var OGVDemuxerWebMW=(()=>{var e="undefined"!=typeof document?document.currentScript?.src:void 0;return"undefined"!=typeof __filename&&(e||=__filename),function(t={}){var n,r,i,o,a,u=t,f=new Promise(((e,t)=>{n=e,r=t})),s=Object.assign({},u),c="object"==typeof window,d="function"==typeof importScripts,l="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,m="";if(l){var p=require("fs"),_=require("path");m=d?_.dirname(m)+"/":__dirname+"/",i=(e,t)=>(e=I(e)?new URL(e):_.normalize(e),p.readFileSync(e,t?void 0:"utf8")),a=e=>((e=i(e,!0)).buffer||(e=new Uint8Array(e)),e),o=(e,t,n,r=!0)=>{e=I(e)?new URL(e):_.normalize(e),p.readFile(e,r?void 0:"utf8",((e,i)=>{e?n(e):t(r?i.buffer:i)}))},process.argv.slice(2)}else(c||d)&&(d?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),e&&(m=e),m=m.startsWith("blob:")?"":m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1),i=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},d&&(a=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),o=(e,t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var v,y=u.print||void 0,g=u.printErr||void 0;Object.assign(u,s),s=null,u.wasmBinary&&(v=u.wasmBinary);var h,b,k,w=!1;function P(){var e=h.buffer;u.HEAP8=new Int8Array(e),u.HEAP16=new Int16Array(e),u.HEAPU8=b=new Uint8Array(e),u.HEAPU16=new Uint16Array(e),u.HEAP32=new Int32Array(e),u.HEAPU32=k=new Uint32Array(e),u.HEAPF32=new Float32Array(e),u.HEAPF64=new Float64Array(e)}var x=[],A=[],R=[];function T(){var e=u.preRun.shift();x.unshift(e)}var W=0,U=null,j=null;function O(e){throw u.onAbort?.(e),g(e="Aborted("+e+")"),w=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),r(e),e}var S,C=e=>e.startsWith("data:application/octet-stream;base64,"),I=e=>e.startsWith("file://");if(!C(S="ogv-demuxer-webm-wasm.wasm")){var E=S;S=u.locateFile?u.locateFile(E,m):m+E}function H(e){if(e==S&&v)return new Uint8Array(v);if(a)return a(e);throw"both async and sync fetching of the wasm failed"}function M(e,t,n){return function(e){if(!v&&(c||d)){if("function"==typeof fetch&&!I(e))return fetch(e,{credentials:"same-origin"}).then((t=>{if(!t.ok)throw`failed to load wasm binary file at '${e}'`;return t.arrayBuffer()})).catch((()=>H(e)));if(o)return new Promise(((t,n)=>{o(e,(e=>t(new Uint8Array(e))),n)}))}return Promise.resolve().then((()=>H(e)))}(e).then((e=>WebAssembly.instantiate(e,t))).then(n,(e=>{g(`failed to asynchronously prepare wasm: ${e}`),O(e)}))}var F,q,D,L,N=e=>{for(;0<e.length;)e.shift()(u)},G="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,B=(e,t)=>{for(var n=t+NaN,r=t;e[r]&&!(r>=n);)++r;if(16<r-t&&e.buffer&&G)return G.decode(e.subarray(t,r));for(n="";t<r;){var i=e[t++];if(128&i){var o=63&e[t++];if(192==(224&i))n+=String.fromCharCode((31&i)<<6|o);else{var a=63&e[t++];65536>(i=224==(240&i)?(15&i)<<12|o<<6|a:(7&i)<<18|o<<12|a<<6|63&e[t++])?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else n+=String.fromCharCode(i)}return n},K=[null,[],[]],V={a:(e,t,n,r)=>{O(`Assertion failed: ${e?B(b,e):""}, at: `+[t?t?B(b,t):"":"unknown filename",n,r?r?B(b,r):"":"unknown function"])},f:(e,t,n)=>b.copyWithin(e,t,t+n),g:()=>{O("")},e:e=>{var t=b.length;if(2147483648<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);var i=Math;r=Math.max(e,r);e:{i=(i.min.call(i,2147483648,r+(65536-r%65536)%65536)-h.buffer.byteLength+65535)/65536;try{h.grow(i),P();var o=1;break e}catch(e){}o=void 0}if(o)return!0}return!1},b:(e,t,n,r)=>{for(var i=0,o=0;o<n;o++){var a=k[t>>2],u=k[t+4>>2];t+=8;for(var f=0;f<u;f++){var s=b[a+f],c=K[e];0===s||10===s?((1===e?y:g)(B(c,0)),c.length=0):c.push(s)}i+=u}return k[r>>2]=i,0},c:function(e,t,n,r){var i=h.buffer;u.audioPackets.push({data:i.slice?i.slice(e,e+t):new Uint8Array(new Uint8Array(i,e,t)).buffer,timestamp:n,discardPadding:r})},j:function(e,t,n,r,i,o,a,f,s,c,d){u.videoFormat={width:e,height:t,chromaWidth:n,chromaHeight:r,cropLeft:f,cropTop:s,cropWidth:o,cropHeight:a,displayWidth:c,displayHeight:d,fps:i}},i:function(e,t){function n(e){for(var t="",n=new Uint8Array(h.buffer);0!=n[e];e++)t+=String.fromCharCode(n[e]);return t}e&&(u.videoCodec=n(e)),t&&(u.audioCodec=n(t)),e=u._ogv_demuxer_media_duration(),u.duration=0<=e?e:NaN,u.loadedMetadata=!0},d:function(e,t){u.onseek&&u.onseek(e+4294967296*t)},h:function(e,t,n,r,i){var o=h.buffer;u.videoPackets.push({data:o.slice?o.slice(e,e+t):new Uint8Array(new Uint8Array(o,e,t)).buffer,timestamp:n,keyframeTimestamp:r,isKeyframe:!!i})}},$=function(){function e(e){return $=e.exports,h=$.k,P(),A.unshift($.l),W--,u.monitorRunDependencies?.(W),0==W&&(null!==U&&(clearInterval(U),U=null),j&&(e=j,j=null,e())),$}var t={a:V};if(W++,u.monitorRunDependencies?.(W),u.instantiateWasm)try{return u.instantiateWasm(t,e)}catch(e){g(`Module.instantiateWasm callback failed with error: ${e}`),r(e)}return function(e,t){var n=S;return v||"function"!=typeof WebAssembly.instantiateStreaming||C(n)||I(n)||l||"function"!=typeof fetch?M(n,e,t):fetch(n,{credentials:"same-origin"}).then((r=>WebAssembly.instantiateStreaming(r,e).then(t,(function(r){return g(`wasm streaming compile failed: ${r}`),g("falling back to ArrayBuffer instantiation"),M(n,e,t)}))))}(t,(function(t){e(t.instance)})).catch(r),{}}();function z(){function e(){if(!F&&(F=!0,u.calledRun=!0,!w)){if(N(A),n(u),u.onRuntimeInitialized&&u.onRuntimeInitialized(),u.postRun)for("function"==typeof u.postRun&&(u.postRun=[u.postRun]);u.postRun.length;){var e=u.postRun.shift();R.unshift(e)}N(R)}}if(!(0<W)){if(u.preRun)for("function"==typeof u.preRun&&(u.preRun=[u.preRun]);u.preRun.length;)T();N(x),0<W||(u.setStatus?(u.setStatus("Running..."),setTimeout((function(){setTimeout((function(){u.setStatus("")}),1),e()}),1)):e())}}if(u._ogv_demuxer_init=()=>(u._ogv_demuxer_init=$.m)(),u._ogv_demuxer_receive_input=(e,t)=>(u._ogv_demuxer_receive_input=$.n)(e,t),u._ogv_demuxer_process=()=>(u._ogv_demuxer_process=$.o)(),u._ogv_demuxer_destroy=()=>(u._ogv_demuxer_destroy=$.p)(),u._ogv_demuxer_flush=()=>(u._ogv_demuxer_flush=$.q)(),u._ogv_demuxer_media_length=()=>(u._ogv_demuxer_media_length=$.r)(),u._ogv_demuxer_media_duration=()=>(u._ogv_demuxer_media_duration=$.s)(),u._ogv_demuxer_seekable=()=>(u._ogv_demuxer_seekable=$.t)(),u._ogv_demuxer_keypoint_offset=e=>(u._ogv_demuxer_keypoint_offset=$.u)(e),u._ogv_demuxer_seek_to_keypoint=e=>(u._ogv_demuxer_seek_to_keypoint=$.v)(e),u._malloc=e=>(u._malloc=$.x)(e),u._free=e=>(u._free=$.y)(e),j=function e(){F||z(),F||(j=e)},u.preInit)for("function"==typeof u.preInit&&(u.preInit=[u.preInit]);0<u.preInit.length;)u.preInit.pop()();function X(e){var t=L();return e=e(),t=L()-t,u.cpuTime+=t,e}return z(),L="undefined"==typeof performance||void 0===performance.now?Date.now:performance.now.bind(performance),u.loadedMetadata=!1,u.videoCodec=null,u.audioCodec=null,u.duration=NaN,u.onseek=null,u.cpuTime=0,u.audioPackets=[],Object.defineProperty(u,"hasAudio",{get:function(){return u.loadedMetadata&&u.audioCodec}}),Object.defineProperty(u,"audioReady",{get:function(){return 0<u.audioPackets.length}}),Object.defineProperty(u,"audioTimestamp",{get:function(){return 0<u.audioPackets.length?u.audioPackets[0].timestamp:-1}}),u.videoPackets=[],Object.defineProperty(u,"hasVideo",{get:function(){return u.loadedMetadata&&u.videoCodec}}),Object.defineProperty(u,"frameReady",{get:function(){return 0<u.videoPackets.length}}),Object.defineProperty(u,"frameTimestamp",{get:function(){return 0<u.videoPackets.length?u.videoPackets[0].timestamp:-1}}),Object.defineProperty(u,"keyframeTimestamp",{get:function(){return 0<u.videoPackets.length?u.videoPackets[0].keyframeTimestamp:-1}}),Object.defineProperty(u,"nextKeyframeTimestamp",{get:function(){for(var e=0;e<u.videoPackets.length;e++){var t=u.videoPackets[e];if(t.isKeyframe)return t.timestamp}return-1}}),Object.defineProperty(u,"processing",{get:function(){return!1}}),Object.defineProperty(u,"seekable",{get:function(){return!!u._ogv_demuxer_seekable()}}),u.init=function(e){X((function(){u._ogv_demuxer_init()})),e()},u.receiveInput=function(e,t){X((function(){var t=e.byteLength;q&&D>=t||(q&&u._free(q),D=t,q=u._malloc(D));var n=q;new Uint8Array(h.buffer,n,t).set(new Uint8Array(e)),u._ogv_demuxer_receive_input(n,t)})),t()},u.process=function(e){e(!!X((function(){return u._ogv_demuxer_process()})))},u.dequeueVideoPacket=function(e){u.videoPackets.length?e(u.videoPackets.shift().data):e(null)},u.dequeueAudioPacket=function(e){if(u.audioPackets.length){var t=u.audioPackets.shift();e(t.data,t.discardPadding)}else e(null)},u.getKeypointOffset=function(e,t){t(X((function(){return u._ogv_demuxer_keypoint_offset(1e3*e)})))},u.seekToKeypoint=function(e,t){var n=X((function(){return u._ogv_demuxer_seek_to_keypoint(1e3*e)}));n&&(u.audioPackets.splice(0,u.audioPackets.length),u.videoPackets.splice(0,u.videoPackets.length)),t(!!n)},u.flush=function(e){X((function(){u.audioPackets.splice(0,u.audioPackets.length),u.videoPackets.splice(0,u.videoPackets.length),u._ogv_demuxer_flush()})),e()},u.close=function(){},f}})();"object"==typeof exports&&"object"==typeof module?module.exports=OGVDemuxerWebMW:"function"==typeof define&&define.amd&&define([],(()=>OGVDemuxerWebMW));