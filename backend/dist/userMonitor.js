'use strict';const a597_0x3c35f5=a597_0x1a68;function a597_0x216e(){const _0x32de3b=['findByPk','./database','__importStar','default','./models/User','getIO','bull','(((.+)+)+)+$','userMonitor','companyId','emit','isNil','initUserMonitorQueues','./utils/logger','hasOwnProperty','13321566tAwjEG','key','email','6865150uOqtse','save','sequelize','SELECT','12FYhKKh','__esModule','search','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','online','update','REDIS_URI','UserMonitor','company-','writable','apply','profile','process','8vOnhuN','prototype','@sentry/node','49dfJZTX','info','removeRepeatableByKey','create','call','add','20124lRaVtk','3184960YGvaLY','defineProperty','logger','448443aZkWQD','data','232164tHMVJr','__createBinding','__setModuleDefault','1542444oZlUAB','toString','length','configurable','query','captureException','*\x20*\x20*\x20*\x20*','UserConnection','143mCzCXi','env'];a597_0x216e=function(){return _0x32de3b;};return a597_0x216e();}(function(_0x47f485,_0x4988ba){const _0x54235b=a597_0x1a68,_0xcc043b=_0x47f485();while(!![]){try{const _0x2a11de=-parseInt(_0x54235b(0xab))/0x1*(parseInt(_0x54235b(0xce))/0x2)+parseInt(_0x54235b(0xa9))/0x3+parseInt(_0x54235b(0xe4))/0x4+parseInt(_0x54235b(0xca))/0x5+-parseInt(_0x54235b(0xae))/0x6*(parseInt(_0x54235b(0xde))/0x7)+parseInt(_0x54235b(0xdb))/0x8*(-parseInt(_0x54235b(0xc7))/0x9)+parseInt(_0x54235b(0xa6))/0xa*(parseInt(_0x54235b(0xb6))/0xb);if(_0x2a11de===_0x4988ba)break;else _0xcc043b['push'](_0xcc043b['shift']());}catch(_0x2b49d5){_0xcc043b['push'](_0xcc043b['shift']());}}}(a597_0x216e,0xf2ff2));var __createBinding=this&&this[a597_0x3c35f5(0xac)]||(Object['create']?function(_0x3b7e2c,_0x12a546,_0x27e1b9,_0x1948b5){const _0x41a7f5=a597_0x3c35f5;if(_0x1948b5===undefined)_0x1948b5=_0x27e1b9;var _0x4ddcaf=Object['getOwnPropertyDescriptor'](_0x12a546,_0x27e1b9);(!_0x4ddcaf||('get'in _0x4ddcaf?!_0x12a546[_0x41a7f5(0xcf)]:_0x4ddcaf[_0x41a7f5(0xd7)]||_0x4ddcaf[_0x41a7f5(0xb1)]))&&(_0x4ddcaf={'enumerable':!![],'get':function(){return _0x12a546[_0x27e1b9];}}),Object[_0x41a7f5(0xa7)](_0x3b7e2c,_0x1948b5,_0x4ddcaf);}:function(_0x320b97,_0xd66725,_0x5b3fca,_0x2ef548){if(_0x2ef548===undefined)_0x2ef548=_0x5b3fca;_0x320b97[_0x2ef548]=_0xd66725[_0x5b3fca];}),__setModuleDefault=this&&this[a597_0x3c35f5(0xad)]||(Object[a597_0x3c35f5(0xe1)]?function(_0x11203f,_0x5f1995){const _0x5295c0=a597_0x3c35f5;Object[_0x5295c0(0xa7)](_0x11203f,_0x5295c0(0xbb),{'enumerable':!![],'value':_0x5f1995});}:function(_0x388212,_0x2dd719){_0x388212['default']=_0x2dd719;}),__importStar=this&&this[a597_0x3c35f5(0xba)]||(function(){const _0xfccedb=(function(){let _0x2dc711=!![];return function(_0x1d883d,_0x5bf7d7){const _0xee8660=_0x2dc711?function(){const _0x3062c2=a597_0x1a68;if(_0x5bf7d7){const _0x1ba0f4=_0x5bf7d7[_0x3062c2(0xd8)](_0x1d883d,arguments);return _0x5bf7d7=null,_0x1ba0f4;}}:function(){};return _0x2dc711=![],_0xee8660;};}()),_0x3e56b0=_0xfccedb(this,function(){const _0x31c73c=a597_0x1a68;return _0x3e56b0[_0x31c73c(0xaf)]()[_0x31c73c(0xd0)]('(((.+)+)+)+$')[_0x31c73c(0xaf)]()['constructor'](_0x3e56b0)['search'](_0x31c73c(0xbf));});_0x3e56b0();var _0x1be157=function(_0x4b2eed){return _0x1be157=Object['getOwnPropertyNames']||function(_0x37d7fb){const _0x1c1598=a597_0x1a68;var _0x1bed40=[];for(var _0x398303 in _0x37d7fb)if(Object[_0x1c1598(0xdc)][_0x1c1598(0xc6)][_0x1c1598(0xe2)](_0x37d7fb,_0x398303))_0x1bed40[_0x1bed40[_0x1c1598(0xb0)]]=_0x398303;return _0x1bed40;},_0x1be157(_0x4b2eed);};return function(_0x3e25af){const _0x22495d=a597_0x1a68;if(_0x3e25af&&_0x3e25af['__esModule'])return _0x3e25af;var _0x12bef6={};if(_0x3e25af!=null){for(var _0x406966=_0x1be157(_0x3e25af),_0x113246=0x0;_0x113246<_0x406966['length'];_0x113246++)if(_0x406966[_0x113246]!==_0x22495d(0xbb))__createBinding(_0x12bef6,_0x3e25af,_0x406966[_0x113246]);}return __setModuleDefault(_0x12bef6,_0x3e25af),_0x12bef6;};}()),__importDefault=this&&this['__importDefault']||function(_0x748a84){return _0x748a84&&_0x748a84['__esModule']?_0x748a84:{'default':_0x748a84};};Object[a597_0x3c35f5(0xa7)](exports,a597_0x3c35f5(0xcf),{'value':!![]}),exports[a597_0x3c35f5(0xc0)]=void 0x0,exports[a597_0x3c35f5(0xc4)]=initUserMonitorQueues;function a597_0x1a68(_0x16c3bb,_0x3e99c5){const _0x2bbdab=a597_0x216e();return a597_0x1a68=function(_0x1d151d,_0x3d1769){_0x1d151d=_0x1d151d-0xa6;let _0x216e5d=_0x2bbdab[_0x1d151d];return _0x216e5d;},a597_0x1a68(_0x16c3bb,_0x3e99c5);}const bull_1=__importDefault(require(a597_0x3c35f5(0xbe))),Sentry=__importStar(require(a597_0x3c35f5(0xdd))),sequelize_1=require(a597_0x3c35f5(0xcc)),lodash_1=require('lodash'),logger_1=require(a597_0x3c35f5(0xc5)),database_1=__importDefault(require(a597_0x3c35f5(0xb9))),User_1=__importDefault(require(a597_0x3c35f5(0xbc))),socket_1=require('./libs/socket'),connection=process[a597_0x3c35f5(0xb7)][a597_0x3c35f5(0xd4)]||'';exports['userMonitor']=new bull_1['default'](a597_0x3c35f5(0xd5),connection);async function handleLoginStatus(_0x5d767a){const _0x48c873=a597_0x3c35f5,_0x5bbeef=await database_1[_0x48c873(0xbb)][_0x48c873(0xb2)](_0x48c873(0xd1),{'type':sequelize_1['QueryTypes'][_0x48c873(0xcd)]});for(let _0x42b48f of _0x5bbeef){try{const _0x44647b=await User_1[_0x48c873(0xbb)][_0x48c873(0xb8)](_0x42b48f['id']);await _0x44647b[_0x48c873(0xd3)]({'online':![]});const _0x13f3ce=(0x0,socket_1[_0x48c873(0xbd)])();_0x13f3ce[_0x48c873(0xc2)](_0x48c873(0xd6)+_0x44647b[_0x48c873(0xc1)]+'-user',{'action':_0x48c873(0xd3),'user':{'id':_0x44647b['id'],'name':_0x44647b['name'],'email':_0x44647b[_0x48c873(0xc9)],'profile':_0x44647b[_0x48c873(0xd9)],'online':![]}}),logger_1[_0x48c873(0xa8)][_0x48c873(0xdf)]('Usuário\x20passado\x20para\x20offline:\x20'+_0x42b48f['id']);}catch(_0x473dbd){Sentry[_0x48c873(0xb3)](_0x473dbd);}}}async function handleUserConnection(_0x1650b2){const _0x25b6cb=a597_0x3c35f5;try{const {id:_0x859e20}=_0x1650b2[_0x25b6cb(0xaa)];if(!(0x0,lodash_1[_0x25b6cb(0xc3)])(_0x859e20)&&_0x859e20!=='null'){const _0x1521fe=await User_1[_0x25b6cb(0xbb)][_0x25b6cb(0xb8)](_0x859e20);if(_0x1521fe){_0x1521fe[_0x25b6cb(0xd2)]=!![],await _0x1521fe[_0x25b6cb(0xcb)]();const _0x569b94=(0x0,socket_1[_0x25b6cb(0xbd)])();_0x569b94['emit'](_0x25b6cb(0xd6)+_0x1521fe[_0x25b6cb(0xc1)]+'-user',{'action':_0x25b6cb(0xd3),'user':{'id':_0x1521fe['id'],'name':_0x1521fe['name'],'email':_0x1521fe[_0x25b6cb(0xc9)],'profile':_0x1521fe[_0x25b6cb(0xd9)],'online':!![]}});}}}catch(_0x230573){Sentry['captureException'](_0x230573);}}exports[a597_0x3c35f5(0xc0)][a597_0x3c35f5(0xda)](a597_0x3c35f5(0xb5),handleUserConnection),exports[a597_0x3c35f5(0xc0)][a597_0x3c35f5(0xda)]('VerifyLoginStatus',handleLoginStatus);async function initUserMonitorQueues(){const _0x304647=a597_0x3c35f5,_0x591cf6=await exports[_0x304647(0xc0)]['getRepeatableJobs']();for(let _0x3886fa of _0x591cf6){await exports[_0x304647(0xc0)][_0x304647(0xe0)](_0x3886fa[_0x304647(0xc8)]);}exports[_0x304647(0xc0)][_0x304647(0xe3)]('VerifyLoginStatus',{},{'repeat':{'cron':_0x304647(0xb4)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x304647(0xa8)]['info']('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado');}