'use strict';const a591_0x6898f1=a591_0x3c9c;function a591_0xa184(){const _0x1d85f2=['update','add','removeRepeatableByKey','__createBinding','UserConnection','7JtleWU','bull','@sentry/node','env','data','28166sXsmAO','query','43YbuhYq','initUserMonitorQueues','./utils/logger','UserMonitor','apply','QueryTypes','__importDefault','null','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','userMonitor','info','lodash','online','length','VerifyLoginStatus','create','*\x20*\x20*\x20*\x20*','defineProperty','20109300NDbwGo','findByPk','toString','search','(((.+)+)+)+$','get','isNil','11xHmQNj','configurable','Usuário\x20passado\x20para\x20offline:\x20','__esModule','8040666ejklEm','REDIS_URI','SELECT','6495990lmYphV','process','save','sequelize','getRepeatableJobs','getOwnPropertyNames','captureException','702ATTFyR','149120eksbiz','44eifjYk','logger','6683512prgFQu','./models/User','writable','141849Adcyqc','key','default','hasOwnProperty','getOwnPropertyDescriptor','__importStar'];a591_0xa184=function(){return _0x1d85f2;};return a591_0xa184();}(function(_0x40c86c,_0x3dcb20){const _0xed692a=a591_0x3c9c,_0x28169e=_0x40c86c();while(!![]){try{const _0x1925db=parseInt(_0xed692a(0x12e))/0x1*(parseInt(_0xed692a(0x12c))/0x2)+-parseInt(_0xed692a(0x11c))/0x3*(-parseInt(_0xed692a(0x117))/0x4)+parseInt(_0xed692a(0x10e))/0x5+parseInt(_0xed692a(0x10b))/0x6*(-parseInt(_0xed692a(0x127))/0x7)+-parseInt(_0xed692a(0x119))/0x8+parseInt(_0xed692a(0x115))/0x9*(-parseInt(_0xed692a(0x116))/0xa)+parseInt(_0xed692a(0x107))/0xb*(parseInt(_0xed692a(0x140))/0xc);if(_0x1925db===_0x3dcb20)break;else _0x28169e['push'](_0x28169e['shift']());}catch(_0x523085){_0x28169e['push'](_0x28169e['shift']());}}}(a591_0xa184,0xba071));var __createBinding=this&&this[a591_0x6898f1(0x125)]||(Object[a591_0x6898f1(0x13d)]?function(_0x347ddd,_0x1dbc8b,_0x35af14,_0x401eb8){const _0x5e9ed1=a591_0x6898f1;if(_0x401eb8===undefined)_0x401eb8=_0x35af14;var _0x4be1ce=Object[_0x5e9ed1(0x120)](_0x1dbc8b,_0x35af14);(!_0x4be1ce||(_0x5e9ed1(0x145)in _0x4be1ce?!_0x1dbc8b[_0x5e9ed1(0x10a)]:_0x4be1ce[_0x5e9ed1(0x11b)]||_0x4be1ce[_0x5e9ed1(0x108)]))&&(_0x4be1ce={'enumerable':!![],'get':function(){return _0x1dbc8b[_0x35af14];}}),Object[_0x5e9ed1(0x13f)](_0x347ddd,_0x401eb8,_0x4be1ce);}:function(_0x3d1624,_0x5ce6c8,_0x46e0e1,_0x5cb985){if(_0x5cb985===undefined)_0x5cb985=_0x46e0e1;_0x3d1624[_0x5cb985]=_0x5ce6c8[_0x46e0e1];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a591_0x6898f1(0x13d)]?function(_0x2d80bd,_0x30c77f){const _0x47e1a4=a591_0x6898f1;Object[_0x47e1a4(0x13f)](_0x2d80bd,'default',{'enumerable':!![],'value':_0x30c77f});}:function(_0x493693,_0x202907){const _0xc4afe=a591_0x6898f1;_0x493693[_0xc4afe(0x11e)]=_0x202907;}),__importStar=this&&this[a591_0x6898f1(0x121)]||(function(){const _0x540131=(function(){let _0x1542c6=!![];return function(_0x4bd129,_0x84dde2){const _0x19a184=_0x1542c6?function(){const _0x1a6d78=a591_0x3c9c;if(_0x84dde2){const _0x10b3ed=_0x84dde2[_0x1a6d78(0x132)](_0x4bd129,arguments);return _0x84dde2=null,_0x10b3ed;}}:function(){};return _0x1542c6=![],_0x19a184;};}()),_0x3364ee=_0x540131(this,function(){const _0x19e01a=a591_0x3c9c;return _0x3364ee['toString']()[_0x19e01a(0x143)](_0x19e01a(0x144))[_0x19e01a(0x142)]()['constructor'](_0x3364ee)[_0x19e01a(0x143)](_0x19e01a(0x144));});_0x3364ee();var _0x394a80=function(_0x7f981c){const _0x4245a6=a591_0x3c9c;return _0x394a80=Object[_0x4245a6(0x113)]||function(_0x522bd9){const _0x41a2a3=_0x4245a6;var _0x45dde1=[];for(var _0x2ea61d in _0x522bd9)if(Object['prototype'][_0x41a2a3(0x11f)]['call'](_0x522bd9,_0x2ea61d))_0x45dde1[_0x45dde1[_0x41a2a3(0x13b)]]=_0x2ea61d;return _0x45dde1;},_0x394a80(_0x7f981c);};return function(_0x35fa7e){const _0x2f0195=a591_0x3c9c;if(_0x35fa7e&&_0x35fa7e[_0x2f0195(0x10a)])return _0x35fa7e;var _0x50a0c2={};if(_0x35fa7e!=null){for(var _0x453c8e=_0x394a80(_0x35fa7e),_0xf4ecdf=0x0;_0xf4ecdf<_0x453c8e[_0x2f0195(0x13b)];_0xf4ecdf++)if(_0x453c8e[_0xf4ecdf]!==_0x2f0195(0x11e))__createBinding(_0x50a0c2,_0x35fa7e,_0x453c8e[_0xf4ecdf]);}return __setModuleDefault(_0x50a0c2,_0x35fa7e),_0x50a0c2;};}()),__importDefault=this&&this[a591_0x6898f1(0x134)]||function(_0x544c4f){const _0x1b8674=a591_0x6898f1;return _0x544c4f&&_0x544c4f[_0x1b8674(0x10a)]?_0x544c4f:{'default':_0x544c4f};};Object['defineProperty'](exports,a591_0x6898f1(0x10a),{'value':!![]}),exports[a591_0x6898f1(0x137)]=void 0x0,exports[a591_0x6898f1(0x12f)]=initUserMonitorQueues;const bull_1=__importDefault(require(a591_0x6898f1(0x128))),Sentry=__importStar(require(a591_0x6898f1(0x129))),sequelize_1=require(a591_0x6898f1(0x111)),lodash_1=require(a591_0x6898f1(0x139)),logger_1=require(a591_0x6898f1(0x130)),database_1=__importDefault(require('./database')),User_1=__importDefault(require(a591_0x6898f1(0x11a))),connection=process[a591_0x6898f1(0x12a)][a591_0x6898f1(0x10c)]||'';exports[a591_0x6898f1(0x137)]=new bull_1[(a591_0x6898f1(0x11e))](a591_0x6898f1(0x131),connection);function a591_0x3c9c(_0x5d96c8,_0x259188){const _0x2c3af3=a591_0xa184();return a591_0x3c9c=function(_0x16bef8,_0x3b3e2f){_0x16bef8=_0x16bef8-0x106;let _0xa18421=_0x2c3af3[_0x16bef8];return _0xa18421;},a591_0x3c9c(_0x5d96c8,_0x259188);}async function handleLoginStatus(_0x2c1c68){const _0x5d5603=a591_0x6898f1,_0x804f43=await database_1[_0x5d5603(0x11e)][_0x5d5603(0x12d)](_0x5d5603(0x136),{'type':sequelize_1[_0x5d5603(0x133)][_0x5d5603(0x10d)]});for(let _0x41faa8 of _0x804f43){try{const _0x317d69=await User_1['default']['findByPk'](_0x41faa8['id']);await _0x317d69[_0x5d5603(0x122)]({'online':![]}),logger_1[_0x5d5603(0x118)]['info'](_0x5d5603(0x109)+_0x41faa8['id']);}catch(_0x11807f){Sentry[_0x5d5603(0x114)](_0x11807f);}}}async function handleUserConnection(_0x246123){const _0x23c0b4=a591_0x6898f1;try{const {id:_0x5acbc1}=_0x246123[_0x23c0b4(0x12b)];if(!(0x0,lodash_1[_0x23c0b4(0x106)])(_0x5acbc1)&&_0x5acbc1!==_0x23c0b4(0x135)){const _0x31fe98=await User_1[_0x23c0b4(0x11e)][_0x23c0b4(0x141)](_0x5acbc1);_0x31fe98&&(_0x31fe98[_0x23c0b4(0x13a)]=!![],await _0x31fe98[_0x23c0b4(0x110)]());}}catch(_0x4dbbb8){Sentry[_0x23c0b4(0x114)](_0x4dbbb8);}}exports[a591_0x6898f1(0x137)][a591_0x6898f1(0x10f)](a591_0x6898f1(0x126),handleUserConnection),exports[a591_0x6898f1(0x137)][a591_0x6898f1(0x10f)](a591_0x6898f1(0x13c),handleLoginStatus);async function initUserMonitorQueues(){const _0x394e23=a591_0x6898f1,_0x2f2498=await exports[_0x394e23(0x137)][_0x394e23(0x112)]();for(let _0x4451b2 of _0x2f2498){await exports[_0x394e23(0x137)][_0x394e23(0x124)](_0x4451b2[_0x394e23(0x11d)]);}exports[_0x394e23(0x137)][_0x394e23(0x123)](_0x394e23(0x13c),{},{'repeat':{'cron':_0x394e23(0x13e)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x394e23(0x118)][_0x394e23(0x138)]('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado');}