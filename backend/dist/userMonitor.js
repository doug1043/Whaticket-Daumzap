'use strict';const a716_0xc0579f=a716_0x41f6;(function(_0x4e580b,_0x19f5ab){const _0x4116a1=a716_0x41f6,_0x12e348=_0x4e580b();while(!![]){try{const _0x52c493=parseInt(_0x4116a1(0x199))/0x1*(parseInt(_0x4116a1(0x184))/0x2)+-parseInt(_0x4116a1(0x1a8))/0x3*(parseInt(_0x4116a1(0x187))/0x4)+-parseInt(_0x4116a1(0x179))/0x5+-parseInt(_0x4116a1(0x178))/0x6+parseInt(_0x4116a1(0x1a0))/0x7*(-parseInt(_0x4116a1(0x176))/0x8)+-parseInt(_0x4116a1(0x173))/0x9*(parseInt(_0x4116a1(0x17c))/0xa)+parseInt(_0x4116a1(0x1a7))/0xb*(parseInt(_0x4116a1(0x16e))/0xc);if(_0x52c493===_0x19f5ab)break;else _0x12e348['push'](_0x12e348['shift']());}catch(_0x1170c6){_0x12e348['push'](_0x12e348['shift']());}}}(a716_0x22a0,0xd8d53));function a716_0x41f6(_0x57de2a,_0x49c294){const _0x2e774d=a716_0x22a0();return a716_0x41f6=function(_0x54b6d9,_0x3ef1a1){_0x54b6d9=_0x54b6d9-0x168;let _0x22a053=_0x2e774d[_0x54b6d9];return _0x22a053;},a716_0x41f6(_0x57de2a,_0x49c294);}var __createBinding=this&&this[a716_0xc0579f(0x19f)]||(Object[a716_0xc0579f(0x195)]?function(_0x87b6cb,_0x3aa6d1,_0x466822,_0x568fc5){const _0x4834b2=a716_0xc0579f;if(_0x568fc5===undefined)_0x568fc5=_0x466822;var _0x50a7ff=Object[_0x4834b2(0x177)](_0x3aa6d1,_0x466822);(!_0x50a7ff||(_0x4834b2(0x197)in _0x50a7ff?!_0x3aa6d1[_0x4834b2(0x18c)]:_0x50a7ff[_0x4834b2(0x196)]||_0x50a7ff['configurable']))&&(_0x50a7ff={'enumerable':!![],'get':function(){return _0x3aa6d1[_0x466822];}}),Object[_0x4834b2(0x188)](_0x87b6cb,_0x568fc5,_0x50a7ff);}:function(_0x3aff2f,_0x4c5864,_0xe31dd0,_0x2a352b){if(_0x2a352b===undefined)_0x2a352b=_0xe31dd0;_0x3aff2f[_0x2a352b]=_0x4c5864[_0xe31dd0];}),__setModuleDefault=this&&this[a716_0xc0579f(0x17f)]||(Object[a716_0xc0579f(0x195)]?function(_0x5b7f9b,_0x2243b5){const _0x44a69b=a716_0xc0579f;Object[_0x44a69b(0x188)](_0x5b7f9b,_0x44a69b(0x174),{'enumerable':!![],'value':_0x2243b5});}:function(_0x45fc0d,_0x5244fd){const _0xb45e57=a716_0xc0579f;_0x45fc0d[_0xb45e57(0x174)]=_0x5244fd;}),__importStar=this&&this['__importStar']||(function(){const _0x53014a=(function(){let _0x437cb5=!![];return function(_0x59a896,_0xd08065){const _0x1bf335=_0x437cb5?function(){const _0x9e7f14=a716_0x41f6;if(_0xd08065){const _0x4080fe=_0xd08065[_0x9e7f14(0x1a4)](_0x59a896,arguments);return _0xd08065=null,_0x4080fe;}}:function(){};return _0x437cb5=![],_0x1bf335;};}()),_0x4256ab=_0x53014a(this,function(){const _0x5c638d=a716_0x41f6;return _0x4256ab[_0x5c638d(0x175)]()['search']('(((.+)+)+)+$')[_0x5c638d(0x175)]()[_0x5c638d(0x19b)](_0x4256ab)[_0x5c638d(0x169)]('(((.+)+)+)+$');});_0x4256ab();var _0x4f21a5=function(_0x5aeccb){const _0x1e93c4=a716_0x41f6;return _0x4f21a5=Object[_0x1e93c4(0x19a)]||function(_0x37a553){const _0x7ba89d=_0x1e93c4;var _0x48ba6f=[];for(var _0x5c2d49 in _0x37a553)if(Object[_0x7ba89d(0x193)][_0x7ba89d(0x170)]['call'](_0x37a553,_0x5c2d49))_0x48ba6f[_0x48ba6f[_0x7ba89d(0x182)]]=_0x5c2d49;return _0x48ba6f;},_0x4f21a5(_0x5aeccb);};return function(_0x4c4c80){const _0x4802d2=a716_0x41f6;if(_0x4c4c80&&_0x4c4c80[_0x4802d2(0x18c)])return _0x4c4c80;var _0xb2df5e={};if(_0x4c4c80!=null){for(var _0x400a0f=_0x4f21a5(_0x4c4c80),_0x39e667=0x0;_0x39e667<_0x400a0f[_0x4802d2(0x182)];_0x39e667++)if(_0x400a0f[_0x39e667]!==_0x4802d2(0x174))__createBinding(_0xb2df5e,_0x4c4c80,_0x400a0f[_0x39e667]);}return __setModuleDefault(_0xb2df5e,_0x4c4c80),_0xb2df5e;};}()),__importDefault=this&&this['__importDefault']||function(_0x4b3f8d){const _0x3fb8c8=a716_0xc0579f;return _0x4b3f8d&&_0x4b3f8d[_0x3fb8c8(0x18c)]?_0x4b3f8d:{'default':_0x4b3f8d};};Object['defineProperty'](exports,a716_0xc0579f(0x18c),{'value':!![]}),exports[a716_0xc0579f(0x194)]=void 0x0,exports[a716_0xc0579f(0x17a)]=initUserMonitorQueues;const bull_1=__importDefault(require(a716_0xc0579f(0x18b))),Sentry=__importStar(require(a716_0xc0579f(0x18a))),sequelize_1=require('sequelize'),lodash_1=require('lodash'),logger_1=require('./utils/logger'),database_1=__importDefault(require(a716_0xc0579f(0x19e))),User_1=__importDefault(require(a716_0xc0579f(0x172))),socket_1=require('./libs/socket'),connection=process[a716_0xc0579f(0x191)][a716_0xc0579f(0x18d)]||'';exports['userMonitor']=new bull_1[(a716_0xc0579f(0x174))]('UserMonitor',connection);function a716_0x22a0(){const _0x4a31b5=['7638340YSwCKb','initUserMonitorQueues','captureException','911390LgsYzo','process','query','__setModuleDefault','getRepeatableJobs','UserConnection','length','key','2IEHyzf','findByPk','getIO','64maFYxF','defineProperty','QueryTypes','@sentry/node','bull','__esModule','REDIS_URI','Usuário\x20passado\x20para\x20offline:\x20','email','name','env','null','prototype','userMonitor','create','writable','get','profile','610993nPPtZg','getOwnPropertyNames','constructor','companyId','info','./database','__createBinding','1547105CQosuP','company-','emit','data','apply','logger','removeRepeatableByKey','11789987auxEgN','220488QqXAJU','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','search','-user','isNil','add','update','72ioNEfy','SELECT','hasOwnProperty','VerifyLoginStatus','./models/User','99wiGjtz','default','toString','56DIRFNj','getOwnPropertyDescriptor','5403060HxCWxP'];a716_0x22a0=function(){return _0x4a31b5;};return a716_0x22a0();}async function handleLoginStatus(_0x557109){const _0x2e8aad=a716_0xc0579f,_0x1f3f8e=await database_1['default'][_0x2e8aad(0x17e)](_0x2e8aad(0x168),{'type':sequelize_1[_0x2e8aad(0x189)][_0x2e8aad(0x16f)]});for(let _0x1c09f8 of _0x1f3f8e){try{const _0x17fd75=await User_1[_0x2e8aad(0x174)][_0x2e8aad(0x185)](_0x1c09f8['id']);await _0x17fd75['update']({'online':![]});const _0x54cb69=(0x0,socket_1[_0x2e8aad(0x186)])();_0x54cb69[_0x2e8aad(0x1a2)](_0x2e8aad(0x1a1)+_0x17fd75[_0x2e8aad(0x19c)]+'-user',{'action':_0x2e8aad(0x16d),'user':{'id':_0x17fd75['id'],'name':_0x17fd75['name'],'email':_0x17fd75[_0x2e8aad(0x18f)],'profile':_0x17fd75[_0x2e8aad(0x198)],'online':![]}}),logger_1[_0x2e8aad(0x1a5)][_0x2e8aad(0x19d)](_0x2e8aad(0x18e)+_0x1c09f8['id']);}catch(_0x192c2a){Sentry['captureException'](_0x192c2a);}}}async function handleUserConnection(_0x2be358){const _0x44863c=a716_0xc0579f;try{const {id:_0x5c4d2b}=_0x2be358[_0x44863c(0x1a3)];if(!(0x0,lodash_1[_0x44863c(0x16b)])(_0x5c4d2b)&&_0x5c4d2b!==_0x44863c(0x192)){const _0x152e6c=await User_1[_0x44863c(0x174)]['findByPk'](_0x5c4d2b);if(_0x152e6c){_0x152e6c['online']=!![],await _0x152e6c['save']();const _0x3a43d2=(0x0,socket_1[_0x44863c(0x186)])();_0x3a43d2['emit']('company-'+_0x152e6c[_0x44863c(0x19c)]+_0x44863c(0x16a),{'action':_0x44863c(0x16d),'user':{'id':_0x152e6c['id'],'name':_0x152e6c[_0x44863c(0x190)],'email':_0x152e6c['email'],'profile':_0x152e6c['profile'],'online':!![]}});}}}catch(_0x5f113c){Sentry[_0x44863c(0x17b)](_0x5f113c);}}exports[a716_0xc0579f(0x194)]['process'](a716_0xc0579f(0x181),handleUserConnection),exports[a716_0xc0579f(0x194)][a716_0xc0579f(0x17d)](a716_0xc0579f(0x171),handleLoginStatus);async function initUserMonitorQueues(){const _0x30d456=a716_0xc0579f,_0x314a91=await exports[_0x30d456(0x194)][_0x30d456(0x180)]();for(let _0x56b310 of _0x314a91){await exports[_0x30d456(0x194)][_0x30d456(0x1a6)](_0x56b310[_0x30d456(0x183)]);}exports[_0x30d456(0x194)][_0x30d456(0x16c)](_0x30d456(0x171),{},{'repeat':{'cron':'*\x20*\x20*\x20*\x20*'},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1['logger'][_0x30d456(0x19d)]('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado');}