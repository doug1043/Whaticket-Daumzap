'use strict';const a596_0x3f8ab5=a596_0xde00;(function(_0x89631e,_0x16684b){const _0x187f12=a596_0xde00,_0x3da90c=_0x89631e();while(!![]){try{const _0x4ceb8e=parseInt(_0x187f12(0x168))/0x1+-parseInt(_0x187f12(0x186))/0x2+-parseInt(_0x187f12(0x169))/0x3+-parseInt(_0x187f12(0x163))/0x4*(-parseInt(_0x187f12(0x160))/0x5)+-parseInt(_0x187f12(0x161))/0x6+-parseInt(_0x187f12(0x158))/0x7*(parseInt(_0x187f12(0x15c))/0x8)+parseInt(_0x187f12(0x16f))/0x9;if(_0x4ceb8e===_0x16684b)break;else _0x3da90c['push'](_0x3da90c['shift']());}catch(_0x147220){_0x3da90c['push'](_0x3da90c['shift']());}}}(a596_0x116c,0xdc35b));function a596_0x116c(){const _0x30bbd2=['QueryTypes','./utils/logger','812700tIXaXJ','2616231xtCTMZ','key','__esModule','initUserMonitorQueues','@sentry/node','isNil','23899644tAlsvx','writable','create','UserConnection','call','./models/User','defineProperty','bull','captureException','getRepeatableJobs','VerifyLoginStatus','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','__importDefault','__createBinding','hasOwnProperty','search','removeRepeatableByKey','logger','default','query','sequelize','Usuário\x20passado\x20para\x20offline:\x20','constructor','34208nBtpyL','configurable','info','update','userMonitor','length','*\x20*\x20*\x20*\x20*','null','(((.+)+)+)+$','237433FDEXvO','Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado','apply','online','232RGpHKZ','env','toString','REDIS_URI','1343185zKHZNy','7384074uJFRDI','process','8kzoLrV','prototype','findByPk'];a596_0x116c=function(){return _0x30bbd2;};return a596_0x116c();}var __createBinding=this&&this[a596_0x3f8ab5(0x17c)]||(Object[a596_0x3f8ab5(0x171)]?function(_0x30b08c,_0x2eeaa3,_0x2cd522,_0x26d2a3){const _0x2f42fa=a596_0x3f8ab5;if(_0x26d2a3===undefined)_0x26d2a3=_0x2cd522;var _0x1e8791=Object['getOwnPropertyDescriptor'](_0x2eeaa3,_0x2cd522);(!_0x1e8791||('get'in _0x1e8791?!_0x2eeaa3[_0x2f42fa(0x16b)]:_0x1e8791[_0x2f42fa(0x170)]||_0x1e8791[_0x2f42fa(0x187)]))&&(_0x1e8791={'enumerable':!![],'get':function(){return _0x2eeaa3[_0x2cd522];}}),Object['defineProperty'](_0x30b08c,_0x26d2a3,_0x1e8791);}:function(_0x6d81ee,_0x46df6e,_0x52e411,_0x150503){if(_0x150503===undefined)_0x150503=_0x52e411;_0x6d81ee[_0x150503]=_0x46df6e[_0x52e411];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a596_0x3f8ab5(0x171)]?function(_0x986f8,_0x221c09){const _0x12809b=a596_0x3f8ab5;Object[_0x12809b(0x175)](_0x986f8,_0x12809b(0x181),{'enumerable':!![],'value':_0x221c09});}:function(_0x15ced8,_0x45a621){const _0x3c5b9f=a596_0x3f8ab5;_0x15ced8[_0x3c5b9f(0x181)]=_0x45a621;}),__importStar=this&&this['__importStar']||(function(){const _0x4093c8=(function(){let _0x4d5afe=!![];return function(_0x213a98,_0x1218b9){const _0x45166f=_0x4d5afe?function(){const _0x404cc8=a596_0xde00;if(_0x1218b9){const _0x416c3c=_0x1218b9[_0x404cc8(0x15a)](_0x213a98,arguments);return _0x1218b9=null,_0x416c3c;}}:function(){};return _0x4d5afe=![],_0x45166f;};}()),_0x43bff6=_0x4093c8(this,function(){const _0x1f462b=a596_0xde00;return _0x43bff6[_0x1f462b(0x15e)]()[_0x1f462b(0x17e)](_0x1f462b(0x157))[_0x1f462b(0x15e)]()[_0x1f462b(0x185)](_0x43bff6)[_0x1f462b(0x17e)](_0x1f462b(0x157));});_0x43bff6();var _0x4abb99=function(_0x56f943){return _0x4abb99=Object['getOwnPropertyNames']||function(_0x3d540b){const _0x32448a=a596_0xde00;var _0x7f007c=[];for(var _0x571159 in _0x3d540b)if(Object[_0x32448a(0x164)][_0x32448a(0x17d)][_0x32448a(0x173)](_0x3d540b,_0x571159))_0x7f007c[_0x7f007c[_0x32448a(0x154)]]=_0x571159;return _0x7f007c;},_0x4abb99(_0x56f943);};return function(_0x521709){const _0xf6339d=a596_0xde00;if(_0x521709&&_0x521709[_0xf6339d(0x16b)])return _0x521709;var _0xb1925a={};if(_0x521709!=null){for(var _0x3ec797=_0x4abb99(_0x521709),_0x5a19e8=0x0;_0x5a19e8<_0x3ec797[_0xf6339d(0x154)];_0x5a19e8++)if(_0x3ec797[_0x5a19e8]!==_0xf6339d(0x181))__createBinding(_0xb1925a,_0x521709,_0x3ec797[_0x5a19e8]);}return __setModuleDefault(_0xb1925a,_0x521709),_0xb1925a;};}()),__importDefault=this&&this[a596_0x3f8ab5(0x17b)]||function(_0x497a4c){const _0x244ecf=a596_0x3f8ab5;return _0x497a4c&&_0x497a4c[_0x244ecf(0x16b)]?_0x497a4c:{'default':_0x497a4c};};Object['defineProperty'](exports,a596_0x3f8ab5(0x16b),{'value':!![]}),exports[a596_0x3f8ab5(0x153)]=void 0x0,exports[a596_0x3f8ab5(0x16c)]=initUserMonitorQueues;const bull_1=__importDefault(require(a596_0x3f8ab5(0x176))),Sentry=__importStar(require(a596_0x3f8ab5(0x16d))),sequelize_1=require(a596_0x3f8ab5(0x183)),lodash_1=require('lodash'),logger_1=require(a596_0x3f8ab5(0x167)),database_1=__importDefault(require('./database')),User_1=__importDefault(require(a596_0x3f8ab5(0x174))),connection=process[a596_0x3f8ab5(0x15d)][a596_0x3f8ab5(0x15f)]||'';exports[a596_0x3f8ab5(0x153)]=new bull_1[(a596_0x3f8ab5(0x181))]('UserMonitor',connection);async function handleLoginStatus(_0x2a61f7){const _0x2a4f29=a596_0x3f8ab5,_0x22fa49=await database_1['default'][_0x2a4f29(0x182)](_0x2a4f29(0x17a),{'type':sequelize_1[_0x2a4f29(0x166)]['SELECT']});for(let _0x11f09f of _0x22fa49){try{const _0x40852b=await User_1[_0x2a4f29(0x181)][_0x2a4f29(0x165)](_0x11f09f['id']);await _0x40852b[_0x2a4f29(0x152)]({'online':![]}),logger_1[_0x2a4f29(0x180)][_0x2a4f29(0x188)](_0x2a4f29(0x184)+_0x11f09f['id']);}catch(_0x398b89){Sentry['captureException'](_0x398b89);}}}async function handleUserConnection(_0x6bb498){const _0x90c20=a596_0x3f8ab5;try{const {id:_0x1a7122}=_0x6bb498['data'];if(!(0x0,lodash_1[_0x90c20(0x16e)])(_0x1a7122)&&_0x1a7122!==_0x90c20(0x156)){const _0x30710e=await User_1[_0x90c20(0x181)][_0x90c20(0x165)](_0x1a7122);_0x30710e&&(_0x30710e[_0x90c20(0x15b)]=!![],await _0x30710e['save']());}}catch(_0x34eaad){Sentry[_0x90c20(0x177)](_0x34eaad);}}exports['userMonitor']['process'](a596_0x3f8ab5(0x172),handleUserConnection),exports[a596_0x3f8ab5(0x153)][a596_0x3f8ab5(0x162)]('VerifyLoginStatus',handleLoginStatus);function a596_0xde00(_0x32a6f3,_0x4274ca){const _0x17ca8e=a596_0x116c();return a596_0xde00=function(_0x5db840,_0x5b7fa8){_0x5db840=_0x5db840-0x152;let _0x116c91=_0x17ca8e[_0x5db840];return _0x116c91;},a596_0xde00(_0x32a6f3,_0x4274ca);}async function initUserMonitorQueues(){const _0xe9213=a596_0x3f8ab5,_0x326642=await exports['userMonitor'][_0xe9213(0x178)]();for(let _0x244417 of _0x326642){await exports['userMonitor'][_0xe9213(0x17f)](_0x244417[_0xe9213(0x16a)]);}exports[_0xe9213(0x153)]['add'](_0xe9213(0x179),{},{'repeat':{'cron':_0xe9213(0x155)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0xe9213(0x180)][_0xe9213(0x188)](_0xe9213(0x159));}