'use strict';const a717_0x42f767=a717_0x4212;(function(_0x40ae4b,_0x99ce58){const _0x37a9f6=a717_0x4212,_0x13fecf=_0x40ae4b();while(!![]){try{const _0x2838a1=-parseInt(_0x37a9f6(0xae))/0x1*(-parseInt(_0x37a9f6(0xb5))/0x2)+parseInt(_0x37a9f6(0xad))/0x3*(-parseInt(_0x37a9f6(0xb3))/0x4)+parseInt(_0x37a9f6(0xb7))/0x5+parseInt(_0x37a9f6(0xc5))/0x6+parseInt(_0x37a9f6(0xc9))/0x7*(-parseInt(_0x37a9f6(0xb2))/0x8)+-parseInt(_0x37a9f6(0x98))/0x9+parseInt(_0x37a9f6(0x96))/0xa;if(_0x2838a1===_0x99ce58)break;else _0x13fecf['push'](_0x13fecf['shift']());}catch(_0x2e0425){_0x13fecf['push'](_0x13fecf['shift']());}}}(a717_0x29d7,0xb595f));var __createBinding=this&&this[a717_0x42f767(0x9c)]||(Object[a717_0x42f767(0xc3)]?function(_0x1e9831,_0x4788e6,_0x1b0a3d,_0x34ade4){const _0x383679=a717_0x42f767;if(_0x34ade4===undefined)_0x34ade4=_0x1b0a3d;var _0x3092a5=Object[_0x383679(0xbb)](_0x4788e6,_0x1b0a3d);(!_0x3092a5||(_0x383679(0x8f)in _0x3092a5?!_0x4788e6[_0x383679(0xbc)]:_0x3092a5['writable']||_0x3092a5[_0x383679(0x9a)]))&&(_0x3092a5={'enumerable':!![],'get':function(){return _0x4788e6[_0x1b0a3d];}}),Object[_0x383679(0xa6)](_0x1e9831,_0x34ade4,_0x3092a5);}:function(_0x47c46e,_0x26bd92,_0xa9061d,_0x6307ae){if(_0x6307ae===undefined)_0x6307ae=_0xa9061d;_0x47c46e[_0x6307ae]=_0x26bd92[_0xa9061d];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x4bf7bc,_0x1a6c6a){const _0x2b4cb9=a717_0x42f767;Object['defineProperty'](_0x4bf7bc,_0x2b4cb9(0xb6),{'enumerable':!![],'value':_0x1a6c6a});}:function(_0x24bafb,_0x110de5){const _0x56cf85=a717_0x42f767;_0x24bafb[_0x56cf85(0xb6)]=_0x110de5;}),__importStar=this&&this[a717_0x42f767(0x94)]||(function(){const _0x5e0532=(function(){let _0xc306=!![];return function(_0x383a21,_0x4052d5){const _0x38c0cc=_0xc306?function(){if(_0x4052d5){const _0x55804c=_0x4052d5['apply'](_0x383a21,arguments);return _0x4052d5=null,_0x55804c;}}:function(){};return _0xc306=![],_0x38c0cc;};}()),_0x124f4f=_0x5e0532(this,function(){const _0x4b165a=a717_0x4212;return _0x124f4f['toString']()['search'](_0x4b165a(0xb1))[_0x4b165a(0xa3)]()['constructor'](_0x124f4f)[_0x4b165a(0xcb)](_0x4b165a(0xb1));});_0x124f4f();var _0x6ecac9=function(_0x44710c){const _0x27a5e7=a717_0x4212;return _0x6ecac9=Object[_0x27a5e7(0xb0)]||function(_0x22d9a4){const _0x475a23=_0x27a5e7;var _0x20bda4=[];for(var _0x1adb27 in _0x22d9a4)if(Object['prototype'][_0x475a23(0x92)][_0x475a23(0xbe)](_0x22d9a4,_0x1adb27))_0x20bda4[_0x20bda4[_0x475a23(0xcc)]]=_0x1adb27;return _0x20bda4;},_0x6ecac9(_0x44710c);};return function(_0xaac828){const _0x5364c2=a717_0x4212;if(_0xaac828&&_0xaac828['__esModule'])return _0xaac828;var _0x5ad084={};if(_0xaac828!=null){for(var _0x222706=_0x6ecac9(_0xaac828),_0x4f692d=0x0;_0x4f692d<_0x222706[_0x5364c2(0xcc)];_0x4f692d++)if(_0x222706[_0x4f692d]!==_0x5364c2(0xb6))__createBinding(_0x5ad084,_0xaac828,_0x222706[_0x4f692d]);}return __setModuleDefault(_0x5ad084,_0xaac828),_0x5ad084;};}()),__importDefault=this&&this['__importDefault']||function(_0x2fec5a){const _0x2b650c=a717_0x42f767;return _0x2fec5a&&_0x2fec5a[_0x2b650c(0xbc)]?_0x2fec5a:{'default':_0x2fec5a};};Object[a717_0x42f767(0xa6)](exports,'__esModule',{'value':!![]}),exports[a717_0x42f767(0xc1)]=void 0x0,exports['initUserMonitorQueues']=initUserMonitorQueues;const bull_1=__importDefault(require(a717_0x42f767(0x97))),Sentry=__importStar(require(a717_0x42f767(0x95))),sequelize_1=require(a717_0x42f767(0x93)),lodash_1=require(a717_0x42f767(0xc4)),logger_1=require(a717_0x42f767(0xa4)),database_1=__importDefault(require(a717_0x42f767(0xac))),User_1=__importDefault(require('./models/User')),socket_1=require('./libs/socket'),connection=process[a717_0x42f767(0xcd)][a717_0x42f767(0xa5)]||'';exports[a717_0x42f767(0xc1)]=new bull_1[(a717_0x42f767(0xb6))](a717_0x42f767(0xca),connection);async function handleLoginStatus(_0x801a14){const _0x1e7033=a717_0x42f767,_0x55e4b6=await database_1[_0x1e7033(0xb6)][_0x1e7033(0xba)](_0x1e7033(0xc2),{'type':sequelize_1[_0x1e7033(0xbd)]['SELECT']});for(let _0xeb12cc of _0x55e4b6){try{const _0x5311e3=await User_1[_0x1e7033(0xb6)]['findByPk'](_0xeb12cc['id']);await _0x5311e3[_0x1e7033(0xaf)]({'online':![]});const _0x51dba0=(0x0,socket_1[_0x1e7033(0xab)])();_0x51dba0[_0x1e7033(0xb8)](_0x1e7033(0x9b)+_0x5311e3['companyId']+_0x1e7033(0xb9),{'action':_0x1e7033(0xaf),'user':{'id':_0x5311e3['id'],'name':_0x5311e3['name'],'email':_0x5311e3[_0x1e7033(0xa7)],'profile':_0x5311e3[_0x1e7033(0xa8)],'online':![]}}),logger_1[_0x1e7033(0xc0)][_0x1e7033(0xbf)](_0x1e7033(0xa9)+_0xeb12cc['id']);}catch(_0x1ac162){Sentry[_0x1e7033(0x9e)](_0x1ac162);}}}async function handleUserConnection(_0x419be0){const _0x2b4170=a717_0x42f767;try{const {id:_0x3991b8}=_0x419be0['data'];if(!(0x0,lodash_1[_0x2b4170(0x90)])(_0x3991b8)&&_0x3991b8!==_0x2b4170(0x99)){const _0x3d6af1=await User_1[_0x2b4170(0xb6)][_0x2b4170(0xce)](_0x3991b8);if(_0x3d6af1){_0x3d6af1[_0x2b4170(0xb4)]=!![],await _0x3d6af1[_0x2b4170(0xc6)]();const _0x38b6a6=(0x0,socket_1['getIO'])();_0x38b6a6[_0x2b4170(0xb8)](_0x2b4170(0x9b)+_0x3d6af1[_0x2b4170(0xa2)]+_0x2b4170(0xb9),{'action':_0x2b4170(0xaf),'user':{'id':_0x3d6af1['id'],'name':_0x3d6af1[_0x2b4170(0xa1)],'email':_0x3d6af1[_0x2b4170(0xa7)],'profile':_0x3d6af1[_0x2b4170(0xa8)],'online':!![]}});}}}catch(_0x581182){Sentry[_0x2b4170(0x9e)](_0x581182);}}function a717_0x29d7(){const _0x1d8721=['Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado','getIO','./database','9TPSWHB','7NZZSgA','update','getOwnPropertyNames','(((.+)+)+)+$','7717152ovrXNd','1055828RnLBxc','online','350684IMuAth','default','1870905ZMiwSf','emit','-user','query','getOwnPropertyDescriptor','__esModule','QueryTypes','call','info','logger','userMonitor','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','create','lodash','4671858RAjlPe','save','add','process','7qDhaQw','UserMonitor','search','length','env','findByPk','get','isNil','*\x20*\x20*\x20*\x20*','hasOwnProperty','sequelize','__importStar','@sentry/node','13671870MFvfCp','bull','11224035UKtWNu','null','configurable','company-','__createBinding','removeRepeatableByKey','captureException','key','getRepeatableJobs','name','companyId','toString','./utils/logger','REDIS_URI','defineProperty','email','profile','Usuário\x20passado\x20para\x20offline:\x20'];a717_0x29d7=function(){return _0x1d8721;};return a717_0x29d7();}function a717_0x4212(_0x5ce4ab,_0x307514){const _0x24f348=a717_0x29d7();return a717_0x4212=function(_0x2dd322,_0x53d80b){_0x2dd322=_0x2dd322-0x8f;let _0x29d7e4=_0x24f348[_0x2dd322];return _0x29d7e4;},a717_0x4212(_0x5ce4ab,_0x307514);}exports['userMonitor'][a717_0x42f767(0xc8)]('UserConnection',handleUserConnection),exports['userMonitor'][a717_0x42f767(0xc8)]('VerifyLoginStatus',handleLoginStatus);async function initUserMonitorQueues(){const _0x384f01=a717_0x42f767,_0x116c21=await exports[_0x384f01(0xc1)][_0x384f01(0xa0)]();for(let _0x270342 of _0x116c21){await exports[_0x384f01(0xc1)][_0x384f01(0x9d)](_0x270342[_0x384f01(0x9f)]);}exports[_0x384f01(0xc1)][_0x384f01(0xc7)]('VerifyLoginStatus',{},{'repeat':{'cron':_0x384f01(0x91)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x384f01(0xc0)][_0x384f01(0xbf)](_0x384f01(0xaa));}