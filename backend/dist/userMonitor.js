'use strict';const a587_0x3b15aa=a587_0x3aa3;function a587_0x3aa3(_0x2dba3d,_0x496dca){const _0x426605=a587_0x5aca();return a587_0x3aa3=function(_0x52c691,_0x141de6){_0x52c691=_0x52c691-0xac;let _0x5acaae=_0x426605[_0x52c691];return _0x5acaae;},a587_0x3aa3(_0x2dba3d,_0x496dca);}(function(_0x45a475,_0x1dc67a){const _0x434f3e=a587_0x3aa3,_0x10b580=_0x45a475();while(!![]){try{const _0x12abda=parseInt(_0x434f3e(0xb8))/0x1+-parseInt(_0x434f3e(0xbc))/0x2*(-parseInt(_0x434f3e(0xce))/0x3)+-parseInt(_0x434f3e(0xcd))/0x4*(parseInt(_0x434f3e(0xbf))/0x5)+parseInt(_0x434f3e(0xbe))/0x6+parseInt(_0x434f3e(0xe1))/0x7+-parseInt(_0x434f3e(0xde))/0x8*(-parseInt(_0x434f3e(0xb5))/0x9)+-parseInt(_0x434f3e(0xbd))/0xa;if(_0x12abda===_0x1dc67a)break;else _0x10b580['push'](_0x10b580['shift']());}catch(_0x287091){_0x10b580['push'](_0x10b580['shift']());}}}(a587_0x5aca,0x1af5c));var __createBinding=this&&this[a587_0x3b15aa(0xaf)]||(Object[a587_0x3b15aa(0xe5)]?function(_0x21f1c7,_0x3d44a6,_0x667411,_0x2c0677){const _0x49ea86=a587_0x3b15aa;if(_0x2c0677===undefined)_0x2c0677=_0x667411;var _0x311f43=Object[_0x49ea86(0xb1)](_0x3d44a6,_0x667411);(!_0x311f43||('get'in _0x311f43?!_0x3d44a6[_0x49ea86(0xb2)]:_0x311f43['writable']||_0x311f43[_0x49ea86(0xe2)]))&&(_0x311f43={'enumerable':!![],'get':function(){return _0x3d44a6[_0x667411];}}),Object[_0x49ea86(0xc2)](_0x21f1c7,_0x2c0677,_0x311f43);}:function(_0x29d9e0,_0x284753,_0x17d64c,_0xfdc92f){if(_0xfdc92f===undefined)_0xfdc92f=_0x17d64c;_0x29d9e0[_0xfdc92f]=_0x284753[_0x17d64c];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a587_0x3b15aa(0xe5)]?function(_0x538b11,_0x49abd5){Object['defineProperty'](_0x538b11,'default',{'enumerable':!![],'value':_0x49abd5});}:function(_0x3b8e40,_0x3c3b15){const _0x228840=a587_0x3b15aa;_0x3b8e40[_0x228840(0xac)]=_0x3c3b15;}),__importStar=this&&this[a587_0x3b15aa(0xc9)]||(function(){const _0x9a1dc8=(function(){let _0x2d636c=!![];return function(_0x266ef0,_0x16557d){const _0x54d76a=_0x2d636c?function(){const _0x4559a0=a587_0x3aa3;if(_0x16557d){const _0xc6fdef=_0x16557d[_0x4559a0(0xdc)](_0x266ef0,arguments);return _0x16557d=null,_0xc6fdef;}}:function(){};return _0x2d636c=![],_0x54d76a;};}()),_0x43f614=_0x9a1dc8(this,function(){const _0x38ec52=a587_0x3aa3;return _0x43f614[_0x38ec52(0xd8)]()[_0x38ec52(0xcb)](_0x38ec52(0xd2))[_0x38ec52(0xd8)]()[_0x38ec52(0xd0)](_0x43f614)[_0x38ec52(0xcb)]('(((.+)+)+)+$');});_0x43f614();var _0xdb035c=function(_0x318602){const _0x48c2ec=a587_0x3aa3;return _0xdb035c=Object[_0x48c2ec(0xb9)]||function(_0x1d843d){const _0x167f89=_0x48c2ec;var _0x432c71=[];for(var _0x2b158b in _0x1d843d)if(Object[_0x167f89(0xb3)][_0x167f89(0xc4)][_0x167f89(0xd7)](_0x1d843d,_0x2b158b))_0x432c71[_0x432c71['length']]=_0x2b158b;return _0x432c71;},_0xdb035c(_0x318602);};return function(_0x3995b4){const _0x29b8de=a587_0x3aa3;if(_0x3995b4&&_0x3995b4['__esModule'])return _0x3995b4;var _0x4ecec1={};if(_0x3995b4!=null){for(var _0x4cfdbd=_0xdb035c(_0x3995b4),_0x44ecdf=0x0;_0x44ecdf<_0x4cfdbd[_0x29b8de(0xca)];_0x44ecdf++)if(_0x4cfdbd[_0x44ecdf]!==_0x29b8de(0xac))__createBinding(_0x4ecec1,_0x3995b4,_0x4cfdbd[_0x44ecdf]);}return __setModuleDefault(_0x4ecec1,_0x3995b4),_0x4ecec1;};}()),__importDefault=this&&this['__importDefault']||function(_0x79435){const _0x147373=a587_0x3b15aa;return _0x79435&&_0x79435[_0x147373(0xb2)]?_0x79435:{'default':_0x79435};};function a587_0x5aca(){const _0x45b53a=['data','32rvKekH','*\x20*\x20*\x20*\x20*','add','361109RfmlJe','configurable','Usuário\x20passado\x20para\x20offline:\x20','update','create','default','findByPk','logger','__createBinding','online','getOwnPropertyDescriptor','__esModule','prototype','getRepeatableJobs','300123WVPkDa','QueryTypes','save','100093TTqeJl','getOwnPropertyNames','SELECT','VerifyLoginStatus','158fZzGZd','2572300gbKxCZ','817662nOyXKn','1725SCIvvX','./utils/logger','env','defineProperty','captureException','hasOwnProperty','key','info','REDIS_URI','isNil','__importStar','length','search','lodash','2360uLqvJc','5691kFUbqD','null','constructor','initUserMonitorQueues','(((.+)+)+)+$','query','removeRepeatableByKey','UserConnection','sequelize','call','toString','./database','process','userMonitor','apply'];a587_0x5aca=function(){return _0x45b53a;};return a587_0x5aca();}Object[a587_0x3b15aa(0xc2)](exports,a587_0x3b15aa(0xb2),{'value':!![]}),exports[a587_0x3b15aa(0xdb)]=void 0x0,exports[a587_0x3b15aa(0xd1)]=initUserMonitorQueues;const bull_1=__importDefault(require('bull')),Sentry=__importStar(require('@sentry/node')),sequelize_1=require(a587_0x3b15aa(0xd6)),lodash_1=require(a587_0x3b15aa(0xcc)),logger_1=require(a587_0x3b15aa(0xc0)),database_1=__importDefault(require(a587_0x3b15aa(0xd9))),User_1=__importDefault(require('./models/User')),connection=process[a587_0x3b15aa(0xc1)][a587_0x3b15aa(0xc7)]||'';exports[a587_0x3b15aa(0xdb)]=new bull_1[(a587_0x3b15aa(0xac))]('UserMonitor',connection);async function handleLoginStatus(_0x1528b4){const _0x392ad8=a587_0x3b15aa,_0x34844b=await database_1[_0x392ad8(0xac)][_0x392ad8(0xd3)]('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x392ad8(0xb6)][_0x392ad8(0xba)]});for(let _0x23ea9e of _0x34844b){try{const _0x305094=await User_1[_0x392ad8(0xac)][_0x392ad8(0xad)](_0x23ea9e['id']);await _0x305094[_0x392ad8(0xe4)]({'online':![]}),logger_1[_0x392ad8(0xae)][_0x392ad8(0xc6)](_0x392ad8(0xe3)+_0x23ea9e['id']);}catch(_0x26d8e4){Sentry[_0x392ad8(0xc3)](_0x26d8e4);}}}async function handleUserConnection(_0x5ab3a5){const _0x218fe2=a587_0x3b15aa;try{const {id:_0x166ad8}=_0x5ab3a5[_0x218fe2(0xdd)];if(!(0x0,lodash_1[_0x218fe2(0xc8)])(_0x166ad8)&&_0x166ad8!==_0x218fe2(0xcf)){const _0x6f28b0=await User_1[_0x218fe2(0xac)][_0x218fe2(0xad)](_0x166ad8);_0x6f28b0&&(_0x6f28b0[_0x218fe2(0xb0)]=!![],await _0x6f28b0[_0x218fe2(0xb7)]());}}catch(_0x29c0f2){Sentry['captureException'](_0x29c0f2);}}exports[a587_0x3b15aa(0xdb)][a587_0x3b15aa(0xda)](a587_0x3b15aa(0xd5),handleUserConnection),exports[a587_0x3b15aa(0xdb)]['process'](a587_0x3b15aa(0xbb),handleLoginStatus);async function initUserMonitorQueues(){const _0x31b297=a587_0x3b15aa,_0x1f136f=await exports['userMonitor'][_0x31b297(0xb4)]();for(let _0x4427af of _0x1f136f){await exports[_0x31b297(0xdb)][_0x31b297(0xd4)](_0x4427af[_0x31b297(0xc5)]);}exports[_0x31b297(0xdb)][_0x31b297(0xe0)](_0x31b297(0xbb),{},{'repeat':{'cron':_0x31b297(0xdf)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x31b297(0xae)]['info']('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado');}