'use strict';const a718_0x5d916d=a718_0x6be7;(function(_0xb9c5be,_0x376a03){const _0x3af533=a718_0x6be7,_0x4ede04=_0xb9c5be();while(!![]){try{const _0x563a9e=parseInt(_0x3af533(0x96))/0x1*(-parseInt(_0x3af533(0xb8))/0x2)+-parseInt(_0x3af533(0xb7))/0x3+-parseInt(_0x3af533(0x92))/0x4*(-parseInt(_0x3af533(0x95))/0x5)+parseInt(_0x3af533(0x9d))/0x6*(-parseInt(_0x3af533(0xbd))/0x7)+parseInt(_0x3af533(0xa1))/0x8*(-parseInt(_0x3af533(0xc1))/0x9)+parseInt(_0x3af533(0xc2))/0xa*(-parseInt(_0x3af533(0x9b))/0xb)+parseInt(_0x3af533(0x8b))/0xc;if(_0x563a9e===_0x376a03)break;else _0x4ede04['push'](_0x4ede04['shift']());}catch(_0x5f3894){_0x4ede04['push'](_0x4ede04['shift']());}}}(a718_0x5211,0x278b8));function a718_0x5211(){const _0x3d9ff8=['company-','sequelize','UserConnection','5404ahAfMZ','removeRepeatableByKey','SELECT','715qUtNMU','31mYrYIK','null','Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado','REDIS_URI','key','113047Fezdvw','UserMonitor','30aZjEXl','apply','configurable','QueryTypes','24DfNzLJ','online','defineProperty','getIO','./models/User','toString','search','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','getOwnPropertyNames','bull','update','(((.+)+)+)+$','name','lodash','emit','./utils/logger','getOwnPropertyDescriptor','*\x20*\x20*\x20*\x20*','data','findByPk','getRepeatableJobs','length','515487cjRClK','15626IQwgsi','profile','VerifyLoginStatus','create','add','394562DWOXrK','default','process','__createBinding','286218phmFVC','70YdQHwC','get','userMonitor','info','captureException','./database','query','Usuário\x20passado\x20para\x20offline:\x20','email','@sentry/node','./libs/socket','9983880pCoVoe','__esModule','call','logger'];a718_0x5211=function(){return _0x3d9ff8;};return a718_0x5211();}var __createBinding=this&&this[a718_0x5d916d(0xc0)]||(Object[a718_0x5d916d(0xbb)]?function(_0x16d54c,_0x2e065a,_0x9f0a73,_0x46ca66){const _0x49587c=a718_0x5d916d;if(_0x46ca66===undefined)_0x46ca66=_0x9f0a73;var _0x2ebf70=Object[_0x49587c(0xb1)](_0x2e065a,_0x9f0a73);(!_0x2ebf70||(_0x49587c(0xc3)in _0x2ebf70?!_0x2e065a[_0x49587c(0x8c)]:_0x2ebf70['writable']||_0x2ebf70[_0x49587c(0x9f)]))&&(_0x2ebf70={'enumerable':!![],'get':function(){return _0x2e065a[_0x9f0a73];}}),Object[_0x49587c(0xa3)](_0x16d54c,_0x46ca66,_0x2ebf70);}:function(_0x183b7e,_0x366b30,_0x2945c2,_0x1888df){if(_0x1888df===undefined)_0x1888df=_0x2945c2;_0x183b7e[_0x1888df]=_0x366b30[_0x2945c2];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a718_0x5d916d(0xbb)]?function(_0x117fb7,_0x4d252f){const _0x56af4e=a718_0x5d916d;Object[_0x56af4e(0xa3)](_0x117fb7,_0x56af4e(0xbe),{'enumerable':!![],'value':_0x4d252f});}:function(_0x1d11da,_0x14f0b8){const _0xd7bb50=a718_0x5d916d;_0x1d11da[_0xd7bb50(0xbe)]=_0x14f0b8;}),__importStar=this&&this['__importStar']||(function(){const _0x4d3489=(function(){let _0x5987b1=!![];return function(_0x1fdde3,_0x5ee0cf){const _0x5e1080=_0x5987b1?function(){const _0x1bc2dc=a718_0x6be7;if(_0x5ee0cf){const _0x5d0547=_0x5ee0cf[_0x1bc2dc(0x9e)](_0x1fdde3,arguments);return _0x5ee0cf=null,_0x5d0547;}}:function(){};return _0x5987b1=![],_0x5e1080;};}()),_0x481473=_0x4d3489(this,function(){const _0x109052=a718_0x6be7;return _0x481473[_0x109052(0xa6)]()[_0x109052(0xa7)](_0x109052(0xac))[_0x109052(0xa6)]()['constructor'](_0x481473)[_0x109052(0xa7)]('(((.+)+)+)+$');});_0x481473();var _0x48e113=function(_0x5c6ba5){const _0x56c798=a718_0x6be7;return _0x48e113=Object[_0x56c798(0xa9)]||function(_0x53f8ff){const _0x1a25d=_0x56c798;var _0x32202d=[];for(var _0x2f06ac in _0x53f8ff)if(Object['prototype']['hasOwnProperty'][_0x1a25d(0x8d)](_0x53f8ff,_0x2f06ac))_0x32202d[_0x32202d[_0x1a25d(0xb6)]]=_0x2f06ac;return _0x32202d;},_0x48e113(_0x5c6ba5);};return function(_0x13c1d3){const _0x32f081=a718_0x6be7;if(_0x13c1d3&&_0x13c1d3[_0x32f081(0x8c)])return _0x13c1d3;var _0x16bbf3={};if(_0x13c1d3!=null){for(var _0x24dec2=_0x48e113(_0x13c1d3),_0x89173=0x0;_0x89173<_0x24dec2['length'];_0x89173++)if(_0x24dec2[_0x89173]!==_0x32f081(0xbe))__createBinding(_0x16bbf3,_0x13c1d3,_0x24dec2[_0x89173]);}return __setModuleDefault(_0x16bbf3,_0x13c1d3),_0x16bbf3;};}()),__importDefault=this&&this['__importDefault']||function(_0x381e46){const _0x45f7a9=a718_0x5d916d;return _0x381e46&&_0x381e46[_0x45f7a9(0x8c)]?_0x381e46:{'default':_0x381e46};};Object['defineProperty'](exports,a718_0x5d916d(0x8c),{'value':!![]}),exports[a718_0x5d916d(0xc4)]=void 0x0,exports['initUserMonitorQueues']=initUserMonitorQueues;const bull_1=__importDefault(require(a718_0x5d916d(0xaa))),Sentry=__importStar(require(a718_0x5d916d(0xcb))),sequelize_1=require(a718_0x5d916d(0x90)),lodash_1=require(a718_0x5d916d(0xae)),logger_1=require(a718_0x5d916d(0xb0)),database_1=__importDefault(require(a718_0x5d916d(0xc7))),User_1=__importDefault(require(a718_0x5d916d(0xa5))),socket_1=require(a718_0x5d916d(0x8a)),connection=process['env'][a718_0x5d916d(0x99)]||'';exports['userMonitor']=new bull_1[(a718_0x5d916d(0xbe))](a718_0x5d916d(0x9c),connection);async function handleLoginStatus(_0xa97119){const _0x56856c=a718_0x5d916d,_0x54e31f=await database_1['default'][_0x56856c(0xc8)](_0x56856c(0xa8),{'type':sequelize_1[_0x56856c(0xa0)][_0x56856c(0x94)]});for(let _0x545156 of _0x54e31f){try{const _0x1957e0=await User_1[_0x56856c(0xbe)][_0x56856c(0xb4)](_0x545156['id']);await _0x1957e0[_0x56856c(0xab)]({'online':![]});const _0x5b8292=(0x0,socket_1[_0x56856c(0xa4)])();_0x5b8292[_0x56856c(0xaf)](_0x56856c(0x8f)+_0x1957e0['companyId']+'-user',{'action':_0x56856c(0xab),'user':{'id':_0x1957e0['id'],'name':_0x1957e0[_0x56856c(0xad)],'email':_0x1957e0['email'],'profile':_0x1957e0[_0x56856c(0xb9)],'online':![]}}),logger_1[_0x56856c(0x8e)][_0x56856c(0xc5)](_0x56856c(0xc9)+_0x545156['id']);}catch(_0x5a3f28){Sentry[_0x56856c(0xc6)](_0x5a3f28);}}}async function handleUserConnection(_0x1473f6){const _0x2c0131=a718_0x5d916d;try{const {id:_0x1be7e0}=_0x1473f6[_0x2c0131(0xb3)];if(!(0x0,lodash_1['isNil'])(_0x1be7e0)&&_0x1be7e0!==_0x2c0131(0x97)){const _0x1626f1=await User_1[_0x2c0131(0xbe)][_0x2c0131(0xb4)](_0x1be7e0);if(_0x1626f1){_0x1626f1[_0x2c0131(0xa2)]=!![],await _0x1626f1['save']();const _0x395fbf=(0x0,socket_1[_0x2c0131(0xa4)])();_0x395fbf[_0x2c0131(0xaf)]('company-'+_0x1626f1['companyId']+'-user',{'action':'update','user':{'id':_0x1626f1['id'],'name':_0x1626f1['name'],'email':_0x1626f1[_0x2c0131(0xca)],'profile':_0x1626f1[_0x2c0131(0xb9)],'online':!![]}});}}}catch(_0x449a25){Sentry[_0x2c0131(0xc6)](_0x449a25);}}exports[a718_0x5d916d(0xc4)][a718_0x5d916d(0xbf)](a718_0x5d916d(0x91),handleUserConnection),exports[a718_0x5d916d(0xc4)][a718_0x5d916d(0xbf)](a718_0x5d916d(0xba),handleLoginStatus);function a718_0x6be7(_0x564b02,_0x427692){const _0x50c230=a718_0x5211();return a718_0x6be7=function(_0x41d634,_0x4a1ff2){_0x41d634=_0x41d634-0x8a;let _0x521118=_0x50c230[_0x41d634];return _0x521118;},a718_0x6be7(_0x564b02,_0x427692);}async function initUserMonitorQueues(){const _0x38c324=a718_0x5d916d,_0x414ea5=await exports[_0x38c324(0xc4)][_0x38c324(0xb5)]();for(let _0x3d589a of _0x414ea5){await exports[_0x38c324(0xc4)][_0x38c324(0x93)](_0x3d589a[_0x38c324(0x9a)]);}exports[_0x38c324(0xc4)][_0x38c324(0xbc)]('VerifyLoginStatus',{},{'repeat':{'cron':_0x38c324(0xb2)},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x38c324(0x8e)][_0x38c324(0xc5)](_0x38c324(0x98));}