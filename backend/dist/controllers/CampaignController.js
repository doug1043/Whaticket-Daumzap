const a10_0x569b73=a10_0x454a;function a10_0x4474(){const _0x44beeb=['findByPk','public','constructor','../libs/socket','body','Cancelamento\x20realizado','validate','update','__esModule','\x20|\x20TAG:\x20','cancel','search','CancelService','params','2LjVWoY','../services/CampaignService/UpdateService','toString','number','-campaign','RestartService','13NHSnns','findAll','6584JdYhrO','Campaign\x20deleted','defineProperty','toISOString','contactId','company-','mediaUpload','company','95MPTTcS','5146484zXHEJH','catch','../services/CampaignService/ShowService','resolve','../services/CampaignService/RestartService','../models/ContactListItem','Reinício\x20dos\x20disparos','mediaName','ticketId','send','../services/CampaignService/DeleteService','deleteMedia','../models/Contact','index','show','lodash','__importStar','remove','__createBinding','required','writable','get','22YwTIGa','\x20-\x20','call','mediaPath','3tgggSb','error','../models/TicketTag','../errors/AppError','(((.+)+)+)+$','shape','store','../models/ContactList','files','hasOwnProperty','getIO','configurable','path','user','__importDefault','status','../services/CampaignService/CancelService','findList','1242826qpcbNM','default','apply','query','filename','then','Arquivo\x20excluído','__setModuleDefault','message','create','33790272MBdJVA','1079476helxoG','json','Mensagem\x20enviada','15966NLUfNb','150510BdrAXl','-mainchannel','../models/Campaign','../services/CampaignService/ListService','tagListId','delete','unlinkSync','../services/CampaignService/FindService','383166LUvdzH','head','emit','object','map','originalname','prototype','Error\x20creating\x20contact\x20list','save','name','restart'];a10_0x4474=function(){return _0x44beeb;};return a10_0x4474();}(function(_0x299395,_0x4977cf){const _0x499df7=a10_0x454a,_0x23e5e1=_0x299395();while(!![]){try{const _0x39e3d5=-parseInt(_0x499df7(0x1d8))/0x1*(parseInt(_0x499df7(0x1a8))/0x2)+parseInt(_0x499df7(0x196))/0x3*(parseInt(_0x499df7(0x1b3))/0x4)+-parseInt(_0x499df7(0x1e8))/0x5*(-parseInt(_0x499df7(0x1bf))/0x6)+-parseInt(_0x499df7(0x1e9))/0x7+parseInt(_0x499df7(0x1e0))/0x8*(-parseInt(_0x499df7(0x1b6))/0x9)+-parseInt(_0x499df7(0x1b7))/0xa*(-parseInt(_0x499df7(0x192))/0xb)+-parseInt(_0x499df7(0x1b2))/0xc*(-parseInt(_0x499df7(0x1de))/0xd);if(_0x39e3d5===_0x4977cf)break;else _0x23e5e1['push'](_0x23e5e1['shift']());}catch(_0x1962bc){_0x23e5e1['push'](_0x23e5e1['shift']());}}}(a10_0x4474,0xd990a));const a10_0x3762ed=(function(){let _0x4059ce=!![];return function(_0x3dbd61,_0x1f7dfb){const _0x23074d=_0x4059ce?function(){const _0x3f8a9b=a10_0x454a;if(_0x1f7dfb){const _0x1f2bd8=_0x1f7dfb[_0x3f8a9b(0x1aa)](_0x3dbd61,arguments);return _0x1f7dfb=null,_0x1f2bd8;}}:function(){};return _0x4059ce=![],_0x23074d;};}()),a10_0x2be405=a10_0x3762ed(this,function(){const _0xf197ae=a10_0x454a;return a10_0x2be405[_0xf197ae(0x1da)]()[_0xf197ae(0x1d5)](_0xf197ae(0x19a))['toString']()[_0xf197ae(0x1cc)](a10_0x2be405)[_0xf197ae(0x1d5)](_0xf197ae(0x19a));});a10_0x2be405();'use strict';var __createBinding=this&&this[a10_0x569b73(0x18e)]||(Object['create']?function(_0x45dc21,_0x987af6,_0xa5a406,_0x191d1f){const _0x2c0318=a10_0x569b73;if(_0x191d1f===undefined)_0x191d1f=_0xa5a406;var _0x172682=Object['getOwnPropertyDescriptor'](_0x987af6,_0xa5a406);(!_0x172682||(_0x2c0318(0x191)in _0x172682?!_0x987af6[_0x2c0318(0x1d2)]:_0x172682[_0x2c0318(0x190)]||_0x172682[_0x2c0318(0x1a1)]))&&(_0x172682={'enumerable':!![],'get':function(){return _0x987af6[_0xa5a406];}}),Object[_0x2c0318(0x1e2)](_0x45dc21,_0x191d1f,_0x172682);}:function(_0x31d39f,_0x30507e,_0xb70107,_0x3b82f7){if(_0x3b82f7===undefined)_0x3b82f7=_0xb70107;_0x31d39f[_0x3b82f7]=_0x30507e[_0xb70107];}),__setModuleDefault=this&&this[a10_0x569b73(0x1af)]||(Object[a10_0x569b73(0x1b1)]?function(_0x397131,_0x31ac1c){const _0x17bfd5=a10_0x569b73;Object[_0x17bfd5(0x1e2)](_0x397131,_0x17bfd5(0x1a9),{'enumerable':!![],'value':_0x31ac1c});}:function(_0x5c5e80,_0x30b182){const _0x3cdef7=a10_0x569b73;_0x5c5e80[_0x3cdef7(0x1a9)]=_0x30b182;}),__importStar=this&&this[a10_0x569b73(0x18c)]||function(_0x545b3a){const _0x4dfece=a10_0x569b73;if(_0x545b3a&&_0x545b3a['__esModule'])return _0x545b3a;var _0x386669={};if(_0x545b3a!=null){for(var _0x590f4b in _0x545b3a)if(_0x590f4b!==_0x4dfece(0x1a9)&&Object[_0x4dfece(0x1c5)][_0x4dfece(0x19f)][_0x4dfece(0x194)](_0x545b3a,_0x590f4b))__createBinding(_0x386669,_0x545b3a,_0x590f4b);}return __setModuleDefault(_0x386669,_0x545b3a),_0x386669;},__importDefault=this&&this[a10_0x569b73(0x1a4)]||function(_0x9bf205){const _0x43e41a=a10_0x569b73;return _0x9bf205&&_0x9bf205[_0x43e41a(0x1d2)]?_0x9bf205:{'default':_0x9bf205};};Object[a10_0x569b73(0x1e2)](exports,'__esModule',{'value':!![]}),exports[a10_0x569b73(0x187)]=exports[a10_0x569b73(0x1e6)]=exports[a10_0x569b73(0x1a7)]=exports[a10_0x569b73(0x18d)]=exports[a10_0x569b73(0x1c9)]=exports[a10_0x569b73(0x1d4)]=exports[a10_0x569b73(0x1d1)]=exports[a10_0x569b73(0x18a)]=exports[a10_0x569b73(0x19c)]=exports[a10_0x569b73(0x189)]=void 0x0;const Yup=__importStar(require('yup')),socket_1=require(a10_0x569b73(0x1cd)),lodash_1=require(a10_0x569b73(0x18b)),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a10_0x569b73(0x1a2))),ListService_1=__importDefault(require(a10_0x569b73(0x1ba))),CreateService_1=__importDefault(require('../services/CampaignService/CreateService')),ShowService_1=__importDefault(require(a10_0x569b73(0x1eb))),UpdateService_1=__importDefault(require(a10_0x569b73(0x1d9))),DeleteService_1=__importDefault(require(a10_0x569b73(0x186))),FindService_1=__importDefault(require(a10_0x569b73(0x1be))),Campaign_1=__importDefault(require(a10_0x569b73(0x1b9))),AppError_1=__importDefault(require(a10_0x569b73(0x199))),CancelService_1=require(a10_0x569b73(0x1a6)),RestartService_1=require(a10_0x569b73(0x1ed)),TicketTag_1=__importDefault(require(a10_0x569b73(0x198))),Ticket_1=__importDefault(require('../models/Ticket')),Contact_1=__importDefault(require(a10_0x569b73(0x188))),ContactList_1=__importDefault(require(a10_0x569b73(0x19d))),ContactListItem_1=__importDefault(require(a10_0x569b73(0x1ee))),index=async(_0x508bea,_0x37da87)=>{const _0x54cf97=a10_0x569b73,{searchParam:_0x2fa95a,pageNumber:_0x527742}=_0x508bea[_0x54cf97(0x1ab)],{companyId:_0x2011e1}=_0x508bea['user'],{records:_0x5112b8,count:_0x2e2cfc,hasMore:_0x4abc8c}=await(0x0,ListService_1['default'])({'searchParam':_0x2fa95a,'pageNumber':_0x527742,'companyId':_0x2011e1});return _0x37da87[_0x54cf97(0x1b4)]({'records':_0x5112b8,'count':_0x2e2cfc,'hasMore':_0x4abc8c});};exports[a10_0x569b73(0x189)]=index;const store=async(_0x3151c3,_0x5b1434)=>{const _0x595c36=a10_0x569b73,{companyId:_0x25ff15}=_0x3151c3[_0x595c36(0x1a3)],_0x5209ef=_0x3151c3[_0x595c36(0x1ce)],_0x421dfb=Yup[_0x595c36(0x1c2)]()[_0x595c36(0x19b)]({'name':Yup['string']()[_0x595c36(0x18f)]()});try{await _0x421dfb[_0x595c36(0x1d0)](_0x5209ef);}catch(_0x17a1cf){throw new AppError_1['default'](_0x17a1cf[_0x595c36(0x1b0)]);}if(typeof _0x5209ef[_0x595c36(0x1bb)]===_0x595c36(0x1db)){const _0x6334e8=_0x5209ef['tagListId'],_0x253c20=_0x5209ef[_0x595c36(0x1c8)];async function _0x2f605a(_0x864205){const _0x48ad46=_0x595c36,_0x310707=new Date(),_0x55baa5=_0x310707[_0x48ad46(0x1e3)]();try{const _0x2a9ea2=await TicketTag_1[_0x48ad46(0x1a9)][_0x48ad46(0x1df)]({'where':{'tagId':_0x864205}}),_0x3c07ac=_0x2a9ea2[_0x48ad46(0x1c3)](_0x4c93db=>_0x4c93db[_0x48ad46(0x184)]),_0x3a6d02=await Ticket_1[_0x48ad46(0x1a9)][_0x48ad46(0x1df)]({'where':{'id':_0x3c07ac}}),_0x109c2b=_0x3a6d02['map'](_0x3172c0=>_0x3172c0[_0x48ad46(0x1e4)]),_0x58f584=await Contact_1['default'][_0x48ad46(0x1df)]({'where':{'id':_0x109c2b}}),_0xbb1a78=_0x253c20+_0x48ad46(0x1d3)+_0x864205+_0x48ad46(0x193)+_0x55baa5,_0x2d2562=await ContactList_1[_0x48ad46(0x1a9)]['create']({'name':_0xbb1a78,'companyId':_0x25ff15}),{id:_0x43dba7}=_0x2d2562,_0x2fe350=_0x58f584[_0x48ad46(0x1c3)](_0x328cf3=>({'name':_0x328cf3[_0x48ad46(0x1c8)],'number':_0x328cf3['number'],'email':_0x328cf3['email'],'contactListId':_0x43dba7,'companyId':_0x25ff15,'isWhatsappValid':!![]}));return await ContactListItem_1[_0x48ad46(0x1a9)]['bulkCreate'](_0x2fe350),_0x43dba7;}catch(_0x3709b2){console['error']('Error\x20creating\x20contact\x20list:',_0x3709b2);throw _0x3709b2;}}_0x2f605a(_0x6334e8)[_0x595c36(0x1ad)](async _0x5093c6=>{const _0x4deca7=_0x595c36,_0x5e5978=await(0x0,CreateService_1['default'])({..._0x5209ef,'companyId':_0x25ff15,'contactListId':_0x5093c6}),_0x2ab4af=(0x0,socket_1['getIO'])();return _0x2ab4af['to'](_0x4deca7(0x1e5)+_0x25ff15+_0x4deca7(0x1b8))[_0x4deca7(0x1c1)](_0x4deca7(0x1e5)+_0x25ff15+_0x4deca7(0x1dc),{'action':_0x4deca7(0x1b1),'record':_0x5e5978}),_0x5b1434['status'](0xc8)[_0x4deca7(0x1b4)](_0x5e5978);})[_0x595c36(0x1ea)](_0x3fcade=>{const _0x3f6b35=_0x595c36;return console[_0x3f6b35(0x197)]('Error:',_0x3fcade),_0x5b1434[_0x3f6b35(0x1a5)](0x1f4)['json']({'error':_0x3f6b35(0x1c6)});});}else{const _0x49cb1f=await(0x0,CreateService_1[_0x595c36(0x1a9)])({..._0x5209ef,'companyId':_0x25ff15}),_0x39e140=(0x0,socket_1['getIO'])();return _0x39e140['to'](_0x595c36(0x1e5)+_0x25ff15+'-mainchannel')[_0x595c36(0x1c1)]('company-'+_0x25ff15+_0x595c36(0x1dc),{'action':_0x595c36(0x1b1),'record':_0x49cb1f}),_0x5b1434[_0x595c36(0x1a5)](0xc8)[_0x595c36(0x1b4)](_0x49cb1f);}};exports['store']=store;const show=async(_0x1e85dd,_0x325eb2)=>{const _0x261c4b=a10_0x569b73,{id:_0x32ad53}=_0x1e85dd[_0x261c4b(0x1d7)],_0x5e40d6=await(0x0,ShowService_1[_0x261c4b(0x1a9)])(_0x32ad53);return _0x325eb2['status'](0xc8)[_0x261c4b(0x1b4)](_0x5e40d6);};exports[a10_0x569b73(0x18a)]=show;const update=async(_0x3ad544,_0x3525b4)=>{const _0xd2b7a3=a10_0x569b73,_0x2fc803=_0x3ad544[_0xd2b7a3(0x1ce)],{companyId:_0x1e08ba}=_0x3ad544[_0xd2b7a3(0x1a3)],_0x4d88ef=Yup[_0xd2b7a3(0x1c2)]()['shape']({'name':Yup['string']()[_0xd2b7a3(0x18f)]()});try{await _0x4d88ef['validate'](_0x2fc803);}catch(_0x8dda72){throw new AppError_1[(_0xd2b7a3(0x1a9))](_0x8dda72[_0xd2b7a3(0x1b0)]);}const {id:_0xfbdfd3}=_0x3ad544['params'],_0x4ee722=await(0x0,UpdateService_1[_0xd2b7a3(0x1a9)])({..._0x2fc803,'id':_0xfbdfd3}),_0x1e77a7=(0x0,socket_1[_0xd2b7a3(0x1a0)])();return _0x1e77a7['to']('company-'+_0x1e08ba+'-mainchannel')[_0xd2b7a3(0x1c1)](_0xd2b7a3(0x1e5)+_0x1e08ba+'-campaign',{'action':_0xd2b7a3(0x1d1),'record':_0x4ee722}),_0x3525b4[_0xd2b7a3(0x1a5)](0xc8)[_0xd2b7a3(0x1b4)](_0x4ee722);};function a10_0x454a(_0x2e0263,_0x46b566){const _0x52f9f4=a10_0x4474();return a10_0x454a=function(_0x2be405,_0x3762ed){_0x2be405=_0x2be405-0x182;let _0x44740d=_0x52f9f4[_0x2be405];return _0x44740d;},a10_0x454a(_0x2e0263,_0x46b566);}exports['update']=update;const cancel=async(_0x449b57,_0x479672)=>{const _0x4ebd10=a10_0x569b73,{id:_0x3a32ab}=_0x449b57['params'];return await(0x0,CancelService_1[_0x4ebd10(0x1d6)])(+_0x3a32ab),_0x479672[_0x4ebd10(0x1a5)](0xcc)[_0x4ebd10(0x1b4)]({'message':_0x4ebd10(0x1cf)});};exports['cancel']=cancel;const restart=async(_0x33be35,_0x537b43)=>{const _0x475f30=a10_0x569b73,{id:_0x2dd73e}=_0x33be35[_0x475f30(0x1d7)];return await(0x0,RestartService_1[_0x475f30(0x1dd)])(+_0x2dd73e),_0x537b43[_0x475f30(0x1a5)](0xcc)[_0x475f30(0x1b4)]({'message':_0x475f30(0x182)});};exports[a10_0x569b73(0x1c9)]=restart;const remove=async(_0x3c0c9a,_0x2641e0)=>{const _0x3a4233=a10_0x569b73,{id:_0x333d26}=_0x3c0c9a[_0x3a4233(0x1d7)],{companyId:_0x39f58d}=_0x3c0c9a[_0x3a4233(0x1a3)];await(0x0,DeleteService_1[_0x3a4233(0x1a9)])(_0x333d26);const _0x5774e3=(0x0,socket_1[_0x3a4233(0x1a0)])();return _0x5774e3['to']('company-'+_0x39f58d+'-mainchannel')[_0x3a4233(0x1c1)]('company-'+_0x39f58d+_0x3a4233(0x1dc),{'action':_0x3a4233(0x1bc),'id':_0x333d26}),_0x2641e0[_0x3a4233(0x1a5)](0xc8)[_0x3a4233(0x1b4)]({'message':_0x3a4233(0x1e1)});};exports['remove']=remove;const findList=async(_0x4eeb49,_0x3e948c)=>{const _0x579198=a10_0x569b73,_0x4ffc98=_0x4eeb49[_0x579198(0x1ab)],_0x1e4147=await(0x0,FindService_1[_0x579198(0x1a9)])(_0x4ffc98);return _0x3e948c['status'](0xc8)[_0x579198(0x1b4)](_0x1e4147);};exports[a10_0x569b73(0x1a7)]=findList;const mediaUpload=async(_0x319b31,_0x5d6e44)=>{const _0x2d5440=a10_0x569b73,{id:_0x41473e}=_0x319b31['params'],_0x4a373b=_0x319b31[_0x2d5440(0x19e)],_0x400c80=(0x0,lodash_1[_0x2d5440(0x1c0)])(_0x4a373b);try{const _0x150e33=await Campaign_1[_0x2d5440(0x1a9)]['findByPk'](_0x41473e);return _0x150e33[_0x2d5440(0x195)]=_0x400c80[_0x2d5440(0x1ac)],_0x150e33[_0x2d5440(0x183)]=_0x400c80[_0x2d5440(0x1c4)],await _0x150e33['save'](),_0x5d6e44[_0x2d5440(0x185)]({'mensagem':_0x2d5440(0x1b5)});}catch(_0x33292b){throw new AppError_1[(_0x2d5440(0x1a9))](_0x33292b[_0x2d5440(0x1b0)]);}};exports[a10_0x569b73(0x1e6)]=mediaUpload;const deleteMedia=async(_0xc88b15,_0x5370d5)=>{const _0xcbbd17=a10_0x569b73,{id:_0x594493}=_0xc88b15[_0xcbbd17(0x1d7)];try{const _0x3d2e40=await Campaign_1[_0xcbbd17(0x1a9)][_0xcbbd17(0x1ca)](_0x594493),_0xaee85a=path_1[_0xcbbd17(0x1a9)][_0xcbbd17(0x1ec)](_0xcbbd17(0x1cb),_0xcbbd17(0x1e7)+_0x3d2e40['companyId'],_0x3d2e40[_0xcbbd17(0x195)]),_0x124197=fs_1[_0xcbbd17(0x1a9)]['existsSync'](_0xaee85a);return _0x124197&&fs_1[_0xcbbd17(0x1a9)][_0xcbbd17(0x1bd)](_0xaee85a),_0x3d2e40['mediaPath']=null,_0x3d2e40[_0xcbbd17(0x183)]=null,await _0x3d2e40[_0xcbbd17(0x1c7)](),_0x5370d5[_0xcbbd17(0x185)]({'mensagem':_0xcbbd17(0x1ae)});}catch(_0x3173eb){throw new AppError_1[(_0xcbbd17(0x1a9))](_0x3173eb[_0xcbbd17(0x1b0)]);}};exports[a10_0x569b73(0x187)]=deleteMedia;