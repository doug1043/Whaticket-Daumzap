const a10_0x2e7a32=a10_0x390a;(function(_0x3a0cd3,_0x4f21a9){const _0x4f7e1a=a10_0x390a,_0xd263eb=_0x3a0cd3();while(!![]){try{const _0x30cc1d=parseInt(_0x4f7e1a(0xf4))/0x1*(parseInt(_0x4f7e1a(0x142))/0x2)+-parseInt(_0x4f7e1a(0x132))/0x3*(-parseInt(_0x4f7e1a(0x124))/0x4)+-parseInt(_0x4f7e1a(0x118))/0x5+parseInt(_0x4f7e1a(0x113))/0x6+parseInt(_0x4f7e1a(0x109))/0x7*(-parseInt(_0x4f7e1a(0xf3))/0x8)+parseInt(_0x4f7e1a(0x12e))/0x9*(parseInt(_0x4f7e1a(0x105))/0xa)+parseInt(_0x4f7e1a(0xf5))/0xb*(parseInt(_0x4f7e1a(0xe6))/0xc);if(_0x30cc1d===_0x4f21a9)break;else _0xd263eb['push'](_0xd263eb['shift']());}catch(_0x47f42a){_0xd263eb['push'](_0xd263eb['shift']());}}}(a10_0x3ca5,0xea15f));const a10_0x312973=(function(){let _0x52a548=!![];return function(_0x35e7a2,_0x9f57a){const _0x195505=_0x52a548?function(){const _0x537d3e=a10_0x390a;if(_0x9f57a){const _0x260bbf=_0x9f57a[_0x537d3e(0xe7)](_0x35e7a2,arguments);return _0x9f57a=null,_0x260bbf;}}:function(){};return _0x52a548=![],_0x195505;};}()),a10_0x48ba6c=a10_0x312973(this,function(){const _0x41a68b=a10_0x390a;return a10_0x48ba6c[_0x41a68b(0x110)]()[_0x41a68b(0xff)](_0x41a68b(0x14a))['toString']()[_0x41a68b(0xe5)](a10_0x48ba6c)[_0x41a68b(0xff)]('(((.+)+)+)+$');});a10_0x48ba6c();'use strict';var __createBinding=this&&this[a10_0x2e7a32(0x149)]||(Object['create']?function(_0x194a29,_0x4c322e,_0x1a2382,_0x29e9de){const _0x24da70=a10_0x2e7a32;if(_0x29e9de===undefined)_0x29e9de=_0x1a2382;var _0x47746e=Object[_0x24da70(0xf9)](_0x4c322e,_0x1a2382);(!_0x47746e||(_0x24da70(0xea)in _0x47746e?!_0x4c322e[_0x24da70(0x135)]:_0x47746e[_0x24da70(0xec)]||_0x47746e[_0x24da70(0x11b)]))&&(_0x47746e={'enumerable':!![],'get':function(){return _0x4c322e[_0x1a2382];}}),Object[_0x24da70(0x112)](_0x194a29,_0x29e9de,_0x47746e);}:function(_0x67fe7f,_0x1da286,_0x11abf1,_0x210cb6){if(_0x210cb6===undefined)_0x210cb6=_0x11abf1;_0x67fe7f[_0x210cb6]=_0x1da286[_0x11abf1];}),__setModuleDefault=this&&this[a10_0x2e7a32(0x10f)]||(Object[a10_0x2e7a32(0xf6)]?function(_0xccb7ba,_0x1cc41e){const _0x46be51=a10_0x2e7a32;Object['defineProperty'](_0xccb7ba,_0x46be51(0x13a),{'enumerable':!![],'value':_0x1cc41e});}:function(_0xc9809c,_0x4857b1){const _0x4d02bf=a10_0x2e7a32;_0xc9809c[_0x4d02bf(0x13a)]=_0x4857b1;}),__importStar=this&&this[a10_0x2e7a32(0x13e)]||function(_0x271cae){const _0x48e24a=a10_0x2e7a32;if(_0x271cae&&_0x271cae[_0x48e24a(0x135)])return _0x271cae;var _0x5d66c6={};if(_0x271cae!=null){for(var _0x32b37e in _0x271cae)if(_0x32b37e!==_0x48e24a(0x13a)&&Object[_0x48e24a(0x13f)]['hasOwnProperty'][_0x48e24a(0x129)](_0x271cae,_0x32b37e))__createBinding(_0x5d66c6,_0x271cae,_0x32b37e);}return __setModuleDefault(_0x5d66c6,_0x271cae),_0x5d66c6;},__importDefault=this&&this[a10_0x2e7a32(0x101)]||function(_0x553bb4){const _0x1af934=a10_0x2e7a32;return _0x553bb4&&_0x553bb4[_0x1af934(0x135)]?_0x553bb4:{'default':_0x553bb4};};Object[a10_0x2e7a32(0x112)](exports,a10_0x2e7a32(0x135),{'value':!![]}),exports['deleteMedia']=exports[a10_0x2e7a32(0x128)]=exports[a10_0x2e7a32(0x117)]=exports[a10_0x2e7a32(0x148)]=exports[a10_0x2e7a32(0x12b)]=exports[a10_0x2e7a32(0x144)]=exports[a10_0x2e7a32(0xfe)]=exports['show']=exports['store']=exports[a10_0x2e7a32(0x125)]=void 0x0;const Yup=__importStar(require('yup')),socket_1=require(a10_0x2e7a32(0xf8)),lodash_1=require(a10_0x2e7a32(0x12c)),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),ListService_1=__importDefault(require('../services/CampaignService/ListService')),CreateService_1=__importDefault(require('../services/CampaignService/CreateService')),ShowService_1=__importDefault(require(a10_0x2e7a32(0xe8))),UpdateService_1=__importDefault(require(a10_0x2e7a32(0x127))),DeleteService_1=__importDefault(require(a10_0x2e7a32(0x13d))),FindService_1=__importDefault(require(a10_0x2e7a32(0x139))),Campaign_1=__importDefault(require(a10_0x2e7a32(0x116))),AppError_1=__importDefault(require(a10_0x2e7a32(0x11f))),CancelService_1=require(a10_0x2e7a32(0x107)),RestartService_1=require('../services/CampaignService/RestartService'),TicketTag_1=__importDefault(require(a10_0x2e7a32(0x121))),Ticket_1=__importDefault(require(a10_0x2e7a32(0xe4))),Contact_1=__importDefault(require('../models/Contact')),ContactList_1=__importDefault(require(a10_0x2e7a32(0x12a))),ContactListItem_1=__importDefault(require(a10_0x2e7a32(0x145))),index=async(_0x5a1c16,_0x907bf1)=>{const _0x2e8ce1=a10_0x2e7a32,{searchParam:_0x34f081,pageNumber:_0x3bba48}=_0x5a1c16['query'],{companyId:_0x57f21b}=_0x5a1c16[_0x2e8ce1(0x131)],{records:_0x24996d,count:_0x120193,hasMore:_0x219217}=await(0x0,ListService_1[_0x2e8ce1(0x13a)])({'searchParam':_0x34f081,'pageNumber':_0x3bba48,'companyId':_0x57f21b});return _0x907bf1[_0x2e8ce1(0x13c)]({'records':_0x24996d,'count':_0x120193,'hasMore':_0x219217});};exports[a10_0x2e7a32(0x125)]=index;const store=async(_0x380a5e,_0x820484)=>{const _0x42bbb6=a10_0x2e7a32,{companyId:_0xeb7ce9}=_0x380a5e[_0x42bbb6(0x131)],_0x282d1e=_0x380a5e['body'],_0xa390cc=Yup['object']()['shape']({'name':Yup[_0x42bbb6(0xf2)]()['required']()});try{await _0xa390cc[_0x42bbb6(0x114)](_0x282d1e);}catch(_0x47252){throw new AppError_1[(_0x42bbb6(0x13a))](_0x47252[_0x42bbb6(0x102)]);}if(typeof _0x282d1e['tagListId']===_0x42bbb6(0x136)){const _0x249653=_0x282d1e[_0x42bbb6(0xfa)],_0x2834e0=_0x282d1e[_0x42bbb6(0x10e)];async function _0x1a19eb(_0x26cde5){const _0x417ac7=_0x42bbb6,_0x3dc831=new Date(),_0xa8eccd=_0x3dc831[_0x417ac7(0x134)]();try{const _0x2f26da=await TicketTag_1[_0x417ac7(0x13a)][_0x417ac7(0xf0)]({'where':{'tagId':_0x26cde5}}),_0x1d3c3e=_0x2f26da['map'](_0x3692bc=>_0x3692bc[_0x417ac7(0x111)]),_0x2466e8=await Ticket_1[_0x417ac7(0x13a)][_0x417ac7(0xf0)]({'where':{'id':_0x1d3c3e}}),_0x4e0ede=_0x2466e8[_0x417ac7(0x10a)](_0x21d6cf=>_0x21d6cf[_0x417ac7(0x11d)]),_0x12459b=await Contact_1[_0x417ac7(0x13a)]['findAll']({'where':{'id':_0x4e0ede}}),_0x1a5213=_0x2834e0+_0x417ac7(0xfc)+_0x26cde5+'\x20-\x20'+_0xa8eccd,_0x52ce22=await ContactList_1[_0x417ac7(0x13a)]['create']({'name':_0x1a5213,'companyId':_0xeb7ce9}),{id:_0x57ae40}=_0x52ce22,_0x1481b2=_0x12459b[_0x417ac7(0x10a)](_0x2852e7=>({'name':_0x2852e7[_0x417ac7(0x10e)],'number':_0x2852e7[_0x417ac7(0x136)],'email':_0x2852e7[_0x417ac7(0x11a)],'contactListId':_0x57ae40,'companyId':_0xeb7ce9,'isWhatsappValid':!![]}));return await ContactListItem_1[_0x417ac7(0x13a)][_0x417ac7(0x10d)](_0x1481b2),_0x57ae40;}catch(_0x106069){console['error'](_0x417ac7(0x146),_0x106069);throw _0x106069;}}_0x1a19eb(_0x249653)[_0x42bbb6(0x147)](async _0x5ef0d4=>{const _0x4f1f46=_0x42bbb6,_0x2ddf8e=await(0x0,CreateService_1[_0x4f1f46(0x13a)])({..._0x282d1e,'companyId':_0xeb7ce9,'contactListId':_0x5ef0d4}),_0x59b216=(0x0,socket_1[_0x4f1f46(0xf7)])();return _0x59b216['to'](_0x4f1f46(0xf1)+_0xeb7ce9+_0x4f1f46(0x13b))['emit'](_0x4f1f46(0xf1)+_0xeb7ce9+_0x4f1f46(0x126),{'action':_0x4f1f46(0xf6),'record':_0x2ddf8e}),_0x820484['status'](0xc8)[_0x4f1f46(0x13c)](_0x2ddf8e);})['catch'](_0x2629e2=>{const _0x29546e=_0x42bbb6;return console['error'](_0x29546e(0x140),_0x2629e2),_0x820484[_0x29546e(0xeb)](0x1f4)[_0x29546e(0x13c)]({'error':_0x29546e(0x130)});});}else{const _0x36073d=await(0x0,CreateService_1[_0x42bbb6(0x13a)])({..._0x282d1e,'companyId':_0xeb7ce9}),_0x17650b=(0x0,socket_1[_0x42bbb6(0xf7)])();return _0x17650b['to'](_0x42bbb6(0xf1)+_0xeb7ce9+_0x42bbb6(0x13b))[_0x42bbb6(0x123)](_0x42bbb6(0xf1)+_0xeb7ce9+'-campaign',{'action':'create','record':_0x36073d}),_0x820484[_0x42bbb6(0xeb)](0xc8)[_0x42bbb6(0x13c)](_0x36073d);}};exports[a10_0x2e7a32(0x10c)]=store;function a10_0x3ca5(){const _0x49985c=['shape','2745xZnoPQ','mediaPath','Error\x20creating\x20contact\x20list','user','11811jdkfcd','resolve','toISOString','__esModule','number','findByPk','show','../services/CampaignService/FindService','default','-mainchannel','json','../services/CampaignService/DeleteService','__importStar','prototype','Error:','Cancelamento\x20realizado','2451418uMzWjg','params','cancel','../models/ContactListItem','Error\x20creating\x20contact\x20list:','then','remove','__createBinding','(((.+)+)+)+$','Arquivo\x20excluído','send','unlinkSync','files','../models/Ticket','constructor','33732xSLNGa','apply','../services/CampaignService/ShowService','mediaName','get','status','writable','RestartService','deleteMedia','filename','findAll','company-','string','94232uEzsWf','1yNCXzf','2882BVvdEi','create','getIO','../libs/socket','getOwnPropertyDescriptor','tagListId','Mensagem\x20enviada','\x20|\x20TAG:\x20','Campaign\x20deleted','update','search','save','__importDefault','message','object','query','34610VyoJqr','company','../services/CampaignService/CancelService','required','854ArdDjN','map','body','store','bulkCreate','name','__setModuleDefault','toString','ticketId','defineProperty','1193370DSdqOZ','validate','existsSync','../models/Campaign','findList','7706545KfutCb','head','email','configurable','companyId','contactId','public','../errors/AppError','originalname','../models/TicketTag','delete','emit','732wCRhWF','index','-campaign','../services/CampaignService/UpdateService','mediaUpload','call','../models/ContactList','restart','lodash'];a10_0x3ca5=function(){return _0x49985c;};return a10_0x3ca5();}const show=async(_0xa97afe,_0x73a0bb)=>{const _0x21351a=a10_0x2e7a32,{id:_0x26a328}=_0xa97afe[_0x21351a(0x143)],_0x41b3a5=await(0x0,ShowService_1[_0x21351a(0x13a)])(_0x26a328);return _0x73a0bb[_0x21351a(0xeb)](0xc8)[_0x21351a(0x13c)](_0x41b3a5);};exports[a10_0x2e7a32(0x138)]=show;const update=async(_0x4a62eb,_0x357157)=>{const _0x148877=a10_0x2e7a32,_0x190e47=_0x4a62eb[_0x148877(0x10b)],{companyId:_0x14527a}=_0x4a62eb[_0x148877(0x131)],_0x28fd29=Yup[_0x148877(0x103)]()[_0x148877(0x12d)]({'name':Yup[_0x148877(0xf2)]()[_0x148877(0x108)]()});try{await _0x28fd29[_0x148877(0x114)](_0x190e47);}catch(_0x22fd45){throw new AppError_1[(_0x148877(0x13a))](_0x22fd45[_0x148877(0x102)]);}const {id:_0x3aa8e8}=_0x4a62eb['params'],_0x15a8a5=await(0x0,UpdateService_1[_0x148877(0x13a)])({..._0x190e47,'id':_0x3aa8e8}),_0xd22f46=(0x0,socket_1[_0x148877(0xf7)])();return _0xd22f46['to']('company-'+_0x14527a+'-mainchannel')[_0x148877(0x123)](_0x148877(0xf1)+_0x14527a+_0x148877(0x126),{'action':_0x148877(0xfe),'record':_0x15a8a5}),_0x357157['status'](0xc8)['json'](_0x15a8a5);};exports['update']=update;const cancel=async(_0x25fb42,_0x1f3e6f)=>{const _0x3fac0b=a10_0x2e7a32,{id:_0x1a8968}=_0x25fb42[_0x3fac0b(0x143)];return await(0x0,CancelService_1['CancelService'])(+_0x1a8968),_0x1f3e6f['status'](0xcc)['json']({'message':_0x3fac0b(0x141)});};function a10_0x390a(_0x1e14f5,_0x4a6c8b){const _0x1afb6c=a10_0x3ca5();return a10_0x390a=function(_0x48ba6c,_0x312973){_0x48ba6c=_0x48ba6c-0xe0;let _0x3ca55d=_0x1afb6c[_0x48ba6c];return _0x3ca55d;},a10_0x390a(_0x1e14f5,_0x4a6c8b);}exports['cancel']=cancel;const restart=async(_0x15b098,_0x5eb738)=>{const _0x5cc74e=a10_0x2e7a32,{id:_0x29e822}=_0x15b098[_0x5cc74e(0x143)];return await(0x0,RestartService_1[_0x5cc74e(0xed)])(+_0x29e822),_0x5eb738[_0x5cc74e(0xeb)](0xcc)['json']({'message':'Reinício\x20dos\x20disparos'});};exports[a10_0x2e7a32(0x12b)]=restart;const remove=async(_0x94ab4d,_0x32c7f1)=>{const _0x5764ce=a10_0x2e7a32,{id:_0x3aa510}=_0x94ab4d['params'],{companyId:_0x4e5efa}=_0x94ab4d['user'];await(0x0,DeleteService_1['default'])(_0x3aa510);const _0x352ee7=(0x0,socket_1['getIO'])();return _0x352ee7['to'](_0x5764ce(0xf1)+_0x4e5efa+'-mainchannel')[_0x5764ce(0x123)]('company-'+_0x4e5efa+'-campaign',{'action':_0x5764ce(0x122),'id':_0x3aa510}),_0x32c7f1[_0x5764ce(0xeb)](0xc8)[_0x5764ce(0x13c)]({'message':_0x5764ce(0xfd)});};exports['remove']=remove;const findList=async(_0x1f141c,_0x38f880)=>{const _0x1d49ee=a10_0x2e7a32,_0x3613c8=_0x1f141c[_0x1d49ee(0x104)],_0xea6c2a=await(0x0,FindService_1['default'])(_0x3613c8);return _0x38f880[_0x1d49ee(0xeb)](0xc8)[_0x1d49ee(0x13c)](_0xea6c2a);};exports['findList']=findList;const mediaUpload=async(_0xa4ddc5,_0x4d89f4)=>{const _0x505ca8=a10_0x2e7a32,{id:_0x444865}=_0xa4ddc5[_0x505ca8(0x143)],_0x396a0b=_0xa4ddc5[_0x505ca8(0xe3)],_0x3573d4=(0x0,lodash_1[_0x505ca8(0x119)])(_0x396a0b);try{const _0x1f6a5d=await Campaign_1[_0x505ca8(0x13a)][_0x505ca8(0x137)](_0x444865);return _0x1f6a5d[_0x505ca8(0x12f)]=_0x3573d4[_0x505ca8(0xef)],_0x1f6a5d[_0x505ca8(0xe9)]=_0x3573d4[_0x505ca8(0x120)],await _0x1f6a5d[_0x505ca8(0x100)](),_0x4d89f4[_0x505ca8(0xe1)]({'mensagem':_0x505ca8(0xfb)});}catch(_0x8e8427){throw new AppError_1[(_0x505ca8(0x13a))](_0x8e8427[_0x505ca8(0x102)]);}};exports['mediaUpload']=mediaUpload;const deleteMedia=async(_0x3c1672,_0x19c8e9)=>{const _0x439a60=a10_0x2e7a32,{id:_0x23b112}=_0x3c1672['params'];try{const _0x6bb220=await Campaign_1[_0x439a60(0x13a)][_0x439a60(0x137)](_0x23b112),_0x23846c=path_1[_0x439a60(0x13a)][_0x439a60(0x133)](_0x439a60(0x11e),_0x439a60(0x106)+_0x6bb220[_0x439a60(0x11c)],_0x6bb220[_0x439a60(0x12f)]),_0x530dd0=fs_1[_0x439a60(0x13a)][_0x439a60(0x115)](_0x23846c);return _0x530dd0&&fs_1['default'][_0x439a60(0xe2)](_0x23846c),_0x6bb220[_0x439a60(0x12f)]=null,_0x6bb220[_0x439a60(0xe9)]=null,await _0x6bb220[_0x439a60(0x100)](),_0x19c8e9['send']({'mensagem':_0x439a60(0xe0)});}catch(_0x388075){throw new AppError_1[(_0x439a60(0x13a))](_0x388075['message']);}};exports[a10_0x2e7a32(0xee)]=deleteMedia;