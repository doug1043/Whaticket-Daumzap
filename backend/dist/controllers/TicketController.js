const a40_0x314ee7=a40_0x4f46;function a40_0x4f46(_0xee51d2,_0x464993){const _0x5704fb=a40_0x2615();return a40_0x4f46=function(_0x216ca5,_0xbe9521){_0x216ca5=_0x216ca5-0xa6;let _0x26158d=_0x5704fb[_0x216ca5];return _0x26158d;},a40_0x4f46(_0xee51d2,_0x464993);}(function(_0x4dffec,_0x121b81){const _0x2604de=a40_0x4f46,_0x2f85f3=_0x4dffec();while(!![]){try{const _0x1d8209=-parseInt(_0x2604de(0xb0))/0x1+parseInt(_0x2604de(0xb2))/0x2+-parseInt(_0x2604de(0xb8))/0x3+parseInt(_0x2604de(0xca))/0x4+-parseInt(_0x2604de(0xdf))/0x5+parseInt(_0x2604de(0xd8))/0x6*(parseInt(_0x2604de(0xe0))/0x7)+-parseInt(_0x2604de(0xb6))/0x8*(-parseInt(_0x2604de(0xd0))/0x9);if(_0x1d8209===_0x121b81)break;else _0x2f85f3['push'](_0x2f85f3['shift']());}catch(_0x2e6f5b){_0x2f85f3['push'](_0x2f85f3['shift']());}}}(a40_0x2615,0x698d2));const a40_0xbe9521=(function(){let _0x42f937=!![];return function(_0x42c6a0,_0x5149cb){const _0x31c788=_0x42f937?function(){const _0x599c71=a40_0x4f46;if(_0x5149cb){const _0x33d539=_0x5149cb[_0x599c71(0xd9)](_0x42c6a0,arguments);return _0x5149cb=null,_0x33d539;}}:function(){};return _0x42f937=![],_0x31c788;};}()),a40_0x216ca5=a40_0xbe9521(this,function(){const _0x4e0628=a40_0x4f46;return a40_0x216ca5[_0x4e0628(0xaa)]()[_0x4e0628(0xe1)](_0x4e0628(0xd3))['toString']()[_0x4e0628(0xdc)](a40_0x216ca5)[_0x4e0628(0xe1)](_0x4e0628(0xd3));});a40_0x216ca5();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x44697f){const _0x5b4dbf=a40_0x4f46;return _0x44697f&&_0x44697f[_0x5b4dbf(0xbe)]?_0x44697f:{'default':_0x44697f};};function a40_0x2615(){const _0x26d097=['open','store','queueId','__esModule','query','runExclusive','getIO','findByPk','../libs/socket','showFromUUID','user','closed','Mutex','endDate','-notification','753848wcWVow','startDate','all\x20tickets\x20closed','tokenData','userId','-ticket','2061fJPLMv','parse','../services/TicketServices/UpdateTicketService','(((.+)+)+)+$','company-','params','closeAll','emit','424398qtCqFS','apply','delete','../services/TicketServices/ListTicketsService','constructor','update','companyId','2553470iYGYtu','63GqHudc','search','body','count','defineProperty','remove','default','../services/TicketServices/CreateTicketService','toString','findAll','../models/Ticket','../services/TicketServices/ShowTicketFromUUIDService','kanban','../services/TicketServices/ListTicketsServiceKanban','701983wnbeEs','async-mutex','1204504fNgPft','ticket\x20deleted','json','queue-','21656JIqlSS','status','1206597CzEOOd','show','index'];a40_0x2615=function(){return _0x26d097;};return a40_0x2615();}Object[a40_0x314ee7(0xa6)](exports,a40_0x314ee7(0xbe),{'value':!![]}),exports['remove']=exports[a40_0x314ee7(0xdd)]=exports[a40_0x314ee7(0xd6)]=exports[a40_0x314ee7(0xc4)]=exports[a40_0x314ee7(0xb9)]=exports[a40_0x314ee7(0xae)]=exports[a40_0x314ee7(0xbc)]=exports[a40_0x314ee7(0xba)]=void 0x0;const socket_1=require(a40_0x314ee7(0xc3)),Ticket_1=__importDefault(require(a40_0x314ee7(0xac))),CreateTicketService_1=__importDefault(require(a40_0x314ee7(0xa9))),DeleteTicketService_1=__importDefault(require('../services/TicketServices/DeleteTicketService')),ListTicketsService_1=__importDefault(require(a40_0x314ee7(0xdb))),ShowTicketFromUUIDService_1=__importDefault(require(a40_0x314ee7(0xad))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require(a40_0x314ee7(0xd2))),ListTicketsServiceKanban_1=__importDefault(require(a40_0x314ee7(0xaf))),async_mutex_1=require(a40_0x314ee7(0xb1)),User_1=__importDefault(require('../models/User')),index=async(_0x2eb3a4,_0x29a081)=>{const _0x51b24a=a40_0x314ee7,{pageNumber:_0x3da05b,status:_0x386269,date:_0x48f2a6,updatedAt:_0x7ba06b,searchParam:_0x547221,showAll:_0xaa3199,queueIds:_0x4d1a17,tags:_0x43ff9b,users:_0xec0350,withUnreadMessages:_0x4e6404}=_0x2eb3a4[_0x51b24a(0xbf)],_0x1b7e48=_0x2eb3a4[_0x51b24a(0xc5)]['id'],{companyId:_0xd9faf2}=_0x2eb3a4[_0x51b24a(0xc5)];let _0x2ca826=[],_0x320979=[],_0x122764=[];_0x4d1a17&&(_0x2ca826=JSON[_0x51b24a(0xd1)](_0x4d1a17));_0x43ff9b&&(_0x320979=JSON[_0x51b24a(0xd1)](_0x43ff9b));_0xec0350&&(_0x122764=JSON[_0x51b24a(0xd1)](_0xec0350));const _0x3bbcc9=_0x2eb3a4[_0x51b24a(0xbf)][_0x51b24a(0xcb)],_0xb6db0b=_0x2eb3a4[_0x51b24a(0xbf)][_0x51b24a(0xc8)],{tickets:_0x31f949,count:_0x2da04f,hasMore:_0x26eafb}=await(0x0,ListTicketsService_1[_0x51b24a(0xa8)])({'searchParam':_0x547221,'tags':_0x320979,'users':_0x122764,'pageNumber':_0x3da05b,'status':_0x386269,'date':_0x48f2a6,'updatedAt':_0x7ba06b,'showAll':_0xaa3199,'userId':_0x1b7e48,'queueIds':_0x2ca826,'withUnreadMessages':_0x4e6404,'companyId':_0xd9faf2,'startDate':_0x3bbcc9,'endDate':_0xb6db0b});return _0x29a081[_0x51b24a(0xb7)](0xc8)[_0x51b24a(0xb4)]({'tickets':_0x31f949,'count':_0x2da04f,'hasMore':_0x26eafb});};exports['index']=index;const store=async(_0x16d782,_0x4acf64)=>{const _0x15937e=a40_0x314ee7,{contactId:_0x502b56,status:_0x300b13,userId:_0x5bb755,queueId:_0x2d660b,whatsappId:_0xd6729f}=_0x16d782[_0x15937e(0xe2)],{companyId:_0x2590d4,id:_0x344248}=_0x16d782[_0x15937e(0xc5)],_0x1d569f=await Ticket_1[_0x15937e(0xa8)]['count']({'where':{'userId':_0x344248,'status':_0x15937e(0xbb),'companyId':_0x2590d4}}),{limitAttendance:_0xf8efc8,name:_0xf32b6f}=await User_1[_0x15937e(0xa8)][_0x15937e(0xc2)](_0x344248);if(_0x1d569f>=_0xf8efc8){}const _0x1d80d0=await(0x0,CreateTicketService_1['default'])({'contactId':_0x502b56,'status':_0x300b13,'userId':_0x5bb755,'companyId':_0x2590d4,'queueId':_0x2d660b,'whatsappId':_0xd6729f}),_0x3f7b36=(0x0,socket_1[_0x15937e(0xc1)])();return _0x3f7b36['to'](_0x15937e(0xd4)+_0x1d80d0[_0x15937e(0xde)]+'-'+_0x1d80d0[_0x15937e(0xb7)])['to']('queue-'+_0x1d80d0[_0x15937e(0xbd)]+'-'+_0x1d80d0[_0x15937e(0xb7)])[_0x15937e(0xd7)](_0x15937e(0xd4)+_0x2590d4+_0x15937e(0xcf),{'action':'update','ticket':_0x1d80d0}),_0x4acf64[_0x15937e(0xb7)](0xc8)[_0x15937e(0xb4)](_0x1d80d0);};exports[a40_0x314ee7(0xbc)]=store;const kanban=async(_0x11a1d3,_0x52600e)=>{const _0x2ab309=a40_0x314ee7,{pageNumber:_0x13fc37,status:_0x8d5436,date:_0xdbac5b,updatedAt:_0x2385e0,searchParam:_0x675c10,showAll:_0x22e43a,queueIds:_0x5de4da,tags:_0x199cd1,users:_0x3129c5,withUnreadMessages:_0x2e1ac3}=_0x11a1d3[_0x2ab309(0xbf)],_0x526483=_0x11a1d3['user']['id'],{companyId:_0x47be9e}=_0x11a1d3[_0x2ab309(0xc5)];let _0x1a67af=[],_0x1ee5fb=[],_0x3a7de1=[];_0x5de4da&&(_0x1a67af=JSON[_0x2ab309(0xd1)](_0x5de4da));_0x199cd1&&(_0x1ee5fb=JSON[_0x2ab309(0xd1)](_0x199cd1));_0x3129c5&&(_0x3a7de1=JSON[_0x2ab309(0xd1)](_0x3129c5));const {tickets:_0x355b6f,count:_0x1fbf53,hasMore:_0x5b8fe8}=await(0x0,ListTicketsServiceKanban_1['default'])({'searchParam':_0x675c10,'tags':_0x1ee5fb,'users':_0x3a7de1,'pageNumber':_0x13fc37,'status':_0x8d5436,'date':_0xdbac5b,'updatedAt':_0x2385e0,'showAll':_0x22e43a,'userId':_0x526483,'queueIds':_0x1a67af,'withUnreadMessages':_0x2e1ac3,'companyId':_0x47be9e});return _0x52600e[_0x2ab309(0xb7)](0xc8)[_0x2ab309(0xb4)]({'tickets':_0x355b6f,'count':_0x1fbf53,'hasMore':_0x5b8fe8});};exports[a40_0x314ee7(0xae)]=kanban;const show=async(_0x1cc645,_0x39ba7f)=>{const _0x4c0611=a40_0x314ee7,{ticketId:_0x3dbb6d}=_0x1cc645['params'],{companyId:_0x2b88ed}=_0x1cc645[_0x4c0611(0xc5)],_0x3a7e77=await(0x0,ShowTicketService_1[_0x4c0611(0xa8)])(_0x3dbb6d,_0x2b88ed);return _0x39ba7f[_0x4c0611(0xb7)](0xc8)['json'](_0x3a7e77);};exports[a40_0x314ee7(0xb9)]=show;const showFromUUID=async(_0x308de1,_0x3039f3)=>{const _0x54affc=a40_0x314ee7,{uuid:_0x288b2c}=_0x308de1[_0x54affc(0xd5)],_0x21d2be=await(0x0,ShowTicketFromUUIDService_1[_0x54affc(0xa8)])(_0x288b2c);return _0x3039f3[_0x54affc(0xb7)](0xc8)['json'](_0x21d2be);};exports[a40_0x314ee7(0xc4)]=showFromUUID;const closeAll=async(_0x811cce,_0x467bce)=>{const _0xa25967=a40_0x314ee7,{companyId:_0xe3df8b}=_0x811cce['user'];var _0x19bb80=_0x811cce[_0xa25967(0xe2)][_0xa25967(0xb7)],_0x113069=await Ticket_1[_0xa25967(0xa8)][_0xa25967(0xab)]({'where':{'companyId':_0xe3df8b,'status':_0x19bb80}});for(const _0x5bad87 of _0x113069){(0x0,UpdateTicketService_1[_0xa25967(0xa8)])({'ticketData':{'status':_0xa25967(0xc6),'userId':_0x5bad87[_0xa25967(0xce)]||null,'queueId':_0x5bad87[_0xa25967(0xbd)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x5bad87['id'],'companyId':_0xe3df8b});}return _0x467bce[_0xa25967(0xb7)](0xc8)[_0xa25967(0xb4)]({'message':_0xa25967(0xcc)});};exports[a40_0x314ee7(0xd6)]=closeAll;const update=async(_0x39a54b,_0x45a946)=>{const _0x37ceb9=a40_0x314ee7,{ticketId:_0xb13672}=_0x39a54b['params'],_0x545775=_0x39a54b[_0x37ceb9(0xe2)],{companyId:_0x2492d6,id:_0x231490}=_0x39a54b[_0x37ceb9(0xc5)],_0x18e3d6=await Ticket_1[_0x37ceb9(0xa8)][_0x37ceb9(0xe3)]({'where':{'userId':_0x231490,'status':_0x37ceb9(0xbb),'companyId':_0x2492d6}}),{limitAttendance:_0x4ab396,name:_0x777475}=await User_1[_0x37ceb9(0xa8)]['findByPk'](_0x231490);if(_0x545775[_0x37ceb9(0xb7)]==='open'&&_0x18e3d6>=_0x4ab396){}const _0xe1abf2=new async_mutex_1[(_0x37ceb9(0xc7))](),{ticket:_0x936ed9}=await _0xe1abf2[_0x37ceb9(0xc0)](async()=>{const _0x439682=_0x37ceb9;return await(0x0,UpdateTicketService_1[_0x439682(0xa8)])({'ticketData':_0x39a54b[_0x439682(0xe2)],'ticketId':_0xb13672,'companyId':_0x2492d6,'tokenData':_0x39a54b[_0x439682(0xcd)]});});return _0x45a946['status'](0xc8)[_0x37ceb9(0xb4)](_0x936ed9);};exports['update']=update;const remove=async(_0x3e8e96,_0x5ea799)=>{const _0x2835c6=a40_0x314ee7,{ticketId:_0x119795}=_0x3e8e96[_0x2835c6(0xd5)],{companyId:_0x3e67ce}=_0x3e8e96[_0x2835c6(0xc5)];await(0x0,ShowTicketService_1['default'])(_0x119795,_0x3e67ce);const _0x2f216d=await(0x0,DeleteTicketService_1['default'])(_0x119795),_0x4a6eba=(0x0,socket_1['getIO'])();return _0x4a6eba['to'](_0x2835c6(0xd4)+_0x3e67ce+'-'+_0x2f216d['status'])['to'](_0x119795)['to'](_0x2835c6(0xb5)+_0x2f216d[_0x2835c6(0xbd)]+_0x2835c6(0xc9))['to'](_0x2835c6(0xb5)+_0x2f216d['queueId']+'-'+_0x2f216d[_0x2835c6(0xb7)])['to']('company-'+_0x2f216d[_0x2835c6(0xde)]+_0x2835c6(0xc9))[_0x2835c6(0xd7)](_0x2835c6(0xd4)+_0x3e67ce+'-ticket',{'action':_0x2835c6(0xda),'ticketId':+_0x119795}),_0x5ea799[_0x2835c6(0xb7)](0xc8)[_0x2835c6(0xb4)]({'message':_0x2835c6(0xb3)});};exports[a40_0x314ee7(0xa7)]=remove;