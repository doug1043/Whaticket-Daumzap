const a38_0x34ddc5=a38_0x2b0c;(function(_0x4d7ce3,_0x2fae82){const _0x527648=a38_0x2b0c,_0x4e15db=_0x4d7ce3();while(!![]){try{const _0x1b444a=-parseInt(_0x527648(0x109))/0x1+-parseInt(_0x527648(0x103))/0x2*(-parseInt(_0x527648(0x10e))/0x3)+parseInt(_0x527648(0x101))/0x4+parseInt(_0x527648(0x117))/0x5+-parseInt(_0x527648(0x118))/0x6+parseInt(_0x527648(0x11a))/0x7*(-parseInt(_0x527648(0xfc))/0x8)+parseInt(_0x527648(0x124))/0x9;if(_0x1b444a===_0x2fae82)break;else _0x4e15db['push'](_0x4e15db['shift']());}catch(_0x23ed29){_0x4e15db['push'](_0x4e15db['shift']());}}}(a38_0xbb9a,0xcee22));const a38_0x4c0a87=(function(){let _0x1815ca=!![];return function(_0x4ed80a,_0x4fd8c3){const _0x368f79=_0x1815ca?function(){const _0x5388d2=a38_0x2b0c;if(_0x4fd8c3){const _0x35e8fa=_0x4fd8c3[_0x5388d2(0xff)](_0x4ed80a,arguments);return _0x4fd8c3=null,_0x35e8fa;}}:function(){};return _0x1815ca=![],_0x368f79;};}()),a38_0x3acbba=a38_0x4c0a87(this,function(){const _0x564211=a38_0x2b0c;return a38_0x3acbba['toString']()['search'](_0x564211(0x11e))[_0x564211(0x116)]()[_0x564211(0x10c)](a38_0x3acbba)[_0x564211(0x113)](_0x564211(0x11e));});function a38_0xbb9a(){const _0x4cd1af=['getIO','-notification','toString','1585800fGzPVc','6888444JKNpLL','store','3413347eySTmV','index','async-mutex','userId','(((.+)+)+)+$','-ticket','queue-','showFromUUID','__esModule','queueId','20634939GIvBjn','show','Mutex','update','emit','ticket\x20deleted','defineProperty','open','kanban','status','../services/TicketServices/ShowTicketFromUUIDService','closed','remove','delete','user','default','query','params','json','../services/TicketServices/CreateTicketService','findAll','24cQEeAM','../libs/socket','../services/TicketServices/UpdateTicketService','apply','parse','2474172TbSTKB','../services/TicketServices/DeleteTicketService','8CMnOyt','../services/TicketServices/ShowTicketService','closeAll','../services/TicketServices/ListTicketsService','../models/Ticket','runExclusive','186619lgKHnu','parseInt','pending','constructor','body','312357poWgpM','company-','findOpenTicketByContactId','findOne','sequelize','search'];a38_0xbb9a=function(){return _0x4cd1af;};return a38_0xbb9a();}a38_0x3acbba();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3aa66a){const _0x17a482=a38_0x2b0c;return _0x3aa66a&&_0x3aa66a[_0x17a482(0x122)]?_0x3aa66a:{'default':_0x3aa66a};};Object[a38_0x34ddc5(0xed)](exports,'__esModule',{'value':!![]}),exports[a38_0x34ddc5(0xf3)]=exports[a38_0x34ddc5(0xea)]=exports[a38_0x34ddc5(0x105)]=exports[a38_0x34ddc5(0x121)]=exports[a38_0x34ddc5(0x125)]=exports['store']=exports[a38_0x34ddc5(0x110)]=exports['kanban']=exports[a38_0x34ddc5(0x11b)]=void 0x0;const async_mutex_1=require(a38_0x34ddc5(0x11c)),socket_1=require(a38_0x34ddc5(0xfd)),Ticket_1=__importDefault(require(a38_0x34ddc5(0x107))),sequelize_1=require(a38_0x34ddc5(0x112)),CreateTicketService_1=__importDefault(require(a38_0x34ddc5(0xfa))),DeleteTicketService_1=__importDefault(require(a38_0x34ddc5(0x102))),ListTicketsService_1=__importDefault(require(a38_0x34ddc5(0x106))),ShowTicketFromUUIDService_1=__importDefault(require(a38_0x34ddc5(0xf1))),ShowTicketService_1=__importDefault(require(a38_0x34ddc5(0x104))),UpdateTicketService_1=__importDefault(require(a38_0x34ddc5(0xfe))),ListTicketsServiceKanban_1=__importDefault(require('../services/TicketServices/ListTicketsServiceKanban')),updateMutex=new async_mutex_1[(a38_0x34ddc5(0xe9))](),index=async(_0x1cfbf4,_0x4b98db)=>{const _0x49279b=a38_0x34ddc5,{pageNumber:_0x114c70,status:_0x1ceb39,groups:_0x2222b5,date:_0x402ca8,updatedAt:_0x17a32c,isSearch:_0x599b54,searchParam:_0x2617f3,showAll:_0x5e45d9,queueIds:_0x1a6e8f,tags:_0x8e04e2,users:_0x479365,withUnreadMessages:_0x57d8de,notClosed:_0x542c0a,all:_0x328359}=_0x1cfbf4['query'],_0x5e0635=_0x1cfbf4[_0x49279b(0xf5)]['id'],{companyId:_0x29e413}=_0x1cfbf4[_0x49279b(0xf5)];let _0x825458=[],_0x2fd137=[],_0x289132=[];_0x1a6e8f&&(_0x825458=JSON[_0x49279b(0x100)](_0x1a6e8f));_0x8e04e2&&(_0x2fd137=JSON[_0x49279b(0x100)](_0x8e04e2));_0x479365&&(_0x289132=JSON['parse'](_0x479365));const {tickets:_0x30a36e,count:_0x129313,hasMore:_0x3f108a}=await(0x0,ListTicketsService_1[_0x49279b(0xf6)])({'isSearch':_0x599b54==='true','searchParam':_0x2617f3,'tags':_0x2fd137,'users':_0x289132,'pageNumber':_0x114c70,'status':_0x1ceb39,'groups':_0x2222b5,'date':_0x402ca8,'updatedAt':_0x17a32c,'showAll':_0x5e45d9,'userId':_0x5e0635,'queueIds':_0x825458,'withUnreadMessages':_0x57d8de,'notClosed':!!_0x542c0a,'all':!!_0x328359,'companyId':_0x29e413});return _0x4b98db['status'](0xc8)[_0x49279b(0xf9)]({'tickets':_0x30a36e,'count':_0x129313,'hasMore':_0x3f108a});};exports[a38_0x34ddc5(0x11b)]=index;const kanban=async(_0x1fc9ee,_0x20a0b0)=>{const _0x2637e1=a38_0x34ddc5,{pageNumber:_0x30b085,status:_0x222617,date:_0x1478d,updatedAt:_0x1cba42,searchParam:_0x462dbd,showAll:_0x456afa,queueIds:_0xd7c900,tags:_0x4bdefb,users:_0x4891a0,withUnreadMessages:_0x21b3d0}=_0x1fc9ee[_0x2637e1(0xf7)],_0xede640=_0x1fc9ee['user']['id'],{companyId:_0x25563b}=_0x1fc9ee[_0x2637e1(0xf5)];let _0xca9c94=[],_0x19c66a=[],_0x43f7f4=[];_0xd7c900&&(_0xca9c94=JSON['parse'](_0xd7c900));_0x4bdefb&&(_0x19c66a=JSON[_0x2637e1(0x100)](_0x4bdefb));_0x4891a0&&(_0x43f7f4=JSON[_0x2637e1(0x100)](_0x4891a0));const {tickets:_0x571c00,count:_0x58dd3a,hasMore:_0x438722}=await(0x0,ListTicketsServiceKanban_1[_0x2637e1(0xf6)])({'searchParam':_0x462dbd,'tags':_0x19c66a,'users':_0x43f7f4,'pageNumber':_0x30b085,'status':_0x222617,'date':_0x1478d,'updatedAt':_0x1cba42,'showAll':_0x456afa,'userId':_0xede640,'queueIds':_0xca9c94,'withUnreadMessages':_0x21b3d0,'companyId':_0x25563b});return _0x20a0b0['status'](0xc8)[_0x2637e1(0xf9)]({'tickets':_0x571c00,'count':_0x58dd3a,'hasMore':_0x438722});};exports[a38_0x34ddc5(0xef)]=kanban;const findOpenTicketByContactId=async(_0x482fdd,_0x106aa2)=>{const _0x3bc098=a38_0x34ddc5,_0x24c2c9=await Ticket_1[_0x3bc098(0xf6)][_0x3bc098(0x111)]({'where':{'contactId':_0x482fdd,'companyId':_0x106aa2,'status':{[sequelize_1['Op']['or']]:[_0x3bc098(0xee),_0x3bc098(0x10b)]}}});return _0x24c2c9;};exports[a38_0x34ddc5(0x110)]=findOpenTicketByContactId;function a38_0x2b0c(_0x4649dd,_0x5e7be2){const _0x512878=a38_0xbb9a();return a38_0x2b0c=function(_0x3acbba,_0x4c0a87){_0x3acbba=_0x3acbba-0xe9;let _0xbb9ac4=_0x512878[_0x3acbba];return _0xbb9ac4;},a38_0x2b0c(_0x4649dd,_0x5e7be2);}const store=async(_0x385e7c,_0x17d075)=>{const _0x2a42bf=a38_0x34ddc5,{contactId:_0x143fa5,userId:_0x5e26a0,queueId:_0x54e6cc}=_0x385e7c['body'],{companyId:_0x4091eb}=_0x385e7c[_0x2a42bf(0xf5)],_0x4683f8=await(0x0,exports['findOpenTicketByContactId'])(_0x143fa5,_0x4091eb);if(_0x4683f8)return _0x17d075[_0x2a42bf(0xf0)](0xc8)[_0x2a42bf(0xf9)](_0x4683f8);const _0x921def=await(0x0,CreateTicketService_1['default'])({'contactId':_0x143fa5,'userId':_0x5e26a0,'companyId':_0x4091eb,'queueId':_0x54e6cc}),_0x124499=(0x0,socket_1[_0x2a42bf(0x114)])();return _0x124499['to'](_0x2a42bf(0x10f)+_0x4091eb+'-'+_0x921def[_0x2a42bf(0xf0)])['to'](_0x2a42bf(0x120)+_0x921def[_0x2a42bf(0x123)]+'-'+_0x921def[_0x2a42bf(0xf0)])[_0x2a42bf(0xeb)]('company-'+_0x4091eb+'-ticket',{'action':_0x2a42bf(0xea),'ticket':_0x921def}),_0x17d075[_0x2a42bf(0xf0)](0xc8)[_0x2a42bf(0xf9)](_0x921def);};exports[a38_0x34ddc5(0x119)]=store;const show=async(_0x3ccdfa,_0x2da5f2)=>{const _0x2a5903=a38_0x34ddc5,{ticketId:_0x28af63}=_0x3ccdfa[_0x2a5903(0xf8)],{companyId:_0x3d7d74}=_0x3ccdfa[_0x2a5903(0xf5)],_0x3afe04=await(0x0,ShowTicketService_1['default'])(_0x28af63,_0x3d7d74);return _0x2da5f2[_0x2a5903(0xf0)](0xc8)[_0x2a5903(0xf9)](_0x3afe04);};exports[a38_0x34ddc5(0x125)]=show;const showFromUUID=async(_0x48d4be,_0x49c862)=>{const _0x1a513d=a38_0x34ddc5,{uuid:_0x1469f2}=_0x48d4be[_0x1a513d(0xf8)],_0x4760ca=await(0x0,ShowTicketFromUUIDService_1[_0x1a513d(0xf6)])(_0x1469f2);return _0x49c862[_0x1a513d(0xf0)](0xc8)[_0x1a513d(0xf9)](_0x4760ca);};exports[a38_0x34ddc5(0x121)]=showFromUUID;const closeAll=async(_0x3cd5c9,_0x2b6642)=>{const _0x1063bd=a38_0x34ddc5,{companyId:_0x39cb25}=_0x3cd5c9[_0x1063bd(0xf5)];var _0x37b8d7=_0x3cd5c9[_0x1063bd(0x10d)][_0x1063bd(0xf0)],_0x3e5f99=await Ticket_1[_0x1063bd(0xf6)][_0x1063bd(0xfb)]({'where':{'companyId':_0x39cb25,'status':_0x37b8d7}});for(const _0xc71fa2 of _0x3e5f99){(0x0,UpdateTicketService_1[_0x1063bd(0xf6)])({'ticketData':{'status':_0x1063bd(0xf2),'userId':_0xc71fa2[_0x1063bd(0x11d)]||null,'queueId':_0xc71fa2[_0x1063bd(0x123)]||null,'amountUsedBotQueues':0x0},'ticketId':_0xc71fa2['id'],'companyId':_0x39cb25});}return _0x2b6642[_0x1063bd(0xf0)](0xc8)[_0x1063bd(0xf9)]({'message':'all\x20tickets\x20closed'});};exports[a38_0x34ddc5(0x105)]=closeAll;const update=async(_0x111d36,_0xd67c7e)=>{const _0x3ed1e6=a38_0x34ddc5,{ticketId:_0x2de014}=_0x111d36['params'],{ticket:_0x14a3a0}=await updateMutex[_0x3ed1e6(0x108)](async()=>{const _0x154095=_0x3ed1e6,_0x20b85=await(0x0,UpdateTicketService_1[_0x154095(0xf6)])({'ticketData':_0x111d36[_0x154095(0x10d)],'ticketId':Number[_0x154095(0x10a)](_0x2de014,0xa),'tokenData':_0x111d36['tokenData']});return _0x20b85;});return _0xd67c7e[_0x3ed1e6(0xf0)](0xc8)[_0x3ed1e6(0xf9)](_0x14a3a0);};exports['update']=update;const remove=async(_0x9e108b,_0x4d3239)=>{const _0x49991c=a38_0x34ddc5,{ticketId:_0x427583}=_0x9e108b[_0x49991c(0xf8)],{companyId:_0xca1f6d}=_0x9e108b['user'];await(0x0,ShowTicketService_1[_0x49991c(0xf6)])(_0x427583,_0xca1f6d);const _0x3196aa=await(0x0,DeleteTicketService_1[_0x49991c(0xf6)])(_0x427583),_0x401e6d=(0x0,socket_1['getIO'])();return _0x401e6d['to'](_0x427583)['to']('company-'+_0xca1f6d+'-'+_0x3196aa['status'])['to'](_0x49991c(0x10f)+_0xca1f6d+_0x49991c(0x115))['to'](_0x49991c(0x120)+_0x3196aa[_0x49991c(0x123)]+'-'+_0x3196aa[_0x49991c(0xf0)])['to'](_0x49991c(0x120)+_0x3196aa[_0x49991c(0x123)]+_0x49991c(0x115))[_0x49991c(0xeb)](_0x49991c(0x10f)+_0xca1f6d+_0x49991c(0x11f),{'action':_0x49991c(0xf4),'ticketId':+_0x427583}),_0x4d3239[_0x49991c(0xf0)](0xc8)[_0x49991c(0xf9)]({'message':_0x49991c(0xec)});};exports['remove']=remove;