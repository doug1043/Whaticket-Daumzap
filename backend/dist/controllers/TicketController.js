const a40_0x263c4d=a40_0x1020;(function(_0x49d2f8,_0x5e1f54){const _0x3118a9=a40_0x1020,_0x57ccfe=_0x49d2f8();while(!![]){try{const _0x20bba5=-parseInt(_0x3118a9(0x103))/0x1+-parseInt(_0x3118a9(0xd1))/0x2+-parseInt(_0x3118a9(0xd3))/0x3+-parseInt(_0x3118a9(0x104))/0x4*(-parseInt(_0x3118a9(0xf5))/0x5)+parseInt(_0x3118a9(0xef))/0x6+-parseInt(_0x3118a9(0xfe))/0x7*(-parseInt(_0x3118a9(0xeb))/0x8)+parseInt(_0x3118a9(0xf3))/0x9;if(_0x20bba5===_0x5e1f54)break;else _0x57ccfe['push'](_0x57ccfe['shift']());}catch(_0x3cbe12){_0x57ccfe['push'](_0x57ccfe['shift']());}}}(a40_0xe184,0x90a08));function a40_0xe184(){const _0x24e210=['15VrVpQz','(((.+)+)+)+$','json','constructor','company-','findByPk','params','closed','getIO','959oXqHvD','delete','parse','Mutex','toString','362092ACCSBM','1071488DLpXQN','queueId','../libs/socket','../services/TicketServices/CreateTicketService','-ticket','showFromUUID','queue-','default','604964smawap','companyId','3004008JwzxGm','count','store','index','update','-notification','status','body','endDate','remove','../models/User','../services/TicketServices/ListTicketsServiceKanban','async-mutex','open','findAll','../services/TicketServices/ListTicketsService','__esModule','../services/TicketServices/UpdateTicketService','closeAll','runExclusive','show','emit','defineProperty','tokenData','9432nPerrv','../services/TicketServices/ShowTicketService','user','kanban','3626112iaJETl','../models/Ticket','userId','query','6199299CZYwTS','apply'];a40_0xe184=function(){return _0x24e210;};return a40_0xe184();}function a40_0x1020(_0x45f70d,_0x433a6b){const _0x5ed095=a40_0xe184();return a40_0x1020=function(_0x2123e4,_0xe4dc5a){_0x2123e4=_0x2123e4-0xcc;let _0xe18401=_0x5ed095[_0x2123e4];return _0xe18401;},a40_0x1020(_0x45f70d,_0x433a6b);}const a40_0xe4dc5a=(function(){let _0xd34de4=!![];return function(_0x5406cc,_0x262b6b){const _0x453c5e=_0xd34de4?function(){const _0xd5bdbf=a40_0x1020;if(_0x262b6b){const _0x24ef12=_0x262b6b[_0xd5bdbf(0xf4)](_0x5406cc,arguments);return _0x262b6b=null,_0x24ef12;}}:function(){};return _0xd34de4=![],_0x453c5e;};}()),a40_0x2123e4=a40_0xe4dc5a(this,function(){const _0xbeea2=a40_0x1020;return a40_0x2123e4['toString']()['search'](_0xbeea2(0xf6))[_0xbeea2(0x102)]()[_0xbeea2(0xf8)](a40_0x2123e4)['search'](_0xbeea2(0xf6));});a40_0x2123e4();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2d4e67){const _0x42648c=a40_0x1020;return _0x2d4e67&&_0x2d4e67[_0x42648c(0xe3)]?_0x2d4e67:{'default':_0x2d4e67};};Object[a40_0x263c4d(0xe9)](exports,a40_0x263c4d(0xe3),{'value':!![]}),exports['remove']=exports['update']=exports['closeAll']=exports[a40_0x263c4d(0xce)]=exports[a40_0x263c4d(0xe7)]=exports[a40_0x263c4d(0xee)]=exports[a40_0x263c4d(0xd5)]=exports[a40_0x263c4d(0xd6)]=void 0x0;const socket_1=require(a40_0x263c4d(0x106)),Ticket_1=__importDefault(require(a40_0x263c4d(0xf0))),CreateTicketService_1=__importDefault(require(a40_0x263c4d(0xcc))),DeleteTicketService_1=__importDefault(require('../services/TicketServices/DeleteTicketService')),ListTicketsService_1=__importDefault(require(a40_0x263c4d(0xe2))),ShowTicketFromUUIDService_1=__importDefault(require('../services/TicketServices/ShowTicketFromUUIDService')),ShowTicketService_1=__importDefault(require(a40_0x263c4d(0xec))),UpdateTicketService_1=__importDefault(require(a40_0x263c4d(0xe4))),ListTicketsServiceKanban_1=__importDefault(require(a40_0x263c4d(0xde))),async_mutex_1=require(a40_0x263c4d(0xdf)),User_1=__importDefault(require(a40_0x263c4d(0xdd))),index=async(_0x1f3da2,_0x458edb)=>{const _0x26efdc=a40_0x263c4d,{pageNumber:_0x4506c6,status:_0x1d8698,date:_0x2d6b40,updatedAt:_0x3e44c4,searchParam:_0x1845b8,showAll:_0x9dcb19,queueIds:_0x2bba9d,tags:_0x6d317,users:_0x55c94d,withUnreadMessages:_0xc5ab6}=_0x1f3da2[_0x26efdc(0xf2)],_0x533782=_0x1f3da2['user']['id'],{companyId:_0x9cb3b1}=_0x1f3da2[_0x26efdc(0xed)];let _0x3f6888=[],_0xb2d032=[],_0x462d79=[];_0x2bba9d&&(_0x3f6888=JSON[_0x26efdc(0x100)](_0x2bba9d));_0x6d317&&(_0xb2d032=JSON['parse'](_0x6d317));_0x55c94d&&(_0x462d79=JSON[_0x26efdc(0x100)](_0x55c94d));const _0x1225e5=_0x1f3da2['query']['startDate'],_0x2bc909=_0x1f3da2[_0x26efdc(0xf2)][_0x26efdc(0xdb)],{tickets:_0x3298b7,count:_0x54e6f7,hasMore:_0x5c90e9}=await(0x0,ListTicketsService_1[_0x26efdc(0xd0)])({'searchParam':_0x1845b8,'tags':_0xb2d032,'users':_0x462d79,'pageNumber':_0x4506c6,'status':_0x1d8698,'date':_0x2d6b40,'updatedAt':_0x3e44c4,'showAll':_0x9dcb19,'userId':_0x533782,'queueIds':_0x3f6888,'withUnreadMessages':_0xc5ab6,'companyId':_0x9cb3b1,'startDate':_0x1225e5,'endDate':_0x2bc909});return _0x458edb[_0x26efdc(0xd9)](0xc8)[_0x26efdc(0xf7)]({'tickets':_0x3298b7,'count':_0x54e6f7,'hasMore':_0x5c90e9});};exports['index']=index;const store=async(_0x32fd45,_0x564005)=>{const _0x4f1527=a40_0x263c4d,{contactId:_0x3f73c1,status:_0x40d094,userId:_0x33070e,queueId:_0x585fc3,whatsappId:_0x16ef34}=_0x32fd45[_0x4f1527(0xda)],{companyId:_0x3c41e5,id:_0x569295}=_0x32fd45[_0x4f1527(0xed)],_0x490b17=await Ticket_1[_0x4f1527(0xd0)][_0x4f1527(0xd4)]({'where':{'userId':_0x569295,'status':_0x4f1527(0xe0),'companyId':_0x3c41e5}}),{limitAttendance:_0x48f1a3,name:_0x191b91}=await User_1[_0x4f1527(0xd0)][_0x4f1527(0xfa)](_0x569295);if(_0x490b17>=_0x48f1a3){}const _0x17c1d6=await(0x0,CreateTicketService_1[_0x4f1527(0xd0)])({'contactId':_0x3f73c1,'status':_0x40d094,'userId':_0x33070e,'companyId':_0x3c41e5,'queueId':_0x585fc3,'whatsappId':_0x16ef34}),_0x6a5cc3=(0x0,socket_1[_0x4f1527(0xfd)])();return _0x6a5cc3['to'](_0x4f1527(0xf9)+_0x17c1d6[_0x4f1527(0xd2)]+'-'+_0x17c1d6[_0x4f1527(0xd9)])['to'](_0x4f1527(0xcf)+_0x17c1d6[_0x4f1527(0x105)]+'-'+_0x17c1d6[_0x4f1527(0xd9)])[_0x4f1527(0xe8)](_0x4f1527(0xf9)+_0x3c41e5+_0x4f1527(0xcd),{'action':_0x4f1527(0xd7),'ticket':_0x17c1d6}),_0x564005['status'](0xc8)[_0x4f1527(0xf7)](_0x17c1d6);};exports[a40_0x263c4d(0xd5)]=store;const kanban=async(_0x4a3b47,_0x171fa3)=>{const _0x26e812=a40_0x263c4d,{pageNumber:_0x32ad04,status:_0xa4072d,date:_0x46298a,updatedAt:_0x40aa3a,searchParam:_0x2b6be2,showAll:_0x1b5670,queueIds:_0x58dffd,tags:_0x23e718,users:_0x17021f,withUnreadMessages:_0x45914d}=_0x4a3b47[_0x26e812(0xf2)],_0x362e70=_0x4a3b47['user']['id'],{companyId:_0x2bf688}=_0x4a3b47[_0x26e812(0xed)];let _0x19a2e3=[],_0x1c5ee7=[],_0x228e85=[];_0x58dffd&&(_0x19a2e3=JSON[_0x26e812(0x100)](_0x58dffd));_0x23e718&&(_0x1c5ee7=JSON[_0x26e812(0x100)](_0x23e718));_0x17021f&&(_0x228e85=JSON['parse'](_0x17021f));const {tickets:_0x3232cc,count:_0xd747a8,hasMore:_0x1519ca}=await(0x0,ListTicketsServiceKanban_1[_0x26e812(0xd0)])({'searchParam':_0x2b6be2,'tags':_0x1c5ee7,'users':_0x228e85,'pageNumber':_0x32ad04,'status':_0xa4072d,'date':_0x46298a,'updatedAt':_0x40aa3a,'showAll':_0x1b5670,'userId':_0x362e70,'queueIds':_0x19a2e3,'withUnreadMessages':_0x45914d,'companyId':_0x2bf688});return _0x171fa3['status'](0xc8)[_0x26e812(0xf7)]({'tickets':_0x3232cc,'count':_0xd747a8,'hasMore':_0x1519ca});};exports['kanban']=kanban;const show=async(_0x3b360a,_0xa481fc)=>{const _0xf2c0fc=a40_0x263c4d,{ticketId:_0x432fec}=_0x3b360a[_0xf2c0fc(0xfb)],{companyId:_0x5622f6}=_0x3b360a['user'],_0x3ae081=await(0x0,ShowTicketService_1['default'])(_0x432fec,_0x5622f6);return _0xa481fc[_0xf2c0fc(0xd9)](0xc8)['json'](_0x3ae081);};exports[a40_0x263c4d(0xe7)]=show;const showFromUUID=async(_0x47172b,_0x382cea)=>{const _0x2e2176=a40_0x263c4d,{uuid:_0x1b55ad}=_0x47172b[_0x2e2176(0xfb)],_0x4a22dc=await(0x0,ShowTicketFromUUIDService_1[_0x2e2176(0xd0)])(_0x1b55ad);return _0x382cea['status'](0xc8)['json'](_0x4a22dc);};exports[a40_0x263c4d(0xce)]=showFromUUID;const closeAll=async(_0x2e560c,_0x20579f)=>{const _0x62a38a=a40_0x263c4d,{companyId:_0x2da491}=_0x2e560c[_0x62a38a(0xed)];var _0x1b0235=_0x2e560c[_0x62a38a(0xda)][_0x62a38a(0xd9)],_0x85de13=await Ticket_1[_0x62a38a(0xd0)][_0x62a38a(0xe1)]({'where':{'companyId':_0x2da491,'status':_0x1b0235}});for(const _0x418d77 of _0x85de13){(0x0,UpdateTicketService_1[_0x62a38a(0xd0)])({'ticketData':{'status':_0x62a38a(0xfc),'userId':_0x418d77[_0x62a38a(0xf1)]||null,'queueId':_0x418d77[_0x62a38a(0x105)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x418d77['id'],'companyId':_0x2da491});}return _0x20579f[_0x62a38a(0xd9)](0xc8)[_0x62a38a(0xf7)]({'message':'all\x20tickets\x20closed'});};exports[a40_0x263c4d(0xe5)]=closeAll;const update=async(_0x4ff506,_0x16d549)=>{const _0xb4b636=a40_0x263c4d,{ticketId:_0x4b6c91}=_0x4ff506['params'],_0x566e9f=_0x4ff506['body'],{companyId:_0x173a24,id:_0x367e09}=_0x4ff506[_0xb4b636(0xed)],_0x59f28f=await Ticket_1[_0xb4b636(0xd0)][_0xb4b636(0xd4)]({'where':{'userId':_0x367e09,'status':'open','companyId':_0x173a24}}),{limitAttendance:_0x4bf931,name:_0x40cbaf}=await User_1[_0xb4b636(0xd0)]['findByPk'](_0x367e09);if(_0x566e9f[_0xb4b636(0xd9)]===_0xb4b636(0xe0)&&_0x59f28f>=_0x4bf931){}const _0x4b0ef0=new async_mutex_1[(_0xb4b636(0x101))](),{ticket:_0x5337f1}=await _0x4b0ef0[_0xb4b636(0xe6)](async()=>{const _0x3dc9fd=_0xb4b636;return await(0x0,UpdateTicketService_1[_0x3dc9fd(0xd0)])({'ticketData':_0x4ff506[_0x3dc9fd(0xda)],'ticketId':_0x4b6c91,'companyId':_0x173a24,'tokenData':_0x4ff506[_0x3dc9fd(0xea)]});});return _0x16d549['status'](0xc8)['json'](_0x5337f1);};exports[a40_0x263c4d(0xd7)]=update;const remove=async(_0x466969,_0x396a19)=>{const _0x212bfa=a40_0x263c4d,{ticketId:_0x1d62a7}=_0x466969['params'],{companyId:_0x5f1de6}=_0x466969[_0x212bfa(0xed)];await(0x0,ShowTicketService_1['default'])(_0x1d62a7,_0x5f1de6);const _0x18b600=await(0x0,DeleteTicketService_1[_0x212bfa(0xd0)])(_0x1d62a7),_0x49f1e5=(0x0,socket_1[_0x212bfa(0xfd)])();return _0x49f1e5['to'](_0x212bfa(0xf9)+_0x5f1de6+'-'+_0x18b600[_0x212bfa(0xd9)])['to'](_0x1d62a7)['to'](_0x212bfa(0xcf)+_0x18b600[_0x212bfa(0x105)]+_0x212bfa(0xd8))['to']('queue-'+_0x18b600[_0x212bfa(0x105)]+'-'+_0x18b600[_0x212bfa(0xd9)])['to'](_0x212bfa(0xf9)+_0x18b600['companyId']+_0x212bfa(0xd8))[_0x212bfa(0xe8)](_0x212bfa(0xf9)+_0x5f1de6+_0x212bfa(0xcd),{'action':_0x212bfa(0xff),'ticketId':+_0x1d62a7}),_0x396a19[_0x212bfa(0xd9)](0xc8)[_0x212bfa(0xf7)]({'message':'ticket\x20deleted'});};exports[a40_0x263c4d(0xdc)]=remove;