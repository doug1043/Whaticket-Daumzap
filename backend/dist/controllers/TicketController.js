const a40_0x448d4e=a40_0x5c19;(function(_0xbdd900,_0x5a898d){const _0x466fde=a40_0x5c19,_0x3042a2=_0xbdd900();while(!![]){try{const _0x5d8dbc=-parseInt(_0x466fde(0x16f))/0x1+-parseInt(_0x466fde(0x14e))/0x2*(parseInt(_0x466fde(0x17b))/0x3)+parseInt(_0x466fde(0x168))/0x4*(-parseInt(_0x466fde(0x181))/0x5)+parseInt(_0x466fde(0x158))/0x6*(parseInt(_0x466fde(0x16a))/0x7)+-parseInt(_0x466fde(0x156))/0x8+-parseInt(_0x466fde(0x15b))/0x9*(-parseInt(_0x466fde(0x17a))/0xa)+parseInt(_0x466fde(0x165))/0xb;if(_0x5d8dbc===_0x5a898d)break;else _0x3042a2['push'](_0x3042a2['shift']());}catch(_0x258fa5){_0x3042a2['push'](_0x3042a2['shift']());}}}(a40_0x14fa,0xd737b));const a40_0x253d59=(function(){let _0x18f406=!![];return function(_0x123521,_0x28851a){const _0x401385=_0x18f406?function(){const _0x4d526b=a40_0x5c19;if(_0x28851a){const _0x257d52=_0x28851a[_0x4d526b(0x175)](_0x123521,arguments);return _0x28851a=null,_0x257d52;}}:function(){};return _0x18f406=![],_0x401385;};}()),a40_0xef2539=a40_0x253d59(this,function(){const _0x26b7d8=a40_0x5c19;return a40_0xef2539[_0x26b7d8(0x14f)]()[_0x26b7d8(0x163)]('(((.+)+)+)+$')['toString']()['constructor'](a40_0xef2539)[_0x26b7d8(0x163)](_0x26b7d8(0x177));});a40_0xef2539();'use strict';var __importDefault=this&&this[a40_0x448d4e(0x15a)]||function(_0x8bc7fe){const _0x1c534f=a40_0x448d4e;return _0x8bc7fe&&_0x8bc7fe[_0x1c534f(0x15e)]?_0x8bc7fe:{'default':_0x8bc7fe};};Object[a40_0x448d4e(0x15d)](exports,a40_0x448d4e(0x15e),{'value':!![]}),exports['remove']=exports[a40_0x448d4e(0x17d)]=exports[a40_0x448d4e(0x15c)]=exports['showFromUUID']=exports[a40_0x448d4e(0x17f)]=exports[a40_0x448d4e(0x157)]=exports['store']=exports[a40_0x448d4e(0x16d)]=void 0x0;const socket_1=require('../libs/socket'),Ticket_1=__importDefault(require(a40_0x448d4e(0x162))),CreateTicketService_1=__importDefault(require('../services/TicketServices/CreateTicketService')),DeleteTicketService_1=__importDefault(require(a40_0x448d4e(0x159))),ListTicketsService_1=__importDefault(require(a40_0x448d4e(0x180))),ShowTicketFromUUIDService_1=__importDefault(require(a40_0x448d4e(0x14c))),ShowTicketService_1=__importDefault(require(a40_0x448d4e(0x14d))),UpdateTicketService_1=__importDefault(require(a40_0x448d4e(0x164))),ListTicketsServiceKanban_1=__importDefault(require(a40_0x448d4e(0x178))),async_mutex_1=require(a40_0x448d4e(0x170)),User_1=__importDefault(require(a40_0x448d4e(0x147))),index=async(_0x317ef8,_0x4bf5e5)=>{const _0x17eae0=a40_0x448d4e,{pageNumber:_0x497809,status:_0x1d7f34,date:_0x26d5e2,updatedAt:_0x33947e,searchParam:_0x398950,showAll:_0x1ece2d,queueIds:_0x9d17a3,tags:_0x4b5406,users:_0x1b410b,withUnreadMessages:_0x841fd7}=_0x317ef8['query'],_0x4c6729=_0x317ef8[_0x17eae0(0x176)]['id'],{companyId:_0x36e131}=_0x317ef8[_0x17eae0(0x176)];let _0x41d0ba=[],_0x5aead7=[],_0x51a9cb=[];_0x9d17a3&&(_0x41d0ba=JSON[_0x17eae0(0x16c)](_0x9d17a3));_0x4b5406&&(_0x5aead7=JSON[_0x17eae0(0x16c)](_0x4b5406));_0x1b410b&&(_0x51a9cb=JSON[_0x17eae0(0x16c)](_0x1b410b));const _0x1027b8=_0x317ef8[_0x17eae0(0x16e)][_0x17eae0(0x171)],_0x38cbc6=_0x317ef8[_0x17eae0(0x16e)][_0x17eae0(0x14b)],{tickets:_0xd55905,count:_0x30c757,hasMore:_0x209dd4}=await(0x0,ListTicketsService_1[_0x17eae0(0x17e)])({'searchParam':_0x398950,'tags':_0x5aead7,'users':_0x51a9cb,'pageNumber':_0x497809,'status':_0x1d7f34,'date':_0x26d5e2,'updatedAt':_0x33947e,'showAll':_0x1ece2d,'userId':_0x4c6729,'queueIds':_0x41d0ba,'withUnreadMessages':_0x841fd7,'companyId':_0x36e131,'startDate':_0x1027b8,'endDate':_0x38cbc6});return _0x4bf5e5[_0x17eae0(0x154)](0xc8)[_0x17eae0(0x152)]({'tickets':_0xd55905,'count':_0x30c757,'hasMore':_0x209dd4});};exports[a40_0x448d4e(0x16d)]=index;const store=async(_0x3804ed,_0x23fd91)=>{const _0x1614a7=a40_0x448d4e,{contactId:_0x190e92,status:_0x540cbf,userId:_0x44268c,queueId:_0xf9242a,whatsappId:_0x1205db}=_0x3804ed[_0x1614a7(0x182)],{companyId:_0xd18f69,id:_0xe86d2b}=_0x3804ed['user'],_0xa07415=await Ticket_1[_0x1614a7(0x17e)][_0x1614a7(0x155)]({'where':{'userId':_0xe86d2b,'status':_0x1614a7(0x146),'companyId':_0xd18f69}}),{limitAttendance:_0x31d7f0,name:_0x1909c4}=await User_1[_0x1614a7(0x17e)][_0x1614a7(0x145)](_0xe86d2b);if(_0xa07415>=_0x31d7f0){}const _0x173877=await(0x0,CreateTicketService_1[_0x1614a7(0x17e)])({'contactId':_0x190e92,'status':_0x540cbf,'userId':_0x44268c,'companyId':_0xd18f69,'queueId':_0xf9242a,'whatsappId':_0x1205db}),_0x319660=(0x0,socket_1['getIO'])();return _0x319660['to'](_0x1614a7(0x172)+_0x173877['companyId']+'-'+_0x173877['status'])['to'](_0x1614a7(0x160)+_0x173877[_0x1614a7(0x174)]+'-'+_0x173877[_0x1614a7(0x154)])[_0x1614a7(0x151)]('company-'+_0xd18f69+_0x1614a7(0x179),{'action':_0x1614a7(0x17d),'ticket':_0x173877}),_0x23fd91['status'](0xc8)[_0x1614a7(0x152)](_0x173877);};exports[a40_0x448d4e(0x150)]=store;const kanban=async(_0x5760f0,_0x33ebad)=>{const _0x18c014=a40_0x448d4e,{pageNumber:_0x5e1677,status:_0x403f42,date:_0x35d873,updatedAt:_0xc17229,searchParam:_0x233bc2,showAll:_0x20f768,queueIds:_0x5bc303,tags:_0x25759f,users:_0xe9e467,withUnreadMessages:_0x2dde91}=_0x5760f0[_0x18c014(0x16e)],_0x2083ec=_0x5760f0[_0x18c014(0x176)]['id'],{companyId:_0x531281}=_0x5760f0['user'];let _0x128756=[],_0x39a6fe=[],_0x26b6c5=[];_0x5bc303&&(_0x128756=JSON[_0x18c014(0x16c)](_0x5bc303));_0x25759f&&(_0x39a6fe=JSON[_0x18c014(0x16c)](_0x25759f));_0xe9e467&&(_0x26b6c5=JSON[_0x18c014(0x16c)](_0xe9e467));const {tickets:_0x3a5d46,count:_0x205ef9,hasMore:_0x175c91}=await(0x0,ListTicketsServiceKanban_1[_0x18c014(0x17e)])({'searchParam':_0x233bc2,'tags':_0x39a6fe,'users':_0x26b6c5,'pageNumber':_0x5e1677,'status':_0x403f42,'date':_0x35d873,'updatedAt':_0xc17229,'showAll':_0x20f768,'userId':_0x2083ec,'queueIds':_0x128756,'withUnreadMessages':_0x2dde91,'companyId':_0x531281});return _0x33ebad['status'](0xc8)[_0x18c014(0x152)]({'tickets':_0x3a5d46,'count':_0x205ef9,'hasMore':_0x175c91});};exports[a40_0x448d4e(0x157)]=kanban;const show=async(_0x5e6138,_0x382dc5)=>{const _0xf04f55=a40_0x448d4e,{ticketId:_0x215021}=_0x5e6138['params'],{companyId:_0x50552d}=_0x5e6138[_0xf04f55(0x176)],_0x462fb3=await(0x0,ShowTicketService_1[_0xf04f55(0x17e)])(_0x215021,_0x50552d);return _0x382dc5[_0xf04f55(0x154)](0xc8)['json'](_0x462fb3);};exports[a40_0x448d4e(0x17f)]=show;const showFromUUID=async(_0x481883,_0x529a5d)=>{const _0x310610=a40_0x448d4e,{uuid:_0x97a581}=_0x481883[_0x310610(0x15f)],_0x275895=await(0x0,ShowTicketFromUUIDService_1[_0x310610(0x17e)])(_0x97a581);return _0x529a5d[_0x310610(0x154)](0xc8)[_0x310610(0x152)](_0x275895);};exports['showFromUUID']=showFromUUID;const closeAll=async(_0x3bf35e,_0x30e850)=>{const _0x4d8be6=a40_0x448d4e,{companyId:_0x373a34}=_0x3bf35e[_0x4d8be6(0x176)];var _0x5a5ae9=_0x3bf35e[_0x4d8be6(0x182)][_0x4d8be6(0x154)],_0x289582=await Ticket_1[_0x4d8be6(0x17e)]['findAll']({'where':{'companyId':_0x373a34,'status':_0x5a5ae9}});for(const _0xc4db58 of _0x289582){(0x0,UpdateTicketService_1[_0x4d8be6(0x17e)])({'ticketData':{'status':'closed','userId':_0xc4db58[_0x4d8be6(0x148)]||null,'queueId':_0xc4db58[_0x4d8be6(0x174)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0xc4db58['id'],'companyId':_0x373a34});}return _0x30e850[_0x4d8be6(0x154)](0xc8)[_0x4d8be6(0x152)]({'message':_0x4d8be6(0x167)});};function a40_0x5c19(_0x8d26f4,_0x330ab7){const _0x403c8f=a40_0x14fa();return a40_0x5c19=function(_0xef2539,_0x253d59){_0xef2539=_0xef2539-0x145;let _0x14fa49=_0x403c8f[_0xef2539];return _0x14fa49;},a40_0x5c19(_0x8d26f4,_0x330ab7);}exports[a40_0x448d4e(0x15c)]=closeAll;const update=async(_0x2a71f5,_0x1ea74d)=>{const _0x3bf838=a40_0x448d4e,{ticketId:_0xddb70}=_0x2a71f5[_0x3bf838(0x15f)],_0x54443f=_0x2a71f5[_0x3bf838(0x182)],{companyId:_0x30e354,id:_0x3f42b3}=_0x2a71f5[_0x3bf838(0x176)],_0x321eb3=await Ticket_1[_0x3bf838(0x17e)][_0x3bf838(0x155)]({'where':{'userId':_0x3f42b3,'status':'open','companyId':_0x30e354}}),{limitAttendance:_0x251bf0,name:_0xb54313}=await User_1[_0x3bf838(0x17e)]['findByPk'](_0x3f42b3);if(_0x54443f['status']===_0x3bf838(0x146)&&_0x321eb3>=_0x251bf0){}const _0x5d8871=new async_mutex_1[(_0x3bf838(0x17c))](),{ticket:_0x35088e}=await _0x5d8871[_0x3bf838(0x153)](async()=>{const _0x114304=_0x3bf838;return await(0x0,UpdateTicketService_1[_0x114304(0x17e)])({'ticketData':_0x2a71f5[_0x114304(0x182)],'ticketId':_0xddb70,'companyId':_0x30e354,'tokenData':_0x2a71f5[_0x114304(0x161)]});});return _0x1ea74d[_0x3bf838(0x154)](0xc8)[_0x3bf838(0x152)](_0x35088e);};exports[a40_0x448d4e(0x17d)]=update;function a40_0x14fa(){const _0x464d90=['closeAll','defineProperty','__esModule','params','queue-','tokenData','../models/Ticket','search','../services/TicketServices/UpdateTicketService','42683014TZCktz','remove','all\x20tickets\x20closed','408mbykTU','-notification','21EJYGle','getIO','parse','index','query','1428452nAyCIL','async-mutex','startDate','company-','companyId','queueId','apply','user','(((.+)+)+)+$','../services/TicketServices/ListTicketsServiceKanban','-ticket','322330FdiTOd','3uAblyZ','Mutex','update','default','show','../services/TicketServices/ListTicketsService','83275sYZAQi','body','findByPk','open','../models/User','userId','delete','ticket\x20deleted','endDate','../services/TicketServices/ShowTicketFromUUIDService','../services/TicketServices/ShowTicketService','10370UIBhNR','toString','store','emit','json','runExclusive','status','count','813520qHCURu','kanban','148458NBegwj','../services/TicketServices/DeleteTicketService','__importDefault','45PjelyV'];a40_0x14fa=function(){return _0x464d90;};return a40_0x14fa();}const remove=async(_0x227a28,_0x583dcd)=>{const _0x330149=a40_0x448d4e,{ticketId:_0x377e41}=_0x227a28[_0x330149(0x15f)],{companyId:_0x239c8e}=_0x227a28[_0x330149(0x176)];await(0x0,ShowTicketService_1[_0x330149(0x17e)])(_0x377e41,_0x239c8e);const _0x2c478e=await(0x0,DeleteTicketService_1['default'])(_0x377e41),_0x50dfcb=(0x0,socket_1[_0x330149(0x16b)])();return _0x50dfcb['to'](_0x330149(0x172)+_0x239c8e+'-'+_0x2c478e[_0x330149(0x154)])['to'](_0x377e41)['to'](_0x330149(0x160)+_0x2c478e[_0x330149(0x174)]+'-notification')['to'](_0x330149(0x160)+_0x2c478e[_0x330149(0x174)]+'-'+_0x2c478e[_0x330149(0x154)])['to'](_0x330149(0x172)+_0x2c478e[_0x330149(0x173)]+_0x330149(0x169))['emit']('company-'+_0x239c8e+_0x330149(0x179),{'action':_0x330149(0x149),'ticketId':+_0x377e41}),_0x583dcd[_0x330149(0x154)](0xc8)['json']({'message':_0x330149(0x14a)});};exports[a40_0x448d4e(0x166)]=remove;