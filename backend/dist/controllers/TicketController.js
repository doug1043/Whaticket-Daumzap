const a40_0x5a6308=a40_0x3469;function a40_0x3469(_0x2880f7,_0x5352ec){const _0x1c8d9d=a40_0x29a1();return a40_0x3469=function(_0xf35955,_0x11fa35){_0xf35955=_0xf35955-0x187;let _0x29a167=_0x1c8d9d[_0xf35955];return _0x29a167;},a40_0x3469(_0x2880f7,_0x5352ec);}(function(_0x4f2297,_0x760740){const _0x10a0e0=a40_0x3469,_0x5d62b2=_0x4f2297();while(!![]){try{const _0x128fec=-parseInt(_0x10a0e0(0x1a8))/0x1+-parseInt(_0x10a0e0(0x1a7))/0x2+-parseInt(_0x10a0e0(0x1b5))/0x3*(parseInt(_0x10a0e0(0x1a4))/0x4)+-parseInt(_0x10a0e0(0x1aa))/0x5+-parseInt(_0x10a0e0(0x1bc))/0x6*(-parseInt(_0x10a0e0(0x18c))/0x7)+-parseInt(_0x10a0e0(0x1a1))/0x8*(-parseInt(_0x10a0e0(0x191))/0x9)+parseInt(_0x10a0e0(0x1b7))/0xa;if(_0x128fec===_0x760740)break;else _0x5d62b2['push'](_0x5d62b2['shift']());}catch(_0x433ab7){_0x5d62b2['push'](_0x5d62b2['shift']());}}}(a40_0x29a1,0x4d37f));const a40_0x11fa35=(function(){let _0x3ab1f4=!![];return function(_0x197f2a,_0x2ef053){const _0x1d48e9=_0x3ab1f4?function(){const _0x28e5fa=a40_0x3469;if(_0x2ef053){const _0x43f1f5=_0x2ef053[_0x28e5fa(0x1bf)](_0x197f2a,arguments);return _0x2ef053=null,_0x43f1f5;}}:function(){};return _0x3ab1f4=![],_0x1d48e9;};}()),a40_0xf35955=a40_0x11fa35(this,function(){const _0x430de1=a40_0x3469;return a40_0xf35955[_0x430de1(0x1af)]()['search'](_0x430de1(0x1ba))[_0x430de1(0x1af)]()['constructor'](a40_0xf35955)[_0x430de1(0x19d)]('(((.+)+)+)+$');});function a40_0x29a1(){const _0x5e5636=['1753175SnWZHP','index','json','userId','company-','toString','tokenData','companyId','closed','open','closeAll','3sLFbxg','delete','7009260Hvgeij','user','status','(((.+)+)+)+$','startDate','1086FwoEpe','default','query','apply','../services/TicketServices/ListTicketsService','params','__importDefault','endDate','show','queueId','async-mutex','-notification','2723pzUokF','showFromUUID','../models/Ticket','parse','../services/TicketServices/ShowTicketFromUUIDService','27hVOKWt','getIO','Mutex','runExclusive','../services/TicketServices/UpdateTicketService','ticket\x20deleted','-ticket','update','kanban','emit','queue-','__esModule','search','count','store','remove','1313072wxWWVc','findAll','all\x20tickets\x20closed','666548MNECNU','body','../models/User','473124heOnhH','193616Zsbdfh','../libs/socket'];a40_0x29a1=function(){return _0x5e5636;};return a40_0x29a1();}a40_0xf35955();'use strict';var __importDefault=this&&this[a40_0x5a6308(0x1c2)]||function(_0xd7dbd8){const _0xdda68=a40_0x5a6308;return _0xd7dbd8&&_0xd7dbd8[_0xdda68(0x19c)]?_0xd7dbd8:{'default':_0xd7dbd8};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a40_0x5a6308(0x1a0)]=exports[a40_0x5a6308(0x198)]=exports[a40_0x5a6308(0x1b4)]=exports[a40_0x5a6308(0x18d)]=exports[a40_0x5a6308(0x188)]=exports[a40_0x5a6308(0x199)]=exports[a40_0x5a6308(0x19f)]=exports[a40_0x5a6308(0x1ab)]=void 0x0;const socket_1=require(a40_0x5a6308(0x1a9)),Ticket_1=__importDefault(require(a40_0x5a6308(0x18e))),CreateTicketService_1=__importDefault(require('../services/TicketServices/CreateTicketService')),DeleteTicketService_1=__importDefault(require('../services/TicketServices/DeleteTicketService')),ListTicketsService_1=__importDefault(require(a40_0x5a6308(0x1c0))),ShowTicketFromUUIDService_1=__importDefault(require(a40_0x5a6308(0x190))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require(a40_0x5a6308(0x195))),ListTicketsServiceKanban_1=__importDefault(require('../services/TicketServices/ListTicketsServiceKanban')),async_mutex_1=require(a40_0x5a6308(0x18a)),User_1=__importDefault(require(a40_0x5a6308(0x1a6))),index=async(_0x818ae,_0x42f468)=>{const _0x400f10=a40_0x5a6308,{pageNumber:_0x55581d,status:_0x2a4445,date:_0x525120,updatedAt:_0x2f21c2,searchParam:_0x5359e6,showAll:_0x5a09cb,queueIds:_0x5df29c,tags:_0x1b4357,users:_0x3b7e47,withUnreadMessages:_0x5b27e4}=_0x818ae['query'],_0x306ed1=_0x818ae['user']['id'],{companyId:_0xb0b818}=_0x818ae[_0x400f10(0x1b8)];let _0x3ce8d5=[],_0x1dcdc2=[],_0x5720e7=[];_0x5df29c&&(_0x3ce8d5=JSON[_0x400f10(0x18f)](_0x5df29c));_0x1b4357&&(_0x1dcdc2=JSON[_0x400f10(0x18f)](_0x1b4357));_0x3b7e47&&(_0x5720e7=JSON['parse'](_0x3b7e47));const _0x327a43=_0x818ae['query'][_0x400f10(0x1bb)],_0x2436f7=_0x818ae[_0x400f10(0x1be)][_0x400f10(0x187)],{tickets:_0x3294f0,count:_0x2ba929,hasMore:_0x2d3810}=await(0x0,ListTicketsService_1[_0x400f10(0x1bd)])({'searchParam':_0x5359e6,'tags':_0x1dcdc2,'users':_0x5720e7,'pageNumber':_0x55581d,'status':_0x2a4445,'date':_0x525120,'updatedAt':_0x2f21c2,'showAll':_0x5a09cb,'userId':_0x306ed1,'queueIds':_0x3ce8d5,'withUnreadMessages':_0x5b27e4,'companyId':_0xb0b818,'startDate':_0x327a43,'endDate':_0x2436f7});return _0x42f468[_0x400f10(0x1b9)](0xc8)[_0x400f10(0x1ac)]({'tickets':_0x3294f0,'count':_0x2ba929,'hasMore':_0x2d3810});};exports[a40_0x5a6308(0x1ab)]=index;const store=async(_0x47062a,_0x52ad71)=>{const _0x140db6=a40_0x5a6308,{contactId:_0x8f886,status:_0x5c4671,userId:_0xbe729c,queueId:_0x3d948b,whatsappId:_0x45281e}=_0x47062a[_0x140db6(0x1a5)],{companyId:_0x134a50,id:_0x7de4c2}=_0x47062a[_0x140db6(0x1b8)],_0x2e8cfb=await Ticket_1[_0x140db6(0x1bd)]['count']({'where':{'userId':_0x7de4c2,'status':'open','companyId':_0x134a50}}),{limitAttendance:_0x19c554,name:_0x5eed13}=await User_1['default']['findByPk'](_0x7de4c2);if(_0x2e8cfb>=_0x19c554){}const _0x8d4e7d=await(0x0,CreateTicketService_1[_0x140db6(0x1bd)])({'contactId':_0x8f886,'status':_0x5c4671,'userId':_0xbe729c,'companyId':_0x134a50,'queueId':_0x3d948b,'whatsappId':_0x45281e}),_0x3d440d=(0x0,socket_1[_0x140db6(0x192)])();return _0x3d440d['to']('company-'+_0x8d4e7d[_0x140db6(0x1b1)]+'-'+_0x8d4e7d[_0x140db6(0x1b9)])['to']('queue-'+_0x8d4e7d[_0x140db6(0x189)]+'-'+_0x8d4e7d[_0x140db6(0x1b9)])['emit'](_0x140db6(0x1ae)+_0x134a50+_0x140db6(0x197),{'action':_0x140db6(0x198),'ticket':_0x8d4e7d}),_0x52ad71['status'](0xc8)[_0x140db6(0x1ac)](_0x8d4e7d);};exports[a40_0x5a6308(0x19f)]=store;const kanban=async(_0x4b2175,_0x1932df)=>{const _0x3056d5=a40_0x5a6308,{pageNumber:_0x3b0b2f,status:_0x47e48f,date:_0x4b5485,updatedAt:_0x30a4c1,searchParam:_0x55daa,showAll:_0x2a76fd,queueIds:_0x21dc1c,tags:_0x3654ae,users:_0xf72911,withUnreadMessages:_0x2084af}=_0x4b2175[_0x3056d5(0x1be)],_0x56160b=_0x4b2175[_0x3056d5(0x1b8)]['id'],{companyId:_0x563bf5}=_0x4b2175[_0x3056d5(0x1b8)];let _0x3d9301=[],_0x2a12bd=[],_0x4521c0=[];_0x21dc1c&&(_0x3d9301=JSON[_0x3056d5(0x18f)](_0x21dc1c));_0x3654ae&&(_0x2a12bd=JSON[_0x3056d5(0x18f)](_0x3654ae));_0xf72911&&(_0x4521c0=JSON[_0x3056d5(0x18f)](_0xf72911));const {tickets:_0x5b877a,count:_0x555da4,hasMore:_0xb41449}=await(0x0,ListTicketsServiceKanban_1[_0x3056d5(0x1bd)])({'searchParam':_0x55daa,'tags':_0x2a12bd,'users':_0x4521c0,'pageNumber':_0x3b0b2f,'status':_0x47e48f,'date':_0x4b5485,'updatedAt':_0x30a4c1,'showAll':_0x2a76fd,'userId':_0x56160b,'queueIds':_0x3d9301,'withUnreadMessages':_0x2084af,'companyId':_0x563bf5});return _0x1932df[_0x3056d5(0x1b9)](0xc8)[_0x3056d5(0x1ac)]({'tickets':_0x5b877a,'count':_0x555da4,'hasMore':_0xb41449});};exports[a40_0x5a6308(0x199)]=kanban;const show=async(_0x3dcdac,_0x302c80)=>{const _0x23ee6b=a40_0x5a6308,{ticketId:_0x205e35}=_0x3dcdac[_0x23ee6b(0x1c1)],{companyId:_0x234a48}=_0x3dcdac[_0x23ee6b(0x1b8)],_0x247208=await(0x0,ShowTicketService_1[_0x23ee6b(0x1bd)])(_0x205e35,_0x234a48);return _0x302c80['status'](0xc8)[_0x23ee6b(0x1ac)](_0x247208);};exports['show']=show;const showFromUUID=async(_0x1cec4d,_0x41a052)=>{const _0x595925=a40_0x5a6308,{uuid:_0x4c25ca}=_0x1cec4d[_0x595925(0x1c1)],_0x25d040=await(0x0,ShowTicketFromUUIDService_1[_0x595925(0x1bd)])(_0x4c25ca);return _0x41a052[_0x595925(0x1b9)](0xc8)[_0x595925(0x1ac)](_0x25d040);};exports[a40_0x5a6308(0x18d)]=showFromUUID;const closeAll=async(_0x431c63,_0x398a94)=>{const _0x4a184e=a40_0x5a6308,{companyId:_0x5366c4}=_0x431c63[_0x4a184e(0x1b8)];var _0x153873=_0x431c63[_0x4a184e(0x1a5)][_0x4a184e(0x1b9)],_0x4e08ec=await Ticket_1[_0x4a184e(0x1bd)][_0x4a184e(0x1a2)]({'where':{'companyId':_0x5366c4,'status':_0x153873}});for(const _0x2d740a of _0x4e08ec){(0x0,UpdateTicketService_1[_0x4a184e(0x1bd)])({'ticketData':{'status':_0x4a184e(0x1b2),'userId':_0x2d740a[_0x4a184e(0x1ad)]||null,'queueId':_0x2d740a['queueId']||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x2d740a['id'],'companyId':_0x5366c4});}return _0x398a94[_0x4a184e(0x1b9)](0xc8)['json']({'message':_0x4a184e(0x1a3)});};exports['closeAll']=closeAll;const update=async(_0x3d2033,_0x3df71d)=>{const _0x189598=a40_0x5a6308,{ticketId:_0x504245}=_0x3d2033[_0x189598(0x1c1)],_0x36dc79=_0x3d2033[_0x189598(0x1a5)],{companyId:_0x4058fc,id:_0x47cb02}=_0x3d2033[_0x189598(0x1b8)],_0x1b74c8=await Ticket_1[_0x189598(0x1bd)][_0x189598(0x19e)]({'where':{'userId':_0x47cb02,'status':_0x189598(0x1b3),'companyId':_0x4058fc}}),{limitAttendance:_0x2a12a8,name:_0x3f7217}=await User_1[_0x189598(0x1bd)]['findByPk'](_0x47cb02);if(_0x36dc79[_0x189598(0x1b9)]===_0x189598(0x1b3)&&_0x1b74c8>=_0x2a12a8){}const _0x4d59cc=new async_mutex_1[(_0x189598(0x193))](),{ticket:_0x2a615e}=await _0x4d59cc[_0x189598(0x194)](async()=>{const _0x1eb26c=_0x189598;return await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x3d2033[_0x1eb26c(0x1a5)],'ticketId':_0x504245,'companyId':_0x4058fc,'tokenData':_0x3d2033[_0x1eb26c(0x1b0)]});});return _0x3df71d[_0x189598(0x1b9)](0xc8)[_0x189598(0x1ac)](_0x2a615e);};exports[a40_0x5a6308(0x198)]=update;const remove=async(_0xb0d4e3,_0x173959)=>{const _0x55afb0=a40_0x5a6308,{ticketId:_0x516f56}=_0xb0d4e3['params'],{companyId:_0x119f9f}=_0xb0d4e3[_0x55afb0(0x1b8)];await(0x0,ShowTicketService_1['default'])(_0x516f56,_0x119f9f);const _0x3014b3=await(0x0,DeleteTicketService_1['default'])(_0x516f56),_0x2a36f1=(0x0,socket_1[_0x55afb0(0x192)])();return _0x2a36f1['to'](_0x55afb0(0x1ae)+_0x119f9f+'-'+_0x3014b3[_0x55afb0(0x1b9)])['to'](_0x516f56)['to'](_0x55afb0(0x19b)+_0x3014b3['queueId']+_0x55afb0(0x18b))['to'](_0x55afb0(0x19b)+_0x3014b3['queueId']+'-'+_0x3014b3[_0x55afb0(0x1b9)])['to'](_0x55afb0(0x1ae)+_0x3014b3[_0x55afb0(0x1b1)]+_0x55afb0(0x18b))[_0x55afb0(0x19a)]('company-'+_0x119f9f+_0x55afb0(0x197),{'action':_0x55afb0(0x1b6),'ticketId':+_0x516f56}),_0x173959['status'](0xc8)[_0x55afb0(0x1ac)]({'message':_0x55afb0(0x196)});};exports['remove']=remove;