const a40_0xa5e2b8=a40_0x371a;function a40_0x6c14(){const _0x17b087=['json','parse','7429928ihxlmg','runExclusive','../services/TicketServices/CreateTicketService','default','query','count','16049WKGLSI','6Vwrwvk','defineProperty','12imuPZI','1048055qpxUgh','all\x20tickets\x20closed','270EoEdqC','body','apply','company-','closeAll','36891zMhkdJ','queue-','../services/TicketServices/ListTicketsServiceKanban','6sUniNl','endDate','(((.+)+)+)+$','params','findByPk','ticket\x20deleted','475688VoiYgh','toString','async-mutex','kanban','status','Mutex','518294ikNvRN','22Ajvkdn','__importDefault','../libs/socket','__esModule','show','../services/TicketServices/ListTicketsService','open','update','-ticket','delete','1196824KyrLmK','queueId','findAll','getIO','../models/User','companyId','user','closed','-notification','userId','../services/TicketServices/ShowTicketFromUUIDService','remove','../services/TicketServices/DeleteTicketService','emit','constructor','showFromUUID'];a40_0x6c14=function(){return _0x17b087;};return a40_0x6c14();}(function(_0x79d33f,_0x13fced){const _0x38bbfc=a40_0x371a,_0x4a4ef7=_0x79d33f();while(!![]){try{const _0x1f134f=-parseInt(_0x38bbfc(0x129))/0x1*(-parseInt(_0x38bbfc(0x144))/0x2)+-parseInt(_0x38bbfc(0x137))/0x3*(parseInt(_0x38bbfc(0x13d))/0x4)+-parseInt(_0x38bbfc(0x12d))/0x5*(parseInt(_0x38bbfc(0x12a))/0x6)+parseInt(_0x38bbfc(0x143))/0x7+-parseInt(_0x38bbfc(0x111))/0x8+-parseInt(_0x38bbfc(0x134))/0x9*(parseInt(_0x38bbfc(0x12f))/0xa)+parseInt(_0x38bbfc(0x123))/0xb*(parseInt(_0x38bbfc(0x12c))/0xc);if(_0x1f134f===_0x13fced)break;else _0x4a4ef7['push'](_0x4a4ef7['shift']());}catch(_0x400f83){_0x4a4ef7['push'](_0x4a4ef7['shift']());}}}(a40_0x6c14,0x354ba));const a40_0x3cbbc3=(function(){let _0x3c25f3=!![];return function(_0x289ede,_0x1b5034){const _0x1aa117=_0x3c25f3?function(){const _0x1338c4=a40_0x371a;if(_0x1b5034){const _0x3bf827=_0x1b5034[_0x1338c4(0x131)](_0x289ede,arguments);return _0x1b5034=null,_0x3bf827;}}:function(){};return _0x3c25f3=![],_0x1aa117;};}()),a40_0x586588=a40_0x3cbbc3(this,function(){const _0x394fe4=a40_0x371a;return a40_0x586588[_0x394fe4(0x13e)]()['search'](_0x394fe4(0x139))[_0x394fe4(0x13e)]()[_0x394fe4(0x11f)](a40_0x586588)['search'](_0x394fe4(0x139));});a40_0x586588();'use strict';var __importDefault=this&&this[a40_0xa5e2b8(0x145)]||function(_0x1918f9){const _0xbb003c=a40_0xa5e2b8;return _0x1918f9&&_0x1918f9[_0xbb003c(0x10a)]?_0x1918f9:{'default':_0x1918f9};};Object[a40_0xa5e2b8(0x12b)](exports,a40_0xa5e2b8(0x10a),{'value':!![]}),exports[a40_0xa5e2b8(0x11c)]=exports[a40_0xa5e2b8(0x10e)]=exports[a40_0xa5e2b8(0x133)]=exports[a40_0xa5e2b8(0x120)]=exports[a40_0xa5e2b8(0x10b)]=exports[a40_0xa5e2b8(0x140)]=exports['store']=exports['index']=void 0x0;const socket_1=require(a40_0xa5e2b8(0x146)),Ticket_1=__importDefault(require('../models/Ticket')),CreateTicketService_1=__importDefault(require(a40_0xa5e2b8(0x125))),DeleteTicketService_1=__importDefault(require(a40_0xa5e2b8(0x11d))),ListTicketsService_1=__importDefault(require(a40_0xa5e2b8(0x10c))),ShowTicketFromUUIDService_1=__importDefault(require(a40_0xa5e2b8(0x11b))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require('../services/TicketServices/UpdateTicketService')),ListTicketsServiceKanban_1=__importDefault(require(a40_0xa5e2b8(0x136))),async_mutex_1=require(a40_0xa5e2b8(0x13f)),User_1=__importDefault(require(a40_0xa5e2b8(0x115))),index=async(_0x425674,_0x13abd4)=>{const _0x249b7b=a40_0xa5e2b8,{pageNumber:_0x2a7d8c,status:_0x129054,date:_0xeaf9bf,updatedAt:_0x215856,searchParam:_0x3c32b4,showAll:_0x418625,queueIds:_0x37cafc,tags:_0x4a5c6e,users:_0x41885f,withUnreadMessages:_0x4b54be}=_0x425674[_0x249b7b(0x127)],_0xdcbf95=_0x425674['user']['id'],{companyId:_0x22b7d2}=_0x425674[_0x249b7b(0x117)];let _0xd4ebfb=[],_0x11adf7=[],_0x4d2ded=[];_0x37cafc&&(_0xd4ebfb=JSON[_0x249b7b(0x122)](_0x37cafc));_0x4a5c6e&&(_0x11adf7=JSON[_0x249b7b(0x122)](_0x4a5c6e));_0x41885f&&(_0x4d2ded=JSON[_0x249b7b(0x122)](_0x41885f));const _0x378827=_0x425674['query']['startDate'],_0x570d12=_0x425674[_0x249b7b(0x127)][_0x249b7b(0x138)],{tickets:_0x52a659,count:_0x5be737,hasMore:_0x56991b}=await(0x0,ListTicketsService_1[_0x249b7b(0x126)])({'searchParam':_0x3c32b4,'tags':_0x11adf7,'users':_0x4d2ded,'pageNumber':_0x2a7d8c,'status':_0x129054,'date':_0xeaf9bf,'updatedAt':_0x215856,'showAll':_0x418625,'userId':_0xdcbf95,'queueIds':_0xd4ebfb,'withUnreadMessages':_0x4b54be,'companyId':_0x22b7d2,'startDate':_0x378827,'endDate':_0x570d12});return _0x13abd4[_0x249b7b(0x141)](0xc8)[_0x249b7b(0x121)]({'tickets':_0x52a659,'count':_0x5be737,'hasMore':_0x56991b});};exports['index']=index;const store=async(_0x2fd6d4,_0xfc19ff)=>{const _0x5c62ba=a40_0xa5e2b8,{contactId:_0x4aedf4,status:_0x4d7b7e,userId:_0xc30610,queueId:_0x20f559,whatsappId:_0x3e8ff1}=_0x2fd6d4[_0x5c62ba(0x130)],{companyId:_0x9935b9,id:_0x135876}=_0x2fd6d4[_0x5c62ba(0x117)],_0x333767=await Ticket_1[_0x5c62ba(0x126)][_0x5c62ba(0x128)]({'where':{'userId':_0x135876,'status':'open','companyId':_0x9935b9}}),{limitAttendance:_0x3c891a,name:_0x68886b}=await User_1[_0x5c62ba(0x126)][_0x5c62ba(0x13b)](_0x135876);if(_0x333767>=_0x3c891a){}const _0x1a10f2=await(0x0,CreateTicketService_1[_0x5c62ba(0x126)])({'contactId':_0x4aedf4,'status':_0x4d7b7e,'userId':_0xc30610,'companyId':_0x9935b9,'queueId':_0x20f559,'whatsappId':_0x3e8ff1}),_0x20024f=(0x0,socket_1[_0x5c62ba(0x114)])();return _0x20024f['to'](_0x5c62ba(0x132)+_0x1a10f2[_0x5c62ba(0x116)]+'-'+_0x1a10f2[_0x5c62ba(0x141)])['to']('queue-'+_0x1a10f2[_0x5c62ba(0x112)]+'-'+_0x1a10f2[_0x5c62ba(0x141)])[_0x5c62ba(0x11e)](_0x5c62ba(0x132)+_0x9935b9+_0x5c62ba(0x10f),{'action':_0x5c62ba(0x10e),'ticket':_0x1a10f2}),_0xfc19ff[_0x5c62ba(0x141)](0xc8)['json'](_0x1a10f2);};exports['store']=store;const kanban=async(_0x35c650,_0x3f480d)=>{const _0x1d5d9c=a40_0xa5e2b8,{pageNumber:_0xb36297,status:_0x44e576,date:_0x503363,updatedAt:_0x3ec6a6,searchParam:_0x54907f,showAll:_0x20fbcd,queueIds:_0x504c3b,tags:_0xdb4eae,users:_0x5a9a7b,withUnreadMessages:_0x182a30}=_0x35c650[_0x1d5d9c(0x127)],_0x188346=_0x35c650[_0x1d5d9c(0x117)]['id'],{companyId:_0xeb53d9}=_0x35c650[_0x1d5d9c(0x117)];let _0x1076d9=[],_0x57044b=[],_0x399e55=[];_0x504c3b&&(_0x1076d9=JSON[_0x1d5d9c(0x122)](_0x504c3b));_0xdb4eae&&(_0x57044b=JSON[_0x1d5d9c(0x122)](_0xdb4eae));_0x5a9a7b&&(_0x399e55=JSON['parse'](_0x5a9a7b));const {tickets:_0x3209b8,count:_0x3ebfd9,hasMore:_0x19d8ff}=await(0x0,ListTicketsServiceKanban_1[_0x1d5d9c(0x126)])({'searchParam':_0x54907f,'tags':_0x57044b,'users':_0x399e55,'pageNumber':_0xb36297,'status':_0x44e576,'date':_0x503363,'updatedAt':_0x3ec6a6,'showAll':_0x20fbcd,'userId':_0x188346,'queueIds':_0x1076d9,'withUnreadMessages':_0x182a30,'companyId':_0xeb53d9});return _0x3f480d[_0x1d5d9c(0x141)](0xc8)[_0x1d5d9c(0x121)]({'tickets':_0x3209b8,'count':_0x3ebfd9,'hasMore':_0x19d8ff});};exports['kanban']=kanban;function a40_0x371a(_0x4ff9b4,_0x371585){const _0x2b7df2=a40_0x6c14();return a40_0x371a=function(_0x586588,_0x3cbbc3){_0x586588=_0x586588-0x10a;let _0x6c1442=_0x2b7df2[_0x586588];return _0x6c1442;},a40_0x371a(_0x4ff9b4,_0x371585);}const show=async(_0x5b3e8d,_0x3341b3)=>{const _0x2158f7=a40_0xa5e2b8,{ticketId:_0x123a5f}=_0x5b3e8d[_0x2158f7(0x13a)],{companyId:_0x4f013b}=_0x5b3e8d[_0x2158f7(0x117)],_0x364a3e=await(0x0,ShowTicketService_1[_0x2158f7(0x126)])(_0x123a5f,_0x4f013b);return _0x3341b3[_0x2158f7(0x141)](0xc8)[_0x2158f7(0x121)](_0x364a3e);};exports[a40_0xa5e2b8(0x10b)]=show;const showFromUUID=async(_0x44de28,_0x59ac9c)=>{const _0x4ca997=a40_0xa5e2b8,{uuid:_0x598102}=_0x44de28[_0x4ca997(0x13a)],_0x1b0400=await(0x0,ShowTicketFromUUIDService_1['default'])(_0x598102);return _0x59ac9c['status'](0xc8)[_0x4ca997(0x121)](_0x1b0400);};exports['showFromUUID']=showFromUUID;const closeAll=async(_0x2bee0e,_0x4cd510)=>{const _0x117c82=a40_0xa5e2b8,{companyId:_0x17bda6}=_0x2bee0e[_0x117c82(0x117)];var _0x1914ff=_0x2bee0e['body'][_0x117c82(0x141)],_0x8fb7fb=await Ticket_1['default'][_0x117c82(0x113)]({'where':{'companyId':_0x17bda6,'status':_0x1914ff}});for(const _0x20e276 of _0x8fb7fb){(0x0,UpdateTicketService_1[_0x117c82(0x126)])({'ticketData':{'status':_0x117c82(0x118),'userId':_0x20e276[_0x117c82(0x11a)]||null,'queueId':_0x20e276['queueId']||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x20e276['id'],'companyId':_0x17bda6});}return _0x4cd510[_0x117c82(0x141)](0xc8)[_0x117c82(0x121)]({'message':_0x117c82(0x12e)});};exports[a40_0xa5e2b8(0x133)]=closeAll;const update=async(_0x4a65b3,_0x1622b3)=>{const _0x213313=a40_0xa5e2b8,{ticketId:_0x131ba6}=_0x4a65b3[_0x213313(0x13a)],_0x548f68=_0x4a65b3[_0x213313(0x130)],{companyId:_0x57738c,id:_0x1af489}=_0x4a65b3[_0x213313(0x117)],_0x218f73=await Ticket_1['default']['count']({'where':{'userId':_0x1af489,'status':_0x213313(0x10d),'companyId':_0x57738c}}),{limitAttendance:_0x3f4136,name:_0x2fac10}=await User_1['default']['findByPk'](_0x1af489);if(_0x548f68[_0x213313(0x141)]===_0x213313(0x10d)&&_0x218f73>=_0x3f4136){}const _0x1e7ae5=new async_mutex_1[(_0x213313(0x142))](),{ticket:_0x1cc27d}=await _0x1e7ae5[_0x213313(0x124)](async()=>{const _0x12eeb9=_0x213313;return await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x4a65b3[_0x12eeb9(0x130)],'ticketId':_0x131ba6,'companyId':_0x57738c,'tokenData':_0x4a65b3['tokenData']});});return _0x1622b3[_0x213313(0x141)](0xc8)[_0x213313(0x121)](_0x1cc27d);};exports[a40_0xa5e2b8(0x10e)]=update;const remove=async(_0x27ee84,_0x2f9e86)=>{const _0x35bb22=a40_0xa5e2b8,{ticketId:_0x4675f4}=_0x27ee84['params'],{companyId:_0x1c186d}=_0x27ee84[_0x35bb22(0x117)];await(0x0,ShowTicketService_1[_0x35bb22(0x126)])(_0x4675f4,_0x1c186d);const _0x461ae6=await(0x0,DeleteTicketService_1[_0x35bb22(0x126)])(_0x4675f4),_0x12e605=(0x0,socket_1[_0x35bb22(0x114)])();return _0x12e605['to'](_0x35bb22(0x132)+_0x1c186d+'-'+_0x461ae6[_0x35bb22(0x141)])['to'](_0x4675f4)['to'](_0x35bb22(0x135)+_0x461ae6[_0x35bb22(0x112)]+_0x35bb22(0x119))['to'](_0x35bb22(0x135)+_0x461ae6[_0x35bb22(0x112)]+'-'+_0x461ae6[_0x35bb22(0x141)])['to'](_0x35bb22(0x132)+_0x461ae6[_0x35bb22(0x116)]+_0x35bb22(0x119))[_0x35bb22(0x11e)](_0x35bb22(0x132)+_0x1c186d+_0x35bb22(0x10f),{'action':_0x35bb22(0x110),'ticketId':+_0x4675f4}),_0x2f9e86[_0x35bb22(0x141)](0xc8)[_0x35bb22(0x121)]({'message':_0x35bb22(0x13c)});};exports[a40_0xa5e2b8(0x11c)]=remove;