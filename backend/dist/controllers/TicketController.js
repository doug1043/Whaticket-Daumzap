const a38_0x38827d=a38_0x3f86;(function(_0x397586,_0x30a459){const _0x1a53b5=a38_0x3f86,_0x3ddfbd=_0x397586();while(!![]){try{const _0x700daf=parseInt(_0x1a53b5(0x1d3))/0x1*(parseInt(_0x1a53b5(0x200))/0x2)+parseInt(_0x1a53b5(0x1db))/0x3+parseInt(_0x1a53b5(0x1dd))/0x4*(parseInt(_0x1a53b5(0x1d5))/0x5)+-parseInt(_0x1a53b5(0x1ed))/0x6+parseInt(_0x1a53b5(0x1d9))/0x7*(-parseInt(_0x1a53b5(0x1fb))/0x8)+parseInt(_0x1a53b5(0x1f4))/0x9+parseInt(_0x1a53b5(0x1e0))/0xa*(-parseInt(_0x1a53b5(0x1f8))/0xb);if(_0x700daf===_0x30a459)break;else _0x3ddfbd['push'](_0x3ddfbd['shift']());}catch(_0x700faf){_0x3ddfbd['push'](_0x3ddfbd['shift']());}}}(a38_0x2ad9,0xbf478));const a38_0x20d0f0=(function(){let _0x1074e5=!![];return function(_0x1ea33d,_0x3c8941){const _0x136469=_0x1074e5?function(){if(_0x3c8941){const _0x49e073=_0x3c8941['apply'](_0x1ea33d,arguments);return _0x3c8941=null,_0x49e073;}}:function(){};return _0x1074e5=![],_0x136469;};}()),a38_0xcd9f63=a38_0x20d0f0(this,function(){const _0x54ab9b=a38_0x3f86;return a38_0xcd9f63[_0x54ab9b(0x1ee)]()['search']('(((.+)+)+)+$')[_0x54ab9b(0x1ee)]()['constructor'](a38_0xcd9f63)[_0x54ab9b(0x1e9)](_0x54ab9b(0x1eb));});a38_0xcd9f63();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x14db4c){const _0x546e86=a38_0x3f86;return _0x14db4c&&_0x14db4c[_0x546e86(0x1fa)]?_0x14db4c:{'default':_0x14db4c};};Object['defineProperty'](exports,a38_0x38827d(0x1fa),{'value':!![]}),exports['remove']=exports[a38_0x38827d(0x1e7)]=exports[a38_0x38827d(0x1ea)]=exports[a38_0x38827d(0x1cf)]=exports[a38_0x38827d(0x1f7)]=exports[a38_0x38827d(0x1e1)]=exports[a38_0x38827d(0x1e4)]=exports['kanban']=exports[a38_0x38827d(0x1ce)]=void 0x0;const async_mutex_1=require(a38_0x38827d(0x1d6)),socket_1=require('../libs/socket'),Ticket_1=__importDefault(require(a38_0x38827d(0x1f5))),sequelize_1=require(a38_0x38827d(0x1e5)),CreateTicketService_1=__importDefault(require(a38_0x38827d(0x1ef))),DeleteTicketService_1=__importDefault(require(a38_0x38827d(0x1f1))),ListTicketsService_1=__importDefault(require(a38_0x38827d(0x1d8))),ShowTicketFromUUIDService_1=__importDefault(require(a38_0x38827d(0x1dc))),ShowTicketService_1=__importDefault(require(a38_0x38827d(0x1fd))),UpdateTicketService_1=__importDefault(require(a38_0x38827d(0x204))),ListTicketsServiceKanban_1=__importDefault(require(a38_0x38827d(0x1ec))),updateMutex=new async_mutex_1[(a38_0x38827d(0x1f0))](),index=async(_0x17e9a8,_0x40536a)=>{const _0x1d1d63=a38_0x38827d,{pageNumber:_0x2df7ab,status:_0x322462,groups:_0x2455b4,date:_0x1939ce,updatedAt:_0x195702,isSearch:_0x57e53b,searchParam:_0x4219b1,showAll:_0xda5e5d,queueIds:_0x41016f,tags:_0x196ca7,users:_0x52dc49,withUnreadMessages:_0x3f911a,notClosed:_0x514416,all:_0x3402d7}=_0x17e9a8[_0x1d1d63(0x1f3)],_0xfe3856=_0x17e9a8[_0x1d1d63(0x1fe)]['id'],{companyId:_0x41677c}=_0x17e9a8[_0x1d1d63(0x1fe)];let _0x3bd2f4=[],_0x161368=[],_0x3d12f2=[];_0x41016f&&(_0x3bd2f4=JSON[_0x1d1d63(0x1d4)](_0x41016f));_0x196ca7&&(_0x161368=JSON['parse'](_0x196ca7));_0x52dc49&&(_0x3d12f2=JSON['parse'](_0x52dc49));const {tickets:_0x584789,count:_0x16d962,hasMore:_0x27aaa3}=await(0x0,ListTicketsService_1[_0x1d1d63(0x1fc)])({'isSearch':_0x57e53b==='true','searchParam':_0x4219b1,'tags':_0x161368,'users':_0x3d12f2,'pageNumber':_0x2df7ab,'status':_0x322462,'groups':_0x2455b4,'date':_0x1939ce,'updatedAt':_0x195702,'showAll':_0xda5e5d,'userId':_0xfe3856,'queueIds':_0x3bd2f4,'withUnreadMessages':_0x3f911a,'notClosed':!!_0x514416,'all':!!_0x3402d7,'companyId':_0x41677c});return _0x40536a[_0x1d1d63(0x1e3)](0xc8)['json']({'tickets':_0x584789,'count':_0x16d962,'hasMore':_0x27aaa3});};exports[a38_0x38827d(0x1ce)]=index;const kanban=async(_0x331468,_0x124d55)=>{const _0x3898d8=a38_0x38827d,{pageNumber:_0x16a896,status:_0x18b20b,date:_0x171780,updatedAt:_0x213773,searchParam:_0xd30389,showAll:_0x14f41c,queueIds:_0x2f4a7a,tags:_0x11c365,users:_0x5a4b1a,withUnreadMessages:_0x452baf}=_0x331468['query'],_0x134533=_0x331468['user']['id'],{companyId:_0x43d539}=_0x331468[_0x3898d8(0x1fe)];let _0x39fe2c=[],_0x40aaed=[],_0x36b5f4=[];_0x2f4a7a&&(_0x39fe2c=JSON[_0x3898d8(0x1d4)](_0x2f4a7a));_0x11c365&&(_0x40aaed=JSON[_0x3898d8(0x1d4)](_0x11c365));_0x5a4b1a&&(_0x36b5f4=JSON[_0x3898d8(0x1d4)](_0x5a4b1a));const {tickets:_0x2e131b,count:_0x3f8772,hasMore:_0x524460}=await(0x0,ListTicketsServiceKanban_1[_0x3898d8(0x1fc)])({'searchParam':_0xd30389,'tags':_0x40aaed,'users':_0x36b5f4,'pageNumber':_0x16a896,'status':_0x18b20b,'date':_0x171780,'updatedAt':_0x213773,'showAll':_0x14f41c,'userId':_0x134533,'queueIds':_0x39fe2c,'withUnreadMessages':_0x452baf,'companyId':_0x43d539});return _0x124d55[_0x3898d8(0x1e3)](0xc8)[_0x3898d8(0x203)]({'tickets':_0x2e131b,'count':_0x3f8772,'hasMore':_0x524460});};exports[a38_0x38827d(0x202)]=kanban;const findOpenTicketByContactId=async(_0x2d4383,_0x5435cc)=>{const _0x26d995=a38_0x38827d,_0x470a11=await Ticket_1[_0x26d995(0x1fc)]['findOne']({'where':{'contactId':_0x2d4383,'companyId':_0x5435cc,'status':{[sequelize_1['Op']['or']]:[_0x26d995(0x1d1),_0x26d995(0x206)]}}});return _0x470a11;};exports[a38_0x38827d(0x1e4)]=findOpenTicketByContactId;const store=async(_0xd57696,_0x105481)=>{const _0x4119ed=a38_0x38827d,{contactId:_0x5bceb2,userId:_0x1e433a,queueId:_0x4e1747}=_0xd57696['body'],{companyId:_0x5129c4}=_0xd57696[_0x4119ed(0x1fe)],_0x485b63=await(0x0,exports['findOpenTicketByContactId'])(_0x5bceb2,_0x5129c4);if(_0x485b63)return _0x105481[_0x4119ed(0x1e3)](0xc8)[_0x4119ed(0x203)](_0x485b63);const _0x2aef77=await(0x0,CreateTicketService_1['default'])({'contactId':_0x5bceb2,'userId':_0x1e433a,'companyId':_0x5129c4,'queueId':_0x4e1747}),_0x2dbbfc=(0x0,socket_1[_0x4119ed(0x205)])();return _0x2dbbfc['to'](_0x4119ed(0x1cc)+_0x5129c4+'-'+_0x2aef77['status'])['to'](_0x4119ed(0x1f9)+_0x2aef77[_0x4119ed(0x1e2)]+'-'+_0x2aef77[_0x4119ed(0x1e3)])[_0x4119ed(0x1f2)](_0x4119ed(0x1cc)+_0x5129c4+_0x4119ed(0x1d7),{'action':_0x4119ed(0x1e7),'ticket':_0x2aef77}),_0x105481[_0x4119ed(0x1e3)](0xc8)['json'](_0x2aef77);};exports[a38_0x38827d(0x1e1)]=store;const show=async(_0xb5c04c,_0x28d37a)=>{const _0x5ba322=a38_0x38827d,{ticketId:_0x167577}=_0xb5c04c['params'],{companyId:_0x3378e9}=_0xb5c04c[_0x5ba322(0x1fe)],_0x58f4=await(0x0,ShowTicketService_1[_0x5ba322(0x1fc)])(_0x167577,_0x3378e9);return _0x28d37a[_0x5ba322(0x1e3)](0xc8)['json'](_0x58f4);};exports['show']=show;const showFromUUID=async(_0x314082,_0x31c6d5)=>{const _0x21b31f=a38_0x38827d,{uuid:_0xa2ec5d}=_0x314082[_0x21b31f(0x1d2)],_0x4e7bf1=await(0x0,ShowTicketFromUUIDService_1[_0x21b31f(0x1fc)])(_0xa2ec5d);return _0x31c6d5['status'](0xc8)[_0x21b31f(0x203)](_0x4e7bf1);};exports[a38_0x38827d(0x1cf)]=showFromUUID;const closeAll=async(_0x1c9402,_0x262fd2)=>{const _0x1df89d=a38_0x38827d,{companyId:_0x178e5f}=_0x1c9402[_0x1df89d(0x1fe)];var _0x44eb3c=_0x1c9402[_0x1df89d(0x1e8)]['status'],_0x42a964=await Ticket_1['default'][_0x1df89d(0x1da)]({'where':{'companyId':_0x178e5f,'status':_0x44eb3c}});for(const _0xd63c46 of _0x42a964){(0x0,UpdateTicketService_1[_0x1df89d(0x1fc)])({'ticketData':{'status':'closed','userId':_0xd63c46[_0x1df89d(0x1de)]||null,'queueId':_0xd63c46[_0x1df89d(0x1e2)]||null,'amountUsedBotQueues':0x0},'ticketId':_0xd63c46['id'],'companyId':_0x178e5f});}return _0x262fd2[_0x1df89d(0x1e3)](0xc8)['json']({'message':_0x1df89d(0x1ff)});};exports[a38_0x38827d(0x1ea)]=closeAll;const update=async(_0x2568fc,_0x5240b7)=>{const _0x35aff9=a38_0x38827d,{ticketId:_0x58dc0b}=_0x2568fc[_0x35aff9(0x1d2)],{ticket:_0x267744}=await updateMutex[_0x35aff9(0x1f6)](async()=>{const _0x151f18=_0x35aff9,_0x27ab9f=await(0x0,UpdateTicketService_1[_0x151f18(0x1fc)])({'ticketData':_0x2568fc[_0x151f18(0x1e8)],'ticketId':Number[_0x151f18(0x201)](_0x58dc0b,0xa),'tokenData':_0x2568fc[_0x151f18(0x1d0)]});return _0x27ab9f;});return _0x5240b7[_0x35aff9(0x1e3)](0xc8)[_0x35aff9(0x203)](_0x267744);};exports[a38_0x38827d(0x1e7)]=update;const remove=async(_0x4d183d,_0x29a34a)=>{const _0x1e4ddd=a38_0x38827d,{ticketId:_0x45749b}=_0x4d183d[_0x1e4ddd(0x1d2)],{companyId:_0x52ec8d}=_0x4d183d[_0x1e4ddd(0x1fe)];await(0x0,ShowTicketService_1[_0x1e4ddd(0x1fc)])(_0x45749b,_0x52ec8d);const _0x534dcb=await(0x0,DeleteTicketService_1[_0x1e4ddd(0x1fc)])(_0x45749b),_0x226c0f=(0x0,socket_1[_0x1e4ddd(0x205)])();return _0x226c0f['to'](_0x45749b)['to'](_0x1e4ddd(0x1cc)+_0x52ec8d+'-'+_0x534dcb[_0x1e4ddd(0x1e3)])['to'](_0x1e4ddd(0x1cc)+_0x52ec8d+_0x1e4ddd(0x1cd))['to']('queue-'+_0x534dcb[_0x1e4ddd(0x1e2)]+'-'+_0x534dcb[_0x1e4ddd(0x1e3)])['to']('queue-'+_0x534dcb[_0x1e4ddd(0x1e2)]+'-notification')[_0x1e4ddd(0x1f2)](_0x1e4ddd(0x1cc)+_0x52ec8d+'-ticket',{'action':_0x1e4ddd(0x1df),'ticketId':+_0x45749b}),_0x29a34a['status'](0xc8)[_0x1e4ddd(0x203)]({'message':'ticket\x20deleted'});};exports[a38_0x38827d(0x1e6)]=remove;function a38_0x3f86(_0xea16ce,_0x2e94f4){const _0x512bb0=a38_0x2ad9();return a38_0x3f86=function(_0xcd9f63,_0x20d0f0){_0xcd9f63=_0xcd9f63-0x1cc;let _0x2ad92d=_0x512bb0[_0xcd9f63];return _0x2ad92d;},a38_0x3f86(_0xea16ce,_0x2e94f4);}function a38_0x2ad9(){const _0x224916=['24nnoVRM','default','../services/TicketServices/ShowTicketService','user','all\x20tickets\x20closed','214OvIDSO','parseInt','kanban','json','../services/TicketServices/UpdateTicketService','getIO','pending','company-','-notification','index','showFromUUID','tokenData','open','params','14389ZyYHQw','parse','944150cBcSJi','async-mutex','-ticket','../services/TicketServices/ListTicketsService','2792391PrZrtl','findAll','1500552JAuDZM','../services/TicketServices/ShowTicketFromUUIDService','8CCjzcZ','userId','delete','430mbuNCw','store','queueId','status','findOpenTicketByContactId','sequelize','remove','update','body','search','closeAll','(((.+)+)+)+$','../services/TicketServices/ListTicketsServiceKanban','5487984ToEpNs','toString','../services/TicketServices/CreateTicketService','Mutex','../services/TicketServices/DeleteTicketService','emit','query','10748808AaLkIn','../models/Ticket','runExclusive','show','183392iSXbxx','queue-','__esModule'];a38_0x2ad9=function(){return _0x224916;};return a38_0x2ad9();}