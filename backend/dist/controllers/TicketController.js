const a40_0x587503=a40_0x4772;(function(_0x657f43,_0x2cc591){const _0x5e376f=a40_0x4772,_0x4bb0ac=_0x657f43();while(!![]){try{const _0x20384f=-parseInt(_0x5e376f(0x192))/0x1*(-parseInt(_0x5e376f(0x18c))/0x2)+-parseInt(_0x5e376f(0x166))/0x3*(parseInt(_0x5e376f(0x184))/0x4)+parseInt(_0x5e376f(0x193))/0x5*(-parseInt(_0x5e376f(0x186))/0x6)+-parseInt(_0x5e376f(0x183))/0x7*(-parseInt(_0x5e376f(0x178))/0x8)+-parseInt(_0x5e376f(0x167))/0x9+parseInt(_0x5e376f(0x18f))/0xa*(-parseInt(_0x5e376f(0x190))/0xb)+-parseInt(_0x5e376f(0x169))/0xc*(-parseInt(_0x5e376f(0x17f))/0xd);if(_0x20384f===_0x2cc591)break;else _0x4bb0ac['push'](_0x4bb0ac['shift']());}catch(_0x3ca788){_0x4bb0ac['push'](_0x4bb0ac['shift']());}}}(a40_0x75f4,0xbda06));const a40_0x43a550=(function(){let _0x31a4df=!![];return function(_0x2cd565,_0x25b225){const _0x3249e7=_0x31a4df?function(){if(_0x25b225){const _0x872da4=_0x25b225['apply'](_0x2cd565,arguments);return _0x25b225=null,_0x872da4;}}:function(){};return _0x31a4df=![],_0x3249e7;};}()),a40_0xdfe97d=a40_0x43a550(this,function(){const _0x213e0b=a40_0x4772;return a40_0xdfe97d[_0x213e0b(0x197)]()[_0x213e0b(0x18a)](_0x213e0b(0x19d))['toString']()['constructor'](a40_0xdfe97d)[_0x213e0b(0x18a)](_0x213e0b(0x19d));});a40_0xdfe97d();function a40_0x75f4(){const _0x566b55=['status','ticket\x20deleted','all\x20tickets\x20closed','body','../services/TicketServices/CreateTicketService','endDate','findAll','emit','-ticket','findByPk','query','../services/TicketServices/ListTicketsService','679600jByjhk','companyId','__importDefault','../services/TicketServices/ListTicketsServiceKanban','Mutex','getIO','async-mutex','715iXlTht','-notification','parse','remove','28vxsegL','132ppePey','update','222hvFDVX','closeAll','runExclusive','closed','search','../services/TicketServices/DeleteTicketService','6XCyzXr','json','__esModule','492290tcyMrI','154zbZQqq','params','126603tZYaem','174845ODFIfn','store','queueId','count','toString','kanban','delete','show','user','../services/TicketServices/UpdateTicketService','(((.+)+)+)+$','default','../services/TicketServices/ShowTicketFromUUIDService','queue-','../libs/socket','company-','50703tnNKsE','2731698jxVRoE','tokenData','633036gIAKZW','open','showFromUUID'];a40_0x75f4=function(){return _0x566b55;};return a40_0x75f4();}'use strict';var __importDefault=this&&this[a40_0x587503(0x17a)]||function(_0x91d625){const _0x445c96=a40_0x587503;return _0x91d625&&_0x91d625[_0x445c96(0x18e)]?_0x91d625:{'default':_0x91d625};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a40_0x587503(0x182)]=exports['update']=exports[a40_0x587503(0x187)]=exports[a40_0x587503(0x16b)]=exports[a40_0x587503(0x19a)]=exports[a40_0x587503(0x198)]=exports[a40_0x587503(0x194)]=exports['index']=void 0x0;const socket_1=require(a40_0x587503(0x164)),Ticket_1=__importDefault(require('../models/Ticket')),CreateTicketService_1=__importDefault(require(a40_0x587503(0x170))),DeleteTicketService_1=__importDefault(require(a40_0x587503(0x18b))),ListTicketsService_1=__importDefault(require(a40_0x587503(0x177))),ShowTicketFromUUIDService_1=__importDefault(require(a40_0x587503(0x19f))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require(a40_0x587503(0x19c))),ListTicketsServiceKanban_1=__importDefault(require(a40_0x587503(0x17b))),async_mutex_1=require(a40_0x587503(0x17e)),User_1=__importDefault(require('../models/User')),index=async(_0x3fbf87,_0x892a27)=>{const _0x4af28e=a40_0x587503,{pageNumber:_0x44d09e,status:_0x23e119,date:_0x2b31e3,updatedAt:_0x52848f,searchParam:_0x142ac2,showAll:_0x82cf99,queueIds:_0x2210bd,tags:_0x52de75,users:_0x18d4f8,withUnreadMessages:_0x39bc89}=_0x3fbf87['query'],_0x20a23c=_0x3fbf87['user']['id'],{companyId:_0x42cd54}=_0x3fbf87[_0x4af28e(0x19b)];let _0xe0fe7e=[],_0x3c967e=[],_0x36efab=[];_0x2210bd&&(_0xe0fe7e=JSON[_0x4af28e(0x181)](_0x2210bd));_0x52de75&&(_0x3c967e=JSON['parse'](_0x52de75));_0x18d4f8&&(_0x36efab=JSON[_0x4af28e(0x181)](_0x18d4f8));const _0x2c87b6=_0x3fbf87[_0x4af28e(0x176)]['startDate'],_0x964806=_0x3fbf87[_0x4af28e(0x176)][_0x4af28e(0x171)],{tickets:_0x1d233a,count:_0xe86f34,hasMore:_0x26d2f8}=await(0x0,ListTicketsService_1[_0x4af28e(0x19e)])({'searchParam':_0x142ac2,'tags':_0x3c967e,'users':_0x36efab,'pageNumber':_0x44d09e,'status':_0x23e119,'date':_0x2b31e3,'updatedAt':_0x52848f,'showAll':_0x82cf99,'userId':_0x20a23c,'queueIds':_0xe0fe7e,'withUnreadMessages':_0x39bc89,'companyId':_0x42cd54,'startDate':_0x2c87b6,'endDate':_0x964806});return _0x892a27[_0x4af28e(0x16c)](0xc8)[_0x4af28e(0x18d)]({'tickets':_0x1d233a,'count':_0xe86f34,'hasMore':_0x26d2f8});};exports['index']=index;const store=async(_0x47c999,_0x1082a0)=>{const _0x9df37c=a40_0x587503,{contactId:_0x4f1bfd,status:_0x3ba8b9,userId:_0x1fa2b9,queueId:_0x4c2eb4,whatsappId:_0x48705b}=_0x47c999['body'],{companyId:_0x479eca,id:_0x162d62}=_0x47c999[_0x9df37c(0x19b)],_0x321268=await Ticket_1[_0x9df37c(0x19e)][_0x9df37c(0x196)]({'where':{'userId':_0x162d62,'status':_0x9df37c(0x16a),'companyId':_0x479eca}}),{limitAttendance:_0x531fda,name:_0x57815f}=await User_1['default'][_0x9df37c(0x175)](_0x162d62);if(_0x321268>=_0x531fda){}const _0x4d48e1=await(0x0,CreateTicketService_1[_0x9df37c(0x19e)])({'contactId':_0x4f1bfd,'status':_0x3ba8b9,'userId':_0x1fa2b9,'companyId':_0x479eca,'queueId':_0x4c2eb4,'whatsappId':_0x48705b}),_0x377ebb=(0x0,socket_1[_0x9df37c(0x17d)])();return _0x377ebb['to']('company-'+_0x4d48e1[_0x9df37c(0x179)]+'-'+_0x4d48e1[_0x9df37c(0x16c)])['to']('queue-'+_0x4d48e1[_0x9df37c(0x195)]+'-'+_0x4d48e1[_0x9df37c(0x16c)])[_0x9df37c(0x173)](_0x9df37c(0x165)+_0x479eca+_0x9df37c(0x174),{'action':_0x9df37c(0x185),'ticket':_0x4d48e1}),_0x1082a0[_0x9df37c(0x16c)](0xc8)[_0x9df37c(0x18d)](_0x4d48e1);};exports[a40_0x587503(0x194)]=store;const kanban=async(_0x4638aa,_0x3784cb)=>{const _0x553be8=a40_0x587503,{pageNumber:_0x770f98,status:_0x19a561,date:_0x7a1082,updatedAt:_0x468ab4,searchParam:_0x349094,showAll:_0x55643d,queueIds:_0x3d1042,tags:_0x487dc2,users:_0x1f4a55,withUnreadMessages:_0x38021f}=_0x4638aa[_0x553be8(0x176)],_0x1df718=_0x4638aa['user']['id'],{companyId:_0x3e5931}=_0x4638aa[_0x553be8(0x19b)];let _0x33e6d1=[],_0x5fc416=[],_0x48b6e4=[];_0x3d1042&&(_0x33e6d1=JSON[_0x553be8(0x181)](_0x3d1042));_0x487dc2&&(_0x5fc416=JSON[_0x553be8(0x181)](_0x487dc2));_0x1f4a55&&(_0x48b6e4=JSON['parse'](_0x1f4a55));const {tickets:_0x22b9f7,count:_0x51cc6d,hasMore:_0x54e7d5}=await(0x0,ListTicketsServiceKanban_1[_0x553be8(0x19e)])({'searchParam':_0x349094,'tags':_0x5fc416,'users':_0x48b6e4,'pageNumber':_0x770f98,'status':_0x19a561,'date':_0x7a1082,'updatedAt':_0x468ab4,'showAll':_0x55643d,'userId':_0x1df718,'queueIds':_0x33e6d1,'withUnreadMessages':_0x38021f,'companyId':_0x3e5931});return _0x3784cb['status'](0xc8)[_0x553be8(0x18d)]({'tickets':_0x22b9f7,'count':_0x51cc6d,'hasMore':_0x54e7d5});};exports[a40_0x587503(0x198)]=kanban;const show=async(_0x412a0b,_0x37c0cf)=>{const _0x214322=a40_0x587503,{ticketId:_0xfee4d1}=_0x412a0b[_0x214322(0x191)],{companyId:_0x5c4449}=_0x412a0b[_0x214322(0x19b)],_0x1ca630=await(0x0,ShowTicketService_1['default'])(_0xfee4d1,_0x5c4449);return _0x37c0cf[_0x214322(0x16c)](0xc8)[_0x214322(0x18d)](_0x1ca630);};exports[a40_0x587503(0x19a)]=show;const showFromUUID=async(_0x3fd809,_0x56869e)=>{const _0x2c8389=a40_0x587503,{uuid:_0x2d96c6}=_0x3fd809[_0x2c8389(0x191)],_0x3f2775=await(0x0,ShowTicketFromUUIDService_1[_0x2c8389(0x19e)])(_0x2d96c6);return _0x56869e[_0x2c8389(0x16c)](0xc8)[_0x2c8389(0x18d)](_0x3f2775);};exports['showFromUUID']=showFromUUID;const closeAll=async(_0x414b72,_0x2ba038)=>{const _0x4bffeb=a40_0x587503,{companyId:_0x55aeda}=_0x414b72[_0x4bffeb(0x19b)];var _0x157e39=_0x414b72[_0x4bffeb(0x16f)][_0x4bffeb(0x16c)],_0x413e39=await Ticket_1[_0x4bffeb(0x19e)][_0x4bffeb(0x172)]({'where':{'companyId':_0x55aeda,'status':_0x157e39}});for(const _0x34e6e3 of _0x413e39){(0x0,UpdateTicketService_1[_0x4bffeb(0x19e)])({'ticketData':{'status':_0x4bffeb(0x189),'userId':_0x34e6e3['userId']||null,'queueId':_0x34e6e3[_0x4bffeb(0x195)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x34e6e3['id'],'companyId':_0x55aeda});}return _0x2ba038[_0x4bffeb(0x16c)](0xc8)[_0x4bffeb(0x18d)]({'message':_0x4bffeb(0x16e)});};exports['closeAll']=closeAll;function a40_0x4772(_0x3afc28,_0xad1377){const _0x38227e=a40_0x75f4();return a40_0x4772=function(_0xdfe97d,_0x43a550){_0xdfe97d=_0xdfe97d-0x163;let _0x75f480=_0x38227e[_0xdfe97d];return _0x75f480;},a40_0x4772(_0x3afc28,_0xad1377);}const update=async(_0x1ff5aa,_0x203705)=>{const _0x5ecf1c=a40_0x587503,{ticketId:_0x3c2615}=_0x1ff5aa[_0x5ecf1c(0x191)],_0x3a5e88=_0x1ff5aa[_0x5ecf1c(0x16f)],{companyId:_0x2b13e9,id:_0x4da507}=_0x1ff5aa[_0x5ecf1c(0x19b)],_0x18b8d5=await Ticket_1['default']['count']({'where':{'userId':_0x4da507,'status':_0x5ecf1c(0x16a),'companyId':_0x2b13e9}}),{limitAttendance:_0x4084ae,name:_0x266ea2}=await User_1[_0x5ecf1c(0x19e)][_0x5ecf1c(0x175)](_0x4da507);if(_0x3a5e88[_0x5ecf1c(0x16c)]===_0x5ecf1c(0x16a)&&_0x18b8d5>=_0x4084ae){}const _0x175ea3=new async_mutex_1[(_0x5ecf1c(0x17c))](),{ticket:_0x2dcbc1}=await _0x175ea3[_0x5ecf1c(0x188)](async()=>{const _0x7bbf3b=_0x5ecf1c;return await(0x0,UpdateTicketService_1['default'])({'ticketData':_0x1ff5aa[_0x7bbf3b(0x16f)],'ticketId':_0x3c2615,'companyId':_0x2b13e9,'tokenData':_0x1ff5aa[_0x7bbf3b(0x168)]});});return _0x203705[_0x5ecf1c(0x16c)](0xc8)[_0x5ecf1c(0x18d)](_0x2dcbc1);};exports[a40_0x587503(0x185)]=update;const remove=async(_0x230773,_0x25498d)=>{const _0x40f928=a40_0x587503,{ticketId:_0x155b22}=_0x230773[_0x40f928(0x191)],{companyId:_0xb2bf6e}=_0x230773[_0x40f928(0x19b)];await(0x0,ShowTicketService_1[_0x40f928(0x19e)])(_0x155b22,_0xb2bf6e);const _0xe608c7=await(0x0,DeleteTicketService_1['default'])(_0x155b22),_0x39a9b1=(0x0,socket_1['getIO'])();return _0x39a9b1['to'](_0x40f928(0x165)+_0xb2bf6e+'-'+_0xe608c7['status'])['to'](_0x155b22)['to'](_0x40f928(0x163)+_0xe608c7[_0x40f928(0x195)]+_0x40f928(0x180))['to'](_0x40f928(0x163)+_0xe608c7[_0x40f928(0x195)]+'-'+_0xe608c7[_0x40f928(0x16c)])['to']('company-'+_0xe608c7[_0x40f928(0x179)]+_0x40f928(0x180))[_0x40f928(0x173)]('company-'+_0xb2bf6e+_0x40f928(0x174),{'action':_0x40f928(0x199),'ticketId':+_0x155b22}),_0x25498d[_0x40f928(0x16c)](0xc8)['json']({'message':_0x40f928(0x16d)});};exports['remove']=remove;