const a38_0x3159c7=a38_0x33fa;function a38_0x5b3f(){const _0x67eb4=['async-mutex','178365jIRTuB','-notification','Mutex','true','update','remove','apply','../services/TicketServices/ShowTicketFromUUIDService','params','tokenData','userId','user','queueId','__importDefault','delete','130fAJfte','16vPtoqG','default','company-','2874018RiEdjt','72260FtKTmW','store','show','closed','../libs/socket','emit','kanban','__esModule','../services/TicketServices/DeleteTicketService','runExclusive','../services/TicketServices/CreateTicketService','(((.+)+)+)+$','index','1180161JxRXmz','closeAll','2780412lFYTMi','ticket\x20deleted','open','findOpenTicketByContactId','findOne','-ticket','sequelize','../services/TicketServices/ShowTicketService','query','status','showFromUUID','4vCNDvd','parse','getIO','4175755wseZzA','constructor','../services/TicketServices/ListTicketsServiceKanban','json','toString','queue-','body','5245400qvAiFA'];a38_0x5b3f=function(){return _0x67eb4;};return a38_0x5b3f();}(function(_0x126f5b,_0x105c1d){const _0x42720f=a38_0x33fa,_0x277053=_0x126f5b();while(!![]){try{const _0x25bd42=-parseInt(_0x42720f(0x1bd))/0x1*(parseInt(_0x42720f(0x1b9))/0x2)+parseInt(_0x42720f(0x1e3))/0x3+parseInt(_0x42720f(0x1d7))/0x4*(-parseInt(_0x42720f(0x1da))/0x5)+parseInt(_0x42720f(0x1cc))/0x6+parseInt(_0x42720f(0x1bc))/0x7+-parseInt(_0x42720f(0x1e1))/0x8+-parseInt(_0x42720f(0x1ca))/0x9*(-parseInt(_0x42720f(0x1b8))/0xa);if(_0x25bd42===_0x105c1d)break;else _0x277053['push'](_0x277053['shift']());}catch(_0x2eff24){_0x277053['push'](_0x277053['shift']());}}}(a38_0x5b3f,0x8af72));const a38_0x79775e=(function(){let _0x43a12e=!![];return function(_0x235f06,_0x8da9cd){const _0x2a7a7b=_0x43a12e?function(){const _0x394819=a38_0x33fa;if(_0x8da9cd){const _0x55cbf3=_0x8da9cd[_0x394819(0x1af)](_0x235f06,arguments);return _0x8da9cd=null,_0x55cbf3;}}:function(){};return _0x43a12e=![],_0x2a7a7b;};}()),a38_0x2e1642=a38_0x79775e(this,function(){const _0x523ec3=a38_0x33fa;return a38_0x2e1642['toString']()['search'](_0x523ec3(0x1c8))[_0x523ec3(0x1de)]()[_0x523ec3(0x1db)](a38_0x2e1642)['search'](_0x523ec3(0x1c8));});a38_0x2e1642();'use strict';var __importDefault=this&&this[a38_0x3159c7(0x1b6)]||function(_0x4c573f){const _0x3fc965=a38_0x3159c7;return _0x4c573f&&_0x4c573f[_0x3fc965(0x1c4)]?_0x4c573f:{'default':_0x4c573f};};Object['defineProperty'](exports,a38_0x3159c7(0x1c4),{'value':!![]}),exports['remove']=exports[a38_0x3159c7(0x1ad)]=exports[a38_0x3159c7(0x1cb)]=exports[a38_0x3159c7(0x1d6)]=exports[a38_0x3159c7(0x1bf)]=exports[a38_0x3159c7(0x1be)]=exports[a38_0x3159c7(0x1cf)]=exports[a38_0x3159c7(0x1c3)]=exports['index']=void 0x0;const async_mutex_1=require(a38_0x3159c7(0x1e2)),socket_1=require(a38_0x3159c7(0x1c1)),Ticket_1=__importDefault(require('../models/Ticket')),sequelize_1=require(a38_0x3159c7(0x1d2)),CreateTicketService_1=__importDefault(require(a38_0x3159c7(0x1c7))),DeleteTicketService_1=__importDefault(require(a38_0x3159c7(0x1c5))),ListTicketsService_1=__importDefault(require('../services/TicketServices/ListTicketsService')),ShowTicketFromUUIDService_1=__importDefault(require(a38_0x3159c7(0x1b0))),ShowTicketService_1=__importDefault(require(a38_0x3159c7(0x1d3))),UpdateTicketService_1=__importDefault(require('../services/TicketServices/UpdateTicketService')),ListTicketsServiceKanban_1=__importDefault(require(a38_0x3159c7(0x1dc))),updateMutex=new async_mutex_1[(a38_0x3159c7(0x1ab))](),index=async(_0x311218,_0x88b84d)=>{const _0x4ce019=a38_0x3159c7,{pageNumber:_0x4d5dd8,status:_0x3ad707,groups:_0x44eb69,date:_0x422495,updatedAt:_0x8eb8c4,isSearch:_0x285d13,searchParam:_0x5dbc2b,showAll:_0x41f282,queueIds:_0x4429d0,tags:_0x209eb3,users:_0x2f5d52,withUnreadMessages:_0x446706,notClosed:_0x21e72a,all:_0x3ef016}=_0x311218['query'],_0x25f373=_0x311218[_0x4ce019(0x1b4)]['id'],{companyId:_0x48cc1b}=_0x311218[_0x4ce019(0x1b4)];let _0x306885=[],_0x319c07=[],_0x3e1547=[];_0x4429d0&&(_0x306885=JSON[_0x4ce019(0x1d8)](_0x4429d0));_0x209eb3&&(_0x319c07=JSON[_0x4ce019(0x1d8)](_0x209eb3));_0x2f5d52&&(_0x3e1547=JSON[_0x4ce019(0x1d8)](_0x2f5d52));const {tickets:_0x4f7695,count:_0x5e39a8,hasMore:_0x384712}=await(0x0,ListTicketsService_1[_0x4ce019(0x1ba)])({'isSearch':_0x285d13===_0x4ce019(0x1ac),'searchParam':_0x5dbc2b,'tags':_0x319c07,'users':_0x3e1547,'pageNumber':_0x4d5dd8,'status':_0x3ad707,'groups':_0x44eb69,'date':_0x422495,'updatedAt':_0x8eb8c4,'showAll':_0x41f282,'userId':_0x25f373,'queueIds':_0x306885,'withUnreadMessages':_0x446706,'notClosed':!!_0x21e72a,'all':!!_0x3ef016,'companyId':_0x48cc1b});return _0x88b84d[_0x4ce019(0x1d5)](0xc8)[_0x4ce019(0x1dd)]({'tickets':_0x4f7695,'count':_0x5e39a8,'hasMore':_0x384712});};exports[a38_0x3159c7(0x1c9)]=index;const kanban=async(_0x323f7a,_0x1faef9)=>{const _0xd03849=a38_0x3159c7,{pageNumber:_0x237f89,status:_0x45a083,date:_0x467627,updatedAt:_0x4168f9,searchParam:_0x3a6645,showAll:_0x2ff619,queueIds:_0x3862b6,tags:_0x1f72b8,users:_0x70c0a0,withUnreadMessages:_0x5338b9}=_0x323f7a[_0xd03849(0x1d4)],_0x3ae322=_0x323f7a['user']['id'],{companyId:_0x3009dc}=_0x323f7a[_0xd03849(0x1b4)];let _0x327fda=[],_0x4d02ed=[],_0x375a6b=[];_0x3862b6&&(_0x327fda=JSON[_0xd03849(0x1d8)](_0x3862b6));_0x1f72b8&&(_0x4d02ed=JSON['parse'](_0x1f72b8));_0x70c0a0&&(_0x375a6b=JSON[_0xd03849(0x1d8)](_0x70c0a0));const {tickets:_0x50f903,count:_0x5da98f,hasMore:_0x39b901}=await(0x0,ListTicketsServiceKanban_1[_0xd03849(0x1ba)])({'searchParam':_0x3a6645,'tags':_0x4d02ed,'users':_0x375a6b,'pageNumber':_0x237f89,'status':_0x45a083,'date':_0x467627,'updatedAt':_0x4168f9,'showAll':_0x2ff619,'userId':_0x3ae322,'queueIds':_0x327fda,'withUnreadMessages':_0x5338b9,'companyId':_0x3009dc});return _0x1faef9[_0xd03849(0x1d5)](0xc8)[_0xd03849(0x1dd)]({'tickets':_0x50f903,'count':_0x5da98f,'hasMore':_0x39b901});};exports[a38_0x3159c7(0x1c3)]=kanban;const findOpenTicketByContactId=async(_0x337796,_0xaf134a)=>{const _0x264fd3=a38_0x3159c7,_0x722420=await Ticket_1[_0x264fd3(0x1ba)][_0x264fd3(0x1d0)]({'where':{'contactId':_0x337796,'companyId':_0xaf134a,'status':{[sequelize_1['Op']['or']]:[_0x264fd3(0x1ce),'pending']}}});return _0x722420;};exports[a38_0x3159c7(0x1cf)]=findOpenTicketByContactId;const store=async(_0x34308d,_0x591c40)=>{const _0x16c82c=a38_0x3159c7,{contactId:_0x16a4a1,userId:_0xc8b8d7,queueId:_0x52ee38}=_0x34308d['body'],{companyId:_0x1915df}=_0x34308d[_0x16c82c(0x1b4)],_0x36b680=await(0x0,exports[_0x16c82c(0x1cf)])(_0x16a4a1,_0x1915df);if(_0x36b680)return _0x591c40[_0x16c82c(0x1d5)](0xc8)['json'](_0x36b680);const _0x28e981=await(0x0,CreateTicketService_1[_0x16c82c(0x1ba)])({'contactId':_0x16a4a1,'userId':_0xc8b8d7,'companyId':_0x1915df,'queueId':_0x52ee38}),_0x3bcb44=(0x0,socket_1[_0x16c82c(0x1d9)])();return _0x3bcb44['to'](_0x16c82c(0x1bb)+_0x1915df+'-'+_0x28e981['status'])['to'](_0x16c82c(0x1df)+_0x28e981['queueId']+'-'+_0x28e981[_0x16c82c(0x1d5)])[_0x16c82c(0x1c2)](_0x16c82c(0x1bb)+_0x1915df+_0x16c82c(0x1d1),{'action':'update','ticket':_0x28e981}),_0x591c40['status'](0xc8)['json'](_0x28e981);};exports['store']=store;const show=async(_0x543eab,_0x13bc2a)=>{const _0xd36fb9=a38_0x3159c7,{ticketId:_0x57b9cd}=_0x543eab[_0xd36fb9(0x1b1)],{companyId:_0x25b235}=_0x543eab[_0xd36fb9(0x1b4)],_0x444fc8=await(0x0,ShowTicketService_1['default'])(_0x57b9cd,_0x25b235);return _0x13bc2a[_0xd36fb9(0x1d5)](0xc8)[_0xd36fb9(0x1dd)](_0x444fc8);};function a38_0x33fa(_0x5da0e0,_0x100708){const _0x54df04=a38_0x5b3f();return a38_0x33fa=function(_0x2e1642,_0x79775e){_0x2e1642=_0x2e1642-0x1ab;let _0x5b3ff9=_0x54df04[_0x2e1642];return _0x5b3ff9;},a38_0x33fa(_0x5da0e0,_0x100708);}exports[a38_0x3159c7(0x1bf)]=show;const showFromUUID=async(_0x27dde7,_0x1dc292)=>{const _0x16616b=a38_0x3159c7,{uuid:_0x177b36}=_0x27dde7[_0x16616b(0x1b1)],_0x301050=await(0x0,ShowTicketFromUUIDService_1[_0x16616b(0x1ba)])(_0x177b36);return _0x1dc292[_0x16616b(0x1d5)](0xc8)[_0x16616b(0x1dd)](_0x301050);};exports['showFromUUID']=showFromUUID;const closeAll=async(_0x258473,_0x4991da)=>{const _0x5e92c3=a38_0x3159c7,{companyId:_0xc17dc6}=_0x258473[_0x5e92c3(0x1b4)];var _0x53aa26=_0x258473[_0x5e92c3(0x1e0)][_0x5e92c3(0x1d5)],_0x2e0d85=await Ticket_1[_0x5e92c3(0x1ba)]['findAll']({'where':{'companyId':_0xc17dc6,'status':_0x53aa26}});for(const _0x2d4cbd of _0x2e0d85){(0x0,UpdateTicketService_1[_0x5e92c3(0x1ba)])({'ticketData':{'status':_0x5e92c3(0x1c0),'userId':_0x2d4cbd[_0x5e92c3(0x1b3)]||null,'queueId':_0x2d4cbd[_0x5e92c3(0x1b5)]||null,'amountUsedBotQueues':0x0},'ticketId':_0x2d4cbd['id'],'companyId':_0xc17dc6});}return _0x4991da[_0x5e92c3(0x1d5)](0xc8)[_0x5e92c3(0x1dd)]({'message':'all\x20tickets\x20closed'});};exports[a38_0x3159c7(0x1cb)]=closeAll;const update=async(_0x378e56,_0x53fd6f)=>{const _0x305dbe=a38_0x3159c7,{ticketId:_0x221f60}=_0x378e56[_0x305dbe(0x1b1)],{ticket:_0x23037c}=await updateMutex[_0x305dbe(0x1c6)](async()=>{const _0x1d3ab7=_0x305dbe,_0x1ba13b=await(0x0,UpdateTicketService_1[_0x1d3ab7(0x1ba)])({'ticketData':_0x378e56[_0x1d3ab7(0x1e0)],'ticketId':Number['parseInt'](_0x221f60,0xa),'tokenData':_0x378e56[_0x1d3ab7(0x1b2)]});return _0x1ba13b;});return _0x53fd6f['status'](0xc8)[_0x305dbe(0x1dd)](_0x23037c);};exports['update']=update;const remove=async(_0x5ba08e,_0x4d7393)=>{const _0x19a1c6=a38_0x3159c7,{ticketId:_0x12dfff}=_0x5ba08e[_0x19a1c6(0x1b1)],{companyId:_0x36962e}=_0x5ba08e[_0x19a1c6(0x1b4)];await(0x0,ShowTicketService_1['default'])(_0x12dfff,_0x36962e);const _0x8f56cd=await(0x0,DeleteTicketService_1['default'])(_0x12dfff),_0x473eed=(0x0,socket_1[_0x19a1c6(0x1d9)])();return _0x473eed['to'](_0x12dfff)['to'](_0x19a1c6(0x1bb)+_0x36962e+'-'+_0x8f56cd['status'])['to'](_0x19a1c6(0x1bb)+_0x36962e+_0x19a1c6(0x1e4))['to'](_0x19a1c6(0x1df)+_0x8f56cd[_0x19a1c6(0x1b5)]+'-'+_0x8f56cd[_0x19a1c6(0x1d5)])['to'](_0x19a1c6(0x1df)+_0x8f56cd['queueId']+'-notification')['emit'](_0x19a1c6(0x1bb)+_0x36962e+'-ticket',{'action':_0x19a1c6(0x1b7),'ticketId':+_0x12dfff}),_0x4d7393[_0x19a1c6(0x1d5)](0xc8)[_0x19a1c6(0x1dd)]({'message':_0x19a1c6(0x1cd)});};exports[a38_0x3159c7(0x1ae)]=remove;