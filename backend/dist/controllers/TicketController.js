const a38_0x3b9fed=a38_0x14a1;(function(_0x1604f0,_0x3dfcc4){const _0x1b2508=a38_0x14a1,_0x51d8a7=_0x1604f0();while(!![]){try{const _0x3168c5=-parseInt(_0x1b2508(0x1f4))/0x1+parseInt(_0x1b2508(0x1cf))/0x2+-parseInt(_0x1b2508(0x1d5))/0x3*(parseInt(_0x1b2508(0x1c5))/0x4)+-parseInt(_0x1b2508(0x1c2))/0x5*(-parseInt(_0x1b2508(0x1cd))/0x6)+parseInt(_0x1b2508(0x1db))/0x7*(-parseInt(_0x1b2508(0x1e1))/0x8)+parseInt(_0x1b2508(0x1e5))/0x9*(parseInt(_0x1b2508(0x1dd))/0xa)+parseInt(_0x1b2508(0x1df))/0xb;if(_0x3168c5===_0x3dfcc4)break;else _0x51d8a7['push'](_0x51d8a7['shift']());}catch(_0x22fe0c){_0x51d8a7['push'](_0x51d8a7['shift']());}}}(a38_0x3613,0xaa8ef));const a38_0x1d140d=(function(){let _0x52efb1=!![];return function(_0x136430,_0x2bd574){const _0xbe2586=_0x52efb1?function(){const _0x242c95=a38_0x14a1;if(_0x2bd574){const _0x5b7220=_0x2bd574[_0x242c95(0x1e9)](_0x136430,arguments);return _0x2bd574=null,_0x5b7220;}}:function(){};return _0x52efb1=![],_0xbe2586;};}()),a38_0x443efc=a38_0x1d140d(this,function(){const _0x4061cb=a38_0x14a1;return a38_0x443efc[_0x4061cb(0x1d2)]()[_0x4061cb(0x1de)]('(((.+)+)+)+$')[_0x4061cb(0x1d2)]()[_0x4061cb(0x1ca)](a38_0x443efc)[_0x4061cb(0x1de)]('(((.+)+)+)+$');});a38_0x443efc();'use strict';var __importDefault=this&&this[a38_0x3b9fed(0x1e3)]||function(_0x2bb697){return _0x2bb697&&_0x2bb697['__esModule']?_0x2bb697:{'default':_0x2bb697};};Object[a38_0x3b9fed(0x1c9)](exports,'__esModule',{'value':!![]}),exports['remove']=exports[a38_0x3b9fed(0x1c4)]=exports[a38_0x3b9fed(0x1d9)]=exports[a38_0x3b9fed(0x1e6)]=exports[a38_0x3b9fed(0x1f7)]=exports[a38_0x3b9fed(0x1c1)]=exports[a38_0x3b9fed(0x1f3)]=exports[a38_0x3b9fed(0x1da)]=exports[a38_0x3b9fed(0x1d0)]=void 0x0;const async_mutex_1=require(a38_0x3b9fed(0x1f9)),socket_1=require('../libs/socket'),Ticket_1=__importDefault(require(a38_0x3b9fed(0x1d3))),sequelize_1=require('sequelize'),CreateTicketService_1=__importDefault(require('../services/TicketServices/CreateTicketService')),DeleteTicketService_1=__importDefault(require(a38_0x3b9fed(0x1fa))),ListTicketsService_1=__importDefault(require(a38_0x3b9fed(0x1c6))),ShowTicketFromUUIDService_1=__importDefault(require(a38_0x3b9fed(0x1d1))),ShowTicketService_1=__importDefault(require(a38_0x3b9fed(0x1ef))),UpdateTicketService_1=__importDefault(require(a38_0x3b9fed(0x1d6))),ListTicketsServiceKanban_1=__importDefault(require(a38_0x3b9fed(0x1e2))),updateMutex=new async_mutex_1[(a38_0x3b9fed(0x1ea))](),index=async(_0x20f76a,_0x25b828)=>{const _0x131168=a38_0x3b9fed,{pageNumber:_0x394ddc,status:_0x118b49,groups:_0x10198a,date:_0x46d352,updatedAt:_0x4cd9b6,isSearch:_0x13a634,searchParam:_0x3b486c,showAll:_0x5264fd,queueIds:_0xf14c7f,tags:_0x30077b,users:_0x4357ae,withUnreadMessages:_0x310403,notClosed:_0xf782e,all:_0x1d6c40}=_0x20f76a[_0x131168(0x1c7)],_0x5bc1d0=_0x20f76a[_0x131168(0x1eb)]['id'],{companyId:_0x18d44a}=_0x20f76a[_0x131168(0x1eb)];let _0x520104=[],_0x158d0c=[],_0x45450e=[];_0xf14c7f&&(_0x520104=JSON[_0x131168(0x1fb)](_0xf14c7f));_0x30077b&&(_0x158d0c=JSON[_0x131168(0x1fb)](_0x30077b));_0x4357ae&&(_0x45450e=JSON['parse'](_0x4357ae));const {tickets:_0x1cd1cb,count:_0x5b957c,hasMore:_0x3d89c7}=await(0x0,ListTicketsService_1[_0x131168(0x1e8)])({'isSearch':_0x13a634===_0x131168(0x1c3),'searchParam':_0x3b486c,'tags':_0x158d0c,'users':_0x45450e,'pageNumber':_0x394ddc,'status':_0x118b49,'groups':_0x10198a,'date':_0x46d352,'updatedAt':_0x4cd9b6,'showAll':_0x5264fd,'userId':_0x5bc1d0,'queueIds':_0x520104,'withUnreadMessages':_0x310403,'notClosed':!!_0xf782e,'all':!!_0x1d6c40,'companyId':_0x18d44a});return _0x25b828[_0x131168(0x1f8)](0xc8)[_0x131168(0x1e4)]({'tickets':_0x1cd1cb,'count':_0x5b957c,'hasMore':_0x3d89c7});};exports[a38_0x3b9fed(0x1d0)]=index;const kanban=async(_0x29dd4c,_0x47c5d8)=>{const _0x14e1a9=a38_0x3b9fed,{pageNumber:_0x4a25e1,status:_0x386a2f,date:_0x30890d,updatedAt:_0x1d28ee,searchParam:_0x2017bd,showAll:_0x321f09,queueIds:_0xc3a797,tags:_0x40b4d8,users:_0x3ca9a3,withUnreadMessages:_0x3da719}=_0x29dd4c[_0x14e1a9(0x1c7)],_0x1c3531=_0x29dd4c[_0x14e1a9(0x1eb)]['id'],{companyId:_0x5d2dba}=_0x29dd4c[_0x14e1a9(0x1eb)];let _0x84eeef=[],_0x59d58d=[],_0x2c9e95=[];_0xc3a797&&(_0x84eeef=JSON[_0x14e1a9(0x1fb)](_0xc3a797));_0x40b4d8&&(_0x59d58d=JSON['parse'](_0x40b4d8));_0x3ca9a3&&(_0x2c9e95=JSON['parse'](_0x3ca9a3));const {tickets:_0x2ed980,count:_0x51ec1c,hasMore:_0x8ee7eb}=await(0x0,ListTicketsServiceKanban_1[_0x14e1a9(0x1e8)])({'searchParam':_0x2017bd,'tags':_0x59d58d,'users':_0x2c9e95,'pageNumber':_0x4a25e1,'status':_0x386a2f,'date':_0x30890d,'updatedAt':_0x1d28ee,'showAll':_0x321f09,'userId':_0x1c3531,'queueIds':_0x84eeef,'withUnreadMessages':_0x3da719,'companyId':_0x5d2dba});return _0x47c5d8[_0x14e1a9(0x1f8)](0xc8)[_0x14e1a9(0x1e4)]({'tickets':_0x2ed980,'count':_0x51ec1c,'hasMore':_0x8ee7eb});};exports[a38_0x3b9fed(0x1da)]=kanban;const findOpenTicketByContactId=async(_0x123a8d,_0xc8becd)=>{const _0x25ea5d=a38_0x3b9fed,_0x4ff014=await Ticket_1[_0x25ea5d(0x1e8)][_0x25ea5d(0x1f0)]({'where':{'contactId':_0x123a8d,'companyId':_0xc8becd,'status':{[sequelize_1['Op']['or']]:['open','pending']}}});return _0x4ff014;};exports[a38_0x3b9fed(0x1f3)]=findOpenTicketByContactId;const store=async(_0x33eaaf,_0x42629e)=>{const _0x337365=a38_0x3b9fed,{contactId:_0x28d453,userId:_0x504172,queueId:_0x2b7db3}=_0x33eaaf[_0x337365(0x1cc)],{companyId:_0x1d0633}=_0x33eaaf[_0x337365(0x1eb)],_0x436a80=await(0x0,exports[_0x337365(0x1f3)])(_0x28d453,_0x1d0633);if(_0x436a80)return _0x42629e['status'](0xc8)['json'](_0x436a80);const _0x36a804=await(0x0,CreateTicketService_1[_0x337365(0x1e8)])({'contactId':_0x28d453,'userId':_0x504172,'companyId':_0x1d0633,'queueId':_0x2b7db3}),_0x2ec49b=(0x0,socket_1[_0x337365(0x1ed)])();return _0x2ec49b['to'](_0x337365(0x1d7)+_0x1d0633+'-'+_0x36a804[_0x337365(0x1f8)])['to'](_0x337365(0x1d8)+_0x36a804['queueId']+'-'+_0x36a804['status'])[_0x337365(0x1cb)](_0x337365(0x1d7)+_0x1d0633+'-ticket',{'action':_0x337365(0x1c4),'ticket':_0x36a804}),_0x42629e[_0x337365(0x1f8)](0xc8)['json'](_0x36a804);};exports['store']=store;const show=async(_0x4c1acb,_0x195323)=>{const _0x16cbe0=a38_0x3b9fed,{ticketId:_0x4e7a05}=_0x4c1acb['params'],{companyId:_0xcacbfc}=_0x4c1acb[_0x16cbe0(0x1eb)],_0x267690=await(0x0,ShowTicketService_1[_0x16cbe0(0x1e8)])(_0x4e7a05,_0xcacbfc);return _0x195323[_0x16cbe0(0x1f8)](0xc8)[_0x16cbe0(0x1e4)](_0x267690);};exports['show']=show;const showFromUUID=async(_0x1f6e5f,_0x554ef9)=>{const _0x33a389=a38_0x3b9fed,{uuid:_0x25f614}=_0x1f6e5f['params'],_0x4f5a51=await(0x0,ShowTicketFromUUIDService_1[_0x33a389(0x1e8)])(_0x25f614);return _0x554ef9[_0x33a389(0x1f8)](0xc8)[_0x33a389(0x1e4)](_0x4f5a51);};exports[a38_0x3b9fed(0x1e6)]=showFromUUID;const closeAll=async(_0x175b53,_0x148af6)=>{const _0x2d618b=a38_0x3b9fed,{companyId:_0x40047a}=_0x175b53['user'];var _0xd4e66e=_0x175b53[_0x2d618b(0x1cc)][_0x2d618b(0x1f8)],_0x23060b=await Ticket_1[_0x2d618b(0x1e8)][_0x2d618b(0x1c8)]({'where':{'companyId':_0x40047a,'status':_0xd4e66e}});for(const _0x216a2a of _0x23060b){(0x0,UpdateTicketService_1[_0x2d618b(0x1e8)])({'ticketData':{'status':_0x2d618b(0x1f6),'userId':_0x216a2a['userId']||null,'queueId':_0x216a2a[_0x2d618b(0x1f5)]||null,'amountUsedBotQueues':0x0},'ticketId':_0x216a2a['id'],'companyId':_0x40047a});}return _0x148af6[_0x2d618b(0x1f8)](0xc8)[_0x2d618b(0x1e4)]({'message':_0x2d618b(0x1ce)});};exports[a38_0x3b9fed(0x1d9)]=closeAll;const update=async(_0x3de561,_0x1668f4)=>{const _0x1b9645=a38_0x3b9fed,{ticketId:_0x510d2d}=_0x3de561[_0x1b9645(0x1d4)],{ticket:_0x30f17d}=await updateMutex[_0x1b9645(0x1e0)](async()=>{const _0x101075=_0x1b9645,_0x5193f2=await(0x0,UpdateTicketService_1[_0x101075(0x1e8)])({'ticketData':_0x3de561['body'],'ticketId':Number[_0x101075(0x1ee)](_0x510d2d,0xa),'tokenData':_0x3de561[_0x101075(0x1f2)]});return _0x5193f2;});return _0x1668f4[_0x1b9645(0x1f8)](0xc8)[_0x1b9645(0x1e4)](_0x30f17d);};function a38_0x14a1(_0x3b5502,_0x52d668){const _0x1cc6f6=a38_0x3613();return a38_0x14a1=function(_0x443efc,_0x1d140d){_0x443efc=_0x443efc-0x1c1;let _0x36132c=_0x1cc6f6[_0x443efc];return _0x36132c;},a38_0x14a1(_0x3b5502,_0x52d668);}exports[a38_0x3b9fed(0x1c4)]=update;const remove=async(_0x2f04df,_0x794ced)=>{const _0x2940e9=a38_0x3b9fed,{ticketId:_0x271000}=_0x2f04df[_0x2940e9(0x1d4)],{companyId:_0x49897b}=_0x2f04df['user'];await(0x0,ShowTicketService_1[_0x2940e9(0x1e8)])(_0x271000,_0x49897b);const _0x13cfea=await(0x0,DeleteTicketService_1[_0x2940e9(0x1e8)])(_0x271000),_0x1191cb=(0x0,socket_1[_0x2940e9(0x1ed)])();return _0x1191cb['to'](_0x271000)['to'](_0x2940e9(0x1d7)+_0x49897b+'-'+_0x13cfea[_0x2940e9(0x1f8)])['to'](_0x2940e9(0x1d7)+_0x49897b+_0x2940e9(0x1ec))['to'](_0x2940e9(0x1d8)+_0x13cfea['queueId']+'-'+_0x13cfea[_0x2940e9(0x1f8)])['to']('queue-'+_0x13cfea['queueId']+_0x2940e9(0x1ec))[_0x2940e9(0x1cb)]('company-'+_0x49897b+_0x2940e9(0x1e7),{'action':_0x2940e9(0x1f1),'ticketId':+_0x271000}),_0x794ced[_0x2940e9(0x1f8)](0xc8)[_0x2940e9(0x1e4)]({'message':'ticket\x20deleted'});};function a38_0x3613(){const _0x100fe4=['parseInt','../services/TicketServices/ShowTicketService','findOne','delete','tokenData','findOpenTicketByContactId','710910NCIXcN','queueId','closed','show','status','async-mutex','../services/TicketServices/DeleteTicketService','parse','store','5xeXMvt','true','update','30620nZWoxX','../services/TicketServices/ListTicketsService','query','findAll','defineProperty','constructor','emit','body','7370718QzGoLU','all\x20tickets\x20closed','466086wSRfHh','index','../services/TicketServices/ShowTicketFromUUIDService','toString','../models/Ticket','params','426QJwTGm','../services/TicketServices/UpdateTicketService','company-','queue-','closeAll','kanban','5693485kPrPEn','remove','4310VwvCmr','search','14410737GwHcFc','runExclusive','8uyBIZe','../services/TicketServices/ListTicketsServiceKanban','__importDefault','json','11241HdWtUc','showFromUUID','-ticket','default','apply','Mutex','user','-notification','getIO'];a38_0x3613=function(){return _0x100fe4;};return a38_0x3613();}exports[a38_0x3b9fed(0x1dc)]=remove;