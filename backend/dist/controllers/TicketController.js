const a40_0x301353=a40_0x11df;(function(_0x1e938e,_0x32efea){const _0x27435b=a40_0x11df,_0x558890=_0x1e938e();while(!![]){try{const _0x43e1fd=-parseInt(_0x27435b(0x1df))/0x1+-parseInt(_0x27435b(0x206))/0x2*(-parseInt(_0x27435b(0x204))/0x3)+-parseInt(_0x27435b(0x1e5))/0x4+-parseInt(_0x27435b(0x1f0))/0x5+-parseInt(_0x27435b(0x212))/0x6+parseInt(_0x27435b(0x207))/0x7*(parseInt(_0x27435b(0x1ff))/0x8)+-parseInt(_0x27435b(0x217))/0x9*(-parseInt(_0x27435b(0x1dd))/0xa);if(_0x43e1fd===_0x32efea)break;else _0x558890['push'](_0x558890['shift']());}catch(_0x142458){_0x558890['push'](_0x558890['shift']());}}}(a40_0x5bd3,0x6d600));const a40_0x28e9cc=(function(){let _0x5172c5=!![];return function(_0xaa50fb,_0x35432e){const _0x3f2828=_0x5172c5?function(){const _0xf9bd06=a40_0x11df;if(_0x35432e){const _0x2c49b0=_0x35432e[_0xf9bd06(0x213)](_0xaa50fb,arguments);return _0x35432e=null,_0x2c49b0;}}:function(){};return _0x5172c5=![],_0x3f2828;};}()),a40_0x4d3264=a40_0x28e9cc(this,function(){const _0x33c27c=a40_0x11df;return a40_0x4d3264['toString']()[_0x33c27c(0x20e)](_0x33c27c(0x201))[_0x33c27c(0x215)]()[_0x33c27c(0x20b)](a40_0x4d3264)['search'](_0x33c27c(0x201));});a40_0x4d3264();'use strict';var __importDefault=this&&this[a40_0x301353(0x1fe)]||function(_0x1dfe26){const _0x5dc0cc=a40_0x301353;return _0x1dfe26&&_0x1dfe26[_0x5dc0cc(0x1fa)]?_0x1dfe26:{'default':_0x1dfe26};};Object[a40_0x301353(0x1e1)](exports,'__esModule',{'value':!![]}),exports[a40_0x301353(0x1ef)]=exports[a40_0x301353(0x1f6)]=exports['closeAll']=exports[a40_0x301353(0x1ed)]=exports[a40_0x301353(0x200)]=exports['kanban']=exports[a40_0x301353(0x20d)]=exports[a40_0x301353(0x1e9)]=void 0x0;const socket_1=require(a40_0x301353(0x1f7)),Ticket_1=__importDefault(require(a40_0x301353(0x20f))),CreateTicketService_1=__importDefault(require('../services/TicketServices/CreateTicketService')),DeleteTicketService_1=__importDefault(require(a40_0x301353(0x20a))),ListTicketsService_1=__importDefault(require(a40_0x301353(0x208))),ShowTicketFromUUIDService_1=__importDefault(require(a40_0x301353(0x1ea))),ShowTicketService_1=__importDefault(require(a40_0x301353(0x1ec))),UpdateTicketService_1=__importDefault(require(a40_0x301353(0x1f2))),ListTicketsServiceKanban_1=__importDefault(require(a40_0x301353(0x20c))),async_mutex_1=require(a40_0x301353(0x1eb)),User_1=__importDefault(require(a40_0x301353(0x1f3))),index=async(_0x627b5b,_0x47e237)=>{const _0x347c91=a40_0x301353,{pageNumber:_0x11400b,status:_0x18cf4b,date:_0x56ebb7,updatedAt:_0x4e889e,searchParam:_0x142e08,showAll:_0x40529f,queueIds:_0x766fd5,tags:_0xae18a6,users:_0x324831,withUnreadMessages:_0x1b1c85}=_0x627b5b['query'],_0x482464=_0x627b5b[_0x347c91(0x1e2)]['id'],{companyId:_0x4d7b7c}=_0x627b5b[_0x347c91(0x1e2)];let _0x4f07bf=[],_0x39108f=[],_0x307449=[];_0x766fd5&&(_0x4f07bf=JSON[_0x347c91(0x216)](_0x766fd5));_0xae18a6&&(_0x39108f=JSON[_0x347c91(0x216)](_0xae18a6));_0x324831&&(_0x307449=JSON[_0x347c91(0x216)](_0x324831));const _0x1ac51c=_0x627b5b[_0x347c91(0x1ee)][_0x347c91(0x1fd)],_0x34e8c7=_0x627b5b['query']['endDate'],{tickets:_0x1f520a,count:_0x334311,hasMore:_0x2e53db}=await(0x0,ListTicketsService_1['default'])({'searchParam':_0x142e08,'tags':_0x39108f,'users':_0x307449,'pageNumber':_0x11400b,'status':_0x18cf4b,'date':_0x56ebb7,'updatedAt':_0x4e889e,'showAll':_0x40529f,'userId':_0x482464,'queueIds':_0x4f07bf,'withUnreadMessages':_0x1b1c85,'companyId':_0x4d7b7c,'startDate':_0x1ac51c,'endDate':_0x34e8c7});return _0x47e237[_0x347c91(0x1e4)](0xc8)['json']({'tickets':_0x1f520a,'count':_0x334311,'hasMore':_0x2e53db});};exports[a40_0x301353(0x1e9)]=index;const store=async(_0x58dc96,_0x3c0bb7)=>{const _0x33acd5=a40_0x301353,{contactId:_0x14c4ca,status:_0x36fbce,userId:_0x25b365,queueId:_0x5d6917,whatsappId:_0x4e4b82}=_0x58dc96['body'],{companyId:_0x4b52f1,id:_0x4db901}=_0x58dc96[_0x33acd5(0x1e2)],_0xb633c7=await Ticket_1[_0x33acd5(0x1e3)][_0x33acd5(0x1fb)]({'where':{'userId':_0x4db901,'status':'open','companyId':_0x4b52f1}}),{limitAttendance:_0x146cc4,name:_0x375955}=await User_1[_0x33acd5(0x1e3)][_0x33acd5(0x218)](_0x4db901);if(_0xb633c7>=_0x146cc4){}const _0x20d416=await(0x0,CreateTicketService_1[_0x33acd5(0x1e3)])({'contactId':_0x14c4ca,'status':_0x36fbce,'userId':_0x25b365,'companyId':_0x4b52f1,'queueId':_0x5d6917,'whatsappId':_0x4e4b82}),_0x2ff45e=(0x0,socket_1[_0x33acd5(0x1de)])();return _0x2ff45e['to'](_0x33acd5(0x203)+_0x20d416[_0x33acd5(0x1fc)]+'-'+_0x20d416[_0x33acd5(0x1e4)])['to'](_0x33acd5(0x1f1)+_0x20d416[_0x33acd5(0x205)]+'-'+_0x20d416[_0x33acd5(0x1e4)])[_0x33acd5(0x1f5)]('company-'+_0x4b52f1+_0x33acd5(0x219),{'action':_0x33acd5(0x1f6),'ticket':_0x20d416}),_0x3c0bb7[_0x33acd5(0x1e4)](0xc8)[_0x33acd5(0x1e0)](_0x20d416);};exports['store']=store;const kanban=async(_0x5e1ffc,_0x412a99)=>{const _0x584a65=a40_0x301353,{pageNumber:_0x155455,status:_0x524636,date:_0x594a78,updatedAt:_0x576189,searchParam:_0x30dcb1,showAll:_0x2abeae,queueIds:_0x7f32d0,tags:_0x23f414,users:_0x267ea4,withUnreadMessages:_0x2bac19}=_0x5e1ffc[_0x584a65(0x1ee)],_0x3406be=_0x5e1ffc['user']['id'],{companyId:_0x3b2542}=_0x5e1ffc[_0x584a65(0x1e2)];let _0x27af71=[],_0x459985=[],_0x1d2195=[];_0x7f32d0&&(_0x27af71=JSON['parse'](_0x7f32d0));_0x23f414&&(_0x459985=JSON[_0x584a65(0x216)](_0x23f414));_0x267ea4&&(_0x1d2195=JSON[_0x584a65(0x216)](_0x267ea4));const {tickets:_0x21b1e6,count:_0x52e1a1,hasMore:_0x7273c7}=await(0x0,ListTicketsServiceKanban_1[_0x584a65(0x1e3)])({'searchParam':_0x30dcb1,'tags':_0x459985,'users':_0x1d2195,'pageNumber':_0x155455,'status':_0x524636,'date':_0x594a78,'updatedAt':_0x576189,'showAll':_0x2abeae,'userId':_0x3406be,'queueIds':_0x27af71,'withUnreadMessages':_0x2bac19,'companyId':_0x3b2542});return _0x412a99[_0x584a65(0x1e4)](0xc8)[_0x584a65(0x1e0)]({'tickets':_0x21b1e6,'count':_0x52e1a1,'hasMore':_0x7273c7});};exports[a40_0x301353(0x211)]=kanban;const show=async(_0x3cf11b,_0x5ae088)=>{const _0x42865b=a40_0x301353,{ticketId:_0x292763}=_0x3cf11b[_0x42865b(0x1e8)],{companyId:_0x42ed01}=_0x3cf11b['user'],_0xa0bf29=await(0x0,ShowTicketService_1[_0x42865b(0x1e3)])(_0x292763,_0x42ed01);return _0x5ae088['status'](0xc8)[_0x42865b(0x1e0)](_0xa0bf29);};exports[a40_0x301353(0x200)]=show;const showFromUUID=async(_0x1bab2b,_0x2ab31d)=>{const _0x4cd120=a40_0x301353,{uuid:_0x5eae8c}=_0x1bab2b[_0x4cd120(0x1e8)],_0x1a8289=await(0x0,ShowTicketFromUUIDService_1[_0x4cd120(0x1e3)])(_0x5eae8c);return _0x2ab31d[_0x4cd120(0x1e4)](0xc8)[_0x4cd120(0x1e0)](_0x1a8289);};exports[a40_0x301353(0x1ed)]=showFromUUID;function a40_0x11df(_0x55152f,_0x4473fd){const _0x2a8dc3=a40_0x5bd3();return a40_0x11df=function(_0x4d3264,_0x28e9cc){_0x4d3264=_0x4d3264-0x1dd;let _0x5bd323=_0x2a8dc3[_0x4d3264];return _0x5bd323;},a40_0x11df(_0x55152f,_0x4473fd);}const closeAll=async(_0x4eadc1,_0x2a5e43)=>{const _0x528d00=a40_0x301353,{companyId:_0x2ae8b2}=_0x4eadc1[_0x528d00(0x1e2)];var _0x377ec4=_0x4eadc1['body'][_0x528d00(0x1e4)],_0xebedca=await Ticket_1['default']['findAll']({'where':{'companyId':_0x2ae8b2,'status':_0x377ec4}});for(const _0x4b8b8c of _0xebedca){(0x0,UpdateTicketService_1[_0x528d00(0x1e3)])({'ticketData':{'status':_0x528d00(0x202),'userId':_0x4b8b8c['userId']||null,'queueId':_0x4b8b8c[_0x528d00(0x205)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x4b8b8c['id'],'companyId':_0x2ae8b2});}return _0x2a5e43['status'](0xc8)[_0x528d00(0x1e0)]({'message':_0x528d00(0x210)});};exports[a40_0x301353(0x1e6)]=closeAll;function a40_0x5bd3(){const _0x1637f2=['json','defineProperty','user','default','status','1137628FwrzCy','closeAll','tokenData','params','index','../services/TicketServices/ShowTicketFromUUIDService','async-mutex','../services/TicketServices/ShowTicketService','showFromUUID','query','remove','2042105LqjnWl','queue-','../services/TicketServices/UpdateTicketService','../models/User','body','emit','update','../libs/socket','open','delete','__esModule','count','companyId','startDate','__importDefault','1254840zvnPEZ','show','(((.+)+)+)+$','closed','company-','111606zosiCE','queueId','44qVuvKf','21WLygmD','../services/TicketServices/ListTicketsService','-notification','../services/TicketServices/DeleteTicketService','constructor','../services/TicketServices/ListTicketsServiceKanban','store','search','../models/Ticket','all\x20tickets\x20closed','kanban','4713444hwQGuI','apply','Mutex','toString','parse','6114879lXPKIk','findByPk','-ticket','10ZvXOFk','getIO','42038BfuLdN'];a40_0x5bd3=function(){return _0x1637f2;};return a40_0x5bd3();}const update=async(_0x121b71,_0x59e7a1)=>{const _0x1056c8=a40_0x301353,{ticketId:_0x5afc29}=_0x121b71[_0x1056c8(0x1e8)],_0x4d70a2=_0x121b71['body'],{companyId:_0x115233,id:_0x38dd54}=_0x121b71[_0x1056c8(0x1e2)],_0x319dbf=await Ticket_1[_0x1056c8(0x1e3)][_0x1056c8(0x1fb)]({'where':{'userId':_0x38dd54,'status':_0x1056c8(0x1f8),'companyId':_0x115233}}),{limitAttendance:_0x21e33d,name:_0x2baed2}=await User_1[_0x1056c8(0x1e3)][_0x1056c8(0x218)](_0x38dd54);if(_0x4d70a2[_0x1056c8(0x1e4)]===_0x1056c8(0x1f8)&&_0x319dbf>=_0x21e33d){}const _0x10f16a=new async_mutex_1[(_0x1056c8(0x214))](),{ticket:_0x49e947}=await _0x10f16a['runExclusive'](async()=>{const _0xd431ad=_0x1056c8;return await(0x0,UpdateTicketService_1[_0xd431ad(0x1e3)])({'ticketData':_0x121b71[_0xd431ad(0x1f4)],'ticketId':_0x5afc29,'companyId':_0x115233,'tokenData':_0x121b71[_0xd431ad(0x1e7)]});});return _0x59e7a1[_0x1056c8(0x1e4)](0xc8)[_0x1056c8(0x1e0)](_0x49e947);};exports[a40_0x301353(0x1f6)]=update;const remove=async(_0x2ab569,_0x2ac28d)=>{const _0x20ee7d=a40_0x301353,{ticketId:_0x1ac50b}=_0x2ab569[_0x20ee7d(0x1e8)],{companyId:_0x4632ab}=_0x2ab569[_0x20ee7d(0x1e2)];await(0x0,ShowTicketService_1[_0x20ee7d(0x1e3)])(_0x1ac50b,_0x4632ab);const _0x268b4b=await(0x0,DeleteTicketService_1[_0x20ee7d(0x1e3)])(_0x1ac50b),_0x2535db=(0x0,socket_1[_0x20ee7d(0x1de)])();return _0x2535db['to'](_0x20ee7d(0x203)+_0x4632ab+'-'+_0x268b4b[_0x20ee7d(0x1e4)])['to'](_0x1ac50b)['to'](_0x20ee7d(0x1f1)+_0x268b4b[_0x20ee7d(0x205)]+'-notification')['to']('queue-'+_0x268b4b[_0x20ee7d(0x205)]+'-'+_0x268b4b[_0x20ee7d(0x1e4)])['to'](_0x20ee7d(0x203)+_0x268b4b[_0x20ee7d(0x1fc)]+_0x20ee7d(0x209))[_0x20ee7d(0x1f5)]('company-'+_0x4632ab+_0x20ee7d(0x219),{'action':_0x20ee7d(0x1f9),'ticketId':+_0x1ac50b}),_0x2ac28d[_0x20ee7d(0x1e4)](0xc8)['json']({'message':'ticket\x20deleted'});};exports[a40_0x301353(0x1ef)]=remove;