const a38_0x2c64c1=a38_0x4cc6;(function(_0x1c5e43,_0x19f2d0){const _0x1c742a=a38_0x4cc6,_0x14f780=_0x1c5e43();while(!![]){try{const _0xd2c4ff=-parseInt(_0x1c742a(0xe3))/0x1+parseInt(_0x1c742a(0xfc))/0x2*(-parseInt(_0x1c742a(0xf0))/0x3)+parseInt(_0x1c742a(0x106))/0x4*(parseInt(_0x1c742a(0xe4))/0x5)+-parseInt(_0x1c742a(0xfe))/0x6*(parseInt(_0x1c742a(0xed))/0x7)+-parseInt(_0x1c742a(0xe1))/0x8*(-parseInt(_0x1c742a(0xf6))/0x9)+-parseInt(_0x1c742a(0xd8))/0xa*(-parseInt(_0x1c742a(0xe9))/0xb)+-parseInt(_0x1c742a(0xe5))/0xc*(-parseInt(_0x1c742a(0x111))/0xd);if(_0xd2c4ff===_0x19f2d0)break;else _0x14f780['push'](_0x14f780['shift']());}catch(_0x1a46df){_0x14f780['push'](_0x14f780['shift']());}}}(a38_0x43fa,0xae1af));const a38_0x3cb8a1=(function(){let _0x5e3523=!![];return function(_0x245e9b,_0x5a35e2){const _0x979390=_0x5e3523?function(){if(_0x5a35e2){const _0x1baa80=_0x5a35e2['apply'](_0x245e9b,arguments);return _0x5a35e2=null,_0x1baa80;}}:function(){};return _0x5e3523=![],_0x979390;};}()),a38_0x3c191f=a38_0x3cb8a1(this,function(){const _0x57eab7=a38_0x4cc6;return a38_0x3c191f[_0x57eab7(0xe8)]()[_0x57eab7(0xdd)](_0x57eab7(0x103))[_0x57eab7(0xe8)]()[_0x57eab7(0x112)](a38_0x3c191f)[_0x57eab7(0xdd)](_0x57eab7(0x103));});a38_0x3c191f();'use strict';var __importDefault=this&&this[a38_0x2c64c1(0xe2)]||function(_0x5db254){return _0x5db254&&_0x5db254['__esModule']?_0x5db254:{'default':_0x5db254};};Object[a38_0x2c64c1(0xfd)](exports,a38_0x2c64c1(0xeb),{'value':!![]}),exports[a38_0x2c64c1(0xfb)]=exports[a38_0x2c64c1(0xef)]=exports[a38_0x2c64c1(0x102)]=exports[a38_0x2c64c1(0xe7)]=exports[a38_0x2c64c1(0xdb)]=exports[a38_0x2c64c1(0x10d)]=exports['findOpenTicketByContactId']=exports[a38_0x2c64c1(0xec)]=exports[a38_0x2c64c1(0x10a)]=void 0x0;const async_mutex_1=require(a38_0x2c64c1(0xf3)),socket_1=require(a38_0x2c64c1(0x109)),Ticket_1=__importDefault(require(a38_0x2c64c1(0xf9))),sequelize_1=require('sequelize'),CreateTicketService_1=__importDefault(require(a38_0x2c64c1(0x110))),DeleteTicketService_1=__importDefault(require(a38_0x2c64c1(0xea))),ListTicketsService_1=__importDefault(require(a38_0x2c64c1(0x113))),ShowTicketFromUUIDService_1=__importDefault(require(a38_0x2c64c1(0xf7))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require('../services/TicketServices/UpdateTicketService')),ListTicketsServiceKanban_1=__importDefault(require(a38_0x2c64c1(0x10f))),updateMutex=new async_mutex_1[(a38_0x2c64c1(0x10c))](),index=async(_0x25280f,_0x263329)=>{const _0x360b96=a38_0x2c64c1,{pageNumber:_0x164b10,status:_0x572ceb,groups:_0x54c57b,date:_0x18a32a,updatedAt:_0x5bc679,isSearch:_0x3e22a7,searchParam:_0x592eee,showAll:_0x1be65c,queueIds:_0x18c4a5,tags:_0x3ff9cd,users:_0x47f363,withUnreadMessages:_0x462cdb,notClosed:_0x29fc0f,all:_0x398827}=_0x25280f[_0x360b96(0xd9)],_0x7bc1f=_0x25280f[_0x360b96(0x105)]['id'],{companyId:_0x40ab94}=_0x25280f[_0x360b96(0x105)];let _0x2238ec=[],_0x6fd67e=[],_0x318220=[];_0x18c4a5&&(_0x2238ec=JSON['parse'](_0x18c4a5));_0x3ff9cd&&(_0x6fd67e=JSON['parse'](_0x3ff9cd));_0x47f363&&(_0x318220=JSON[_0x360b96(0xe6)](_0x47f363));const {tickets:_0xe2ca32,count:_0x4dec1a,hasMore:_0x87b4c7}=await(0x0,ListTicketsService_1[_0x360b96(0xe0)])({'isSearch':_0x3e22a7===_0x360b96(0xf5),'searchParam':_0x592eee,'tags':_0x6fd67e,'users':_0x318220,'pageNumber':_0x164b10,'status':_0x572ceb,'groups':_0x54c57b,'date':_0x18a32a,'updatedAt':_0x5bc679,'showAll':_0x1be65c,'userId':_0x7bc1f,'queueIds':_0x2238ec,'withUnreadMessages':_0x462cdb,'notClosed':!!_0x29fc0f,'all':!!_0x398827,'companyId':_0x40ab94});return _0x263329['status'](0xc8)[_0x360b96(0xdc)]({'tickets':_0xe2ca32,'count':_0x4dec1a,'hasMore':_0x87b4c7});};exports[a38_0x2c64c1(0x10a)]=index;const kanban=async(_0x1546a0,_0x1ca936)=>{const _0x6d7da2=a38_0x2c64c1,{pageNumber:_0x869b1,status:_0x2007dd,date:_0x25d132,updatedAt:_0x3499d4,searchParam:_0xc0dd74,showAll:_0x18f9fe,queueIds:_0x41cb22,tags:_0x17b502,users:_0xe91ee8,withUnreadMessages:_0x528d24}=_0x1546a0[_0x6d7da2(0xd9)],_0x5443ed=_0x1546a0[_0x6d7da2(0x105)]['id'],{companyId:_0x42a766}=_0x1546a0[_0x6d7da2(0x105)];let _0x32d09d=[],_0x1516b4=[],_0x128213=[];_0x41cb22&&(_0x32d09d=JSON['parse'](_0x41cb22));_0x17b502&&(_0x1516b4=JSON['parse'](_0x17b502));_0xe91ee8&&(_0x128213=JSON['parse'](_0xe91ee8));const {tickets:_0x40ea72,count:_0x12f5e6,hasMore:_0x27ed37}=await(0x0,ListTicketsServiceKanban_1[_0x6d7da2(0xe0)])({'searchParam':_0xc0dd74,'tags':_0x1516b4,'users':_0x128213,'pageNumber':_0x869b1,'status':_0x2007dd,'date':_0x25d132,'updatedAt':_0x3499d4,'showAll':_0x18f9fe,'userId':_0x5443ed,'queueIds':_0x32d09d,'withUnreadMessages':_0x528d24,'companyId':_0x42a766});return _0x1ca936['status'](0xc8)[_0x6d7da2(0xdc)]({'tickets':_0x40ea72,'count':_0x12f5e6,'hasMore':_0x27ed37});};exports[a38_0x2c64c1(0xec)]=kanban;const findOpenTicketByContactId=async(_0x263002,_0x26204b)=>{const _0xad339e=a38_0x2c64c1,_0x5ae42c=await Ticket_1['default'][_0xad339e(0xf4)]({'where':{'contactId':_0x263002,'companyId':_0x26204b,'status':{[sequelize_1['Op']['or']]:['open',_0xad339e(0xff)]}}});return _0x5ae42c;};exports[a38_0x2c64c1(0xdf)]=findOpenTicketByContactId;const store=async(_0x23a857,_0x267703)=>{const _0x5b1791=a38_0x2c64c1,{contactId:_0x408ebd,userId:_0x512d7d,queueId:_0x24788e}=_0x23a857[_0x5b1791(0xee)],{companyId:_0x318c86}=_0x23a857[_0x5b1791(0x105)],_0x2198b9=await(0x0,exports['findOpenTicketByContactId'])(_0x408ebd,_0x318c86);if(_0x2198b9)return _0x267703[_0x5b1791(0xf2)](0xc8)[_0x5b1791(0xdc)](_0x2198b9);const _0x21de76=await(0x0,CreateTicketService_1['default'])({'contactId':_0x408ebd,'userId':_0x512d7d,'companyId':_0x318c86,'queueId':_0x24788e}),_0x48760f=(0x0,socket_1[_0x5b1791(0xf8)])();return _0x48760f['to'](_0x5b1791(0x101)+_0x318c86+'-'+_0x21de76[_0x5b1791(0xf2)])['to']('queue-'+_0x21de76[_0x5b1791(0xf1)]+'-'+_0x21de76[_0x5b1791(0xf2)])[_0x5b1791(0x10e)]('company-'+_0x318c86+_0x5b1791(0x107),{'action':_0x5b1791(0xef),'ticket':_0x21de76}),_0x267703[_0x5b1791(0xf2)](0xc8)[_0x5b1791(0xdc)](_0x21de76);};exports[a38_0x2c64c1(0x10d)]=store;function a38_0x43fa(){const _0x316fc1=['defineProperty','1098IHQvRs','pending','-notification','company-','closeAll','(((.+)+)+)+$','queue-','user','1636MBkWkP','-ticket','all\x20tickets\x20closed','../libs/socket','index','params','Mutex','store','emit','../services/TicketServices/ListTicketsServiceKanban','../services/TicketServices/CreateTicketService','208QvYEIq','constructor','../services/TicketServices/ListTicketsService','10PaxOcq','query','closed','show','json','search','ticket\x20deleted','findOpenTicketByContactId','default','411744IcfBVL','__importDefault','396218dJndZL','940PZBmfA','1089684fusfGa','parse','showFromUUID','toString','8145291nAnoaG','../services/TicketServices/DeleteTicketService','__esModule','kanban','15673wlJsMF','body','update','1383BZXgrI','queueId','status','async-mutex','findOne','true','63qInovw','../services/TicketServices/ShowTicketFromUUIDService','getIO','../models/Ticket','tokenData','remove','4822vGNGmC'];a38_0x43fa=function(){return _0x316fc1;};return a38_0x43fa();}const show=async(_0x409ccb,_0x1b33a2)=>{const _0x13907d=a38_0x2c64c1,{ticketId:_0x4e246a}=_0x409ccb[_0x13907d(0x10b)],{companyId:_0xbdb1bb}=_0x409ccb[_0x13907d(0x105)],_0x2fe260=await(0x0,ShowTicketService_1['default'])(_0x4e246a,_0xbdb1bb);return _0x1b33a2[_0x13907d(0xf2)](0xc8)[_0x13907d(0xdc)](_0x2fe260);};exports['show']=show;const showFromUUID=async(_0xaef3f7,_0x576a80)=>{const _0xc09225=a38_0x2c64c1,{uuid:_0x4aa7ac}=_0xaef3f7[_0xc09225(0x10b)],_0x4334b7=await(0x0,ShowTicketFromUUIDService_1[_0xc09225(0xe0)])(_0x4aa7ac);return _0x576a80[_0xc09225(0xf2)](0xc8)['json'](_0x4334b7);};exports[a38_0x2c64c1(0xe7)]=showFromUUID;const closeAll=async(_0x3d1471,_0x3307e5)=>{const _0x945def=a38_0x2c64c1,{companyId:_0x37cf42}=_0x3d1471[_0x945def(0x105)];var _0x4e06b3=_0x3d1471[_0x945def(0xee)][_0x945def(0xf2)],_0x222ae3=await Ticket_1[_0x945def(0xe0)]['findAll']({'where':{'companyId':_0x37cf42,'status':_0x4e06b3}});for(const _0x11cc54 of _0x222ae3){(0x0,UpdateTicketService_1[_0x945def(0xe0)])({'ticketData':{'status':_0x945def(0xda),'userId':_0x11cc54['userId']||null,'queueId':_0x11cc54[_0x945def(0xf1)]||null,'amountUsedBotQueues':0x0},'ticketId':_0x11cc54['id'],'companyId':_0x37cf42});}return _0x3307e5['status'](0xc8)['json']({'message':_0x945def(0x108)});};exports[a38_0x2c64c1(0x102)]=closeAll;const update=async(_0x2321fa,_0x527ada)=>{const _0x14ecbd=a38_0x2c64c1,{ticketId:_0xcd81b9}=_0x2321fa['params'],{ticket:_0x249320}=await updateMutex['runExclusive'](async()=>{const _0x31139c=a38_0x4cc6,_0x39aa24=await(0x0,UpdateTicketService_1[_0x31139c(0xe0)])({'ticketData':_0x2321fa[_0x31139c(0xee)],'ticketId':Number['parseInt'](_0xcd81b9,0xa),'tokenData':_0x2321fa[_0x31139c(0xfa)]});return _0x39aa24;});return _0x527ada[_0x14ecbd(0xf2)](0xc8)['json'](_0x249320);};function a38_0x4cc6(_0x182325,_0x22628e){const _0x295a22=a38_0x43fa();return a38_0x4cc6=function(_0x3c191f,_0x3cb8a1){_0x3c191f=_0x3c191f-0xd8;let _0x43fa81=_0x295a22[_0x3c191f];return _0x43fa81;},a38_0x4cc6(_0x182325,_0x22628e);}exports[a38_0x2c64c1(0xef)]=update;const remove=async(_0x653b10,_0xbb65bb)=>{const _0x4e07e0=a38_0x2c64c1,{ticketId:_0x258ab2}=_0x653b10[_0x4e07e0(0x10b)],{companyId:_0x55e46d}=_0x653b10['user'];await(0x0,ShowTicketService_1[_0x4e07e0(0xe0)])(_0x258ab2,_0x55e46d);const _0xea4c3c=await(0x0,DeleteTicketService_1['default'])(_0x258ab2),_0x3254fe=(0x0,socket_1[_0x4e07e0(0xf8)])();return _0x3254fe['to'](_0x258ab2)['to'](_0x4e07e0(0x101)+_0x55e46d+'-'+_0xea4c3c['status'])['to']('company-'+_0x55e46d+_0x4e07e0(0x100))['to']('queue-'+_0xea4c3c[_0x4e07e0(0xf1)]+'-'+_0xea4c3c['status'])['to'](_0x4e07e0(0x104)+_0xea4c3c[_0x4e07e0(0xf1)]+_0x4e07e0(0x100))[_0x4e07e0(0x10e)](_0x4e07e0(0x101)+_0x55e46d+_0x4e07e0(0x107),{'action':'delete','ticketId':+_0x258ab2}),_0xbb65bb[_0x4e07e0(0xf2)](0xc8)['json']({'message':_0x4e07e0(0xde)});};exports[a38_0x2c64c1(0xfb)]=remove;