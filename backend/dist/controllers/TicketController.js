const a40_0x1a9ddc=a40_0x588a;(function(_0x74a8de,_0x14f13c){const _0x43c6bb=a40_0x588a,_0x40ac0f=_0x74a8de();while(!![]){try{const _0x373478=-parseInt(_0x43c6bb(0x1df))/0x1+parseInt(_0x43c6bb(0x1db))/0x2+parseInt(_0x43c6bb(0x1cd))/0x3*(parseInt(_0x43c6bb(0x1c3))/0x4)+parseInt(_0x43c6bb(0x1d3))/0x5*(parseInt(_0x43c6bb(0x1b0))/0x6)+-parseInt(_0x43c6bb(0x1ba))/0x7*(parseInt(_0x43c6bb(0x1e6))/0x8)+-parseInt(_0x43c6bb(0x1d6))/0x9+-parseInt(_0x43c6bb(0x1b6))/0xa*(-parseInt(_0x43c6bb(0x1d7))/0xb);if(_0x373478===_0x14f13c)break;else _0x40ac0f['push'](_0x40ac0f['shift']());}catch(_0x45efab){_0x40ac0f['push'](_0x40ac0f['shift']());}}}(a40_0x2f93,0x2aef7));const a40_0x47f854=(function(){let _0x46400f=!![];return function(_0x534d4d,_0x5b6bda){const _0x532bff=_0x46400f?function(){const _0x1c7c75=a40_0x588a;if(_0x5b6bda){const _0x5f502d=_0x5b6bda[_0x1c7c75(0x1ab)](_0x534d4d,arguments);return _0x5b6bda=null,_0x5f502d;}}:function(){};return _0x46400f=![],_0x532bff;};}()),a40_0x30447d=a40_0x47f854(this,function(){const _0x53f9dc=a40_0x588a;return a40_0x30447d[_0x53f9dc(0x1e7)]()[_0x53f9dc(0x1cb)](_0x53f9dc(0x1c2))[_0x53f9dc(0x1e7)]()[_0x53f9dc(0x1e2)](a40_0x30447d)[_0x53f9dc(0x1cb)](_0x53f9dc(0x1c2));});a40_0x30447d();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2affdf){return _0x2affdf&&_0x2affdf['__esModule']?_0x2affdf:{'default':_0x2affdf};};Object[a40_0x1a9ddc(0x1e1)](exports,'__esModule',{'value':!![]}),exports[a40_0x1a9ddc(0x1cc)]=exports['update']=exports[a40_0x1a9ddc(0x1d2)]=exports[a40_0x1a9ddc(0x1de)]=exports[a40_0x1a9ddc(0x1d1)]=exports['kanban']=exports[a40_0x1a9ddc(0x1ca)]=exports[a40_0x1a9ddc(0x1b7)]=void 0x0;const socket_1=require(a40_0x1a9ddc(0x1b3)),Ticket_1=__importDefault(require(a40_0x1a9ddc(0x1bd))),CreateTicketService_1=__importDefault(require(a40_0x1a9ddc(0x1b5))),DeleteTicketService_1=__importDefault(require(a40_0x1a9ddc(0x1d9))),ListTicketsService_1=__importDefault(require('../services/TicketServices/ListTicketsService')),ShowTicketFromUUIDService_1=__importDefault(require(a40_0x1a9ddc(0x1ae))),ShowTicketService_1=__importDefault(require(a40_0x1a9ddc(0x1c0))),UpdateTicketService_1=__importDefault(require(a40_0x1a9ddc(0x1dd))),ListTicketsServiceKanban_1=__importDefault(require('../services/TicketServices/ListTicketsServiceKanban')),async_mutex_1=require(a40_0x1a9ddc(0x1c8)),User_1=__importDefault(require(a40_0x1a9ddc(0x1b1))),index=async(_0xe89c37,_0x45bb88)=>{const _0x87c8a6=a40_0x1a9ddc,{pageNumber:_0x5c15e7,status:_0x1eed08,date:_0x3cd9de,updatedAt:_0x5e9d03,searchParam:_0x47e0d7,showAll:_0xdf91e6,queueIds:_0x2b691a,tags:_0x48bd61,users:_0x4f5746,withUnreadMessages:_0x2514b0}=_0xe89c37[_0x87c8a6(0x1bf)],_0x345d89=_0xe89c37[_0x87c8a6(0x1aa)]['id'],{companyId:_0x42a71b}=_0xe89c37['user'];let _0x13ed2e=[],_0x4930b0=[],_0x316054=[];_0x2b691a&&(_0x13ed2e=JSON[_0x87c8a6(0x1bb)](_0x2b691a));_0x48bd61&&(_0x4930b0=JSON[_0x87c8a6(0x1bb)](_0x48bd61));_0x4f5746&&(_0x316054=JSON['parse'](_0x4f5746));const _0x2e63cf=_0xe89c37['query'][_0x87c8a6(0x1c7)],_0x333f3f=_0xe89c37['query'][_0x87c8a6(0x1d5)],{tickets:_0x4ec527,count:_0x1bdaec,hasMore:_0xa2ad34}=await(0x0,ListTicketsService_1[_0x87c8a6(0x1da)])({'searchParam':_0x47e0d7,'tags':_0x4930b0,'users':_0x316054,'pageNumber':_0x5c15e7,'status':_0x1eed08,'date':_0x3cd9de,'updatedAt':_0x5e9d03,'showAll':_0xdf91e6,'userId':_0x345d89,'queueIds':_0x13ed2e,'withUnreadMessages':_0x2514b0,'companyId':_0x42a71b,'startDate':_0x2e63cf,'endDate':_0x333f3f});return _0x45bb88[_0x87c8a6(0x1bc)](0xc8)[_0x87c8a6(0x1c1)]({'tickets':_0x4ec527,'count':_0x1bdaec,'hasMore':_0xa2ad34});};exports[a40_0x1a9ddc(0x1b7)]=index;const store=async(_0xcb4439,_0x5de682)=>{const _0x3bd1f3=a40_0x1a9ddc,{contactId:_0x948a66,status:_0x2238ef,userId:_0x19a844,queueId:_0xeff139,whatsappId:_0xc5a116}=_0xcb4439[_0x3bd1f3(0x1c6)],{companyId:_0x1ba31b,id:_0x187461}=_0xcb4439[_0x3bd1f3(0x1aa)],_0x19a6c8=await Ticket_1[_0x3bd1f3(0x1da)][_0x3bd1f3(0x1af)]({'where':{'userId':_0x187461,'status':_0x3bd1f3(0x1cf),'companyId':_0x1ba31b}}),{limitAttendance:_0x427e8f,name:_0x229c9f}=await User_1[_0x3bd1f3(0x1da)][_0x3bd1f3(0x1e5)](_0x187461);if(_0x19a6c8>=_0x427e8f){}const _0x472fbd=await(0x0,CreateTicketService_1[_0x3bd1f3(0x1da)])({'contactId':_0x948a66,'status':_0x2238ef,'userId':_0x19a844,'companyId':_0x1ba31b,'queueId':_0xeff139,'whatsappId':_0xc5a116}),_0x5b7efe=(0x0,socket_1['getIO'])();return _0x5b7efe['to'](_0x3bd1f3(0x1ce)+_0x472fbd['companyId']+'-'+_0x472fbd[_0x3bd1f3(0x1bc)])['to'](_0x3bd1f3(0x1ad)+_0x472fbd[_0x3bd1f3(0x1d8)]+'-'+_0x472fbd['status'])[_0x3bd1f3(0x1dc)](_0x3bd1f3(0x1ce)+_0x1ba31b+_0x3bd1f3(0x1b9),{'action':_0x3bd1f3(0x1c4),'ticket':_0x472fbd}),_0x5de682[_0x3bd1f3(0x1bc)](0xc8)[_0x3bd1f3(0x1c1)](_0x472fbd);};exports[a40_0x1a9ddc(0x1ca)]=store;const kanban=async(_0x51863b,_0x174ef5)=>{const _0x3043ea=a40_0x1a9ddc,{pageNumber:_0x5426eb,status:_0x5c1022,date:_0x1cbb9e,updatedAt:_0x2e2f94,searchParam:_0xdae4a0,showAll:_0x4c68ee,queueIds:_0x25bdea,tags:_0x48d73d,users:_0x48d3df,withUnreadMessages:_0x360065}=_0x51863b['query'],_0x4d98a2=_0x51863b[_0x3043ea(0x1aa)]['id'],{companyId:_0xc3a76d}=_0x51863b[_0x3043ea(0x1aa)];let _0x15cea9=[],_0x23a47d=[],_0x56126c=[];_0x25bdea&&(_0x15cea9=JSON[_0x3043ea(0x1bb)](_0x25bdea));_0x48d73d&&(_0x23a47d=JSON[_0x3043ea(0x1bb)](_0x48d73d));_0x48d3df&&(_0x56126c=JSON[_0x3043ea(0x1bb)](_0x48d3df));const {tickets:_0x157a18,count:_0x3a1ec0,hasMore:_0x1b1991}=await(0x0,ListTicketsServiceKanban_1['default'])({'searchParam':_0xdae4a0,'tags':_0x23a47d,'users':_0x56126c,'pageNumber':_0x5426eb,'status':_0x5c1022,'date':_0x1cbb9e,'updatedAt':_0x2e2f94,'showAll':_0x4c68ee,'userId':_0x4d98a2,'queueIds':_0x15cea9,'withUnreadMessages':_0x360065,'companyId':_0xc3a76d});return _0x174ef5['status'](0xc8)[_0x3043ea(0x1c1)]({'tickets':_0x157a18,'count':_0x3a1ec0,'hasMore':_0x1b1991});};exports[a40_0x1a9ddc(0x1c9)]=kanban;const show=async(_0x14af9d,_0x205e7d)=>{const _0x3e522a=a40_0x1a9ddc,{ticketId:_0x4048dd}=_0x14af9d[_0x3e522a(0x1e4)],{companyId:_0x4245df}=_0x14af9d['user'],_0x240da0=await(0x0,ShowTicketService_1['default'])(_0x4048dd,_0x4245df);return _0x205e7d[_0x3e522a(0x1bc)](0xc8)[_0x3e522a(0x1c1)](_0x240da0);};exports['show']=show;const showFromUUID=async(_0x3ef01e,_0x1eeaf8)=>{const _0x21d493=a40_0x1a9ddc,{uuid:_0x2366f3}=_0x3ef01e[_0x21d493(0x1e4)],_0x2009d2=await(0x0,ShowTicketFromUUIDService_1[_0x21d493(0x1da)])(_0x2366f3);return _0x1eeaf8['status'](0xc8)[_0x21d493(0x1c1)](_0x2009d2);};exports['showFromUUID']=showFromUUID;const closeAll=async(_0x145a04,_0xe37454)=>{const _0x1919e4=a40_0x1a9ddc,{companyId:_0x32534c}=_0x145a04[_0x1919e4(0x1aa)];var _0x4cb1d2=_0x145a04[_0x1919e4(0x1c6)]['status'],_0xff9f2e=await Ticket_1['default'][_0x1919e4(0x1d4)]({'where':{'companyId':_0x32534c,'status':_0x4cb1d2}});for(const _0xfdc4b8 of _0xff9f2e){(0x0,UpdateTicketService_1[_0x1919e4(0x1da)])({'ticketData':{'status':_0x1919e4(0x1b2),'userId':_0xfdc4b8[_0x1919e4(0x1e0)]||null,'queueId':_0xfdc4b8[_0x1919e4(0x1d8)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0xfdc4b8['id'],'companyId':_0x32534c});}return _0xe37454['status'](0xc8)[_0x1919e4(0x1c1)]({'message':_0x1919e4(0x1b8)});};exports[a40_0x1a9ddc(0x1d2)]=closeAll;function a40_0x588a(_0x46a68f,_0x2a2c48){const _0x477947=a40_0x2f93();return a40_0x588a=function(_0x30447d,_0x47f854){_0x30447d=_0x30447d-0x1aa;let _0x2f935e=_0x477947[_0x30447d];return _0x2f935e;},a40_0x588a(_0x46a68f,_0x2a2c48);}const update=async(_0x13c643,_0x1a4de5)=>{const _0x3d2731=a40_0x1a9ddc,{ticketId:_0x10ebd5}=_0x13c643['params'],_0xd695a9=_0x13c643[_0x3d2731(0x1c6)],{companyId:_0x244fc3,id:_0x51a5bc}=_0x13c643['user'],_0x5bb10f=await Ticket_1[_0x3d2731(0x1da)][_0x3d2731(0x1af)]({'where':{'userId':_0x51a5bc,'status':'open','companyId':_0x244fc3}}),{limitAttendance:_0x379aef,name:_0x1b166c}=await User_1[_0x3d2731(0x1da)]['findByPk'](_0x51a5bc);if(_0xd695a9[_0x3d2731(0x1bc)]===_0x3d2731(0x1cf)&&_0x5bb10f>=_0x379aef){}const _0x2a8846=new async_mutex_1[(_0x3d2731(0x1ac))](),{ticket:_0x236fb4}=await _0x2a8846[_0x3d2731(0x1c5)](async()=>{const _0x51c986=_0x3d2731;return await(0x0,UpdateTicketService_1[_0x51c986(0x1da)])({'ticketData':_0x13c643[_0x51c986(0x1c6)],'ticketId':_0x10ebd5,'companyId':_0x244fc3,'tokenData':_0x13c643['tokenData']});});return _0x1a4de5[_0x3d2731(0x1bc)](0xc8)[_0x3d2731(0x1c1)](_0x236fb4);};exports[a40_0x1a9ddc(0x1c4)]=update;const remove=async(_0x2b6e98,_0x55f233)=>{const _0x269d68=a40_0x1a9ddc,{ticketId:_0xb00370}=_0x2b6e98[_0x269d68(0x1e4)],{companyId:_0x4837b0}=_0x2b6e98[_0x269d68(0x1aa)];await(0x0,ShowTicketService_1[_0x269d68(0x1da)])(_0xb00370,_0x4837b0);const _0x3ec9a6=await(0x0,DeleteTicketService_1[_0x269d68(0x1da)])(_0xb00370),_0xdb220c=(0x0,socket_1[_0x269d68(0x1d0)])();return _0xdb220c['to'](_0x269d68(0x1ce)+_0x4837b0+'-'+_0x3ec9a6[_0x269d68(0x1bc)])['to'](_0xb00370)['to'](_0x269d68(0x1ad)+_0x3ec9a6['queueId']+'-notification')['to']('queue-'+_0x3ec9a6[_0x269d68(0x1d8)]+'-'+_0x3ec9a6[_0x269d68(0x1bc)])['to']('company-'+_0x3ec9a6[_0x269d68(0x1be)]+_0x269d68(0x1b4))[_0x269d68(0x1dc)](_0x269d68(0x1ce)+_0x4837b0+_0x269d68(0x1b9),{'action':_0x269d68(0x1e3),'ticketId':+_0xb00370}),_0x55f233[_0x269d68(0x1bc)](0xc8)[_0x269d68(0x1c1)]({'message':'ticket\x20deleted'});};function a40_0x2f93(){const _0x4ee102=['store','search','remove','129990WZNVEk','company-','open','getIO','show','closeAll','10akuUpT','findAll','endDate','418788TTsVYf','209QCrjgj','queueId','../services/TicketServices/DeleteTicketService','default','156526HPaCSV','emit','../services/TicketServices/UpdateTicketService','showFromUUID','329146xvuaqD','userId','defineProperty','constructor','delete','params','findByPk','14008CARcep','toString','user','apply','Mutex','queue-','../services/TicketServices/ShowTicketFromUUIDService','count','818046deQzTr','../models/User','closed','../libs/socket','-notification','../services/TicketServices/CreateTicketService','14590EtLzUZ','index','all\x20tickets\x20closed','-ticket','175iNlvym','parse','status','../models/Ticket','companyId','query','../services/TicketServices/ShowTicketService','json','(((.+)+)+)+$','20JjDAEc','update','runExclusive','body','startDate','async-mutex','kanban'];a40_0x2f93=function(){return _0x4ee102;};return a40_0x2f93();}exports['remove']=remove;