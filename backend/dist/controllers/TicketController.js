const a38_0x4253f8=a38_0x13e8;(function(_0x4b0cf7,_0x1784c1){const _0x502bc1=a38_0x13e8,_0x276f06=_0x4b0cf7();while(!![]){try{const _0x5b977b=parseInt(_0x502bc1(0xca))/0x1*(parseInt(_0x502bc1(0xd3))/0x2)+parseInt(_0x502bc1(0xbe))/0x3*(parseInt(_0x502bc1(0xe2))/0x4)+parseInt(_0x502bc1(0xc2))/0x5*(-parseInt(_0x502bc1(0xc5))/0x6)+parseInt(_0x502bc1(0xe6))/0x7+-parseInt(_0x502bc1(0xd8))/0x8+-parseInt(_0x502bc1(0xd9))/0x9*(parseInt(_0x502bc1(0xec))/0xa)+parseInt(_0x502bc1(0xc7))/0xb*(parseInt(_0x502bc1(0xcb))/0xc);if(_0x5b977b===_0x1784c1)break;else _0x276f06['push'](_0x276f06['shift']());}catch(_0x216764){_0x276f06['push'](_0x276f06['shift']());}}}(a38_0x14ab,0x557f8));const a38_0x31b620=(function(){let _0x12519d=!![];return function(_0x4ef03c,_0x50d2eb){const _0x31678e=_0x12519d?function(){const _0x251241=a38_0x13e8;if(_0x50d2eb){const _0x43ad2f=_0x50d2eb[_0x251241(0xd4)](_0x4ef03c,arguments);return _0x50d2eb=null,_0x43ad2f;}}:function(){};return _0x12519d=![],_0x31678e;};}()),a38_0x35c47f=a38_0x31b620(this,function(){const _0x41ea12=a38_0x13e8;return a38_0x35c47f['toString']()[_0x41ea12(0xc8)](_0x41ea12(0xe1))[_0x41ea12(0xe0)]()[_0x41ea12(0xf7)](a38_0x35c47f)[_0x41ea12(0xc8)]('(((.+)+)+)+$');});a38_0x35c47f();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x18df74){const _0x492f3c=a38_0x13e8;return _0x18df74&&_0x18df74[_0x492f3c(0xc1)]?_0x18df74:{'default':_0x18df74};};Object[a38_0x4253f8(0xf0)](exports,'__esModule',{'value':!![]}),exports[a38_0x4253f8(0xee)]=exports[a38_0x4253f8(0xc0)]=exports[a38_0x4253f8(0xf2)]=exports[a38_0x4253f8(0xd2)]=exports[a38_0x4253f8(0xe4)]=exports[a38_0x4253f8(0xdd)]=exports[a38_0x4253f8(0xf1)]=exports['kanban']=exports[a38_0x4253f8(0xcd)]=void 0x0;const async_mutex_1=require('async-mutex'),socket_1=require(a38_0x4253f8(0xef)),Ticket_1=__importDefault(require(a38_0x4253f8(0xe7))),sequelize_1=require(a38_0x4253f8(0xd7)),CreateTicketService_1=__importDefault(require(a38_0x4253f8(0xdf))),DeleteTicketService_1=__importDefault(require('../services/TicketServices/DeleteTicketService')),ListTicketsService_1=__importDefault(require(a38_0x4253f8(0xc9))),ShowTicketFromUUIDService_1=__importDefault(require(a38_0x4253f8(0xdb))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require(a38_0x4253f8(0xf5))),ListTicketsServiceKanban_1=__importDefault(require(a38_0x4253f8(0xd6))),updateMutex=new async_mutex_1[(a38_0x4253f8(0xbc))](),index=async(_0x32738a,_0x3fc210)=>{const _0x264da5=a38_0x4253f8,{pageNumber:_0x7c63,status:_0x146732,groups:_0x2f0649,date:_0xcf462a,updatedAt:_0x452f6c,isSearch:_0x932062,searchParam:_0x1bbb0e,showAll:_0x39829b,queueIds:_0xc3ed27,tags:_0x468d3e,users:_0x29d7d4,withUnreadMessages:_0x365950,notClosed:_0x52c3fa,all:_0x3877cd}=_0x32738a[_0x264da5(0xf3)],_0x3cf35a=_0x32738a[_0x264da5(0xce)]['id'],{companyId:_0x1551b6}=_0x32738a[_0x264da5(0xce)];let _0x31d478=[],_0x247ad9=[],_0xc2fc37=[];_0xc3ed27&&(_0x31d478=JSON[_0x264da5(0xed)](_0xc3ed27));_0x468d3e&&(_0x247ad9=JSON['parse'](_0x468d3e));_0x29d7d4&&(_0xc2fc37=JSON[_0x264da5(0xed)](_0x29d7d4));const {tickets:_0x12542a,count:_0x5aa9c4,hasMore:_0x5145a5}=await(0x0,ListTicketsService_1[_0x264da5(0xd0)])({'isSearch':_0x932062===_0x264da5(0xe9),'searchParam':_0x1bbb0e,'tags':_0x247ad9,'users':_0xc2fc37,'pageNumber':_0x7c63,'status':_0x146732,'groups':_0x2f0649,'date':_0xcf462a,'updatedAt':_0x452f6c,'showAll':_0x39829b,'userId':_0x3cf35a,'queueIds':_0x31d478,'withUnreadMessages':_0x365950,'notClosed':!!_0x52c3fa,'all':!!_0x3877cd,'companyId':_0x1551b6});return _0x3fc210[_0x264da5(0xbf)](0xc8)[_0x264da5(0xbb)]({'tickets':_0x12542a,'count':_0x5aa9c4,'hasMore':_0x5145a5});};exports[a38_0x4253f8(0xcd)]=index;function a38_0x14ab(){const _0x59f091=['5zFRwvy','body','params','2423154qAVTcX','-notification','11ZIrqRD','search','../services/TicketServices/ListTicketsService','10239tAhsDV','6880620tAidGA','closed','index','user','all\x20tickets\x20closed','default','pending','showFromUUID','2kSYCih','apply','getIO','../services/TicketServices/ListTicketsServiceKanban','sequelize','3884344jasHhC','6174BSoPmk','tokenData','../services/TicketServices/ShowTicketFromUUIDService','kanban','store','company-','../services/TicketServices/CreateTicketService','toString','(((.+)+)+)+$','320tBrpmN','queueId','show','open','1584240XApqhe','../models/Ticket','-ticket','true','userId','emit','3170IpRgKp','parse','remove','../libs/socket','defineProperty','findOpenTicketByContactId','closeAll','query','parseInt','../services/TicketServices/UpdateTicketService','findOne','constructor','json','Mutex','queue-','24267oMeNkc','status','update','__esModule'];a38_0x14ab=function(){return _0x59f091;};return a38_0x14ab();}const kanban=async(_0x2128ee,_0xcee2c0)=>{const _0x2232e1=a38_0x4253f8,{pageNumber:_0xe8026,status:_0x1700a2,date:_0x58849e,updatedAt:_0x37b3e2,searchParam:_0x231ba6,showAll:_0x51e8da,queueIds:_0x5c9d62,tags:_0x352e3d,users:_0x1e108c,withUnreadMessages:_0xc0fbc6}=_0x2128ee[_0x2232e1(0xf3)],_0x201510=_0x2128ee['user']['id'],{companyId:_0x3f36fd}=_0x2128ee[_0x2232e1(0xce)];let _0x345c83=[],_0x664f7=[],_0x31c47b=[];_0x5c9d62&&(_0x345c83=JSON[_0x2232e1(0xed)](_0x5c9d62));_0x352e3d&&(_0x664f7=JSON[_0x2232e1(0xed)](_0x352e3d));_0x1e108c&&(_0x31c47b=JSON['parse'](_0x1e108c));const {tickets:_0x3bc2f2,count:_0x58023d,hasMore:_0x7d8cb4}=await(0x0,ListTicketsServiceKanban_1['default'])({'searchParam':_0x231ba6,'tags':_0x664f7,'users':_0x31c47b,'pageNumber':_0xe8026,'status':_0x1700a2,'date':_0x58849e,'updatedAt':_0x37b3e2,'showAll':_0x51e8da,'userId':_0x201510,'queueIds':_0x345c83,'withUnreadMessages':_0xc0fbc6,'companyId':_0x3f36fd});return _0xcee2c0[_0x2232e1(0xbf)](0xc8)[_0x2232e1(0xbb)]({'tickets':_0x3bc2f2,'count':_0x58023d,'hasMore':_0x7d8cb4});};exports[a38_0x4253f8(0xdc)]=kanban;const findOpenTicketByContactId=async(_0x1f5bdf,_0x43ada9)=>{const _0x33c56a=a38_0x4253f8,_0x37096a=await Ticket_1[_0x33c56a(0xd0)][_0x33c56a(0xf6)]({'where':{'contactId':_0x1f5bdf,'companyId':_0x43ada9,'status':{[sequelize_1['Op']['or']]:[_0x33c56a(0xe5),_0x33c56a(0xd1)]}}});return _0x37096a;};exports['findOpenTicketByContactId']=findOpenTicketByContactId;const store=async(_0x4066b8,_0x1265b0)=>{const _0x13dda1=a38_0x4253f8,{contactId:_0x49a114,userId:_0xdb241d,queueId:_0x34c932}=_0x4066b8['body'],{companyId:_0x275184}=_0x4066b8[_0x13dda1(0xce)],_0xd48b59=await(0x0,exports[_0x13dda1(0xf1)])(_0x49a114,_0x275184);if(_0xd48b59)return _0x1265b0['status'](0xc8)['json'](_0xd48b59);const _0x183de8=await(0x0,CreateTicketService_1[_0x13dda1(0xd0)])({'contactId':_0x49a114,'userId':_0xdb241d,'companyId':_0x275184,'queueId':_0x34c932}),_0x543532=(0x0,socket_1[_0x13dda1(0xd5)])();return _0x543532['to'](_0x13dda1(0xde)+_0x275184+'-'+_0x183de8[_0x13dda1(0xbf)])['to'](_0x13dda1(0xbd)+_0x183de8[_0x13dda1(0xe3)]+'-'+_0x183de8[_0x13dda1(0xbf)])[_0x13dda1(0xeb)](_0x13dda1(0xde)+_0x275184+_0x13dda1(0xe8),{'action':_0x13dda1(0xc0),'ticket':_0x183de8}),_0x1265b0['status'](0xc8)[_0x13dda1(0xbb)](_0x183de8);};exports['store']=store;const show=async(_0x515708,_0x20aae4)=>{const _0x461caf=a38_0x4253f8,{ticketId:_0x5103ca}=_0x515708[_0x461caf(0xc4)],{companyId:_0x1743cc}=_0x515708[_0x461caf(0xce)],_0x5e2a38=await(0x0,ShowTicketService_1[_0x461caf(0xd0)])(_0x5103ca,_0x1743cc);return _0x20aae4[_0x461caf(0xbf)](0xc8)[_0x461caf(0xbb)](_0x5e2a38);};exports['show']=show;const showFromUUID=async(_0x591918,_0x4e6306)=>{const _0x14934a=a38_0x4253f8,{uuid:_0xb4a94b}=_0x591918[_0x14934a(0xc4)],_0x4c23da=await(0x0,ShowTicketFromUUIDService_1[_0x14934a(0xd0)])(_0xb4a94b);return _0x4e6306[_0x14934a(0xbf)](0xc8)['json'](_0x4c23da);};exports[a38_0x4253f8(0xd2)]=showFromUUID;const closeAll=async(_0x3c0bf0,_0x3184d2)=>{const _0x5aa18a=a38_0x4253f8,{companyId:_0x292835}=_0x3c0bf0['user'];var _0x5841a9=_0x3c0bf0[_0x5aa18a(0xc3)][_0x5aa18a(0xbf)],_0x7c45de=await Ticket_1['default']['findAll']({'where':{'companyId':_0x292835,'status':_0x5841a9}});for(const _0x2706fe of _0x7c45de){(0x0,UpdateTicketService_1[_0x5aa18a(0xd0)])({'ticketData':{'status':_0x5aa18a(0xcc),'userId':_0x2706fe[_0x5aa18a(0xea)]||null,'queueId':_0x2706fe[_0x5aa18a(0xe3)]||null,'amountUsedBotQueues':0x0},'ticketId':_0x2706fe['id'],'companyId':_0x292835});}return _0x3184d2[_0x5aa18a(0xbf)](0xc8)['json']({'message':_0x5aa18a(0xcf)});};exports[a38_0x4253f8(0xf2)]=closeAll;const update=async(_0xe0f2e6,_0x1d24a5)=>{const _0x5b1efc=a38_0x4253f8,{ticketId:_0x51dc38}=_0xe0f2e6[_0x5b1efc(0xc4)],{ticket:_0x1c5eed}=await updateMutex['runExclusive'](async()=>{const _0x238060=_0x5b1efc,_0x555100=await(0x0,UpdateTicketService_1[_0x238060(0xd0)])({'ticketData':_0xe0f2e6[_0x238060(0xc3)],'ticketId':Number[_0x238060(0xf4)](_0x51dc38,0xa),'tokenData':_0xe0f2e6[_0x238060(0xda)]});return _0x555100;});return _0x1d24a5[_0x5b1efc(0xbf)](0xc8)[_0x5b1efc(0xbb)](_0x1c5eed);};function a38_0x13e8(_0x49a635,_0x334d42){const _0x4bf0b7=a38_0x14ab();return a38_0x13e8=function(_0x35c47f,_0x31b620){_0x35c47f=_0x35c47f-0xbb;let _0x14ab3b=_0x4bf0b7[_0x35c47f];return _0x14ab3b;},a38_0x13e8(_0x49a635,_0x334d42);}exports[a38_0x4253f8(0xc0)]=update;const remove=async(_0x6693f6,_0x5acf59)=>{const _0x13a0e6=a38_0x4253f8,{ticketId:_0xd4bd93}=_0x6693f6[_0x13a0e6(0xc4)],{companyId:_0x59e336}=_0x6693f6[_0x13a0e6(0xce)];await(0x0,ShowTicketService_1[_0x13a0e6(0xd0)])(_0xd4bd93,_0x59e336);const _0x1270d1=await(0x0,DeleteTicketService_1['default'])(_0xd4bd93),_0x1d383a=(0x0,socket_1[_0x13a0e6(0xd5)])();return _0x1d383a['to'](_0xd4bd93)['to']('company-'+_0x59e336+'-'+_0x1270d1[_0x13a0e6(0xbf)])['to'](_0x13a0e6(0xde)+_0x59e336+_0x13a0e6(0xc6))['to'](_0x13a0e6(0xbd)+_0x1270d1['queueId']+'-'+_0x1270d1[_0x13a0e6(0xbf)])['to'](_0x13a0e6(0xbd)+_0x1270d1['queueId']+'-notification')[_0x13a0e6(0xeb)]('company-'+_0x59e336+_0x13a0e6(0xe8),{'action':'delete','ticketId':+_0xd4bd93}),_0x5acf59[_0x13a0e6(0xbf)](0xc8)['json']({'message':'ticket\x20deleted'});};exports['remove']=remove;