function a39_0x2d9a(){const _0x18c1dc=['../models/User','18thjIJQ','count','show','queueId','query','kanban','58HDlJcR','__esModule','delete','715299hJAPHf','1436HsNIkX','6HvRDnJ','parse','../services/TicketServices/UpdateTicketService','87765UHPcfZ','../services/TicketServices/ShowTicketFromUUIDService','showFromUUID','update','body','ticket\x20deleted','all\x20tickets\x20closed','getIO','userId','__importDefault','emit','../services/TicketServices/DeleteTicketService','4784696VvUDRe','companyId','search','defineProperty','queue-','toString','company-','../services/TicketServices/CreateTicketService','default','apply','-ticket','2064183eKZjhO','startDate','findByPk','closeAll','user','params','open','status','store','../models/Ticket','runExclusive','../libs/socket','index','async-mutex','remove','tokenData','json','-notification','4649210rplZEz','4505896WhrKvR','1220zUSfTP'];a39_0x2d9a=function(){return _0x18c1dc;};return a39_0x2d9a();}const a39_0x35f84f=a39_0x1f68;(function(_0x3172a4,_0x479f1d){const _0x4274be=a39_0x1f68,_0x3bef94=_0x3172a4();while(!![]){try{const _0x593cdd=-parseInt(_0x4274be(0x197))/0x1+parseInt(_0x4274be(0x194))/0x2*(parseInt(_0x4274be(0x19c))/0x3)+-parseInt(_0x4274be(0x198))/0x4*(parseInt(_0x4274be(0x1c7))/0x5)+parseInt(_0x4274be(0x199))/0x6*(parseInt(_0x4274be(0x1a8))/0x7)+parseInt(_0x4274be(0x1c6))/0x8+parseInt(_0x4274be(0x1c9))/0x9*(-parseInt(_0x4274be(0x1c5))/0xa)+parseInt(_0x4274be(0x1b3))/0xb;if(_0x593cdd===_0x479f1d)break;else _0x3bef94['push'](_0x3bef94['shift']());}catch(_0x4749c6){_0x3bef94['push'](_0x3bef94['shift']());}}}(a39_0x2d9a,0x864bc));const a39_0x31b709=(function(){let _0x150e88=!![];return function(_0x17c2a5,_0xc6a626){const _0x47b500=_0x150e88?function(){const _0x4f1248=a39_0x1f68;if(_0xc6a626){const _0x27a00a=_0xc6a626[_0x4f1248(0x1b1)](_0x17c2a5,arguments);return _0xc6a626=null,_0x27a00a;}}:function(){};return _0x150e88=![],_0x47b500;};}()),a39_0x3e0805=a39_0x31b709(this,function(){const _0x475460=a39_0x1f68;return a39_0x3e0805[_0x475460(0x1ad)]()[_0x475460(0x1aa)]('(((.+)+)+)+$')[_0x475460(0x1ad)]()['constructor'](a39_0x3e0805)['search']('(((.+)+)+)+$');});a39_0x3e0805();'use strict';var __importDefault=this&&this[a39_0x35f84f(0x1a5)]||function(_0x3e83a6){return _0x3e83a6&&_0x3e83a6['__esModule']?_0x3e83a6:{'default':_0x3e83a6};};Object[a39_0x35f84f(0x1ab)](exports,a39_0x35f84f(0x195),{'value':!![]}),exports[a39_0x35f84f(0x1c1)]=exports['update']=exports[a39_0x35f84f(0x1b6)]=exports[a39_0x35f84f(0x19e)]=exports[a39_0x35f84f(0x1cb)]=exports[a39_0x35f84f(0x1ce)]=exports[a39_0x35f84f(0x1bb)]=exports['index']=void 0x0;const socket_1=require(a39_0x35f84f(0x1be)),Ticket_1=__importDefault(require(a39_0x35f84f(0x1bc))),CreateTicketService_1=__importDefault(require(a39_0x35f84f(0x1af))),DeleteTicketService_1=__importDefault(require(a39_0x35f84f(0x1a7))),ListTicketsService_1=__importDefault(require('../services/TicketServices/ListTicketsService')),ShowTicketFromUUIDService_1=__importDefault(require(a39_0x35f84f(0x19d))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require(a39_0x35f84f(0x19b))),ListTicketsServiceKanban_1=__importDefault(require('../services/TicketServices/ListTicketsServiceKanban')),async_mutex_1=require(a39_0x35f84f(0x1c0)),User_1=__importDefault(require(a39_0x35f84f(0x1c8))),index=async(_0x41b5a1,_0x2ddb8c)=>{const _0x457e6f=a39_0x35f84f,{pageNumber:_0x5d3ff8,status:_0x3b9542,date:_0x38636c,updatedAt:_0xd8d724,searchParam:_0x12ae32,showAll:_0x29504c,queueIds:_0x53e495,tags:_0x3e1083,users:_0x229992,withUnreadMessages:_0x5b516}=_0x41b5a1[_0x457e6f(0x1cd)],_0x39ea1a=_0x41b5a1['user']['id'],{companyId:_0x865ec3}=_0x41b5a1[_0x457e6f(0x1b7)];let _0x54d81a=[],_0x4c7cd2=[],_0x149cd2=[];_0x53e495&&(_0x54d81a=JSON[_0x457e6f(0x19a)](_0x53e495));_0x3e1083&&(_0x4c7cd2=JSON[_0x457e6f(0x19a)](_0x3e1083));_0x229992&&(_0x149cd2=JSON[_0x457e6f(0x19a)](_0x229992));const _0x2376ca=_0x41b5a1['query'][_0x457e6f(0x1b4)],_0x377b87=_0x41b5a1[_0x457e6f(0x1cd)]['endDate'],{tickets:_0x9307ca,count:_0x1dfbf2,hasMore:_0x2a1461}=await(0x0,ListTicketsService_1[_0x457e6f(0x1b0)])({'searchParam':_0x12ae32,'tags':_0x4c7cd2,'users':_0x149cd2,'pageNumber':_0x5d3ff8,'status':_0x3b9542,'date':_0x38636c,'updatedAt':_0xd8d724,'showAll':_0x29504c,'userId':_0x39ea1a,'queueIds':_0x54d81a,'withUnreadMessages':_0x5b516,'companyId':_0x865ec3,'startDate':_0x2376ca,'endDate':_0x377b87});return _0x2ddb8c[_0x457e6f(0x1ba)](0xc8)[_0x457e6f(0x1c3)]({'tickets':_0x9307ca,'count':_0x1dfbf2,'hasMore':_0x2a1461});};exports[a39_0x35f84f(0x1bf)]=index;const store=async(_0x5e5edf,_0x259308)=>{const _0x2df0ee=a39_0x35f84f,{contactId:_0x2a217a,status:_0x324bee,userId:_0x54968a,queueId:_0x338fbd,whatsappId:_0x5d7d42}=_0x5e5edf[_0x2df0ee(0x1a0)],{companyId:_0x1da818,id:_0x226610}=_0x5e5edf[_0x2df0ee(0x1b7)],_0x47c5a8=await Ticket_1['default'][_0x2df0ee(0x1ca)]({'where':{'userId':_0x226610,'status':'open','companyId':_0x1da818}}),{limitAttendance:_0x11d9fa,name:_0x10a5f2}=await User_1[_0x2df0ee(0x1b0)][_0x2df0ee(0x1b5)](_0x226610);if(_0x47c5a8>=_0x11d9fa){}const _0x53817e=await(0x0,CreateTicketService_1[_0x2df0ee(0x1b0)])({'contactId':_0x2a217a,'status':_0x324bee,'userId':_0x54968a,'companyId':_0x1da818,'queueId':_0x338fbd,'whatsappId':_0x5d7d42}),_0x3341cc=(0x0,socket_1[_0x2df0ee(0x1a3)])();return _0x3341cc['to'](_0x2df0ee(0x1ae)+_0x53817e[_0x2df0ee(0x1a9)]+'-'+_0x53817e[_0x2df0ee(0x1ba)])['to'](_0x2df0ee(0x1ac)+_0x53817e[_0x2df0ee(0x1cc)]+'-'+_0x53817e[_0x2df0ee(0x1ba)])[_0x2df0ee(0x1a6)](_0x2df0ee(0x1ae)+_0x1da818+'-ticket',{'action':_0x2df0ee(0x19f),'ticket':_0x53817e}),_0x259308[_0x2df0ee(0x1ba)](0xc8)[_0x2df0ee(0x1c3)](_0x53817e);};exports['store']=store;const kanban=async(_0xbd1b0c,_0xbf8545)=>{const _0x3eb926=a39_0x35f84f,{pageNumber:_0x389bbe,status:_0x4cfb43,date:_0x2e0faa,updatedAt:_0x39e966,searchParam:_0x1194a5,showAll:_0x52fb91,queueIds:_0x12f157,tags:_0x367926,users:_0x50b884,withUnreadMessages:_0x413834}=_0xbd1b0c['query'],_0x200019=_0xbd1b0c[_0x3eb926(0x1b7)]['id'],{companyId:_0xe37765}=_0xbd1b0c[_0x3eb926(0x1b7)];let _0x3b36f9=[],_0x160f1d=[],_0x40007b=[];_0x12f157&&(_0x3b36f9=JSON[_0x3eb926(0x19a)](_0x12f157));_0x367926&&(_0x160f1d=JSON[_0x3eb926(0x19a)](_0x367926));_0x50b884&&(_0x40007b=JSON[_0x3eb926(0x19a)](_0x50b884));const {tickets:_0x4d965e,count:_0x4a1e2a,hasMore:_0x12048b}=await(0x0,ListTicketsServiceKanban_1[_0x3eb926(0x1b0)])({'searchParam':_0x1194a5,'tags':_0x160f1d,'users':_0x40007b,'pageNumber':_0x389bbe,'status':_0x4cfb43,'date':_0x2e0faa,'updatedAt':_0x39e966,'showAll':_0x52fb91,'userId':_0x200019,'queueIds':_0x3b36f9,'withUnreadMessages':_0x413834,'companyId':_0xe37765});return _0xbf8545[_0x3eb926(0x1ba)](0xc8)[_0x3eb926(0x1c3)]({'tickets':_0x4d965e,'count':_0x4a1e2a,'hasMore':_0x12048b});};exports[a39_0x35f84f(0x1ce)]=kanban;const show=async(_0x4fb7a3,_0x33edad)=>{const _0x184eae=a39_0x35f84f,{ticketId:_0x9fbf28}=_0x4fb7a3[_0x184eae(0x1b8)],{companyId:_0x248daf}=_0x4fb7a3[_0x184eae(0x1b7)],_0x13c472=await(0x0,ShowTicketService_1[_0x184eae(0x1b0)])(_0x9fbf28,_0x248daf);return _0x33edad[_0x184eae(0x1ba)](0xc8)[_0x184eae(0x1c3)](_0x13c472);};exports[a39_0x35f84f(0x1cb)]=show;function a39_0x1f68(_0x20c9d9,_0x27d2df){const _0x47eb37=a39_0x2d9a();return a39_0x1f68=function(_0x3e0805,_0x31b709){_0x3e0805=_0x3e0805-0x194;let _0x2d9a24=_0x47eb37[_0x3e0805];return _0x2d9a24;},a39_0x1f68(_0x20c9d9,_0x27d2df);}const showFromUUID=async(_0x1ee085,_0x3d7b0c)=>{const _0x3d2301=a39_0x35f84f,{uuid:_0x3d8247}=_0x1ee085[_0x3d2301(0x1b8)],_0x31e9c9=await(0x0,ShowTicketFromUUIDService_1[_0x3d2301(0x1b0)])(_0x3d8247);return _0x3d7b0c[_0x3d2301(0x1ba)](0xc8)['json'](_0x31e9c9);};exports[a39_0x35f84f(0x19e)]=showFromUUID;const closeAll=async(_0x11db5c,_0x53b06c)=>{const _0x27d73b=a39_0x35f84f,{companyId:_0x5d2108}=_0x11db5c[_0x27d73b(0x1b7)];var _0x3ff285=_0x11db5c[_0x27d73b(0x1a0)]['status'],_0x407283=await Ticket_1['default']['findAll']({'where':{'companyId':_0x5d2108,'status':_0x3ff285}});for(const _0x569dfc of _0x407283){(0x0,UpdateTicketService_1[_0x27d73b(0x1b0)])({'ticketData':{'status':'closed','userId':_0x569dfc[_0x27d73b(0x1a4)]||null,'queueId':_0x569dfc[_0x27d73b(0x1cc)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x569dfc['id'],'companyId':_0x5d2108});}return _0x53b06c['status'](0xc8)[_0x27d73b(0x1c3)]({'message':_0x27d73b(0x1a2)});};exports[a39_0x35f84f(0x1b6)]=closeAll;const update=async(_0x37242b,_0x1bc882)=>{const _0x41fde8=a39_0x35f84f,{ticketId:_0x2742b0}=_0x37242b[_0x41fde8(0x1b8)],_0x21763d=_0x37242b[_0x41fde8(0x1a0)],{companyId:_0x1d54b0,id:_0x4b0179}=_0x37242b[_0x41fde8(0x1b7)],_0x3dcc19=await Ticket_1['default']['count']({'where':{'userId':_0x4b0179,'status':_0x41fde8(0x1b9),'companyId':_0x1d54b0}}),{limitAttendance:_0x4a6d22,name:_0x34bda3}=await User_1['default'][_0x41fde8(0x1b5)](_0x4b0179);if(_0x21763d[_0x41fde8(0x1ba)]===_0x41fde8(0x1b9)&&_0x3dcc19>=_0x4a6d22){}const _0x152f41=new async_mutex_1['Mutex'](),{ticket:_0x279df7}=await _0x152f41[_0x41fde8(0x1bd)](async()=>{const _0x5ed3ca=_0x41fde8;return await(0x0,UpdateTicketService_1[_0x5ed3ca(0x1b0)])({'ticketData':_0x37242b['body'],'ticketId':_0x2742b0,'companyId':_0x1d54b0,'tokenData':_0x37242b[_0x5ed3ca(0x1c2)]});});return _0x1bc882[_0x41fde8(0x1ba)](0xc8)[_0x41fde8(0x1c3)](_0x279df7);};exports[a39_0x35f84f(0x19f)]=update;const remove=async(_0x2281fa,_0x3b903e)=>{const _0x207e93=a39_0x35f84f,{ticketId:_0x1817f8}=_0x2281fa[_0x207e93(0x1b8)],{companyId:_0x30e7d6}=_0x2281fa['user'];await(0x0,ShowTicketService_1[_0x207e93(0x1b0)])(_0x1817f8,_0x30e7d6);const _0x552b27=await(0x0,DeleteTicketService_1[_0x207e93(0x1b0)])(_0x1817f8),_0x45d416=(0x0,socket_1[_0x207e93(0x1a3)])();return _0x45d416['to'](_0x207e93(0x1ae)+_0x30e7d6+'-'+_0x552b27[_0x207e93(0x1ba)])['to'](_0x1817f8)['to'](_0x207e93(0x1ac)+_0x552b27[_0x207e93(0x1cc)]+_0x207e93(0x1c4))['to'](_0x207e93(0x1ac)+_0x552b27[_0x207e93(0x1cc)]+'-'+_0x552b27['status'])['to'](_0x207e93(0x1ae)+_0x552b27[_0x207e93(0x1a9)]+_0x207e93(0x1c4))[_0x207e93(0x1a6)]('company-'+_0x30e7d6+_0x207e93(0x1b2),{'action':_0x207e93(0x196),'ticketId':+_0x1817f8}),_0x3b903e[_0x207e93(0x1ba)](0xc8)[_0x207e93(0x1c3)]({'message':_0x207e93(0x1a1)});};exports[a39_0x35f84f(0x1c1)]=remove;