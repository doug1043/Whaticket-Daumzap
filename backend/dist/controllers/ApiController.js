const a9_0x43e66d=a9_0x5ddf;(function(_0x2fb951,_0xec58cf){const _0x197c8d=a9_0x5ddf,_0x47b9ff=_0x2fb951();while(!![]){try{const _0x29a261=-parseInt(_0x197c8d(0x160))/0x1*(parseInt(_0x197c8d(0x175))/0x2)+-parseInt(_0x197c8d(0x191))/0x3+-parseInt(_0x197c8d(0x185))/0x4*(-parseInt(_0x197c8d(0x142))/0x5)+parseInt(_0x197c8d(0x164))/0x6+-parseInt(_0x197c8d(0x13e))/0x7*(parseInt(_0x197c8d(0x1df))/0x8)+parseInt(_0x197c8d(0x162))/0x9*(-parseInt(_0x197c8d(0x1a3))/0xa)+parseInt(_0x197c8d(0x194))/0xb;if(_0x29a261===_0xec58cf)break;else _0x47b9ff['push'](_0x47b9ff['shift']());}catch(_0x1bb514){_0x47b9ff['push'](_0x47b9ff['shift']());}}}(a9_0x18f7,0x3414b));function a9_0x5ddf(_0x19de47,_0x1273e9){const _0x4e0076=a9_0x18f7();return a9_0x5ddf=function(_0x432bfe,_0x921999){_0x432bfe=_0x432bfe-0x13c;let _0x18f70c=_0x4e0076[_0x432bfe];return _0x18f70c;},a9_0x5ddf(_0x19de47,_0x1273e9);}const a9_0x921999=(function(){let _0x270925=!![];return function(_0x28f34c,_0x3a8f03){const _0x429f79=_0x270925?function(){const _0x456e88=a9_0x5ddf;if(_0x3a8f03){const _0x43b8f0=_0x3a8f03[_0x456e88(0x178)](_0x28f34c,arguments);return _0x3a8f03=null,_0x43b8f0;}}:function(){};return _0x270925=![],_0x429f79;};}()),a9_0x432bfe=a9_0x921999(this,function(){const _0x36a9e0=a9_0x5ddf;return a9_0x432bfe[_0x36a9e0(0x20f)]()[_0x36a9e0(0x18e)]('(((.+)+)+)+$')[_0x36a9e0(0x20f)]()[_0x36a9e0(0x205)](a9_0x432bfe)[_0x36a9e0(0x18e)](_0x36a9e0(0x1fc));});a9_0x432bfe();'use strict';var __createBinding=this&&this[a9_0x43e66d(0x1c9)]||(Object[a9_0x43e66d(0x1a4)]?function(_0x2ca928,_0x2c72e5,_0x5a7a3e,_0x588d8a){const _0x1e4ae7=a9_0x43e66d;if(_0x588d8a===undefined)_0x588d8a=_0x5a7a3e;var _0x5cff82=Object[_0x1e4ae7(0x1d0)](_0x2c72e5,_0x5a7a3e);(!_0x5cff82||('get'in _0x5cff82?!_0x2c72e5[_0x1e4ae7(0x1cc)]:_0x5cff82[_0x1e4ae7(0x148)]||_0x5cff82[_0x1e4ae7(0x1f3)]))&&(_0x5cff82={'enumerable':!![],'get':function(){return _0x2c72e5[_0x5a7a3e];}}),Object[_0x1e4ae7(0x16c)](_0x2ca928,_0x588d8a,_0x5cff82);}:function(_0x38c0f9,_0x87082b,_0x4aaf83,_0x54471d){if(_0x54471d===undefined)_0x54471d=_0x4aaf83;_0x38c0f9[_0x54471d]=_0x87082b[_0x4aaf83];}),__setModuleDefault=this&&this[a9_0x43e66d(0x1de)]||(Object[a9_0x43e66d(0x1a4)]?function(_0x5a1990,_0x3988f0){const _0x551aab=a9_0x43e66d;Object[_0x551aab(0x16c)](_0x5a1990,'default',{'enumerable':!![],'value':_0x3988f0});}:function(_0xc6f6b9,_0x45604b){const _0xa8dd7b=a9_0x43e66d;_0xc6f6b9[_0xa8dd7b(0x1ba)]=_0x45604b;}),__importStar=this&&this['__importStar']||function(_0x174c13){const _0x11a2d3=a9_0x43e66d;if(_0x174c13&&_0x174c13[_0x11a2d3(0x1cc)])return _0x174c13;var _0x2cbd9c={};if(_0x174c13!=null){for(var _0x36a733 in _0x174c13)if(_0x36a733!==_0x11a2d3(0x1ba)&&Object[_0x11a2d3(0x1cd)][_0x11a2d3(0x1a1)][_0x11a2d3(0x17c)](_0x174c13,_0x36a733))__createBinding(_0x2cbd9c,_0x174c13,_0x36a733);}return __setModuleDefault(_0x2cbd9c,_0x174c13),_0x2cbd9c;},__importDefault=this&&this[a9_0x43e66d(0x1c4)]||function(_0x22d56b){return _0x22d56b&&_0x22d56b['__esModule']?_0x22d56b:{'default':_0x22d56b};};Object['defineProperty'](exports,a9_0x43e66d(0x1cc),{'value':!![]}),exports[a9_0x43e66d(0x153)]=exports[a9_0x43e66d(0x1b6)]=exports[a9_0x43e66d(0x210)]=exports[a9_0x43e66d(0x147)]=exports['removeAllContacts']=exports[a9_0x43e66d(0x177)]=exports[a9_0x43e66d(0x146)]=exports[a9_0x43e66d(0x149)]=exports[a9_0x43e66d(0x1c0)]=exports[a9_0x43e66d(0x1a8)]=exports[a9_0x43e66d(0x181)]=exports[a9_0x43e66d(0x143)]=exports['showAllApi']=exports[a9_0x43e66d(0x1e1)]=exports[a9_0x43e66d(0x1b7)]=exports[a9_0x43e66d(0x14e)]=exports[a9_0x43e66d(0x1ea)]=exports[a9_0x43e66d(0x145)]=exports[a9_0x43e66d(0x208)]=exports[a9_0x43e66d(0x18b)]=exports[a9_0x43e66d(0x161)]=exports['updateTicketTag']=exports['closeTicket']=exports[a9_0x43e66d(0x1d8)]=exports[a9_0x43e66d(0x197)]=exports[a9_0x43e66d(0x1b4)]=exports[a9_0x43e66d(0x17e)]=exports[a9_0x43e66d(0x1a2)]=exports[a9_0x43e66d(0x186)]=exports[a9_0x43e66d(0x144)]=exports[a9_0x43e66d(0x1ac)]=exports['createCompany']=exports[a9_0x43e66d(0x168)]=void 0x0;const axios_1=__importDefault(require(a9_0x43e66d(0x172))),fs_1=__importDefault(require('fs')),Yup=__importStar(require(a9_0x43e66d(0x1a5))),lodash_1=require(a9_0x43e66d(0x212)),GetDefaultWhatsApp_1=__importDefault(require(a9_0x43e66d(0x196))),SetTicketMessagesAsRead_1=__importDefault(require('../helpers/SetTicketMessagesAsRead')),socket_1=require(a9_0x43e66d(0x19e)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),Queue_1=__importDefault(require(a9_0x43e66d(0x198))),User_1=__importDefault(require('../models/User')),CreateOrUpdateContactService_1=__importDefault(require(a9_0x43e66d(0x1e4))),FindOrCreateTicketService_1=__importDefault(require(a9_0x43e66d(0x167))),ShowTicketService_1=__importDefault(require(a9_0x43e66d(0x1bf))),GetProfilePicUrl_1=__importDefault(require(a9_0x43e66d(0x1d6))),SendWhatsAppMedia_1=__importDefault(require('../services/WbotServices/SendWhatsAppMedia')),UpdateTicketService_1=__importDefault(require('../services/TicketServices/UpdateTicketService')),wbot_1=require(a9_0x43e66d(0x1ae)),SendWhatsAppMessageLink_1=__importDefault(require('../services/WbotServices/SendWhatsAppMessageLink')),SendWhatsAppMessageAPI_1=__importDefault(require(a9_0x43e66d(0x156))),SendWhatsappMediaImage_1=__importDefault(require(a9_0x43e66d(0x15e))),ListInvoicesServices_1=__importDefault(require(a9_0x43e66d(0x15b))),ShowInvoiceService_1=__importDefault(require(a9_0x43e66d(0x158))),UpdateInvoiceService_1=__importDefault(require(a9_0x43e66d(0x17d))),Invoices_1=__importDefault(require(a9_0x43e66d(0x211))),ListContactsService_1=__importDefault(require(a9_0x43e66d(0x1e7))),CreateContactService_1=__importDefault(require('../services/ContactServices/CreateContactService')),ShowContactService_1=__importDefault(require('../services/ContactServices/ShowContactService')),UpdateContactService_1=__importDefault(require(a9_0x43e66d(0x1e2))),DeleteContactService_1=__importDefault(require(a9_0x43e66d(0x1c8))),GetContactService_1=__importDefault(require(a9_0x43e66d(0x1b3))),ToggleDisableBotService_1=__importDefault(require('../services/ContactServices/ToggleDisableBotService')),CheckNumber_1=__importDefault(require(a9_0x43e66d(0x1b0))),CheckIsValidContact_1=__importDefault(require('../services/WbotServices/CheckIsValidContact')),AppError_1=__importDefault(require(a9_0x43e66d(0x1d2))),SimpleListService_1=__importDefault(require(a9_0x43e66d(0x190))),ImportXLSContactsService_1=require(a9_0x43e66d(0x1da)),ApiUsages_1=__importDefault(require('../models/ApiUsages')),useDate_1=require(a9_0x43e66d(0x1d7)),TicketTag_1=__importDefault(require(a9_0x43e66d(0x1d1))),Tag_1=__importDefault(require('../models/Tag')),moment_1=__importDefault(require(a9_0x43e66d(0x1dd))),path_1=__importDefault(require(a9_0x43e66d(0x1d9))),Ticket_1=__importDefault(require(a9_0x43e66d(0x1d5))),Contact_1=__importDefault(require('../models/Contact')),Company_1=__importDefault(require(a9_0x43e66d(0x192))),SendPresenceStatus_1=require('../helpers/SendPresenceStatus');class OnWhatsAppDto{constructor(_0x215e95,_0xb465e2){const _0x12c801=a9_0x43e66d;this[_0x12c801(0x202)]=_0x215e95,this[_0x12c801(0x1eb)]=_0xb465e2;}}exports[a9_0x43e66d(0x168)]=OnWhatsAppDto;const CompanySchema=Yup[a9_0x43e66d(0x151)]()[a9_0x43e66d(0x155)]({'name':Yup[a9_0x43e66d(0x20b)]()[a9_0x43e66d(0x1f9)](),'id':Yup['number'](),'phone':Yup[a9_0x43e66d(0x20b)]()['nullable'](),'email':Yup[a9_0x43e66d(0x20b)]()[a9_0x43e66d(0x159)]()[a9_0x43e66d(0x1bc)](),'status':Yup[a9_0x43e66d(0x150)]()[a9_0x43e66d(0x1bc)](),'planId':Yup[a9_0x43e66d(0x165)]()[a9_0x43e66d(0x1bc)](),'campaignsEnabled':Yup[a9_0x43e66d(0x150)]()[a9_0x43e66d(0x1bc)](),'dueDate':Yup[a9_0x43e66d(0x1a6)]()[a9_0x43e66d(0x1bc)](),'recurrence':Yup[a9_0x43e66d(0x20b)]()[a9_0x43e66d(0x1bc)]()}),createCompany=async(_0x30842b,_0x20cf78)=>{const _0x2d6e7e=a9_0x43e66d;try{await CompanySchema['validate'](_0x30842b['body']);const _0xaecf5a=await Company_1['default'][_0x2d6e7e(0x1a4)](_0x30842b[_0x2d6e7e(0x1fb)]);_0x20cf78[_0x2d6e7e(0x1aa)](0xc9)['json'](_0xaecf5a);}catch(_0x100672){_0x20cf78[_0x2d6e7e(0x1aa)](0x190)['json']({'error':_0x100672['message']});}};exports[a9_0x43e66d(0x154)]=createCompany;const updateCompany=async(_0x3cd044,_0x4f9ab5)=>{const _0x93ba24=a9_0x43e66d;try{await CompanySchema[_0x93ba24(0x20e)](_0x3cd044['body']);const {id:_0x526675}=_0x3cd044[_0x93ba24(0x170)],[_0x5aae68]=await Company_1[_0x93ba24(0x1ba)][_0x93ba24(0x184)](_0x3cd044[_0x93ba24(0x1fb)],{'where':{'id':_0x526675}});if(_0x5aae68){const _0x2bcd25=await Company_1[_0x93ba24(0x1ba)]['findByPk'](_0x526675);_0x4f9ab5[_0x93ba24(0x1aa)](0xc8)[_0x93ba24(0x200)](_0x2bcd25);}else _0x4f9ab5[_0x93ba24(0x1aa)](0x194)[_0x93ba24(0x200)]({'error':_0x93ba24(0x19d)});}catch(_0x2f5b10){_0x4f9ab5[_0x93ba24(0x1aa)](0x190)['json']({'error':_0x2f5b10[_0x93ba24(0x16b)]});}};exports['updateCompany']=updateCompany;const blockCompany=async(_0x475805,_0x275061)=>{const _0x344a73=a9_0x43e66d;try{const {id:_0x218cbb}=_0x475805['params'],[_0x231684]=await Company_1[_0x344a73(0x1ba)][_0x344a73(0x184)]({'status':![]},{'where':{'id':_0x218cbb}});if(_0x231684){const _0x1a941e=await Company_1[_0x344a73(0x1ba)][_0x344a73(0x15d)](_0x218cbb);_0x275061[_0x344a73(0x1aa)](0xc8)['json'](_0x1a941e);}else _0x275061[_0x344a73(0x1aa)](0x194)[_0x344a73(0x200)]({'error':'Company\x20not\x20found'});}catch(_0x58f531){_0x275061['status'](0x190)[_0x344a73(0x200)]({'error':_0x58f531['message']});}};exports[a9_0x43e66d(0x144)]=blockCompany;const createContact=async(_0x2be1d0,_0x1cbf6f,_0x42a585)=>{const _0x2778c3=a9_0x43e66d;await(0x0,CheckIsValidContact_1[_0x2778c3(0x1ba)])(_0x42a585,_0x1cbf6f);const _0x2d88f1=await(0x0,CheckNumber_1[_0x2778c3(0x1ba)])(_0x42a585,_0x1cbf6f),_0x1ca8fd=await(0x0,GetProfilePicUrl_1[_0x2778c3(0x1ba)])(_0x2d88f1,_0x1cbf6f),_0x4972fb=_0x2d88f1,_0x4e72d4={'name':''+_0x4972fb,'number':_0x4972fb,'profilePicUrl':_0x1ca8fd,'isGroup':![],'companyId':_0x1cbf6f},_0x476d73=await(0x0,CreateOrUpdateContactService_1[_0x2778c3(0x1ba)])(_0x4e72d4,null,null);let _0x4efe05;if(_0x2be1d0===undefined)_0x4efe05=await(0x0,GetDefaultWhatsApp_1[_0x2778c3(0x1ba)])(_0x1cbf6f);else{_0x4efe05=await Whatsapp_1['default'][_0x2778c3(0x15d)](_0x2be1d0);if(_0x4efe05===null)throw new AppError_1[(_0x2778c3(0x1ba))](_0x2778c3(0x193)+_0x2be1d0+_0x2778c3(0x203));}const _0x22ff67=await(0x0,FindOrCreateTicketService_1[_0x2778c3(0x1ba)])(_0x476d73,_0x4efe05['id'],0x0,_0x1cbf6f),_0x293a59=await(0x0,ShowTicketService_1[_0x2778c3(0x1ba)])(_0x22ff67['id'],_0x1cbf6f);return(0x0,SetTicketMessagesAsRead_1[_0x2778c3(0x1ba)])(_0x293a59),_0x293a59;};function formatBRNumber(_0x2757f1){const _0x2b2112=a9_0x43e66d,_0x7bec4f=new RegExp(/^(\d{2})(\d{2})\d{1}(\d{8})$/);if(_0x7bec4f['test'](_0x2757f1)){const _0x287748=_0x7bec4f[_0x2b2112(0x1c2)](_0x2757f1);if(_0x287748&&_0x287748[0x1]==='55'&&Number[_0x2b2112(0x1b8)](Number['parseInt'](_0x287748[0x2]))){const _0x28199c=Number[_0x2b2112(0x1be)](_0x287748[0x2]);if(_0x28199c<0x1f)return _0x287748[0x0];else{if(_0x28199c>=0x1f)return _0x287748[0x1]+_0x287748[0x2]+_0x287748[0x3];}}}else return _0x2757f1;}function createJid(_0x126625){const _0x19cac7=a9_0x43e66d;if(_0x126625['includes'](_0x19cac7(0x174))||_0x126625[_0x19cac7(0x1ad)](_0x19cac7(0x157)))return formatBRNumber(_0x126625);return _0x126625[_0x19cac7(0x1ad)]('-')?_0x126625+_0x19cac7(0x174):formatBRNumber(_0x126625)+'@s.whatsapp.net';}const indexLink=async(_0x280ebb,_0x56736c)=>{const _0x2ca8fa=a9_0x43e66d,_0x282370=_0x280ebb[_0x2ca8fa(0x1fb)],{whatsappId:_0x5c275a}=_0x280ebb[_0x2ca8fa(0x1fb)],{msdelay:_0x5f3666}=_0x280ebb[_0x2ca8fa(0x1fb)],_0xf4228b=_0x280ebb[_0x2ca8fa(0x1fb)][_0x2ca8fa(0x14b)],_0x26e044=_0x280ebb[_0x2ca8fa(0x1fb)][_0x2ca8fa(0x16f)],_0x426eda=_0x280ebb[_0x2ca8fa(0x14d)][_0x2ca8fa(0x1db)],[,_0x4310ba]=_0x426eda[_0x2ca8fa(0x1bb)]('\x20'),_0x1bb2ad=await Whatsapp_1[_0x2ca8fa(0x1ba)][_0x2ca8fa(0x1fd)]({'where':{'token':_0x4310ba}}),_0x2bea5a=_0x1bb2ad[_0x2ca8fa(0x1f4)];_0x282370[_0x2ca8fa(0x165)]=_0x282370[_0x2ca8fa(0x165)][_0x2ca8fa(0x13d)]('-','')[_0x2ca8fa(0x13d)]('\x20','');const _0x5280c8=Yup[_0x2ca8fa(0x151)]()[_0x2ca8fa(0x155)]({'number':Yup['string']()[_0x2ca8fa(0x1f9)]()[_0x2ca8fa(0x18d)](/^\d+$/,_0x2ca8fa(0x16e))});try{await _0x5280c8[_0x2ca8fa(0x20e)](_0x282370);}catch(_0x5f54a2){throw new AppError_1[(_0x2ca8fa(0x1ba))](_0x5f54a2[_0x2ca8fa(0x16b)]);}const _0x27b53e=await createContact(_0x5c275a,_0x2bea5a,_0x282370[_0x2ca8fa(0x165)]);return await(0x0,SendWhatsAppMessageLink_1[_0x2ca8fa(0x1ba)])({'ticket':_0x27b53e,'url':_0xf4228b,'caption':_0x26e044,'msdelay':_0x5f3666}),setTimeout(async()=>{const _0x2cbd43=_0x2ca8fa;await(0x0,UpdateTicketService_1[_0x2cbd43(0x1ba)])({'ticketId':_0x27b53e['id'],'ticketData':{'status':_0x2cbd43(0x19c),'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x2bea5a});},0xc8),setTimeout(async()=>{const _0xc064e9=_0x2ca8fa,{dateToClient:_0x54334b}=(0x0,useDate_1[_0xc064e9(0x18a)])(),_0x281159=_0x54334b(new Date()[_0xc064e9(0x20f)]()),_0x136fb0=(0x0,moment_1[_0xc064e9(0x1ba)])()[_0xc064e9(0x1c1)](),_0x289550=await ApiUsages_1[_0xc064e9(0x1ba)]['findOne']({'where':{'dateUsed':_0x281159,'companyId':_0x2bea5a}});if(_0x289550)await _0x289550[_0xc064e9(0x184)]({'usedPDF':_0x289550[_0xc064e9(0x1e3)][_0xc064e9(0x1dc)]+0x1,'UsedOnDay':_0x289550[_0xc064e9(0x1e3)][_0xc064e9(0x1b9)]+0x1,'updatedAt':_0x136fb0});else{const _0xee9450=await ApiUsages_1[_0xc064e9(0x1ba)][_0xc064e9(0x1a4)]({'companyId':_0x2bea5a,'dateUsed':_0x281159});await _0xee9450['update']({'usedPDF':_0xee9450['dataValues'][_0xc064e9(0x1dc)]+0x1,'UsedOnDay':_0xee9450['dataValues'][_0xc064e9(0x1b9)]+0x1,'updatedAt':_0x136fb0});}},0x64),_0x56736c['send']({'status':_0x2ca8fa(0x17b)});};exports[a9_0x43e66d(0x186)]=indexLink;const index=async(_0x28e041,_0x4542dd)=>{const _0x2cebf8=a9_0x43e66d,_0x24ec78=_0x28e041[_0x2cebf8(0x1fb)],{whatsappId:_0x4c1d74}=_0x28e041['body'],{msdelay:_0x47ee6e}=_0x28e041[_0x2cebf8(0x1fb)],{body:_0x140fad,quotedMsg:_0x3b1b2f}=_0x28e041[_0x2cebf8(0x1fb)],_0xe81f33=_0x28e041[_0x2cebf8(0x201)],_0x3ccf61=_0x28e041[_0x2cebf8(0x14d)][_0x2cebf8(0x1db)],[,_0x1a08a6]=_0x3ccf61[_0x2cebf8(0x1bb)]('\x20'),_0x508341=await Whatsapp_1[_0x2cebf8(0x1ba)][_0x2cebf8(0x1fd)]({'where':{'token':_0x1a08a6}}),_0x45ccc4=_0x508341[_0x2cebf8(0x1f4)];_0x24ec78['number']=_0x24ec78['number'][_0x2cebf8(0x13d)]('-','')[_0x2cebf8(0x13d)]('\x20','');const _0x448764=Yup[_0x2cebf8(0x151)]()[_0x2cebf8(0x155)]({'number':Yup[_0x2cebf8(0x20b)]()[_0x2cebf8(0x1f9)]()[_0x2cebf8(0x18d)](/^\d+$/,_0x2cebf8(0x16e))});try{await _0x448764[_0x2cebf8(0x20e)](_0x24ec78);}catch(_0x2d776e){throw new AppError_1[(_0x2cebf8(0x1ba))](_0x2d776e[_0x2cebf8(0x16b)]);}const _0x4157b9=await createContact(_0x4c1d74,_0x45ccc4,_0x24ec78[_0x2cebf8(0x165)]);return _0xe81f33?await Promise[_0x2cebf8(0x1d4)](_0xe81f33['map'](async _0x3092f8=>{await(0x0,SendWhatsAppMedia_1['default'])({'body':_0x140fad,'media':_0x3092f8,'ticket':_0x4157b9});})):await(0x0,SendWhatsAppMessageAPI_1[_0x2cebf8(0x1ba)])({'body':_0x140fad,'ticket':_0x4157b9,'quotedMsg':_0x3b1b2f,'msdelay':_0x47ee6e}),setTimeout(async()=>{const _0x5e5b68=_0x2cebf8;await(0x0,UpdateTicketService_1[_0x5e5b68(0x1ba)])({'ticketId':_0x4157b9['id'],'ticketData':{'status':_0x5e5b68(0x19c),'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x45ccc4});},0x64),setTimeout(async()=>{const _0x2de264=_0x2cebf8,{dateToClient:_0x12f4d4}=(0x0,useDate_1[_0x2de264(0x18a)])(),_0x1925e1=_0x12f4d4(new Date()['toString']()),_0x3bb1aa=(0x0,moment_1[_0x2de264(0x1ba)])()[_0x2de264(0x1c1)](),_0xd46d89=await ApiUsages_1[_0x2de264(0x1ba)][_0x2de264(0x1fd)]({'where':{'dateUsed':_0x1925e1,'companyId':_0x45ccc4}});_0xd46d89?_0xe81f33?await Promise[_0x2de264(0x1d4)](_0xe81f33[_0x2de264(0x180)](async _0x14f230=>{const _0x181b93=_0x2de264;console['log'](_0x181b93(0x13c),_0x14f230);const _0x585d7f=path_1[_0x181b93(0x1ba)]['extname'](_0x14f230['originalname']);console[_0x181b93(0x1c3)]('type',_0x585d7f);if(_0x14f230[_0x181b93(0x1fa)][_0x181b93(0x1ad)](_0x181b93(0x20a)))await _0xd46d89[_0x181b93(0x184)]({'usedPDF':_0xd46d89[_0x181b93(0x1e3)][_0x181b93(0x1dc)]+0x1,'UsedOnDay':_0xd46d89['dataValues']['UsedOnDay']+0x1,'updatedAt':_0x3bb1aa});else{if(_0x14f230['mimetype'][_0x181b93(0x1ad)](_0x181b93(0x166)))await _0xd46d89['update']({'usedImage':_0xd46d89[_0x181b93(0x1e3)][_0x181b93(0x19b)]+0x1,'UsedOnDay':_0xd46d89['dataValues'][_0x181b93(0x1b9)]+0x1,'updatedAt':_0x3bb1aa});else _0x14f230[_0x181b93(0x1fa)][_0x181b93(0x1ad)]('video')?await _0xd46d89['update']({'usedVideo':_0xd46d89[_0x181b93(0x1e3)][_0x181b93(0x206)]+0x1,'UsedOnDay':_0xd46d89[_0x181b93(0x1e3)][_0x181b93(0x1b9)]+0x1,'updatedAt':_0x3bb1aa}):await _0xd46d89['update']({'usedOther':_0xd46d89[_0x181b93(0x1e3)]['usedOther']+0x1,'UsedOnDay':_0xd46d89[_0x181b93(0x1e3)][_0x181b93(0x1b9)]+0x1,'updatedAt':_0x3bb1aa});}})):await _0xd46d89[_0x2de264(0x184)]({'usedText':_0xd46d89[_0x2de264(0x1e3)][_0x2de264(0x1ec)]+0x1,'UsedOnDay':_0xd46d89[_0x2de264(0x1e3)][_0x2de264(0x1b9)]+0x1,'updatedAt':_0x3bb1aa}):(await ApiUsages_1[_0x2de264(0x1ba)][_0x2de264(0x1a4)]({'companyId':_0x45ccc4,'dateUsed':_0x1925e1}),_0xe81f33?await Promise[_0x2de264(0x1d4)](_0xe81f33[_0x2de264(0x180)](async _0x4cf7cf=>{const _0x5be09e=_0x2de264;console[_0x5be09e(0x1c3)](_0x5be09e(0x13c),_0x4cf7cf);const _0x9addc5=path_1[_0x5be09e(0x1ba)][_0x5be09e(0x1f5)](_0x4cf7cf[_0x5be09e(0x17f)]);console[_0x5be09e(0x1c3)](_0x5be09e(0x1f2),_0x9addc5);if(_0x4cf7cf[_0x5be09e(0x1fa)][_0x5be09e(0x1ad)](_0x5be09e(0x20a)))await _0xd46d89[_0x5be09e(0x184)]({'usedPDF':_0xd46d89[_0x5be09e(0x1e3)][_0x5be09e(0x1dc)]+0x1,'UsedOnDay':_0xd46d89[_0x5be09e(0x1e3)][_0x5be09e(0x1b9)]+0x1,'updatedAt':_0x3bb1aa});else{if(_0x4cf7cf[_0x5be09e(0x1fa)][_0x5be09e(0x1ad)](_0x5be09e(0x166)))await _0xd46d89[_0x5be09e(0x184)]({'usedImage':_0xd46d89[_0x5be09e(0x1e3)][_0x5be09e(0x19b)]+0x1,'UsedOnDay':_0xd46d89['dataValues'][_0x5be09e(0x1b9)]+0x1,'updatedAt':_0x3bb1aa});else _0x4cf7cf['mimetype'][_0x5be09e(0x1ad)](_0x5be09e(0x1f1))?await _0xd46d89['update']({'usedVideo':_0xd46d89['dataValues']['usedVideo']+0x1,'UsedOnDay':_0xd46d89['dataValues'][_0x5be09e(0x1b9)]+0x1,'updatedAt':_0x3bb1aa}):await _0xd46d89[_0x5be09e(0x184)]({'usedOther':_0xd46d89['dataValues'][_0x5be09e(0x195)]+0x1,'UsedOnDay':_0xd46d89['dataValues'][_0x5be09e(0x1b9)]+0x1,'updatedAt':_0x3bb1aa});}})):await _0xd46d89[_0x2de264(0x184)]({'usedText':_0xd46d89[_0x2de264(0x1e3)][_0x2de264(0x1ec)]+0x1,'UsedOnDay':_0xd46d89[_0x2de264(0x1e3)][_0x2de264(0x1b9)]+0x1,'updatedAt':_0x3bb1aa}));},0x64),_0x4542dd[_0x2cebf8(0x182)]({'status':'SUCCESS'});};exports[a9_0x43e66d(0x1a2)]=index;const indexImage=async(_0x2db362,_0x51a82f)=>{const _0xbe9eac=a9_0x43e66d,_0x577309=_0x2db362[_0xbe9eac(0x1fb)],{whatsappId:_0x10ed66}=_0x2db362[_0xbe9eac(0x1fb)],{msdelay:_0x40b959}=_0x2db362[_0xbe9eac(0x1fb)],_0x33eaa5=_0x2db362[_0xbe9eac(0x1fb)]['url'],_0x1b8f7c=_0x2db362[_0xbe9eac(0x1fb)][_0xbe9eac(0x16f)],_0x256c8d=_0x2db362[_0xbe9eac(0x14d)][_0xbe9eac(0x1db)],[,_0x15f95b]=_0x256c8d[_0xbe9eac(0x1bb)]('\x20'),_0x346f85=await Whatsapp_1[_0xbe9eac(0x1ba)][_0xbe9eac(0x1fd)]({'where':{'token':_0x15f95b}}),_0x3a9d94=_0x346f85['companyId'];_0x577309['number']=_0x577309['number'][_0xbe9eac(0x13d)]('-','')[_0xbe9eac(0x13d)]('\x20','');const _0x334b6f=Yup['object']()['shape']({'number':Yup[_0xbe9eac(0x20b)]()[_0xbe9eac(0x1f9)]()[_0xbe9eac(0x18d)](/^\d+$/,_0xbe9eac(0x16e))});try{await _0x334b6f[_0xbe9eac(0x20e)](_0x577309);}catch(_0xc8032c){throw new AppError_1[(_0xbe9eac(0x1ba))](_0xc8032c['message']);}const _0x5b2b41=await createContact(_0x10ed66,_0x3a9d94,_0x577309[_0xbe9eac(0x165)]);return _0x33eaa5&&await(0x0,SendWhatsappMediaImage_1[_0xbe9eac(0x1ba)])({'ticket':_0x5b2b41,'url':_0x33eaa5,'caption':_0x1b8f7c,'msdelay':_0x40b959}),setTimeout(async()=>{const _0xedde04=_0xbe9eac;await(0x0,UpdateTicketService_1[_0xedde04(0x1ba)])({'ticketId':_0x5b2b41['id'],'ticketData':{'status':_0xedde04(0x19c),'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x3a9d94});},0x64),setTimeout(async()=>{const _0x118980=_0xbe9eac,{dateToClient:_0x1e9cac}=(0x0,useDate_1[_0x118980(0x18a)])(),_0x156f2a=_0x1e9cac(new Date()[_0x118980(0x20f)]()),_0x1a4297=(0x0,moment_1[_0x118980(0x1ba)])()[_0x118980(0x1c1)](),_0x215ef7=await ApiUsages_1[_0x118980(0x1ba)][_0x118980(0x1fd)]({'where':{'dateUsed':_0x156f2a,'companyId':_0x3a9d94}});if(_0x215ef7)await _0x215ef7['update']({'usedImage':_0x215ef7[_0x118980(0x1e3)][_0x118980(0x19b)]+0x1,'UsedOnDay':_0x215ef7[_0x118980(0x1e3)]['UsedOnDay']+0x1,'updatedAt':_0x1a4297});else{const _0x5b505f=await ApiUsages_1[_0x118980(0x1ba)][_0x118980(0x1a4)]({'companyId':_0x3a9d94,'dateUsed':_0x156f2a});await _0x5b505f[_0x118980(0x184)]({'usedImage':_0x5b505f['dataValues']['usedImage']+0x1,'UsedOnDay':_0x5b505f[_0x118980(0x1e3)]['UsedOnDay']+0x1,'updatedAt':_0x1a4297});}},0x64),_0x51a82f[_0xbe9eac(0x182)]({'status':_0xbe9eac(0x17b)});};exports['indexImage']=indexImage;const checkNumber=async(_0x5905ad,_0x238773)=>{const _0x36eda5=a9_0x43e66d,_0x3fad12=_0x5905ad['body'],_0x5bfeaf=_0x5905ad[_0x36eda5(0x14d)][_0x36eda5(0x1db)],[,_0x2b6e2c]=_0x5bfeaf[_0x36eda5(0x1bb)]('\x20'),_0x221e8c=await Whatsapp_1['default']['findOne']({'where':{'token':_0x2b6e2c}}),_0x139e51=_0x221e8c[_0x36eda5(0x1f4)],_0x4270d4=_0x3fad12[_0x36eda5(0x165)][_0x36eda5(0x13d)]('-','')[_0x36eda5(0x13d)]('\x20',''),_0x274edf=await(0x0,GetDefaultWhatsApp_1[_0x36eda5(0x1ba)])(_0x139e51),_0x2f6a29=(0x0,wbot_1[_0x36eda5(0x207)])(_0x274edf['id']),_0x4b39f6=createJid(_0x4270d4);try{const [_0x1e2367]=await _0x2f6a29['onWhatsApp'](_0x4b39f6);if(_0x1e2367[_0x36eda5(0x1eb)])return setTimeout(async()=>{const _0x4b9417=_0x36eda5,{dateToClient:_0x9317ff}=(0x0,useDate_1[_0x4b9417(0x18a)])(),_0x5dd740=_0x9317ff(new Date()['toString']()),_0x1a30c3=(0x0,moment_1[_0x4b9417(0x1ba)])()[_0x4b9417(0x1c1)](),_0x495351=await ApiUsages_1['default'][_0x4b9417(0x1fd)]({'where':{'dateUsed':_0x5dd740,'companyId':_0x139e51}});if(_0x495351)await _0x495351[_0x4b9417(0x184)]({'usedCheckNumber':_0x495351[_0x4b9417(0x1e3)][_0x4b9417(0x16a)]+0x1,'UsedOnDay':_0x495351[_0x4b9417(0x1e3)]['UsedOnDay']+0x1,'updatedAt':_0x1a30c3});else{const _0x4ddc81=await ApiUsages_1[_0x4b9417(0x1ba)][_0x4b9417(0x1a4)]({'companyId':_0x139e51,'dateUsed':_0x5dd740});await _0x4ddc81[_0x4b9417(0x184)]({'usedCheckNumber':_0x4ddc81[_0x4b9417(0x1e3)][_0x4b9417(0x16a)]+0x1,'UsedOnDay':_0x4ddc81['dataValues'][_0x4b9417(0x1b9)]+0x1,'updatedAt':_0x1a30c3});}},0x64),_0x238773[_0x36eda5(0x1aa)](0xc8)[_0x36eda5(0x200)]({'existsInWhatsapp':!![],'number':_0x4270d4,'numberFormatted':_0x1e2367['jid']});}catch(_0xd27515){return _0x238773['status'](0x190)[_0x36eda5(0x200)]({'existsInWhatsapp':![],'number':_0x4b39f6,'error':_0x36eda5(0x183)});}};exports[a9_0x43e66d(0x1b4)]=checkNumber;const indexWhatsappsId=async(_0x1390e8,_0x131b9c)=>{const _0x5e5062=a9_0x43e66d;return console[_0x5e5062(0x1c3)](_0x5e5062(0x1b2),_0x1390e8),console['log'](_0x5e5062(0x1b2),_0x1390e8[_0x5e5062(0x1c5)]),_0x131b9c[_0x5e5062(0x1aa)](0xc8)['json']('oi');};exports[a9_0x43e66d(0x197)]=indexWhatsappsId;const updateQueueId=async(_0x40215a,_0x609767)=>{const _0x151d1d=a9_0x43e66d,{ticketId:_0x56448e}=_0x40215a[_0x151d1d(0x170)],{queueId:_0x4411e9}=_0x40215a[_0x151d1d(0x1fb)],_0x1fe566=_0x40215a[_0x151d1d(0x14d)][_0x151d1d(0x1db)],[,_0x23e458]=_0x1fe566[_0x151d1d(0x1bb)]('\x20'),_0x42260e=await Whatsapp_1[_0x151d1d(0x1ba)][_0x151d1d(0x1fd)]({'where':{'token':_0x23e458}}),_0x3c2d0a=_0x42260e[_0x151d1d(0x1f4)];try{const _0x609ef4=await Queue_1['default'][_0x151d1d(0x1fd)]({'where':{'id':_0x4411e9,'companyId':_0x3c2d0a}});if(!_0x609ef4)return _0x609767[_0x151d1d(0x1aa)](0x190)[_0x151d1d(0x200)]({'status':_0x151d1d(0x176),'error':_0x151d1d(0x169)});return await(0x0,UpdateTicketService_1[_0x151d1d(0x1ba)])({'ticketId':_0x56448e,'ticketData':{'queueId':_0x4411e9},'companyId':_0x3c2d0a}),_0x609767['status'](0xc8)['json']({'status':_0x151d1d(0x17b)});}catch(_0x4d68ed){return console[_0x151d1d(0x1e6)](_0x4d68ed),_0x609767[_0x151d1d(0x1aa)](0x1f4)['json']({'status':_0x151d1d(0x176),'error':'Internal\x20Server\x20Error'});}};exports[a9_0x43e66d(0x1d8)]=updateQueueId;const closeTicket=async(_0xc14077,_0x3fc8ef)=>{const _0x1de2e4=a9_0x43e66d,_0x45cecb=_0xc14077[_0x1de2e4(0x14d)][_0x1de2e4(0x1db)],[,_0x505c24]=_0x45cecb[_0x1de2e4(0x1bb)]('\x20'),_0x1e89a7=await Whatsapp_1[_0x1de2e4(0x1ba)][_0x1de2e4(0x1fd)]({'where':{'token':_0x505c24}}),_0x4693d5=_0x1e89a7[_0x1de2e4(0x1f4)],{ticketId:_0x4d36a1}=_0xc14077['params'],_0x38ff43=await(0x0,ShowTicketService_1['default'])(_0x4d36a1,_0x4693d5);_0x38ff43[_0x1de2e4(0x1aa)]=_0xc14077[_0x1de2e4(0x1fb)][_0x1de2e4(0x1e0)][_0x1de2e4(0x1aa)],console[_0x1de2e4(0x1c3)](_0x38ff43['status']);const {ticket:_0x2b32e9}=await(0x0,UpdateTicketService_1[_0x1de2e4(0x1ba)])({'ticketData':_0x38ff43,'ticketId':_0x4d36a1,'companyId':_0x4693d5});return _0x3fc8ef[_0x1de2e4(0x1aa)](0xc8)[_0x1de2e4(0x200)](_0x2b32e9);};exports['closeTicket']=closeTicket;function a9_0x18f7(){const _0x495742=['../libs/socket','getIO','Legenda\x20do\x20áudio','hasOwnProperty','index','390kMoAnb','create','yup','date','toISOString','indexContacts','profilePicUrl','status','acceptAudioMessage','updateCompany','includes','../libs/wbot','Failed\x20to\x20remove\x20ticket\x20tag','../services/WbotServices/CheckNumber','Internal\x20server\x20error','req','../services/ContactServices/GetContactService','checkNumber','paid','uploadContacts','indexApi','isInteger','UsedOnDay','default','split','nullable','tags','parseInt','../services/TicketServices/ShowTicketService','listContacts','format','exec','log','__importDefault','user','Token\x20de\x20autorização\x20inválido','-contact','../services/ContactServices/DeleteContactService','__createBinding','charAt','Tag\x20already\x20associated\x20with\x20the\x20ticket','__esModule','prototype','deleteAll','get','getOwnPropertyDescriptor','../models/TicketTag','../errors/AppError','company','all','../models/Ticket','../services/WbotServices/GetProfilePicUrl','../utils/useDate','updateQueueId','path','../services/ContactServices/ImportXLSContactsService','authorization','usedPDF','moment','__setModuleDefault','40IlHPZg','ticketData','showApi','../services/ContactServices/UpdateContactService','dataValues','../services/ContactServices/CreateOrUpdateContactService','active','error','../services/ContactServices/ListContactsService','query','queue','makeid','exists','usedText','writeFileSync','disableBot','length','emit','video','type','configurable','companyId','extname','getDate','removeAllContacts','dueDate','required','mimetype','body','(((.+)+)+)+$','findOne','facebookUserId','Error\x20updating\x20usage\x20stats:','json','files','jid','\x20not\x20found','Erro\x20ao\x20buscar\x20invoices:','constructor','usedVideo','getWbot','listTicketsByTag','SendPresenceStatus','pdf','string','Contact\x20deleted','Acesso\x20não\x20autorizado.\x20Por\x20favor,\x20forneça\x20credenciais\x20válidas.','validate','toString','removeContacts','../models/Invoices','lodash','whatsapp','media','replace','97181RdNyeG','name','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','color','5jZRxCC','updateApi','blockCompany','listTicketsByTagIsAuth','findOrCreateContacts','updateContacts','writable','showContacts','head','url','setDate','headers','handleAudioLink','Internal\x20Server\x20Error','boolean','object','Tag\x20does\x20not\x20belong\x20to\x20the\x20specified\x20company','toggleDisableBotContacts','createCompany','shape','../services/WbotServices/SendWhatsAppMessageAPI','@s.whatsapp.net','../services/InvoicesService/ShowInvoiceService','email','showAllApi','../services/InvoicesService/ListInvoicesServices','ERRO','findByPk','../services/WbotServices/SendWhatsappMediaImage','./public/company','2SdgJBB','removeTicketTag','46701vcroKj','extraInfo','545796KArgcJ','number','image','../services/TicketServices/FindOrCreateTicketService','OnWhatsAppDto','Invalid\x20queue\x20for\x20the\x20company','usedCheckNumber','message','defineProperty','.mp3','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','caption','params','facebookUserToken','axios','Missing\x20user\x20or\x20companyId','@g.us','207082KwTXgp','ERROR','storeContacts','apply','destroy','Erro\x20ao\x20buscar\x20invoices','SUCCESS','call','../services/InvoicesService/UpdateInvoiceService','indexImage','originalname','map','updateUsageStats','send','Not\x20exists\x20on\x20Whatsapp','update','988220kyTSsK','indexLink','reload','SUCESSO','arraybuffer','useDate','listTicketsByCompany','company-','matches','search','contact','../services/ContactServices/SimpleListService','260238NSVLAD','../models/Company','whatsapp\x20#','4850076gxatJA','usedOther','../helpers/GetDefaultWhatsApp','indexWhatsappsId','../models/Queue','findAll','Error\x20removing\x20all\x20contacts:','usedImage','pending','Company\x20not\x20found'];a9_0x18f7=function(){return _0x495742;};return a9_0x18f7();}const updateTicketTag=async(_0x547246,_0x2f3224)=>{const _0x358fd7=a9_0x43e66d,{ticketId:_0x1af618,tagId:_0x3a7a98}=_0x547246['body'],_0x381ccf=_0x547246[_0x358fd7(0x14d)][_0x358fd7(0x1db)],[,_0x5654d6]=_0x381ccf[_0x358fd7(0x1bb)]('\x20');try{const _0x5abac5=await Whatsapp_1[_0x358fd7(0x1ba)][_0x358fd7(0x1fd)]({'where':{'token':_0x5654d6}}),_0x33dd77=_0x5abac5['companyId'],_0x1b89e=await Tag_1[_0x358fd7(0x1ba)][_0x358fd7(0x1fd)]({'where':{'id':_0x3a7a98,'companyId':_0x33dd77}});if(!_0x1b89e)return _0x2f3224[_0x358fd7(0x1aa)](0x190)[_0x358fd7(0x200)]({'status':_0x358fd7(0x176),'error':_0x358fd7(0x152)});const _0x2c30aa=await TicketTag_1[_0x358fd7(0x1ba)][_0x358fd7(0x1fd)]({'where':{'ticketId':_0x1af618,'tagId':_0x3a7a98}});if(_0x2c30aa)return _0x2f3224['status'](0x190)['json']({'status':_0x358fd7(0x176),'error':_0x358fd7(0x1cb)});const _0x4425e9=await TicketTag_1[_0x358fd7(0x1ba)][_0x358fd7(0x1a4)]({'ticketId':_0x1af618,'tagId':_0x3a7a98});return _0x2f3224[_0x358fd7(0x1aa)](0xc8)[_0x358fd7(0x200)]({'status':_0x358fd7(0x17b),'ticketTag':_0x4425e9});}catch(_0x4d2c97){return console[_0x358fd7(0x1e6)](_0x4d2c97),_0x2f3224['status'](0x1f4)[_0x358fd7(0x200)]({'status':'ERROR','error':'Failed\x20to\x20update\x20ticket\x20tag'});}};exports['updateTicketTag']=updateTicketTag;const removeTicketTag=async(_0x31bcf4,_0x5ead34)=>{const _0x4fb304=a9_0x43e66d,{ticketId:_0x1f1273,tagId:_0x124300}=_0x31bcf4[_0x4fb304(0x1fb)];try{const _0x311165=await TicketTag_1['default'][_0x4fb304(0x1fd)]({'where':{'ticketId':_0x1f1273,'tagId':_0x124300}});if(!_0x311165)return _0x5ead34[_0x4fb304(0x1aa)](0x190)[_0x4fb304(0x200)]({'status':_0x4fb304(0x176),'error':'Tag\x20is\x20not\x20associated\x20with\x20the\x20ticket'});return await _0x311165[_0x4fb304(0x179)](),_0x5ead34[_0x4fb304(0x1aa)](0xc8)[_0x4fb304(0x200)]({'status':_0x4fb304(0x17b)});}catch(_0x201163){return console[_0x4fb304(0x1e6)](_0x201163),_0x5ead34[_0x4fb304(0x1aa)](0x1f4)[_0x4fb304(0x200)]({'status':_0x4fb304(0x176),'error':_0x4fb304(0x1af)});}};exports[a9_0x43e66d(0x161)]=removeTicketTag;const listTicketsByCompany=async(_0x5152ce,_0x3ea189)=>{const _0x2fc63a=a9_0x43e66d,_0x41256d=_0x5152ce['headers']['authorization'],[,_0xf6168f]=_0x41256d[_0x2fc63a(0x1bb)]('\x20'),_0x317b1d=await Whatsapp_1[_0x2fc63a(0x1ba)]['findOne']({'where':{'token':_0xf6168f}}),_0x1abd2f=_0x317b1d['companyId'];try{const _0x1cac98=await Ticket_1[_0x2fc63a(0x1ba)][_0x2fc63a(0x199)]({'where':{'companyId':_0x1abd2f},'include':[{'model':Contact_1[_0x2fc63a(0x1ba)],'as':'contact','attributes':['id','name',_0x2fc63a(0x165),_0x2fc63a(0x159),'profilePicUrl','acceptAudioMessage',_0x2fc63a(0x1e5),_0x2fc63a(0x1ee)],'include':[_0x2fc63a(0x163)]},{'model':Queue_1[_0x2fc63a(0x1ba)],'as':_0x2fc63a(0x1e9),'attributes':['id','name',_0x2fc63a(0x141)]},{'model':User_1[_0x2fc63a(0x1ba)],'as':_0x2fc63a(0x1c5),'attributes':['id','name']},{'model':Tag_1[_0x2fc63a(0x1ba)],'as':'tags','attributes':['id',_0x2fc63a(0x13f),_0x2fc63a(0x141)]},{'model':Whatsapp_1[_0x2fc63a(0x1ba)],'as':_0x2fc63a(0x213),'attributes':[_0x2fc63a(0x13f),_0x2fc63a(0x171),_0x2fc63a(0x1fe)]},{'model':Company_1['default'],'as':_0x2fc63a(0x1d3),'attributes':['name']}]});return _0x3ea189[_0x2fc63a(0x1aa)](0xc8)[_0x2fc63a(0x200)]({'status':_0x2fc63a(0x17b),'tickets':_0x1cac98});}catch(_0x461c65){return console[_0x2fc63a(0x1e6)](_0x461c65),_0x3ea189[_0x2fc63a(0x1aa)](0x1f4)[_0x2fc63a(0x200)]({'status':_0x2fc63a(0x176),'error':_0x2fc63a(0x14f)});}};exports[a9_0x43e66d(0x18b)]=listTicketsByCompany;const listTicketsByTag=async(_0x2d7e92,_0x2c020e)=>{const _0x399bb9=a9_0x43e66d,{tagId:_0x44cc98}=_0x2d7e92[_0x399bb9(0x170)],_0x4f121d=_0x2d7e92['headers']['authorization'],[,_0x39fcab]=_0x4f121d['split']('\x20');try{const _0x1ae0e6=await Whatsapp_1[_0x399bb9(0x1ba)]['findOne']({'where':{'token':_0x39fcab}}),_0x1a8f47=_0x1ae0e6['companyId'],_0x2c8d88=await Tag_1[_0x399bb9(0x1ba)]['findOne']({'where':{'id':_0x44cc98,'companyId':_0x1a8f47}});if(!_0x2c8d88)return _0x2c020e[_0x399bb9(0x1aa)](0x190)[_0x399bb9(0x200)]({'status':_0x399bb9(0x176),'error':_0x399bb9(0x152)});const _0x5d49b1=await Ticket_1[_0x399bb9(0x1ba)][_0x399bb9(0x199)]({'include':[{'model':Tag_1[_0x399bb9(0x1ba)],'as':_0x399bb9(0x1bd),'attributes':['id',_0x399bb9(0x13f)],'through':{'attributes':[],'where':{'tagId':_0x44cc98}}},{'model':Contact_1[_0x399bb9(0x1ba)],'as':_0x399bb9(0x18f),'attributes':['id',_0x399bb9(0x13f),_0x399bb9(0x165),_0x399bb9(0x159),_0x399bb9(0x1a9),_0x399bb9(0x1ab),_0x399bb9(0x1e5),_0x399bb9(0x1ee)],'include':[_0x399bb9(0x163)]},{'model':Queue_1[_0x399bb9(0x1ba)],'as':_0x399bb9(0x1e9),'attributes':['id',_0x399bb9(0x13f),'color']},{'model':User_1[_0x399bb9(0x1ba)],'as':_0x399bb9(0x1c5),'attributes':['id',_0x399bb9(0x13f)]},{'model':Whatsapp_1[_0x399bb9(0x1ba)],'as':_0x399bb9(0x213),'attributes':[_0x399bb9(0x13f),_0x399bb9(0x171),_0x399bb9(0x1fe)]},{'model':Company_1[_0x399bb9(0x1ba)],'as':_0x399bb9(0x1d3),'attributes':[_0x399bb9(0x13f)]}],'where':{'companyId':_0x1a8f47,'$tags.id$':_0x44cc98}});return _0x2c020e[_0x399bb9(0x1aa)](0xc8)[_0x399bb9(0x200)]({'status':_0x399bb9(0x17b),'tickets':_0x5d49b1});}catch(_0x63f830){return console[_0x399bb9(0x1e6)](_0x63f830),_0x2c020e[_0x399bb9(0x1aa)](0x1f4)[_0x399bb9(0x200)]({'status':_0x399bb9(0x176),'error':_0x399bb9(0x14f)});}};exports[a9_0x43e66d(0x208)]=listTicketsByTag;const listTicketsByTagIsAuth=async(_0xa504ad,_0x5925b6)=>{const _0x4a3826=a9_0x43e66d,{tagId:_0x2e0aa1}=_0xa504ad[_0x4a3826(0x170)];try{const _0x5ecc33=await Ticket_1[_0x4a3826(0x1ba)][_0x4a3826(0x199)]({'include':[{'model':Contact_1[_0x4a3826(0x1ba)],'as':_0x4a3826(0x18f),'attributes':[_0x4a3826(0x13f),_0x4a3826(0x165),'email'],'include':[_0x4a3826(0x163)]},{'model':Tag_1[_0x4a3826(0x1ba)],'as':'tags','attributes':['id',_0x4a3826(0x13f),_0x4a3826(0x141)],'where':{'id':_0x2e0aa1}},{'model':Whatsapp_1[_0x4a3826(0x1ba)],'as':_0x4a3826(0x213),'attributes':[_0x4a3826(0x13f),_0x4a3826(0x171),'facebookUserId']},{'model':Company_1[_0x4a3826(0x1ba)],'as':'company','attributes':[_0x4a3826(0x13f)]}]});return _0x5925b6[_0x4a3826(0x1aa)](0xc8)[_0x4a3826(0x200)]({'status':_0x4a3826(0x17b),'tickets':_0x5ecc33});}catch(_0xcad491){return console[_0x4a3826(0x1e6)](_0xcad491),_0x5925b6[_0x4a3826(0x1aa)](0x1f4)['json']({'status':'ERROR','error':'Internal\x20Server\x20Error'});}};exports[a9_0x43e66d(0x145)]=listTicketsByTagIsAuth;function makeid(_0x2de245){const _0x41d1a2=a9_0x43e66d;var _0x5682de='',_0x3bf894=_0x41d1a2(0x140),_0x288dea=_0x3bf894[_0x41d1a2(0x1ef)];for(var _0x31051c=0x0;_0x31051c<_0x2de245;_0x31051c++){_0x5682de+=_0x3bf894[_0x41d1a2(0x1ca)](Math['floor'](Math['random']()*_0x288dea));}return _0x5682de;}exports[a9_0x43e66d(0x1ea)]=makeid;const handleAudioLink=async(_0x2641ad,_0x51b972)=>{const _0x1ee9a0=a9_0x43e66d,{link:_0x34dbae,contactNumber:_0x55ec54}=_0x2641ad[_0x1ee9a0(0x1fb)];try{const _0x4b27b5=_0x2641ad[_0x1ee9a0(0x14d)][_0x1ee9a0(0x1db)],[,_0x1c4627]=_0x4b27b5[_0x1ee9a0(0x1bb)]('\x20'),_0x48c76a=await Whatsapp_1[_0x1ee9a0(0x1ba)][_0x1ee9a0(0x1fd)]({'where':{'token':_0x1c4627}}),_0x11cba8=_0x48c76a['companyId'],_0x357bfe=await(0x0,GetDefaultWhatsApp_1[_0x1ee9a0(0x1ba)])(_0x11cba8),_0x5f50a1=(0x0,wbot_1[_0x1ee9a0(0x207)])(_0x357bfe['id']),_0x1bd168=_0x1ee9a0(0x15f)+_0x11cba8+'/'+makeid(0xa)+_0x1ee9a0(0x16d);if(!_0x48c76a)return _0x51b972[_0x1ee9a0(0x1aa)](0x191)['json']({'status':'ERRO','error':_0x1ee9a0(0x1c6)});const _0xc0a1bd=await axios_1[_0x1ee9a0(0x1ba)][_0x1ee9a0(0x1cf)](_0x34dbae,{'responseType':_0x1ee9a0(0x189)});fs_1[_0x1ee9a0(0x1ba)][_0x1ee9a0(0x1ed)](_0x1bd168,Buffer['from'](_0xc0a1bd['data']));const _0x172a59=_0x1ee9a0(0x1a0);return await(0x0,SendPresenceStatus_1[_0x1ee9a0(0x209)])(_0x5f50a1,_0x55ec54),await _0x5f50a1['sendMessage'](_0x55ec54+_0x1ee9a0(0x157),{'audio':fs_1['default']['readFileSync'](_0x1bd168),'fileName':_0x172a59,'caption':_0x172a59,'mimetype':'audio/mp4','ptt':!![]}),_0x51b972[_0x1ee9a0(0x1aa)](0xc8)[_0x1ee9a0(0x200)]({'status':_0x1ee9a0(0x188)});}catch(_0x3bc505){return console['error'](_0x3bc505),_0x51b972[_0x1ee9a0(0x1aa)](0x1f4)[_0x1ee9a0(0x200)]({'status':'ERRO','error':'Erro\x20ao\x20lidar\x20com\x20o\x20link\x20de\x20áudio'});}};exports[a9_0x43e66d(0x14e)]=handleAudioLink;const indexApi=async(_0x2eff3b,_0x44ade9)=>{const _0x1a19de=a9_0x43e66d,_0x45f1cf=_0x2eff3b[_0x1a19de(0x14d)][_0x1a19de(0x1db)],[,_0x105924]=_0x45f1cf[_0x1a19de(0x1bb)]('\x20'),_0x1e53e3=await Whatsapp_1['default'][_0x1a19de(0x1fd)]({'where':{'token':_0x105924}}),_0x891b27=_0x1e53e3[_0x1a19de(0x1f4)],{searchParam:_0x3effff,pageNumber:_0x24167f}=_0x2eff3b[_0x1a19de(0x1e8)];if(_0x891b27===0x1){const {invoices:_0x5dbc5b,count:_0x5a1517,hasMore:_0x3e7b33}=await(0x0,ListInvoicesServices_1[_0x1a19de(0x1ba)])({'searchParam':_0x3effff,'pageNumber':_0x24167f});return _0x44ade9[_0x1a19de(0x200)]({'invoices':_0x5dbc5b,'count':_0x5a1517,'hasMore':_0x3e7b33});}else return _0x44ade9[_0x1a19de(0x1aa)](0x191)[_0x1a19de(0x200)]({'status':_0x1a19de(0x15c),'error':'Acesso\x20não\x20autorizado.\x20Por\x20favor,\x20forneça\x20credenciais\x20válidas.'});};exports[a9_0x43e66d(0x1b7)]=indexApi;const showApi=async(_0x1a0f56,_0x273ac0)=>{const _0x123bb6=a9_0x43e66d,_0x2581e5=_0x1a0f56[_0x123bb6(0x14d)][_0x123bb6(0x1db)],[,_0x675b49]=_0x2581e5[_0x123bb6(0x1bb)]('\x20'),_0x1bff2c=await Whatsapp_1[_0x123bb6(0x1ba)][_0x123bb6(0x1fd)]({'where':{'token':_0x675b49}}),_0x366349=_0x1bff2c[_0x123bb6(0x1f4)],{Invoiceid:_0x563c08}=_0x1a0f56['params'],_0x1c828f=await(0x0,ShowInvoiceService_1[_0x123bb6(0x1ba)])(_0x563c08);return _0x273ac0[_0x123bb6(0x1aa)](0xc8)[_0x123bb6(0x200)](_0x1c828f);};exports['showApi']=showApi;const showAllApi=async(_0x57ae5c,_0x2fa0)=>{const _0x582276=a9_0x43e66d;try{const _0x291ee4=_0x57ae5c[_0x582276(0x14d)]['authorization'],[,_0x4c30ad]=_0x291ee4[_0x582276(0x1bb)]('\x20'),_0x2bee58=await Whatsapp_1[_0x582276(0x1ba)][_0x582276(0x1fd)]({'where':{'token':_0x4c30ad}}),_0x165d02=_0x2bee58[_0x582276(0x1f4)],{companyId:_0x351cb1,status:_0x28b435}=_0x57ae5c['body'];if(_0x165d02===0x1){const _0x54622f=await Invoices_1[_0x582276(0x1ba)]['findAll']({'where':{'companyId':_0x351cb1,'status':_0x28b435}});return _0x2fa0['status'](0xc8)[_0x582276(0x200)](_0x54622f);}else return _0x2fa0['status'](0x191)[_0x582276(0x200)]({'status':_0x582276(0x15c),'error':'Acesso\x20não\x20autorizado.\x20Por\x20favor,\x20forneça\x20credenciais\x20válidas.'});}catch(_0x59e325){return console[_0x582276(0x1e6)](_0x582276(0x204),_0x59e325),_0x2fa0[_0x582276(0x1aa)](0x1f4)[_0x582276(0x200)]({'error':_0x582276(0x17a)});}};exports[a9_0x43e66d(0x15a)]=showAllApi;const updateApi=async(_0xd7269c,_0xf23a50)=>{const _0x1f3c41=a9_0x43e66d,_0x2da5ee=_0xd7269c[_0x1f3c41(0x14d)]['authorization'],[,_0x4a545a]=_0x2da5ee[_0x1f3c41(0x1bb)]('\x20'),_0x20f43f=await Whatsapp_1[_0x1f3c41(0x1ba)][_0x1f3c41(0x1fd)]({'where':{'token':_0x4a545a}}),_0x3218dc=_0x20f43f[_0x1f3c41(0x1f4)],_0x38f968=_0xd7269c[_0x1f3c41(0x1fb)],_0xc472c0=Yup[_0x1f3c41(0x151)]()[_0x1f3c41(0x155)]({'name':Yup[_0x1f3c41(0x20b)]()});try{await _0xc472c0[_0x1f3c41(0x20e)](_0x38f968);}catch(_0x133faf){throw new AppError_1[(_0x1f3c41(0x1ba))](_0x133faf['message']);}const {id:_0x276aa7,status:_0x32bfbe}=_0x38f968;if(_0x3218dc===0x1){const _0x50ac80=await(0x0,UpdateInvoiceService_1[_0x1f3c41(0x1ba)])({'id':_0x276aa7,'status':_0x32bfbe}),_0x18da0f=await Invoices_1[_0x1f3c41(0x1ba)][_0x1f3c41(0x15d)](_0x276aa7),_0x5a9222=_0x18da0f[_0x1f3c41(0x1f4)],_0x17a5ba=await Company_1['default'][_0x1f3c41(0x15d)](_0x5a9222),_0x54f410=new Date(_0x17a5ba[_0x1f3c41(0x1f8)]);_0x54f410[_0x1f3c41(0x14c)](_0x54f410[_0x1f3c41(0x1f6)]()+0x1e);const _0x5e1a56=_0x54f410[_0x1f3c41(0x1a7)]()['split']('T')[0x0];if(_0x17a5ba){await _0x17a5ba['update']({'dueDate':_0x5e1a56});const _0xba3296=await _0x18da0f[_0x1f3c41(0x184)]({'id':_0x276aa7,'status':_0x1f3c41(0x1b5)});await _0x17a5ba[_0x1f3c41(0x187)]();const _0x21a7e2=(0x0,socket_1[_0x1f3c41(0x19f)])(),_0x23f225=await Company_1[_0x1f3c41(0x1ba)]['findOne']({'where':{'id':_0x5a9222}});}return _0xf23a50['status'](0xc8)[_0x1f3c41(0x200)](_0x50ac80);}else return _0xf23a50['status'](0x191)[_0x1f3c41(0x200)]({'status':_0x1f3c41(0x15c),'error':_0x1f3c41(0x20d)});};exports[a9_0x43e66d(0x143)]=updateApi;const updateUsageStats=async(_0x22a327,_0xf607ec)=>{const _0x333596=a9_0x43e66d;if(!_0x22a327[_0x333596(0x1c5)]||!_0x22a327[_0x333596(0x1c5)][_0x333596(0x1f4)])return _0xf607ec[_0x333596(0x1aa)](0x190)[_0x333596(0x182)]({'status':_0x333596(0x176),'message':_0x333596(0x173)});const {companyId:_0x4bbdfe}=_0x22a327[_0x333596(0x1c5)],{contactId:_0xf42596}=_0x22a327[_0x333596(0x170)];return setTimeout(async()=>{const _0x509aee=_0x333596,{dateToClient:_0x5a93c2}=(0x0,useDate_1['useDate'])(),_0x42e405=_0x5a93c2(new Date()[_0x509aee(0x20f)]()),_0x2c0d2b=(0x0,moment_1['default'])()[_0x509aee(0x1c1)]();try{const _0x2b536d=await ApiUsages_1['default'][_0x509aee(0x1fd)]({'where':{'dateUsed':_0x42e405,'companyId':_0x4bbdfe}});if(_0x2b536d)await _0x2b536d['update']({'usedOther':_0x2b536d['dataValues'][_0x509aee(0x195)]+0x1,'UsedOnDay':_0x2b536d[_0x509aee(0x1e3)][_0x509aee(0x1b9)]+0x1,'updatedAt':_0x2c0d2b});else{const _0xc684e9=await ApiUsages_1[_0x509aee(0x1ba)][_0x509aee(0x1a4)]({'companyId':_0x4bbdfe,'dateUsed':_0x42e405});await _0xc684e9[_0x509aee(0x184)]({'usedOther':_0xc684e9[_0x509aee(0x1e3)]['usedOther']+0x1,'UsedOnDay':_0xc684e9[_0x509aee(0x1e3)][_0x509aee(0x1b9)]+0x1,'updatedAt':_0x2c0d2b});}}catch(_0x2f6446){return console[_0x509aee(0x1e6)](_0x509aee(0x1ff),_0x2f6446),_0xf607ec[_0x509aee(0x1aa)](0x1f4)[_0x509aee(0x182)]({'status':'ERROR','message':'Internal\x20server\x20error'});}},0x64),_0xf607ec[_0x333596(0x182)]({'status':_0x333596(0x17b)});};exports[a9_0x43e66d(0x181)]=updateUsageStats;const indexContacts=async(_0xf53ebc,_0xf32073)=>{const _0x26207b=a9_0x43e66d,{searchParam:_0x268c70,pageNumber:_0x25a2c7}=_0xf53ebc[_0x26207b(0x1e8)],{companyId:_0x2e2c08}=_0xf53ebc[_0x26207b(0x1c5)],{contacts:_0x5d2208,count:_0x56fe85,hasMore:_0x1a82c3}=await(0x0,ListContactsService_1['default'])({'searchParam':_0x268c70,'pageNumber':_0x25a2c7,'companyId':_0x2e2c08});return _0xf32073[_0x26207b(0x200)]({'contacts':_0x5d2208,'count':_0x56fe85,'hasMore':_0x1a82c3});};exports['indexContacts']=indexContacts;const listContacts=async(_0x1ca2e0,_0x4daa18)=>{const _0x1c0be7=a9_0x43e66d,{name:_0x15d740}=_0x1ca2e0['query'],{companyId:_0x2e45b2}=_0x1ca2e0[_0x1c0be7(0x1c5)],_0x20003e=await(0x0,SimpleListService_1['default'])({'name':_0x15d740,'companyId':_0x2e45b2});return _0x4daa18[_0x1c0be7(0x200)](_0x20003e);};exports[a9_0x43e66d(0x1c0)]=listContacts;const showContacts=async(_0x3d2646,_0x1588c0)=>{const _0x235efc=a9_0x43e66d,{contactId:_0x4223b3}=_0x3d2646[_0x235efc(0x170)],{companyId:_0x2096e4}=_0x3d2646[_0x235efc(0x1c5)],_0xcca4ad=await(0x0,ShowContactService_1[_0x235efc(0x1ba)])(_0x4223b3,_0x2096e4);return _0x1588c0[_0x235efc(0x1aa)](0xc8)[_0x235efc(0x200)](_0xcca4ad);};exports[a9_0x43e66d(0x149)]=showContacts;const findOrCreateContacts=async(_0x249db5,_0x287e07)=>{const _0xaadf3f=a9_0x43e66d,{name:_0x7254ee,number:_0x2ed755}=_0x249db5['body'],{companyId:_0x3c0c8f}=_0x249db5[_0xaadf3f(0x1c5)],_0x3813c8=await(0x0,GetContactService_1[_0xaadf3f(0x1ba)])({'name':_0x7254ee,'number':_0x2ed755,'companyId':_0x3c0c8f});return _0x287e07['status'](0xc8)[_0xaadf3f(0x200)](_0x3813c8);};exports['findOrCreateContacts']=findOrCreateContacts;const storeContacts=async(_0x18862c,_0x46041c)=>{const _0x24302c=a9_0x43e66d,{companyId:_0x9323df}=_0x18862c['user'],_0x216024=_0x18862c[_0x24302c(0x1fb)];_0x216024[_0x24302c(0x165)]=_0x216024['number'][_0x24302c(0x13d)]('-','')[_0x24302c(0x13d)]('\x20','');const _0x2a890e=Yup[_0x24302c(0x151)]()['shape']({'name':Yup[_0x24302c(0x20b)]()[_0x24302c(0x1f9)](),'number':Yup[_0x24302c(0x20b)]()[_0x24302c(0x1f9)]()['matches'](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0x2a890e[_0x24302c(0x20e)](_0x216024);}catch(_0x1925f3){throw new AppError_1[(_0x24302c(0x1ba))](_0x1925f3[_0x24302c(0x16b)]);}await(0x0,CheckIsValidContact_1[_0x24302c(0x1ba)])(_0x216024[_0x24302c(0x165)],_0x9323df);const _0x3e25c3=await(0x0,CheckNumber_1[_0x24302c(0x1ba)])(_0x216024[_0x24302c(0x165)],_0x9323df),_0xecf454=_0x3e25c3['jid'][_0x24302c(0x13d)](/\D/g,'');_0x216024[_0x24302c(0x165)]=_0xecf454;const _0x1a31cf=await(0x0,CreateContactService_1[_0x24302c(0x1ba)])({..._0x216024,'companyId':_0x9323df}),_0x57cbe7=(0x0,socket_1['getIO'])();return _0x57cbe7['emit'](_0x24302c(0x18c)+_0x9323df+_0x24302c(0x1c7),{'action':_0x24302c(0x1a4),'contact':_0x1a31cf}),_0x46041c['status'](0xc8)[_0x24302c(0x200)](_0x1a31cf);};exports[a9_0x43e66d(0x177)]=storeContacts;const removeAllContacts=async(_0x181920,_0x4c722f)=>{const _0x38bd81=a9_0x43e66d,{companyId:_0x591936}=_0x181920['user'];try{await Contact_1['default'][_0x38bd81(0x179)]({'where':{'companyId':_0x591936}});const _0x2eef79=(0x0,socket_1['getIO'])();return _0x2eef79[_0x38bd81(0x1f0)]('company-'+_0x591936+_0x38bd81(0x1c7),{'action':_0x38bd81(0x1ce)}),setTimeout(async()=>{const _0x1dd44f=_0x38bd81,{dateToClient:_0x3a848b}=(0x0,useDate_1[_0x1dd44f(0x18a)])(),_0x594518=_0x3a848b(new Date()['toString']()),_0x1e7852=(0x0,moment_1[_0x1dd44f(0x1ba)])()[_0x1dd44f(0x1c1)]();try{const _0x1d53e7=await ApiUsages_1[_0x1dd44f(0x1ba)][_0x1dd44f(0x1fd)]({'where':{'dateUsed':_0x594518,'companyId':_0x591936}});if(_0x1d53e7)await _0x1d53e7[_0x1dd44f(0x184)]({'usedOther':_0x1d53e7[_0x1dd44f(0x1e3)]['usedOther']+0x1,'UsedOnDay':_0x1d53e7[_0x1dd44f(0x1e3)][_0x1dd44f(0x1b9)]+0x1,'updatedAt':_0x1e7852});else{const _0x1d25bc=await ApiUsages_1[_0x1dd44f(0x1ba)]['create']({'companyId':_0x591936,'dateUsed':_0x594518});await _0x1d25bc[_0x1dd44f(0x184)]({'usedOther':_0x1d25bc[_0x1dd44f(0x1e3)]['usedOther']+0x1,'UsedOnDay':_0x1d25bc[_0x1dd44f(0x1e3)][_0x1dd44f(0x1b9)]+0x1,'updatedAt':_0x1e7852});}}catch(_0x42d914){return console[_0x1dd44f(0x1e6)](_0x1dd44f(0x1ff),_0x42d914),_0x4c722f[_0x1dd44f(0x1aa)](0x1f4)[_0x1dd44f(0x182)]({'status':'ERROR','message':_0x1dd44f(0x1b1)});}},0x64),_0x4c722f[_0x38bd81(0x1aa)](0xc8)[_0x38bd81(0x182)]({'status':'SUCCESS','message':'All\x20contacts\x20removed\x20successfully'});}catch(_0x1a3eaa){return console[_0x38bd81(0x1e6)](_0x38bd81(0x19a),_0x1a3eaa),_0x4c722f[_0x38bd81(0x1aa)](0x1f4)['send']({'status':'ERROR','message':_0x38bd81(0x1b1)});}};exports[a9_0x43e66d(0x1f7)]=removeAllContacts;const updateContacts=async(_0x184c86,_0x2dd8e1)=>{const _0x40dc13=a9_0x43e66d,_0x33f822=_0x184c86[_0x40dc13(0x1fb)],{companyId:_0x5094b2}=_0x184c86[_0x40dc13(0x1c5)],_0x4ac510=Yup[_0x40dc13(0x151)]()[_0x40dc13(0x155)]({'name':Yup[_0x40dc13(0x20b)](),'number':Yup['string']()[_0x40dc13(0x18d)](/^\d+$/,_0x40dc13(0x16e))});try{await _0x4ac510[_0x40dc13(0x20e)](_0x33f822);}catch(_0x2612d6){throw new AppError_1[(_0x40dc13(0x1ba))](_0x2612d6[_0x40dc13(0x16b)]);}await(0x0,CheckIsValidContact_1[_0x40dc13(0x1ba)])(_0x33f822[_0x40dc13(0x165)],_0x5094b2);const _0x500869=await(0x0,CheckNumber_1[_0x40dc13(0x1ba)])(_0x33f822[_0x40dc13(0x165)],_0x5094b2),_0x3d16e1=_0x500869[_0x40dc13(0x202)][_0x40dc13(0x13d)](/\D/g,'');_0x33f822[_0x40dc13(0x165)]=_0x3d16e1;const {contactId:_0x506b35}=_0x184c86[_0x40dc13(0x170)],_0x35a8f3=await(0x0,UpdateContactService_1[_0x40dc13(0x1ba)])({'contactData':_0x33f822,'contactId':_0x506b35,'companyId':_0x5094b2}),_0x2aa86f=(0x0,socket_1[_0x40dc13(0x19f)])();return _0x2aa86f[_0x40dc13(0x1f0)](_0x40dc13(0x18c)+_0x5094b2+'-contact',{'action':_0x40dc13(0x184),'contact':_0x35a8f3}),_0x2dd8e1[_0x40dc13(0x1aa)](0xc8)[_0x40dc13(0x200)](_0x35a8f3);};exports['updateContacts']=updateContacts;const removeContacts=async(_0x8c5035,_0x4359a3)=>{const _0x29e74c=a9_0x43e66d,{contactId:_0x2b7e21}=_0x8c5035['params'],{companyId:_0x20134b}=_0x8c5035['user'];await(0x0,ShowContactService_1[_0x29e74c(0x1ba)])(_0x2b7e21,_0x20134b),await(0x0,DeleteContactService_1[_0x29e74c(0x1ba)])(_0x2b7e21);const _0x457648=(0x0,socket_1['getIO'])();return _0x457648['emit'](_0x29e74c(0x18c)+_0x20134b+'-contact',{'action':'delete','contactId':_0x2b7e21}),_0x4359a3['status'](0xc8)['json']({'message':_0x29e74c(0x20c)});};exports['removeContacts']=removeContacts;const uploadContacts=async(_0x2ebe97,_0x42567b)=>{const _0x5e4727=a9_0x43e66d,_0x1dda9b=_0x2ebe97[_0x5e4727(0x201)],_0x13972c=(0x0,lodash_1[_0x5e4727(0x14a)])(_0x1dda9b),{companyId:_0x14cf6b}=_0x2ebe97[_0x5e4727(0x1c5)],_0x92cd5c=await(0x0,ImportXLSContactsService_1['ImportXLSContactsService'])(_0x14cf6b,_0x13972c),_0x436b87=(0x0,socket_1[_0x5e4727(0x19f)])(),_0x3312c2={'action':'reload','records':_0x92cd5c};return _0x436b87['to']('company-'+_0x14cf6b+'-mainchannel')[_0x5e4727(0x1f0)](_0x5e4727(0x18c)+_0x14cf6b+_0x5e4727(0x1c7),_0x3312c2),_0x42567b[_0x5e4727(0x1aa)](0xc8)['json'](_0x92cd5c);};exports[a9_0x43e66d(0x1b6)]=uploadContacts;const toggleDisableBotContacts=async(_0x1a2f30,_0x379da0)=>{const _0xf5c3a2=a9_0x43e66d,{contactId:_0xfd4cda}=_0x1a2f30['params'],{companyId:_0x3cb0ba}=_0x1a2f30[_0xf5c3a2(0x1c5)],_0x4eead4=await(0x0,ToggleDisableBotService_1['default'])(_0xfd4cda,_0x3cb0ba),_0x2c0137=(0x0,socket_1[_0xf5c3a2(0x19f)])();return _0x2c0137[_0xf5c3a2(0x1f0)](_0xf5c3a2(0x18c)+_0x3cb0ba+_0xf5c3a2(0x1c7),{'action':_0xf5c3a2(0x184),'contact':_0x4eead4}),_0x379da0['status'](0xc8)[_0xf5c3a2(0x200)](_0x4eead4);};exports[a9_0x43e66d(0x153)]=toggleDisableBotContacts;