const a33_0xc88c45=a33_0x40de;function a33_0x2c9b(){const _0x1a919e=['emit','clearCookie','getIO','__importDefault','116819jnlfmy','ERR_SESSION_EXPIRED','findByPk','../models/User','../models/Company','status','send','search','(((.+)+)+)+$','companyId','jrt','json','admin','default','1903mRxkaf','103520qqpjUK','remove','__esModule','user','../services/AuthServices/FindUserFromToken','../helpers/SerializeUser','findOne','company-','../errors/AppError','../models/Setting','impersonate','cookies','update','3165896RxjSmY','createAccessToken','params','SerializeUser','6884604fssaSS','toString','queues','store','user-','email','3wLLouA','2536295WvXsqZ','12IWZApd','4248032bLvBUm','body','ERR_NO_USER_FOUND','../services/UserServices/AuthUserService','../helpers/CreateTokens','SendRefreshToken','RefreshTokenService','defineProperty','323856ZmXaPw','7rVfDku'];a33_0x2c9b=function(){return _0x1a919e;};return a33_0x2c9b();}(function(_0x51c019,_0xbf5013){const _0x1b3317=a33_0x40de,_0x25ca99=_0x51c019();while(!![]){try{const _0x1deb22=parseInt(_0x1b3317(0x102))/0x1+-parseInt(_0x1b3317(0xfc))/0x2+parseInt(_0x1b3317(0xf1))/0x3*(-parseInt(_0x1b3317(0xf4))/0x4)+parseInt(_0x1b3317(0xf2))/0x5*(parseInt(_0x1b3317(0xf3))/0x6)+-parseInt(_0x1b3317(0xfd))/0x7*(parseInt(_0x1b3317(0xe7))/0x8)+-parseInt(_0x1b3317(0xeb))/0x9+parseInt(_0x1b3317(0xda))/0xa*(parseInt(_0x1b3317(0xd9))/0xb);if(_0x1deb22===_0xbf5013)break;else _0x25ca99['push'](_0x25ca99['shift']());}catch(_0x2137de){_0x25ca99['push'](_0x25ca99['shift']());}}}(a33_0x2c9b,0x83404));function a33_0x40de(_0x1ccde1,_0x3a3f68){const _0x231d8f=a33_0x2c9b();return a33_0x40de=function(_0x49b217,_0x31d361){_0x49b217=_0x49b217-0xce;let _0x2c9b08=_0x231d8f[_0x49b217];return _0x2c9b08;},a33_0x40de(_0x1ccde1,_0x3a3f68);}const a33_0x31d361=(function(){let _0xa4de5d=!![];return function(_0x1d13b9,_0x6a7c73){const _0x84cad5=_0xa4de5d?function(){if(_0x6a7c73){const _0x20b71b=_0x6a7c73['apply'](_0x1d13b9,arguments);return _0x6a7c73=null,_0x20b71b;}}:function(){};return _0xa4de5d=![],_0x84cad5;};}()),a33_0x49b217=a33_0x31d361(this,function(){const _0x27cab0=a33_0x40de;return a33_0x49b217[_0x27cab0(0xec)]()[_0x27cab0(0xd2)]('(((.+)+)+)+$')['toString']()['constructor'](a33_0x49b217)['search'](_0x27cab0(0xd3));});a33_0x49b217();'use strict';var __importDefault=this&&this[a33_0xc88c45(0x101)]||function(_0x579c47){const _0x29a342=a33_0xc88c45;return _0x579c47&&_0x579c47[_0x29a342(0xdc)]?_0x579c47:{'default':_0x579c47};};Object[a33_0xc88c45(0xfb)](exports,'__esModule',{'value':!![]}),exports[a33_0xc88c45(0xe4)]=exports[a33_0xc88c45(0xdb)]=exports['me']=exports[a33_0xc88c45(0xe6)]=exports['store']=void 0x0;const AppError_1=__importDefault(require(a33_0xc88c45(0xe2))),socket_1=require('../libs/socket'),AuthUserService_1=__importDefault(require(a33_0xc88c45(0xf7))),SendRefreshToken_1=require('../helpers/SendRefreshToken'),RefreshTokenService_1=require('../services/AuthServices/RefreshTokenService'),FindUserFromToken_1=__importDefault(require(a33_0xc88c45(0xde))),User_1=__importDefault(require(a33_0xc88c45(0xce))),SerializeUser_1=require(a33_0xc88c45(0xdf)),CreateTokens_1=require(a33_0xc88c45(0xf8)),Company_1=__importDefault(require(a33_0xc88c45(0xcf))),Setting_1=__importDefault(require(a33_0xc88c45(0xe3))),store=async(_0x340569,_0x34ff62)=>{const _0x131fde=a33_0xc88c45,{email:_0x5a9950,password:_0xcf16b4}=_0x340569[_0x131fde(0xf5)],{token:_0x231b72,serializedUser:_0xd0183b,refreshToken:_0x6542a3}=await(0x0,AuthUserService_1[_0x131fde(0xd8)])({'email':_0x5a9950,'password':_0xcf16b4});(0x0,SendRefreshToken_1[_0x131fde(0xf9)])(_0x34ff62,_0x6542a3);const _0x8d5aa3=(0x0,socket_1[_0x131fde(0x100)])();return _0x8d5aa3['to'](_0x131fde(0xef)+_0xd0183b['id'])[_0x131fde(0xfe)](_0x131fde(0xe1)+_0xd0183b[_0x131fde(0xd4)]+'-auth',{'action':'update','user':{'id':_0xd0183b['id'],'email':_0xd0183b[_0x131fde(0xf0)],'companyId':_0xd0183b[_0x131fde(0xd4)]}}),_0x34ff62[_0x131fde(0xd0)](0xc8)[_0x131fde(0xd6)]({'token':_0x231b72,'user':_0xd0183b});};exports[a33_0xc88c45(0xee)]=store;const update=async(_0x144304,_0x2883d6)=>{const _0x5dfec0=a33_0xc88c45,_0x8ed966=_0x144304[_0x5dfec0(0xe5)][_0x5dfec0(0xd5)];if(!_0x8ed966)throw new AppError_1[(_0x5dfec0(0xd8))]('ERR_SESSION_EXPIRED',0x191);const {user:_0x1b216d,newToken:_0x1905cb,refreshToken:_0x4bf8fe}=await(0x0,RefreshTokenService_1[_0x5dfec0(0xfa)])(_0x2883d6,_0x8ed966);return(0x0,SendRefreshToken_1[_0x5dfec0(0xf9)])(_0x2883d6,_0x4bf8fe),_0x2883d6['json']({'token':_0x1905cb,'user':_0x1b216d});};exports[a33_0xc88c45(0xe6)]=update;const me=async(_0x32e9aa,_0x4ebc04)=>{const _0x41fed3=a33_0xc88c45,_0x2b252c=_0x32e9aa['cookies'][_0x41fed3(0xd5)],_0x3965aa=await(0x0,FindUserFromToken_1[_0x41fed3(0xd8)])(_0x2b252c),{id:_0x4a8626,profile:_0x55e8b2,email:_0x53e10f,super:_0x7fbbb6}=_0x3965aa;if(!_0x2b252c)throw new AppError_1['default'](_0x41fed3(0x103),0x191);return _0x4ebc04[_0x41fed3(0xd6)]({'id':_0x4a8626,'profile':_0x55e8b2,'email':_0x53e10f,'super':_0x7fbbb6});};exports['me']=me;const remove=async(_0x340fe3,_0x1510a8)=>{const _0x3158f1=a33_0xc88c45,{id:_0x3f24e1}=_0x340fe3[_0x3158f1(0xdd)],_0x5276f8=await User_1['default'][_0x3158f1(0x104)](_0x3f24e1);return await _0x5276f8['update']({'online':![]}),_0x1510a8[_0x3158f1(0xff)](_0x3158f1(0xd5)),_0x1510a8[_0x3158f1(0xd1)]();};exports[a33_0xc88c45(0xdb)]=remove;const impersonate=async(_0x5870e9,_0x52e8c7)=>{const _0x3f6ac1=a33_0xc88c45,_0x5ef133=_0x5870e9['cookies']['jrt'],{companyId:_0x50c08d}=_0x5870e9[_0x3f6ac1(0xe9)];if(!_0x5ef133)throw new AppError_1['default']('ERR_SESSION_EXPIRED',0x191);const _0x3f3944=await User_1['default'][_0x3f6ac1(0xe0)]({'where':{'companyId':Number(_0x50c08d),'profile':_0x3f6ac1(0xd7)},'include':[_0x3f6ac1(0xed),{'model':Company_1[_0x3f6ac1(0xd8)],'include':[{'model':Setting_1[_0x3f6ac1(0xd8)]}]}]});if(!_0x3f3944)throw new AppError_1['default'](_0x3f6ac1(0xf6),0x194);const _0x4c940e=(0x0,CreateTokens_1[_0x3f6ac1(0xe8)])(_0x3f3944),_0x8f2497=(0x0,CreateTokens_1['createRefreshToken'])(_0x3f3944),_0x316899=await(0x0,SerializeUser_1[_0x3f6ac1(0xea)])(_0x3f3944);(0x0,SendRefreshToken_1[_0x3f6ac1(0xf9)])(_0x52e8c7,_0x8f2497);const _0xa6b359=(0x0,socket_1[_0x3f6ac1(0x100)])();return _0xa6b359['to'](_0x3f6ac1(0xef)+_0x316899['id'])[_0x3f6ac1(0xfe)](_0x3f6ac1(0xe1)+_0x316899[_0x3f6ac1(0xd4)]+'-auth',{'action':_0x3f6ac1(0xe6),'user':{'id':_0x316899['id'],'email':_0x316899[_0x3f6ac1(0xf0)],'companyId':_0x316899[_0x3f6ac1(0xd4)],'impersonated':!![]}}),_0x52e8c7['status'](0xc8)['json']({'token':_0x4c940e,'user':_0x316899});};exports[a33_0xc88c45(0xe4)]=impersonate;