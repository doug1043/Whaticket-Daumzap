const a40_0xa6431a=a40_0x5840;(function(_0xfcd5c4,_0x4f79c5){const _0x3bf6bc=a40_0x5840,_0x4b1c30=_0xfcd5c4();while(!![]){try{const _0x2fa9c4=parseInt(_0x3bf6bc(0x1f2))/0x1+parseInt(_0x3bf6bc(0x1fc))/0x2*(-parseInt(_0x3bf6bc(0x1e3))/0x3)+parseInt(_0x3bf6bc(0x1f7))/0x4+parseInt(_0x3bf6bc(0x1ed))/0x5+-parseInt(_0x3bf6bc(0x1e6))/0x6*(parseInt(_0x3bf6bc(0x1fd))/0x7)+parseInt(_0x3bf6bc(0x20c))/0x8+-parseInt(_0x3bf6bc(0x1ff))/0x9;if(_0x2fa9c4===_0x4f79c5)break;else _0x4b1c30['push'](_0x4b1c30['shift']());}catch(_0x528fe1){_0x4b1c30['push'](_0x4b1c30['shift']());}}}(a40_0x15c6,0x1ebdd));const a40_0x24dd9e=(function(){let _0x367499=!![];return function(_0x3b0c18,_0x4c2936){const _0x392269=_0x367499?function(){if(_0x4c2936){const _0x9f388=_0x4c2936['apply'](_0x3b0c18,arguments);return _0x4c2936=null,_0x9f388;}}:function(){};return _0x367499=![],_0x392269;};}()),a40_0x430a27=a40_0x24dd9e(this,function(){const _0x586985=a40_0x5840;return a40_0x430a27['toString']()['search']('(((.+)+)+)+$')[_0x586985(0x20d)]()[_0x586985(0x211)](a40_0x430a27)['search'](_0x586985(0x1de));});a40_0x430a27();function a40_0x5840(_0xbcf22e,_0x59088f){const _0xf0c5e5=a40_0x15c6();return a40_0x5840=function(_0x430a27,_0x24dd9e){_0x430a27=_0x430a27-0x1dd;let _0x15c613=_0xf0c5e5[_0x430a27];return _0x15c613;},a40_0x5840(_0xbcf22e,_0x59088f);}'use strict';var __importDefault=this&&this[a40_0xa6431a(0x209)]||function(_0x1b32ba){const _0x1e5794=a40_0xa6431a;return _0x1b32ba&&_0x1b32ba[_0x1e5794(0x1e5)]?_0x1b32ba:{'default':_0x1b32ba};};Object[a40_0xa6431a(0x1f3)](exports,'__esModule',{'value':!![]}),exports[a40_0xa6431a(0x1ea)]=exports[a40_0xa6431a(0x1fb)]=exports['me']=exports['update']=exports[a40_0xa6431a(0x1e8)]=void 0x0;const AppError_1=__importDefault(require('../errors/AppError')),socket_1=require(a40_0xa6431a(0x1eb)),AuthUserService_1=__importDefault(require(a40_0xa6431a(0x213))),SendRefreshToken_1=require('../helpers/SendRefreshToken'),RefreshTokenService_1=require(a40_0xa6431a(0x1f9)),FindUserFromToken_1=__importDefault(require('../services/AuthServices/FindUserFromToken')),User_1=__importDefault(require(a40_0xa6431a(0x200))),SerializeUser_1=require('../helpers/SerializeUser'),CreateTokens_1=require(a40_0xa6431a(0x1f5)),Company_1=__importDefault(require('../models/Company')),Setting_1=__importDefault(require('../models/Setting')),GetProfilePermissions_1=require(a40_0xa6431a(0x1fa)),store=async(_0x253971,_0x28726e)=>{const _0x3f4cda=a40_0xa6431a,{email:_0x303937,password:_0x3d8d17}=_0x253971[_0x3f4cda(0x1e1)],{token:_0x24defe,serializedUser:_0x31821a,refreshToken:_0x3a5232}=await(0x0,AuthUserService_1[_0x3f4cda(0x1e2)])({'email':_0x303937,'password':_0x3d8d17});(0x0,SendRefreshToken_1[_0x3f4cda(0x20f)])(_0x28726e,_0x3a5232);const _0x4cb3df=(0x0,socket_1[_0x3f4cda(0x208)])();return _0x4cb3df['to'](_0x3f4cda(0x203)+_0x31821a['id'])['emit'](_0x3f4cda(0x1ec)+_0x31821a[_0x3f4cda(0x1e4)]+_0x3f4cda(0x205),{'action':_0x3f4cda(0x1ee),'user':{'id':_0x31821a['id'],'email':_0x31821a[_0x3f4cda(0x1f1)],'companyId':_0x31821a[_0x3f4cda(0x1e4)]}}),_0x28726e[_0x3f4cda(0x1e9)](0xc8)[_0x3f4cda(0x204)]({'token':_0x24defe,'user':_0x31821a});};exports[a40_0xa6431a(0x1e8)]=store;const update=async(_0x150953,_0x212b5f)=>{const _0x199a78=a40_0xa6431a,_0x21acf6=_0x150953[_0x199a78(0x20b)][_0x199a78(0x1f4)];if(!_0x21acf6)throw new AppError_1['default'](_0x199a78(0x206),0x191);const {user:_0x12955c,newToken:_0x2d1d32,refreshToken:_0x3293ed}=await(0x0,RefreshTokenService_1[_0x199a78(0x1df)])(_0x212b5f,_0x21acf6);return(0x0,SendRefreshToken_1[_0x199a78(0x20f)])(_0x212b5f,_0x3293ed),_0x212b5f[_0x199a78(0x204)]({'token':_0x2d1d32,'user':_0x12955c});};exports[a40_0xa6431a(0x1ee)]=update;const me=async(_0x447b48,_0x3b17e4)=>{const _0x392e5f=a40_0xa6431a,_0x48dc12=_0x447b48[_0x392e5f(0x20b)]['jrt'],_0x3bffee=await(0x0,FindUserFromToken_1[_0x392e5f(0x1e2)])(_0x48dc12),{id:_0x4f4cf8,profile:_0x25bf6f,email:_0x2fc61c,super:_0x310b99,companyId:_0x17d3ca}=_0x3bffee;if(!_0x48dc12)throw new AppError_1['default']('ERR_SESSION_EXPIRED',0x191);const _0x3206db=await(0x0,GetProfilePermissions_1[_0x392e5f(0x201)])(_0x25bf6f,_0x17d3ca);return _0x3b17e4[_0x392e5f(0x204)]({'id':_0x4f4cf8,'profile':_0x25bf6f,'email':_0x2fc61c,'super':_0x310b99,'permissions':_0x3206db});};exports['me']=me;const remove=async(_0x14fa21,_0x4267d2)=>{const _0xbf3047=a40_0xa6431a,{id:_0x554da9}=_0x14fa21[_0xbf3047(0x1dd)],_0x1d3e63=await User_1[_0xbf3047(0x1e2)]['findByPk'](_0x554da9);await _0x1d3e63[_0xbf3047(0x1ee)]({'online':![]});const _0x6efab9=(0x0,socket_1['getIO'])();return _0x6efab9['emit']('company-'+_0x1d3e63[_0xbf3047(0x1e4)]+_0xbf3047(0x20e),{'action':_0xbf3047(0x1ee),'user':{'id':_0x1d3e63['id'],'name':_0x1d3e63[_0xbf3047(0x1f8)],'email':_0x1d3e63[_0xbf3047(0x1f1)],'profile':_0x1d3e63[_0xbf3047(0x1e7)],'online':![],'isTricked':_0x1d3e63['isTricked'],'spy':_0x1d3e63[_0xbf3047(0x1f0)],'allTicket':_0x1d3e63['allTicket'],'whatsappId':_0x1d3e63['whatsappId'],'startWork':_0x1d3e63[_0xbf3047(0x20a)],'endWork':_0x1d3e63[_0xbf3047(0x202)],'defaultMenu':_0x1d3e63[_0xbf3047(0x207)]}}),_0x4267d2['clearCookie'](_0xbf3047(0x1f4)),_0x4267d2[_0xbf3047(0x1fe)]();};function a40_0x15c6(){const _0x5cd164=['profile','store','status','impersonate','../libs/socket','company-','1206140tHpJze','update','SerializeUser','spy','email','130508nUiTYz','defineProperty','jrt','../helpers/CreateTokens','ERR_NO_USER_FOUND','209264LQihVV','name','../services/AuthServices/RefreshTokenService','../helpers/GetProfilePermissions','remove','3814KAGFEz','2709xnTjNo','send','918369zInWvh','../models/User','GetProfilePermissions','endWork','user-','json','-auth','ERR_SESSION_EXPIRED','defaultMenu','getIO','__importDefault','startWork','cookies','1153920evPosj','toString','-user','SendRefreshToken','admin','constructor','queues','../services/UserServices/AuthUserService','user','(((.+)+)+)+$','RefreshTokenService','params','body','default','273vgZEGM','companyId','__esModule','2586Cpkboq'];a40_0x15c6=function(){return _0x5cd164;};return a40_0x15c6();}exports['remove']=remove;const impersonate=async(_0x24727c,_0x3b82bd)=>{const _0x587c64=a40_0xa6431a,_0x18c3c7=_0x24727c[_0x587c64(0x20b)][_0x587c64(0x1f4)],{companyId:_0x5a5b30}=_0x24727c[_0x587c64(0x1e0)];if(!_0x18c3c7)throw new AppError_1['default']('ERR_SESSION_EXPIRED',0x191);const _0x1f7562=await User_1['default']['findOne']({'where':{'companyId':Number(_0x5a5b30),'profile':_0x587c64(0x210)},'include':[_0x587c64(0x212),{'model':Company_1[_0x587c64(0x1e2)],'include':[{'model':Setting_1[_0x587c64(0x1e2)]}]}]});if(!_0x1f7562)throw new AppError_1[(_0x587c64(0x1e2))](_0x587c64(0x1f6),0x194);const _0x75328=(0x0,CreateTokens_1['createAccessToken'])(_0x1f7562),_0x4a1c37=(0x0,CreateTokens_1['createRefreshToken'])(_0x1f7562),_0x1df6be=await(0x0,SerializeUser_1[_0x587c64(0x1ef)])(_0x1f7562);(0x0,SendRefreshToken_1['SendRefreshToken'])(_0x3b82bd,_0x4a1c37);const _0x4ee6a7=(0x0,socket_1[_0x587c64(0x208)])();return _0x4ee6a7['to'](_0x587c64(0x203)+_0x1df6be['id'])['emit']('company-'+_0x1df6be[_0x587c64(0x1e4)]+_0x587c64(0x205),{'action':_0x587c64(0x1ee),'user':{'id':_0x1df6be['id'],'email':_0x1df6be[_0x587c64(0x1f1)],'companyId':_0x1df6be[_0x587c64(0x1e4)],'impersonated':!![]}}),_0x3b82bd[_0x587c64(0x1e9)](0xc8)[_0x587c64(0x204)]({'token':_0x75328,'user':_0x1df6be});};exports['impersonate']=impersonate;