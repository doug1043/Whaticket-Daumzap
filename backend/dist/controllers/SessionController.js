function a33_0x515c(){const _0x308623=['send','../models/User','../helpers/SendRefreshToken','cookies','8ExrPww','SerializeUser','emit','2685599TLVdHK','932614aIqvJh','companyId','json','defineProperty','toString','1894560AQtuER','ERR_NO_USER_FOUND','1087116oiSDne','RefreshTokenService','1378055noddAU','search','impersonate','-auth','update','jrt','../services/AuthServices/FindUserFromToken','constructor','19362357Bdpelm','apply','getIO','user-','params','__importDefault','SendRefreshToken','../models/Company','4PvaNsR','2102320qRZoDm','../errors/AppError','email','../services/UserServices/AuthUserService','../helpers/CreateTokens','admin','../libs/socket','(((.+)+)+)+$','default','status','clearCookie','store','company-','user','findOne','ERR_SESSION_EXPIRED','__esModule','remove'];a33_0x515c=function(){return _0x308623;};return a33_0x515c();}const a33_0x24a641=a33_0xeb8f;function a33_0xeb8f(_0x334526,_0x262026){const _0xa4c132=a33_0x515c();return a33_0xeb8f=function(_0x32624b,_0x5c0a86){_0x32624b=_0x32624b-0xc7;let _0x515c05=_0xa4c132[_0x32624b];return _0x515c05;},a33_0xeb8f(_0x334526,_0x262026);}(function(_0x58f26f,_0x18e9f4){const _0x39b15e=a33_0xeb8f,_0x2db0fc=_0x58f26f();while(!![]){try{const _0x3308e8=parseInt(_0x39b15e(0xe4))/0x1*(parseInt(_0x39b15e(0xcb))/0x2)+parseInt(_0x39b15e(0xd2))/0x3+parseInt(_0x39b15e(0xe5))/0x4+parseInt(_0x39b15e(0xd4))/0x5+-parseInt(_0x39b15e(0xd0))/0x6+parseInt(_0x39b15e(0xca))/0x7*(parseInt(_0x39b15e(0xc7))/0x8)+-parseInt(_0x39b15e(0xdc))/0x9;if(_0x3308e8===_0x18e9f4)break;else _0x2db0fc['push'](_0x2db0fc['shift']());}catch(_0x34bf9a){_0x2db0fc['push'](_0x2db0fc['shift']());}}}(a33_0x515c,0xe6ca3));const a33_0x5c0a86=(function(){let _0x3899f0=!![];return function(_0x3c8ca5,_0x3d8e72){const _0x27222e=_0x3899f0?function(){const _0x208f04=a33_0xeb8f;if(_0x3d8e72){const _0x4ad930=_0x3d8e72[_0x208f04(0xdd)](_0x3c8ca5,arguments);return _0x3d8e72=null,_0x4ad930;}}:function(){};return _0x3899f0=![],_0x27222e;};}()),a33_0x32624b=a33_0x5c0a86(this,function(){const _0x10e615=a33_0xeb8f;return a33_0x32624b[_0x10e615(0xcf)]()[_0x10e615(0xd5)](_0x10e615(0xec))['toString']()[_0x10e615(0xdb)](a33_0x32624b)[_0x10e615(0xd5)]('(((.+)+)+)+$');});a33_0x32624b();'use strict';var __importDefault=this&&this[a33_0x24a641(0xe1)]||function(_0x3d33e5){const _0x4a411a=a33_0x24a641;return _0x3d33e5&&_0x3d33e5[_0x4a411a(0xf5)]?_0x3d33e5:{'default':_0x3d33e5};};Object[a33_0x24a641(0xce)](exports,a33_0x24a641(0xf5),{'value':!![]}),exports[a33_0x24a641(0xd6)]=exports[a33_0x24a641(0xf6)]=exports['me']=exports[a33_0x24a641(0xd8)]=exports[a33_0x24a641(0xf0)]=void 0x0;const AppError_1=__importDefault(require(a33_0x24a641(0xe6))),socket_1=require(a33_0x24a641(0xeb)),AuthUserService_1=__importDefault(require(a33_0x24a641(0xe8))),SendRefreshToken_1=require(a33_0x24a641(0xf9)),RefreshTokenService_1=require('../services/AuthServices/RefreshTokenService'),FindUserFromToken_1=__importDefault(require(a33_0x24a641(0xda))),User_1=__importDefault(require(a33_0x24a641(0xf8))),SerializeUser_1=require('../helpers/SerializeUser'),CreateTokens_1=require(a33_0x24a641(0xe9)),Company_1=__importDefault(require(a33_0x24a641(0xe3))),Setting_1=__importDefault(require('../models/Setting')),store=async(_0x1b1e71,_0x110d78)=>{const _0x3bfd9e=a33_0x24a641,{email:_0xe683f5,password:_0x15c536}=_0x1b1e71['body'],{token:_0x45323c,serializedUser:_0x162f72,refreshToken:_0x12abfd}=await(0x0,AuthUserService_1['default'])({'email':_0xe683f5,'password':_0x15c536});(0x0,SendRefreshToken_1[_0x3bfd9e(0xe2)])(_0x110d78,_0x12abfd);const _0x35ce50=(0x0,socket_1[_0x3bfd9e(0xde)])();return _0x35ce50['to'](_0x3bfd9e(0xdf)+_0x162f72['id'])[_0x3bfd9e(0xc9)](_0x3bfd9e(0xf1)+_0x162f72['companyId']+_0x3bfd9e(0xd7),{'action':_0x3bfd9e(0xd8),'user':{'id':_0x162f72['id'],'email':_0x162f72[_0x3bfd9e(0xe7)],'companyId':_0x162f72[_0x3bfd9e(0xcc)]}}),_0x110d78[_0x3bfd9e(0xee)](0xc8)[_0x3bfd9e(0xcd)]({'token':_0x45323c,'user':_0x162f72});};exports[a33_0x24a641(0xf0)]=store;const update=async(_0x436ea1,_0x40c782)=>{const _0x30e10d=a33_0x24a641,_0x2f9083=_0x436ea1[_0x30e10d(0xfa)][_0x30e10d(0xd9)];if(!_0x2f9083)throw new AppError_1[(_0x30e10d(0xed))](_0x30e10d(0xf4),0x191);const {user:_0x280307,newToken:_0x1e9963,refreshToken:_0x296e94}=await(0x0,RefreshTokenService_1[_0x30e10d(0xd3)])(_0x40c782,_0x2f9083);return(0x0,SendRefreshToken_1[_0x30e10d(0xe2)])(_0x40c782,_0x296e94),_0x40c782['json']({'token':_0x1e9963,'user':_0x280307});};exports[a33_0x24a641(0xd8)]=update;const me=async(_0x2684a0,_0x22d3e8)=>{const _0x384c05=a33_0x24a641,_0x886254=_0x2684a0[_0x384c05(0xfa)][_0x384c05(0xd9)],_0x3d2488=await(0x0,FindUserFromToken_1[_0x384c05(0xed)])(_0x886254),{id:_0xdc0939,profile:_0x308d86,email:_0x555b0a,super:_0x3108c7}=_0x3d2488;if(!_0x886254)throw new AppError_1[(_0x384c05(0xed))](_0x384c05(0xf4),0x191);return _0x22d3e8[_0x384c05(0xcd)]({'id':_0xdc0939,'profile':_0x308d86,'email':_0x555b0a,'super':_0x3108c7});};exports['me']=me;const remove=async(_0x121153,_0x10694e)=>{const _0x459643=a33_0x24a641,{id:_0x231c70}=_0x121153[_0x459643(0xf2)],_0x339f73=await User_1[_0x459643(0xed)]['findByPk'](_0x231c70);return await _0x339f73['update']({'online':![]}),_0x10694e[_0x459643(0xef)](_0x459643(0xd9)),_0x10694e[_0x459643(0xf7)]();};exports[a33_0x24a641(0xf6)]=remove;const impersonate=async(_0x3f81ac,_0x394832)=>{const _0x1dcde6=a33_0x24a641,_0x369a49=_0x3f81ac[_0x1dcde6(0xfa)][_0x1dcde6(0xd9)],{companyId:_0x471768}=_0x3f81ac[_0x1dcde6(0xe0)];if(!_0x369a49)throw new AppError_1[(_0x1dcde6(0xed))](_0x1dcde6(0xf4),0x191);const _0x152f21=await User_1['default'][_0x1dcde6(0xf3)]({'where':{'companyId':Number(_0x471768),'profile':_0x1dcde6(0xea)},'include':['queues',{'model':Company_1[_0x1dcde6(0xed)],'include':[{'model':Setting_1[_0x1dcde6(0xed)]}]}]});if(!_0x152f21)throw new AppError_1[(_0x1dcde6(0xed))](_0x1dcde6(0xd1),0x194);const _0x56b54d=(0x0,CreateTokens_1['createAccessToken'])(_0x152f21),_0x38c195=(0x0,CreateTokens_1['createRefreshToken'])(_0x152f21),_0x49bade=await(0x0,SerializeUser_1[_0x1dcde6(0xc8)])(_0x152f21);(0x0,SendRefreshToken_1[_0x1dcde6(0xe2)])(_0x394832,_0x38c195);const _0x2fa909=(0x0,socket_1[_0x1dcde6(0xde)])();return _0x2fa909['to'](_0x1dcde6(0xdf)+_0x49bade['id'])[_0x1dcde6(0xc9)]('company-'+_0x49bade[_0x1dcde6(0xcc)]+_0x1dcde6(0xd7),{'action':'update','user':{'id':_0x49bade['id'],'email':_0x49bade[_0x1dcde6(0xe7)],'companyId':_0x49bade[_0x1dcde6(0xcc)],'impersonated':!![]}}),_0x394832['status'](0xc8)[_0x1dcde6(0xcd)]({'token':_0x56b54d,'user':_0x49bade});};exports[a33_0x24a641(0xd6)]=impersonate;