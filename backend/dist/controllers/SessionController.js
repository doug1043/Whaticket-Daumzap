const a33_0x15f987=a33_0x40a3;function a33_0x40a3(_0x2d28bc,_0x30f3bc){const _0x49a92a=a33_0x499e();return a33_0x40a3=function(_0x2ce7aa,_0x4c5f70){_0x2ce7aa=_0x2ce7aa-0x123;let _0x499e9d=_0x49a92a[_0x2ce7aa];return _0x499e9d;},a33_0x40a3(_0x2d28bc,_0x30f3bc);}(function(_0x1beeec,_0x3d0d80){const _0x3343a1=a33_0x40a3,_0x5cb517=_0x1beeec();while(!![]){try{const _0x2507bd=-parseInt(_0x3343a1(0x123))/0x1+parseInt(_0x3343a1(0x142))/0x2*(-parseInt(_0x3343a1(0x12c))/0x3)+-parseInt(_0x3343a1(0x153))/0x4+-parseInt(_0x3343a1(0x146))/0x5+parseInt(_0x3343a1(0x14c))/0x6+parseInt(_0x3343a1(0x155))/0x7*(-parseInt(_0x3343a1(0x135))/0x8)+-parseInt(_0x3343a1(0x156))/0x9*(-parseInt(_0x3343a1(0x13a))/0xa);if(_0x2507bd===_0x3d0d80)break;else _0x5cb517['push'](_0x5cb517['shift']());}catch(_0xc447a2){_0x5cb517['push'](_0x5cb517['shift']());}}}(a33_0x499e,0x717c5));const a33_0x4c5f70=(function(){let _0x484f49=!![];return function(_0x5ec017,_0x21d0af){const _0x348f25=_0x484f49?function(){if(_0x21d0af){const _0x1a4f37=_0x21d0af['apply'](_0x5ec017,arguments);return _0x21d0af=null,_0x1a4f37;}}:function(){};return _0x484f49=![],_0x348f25;};}()),a33_0x2ce7aa=a33_0x4c5f70(this,function(){const _0x1679d8=a33_0x40a3;return a33_0x2ce7aa[_0x1679d8(0x13d)]()[_0x1679d8(0x14d)](_0x1679d8(0x150))['toString']()[_0x1679d8(0x13f)](a33_0x2ce7aa)[_0x1679d8(0x14d)](_0x1679d8(0x150));});a33_0x2ce7aa();'use strict';var __importDefault=this&&this[a33_0x15f987(0x124)]||function(_0x23b007){return _0x23b007&&_0x23b007['__esModule']?_0x23b007:{'default':_0x23b007};};Object[a33_0x15f987(0x13b)](exports,'__esModule',{'value':!![]}),exports['impersonate']=exports[a33_0x15f987(0x12f)]=exports['me']=exports[a33_0x15f987(0x144)]=exports[a33_0x15f987(0x130)]=void 0x0;const AppError_1=__importDefault(require(a33_0x15f987(0x14f))),socket_1=require(a33_0x15f987(0x139)),AuthUserService_1=__importDefault(require(a33_0x15f987(0x149))),SendRefreshToken_1=require('../helpers/SendRefreshToken'),RefreshTokenService_1=require(a33_0x15f987(0x127)),FindUserFromToken_1=__importDefault(require('../services/AuthServices/FindUserFromToken')),User_1=__importDefault(require(a33_0x15f987(0x128))),SerializeUser_1=require(a33_0x15f987(0x129)),CreateTokens_1=require(a33_0x15f987(0x148)),Company_1=__importDefault(require('../models/Company')),Setting_1=__importDefault(require('../models/Setting')),store=async(_0x221c3f,_0xa51752)=>{const _0x45f333=a33_0x15f987,{email:_0x41a16f,password:_0x3df930}=_0x221c3f[_0x45f333(0x14e)],{token:_0x38fcae,serializedUser:_0x3fd135,refreshToken:_0x50f352}=await(0x0,AuthUserService_1[_0x45f333(0x152)])({'email':_0x41a16f,'password':_0x3df930});(0x0,SendRefreshToken_1['SendRefreshToken'])(_0xa51752,_0x50f352);const _0x3b66a4=(0x0,socket_1['getIO'])();return _0x3b66a4['to']('user-'+_0x3fd135['id'])[_0x45f333(0x145)]('company-'+_0x3fd135[_0x45f333(0x131)]+_0x45f333(0x13c),{'action':'update','user':{'id':_0x3fd135['id'],'email':_0x3fd135[_0x45f333(0x12d)],'companyId':_0x3fd135[_0x45f333(0x131)]}}),_0xa51752[_0x45f333(0x137)](0xc8)[_0x45f333(0x12a)]({'token':_0x38fcae,'user':_0x3fd135});};exports[a33_0x15f987(0x130)]=store;const update=async(_0x5ac069,_0xd17085)=>{const _0x2d899e=a33_0x15f987,_0x309cf5=_0x5ac069[_0x2d899e(0x154)][_0x2d899e(0x143)];if(!_0x309cf5)throw new AppError_1[(_0x2d899e(0x152))]('ERR_SESSION_EXPIRED',0x191);const {user:_0x208a7f,newToken:_0x32507d,refreshToken:_0x6a00cc}=await(0x0,RefreshTokenService_1[_0x2d899e(0x14b)])(_0xd17085,_0x309cf5);return(0x0,SendRefreshToken_1[_0x2d899e(0x151)])(_0xd17085,_0x6a00cc),_0xd17085[_0x2d899e(0x12a)]({'token':_0x32507d,'user':_0x208a7f});};exports[a33_0x15f987(0x144)]=update;function a33_0x499e(){const _0x3dd0b4=['SendRefreshToken','default','1307448xLVhzC','cookies','9443lmyjXk','793215ewtMfM','6628NZZoft','__importDefault','user','send','../services/AuthServices/RefreshTokenService','../models/User','../helpers/SerializeUser','json','company-','185667RrWRnC','email','admin','remove','store','companyId','createRefreshToken','impersonate','getIO','1352UostyX','findByPk','status','SerializeUser','../libs/socket','160LmHYPW','defineProperty','-auth','toString','ERR_SESSION_EXPIRED','constructor','findOne','user-','2NzDGdC','jrt','update','emit','4086495BrJLgx','createAccessToken','../helpers/CreateTokens','../services/UserServices/AuthUserService','params','RefreshTokenService','2972016RVNrIH','search','body','../errors/AppError','(((.+)+)+)+$'];a33_0x499e=function(){return _0x3dd0b4;};return a33_0x499e();}const me=async(_0x578fbe,_0x1459da)=>{const _0x537303=a33_0x15f987,_0x4644c2=_0x578fbe[_0x537303(0x154)][_0x537303(0x143)],_0x9050e5=await(0x0,FindUserFromToken_1['default'])(_0x4644c2),{id:_0x5baf62,profile:_0x6dfb9a,email:_0x2b1b7a,super:_0x2d7f75}=_0x9050e5;if(!_0x4644c2)throw new AppError_1[(_0x537303(0x152))](_0x537303(0x13e),0x191);return _0x1459da[_0x537303(0x12a)]({'id':_0x5baf62,'profile':_0x6dfb9a,'email':_0x2b1b7a,'super':_0x2d7f75});};exports['me']=me;const remove=async(_0x3b2109,_0xac366e)=>{const _0x4829fc=a33_0x15f987,{id:_0x272c6b}=_0x3b2109[_0x4829fc(0x125)],_0x3eff49=await User_1[_0x4829fc(0x152)][_0x4829fc(0x136)](_0x272c6b);return await _0x3eff49[_0x4829fc(0x144)]({'online':![]}),_0xac366e['clearCookie'](_0x4829fc(0x143)),_0xac366e[_0x4829fc(0x126)]();};exports[a33_0x15f987(0x12f)]=remove;const impersonate=async(_0x580fa6,_0xaf5b60)=>{const _0xa09d2a=a33_0x15f987,_0x3f78e4=_0x580fa6[_0xa09d2a(0x154)][_0xa09d2a(0x143)],{companyId:_0x3211d3}=_0x580fa6[_0xa09d2a(0x14a)];if(!_0x3f78e4)throw new AppError_1[(_0xa09d2a(0x152))](_0xa09d2a(0x13e),0x191);const _0x302b81=await User_1[_0xa09d2a(0x152)][_0xa09d2a(0x140)]({'where':{'companyId':Number(_0x3211d3),'profile':_0xa09d2a(0x12e)},'include':['queues',{'model':Company_1[_0xa09d2a(0x152)],'include':[{'model':Setting_1[_0xa09d2a(0x152)]}]}]});if(!_0x302b81)throw new AppError_1['default']('ERR_NO_USER_FOUND',0x194);const _0x590012=(0x0,CreateTokens_1[_0xa09d2a(0x147)])(_0x302b81),_0x27849a=(0x0,CreateTokens_1[_0xa09d2a(0x132)])(_0x302b81),_0x48b89f=await(0x0,SerializeUser_1[_0xa09d2a(0x138)])(_0x302b81);(0x0,SendRefreshToken_1['SendRefreshToken'])(_0xaf5b60,_0x27849a);const _0x2356ab=(0x0,socket_1[_0xa09d2a(0x134)])();return _0x2356ab['to'](_0xa09d2a(0x141)+_0x48b89f['id'])[_0xa09d2a(0x145)](_0xa09d2a(0x12b)+_0x48b89f[_0xa09d2a(0x131)]+'-auth',{'action':_0xa09d2a(0x144),'user':{'id':_0x48b89f['id'],'email':_0x48b89f[_0xa09d2a(0x12d)],'companyId':_0x48b89f[_0xa09d2a(0x131)],'impersonated':!![]}}),_0xaf5b60['status'](0xc8)[_0xa09d2a(0x12a)]({'token':_0x590012,'user':_0x48b89f});};exports[a33_0x15f987(0x133)]=impersonate;