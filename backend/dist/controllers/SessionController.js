const a33_0x1a17b7=a33_0x12d7;(function(_0x41562c,_0x599168){const _0x2bed3d=a33_0x12d7,_0x5c6d66=_0x41562c();while(!![]){try{const _0x3662c8=parseInt(_0x2bed3d(0xd4))/0x1*(parseInt(_0x2bed3d(0xc3))/0x2)+parseInt(_0x2bed3d(0xec))/0x3+parseInt(_0x2bed3d(0xdd))/0x4+parseInt(_0x2bed3d(0xee))/0x5+parseInt(_0x2bed3d(0xca))/0x6*(parseInt(_0x2bed3d(0xf0))/0x7)+-parseInt(_0x2bed3d(0xc8))/0x8*(parseInt(_0x2bed3d(0xe0))/0x9)+-parseInt(_0x2bed3d(0xe3))/0xa*(parseInt(_0x2bed3d(0xd2))/0xb);if(_0x3662c8===_0x599168)break;else _0x5c6d66['push'](_0x5c6d66['shift']());}catch(_0xd5e53){_0x5c6d66['push'](_0x5c6d66['shift']());}}}(a33_0x1b44,0x8cbb7));const a33_0x3cb516=(function(){let _0x45f334=!![];return function(_0x444fdb,_0x4078fb){const _0x2fdbc7=_0x45f334?function(){const _0x46c831=a33_0x12d7;if(_0x4078fb){const _0x33d34d=_0x4078fb[_0x46c831(0xc6)](_0x444fdb,arguments);return _0x4078fb=null,_0x33d34d;}}:function(){};return _0x45f334=![],_0x2fdbc7;};}()),a33_0x2f690d=a33_0x3cb516(this,function(){const _0x1ee58e=a33_0x12d7;return a33_0x2f690d['toString']()[_0x1ee58e(0xc0)](_0x1ee58e(0xdc))[_0x1ee58e(0xc1)]()[_0x1ee58e(0xe8)](a33_0x2f690d)['search'](_0x1ee58e(0xdc));});a33_0x2f690d();'use strict';var __importDefault=this&&this[a33_0x1a17b7(0xd9)]||function(_0x5adaf0){const _0x280ee0=a33_0x1a17b7;return _0x5adaf0&&_0x5adaf0[_0x280ee0(0xd5)]?_0x5adaf0:{'default':_0x5adaf0};};function a33_0x1b44(){const _0x427419=['ERR_SESSION_EXPIRED','../services/AuthServices/RefreshTokenService','2624435OLtIxB','SendRefreshToken','349010urgUYG','__esModule','status','queues','clearCookie','__importDefault','../services/AuthServices/FindUserFromToken','companyId','(((.+)+)+)+$','1467500MFVHPp','params','../models/Company','27VOXKlr','createRefreshToken','remove','110PYnhSX','getIO','../libs/socket','../models/User','store','constructor','impersonate','jrt','../helpers/SendRefreshToken','2384913bRJsfp','cookies','4490660doNOvc','-auth','453481PmzreN','emit','user-','../services/UserServices/AuthUserService','admin','search','toString','json','6ewCgfE','createAccessToken','defineProperty','apply','SerializeUser','1649992LotnJf','../helpers/CreateTokens','66awDhPk','user','default','../errors/AppError','update','RefreshTokenService'];a33_0x1b44=function(){return _0x427419;};return a33_0x1b44();}Object[a33_0x1a17b7(0xc5)](exports,a33_0x1a17b7(0xd5),{'value':!![]}),exports['impersonate']=exports[a33_0x1a17b7(0xe2)]=exports['me']=exports['update']=exports['store']=void 0x0;const AppError_1=__importDefault(require(a33_0x1a17b7(0xcd))),socket_1=require(a33_0x1a17b7(0xe5)),AuthUserService_1=__importDefault(require(a33_0x1a17b7(0xbe))),SendRefreshToken_1=require(a33_0x1a17b7(0xeb)),RefreshTokenService_1=require(a33_0x1a17b7(0xd1)),FindUserFromToken_1=__importDefault(require(a33_0x1a17b7(0xda))),User_1=__importDefault(require(a33_0x1a17b7(0xe6))),SerializeUser_1=require('../helpers/SerializeUser'),CreateTokens_1=require(a33_0x1a17b7(0xc9)),Company_1=__importDefault(require(a33_0x1a17b7(0xdf))),Setting_1=__importDefault(require('../models/Setting')),store=async(_0x3b0097,_0x580a70)=>{const _0x625fe0=a33_0x1a17b7,{email:_0x28bef5,password:_0x515d11}=_0x3b0097['body'],{token:_0x3556dd,serializedUser:_0x697dcc,refreshToken:_0x22a390}=await(0x0,AuthUserService_1[_0x625fe0(0xcc)])({'email':_0x28bef5,'password':_0x515d11});(0x0,SendRefreshToken_1[_0x625fe0(0xd3)])(_0x580a70,_0x22a390);const _0x1139e0=(0x0,socket_1[_0x625fe0(0xe4)])();return _0x1139e0['to']('user-'+_0x697dcc['id'])[_0x625fe0(0xf1)]('company-'+_0x697dcc[_0x625fe0(0xdb)]+_0x625fe0(0xef),{'action':_0x625fe0(0xce),'user':{'id':_0x697dcc['id'],'email':_0x697dcc['email'],'companyId':_0x697dcc[_0x625fe0(0xdb)]}}),_0x580a70[_0x625fe0(0xd6)](0xc8)['json']({'token':_0x3556dd,'user':_0x697dcc});};exports[a33_0x1a17b7(0xe7)]=store;const update=async(_0x25b1ac,_0x4271da)=>{const _0x155c74=a33_0x1a17b7,_0x590961=_0x25b1ac['cookies'][_0x155c74(0xea)];if(!_0x590961)throw new AppError_1[(_0x155c74(0xcc))]('ERR_SESSION_EXPIRED',0x191);const {user:_0x53dc88,newToken:_0x95ce58,refreshToken:_0x1d181e}=await(0x0,RefreshTokenService_1[_0x155c74(0xcf)])(_0x4271da,_0x590961);return(0x0,SendRefreshToken_1[_0x155c74(0xd3)])(_0x4271da,_0x1d181e),_0x4271da[_0x155c74(0xc2)]({'token':_0x95ce58,'user':_0x53dc88});};exports['update']=update;const me=async(_0x5176fc,_0xd2244d)=>{const _0x4595da=a33_0x1a17b7,_0x3274b9=_0x5176fc[_0x4595da(0xed)][_0x4595da(0xea)],_0x413a65=await(0x0,FindUserFromToken_1[_0x4595da(0xcc)])(_0x3274b9),{id:_0x1bf6ec,profile:_0x3bfb48,email:_0x5c6bc3,super:_0x56058b}=_0x413a65;if(!_0x3274b9)throw new AppError_1[(_0x4595da(0xcc))]('ERR_SESSION_EXPIRED',0x191);return _0xd2244d[_0x4595da(0xc2)]({'id':_0x1bf6ec,'profile':_0x3bfb48,'email':_0x5c6bc3,'super':_0x56058b});};exports['me']=me;const remove=async(_0x118ef4,_0xd14801)=>{const _0x31f35b=a33_0x1a17b7,{id:_0x10c4ef}=_0x118ef4[_0x31f35b(0xcb)],_0x2fe954=await User_1[_0x31f35b(0xcc)]['findByPk'](_0x10c4ef);return await _0x2fe954[_0x31f35b(0xce)]({'online':![]}),_0xd14801[_0x31f35b(0xd8)](_0x31f35b(0xea)),_0xd14801['send']();};exports[a33_0x1a17b7(0xe2)]=remove;const impersonate=async(_0x4e79e0,_0x1bcae6)=>{const _0x5b868d=a33_0x1a17b7,_0x28f6ff=_0x4e79e0[_0x5b868d(0xed)][_0x5b868d(0xea)],{companyId:_0x2931f3}=_0x4e79e0[_0x5b868d(0xde)];if(!_0x28f6ff)throw new AppError_1[(_0x5b868d(0xcc))](_0x5b868d(0xd0),0x191);const _0x3081d8=await User_1[_0x5b868d(0xcc)]['findOne']({'where':{'companyId':Number(_0x2931f3),'profile':_0x5b868d(0xbf)},'include':[_0x5b868d(0xd7),{'model':Company_1[_0x5b868d(0xcc)],'include':[{'model':Setting_1[_0x5b868d(0xcc)]}]}]});if(!_0x3081d8)throw new AppError_1['default']('ERR_NO_USER_FOUND',0x194);const _0x254251=(0x0,CreateTokens_1[_0x5b868d(0xc4)])(_0x3081d8),_0x25eafb=(0x0,CreateTokens_1[_0x5b868d(0xe1)])(_0x3081d8),_0xf159ff=await(0x0,SerializeUser_1[_0x5b868d(0xc7)])(_0x3081d8);(0x0,SendRefreshToken_1[_0x5b868d(0xd3)])(_0x1bcae6,_0x25eafb);const _0x149742=(0x0,socket_1[_0x5b868d(0xe4)])();return _0x149742['to'](_0x5b868d(0xf2)+_0xf159ff['id'])[_0x5b868d(0xf1)]('company-'+_0xf159ff[_0x5b868d(0xdb)]+_0x5b868d(0xef),{'action':_0x5b868d(0xce),'user':{'id':_0xf159ff['id'],'email':_0xf159ff['email'],'companyId':_0xf159ff[_0x5b868d(0xdb)],'impersonated':!![]}}),_0x1bcae6[_0x5b868d(0xd6)](0xc8)[_0x5b868d(0xc2)]({'token':_0x254251,'user':_0xf159ff});};function a33_0x12d7(_0x50353c,_0x3d07f0){const _0x1d7011=a33_0x1b44();return a33_0x12d7=function(_0x2f690d,_0x3cb516){_0x2f690d=_0x2f690d-0xbe;let _0x1b44d5=_0x1d7011[_0x2f690d];return _0x1b44d5;},a33_0x12d7(_0x50353c,_0x3d07f0);}exports[a33_0x1a17b7(0xe9)]=impersonate;