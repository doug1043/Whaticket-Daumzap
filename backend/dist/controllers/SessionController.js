const a40_0x39fdff=a40_0x2186;(function(_0x4fadc9,_0x89106b){const _0x4c66d1=a40_0x2186,_0x23e368=_0x4fadc9();while(!![]){try{const _0x33abb2=parseInt(_0x4c66d1(0x1ba))/0x1+-parseInt(_0x4c66d1(0x1c9))/0x2*(parseInt(_0x4c66d1(0x1c2))/0x3)+parseInt(_0x4c66d1(0x199))/0x4*(parseInt(_0x4c66d1(0x19a))/0x5)+parseInt(_0x4c66d1(0x19f))/0x6*(-parseInt(_0x4c66d1(0x1bb))/0x7)+-parseInt(_0x4c66d1(0x1b7))/0x8+-parseInt(_0x4c66d1(0x1ad))/0x9*(parseInt(_0x4c66d1(0x1c7))/0xa)+parseInt(_0x4c66d1(0x1c1))/0xb;if(_0x33abb2===_0x89106b)break;else _0x23e368['push'](_0x23e368['shift']());}catch(_0x1307b1){_0x23e368['push'](_0x23e368['shift']());}}}(a40_0x2ed2,0x31e7b));const a40_0x2753a3=(function(){let _0x2fce10=!![];return function(_0xfaf191,_0x427182){const _0x681e81=_0x2fce10?function(){const _0x1aa8a0=a40_0x2186;if(_0x427182){const _0x48ef50=_0x427182[_0x1aa8a0(0x1cd)](_0xfaf191,arguments);return _0x427182=null,_0x48ef50;}}:function(){};return _0x2fce10=![],_0x681e81;};}()),a40_0x793020=a40_0x2753a3(this,function(){const _0x4b8029=a40_0x2186;return a40_0x793020[_0x4b8029(0x1c6)]()[_0x4b8029(0x1a1)]('(((.+)+)+)+$')['toString']()[_0x4b8029(0x1ab)](a40_0x793020)[_0x4b8029(0x1a1)]('(((.+)+)+)+$');});a40_0x793020();function a40_0x2ed2(){const _0x13036d=['queues','../libs/socket','isTricked','remove','ERR_SESSION_EXPIRED','name','../services/AuthServices/RefreshTokenService','params','610472bGFECr','5DPLwvS','../services/UserServices/AuthUserService','user-','user','store','458022pksNHc','../errors/AppError','search','RefreshTokenService','findByPk','SerializeUser','createAccessToken','endWork','ERR_NO_USER_FOUND','companyId','startWork','GetProfilePermissions','constructor','cookies','9NRPsor','update','SendRefreshToken','jrt','../models/Setting','findOne','defaultMenu','impersonate','json','spy','1002000oRlRdp','default','__esModule','263372uqGAhe','7lZRMdC','defineProperty','admin','getIO','-user','../models/Company','2385603DYtQTl','270LyuYmB','../helpers/GetProfilePermissions','status','company-','toString','129350kloNtR','-auth','4754GjRqPQ','../helpers/SendRefreshToken','emit','email','apply','whatsappId','../models/User','clearCookie','send'];a40_0x2ed2=function(){return _0x13036d;};return a40_0x2ed2();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x14d81d){const _0x51a0e5=a40_0x2186;return _0x14d81d&&_0x14d81d[_0x51a0e5(0x1b9)]?_0x14d81d:{'default':_0x14d81d};};Object[a40_0x39fdff(0x1bc)](exports,a40_0x39fdff(0x1b9),{'value':!![]}),exports[a40_0x39fdff(0x1b4)]=exports[a40_0x39fdff(0x194)]=exports['me']=exports['update']=exports[a40_0x39fdff(0x19e)]=void 0x0;const AppError_1=__importDefault(require(a40_0x39fdff(0x1a0))),socket_1=require(a40_0x39fdff(0x192)),AuthUserService_1=__importDefault(require(a40_0x39fdff(0x19b))),SendRefreshToken_1=require(a40_0x39fdff(0x1ca)),RefreshTokenService_1=require(a40_0x39fdff(0x197)),FindUserFromToken_1=__importDefault(require('../services/AuthServices/FindUserFromToken')),User_1=__importDefault(require(a40_0x39fdff(0x18e))),SerializeUser_1=require('../helpers/SerializeUser'),CreateTokens_1=require('../helpers/CreateTokens'),Company_1=__importDefault(require(a40_0x39fdff(0x1c0))),Setting_1=__importDefault(require(a40_0x39fdff(0x1b1))),GetProfilePermissions_1=require(a40_0x39fdff(0x1c3)),store=async(_0x436116,_0x2efb60)=>{const _0x1a873e=a40_0x39fdff,{email:_0x50c713,password:_0x364fd9}=_0x436116['body'],{token:_0x3801c6,serializedUser:_0x375c3c,refreshToken:_0xa848af}=await(0x0,AuthUserService_1[_0x1a873e(0x1b8)])({'email':_0x50c713,'password':_0x364fd9});(0x0,SendRefreshToken_1[_0x1a873e(0x1af)])(_0x2efb60,_0xa848af);const _0x2a984f=(0x0,socket_1['getIO'])();return _0x2a984f['to'](_0x1a873e(0x19c)+_0x375c3c['id'])[_0x1a873e(0x1cb)]('company-'+_0x375c3c['companyId']+_0x1a873e(0x1c8),{'action':'update','user':{'id':_0x375c3c['id'],'email':_0x375c3c['email'],'companyId':_0x375c3c[_0x1a873e(0x1a8)]}}),_0x2efb60[_0x1a873e(0x1c4)](0xc8)['json']({'token':_0x3801c6,'user':_0x375c3c});};exports[a40_0x39fdff(0x19e)]=store;const update=async(_0x1fb7a9,_0x26ed96)=>{const _0x3a3399=a40_0x39fdff,_0x2f0591=_0x1fb7a9[_0x3a3399(0x1ac)][_0x3a3399(0x1b0)];if(!_0x2f0591)throw new AppError_1['default'](_0x3a3399(0x195),0x191);const {user:_0x2057ac,newToken:_0x4c1bf0,refreshToken:_0x14b338}=await(0x0,RefreshTokenService_1[_0x3a3399(0x1a2)])(_0x26ed96,_0x2f0591);return(0x0,SendRefreshToken_1[_0x3a3399(0x1af)])(_0x26ed96,_0x14b338),_0x26ed96[_0x3a3399(0x1b5)]({'token':_0x4c1bf0,'user':_0x2057ac});};exports[a40_0x39fdff(0x1ae)]=update;function a40_0x2186(_0x5b1230,_0x27712d){const _0x34d186=a40_0x2ed2();return a40_0x2186=function(_0x793020,_0x2753a3){_0x793020=_0x793020-0x18e;let _0x2ed25c=_0x34d186[_0x793020];return _0x2ed25c;},a40_0x2186(_0x5b1230,_0x27712d);}const me=async(_0x313fdc,_0x4c9c80)=>{const _0x3424a6=a40_0x39fdff,_0x238f70=_0x313fdc['cookies']['jrt'],_0x12f14a=await(0x0,FindUserFromToken_1['default'])(_0x238f70),{id:_0x49f5a5,profile:_0xa41e21,email:_0x48b581,super:_0x2d4681,companyId:_0x57b3d1}=_0x12f14a;if(!_0x238f70)throw new AppError_1[(_0x3424a6(0x1b8))](_0x3424a6(0x195),0x191);const _0x2bd7d4=await(0x0,GetProfilePermissions_1[_0x3424a6(0x1aa)])(_0xa41e21,_0x57b3d1);return _0x4c9c80[_0x3424a6(0x1b5)]({'id':_0x49f5a5,'profile':_0xa41e21,'email':_0x48b581,'super':_0x2d4681,'permissions':_0x2bd7d4});};exports['me']=me;const remove=async(_0x3e163c,_0x4e2eed)=>{const _0x56a902=a40_0x39fdff,{id:_0x3686b1}=_0x3e163c[_0x56a902(0x19d)],_0x2ad16d=await User_1['default'][_0x56a902(0x1a3)](_0x3686b1);await _0x2ad16d[_0x56a902(0x1ae)]({'online':![]});const _0x237f33=(0x0,socket_1['getIO'])();return _0x237f33[_0x56a902(0x1cb)](_0x56a902(0x1c5)+_0x2ad16d['companyId']+_0x56a902(0x1bf),{'action':_0x56a902(0x1ae),'user':{'id':_0x2ad16d['id'],'name':_0x2ad16d[_0x56a902(0x196)],'email':_0x2ad16d[_0x56a902(0x1cc)],'profile':_0x2ad16d['profile'],'online':![],'isTricked':_0x2ad16d[_0x56a902(0x193)],'spy':_0x2ad16d[_0x56a902(0x1b6)],'allTicket':_0x2ad16d['allTicket'],'whatsappId':_0x2ad16d[_0x56a902(0x1ce)],'startWork':_0x2ad16d[_0x56a902(0x1a9)],'endWork':_0x2ad16d[_0x56a902(0x1a6)],'defaultMenu':_0x2ad16d[_0x56a902(0x1b3)]}}),_0x4e2eed[_0x56a902(0x18f)]('jrt'),_0x4e2eed[_0x56a902(0x190)]();};exports['remove']=remove;const impersonate=async(_0x28653e,_0x83f7d9)=>{const _0x540d41=a40_0x39fdff,_0x4cff67=_0x28653e[_0x540d41(0x1ac)]['jrt'],{companyId:_0x5d7389}=_0x28653e[_0x540d41(0x198)];if(!_0x4cff67)throw new AppError_1[(_0x540d41(0x1b8))]('ERR_SESSION_EXPIRED',0x191);const _0x1965bf=await User_1[_0x540d41(0x1b8)][_0x540d41(0x1b2)]({'where':{'companyId':Number(_0x5d7389),'profile':_0x540d41(0x1bd)},'include':[_0x540d41(0x191),{'model':Company_1['default'],'include':[{'model':Setting_1[_0x540d41(0x1b8)]}]}]});if(!_0x1965bf)throw new AppError_1[(_0x540d41(0x1b8))](_0x540d41(0x1a7),0x194);const _0x2f6337=(0x0,CreateTokens_1[_0x540d41(0x1a5)])(_0x1965bf),_0x3a1027=(0x0,CreateTokens_1['createRefreshToken'])(_0x1965bf),_0x36e97a=await(0x0,SerializeUser_1[_0x540d41(0x1a4)])(_0x1965bf);(0x0,SendRefreshToken_1[_0x540d41(0x1af)])(_0x83f7d9,_0x3a1027);const _0x50b132=(0x0,socket_1[_0x540d41(0x1be)])();return _0x50b132['to'](_0x540d41(0x19c)+_0x36e97a['id'])['emit']('company-'+_0x36e97a['companyId']+_0x540d41(0x1c8),{'action':_0x540d41(0x1ae),'user':{'id':_0x36e97a['id'],'email':_0x36e97a['email'],'companyId':_0x36e97a['companyId'],'impersonated':!![]}}),_0x83f7d9[_0x540d41(0x1c4)](0xc8)[_0x540d41(0x1b5)]({'token':_0x2f6337,'user':_0x36e97a});};exports['impersonate']=impersonate;