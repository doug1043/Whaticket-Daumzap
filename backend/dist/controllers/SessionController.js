const a40_0x6ffb33=a40_0xd512;(function(_0x1c48bb,_0x990143){const _0x17f75b=a40_0xd512,_0x21e1dc=_0x1c48bb();while(!![]){try{const _0x1b6b3c=parseInt(_0x17f75b(0x138))/0x1+-parseInt(_0x17f75b(0x12e))/0x2*(parseInt(_0x17f75b(0x140))/0x3)+-parseInt(_0x17f75b(0x121))/0x4+-parseInt(_0x17f75b(0x14a))/0x5*(-parseInt(_0x17f75b(0x125))/0x6)+-parseInt(_0x17f75b(0x137))/0x7*(-parseInt(_0x17f75b(0x142))/0x8)+parseInt(_0x17f75b(0x10f))/0x9+-parseInt(_0x17f75b(0x144))/0xa;if(_0x1b6b3c===_0x990143)break;else _0x21e1dc['push'](_0x21e1dc['shift']());}catch(_0x22d93b){_0x21e1dc['push'](_0x21e1dc['shift']());}}}(a40_0x5108,0x59303));function a40_0xd512(_0x1922e6,_0x4e6326){const _0x40a147=a40_0x5108();return a40_0xd512=function(_0x473614,_0x460de3){_0x473614=_0x473614-0x10e;let _0x5108d1=_0x40a147[_0x473614];return _0x5108d1;},a40_0xd512(_0x1922e6,_0x4e6326);}const a40_0x460de3=(function(){let _0x555e5c=!![];return function(_0x2e0e4c,_0x5a11b9){const _0x59dbc2=_0x555e5c?function(){if(_0x5a11b9){const _0x531405=_0x5a11b9['apply'](_0x2e0e4c,arguments);return _0x5a11b9=null,_0x531405;}}:function(){};return _0x555e5c=![],_0x59dbc2;};}()),a40_0x473614=a40_0x460de3(this,function(){const _0x25b886=a40_0xd512;return a40_0x473614['toString']()[_0x25b886(0x111)]('(((.+)+)+)+$')[_0x25b886(0x148)]()[_0x25b886(0x135)](a40_0x473614)[_0x25b886(0x111)](_0x25b886(0x128));});a40_0x473614();'use strict';var __importDefault=this&&this[a40_0x6ffb33(0x13e)]||function(_0x4efde3){return _0x4efde3&&_0x4efde3['__esModule']?_0x4efde3:{'default':_0x4efde3};};Object['defineProperty'](exports,a40_0x6ffb33(0x11d),{'value':!![]}),exports['impersonate']=exports[a40_0x6ffb33(0x149)]=exports['me']=exports[a40_0x6ffb33(0x124)]=exports[a40_0x6ffb33(0x113)]=void 0x0;const AppError_1=__importDefault(require('../errors/AppError')),socket_1=require(a40_0x6ffb33(0x145)),AuthUserService_1=__importDefault(require(a40_0x6ffb33(0x114))),SendRefreshToken_1=require(a40_0x6ffb33(0x133)),RefreshTokenService_1=require('../services/AuthServices/RefreshTokenService'),FindUserFromToken_1=__importDefault(require(a40_0x6ffb33(0x123))),User_1=__importDefault(require('../models/User')),SerializeUser_1=require(a40_0x6ffb33(0x143)),CreateTokens_1=require(a40_0x6ffb33(0x131)),Company_1=__importDefault(require(a40_0x6ffb33(0x12d))),Setting_1=__importDefault(require(a40_0x6ffb33(0x12c))),GetProfilePermissions_1=require(a40_0x6ffb33(0x14b)),store=async(_0xf36e61,_0x461641)=>{const _0x613c63=a40_0x6ffb33,{email:_0xa93c0e,password:_0x5784e1}=_0xf36e61[_0x613c63(0x13a)],{token:_0x3edc69,serializedUser:_0x45cd57,refreshToken:_0x3735ee}=await(0x0,AuthUserService_1[_0x613c63(0x12f)])({'email':_0xa93c0e,'password':_0x5784e1});(0x0,SendRefreshToken_1[_0x613c63(0x139)])(_0x461641,_0x3735ee);const _0x5280a0=(0x0,socket_1[_0x613c63(0x127)])();return _0x5280a0['to'](_0x613c63(0x141)+_0x45cd57['id'])[_0x613c63(0x13b)](_0x613c63(0x13f)+_0x45cd57[_0x613c63(0x12b)]+_0x613c63(0x136),{'action':_0x613c63(0x124),'user':{'id':_0x45cd57['id'],'email':_0x45cd57[_0x613c63(0x11f)],'companyId':_0x45cd57['companyId']}}),_0x461641['status'](0xc8)[_0x613c63(0x11e)]({'token':_0x3edc69,'user':_0x45cd57});};exports[a40_0x6ffb33(0x113)]=store;const update=async(_0x4dc818,_0x4f9935)=>{const _0x5513f8=a40_0x6ffb33,_0xcdeaa1=_0x4dc818['cookies']['jrt'];if(!_0xcdeaa1)throw new AppError_1[(_0x5513f8(0x12f))](_0x5513f8(0x13d),0x191);const {user:_0xe29c5c,newToken:_0x2195ea,refreshToken:_0x2bc78a}=await(0x0,RefreshTokenService_1[_0x5513f8(0x120)])(_0x4f9935,_0xcdeaa1);return(0x0,SendRefreshToken_1[_0x5513f8(0x139)])(_0x4f9935,_0x2bc78a),_0x4f9935[_0x5513f8(0x11e)]({'token':_0x2195ea,'user':_0xe29c5c});};exports['update']=update;const me=async(_0x5e30cf,_0x566117)=>{const _0x55ea71=a40_0x6ffb33,_0x5033dc=_0x5e30cf[_0x55ea71(0x112)][_0x55ea71(0x132)],_0x537462=await(0x0,FindUserFromToken_1[_0x55ea71(0x12f)])(_0x5033dc),{id:_0x51e86e,profile:_0x1f473f,email:_0xcc5426,super:_0x3b46b6,companyId:_0x122d29}=_0x537462;if(!_0x5033dc)throw new AppError_1[(_0x55ea71(0x12f))](_0x55ea71(0x13d),0x191);const _0x1aa27c=await(0x0,GetProfilePermissions_1[_0x55ea71(0x110)])(_0x1f473f,_0x122d29);return _0x566117[_0x55ea71(0x11e)]({'id':_0x51e86e,'profile':_0x1f473f,'email':_0xcc5426,'super':_0x3b46b6,'permissions':_0x1aa27c});};exports['me']=me;const remove=async(_0x20bdd,_0x5ca55d)=>{const _0x3d6883=a40_0x6ffb33,{id:_0x12ac1d}=_0x20bdd['user'],_0x1a6f14=await User_1[_0x3d6883(0x12f)][_0x3d6883(0x119)](_0x12ac1d);await _0x1a6f14['update']({'online':![]});const _0x2b026a=(0x0,socket_1[_0x3d6883(0x127)])();return _0x2b026a[_0x3d6883(0x13b)](_0x3d6883(0x13f)+_0x1a6f14['companyId']+_0x3d6883(0x126),{'action':_0x3d6883(0x124),'user':{'id':_0x1a6f14['id'],'name':_0x1a6f14[_0x3d6883(0x147)],'email':_0x1a6f14[_0x3d6883(0x11f)],'profile':_0x1a6f14[_0x3d6883(0x116)],'online':![],'isTricked':_0x1a6f14[_0x3d6883(0x11b)],'spy':_0x1a6f14[_0x3d6883(0x130)],'allTicket':_0x1a6f14[_0x3d6883(0x129)],'whatsappId':_0x1a6f14[_0x3d6883(0x10e)],'startWork':_0x1a6f14[_0x3d6883(0x12a)],'endWork':_0x1a6f14['endWork'],'defaultMenu':_0x1a6f14[_0x3d6883(0x118)]}}),_0x5ca55d[_0x3d6883(0x11a)]('jrt'),_0x5ca55d[_0x3d6883(0x13c)]();};exports[a40_0x6ffb33(0x149)]=remove;const impersonate=async(_0x24464f,_0x59725a)=>{const _0x4519de=a40_0x6ffb33,_0x17b327=_0x24464f[_0x4519de(0x112)]['jrt'],{companyId:_0x4312bd}=_0x24464f[_0x4519de(0x115)];if(!_0x17b327)throw new AppError_1[(_0x4519de(0x12f))](_0x4519de(0x13d),0x191);const _0x341f02=await User_1[_0x4519de(0x12f)][_0x4519de(0x134)]({'where':{'companyId':Number(_0x4312bd),'profile':'admin'},'include':['queues',{'model':Company_1[_0x4519de(0x12f)],'include':[{'model':Setting_1[_0x4519de(0x12f)]}]}]});if(!_0x341f02)throw new AppError_1[(_0x4519de(0x12f))]('ERR_NO_USER_FOUND',0x194);const _0x59776f=(0x0,CreateTokens_1[_0x4519de(0x11c)])(_0x341f02),_0x127607=(0x0,CreateTokens_1[_0x4519de(0x146)])(_0x341f02),_0x47b729=await(0x0,SerializeUser_1[_0x4519de(0x122)])(_0x341f02);(0x0,SendRefreshToken_1['SendRefreshToken'])(_0x59725a,_0x127607);const _0xb10c8b=(0x0,socket_1[_0x4519de(0x127)])();return _0xb10c8b['to'](_0x4519de(0x141)+_0x47b729['id'])['emit']('company-'+_0x47b729['companyId']+_0x4519de(0x136),{'action':_0x4519de(0x124),'user':{'id':_0x47b729['id'],'email':_0x47b729[_0x4519de(0x11f)],'companyId':_0x47b729[_0x4519de(0x12b)],'impersonated':!![]}}),_0x59725a['status'](0xc8)[_0x4519de(0x11e)]({'token':_0x59776f,'user':_0x47b729});};function a40_0x5108(){const _0x4bc49b=['params','profile','impersonate','defaultMenu','findByPk','clearCookie','isTricked','createAccessToken','__esModule','json','email','RefreshTokenService','870528aoKvCQ','SerializeUser','../services/AuthServices/FindUserFromToken','update','122376WsAVyV','-user','getIO','(((.+)+)+)+$','allTicket','startWork','companyId','../models/Setting','../models/Company','7186AJNlNe','default','spy','../helpers/CreateTokens','jrt','../helpers/SendRefreshToken','findOne','constructor','-auth','7QkQDnv','622269zZXHld','SendRefreshToken','body','emit','send','ERR_SESSION_EXPIRED','__importDefault','company-','195ztfUVF','user-','2207984aduowA','../helpers/SerializeUser','5140390CkUIau','../libs/socket','createRefreshToken','name','toString','remove','55fiOmNO','../helpers/GetProfilePermissions','whatsappId','1871172FHjIPs','GetProfilePermissions','search','cookies','store','../services/UserServices/AuthUserService'];a40_0x5108=function(){return _0x4bc49b;};return a40_0x5108();}exports[a40_0x6ffb33(0x117)]=impersonate;