const a31_0x1cd4d0=a31_0x2c21;(function(_0x1269c4,_0x233938){const _0x321408=a31_0x2c21,_0x4172a9=_0x1269c4();while(!![]){try{const _0x11d0de=-parseInt(_0x321408(0x1fd))/0x1*(-parseInt(_0x321408(0x213))/0x2)+-parseInt(_0x321408(0x1e7))/0x3*(-parseInt(_0x321408(0x207))/0x4)+parseInt(_0x321408(0x21a))/0x5+parseInt(_0x321408(0x1f8))/0x6*(-parseInt(_0x321408(0x1ee))/0x7)+-parseInt(_0x321408(0x203))/0x8+parseInt(_0x321408(0x1f5))/0x9+-parseInt(_0x321408(0x1f4))/0xa;if(_0x11d0de===_0x233938)break;else _0x4172a9['push'](_0x4172a9['shift']());}catch(_0x848e67){_0x4172a9['push'](_0x4172a9['shift']());}}}(a31_0x5e90,0x74b5e));function a31_0x5e90(){const _0x112576=['body','apply','__esModule','default','findAll','findOne','user','../models/Queue','50712bRnNvF','push','rated','contactId','DESC','toDate','moment/moment','392860PDHzMX','name','toString','../models/Contact','sequelize','queuedAt','3xFAxWM','N/A','search','join','tag','endOf','json','355642LEvgjK','add','startedAt','../models/TicketTraking','tagId','../models/Tag','6079890JiYNDQ','8078787sCOOLG','ratingAt','createdAt','36qbTBfu','profile','whatsapp','number','../models/TicketTag','21VExjlQ','minute','__importDefault','../models/Ticket','constructor','status','3378112GqZYRA','../models/Whatsapp','(((.+)+)+)+$','startOf','1217776BdZRlX','day','queueId','map'];a31_0x5e90=function(){return _0x112576;};return a31_0x5e90();}const a31_0x59c3a6=(function(){let _0x536ef5=!![];return function(_0x3a3d48,_0x41feb5){const _0x2293be=_0x536ef5?function(){const _0x49fe35=a31_0x2c21;if(_0x41feb5){const _0x220a91=_0x41feb5[_0x49fe35(0x20c)](_0x3a3d48,arguments);return _0x41feb5=null,_0x220a91;}}:function(){};return _0x536ef5=![],_0x2293be;};}()),a31_0x4471a4=a31_0x59c3a6(this,function(){const _0x48f175=a31_0x2c21;return a31_0x4471a4[_0x48f175(0x21c)]()[_0x48f175(0x1e9)]('(((.+)+)+)+$')[_0x48f175(0x21c)]()[_0x48f175(0x201)](a31_0x4471a4)[_0x48f175(0x1e9)](_0x48f175(0x205));});a31_0x4471a4();function a31_0x2c21(_0x4c307f,_0x510d40){const _0x29137b=a31_0x5e90();return a31_0x2c21=function(_0x4471a4,_0x59c3a6){_0x4471a4=_0x4471a4-0x1e4;let _0x5e9034=_0x29137b[_0x4471a4];return _0x5e9034;},a31_0x2c21(_0x4c307f,_0x510d40);}'use strict';var __importDefault=this&&this[a31_0x1cd4d0(0x1ff)]||function(_0x52fe78){const _0x260465=a31_0x1cd4d0;return _0x52fe78&&_0x52fe78[_0x260465(0x20d)]?_0x52fe78:{'default':_0x52fe78};};Object['defineProperty'](exports,a31_0x1cd4d0(0x20d),{'value':!![]});const Ticket_1=__importDefault(require(a31_0x1cd4d0(0x200))),sequelize_1=require(a31_0x1cd4d0(0x1e5)),moment_1=__importDefault(require(a31_0x1cd4d0(0x219))),User_1=__importDefault(require('../models/User')),Queue_1=__importDefault(require(a31_0x1cd4d0(0x212))),TicketTag_1=__importDefault(require(a31_0x1cd4d0(0x1fc))),Tag_1=__importDefault(require(a31_0x1cd4d0(0x1f3))),Whatsapp_1=__importDefault(require(a31_0x1cd4d0(0x204))),TicketTraking_1=__importDefault(require(a31_0x1cd4d0(0x1f1))),Contact_1=__importDefault(require(a31_0x1cd4d0(0x1e4))),ReportController={'tickets':async(_0x23b7a6,_0x211e34)=>{const _0xb39e02=a31_0x1cd4d0,{companyId:_0x16ad65}=_0x23b7a6[_0xb39e02(0x211)];let {dateStart:_0x214c14,dateEnd:_0x56a8b8,status:_0x58ffa6,queueId:_0x21cddb}=_0x23b7a6[_0xb39e02(0x20b)],_0x341b88={'companyId':_0x16ad65};_0x21cddb&&(_0x341b88[_0xb39e02(0x209)]=_0x21cddb);_0x58ffa6&&(_0x341b88['status']=_0x58ffa6);let _0x55e48e=await Ticket_1[_0xb39e02(0x20e)][_0xb39e02(0x20f)]({'where':{..._0x341b88,'createdAt':{[sequelize_1['Op']['between']]:[(0x0,moment_1['default'])(_0x214c14)[_0xb39e02(0x206)](_0xb39e02(0x208))[_0xb39e02(0x218)](),(0x0,moment_1[_0xb39e02(0x20e)])(_0x56a8b8)[_0xb39e02(0x1ec)](_0xb39e02(0x208))[_0xb39e02(0x218)]()]}},'include':[{'model':User_1[_0xb39e02(0x20e)],'as':_0xb39e02(0x211),'attributes':['id',_0xb39e02(0x21b),_0xb39e02(0x1f9)]},{'model':Queue_1[_0xb39e02(0x20e)],'as':'queue','attributes':['id','name']},{'model':Whatsapp_1['default'],'as':_0xb39e02(0x1fa),'attributes':['id',_0xb39e02(0x21b)]}],'attributes':['id',_0xb39e02(0x1f7),'status',_0xb39e02(0x209),'userId',_0xb39e02(0x216)],'order':[['createdAt',_0xb39e02(0x217)]]}),_0x1960a6=[];for(let _0xe3763a of _0x55e48e){const _0x1544ee=await TicketTag_1[_0xb39e02(0x20e)]['findAll']({'attributes':[_0xb39e02(0x1f2)],'where':{'ticketId':_0xe3763a['id']},'include':[{'model':Tag_1[_0xb39e02(0x20e)],'as':_0xb39e02(0x1eb),'attributes':['id',_0xb39e02(0x21b)]}]});var _0x12f332=await TicketTraking_1[_0xb39e02(0x20e)][_0xb39e02(0x210)]({'where':{'ticketId':_0xe3763a['id']},'attributes':[_0xb39e02(0x1f0),_0xb39e02(0x1e6),_0xb39e02(0x1f6),'rated','createdAt','finishedAt']});let _0x323dc0=await Contact_1[_0xb39e02(0x20e)][_0xb39e02(0x210)]({'attributes':[_0xb39e02(0x1f7),_0xb39e02(0x21b),_0xb39e02(0x1fb)],'where':{'id':_0xe3763a[_0xb39e02(0x216)]}}),_0x13fca3=![];_0x323dc0&&(_0x13fca3=(0x0,moment_1['default'])(_0x323dc0[_0xb39e02(0x1f7)])['isBetween']((0x0,moment_1[_0xb39e02(0x20e)])(_0xe3763a[_0xb39e02(0x1f7)])['subtract'](0x1,_0xb39e02(0x1fe)),(0x0,moment_1[_0xb39e02(0x20e)])(_0xe3763a['createdAt'])[_0xb39e02(0x1ef)](0x1,'minute'))),_0x1960a6[_0xb39e02(0x214)]({'id':_0xe3763a['id'],'contactName':_0x323dc0?.[_0xb39e02(0x21b)]||_0xb39e02(0x1e8),'contactNumber':_0x323dc0?.[_0xb39e02(0x1fb)]||_0xb39e02(0x1e8),'createdAt':_0xe3763a?.['createdAt'],'startedAt':_0x12f332?.[_0xb39e02(0x1f0)],'queuedAt':_0x12f332?.[_0xb39e02(0x1e6)],'ratingAt':_0x12f332?.[_0xb39e02(0x1f6)],'rated':_0x12f332?.[_0xb39e02(0x215)],'status':_0xe3763a[_0xb39e02(0x202)],'user':_0xe3763a['user']?.['name']||_0xb39e02(0x1e8),'userId':_0xe3763a['userId'],'queue':_0xe3763a['queue']?.[_0xb39e02(0x21b)]||_0xb39e02(0x1e8),'queueId':_0xe3763a[_0xb39e02(0x209)],'connection':_0xe3763a['whatsapp'][_0xb39e02(0x21b)],'connectionId':_0xe3763a['whatsapp']['id'],'firstSentMessageAt':_0x12f332?.[_0xb39e02(0x1f7)],'resolvedAt':_0x12f332?.['finishedAt'],'isNewContact':_0x13fca3,'tags':_0x1544ee[_0xb39e02(0x20a)](_0x4e8a1b=>_0x4e8a1b[_0xb39e02(0x1eb)]['name'])[_0xb39e02(0x1ea)](',')});}return _0x211e34[_0xb39e02(0x1ed)](_0x1960a6);}};exports[a31_0x1cd4d0(0x20e)]=ReportController;