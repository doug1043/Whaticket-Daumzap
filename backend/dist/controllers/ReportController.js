const a31_0x590581=a31_0x2ff8;(function(_0x404b85,_0x44195a){const _0x48193b=a31_0x2ff8,_0x26ebfa=_0x404b85();while(!![]){try{const _0x7075e=-parseInt(_0x48193b(0x91))/0x1+-parseInt(_0x48193b(0xb8))/0x2+parseInt(_0x48193b(0x95))/0x3*(parseInt(_0x48193b(0xa1))/0x4)+-parseInt(_0x48193b(0x93))/0x5*(-parseInt(_0x48193b(0x89))/0x6)+parseInt(_0x48193b(0xae))/0x7+-parseInt(_0x48193b(0xac))/0x8*(-parseInt(_0x48193b(0xbb))/0x9)+parseInt(_0x48193b(0xba))/0xa*(parseInt(_0x48193b(0x9e))/0xb);if(_0x7075e===_0x44195a)break;else _0x26ebfa['push'](_0x26ebfa['shift']());}catch(_0x451415){_0x26ebfa['push'](_0x26ebfa['shift']());}}}(a31_0x3ac1,0xed093));const a31_0x48df1d=(function(){let _0x5ee93b=!![];return function(_0x2f0448,_0x4860d4){const _0x3ada83=_0x5ee93b?function(){const _0x250788=a31_0x2ff8;if(_0x4860d4){const _0x2baec7=_0x4860d4[_0x250788(0xb9)](_0x2f0448,arguments);return _0x4860d4=null,_0x2baec7;}}:function(){};return _0x5ee93b=![],_0x3ada83;};}()),a31_0x30b25c=a31_0x48df1d(this,function(){const _0x3d8662=a31_0x2ff8;return a31_0x30b25c[_0x3d8662(0x99)]()['search']('(((.+)+)+)+$')['toString']()['constructor'](a31_0x30b25c)[_0x3d8662(0xaa)]('(((.+)+)+)+$');});a31_0x30b25c();function a31_0x2ff8(_0x1a6d9e,_0x5c6c92){const _0x1db4af=a31_0x3ac1();return a31_0x2ff8=function(_0x30b25c,_0x48df1d){_0x30b25c=_0x30b25c-0x88;let _0x3ac13e=_0x1db4af[_0x30b25c];return _0x3ac13e;},a31_0x2ff8(_0x1a6d9e,_0x5c6c92);}'use strict';var __importDefault=this&&this[a31_0x590581(0xa2)]||function(_0x4f7795){const _0x52098a=a31_0x590581;return _0x4f7795&&_0x4f7795[_0x52098a(0xb5)]?_0x4f7795:{'default':_0x4f7795};};Object[a31_0x590581(0x88)](exports,a31_0x590581(0xb5),{'value':!![]});const Ticket_1=__importDefault(require(a31_0x590581(0x8c))),sequelize_1=require(a31_0x590581(0x90)),moment_1=__importDefault(require('moment/moment')),User_1=__importDefault(require(a31_0x590581(0x8b))),Queue_1=__importDefault(require(a31_0x590581(0xbe))),TicketTag_1=__importDefault(require(a31_0x590581(0x92))),Tag_1=__importDefault(require('../models/Tag')),Whatsapp_1=__importDefault(require('../models/Whatsapp')),TicketTraking_1=__importDefault(require('../models/TicketTraking')),Contact_1=__importDefault(require(a31_0x590581(0xbc))),ReportController={'tickets':async(_0x166eec,_0x13f98a)=>{const _0x5ddc7d=a31_0x590581,{companyId:_0x35421d}=_0x166eec[_0x5ddc7d(0xab)];let {dateStart:_0x529985,dateEnd:_0x4aad00,status:_0x56394c,queueId:_0xf0682c}=_0x166eec['body'],_0x3acae7={'companyId':_0x35421d};_0xf0682c&&(_0x3acae7['queueId']=_0xf0682c);_0x56394c&&(_0x3acae7['status']=_0x56394c);let _0x153244=await Ticket_1['default']['findAll']({'where':{..._0x3acae7,'createdAt':{[sequelize_1['Op'][_0x5ddc7d(0x97)]]:[(0x0,moment_1['default'])(_0x529985)[_0x5ddc7d(0xaf)](_0x5ddc7d(0xb2))[_0x5ddc7d(0xb4)](),(0x0,moment_1[_0x5ddc7d(0xa8)])(_0x4aad00)['endOf'](_0x5ddc7d(0xb2))['toDate']()]}},'include':[{'model':User_1[_0x5ddc7d(0xa8)],'as':_0x5ddc7d(0xab),'attributes':['id',_0x5ddc7d(0xb6),_0x5ddc7d(0xa6)]},{'model':Queue_1[_0x5ddc7d(0xa8)],'as':_0x5ddc7d(0x9f),'attributes':['id','name']},{'model':Whatsapp_1[_0x5ddc7d(0xa8)],'as':_0x5ddc7d(0xb0),'attributes':['id',_0x5ddc7d(0xb6)]}],'attributes':['id',_0x5ddc7d(0xa9),_0x5ddc7d(0xbd),_0x5ddc7d(0x9a),_0x5ddc7d(0xa3),'contactId'],'order':[[_0x5ddc7d(0xa9),_0x5ddc7d(0x98)]]}),_0x15fc29=[];for(let _0x1ae7b4 of _0x153244){const _0x3f98ad=await TicketTag_1[_0x5ddc7d(0xa8)][_0x5ddc7d(0xb1)]({'attributes':[_0x5ddc7d(0x96)],'where':{'ticketId':_0x1ae7b4['id']},'include':[{'model':Tag_1[_0x5ddc7d(0xa8)],'as':'tag','attributes':['id',_0x5ddc7d(0xb6)]}]});var _0x4ca640=await TicketTraking_1[_0x5ddc7d(0xa8)]['findOne']({'where':{'ticketId':_0x1ae7b4['id']},'attributes':[_0x5ddc7d(0xad),_0x5ddc7d(0x9d),_0x5ddc7d(0x94),_0x5ddc7d(0x8d),'createdAt',_0x5ddc7d(0x9b)]});let _0x34900a=await Contact_1['default'][_0x5ddc7d(0x8f)]({'attributes':['createdAt','name','number'],'where':{'id':_0x1ae7b4[_0x5ddc7d(0xa0)]}}),_0x1ac1e9=![];_0x34900a&&(_0x1ac1e9=(0x0,moment_1['default'])(_0x34900a[_0x5ddc7d(0xa9)])[_0x5ddc7d(0xb3)]((0x0,moment_1[_0x5ddc7d(0xa8)])(_0x1ae7b4[_0x5ddc7d(0xa9)])[_0x5ddc7d(0xb7)](0x1,_0x5ddc7d(0x8e)),(0x0,moment_1[_0x5ddc7d(0xa8)])(_0x1ae7b4[_0x5ddc7d(0xa9)])['add'](0x1,_0x5ddc7d(0x8e)))),_0x15fc29['push']({'id':_0x1ae7b4['id'],'contactName':_0x34900a?.['name']||'N/A','contactNumber':_0x34900a?.['number']||_0x5ddc7d(0xa4),'createdAt':_0x1ae7b4?.[_0x5ddc7d(0xa9)],'startedAt':_0x4ca640?.[_0x5ddc7d(0xad)],'queuedAt':_0x4ca640?.[_0x5ddc7d(0x9d)],'ratingAt':_0x4ca640?.[_0x5ddc7d(0x94)],'rated':_0x4ca640?.[_0x5ddc7d(0x8d)],'status':_0x1ae7b4[_0x5ddc7d(0xbd)],'user':_0x1ae7b4[_0x5ddc7d(0xab)]?.['name']||_0x5ddc7d(0xa4),'userId':_0x1ae7b4['userId'],'queue':_0x1ae7b4['queue']?.[_0x5ddc7d(0xb6)]||'N/A','queueId':_0x1ae7b4[_0x5ddc7d(0x9a)],'connection':_0x1ae7b4['whatsapp']['name'],'connectionId':_0x1ae7b4[_0x5ddc7d(0xb0)]['id'],'firstSentMessageAt':_0x4ca640?.[_0x5ddc7d(0xa9)],'resolvedAt':_0x4ca640?.[_0x5ddc7d(0x9b)],'isNewContact':_0x1ac1e9,'tags':_0x3f98ad[_0x5ddc7d(0xa5)](_0x2c2d95=>_0x2c2d95[_0x5ddc7d(0x9c)][_0x5ddc7d(0xb6)])[_0x5ddc7d(0x8a)](',')});}return _0x13f98a[_0x5ddc7d(0xa7)](_0x15fc29);}};exports[a31_0x590581(0xa8)]=ReportController;function a31_0x3ac1(){const _0x3e015f=['toString','queueId','finishedAt','tag','queuedAt','17319511gXMVGw','queue','contactId','4vzZfnt','__importDefault','userId','N/A','map','profile','json','default','createdAt','search','user','8xUisxH','startedAt','5690055ooeoiX','startOf','whatsapp','findAll','day','isBetween','toDate','__esModule','name','subtract','3129112KaCvEJ','apply','10ZsmlzZ','8864559nVMMyN','../models/Contact','status','../models/Queue','defineProperty','300MKgQGP','join','../models/User','../models/Ticket','rated','minute','findOne','sequelize','1863451tElfkF','../models/TicketTag','44095uoGGVk','ratingAt','1756917loJccb','tagId','between','DESC'];a31_0x3ac1=function(){return _0x3e015f;};return a31_0x3ac1();}