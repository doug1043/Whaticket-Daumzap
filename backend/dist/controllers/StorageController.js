const a42_0x290e34=a42_0x4be8;(function(_0x409ab9,_0x5c90e5){const _0x40fea9=a42_0x4be8,_0x5ac6b0=_0x409ab9();while(!![]){try{const _0x494168=parseInt(_0x40fea9(0x10b))/0x1+parseInt(_0x40fea9(0xf0))/0x2+parseInt(_0x40fea9(0x102))/0x3+-parseInt(_0x40fea9(0x10e))/0x4*(parseInt(_0x40fea9(0x11c))/0x5)+parseInt(_0x40fea9(0x11f))/0x6*(-parseInt(_0x40fea9(0xee))/0x7)+-parseInt(_0x40fea9(0x10c))/0x8*(-parseInt(_0x40fea9(0xef))/0x9)+parseInt(_0x40fea9(0xf4))/0xa*(-parseInt(_0x40fea9(0xf5))/0xb);if(_0x494168===_0x5c90e5)break;else _0x5ac6b0['push'](_0x5ac6b0['shift']());}catch(_0x152cdc){_0x5ac6b0['push'](_0x5ac6b0['shift']());}}}(a42_0x5093,0xdb528));function a42_0x5093(){const _0x3072f1=['constructor','minioPort','Erro\x20ao\x20salvar\x20configurações','3529071SrEytI','minioSecretKey','Erro\x20ao\x20obter\x20configurações\x20MinIO:','getStorageUsage','canUpload','key','toString','getMinioSettings','minioUseSSL','1383325lZXLzQ','40byrHRT','clearFolder','116vOCcCe','apply','minioBucket','checkUploadPermission','defineProperty','Erro\x20ao\x20obter\x20uso\x20de\x20armazenamento:','../errors/AppError','true','Erro\x20ao\x20inicializar\x20armazenamento\x20da\x20empresa:','includes','status','update','error','json','259295URrKcV','Erro\x20ao\x20verificar\x20permissão\x20de\x20upload','default','2740926lVKADh','(((.+)+)+)+$','value','testMinioConnection','user','minioEndpoint','minioAccessKey','createCompanyStorage','Pasta\x20não\x20especificada','__esModule','../services/StorageService/StorageService','forEach','initializeCompanyStorage','7GasRHM','2841642MZOrlT','592876hjIleA','Erro\x20ao\x20obter\x20informações\x20de\x20armazenamento','findOrCreate','9000','1580urhvFS','109703jNnXBG','body','saveMinioSettings','query','Erro\x20ao\x20testar\x20conexão\x20MinIO:','__importDefault','../models/Setting','Parâmetros\x20incompletos','search','params'];a42_0x5093=function(){return _0x3072f1;};return a42_0x5093();}const a42_0x1278ad=(function(){let _0x1b475a=!![];return function(_0x15e2df,_0xc3f0f0){const _0x4bbc4e=_0x1b475a?function(){const _0x206b8a=a42_0x4be8;if(_0xc3f0f0){const _0xfbcffa=_0xc3f0f0[_0x206b8a(0x10f)](_0x15e2df,arguments);return _0xc3f0f0=null,_0xfbcffa;}}:function(){};return _0x1b475a=![],_0x4bbc4e;};}()),a42_0x1c2ee5=a42_0x1278ad(this,function(){const _0xc29fd9=a42_0x4be8;return a42_0x1c2ee5[_0xc29fd9(0x108)]()['search']('(((.+)+)+)+$')['toString']()[_0xc29fd9(0xff)](a42_0x1c2ee5)[_0xc29fd9(0xfd)](_0xc29fd9(0x120));});a42_0x1c2ee5();'use strict';var __importDefault=this&&this[a42_0x290e34(0xfa)]||function(_0x40290d){const _0x2834d9=a42_0x290e34;return _0x40290d&&_0x40290d[_0x2834d9(0xea)]?_0x40290d:{'default':_0x40290d};};Object[a42_0x290e34(0x112)](exports,a42_0x290e34(0xea),{'value':!![]}),exports['initializeCompanyStorage']=exports['getMinioSettings']=exports[a42_0x290e34(0xf7)]=exports[a42_0x290e34(0x122)]=exports[a42_0x290e34(0x111)]=exports[a42_0x290e34(0x10d)]=exports[a42_0x290e34(0x105)]=void 0x0;const StorageService_1=__importDefault(require(a42_0x290e34(0xeb))),AppError_1=__importDefault(require(a42_0x290e34(0x114))),Setting_1=__importDefault(require(a42_0x290e34(0xfb))),getStorageUsage=async(_0x3b22b5,_0x512a64)=>{const _0xef5dd4=a42_0x290e34,{companyId:_0x2d9198}=_0x3b22b5[_0xef5dd4(0x123)];try{const _0x19f79c=await StorageService_1[_0xef5dd4(0x11e)][_0xef5dd4(0x105)](_0x2d9198);return _0x512a64[_0xef5dd4(0x118)](0xc8)[_0xef5dd4(0x11b)](_0x19f79c);}catch(_0x217ece){console[_0xef5dd4(0x11a)](_0xef5dd4(0x113),_0x217ece);throw new AppError_1[(_0xef5dd4(0x11e))](_0xef5dd4(0xf1),0x1f4);}};exports[a42_0x290e34(0x105)]=getStorageUsage;const clearFolder=async(_0xc9da0a,_0x40599f)=>{const _0x308735=a42_0x290e34,{companyId:_0x4736e1}=_0xc9da0a['user'],{folder:_0x707ca8}=_0xc9da0a[_0x308735(0xfe)];if(!_0x707ca8)throw new AppError_1['default'](_0x308735(0x127),0x190);try{const _0x42641b=await StorageService_1['default'][_0x308735(0x10d)](_0x4736e1,_0x707ca8);return _0x40599f[_0x308735(0x118)](0xc8)['json'](_0x42641b);}catch(_0x5ed10c){console[_0x308735(0x11a)]('Erro\x20ao\x20limpar\x20pasta:',_0x5ed10c);throw new AppError_1[(_0x308735(0x11e))]('Erro\x20ao\x20limpar\x20pasta',0x1f4);}};exports[a42_0x290e34(0x10d)]=clearFolder;const checkUploadPermission=async(_0xb46f9b,_0x4dffb3)=>{const _0x5352d2=a42_0x290e34,{companyId:_0x57f859}=_0xb46f9b['user'],{fileSize:_0x331c97}=_0xb46f9b[_0x5352d2(0xf8)],_0x2745c5=parseInt(String(_0x331c97)||'0',0xa);try{const _0x5b8fab=await StorageService_1[_0x5352d2(0x11e)][_0x5352d2(0x106)](_0x57f859,_0x2745c5),_0x5a78c1=await StorageService_1['default'][_0x5352d2(0x105)](_0x57f859);return _0x4dffb3['status'](0xc8)[_0x5352d2(0x11b)]({'canUpload':_0x5b8fab,..._0x5a78c1});}catch(_0x289ca0){console[_0x5352d2(0x11a)]('Erro\x20ao\x20verificar\x20permissão\x20de\x20upload:',_0x289ca0);throw new AppError_1[(_0x5352d2(0x11e))](_0x5352d2(0x11d),0x1f4);}};exports[a42_0x290e34(0x111)]=checkUploadPermission;function a42_0x4be8(_0x55985d,_0x15d5ad){const _0x215c67=a42_0x5093();return a42_0x4be8=function(_0x1c2ee5,_0x1278ad){_0x1c2ee5=_0x1c2ee5-0xea;let _0x5093ae=_0x215c67[_0x1c2ee5];return _0x5093ae;},a42_0x4be8(_0x55985d,_0x15d5ad);}const testMinioConnection=async(_0x1c39a1,_0x4a7b6e)=>{const _0x42ae9e=a42_0x290e34,{endPoint:_0x4f8bd5,port:_0xe3d431,useSSL:_0x4d2a6a,accessKey:_0x122452,secretKey:_0x2ced72,bucket:_0x448ef9}=_0x1c39a1[_0x42ae9e(0xf6)];if(!_0x4f8bd5||!_0x122452||!_0x2ced72||!_0x448ef9)throw new AppError_1['default'](_0x42ae9e(0xfc),0x190);try{const _0x504521=await StorageService_1[_0x42ae9e(0x11e)][_0x42ae9e(0x122)]({'endPoint':_0x4f8bd5,'port':parseInt(_0xe3d431||'9000',0xa),'useSSL':_0x4d2a6a===!![]||_0x4d2a6a===_0x42ae9e(0x115),'accessKey':_0x122452,'secretKey':_0x2ced72,'bucket':_0x448ef9});return _0x4a7b6e[_0x42ae9e(0x118)](0xc8)['json'](_0x504521);}catch(_0x13abcc){return console[_0x42ae9e(0x11a)](_0x42ae9e(0xf9),_0x13abcc),_0x4a7b6e[_0x42ae9e(0x118)](0xc8)[_0x42ae9e(0x11b)]({'success':![],'message':String(_0x13abcc)});}};exports[a42_0x290e34(0x122)]=testMinioConnection;const saveMinioSettings=async(_0x588bef,_0x57adaf)=>{const _0x534c12=a42_0x290e34,{companyId:_0x5ccdc5}=_0x588bef[_0x534c12(0x123)],{endPoint:_0x1ad631,port:_0x1108f7,useSSL:_0x50b454,accessKey:_0x57a8d3,secretKey:_0xe65e82,bucket:_0x3567d6}=_0x588bef['body'];try{const _0x13ca3f=[{'key':_0x534c12(0x124),'value':_0x1ad631||''},{'key':_0x534c12(0x100),'value':String(_0x1108f7||_0x534c12(0xf3))},{'key':_0x534c12(0x10a),'value':String(_0x50b454===!![]||_0x50b454===_0x534c12(0x115))},{'key':_0x534c12(0x125),'value':_0x57a8d3||''},{'key':_0x534c12(0x103),'value':_0xe65e82||''},{'key':_0x534c12(0x110),'value':_0x3567d6||''}];for(const _0xbab7f5 of _0x13ca3f){const [_0xd59985]=await Setting_1[_0x534c12(0x11e)][_0x534c12(0xf2)]({'where':{'companyId':_0x5ccdc5,'key':_0xbab7f5['key']},'defaults':{'companyId':_0x5ccdc5,'key':_0xbab7f5[_0x534c12(0x107)],'value':_0xbab7f5['value']}});_0xd59985&&await _0xd59985[_0x534c12(0x119)]({'value':_0xbab7f5['value']});}return _0x1ad631&&_0x57a8d3&&_0xe65e82&&_0x3567d6&&await StorageService_1[_0x534c12(0x11e)]['createCompanyStorage'](_0x5ccdc5),_0x57adaf[_0x534c12(0x118)](0xc8)[_0x534c12(0x11b)]({'success':!![]});}catch(_0x13be85){console[_0x534c12(0x11a)]('Erro\x20ao\x20salvar\x20configurações\x20MinIO:',_0x13be85);throw new AppError_1[(_0x534c12(0x11e))](_0x534c12(0x101),0x1f4);}};exports[a42_0x290e34(0xf7)]=saveMinioSettings;const getMinioSettings=async(_0x4302cb,_0x32ff40)=>{const _0x595af1=a42_0x290e34,{companyId:_0x28cb69}=_0x4302cb[_0x595af1(0x123)];try{const _0x47ccd8=await Setting_1['default']['findAll']({'where':{'companyId':_0x28cb69},'attributes':['key',_0x595af1(0x121)]}),_0x4caa48={},_0x199384=[_0x595af1(0x124),'minioPort',_0x595af1(0x10a),'minioAccessKey','minioSecretKey',_0x595af1(0x110)];return _0x47ccd8[_0x595af1(0xec)](_0x340eab=>{const _0x5c2fe8=_0x595af1;_0x199384[_0x5c2fe8(0x117)](_0x340eab[_0x5c2fe8(0x107)])&&(_0x4caa48[_0x340eab['key']]=_0x340eab[_0x5c2fe8(0x121)]);}),_0x32ff40[_0x595af1(0x118)](0xc8)[_0x595af1(0x11b)](_0x4caa48);}catch(_0x99796f){console[_0x595af1(0x11a)](_0x595af1(0x104),_0x99796f);throw new AppError_1[(_0x595af1(0x11e))]('Erro\x20ao\x20obter\x20configurações',0x1f4);}};exports[a42_0x290e34(0x109)]=getMinioSettings;const initializeCompanyStorage=async _0x3122b3=>{const _0x110f46=a42_0x290e34;try{await StorageService_1['default'][_0x110f46(0x126)](_0x3122b3);}catch(_0x3c1082){console[_0x110f46(0x11a)](_0x110f46(0x116),_0x3c1082);}};exports[a42_0x290e34(0xed)]=initializeCompanyStorage;