function a42_0x3a03(_0x5d1657,_0x444191){const _0x3cb9b2=a42_0x36a4();return a42_0x3a03=function(_0x1b701f,_0x326df2){_0x1b701f=_0x1b701f-0x1e0;let _0x36a42b=_0x3cb9b2[_0x1b701f];return _0x36a42b;},a42_0x3a03(_0x5d1657,_0x444191);}const a42_0x594ee3=a42_0x3a03;(function(_0x113990,_0x1860c6){const _0x2cc4a6=a42_0x3a03,_0x430ac5=_0x113990();while(!![]){try{const _0x4b4d4a=parseInt(_0x2cc4a6(0x1eb))/0x1*(-parseInt(_0x2cc4a6(0x1fd))/0x2)+-parseInt(_0x2cc4a6(0x1e3))/0x3+-parseInt(_0x2cc4a6(0x20f))/0x4+-parseInt(_0x2cc4a6(0x20b))/0x5*(-parseInt(_0x2cc4a6(0x1ec))/0x6)+-parseInt(_0x2cc4a6(0x1e6))/0x7*(-parseInt(_0x2cc4a6(0x1fa))/0x8)+-parseInt(_0x2cc4a6(0x20e))/0x9+-parseInt(_0x2cc4a6(0x1f4))/0xa*(-parseInt(_0x2cc4a6(0x214))/0xb);if(_0x4b4d4a===_0x1860c6)break;else _0x430ac5['push'](_0x430ac5['shift']());}catch(_0x49e453){_0x430ac5['push'](_0x430ac5['shift']());}}}(a42_0x36a4,0x36c9a));const a42_0x326df2=(function(){let _0x4491ad=!![];return function(_0x3a3e9e,_0xfc10f6){const _0x55b086=_0x4491ad?function(){if(_0xfc10f6){const _0x4a351b=_0xfc10f6['apply'](_0x3a3e9e,arguments);return _0xfc10f6=null,_0x4a351b;}}:function(){};return _0x4491ad=![],_0x55b086;};}()),a42_0x1b701f=a42_0x326df2(this,function(){const _0x41b458=a42_0x3a03;return a42_0x1b701f[_0x41b458(0x211)]()[_0x41b458(0x207)]('(((.+)+)+)+$')[_0x41b458(0x211)]()[_0x41b458(0x213)](a42_0x1b701f)['search'](_0x41b458(0x1ff));});a42_0x1b701f();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4cf5c8){const _0x34a7b0=a42_0x3a03;return _0x4cf5c8&&_0x4cf5c8[_0x34a7b0(0x209)]?_0x4cf5c8:{'default':_0x4cf5c8};};Object[a42_0x594ee3(0x1f6)](exports,a42_0x594ee3(0x209),{'value':!![]}),exports[a42_0x594ee3(0x1fc)]=exports[a42_0x594ee3(0x206)]=exports['saveMinioSettings']=exports[a42_0x594ee3(0x20a)]=exports[a42_0x594ee3(0x218)]=exports['clearFolder']=exports['getStorageUsage']=void 0x0;function a42_0x36a4(){const _0x4085c4=['error','defineProperty','json','params','Parâmetros\x20incompletos','301032XutsPb','Erro\x20ao\x20testar\x20conexão\x20MinIO:','initializeCompanyStorage','2gINwZX','Erro\x20ao\x20verificar\x20permissão\x20de\x20upload:','(((.+)+)+)+$','user','getStorageUsage','minioEndpoint','minioPort','query','body','getMinioSettings','search','minioBucket','__esModule','testMinioConnection','125KmjgME','canUpload','saveMinioSettings','2735199eQrFGx','1008500dqcIrN','Erro\x20ao\x20inicializar\x20armazenamento\x20da\x20empresa:','toString','clearFolder','constructor','1254yblGWz','update','minioSecretKey','default','checkUploadPermission','Erro\x20ao\x20limpar\x20pasta:','findAll','status','value','../errors/AppError','Erro\x20ao\x20salvar\x20configurações','371934lesptz','true','minioUseSSL','21zQJfeN','includes','../models/Setting','key','Erro\x20ao\x20obter\x20configurações\x20MinIO:','381209nscrlp','69720vcwMEx','forEach','9000','Pasta\x20não\x20especificada','minioAccessKey','Erro\x20ao\x20obter\x20informações\x20de\x20armazenamento','Erro\x20ao\x20obter\x20uso\x20de\x20armazenamento:','createCompanyStorage','77390fAKJyt'];a42_0x36a4=function(){return _0x4085c4;};return a42_0x36a4();}const StorageService_1=__importDefault(require('../services/StorageService/StorageService')),AppError_1=__importDefault(require(a42_0x594ee3(0x1e1))),Setting_1=__importDefault(require(a42_0x594ee3(0x1e8))),getStorageUsage=async(_0xa1713c,_0x253374)=>{const _0x410462=a42_0x594ee3,{companyId:_0x52005f}=_0xa1713c[_0x410462(0x200)];try{const _0x14bf07=await StorageService_1[_0x410462(0x217)]['getStorageUsage'](_0x52005f);return _0x253374[_0x410462(0x21b)](0xc8)[_0x410462(0x1f7)](_0x14bf07);}catch(_0x230d1c){console[_0x410462(0x1f5)](_0x410462(0x1f2),_0x230d1c);throw new AppError_1[(_0x410462(0x217))](_0x410462(0x1f1),0x1f4);}};exports[a42_0x594ee3(0x201)]=getStorageUsage;const clearFolder=async(_0x10ce5d,_0xf69810)=>{const _0x1e488c=a42_0x594ee3,{companyId:_0x18495f}=_0x10ce5d[_0x1e488c(0x200)],{folder:_0x33a52b}=_0x10ce5d[_0x1e488c(0x1f8)];if(!_0x33a52b)throw new AppError_1[(_0x1e488c(0x217))](_0x1e488c(0x1ef),0x190);try{const _0x2e76ff=await StorageService_1['default'][_0x1e488c(0x212)](_0x18495f,_0x33a52b);return _0xf69810[_0x1e488c(0x21b)](0xc8)[_0x1e488c(0x1f7)](_0x2e76ff);}catch(_0x7de6fb){console[_0x1e488c(0x1f5)](_0x1e488c(0x219),_0x7de6fb);throw new AppError_1[(_0x1e488c(0x217))]('Erro\x20ao\x20limpar\x20pasta',0x1f4);}};exports['clearFolder']=clearFolder;const checkUploadPermission=async(_0x4dcde5,_0x9cd3aa)=>{const _0xb67ba9=a42_0x594ee3,{companyId:_0x323998}=_0x4dcde5[_0xb67ba9(0x200)],{fileSize:_0x4fae5d}=_0x4dcde5[_0xb67ba9(0x204)],_0x371e05=parseInt(String(_0x4fae5d)||'0',0xa);try{const _0x3972e2=await StorageService_1[_0xb67ba9(0x217)][_0xb67ba9(0x20c)](_0x323998,_0x371e05),_0x5a7134=await StorageService_1[_0xb67ba9(0x217)][_0xb67ba9(0x201)](_0x323998);return _0x9cd3aa[_0xb67ba9(0x21b)](0xc8)[_0xb67ba9(0x1f7)]({'canUpload':_0x3972e2,..._0x5a7134});}catch(_0xf17595){console[_0xb67ba9(0x1f5)](_0xb67ba9(0x1fe),_0xf17595);throw new AppError_1[(_0xb67ba9(0x217))]('Erro\x20ao\x20verificar\x20permissão\x20de\x20upload',0x1f4);}};exports[a42_0x594ee3(0x218)]=checkUploadPermission;const testMinioConnection=async(_0x232554,_0x332b2a)=>{const _0x410a8f=a42_0x594ee3,{endPoint:_0x21d5af,port:_0x42ed2c,useSSL:_0x140ddb,accessKey:_0x3b9285,secretKey:_0x510db7,bucket:_0x5e9400}=_0x232554[_0x410a8f(0x205)];if(!_0x21d5af||!_0x3b9285||!_0x510db7||!_0x5e9400)throw new AppError_1[(_0x410a8f(0x217))](_0x410a8f(0x1f9),0x190);try{const _0x2fa835=await StorageService_1['default'][_0x410a8f(0x20a)]({'endPoint':_0x21d5af,'port':parseInt(_0x42ed2c||_0x410a8f(0x1ee),0xa),'useSSL':_0x140ddb===!![]||_0x140ddb==='true','accessKey':_0x3b9285,'secretKey':_0x510db7,'bucket':_0x5e9400});return _0x332b2a[_0x410a8f(0x21b)](0xc8)[_0x410a8f(0x1f7)](_0x2fa835);}catch(_0x529d9c){return console['error'](_0x410a8f(0x1fb),_0x529d9c),_0x332b2a['status'](0xc8)[_0x410a8f(0x1f7)]({'success':![],'message':String(_0x529d9c)});}};exports[a42_0x594ee3(0x20a)]=testMinioConnection;const saveMinioSettings=async(_0x5a0771,_0x5a3506)=>{const _0x18e768=a42_0x594ee3,{companyId:_0x4a384e}=_0x5a0771[_0x18e768(0x200)],{endPoint:_0x1a36f2,port:_0x1cc6ae,useSSL:_0x539c9f,accessKey:_0x5bd417,secretKey:_0xca9c30,bucket:_0x8a39ab}=_0x5a0771[_0x18e768(0x205)];try{const _0x44aedf=[{'key':_0x18e768(0x202),'value':_0x1a36f2||''},{'key':_0x18e768(0x203),'value':String(_0x1cc6ae||_0x18e768(0x1ee))},{'key':_0x18e768(0x1e5),'value':String(_0x539c9f===!![]||_0x539c9f===_0x18e768(0x1e4))},{'key':_0x18e768(0x1f0),'value':_0x5bd417||''},{'key':_0x18e768(0x216),'value':_0xca9c30||''},{'key':'minioBucket','value':_0x8a39ab||''}];for(const _0x50591f of _0x44aedf){const [_0xf8873f]=await Setting_1[_0x18e768(0x217)]['findOrCreate']({'where':{'companyId':_0x4a384e,'key':_0x50591f[_0x18e768(0x1e9)]},'defaults':{'companyId':_0x4a384e,'key':_0x50591f[_0x18e768(0x1e9)],'value':_0x50591f[_0x18e768(0x1e0)]}});_0xf8873f&&await _0xf8873f[_0x18e768(0x215)]({'value':_0x50591f[_0x18e768(0x1e0)]});}return _0x1a36f2&&_0x5bd417&&_0xca9c30&&_0x8a39ab&&await StorageService_1[_0x18e768(0x217)][_0x18e768(0x1f3)](_0x4a384e),_0x5a3506[_0x18e768(0x21b)](0xc8)[_0x18e768(0x1f7)]({'success':!![]});}catch(_0x50f82b){console[_0x18e768(0x1f5)]('Erro\x20ao\x20salvar\x20configurações\x20MinIO:',_0x50f82b);throw new AppError_1[(_0x18e768(0x217))](_0x18e768(0x1e2),0x1f4);}};exports[a42_0x594ee3(0x20d)]=saveMinioSettings;const getMinioSettings=async(_0x3ff4aa,_0x440753)=>{const _0x82e4ba=a42_0x594ee3,{companyId:_0x5671cd}=_0x3ff4aa[_0x82e4ba(0x200)];try{const _0x3bc8dc=await Setting_1[_0x82e4ba(0x217)][_0x82e4ba(0x21a)]({'where':{'companyId':_0x5671cd},'attributes':[_0x82e4ba(0x1e9),_0x82e4ba(0x1e0)]}),_0xbfbaec={},_0x4adf73=['minioEndpoint','minioPort',_0x82e4ba(0x1e5),_0x82e4ba(0x1f0),_0x82e4ba(0x216),_0x82e4ba(0x208)];return _0x3bc8dc[_0x82e4ba(0x1ed)](_0x11669f=>{const _0x523062=_0x82e4ba;_0x4adf73[_0x523062(0x1e7)](_0x11669f['key'])&&(_0xbfbaec[_0x11669f[_0x523062(0x1e9)]]=_0x11669f[_0x523062(0x1e0)]);}),_0x440753[_0x82e4ba(0x21b)](0xc8)[_0x82e4ba(0x1f7)](_0xbfbaec);}catch(_0x359bff){console[_0x82e4ba(0x1f5)](_0x82e4ba(0x1ea),_0x359bff);throw new AppError_1['default']('Erro\x20ao\x20obter\x20configurações',0x1f4);}};exports[a42_0x594ee3(0x206)]=getMinioSettings;const initializeCompanyStorage=async _0x21202b=>{const _0x5bed68=a42_0x594ee3;try{await StorageService_1[_0x5bed68(0x217)][_0x5bed68(0x1f3)](_0x21202b);}catch(_0x424652){console[_0x5bed68(0x1f5)](_0x5bed68(0x210),_0x424652);}};exports[a42_0x594ee3(0x1fc)]=initializeCompanyStorage;