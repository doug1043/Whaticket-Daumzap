function a11_0x17d3(){const _0x4094fa=['filename','store','__esModule','-chat-user-','../services/ChatService/CreateService','users','update','files','../libs/socket','1869948CdsCKo','messages','../services/ChatService/CreateMessageService','(((.+)+)+)+$','new-message','userId','47999GqsPBj','../models/User','479784mxgyyN','saveMessage','body','query','user','../models/Chat','../services/ChatService/UpdateService','params','450594vCsNYn','__importDefault','632576PYTekU','json','../models/ChatUser','defineProperty','-chat','user-','owner','toString','20DjBoUO','getIO','40302GWKcRs','5AbPKaR','search','../services/ChatService/DeleteService','default','checkAsRead','-chat-','remove','company-','Chat\x20deleted','1501951qszLaK','delete','show','emit','index','apply','originalname','30DUaHQg','create','mimetype','status','8SzpYEJ','findByPk','constructor','forEach'];a11_0x17d3=function(){return _0x4094fa;};return a11_0x17d3();}const a11_0x3368b0=a11_0x3693;(function(_0x536668,_0x199126){const _0x2d0930=a11_0x3693,_0x19bd5e=_0x536668();while(!![]){try{const _0x32cb53=-parseInt(_0x2d0930(0x1bd))/0x1*(parseInt(_0x2d0930(0x1bb))/0x2)+parseInt(_0x2d0930(0x1a9))/0x3+-parseInt(_0x2d0930(0x1b3))/0x4+parseInt(_0x2d0930(0x1be))/0x5*(parseInt(_0x2d0930(0x1a1))/0x6)+-parseInt(_0x2d0930(0x1a7))/0x7+parseInt(_0x2d0930(0x1d2))/0x8*(parseInt(_0x2d0930(0x1b1))/0x9)+parseInt(_0x2d0930(0x1ce))/0xa*(parseInt(_0x2d0930(0x1c7))/0xb);if(_0x32cb53===_0x199126)break;else _0x19bd5e['push'](_0x19bd5e['shift']());}catch(_0x31f7e7){_0x19bd5e['push'](_0x19bd5e['shift']());}}}(a11_0x17d3,0x58af6));const a11_0x20ecef=(function(){let _0x2369f9=!![];return function(_0x31cfcb,_0xa3b5cd){const _0x332543=_0x2369f9?function(){const _0x356a34=a11_0x3693;if(_0xa3b5cd){const _0x45d122=_0xa3b5cd[_0x356a34(0x1cc)](_0x31cfcb,arguments);return _0xa3b5cd=null,_0x45d122;}}:function(){};return _0x2369f9=![],_0x332543;};}()),a11_0x1558de=a11_0x20ecef(this,function(){const _0x679692=a11_0x3693;return a11_0x1558de[_0x679692(0x1ba)]()[_0x679692(0x1bf)](_0x679692(0x1a4))[_0x679692(0x1ba)]()[_0x679692(0x1d4)](a11_0x1558de)[_0x679692(0x1bf)](_0x679692(0x1a4));});a11_0x1558de();'use strict';var __importDefault=this&&this[a11_0x3368b0(0x1b2)]||function(_0x2ccc4f){const _0x335bc8=a11_0x3368b0;return _0x2ccc4f&&_0x2ccc4f[_0x335bc8(0x1d8)]?_0x2ccc4f:{'default':_0x2ccc4f};};Object[a11_0x3368b0(0x1b6)](exports,a11_0x3368b0(0x1d8),{'value':!![]}),exports[a11_0x3368b0(0x1a2)]=exports[a11_0x3368b0(0x1c2)]=exports[a11_0x3368b0(0x1aa)]=exports['remove']=exports['show']=exports['update']=exports[a11_0x3368b0(0x1d7)]=exports['index']=void 0x0;const socket_1=require(a11_0x3368b0(0x1a0)),CreateService_1=__importDefault(require(a11_0x3368b0(0x19c))),ListService_1=__importDefault(require('../services/ChatService/ListService')),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require(a11_0x3368b0(0x1c0))),FindMessages_1=__importDefault(require('../services/ChatService/FindMessages')),UpdateService_1=__importDefault(require(a11_0x3368b0(0x1af))),Chat_1=__importDefault(require(a11_0x3368b0(0x1ae))),CreateMessageService_1=__importDefault(require(a11_0x3368b0(0x1a3))),User_1=__importDefault(require(a11_0x3368b0(0x1a8))),ChatUser_1=__importDefault(require(a11_0x3368b0(0x1b5))),index=async(_0x3bcef3,_0x4027ad)=>{const _0x43410a=a11_0x3368b0,{pageNumber:_0x5737fc}=_0x3bcef3[_0x43410a(0x1ac)],_0x4b54ec=+_0x3bcef3['user']['id'],{records:_0x50debb,count:_0x5849f5,hasMore:_0x7a8cf4}=await(0x0,ListService_1[_0x43410a(0x1c1)])({'ownerId':_0x4b54ec,'pageNumber':_0x5737fc});return _0x4027ad[_0x43410a(0x1b4)]({'records':_0x50debb,'count':_0x5849f5,'hasMore':_0x7a8cf4});};function a11_0x3693(_0x372a7b,_0x2edfee){const _0x153489=a11_0x17d3();return a11_0x3693=function(_0x1558de,_0x20ecef){_0x1558de=_0x1558de-0x19c;let _0x17d345=_0x153489[_0x1558de];return _0x17d345;},a11_0x3693(_0x372a7b,_0x2edfee);}exports[a11_0x3368b0(0x1cb)]=index;const store=async(_0x2b9045,_0x1c4a27)=>{const _0x19e1e5=a11_0x3368b0,{companyId:_0x5dc434}=_0x2b9045[_0x19e1e5(0x1ad)],_0x5487cc=+_0x2b9045[_0x19e1e5(0x1ad)]['id'],_0x356939=_0x2b9045['body'],_0x44be2e=await(0x0,CreateService_1[_0x19e1e5(0x1c1)])({..._0x356939,'ownerId':_0x5487cc,'companyId':_0x5dc434}),_0x1ac76f=(0x0,socket_1[_0x19e1e5(0x1bc)])();return _0x44be2e[_0x19e1e5(0x19d)]['forEach'](_0x4279b3=>{const _0x42145d=_0x19e1e5;_0x1ac76f['emit'](_0x42145d(0x1c5)+_0x5dc434+_0x42145d(0x1d9)+_0x4279b3[_0x42145d(0x1a6)],{'action':_0x42145d(0x1cf),'record':_0x44be2e});}),_0x1c4a27[_0x19e1e5(0x1d1)](0xc8)['json'](_0x44be2e);};exports['store']=store;const update=async(_0x7a0e0b,_0x55d9fc)=>{const _0xada48c=a11_0x3368b0,{companyId:_0x55b2e2}=_0x7a0e0b[_0xada48c(0x1ad)],_0x28a2b0=_0x7a0e0b[_0xada48c(0x1ab)],{id:_0x345549}=_0x7a0e0b['params'],_0x212bc9=await(0x0,UpdateService_1[_0xada48c(0x1c1)])({..._0x28a2b0,'id':+_0x345549}),_0x4357b9=(0x0,socket_1[_0xada48c(0x1bc)])();return _0x212bc9['users'][_0xada48c(0x1d5)](_0x625208=>{const _0x4e168e=_0xada48c;_0x4357b9[_0x4e168e(0x1ca)](_0x4e168e(0x1c5)+_0x55b2e2+_0x4e168e(0x1d9)+_0x625208[_0x4e168e(0x1a6)],{'action':_0x4e168e(0x19e),'record':_0x212bc9});}),_0x55d9fc[_0xada48c(0x1d1)](0xc8)[_0xada48c(0x1b4)](_0x212bc9);};exports[a11_0x3368b0(0x19e)]=update;const show=async(_0x2ddad8,_0x266744)=>{const _0xbf5c7e=a11_0x3368b0,{id:_0x29567a}=_0x2ddad8['params'],_0x436717=await(0x0,ShowFromUuidService_1[_0xbf5c7e(0x1c1)])(_0x29567a);return _0x266744[_0xbf5c7e(0x1d1)](0xc8)[_0xbf5c7e(0x1b4)](_0x436717);};exports[a11_0x3368b0(0x1c9)]=show;const remove=async(_0x365daa,_0x35a186)=>{const _0x50ba6f=a11_0x3368b0,{id:_0x5caee0}=_0x365daa['params'],{companyId:_0x31e646}=_0x365daa[_0x50ba6f(0x1ad)];await(0x0,DeleteService_1[_0x50ba6f(0x1c1)])(_0x5caee0);const _0x6cab86=(0x0,socket_1[_0x50ba6f(0x1bc)])();return _0x6cab86[_0x50ba6f(0x1ca)](_0x50ba6f(0x1c5)+_0x31e646+_0x50ba6f(0x1b7),{'action':_0x50ba6f(0x1c8),'id':_0x5caee0}),_0x35a186[_0x50ba6f(0x1d1)](0xc8)[_0x50ba6f(0x1b4)]({'message':_0x50ba6f(0x1c6)});};exports[a11_0x3368b0(0x1c4)]=remove;const saveMessage=async(_0x508b34,_0x197638)=>{const _0x29ef2b=a11_0x3368b0,_0x343d6f=_0x508b34[_0x29ef2b(0x19f)],{companyId:_0x403c63}=_0x508b34[_0x29ef2b(0x1ad)],{message:_0xb8875a}=_0x508b34[_0x29ef2b(0x1ab)],{id:_0x5a7c33}=_0x508b34['params'],_0x36ea00=+_0x508b34[_0x29ef2b(0x1ad)]['id'],_0x428569=+_0x5a7c33;let _0x5b53c8=null;_0x343d6f?await Promise['all'](_0x343d6f['map'](async _0x11a786=>{const _0x195a97=_0x29ef2b;_0x5b53c8=await(0x0,CreateMessageService_1[_0x195a97(0x1c1)])({'chatId':_0x428569,'senderId':_0x36ea00,'message':_0x11a786['originalname'],'mediaPath':_0x11a786[_0x195a97(0x1d6)],'mediaName':_0x11a786[_0x195a97(0x1cd)],'mediaType':_0x11a786[_0x195a97(0x1d0)]['split']('/')[0x0]});})):_0x5b53c8=await(0x0,CreateMessageService_1[_0x29ef2b(0x1c1)])({'chatId':_0x428569,'senderId':_0x36ea00,'message':_0xb8875a});const _0x5146a2=await Chat_1['default'][_0x29ef2b(0x1d3)](_0x428569,{'include':[{'model':User_1[_0x29ef2b(0x1c1)],'as':_0x29ef2b(0x1b9)},{'model':ChatUser_1[_0x29ef2b(0x1c1)],'as':_0x29ef2b(0x19d)}]}),_0x4b1b4b=_0x5146a2[_0x29ef2b(0x19d)]['map'](_0x4bb192=>'user-'+_0x4bb192['userId']),_0x325ffb=(0x0,socket_1[_0x29ef2b(0x1bc)])();return _0x325ffb['to'](_0x4b1b4b)[_0x29ef2b(0x1ca)](_0x29ef2b(0x1c5)+_0x403c63+_0x29ef2b(0x1c3)+_0x428569,{'action':_0x29ef2b(0x1a5),'newMessage':_0x5b53c8,'chat':_0x5146a2}),_0x325ffb['to'](_0x4b1b4b)[_0x29ef2b(0x1ca)](_0x29ef2b(0x1c5)+_0x403c63+_0x29ef2b(0x1b7),{'action':'new-message','newMessage':_0x5b53c8,'chat':_0x5146a2}),_0x197638['json'](_0x5b53c8);};exports[a11_0x3368b0(0x1aa)]=saveMessage;const checkAsRead=async(_0x418d5e,_0x151286)=>{const _0x2d9502=a11_0x3368b0,{companyId:_0x92e789}=_0x418d5e['user'],{userId:_0xc607cf}=_0x418d5e['body'],{id:_0x166e6b}=_0x418d5e[_0x2d9502(0x1b0)],_0x43e95b=await ChatUser_1['default']['findOne']({'where':{'chatId':_0x166e6b,'userId':_0xc607cf}});await _0x43e95b[_0x2d9502(0x19e)]({'unreads':0x0});const _0x4a067b=await Chat_1['default'][_0x2d9502(0x1d3)](_0x166e6b,{'include':[{'model':User_1[_0x2d9502(0x1c1)],'as':'owner'},{'model':ChatUser_1[_0x2d9502(0x1c1)],'as':_0x2d9502(0x19d)}]}),_0x42fd25=_0x4a067b['users']['map'](_0x5e0b23=>_0x2d9502(0x1b8)+_0x5e0b23[_0x2d9502(0x1a6)]),_0x172f23=(0x0,socket_1[_0x2d9502(0x1bc)])();return _0x172f23['to'](_0x42fd25)[_0x2d9502(0x1ca)]('company-'+_0x92e789+_0x2d9502(0x1c3)+_0x166e6b,{'action':_0x2d9502(0x19e),'chat':_0x4a067b}),_0x172f23['to'](_0x42fd25)[_0x2d9502(0x1ca)](_0x2d9502(0x1c5)+_0x92e789+'-chat',{'action':_0x2d9502(0x19e),'chat':_0x4a067b}),_0x151286['json'](_0x4a067b);};exports[a11_0x3368b0(0x1c2)]=checkAsRead;const messages=async(_0x3118e2,_0x72e275)=>{const _0x403dea=a11_0x3368b0,{pageNumber:_0x1a2634}=_0x3118e2[_0x403dea(0x1ac)],{id:_0xde809}=_0x3118e2['params'],_0x4554fb=+_0x3118e2['user']['id'],{records:_0x2b6e2a,count:_0x33a849,hasMore:_0x11e561}=await(0x0,FindMessages_1[_0x403dea(0x1c1)])({'chatId':_0xde809,'ownerId':_0x4554fb,'pageNumber':_0x1a2634});return _0x72e275[_0x403dea(0x1b4)]({'records':_0x2b6e2a,'count':_0x33a849,'hasMore':_0x11e561});};exports[a11_0x3368b0(0x1a2)]=messages;