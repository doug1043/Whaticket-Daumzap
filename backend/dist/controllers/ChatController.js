const a11_0xeb9f37=a11_0x58d7;(function(_0xe8427a,_0x511ba2){const _0x359ce0=a11_0x58d7,_0x3a3d43=_0xe8427a();while(!![]){try{const _0x3b7b04=-parseInt(_0x359ce0(0x195))/0x1*(-parseInt(_0x359ce0(0x17e))/0x2)+parseInt(_0x359ce0(0x178))/0x3*(-parseInt(_0x359ce0(0x1a3))/0x4)+-parseInt(_0x359ce0(0x1a0))/0x5+parseInt(_0x359ce0(0x175))/0x6+-parseInt(_0x359ce0(0x191))/0x7*(parseInt(_0x359ce0(0x16d))/0x8)+parseInt(_0x359ce0(0x17a))/0x9*(-parseInt(_0x359ce0(0x198))/0xa)+parseInt(_0x359ce0(0x16b))/0xb*(parseInt(_0x359ce0(0x17b))/0xc);if(_0x3b7b04===_0x511ba2)break;else _0x3a3d43['push'](_0x3a3d43['shift']());}catch(_0x4acc52){_0x3a3d43['push'](_0x3a3d43['shift']());}}}(a11_0x37c5,0x7a5ce));const a11_0x9ae160=(function(){let _0xec3a82=!![];return function(_0x447b04,_0x41d32f){const _0x3bd096=_0xec3a82?function(){const _0x329eff=a11_0x58d7;if(_0x41d32f){const _0x1249bf=_0x41d32f[_0x329eff(0x1a2)](_0x447b04,arguments);return _0x41d32f=null,_0x1249bf;}}:function(){};return _0xec3a82=![],_0x3bd096;};}()),a11_0x42c836=a11_0x9ae160(this,function(){const _0xefb6ee=a11_0x58d7;return a11_0x42c836[_0xefb6ee(0x19f)]()['search'](_0xefb6ee(0x16c))[_0xefb6ee(0x19f)]()[_0xefb6ee(0x199)](a11_0x42c836)[_0xefb6ee(0x1a5)](_0xefb6ee(0x16c));});a11_0x42c836();'use strict';var __importDefault=this&&this[a11_0xeb9f37(0x1a7)]||function(_0x550da1){const _0x51735c=a11_0xeb9f37;return _0x550da1&&_0x550da1[_0x51735c(0x181)]?_0x550da1:{'default':_0x550da1};};Object['defineProperty'](exports,a11_0xeb9f37(0x181),{'value':!![]}),exports['messages']=exports[a11_0xeb9f37(0x18d)]=exports[a11_0xeb9f37(0x176)]=exports[a11_0xeb9f37(0x182)]=exports[a11_0xeb9f37(0x16a)]=exports[a11_0xeb9f37(0x172)]=exports['store']=exports[a11_0xeb9f37(0x18a)]=void 0x0;const socket_1=require(a11_0xeb9f37(0x197)),CreateService_1=__importDefault(require('../services/ChatService/CreateService')),ListService_1=__importDefault(require(a11_0xeb9f37(0x17f))),ShowFromUuidService_1=__importDefault(require(a11_0xeb9f37(0x1a1))),DeleteService_1=__importDefault(require(a11_0xeb9f37(0x16f))),FindMessages_1=__importDefault(require('../services/ChatService/FindMessages')),UpdateService_1=__importDefault(require('../services/ChatService/UpdateService')),Chat_1=__importDefault(require(a11_0xeb9f37(0x16e))),CreateMessageService_1=__importDefault(require(a11_0xeb9f37(0x192))),User_1=__importDefault(require(a11_0xeb9f37(0x19d))),ChatUser_1=__importDefault(require(a11_0xeb9f37(0x18f))),index=async(_0xf5e074,_0x234653)=>{const _0x3b85c5=a11_0xeb9f37,{pageNumber:_0x5d3ba}=_0xf5e074['query'],_0x46a814=+_0xf5e074[_0x3b85c5(0x18e)]['id'],{records:_0x493255,count:_0x52392d,hasMore:_0x534c05}=await(0x0,ListService_1['default'])({'ownerId':_0x46a814,'pageNumber':_0x5d3ba});return _0x234653[_0x3b85c5(0x19a)]({'records':_0x493255,'count':_0x52392d,'hasMore':_0x534c05});};exports['index']=index;const store=async(_0x412f56,_0x27df27)=>{const _0x58e91e=a11_0xeb9f37,{companyId:_0x3663ee}=_0x412f56[_0x58e91e(0x18e)],_0x19302c=+_0x412f56[_0x58e91e(0x18e)]['id'],_0xb35bc6=_0x412f56[_0x58e91e(0x196)],_0x5c1ee8=await(0x0,CreateService_1[_0x58e91e(0x190)])({..._0xb35bc6,'ownerId':_0x19302c,'companyId':_0x3663ee}),_0xffafd4=(0x0,socket_1[_0x58e91e(0x188)])();return _0x5c1ee8[_0x58e91e(0x183)][_0x58e91e(0x174)](_0x198574=>{const _0xd0a735=_0x58e91e;_0xffafd4['emit'](_0xd0a735(0x1a4)+_0x3663ee+'-chat-user-'+_0x198574[_0xd0a735(0x193)],{'action':_0xd0a735(0x18b),'record':_0x5c1ee8});}),_0x27df27[_0x58e91e(0x171)](0xc8)['json'](_0x5c1ee8);};exports[a11_0xeb9f37(0x1a6)]=store;const update=async(_0x45d75a,_0x23acd0)=>{const _0x31b233=a11_0xeb9f37,{companyId:_0x575b9d}=_0x45d75a['user'],_0x13c500=_0x45d75a[_0x31b233(0x196)],{id:_0x2f2bc8}=_0x45d75a['params'],_0x2eb68d=await(0x0,UpdateService_1[_0x31b233(0x190)])({..._0x13c500,'id':+_0x2f2bc8}),_0x31748d=(0x0,socket_1['getIO'])();return _0x2eb68d[_0x31b233(0x183)][_0x31b233(0x174)](_0x1d6351=>{const _0x17c4d0=_0x31b233;_0x31748d[_0x17c4d0(0x19c)](_0x17c4d0(0x1a4)+_0x575b9d+'-chat-user-'+_0x1d6351[_0x17c4d0(0x193)],{'action':_0x17c4d0(0x172),'record':_0x2eb68d});}),_0x23acd0[_0x31b233(0x171)](0xc8)['json'](_0x2eb68d);};function a11_0x58d7(_0x50baf7,_0x1740f7){const _0x9ab22d=a11_0x37c5();return a11_0x58d7=function(_0x42c836,_0x9ae160){_0x42c836=_0x42c836-0x16a;let _0x37c530=_0x9ab22d[_0x42c836];return _0x37c530;},a11_0x58d7(_0x50baf7,_0x1740f7);}exports['update']=update;const show=async(_0x15fb8d,_0x4d408b)=>{const _0xe86d46=a11_0xeb9f37,{id:_0x2cd318}=_0x15fb8d[_0xe86d46(0x180)],_0x142039=await(0x0,ShowFromUuidService_1[_0xe86d46(0x190)])(_0x2cd318);return _0x4d408b[_0xe86d46(0x171)](0xc8)[_0xe86d46(0x19a)](_0x142039);};exports['show']=show;const remove=async(_0x594f14,_0x162019)=>{const _0x45471f=a11_0xeb9f37,{id:_0x41dc79}=_0x594f14[_0x45471f(0x180)],{companyId:_0x5dd691}=_0x594f14['user'];await(0x0,DeleteService_1[_0x45471f(0x190)])(_0x41dc79);const _0x14188c=(0x0,socket_1['getIO'])();return _0x14188c[_0x45471f(0x19c)](_0x45471f(0x1a4)+_0x5dd691+_0x45471f(0x189),{'action':_0x45471f(0x187),'id':_0x41dc79}),_0x162019[_0x45471f(0x171)](0xc8)[_0x45471f(0x19a)]({'message':_0x45471f(0x17c)});};exports[a11_0xeb9f37(0x182)]=remove;const saveMessage=async(_0x37b6b9,_0x5375c7)=>{const _0x29ba92=a11_0xeb9f37,_0x6f23ab=_0x37b6b9[_0x29ba92(0x184)],{companyId:_0x2548dd}=_0x37b6b9[_0x29ba92(0x18e)],{message:_0x368320}=_0x37b6b9[_0x29ba92(0x196)],{id:_0x2be428}=_0x37b6b9[_0x29ba92(0x180)],_0x447960=+_0x37b6b9[_0x29ba92(0x18e)]['id'],_0x35488f=+_0x2be428;let _0x48c08f=null;_0x6f23ab?await Promise[_0x29ba92(0x177)](_0x6f23ab['map'](async _0x5ce2cb=>{const _0x4db441=_0x29ba92;_0x48c08f=await(0x0,CreateMessageService_1[_0x4db441(0x190)])({'chatId':_0x35488f,'senderId':_0x447960,'message':_0x5ce2cb[_0x4db441(0x19b)],'mediaPath':_0x5ce2cb['filename'],'mediaName':_0x5ce2cb[_0x4db441(0x19b)],'mediaType':_0x5ce2cb['mimetype'][_0x4db441(0x170)]('/')[0x0]});})):_0x48c08f=await(0x0,CreateMessageService_1[_0x29ba92(0x190)])({'chatId':_0x35488f,'senderId':_0x447960,'message':_0x368320});const _0x5b4361=await Chat_1['default']['findByPk'](_0x35488f,{'include':[{'model':User_1[_0x29ba92(0x190)],'as':_0x29ba92(0x186)},{'model':ChatUser_1[_0x29ba92(0x190)],'as':_0x29ba92(0x183)}]}),_0x189f68=_0x5b4361[_0x29ba92(0x183)][_0x29ba92(0x173)](_0x2c4e6e=>_0x29ba92(0x17d)+_0x2c4e6e[_0x29ba92(0x193)]),_0x48de9d=(0x0,socket_1[_0x29ba92(0x188)])();return _0x48de9d['to'](_0x189f68)[_0x29ba92(0x19c)](_0x29ba92(0x1a4)+_0x2548dd+_0x29ba92(0x194)+_0x35488f,{'action':'new-message','newMessage':_0x48c08f,'chat':_0x5b4361}),_0x48de9d['to'](_0x189f68)[_0x29ba92(0x19c)](_0x29ba92(0x1a4)+_0x2548dd+'-chat',{'action':_0x29ba92(0x185),'newMessage':_0x48c08f,'chat':_0x5b4361}),_0x5375c7['json'](_0x48c08f);};exports[a11_0xeb9f37(0x176)]=saveMessage;function a11_0x37c5(){const _0x1926cb=['saveMessage','all','1158438GmEjKt','messages','5955093TzmQkn','120VmPYEw','Chat\x20deleted','user-','44PQywZr','../services/ChatService/ListService','params','__esModule','remove','users','files','new-message','owner','delete','getIO','-chat','index','create','findByPk','checkAsRead','user','../models/ChatUser','default','115157TBRizF','../services/ChatService/CreateMessageService','userId','-chat-','7841HeayvT','body','../libs/socket','10hSPFUn','constructor','json','originalname','emit','../models/User','query','toString','3608655yzHdLv','../services/ChatService/ShowFromUuidService','apply','4mlaOaW','company-','search','store','__importDefault','show','2804703yJrXLB','(((.+)+)+)+$','432vrsSeJ','../models/Chat','../services/ChatService/DeleteService','split','status','update','map','forEach','2621244eemjFJ'];a11_0x37c5=function(){return _0x1926cb;};return a11_0x37c5();}const checkAsRead=async(_0x526553,_0x2f04b5)=>{const _0x1c9c93=a11_0xeb9f37,{companyId:_0x1622e0}=_0x526553[_0x1c9c93(0x18e)],{userId:_0x1adfb3}=_0x526553[_0x1c9c93(0x196)],{id:_0x3591f4}=_0x526553[_0x1c9c93(0x180)],_0x45b0fc=await ChatUser_1[_0x1c9c93(0x190)]['findOne']({'where':{'chatId':_0x3591f4,'userId':_0x1adfb3}});await _0x45b0fc['update']({'unreads':0x0});const _0x46616f=await Chat_1[_0x1c9c93(0x190)][_0x1c9c93(0x18c)](_0x3591f4,{'include':[{'model':User_1['default'],'as':_0x1c9c93(0x186)},{'model':ChatUser_1['default'],'as':_0x1c9c93(0x183)}]}),_0x281f5b=_0x46616f[_0x1c9c93(0x183)][_0x1c9c93(0x173)](_0x598c87=>_0x1c9c93(0x17d)+_0x598c87[_0x1c9c93(0x193)]),_0x45abd2=(0x0,socket_1[_0x1c9c93(0x188)])();return _0x45abd2['to'](_0x281f5b)[_0x1c9c93(0x19c)](_0x1c9c93(0x1a4)+_0x1622e0+_0x1c9c93(0x194)+_0x3591f4,{'action':_0x1c9c93(0x172),'chat':_0x46616f}),_0x45abd2['to'](_0x281f5b)[_0x1c9c93(0x19c)]('company-'+_0x1622e0+_0x1c9c93(0x189),{'action':_0x1c9c93(0x172),'chat':_0x46616f}),_0x2f04b5[_0x1c9c93(0x19a)](_0x46616f);};exports[a11_0xeb9f37(0x18d)]=checkAsRead;const messages=async(_0x4a3d35,_0xef0601)=>{const _0x348024=a11_0xeb9f37,{pageNumber:_0x4ba4c8}=_0x4a3d35[_0x348024(0x19e)],{id:_0xaa2f2d}=_0x4a3d35[_0x348024(0x180)],_0x52f329=+_0x4a3d35[_0x348024(0x18e)]['id'],{records:_0x15b420,count:_0x5bca52,hasMore:_0x59d119}=await(0x0,FindMessages_1[_0x348024(0x190)])({'chatId':_0xaa2f2d,'ownerId':_0x52f329,'pageNumber':_0x4ba4c8});return _0xef0601[_0x348024(0x19a)]({'records':_0x15b420,'count':_0x5bca52,'hasMore':_0x59d119});};exports[a11_0xeb9f37(0x179)]=messages;