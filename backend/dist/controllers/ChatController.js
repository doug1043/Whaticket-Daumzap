const a12_0x299213=a12_0x4440;(function(_0xa1b1b6,_0x42a74a){const _0x4ada2b=a12_0x4440,_0x268cfd=_0xa1b1b6();while(!![]){try{const _0x590dcb=parseInt(_0x4ada2b(0x13a))/0x1+parseInt(_0x4ada2b(0x10a))/0x2*(parseInt(_0x4ada2b(0x11f))/0x3)+parseInt(_0x4ada2b(0x111))/0x4+-parseInt(_0x4ada2b(0x136))/0x5*(-parseInt(_0x4ada2b(0x128))/0x6)+parseInt(_0x4ada2b(0x130))/0x7*(-parseInt(_0x4ada2b(0x119))/0x8)+parseInt(_0x4ada2b(0x133))/0x9*(-parseInt(_0x4ada2b(0x134))/0xa)+-parseInt(_0x4ada2b(0x113))/0xb;if(_0x590dcb===_0x42a74a)break;else _0x268cfd['push'](_0x268cfd['shift']());}catch(_0x4e2681){_0x268cfd['push'](_0x268cfd['shift']());}}}(a12_0x49be,0x6d3a7));const a12_0x28e390=(function(){let _0xa9302d=!![];return function(_0xb10c2f,_0x5c743f){const _0xd4fd92=_0xa9302d?function(){const _0xc736e2=a12_0x4440;if(_0x5c743f){const _0x12be7e=_0x5c743f[_0xc736e2(0x11b)](_0xb10c2f,arguments);return _0x5c743f=null,_0x12be7e;}}:function(){};return _0xa9302d=![],_0xd4fd92;};}()),a12_0x40161a=a12_0x28e390(this,function(){const _0x2f03fa=a12_0x4440;return a12_0x40161a[_0x2f03fa(0x131)]()[_0x2f03fa(0x11d)](_0x2f03fa(0x141))[_0x2f03fa(0x131)]()[_0x2f03fa(0x126)](a12_0x40161a)['search']('(((.+)+)+)+$');});a12_0x40161a();'use strict';var __importDefault=this&&this[a12_0x299213(0x129)]||function(_0x336227){const _0x273b80=a12_0x299213;return _0x336227&&_0x336227[_0x273b80(0x13f)]?_0x336227:{'default':_0x336227};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['messages']=exports[a12_0x299213(0x11a)]=exports[a12_0x299213(0x13b)]=exports['remove']=exports[a12_0x299213(0x11e)]=exports['update']=exports[a12_0x299213(0x12d)]=exports['index']=void 0x0;const socket_1=require(a12_0x299213(0x127)),CreateService_1=__importDefault(require(a12_0x299213(0x12b))),ListService_1=__importDefault(require(a12_0x299213(0x12f))),ShowFromUuidService_1=__importDefault(require(a12_0x299213(0x10f))),DeleteService_1=__importDefault(require(a12_0x299213(0x12e))),FindMessages_1=__importDefault(require(a12_0x299213(0x13d))),UpdateService_1=__importDefault(require(a12_0x299213(0x117))),Chat_1=__importDefault(require('../models/Chat')),CreateMessageService_1=__importDefault(require(a12_0x299213(0x116))),User_1=__importDefault(require(a12_0x299213(0x11c))),ChatUser_1=__importDefault(require(a12_0x299213(0x124))),index=async(_0x918dde,_0x2c3fe0)=>{const _0x8512ad=a12_0x299213,{pageNumber:_0x3253f6}=_0x918dde['query'],_0x5f02ea=+_0x918dde[_0x8512ad(0x13e)]['id'],{records:_0x39e2a0,count:_0x5564a3,hasMore:_0x3635e4}=await(0x0,ListService_1[_0x8512ad(0x140)])({'ownerId':_0x5f02ea,'pageNumber':_0x3253f6});return _0x2c3fe0['json']({'records':_0x39e2a0,'count':_0x5564a3,'hasMore':_0x3635e4});};exports[a12_0x299213(0x10d)]=index;const store=async(_0x4755ff,_0x3a0198)=>{const _0x582928=a12_0x299213,{companyId:_0x41f4a4}=_0x4755ff[_0x582928(0x13e)],_0x361bf9=+_0x4755ff[_0x582928(0x13e)]['id'],_0x218a5f=_0x4755ff[_0x582928(0x135)],_0x47b86e=await(0x0,CreateService_1[_0x582928(0x140)])({..._0x218a5f,'ownerId':_0x361bf9,'companyId':_0x41f4a4}),_0x2ac5b1=(0x0,socket_1[_0x582928(0x10b)])();return _0x47b86e['users'][_0x582928(0x137)](_0x2938d4=>{const _0x1e9543=_0x582928;_0x2ac5b1['to'](_0x1e9543(0x125)+_0x41f4a4+_0x1e9543(0x10c))[_0x1e9543(0x139)](_0x1e9543(0x125)+_0x41f4a4+_0x1e9543(0x12c)+_0x2938d4['userId'],{'action':_0x1e9543(0x132),'record':_0x47b86e});}),_0x3a0198[_0x582928(0x109)](0xc8)[_0x582928(0x121)](_0x47b86e);};exports[a12_0x299213(0x12d)]=store;const update=async(_0x59f834,_0x345ad6)=>{const _0x57ae6f=a12_0x299213,{companyId:_0x2d209b}=_0x59f834[_0x57ae6f(0x13e)],_0x5457ae=_0x59f834['body'],{id:_0x170902}=_0x59f834[_0x57ae6f(0x10e)],_0x3e2961=await(0x0,UpdateService_1[_0x57ae6f(0x140)])({..._0x5457ae,'id':+_0x170902}),_0x179078=(0x0,socket_1['getIO'])();return _0x3e2961[_0x57ae6f(0x112)][_0x57ae6f(0x137)](_0x5de5b2=>{const _0x1ea871=_0x57ae6f;_0x179078['to'](_0x1ea871(0x125)+_0x2d209b+_0x1ea871(0x10c))[_0x1ea871(0x139)](_0x1ea871(0x125)+_0x2d209b+_0x1ea871(0x12c)+_0x5de5b2[_0x1ea871(0x123)],{'action':_0x1ea871(0x107),'record':_0x3e2961});}),_0x345ad6[_0x57ae6f(0x109)](0xc8)['json'](_0x3e2961);};exports[a12_0x299213(0x107)]=update;const show=async(_0x3d4d5e,_0x1a4a4a)=>{const _0x85787=a12_0x299213,{id:_0x585a18}=_0x3d4d5e[_0x85787(0x10e)],_0xd1e64b=await(0x0,ShowFromUuidService_1[_0x85787(0x140)])(_0x585a18);return _0x1a4a4a[_0x85787(0x109)](0xc8)[_0x85787(0x121)](_0xd1e64b);};function a12_0x4440(_0x41d0ca,_0x15c1df){const _0x351cd2=a12_0x49be();return a12_0x4440=function(_0x40161a,_0x28e390){_0x40161a=_0x40161a-0x107;let _0x49bed6=_0x351cd2[_0x40161a];return _0x49bed6;},a12_0x4440(_0x41d0ca,_0x15c1df);}exports[a12_0x299213(0x11e)]=show;const remove=async(_0x1f1966,_0x31d05a)=>{const _0x47ac3c=a12_0x299213,{id:_0x521b18}=_0x1f1966[_0x47ac3c(0x10e)],{companyId:_0x582986}=_0x1f1966[_0x47ac3c(0x13e)];await(0x0,DeleteService_1[_0x47ac3c(0x140)])(_0x521b18);const _0x39e263=(0x0,socket_1['getIO'])();return _0x39e263['to'](_0x47ac3c(0x125)+_0x582986+_0x47ac3c(0x10c))['emit']('company-'+_0x582986+'-chat',{'action':_0x47ac3c(0x114),'id':_0x521b18}),_0x31d05a[_0x47ac3c(0x109)](0xc8)[_0x47ac3c(0x121)]({'message':_0x47ac3c(0x118)});};exports[a12_0x299213(0x13c)]=remove;function a12_0x49be(){const _0x1a398d=['222AwNnDX','__importDefault','findByPk','../services/ChatService/CreateService','-chat-user-','store','../services/ChatService/DeleteService','../services/ChatService/ListService','35BFqQdE','toString','create','117LqFlXX','229550aDxAaz','body','6415Lxlpsn','forEach','findOne','emit','663330DCmwoY','saveMessage','remove','../services/ChatService/FindMessages','user','__esModule','default','(((.+)+)+)+$','update','owner','status','2lKZFjn','getIO','-mainchannel','index','params','../services/ChatService/ShowFromUuidService','-chat','2529552uvjHfN','users','9996360WJlzSM','delete','-chat-','../services/ChatService/CreateMessageService','../services/ChatService/UpdateService','Chat\x20deleted','944zFLZrj','checkAsRead','apply','../models/User','search','show','935925MgfVSE','messages','json','new-message','userId','../models/ChatUser','company-','constructor','../libs/socket'];a12_0x49be=function(){return _0x1a398d;};return a12_0x49be();}const saveMessage=async(_0x4997ac,_0x4dd55c)=>{const _0x1bb735=a12_0x299213,{companyId:_0x285816}=_0x4997ac[_0x1bb735(0x13e)],{message:_0x1039b8}=_0x4997ac[_0x1bb735(0x135)],{id:_0x5de6f9}=_0x4997ac[_0x1bb735(0x10e)],_0x111b7b=+_0x4997ac[_0x1bb735(0x13e)]['id'],_0x396a9b=+_0x5de6f9,_0xe2806=await(0x0,CreateMessageService_1[_0x1bb735(0x140)])({'chatId':_0x396a9b,'senderId':_0x111b7b,'message':_0x1039b8}),_0x30098e=await Chat_1[_0x1bb735(0x140)][_0x1bb735(0x12a)](_0x396a9b,{'include':[{'model':User_1[_0x1bb735(0x140)],'as':'owner'},{'model':ChatUser_1[_0x1bb735(0x140)],'as':_0x1bb735(0x112)}]}),_0x2d6258=(0x0,socket_1[_0x1bb735(0x10b)])();return _0x2d6258['to'](_0x1bb735(0x125)+_0x285816+'-mainchannel')[_0x1bb735(0x139)](_0x1bb735(0x125)+_0x285816+'-chat-'+_0x396a9b,{'action':'new-message','newMessage':_0xe2806,'chat':_0x30098e}),_0x2d6258['to'](_0x1bb735(0x125)+_0x285816+_0x1bb735(0x10c))[_0x1bb735(0x139)]('company-'+_0x285816+'-chat',{'action':_0x1bb735(0x122),'newMessage':_0xe2806,'chat':_0x30098e}),_0x4dd55c[_0x1bb735(0x121)](_0xe2806);};exports['saveMessage']=saveMessage;const checkAsRead=async(_0x2bc80a,_0x2a77e3)=>{const _0x3a0801=a12_0x299213,{companyId:_0x5c57c8}=_0x2bc80a['user'],{userId:_0x543010}=_0x2bc80a[_0x3a0801(0x135)],{id:_0x3757d5}=_0x2bc80a['params'],_0x53cada=await ChatUser_1[_0x3a0801(0x140)][_0x3a0801(0x138)]({'where':{'chatId':_0x3757d5,'userId':_0x543010}});await _0x53cada[_0x3a0801(0x107)]({'unreads':0x0});const _0x1f5a15=await Chat_1['default'][_0x3a0801(0x12a)](_0x3757d5,{'include':[{'model':User_1[_0x3a0801(0x140)],'as':_0x3a0801(0x108)},{'model':ChatUser_1['default'],'as':_0x3a0801(0x112)}]}),_0x29a0a8=(0x0,socket_1[_0x3a0801(0x10b)])();return _0x29a0a8['to'](_0x3a0801(0x125)+_0x5c57c8+_0x3a0801(0x10c))['emit'](_0x3a0801(0x125)+_0x5c57c8+_0x3a0801(0x115)+_0x3757d5,{'action':_0x3a0801(0x107),'chat':_0x1f5a15}),_0x29a0a8['to'](_0x3a0801(0x125)+_0x5c57c8+_0x3a0801(0x10c))[_0x3a0801(0x139)](_0x3a0801(0x125)+_0x5c57c8+_0x3a0801(0x110),{'action':_0x3a0801(0x107),'chat':_0x1f5a15}),_0x2a77e3[_0x3a0801(0x121)](_0x1f5a15);};exports[a12_0x299213(0x11a)]=checkAsRead;const messages=async(_0x972efb,_0x205561)=>{const _0x791c96=a12_0x299213,{pageNumber:_0x2ebd35}=_0x972efb['query'],{id:_0x2378b5}=_0x972efb[_0x791c96(0x10e)],_0xfeb5a=+_0x972efb['user']['id'],{records:_0x415592,count:_0x14d5db,hasMore:_0x4b9131}=await(0x0,FindMessages_1[_0x791c96(0x140)])({'chatId':_0x2378b5,'ownerId':_0xfeb5a,'pageNumber':_0x2ebd35});return _0x205561['json']({'records':_0x415592,'count':_0x14d5db,'hasMore':_0x4b9131});};exports[a12_0x299213(0x120)]=messages;