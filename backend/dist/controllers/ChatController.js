const a12_0x10c7c6=a12_0xa539;(function(_0x51b930,_0x3f1780){const _0x546bb3=a12_0xa539,_0xa27984=_0x51b930();while(!![]){try{const _0x51bacb=parseInt(_0x546bb3(0x1d8))/0x1+-parseInt(_0x546bb3(0x1db))/0x2*(parseInt(_0x546bb3(0x1cc))/0x3)+parseInt(_0x546bb3(0x1e8))/0x4*(-parseInt(_0x546bb3(0x1d0))/0x5)+-parseInt(_0x546bb3(0x1d4))/0x6+-parseInt(_0x546bb3(0x1ea))/0x7*(parseInt(_0x546bb3(0x1e2))/0x8)+-parseInt(_0x546bb3(0x1e6))/0x9+parseInt(_0x546bb3(0x1eb))/0xa;if(_0x51bacb===_0x3f1780)break;else _0xa27984['push'](_0xa27984['shift']());}catch(_0x3b0aeb){_0xa27984['push'](_0xa27984['shift']());}}}(a12_0x2750,0x5fab2));const a12_0x5995aa=(function(){let _0x469773=!![];return function(_0x1263e1,_0x20b5de){const _0xd8fc0c=_0x469773?function(){const _0x29e89c=a12_0xa539;if(_0x20b5de){const _0x55c031=_0x20b5de[_0x29e89c(0x1cf)](_0x1263e1,arguments);return _0x20b5de=null,_0x55c031;}}:function(){};return _0x469773=![],_0xd8fc0c;};}()),a12_0x412784=a12_0x5995aa(this,function(){const _0x5b757c=a12_0xa539;return a12_0x412784[_0x5b757c(0x1f9)]()['search'](_0x5b757c(0x1f6))[_0x5b757c(0x1f9)]()[_0x5b757c(0x1ca)](a12_0x412784)['search']('(((.+)+)+)+$');});a12_0x412784();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x106fe3){const _0x24e228=a12_0xa539;return _0x106fe3&&_0x106fe3[_0x24e228(0x1c8)]?_0x106fe3:{'default':_0x106fe3};};function a12_0x2750(){const _0x5860d0=['toString','index','owner','body','../services/ChatService/CreateService','__esModule','remove','constructor','emit','1077tCErVe','store','checkAsRead','apply','7045byAhqn','../libs/socket','findOne','new-message','2386848SMoofB','-chat-user-','userId','getIO','706986tMyMaL','../services/ChatService/UpdateService','-chat-','4022tezLlL','show','Chat\x20deleted','create','../services/ChatService/DeleteService','saveMessage','company-','13128nTKvFt','params','update','users','1525617UosKeA','findByPk','552ijMxkS','delete','1778hWpdBP','15853980RTHtDN','../services/ChatService/ListService','-chat','messages','default','defineProperty','user','query','-mainchannel','../services/ChatService/FindMessages','forEach','(((.+)+)+)+$','json','status'];a12_0x2750=function(){return _0x5860d0;};return a12_0x2750();}Object[a12_0x10c7c6(0x1f0)](exports,a12_0x10c7c6(0x1c8),{'value':!![]}),exports[a12_0x10c7c6(0x1ee)]=exports[a12_0x10c7c6(0x1ce)]=exports[a12_0x10c7c6(0x1e0)]=exports['remove']=exports[a12_0x10c7c6(0x1dc)]=exports[a12_0x10c7c6(0x1e4)]=exports['store']=exports[a12_0x10c7c6(0x1c4)]=void 0x0;const socket_1=require(a12_0x10c7c6(0x1d1)),CreateService_1=__importDefault(require(a12_0x10c7c6(0x1c7))),ListService_1=__importDefault(require(a12_0x10c7c6(0x1ec))),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require(a12_0x10c7c6(0x1df))),FindMessages_1=__importDefault(require(a12_0x10c7c6(0x1f4))),UpdateService_1=__importDefault(require(a12_0x10c7c6(0x1d9))),Chat_1=__importDefault(require('../models/Chat')),CreateMessageService_1=__importDefault(require('../services/ChatService/CreateMessageService')),User_1=__importDefault(require('../models/User')),ChatUser_1=__importDefault(require('../models/ChatUser')),index=async(_0x4cab7e,_0x435eaa)=>{const _0x2db6ae=a12_0x10c7c6,{pageNumber:_0x51ece8}=_0x4cab7e[_0x2db6ae(0x1f2)],_0x4b85d8=+_0x4cab7e[_0x2db6ae(0x1f1)]['id'],{records:_0x361d75,count:_0x206640,hasMore:_0x765eb}=await(0x0,ListService_1[_0x2db6ae(0x1ef)])({'ownerId':_0x4b85d8,'pageNumber':_0x51ece8});return _0x435eaa['json']({'records':_0x361d75,'count':_0x206640,'hasMore':_0x765eb});};exports[a12_0x10c7c6(0x1c4)]=index;const store=async(_0x34e99c,_0x1c574a)=>{const _0x4c1bc1=a12_0x10c7c6,{companyId:_0x60460e}=_0x34e99c[_0x4c1bc1(0x1f1)],_0x28d70a=+_0x34e99c['user']['id'],_0x176acc=_0x34e99c[_0x4c1bc1(0x1c6)],_0xbc5eb1=await(0x0,CreateService_1['default'])({..._0x176acc,'ownerId':_0x28d70a,'companyId':_0x60460e}),_0x4157a1=(0x0,socket_1[_0x4c1bc1(0x1d7)])();return _0xbc5eb1[_0x4c1bc1(0x1e5)][_0x4c1bc1(0x1f5)](_0x45e8a7=>{const _0x44f61f=_0x4c1bc1;_0x4157a1['to'](_0x44f61f(0x1e1)+_0x60460e+_0x44f61f(0x1f3))[_0x44f61f(0x1cb)]('company-'+_0x60460e+_0x44f61f(0x1d5)+_0x45e8a7[_0x44f61f(0x1d6)],{'action':_0x44f61f(0x1de),'record':_0xbc5eb1});}),_0x1c574a['status'](0xc8)[_0x4c1bc1(0x1f7)](_0xbc5eb1);};exports[a12_0x10c7c6(0x1cd)]=store;const update=async(_0x36eca4,_0x557ad9)=>{const _0x1ce5dd=a12_0x10c7c6,{companyId:_0x4381ca}=_0x36eca4[_0x1ce5dd(0x1f1)],_0x2763b6=_0x36eca4[_0x1ce5dd(0x1c6)],{id:_0x335ce1}=_0x36eca4[_0x1ce5dd(0x1e3)],_0x2b28ac=await(0x0,UpdateService_1['default'])({..._0x2763b6,'id':+_0x335ce1}),_0x2179e4=(0x0,socket_1['getIO'])();return _0x2b28ac[_0x1ce5dd(0x1e5)]['forEach'](_0x1252f9=>{const _0x24c29d=_0x1ce5dd;_0x2179e4['to'](_0x24c29d(0x1e1)+_0x4381ca+_0x24c29d(0x1f3))['emit'](_0x24c29d(0x1e1)+_0x4381ca+_0x24c29d(0x1d5)+_0x1252f9[_0x24c29d(0x1d6)],{'action':'update','record':_0x2b28ac});}),_0x557ad9[_0x1ce5dd(0x1f8)](0xc8)[_0x1ce5dd(0x1f7)](_0x2b28ac);};exports['update']=update;const show=async(_0x5e3ecf,_0x329f70)=>{const _0x59240d=a12_0x10c7c6,{id:_0xbbe857}=_0x5e3ecf[_0x59240d(0x1e3)],_0x422278=await(0x0,ShowFromUuidService_1[_0x59240d(0x1ef)])(_0xbbe857);return _0x329f70[_0x59240d(0x1f8)](0xc8)['json'](_0x422278);};exports[a12_0x10c7c6(0x1dc)]=show;const remove=async(_0x1f0cf0,_0x5ebe46)=>{const _0x3fffae=a12_0x10c7c6,{id:_0x1fdf5f}=_0x1f0cf0['params'],{companyId:_0x1c4471}=_0x1f0cf0[_0x3fffae(0x1f1)];await(0x0,DeleteService_1[_0x3fffae(0x1ef)])(_0x1fdf5f);const _0x332aeb=(0x0,socket_1[_0x3fffae(0x1d7)])();return _0x332aeb['to']('company-'+_0x1c4471+_0x3fffae(0x1f3))['emit']('company-'+_0x1c4471+_0x3fffae(0x1ed),{'action':_0x3fffae(0x1e9),'id':_0x1fdf5f}),_0x5ebe46[_0x3fffae(0x1f8)](0xc8)['json']({'message':_0x3fffae(0x1dd)});};exports[a12_0x10c7c6(0x1c9)]=remove;const saveMessage=async(_0x12fd92,_0x219d40)=>{const _0x4a464f=a12_0x10c7c6,{companyId:_0x55fa3d}=_0x12fd92[_0x4a464f(0x1f1)],{message:_0xee5a26}=_0x12fd92[_0x4a464f(0x1c6)],{id:_0x403caa}=_0x12fd92['params'],_0x319009=+_0x12fd92['user']['id'],_0x39fc46=+_0x403caa,_0x169124=await(0x0,CreateMessageService_1['default'])({'chatId':_0x39fc46,'senderId':_0x319009,'message':_0xee5a26}),_0x4cb324=await Chat_1[_0x4a464f(0x1ef)][_0x4a464f(0x1e7)](_0x39fc46,{'include':[{'model':User_1[_0x4a464f(0x1ef)],'as':_0x4a464f(0x1c5)},{'model':ChatUser_1[_0x4a464f(0x1ef)],'as':_0x4a464f(0x1e5)}]}),_0x296eee=(0x0,socket_1[_0x4a464f(0x1d7)])();return _0x296eee['to']('company-'+_0x55fa3d+_0x4a464f(0x1f3))[_0x4a464f(0x1cb)]('company-'+_0x55fa3d+_0x4a464f(0x1da)+_0x39fc46,{'action':'new-message','newMessage':_0x169124,'chat':_0x4cb324}),_0x296eee['to'](_0x4a464f(0x1e1)+_0x55fa3d+'-mainchannel')[_0x4a464f(0x1cb)]('company-'+_0x55fa3d+'-chat',{'action':_0x4a464f(0x1d3),'newMessage':_0x169124,'chat':_0x4cb324}),_0x219d40[_0x4a464f(0x1f7)](_0x169124);};exports['saveMessage']=saveMessage;const checkAsRead=async(_0x8a288f,_0x2c45eb)=>{const _0x5bdc5a=a12_0x10c7c6,{companyId:_0x1ac3d6}=_0x8a288f[_0x5bdc5a(0x1f1)],{userId:_0x70aa95}=_0x8a288f['body'],{id:_0x595660}=_0x8a288f[_0x5bdc5a(0x1e3)],_0x54387c=await ChatUser_1[_0x5bdc5a(0x1ef)][_0x5bdc5a(0x1d2)]({'where':{'chatId':_0x595660,'userId':_0x70aa95}});await _0x54387c[_0x5bdc5a(0x1e4)]({'unreads':0x0});const _0x5622cf=await Chat_1[_0x5bdc5a(0x1ef)][_0x5bdc5a(0x1e7)](_0x595660,{'include':[{'model':User_1[_0x5bdc5a(0x1ef)],'as':'owner'},{'model':ChatUser_1[_0x5bdc5a(0x1ef)],'as':_0x5bdc5a(0x1e5)}]}),_0x3bfc3f=(0x0,socket_1['getIO'])();return _0x3bfc3f['to'](_0x5bdc5a(0x1e1)+_0x1ac3d6+_0x5bdc5a(0x1f3))[_0x5bdc5a(0x1cb)]('company-'+_0x1ac3d6+_0x5bdc5a(0x1da)+_0x595660,{'action':_0x5bdc5a(0x1e4),'chat':_0x5622cf}),_0x3bfc3f['to']('company-'+_0x1ac3d6+_0x5bdc5a(0x1f3))[_0x5bdc5a(0x1cb)](_0x5bdc5a(0x1e1)+_0x1ac3d6+_0x5bdc5a(0x1ed),{'action':'update','chat':_0x5622cf}),_0x2c45eb[_0x5bdc5a(0x1f7)](_0x5622cf);};exports[a12_0x10c7c6(0x1ce)]=checkAsRead;const messages=async(_0x29e469,_0x724a2a)=>{const _0x351d57=a12_0x10c7c6,{pageNumber:_0x418972}=_0x29e469[_0x351d57(0x1f2)],{id:_0x1405f6}=_0x29e469['params'],_0x3ca90b=+_0x29e469['user']['id'],{records:_0x4509c0,count:_0x1d6b62,hasMore:_0x5a4b20}=await(0x0,FindMessages_1[_0x351d57(0x1ef)])({'chatId':_0x1405f6,'ownerId':_0x3ca90b,'pageNumber':_0x418972});return _0x724a2a['json']({'records':_0x4509c0,'count':_0x1d6b62,'hasMore':_0x5a4b20});};function a12_0xa539(_0x566a53,_0xad0007){const _0x29e60d=a12_0x2750();return a12_0xa539=function(_0x412784,_0x5995aa){_0x412784=_0x412784-0x1c4;let _0x275099=_0x29e60d[_0x412784];return _0x275099;},a12_0xa539(_0x566a53,_0xad0007);}exports[a12_0x10c7c6(0x1ee)]=messages;