const a12_0x2df625=a12_0x5884;(function(_0x3fc3f4,_0x514ac2){const _0x57fb22=a12_0x5884,_0x5b537c=_0x3fc3f4();while(!![]){try{const _0x3155de=parseInt(_0x57fb22(0x20a))/0x1*(parseInt(_0x57fb22(0x1f8))/0x2)+-parseInt(_0x57fb22(0x1f6))/0x3+-parseInt(_0x57fb22(0x20d))/0x4+parseInt(_0x57fb22(0x21c))/0x5*(parseInt(_0x57fb22(0x220))/0x6)+-parseInt(_0x57fb22(0x1f7))/0x7*(-parseInt(_0x57fb22(0x21b))/0x8)+-parseInt(_0x57fb22(0x21d))/0x9+-parseInt(_0x57fb22(0x221))/0xa;if(_0x3155de===_0x514ac2)break;else _0x5b537c['push'](_0x5b537c['shift']());}catch(_0x5bb6d4){_0x5b537c['push'](_0x5b537c['shift']());}}}(a12_0x55a7,0x8d5b1));const a12_0x3530b4=(function(){let _0x1fe4b0=!![];return function(_0xaa6769,_0x5a2787){const _0x34d083=_0x1fe4b0?function(){const _0x3e1fd0=a12_0x5884;if(_0x5a2787){const _0x4c7e40=_0x5a2787[_0x3e1fd0(0x20b)](_0xaa6769,arguments);return _0x5a2787=null,_0x4c7e40;}}:function(){};return _0x1fe4b0=![],_0x34d083;};}()),a12_0x3487e9=a12_0x3530b4(this,function(){const _0x565e19=a12_0x5884;return a12_0x3487e9[_0x565e19(0x218)]()[_0x565e19(0x20e)]('(((.+)+)+)+$')['toString']()[_0x565e19(0x200)](a12_0x3487e9)['search']('(((.+)+)+)+$');});a12_0x3487e9();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x8147de){const _0x41ce49=a12_0x5884;return _0x8147de&&_0x8147de[_0x41ce49(0x216)]?_0x8147de:{'default':_0x8147de};};Object['defineProperty'](exports,a12_0x2df625(0x216),{'value':!![]}),exports[a12_0x2df625(0x204)]=exports[a12_0x2df625(0x1ff)]=exports[a12_0x2df625(0x211)]=exports[a12_0x2df625(0x20f)]=exports[a12_0x2df625(0x206)]=exports[a12_0x2df625(0x1f4)]=exports[a12_0x2df625(0x1f9)]=exports[a12_0x2df625(0x21e)]=void 0x0;const socket_1=require(a12_0x2df625(0x1f5)),CreateService_1=__importDefault(require('../services/ChatService/CreateService')),ListService_1=__importDefault(require('../services/ChatService/ListService')),ShowFromUuidService_1=__importDefault(require(a12_0x2df625(0x1fc))),DeleteService_1=__importDefault(require(a12_0x2df625(0x1fa))),FindMessages_1=__importDefault(require('../services/ChatService/FindMessages')),UpdateService_1=__importDefault(require(a12_0x2df625(0x1fd))),Chat_1=__importDefault(require(a12_0x2df625(0x219))),CreateMessageService_1=__importDefault(require(a12_0x2df625(0x1f0))),User_1=__importDefault(require(a12_0x2df625(0x1ed))),ChatUser_1=__importDefault(require('../models/ChatUser')),index=async(_0x19e9e7,_0x38b3c5)=>{const _0x2db6fb=a12_0x2df625,{pageNumber:_0x223954}=_0x19e9e7[_0x2db6fb(0x210)],_0x16f79b=+_0x19e9e7[_0x2db6fb(0x212)]['id'],{records:_0x4f65fd,count:_0x342ae0,hasMore:_0x20cf3e}=await(0x0,ListService_1[_0x2db6fb(0x1f2)])({'ownerId':_0x16f79b,'pageNumber':_0x223954});return _0x38b3c5[_0x2db6fb(0x214)]({'records':_0x4f65fd,'count':_0x342ae0,'hasMore':_0x20cf3e});};function a12_0x5884(_0x5bef28,_0x1629b0){const _0x5d28e8=a12_0x55a7();return a12_0x5884=function(_0x3487e9,_0x3530b4){_0x3487e9=_0x3487e9-0x1ed;let _0x55a71a=_0x5d28e8[_0x3487e9];return _0x55a71a;},a12_0x5884(_0x5bef28,_0x1629b0);}exports[a12_0x2df625(0x21e)]=index;const store=async(_0x5d3d8d,_0xd7f6b8)=>{const _0xa33d19=a12_0x2df625,{companyId:_0xdcb451}=_0x5d3d8d[_0xa33d19(0x212)],_0x1ed2a8=+_0x5d3d8d[_0xa33d19(0x212)]['id'],_0x522e7e=_0x5d3d8d[_0xa33d19(0x202)],_0x329e5c=await(0x0,CreateService_1[_0xa33d19(0x1f2)])({..._0x522e7e,'ownerId':_0x1ed2a8,'companyId':_0xdcb451}),_0x44dc51=(0x0,socket_1[_0xa33d19(0x217)])();return _0x329e5c[_0xa33d19(0x213)][_0xa33d19(0x209)](_0x20fc33=>{const _0x2fc722=_0xa33d19;_0x44dc51['to'](_0x2fc722(0x207)+_0xdcb451+_0x2fc722(0x1ef))[_0x2fc722(0x203)](_0x2fc722(0x207)+_0xdcb451+_0x2fc722(0x20c)+_0x20fc33[_0x2fc722(0x21f)],{'action':_0x2fc722(0x1f3),'record':_0x329e5c});}),_0xd7f6b8[_0xa33d19(0x215)](0xc8)[_0xa33d19(0x214)](_0x329e5c);};exports['store']=store;function a12_0x55a7(){const _0x3d24a3=['../services/ChatService/ShowFromUuidService','../services/ChatService/UpdateService','findByPk','checkAsRead','constructor','-chat-','body','emit','messages','-chat','show','company-','new-message','forEach','1hFtCAT','apply','-chat-user-','749700LElUCJ','search','remove','query','saveMessage','user','users','json','status','__esModule','getIO','toString','../models/Chat','Chat\x20deleted','196656xTXZdg','3938105SRXiVn','3023469JGBmWt','index','userId','6VzhBcy','550250ozqcsc','../models/User','params','-mainchannel','../services/ChatService/CreateMessageService','owner','default','create','update','../libs/socket','1353870SkYoCu','112RafUuD','855482WurDqh','store','../services/ChatService/DeleteService','delete'];a12_0x55a7=function(){return _0x3d24a3;};return a12_0x55a7();}const update=async(_0x372f3e,_0x4833a6)=>{const _0x5e5748=a12_0x2df625,{companyId:_0x4631ea}=_0x372f3e[_0x5e5748(0x212)],_0x14a7e5=_0x372f3e[_0x5e5748(0x202)],{id:_0x48fa35}=_0x372f3e[_0x5e5748(0x1ee)],_0x4e7528=await(0x0,UpdateService_1[_0x5e5748(0x1f2)])({..._0x14a7e5,'id':+_0x48fa35}),_0x5b5a25=(0x0,socket_1[_0x5e5748(0x217)])();return _0x4e7528[_0x5e5748(0x213)][_0x5e5748(0x209)](_0x2eaee1=>{const _0x22bc6f=_0x5e5748;_0x5b5a25['to'](_0x22bc6f(0x207)+_0x4631ea+'-mainchannel')['emit'](_0x22bc6f(0x207)+_0x4631ea+_0x22bc6f(0x20c)+_0x2eaee1[_0x22bc6f(0x21f)],{'action':'update','record':_0x4e7528});}),_0x4833a6[_0x5e5748(0x215)](0xc8)['json'](_0x4e7528);};exports[a12_0x2df625(0x1f4)]=update;const show=async(_0x38e635,_0x5be957)=>{const _0x5f3ee5=a12_0x2df625,{id:_0x299ad6}=_0x38e635[_0x5f3ee5(0x1ee)],_0x12a078=await(0x0,ShowFromUuidService_1[_0x5f3ee5(0x1f2)])(_0x299ad6);return _0x5be957[_0x5f3ee5(0x215)](0xc8)[_0x5f3ee5(0x214)](_0x12a078);};exports['show']=show;const remove=async(_0xda0703,_0x2e1a51)=>{const _0x184a1f=a12_0x2df625,{id:_0x27a504}=_0xda0703[_0x184a1f(0x1ee)],{companyId:_0x52f94b}=_0xda0703[_0x184a1f(0x212)];await(0x0,DeleteService_1[_0x184a1f(0x1f2)])(_0x27a504);const _0x4018ba=(0x0,socket_1[_0x184a1f(0x217)])();return _0x4018ba['to']('company-'+_0x52f94b+_0x184a1f(0x1ef))[_0x184a1f(0x203)]('company-'+_0x52f94b+_0x184a1f(0x205),{'action':_0x184a1f(0x1fb),'id':_0x27a504}),_0x2e1a51[_0x184a1f(0x215)](0xc8)[_0x184a1f(0x214)]({'message':_0x184a1f(0x21a)});};exports[a12_0x2df625(0x20f)]=remove;const saveMessage=async(_0x5a47a,_0x3c8cff)=>{const _0x550bb5=a12_0x2df625,{companyId:_0x1a8988}=_0x5a47a[_0x550bb5(0x212)],{message:_0x5cac56}=_0x5a47a[_0x550bb5(0x202)],{id:_0x55c013}=_0x5a47a[_0x550bb5(0x1ee)],_0x5ca21d=+_0x5a47a[_0x550bb5(0x212)]['id'],_0xa2a4ec=+_0x55c013,_0x37960a=await(0x0,CreateMessageService_1['default'])({'chatId':_0xa2a4ec,'senderId':_0x5ca21d,'message':_0x5cac56}),_0x3e68a1=await Chat_1[_0x550bb5(0x1f2)]['findByPk'](_0xa2a4ec,{'include':[{'model':User_1[_0x550bb5(0x1f2)],'as':_0x550bb5(0x1f1)},{'model':ChatUser_1[_0x550bb5(0x1f2)],'as':_0x550bb5(0x213)}]}),_0x1ba0d3=(0x0,socket_1['getIO'])();return _0x1ba0d3['to']('company-'+_0x1a8988+'-mainchannel')[_0x550bb5(0x203)](_0x550bb5(0x207)+_0x1a8988+_0x550bb5(0x201)+_0xa2a4ec,{'action':_0x550bb5(0x208),'newMessage':_0x37960a,'chat':_0x3e68a1}),_0x1ba0d3['to'](_0x550bb5(0x207)+_0x1a8988+_0x550bb5(0x1ef))['emit']('company-'+_0x1a8988+_0x550bb5(0x205),{'action':_0x550bb5(0x208),'newMessage':_0x37960a,'chat':_0x3e68a1}),_0x3c8cff[_0x550bb5(0x214)](_0x37960a);};exports[a12_0x2df625(0x211)]=saveMessage;const checkAsRead=async(_0x2aa589,_0x5d459f)=>{const _0x48fc38=a12_0x2df625,{companyId:_0x4f81e6}=_0x2aa589['user'],{userId:_0x54fd4c}=_0x2aa589[_0x48fc38(0x202)],{id:_0x3441f0}=_0x2aa589[_0x48fc38(0x1ee)],_0x54952c=await ChatUser_1[_0x48fc38(0x1f2)]['findOne']({'where':{'chatId':_0x3441f0,'userId':_0x54fd4c}});await _0x54952c[_0x48fc38(0x1f4)]({'unreads':0x0});const _0x11d6fc=await Chat_1[_0x48fc38(0x1f2)][_0x48fc38(0x1fe)](_0x3441f0,{'include':[{'model':User_1[_0x48fc38(0x1f2)],'as':_0x48fc38(0x1f1)},{'model':ChatUser_1[_0x48fc38(0x1f2)],'as':_0x48fc38(0x213)}]}),_0x5e1317=(0x0,socket_1[_0x48fc38(0x217)])();return _0x5e1317['to'](_0x48fc38(0x207)+_0x4f81e6+_0x48fc38(0x1ef))[_0x48fc38(0x203)](_0x48fc38(0x207)+_0x4f81e6+_0x48fc38(0x201)+_0x3441f0,{'action':_0x48fc38(0x1f4),'chat':_0x11d6fc}),_0x5e1317['to'](_0x48fc38(0x207)+_0x4f81e6+_0x48fc38(0x1ef))[_0x48fc38(0x203)]('company-'+_0x4f81e6+'-chat',{'action':_0x48fc38(0x1f4),'chat':_0x11d6fc}),_0x5d459f[_0x48fc38(0x214)](_0x11d6fc);};exports[a12_0x2df625(0x1ff)]=checkAsRead;const messages=async(_0x297af0,_0x1566ff)=>{const _0x53af34=a12_0x2df625,{pageNumber:_0x1c151e}=_0x297af0[_0x53af34(0x210)],{id:_0x130f0a}=_0x297af0[_0x53af34(0x1ee)],_0x35ef4a=+_0x297af0[_0x53af34(0x212)]['id'],{records:_0x2673ab,count:_0x1ccb47,hasMore:_0x2785c9}=await(0x0,FindMessages_1[_0x53af34(0x1f2)])({'chatId':_0x130f0a,'ownerId':_0x35ef4a,'pageNumber':_0x1c151e});return _0x1566ff[_0x53af34(0x214)]({'records':_0x2673ab,'count':_0x1ccb47,'hasMore':_0x2785c9});};exports[a12_0x2df625(0x204)]=messages;