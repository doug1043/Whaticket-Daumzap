const a14_0x3b34cf=a14_0x1ae2;(function(_0x56fd43,_0x32d630){const _0x53b4a1=a14_0x1ae2,_0x423beb=_0x56fd43();while(!![]){try{const _0x7460e2=-parseInt(_0x53b4a1(0x180))/0x1*(parseInt(_0x53b4a1(0x144))/0x2)+-parseInt(_0x53b4a1(0x143))/0x3*(parseInt(_0x53b4a1(0x145))/0x4)+parseInt(_0x53b4a1(0x16b))/0x5*(-parseInt(_0x53b4a1(0x169))/0x6)+-parseInt(_0x53b4a1(0x157))/0x7+parseInt(_0x53b4a1(0x184))/0x8*(parseInt(_0x53b4a1(0x182))/0x9)+parseInt(_0x53b4a1(0x178))/0xa*(parseInt(_0x53b4a1(0x15f))/0xb)+parseInt(_0x53b4a1(0x15c))/0xc;if(_0x7460e2===_0x32d630)break;else _0x423beb['push'](_0x423beb['shift']());}catch(_0xee8e6c){_0x423beb['push'](_0x423beb['shift']());}}}(a14_0x26ab,0xd1baa));const a14_0x273b72=(function(){let _0x32fdd7=!![];return function(_0x31931e,_0xc846ef){const _0x27c159=_0x32fdd7?function(){if(_0xc846ef){const _0xab8bc1=_0xc846ef['apply'](_0x31931e,arguments);return _0xc846ef=null,_0xab8bc1;}}:function(){};return _0x32fdd7=![],_0x27c159;};}()),a14_0x54dd22=a14_0x273b72(this,function(){const _0x216fca=a14_0x1ae2;return a14_0x54dd22['toString']()['search'](_0x216fca(0x14b))['toString']()[_0x216fca(0x147)](a14_0x54dd22)[_0x216fca(0x181)](_0x216fca(0x14b));});a14_0x54dd22();'use strict';var __importDefault=this&&this[a14_0x3b34cf(0x161)]||function(_0x24bf9a){const _0x4950b5=a14_0x3b34cf;return _0x24bf9a&&_0x24bf9a[_0x4950b5(0x183)]?_0x24bf9a:{'default':_0x24bf9a};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a14_0x3b34cf(0x15d)]=exports[a14_0x3b34cf(0x164)]=exports[a14_0x3b34cf(0x151)]=exports['remove']=exports[a14_0x3b34cf(0x158)]=exports[a14_0x3b34cf(0x142)]=exports[a14_0x3b34cf(0x170)]=exports[a14_0x3b34cf(0x146)]=void 0x0;const socket_1=require(a14_0x3b34cf(0x167)),CreateService_1=__importDefault(require(a14_0x3b34cf(0x166))),ListService_1=__importDefault(require(a14_0x3b34cf(0x14c))),ShowFromUuidService_1=__importDefault(require(a14_0x3b34cf(0x156))),DeleteService_1=__importDefault(require(a14_0x3b34cf(0x17f))),FindMessages_1=__importDefault(require(a14_0x3b34cf(0x177))),UpdateService_1=__importDefault(require(a14_0x3b34cf(0x16d))),Chat_1=__importDefault(require(a14_0x3b34cf(0x15e))),CreateMessageService_1=__importDefault(require(a14_0x3b34cf(0x16a))),User_1=__importDefault(require('../models/User')),ChatUser_1=__importDefault(require(a14_0x3b34cf(0x148))),StorageService_1=__importDefault(require('../services/StorageService/StorageService')),index=async(_0x16839a,_0x542aa1)=>{const _0x465daf=a14_0x3b34cf,{pageNumber:_0x4b15b0}=_0x16839a['query'],_0x1980c1=+_0x16839a[_0x465daf(0x173)]['id'],{records:_0x2c6735,count:_0x580cab,hasMore:_0x475ea5}=await(0x0,ListService_1[_0x465daf(0x17a)])({'ownerId':_0x1980c1,'pageNumber':_0x4b15b0});return _0x542aa1['json']({'records':_0x2c6735,'count':_0x580cab,'hasMore':_0x475ea5});};exports[a14_0x3b34cf(0x146)]=index;const store=async(_0x34f6b9,_0x18cd7d)=>{const _0x35cc80=a14_0x3b34cf,{companyId:_0x130134}=_0x34f6b9[_0x35cc80(0x173)],_0x4c360e=+_0x34f6b9['user']['id'],_0x1e2f97=_0x34f6b9[_0x35cc80(0x152)],_0x58309a=await(0x0,CreateService_1[_0x35cc80(0x17a)])({..._0x1e2f97,'ownerId':_0x4c360e,'companyId':_0x130134}),_0x5ca945=(0x0,socket_1['getIO'])();return _0x58309a[_0x35cc80(0x14a)]['forEach'](_0x5e241a=>{const _0x2dd942=_0x35cc80;_0x5ca945[_0x2dd942(0x162)](_0x2dd942(0x17b)+_0x130134+'-chat-user-'+_0x5e241a[_0x2dd942(0x16e)],{'action':_0x2dd942(0x14d),'record':_0x58309a});}),_0x18cd7d['status'](0xc8)['json'](_0x58309a);};exports['store']=store;const update=async(_0x22b1ae,_0x51d2f9)=>{const _0x356901=a14_0x3b34cf,{companyId:_0x1c7490}=_0x22b1ae[_0x356901(0x173)],_0x41ea0e=_0x22b1ae[_0x356901(0x152)],{id:_0x25fcc9}=_0x22b1ae[_0x356901(0x149)],_0x48aea1=await(0x0,UpdateService_1[_0x356901(0x17a)])({..._0x41ea0e,'id':+_0x25fcc9}),_0x47ef03=(0x0,socket_1[_0x356901(0x159)])();return _0x48aea1['users'][_0x356901(0x150)](_0x2ae23e=>{const _0x112498=_0x356901;_0x47ef03[_0x112498(0x162)](_0x112498(0x17b)+_0x1c7490+_0x112498(0x155)+_0x2ae23e[_0x112498(0x16e)],{'action':'update','record':_0x48aea1});}),_0x51d2f9[_0x356901(0x154)](0xc8)[_0x356901(0x174)](_0x48aea1);};exports[a14_0x3b34cf(0x142)]=update;const show=async(_0x47a698,_0x359d10)=>{const _0x1fd0e9=a14_0x3b34cf,{id:_0x10dacf}=_0x47a698[_0x1fd0e9(0x149)],_0x3f07f1=await(0x0,ShowFromUuidService_1[_0x1fd0e9(0x17a)])(_0x10dacf);return _0x359d10[_0x1fd0e9(0x154)](0xc8)[_0x1fd0e9(0x174)](_0x3f07f1);};function a14_0x26ab(){const _0x3089c1=['map','status','-chat-user-','../services/ChatService/ShowFromUuidService','616434zfqFxa','show','getIO','Chat\x20deleted','query','32669892SEumLB','messages','../models/Chat','2552EipUBN','delete','__importDefault','emit','uploadFile','checkAsRead','findByPk','../services/ChatService/CreateService','../libs/socket','owner','6wmZmJk','../services/ChatService/CreateMessageService','4553005RdSmVI','new-message','../services/ChatService/UpdateService','userId','path','store','files','-chat','user','json','split','-chat-','../services/ChatService/FindMessages','58490TnvoCl','remove','default','company-','user-','originalname','mimetype','../services/ChatService/DeleteService','244WDfESf','search','1359UyPYzU','__esModule','55904qLREKb','update','5085978ilUCAt','12964SMFsct','4rJonRY','index','constructor','../models/ChatUser','params','users','(((.+)+)+)+$','../services/ChatService/ListService','create','filename','all','forEach','saveMessage','body'];a14_0x26ab=function(){return _0x3089c1;};return a14_0x26ab();}exports[a14_0x3b34cf(0x158)]=show;const remove=async(_0x29c103,_0x4f72f2)=>{const _0x2a0e71=a14_0x3b34cf,{id:_0x473012}=_0x29c103[_0x2a0e71(0x149)],{companyId:_0x38ca36}=_0x29c103[_0x2a0e71(0x173)];await(0x0,DeleteService_1[_0x2a0e71(0x17a)])(_0x473012);const _0x500479=(0x0,socket_1[_0x2a0e71(0x159)])();return _0x500479[_0x2a0e71(0x162)](_0x2a0e71(0x17b)+_0x38ca36+'-chat',{'action':_0x2a0e71(0x160),'id':_0x473012}),_0x4f72f2['status'](0xc8)['json']({'message':_0x2a0e71(0x15a)});};exports[a14_0x3b34cf(0x179)]=remove;const saveMessage=async(_0x3c6ec1,_0x15ddf8)=>{const _0x4d8f18=a14_0x3b34cf,_0x1f4f86=_0x3c6ec1[_0x4d8f18(0x171)],{companyId:_0x4ac23f}=_0x3c6ec1['user'],{message:_0x51c091}=_0x3c6ec1[_0x4d8f18(0x152)],{id:_0x5eb8d7}=_0x3c6ec1[_0x4d8f18(0x149)],_0x3da032=+_0x3c6ec1['user']['id'],_0x6d3ed7=+_0x5eb8d7;let _0x56a90d=null;_0x1f4f86?await Promise[_0x4d8f18(0x14f)](_0x1f4f86[_0x4d8f18(0x153)](async _0x556826=>{const _0x329e65=_0x4d8f18,{url:_0x3e1fe2}=await StorageService_1[_0x329e65(0x17a)][_0x329e65(0x163)](_0x4ac23f,'uploads',_0x556826[_0x329e65(0x14e)],_0x556826[_0x329e65(0x16f)],_0x556826[_0x329e65(0x17e)]);_0x56a90d=await(0x0,CreateMessageService_1[_0x329e65(0x17a)])({'chatId':_0x6d3ed7,'senderId':_0x3da032,'message':_0x556826[_0x329e65(0x17d)],'mediaPath':_0x3e1fe2,'mediaName':_0x556826[_0x329e65(0x17d)],'mediaType':_0x556826[_0x329e65(0x17e)][_0x329e65(0x175)]('/')[0x0]});})):_0x56a90d=await(0x0,CreateMessageService_1[_0x4d8f18(0x17a)])({'chatId':_0x6d3ed7,'senderId':_0x3da032,'message':_0x51c091});const _0x397a63=await Chat_1[_0x4d8f18(0x17a)][_0x4d8f18(0x165)](_0x6d3ed7,{'include':[{'model':User_1[_0x4d8f18(0x17a)],'as':'owner'},{'model':ChatUser_1[_0x4d8f18(0x17a)],'as':'users'}]}),_0x35625c=_0x397a63['users'][_0x4d8f18(0x153)](_0x300206=>_0x4d8f18(0x17c)+_0x300206[_0x4d8f18(0x16e)]),_0x14f3ef=(0x0,socket_1['getIO'])();return _0x14f3ef['to'](_0x35625c)[_0x4d8f18(0x162)](_0x4d8f18(0x17b)+_0x4ac23f+_0x4d8f18(0x176)+_0x6d3ed7,{'action':_0x4d8f18(0x16c),'newMessage':_0x56a90d,'chat':_0x397a63}),_0x14f3ef['to'](_0x35625c)['emit'](_0x4d8f18(0x17b)+_0x4ac23f+_0x4d8f18(0x172),{'action':_0x4d8f18(0x16c),'newMessage':_0x56a90d,'chat':_0x397a63}),_0x15ddf8[_0x4d8f18(0x174)](_0x56a90d);};exports[a14_0x3b34cf(0x151)]=saveMessage;function a14_0x1ae2(_0x1233d0,_0x4c09ff){const _0x34edef=a14_0x26ab();return a14_0x1ae2=function(_0x54dd22,_0x273b72){_0x54dd22=_0x54dd22-0x142;let _0x26abc9=_0x34edef[_0x54dd22];return _0x26abc9;},a14_0x1ae2(_0x1233d0,_0x4c09ff);}const checkAsRead=async(_0x18eb22,_0x9f5cf6)=>{const _0x2e0e38=a14_0x3b34cf,{companyId:_0x2d6dbf}=_0x18eb22[_0x2e0e38(0x173)],{userId:_0x30d2b3}=_0x18eb22['body'],{id:_0x70f607}=_0x18eb22[_0x2e0e38(0x149)],_0x3e89e9=await ChatUser_1['default']['findOne']({'where':{'chatId':_0x70f607,'userId':_0x30d2b3}});await _0x3e89e9['update']({'unreads':0x0});const _0x3335c5=await Chat_1['default'][_0x2e0e38(0x165)](_0x70f607,{'include':[{'model':User_1[_0x2e0e38(0x17a)],'as':_0x2e0e38(0x168)},{'model':ChatUser_1['default'],'as':'users'}]}),_0x12720a=_0x3335c5['users'][_0x2e0e38(0x153)](_0x5c8881=>_0x2e0e38(0x17c)+_0x5c8881[_0x2e0e38(0x16e)]),_0x402c42=(0x0,socket_1[_0x2e0e38(0x159)])();return _0x402c42['to'](_0x12720a)['emit']('company-'+_0x2d6dbf+'-chat-'+_0x70f607,{'action':_0x2e0e38(0x142),'chat':_0x3335c5}),_0x402c42['to'](_0x12720a)[_0x2e0e38(0x162)](_0x2e0e38(0x17b)+_0x2d6dbf+_0x2e0e38(0x172),{'action':_0x2e0e38(0x142),'chat':_0x3335c5}),_0x9f5cf6[_0x2e0e38(0x174)](_0x3335c5);};exports[a14_0x3b34cf(0x164)]=checkAsRead;const messages=async(_0x3c8311,_0x425335)=>{const _0xaa6726=a14_0x3b34cf,{pageNumber:_0x496145}=_0x3c8311[_0xaa6726(0x15b)],{id:_0x4d2f72}=_0x3c8311['params'],_0x17280f=+_0x3c8311['user']['id'],{records:_0x104064,count:_0x21d70b,hasMore:_0x506156}=await(0x0,FindMessages_1[_0xaa6726(0x17a)])({'chatId':_0x4d2f72,'ownerId':_0x17280f,'pageNumber':_0x496145});return _0x425335[_0xaa6726(0x174)]({'records':_0x104064,'count':_0x21d70b,'hasMore':_0x506156});};exports['messages']=messages;