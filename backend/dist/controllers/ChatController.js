const a12_0xc36269=a12_0x1a3e;(function(_0x5bf1ae,_0x3d1227){const _0x2440d9=a12_0x1a3e,_0x292b51=_0x5bf1ae();while(!![]){try{const _0x325fc9=-parseInt(_0x2440d9(0xdf))/0x1+parseInt(_0x2440d9(0xc1))/0x2+parseInt(_0x2440d9(0xbc))/0x3+parseInt(_0x2440d9(0xde))/0x4*(parseInt(_0x2440d9(0xcd))/0x5)+-parseInt(_0x2440d9(0xe1))/0x6*(-parseInt(_0x2440d9(0xc0))/0x7)+-parseInt(_0x2440d9(0xe4))/0x8+-parseInt(_0x2440d9(0xc4))/0x9;if(_0x325fc9===_0x3d1227)break;else _0x292b51['push'](_0x292b51['shift']());}catch(_0x7a8e07){_0x292b51['push'](_0x292b51['shift']());}}}(a12_0x4148,0x91bc8));const a12_0x19e82e=(function(){let _0x37f6d3=!![];return function(_0x3cdd9c,_0x44f9cb){const _0x2404b1=_0x37f6d3?function(){const _0x24af50=a12_0x1a3e;if(_0x44f9cb){const _0xbc44ee=_0x44f9cb[_0x24af50(0xea)](_0x3cdd9c,arguments);return _0x44f9cb=null,_0xbc44ee;}}:function(){};return _0x37f6d3=![],_0x2404b1;};}()),a12_0x3a3487=a12_0x19e82e(this,function(){const _0x218951=a12_0x1a3e;return a12_0x3a3487[_0x218951(0xe6)]()[_0x218951(0xd0)](_0x218951(0xda))['toString']()[_0x218951(0xdc)](a12_0x3a3487)[_0x218951(0xd0)](_0x218951(0xda));});function a12_0x4148(){const _0x455ce2=['users','index','10hFfhtV','-chat-','update','search','remove','status','getIO','new-message','__esModule','owner','saveMessage','show','params','(((.+)+)+)+$','Chat\x20deleted','constructor','../services/ChatService/DeleteService','58196STpQQc','739962SfKtPX','checkAsRead','384yYTTpS','../services/ChatService/ShowFromUuidService','messages','3697416LTPvLQ','../models/ChatUser','toString','forEach','../services/ChatService/CreateMessageService','default','apply','delete','body','store','company-','query','-chat-user-','emit','2877444QZlBVM','userId','user','json','50897nsqlei','2002366tROQPg','-chat','findByPk','5901282VjaRwe','../libs/socket','-mainchannel','findOne','../services/ChatService/CreateService','../services/ChatService/UpdateService','../models/User'];a12_0x4148=function(){return _0x455ce2;};return a12_0x4148();}a12_0x3a3487();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3e6d98){return _0x3e6d98&&_0x3e6d98['__esModule']?_0x3e6d98:{'default':_0x3e6d98};};Object['defineProperty'](exports,a12_0xc36269(0xd5),{'value':!![]}),exports[a12_0xc36269(0xe3)]=exports[a12_0xc36269(0xe0)]=exports[a12_0xc36269(0xd7)]=exports['remove']=exports[a12_0xc36269(0xd8)]=exports[a12_0xc36269(0xcf)]=exports[a12_0xc36269(0xed)]=exports[a12_0xc36269(0xcc)]=void 0x0;function a12_0x1a3e(_0x5bb609,_0x10f3bf){const _0x41eb07=a12_0x4148();return a12_0x1a3e=function(_0x3a3487,_0x19e82e){_0x3a3487=_0x3a3487-0xbb;let _0x41487a=_0x41eb07[_0x3a3487];return _0x41487a;},a12_0x1a3e(_0x5bb609,_0x10f3bf);}const socket_1=require(a12_0xc36269(0xc5)),CreateService_1=__importDefault(require(a12_0xc36269(0xc8))),ListService_1=__importDefault(require('../services/ChatService/ListService')),ShowFromUuidService_1=__importDefault(require(a12_0xc36269(0xe2))),DeleteService_1=__importDefault(require(a12_0xc36269(0xdd))),FindMessages_1=__importDefault(require('../services/ChatService/FindMessages')),UpdateService_1=__importDefault(require(a12_0xc36269(0xc9))),Chat_1=__importDefault(require('../models/Chat')),CreateMessageService_1=__importDefault(require(a12_0xc36269(0xe8))),User_1=__importDefault(require(a12_0xc36269(0xca))),ChatUser_1=__importDefault(require(a12_0xc36269(0xe5))),index=async(_0x58c2f9,_0x313b28)=>{const _0x3660ce=a12_0xc36269,{pageNumber:_0x93ff43}=_0x58c2f9[_0x3660ce(0xef)],_0x4fda57=+_0x58c2f9['user']['id'],{records:_0x71fd64,count:_0x5e65c9,hasMore:_0x13c434}=await(0x0,ListService_1[_0x3660ce(0xe9)])({'ownerId':_0x4fda57,'pageNumber':_0x93ff43});return _0x313b28['json']({'records':_0x71fd64,'count':_0x5e65c9,'hasMore':_0x13c434});};exports[a12_0xc36269(0xcc)]=index;const store=async(_0x2eb943,_0xc6fa8)=>{const _0x14af89=a12_0xc36269,{companyId:_0x253037}=_0x2eb943['user'],_0x3e5d46=+_0x2eb943[_0x14af89(0xbe)]['id'],_0x17e67a=_0x2eb943[_0x14af89(0xec)],_0x4d5d5b=await(0x0,CreateService_1[_0x14af89(0xe9)])({..._0x17e67a,'ownerId':_0x3e5d46,'companyId':_0x253037}),_0x7d404=(0x0,socket_1[_0x14af89(0xd3)])();return _0x4d5d5b[_0x14af89(0xcb)][_0x14af89(0xe7)](_0x6d30cf=>{const _0x5af08e=_0x14af89;_0x7d404['to']('company-'+_0x253037+_0x5af08e(0xc6))[_0x5af08e(0xbb)](_0x5af08e(0xee)+_0x253037+_0x5af08e(0xf0)+_0x6d30cf[_0x5af08e(0xbd)],{'action':'create','record':_0x4d5d5b});}),_0xc6fa8[_0x14af89(0xd2)](0xc8)[_0x14af89(0xbf)](_0x4d5d5b);};exports[a12_0xc36269(0xed)]=store;const update=async(_0x26e5f1,_0x4459d9)=>{const _0x376d64=a12_0xc36269,{companyId:_0x47f49e}=_0x26e5f1['user'],_0x4b9ace=_0x26e5f1[_0x376d64(0xec)],{id:_0x3579a2}=_0x26e5f1[_0x376d64(0xd9)],_0x1a7a6e=await(0x0,UpdateService_1['default'])({..._0x4b9ace,'id':+_0x3579a2}),_0x52ecc2=(0x0,socket_1['getIO'])();return _0x1a7a6e[_0x376d64(0xcb)]['forEach'](_0x3f4742=>{const _0x7cd5ed=_0x376d64;_0x52ecc2['to'](_0x7cd5ed(0xee)+_0x47f49e+'-mainchannel')[_0x7cd5ed(0xbb)](_0x7cd5ed(0xee)+_0x47f49e+_0x7cd5ed(0xf0)+_0x3f4742['userId'],{'action':_0x7cd5ed(0xcf),'record':_0x1a7a6e});}),_0x4459d9[_0x376d64(0xd2)](0xc8)['json'](_0x1a7a6e);};exports[a12_0xc36269(0xcf)]=update;const show=async(_0x54bdb1,_0x36b2b4)=>{const _0x2aa94b=a12_0xc36269,{id:_0x105a15}=_0x54bdb1['params'],_0x52cbc1=await(0x0,ShowFromUuidService_1[_0x2aa94b(0xe9)])(_0x105a15);return _0x36b2b4[_0x2aa94b(0xd2)](0xc8)[_0x2aa94b(0xbf)](_0x52cbc1);};exports['show']=show;const remove=async(_0x2d2644,_0x3631cf)=>{const _0x4f0064=a12_0xc36269,{id:_0x379598}=_0x2d2644[_0x4f0064(0xd9)],{companyId:_0x4c9e5d}=_0x2d2644[_0x4f0064(0xbe)];await(0x0,DeleteService_1['default'])(_0x379598);const _0x428925=(0x0,socket_1['getIO'])();return _0x428925['to'](_0x4f0064(0xee)+_0x4c9e5d+_0x4f0064(0xc6))[_0x4f0064(0xbb)](_0x4f0064(0xee)+_0x4c9e5d+_0x4f0064(0xc2),{'action':_0x4f0064(0xeb),'id':_0x379598}),_0x3631cf[_0x4f0064(0xd2)](0xc8)['json']({'message':_0x4f0064(0xdb)});};exports[a12_0xc36269(0xd1)]=remove;const saveMessage=async(_0x12320c,_0x474a66)=>{const _0xea91ea=a12_0xc36269,{companyId:_0x1bc237}=_0x12320c[_0xea91ea(0xbe)],{message:_0x4034b9}=_0x12320c[_0xea91ea(0xec)],{id:_0x5233fb}=_0x12320c[_0xea91ea(0xd9)],_0x21e07d=+_0x12320c[_0xea91ea(0xbe)]['id'],_0x465691=+_0x5233fb,_0x20ecfa=await(0x0,CreateMessageService_1[_0xea91ea(0xe9)])({'chatId':_0x465691,'senderId':_0x21e07d,'message':_0x4034b9}),_0x3e4cdd=await Chat_1['default'][_0xea91ea(0xc3)](_0x465691,{'include':[{'model':User_1[_0xea91ea(0xe9)],'as':_0xea91ea(0xd6)},{'model':ChatUser_1[_0xea91ea(0xe9)],'as':_0xea91ea(0xcb)}]}),_0x2561e3=(0x0,socket_1[_0xea91ea(0xd3)])();return _0x2561e3['to']('company-'+_0x1bc237+'-mainchannel')[_0xea91ea(0xbb)](_0xea91ea(0xee)+_0x1bc237+_0xea91ea(0xce)+_0x465691,{'action':_0xea91ea(0xd4),'newMessage':_0x20ecfa,'chat':_0x3e4cdd}),_0x2561e3['to']('company-'+_0x1bc237+_0xea91ea(0xc6))['emit'](_0xea91ea(0xee)+_0x1bc237+_0xea91ea(0xc2),{'action':_0xea91ea(0xd4),'newMessage':_0x20ecfa,'chat':_0x3e4cdd}),_0x474a66[_0xea91ea(0xbf)](_0x20ecfa);};exports[a12_0xc36269(0xd7)]=saveMessage;const checkAsRead=async(_0x1cccc2,_0x410043)=>{const _0x2dfd51=a12_0xc36269,{companyId:_0xf99b8b}=_0x1cccc2[_0x2dfd51(0xbe)],{userId:_0x269b67}=_0x1cccc2['body'],{id:_0x4e5495}=_0x1cccc2[_0x2dfd51(0xd9)],_0x5c7dda=await ChatUser_1[_0x2dfd51(0xe9)][_0x2dfd51(0xc7)]({'where':{'chatId':_0x4e5495,'userId':_0x269b67}});await _0x5c7dda[_0x2dfd51(0xcf)]({'unreads':0x0});const _0xab9799=await Chat_1[_0x2dfd51(0xe9)]['findByPk'](_0x4e5495,{'include':[{'model':User_1[_0x2dfd51(0xe9)],'as':'owner'},{'model':ChatUser_1[_0x2dfd51(0xe9)],'as':_0x2dfd51(0xcb)}]}),_0x54a7d9=(0x0,socket_1['getIO'])();return _0x54a7d9['to'](_0x2dfd51(0xee)+_0xf99b8b+'-mainchannel')[_0x2dfd51(0xbb)](_0x2dfd51(0xee)+_0xf99b8b+_0x2dfd51(0xce)+_0x4e5495,{'action':'update','chat':_0xab9799}),_0x54a7d9['to'](_0x2dfd51(0xee)+_0xf99b8b+_0x2dfd51(0xc6))[_0x2dfd51(0xbb)]('company-'+_0xf99b8b+'-chat',{'action':'update','chat':_0xab9799}),_0x410043['json'](_0xab9799);};exports[a12_0xc36269(0xe0)]=checkAsRead;const messages=async(_0x2b7cb8,_0x321898)=>{const _0x567462=a12_0xc36269,{pageNumber:_0x5294ca}=_0x2b7cb8['query'],{id:_0x10e918}=_0x2b7cb8['params'],_0x26473c=+_0x2b7cb8[_0x567462(0xbe)]['id'],{records:_0x317cc3,count:_0xe0f26d,hasMore:_0x2a4ec2}=await(0x0,FindMessages_1[_0x567462(0xe9)])({'chatId':_0x10e918,'ownerId':_0x26473c,'pageNumber':_0x5294ca});return _0x321898[_0x567462(0xbf)]({'records':_0x317cc3,'count':_0xe0f26d,'hasMore':_0x2a4ec2});};exports['messages']=messages;