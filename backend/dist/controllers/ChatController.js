const a11_0x26cdcb=a11_0x3d8f;(function(_0x5e69db,_0x16c739){const _0x334687=a11_0x3d8f,_0x302ac5=_0x5e69db();while(!![]){try{const _0x12e49a=parseInt(_0x334687(0x129))/0x1*(-parseInt(_0x334687(0x135))/0x2)+parseInt(_0x334687(0x133))/0x3+-parseInt(_0x334687(0x136))/0x4+-parseInt(_0x334687(0x149))/0x5+-parseInt(_0x334687(0x150))/0x6+-parseInt(_0x334687(0x14b))/0x7*(-parseInt(_0x334687(0x15d))/0x8)+parseInt(_0x334687(0x144))/0x9;if(_0x12e49a===_0x16c739)break;else _0x302ac5['push'](_0x302ac5['shift']());}catch(_0x5969b0){_0x302ac5['push'](_0x302ac5['shift']());}}}(a11_0x3ede,0x48687));const a11_0x2b3b4a=(function(){let _0x5acaad=!![];return function(_0x11bc0f,_0x3c4b49){const _0x4f6d61=_0x5acaad?function(){const _0x16c47e=a11_0x3d8f;if(_0x3c4b49){const _0x1e12b1=_0x3c4b49[_0x16c47e(0x13c)](_0x11bc0f,arguments);return _0x3c4b49=null,_0x1e12b1;}}:function(){};return _0x5acaad=![],_0x4f6d61;};}()),a11_0x37d457=a11_0x2b3b4a(this,function(){const _0x58e46b=a11_0x3d8f;return a11_0x37d457['toString']()['search'](_0x58e46b(0x137))[_0x58e46b(0x122)]()['constructor'](a11_0x37d457)['search'](_0x58e46b(0x137));});a11_0x37d457();'use strict';var __importDefault=this&&this[a11_0x26cdcb(0x12b)]||function(_0x11b53e){return _0x11b53e&&_0x11b53e['__esModule']?_0x11b53e:{'default':_0x11b53e};};Object[a11_0x26cdcb(0x12e)](exports,a11_0x26cdcb(0x14c),{'value':!![]}),exports[a11_0x26cdcb(0x132)]=exports['checkAsRead']=exports[a11_0x26cdcb(0x141)]=exports['remove']=exports[a11_0x26cdcb(0x143)]=exports[a11_0x26cdcb(0x139)]=exports[a11_0x26cdcb(0x151)]=exports['index']=void 0x0;function a11_0x3d8f(_0x535c62,_0x514b0d){const _0x4351fd=a11_0x3ede();return a11_0x3d8f=function(_0x37d457,_0x2b3b4a){_0x37d457=_0x37d457-0x122;let _0x3ede2a=_0x4351fd[_0x37d457];return _0x3ede2a;},a11_0x3d8f(_0x535c62,_0x514b0d);}const socket_1=require(a11_0x26cdcb(0x126)),CreateService_1=__importDefault(require(a11_0x26cdcb(0x131))),ListService_1=__importDefault(require(a11_0x26cdcb(0x146))),ShowFromUuidService_1=__importDefault(require(a11_0x26cdcb(0x14f))),DeleteService_1=__importDefault(require(a11_0x26cdcb(0x138))),FindMessages_1=__importDefault(require(a11_0x26cdcb(0x142))),UpdateService_1=__importDefault(require(a11_0x26cdcb(0x130))),Chat_1=__importDefault(require(a11_0x26cdcb(0x13f))),CreateMessageService_1=__importDefault(require(a11_0x26cdcb(0x157))),User_1=__importDefault(require(a11_0x26cdcb(0x148))),ChatUser_1=__importDefault(require('../models/ChatUser')),index=async(_0x2012dd,_0x220623)=>{const _0xa0e533=a11_0x26cdcb,{pageNumber:_0x40956a}=_0x2012dd[_0xa0e533(0x14a)],_0x3e0d12=+_0x2012dd[_0xa0e533(0x147)]['id'],{records:_0x341d8b,count:_0x492a09,hasMore:_0x292306}=await(0x0,ListService_1[_0xa0e533(0x12c)])({'ownerId':_0x3e0d12,'pageNumber':_0x40956a});return _0x220623[_0xa0e533(0x14d)]({'records':_0x341d8b,'count':_0x492a09,'hasMore':_0x292306});};exports['index']=index;const store=async(_0x5f0ade,_0xbac93a)=>{const _0x1a9395=a11_0x26cdcb,{companyId:_0x46081b}=_0x5f0ade['user'],_0x17bff8=+_0x5f0ade['user']['id'],_0x5743fa=_0x5f0ade[_0x1a9395(0x15b)],_0x5581da=await(0x0,CreateService_1[_0x1a9395(0x12c)])({..._0x5743fa,'ownerId':_0x17bff8,'companyId':_0x46081b}),_0x21d29f=(0x0,socket_1[_0x1a9395(0x13d)])();return _0x5581da[_0x1a9395(0x152)]['forEach'](_0xfbf572=>{const _0x43dcb7=_0x1a9395;_0x21d29f[_0x43dcb7(0x12f)](_0x43dcb7(0x12d)+_0x46081b+_0x43dcb7(0x153)+_0xfbf572[_0x43dcb7(0x123)],{'action':_0x43dcb7(0x15c),'record':_0x5581da});}),_0xbac93a[_0x1a9395(0x12a)](0xc8)[_0x1a9395(0x14d)](_0x5581da);};exports[a11_0x26cdcb(0x151)]=store;const update=async(_0x26ec66,_0x5ab7bd)=>{const _0x334ea8=a11_0x26cdcb,{companyId:_0x100245}=_0x26ec66[_0x334ea8(0x147)],_0x24bc93=_0x26ec66[_0x334ea8(0x15b)],{id:_0x2e2f3a}=_0x26ec66[_0x334ea8(0x125)],_0x3b157d=await(0x0,UpdateService_1['default'])({..._0x24bc93,'id':+_0x2e2f3a}),_0x29ab6d=(0x0,socket_1['getIO'])();return _0x3b157d[_0x334ea8(0x152)][_0x334ea8(0x158)](_0x3b3735=>{const _0x38ee20=_0x334ea8;_0x29ab6d['emit']('company-'+_0x100245+_0x38ee20(0x153)+_0x3b3735[_0x38ee20(0x123)],{'action':'update','record':_0x3b157d});}),_0x5ab7bd['status'](0xc8)[_0x334ea8(0x14d)](_0x3b157d);};exports['update']=update;const show=async(_0x3a1c55,_0x2871d0)=>{const _0x2d6ffa=a11_0x26cdcb,{id:_0x654944}=_0x3a1c55[_0x2d6ffa(0x125)],_0x4e9a5b=await(0x0,ShowFromUuidService_1[_0x2d6ffa(0x12c)])(_0x654944);return _0x2871d0['status'](0xc8)['json'](_0x4e9a5b);};exports['show']=show;const remove=async(_0x28d207,_0x4f0d38)=>{const _0xf10ca9=a11_0x26cdcb,{id:_0x20cf39}=_0x28d207[_0xf10ca9(0x125)],{companyId:_0x39850c}=_0x28d207[_0xf10ca9(0x147)];await(0x0,DeleteService_1[_0xf10ca9(0x12c)])(_0x20cf39);const _0x727dae=(0x0,socket_1[_0xf10ca9(0x13d)])();return _0x727dae['emit'](_0xf10ca9(0x12d)+_0x39850c+'-chat',{'action':_0xf10ca9(0x140),'id':_0x20cf39}),_0x4f0d38[_0xf10ca9(0x12a)](0xc8)[_0xf10ca9(0x14d)]({'message':'Chat\x20deleted'});};exports[a11_0x26cdcb(0x159)]=remove;const saveMessage=async(_0x3904c9,_0x2d000a)=>{const _0x502c97=a11_0x26cdcb,_0x2a57c9=_0x3904c9['files'],{companyId:_0x108978}=_0x3904c9['user'],{message:_0xdd7f77}=_0x3904c9[_0x502c97(0x15b)],{id:_0x2f07d2}=_0x3904c9[_0x502c97(0x125)],_0x423cd0=+_0x3904c9[_0x502c97(0x147)]['id'],_0x25bef5=+_0x2f07d2;let _0x3b3bdf=null;_0x2a57c9?await Promise[_0x502c97(0x13b)](_0x2a57c9[_0x502c97(0x14e)](async _0x3e42a5=>{const _0x1609bc=_0x502c97;_0x3b3bdf=await(0x0,CreateMessageService_1[_0x1609bc(0x12c)])({'chatId':_0x25bef5,'senderId':_0x423cd0,'message':_0x3e42a5[_0x1609bc(0x13a)],'mediaPath':_0x3e42a5[_0x1609bc(0x13e)],'mediaName':_0x3e42a5[_0x1609bc(0x13a)],'mediaType':_0x3e42a5[_0x1609bc(0x127)][_0x1609bc(0x145)]('/')[0x0]});})):_0x3b3bdf=await(0x0,CreateMessageService_1[_0x502c97(0x12c)])({'chatId':_0x25bef5,'senderId':_0x423cd0,'message':_0xdd7f77});const _0x163c92=await Chat_1['default'][_0x502c97(0x134)](_0x25bef5,{'include':[{'model':User_1[_0x502c97(0x12c)],'as':_0x502c97(0x15a)},{'model':ChatUser_1[_0x502c97(0x12c)],'as':'users'}]}),_0x4fa3f0=_0x163c92[_0x502c97(0x152)][_0x502c97(0x14e)](_0x4e7bc6=>_0x502c97(0x124)+_0x4e7bc6[_0x502c97(0x123)]),_0xa54b6=(0x0,socket_1['getIO'])();return _0xa54b6['to'](_0x4fa3f0)[_0x502c97(0x12f)](_0x502c97(0x12d)+_0x108978+_0x502c97(0x155)+_0x25bef5,{'action':_0x502c97(0x128),'newMessage':_0x3b3bdf,'chat':_0x163c92}),_0xa54b6['to'](_0x4fa3f0)[_0x502c97(0x12f)](_0x502c97(0x12d)+_0x108978+_0x502c97(0x156),{'action':_0x502c97(0x128),'newMessage':_0x3b3bdf,'chat':_0x163c92}),_0x2d000a['json'](_0x3b3bdf);};exports[a11_0x26cdcb(0x141)]=saveMessage;const checkAsRead=async(_0x2ce157,_0x4e24b8)=>{const _0x89ae82=a11_0x26cdcb,{companyId:_0x5ef546}=_0x2ce157[_0x89ae82(0x147)],{userId:_0xfac56}=_0x2ce157[_0x89ae82(0x15b)],{id:_0x55670b}=_0x2ce157[_0x89ae82(0x125)],_0x1a2f86=await ChatUser_1[_0x89ae82(0x12c)]['findOne']({'where':{'chatId':_0x55670b,'userId':_0xfac56}});await _0x1a2f86['update']({'unreads':0x0});const _0x20410b=await Chat_1[_0x89ae82(0x12c)][_0x89ae82(0x134)](_0x55670b,{'include':[{'model':User_1[_0x89ae82(0x12c)],'as':_0x89ae82(0x15a)},{'model':ChatUser_1[_0x89ae82(0x12c)],'as':'users'}]}),_0x4efb54=_0x20410b[_0x89ae82(0x152)][_0x89ae82(0x14e)](_0x2dcd9b=>_0x89ae82(0x124)+_0x2dcd9b[_0x89ae82(0x123)]),_0x62607e=(0x0,socket_1[_0x89ae82(0x13d)])();return _0x62607e['to'](_0x4efb54)[_0x89ae82(0x12f)](_0x89ae82(0x12d)+_0x5ef546+_0x89ae82(0x155)+_0x55670b,{'action':_0x89ae82(0x139),'chat':_0x20410b}),_0x62607e['to'](_0x4efb54)['emit']('company-'+_0x5ef546+_0x89ae82(0x156),{'action':_0x89ae82(0x139),'chat':_0x20410b}),_0x4e24b8[_0x89ae82(0x14d)](_0x20410b);};exports[a11_0x26cdcb(0x154)]=checkAsRead;const messages=async(_0x4972b3,_0x51b62c)=>{const _0x379380=a11_0x26cdcb,{pageNumber:_0x64fd7b}=_0x4972b3[_0x379380(0x14a)],{id:_0xbc25ca}=_0x4972b3[_0x379380(0x125)],_0x4a905c=+_0x4972b3[_0x379380(0x147)]['id'],{records:_0x1f04f5,count:_0x88f1a2,hasMore:_0x1ba6f6}=await(0x0,FindMessages_1[_0x379380(0x12c)])({'chatId':_0xbc25ca,'ownerId':_0x4a905c,'pageNumber':_0x64fd7b});return _0x51b62c['json']({'records':_0x1f04f5,'count':_0x88f1a2,'hasMore':_0x1ba6f6});};function a11_0x3ede(){const _0x2ff79b=['../services/ChatService/CreateMessageService','forEach','remove','owner','body','create','976FQTpxq','toString','userId','user-','params','../libs/socket','mimetype','new-message','29lKVYbK','status','__importDefault','default','company-','defineProperty','emit','../services/ChatService/UpdateService','../services/ChatService/CreateService','messages','542862aEYeIA','findByPk','30238WkmWIm','1387680hRcELu','(((.+)+)+)+$','../services/ChatService/DeleteService','update','originalname','all','apply','getIO','filename','../models/Chat','delete','saveMessage','../services/ChatService/FindMessages','show','9204093hEcwkU','split','../services/ChatService/ListService','user','../models/User','2770240uvKPBx','query','25711KaJskr','__esModule','json','map','../services/ChatService/ShowFromUuidService','94410VuxOYu','store','users','-chat-user-','checkAsRead','-chat-','-chat'];a11_0x3ede=function(){return _0x2ff79b;};return a11_0x3ede();}exports[a11_0x26cdcb(0x132)]=messages;