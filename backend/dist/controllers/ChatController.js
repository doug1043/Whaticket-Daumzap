const a14_0x3525b9=a14_0xb5c6;function a14_0xb5c6(_0x52923d,_0x5c8e8c){const _0x38628e=a14_0x577f();return a14_0xb5c6=function(_0x530220,_0x371940){_0x530220=_0x530220-0xf8;let _0x577f9f=_0x38628e[_0x530220];return _0x577f9f;},a14_0xb5c6(_0x52923d,_0x5c8e8c);}(function(_0x4c6ec8,_0x404243){const _0xfb8974=a14_0xb5c6,_0x185984=_0x4c6ec8();while(!![]){try{const _0x33ac8=-parseInt(_0xfb8974(0x127))/0x1*(parseInt(_0xfb8974(0x105))/0x2)+-parseInt(_0xfb8974(0x12c))/0x3+-parseInt(_0xfb8974(0x107))/0x4*(parseInt(_0xfb8974(0x10c))/0x5)+parseInt(_0xfb8974(0x112))/0x6*(-parseInt(_0xfb8974(0x13a))/0x7)+-parseInt(_0xfb8974(0x122))/0x8+parseInt(_0xfb8974(0x12f))/0x9+-parseInt(_0xfb8974(0x136))/0xa*(-parseInt(_0xfb8974(0xfa))/0xb);if(_0x33ac8===_0x404243)break;else _0x185984['push'](_0x185984['shift']());}catch(_0xa63920){_0x185984['push'](_0x185984['shift']());}}}(a14_0x577f,0xd2585));const a14_0x371940=(function(){let _0x512aa3=!![];return function(_0x2c594e,_0x25769a){const _0x42e566=_0x512aa3?function(){const _0x313e72=a14_0xb5c6;if(_0x25769a){const _0xc22618=_0x25769a[_0x313e72(0x111)](_0x2c594e,arguments);return _0x25769a=null,_0xc22618;}}:function(){};return _0x512aa3=![],_0x42e566;};}()),a14_0x530220=a14_0x371940(this,function(){const _0x4b364d=a14_0xb5c6;return a14_0x530220[_0x4b364d(0x118)]()[_0x4b364d(0x102)](_0x4b364d(0x114))[_0x4b364d(0x118)]()[_0x4b364d(0x119)](a14_0x530220)[_0x4b364d(0x102)](_0x4b364d(0x114));});a14_0x530220();'use strict';var __importDefault=this&&this[a14_0x3525b9(0x103)]||function(_0x45d9ab){const _0x4e485c=a14_0x3525b9;return _0x45d9ab&&_0x45d9ab[_0x4e485c(0x121)]?_0x45d9ab:{'default':_0x45d9ab};};Object[a14_0x3525b9(0xff)](exports,a14_0x3525b9(0x121),{'value':!![]}),exports[a14_0x3525b9(0x10b)]=exports[a14_0x3525b9(0x128)]=exports['saveMessage']=exports['remove']=exports[a14_0x3525b9(0x113)]=exports['update']=exports[a14_0x3525b9(0x12a)]=exports[a14_0x3525b9(0xfc)]=void 0x0;const socket_1=require(a14_0x3525b9(0x117)),CreateService_1=__importDefault(require('../services/ChatService/CreateService')),ListService_1=__importDefault(require(a14_0x3525b9(0x126))),ShowFromUuidService_1=__importDefault(require(a14_0x3525b9(0x138))),DeleteService_1=__importDefault(require(a14_0x3525b9(0x11a))),FindMessages_1=__importDefault(require(a14_0x3525b9(0x12e))),UpdateService_1=__importDefault(require(a14_0x3525b9(0x10f))),Chat_1=__importDefault(require(a14_0x3525b9(0xfd))),CreateMessageService_1=__importDefault(require(a14_0x3525b9(0xfe))),User_1=__importDefault(require(a14_0x3525b9(0xf9))),ChatUser_1=__importDefault(require(a14_0x3525b9(0x10d))),StorageService_1=__importDefault(require(a14_0x3525b9(0x109))),index=async(_0x5491f5,_0x54c617)=>{const _0x48fbc8=a14_0x3525b9,{pageNumber:_0x58572e}=_0x5491f5['query'],_0x3b37c5=+_0x5491f5[_0x48fbc8(0x129)]['id'],{records:_0x3e1b05,count:_0x16aa02,hasMore:_0x2b0fd5}=await(0x0,ListService_1[_0x48fbc8(0x11f)])({'ownerId':_0x3b37c5,'pageNumber':_0x58572e});return _0x54c617[_0x48fbc8(0x101)]({'records':_0x3e1b05,'count':_0x16aa02,'hasMore':_0x2b0fd5});};exports['index']=index;const store=async(_0x2b0478,_0x27e4be)=>{const _0x411079=a14_0x3525b9,{companyId:_0x30bc32}=_0x2b0478[_0x411079(0x129)],_0x570b2a=+_0x2b0478[_0x411079(0x129)]['id'],_0x3f731c=_0x2b0478[_0x411079(0x135)],_0x100f59=await(0x0,CreateService_1[_0x411079(0x11f)])({..._0x3f731c,'ownerId':_0x570b2a,'companyId':_0x30bc32}),_0x3e397d=(0x0,socket_1[_0x411079(0x123)])();return _0x100f59[_0x411079(0x115)]['forEach'](_0x2694dd=>{const _0x2447e7=_0x411079;_0x3e397d[_0x2447e7(0x11b)](_0x2447e7(0x139)+_0x30bc32+_0x2447e7(0xf8)+_0x2694dd[_0x2447e7(0x12b)],{'action':_0x2447e7(0x108),'record':_0x100f59});}),_0x27e4be[_0x411079(0x11e)](0xc8)[_0x411079(0x101)](_0x100f59);};exports[a14_0x3525b9(0x12a)]=store;const update=async(_0x3c49a1,_0x34ca94)=>{const _0x5620c6=a14_0x3525b9,{companyId:_0x39f696}=_0x3c49a1[_0x5620c6(0x129)],_0x43cb6d=_0x3c49a1[_0x5620c6(0x135)],{id:_0x5d1a83}=_0x3c49a1[_0x5620c6(0x125)],_0x4919de=await(0x0,UpdateService_1[_0x5620c6(0x11f)])({..._0x43cb6d,'id':+_0x5d1a83}),_0x4b7f7e=(0x0,socket_1['getIO'])();return _0x4919de[_0x5620c6(0x115)][_0x5620c6(0x106)](_0x202f94=>{const _0x5b0239=_0x5620c6;_0x4b7f7e[_0x5b0239(0x11b)](_0x5b0239(0x139)+_0x39f696+'-chat-user-'+_0x202f94[_0x5b0239(0x12b)],{'action':_0x5b0239(0x10e),'record':_0x4919de});}),_0x34ca94[_0x5620c6(0x11e)](0xc8)[_0x5620c6(0x101)](_0x4919de);};exports[a14_0x3525b9(0x10e)]=update;const show=async(_0x2faaac,_0x2b70a8)=>{const _0x515be1=a14_0x3525b9,{id:_0x281e46}=_0x2faaac[_0x515be1(0x125)],_0x1e7775=await(0x0,ShowFromUuidService_1[_0x515be1(0x11f)])(_0x281e46);return _0x2b70a8[_0x515be1(0x11e)](0xc8)[_0x515be1(0x101)](_0x1e7775);};exports['show']=show;const remove=async(_0x1706c9,_0x1ed3c2)=>{const _0x2bf0ba=a14_0x3525b9,{id:_0x31a0d2}=_0x1706c9[_0x2bf0ba(0x125)],{companyId:_0x9c1049}=_0x1706c9[_0x2bf0ba(0x129)];await(0x0,DeleteService_1['default'])(_0x31a0d2);const _0x4acc22=(0x0,socket_1[_0x2bf0ba(0x123)])();return _0x4acc22[_0x2bf0ba(0x11b)](_0x2bf0ba(0x139)+_0x9c1049+'-chat',{'action':'delete','id':_0x31a0d2}),_0x1ed3c2[_0x2bf0ba(0x11e)](0xc8)[_0x2bf0ba(0x101)]({'message':_0x2bf0ba(0x104)});};exports[a14_0x3525b9(0x12d)]=remove;function a14_0x577f(){const _0x4a8f6c=['-chat-user-','../models/User','39050pWgmFV','new-message','index','../models/Chat','../services/ChatService/CreateMessageService','defineProperty','-chat-','json','search','__importDefault','Chat\x20deleted','2XYpKzc','forEach','28EaKsIb','create','../services/StorageService/StorageService','map','messages','837185KIrgTq','../models/ChatUser','update','../services/ChatService/UpdateService','mimetype','apply','6qCsojc','show','(((.+)+)+)+$','users','all','../libs/socket','toString','constructor','../services/ChatService/DeleteService','emit','filename','user-','status','default','split','__esModule','12240280IdeBBa','getIO','saveMessage','params','../services/ChatService/ListService','1626410miFmvW','checkAsRead','user','store','userId','5090466OjgJPg','remove','../services/ChatService/FindMessages','8746272SUtIJZ','uploadFile','owner','files','-chat','originalname','body','17450Czxpvc','findByPk','../services/ChatService/ShowFromUuidService','company-','1957613ENElaK'];a14_0x577f=function(){return _0x4a8f6c;};return a14_0x577f();}const saveMessage=async(_0x2afba4,_0x59d0d8)=>{const _0x1b44a1=a14_0x3525b9,_0x2366ed=_0x2afba4[_0x1b44a1(0x132)],{companyId:_0x12cc2c}=_0x2afba4[_0x1b44a1(0x129)],{message:_0xf4a183}=_0x2afba4[_0x1b44a1(0x135)],{id:_0x29a6d2}=_0x2afba4[_0x1b44a1(0x125)],_0x4f52be=+_0x2afba4[_0x1b44a1(0x129)]['id'],_0x4101cc=+_0x29a6d2;let _0x4cc409=null;_0x2366ed?await Promise[_0x1b44a1(0x116)](_0x2366ed[_0x1b44a1(0x10a)](async _0x5f5dab=>{const _0x3ca38f=_0x1b44a1,{url:_0x5f539}=await StorageService_1[_0x3ca38f(0x11f)][_0x3ca38f(0x130)](_0x12cc2c,'uploads',_0x5f5dab[_0x3ca38f(0x11c)],_0x5f5dab['path'],_0x5f5dab[_0x3ca38f(0x110)]);_0x4cc409=await(0x0,CreateMessageService_1[_0x3ca38f(0x11f)])({'chatId':_0x4101cc,'senderId':_0x4f52be,'message':_0x5f5dab[_0x3ca38f(0x134)],'mediaPath':_0x5f539,'mediaName':_0x5f5dab[_0x3ca38f(0x134)],'mediaType':_0x5f5dab[_0x3ca38f(0x110)][_0x3ca38f(0x120)]('/')[0x0]});})):_0x4cc409=await(0x0,CreateMessageService_1['default'])({'chatId':_0x4101cc,'senderId':_0x4f52be,'message':_0xf4a183});const _0x185c33=await Chat_1['default'][_0x1b44a1(0x137)](_0x4101cc,{'include':[{'model':User_1[_0x1b44a1(0x11f)],'as':_0x1b44a1(0x131)},{'model':ChatUser_1[_0x1b44a1(0x11f)],'as':_0x1b44a1(0x115)}]}),_0x854ac7=_0x185c33[_0x1b44a1(0x115)]['map'](_0xe0dcb5=>_0x1b44a1(0x11d)+_0xe0dcb5[_0x1b44a1(0x12b)]),_0x44bb05=(0x0,socket_1[_0x1b44a1(0x123)])();return _0x44bb05['to'](_0x854ac7)['emit'](_0x1b44a1(0x139)+_0x12cc2c+_0x1b44a1(0x100)+_0x4101cc,{'action':_0x1b44a1(0xfb),'newMessage':_0x4cc409,'chat':_0x185c33}),_0x44bb05['to'](_0x854ac7)['emit'](_0x1b44a1(0x139)+_0x12cc2c+_0x1b44a1(0x133),{'action':_0x1b44a1(0xfb),'newMessage':_0x4cc409,'chat':_0x185c33}),_0x59d0d8['json'](_0x4cc409);};exports[a14_0x3525b9(0x124)]=saveMessage;const checkAsRead=async(_0x449d3b,_0x3f9167)=>{const _0x5da91f=a14_0x3525b9,{companyId:_0x31b365}=_0x449d3b['user'],{userId:_0x56f58f}=_0x449d3b['body'],{id:_0xf2c26e}=_0x449d3b[_0x5da91f(0x125)],_0x4e3d5a=await ChatUser_1[_0x5da91f(0x11f)]['findOne']({'where':{'chatId':_0xf2c26e,'userId':_0x56f58f}});await _0x4e3d5a[_0x5da91f(0x10e)]({'unreads':0x0});const _0x59395c=await Chat_1[_0x5da91f(0x11f)][_0x5da91f(0x137)](_0xf2c26e,{'include':[{'model':User_1[_0x5da91f(0x11f)],'as':'owner'},{'model':ChatUser_1['default'],'as':_0x5da91f(0x115)}]}),_0x51ae4f=_0x59395c[_0x5da91f(0x115)]['map'](_0x5ce76c=>'user-'+_0x5ce76c[_0x5da91f(0x12b)]),_0x4e5fed=(0x0,socket_1[_0x5da91f(0x123)])();return _0x4e5fed['to'](_0x51ae4f)['emit'](_0x5da91f(0x139)+_0x31b365+_0x5da91f(0x100)+_0xf2c26e,{'action':_0x5da91f(0x10e),'chat':_0x59395c}),_0x4e5fed['to'](_0x51ae4f)[_0x5da91f(0x11b)](_0x5da91f(0x139)+_0x31b365+_0x5da91f(0x133),{'action':'update','chat':_0x59395c}),_0x3f9167[_0x5da91f(0x101)](_0x59395c);};exports[a14_0x3525b9(0x128)]=checkAsRead;const messages=async(_0x9c540b,_0xe0c8de)=>{const _0xb122b7=a14_0x3525b9,{pageNumber:_0xfc909a}=_0x9c540b['query'],{id:_0x2011ba}=_0x9c540b[_0xb122b7(0x125)],_0x20f594=+_0x9c540b[_0xb122b7(0x129)]['id'],{records:_0x51f165,count:_0x2a8887,hasMore:_0xa05b47}=await(0x0,FindMessages_1['default'])({'chatId':_0x2011ba,'ownerId':_0x20f594,'pageNumber':_0xfc909a});return _0xe0c8de[_0xb122b7(0x101)]({'records':_0x51f165,'count':_0x2a8887,'hasMore':_0xa05b47});};exports[a14_0x3525b9(0x10b)]=messages;