const a12_0x29f5a8=a12_0x3100;(function(_0x28da2d,_0x4c0c2e){const _0x3e4caa=a12_0x3100,_0x186e47=_0x28da2d();while(!![]){try{const _0x30790b=-parseInt(_0x3e4caa(0x16c))/0x1+parseInt(_0x3e4caa(0x142))/0x2+-parseInt(_0x3e4caa(0x147))/0x3*(-parseInt(_0x3e4caa(0x144))/0x4)+parseInt(_0x3e4caa(0x160))/0x5*(-parseInt(_0x3e4caa(0x146))/0x6)+-parseInt(_0x3e4caa(0x14f))/0x7*(-parseInt(_0x3e4caa(0x155))/0x8)+-parseInt(_0x3e4caa(0x13e))/0x9+-parseInt(_0x3e4caa(0x156))/0xa*(-parseInt(_0x3e4caa(0x140))/0xb);if(_0x30790b===_0x4c0c2e)break;else _0x186e47['push'](_0x186e47['shift']());}catch(_0x4cc035){_0x186e47['push'](_0x186e47['shift']());}}}(a12_0x3606,0x90eaf));const a12_0x25794c=(function(){let _0x2cd622=!![];return function(_0xcf2544,_0xb3d079){const _0x317fb0=_0x2cd622?function(){const _0x245a14=a12_0x3100;if(_0xb3d079){const _0x5b30f9=_0xb3d079[_0x245a14(0x15c)](_0xcf2544,arguments);return _0xb3d079=null,_0x5b30f9;}}:function(){};return _0x2cd622=![],_0x317fb0;};}()),a12_0x19087e=a12_0x25794c(this,function(){const _0x405632=a12_0x3100;return a12_0x19087e[_0x405632(0x15b)]()[_0x405632(0x153)](_0x405632(0x13d))[_0x405632(0x15b)]()['constructor'](a12_0x19087e)['search'](_0x405632(0x13d));});a12_0x19087e();'use strict';var __importDefault=this&&this[a12_0x29f5a8(0x171)]||function(_0x25261f){const _0x23e258=a12_0x29f5a8;return _0x25261f&&_0x25261f[_0x23e258(0x145)]?_0x25261f:{'default':_0x25261f};};function a12_0x3606(){const _0x526ee4=['../services/ChatService/ListService','index','emit','findByPk','default','query','-mainchannel','../models/User','60152djdUTW','../models/Chat','../libs/socket','saveMessage','messages','__importDefault','defineProperty','status','(((.+)+)+)+$','9604998xgbpOI','../services/ChatService/FindMessages','803EnZzRu','../services/ChatService/CreateMessageService','1455284IOcHpY','update','9244CyhGGz','__esModule','464088gXbySb','1227uDssje','show','-chat-','store','forEach','delete','getIO','-chat-user-','83321SsDppq','-chat','../services/ChatService/ShowFromUuidService','params','search','../services/ChatService/UpdateService','200YNuVja','8210wlZQed','remove','owner','checkAsRead','users','toString','apply','body','company-','user','20saGAgI','json','userId','../models/ChatUser'];a12_0x3606=function(){return _0x526ee4;};return a12_0x3606();}Object[a12_0x29f5a8(0x13b)](exports,a12_0x29f5a8(0x145),{'value':!![]}),exports['messages']=exports[a12_0x29f5a8(0x159)]=exports[a12_0x29f5a8(0x16f)]=exports[a12_0x29f5a8(0x157)]=exports[a12_0x29f5a8(0x148)]=exports[a12_0x29f5a8(0x143)]=exports['store']=exports[a12_0x29f5a8(0x165)]=void 0x0;const socket_1=require(a12_0x29f5a8(0x16e)),CreateService_1=__importDefault(require('../services/ChatService/CreateService')),ListService_1=__importDefault(require(a12_0x29f5a8(0x164))),ShowFromUuidService_1=__importDefault(require(a12_0x29f5a8(0x151))),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require(a12_0x29f5a8(0x13f))),UpdateService_1=__importDefault(require(a12_0x29f5a8(0x154))),Chat_1=__importDefault(require(a12_0x29f5a8(0x16d))),CreateMessageService_1=__importDefault(require(a12_0x29f5a8(0x141))),User_1=__importDefault(require(a12_0x29f5a8(0x16b))),ChatUser_1=__importDefault(require(a12_0x29f5a8(0x163))),index=async(_0x15c6ef,_0x59c403)=>{const _0xdb09fe=a12_0x29f5a8,{pageNumber:_0xffef04}=_0x15c6ef[_0xdb09fe(0x169)],_0x3aebca=+_0x15c6ef[_0xdb09fe(0x15f)]['id'],{records:_0xcc2a5c,count:_0x39d48e,hasMore:_0x531401}=await(0x0,ListService_1[_0xdb09fe(0x168)])({'ownerId':_0x3aebca,'pageNumber':_0xffef04});return _0x59c403[_0xdb09fe(0x161)]({'records':_0xcc2a5c,'count':_0x39d48e,'hasMore':_0x531401});};exports[a12_0x29f5a8(0x165)]=index;const store=async(_0x19e5b5,_0x561260)=>{const _0x18f15f=a12_0x29f5a8,{companyId:_0x12bf32}=_0x19e5b5['user'],_0x1f0461=+_0x19e5b5[_0x18f15f(0x15f)]['id'],_0x420c7d=_0x19e5b5['body'],_0x23034c=await(0x0,CreateService_1[_0x18f15f(0x168)])({..._0x420c7d,'ownerId':_0x1f0461,'companyId':_0x12bf32}),_0x55cae2=(0x0,socket_1[_0x18f15f(0x14d)])();return _0x23034c[_0x18f15f(0x15a)][_0x18f15f(0x14b)](_0x4b78d2=>{const _0x4333a8=_0x18f15f;_0x55cae2['to'](_0x4333a8(0x15e)+_0x12bf32+_0x4333a8(0x16a))['emit'](_0x4333a8(0x15e)+_0x12bf32+_0x4333a8(0x14e)+_0x4b78d2[_0x4333a8(0x162)],{'action':'create','record':_0x23034c});}),_0x561260[_0x18f15f(0x13c)](0xc8)[_0x18f15f(0x161)](_0x23034c);};exports[a12_0x29f5a8(0x14a)]=store;const update=async(_0xb42eb4,_0x462a4e)=>{const _0x47c67a=a12_0x29f5a8,{companyId:_0x4151b0}=_0xb42eb4['user'],_0x566e2e=_0xb42eb4[_0x47c67a(0x15d)],{id:_0x3ceb9d}=_0xb42eb4[_0x47c67a(0x152)],_0x44fa63=await(0x0,UpdateService_1[_0x47c67a(0x168)])({..._0x566e2e,'id':+_0x3ceb9d}),_0x42c111=(0x0,socket_1['getIO'])();return _0x44fa63[_0x47c67a(0x15a)][_0x47c67a(0x14b)](_0x15d4b8=>{const _0x2733b4=_0x47c67a;_0x42c111['to'](_0x2733b4(0x15e)+_0x4151b0+_0x2733b4(0x16a))[_0x2733b4(0x166)]('company-'+_0x4151b0+'-chat-user-'+_0x15d4b8[_0x2733b4(0x162)],{'action':_0x2733b4(0x143),'record':_0x44fa63});}),_0x462a4e[_0x47c67a(0x13c)](0xc8)[_0x47c67a(0x161)](_0x44fa63);};exports[a12_0x29f5a8(0x143)]=update;const show=async(_0x3d1ad5,_0x54ff98)=>{const _0xcca49e=a12_0x29f5a8,{id:_0x1cf439}=_0x3d1ad5['params'],_0x5dc306=await(0x0,ShowFromUuidService_1[_0xcca49e(0x168)])(_0x1cf439);return _0x54ff98[_0xcca49e(0x13c)](0xc8)[_0xcca49e(0x161)](_0x5dc306);};exports[a12_0x29f5a8(0x148)]=show;const remove=async(_0x4528d5,_0x11cb32)=>{const _0x14ebcb=a12_0x29f5a8,{id:_0x507397}=_0x4528d5[_0x14ebcb(0x152)],{companyId:_0x369f8e}=_0x4528d5[_0x14ebcb(0x15f)];await(0x0,DeleteService_1[_0x14ebcb(0x168)])(_0x507397);const _0x2f9f07=(0x0,socket_1[_0x14ebcb(0x14d)])();return _0x2f9f07['to'](_0x14ebcb(0x15e)+_0x369f8e+_0x14ebcb(0x16a))['emit']('company-'+_0x369f8e+'-chat',{'action':_0x14ebcb(0x14c),'id':_0x507397}),_0x11cb32[_0x14ebcb(0x13c)](0xc8)[_0x14ebcb(0x161)]({'message':'Chat\x20deleted'});};exports[a12_0x29f5a8(0x157)]=remove;function a12_0x3100(_0x1b8140,_0x1b0c2d){const _0x56583b=a12_0x3606();return a12_0x3100=function(_0x19087e,_0x25794c){_0x19087e=_0x19087e-0x13b;let _0x36061b=_0x56583b[_0x19087e];return _0x36061b;},a12_0x3100(_0x1b8140,_0x1b0c2d);}const saveMessage=async(_0x1cc903,_0x121085)=>{const _0x25812d=a12_0x29f5a8,{companyId:_0x275117}=_0x1cc903[_0x25812d(0x15f)],{message:_0x346bf1}=_0x1cc903[_0x25812d(0x15d)],{id:_0x39869e}=_0x1cc903[_0x25812d(0x152)],_0x26c086=+_0x1cc903[_0x25812d(0x15f)]['id'],_0x1c2aa8=+_0x39869e,_0x38b0df=await(0x0,CreateMessageService_1[_0x25812d(0x168)])({'chatId':_0x1c2aa8,'senderId':_0x26c086,'message':_0x346bf1}),_0x1aabda=await Chat_1[_0x25812d(0x168)]['findByPk'](_0x1c2aa8,{'include':[{'model':User_1['default'],'as':_0x25812d(0x158)},{'model':ChatUser_1[_0x25812d(0x168)],'as':'users'}]}),_0x379a5c=(0x0,socket_1[_0x25812d(0x14d)])();return _0x379a5c['to'](_0x25812d(0x15e)+_0x275117+_0x25812d(0x16a))[_0x25812d(0x166)]('company-'+_0x275117+'-chat-'+_0x1c2aa8,{'action':'new-message','newMessage':_0x38b0df,'chat':_0x1aabda}),_0x379a5c['to']('company-'+_0x275117+'-mainchannel')[_0x25812d(0x166)](_0x25812d(0x15e)+_0x275117+_0x25812d(0x150),{'action':'new-message','newMessage':_0x38b0df,'chat':_0x1aabda}),_0x121085[_0x25812d(0x161)](_0x38b0df);};exports[a12_0x29f5a8(0x16f)]=saveMessage;const checkAsRead=async(_0x2b0570,_0x40b0bd)=>{const _0x194f01=a12_0x29f5a8,{companyId:_0x17f77d}=_0x2b0570[_0x194f01(0x15f)],{userId:_0xaffc77}=_0x2b0570['body'],{id:_0x9b8d50}=_0x2b0570[_0x194f01(0x152)],_0x2036d7=await ChatUser_1[_0x194f01(0x168)]['findOne']({'where':{'chatId':_0x9b8d50,'userId':_0xaffc77}});await _0x2036d7[_0x194f01(0x143)]({'unreads':0x0});const _0x521738=await Chat_1[_0x194f01(0x168)][_0x194f01(0x167)](_0x9b8d50,{'include':[{'model':User_1[_0x194f01(0x168)],'as':'owner'},{'model':ChatUser_1[_0x194f01(0x168)],'as':_0x194f01(0x15a)}]}),_0x5945c6=(0x0,socket_1['getIO'])();return _0x5945c6['to']('company-'+_0x17f77d+_0x194f01(0x16a))[_0x194f01(0x166)](_0x194f01(0x15e)+_0x17f77d+_0x194f01(0x149)+_0x9b8d50,{'action':_0x194f01(0x143),'chat':_0x521738}),_0x5945c6['to']('company-'+_0x17f77d+'-mainchannel')['emit'](_0x194f01(0x15e)+_0x17f77d+_0x194f01(0x150),{'action':_0x194f01(0x143),'chat':_0x521738}),_0x40b0bd[_0x194f01(0x161)](_0x521738);};exports[a12_0x29f5a8(0x159)]=checkAsRead;const messages=async(_0x4f0c30,_0x28d011)=>{const _0x5a8274=a12_0x29f5a8,{pageNumber:_0x3603f7}=_0x4f0c30[_0x5a8274(0x169)],{id:_0x2d7d1f}=_0x4f0c30[_0x5a8274(0x152)],_0x1f884a=+_0x4f0c30[_0x5a8274(0x15f)]['id'],{records:_0x45f898,count:_0x220308,hasMore:_0x1c5167}=await(0x0,FindMessages_1[_0x5a8274(0x168)])({'chatId':_0x2d7d1f,'ownerId':_0x1f884a,'pageNumber':_0x3603f7});return _0x28d011[_0x5a8274(0x161)]({'records':_0x45f898,'count':_0x220308,'hasMore':_0x1c5167});};exports[a12_0x29f5a8(0x170)]=messages;