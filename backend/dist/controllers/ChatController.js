const a11_0x4321fd=a11_0x548a;(function(_0x384512,_0x367dae){const _0x4cb3b7=a11_0x548a,_0x45e02f=_0x384512();while(!![]){try{const _0x488768=parseInt(_0x4cb3b7(0xa9))/0x1+parseInt(_0x4cb3b7(0xbc))/0x2*(-parseInt(_0x4cb3b7(0xc0))/0x3)+-parseInt(_0x4cb3b7(0xae))/0x4*(-parseInt(_0x4cb3b7(0xc9))/0x5)+parseInt(_0x4cb3b7(0xad))/0x6+parseInt(_0x4cb3b7(0xb2))/0x7*(-parseInt(_0x4cb3b7(0xce))/0x8)+parseInt(_0x4cb3b7(0xb9))/0x9+-parseInt(_0x4cb3b7(0xa2))/0xa*(parseInt(_0x4cb3b7(0x9f))/0xb);if(_0x488768===_0x367dae)break;else _0x45e02f['push'](_0x45e02f['shift']());}catch(_0xd54413){_0x45e02f['push'](_0x45e02f['shift']());}}}(a11_0x216a,0x4a450));const a11_0x33185c=(function(){let _0x28164c=!![];return function(_0x10e21d,_0x19b207){const _0x292210=_0x28164c?function(){const _0x55010a=a11_0x548a;if(_0x19b207){const _0x584136=_0x19b207[_0x55010a(0xa5)](_0x10e21d,arguments);return _0x19b207=null,_0x584136;}}:function(){};return _0x28164c=![],_0x292210;};}()),a11_0x703174=a11_0x33185c(this,function(){const _0x42dbbf=a11_0x548a;return a11_0x703174[_0x42dbbf(0xbd)]()[_0x42dbbf(0xc6)](_0x42dbbf(0x99))[_0x42dbbf(0xbd)]()['constructor'](a11_0x703174)[_0x42dbbf(0xc6)](_0x42dbbf(0x99));});a11_0x703174();'use strict';var __importDefault=this&&this[a11_0x4321fd(0x9e)]||function(_0x206a8f){const _0x2f8f4f=a11_0x4321fd;return _0x206a8f&&_0x206a8f[_0x2f8f4f(0xc5)]?_0x206a8f:{'default':_0x206a8f};};Object[a11_0x4321fd(0xb7)](exports,a11_0x4321fd(0xc5),{'value':!![]}),exports[a11_0x4321fd(0xa6)]=exports[a11_0x4321fd(0xca)]=exports[a11_0x4321fd(0xcf)]=exports[a11_0x4321fd(0xbe)]=exports[a11_0x4321fd(0x93)]=exports[a11_0x4321fd(0xb3)]=exports['store']=exports['index']=void 0x0;const socket_1=require(a11_0x4321fd(0x9d)),CreateService_1=__importDefault(require(a11_0x4321fd(0x92))),ListService_1=__importDefault(require(a11_0x4321fd(0x9c))),ShowFromUuidService_1=__importDefault(require(a11_0x4321fd(0xcc))),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require(a11_0x4321fd(0xa7))),UpdateService_1=__importDefault(require(a11_0x4321fd(0xd0))),Chat_1=__importDefault(require(a11_0x4321fd(0x98))),CreateMessageService_1=__importDefault(require(a11_0x4321fd(0xcd))),User_1=__importDefault(require(a11_0x4321fd(0xbb))),ChatUser_1=__importDefault(require(a11_0x4321fd(0xa4))),index=async(_0x11ddd2,_0x1a03cb)=>{const _0x1b9728=a11_0x4321fd,{pageNumber:_0x48e5dd}=_0x11ddd2[_0x1b9728(0xab)],_0x54b37b=+_0x11ddd2[_0x1b9728(0xa1)]['id'],{records:_0x4a1a19,count:_0x4f7690,hasMore:_0x37621b}=await(0x0,ListService_1[_0x1b9728(0xb8)])({'ownerId':_0x54b37b,'pageNumber':_0x48e5dd});return _0x1a03cb[_0x1b9728(0xbf)]({'records':_0x4a1a19,'count':_0x4f7690,'hasMore':_0x37621b});};function a11_0x548a(_0x48681f,_0x1e28cf){const _0x2784f7=a11_0x216a();return a11_0x548a=function(_0x703174,_0x33185c){_0x703174=_0x703174-0x92;let _0x216a68=_0x2784f7[_0x703174];return _0x216a68;},a11_0x548a(_0x48681f,_0x1e28cf);}function a11_0x216a(){const _0x58ea05=['store','../services/ChatService/ListService','../libs/socket','__importDefault','1617lvKeTK','-chat-user-','user','33590qVZIrI','findByPk','../models/ChatUser','apply','messages','../services/ChatService/FindMessages','company-','170665bqyCMi','emit','query','-chat','2100054oWYiRN','290908weBRbZ','map','owner','forEach','697277YSBEsk','update','all','status','-chat-','defineProperty','default','4175748DYAhlM','create','../models/User','319562uaVyFx','toString','remove','json','3UAAUKx','index','params','Chat\x20deleted','findOne','__esModule','search','user-','originalname','5BFrHHB','checkAsRead','userId','../services/ChatService/ShowFromUuidService','../services/ChatService/CreateMessageService','8RcmZln','saveMessage','../services/ChatService/UpdateService','delete','../services/ChatService/CreateService','show','new-message','files','body','users','../models/Chat','(((.+)+)+)+$','getIO'];a11_0x216a=function(){return _0x58ea05;};return a11_0x216a();}exports[a11_0x4321fd(0xc1)]=index;const store=async(_0x5c5b32,_0x160efd)=>{const _0x2e1b4a=a11_0x4321fd,{companyId:_0x579b2f}=_0x5c5b32[_0x2e1b4a(0xa1)],_0xf8d1a3=+_0x5c5b32[_0x2e1b4a(0xa1)]['id'],_0x5a23c4=_0x5c5b32[_0x2e1b4a(0x96)],_0x1d9a31=await(0x0,CreateService_1[_0x2e1b4a(0xb8)])({..._0x5a23c4,'ownerId':_0xf8d1a3,'companyId':_0x579b2f}),_0x1479a9=(0x0,socket_1[_0x2e1b4a(0x9a)])();return _0x1d9a31[_0x2e1b4a(0x97)][_0x2e1b4a(0xb1)](_0x218014=>{const _0x2131cb=_0x2e1b4a;_0x1479a9[_0x2131cb(0xaa)](_0x2131cb(0xa8)+_0x579b2f+_0x2131cb(0xa0)+_0x218014[_0x2131cb(0xcb)],{'action':_0x2131cb(0xba),'record':_0x1d9a31});}),_0x160efd[_0x2e1b4a(0xb5)](0xc8)['json'](_0x1d9a31);};exports[a11_0x4321fd(0x9b)]=store;const update=async(_0xd0ab32,_0x607678)=>{const _0x516bbc=a11_0x4321fd,{companyId:_0x135aaa}=_0xd0ab32['user'],_0x5e78cd=_0xd0ab32[_0x516bbc(0x96)],{id:_0x57296d}=_0xd0ab32['params'],_0x18884e=await(0x0,UpdateService_1[_0x516bbc(0xb8)])({..._0x5e78cd,'id':+_0x57296d}),_0x31ba66=(0x0,socket_1[_0x516bbc(0x9a)])();return _0x18884e[_0x516bbc(0x97)]['forEach'](_0x5a7a71=>{const _0x18afca=_0x516bbc;_0x31ba66[_0x18afca(0xaa)](_0x18afca(0xa8)+_0x135aaa+'-chat-user-'+_0x5a7a71[_0x18afca(0xcb)],{'action':'update','record':_0x18884e});}),_0x607678[_0x516bbc(0xb5)](0xc8)[_0x516bbc(0xbf)](_0x18884e);};exports[a11_0x4321fd(0xb3)]=update;const show=async(_0x1c7f9f,_0x44afd0)=>{const _0x9aa6d5=a11_0x4321fd,{id:_0x508c56}=_0x1c7f9f[_0x9aa6d5(0xc2)],_0x3993e8=await(0x0,ShowFromUuidService_1[_0x9aa6d5(0xb8)])(_0x508c56);return _0x44afd0[_0x9aa6d5(0xb5)](0xc8)[_0x9aa6d5(0xbf)](_0x3993e8);};exports['show']=show;const remove=async(_0x3187a4,_0x269360)=>{const _0x58bf97=a11_0x4321fd,{id:_0xb19f54}=_0x3187a4[_0x58bf97(0xc2)],{companyId:_0x40c996}=_0x3187a4['user'];await(0x0,DeleteService_1['default'])(_0xb19f54);const _0x3be4e7=(0x0,socket_1[_0x58bf97(0x9a)])();return _0x3be4e7['emit'](_0x58bf97(0xa8)+_0x40c996+_0x58bf97(0xac),{'action':_0x58bf97(0xd1),'id':_0xb19f54}),_0x269360['status'](0xc8)[_0x58bf97(0xbf)]({'message':_0x58bf97(0xc3)});};exports[a11_0x4321fd(0xbe)]=remove;const saveMessage=async(_0x23cb84,_0x291e0e)=>{const _0x4685be=a11_0x4321fd,_0x25f375=_0x23cb84[_0x4685be(0x95)],{companyId:_0x55455a}=_0x23cb84[_0x4685be(0xa1)],{message:_0x224d87}=_0x23cb84[_0x4685be(0x96)],{id:_0x19e9a3}=_0x23cb84['params'],_0x3a5755=+_0x23cb84['user']['id'],_0x34fbb8=+_0x19e9a3;let _0x134133=null;_0x25f375?await Promise[_0x4685be(0xb4)](_0x25f375['map'](async _0x2644ab=>{const _0x8ccb10=_0x4685be;_0x134133=await(0x0,CreateMessageService_1[_0x8ccb10(0xb8)])({'chatId':_0x34fbb8,'senderId':_0x3a5755,'message':_0x2644ab[_0x8ccb10(0xc8)],'mediaPath':_0x2644ab['filename'],'mediaName':_0x2644ab['originalname'],'mediaType':_0x2644ab['mimetype']['split']('/')[0x0]});})):_0x134133=await(0x0,CreateMessageService_1[_0x4685be(0xb8)])({'chatId':_0x34fbb8,'senderId':_0x3a5755,'message':_0x224d87});const _0x4f5954=await Chat_1[_0x4685be(0xb8)][_0x4685be(0xa3)](_0x34fbb8,{'include':[{'model':User_1[_0x4685be(0xb8)],'as':_0x4685be(0xb0)},{'model':ChatUser_1['default'],'as':_0x4685be(0x97)}]}),_0x151491=_0x4f5954[_0x4685be(0x97)][_0x4685be(0xaf)](_0x164478=>_0x4685be(0xc7)+_0x164478[_0x4685be(0xcb)]),_0x5d9944=(0x0,socket_1[_0x4685be(0x9a)])();return _0x5d9944['to'](_0x151491)[_0x4685be(0xaa)](_0x4685be(0xa8)+_0x55455a+_0x4685be(0xb6)+_0x34fbb8,{'action':'new-message','newMessage':_0x134133,'chat':_0x4f5954}),_0x5d9944['to'](_0x151491)[_0x4685be(0xaa)](_0x4685be(0xa8)+_0x55455a+_0x4685be(0xac),{'action':_0x4685be(0x94),'newMessage':_0x134133,'chat':_0x4f5954}),_0x291e0e[_0x4685be(0xbf)](_0x134133);};exports[a11_0x4321fd(0xcf)]=saveMessage;const checkAsRead=async(_0x39d5fb,_0x5030d3)=>{const _0x12612d=a11_0x4321fd,{companyId:_0x49742b}=_0x39d5fb['user'],{userId:_0x48da9d}=_0x39d5fb[_0x12612d(0x96)],{id:_0x229274}=_0x39d5fb[_0x12612d(0xc2)],_0x213558=await ChatUser_1['default'][_0x12612d(0xc4)]({'where':{'chatId':_0x229274,'userId':_0x48da9d}});await _0x213558['update']({'unreads':0x0});const _0xa2f5f3=await Chat_1[_0x12612d(0xb8)][_0x12612d(0xa3)](_0x229274,{'include':[{'model':User_1[_0x12612d(0xb8)],'as':_0x12612d(0xb0)},{'model':ChatUser_1[_0x12612d(0xb8)],'as':_0x12612d(0x97)}]}),_0x53f748=_0xa2f5f3[_0x12612d(0x97)][_0x12612d(0xaf)](_0x23ec6c=>_0x12612d(0xc7)+_0x23ec6c[_0x12612d(0xcb)]),_0x499614=(0x0,socket_1[_0x12612d(0x9a)])();return _0x499614['to'](_0x53f748)['emit'](_0x12612d(0xa8)+_0x49742b+_0x12612d(0xb6)+_0x229274,{'action':'update','chat':_0xa2f5f3}),_0x499614['to'](_0x53f748)[_0x12612d(0xaa)]('company-'+_0x49742b+_0x12612d(0xac),{'action':_0x12612d(0xb3),'chat':_0xa2f5f3}),_0x5030d3[_0x12612d(0xbf)](_0xa2f5f3);};exports[a11_0x4321fd(0xca)]=checkAsRead;const messages=async(_0x44bf3d,_0x1c6af5)=>{const _0x521977=a11_0x4321fd,{pageNumber:_0xaa14d4}=_0x44bf3d[_0x521977(0xab)],{id:_0x48c98b}=_0x44bf3d[_0x521977(0xc2)],_0x3f6217=+_0x44bf3d[_0x521977(0xa1)]['id'],{records:_0x46bdab,count:_0x2167ff,hasMore:_0x135089}=await(0x0,FindMessages_1[_0x521977(0xb8)])({'chatId':_0x48c98b,'ownerId':_0x3f6217,'pageNumber':_0xaa14d4});return _0x1c6af5[_0x521977(0xbf)]({'records':_0x46bdab,'count':_0x2167ff,'hasMore':_0x135089});};exports[a11_0x4321fd(0xa6)]=messages;