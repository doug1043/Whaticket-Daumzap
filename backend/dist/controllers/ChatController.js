const a12_0x54ee26=a12_0xed26;(function(_0x26ff7b,_0x42d6ba){const _0x26a2bb=a12_0xed26,_0x115096=_0x26ff7b();while(!![]){try{const _0x581b19=parseInt(_0x26a2bb(0xd2))/0x1*(parseInt(_0x26a2bb(0xfb))/0x2)+-parseInt(_0x26a2bb(0xed))/0x3+parseInt(_0x26a2bb(0xe5))/0x4+parseInt(_0x26a2bb(0xe6))/0x5*(parseInt(_0x26a2bb(0xfa))/0x6)+parseInt(_0x26a2bb(0xe2))/0x7*(parseInt(_0x26a2bb(0xd5))/0x8)+parseInt(_0x26a2bb(0xf1))/0x9+-parseInt(_0x26a2bb(0xe8))/0xa*(parseInt(_0x26a2bb(0xe9))/0xb);if(_0x581b19===_0x42d6ba)break;else _0x115096['push'](_0x115096['shift']());}catch(_0x5c5819){_0x115096['push'](_0x115096['shift']());}}}(a12_0x3c41,0xe9c44));const a12_0x137f0b=(function(){let _0x1de91a=!![];return function(_0x3bce2e,_0x415576){const _0xf1fb63=_0x1de91a?function(){const _0x36d658=a12_0xed26;if(_0x415576){const _0x5858cd=_0x415576[_0x36d658(0xf4)](_0x3bce2e,arguments);return _0x415576=null,_0x5858cd;}}:function(){};return _0x1de91a=![],_0xf1fb63;};}()),a12_0x481a20=a12_0x137f0b(this,function(){const _0x232257=a12_0xed26;return a12_0x481a20[_0x232257(0xce)]()[_0x232257(0xd7)](_0x232257(0xf0))[_0x232257(0xce)]()[_0x232257(0xdb)](a12_0x481a20)[_0x232257(0xd7)](_0x232257(0xf0));});a12_0x481a20();'use strict';var __importDefault=this&&this[a12_0x54ee26(0xfc)]||function(_0x5b2575){const _0x6e0afb=a12_0x54ee26;return _0x5b2575&&_0x5b2575[_0x6e0afb(0xec)]?_0x5b2575:{'default':_0x5b2575};};Object[a12_0x54ee26(0xc6)](exports,a12_0x54ee26(0xec),{'value':!![]}),exports[a12_0x54ee26(0xd3)]=exports[a12_0x54ee26(0xee)]=exports[a12_0x54ee26(0xea)]=exports['remove']=exports[a12_0x54ee26(0xe4)]=exports['update']=exports[a12_0x54ee26(0xe1)]=exports[a12_0x54ee26(0xcc)]=void 0x0;const socket_1=require(a12_0x54ee26(0xcb)),CreateService_1=__importDefault(require(a12_0x54ee26(0xd9))),ListService_1=__importDefault(require(a12_0x54ee26(0xdf))),ShowFromUuidService_1=__importDefault(require(a12_0x54ee26(0xe7))),DeleteService_1=__importDefault(require(a12_0x54ee26(0xf3))),FindMessages_1=__importDefault(require(a12_0x54ee26(0xf9))),UpdateService_1=__importDefault(require(a12_0x54ee26(0xeb))),Chat_1=__importDefault(require(a12_0x54ee26(0xda))),CreateMessageService_1=__importDefault(require(a12_0x54ee26(0xca))),User_1=__importDefault(require('../models/User')),ChatUser_1=__importDefault(require(a12_0x54ee26(0xf5))),index=async(_0x170a5f,_0x4513e5)=>{const _0x1c41f3=a12_0x54ee26,{pageNumber:_0x3648e1}=_0x170a5f['query'],_0x4fbf89=+_0x170a5f[_0x1c41f3(0xc3)]['id'],{records:_0x5a375e,count:_0x298660,hasMore:_0x1b060e}=await(0x0,ListService_1[_0x1c41f3(0xcd)])({'ownerId':_0x4fbf89,'pageNumber':_0x3648e1});return _0x4513e5[_0x1c41f3(0xdd)]({'records':_0x5a375e,'count':_0x298660,'hasMore':_0x1b060e});};exports['index']=index;const store=async(_0x3a1e85,_0xcf51ab)=>{const _0xeae503=a12_0x54ee26,{companyId:_0x3cb3aa}=_0x3a1e85[_0xeae503(0xc3)],_0x2d322b=+_0x3a1e85[_0xeae503(0xc3)]['id'],_0x3e6d9c=_0x3a1e85[_0xeae503(0xd0)],_0x10ac89=await(0x0,CreateService_1[_0xeae503(0xcd)])({..._0x3e6d9c,'ownerId':_0x2d322b,'companyId':_0x3cb3aa}),_0x22f849=(0x0,socket_1[_0xeae503(0xf2)])();return _0x10ac89['users']['forEach'](_0x3a6f22=>{const _0x5a4fe3=_0xeae503;_0x22f849['to'](_0x5a4fe3(0xc7)+_0x3cb3aa+_0x5a4fe3(0xfd))[_0x5a4fe3(0xd6)](_0x5a4fe3(0xc7)+_0x3cb3aa+_0x5a4fe3(0xef)+_0x3a6f22[_0x5a4fe3(0xd4)],{'action':_0x5a4fe3(0xd8),'record':_0x10ac89});}),_0xcf51ab[_0xeae503(0xc4)](0xc8)[_0xeae503(0xdd)](_0x10ac89);};exports[a12_0x54ee26(0xe1)]=store;const update=async(_0x1df01c,_0x5ef55d)=>{const _0x45479f=a12_0x54ee26,{companyId:_0x4baa76}=_0x1df01c[_0x45479f(0xc3)],_0x3b34d3=_0x1df01c['body'],{id:_0x51c6b9}=_0x1df01c[_0x45479f(0xf8)],_0x9dc64e=await(0x0,UpdateService_1[_0x45479f(0xcd)])({..._0x3b34d3,'id':+_0x51c6b9}),_0x507b63=(0x0,socket_1[_0x45479f(0xf2)])();return _0x9dc64e[_0x45479f(0xf7)][_0x45479f(0xd1)](_0x1aa3c3=>{const _0xfbf171=_0x45479f;_0x507b63['to'](_0xfbf171(0xc7)+_0x4baa76+_0xfbf171(0xfd))['emit'](_0xfbf171(0xc7)+_0x4baa76+_0xfbf171(0xef)+_0x1aa3c3['userId'],{'action':_0xfbf171(0xc8),'record':_0x9dc64e});}),_0x5ef55d['status'](0xc8)[_0x45479f(0xdd)](_0x9dc64e);};exports[a12_0x54ee26(0xc8)]=update;const show=async(_0x486ac5,_0x28d072)=>{const _0x52fda6=a12_0x54ee26,{id:_0x47452e}=_0x486ac5[_0x52fda6(0xf8)],_0x44c510=await(0x0,ShowFromUuidService_1[_0x52fda6(0xcd)])(_0x47452e);return _0x28d072[_0x52fda6(0xc4)](0xc8)['json'](_0x44c510);};exports[a12_0x54ee26(0xe4)]=show;function a12_0x3c41(){const _0xb0087e=['14495526pKMEvs','getIO','../services/ChatService/DeleteService','apply','../models/ChatUser','remove','users','params','../services/ChatService/FindMessages','4496520GrZWYc','68fEpSfr','__importDefault','-mainchannel','user','status','query','defineProperty','company-','update','owner','../services/ChatService/CreateMessageService','../libs/socket','index','default','toString','new-message','body','forEach','48891KKtXtu','messages','userId','192LLdVZC','emit','search','create','../services/ChatService/CreateService','../models/Chat','constructor','-chat','json','-chat-','../services/ChatService/ListService','delete','store','76139hBWFHB','findByPk','show','5161608einbUQ','10ApMaLL','../services/ChatService/ShowFromUuidService','2085140SGcPdH','242ehXraN','saveMessage','../services/ChatService/UpdateService','__esModule','2335146WRjlhM','checkAsRead','-chat-user-','(((.+)+)+)+$'];a12_0x3c41=function(){return _0xb0087e;};return a12_0x3c41();}const remove=async(_0x3546ca,_0x1bdfea)=>{const _0x48e146=a12_0x54ee26,{id:_0x4d8ca0}=_0x3546ca[_0x48e146(0xf8)],{companyId:_0x21ccce}=_0x3546ca[_0x48e146(0xc3)];await(0x0,DeleteService_1[_0x48e146(0xcd)])(_0x4d8ca0);const _0x54d9c8=(0x0,socket_1['getIO'])();return _0x54d9c8['to'](_0x48e146(0xc7)+_0x21ccce+'-mainchannel')[_0x48e146(0xd6)](_0x48e146(0xc7)+_0x21ccce+_0x48e146(0xdc),{'action':_0x48e146(0xe0),'id':_0x4d8ca0}),_0x1bdfea[_0x48e146(0xc4)](0xc8)[_0x48e146(0xdd)]({'message':'Chat\x20deleted'});};exports[a12_0x54ee26(0xf6)]=remove;const saveMessage=async(_0x138e5e,_0x4fb86b)=>{const _0x124647=a12_0x54ee26,{companyId:_0x1a0f1e}=_0x138e5e[_0x124647(0xc3)],{message:_0x56905e}=_0x138e5e[_0x124647(0xd0)],{id:_0x5ea0f3}=_0x138e5e[_0x124647(0xf8)],_0x2dcb23=+_0x138e5e[_0x124647(0xc3)]['id'],_0x337f4c=+_0x5ea0f3,_0x5320ce=await(0x0,CreateMessageService_1[_0x124647(0xcd)])({'chatId':_0x337f4c,'senderId':_0x2dcb23,'message':_0x56905e}),_0x596d72=await Chat_1[_0x124647(0xcd)][_0x124647(0xe3)](_0x337f4c,{'include':[{'model':User_1['default'],'as':_0x124647(0xc9)},{'model':ChatUser_1[_0x124647(0xcd)],'as':_0x124647(0xf7)}]}),_0x46929a=(0x0,socket_1[_0x124647(0xf2)])();return _0x46929a['to'](_0x124647(0xc7)+_0x1a0f1e+_0x124647(0xfd))[_0x124647(0xd6)](_0x124647(0xc7)+_0x1a0f1e+_0x124647(0xde)+_0x337f4c,{'action':_0x124647(0xcf),'newMessage':_0x5320ce,'chat':_0x596d72}),_0x46929a['to'](_0x124647(0xc7)+_0x1a0f1e+_0x124647(0xfd))[_0x124647(0xd6)]('company-'+_0x1a0f1e+'-chat',{'action':_0x124647(0xcf),'newMessage':_0x5320ce,'chat':_0x596d72}),_0x4fb86b[_0x124647(0xdd)](_0x5320ce);};exports[a12_0x54ee26(0xea)]=saveMessage;function a12_0xed26(_0xf37cd0,_0x38d823){const _0x5a3275=a12_0x3c41();return a12_0xed26=function(_0x481a20,_0x137f0b){_0x481a20=_0x481a20-0xc3;let _0x3c417e=_0x5a3275[_0x481a20];return _0x3c417e;},a12_0xed26(_0xf37cd0,_0x38d823);}const checkAsRead=async(_0x3df92a,_0x3d3d0d)=>{const _0x392a0d=a12_0x54ee26,{companyId:_0x43261a}=_0x3df92a[_0x392a0d(0xc3)],{userId:_0x433787}=_0x3df92a[_0x392a0d(0xd0)],{id:_0xfc02f3}=_0x3df92a[_0x392a0d(0xf8)],_0x314878=await ChatUser_1[_0x392a0d(0xcd)]['findOne']({'where':{'chatId':_0xfc02f3,'userId':_0x433787}});await _0x314878['update']({'unreads':0x0});const _0x1d6fad=await Chat_1[_0x392a0d(0xcd)][_0x392a0d(0xe3)](_0xfc02f3,{'include':[{'model':User_1[_0x392a0d(0xcd)],'as':_0x392a0d(0xc9)},{'model':ChatUser_1[_0x392a0d(0xcd)],'as':_0x392a0d(0xf7)}]}),_0x2bd47d=(0x0,socket_1[_0x392a0d(0xf2)])();return _0x2bd47d['to'](_0x392a0d(0xc7)+_0x43261a+_0x392a0d(0xfd))['emit'](_0x392a0d(0xc7)+_0x43261a+_0x392a0d(0xde)+_0xfc02f3,{'action':_0x392a0d(0xc8),'chat':_0x1d6fad}),_0x2bd47d['to'](_0x392a0d(0xc7)+_0x43261a+_0x392a0d(0xfd))[_0x392a0d(0xd6)](_0x392a0d(0xc7)+_0x43261a+_0x392a0d(0xdc),{'action':'update','chat':_0x1d6fad}),_0x3d3d0d['json'](_0x1d6fad);};exports[a12_0x54ee26(0xee)]=checkAsRead;const messages=async(_0x52375a,_0x4b435d)=>{const _0x585b89=a12_0x54ee26,{pageNumber:_0x380c87}=_0x52375a[_0x585b89(0xc5)],{id:_0x307046}=_0x52375a['params'],_0x43d0a7=+_0x52375a[_0x585b89(0xc3)]['id'],{records:_0x4aae3f,count:_0x439557,hasMore:_0x499ed5}=await(0x0,FindMessages_1[_0x585b89(0xcd)])({'chatId':_0x307046,'ownerId':_0x43d0a7,'pageNumber':_0x380c87});return _0x4b435d[_0x585b89(0xdd)]({'records':_0x4aae3f,'count':_0x439557,'hasMore':_0x499ed5});};exports[a12_0x54ee26(0xd3)]=messages;