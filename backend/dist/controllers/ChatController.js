function a11_0xa16f(_0x8e7bf1,_0x5b4a07){const _0x3174c7=a11_0x5833();return a11_0xa16f=function(_0xf0f8e1,_0x499c31){_0xf0f8e1=_0xf0f8e1-0x1d5;let _0x583380=_0x3174c7[_0xf0f8e1];return _0x583380;},a11_0xa16f(_0x8e7bf1,_0x5b4a07);}const a11_0x15113f=a11_0xa16f;(function(_0x1380e9,_0x27746d){const _0x50bbaf=a11_0xa16f,_0x555b78=_0x1380e9();while(!![]){try{const _0x7b6384=-parseInt(_0x50bbaf(0x1d8))/0x1*(-parseInt(_0x50bbaf(0x1e2))/0x2)+-parseInt(_0x50bbaf(0x207))/0x3*(-parseInt(_0x50bbaf(0x1dd))/0x4)+parseInt(_0x50bbaf(0x201))/0x5*(-parseInt(_0x50bbaf(0x1e4))/0x6)+-parseInt(_0x50bbaf(0x1f9))/0x7*(-parseInt(_0x50bbaf(0x1ef))/0x8)+parseInt(_0x50bbaf(0x1da))/0x9+-parseInt(_0x50bbaf(0x1d5))/0xa*(parseInt(_0x50bbaf(0x215))/0xb)+parseInt(_0x50bbaf(0x20e))/0xc*(-parseInt(_0x50bbaf(0x210))/0xd);if(_0x7b6384===_0x27746d)break;else _0x555b78['push'](_0x555b78['shift']());}catch(_0x18b908){_0x555b78['push'](_0x555b78['shift']());}}}(a11_0x5833,0x82bad));const a11_0x499c31=(function(){let _0x4b8e7a=!![];return function(_0x7f4943,_0x59cc34){const _0x33dfbf=_0x4b8e7a?function(){const _0x16a082=a11_0xa16f;if(_0x59cc34){const _0x552cae=_0x59cc34[_0x16a082(0x208)](_0x7f4943,arguments);return _0x59cc34=null,_0x552cae;}}:function(){};return _0x4b8e7a=![],_0x33dfbf;};}()),a11_0xf0f8e1=a11_0x499c31(this,function(){const _0x16e7ca=a11_0xa16f;return a11_0xf0f8e1[_0x16e7ca(0x1f5)]()[_0x16e7ca(0x1eb)](_0x16e7ca(0x20c))['toString']()['constructor'](a11_0xf0f8e1)[_0x16e7ca(0x1eb)](_0x16e7ca(0x20c));});a11_0xf0f8e1();'use strict';var __importDefault=this&&this[a11_0x15113f(0x1f2)]||function(_0x2b70ba){const _0x3731c1=a11_0x15113f;return _0x2b70ba&&_0x2b70ba[_0x3731c1(0x1f6)]?_0x2b70ba:{'default':_0x2b70ba};};Object[a11_0x15113f(0x1fa)](exports,'__esModule',{'value':!![]}),exports[a11_0x15113f(0x20b)]=exports[a11_0x15113f(0x1f0)]=exports[a11_0x15113f(0x1e6)]=exports[a11_0x15113f(0x20d)]=exports[a11_0x15113f(0x1fe)]=exports[a11_0x15113f(0x1e1)]=exports['store']=exports['index']=void 0x0;const socket_1=require(a11_0x15113f(0x200)),CreateService_1=__importDefault(require(a11_0x15113f(0x214))),ListService_1=__importDefault(require(a11_0x15113f(0x1e3))),ShowFromUuidService_1=__importDefault(require(a11_0x15113f(0x1e9))),DeleteService_1=__importDefault(require(a11_0x15113f(0x1e7))),FindMessages_1=__importDefault(require(a11_0x15113f(0x1e8))),UpdateService_1=__importDefault(require(a11_0x15113f(0x1e5))),Chat_1=__importDefault(require(a11_0x15113f(0x1d9))),CreateMessageService_1=__importDefault(require('../services/ChatService/CreateMessageService')),User_1=__importDefault(require(a11_0x15113f(0x1f1))),ChatUser_1=__importDefault(require(a11_0x15113f(0x20a))),index=async(_0x412433,_0x37c6f6)=>{const _0x3b241a=a11_0x15113f,{pageNumber:_0x384912}=_0x412433[_0x3b241a(0x1f7)],_0x4ada8f=+_0x412433[_0x3b241a(0x213)]['id'],{records:_0x2c7e75,count:_0x28125c,hasMore:_0x2ac85b}=await(0x0,ListService_1[_0x3b241a(0x1dc)])({'ownerId':_0x4ada8f,'pageNumber':_0x384912});return _0x37c6f6[_0x3b241a(0x206)]({'records':_0x2c7e75,'count':_0x28125c,'hasMore':_0x2ac85b});};exports['index']=index;const store=async(_0x3d0f34,_0x30a331)=>{const _0x3f4f90=a11_0x15113f,{companyId:_0x38da9d}=_0x3d0f34[_0x3f4f90(0x213)],_0x5f5711=+_0x3d0f34[_0x3f4f90(0x213)]['id'],_0x5be706=_0x3d0f34[_0x3f4f90(0x1de)],_0x2db007=await(0x0,CreateService_1[_0x3f4f90(0x1dc)])({..._0x5be706,'ownerId':_0x5f5711,'companyId':_0x38da9d}),_0x5a9a2d=(0x0,socket_1['getIO'])();return _0x2db007['users'][_0x3f4f90(0x209)](_0x1c581e=>{const _0x4ebd22=_0x3f4f90;_0x5a9a2d[_0x4ebd22(0x1d7)](_0x4ebd22(0x203)+_0x38da9d+_0x4ebd22(0x1db)+_0x1c581e['userId'],{'action':'create','record':_0x2db007});}),_0x30a331[_0x3f4f90(0x204)](0xc8)[_0x3f4f90(0x206)](_0x2db007);};exports[a11_0x15113f(0x1ff)]=store;const update=async(_0x1f3161,_0x2354b8)=>{const _0x243f5b=a11_0x15113f,{companyId:_0x46e2b0}=_0x1f3161[_0x243f5b(0x213)],_0x38c17d=_0x1f3161[_0x243f5b(0x1de)],{id:_0xe2616}=_0x1f3161['params'],_0x267f27=await(0x0,UpdateService_1[_0x243f5b(0x1dc)])({..._0x38c17d,'id':+_0xe2616}),_0xea7763=(0x0,socket_1['getIO'])();return _0x267f27[_0x243f5b(0x1f8)][_0x243f5b(0x209)](_0x52f418=>{const _0x46900c=_0x243f5b;_0xea7763[_0x46900c(0x1d7)](_0x46900c(0x203)+_0x46e2b0+_0x46900c(0x1db)+_0x52f418[_0x46900c(0x1ed)],{'action':_0x46900c(0x1e1),'record':_0x267f27});}),_0x2354b8[_0x243f5b(0x204)](0xc8)[_0x243f5b(0x206)](_0x267f27);};exports['update']=update;const show=async(_0x1bd303,_0x3a4dd8)=>{const _0x157977=a11_0x15113f,{id:_0x12c3da}=_0x1bd303[_0x157977(0x1fc)],_0x3a8a0d=await(0x0,ShowFromUuidService_1[_0x157977(0x1dc)])(_0x12c3da);return _0x3a4dd8[_0x157977(0x204)](0xc8)[_0x157977(0x206)](_0x3a8a0d);};function a11_0x5833(){const _0xa49d65=['../models/Chat','4432545UvuCoQ','-chat-user-','default','244CdNQVc','body','Chat\x20deleted','user-','update','318078QPZkVv','../services/ChatService/ListService','6nQUcLc','../services/ChatService/UpdateService','saveMessage','../services/ChatService/DeleteService','../services/ChatService/FindMessages','../services/ChatService/ShowFromUuidService','findByPk','search','owner','userId','-chat-','8DLCSMN','checkAsRead','../models/User','__importDefault','split','map','toString','__esModule','query','users','4611229MbCkqA','defineProperty','mimetype','params','filename','show','store','../libs/socket','4187485eyWOlR','originalname','company-','status','getIO','json','20256OzDXps','apply','forEach','../models/ChatUser','messages','(((.+)+)+)+$','remove','79260saSdLL','all','624OfvuUv','-chat','new-message','user','../services/ChatService/CreateService','13101OLjewZ','270JMCzBe','findOne','emit','1toQURD'];a11_0x5833=function(){return _0xa49d65;};return a11_0x5833();}exports[a11_0x15113f(0x1fe)]=show;const remove=async(_0x188f47,_0x28d911)=>{const _0x213c3f=a11_0x15113f,{id:_0x5ba331}=_0x188f47['params'],{companyId:_0x5da429}=_0x188f47[_0x213c3f(0x213)];await(0x0,DeleteService_1[_0x213c3f(0x1dc)])(_0x5ba331);const _0x174d98=(0x0,socket_1['getIO'])();return _0x174d98[_0x213c3f(0x1d7)](_0x213c3f(0x203)+_0x5da429+_0x213c3f(0x211),{'action':'delete','id':_0x5ba331}),_0x28d911['status'](0xc8)[_0x213c3f(0x206)]({'message':_0x213c3f(0x1df)});};exports[a11_0x15113f(0x20d)]=remove;const saveMessage=async(_0x142d6f,_0x584bfc)=>{const _0x3157a0=a11_0x15113f,_0x54bfe5=_0x142d6f['files'],{companyId:_0x147e64}=_0x142d6f[_0x3157a0(0x213)],{message:_0x1a80c6}=_0x142d6f[_0x3157a0(0x1de)],{id:_0x3ec746}=_0x142d6f[_0x3157a0(0x1fc)],_0x16a0cf=+_0x142d6f[_0x3157a0(0x213)]['id'],_0x5ab326=+_0x3ec746;let _0x292d60=null;_0x54bfe5?await Promise[_0x3157a0(0x20f)](_0x54bfe5[_0x3157a0(0x1f4)](async _0x2dffb8=>{const _0x3d1903=_0x3157a0;_0x292d60=await(0x0,CreateMessageService_1[_0x3d1903(0x1dc)])({'chatId':_0x5ab326,'senderId':_0x16a0cf,'message':_0x2dffb8[_0x3d1903(0x202)],'mediaPath':_0x2dffb8[_0x3d1903(0x1fd)],'mediaName':_0x2dffb8['originalname'],'mediaType':_0x2dffb8[_0x3d1903(0x1fb)][_0x3d1903(0x1f3)]('/')[0x0]});})):_0x292d60=await(0x0,CreateMessageService_1[_0x3157a0(0x1dc)])({'chatId':_0x5ab326,'senderId':_0x16a0cf,'message':_0x1a80c6});const _0x1434bb=await Chat_1[_0x3157a0(0x1dc)]['findByPk'](_0x5ab326,{'include':[{'model':User_1[_0x3157a0(0x1dc)],'as':_0x3157a0(0x1ec)},{'model':ChatUser_1['default'],'as':_0x3157a0(0x1f8)}]}),_0x726c89=_0x1434bb[_0x3157a0(0x1f8)][_0x3157a0(0x1f4)](_0x2bc08d=>_0x3157a0(0x1e0)+_0x2bc08d[_0x3157a0(0x1ed)]),_0x10b781=(0x0,socket_1[_0x3157a0(0x205)])();return _0x10b781['to'](_0x726c89)['emit'](_0x3157a0(0x203)+_0x147e64+_0x3157a0(0x1ee)+_0x5ab326,{'action':_0x3157a0(0x212),'newMessage':_0x292d60,'chat':_0x1434bb}),_0x10b781['to'](_0x726c89)[_0x3157a0(0x1d7)](_0x3157a0(0x203)+_0x147e64+'-chat',{'action':_0x3157a0(0x212),'newMessage':_0x292d60,'chat':_0x1434bb}),_0x584bfc['json'](_0x292d60);};exports['saveMessage']=saveMessage;const checkAsRead=async(_0x1bfd35,_0x1bf51b)=>{const _0x2cedca=a11_0x15113f,{companyId:_0x3bb103}=_0x1bfd35[_0x2cedca(0x213)],{userId:_0x1071a5}=_0x1bfd35['body'],{id:_0x197bf5}=_0x1bfd35[_0x2cedca(0x1fc)],_0x58615e=await ChatUser_1[_0x2cedca(0x1dc)][_0x2cedca(0x1d6)]({'where':{'chatId':_0x197bf5,'userId':_0x1071a5}});await _0x58615e[_0x2cedca(0x1e1)]({'unreads':0x0});const _0x53409f=await Chat_1[_0x2cedca(0x1dc)][_0x2cedca(0x1ea)](_0x197bf5,{'include':[{'model':User_1[_0x2cedca(0x1dc)],'as':_0x2cedca(0x1ec)},{'model':ChatUser_1['default'],'as':_0x2cedca(0x1f8)}]}),_0xaf19f9=_0x53409f['users']['map'](_0x57d24a=>_0x2cedca(0x1e0)+_0x57d24a[_0x2cedca(0x1ed)]),_0x3a0f43=(0x0,socket_1[_0x2cedca(0x205)])();return _0x3a0f43['to'](_0xaf19f9)[_0x2cedca(0x1d7)](_0x2cedca(0x203)+_0x3bb103+_0x2cedca(0x1ee)+_0x197bf5,{'action':_0x2cedca(0x1e1),'chat':_0x53409f}),_0x3a0f43['to'](_0xaf19f9)['emit'](_0x2cedca(0x203)+_0x3bb103+_0x2cedca(0x211),{'action':'update','chat':_0x53409f}),_0x1bf51b[_0x2cedca(0x206)](_0x53409f);};exports[a11_0x15113f(0x1f0)]=checkAsRead;const messages=async(_0x466dea,_0x37d705)=>{const _0xa9559=a11_0x15113f,{pageNumber:_0x37d418}=_0x466dea[_0xa9559(0x1f7)],{id:_0x30db33}=_0x466dea[_0xa9559(0x1fc)],_0x5b6518=+_0x466dea[_0xa9559(0x213)]['id'],{records:_0x18cf3d,count:_0x23b0eb,hasMore:_0x16cb9a}=await(0x0,FindMessages_1['default'])({'chatId':_0x30db33,'ownerId':_0x5b6518,'pageNumber':_0x37d418});return _0x37d705[_0xa9559(0x206)]({'records':_0x18cf3d,'count':_0x23b0eb,'hasMore':_0x16cb9a});};exports[a11_0x15113f(0x20b)]=messages;