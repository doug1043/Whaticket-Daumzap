const a11_0xc5e072=a11_0x16a2;(function(_0x281cb8,_0x100805){const _0x40fd39=a11_0x16a2,_0x1ea511=_0x281cb8();while(!![]){try{const _0x4a073c=-parseInt(_0x40fd39(0x10f))/0x1*(-parseInt(_0x40fd39(0xf0))/0x2)+-parseInt(_0x40fd39(0x100))/0x3+-parseInt(_0x40fd39(0xe2))/0x4*(parseInt(_0x40fd39(0x102))/0x5)+-parseInt(_0x40fd39(0xe5))/0x6*(-parseInt(_0x40fd39(0xff))/0x7)+-parseInt(_0x40fd39(0x10a))/0x8*(-parseInt(_0x40fd39(0x104))/0x9)+-parseInt(_0x40fd39(0x10e))/0xa*(-parseInt(_0x40fd39(0x105))/0xb)+-parseInt(_0x40fd39(0xed))/0xc;if(_0x4a073c===_0x100805)break;else _0x1ea511['push'](_0x1ea511['shift']());}catch(_0x4e57f7){_0x1ea511['push'](_0x1ea511['shift']());}}}(a11_0x1c28,0x1c976));function a11_0x1c28(){const _0x51924f=['user','remove','filename','users','saveMessage','apply','-chat-','7NpVKmd','244896wHxhuv','store','26115JMqinu','delete','1415727grxQHL','407wnlZSW','default','../models/User','../services/ChatService/CreateMessageService','emit','8Lyqagm','../services/ChatService/ShowFromUuidService','constructor','findByPk','28300XjFZcP','29735mmyBzA','__esModule','show','user-','__importDefault','owner','../services/ChatService/CreateService','findOne','map','../services/ChatService/ListService','company-','userId','new-message','body','84TeyCiM','params','-chat-user-','1355592DvHjsH','create','index','getIO','originalname','checkAsRead','update','-chat','4651980ZrIlRH','../libs/socket','toString','14Uuedmb','../models/Chat','../services/ChatService/DeleteService','status','messages','json','(((.+)+)+)+$','defineProperty'];a11_0x1c28=function(){return _0x51924f;};return a11_0x1c28();}const a11_0x5bb4d2=(function(){let _0x5cf35c=!![];return function(_0x4f42db,_0xc95759){const _0x10ffa2=_0x5cf35c?function(){const _0x5e47c3=a11_0x16a2;if(_0xc95759){const _0x2cb6f2=_0xc95759[_0x5e47c3(0xfd)](_0x4f42db,arguments);return _0xc95759=null,_0x2cb6f2;}}:function(){};return _0x5cf35c=![],_0x10ffa2;};}()),a11_0x444165=a11_0x5bb4d2(this,function(){const _0x96b50e=a11_0x16a2;return a11_0x444165[_0x96b50e(0xef)]()['search'](_0x96b50e(0xf6))[_0x96b50e(0xef)]()[_0x96b50e(0x10c)](a11_0x444165)['search'](_0x96b50e(0xf6));});a11_0x444165();'use strict';var __importDefault=this&&this[a11_0xc5e072(0x113)]||function(_0x4c04a6){const _0x932e7d=a11_0xc5e072;return _0x4c04a6&&_0x4c04a6[_0x932e7d(0x110)]?_0x4c04a6:{'default':_0x4c04a6};};Object[a11_0xc5e072(0xf7)](exports,a11_0xc5e072(0x110),{'value':!![]}),exports[a11_0xc5e072(0xf4)]=exports[a11_0xc5e072(0xea)]=exports['saveMessage']=exports[a11_0xc5e072(0xf9)]=exports[a11_0xc5e072(0x111)]=exports['update']=exports[a11_0xc5e072(0x101)]=exports['index']=void 0x0;const socket_1=require(a11_0xc5e072(0xee)),CreateService_1=__importDefault(require(a11_0xc5e072(0x115))),ListService_1=__importDefault(require(a11_0xc5e072(0x118))),ShowFromUuidService_1=__importDefault(require(a11_0xc5e072(0x10b))),DeleteService_1=__importDefault(require(a11_0xc5e072(0xf2))),FindMessages_1=__importDefault(require('../services/ChatService/FindMessages')),UpdateService_1=__importDefault(require('../services/ChatService/UpdateService')),Chat_1=__importDefault(require(a11_0xc5e072(0xf1))),CreateMessageService_1=__importDefault(require(a11_0xc5e072(0x108))),User_1=__importDefault(require(a11_0xc5e072(0x107))),ChatUser_1=__importDefault(require('../models/ChatUser')),index=async(_0x4bee19,_0x376f60)=>{const _0x2f0d95=a11_0xc5e072,{pageNumber:_0x49640b}=_0x4bee19['query'],_0xc86f01=+_0x4bee19['user']['id'],{records:_0x2ec294,count:_0x22573e,hasMore:_0x48f137}=await(0x0,ListService_1['default'])({'ownerId':_0xc86f01,'pageNumber':_0x49640b});return _0x376f60[_0x2f0d95(0xf5)]({'records':_0x2ec294,'count':_0x22573e,'hasMore':_0x48f137});};exports[a11_0xc5e072(0xe7)]=index;const store=async(_0x235a4f,_0x3d2764)=>{const _0x29a2b7=a11_0xc5e072,{companyId:_0x1fe829}=_0x235a4f[_0x29a2b7(0xf8)],_0x516c62=+_0x235a4f[_0x29a2b7(0xf8)]['id'],_0xf1a86b=_0x235a4f[_0x29a2b7(0xe1)],_0x6e2c29=await(0x0,CreateService_1[_0x29a2b7(0x106)])({..._0xf1a86b,'ownerId':_0x516c62,'companyId':_0x1fe829}),_0x18b823=(0x0,socket_1['getIO'])();return _0x6e2c29['users']['forEach'](_0x44539a=>{const _0xd4b6c3=_0x29a2b7;_0x18b823[_0xd4b6c3(0x109)](_0xd4b6c3(0x119)+_0x1fe829+_0xd4b6c3(0xe4)+_0x44539a['userId'],{'action':_0xd4b6c3(0xe6),'record':_0x6e2c29});}),_0x3d2764[_0x29a2b7(0xf3)](0xc8)[_0x29a2b7(0xf5)](_0x6e2c29);};function a11_0x16a2(_0x34f2e7,_0x5dbb72){const _0x38694d=a11_0x1c28();return a11_0x16a2=function(_0x444165,_0x5bb4d2){_0x444165=_0x444165-0xe1;let _0x1c28b1=_0x38694d[_0x444165];return _0x1c28b1;},a11_0x16a2(_0x34f2e7,_0x5dbb72);}exports['store']=store;const update=async(_0x249cc9,_0x6c52df)=>{const _0xfe3b74=a11_0xc5e072,{companyId:_0x32de3d}=_0x249cc9[_0xfe3b74(0xf8)],_0x1a3bab=_0x249cc9[_0xfe3b74(0xe1)],{id:_0x53ab9c}=_0x249cc9['params'],_0x450106=await(0x0,UpdateService_1['default'])({..._0x1a3bab,'id':+_0x53ab9c}),_0x5b8fe2=(0x0,socket_1[_0xfe3b74(0xe8)])();return _0x450106[_0xfe3b74(0xfb)]['forEach'](_0x5113e8=>{const _0xbcfc2f=_0xfe3b74;_0x5b8fe2[_0xbcfc2f(0x109)](_0xbcfc2f(0x119)+_0x32de3d+_0xbcfc2f(0xe4)+_0x5113e8['userId'],{'action':_0xbcfc2f(0xeb),'record':_0x450106});}),_0x6c52df[_0xfe3b74(0xf3)](0xc8)[_0xfe3b74(0xf5)](_0x450106);};exports[a11_0xc5e072(0xeb)]=update;const show=async(_0x3f1a79,_0x1822b8)=>{const _0x3fb59b=a11_0xc5e072,{id:_0x43ec99}=_0x3f1a79[_0x3fb59b(0xe3)],_0x1bd2e0=await(0x0,ShowFromUuidService_1[_0x3fb59b(0x106)])(_0x43ec99);return _0x1822b8[_0x3fb59b(0xf3)](0xc8)[_0x3fb59b(0xf5)](_0x1bd2e0);};exports[a11_0xc5e072(0x111)]=show;const remove=async(_0x36eb2e,_0x3ebcdb)=>{const _0x547379=a11_0xc5e072,{id:_0x1525a6}=_0x36eb2e[_0x547379(0xe3)],{companyId:_0x5f16bc}=_0x36eb2e[_0x547379(0xf8)];await(0x0,DeleteService_1[_0x547379(0x106)])(_0x1525a6);const _0x1a97bf=(0x0,socket_1[_0x547379(0xe8)])();return _0x1a97bf[_0x547379(0x109)](_0x547379(0x119)+_0x5f16bc+'-chat',{'action':_0x547379(0x103),'id':_0x1525a6}),_0x3ebcdb[_0x547379(0xf3)](0xc8)[_0x547379(0xf5)]({'message':'Chat\x20deleted'});};exports[a11_0xc5e072(0xf9)]=remove;const saveMessage=async(_0x122f83,_0x5dd3aa)=>{const _0x1eeace=a11_0xc5e072,_0x501a73=_0x122f83['files'],{companyId:_0x1fa867}=_0x122f83[_0x1eeace(0xf8)],{message:_0x25b625}=_0x122f83[_0x1eeace(0xe1)],{id:_0x519a85}=_0x122f83[_0x1eeace(0xe3)],_0x1b70f2=+_0x122f83[_0x1eeace(0xf8)]['id'],_0x301619=+_0x519a85;let _0x1006f7=null;_0x501a73?await Promise['all'](_0x501a73['map'](async _0x4d23b8=>{const _0x1ccf3a=_0x1eeace;_0x1006f7=await(0x0,CreateMessageService_1[_0x1ccf3a(0x106)])({'chatId':_0x301619,'senderId':_0x1b70f2,'message':_0x4d23b8[_0x1ccf3a(0xe9)],'mediaPath':_0x4d23b8[_0x1ccf3a(0xfa)],'mediaName':_0x4d23b8[_0x1ccf3a(0xe9)],'mediaType':_0x4d23b8['mimetype']['split']('/')[0x0]});})):_0x1006f7=await(0x0,CreateMessageService_1[_0x1eeace(0x106)])({'chatId':_0x301619,'senderId':_0x1b70f2,'message':_0x25b625});const _0xd4c566=await Chat_1[_0x1eeace(0x106)][_0x1eeace(0x10d)](_0x301619,{'include':[{'model':User_1[_0x1eeace(0x106)],'as':_0x1eeace(0x114)},{'model':ChatUser_1['default'],'as':'users'}]}),_0x318c17=_0xd4c566[_0x1eeace(0xfb)][_0x1eeace(0x117)](_0x11a99d=>_0x1eeace(0x112)+_0x11a99d[_0x1eeace(0x11a)]),_0x39c9a2=(0x0,socket_1['getIO'])();return _0x39c9a2['to'](_0x318c17)[_0x1eeace(0x109)]('company-'+_0x1fa867+_0x1eeace(0xfe)+_0x301619,{'action':_0x1eeace(0x11b),'newMessage':_0x1006f7,'chat':_0xd4c566}),_0x39c9a2['to'](_0x318c17)['emit'](_0x1eeace(0x119)+_0x1fa867+_0x1eeace(0xec),{'action':_0x1eeace(0x11b),'newMessage':_0x1006f7,'chat':_0xd4c566}),_0x5dd3aa['json'](_0x1006f7);};exports[a11_0xc5e072(0xfc)]=saveMessage;const checkAsRead=async(_0x4a8554,_0x48c7c4)=>{const _0x52afbb=a11_0xc5e072,{companyId:_0x37eafd}=_0x4a8554['user'],{userId:_0x177dbe}=_0x4a8554[_0x52afbb(0xe1)],{id:_0x5488b2}=_0x4a8554[_0x52afbb(0xe3)],_0x1c7f5a=await ChatUser_1[_0x52afbb(0x106)][_0x52afbb(0x116)]({'where':{'chatId':_0x5488b2,'userId':_0x177dbe}});await _0x1c7f5a[_0x52afbb(0xeb)]({'unreads':0x0});const _0x19ebc3=await Chat_1[_0x52afbb(0x106)][_0x52afbb(0x10d)](_0x5488b2,{'include':[{'model':User_1['default'],'as':_0x52afbb(0x114)},{'model':ChatUser_1[_0x52afbb(0x106)],'as':_0x52afbb(0xfb)}]}),_0x323e9f=_0x19ebc3[_0x52afbb(0xfb)]['map'](_0x34004e=>_0x52afbb(0x112)+_0x34004e[_0x52afbb(0x11a)]),_0x3700d2=(0x0,socket_1[_0x52afbb(0xe8)])();return _0x3700d2['to'](_0x323e9f)['emit'](_0x52afbb(0x119)+_0x37eafd+_0x52afbb(0xfe)+_0x5488b2,{'action':_0x52afbb(0xeb),'chat':_0x19ebc3}),_0x3700d2['to'](_0x323e9f)[_0x52afbb(0x109)](_0x52afbb(0x119)+_0x37eafd+_0x52afbb(0xec),{'action':_0x52afbb(0xeb),'chat':_0x19ebc3}),_0x48c7c4[_0x52afbb(0xf5)](_0x19ebc3);};exports[a11_0xc5e072(0xea)]=checkAsRead;const messages=async(_0x10d60e,_0x3eed77)=>{const _0x3f2517=a11_0xc5e072,{pageNumber:_0x2c5ed1}=_0x10d60e['query'],{id:_0x23c185}=_0x10d60e[_0x3f2517(0xe3)],_0xc8c3a=+_0x10d60e[_0x3f2517(0xf8)]['id'],{records:_0x1f347e,count:_0x1eb69f,hasMore:_0x564e2b}=await(0x0,FindMessages_1[_0x3f2517(0x106)])({'chatId':_0x23c185,'ownerId':_0xc8c3a,'pageNumber':_0x2c5ed1});return _0x3eed77[_0x3f2517(0xf5)]({'records':_0x1f347e,'count':_0x1eb69f,'hasMore':_0x564e2b});};exports[a11_0xc5e072(0xf4)]=messages;