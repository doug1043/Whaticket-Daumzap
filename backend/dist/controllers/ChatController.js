const a14_0x315bae=a14_0x5307;(function(_0x3f41ed,_0x4db0f8){const _0x41b7d4=a14_0x5307,_0x27b0eb=_0x3f41ed();while(!![]){try{const _0x409a4e=parseInt(_0x41b7d4(0x1a0))/0x1+-parseInt(_0x41b7d4(0x194))/0x2+parseInt(_0x41b7d4(0x197))/0x3+parseInt(_0x41b7d4(0x18b))/0x4+parseInt(_0x41b7d4(0x1a7))/0x5*(parseInt(_0x41b7d4(0x176))/0x6)+parseInt(_0x41b7d4(0x1b1))/0x7*(parseInt(_0x41b7d4(0x195))/0x8)+parseInt(_0x41b7d4(0x196))/0x9*(-parseInt(_0x41b7d4(0x1aa))/0xa);if(_0x409a4e===_0x4db0f8)break;else _0x27b0eb['push'](_0x27b0eb['shift']());}catch(_0x1aafe2){_0x27b0eb['push'](_0x27b0eb['shift']());}}}(a14_0x1b44,0xafee9));const a14_0x3e2d50=(function(){let _0x3cc30c=!![];return function(_0x58e70e,_0xc8f98d){const _0x3e4ce1=_0x3cc30c?function(){const _0x2f36ec=a14_0x5307;if(_0xc8f98d){const _0x1c560d=_0xc8f98d[_0x2f36ec(0x191)](_0x58e70e,arguments);return _0xc8f98d=null,_0x1c560d;}}:function(){};return _0x3cc30c=![],_0x3e4ce1;};}()),a14_0x3c66b8=a14_0x3e2d50(this,function(){const _0x1f2066=a14_0x5307;return a14_0x3c66b8['toString']()['search'](_0x1f2066(0x1b0))['toString']()[_0x1f2066(0x17e)](a14_0x3c66b8)[_0x1f2066(0x1ab)](_0x1f2066(0x1b0));});a14_0x3c66b8();'use strict';var __importDefault=this&&this['__importDefault']||function(_0xc9b889){return _0xc9b889&&_0xc9b889['__esModule']?_0xc9b889:{'default':_0xc9b889};};function a14_0x1b44(){const _0x12fc2d=['constructor','findByPk','default','saveMessage','userId','status','split','../services/ChatService/UpdateService','findOne','update','json','__esModule','uploadFile','5475304JUfkIF','store','user','../models/Chat','body','remove','apply','owner','../services/ChatService/FindMessages','844994MzzDoB','2626856exmiAq','9wICgXB','3773904YwJCPo','all','mimetype','-chat-','users','../services/ChatService/ListService','forEach','map','new-message','37942NyZpnL','delete','company-','user-','../models/ChatUser','../models/User','path','492355AnElyR','../services/ChatService/DeleteService','create','23752780dWVsRZ','search','getIO','query','../services/ChatService/ShowFromUuidService','-chat','(((.+)+)+)+$','14rCjYfQ','messages','-chat-user-','../services/ChatService/CreateMessageService','checkAsRead','12pEvjBt','uploads','Chat\x20deleted','index','../services/StorageService/StorageService','emit','originalname','params'];a14_0x1b44=function(){return _0x12fc2d;};return a14_0x1b44();}Object['defineProperty'](exports,a14_0x315bae(0x189),{'value':!![]}),exports[a14_0x315bae(0x172)]=exports[a14_0x315bae(0x175)]=exports[a14_0x315bae(0x181)]=exports[a14_0x315bae(0x190)]=exports['show']=exports[a14_0x315bae(0x187)]=exports[a14_0x315bae(0x18c)]=exports[a14_0x315bae(0x179)]=void 0x0;const socket_1=require('../libs/socket'),CreateService_1=__importDefault(require('../services/ChatService/CreateService')),ListService_1=__importDefault(require(a14_0x315bae(0x19c))),ShowFromUuidService_1=__importDefault(require(a14_0x315bae(0x1ae))),DeleteService_1=__importDefault(require(a14_0x315bae(0x1a8))),FindMessages_1=__importDefault(require(a14_0x315bae(0x193))),UpdateService_1=__importDefault(require(a14_0x315bae(0x185))),Chat_1=__importDefault(require(a14_0x315bae(0x18e))),CreateMessageService_1=__importDefault(require(a14_0x315bae(0x174))),User_1=__importDefault(require(a14_0x315bae(0x1a5))),ChatUser_1=__importDefault(require(a14_0x315bae(0x1a4))),StorageService_1=__importDefault(require(a14_0x315bae(0x17a))),index=async(_0x28afb4,_0x572218)=>{const _0x5ed034=a14_0x315bae,{pageNumber:_0x1c08ee}=_0x28afb4[_0x5ed034(0x1ad)],_0x1717cb=+_0x28afb4[_0x5ed034(0x18d)]['id'],{records:_0xc26b7d,count:_0x366eb3,hasMore:_0x25f080}=await(0x0,ListService_1[_0x5ed034(0x180)])({'ownerId':_0x1717cb,'pageNumber':_0x1c08ee});return _0x572218[_0x5ed034(0x188)]({'records':_0xc26b7d,'count':_0x366eb3,'hasMore':_0x25f080});};exports[a14_0x315bae(0x179)]=index;const store=async(_0x357b15,_0x59045d)=>{const _0x431b77=a14_0x315bae,{companyId:_0x2904b4}=_0x357b15[_0x431b77(0x18d)],_0x14e2b1=+_0x357b15['user']['id'],_0x75670e=_0x357b15['body'],_0x4c681d=await(0x0,CreateService_1[_0x431b77(0x180)])({..._0x75670e,'ownerId':_0x14e2b1,'companyId':_0x2904b4}),_0x173298=(0x0,socket_1['getIO'])();return _0x4c681d[_0x431b77(0x19b)][_0x431b77(0x19d)](_0x468881=>{const _0x3ff328=_0x431b77;_0x173298[_0x3ff328(0x17b)](_0x3ff328(0x1a2)+_0x2904b4+_0x3ff328(0x173)+_0x468881[_0x3ff328(0x182)],{'action':_0x3ff328(0x1a9),'record':_0x4c681d});}),_0x59045d[_0x431b77(0x183)](0xc8)['json'](_0x4c681d);};exports[a14_0x315bae(0x18c)]=store;const update=async(_0x2aac94,_0xb01948)=>{const _0x39d8ce=a14_0x315bae,{companyId:_0x2c77fb}=_0x2aac94['user'],_0x1444a6=_0x2aac94[_0x39d8ce(0x18f)],{id:_0x3d74d4}=_0x2aac94['params'],_0x2d5195=await(0x0,UpdateService_1[_0x39d8ce(0x180)])({..._0x1444a6,'id':+_0x3d74d4}),_0x8fcc19=(0x0,socket_1['getIO'])();return _0x2d5195[_0x39d8ce(0x19b)][_0x39d8ce(0x19d)](_0x37e419=>{const _0x522a5c=_0x39d8ce;_0x8fcc19['emit'](_0x522a5c(0x1a2)+_0x2c77fb+_0x522a5c(0x173)+_0x37e419['userId'],{'action':'update','record':_0x2d5195});}),_0xb01948[_0x39d8ce(0x183)](0xc8)[_0x39d8ce(0x188)](_0x2d5195);};exports[a14_0x315bae(0x187)]=update;const show=async(_0xb7945c,_0x1183b3)=>{const _0x4f4957=a14_0x315bae,{id:_0x1b0e94}=_0xb7945c[_0x4f4957(0x17d)],_0x267c2d=await(0x0,ShowFromUuidService_1[_0x4f4957(0x180)])(_0x1b0e94);return _0x1183b3[_0x4f4957(0x183)](0xc8)[_0x4f4957(0x188)](_0x267c2d);};exports['show']=show;const remove=async(_0x4c486f,_0x199f38)=>{const _0x705838=a14_0x315bae,{id:_0x5d50e1}=_0x4c486f['params'],{companyId:_0x4e495d}=_0x4c486f[_0x705838(0x18d)];await(0x0,DeleteService_1['default'])(_0x5d50e1);const _0x315380=(0x0,socket_1['getIO'])();return _0x315380[_0x705838(0x17b)](_0x705838(0x1a2)+_0x4e495d+_0x705838(0x1af),{'action':_0x705838(0x1a1),'id':_0x5d50e1}),_0x199f38[_0x705838(0x183)](0xc8)[_0x705838(0x188)]({'message':_0x705838(0x178)});};exports[a14_0x315bae(0x190)]=remove;function a14_0x5307(_0x3df07b,_0x2d3e67){const _0xbf8a95=a14_0x1b44();return a14_0x5307=function(_0x3c66b8,_0x3e2d50){_0x3c66b8=_0x3c66b8-0x172;let _0x1b4435=_0xbf8a95[_0x3c66b8];return _0x1b4435;},a14_0x5307(_0x3df07b,_0x2d3e67);}const saveMessage=async(_0x1caf26,_0xc01262)=>{const _0x328797=a14_0x315bae,_0x1db61d=_0x1caf26['files'],{companyId:_0x4febff}=_0x1caf26['user'],{message:_0x4db6d3}=_0x1caf26[_0x328797(0x18f)],{id:_0x1c1284}=_0x1caf26[_0x328797(0x17d)],_0x240edd=+_0x1caf26[_0x328797(0x18d)]['id'],_0xb358c8=+_0x1c1284;let _0xca9748=null;_0x1db61d?await Promise[_0x328797(0x198)](_0x1db61d['map'](async _0x1eacce=>{const _0x7c9700=_0x328797,{url:_0x128f6d}=await StorageService_1[_0x7c9700(0x180)][_0x7c9700(0x18a)](_0x4febff,_0x7c9700(0x177),_0x1eacce['filename'],_0x1eacce[_0x7c9700(0x1a6)],_0x1eacce[_0x7c9700(0x199)]);_0xca9748=await(0x0,CreateMessageService_1[_0x7c9700(0x180)])({'chatId':_0xb358c8,'senderId':_0x240edd,'message':_0x1eacce[_0x7c9700(0x17c)],'mediaPath':_0x128f6d,'mediaName':_0x1eacce['originalname'],'mediaType':_0x1eacce[_0x7c9700(0x199)][_0x7c9700(0x184)]('/')[0x0]});})):_0xca9748=await(0x0,CreateMessageService_1[_0x328797(0x180)])({'chatId':_0xb358c8,'senderId':_0x240edd,'message':_0x4db6d3});const _0x475d71=await Chat_1[_0x328797(0x180)][_0x328797(0x17f)](_0xb358c8,{'include':[{'model':User_1[_0x328797(0x180)],'as':_0x328797(0x192)},{'model':ChatUser_1[_0x328797(0x180)],'as':_0x328797(0x19b)}]}),_0x41ca81=_0x475d71[_0x328797(0x19b)][_0x328797(0x19e)](_0x205a13=>_0x328797(0x1a3)+_0x205a13['userId']),_0x2fbc42=(0x0,socket_1[_0x328797(0x1ac)])();return _0x2fbc42['to'](_0x41ca81)['emit'](_0x328797(0x1a2)+_0x4febff+_0x328797(0x19a)+_0xb358c8,{'action':_0x328797(0x19f),'newMessage':_0xca9748,'chat':_0x475d71}),_0x2fbc42['to'](_0x41ca81)[_0x328797(0x17b)]('company-'+_0x4febff+_0x328797(0x1af),{'action':_0x328797(0x19f),'newMessage':_0xca9748,'chat':_0x475d71}),_0xc01262[_0x328797(0x188)](_0xca9748);};exports[a14_0x315bae(0x181)]=saveMessage;const checkAsRead=async(_0x23e446,_0xfe7965)=>{const _0x2a7667=a14_0x315bae,{companyId:_0x421515}=_0x23e446['user'],{userId:_0x3911ba}=_0x23e446[_0x2a7667(0x18f)],{id:_0x49472b}=_0x23e446['params'],_0x12b395=await ChatUser_1[_0x2a7667(0x180)][_0x2a7667(0x186)]({'where':{'chatId':_0x49472b,'userId':_0x3911ba}});await _0x12b395[_0x2a7667(0x187)]({'unreads':0x0});const _0x5c1f46=await Chat_1['default']['findByPk'](_0x49472b,{'include':[{'model':User_1[_0x2a7667(0x180)],'as':_0x2a7667(0x192)},{'model':ChatUser_1['default'],'as':_0x2a7667(0x19b)}]}),_0x35667f=_0x5c1f46[_0x2a7667(0x19b)]['map'](_0x2938c7=>_0x2a7667(0x1a3)+_0x2938c7[_0x2a7667(0x182)]),_0x57fafd=(0x0,socket_1['getIO'])();return _0x57fafd['to'](_0x35667f)[_0x2a7667(0x17b)]('company-'+_0x421515+_0x2a7667(0x19a)+_0x49472b,{'action':_0x2a7667(0x187),'chat':_0x5c1f46}),_0x57fafd['to'](_0x35667f)[_0x2a7667(0x17b)](_0x2a7667(0x1a2)+_0x421515+_0x2a7667(0x1af),{'action':_0x2a7667(0x187),'chat':_0x5c1f46}),_0xfe7965[_0x2a7667(0x188)](_0x5c1f46);};exports['checkAsRead']=checkAsRead;const messages=async(_0x4ec813,_0xa38fe3)=>{const _0x1f9fcc=a14_0x315bae,{pageNumber:_0x1d60d4}=_0x4ec813[_0x1f9fcc(0x1ad)],{id:_0x59cc51}=_0x4ec813['params'],_0xd39502=+_0x4ec813[_0x1f9fcc(0x18d)]['id'],{records:_0x4b38b8,count:_0x3d9a95,hasMore:_0x1d9b98}=await(0x0,FindMessages_1[_0x1f9fcc(0x180)])({'chatId':_0x59cc51,'ownerId':_0xd39502,'pageNumber':_0x1d60d4});return _0xa38fe3['json']({'records':_0x4b38b8,'count':_0x3d9a95,'hasMore':_0x1d9b98});};exports[a14_0x315bae(0x172)]=messages;