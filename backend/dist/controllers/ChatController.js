const a11_0x3d5514=a11_0x4e3d;(function(_0x1e8767,_0x579a52){const _0x3977ca=a11_0x4e3d,_0x3ae5db=_0x1e8767();while(!![]){try{const _0x3eebfe=parseInt(_0x3977ca(0x219))/0x1*(parseInt(_0x3977ca(0x20d))/0x2)+-parseInt(_0x3977ca(0x1f6))/0x3*(parseInt(_0x3977ca(0x20a))/0x4)+-parseInt(_0x3977ca(0x213))/0x5+-parseInt(_0x3977ca(0x1e6))/0x6*(parseInt(_0x3977ca(0x207))/0x7)+-parseInt(_0x3977ca(0x1ff))/0x8+parseInt(_0x3977ca(0x1f1))/0x9+-parseInt(_0x3977ca(0x20f))/0xa*(-parseInt(_0x3977ca(0x210))/0xb);if(_0x3eebfe===_0x579a52)break;else _0x3ae5db['push'](_0x3ae5db['shift']());}catch(_0xe38a84){_0x3ae5db['push'](_0x3ae5db['shift']());}}}(a11_0x596d,0xa690b));function a11_0x4e3d(_0x52ff73,_0x577d85){const _0x1c73f2=a11_0x596d();return a11_0x4e3d=function(_0x3cd925,_0x54e9eb){_0x3cd925=_0x3cd925-0x1e6;let _0x596db1=_0x1c73f2[_0x3cd925];return _0x596db1;},a11_0x4e3d(_0x52ff73,_0x577d85);}const a11_0x54e9eb=(function(){let _0x544458=!![];return function(_0x3744f9,_0x44388a){const _0x22c7f1=_0x544458?function(){const _0x242bf9=a11_0x4e3d;if(_0x44388a){const _0x55844a=_0x44388a[_0x242bf9(0x202)](_0x3744f9,arguments);return _0x44388a=null,_0x55844a;}}:function(){};return _0x544458=![],_0x22c7f1;};}()),a11_0x3cd925=a11_0x54e9eb(this,function(){const _0x9a9589=a11_0x4e3d;return a11_0x3cd925[_0x9a9589(0x1fe)]()[_0x9a9589(0x220)]('(((.+)+)+)+$')[_0x9a9589(0x1fe)]()[_0x9a9589(0x1eb)](a11_0x3cd925)['search'](_0x9a9589(0x20b));});a11_0x3cd925();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x55ad94){const _0x3f66f5=a11_0x4e3d;return _0x55ad94&&_0x55ad94[_0x3f66f5(0x1e8)]?_0x55ad94:{'default':_0x55ad94};};Object[a11_0x3d5514(0x1ec)](exports,a11_0x3d5514(0x1e8),{'value':!![]}),exports[a11_0x3d5514(0x211)]=exports[a11_0x3d5514(0x1fa)]=exports[a11_0x3d5514(0x221)]=exports['remove']=exports[a11_0x3d5514(0x1e7)]=exports[a11_0x3d5514(0x222)]=exports[a11_0x3d5514(0x21a)]=exports['index']=void 0x0;const socket_1=require(a11_0x3d5514(0x1fd)),CreateService_1=__importDefault(require(a11_0x3d5514(0x1ee))),ListService_1=__importDefault(require(a11_0x3d5514(0x1f4))),ShowFromUuidService_1=__importDefault(require(a11_0x3d5514(0x1f5))),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require(a11_0x3d5514(0x21e))),UpdateService_1=__importDefault(require('../services/ChatService/UpdateService')),Chat_1=__importDefault(require('../models/Chat')),CreateMessageService_1=__importDefault(require(a11_0x3d5514(0x1f9))),User_1=__importDefault(require(a11_0x3d5514(0x203))),ChatUser_1=__importDefault(require(a11_0x3d5514(0x218))),index=async(_0x2eb5b5,_0x347e0f)=>{const _0x5ea356=a11_0x3d5514,{pageNumber:_0x51dbb9}=_0x2eb5b5[_0x5ea356(0x212)],_0x2656cd=+_0x2eb5b5['user']['id'],{records:_0x258347,count:_0x27e207,hasMore:_0x559ec0}=await(0x0,ListService_1['default'])({'ownerId':_0x2656cd,'pageNumber':_0x51dbb9});return _0x347e0f[_0x5ea356(0x217)]({'records':_0x258347,'count':_0x27e207,'hasMore':_0x559ec0});};exports[a11_0x3d5514(0x21b)]=index;const store=async(_0x4e313a,_0x144d51)=>{const _0x4ab711=a11_0x3d5514,{companyId:_0x54a952}=_0x4e313a[_0x4ab711(0x21f)],_0x123ae3=+_0x4e313a['user']['id'],_0x324bd2=_0x4e313a[_0x4ab711(0x1ea)],_0x29790a=await(0x0,CreateService_1[_0x4ab711(0x20e)])({..._0x324bd2,'ownerId':_0x123ae3,'companyId':_0x54a952}),_0x1da94a=(0x0,socket_1[_0x4ab711(0x1fb)])();return _0x29790a[_0x4ab711(0x216)][_0x4ab711(0x201)](_0x403974=>{const _0x1305f6=_0x4ab711;_0x1da94a[_0x1305f6(0x1f0)](_0x1305f6(0x1fc)+_0x54a952+_0x1305f6(0x21d)+_0x403974[_0x1305f6(0x1e9)],{'action':'create','record':_0x29790a});}),_0x144d51['status'](0xc8)[_0x4ab711(0x217)](_0x29790a);};exports['store']=store;const update=async(_0x495664,_0x22e9b0)=>{const _0x453c9f=a11_0x3d5514,{companyId:_0x49eb63}=_0x495664[_0x453c9f(0x21f)],_0x1c3614=_0x495664[_0x453c9f(0x1ea)],{id:_0x4f7ae9}=_0x495664[_0x453c9f(0x209)],_0x2418ba=await(0x0,UpdateService_1['default'])({..._0x1c3614,'id':+_0x4f7ae9}),_0x36fda8=(0x0,socket_1[_0x453c9f(0x1fb)])();return _0x2418ba[_0x453c9f(0x216)][_0x453c9f(0x201)](_0xfba717=>{const _0x581624=_0x453c9f;_0x36fda8[_0x581624(0x1f0)](_0x581624(0x1fc)+_0x49eb63+'-chat-user-'+_0xfba717[_0x581624(0x1e9)],{'action':_0x581624(0x222),'record':_0x2418ba});}),_0x22e9b0[_0x453c9f(0x1f7)](0xc8)[_0x453c9f(0x217)](_0x2418ba);};function a11_0x596d(){const _0x4a77d7=['remove','forEach','apply','../models/User','map','user-','originalname','4008529ZHikKm','Chat\x20deleted','params','3124fJiihf','(((.+)+)+)+$','-chat','2PjuUjo','default','10592020TaUknk','22ddEnaX','messages','query','990415OtopRz','mimetype','files','users','json','../models/ChatUser','396179vEZddu','store','index','-chat-','-chat-user-','../services/ChatService/FindMessages','user','search','saveMessage','update','new-message','6dLWqXE','show','__esModule','userId','body','constructor','defineProperty','delete','../services/ChatService/CreateService','findByPk','emit','2178630YNAZIn','owner','all','../services/ChatService/ListService','../services/ChatService/ShowFromUuidService','2037obyuLr','status','findOne','../services/ChatService/CreateMessageService','checkAsRead','getIO','company-','../libs/socket','toString','6186984fkEDRs'];a11_0x596d=function(){return _0x4a77d7;};return a11_0x596d();}exports[a11_0x3d5514(0x222)]=update;const show=async(_0x4dee2d,_0x13deb5)=>{const _0x258256=a11_0x3d5514,{id:_0x67f53c}=_0x4dee2d[_0x258256(0x209)],_0x10ed09=await(0x0,ShowFromUuidService_1[_0x258256(0x20e)])(_0x67f53c);return _0x13deb5['status'](0xc8)[_0x258256(0x217)](_0x10ed09);};exports[a11_0x3d5514(0x1e7)]=show;const remove=async(_0x249b98,_0x53b28a)=>{const _0xdd72b5=a11_0x3d5514,{id:_0x3ec1ae}=_0x249b98['params'],{companyId:_0xd5a24a}=_0x249b98[_0xdd72b5(0x21f)];await(0x0,DeleteService_1[_0xdd72b5(0x20e)])(_0x3ec1ae);const _0x3dd373=(0x0,socket_1[_0xdd72b5(0x1fb)])();return _0x3dd373['emit'](_0xdd72b5(0x1fc)+_0xd5a24a+_0xdd72b5(0x20c),{'action':_0xdd72b5(0x1ed),'id':_0x3ec1ae}),_0x53b28a[_0xdd72b5(0x1f7)](0xc8)[_0xdd72b5(0x217)]({'message':_0xdd72b5(0x208)});};exports[a11_0x3d5514(0x200)]=remove;const saveMessage=async(_0x306bd0,_0x2979a5)=>{const _0xda9735=a11_0x3d5514,_0x380eb5=_0x306bd0[_0xda9735(0x215)],{companyId:_0x544bc7}=_0x306bd0['user'],{message:_0x4f600d}=_0x306bd0[_0xda9735(0x1ea)],{id:_0x2dc7ba}=_0x306bd0[_0xda9735(0x209)],_0x5ef391=+_0x306bd0[_0xda9735(0x21f)]['id'],_0x4f1e87=+_0x2dc7ba;let _0x51013a=null;_0x380eb5?await Promise[_0xda9735(0x1f3)](_0x380eb5[_0xda9735(0x204)](async _0x2417c3=>{const _0x1e6ea5=_0xda9735;_0x51013a=await(0x0,CreateMessageService_1[_0x1e6ea5(0x20e)])({'chatId':_0x4f1e87,'senderId':_0x5ef391,'message':_0x2417c3[_0x1e6ea5(0x206)],'mediaPath':_0x2417c3['filename'],'mediaName':_0x2417c3['originalname'],'mediaType':_0x2417c3[_0x1e6ea5(0x214)]['split']('/')[0x0]});})):_0x51013a=await(0x0,CreateMessageService_1[_0xda9735(0x20e)])({'chatId':_0x4f1e87,'senderId':_0x5ef391,'message':_0x4f600d});const _0x572155=await Chat_1[_0xda9735(0x20e)][_0xda9735(0x1ef)](_0x4f1e87,{'include':[{'model':User_1[_0xda9735(0x20e)],'as':'owner'},{'model':ChatUser_1[_0xda9735(0x20e)],'as':_0xda9735(0x216)}]}),_0x404642=_0x572155[_0xda9735(0x216)]['map'](_0x3eab46=>'user-'+_0x3eab46[_0xda9735(0x1e9)]),_0x2ba665=(0x0,socket_1[_0xda9735(0x1fb)])();return _0x2ba665['to'](_0x404642)[_0xda9735(0x1f0)](_0xda9735(0x1fc)+_0x544bc7+_0xda9735(0x21c)+_0x4f1e87,{'action':_0xda9735(0x223),'newMessage':_0x51013a,'chat':_0x572155}),_0x2ba665['to'](_0x404642)[_0xda9735(0x1f0)](_0xda9735(0x1fc)+_0x544bc7+'-chat',{'action':_0xda9735(0x223),'newMessage':_0x51013a,'chat':_0x572155}),_0x2979a5['json'](_0x51013a);};exports[a11_0x3d5514(0x221)]=saveMessage;const checkAsRead=async(_0x9c9a8a,_0x13c191)=>{const _0x3d6d0f=a11_0x3d5514,{companyId:_0x45174e}=_0x9c9a8a[_0x3d6d0f(0x21f)],{userId:_0x31fbe9}=_0x9c9a8a[_0x3d6d0f(0x1ea)],{id:_0x5b6baa}=_0x9c9a8a[_0x3d6d0f(0x209)],_0x1d26f0=await ChatUser_1[_0x3d6d0f(0x20e)][_0x3d6d0f(0x1f8)]({'where':{'chatId':_0x5b6baa,'userId':_0x31fbe9}});await _0x1d26f0['update']({'unreads':0x0});const _0x425540=await Chat_1[_0x3d6d0f(0x20e)][_0x3d6d0f(0x1ef)](_0x5b6baa,{'include':[{'model':User_1['default'],'as':_0x3d6d0f(0x1f2)},{'model':ChatUser_1['default'],'as':_0x3d6d0f(0x216)}]}),_0x34e8e2=_0x425540[_0x3d6d0f(0x216)][_0x3d6d0f(0x204)](_0x5416ff=>_0x3d6d0f(0x205)+_0x5416ff[_0x3d6d0f(0x1e9)]),_0x22ebfa=(0x0,socket_1[_0x3d6d0f(0x1fb)])();return _0x22ebfa['to'](_0x34e8e2)[_0x3d6d0f(0x1f0)](_0x3d6d0f(0x1fc)+_0x45174e+_0x3d6d0f(0x21c)+_0x5b6baa,{'action':_0x3d6d0f(0x222),'chat':_0x425540}),_0x22ebfa['to'](_0x34e8e2)[_0x3d6d0f(0x1f0)](_0x3d6d0f(0x1fc)+_0x45174e+_0x3d6d0f(0x20c),{'action':_0x3d6d0f(0x222),'chat':_0x425540}),_0x13c191[_0x3d6d0f(0x217)](_0x425540);};exports[a11_0x3d5514(0x1fa)]=checkAsRead;const messages=async(_0x4fae65,_0x6ebc4c)=>{const _0x2154c4=a11_0x3d5514,{pageNumber:_0x1e3dca}=_0x4fae65['query'],{id:_0x588433}=_0x4fae65['params'],_0x2dfcad=+_0x4fae65[_0x2154c4(0x21f)]['id'],{records:_0x5f233b,count:_0x4623cb,hasMore:_0x3af717}=await(0x0,FindMessages_1[_0x2154c4(0x20e)])({'chatId':_0x588433,'ownerId':_0x2dfcad,'pageNumber':_0x1e3dca});return _0x6ebc4c[_0x2154c4(0x217)]({'records':_0x5f233b,'count':_0x4623cb,'hasMore':_0x3af717});};exports[a11_0x3d5514(0x211)]=messages;