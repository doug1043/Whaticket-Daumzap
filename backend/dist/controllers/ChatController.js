const a12_0x5f5d46=a12_0x2bbc;(function(_0xecdff2,_0x2f0a40){const _0x59bfad=a12_0x2bbc,_0x2891d0=_0xecdff2();while(!![]){try{const _0x455b4b=-parseInt(_0x59bfad(0x1b4))/0x1*(-parseInt(_0x59bfad(0x18c))/0x2)+parseInt(_0x59bfad(0x1b7))/0x3+-parseInt(_0x59bfad(0x1a2))/0x4*(parseInt(_0x59bfad(0x1a6))/0x5)+-parseInt(_0x59bfad(0x1a7))/0x6+-parseInt(_0x59bfad(0x191))/0x7+parseInt(_0x59bfad(0x18b))/0x8*(-parseInt(_0x59bfad(0x1ac))/0x9)+parseInt(_0x59bfad(0x18e))/0xa*(parseInt(_0x59bfad(0x198))/0xb);if(_0x455b4b===_0x2f0a40)break;else _0x2891d0['push'](_0x2891d0['shift']());}catch(_0x3b6259){_0x2891d0['push'](_0x2891d0['shift']());}}}(a12_0x5685,0x910d5));const a12_0xf74670=(function(){let _0x3053ab=!![];return function(_0x125237,_0x4d0bad){const _0x4c9979=_0x3053ab?function(){const _0x385278=a12_0x2bbc;if(_0x4d0bad){const _0x5b2da6=_0x4d0bad[_0x385278(0x193)](_0x125237,arguments);return _0x4d0bad=null,_0x5b2da6;}}:function(){};return _0x3053ab=![],_0x4c9979;};}()),a12_0x1dbfa8=a12_0xf74670(this,function(){const _0x489df8=a12_0x2bbc;return a12_0x1dbfa8[_0x489df8(0x1a8)]()[_0x489df8(0x19e)]('(((.+)+)+)+$')['toString']()[_0x489df8(0x1b2)](a12_0x1dbfa8)['search'](_0x489df8(0x19a));});a12_0x1dbfa8();'use strict';var __importDefault=this&&this[a12_0x5f5d46(0x18f)]||function(_0x3e783d){const _0x10f874=a12_0x5f5d46;return _0x3e783d&&_0x3e783d[_0x10f874(0x18d)]?_0x3e783d:{'default':_0x3e783d};};function a12_0x5685(){const _0x4e4098=['toString','../models/User','query','show','798129yPkTsm','Chat\x20deleted','owner','body','../services/ChatService/CreateMessageService','company-','constructor','checkAsRead','1FGIyGQ','findByPk','new-message','1576317VCRdSV','user','delete','../services/ChatService/CreateService','-mainchannel','default','../services/ChatService/ShowFromUuidService','emit','getIO','index','../models/Chat','status','104XsnYlZ','1776782YejCQO','__esModule','70ZuDbiJ','__importDefault','defineProperty','7724584UwOyCN','update','apply','messages','remove','users','-chat-','3379046XOinWf','forEach','(((.+)+)+)+$','json','saveMessage','create','search','../services/ChatService/FindMessages','params','../libs/socket','132GtgMWI','-chat','userId','../services/ChatService/UpdateService','23910Rpstiv','3334968dxowCY'];a12_0x5685=function(){return _0x4e4098;};return a12_0x5685();}Object[a12_0x5f5d46(0x190)](exports,a12_0x5f5d46(0x18d),{'value':!![]}),exports[a12_0x5f5d46(0x194)]=exports[a12_0x5f5d46(0x1b3)]=exports[a12_0x5f5d46(0x19c)]=exports[a12_0x5f5d46(0x195)]=exports[a12_0x5f5d46(0x1ab)]=exports[a12_0x5f5d46(0x192)]=exports['store']=exports[a12_0x5f5d46(0x1c0)]=void 0x0;const socket_1=require(a12_0x5f5d46(0x1a1)),CreateService_1=__importDefault(require(a12_0x5f5d46(0x1ba))),ListService_1=__importDefault(require('../services/ChatService/ListService')),ShowFromUuidService_1=__importDefault(require(a12_0x5f5d46(0x1bd))),DeleteService_1=__importDefault(require('../services/ChatService/DeleteService')),FindMessages_1=__importDefault(require(a12_0x5f5d46(0x19f))),UpdateService_1=__importDefault(require(a12_0x5f5d46(0x1a5))),Chat_1=__importDefault(require(a12_0x5f5d46(0x1c1))),CreateMessageService_1=__importDefault(require(a12_0x5f5d46(0x1b0))),User_1=__importDefault(require(a12_0x5f5d46(0x1a9))),ChatUser_1=__importDefault(require('../models/ChatUser')),index=async(_0x114830,_0x1589de)=>{const _0x3aa762=a12_0x5f5d46,{pageNumber:_0x36f78f}=_0x114830['query'],_0x205a58=+_0x114830[_0x3aa762(0x1b8)]['id'],{records:_0x40c419,count:_0x2aae8c,hasMore:_0x5e76cd}=await(0x0,ListService_1[_0x3aa762(0x1bc)])({'ownerId':_0x205a58,'pageNumber':_0x36f78f});return _0x1589de['json']({'records':_0x40c419,'count':_0x2aae8c,'hasMore':_0x5e76cd});};exports[a12_0x5f5d46(0x1c0)]=index;const store=async(_0x2672af,_0x39b36f)=>{const _0x235ce9=a12_0x5f5d46,{companyId:_0x278bea}=_0x2672af[_0x235ce9(0x1b8)],_0xe4ffd=+_0x2672af[_0x235ce9(0x1b8)]['id'],_0x80cc10=_0x2672af[_0x235ce9(0x1af)],_0x14e0b0=await(0x0,CreateService_1[_0x235ce9(0x1bc)])({..._0x80cc10,'ownerId':_0xe4ffd,'companyId':_0x278bea}),_0x45d3a3=(0x0,socket_1[_0x235ce9(0x1bf)])();return _0x14e0b0[_0x235ce9(0x196)][_0x235ce9(0x199)](_0x3d67e6=>{const _0x43452b=_0x235ce9;_0x45d3a3['to'](_0x43452b(0x1b1)+_0x278bea+'-mainchannel')[_0x43452b(0x1be)](_0x43452b(0x1b1)+_0x278bea+'-chat-user-'+_0x3d67e6['userId'],{'action':_0x43452b(0x19d),'record':_0x14e0b0});}),_0x39b36f[_0x235ce9(0x18a)](0xc8)['json'](_0x14e0b0);};exports['store']=store;const update=async(_0x26f59e,_0x42aaa6)=>{const _0xe6d66=a12_0x5f5d46,{companyId:_0x1ebef5}=_0x26f59e['user'],_0x366a8e=_0x26f59e[_0xe6d66(0x1af)],{id:_0x9b03fa}=_0x26f59e[_0xe6d66(0x1a0)],_0x311d30=await(0x0,UpdateService_1[_0xe6d66(0x1bc)])({..._0x366a8e,'id':+_0x9b03fa}),_0x340b8d=(0x0,socket_1[_0xe6d66(0x1bf)])();return _0x311d30[_0xe6d66(0x196)]['forEach'](_0x2c5004=>{const _0x393a34=_0xe6d66;_0x340b8d['to'](_0x393a34(0x1b1)+_0x1ebef5+_0x393a34(0x1bb))[_0x393a34(0x1be)]('company-'+_0x1ebef5+'-chat-user-'+_0x2c5004[_0x393a34(0x1a4)],{'action':_0x393a34(0x192),'record':_0x311d30});}),_0x42aaa6['status'](0xc8)[_0xe6d66(0x19b)](_0x311d30);};exports[a12_0x5f5d46(0x192)]=update;const show=async(_0x237bd4,_0x5193e2)=>{const _0x419529=a12_0x5f5d46,{id:_0x15defc}=_0x237bd4[_0x419529(0x1a0)],_0x5ca17b=await(0x0,ShowFromUuidService_1[_0x419529(0x1bc)])(_0x15defc);return _0x5193e2[_0x419529(0x18a)](0xc8)[_0x419529(0x19b)](_0x5ca17b);};exports[a12_0x5f5d46(0x1ab)]=show;const remove=async(_0x543d95,_0x35408b)=>{const _0x2e75ac=a12_0x5f5d46,{id:_0x29e912}=_0x543d95[_0x2e75ac(0x1a0)],{companyId:_0x7c1908}=_0x543d95[_0x2e75ac(0x1b8)];await(0x0,DeleteService_1[_0x2e75ac(0x1bc)])(_0x29e912);const _0x43aa91=(0x0,socket_1['getIO'])();return _0x43aa91['to']('company-'+_0x7c1908+_0x2e75ac(0x1bb))[_0x2e75ac(0x1be)](_0x2e75ac(0x1b1)+_0x7c1908+_0x2e75ac(0x1a3),{'action':_0x2e75ac(0x1b9),'id':_0x29e912}),_0x35408b[_0x2e75ac(0x18a)](0xc8)[_0x2e75ac(0x19b)]({'message':_0x2e75ac(0x1ad)});};exports[a12_0x5f5d46(0x195)]=remove;const saveMessage=async(_0x2d84a3,_0x142253)=>{const _0x49757b=a12_0x5f5d46,{companyId:_0x59d807}=_0x2d84a3[_0x49757b(0x1b8)],{message:_0xcac4c7}=_0x2d84a3[_0x49757b(0x1af)],{id:_0x309ff4}=_0x2d84a3[_0x49757b(0x1a0)],_0xbce1d5=+_0x2d84a3['user']['id'],_0x261521=+_0x309ff4,_0x3c8043=await(0x0,CreateMessageService_1[_0x49757b(0x1bc)])({'chatId':_0x261521,'senderId':_0xbce1d5,'message':_0xcac4c7}),_0x17d98f=await Chat_1[_0x49757b(0x1bc)][_0x49757b(0x1b5)](_0x261521,{'include':[{'model':User_1['default'],'as':_0x49757b(0x1ae)},{'model':ChatUser_1['default'],'as':_0x49757b(0x196)}]}),_0x1dd1ae=(0x0,socket_1['getIO'])();return _0x1dd1ae['to'](_0x49757b(0x1b1)+_0x59d807+_0x49757b(0x1bb))['emit'](_0x49757b(0x1b1)+_0x59d807+_0x49757b(0x197)+_0x261521,{'action':'new-message','newMessage':_0x3c8043,'chat':_0x17d98f}),_0x1dd1ae['to']('company-'+_0x59d807+'-mainchannel')['emit'](_0x49757b(0x1b1)+_0x59d807+_0x49757b(0x1a3),{'action':_0x49757b(0x1b6),'newMessage':_0x3c8043,'chat':_0x17d98f}),_0x142253['json'](_0x3c8043);};function a12_0x2bbc(_0x58f807,_0x383c4f){const _0x1ee332=a12_0x5685();return a12_0x2bbc=function(_0x1dbfa8,_0xf74670){_0x1dbfa8=_0x1dbfa8-0x18a;let _0x56858e=_0x1ee332[_0x1dbfa8];return _0x56858e;},a12_0x2bbc(_0x58f807,_0x383c4f);}exports[a12_0x5f5d46(0x19c)]=saveMessage;const checkAsRead=async(_0x52322b,_0x322eb6)=>{const _0x32320d=a12_0x5f5d46,{companyId:_0x42f4fe}=_0x52322b[_0x32320d(0x1b8)],{userId:_0x83ea10}=_0x52322b['body'],{id:_0xb6b4e7}=_0x52322b[_0x32320d(0x1a0)],_0x3fa2ab=await ChatUser_1['default']['findOne']({'where':{'chatId':_0xb6b4e7,'userId':_0x83ea10}});await _0x3fa2ab[_0x32320d(0x192)]({'unreads':0x0});const _0x4519ab=await Chat_1[_0x32320d(0x1bc)][_0x32320d(0x1b5)](_0xb6b4e7,{'include':[{'model':User_1[_0x32320d(0x1bc)],'as':'owner'},{'model':ChatUser_1[_0x32320d(0x1bc)],'as':'users'}]}),_0x422fe8=(0x0,socket_1[_0x32320d(0x1bf)])();return _0x422fe8['to'](_0x32320d(0x1b1)+_0x42f4fe+_0x32320d(0x1bb))['emit'](_0x32320d(0x1b1)+_0x42f4fe+_0x32320d(0x197)+_0xb6b4e7,{'action':_0x32320d(0x192),'chat':_0x4519ab}),_0x422fe8['to'](_0x32320d(0x1b1)+_0x42f4fe+_0x32320d(0x1bb))[_0x32320d(0x1be)](_0x32320d(0x1b1)+_0x42f4fe+_0x32320d(0x1a3),{'action':_0x32320d(0x192),'chat':_0x4519ab}),_0x322eb6[_0x32320d(0x19b)](_0x4519ab);};exports[a12_0x5f5d46(0x1b3)]=checkAsRead;const messages=async(_0x44a934,_0x40483b)=>{const _0x241ec3=a12_0x5f5d46,{pageNumber:_0x331f07}=_0x44a934[_0x241ec3(0x1aa)],{id:_0x2b1891}=_0x44a934['params'],_0x369803=+_0x44a934['user']['id'],{records:_0x59464c,count:_0x152ae6,hasMore:_0x2de352}=await(0x0,FindMessages_1[_0x241ec3(0x1bc)])({'chatId':_0x2b1891,'ownerId':_0x369803,'pageNumber':_0x331f07});return _0x40483b[_0x241ec3(0x19b)]({'records':_0x59464c,'count':_0x152ae6,'hasMore':_0x2de352});};exports[a12_0x5f5d46(0x194)]=messages;