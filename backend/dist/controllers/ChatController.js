const a11_0x4f9526=a11_0x18fd;(function(_0x2ee8c0,_0x3f765c){const _0x2dd145=a11_0x18fd,_0x1083c6=_0x2ee8c0();while(!![]){try{const _0x32e857=parseInt(_0x2dd145(0xc7))/0x1*(-parseInt(_0x2dd145(0xad))/0x2)+-parseInt(_0x2dd145(0xc9))/0x3*(-parseInt(_0x2dd145(0xc1))/0x4)+parseInt(_0x2dd145(0xa9))/0x5*(parseInt(_0x2dd145(0xa7))/0x6)+parseInt(_0x2dd145(0xb0))/0x7+parseInt(_0x2dd145(0xb9))/0x8*(parseInt(_0x2dd145(0xce))/0x9)+-parseInt(_0x2dd145(0xd2))/0xa+-parseInt(_0x2dd145(0xd4))/0xb*(parseInt(_0x2dd145(0xb8))/0xc);if(_0x32e857===_0x3f765c)break;else _0x1083c6['push'](_0x1083c6['shift']());}catch(_0x58479a){_0x1083c6['push'](_0x1083c6['shift']());}}}(a11_0x3ded,0x9d754));const a11_0x1ef455=(function(){let _0x15e0bd=!![];return function(_0x5f190a,_0x281ac6){const _0x75aed1=_0x15e0bd?function(){const _0x3fd585=a11_0x18fd;if(_0x281ac6){const _0x5bb9ce=_0x281ac6[_0x3fd585(0xb5)](_0x5f190a,arguments);return _0x281ac6=null,_0x5bb9ce;}}:function(){};return _0x15e0bd=![],_0x75aed1;};}()),a11_0x2f652f=a11_0x1ef455(this,function(){const _0x2cbf81=a11_0x18fd;return a11_0x2f652f['toString']()[_0x2cbf81(0xb4)](_0x2cbf81(0xb3))['toString']()[_0x2cbf81(0xcd)](a11_0x2f652f)[_0x2cbf81(0xb4)]('(((.+)+)+)+$');});function a11_0x18fd(_0x57cad3,_0x4b704b){const _0x31103a=a11_0x3ded();return a11_0x18fd=function(_0x2f652f,_0x1ef455){_0x2f652f=_0x2f652f-0x9b;let _0x3ded48=_0x31103a[_0x2f652f];return _0x3ded48;},a11_0x18fd(_0x57cad3,_0x4b704b);}a11_0x2f652f();'use strict';var __importDefault=this&&this[a11_0x4f9526(0xb7)]||function(_0x44988c){const _0x275337=a11_0x4f9526;return _0x44988c&&_0x44988c[_0x275337(0xcc)]?_0x44988c:{'default':_0x44988c};};Object[a11_0x4f9526(0xab)](exports,a11_0x4f9526(0xcc),{'value':!![]}),exports[a11_0x4f9526(0xcf)]=exports[a11_0x4f9526(0xae)]=exports[a11_0x4f9526(0xa5)]=exports[a11_0x4f9526(0xa0)]=exports[a11_0x4f9526(0xa6)]=exports[a11_0x4f9526(0xc4)]=exports[a11_0x4f9526(0x9d)]=exports['index']=void 0x0;const socket_1=require('../libs/socket'),CreateService_1=__importDefault(require('../services/ChatService/CreateService')),ListService_1=__importDefault(require(a11_0x4f9526(0x9c))),ShowFromUuidService_1=__importDefault(require(a11_0x4f9526(0xc8))),DeleteService_1=__importDefault(require(a11_0x4f9526(0xbd))),FindMessages_1=__importDefault(require(a11_0x4f9526(0xc5))),UpdateService_1=__importDefault(require('../services/ChatService/UpdateService')),Chat_1=__importDefault(require('../models/Chat')),CreateMessageService_1=__importDefault(require('../services/ChatService/CreateMessageService')),User_1=__importDefault(require('../models/User')),ChatUser_1=__importDefault(require(a11_0x4f9526(0xaa))),index=async(_0x1186b1,_0x5a1ad1)=>{const _0x13529f=a11_0x4f9526,{pageNumber:_0x2335ad}=_0x1186b1[_0x13529f(0xa1)],_0x3c704f=+_0x1186b1[_0x13529f(0xb1)]['id'],{records:_0x23b783,count:_0x3d229c,hasMore:_0x12998a}=await(0x0,ListService_1[_0x13529f(0xc0)])({'ownerId':_0x3c704f,'pageNumber':_0x2335ad});return _0x5a1ad1[_0x13529f(0xaf)]({'records':_0x23b783,'count':_0x3d229c,'hasMore':_0x12998a});};exports['index']=index;const store=async(_0x1baa7c,_0x59b48d)=>{const _0x12d478=a11_0x4f9526,{companyId:_0x576811}=_0x1baa7c[_0x12d478(0xb1)],_0x1e984d=+_0x1baa7c['user']['id'],_0xbacfb9=_0x1baa7c[_0x12d478(0xd6)],_0x27e319=await(0x0,CreateService_1[_0x12d478(0xc0)])({..._0xbacfb9,'ownerId':_0x1e984d,'companyId':_0x576811}),_0x123f1b=(0x0,socket_1[_0x12d478(0x9f)])();return _0x27e319['users'][_0x12d478(0xa8)](_0x3f562b=>{const _0x285c22=_0x12d478;_0x123f1b['emit'](_0x285c22(0xba)+_0x576811+_0x285c22(0xbc)+_0x3f562b[_0x285c22(0xcb)],{'action':_0x285c22(0xbf),'record':_0x27e319});}),_0x59b48d['status'](0xc8)[_0x12d478(0xaf)](_0x27e319);};exports[a11_0x4f9526(0x9d)]=store;const update=async(_0x24ba19,_0x1c9f8e)=>{const _0x1f5426=a11_0x4f9526,{companyId:_0x45c564}=_0x24ba19[_0x1f5426(0xb1)],_0x32c158=_0x24ba19[_0x1f5426(0xd6)],{id:_0x2ce7a0}=_0x24ba19[_0x1f5426(0xd1)],_0x3f5d18=await(0x0,UpdateService_1[_0x1f5426(0xc0)])({..._0x32c158,'id':+_0x2ce7a0}),_0x3b4244=(0x0,socket_1[_0x1f5426(0x9f)])();return _0x3f5d18[_0x1f5426(0xbb)]['forEach'](_0x7f4b03=>{const _0x5cc783=_0x1f5426;_0x3b4244[_0x5cc783(0x9e)](_0x5cc783(0xba)+_0x45c564+_0x5cc783(0xbc)+_0x7f4b03[_0x5cc783(0xcb)],{'action':_0x5cc783(0xc4),'record':_0x3f5d18});}),_0x1c9f8e[_0x1f5426(0xb2)](0xc8)['json'](_0x3f5d18);};exports['update']=update;const show=async(_0x3e9614,_0x708b55)=>{const _0x3f8424=a11_0x4f9526,{id:_0x4e20d6}=_0x3e9614['params'],_0x2de8d2=await(0x0,ShowFromUuidService_1['default'])(_0x4e20d6);return _0x708b55[_0x3f8424(0xb2)](0xc8)[_0x3f8424(0xaf)](_0x2de8d2);};exports['show']=show;const remove=async(_0x2ff316,_0x10282b)=>{const _0xf171f0=a11_0x4f9526,{id:_0x4d79de}=_0x2ff316[_0xf171f0(0xd1)],{companyId:_0x586571}=_0x2ff316['user'];await(0x0,DeleteService_1['default'])(_0x4d79de);const _0x29bbf4=(0x0,socket_1[_0xf171f0(0x9f)])();return _0x29bbf4['emit'](_0xf171f0(0xba)+_0x586571+_0xf171f0(0xb6),{'action':_0xf171f0(0xa3),'id':_0x4d79de}),_0x10282b[_0xf171f0(0xb2)](0xc8)[_0xf171f0(0xaf)]({'message':_0xf171f0(0xd0)});};exports[a11_0x4f9526(0xa0)]=remove;const saveMessage=async(_0x3e7312,_0x3ba509)=>{const _0x444a26=a11_0x4f9526,_0x233a3c=_0x3e7312[_0x444a26(0xbe)],{companyId:_0x4c6514}=_0x3e7312['user'],{message:_0x2530cf}=_0x3e7312[_0x444a26(0xd6)],{id:_0x4d4baf}=_0x3e7312[_0x444a26(0xd1)],_0x5d287d=+_0x3e7312['user']['id'],_0x35dc6b=+_0x4d4baf;let _0x23e6cb=null;_0x233a3c?await Promise[_0x444a26(0xa4)](_0x233a3c[_0x444a26(0xd5)](async _0x8d6375=>{const _0x43f91e=_0x444a26;_0x23e6cb=await(0x0,CreateMessageService_1[_0x43f91e(0xc0)])({'chatId':_0x35dc6b,'senderId':_0x5d287d,'message':_0x8d6375[_0x43f91e(0xca)],'mediaPath':_0x8d6375[_0x43f91e(0xa2)],'mediaName':_0x8d6375['originalname'],'mediaType':_0x8d6375['mimetype'][_0x43f91e(0x9b)]('/')[0x0]});})):_0x23e6cb=await(0x0,CreateMessageService_1['default'])({'chatId':_0x35dc6b,'senderId':_0x5d287d,'message':_0x2530cf});const _0x376255=await Chat_1['default'][_0x444a26(0xc3)](_0x35dc6b,{'include':[{'model':User_1['default'],'as':'owner'},{'model':ChatUser_1[_0x444a26(0xc0)],'as':_0x444a26(0xbb)}]}),_0x578f08=_0x376255[_0x444a26(0xbb)]['map'](_0x4f3665=>_0x444a26(0xc2)+_0x4f3665[_0x444a26(0xcb)]),_0x686ca1=(0x0,socket_1[_0x444a26(0x9f)])();return _0x686ca1['to'](_0x578f08)[_0x444a26(0x9e)](_0x444a26(0xba)+_0x4c6514+_0x444a26(0xc6)+_0x35dc6b,{'action':_0x444a26(0xd3),'newMessage':_0x23e6cb,'chat':_0x376255}),_0x686ca1['to'](_0x578f08)['emit'](_0x444a26(0xba)+_0x4c6514+_0x444a26(0xb6),{'action':_0x444a26(0xd3),'newMessage':_0x23e6cb,'chat':_0x376255}),_0x3ba509['json'](_0x23e6cb);};exports[a11_0x4f9526(0xa5)]=saveMessage;const checkAsRead=async(_0x342752,_0x190a36)=>{const _0x36a9d4=a11_0x4f9526,{companyId:_0x288aac}=_0x342752[_0x36a9d4(0xb1)],{userId:_0x321748}=_0x342752[_0x36a9d4(0xd6)],{id:_0x520f77}=_0x342752[_0x36a9d4(0xd1)],_0x3aeb44=await ChatUser_1[_0x36a9d4(0xc0)]['findOne']({'where':{'chatId':_0x520f77,'userId':_0x321748}});await _0x3aeb44[_0x36a9d4(0xc4)]({'unreads':0x0});const _0x1542bf=await Chat_1['default']['findByPk'](_0x520f77,{'include':[{'model':User_1['default'],'as':_0x36a9d4(0xac)},{'model':ChatUser_1['default'],'as':'users'}]}),_0x143568=_0x1542bf[_0x36a9d4(0xbb)][_0x36a9d4(0xd5)](_0x41ea75=>_0x36a9d4(0xc2)+_0x41ea75[_0x36a9d4(0xcb)]),_0x504c9d=(0x0,socket_1['getIO'])();return _0x504c9d['to'](_0x143568)[_0x36a9d4(0x9e)](_0x36a9d4(0xba)+_0x288aac+_0x36a9d4(0xc6)+_0x520f77,{'action':_0x36a9d4(0xc4),'chat':_0x1542bf}),_0x504c9d['to'](_0x143568)['emit'](_0x36a9d4(0xba)+_0x288aac+_0x36a9d4(0xb6),{'action':_0x36a9d4(0xc4),'chat':_0x1542bf}),_0x190a36[_0x36a9d4(0xaf)](_0x1542bf);};exports[a11_0x4f9526(0xae)]=checkAsRead;const messages=async(_0x1ca1a0,_0xb5ba0b)=>{const _0x3f102d=a11_0x4f9526,{pageNumber:_0x1a0317}=_0x1ca1a0[_0x3f102d(0xa1)],{id:_0x58f08e}=_0x1ca1a0[_0x3f102d(0xd1)],_0x2733ef=+_0x1ca1a0['user']['id'],{records:_0x3949ed,count:_0x4df856,hasMore:_0x1c452c}=await(0x0,FindMessages_1[_0x3f102d(0xc0)])({'chatId':_0x58f08e,'ownerId':_0x2733ef,'pageNumber':_0x1a0317});return _0xb5ba0b['json']({'records':_0x3949ed,'count':_0x4df856,'hasMore':_0x1c452c});};exports[a11_0x4f9526(0xcf)]=messages;function a11_0x3ded(){const _0xae21a5=['company-','users','-chat-user-','../services/ChatService/DeleteService','files','create','default','17044OvohSi','user-','findByPk','update','../services/ChatService/FindMessages','-chat-','5gWoWtX','../services/ChatService/ShowFromUuidService','615zwrziJ','originalname','userId','__esModule','constructor','43722TwjZpL','messages','Chat\x20deleted','params','3102890CKQHxW','new-message','68079CsCgOQ','map','body','split','../services/ChatService/ListService','store','emit','getIO','remove','query','filename','delete','all','saveMessage','show','1064418wTUOZA','forEach','15cqEfLg','../models/ChatUser','defineProperty','owner','102206xhyKXt','checkAsRead','json','4957673pVrGwI','user','status','(((.+)+)+)+$','search','apply','-chat','__importDefault','3588fXBStJ','1560IztIXy'];a11_0x3ded=function(){return _0xae21a5;};return a11_0x3ded();}