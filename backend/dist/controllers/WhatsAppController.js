const a46_0x178867=a46_0x4c96;(function(_0xfc0e09,_0x1efbcd){const _0x3f2e56=a46_0x4c96,_0x399138=_0xfc0e09();while(!![]){try{const _0x56b4f2=-parseInt(_0x3f2e56(0x192))/0x1+parseInt(_0x3f2e56(0x1a0))/0x2+parseInt(_0x3f2e56(0x195))/0x3+-parseInt(_0x3f2e56(0x18f))/0x4+-parseInt(_0x3f2e56(0x1a7))/0x5*(-parseInt(_0x3f2e56(0x19e))/0x6)+parseInt(_0x3f2e56(0x177))/0x7+-parseInt(_0x3f2e56(0x17b))/0x8;if(_0x56b4f2===_0x1efbcd)break;else _0x399138['push'](_0x399138['shift']());}catch(_0x132bce){_0x399138['push'](_0x399138['shift']());}}}(a46_0x325f,0xadc93));function a46_0x4c96(_0x2d8dec,_0x4734e8){const _0x4f774a=a46_0x325f();return a46_0x4c96=function(_0x2155cd,_0x3b2d7a){_0x2155cd=_0x2155cd-0x16d;let _0x325fff=_0x4f774a[_0x2155cd];return _0x325fff;},a46_0x4c96(_0x2d8dec,_0x4734e8);}const a46_0x3b2d7a=(function(){let _0x85cb63=!![];return function(_0x5ad24c,_0x237ffc){const _0x3d1780=_0x85cb63?function(){const _0x5a10d4=a46_0x4c96;if(_0x237ffc){const _0x318d85=_0x237ffc[_0x5a10d4(0x176)](_0x5ad24c,arguments);return _0x237ffc=null,_0x318d85;}}:function(){};return _0x85cb63=![],_0x3d1780;};}()),a46_0x2155cd=a46_0x3b2d7a(this,function(){const _0x43ce3b=a46_0x4c96;return a46_0x2155cd[_0x43ce3b(0x16d)]()[_0x43ce3b(0x183)](_0x43ce3b(0x17d))[_0x43ce3b(0x16d)]()['constructor'](a46_0x2155cd)['search'](_0x43ce3b(0x17d));});a46_0x2155cd();'use strict';var __importDefault=this&&this[a46_0x178867(0x17a)]||function(_0x3936c2){return _0x3936c2&&_0x3936c2['__esModule']?_0x3936c2:{'default':_0x3936c2};};function a46_0x325f(){const _0x387358=['remove','Whatsapp\x20deleted.','24uoVTRJ','-mainchannel','743488gOSZvs','query','body','status','../errors/AppError','../libs/socket','company-','1299535eBXvIT','-whatsapp','number','toString','whatsapp','Failed\x20to\x20fetch\x20connections','Whatsapp\x20restart.','admin','../services/WhatsappService/DeleteWhatsAppService','params','ERR_NO_PERMISSION','closedTickets','apply','3159100iawMVB','length','error','__importDefault','1827432iFjmsr','removeWbot','(((.+)+)+)+$','../libs/wbot','getAllConnections','open','findAll','store','search','../services/WhatsappService/UpdateWhatsAppService','sequelize','../services/WhatsappService/ListWhatsAppsService','show','emit','No\x20companies\x20found','../services/WhatsappService/ShowWhatsAppService','StartWhatsAppSession','../services/CompanyService/FindAllCompaniesService','update','__esModule','1832856JpfsIo','getIO','restartWbot','899311czjfsk','user','closeImportedTickets','1305327TyWymP','push','restart','default','../services/WhatsappService/ImportWhatsAppMessageService','json','index'];a46_0x325f=function(){return _0x387358;};return a46_0x325f();}Object['defineProperty'](exports,a46_0x178867(0x18e),{'value':!![]}),exports[a46_0x178867(0x197)]=exports[a46_0x178867(0x19c)]=exports[a46_0x178867(0x18d)]=exports[a46_0x178867(0x17f)]=exports[a46_0x178867(0x187)]=exports[a46_0x178867(0x182)]=exports['index']=exports[a46_0x178867(0x175)]=void 0x0;const socket_1=require(a46_0x178867(0x1a5)),wbot_1=require(a46_0x178867(0x17e)),StartWhatsAppSession_1=require('../services/WbotServices/StartWhatsAppSession'),FindAllCompaniesService_1=__importDefault(require(a46_0x178867(0x18c))),CreateWhatsAppService_1=__importDefault(require('../services/WhatsappService/CreateWhatsAppService')),DeleteWhatsAppService_1=__importDefault(require(a46_0x178867(0x172))),ListWhatsAppsService_1=__importDefault(require(a46_0x178867(0x186))),ShowWhatsAppService_1=__importDefault(require(a46_0x178867(0x18a))),UpdateWhatsAppService_1=__importDefault(require(a46_0x178867(0x184))),AppError_1=__importDefault(require(a46_0x178867(0x1a4))),sequelize_1=require(a46_0x178867(0x185)),ImportWhatsAppMessageService_1=require(a46_0x178867(0x199)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),closedTickets=async(_0x2943ec,_0x3b1585)=>{const _0x542885=a46_0x178867,{whatsappId:_0xd438ee}=_0x2943ec[_0x542885(0x173)];return await(0x0,ImportWhatsAppMessageService_1[_0x542885(0x194)])(_0xd438ee),_0x3b1585['status'](0xc8)['json'](_0x542885(0x16e));};exports[a46_0x178867(0x175)]=closedTickets;const index=async(_0x303d20,_0x5a5432)=>{const _0x3e62a2=a46_0x178867,{companyId:_0xa02a12}=_0x303d20[_0x3e62a2(0x193)],{session:_0x3f6b2c}=_0x303d20['query'],_0x2ddf9d=await(0x0,ListWhatsAppsService_1[_0x3e62a2(0x198)])({'companyId':_0xa02a12,'session':_0x3f6b2c});return _0x5a5432[_0x3e62a2(0x1a3)](0xc8)[_0x3e62a2(0x19a)](_0x2ddf9d);};exports[a46_0x178867(0x19b)]=index;const store=async(_0x50375b,_0x42c6b0)=>{const _0xe030e4=a46_0x178867,{name:_0x14e595,status:_0x3fb4d9,isDefault:_0x4e951c,greetingMessage:_0x340461,complationMessage:_0xc0e417,outOfHoursMessage:_0x17179b,queueIds:_0x139a21,token:_0x87d69e,allowGroup:_0x5648fb,timeSendQueue:_0x466926,sendIdQueue:_0x6957a6,promptId:_0x3e1978,maxUseBotQueues:_0x5f26ee,timeUseBotQueues:_0x1d0bfc,expiresTicket:_0x3fde2f,expiresInactiveMessage:_0x39a927,importOldMessages:_0x44a41d,importRecentMessages:_0x25ad3f,closedTicketsPostImported:_0x25e0c4,importOldMessagesGroups:_0x5659ac}=_0x50375b[_0xe030e4(0x1a2)],{companyId:_0x44de05}=_0x50375b[_0xe030e4(0x193)],{whatsapp:_0x5f269c,oldDefaultWhatsapp:_0x5ab3cb}=await(0x0,CreateWhatsAppService_1[_0xe030e4(0x198)])({'name':_0x14e595,'status':_0x3fb4d9,'isDefault':_0x4e951c,'greetingMessage':_0x340461,'complationMessage':_0xc0e417,'outOfHoursMessage':_0x17179b,'queueIds':_0x139a21,'companyId':_0x44de05,'token':_0x87d69e,'timeSendQueue':_0x466926,'sendIdQueue':_0x6957a6,'promptId':_0x3e1978,'maxUseBotQueues':_0x5f26ee,'timeUseBotQueues':_0x1d0bfc,'expiresTicket':_0x3fde2f,'expiresInactiveMessage':_0x39a927,'allowGroup':_0x5648fb,'importOldMessages':_0x44a41d,'importRecentMessages':_0x25ad3f,'closedTicketsPostImported':_0x25e0c4,'importOldMessagesGroups':_0x5659ac});(0x0,StartWhatsAppSession_1[_0xe030e4(0x18b)])(_0x5f269c,_0x44de05);const _0x53334c=(0x0,socket_1[_0xe030e4(0x190)])();return _0x53334c['to'](_0xe030e4(0x1a6)+_0x44de05+_0xe030e4(0x19f))[_0xe030e4(0x188)](_0xe030e4(0x1a6)+_0x44de05+_0xe030e4(0x1a8),{'action':_0xe030e4(0x18d),'whatsapp':_0x5f269c}),_0x5ab3cb&&_0x53334c['to'](_0xe030e4(0x1a6)+_0x44de05+_0xe030e4(0x19f))[_0xe030e4(0x188)](_0xe030e4(0x1a6)+_0x44de05+_0xe030e4(0x1a8),{'action':_0xe030e4(0x18d),'whatsapp':_0x5ab3cb}),_0x42c6b0[_0xe030e4(0x1a3)](0xc8)[_0xe030e4(0x19a)](_0x5f269c);};exports['store']=store;const show=async(_0x14b304,_0x119020)=>{const _0x4096d9=a46_0x178867,{whatsappId:_0x4b4958}=_0x14b304[_0x4096d9(0x173)],{companyId:_0x22c4f3}=_0x14b304[_0x4096d9(0x193)],{session:_0x5caedf}=_0x14b304[_0x4096d9(0x1a1)],_0x243fde=await(0x0,ShowWhatsAppService_1[_0x4096d9(0x198)])(_0x4b4958,_0x22c4f3,_0x5caedf);return _0x119020[_0x4096d9(0x1a3)](0xc8)[_0x4096d9(0x19a)](_0x243fde);};exports[a46_0x178867(0x187)]=show;const getAllConnections=async(_0x5e27b7,_0x3e2dac)=>{const _0x13b17=a46_0x178867;try{const _0x32dd5a=await(0x0,FindAllCompaniesService_1[_0x13b17(0x198)])();if(!_0x32dd5a||_0x32dd5a[_0x13b17(0x178)]===0x0)return _0x3e2dac[_0x13b17(0x1a3)](0x194)[_0x13b17(0x19a)]({'error':_0x13b17(0x189)});const _0x220dab=[];for(const _0xc12459 of _0x32dd5a){if(typeof _0xc12459['id']!==_0x13b17(0x1a9))continue;const _0x727bc9=await Whatsapp_1[_0x13b17(0x198)][_0x13b17(0x181)]({'where':{'companyId':_0xc12459['id']}});_0x220dab[_0x13b17(0x196)](..._0x727bc9);}return _0x3e2dac[_0x13b17(0x1a3)](0xc8)[_0x13b17(0x19a)](_0x220dab);}catch(_0x157149){return console[_0x13b17(0x179)](_0x157149),_0x3e2dac['status'](0x1f4)[_0x13b17(0x19a)]({'error':_0x13b17(0x16f)});}};exports[a46_0x178867(0x17f)]=getAllConnections;const update=async(_0x2ea9ef,_0x47fae3)=>{const _0x2da0c1=a46_0x178867,{whatsappId:_0x2cbd47}=_0x2ea9ef[_0x2da0c1(0x173)],_0x2d633d=_0x2ea9ef[_0x2da0c1(0x1a2)],{companyId:_0x151780}=_0x2ea9ef[_0x2da0c1(0x193)],{whatsapp:_0x5e4619,oldDefaultWhatsapp:_0x3616a4}=await(0x0,UpdateWhatsAppService_1['default'])({'whatsappData':_0x2d633d,'whatsappId':_0x2cbd47,'companyId':_0x151780}),_0x1d0fcc=(0x0,socket_1[_0x2da0c1(0x190)])();return _0x1d0fcc['to'](_0x2da0c1(0x1a6)+_0x151780+_0x2da0c1(0x19f))[_0x2da0c1(0x188)]('company-'+_0x151780+_0x2da0c1(0x1a8),{'action':_0x2da0c1(0x18d),'whatsapp':_0x5e4619}),_0x3616a4&&_0x1d0fcc['to'](_0x2da0c1(0x1a6)+_0x151780+_0x2da0c1(0x19f))[_0x2da0c1(0x188)]('company-'+_0x151780+'-whatsapp',{'action':'update','whatsapp':_0x3616a4}),_0x47fae3[_0x2da0c1(0x1a3)](0xc8)['json'](_0x5e4619);};exports[a46_0x178867(0x18d)]=update;const remove=async(_0x4108aa,_0x40868b)=>{const _0x15708f=a46_0x178867,{whatsappId:_0x4e0e31}=_0x4108aa[_0x15708f(0x173)],{companyId:_0x39d08c}=_0x4108aa[_0x15708f(0x193)],_0x4d5e60=await(0x0,ShowWhatsAppService_1[_0x15708f(0x198)])(_0x4e0e31,_0x39d08c),_0x1ea8d5=await _0x4d5e60['$get']('tickets',{'where':{'status':{[sequelize_1['Op']['or']]:[_0x15708f(0x180),'pending']}}});if(_0x1ea8d5[_0x15708f(0x178)]>0x0)throw new AppError_1['default']('Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos');await(0x0,DeleteWhatsAppService_1[_0x15708f(0x198)])(_0x4e0e31),await(0x0,wbot_1[_0x15708f(0x17c)])(+_0x4e0e31);const _0x839b3=(0x0,socket_1[_0x15708f(0x190)])();return _0x839b3['to'](_0x15708f(0x1a6)+_0x39d08c+_0x15708f(0x19f))['emit'](_0x15708f(0x1a6)+_0x39d08c+'-whatsapp',{'action':'delete','whatsappId':+_0x4e0e31}),_0x40868b[_0x15708f(0x1a3)](0xc8)[_0x15708f(0x19a)]({'message':_0x15708f(0x19d)});};exports['remove']=remove;const restart=async(_0x1bbb28,_0x427ec9)=>{const _0x3dfd2a=a46_0x178867,{companyId:_0x37942e,profile:_0x88e376}=_0x1bbb28['user'];if(_0x88e376!==_0x3dfd2a(0x171))throw new AppError_1[(_0x3dfd2a(0x198))](_0x3dfd2a(0x174),0x193);return await(0x0,wbot_1[_0x3dfd2a(0x191)])(_0x37942e),_0x427ec9['status'](0xc8)[_0x3dfd2a(0x19a)]({'message':_0x3dfd2a(0x170)});};exports[a46_0x178867(0x197)]=restart;