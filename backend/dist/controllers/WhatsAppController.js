const a54_0x4ffd43=a54_0x4f46;(function(_0x4032cc,_0x1ef775){const _0x500d22=a54_0x4f46,_0x106c9e=_0x4032cc();while(!![]){try{const _0x356136=-parseInt(_0x500d22(0x18b))/0x1*(-parseInt(_0x500d22(0x153))/0x2)+-parseInt(_0x500d22(0x14d))/0x3+-parseInt(_0x500d22(0x18d))/0x4*(-parseInt(_0x500d22(0x174))/0x5)+parseInt(_0x500d22(0x16e))/0x6*(parseInt(_0x500d22(0x160))/0x7)+parseInt(_0x500d22(0x17c))/0x8*(-parseInt(_0x500d22(0x17f))/0x9)+-parseInt(_0x500d22(0x14b))/0xa+-parseInt(_0x500d22(0x14f))/0xb*(-parseInt(_0x500d22(0x186))/0xc);if(_0x356136===_0x1ef775)break;else _0x106c9e['push'](_0x106c9e['shift']());}catch(_0x49a89e){_0x106c9e['push'](_0x106c9e['shift']());}}}(a54_0x5c76,0x96018));const a54_0x21701b=(function(){let _0xd4917b=!![];return function(_0x441b93,_0x28af93){const _0x45bc8b=_0xd4917b?function(){if(_0x28af93){const _0x21cb4d=_0x28af93['apply'](_0x441b93,arguments);return _0x28af93=null,_0x21cb4d;}}:function(){};return _0xd4917b=![],_0x45bc8b;};}()),a54_0x173f60=a54_0x21701b(this,function(){const _0x50f9a9=a54_0x4f46;return a54_0x173f60[_0x50f9a9(0x157)]()['search'](_0x50f9a9(0x164))[_0x50f9a9(0x157)]()[_0x50f9a9(0x191)](a54_0x173f60)[_0x50f9a9(0x158)](_0x50f9a9(0x164));});a54_0x173f60();'use strict';function a54_0x5c76(){const _0x271955=['pending','../libs/cache','default','remove','findByPk','12119292QOCqfP','message','channel','store','update','2269QhpWiL','show','508emggNc','delFromPattern','status','../services/WbotServices/StartWhatsAppSession','constructor','user','restart','body','open','$get','2765990MIKWPK','Arquivo\x20salvo','1894002KHSWSj','cacheLayer','22qJqUzz','instagram','../services/WhatsappService/CreateWhatsAppService','delete','10fiGaMq','head','getIO','params','toString','search','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','json','lodash','path','ERR_NO_PERMISSION','length','mediaUpload','250229aKHFWr','removeWbot','sessions:','forEach','(((.+)+)+)+$','tickets','greetingMediaAttachment','sequelize','../services/WhatsappService/ListWhatsAppsService','deleteMedia','query','company-','index','StartWhatsAppSession','42jcnAll','send','../services/StorageService/StorageService','__importDefault','-whatsapp','filename','17695sfZgsh','destroy','../libs/wbot','emit','uploadFile','defineProperty','findAll','../models/Whatsapp','32TXUTaW','../libs/socket','deleteFile','2719242nAthUq','__esModule'];a54_0x5c76=function(){return _0x271955;};return a54_0x5c76();}var __importDefault=this&&this[a54_0x4ffd43(0x171)]||function(_0x77ef18){const _0xbfe5ab=a54_0x4ffd43;return _0x77ef18&&_0x77ef18[_0xbfe5ab(0x180)]?_0x77ef18:{'default':_0x77ef18};};Object[a54_0x4ffd43(0x179)](exports,'__esModule',{'value':!![]}),exports[a54_0x4ffd43(0x169)]=exports['mediaUpload']=exports[a54_0x4ffd43(0x184)]=exports[a54_0x4ffd43(0x193)]=exports[a54_0x4ffd43(0x18a)]=exports[a54_0x4ffd43(0x18c)]=exports[a54_0x4ffd43(0x189)]=exports['index']=void 0x0;const sequelize_1=require(a54_0x4ffd43(0x167)),lodash_1=require(a54_0x4ffd43(0x15b)),cache_1=require(a54_0x4ffd43(0x182)),socket_1=require(a54_0x4ffd43(0x17d)),wbot_1=require(a54_0x4ffd43(0x176)),Whatsapp_1=__importDefault(require(a54_0x4ffd43(0x17b))),DeleteBaileysService_1=__importDefault(require('../services/BaileysServices/DeleteBaileysService')),StartWhatsAppSession_1=require(a54_0x4ffd43(0x190)),CreateWhatsAppService_1=__importDefault(require(a54_0x4ffd43(0x151))),DeleteWhatsAppService_1=__importDefault(require('../services/WhatsappService/DeleteWhatsAppService')),ListWhatsAppsService_1=__importDefault(require(a54_0x4ffd43(0x168))),ShowWhatsAppService_1=__importDefault(require('../services/WhatsappService/ShowWhatsAppService')),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),AppError_1=__importDefault(require('../errors/AppError')),StorageService_1=__importDefault(require(a54_0x4ffd43(0x170))),index=async(_0x393d43,_0xfdca40)=>{const _0x533669=a54_0x4ffd43,{companyId:_0xffcbe5,id:_0xaee817}=_0x393d43['user'],{session:_0x5a410e}=_0x393d43[_0x533669(0x16a)],_0x4c9026=await(0x0,ListWhatsAppsService_1[_0x533669(0x183)])({'companyId':_0xffcbe5,'session':_0x5a410e,'userId':+_0xaee817});return _0xfdca40['status'](0xc8)[_0x533669(0x15a)](_0x4c9026);};exports[a54_0x4ffd43(0x16c)]=index;const store=async(_0x531c17,_0xbe160e)=>{const _0x3de677=a54_0x4ffd43,{name:_0x3935c3,status:_0x9ff3d0,isDefault:_0x61c338,greetingMessage:_0x5a7d6c,complationMessage:_0xbc5bae,outOfHoursMessage:_0x52e9e6,allowGroup:_0x3f5271,timeSendQueue:_0x40fb27,sendIdQueue:_0x49e484,useRating:_0xe7b405,ratingMessage:_0x41044b,transferMessage:_0x3f106f,queueIds:_0x40d638,token:_0x1c30c3,maxUseBotQueues:_0x14abe8,expiresTicket:_0x10afb8,expiresInactiveMessage:_0x274304,importOldMessages:_0x2f0415,whenExpireTicket:_0xcbe423,inactiveMessageTime:_0x5576f5,inactiveMessage:_0x4d3fdb,automaticRestart:_0x884200,period:_0xaa1b24}=_0x531c17['body'],{companyId:_0x20e169}=_0x531c17[_0x3de677(0x192)],{whatsapp:_0x39781f,oldDefaultWhatsapp:_0x12ef69}=await(0x0,CreateWhatsAppService_1[_0x3de677(0x183)])({'name':_0x3935c3,'status':_0x9ff3d0,'isDefault':_0x61c338,'greetingMessage':_0x5a7d6c,'complationMessage':_0xbc5bae,'outOfHoursMessage':_0x52e9e6,'useRating':_0xe7b405,'ratingMessage':_0x41044b,'transferMessage':_0x3f106f,'queueIds':_0x40d638,'companyId':_0x20e169,'token':_0x1c30c3,'maxUseBotQueues':_0x14abe8,'timeSendQueue':_0x40fb27,'sendIdQueue':_0x49e484,'expiresTicket':_0x10afb8,'expiresInactiveMessage':_0x274304,'allowGroup':_0x3f5271,'importOldMessages':_0x2f0415,'whenExpireTicket':_0xcbe423,'inactiveMessageTime':_0x5576f5,'inactiveMessage':_0x4d3fdb,'automaticRestart':_0x884200,'period':_0xaa1b24});(0x0,StartWhatsAppSession_1[_0x3de677(0x16d)])(_0x39781f,_0x20e169);const _0x12f8b6=(0x0,socket_1[_0x3de677(0x155)])();return _0x12f8b6[_0x3de677(0x177)]('company-'+_0x20e169+_0x3de677(0x172),{'action':_0x3de677(0x18a),'whatsapp':_0x39781f}),_0x12ef69&&_0x12f8b6[_0x3de677(0x177)](_0x3de677(0x16b)+_0x20e169+_0x3de677(0x172),{'action':_0x3de677(0x18a),'whatsapp':_0x12ef69}),_0xbe160e['status'](0xc8)[_0x3de677(0x15a)](_0x39781f);};exports[a54_0x4ffd43(0x189)]=store;const show=async(_0x35ca18,_0x4c4647)=>{const _0x22f263=a54_0x4ffd43,{whatsappId:_0x3c47ce}=_0x35ca18['params'],{companyId:_0x3ea5c8}=_0x35ca18['user'],{session:_0x5f1e17}=_0x35ca18['query'],_0x2d4bcc=await(0x0,ShowWhatsAppService_1[_0x22f263(0x183)])(_0x3c47ce,_0x3ea5c8,_0x5f1e17);return _0x4c4647[_0x22f263(0x18f)](0xc8)[_0x22f263(0x15a)](_0x2d4bcc);};exports['show']=show;const update=async(_0x23fd31,_0x35cb4d)=>{const _0x15358d=a54_0x4ffd43,{whatsappId:_0x4a586e}=_0x23fd31[_0x15358d(0x156)],_0x557c2d=_0x23fd31[_0x15358d(0x194)],{companyId:_0x182ec5}=_0x23fd31[_0x15358d(0x192)],{whatsapp:_0x398b79,oldDefaultWhatsapp:_0x3913fa}=await(0x0,UpdateWhatsAppService_1[_0x15358d(0x183)])({'whatsappData':_0x557c2d,'whatsappId':_0x4a586e,'companyId':_0x182ec5}),_0x28ec6a=(0x0,socket_1[_0x15358d(0x155)])();return _0x28ec6a[_0x15358d(0x177)](_0x15358d(0x16b)+_0x182ec5+_0x15358d(0x172),{'action':_0x15358d(0x18a),'whatsapp':_0x398b79}),_0x3913fa&&_0x28ec6a[_0x15358d(0x177)]('company-'+_0x182ec5+_0x15358d(0x172),{'action':_0x15358d(0x18a),'whatsapp':_0x3913fa}),_0x35cb4d[_0x15358d(0x18f)](0xc8)['json'](_0x398b79);};function a54_0x4f46(_0x22291b,_0x394a7c){const _0x23a976=a54_0x5c76();return a54_0x4f46=function(_0x173f60,_0x21701b){_0x173f60=_0x173f60-0x14b;let _0x5c76af=_0x23a976[_0x173f60];return _0x5c76af;},a54_0x4f46(_0x22291b,_0x394a7c);}exports[a54_0x4ffd43(0x18a)]=update;const restart=async(_0x52964f,_0x3fbc2c)=>{const _0x19ff4e=a54_0x4ffd43,{companyId:_0x6fd2c1,profile:_0x5e1c09}=_0x52964f[_0x19ff4e(0x192)];if(_0x5e1c09!=='admin')throw new AppError_1[(_0x19ff4e(0x183))](_0x19ff4e(0x15d),0x193);const _0x17ed6e=await Whatsapp_1[_0x19ff4e(0x183)][_0x19ff4e(0x17a)]({'where':{'companyId':_0x6fd2c1}});for(const _0x2b1eba of _0x17ed6e){await(0x0,wbot_1[_0x19ff4e(0x161)])(_0x2b1eba['id'],![]),await new Promise(_0x3c9383=>setTimeout(_0x3c9383,0xbb8)),await(0x0,StartWhatsAppSession_1[_0x19ff4e(0x16d)])(_0x2b1eba,_0x6fd2c1),await _0x2b1eba[_0x19ff4e(0x18a)]({'lastRestartAt':new Date()});}return _0x3fbc2c[_0x19ff4e(0x18f)](0xc8)[_0x19ff4e(0x15a)]({'message':'Whatsapp\x20connections\x20restarted.'});};exports[a54_0x4ffd43(0x193)]=restart;const remove=async(_0x47d115,_0x5d49f2)=>{const _0x464552=a54_0x4ffd43,{whatsappId:_0x16a685}=_0x47d115[_0x464552(0x156)],{companyId:_0x8280ca}=_0x47d115['user'],_0x2fdcd6=(0x0,socket_1[_0x464552(0x155)])(),_0x4f271d=await(0x0,ShowWhatsAppService_1[_0x464552(0x183)])(_0x16a685,_0x8280ca);if(_0x4f271d['channel']==='whatsapp'){const _0x4cf6b6=await _0x4f271d[_0x464552(0x196)](_0x464552(0x165),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x464552(0x195),_0x464552(0x181)]}}});if(_0x4cf6b6[_0x464552(0x15e)]>0x0)throw new AppError_1[(_0x464552(0x183))](_0x464552(0x159));await(0x0,DeleteBaileysService_1['default'])(_0x16a685),await(0x0,DeleteWhatsAppService_1[_0x464552(0x183)])(_0x16a685),await cache_1[_0x464552(0x14e)][_0x464552(0x18e)](_0x464552(0x162)+_0x16a685+':*'),(0x0,wbot_1[_0x464552(0x161)])(+_0x16a685),_0x2fdcd6[_0x464552(0x177)]('company-'+_0x8280ca+'-whatsapp',{'action':'delete','whatsappId':+_0x16a685});}if(_0x4f271d[_0x464552(0x188)]==='facebook'||_0x4f271d['channel']===_0x464552(0x150)){const {facebookUserToken:_0x3f933a}=_0x4f271d,_0xfafc48=await Whatsapp_1[_0x464552(0x183)][_0x464552(0x17a)]({'where':{'facebookUserToken':_0x3f933a}});await Whatsapp_1[_0x464552(0x183)][_0x464552(0x175)]({'where':{'facebookUserToken':_0x3f933a}}),_0xfafc48[_0x464552(0x163)](_0x92c46e=>{const _0x12b72f=_0x464552;_0x2fdcd6[_0x12b72f(0x177)](_0x12b72f(0x16b)+_0x8280ca+_0x12b72f(0x172),{'action':_0x12b72f(0x152),'whatsappId':_0x92c46e['id']});});}return _0x5d49f2[_0x464552(0x18f)](0xc8)[_0x464552(0x15a)]({'message':'Session\x20disconnected.'});};exports[a54_0x4ffd43(0x184)]=remove;const mediaUpload=async(_0x459ae3,_0x1f58fc)=>{const _0x20602f=a54_0x4ffd43,{whatsappId:_0x5a6d83}=_0x459ae3[_0x20602f(0x156)],{companyId:_0x4a74bb}=_0x459ae3[_0x20602f(0x192)],_0x52168d=_0x459ae3['files'],_0x4bfe8a=(0x0,lodash_1[_0x20602f(0x154)])(_0x52168d);try{const _0x276855=await Whatsapp_1['default'][_0x20602f(0x185)](_0x5a6d83),{url:_0x505ec1}=await StorageService_1[_0x20602f(0x183)][_0x20602f(0x178)](_0x4a74bb,'conexao',_0x4bfe8a[_0x20602f(0x173)],_0x4bfe8a[_0x20602f(0x15c)],_0x4bfe8a['mimetype']);return await _0x276855['update']({'greetingMediaAttachment':_0x505ec1}),_0x1f58fc[_0x20602f(0x16f)]({'message':_0x20602f(0x14c)});}catch(_0x1a0dba){throw new AppError_1[(_0x20602f(0x183))](_0x1a0dba[_0x20602f(0x187)]);}};exports[a54_0x4ffd43(0x15f)]=mediaUpload;const deleteMedia=async(_0x13649b,_0x3979a1)=>{const _0x48a179=a54_0x4ffd43,{whatsappId:_0x2b8d0f}=_0x13649b[_0x48a179(0x156)],{companyId:_0x31bd22}=_0x13649b[_0x48a179(0x192)];try{const _0x392c77=await Whatsapp_1[_0x48a179(0x183)][_0x48a179(0x185)](_0x2b8d0f);return _0x392c77[_0x48a179(0x166)]&&await StorageService_1[_0x48a179(0x183)][_0x48a179(0x17e)](_0x31bd22,_0x392c77[_0x48a179(0x166)]),await _0x392c77[_0x48a179(0x18a)]({'greetingMediaAttachment':null}),_0x3979a1[_0x48a179(0x16f)]({'message':'Arquivo\x20excluído'});}catch(_0x570296){throw new AppError_1[(_0x48a179(0x183))](_0x570296[_0x48a179(0x187)]);}};exports['deleteMedia']=deleteMedia;