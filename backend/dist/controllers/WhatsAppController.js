const a54_0x4d5842=a54_0x4587;(function(_0xbf7c18,_0x614977){const _0x1fe5e6=a54_0x4587,_0x42d26f=_0xbf7c18();while(!![]){try{const _0x8e8a39=parseInt(_0x1fe5e6(0x138))/0x1*(-parseInt(_0x1fe5e6(0x139))/0x2)+-parseInt(_0x1fe5e6(0x133))/0x3+-parseInt(_0x1fe5e6(0x14e))/0x4*(-parseInt(_0x1fe5e6(0x12f))/0x5)+-parseInt(_0x1fe5e6(0x165))/0x6+-parseInt(_0x1fe5e6(0x172))/0x7+parseInt(_0x1fe5e6(0x169))/0x8*(parseInt(_0x1fe5e6(0x16a))/0x9)+-parseInt(_0x1fe5e6(0x145))/0xa*(-parseInt(_0x1fe5e6(0x160))/0xb);if(_0x8e8a39===_0x614977)break;else _0x42d26f['push'](_0x42d26f['shift']());}catch(_0x2fb22b){_0x42d26f['push'](_0x42d26f['shift']());}}}(a54_0x4b8e,0x7b08b));const a54_0x2f0489=(function(){let _0x3b4602=!![];return function(_0x1904a4,_0x1eff14){const _0x6fccce=_0x3b4602?function(){const _0x5176d9=a54_0x4587;if(_0x1eff14){const _0x41790a=_0x1eff14[_0x5176d9(0x13b)](_0x1904a4,arguments);return _0x1eff14=null,_0x41790a;}}:function(){};return _0x3b4602=![],_0x6fccce;};}()),a54_0x1ba96a=a54_0x2f0489(this,function(){const _0x4edd57=a54_0x4587;return a54_0x1ba96a[_0x4edd57(0x15b)]()[_0x4edd57(0x156)](_0x4edd57(0x12d))['toString']()[_0x4edd57(0x152)](a54_0x1ba96a)[_0x4edd57(0x156)]('(((.+)+)+)+$');});a54_0x1ba96a();'use strict';var __importDefault=this&&this[a54_0x4d5842(0x174)]||function(_0x3f4a67){const _0x4549cd=a54_0x4d5842;return _0x3f4a67&&_0x3f4a67[_0x4549cd(0x153)]?_0x3f4a67:{'default':_0x3f4a67};};Object[a54_0x4d5842(0x13a)](exports,'__esModule',{'value':!![]}),exports[a54_0x4d5842(0x16b)]=exports['mediaUpload']=exports[a54_0x4d5842(0x168)]=exports['restart']=exports[a54_0x4d5842(0x166)]=exports[a54_0x4d5842(0x150)]=exports[a54_0x4d5842(0x147)]=exports['index']=void 0x0;const sequelize_1=require(a54_0x4d5842(0x143)),lodash_1=require(a54_0x4d5842(0x158)),cache_1=require(a54_0x4d5842(0x155)),socket_1=require(a54_0x4d5842(0x177)),wbot_1=require(a54_0x4d5842(0x173)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),DeleteBaileysService_1=__importDefault(require('../services/BaileysServices/DeleteBaileysService')),StartWhatsAppSession_1=require(a54_0x4d5842(0x149)),CreateWhatsAppService_1=__importDefault(require(a54_0x4d5842(0x16c))),DeleteWhatsAppService_1=__importDefault(require(a54_0x4d5842(0x16f))),ListWhatsAppsService_1=__importDefault(require(a54_0x4d5842(0x144))),ShowWhatsAppService_1=__importDefault(require(a54_0x4d5842(0x131))),UpdateWhatsAppService_1=__importDefault(require(a54_0x4d5842(0x132))),AppError_1=__importDefault(require('../errors/AppError')),StorageService_1=__importDefault(require(a54_0x4d5842(0x161))),index=async(_0x5598e8,_0x453f9e)=>{const _0x31bdf3=a54_0x4d5842,{companyId:_0x3ef2ac,id:_0x349784}=_0x5598e8[_0x31bdf3(0x167)],{session:_0x29aa3f}=_0x5598e8[_0x31bdf3(0x159)],_0x184f8b=await(0x0,ListWhatsAppsService_1['default'])({'companyId':_0x3ef2ac,'session':_0x29aa3f,'userId':+_0x349784});return _0x453f9e[_0x31bdf3(0x170)](0xc8)[_0x31bdf3(0x157)](_0x184f8b);};exports[a54_0x4d5842(0x13e)]=index;const store=async(_0x43ba79,_0x41cd27)=>{const _0x22b92a=a54_0x4d5842,{name:_0x2433e7,status:_0xe3d0a3,isDefault:_0x24b730,greetingMessage:_0x53b27a,complationMessage:_0x2457d0,outOfHoursMessage:_0x3487ee,allowGroup:_0xc141a1,timeSendQueue:_0x58bf7c,sendIdQueue:_0x28c922,useRating:_0x52b872,ratingMessage:_0x5a27eb,transferMessage:_0x15b1c2,queueIds:_0x44bb8d,token:_0x5e253b,maxUseBotQueues:_0x211dad,expiresTicket:_0x4c1f1e,expiresInactiveMessage:_0x75ee87,importOldMessages:_0x632598,whenExpireTicket:_0x596df5,inactiveMessageTime:_0x4bf542,inactiveMessage:_0x24c98d,automaticRestart:_0x46f446,period:_0xb7c708}=_0x43ba79['body'],{companyId:_0x3fc99d}=_0x43ba79[_0x22b92a(0x167)],{whatsapp:_0x3b9679,oldDefaultWhatsapp:_0x5687a8}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x2433e7,'status':_0xe3d0a3,'isDefault':_0x24b730,'greetingMessage':_0x53b27a,'complationMessage':_0x2457d0,'outOfHoursMessage':_0x3487ee,'useRating':_0x52b872,'ratingMessage':_0x5a27eb,'transferMessage':_0x15b1c2,'queueIds':_0x44bb8d,'companyId':_0x3fc99d,'token':_0x5e253b,'maxUseBotQueues':_0x211dad,'timeSendQueue':_0x58bf7c,'sendIdQueue':_0x28c922,'expiresTicket':_0x4c1f1e,'expiresInactiveMessage':_0x75ee87,'allowGroup':_0xc141a1,'importOldMessages':_0x632598,'whenExpireTicket':_0x596df5,'inactiveMessageTime':_0x4bf542,'inactiveMessage':_0x24c98d,'automaticRestart':_0x46f446,'period':_0xb7c708});(0x0,StartWhatsAppSession_1[_0x22b92a(0x14d)])(_0x3b9679,_0x3fc99d);const _0x20ef31=(0x0,socket_1[_0x22b92a(0x15a)])();return _0x20ef31['emit']('company-'+_0x3fc99d+'-whatsapp',{'action':_0x22b92a(0x166),'whatsapp':_0x3b9679}),_0x5687a8&&_0x20ef31['emit']('company-'+_0x3fc99d+_0x22b92a(0x14b),{'action':_0x22b92a(0x166),'whatsapp':_0x5687a8}),_0x41cd27[_0x22b92a(0x170)](0xc8)[_0x22b92a(0x157)](_0x3b9679);};exports[a54_0x4d5842(0x147)]=store;const show=async(_0x4c7dad,_0x456569)=>{const _0x2723ed=a54_0x4d5842,{whatsappId:_0x23b864}=_0x4c7dad[_0x2723ed(0x151)],{companyId:_0x4358ed}=_0x4c7dad[_0x2723ed(0x167)],{session:_0x2a0648}=_0x4c7dad[_0x2723ed(0x159)],_0xb4d094=await(0x0,ShowWhatsAppService_1[_0x2723ed(0x15f)])(_0x23b864,_0x4358ed,_0x2a0648);return _0x456569[_0x2723ed(0x170)](0xc8)[_0x2723ed(0x157)](_0xb4d094);};exports[a54_0x4d5842(0x150)]=show;const update=async(_0xbc9093,_0x259b11)=>{const _0x3bce1a=a54_0x4d5842,{whatsappId:_0x42717b}=_0xbc9093[_0x3bce1a(0x151)],_0x5e99e9=_0xbc9093['body'],{companyId:_0xbe0da}=_0xbc9093['user'],{whatsapp:_0x12408f,oldDefaultWhatsapp:_0x56d509}=await(0x0,UpdateWhatsAppService_1[_0x3bce1a(0x15f)])({'whatsappData':_0x5e99e9,'whatsappId':_0x42717b,'companyId':_0xbe0da}),_0x1cbc27=(0x0,socket_1[_0x3bce1a(0x15a)])();return _0x1cbc27[_0x3bce1a(0x154)](_0x3bce1a(0x15d)+_0xbe0da+'-whatsapp',{'action':_0x3bce1a(0x166),'whatsapp':_0x12408f}),_0x56d509&&_0x1cbc27['emit']('company-'+_0xbe0da+_0x3bce1a(0x14b),{'action':_0x3bce1a(0x166),'whatsapp':_0x56d509}),_0x259b11[_0x3bce1a(0x170)](0xc8)[_0x3bce1a(0x157)](_0x12408f);};exports[a54_0x4d5842(0x166)]=update;const restart=async(_0x54a35d,_0x4a4498)=>{const _0xc4d1c2=a54_0x4d5842,{companyId:_0x388436,profile:_0x2685eb}=_0x54a35d[_0xc4d1c2(0x167)];if(_0x2685eb!=='admin')throw new AppError_1['default'](_0xc4d1c2(0x130),0x193);const _0x19790e=await Whatsapp_1[_0xc4d1c2(0x15f)]['findAll']({'where':{'companyId':_0x388436}});for(const _0x12db76 of _0x19790e){await(0x0,wbot_1[_0xc4d1c2(0x164)])(_0x12db76['id'],![]),await new Promise(_0x473c47=>setTimeout(_0x473c47,0xbb8)),await(0x0,StartWhatsAppSession_1[_0xc4d1c2(0x14d)])(_0x12db76,_0x388436),await _0x12db76[_0xc4d1c2(0x166)]({'lastRestartAt':new Date()});}return _0x4a4498[_0xc4d1c2(0x170)](0xc8)['json']({'message':'Whatsapp\x20connections\x20restarted.'});};function a54_0x4587(_0x5b1a4f,_0x942bfa){const _0x3d39c7=a54_0x4b8e();return a54_0x4587=function(_0x1ba96a,_0x2f0489){_0x1ba96a=_0x1ba96a-0x12c;let _0x4b8ea3=_0x3d39c7[_0x1ba96a];return _0x4b8ea3;},a54_0x4587(_0x5b1a4f,_0x942bfa);}exports[a54_0x4d5842(0x176)]=restart;const remove=async(_0x2b218a,_0x2bab4a)=>{const _0x547592=a54_0x4d5842,{whatsappId:_0x2b54f1}=_0x2b218a['params'],{companyId:_0x1c61a8}=_0x2b218a[_0x547592(0x167)],_0x213534=(0x0,socket_1[_0x547592(0x15a)])(),_0x36096a=await(0x0,ShowWhatsAppService_1[_0x547592(0x15f)])(_0x2b54f1,_0x1c61a8);if(_0x36096a['channel']===_0x547592(0x175)){const _0x27a83e=await _0x36096a[_0x547592(0x134)]('tickets',{'where':{'status':{[sequelize_1['Op']['or']]:['open','pending']}}});if(_0x27a83e['length']>0x0)throw new AppError_1[(_0x547592(0x15f))](_0x547592(0x148));await(0x0,DeleteBaileysService_1[_0x547592(0x15f)])(_0x2b54f1),await(0x0,DeleteWhatsAppService_1[_0x547592(0x15f)])(_0x2b54f1),await cache_1['cacheLayer'][_0x547592(0x16e)](_0x547592(0x13c)+_0x2b54f1+':*'),(0x0,wbot_1[_0x547592(0x164)])(+_0x2b54f1),_0x213534[_0x547592(0x154)](_0x547592(0x15d)+_0x1c61a8+_0x547592(0x14b),{'action':_0x547592(0x146),'whatsappId':+_0x2b54f1});}if(_0x36096a['channel']===_0x547592(0x12c)||_0x36096a['channel']===_0x547592(0x13d)){const {facebookUserToken:_0x3a5875}=_0x36096a,_0x2cc8f2=await Whatsapp_1[_0x547592(0x15f)][_0x547592(0x16d)]({'where':{'facebookUserToken':_0x3a5875}});await Whatsapp_1['default'][_0x547592(0x142)]({'where':{'facebookUserToken':_0x3a5875}}),_0x2cc8f2['forEach'](_0x1fcb81=>{const _0x1370c1=_0x547592;_0x213534[_0x1370c1(0x154)]('company-'+_0x1c61a8+_0x1370c1(0x14b),{'action':_0x1370c1(0x146),'whatsappId':_0x1fcb81['id']});});}return _0x2bab4a[_0x547592(0x170)](0xc8)['json']({'message':_0x547592(0x162)});};exports[a54_0x4d5842(0x168)]=remove;const mediaUpload=async(_0x2bcc64,_0x490d2a)=>{const _0x3ad8a1=a54_0x4d5842,{whatsappId:_0x2f71f6}=_0x2bcc64[_0x3ad8a1(0x151)],{companyId:_0x7c297b}=_0x2bcc64[_0x3ad8a1(0x167)],_0x45fb75=_0x2bcc64[_0x3ad8a1(0x140)],_0x4f7ad2=(0x0,lodash_1[_0x3ad8a1(0x163)])(_0x45fb75);try{const _0x3ad7fa=await Whatsapp_1[_0x3ad8a1(0x15f)][_0x3ad8a1(0x12e)](_0x2f71f6),{url:_0x8a9c1c}=await StorageService_1[_0x3ad8a1(0x15f)][_0x3ad8a1(0x13f)](_0x7c297b,_0x3ad8a1(0x14f),_0x4f7ad2[_0x3ad8a1(0x15c)],_0x4f7ad2[_0x3ad8a1(0x14a)],_0x4f7ad2[_0x3ad8a1(0x171)]);return await _0x3ad7fa[_0x3ad8a1(0x166)]({'greetingMediaAttachment':_0x8a9c1c}),_0x490d2a[_0x3ad8a1(0x137)]({'message':_0x3ad8a1(0x15e)});}catch(_0x5905a4){throw new AppError_1[(_0x3ad8a1(0x15f))](_0x5905a4[_0x3ad8a1(0x135)]);}};exports['mediaUpload']=mediaUpload;function a54_0x4b8e(){const _0x38ded3=['search','json','lodash','query','getIO','toString','filename','company-','Arquivo\x20salvo','default','22hwgZQJ','../services/StorageService/StorageService','Session\x20disconnected.','head','removeWbot','341472RcEcuj','update','user','remove','6616cxZbck','1170YSyLCl','deleteMedia','../services/WhatsappService/CreateWhatsAppService','findAll','delFromPattern','../services/WhatsappService/DeleteWhatsAppService','status','mimetype','2686292FFrzUx','../libs/wbot','__importDefault','whatsapp','restart','../libs/socket','facebook','(((.+)+)+)+$','findByPk','395690kNComm','ERR_NO_PERMISSION','../services/WhatsappService/ShowWhatsAppService','../services/WhatsappService/UpdateWhatsAppService','182073Fdhgns','$get','message','Arquivo\x20excluído','send','154UeOttN','12050JoACNW','defineProperty','apply','sessions:','instagram','index','uploadFile','files','greetingMediaAttachment','destroy','sequelize','../services/WhatsappService/ListWhatsAppsService','7545470fDqquu','delete','store','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','../services/WbotServices/StartWhatsAppSession','path','-whatsapp','deleteFile','StartWhatsAppSession','16YJYYvt','conexao','show','params','constructor','__esModule','emit','../libs/cache'];a54_0x4b8e=function(){return _0x38ded3;};return a54_0x4b8e();}const deleteMedia=async(_0x5e0f7d,_0x113625)=>{const _0x2e37ac=a54_0x4d5842,{whatsappId:_0x4d315e}=_0x5e0f7d[_0x2e37ac(0x151)],{companyId:_0x28f5bb}=_0x5e0f7d[_0x2e37ac(0x167)];try{const _0x2f3d76=await Whatsapp_1[_0x2e37ac(0x15f)][_0x2e37ac(0x12e)](_0x4d315e);return _0x2f3d76[_0x2e37ac(0x141)]&&await StorageService_1[_0x2e37ac(0x15f)][_0x2e37ac(0x14c)](_0x28f5bb,_0x2f3d76[_0x2e37ac(0x141)]),await _0x2f3d76[_0x2e37ac(0x166)]({'greetingMediaAttachment':null}),_0x113625[_0x2e37ac(0x137)]({'message':_0x2e37ac(0x136)});}catch(_0x4354c2){throw new AppError_1[(_0x2e37ac(0x15f))](_0x4354c2[_0x2e37ac(0x135)]);}};exports['deleteMedia']=deleteMedia;