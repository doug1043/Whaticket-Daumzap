const a46_0x3943e0=a46_0x3bad;(function(_0x33cf43,_0x28c239){const _0x39bec3=a46_0x3bad,_0x5e22ac=_0x33cf43();while(!![]){try{const _0x94e94b=parseInt(_0x39bec3(0x137))/0x1+parseInt(_0x39bec3(0x150))/0x2*(parseInt(_0x39bec3(0x134))/0x3)+-parseInt(_0x39bec3(0x12c))/0x4+parseInt(_0x39bec3(0x12e))/0x5*(-parseInt(_0x39bec3(0x154))/0x6)+-parseInt(_0x39bec3(0x127))/0x7+parseInt(_0x39bec3(0x128))/0x8+parseInt(_0x39bec3(0x15d))/0x9;if(_0x94e94b===_0x28c239)break;else _0x5e22ac['push'](_0x5e22ac['shift']());}catch(_0x3e220e){_0x5e22ac['push'](_0x5e22ac['shift']());}}}(a46_0x10b1,0x3748d));const a46_0x29ebbd=(function(){let _0x32e0ed=!![];return function(_0x396b0c,_0x5a9d77){const _0x51dce0=_0x32e0ed?function(){const _0x31ae97=a46_0x3bad;if(_0x5a9d77){const _0x404302=_0x5a9d77[_0x31ae97(0x160)](_0x396b0c,arguments);return _0x5a9d77=null,_0x404302;}}:function(){};return _0x32e0ed=![],_0x51dce0;};}()),a46_0x56a7d9=a46_0x29ebbd(this,function(){const _0x5e65a7=a46_0x3bad;return a46_0x56a7d9[_0x5e65a7(0x13c)]()[_0x5e65a7(0x12b)]('(((.+)+)+)+$')['toString']()[_0x5e65a7(0x147)](a46_0x56a7d9)[_0x5e65a7(0x12b)]('(((.+)+)+)+$');});a46_0x56a7d9();'use strict';var __importDefault=this&&this[a46_0x3943e0(0x142)]||function(_0x2890a5){return _0x2890a5&&_0x2890a5['__esModule']?_0x2890a5:{'default':_0x2890a5};};Object[a46_0x3943e0(0x13b)](exports,a46_0x3943e0(0x148),{'value':!![]}),exports['restart']=exports[a46_0x3943e0(0x130)]=exports[a46_0x3943e0(0x132)]=exports[a46_0x3943e0(0x133)]=exports[a46_0x3943e0(0x15c)]=exports[a46_0x3943e0(0x143)]=exports[a46_0x3943e0(0x135)]=exports[a46_0x3943e0(0x129)]=void 0x0;const socket_1=require('../libs/socket'),wbot_1=require(a46_0x3943e0(0x145)),StartWhatsAppSession_1=require('../services/WbotServices/StartWhatsAppSession'),FindAllCompaniesService_1=__importDefault(require('../services/CompanyService/FindAllCompaniesService')),CreateWhatsAppService_1=__importDefault(require(a46_0x3943e0(0x15b))),DeleteWhatsAppService_1=__importDefault(require(a46_0x3943e0(0x13f))),ListWhatsAppsService_1=__importDefault(require('../services/WhatsappService/ListWhatsAppsService')),ShowWhatsAppService_1=__importDefault(require(a46_0x3943e0(0x14d))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),AppError_1=__importDefault(require('../errors/AppError')),sequelize_1=require(a46_0x3943e0(0x146)),ImportWhatsAppMessageService_1=require(a46_0x3943e0(0x14c)),Whatsapp_1=__importDefault(require(a46_0x3943e0(0x15e))),closedTickets=async(_0x469dcb,_0xc0f65e)=>{const _0x349d7a=a46_0x3943e0,{whatsappId:_0x5e1d7b}=_0x469dcb[_0x349d7a(0x15f)];return await(0x0,ImportWhatsAppMessageService_1[_0x349d7a(0x153)])(_0x5e1d7b),_0xc0f65e[_0x349d7a(0x15a)](0xc8)[_0x349d7a(0x156)](_0x349d7a(0x136));};exports['closedTickets']=closedTickets;const index=async(_0x2037f3,_0x34eb42)=>{const _0x4cd4bc=a46_0x3943e0,{companyId:_0x13ff0b}=_0x2037f3[_0x4cd4bc(0x125)],{session:_0x586fad}=_0x2037f3['query'],_0x173db0=await(0x0,ListWhatsAppsService_1['default'])({'companyId':_0x13ff0b,'session':_0x586fad});return _0x34eb42[_0x4cd4bc(0x15a)](0xc8)[_0x4cd4bc(0x156)](_0x173db0);};function a46_0x10b1(){const _0x4f481b=['-whatsapp','1768400oGGOUF','error','remove','pending','update','getAllConnections','12CKASLs','index','whatsapp','75946ppjoJe','number','Whatsapp\x20restart.','tickets','defineProperty','toString','Whatsapp\x20deleted.','default','../services/WhatsappService/DeleteWhatsAppService','ERR_NO_PERMISSION','$get','__importDefault','store','restartWbot','../libs/wbot','sequelize','constructor','__esModule','emit','restart','query','../services/WhatsappService/ImportWhatsAppMessageService','../services/WhatsappService/ShowWhatsAppService','admin','Failed\x20to\x20fetch\x20connections','72014yQrEKp','body','push','closeImportedTickets','6DumigT','getIO','json','findAll','-mainchannel','removeWbot','status','../services/WhatsappService/CreateWhatsAppService','show','3833568zxcWTk','../models/Whatsapp','params','apply','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','user','company-','976381lMyaVp','671392pelvBg','closedTickets','length','search','40968BDqyIR'];a46_0x10b1=function(){return _0x4f481b;};return a46_0x10b1();}exports['index']=index;const store=async(_0x51c84e,_0x410433)=>{const _0x8e1863=a46_0x3943e0,{name:_0x1bf0d6,status:_0x16ceb3,isDefault:_0x381ef2,greetingMessage:_0x524c0b,complationMessage:_0x23445f,outOfHoursMessage:_0x293df9,queueIds:_0x504c56,token:_0x4b9b4e,allowGroup:_0x555013,timeSendQueue:_0x48ff79,sendIdQueue:_0xcd0911,promptId:_0x1f1a16,maxUseBotQueues:_0x4ab5ca,timeUseBotQueues:_0x1a7ed7,expiresTicket:_0x807322,expiresInactiveMessage:_0x1b3ec8,importOldMessages:_0x42f628,importRecentMessages:_0x55e764,closedTicketsPostImported:_0x41900a,importOldMessagesGroups:_0x476804}=_0x51c84e[_0x8e1863(0x151)],{companyId:_0x1b3ad3}=_0x51c84e[_0x8e1863(0x125)],{whatsapp:_0x59cf83,oldDefaultWhatsapp:_0x1e67c2}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x1bf0d6,'status':_0x16ceb3,'isDefault':_0x381ef2,'greetingMessage':_0x524c0b,'complationMessage':_0x23445f,'outOfHoursMessage':_0x293df9,'queueIds':_0x504c56,'companyId':_0x1b3ad3,'token':_0x4b9b4e,'timeSendQueue':_0x48ff79,'sendIdQueue':_0xcd0911,'promptId':_0x1f1a16,'maxUseBotQueues':_0x4ab5ca,'timeUseBotQueues':_0x1a7ed7,'expiresTicket':_0x807322,'expiresInactiveMessage':_0x1b3ec8,'allowGroup':_0x555013,'importOldMessages':_0x42f628,'importRecentMessages':_0x55e764,'closedTicketsPostImported':_0x41900a,'importOldMessagesGroups':_0x476804});(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x59cf83,_0x1b3ad3);const _0x31492f=(0x0,socket_1[_0x8e1863(0x155)])();return _0x31492f['to'](_0x8e1863(0x126)+_0x1b3ad3+_0x8e1863(0x158))[_0x8e1863(0x149)](_0x8e1863(0x126)+_0x1b3ad3+'-whatsapp',{'action':'update','whatsapp':_0x59cf83}),_0x1e67c2&&_0x31492f['to'](_0x8e1863(0x126)+_0x1b3ad3+'-mainchannel')[_0x8e1863(0x149)]('company-'+_0x1b3ad3+'-whatsapp',{'action':_0x8e1863(0x132),'whatsapp':_0x1e67c2}),_0x410433[_0x8e1863(0x15a)](0xc8)['json'](_0x59cf83);};exports[a46_0x3943e0(0x143)]=store;const show=async(_0x1a30c4,_0x347c95)=>{const _0x414b27=a46_0x3943e0,{whatsappId:_0x459fdd}=_0x1a30c4[_0x414b27(0x15f)],{companyId:_0x5e3535}=_0x1a30c4['user'],{session:_0x4aa718}=_0x1a30c4[_0x414b27(0x14b)],_0x4983c9=await(0x0,ShowWhatsAppService_1[_0x414b27(0x13e)])(_0x459fdd,_0x5e3535,_0x4aa718);return _0x347c95['status'](0xc8)[_0x414b27(0x156)](_0x4983c9);};exports[a46_0x3943e0(0x15c)]=show;const getAllConnections=async(_0x5e87de,_0x94b3ca)=>{const _0x1c3183=a46_0x3943e0;try{const _0x287d5d=await(0x0,FindAllCompaniesService_1[_0x1c3183(0x13e)])();if(!_0x287d5d||_0x287d5d[_0x1c3183(0x12a)]===0x0)return _0x94b3ca[_0x1c3183(0x15a)](0x194)[_0x1c3183(0x156)]({'error':'No\x20companies\x20found'});const _0x3af7d6=[];for(const _0x174ee8 of _0x287d5d){if(typeof _0x174ee8['id']!==_0x1c3183(0x138))continue;const _0x88bf23=await Whatsapp_1['default'][_0x1c3183(0x157)]({'where':{'companyId':_0x174ee8['id']}});_0x3af7d6[_0x1c3183(0x152)](..._0x88bf23);}return _0x94b3ca['status'](0xc8)[_0x1c3183(0x156)](_0x3af7d6);}catch(_0x406561){return console[_0x1c3183(0x12f)](_0x406561),_0x94b3ca['status'](0x1f4)[_0x1c3183(0x156)]({'error':_0x1c3183(0x14f)});}};exports['getAllConnections']=getAllConnections;const update=async(_0x3d84bd,_0x2a4086)=>{const _0x3d4a27=a46_0x3943e0,{whatsappId:_0x25a2dc}=_0x3d84bd[_0x3d4a27(0x15f)],_0x5cd915=_0x3d84bd[_0x3d4a27(0x151)],{companyId:_0x2a4762}=_0x3d84bd[_0x3d4a27(0x125)],{whatsapp:_0x277fcd,oldDefaultWhatsapp:_0x419bbc}=await(0x0,UpdateWhatsAppService_1['default'])({'whatsappData':_0x5cd915,'whatsappId':_0x25a2dc,'companyId':_0x2a4762}),_0x27ae4c=(0x0,socket_1[_0x3d4a27(0x155)])();return _0x27ae4c['to'](_0x3d4a27(0x126)+_0x2a4762+_0x3d4a27(0x158))[_0x3d4a27(0x149)](_0x3d4a27(0x126)+_0x2a4762+_0x3d4a27(0x12d),{'action':'update','whatsapp':_0x277fcd}),_0x419bbc&&_0x27ae4c['to'](_0x3d4a27(0x126)+_0x2a4762+_0x3d4a27(0x158))[_0x3d4a27(0x149)](_0x3d4a27(0x126)+_0x2a4762+_0x3d4a27(0x12d),{'action':_0x3d4a27(0x132),'whatsapp':_0x419bbc}),_0x2a4086[_0x3d4a27(0x15a)](0xc8)[_0x3d4a27(0x156)](_0x277fcd);};function a46_0x3bad(_0x273a23,_0x19160a){const _0x1bd298=a46_0x10b1();return a46_0x3bad=function(_0x56a7d9,_0x29ebbd){_0x56a7d9=_0x56a7d9-0x124;let _0x10b106=_0x1bd298[_0x56a7d9];return _0x10b106;},a46_0x3bad(_0x273a23,_0x19160a);}exports[a46_0x3943e0(0x132)]=update;const remove=async(_0x426650,_0x5dd86d)=>{const _0x1e5ae6=a46_0x3943e0,{whatsappId:_0x595538}=_0x426650['params'],{companyId:_0x554c27}=_0x426650[_0x1e5ae6(0x125)],_0x5a6bc2=await(0x0,ShowWhatsAppService_1[_0x1e5ae6(0x13e)])(_0x595538,_0x554c27),_0x4d50af=await _0x5a6bc2[_0x1e5ae6(0x141)](_0x1e5ae6(0x13a),{'where':{'status':{[sequelize_1['Op']['or']]:['open',_0x1e5ae6(0x131)]}}});if(_0x4d50af[_0x1e5ae6(0x12a)]>0x0)throw new AppError_1['default'](_0x1e5ae6(0x124));await(0x0,DeleteWhatsAppService_1[_0x1e5ae6(0x13e)])(_0x595538),await(0x0,wbot_1[_0x1e5ae6(0x159)])(+_0x595538);const _0x38fb4d=(0x0,socket_1[_0x1e5ae6(0x155)])();return _0x38fb4d['to'](_0x1e5ae6(0x126)+_0x554c27+_0x1e5ae6(0x158))['emit']('company-'+_0x554c27+_0x1e5ae6(0x12d),{'action':'delete','whatsappId':+_0x595538}),_0x5dd86d[_0x1e5ae6(0x15a)](0xc8)[_0x1e5ae6(0x156)]({'message':_0x1e5ae6(0x13d)});};exports[a46_0x3943e0(0x130)]=remove;const restart=async(_0x20bdf1,_0x533e83)=>{const _0x2cd8d2=a46_0x3943e0,{companyId:_0x3ba20d,profile:_0x36e955}=_0x20bdf1[_0x2cd8d2(0x125)];if(_0x36e955!==_0x2cd8d2(0x14e))throw new AppError_1['default'](_0x2cd8d2(0x140),0x193);return await(0x0,wbot_1[_0x2cd8d2(0x144)])(_0x3ba20d),_0x533e83[_0x2cd8d2(0x15a)](0xc8)['json']({'message':_0x2cd8d2(0x139)});};exports[a46_0x3943e0(0x14a)]=restart;