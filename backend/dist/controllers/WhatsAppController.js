const a45_0xdc7d12=a45_0x3ee9;(function(_0x5848a3,_0x47dca9){const _0x4dedd9=a45_0x3ee9,_0x56fb36=_0x5848a3();while(!![]){try{const _0x30436f=-parseInt(_0x4dedd9(0x90))/0x1*(-parseInt(_0x4dedd9(0x8e))/0x2)+-parseInt(_0x4dedd9(0xb6))/0x3*(parseInt(_0x4dedd9(0x83))/0x4)+parseInt(_0x4dedd9(0x7a))/0x5*(-parseInt(_0x4dedd9(0x8b))/0x6)+-parseInt(_0x4dedd9(0x98))/0x7+parseInt(_0x4dedd9(0xaa))/0x8*(-parseInt(_0x4dedd9(0x7e))/0x9)+parseInt(_0x4dedd9(0xae))/0xa+parseInt(_0x4dedd9(0x84))/0xb;if(_0x30436f===_0x47dca9)break;else _0x56fb36['push'](_0x56fb36['shift']());}catch(_0x4e0b6d){_0x56fb36['push'](_0x56fb36['shift']());}}}(a45_0x6eda,0x1b106));const a45_0x182f77=(function(){let _0xf65606=!![];return function(_0x57598b,_0x2250c3){const _0x4bca1e=_0xf65606?function(){const _0x5b175c=a45_0x3ee9;if(_0x2250c3){const _0xc9ac16=_0x2250c3[_0x5b175c(0x95)](_0x57598b,arguments);return _0x2250c3=null,_0xc9ac16;}}:function(){};return _0xf65606=![],_0x4bca1e;};}()),a45_0xa0d3f2=a45_0x182f77(this,function(){const _0x539f2c=a45_0x3ee9;return a45_0xa0d3f2[_0x539f2c(0xb5)]()['search'](_0x539f2c(0xaf))[_0x539f2c(0xb5)]()[_0x539f2c(0x89)](a45_0xa0d3f2)[_0x539f2c(0x9e)]('(((.+)+)+)+$');});a45_0xa0d3f2();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5cc671){const _0x1f4f30=a45_0x3ee9;return _0x5cc671&&_0x5cc671[_0x1f4f30(0xa2)]?_0x5cc671:{'default':_0x5cc671};};Object['defineProperty'](exports,a45_0xdc7d12(0xa2),{'value':!![]}),exports[a45_0xdc7d12(0x80)]=exports[a45_0xdc7d12(0xa7)]=exports['update']=exports['getAllConnections']=exports['show']=exports[a45_0xdc7d12(0x96)]=exports[a45_0xdc7d12(0xb7)]=exports['closedTickets']=void 0x0;const socket_1=require(a45_0xdc7d12(0x9c)),wbot_1=require(a45_0xdc7d12(0x85)),StartWhatsAppSession_1=require(a45_0xdc7d12(0xb8)),FindAllCompaniesService_1=__importDefault(require(a45_0xdc7d12(0xa8))),CreateWhatsAppService_1=__importDefault(require('../services/WhatsappService/CreateWhatsAppService')),DeleteWhatsAppService_1=__importDefault(require(a45_0xdc7d12(0x8d))),ListWhatsAppsService_1=__importDefault(require(a45_0xdc7d12(0x9f))),ShowWhatsAppService_1=__importDefault(require(a45_0xdc7d12(0xb2))),UpdateWhatsAppService_1=__importDefault(require(a45_0xdc7d12(0x99))),AppError_1=__importDefault(require(a45_0xdc7d12(0x9d))),sequelize_1=require(a45_0xdc7d12(0x82)),ImportWhatsAppMessageService_1=require('../services/WhatsappService/ImportWhatsAppMessageService'),Whatsapp_1=__importDefault(require(a45_0xdc7d12(0x7f))),closedTickets=async(_0x3d919b,_0xe9e96b)=>{const _0x1c8f1d=a45_0xdc7d12,{whatsappId:_0x22b58c}=_0x3d919b['params'];return await(0x0,ImportWhatsAppMessageService_1['closeImportedTickets'])(_0x22b58c),_0xe9e96b[_0x1c8f1d(0x91)](0xc8)['json'](_0x1c8f1d(0xa4));};exports[a45_0xdc7d12(0x97)]=closedTickets;function a45_0x3ee9(_0x4ea924,_0x5481d3){const _0x524957=a45_0x6eda();return a45_0x3ee9=function(_0xa0d3f2,_0x182f77){_0xa0d3f2=_0xa0d3f2-0x7a;let _0x6eda78=_0x524957[_0xa0d3f2];return _0x6eda78;},a45_0x3ee9(_0x4ea924,_0x5481d3);}const index=async(_0x5e11ca,_0x140de9)=>{const _0x10a002=a45_0xdc7d12,{companyId:_0x24e432}=_0x5e11ca[_0x10a002(0xb3)],{session:_0x2030b0}=_0x5e11ca[_0x10a002(0x7d)],_0x2da40d=await(0x0,ListWhatsAppsService_1[_0x10a002(0x9b)])({'companyId':_0x24e432,'session':_0x2030b0});return _0x140de9[_0x10a002(0x91)](0xc8)[_0x10a002(0xac)](_0x2da40d);};exports['index']=index;const store=async(_0x51841a,_0x5d78fb)=>{const _0x4f3c88=a45_0xdc7d12,{name:_0x15761d,status:_0x5b31a7,isDefault:_0x19afe8,greetingMessage:_0x410094,complationMessage:_0x447c63,outOfHoursMessage:_0x199281,queueIds:_0x5d4c06,token:_0xdde786,allowGroup:_0x3e1917,timeSendQueue:_0x19c0db,sendIdQueue:_0x3009b5,maxUseBotQueues:_0x3ff71c,timeUseBotQueues:_0x666344,expiresTicket:_0x487329,expiresInactiveMessage:_0x1eac83,importOldMessages:_0x3284d8,importRecentMessages:_0x3b3cea,closedTicketsPostImported:_0x1a3765,importOldMessagesGroups:_0x430d7d}=_0x51841a[_0x4f3c88(0x88)],{companyId:_0x546827}=_0x51841a[_0x4f3c88(0xb3)],{whatsapp:_0x158062,oldDefaultWhatsapp:_0x18b0b0}=await(0x0,CreateWhatsAppService_1[_0x4f3c88(0x9b)])({'name':_0x15761d,'status':_0x5b31a7,'isDefault':_0x19afe8,'greetingMessage':_0x410094,'complationMessage':_0x447c63,'outOfHoursMessage':_0x199281,'queueIds':_0x5d4c06,'companyId':_0x546827,'token':_0xdde786,'timeSendQueue':_0x19c0db,'sendIdQueue':_0x3009b5,'maxUseBotQueues':_0x3ff71c,'timeUseBotQueues':_0x666344,'expiresTicket':_0x487329,'expiresInactiveMessage':_0x1eac83,'allowGroup':_0x3e1917,'importOldMessages':_0x3284d8,'importRecentMessages':_0x3b3cea,'closedTicketsPostImported':_0x1a3765,'importOldMessagesGroups':_0x430d7d});(0x0,StartWhatsAppSession_1[_0x4f3c88(0x7b)])(_0x158062,_0x546827);const _0x4eaf8f=(0x0,socket_1[_0x4f3c88(0xab)])();return _0x4eaf8f['to']('company-'+_0x546827+'-mainchannel')[_0x4f3c88(0x81)](_0x4f3c88(0x8a)+_0x546827+_0x4f3c88(0x8f),{'action':_0x4f3c88(0xa1),'whatsapp':_0x158062}),_0x18b0b0&&_0x4eaf8f['to'](_0x4f3c88(0x8a)+_0x546827+'-mainchannel')[_0x4f3c88(0x81)]('company-'+_0x546827+_0x4f3c88(0x8f),{'action':_0x4f3c88(0xa1),'whatsapp':_0x18b0b0}),_0x5d78fb[_0x4f3c88(0x91)](0xc8)[_0x4f3c88(0xac)](_0x158062);};exports[a45_0xdc7d12(0x96)]=store;const show=async(_0xe5d595,_0x5ef4da)=>{const _0x1fa737=a45_0xdc7d12,{whatsappId:_0x131025}=_0xe5d595[_0x1fa737(0x7c)],{companyId:_0x34ad84}=_0xe5d595[_0x1fa737(0xb3)],{session:_0x315652}=_0xe5d595[_0x1fa737(0x7d)],_0x5d2168=await(0x0,ShowWhatsAppService_1[_0x1fa737(0x9b)])(_0x131025,_0x34ad84,_0x315652);return _0x5ef4da[_0x1fa737(0x91)](0xc8)['json'](_0x5d2168);};exports[a45_0xdc7d12(0x92)]=show;const getAllConnections=async(_0x2de107,_0x9f8f8)=>{const _0x188584=a45_0xdc7d12;try{const _0x37cd2d=await(0x0,FindAllCompaniesService_1['default'])();if(!_0x37cd2d||_0x37cd2d[_0x188584(0x9a)]===0x0)return _0x9f8f8[_0x188584(0x91)](0x194)[_0x188584(0xac)]({'error':'No\x20companies\x20found'});const _0x3d1ed1=[];for(const _0x3e1b35 of _0x37cd2d){if(typeof _0x3e1b35['id']!=='number')continue;const _0x125746=await Whatsapp_1[_0x188584(0x9b)]['findAll']({'where':{'companyId':_0x3e1b35['id']}});_0x3d1ed1[_0x188584(0x86)](..._0x125746);}return _0x9f8f8[_0x188584(0x91)](0xc8)[_0x188584(0xac)](_0x3d1ed1);}catch(_0x5cb60e){return console[_0x188584(0xa0)](_0x5cb60e),_0x9f8f8[_0x188584(0x91)](0x1f4)[_0x188584(0xac)]({'error':_0x188584(0x87)});}};exports[a45_0xdc7d12(0xa5)]=getAllConnections;const update=async(_0x18938c,_0x1f258e)=>{const _0x8d09a8=a45_0xdc7d12,{whatsappId:_0x5154ca}=_0x18938c[_0x8d09a8(0x7c)],_0x3382c0=_0x18938c['body'],{companyId:_0x35a45a}=_0x18938c[_0x8d09a8(0xb3)],{whatsapp:_0x4ef801,oldDefaultWhatsapp:_0x1b6ed1}=await(0x0,UpdateWhatsAppService_1[_0x8d09a8(0x9b)])({'whatsappData':_0x3382c0,'whatsappId':_0x5154ca,'companyId':_0x35a45a}),_0x14f0c4=(0x0,socket_1[_0x8d09a8(0xab)])();return _0x14f0c4['to'](_0x8d09a8(0x8a)+_0x35a45a+_0x8d09a8(0xa3))['emit']('company-'+_0x35a45a+_0x8d09a8(0x8f),{'action':_0x8d09a8(0xa1),'whatsapp':_0x4ef801}),_0x1b6ed1&&_0x14f0c4['to'](_0x8d09a8(0x8a)+_0x35a45a+_0x8d09a8(0xa3))[_0x8d09a8(0x81)](_0x8d09a8(0x8a)+_0x35a45a+'-whatsapp',{'action':_0x8d09a8(0xa1),'whatsapp':_0x1b6ed1}),_0x1f258e[_0x8d09a8(0x91)](0xc8)[_0x8d09a8(0xac)](_0x4ef801);};exports[a45_0xdc7d12(0xa1)]=update;const remove=async(_0x51714f,_0x495b2c)=>{const _0xeb1e8d=a45_0xdc7d12,{whatsappId:_0x4c1fa0}=_0x51714f[_0xeb1e8d(0x7c)],{companyId:_0x1115f6}=_0x51714f['user'],_0x540f54=await(0x0,ShowWhatsAppService_1['default'])(_0x4c1fa0,_0x1115f6),_0x145bce=await _0x540f54['$get']('tickets',{'where':{'status':{[sequelize_1['Op']['or']]:[_0xeb1e8d(0xa6),_0xeb1e8d(0x94)]}}});if(_0x145bce[_0xeb1e8d(0x9a)]>0x0)throw new AppError_1[(_0xeb1e8d(0x9b))](_0xeb1e8d(0xad));await(0x0,DeleteWhatsAppService_1[_0xeb1e8d(0x9b)])(_0x4c1fa0),await(0x0,wbot_1[_0xeb1e8d(0xb0)])(+_0x4c1fa0);const _0x55eff0=(0x0,socket_1[_0xeb1e8d(0xab)])();return _0x55eff0['to']('company-'+_0x1115f6+_0xeb1e8d(0xa3))['emit'](_0xeb1e8d(0x8a)+_0x1115f6+'-whatsapp',{'action':_0xeb1e8d(0xb4),'whatsappId':+_0x4c1fa0}),_0x495b2c[_0xeb1e8d(0x91)](0xc8)[_0xeb1e8d(0xac)]({'message':_0xeb1e8d(0xa9)});};function a45_0x6eda(){const _0x15d254=['ERR_NO_PERMISSION','pending','apply','store','closedTickets','525294ZHyRRJ','../services/WhatsappService/UpdateWhatsAppService','length','default','../libs/socket','../errors/AppError','search','../services/WhatsappService/ListWhatsAppsService','error','update','__esModule','-mainchannel','whatsapp','getAllConnections','open','remove','../services/CompanyService/FindAllCompaniesService','Whatsapp\x20deleted.','266376KzYETO','getIO','json','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','1887290JGsHQv','(((.+)+)+)+$','removeWbot','Whatsapp\x20restart.','../services/WhatsappService/ShowWhatsAppService','user','delete','toString','3SrlanQ','index','../services/WbotServices/StartWhatsAppSession','54575UdKFjA','StartWhatsAppSession','params','query','54bQPotH','../models/Whatsapp','restart','emit','sequelize','818124MOpKqL','5588682uUiEiw','../libs/wbot','push','Failed\x20to\x20fetch\x20connections','body','constructor','company-','114PBHVcA','admin','../services/WhatsappService/DeleteWhatsAppService','201606wqVkLl','-whatsapp','1NDTvHK','status','show'];a45_0x6eda=function(){return _0x15d254;};return a45_0x6eda();}exports[a45_0xdc7d12(0xa7)]=remove;const restart=async(_0x3fcdef,_0x3504c2)=>{const _0x317a3c=a45_0xdc7d12,{companyId:_0x1493b2,profile:_0x1cfaaa}=_0x3fcdef[_0x317a3c(0xb3)];if(_0x1cfaaa!==_0x317a3c(0x8c))throw new AppError_1['default'](_0x317a3c(0x93),0x193);return await(0x0,wbot_1['restartWbot'])(_0x1493b2),_0x3504c2[_0x317a3c(0x91)](0xc8)['json']({'message':_0x317a3c(0xb1)});};exports[a45_0xdc7d12(0x80)]=restart;