const a45_0x1a3cf3=a45_0x46da;(function(_0xaafe9e,_0x4790aa){const _0x4a3991=a45_0x46da,_0x5cc633=_0xaafe9e();while(!![]){try{const _0x117448=-parseInt(_0x4a3991(0x168))/0x1+parseInt(_0x4a3991(0x17d))/0x2*(-parseInt(_0x4a3991(0x186))/0x3)+parseInt(_0x4a3991(0x199))/0x4*(-parseInt(_0x4a3991(0x175))/0x5)+parseInt(_0x4a3991(0x16d))/0x6+-parseInt(_0x4a3991(0x16e))/0x7*(-parseInt(_0x4a3991(0x17a))/0x8)+parseInt(_0x4a3991(0x190))/0x9*(-parseInt(_0x4a3991(0x187))/0xa)+parseInt(_0x4a3991(0x182))/0xb;if(_0x117448===_0x4790aa)break;else _0x5cc633['push'](_0x5cc633['shift']());}catch(_0x40a89c){_0x5cc633['push'](_0x5cc633['shift']());}}}(a45_0x4ecf,0x54961));const a45_0x117d42=(function(){let _0x133132=!![];return function(_0x15df0,_0x3d31e0){const _0x182241=_0x133132?function(){if(_0x3d31e0){const _0x5a6d34=_0x3d31e0['apply'](_0x15df0,arguments);return _0x3d31e0=null,_0x5a6d34;}}:function(){};return _0x133132=![],_0x182241;};}()),a45_0x309cf9=a45_0x117d42(this,function(){const _0x5015d8=a45_0x46da;return a45_0x309cf9['toString']()[_0x5015d8(0x1aa)]('(((.+)+)+)+$')[_0x5015d8(0x19c)]()[_0x5015d8(0x16f)](a45_0x309cf9)['search'](_0x5015d8(0x1a2));});a45_0x309cf9();'use strict';var __importDefault=this&&this[a45_0x1a3cf3(0x1a8)]||function(_0x20e7a4){const _0x2b43d3=a45_0x1a3cf3;return _0x20e7a4&&_0x20e7a4[_0x2b43d3(0x176)]?_0x20e7a4:{'default':_0x20e7a4};};Object[a45_0x1a3cf3(0x196)](exports,a45_0x1a3cf3(0x176),{'value':!![]}),exports[a45_0x1a3cf3(0x19a)]=exports[a45_0x1a3cf3(0x174)]=exports[a45_0x1a3cf3(0x17e)]=exports[a45_0x1a3cf3(0x181)]=exports['store']=exports[a45_0x1a3cf3(0x194)]=void 0x0;const sequelize_1=require(a45_0x1a3cf3(0x170)),cache_1=require(a45_0x1a3cf3(0x19e)),socket_1=require(a45_0x1a3cf3(0x193)),wbot_1=require('../libs/wbot'),Whatsapp_1=__importDefault(require(a45_0x1a3cf3(0x18f))),DeleteBaileysService_1=__importDefault(require(a45_0x1a3cf3(0x17c))),StartWhatsAppSession_1=require(a45_0x1a3cf3(0x19f)),CreateWhatsAppService_1=__importDefault(require(a45_0x1a3cf3(0x197))),DeleteWhatsAppService_1=__importDefault(require(a45_0x1a3cf3(0x178))),ListWhatsAppsService_1=__importDefault(require(a45_0x1a3cf3(0x169))),ShowWhatsAppService_1=__importDefault(require(a45_0x1a3cf3(0x183))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),AppError_1=__importDefault(require(a45_0x1a3cf3(0x192))),index=async(_0x143837,_0x5357e6)=>{const _0x13ea2d=a45_0x1a3cf3,{companyId:_0x967489}=_0x143837['user'],{session:_0x728634}=_0x143837[_0x13ea2d(0x16b)],_0x1d048b=await(0x0,ListWhatsAppsService_1[_0x13ea2d(0x180)])({'companyId':_0x967489,'session':_0x728634});return _0x5357e6['status'](0xc8)['json'](_0x1d048b);};exports[a45_0x1a3cf3(0x194)]=index;const store=async(_0x4d9ff2,_0x226ac5)=>{const _0x5ec030=a45_0x1a3cf3,{name:_0x38c420,status:_0xe335ae,isDefault:_0x3ff074,greetingMessage:_0x378f07,complationMessage:_0x88bee8,outOfHoursMessage:_0x52b4c0,allowGroup:_0x2c3a60,timeSendQueue:_0x483692,sendIdQueue:_0x164e94,useRating:_0x547df3,ratingMessage:_0x284164,transferMessage:_0x55af5c,queueIds:_0x48bbcb,token:_0x468e05,maxUseBotQueues:_0x3c7587,expiresTicket:_0x2029b1,expiresInactiveMessage:_0x444192,importOldMessages:_0x356650,schedules:_0x46a8e0,whenExpireTicket:_0x5bf6d2,inactiveMessageTime:_0x259011,inactiveMessage:_0x5168b1,automaticRestart:_0x2e94a5,period:_0x3c60e9}=_0x4d9ff2[_0x5ec030(0x188)],{companyId:_0x59cbab}=_0x4d9ff2['user'],{whatsapp:_0x3fba92,oldDefaultWhatsapp:_0x149f0b}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x38c420,'status':_0xe335ae,'isDefault':_0x3ff074,'greetingMessage':_0x378f07,'complationMessage':_0x88bee8,'outOfHoursMessage':_0x52b4c0,'useRating':_0x547df3,'ratingMessage':_0x284164,'transferMessage':_0x55af5c,'queueIds':_0x48bbcb,'companyId':_0x59cbab,'token':_0x468e05,'maxUseBotQueues':_0x3c7587,'timeSendQueue':_0x483692,'sendIdQueue':_0x164e94,'expiresTicket':_0x2029b1,'expiresInactiveMessage':_0x444192,'allowGroup':_0x2c3a60,'importOldMessages':_0x356650,'schedules':_0x46a8e0,'whenExpireTicket':_0x5bf6d2,'inactiveMessageTime':_0x259011,'inactiveMessage':_0x5168b1,'automaticRestart':_0x2e94a5,'period':_0x3c60e9});(0x0,StartWhatsAppSession_1[_0x5ec030(0x1a4)])(_0x3fba92,_0x59cbab);const _0x2ec8c2=(0x0,socket_1[_0x5ec030(0x1a5)])();return _0x2ec8c2[_0x5ec030(0x191)]('company-'+_0x59cbab+_0x5ec030(0x1a3),{'action':_0x5ec030(0x17e),'whatsapp':_0x3fba92}),_0x149f0b&&_0x2ec8c2[_0x5ec030(0x191)](_0x5ec030(0x1a9)+_0x59cbab+_0x5ec030(0x1a3),{'action':'update','whatsapp':_0x149f0b}),_0x226ac5[_0x5ec030(0x18a)](0xc8)[_0x5ec030(0x198)](_0x3fba92);};function a45_0x4ecf(){const _0x2cf046=['restart','122470yryJVs','__esModule','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','../services/WhatsappService/DeleteWhatsAppService','$get','56HVAJNk','Session\x20disconnected.','../services/BaileysServices/DeleteBaileysService','128134MTJTtY','update','findAll','default','show','14503896BrBABy','../services/WhatsappService/ShowWhatsAppService','instagram','destroy','27QFWQAV','62110MTTTue','body','admin','status','channel','delFromPattern','store','removeWbot','../models/Whatsapp','738Glqfrx','emit','../errors/AppError','../libs/socket','index','user','defineProperty','../services/WhatsappService/CreateWhatsAppService','json','76IIYyOy','remove','params','toString','open','../libs/cache','../services/WbotServices/StartWhatsAppSession','facebook','tickets','(((.+)+)+)+$','-whatsapp','StartWhatsAppSession','getIO','length','sessions:','__importDefault','company-','search','152801YmaSfp','../services/WhatsappService/ListWhatsAppsService','ERR_NO_PERMISSION','query','forEach','3625584EPVlGg','127757mhBnCz','constructor','sequelize','whatsapp','cacheLayer','pending'];a45_0x4ecf=function(){return _0x2cf046;};return a45_0x4ecf();}exports[a45_0x1a3cf3(0x18d)]=store;const show=async(_0x3ce350,_0x2fd75d)=>{const _0x297758=a45_0x1a3cf3,{whatsappId:_0xea4d66}=_0x3ce350['params'],{companyId:_0x47b44a}=_0x3ce350['user'],{session:_0x1fd743}=_0x3ce350[_0x297758(0x16b)],_0x1f8461=await(0x0,ShowWhatsAppService_1[_0x297758(0x180)])(_0xea4d66,_0x47b44a,_0x1fd743);return _0x2fd75d[_0x297758(0x18a)](0xc8)[_0x297758(0x198)](_0x1f8461);};exports[a45_0x1a3cf3(0x181)]=show;const update=async(_0x4958b3,_0x5ed307)=>{const _0x5623ab=a45_0x1a3cf3,{whatsappId:_0x2d279a}=_0x4958b3[_0x5623ab(0x19b)],_0x243b92=_0x4958b3[_0x5623ab(0x188)],{companyId:_0x13a603}=_0x4958b3[_0x5623ab(0x195)],{whatsapp:_0x3d0f1f,oldDefaultWhatsapp:_0x311388}=await(0x0,UpdateWhatsAppService_1[_0x5623ab(0x180)])({'whatsappData':_0x243b92,'whatsappId':_0x2d279a,'companyId':_0x13a603}),_0x87a0c5=(0x0,socket_1[_0x5623ab(0x1a5)])();return _0x87a0c5[_0x5623ab(0x191)](_0x5623ab(0x1a9)+_0x13a603+_0x5623ab(0x1a3),{'action':'update','whatsapp':_0x3d0f1f}),_0x311388&&_0x87a0c5[_0x5623ab(0x191)]('company-'+_0x13a603+_0x5623ab(0x1a3),{'action':'update','whatsapp':_0x311388}),_0x5ed307[_0x5623ab(0x18a)](0xc8)[_0x5623ab(0x198)](_0x3d0f1f);};exports[a45_0x1a3cf3(0x17e)]=update;const restart=async(_0x8a3397,_0x18b1f8)=>{const _0x51849d=a45_0x1a3cf3,{companyId:_0x1428b9,profile:_0x2615f9}=_0x8a3397[_0x51849d(0x195)];if(_0x2615f9!==_0x51849d(0x189))throw new AppError_1[(_0x51849d(0x180))](_0x51849d(0x16a),0x193);const _0x337b39=await Whatsapp_1[_0x51849d(0x180)][_0x51849d(0x17f)]({'where':{'companyId':_0x1428b9}});for(const _0x6b3ba8 of _0x337b39){await(0x0,wbot_1[_0x51849d(0x18e)])(_0x6b3ba8['id'],![]),await new Promise(_0x46ee84=>setTimeout(_0x46ee84,0xbb8)),await(0x0,StartWhatsAppSession_1[_0x51849d(0x1a4)])(_0x6b3ba8,_0x1428b9),await _0x6b3ba8[_0x51849d(0x17e)]({'lastRestartAt':new Date()});}return _0x18b1f8[_0x51849d(0x18a)](0xc8)['json']({'message':'Whatsapp\x20connections\x20restarted.'});};exports['restart']=restart;const remove=async(_0x5cafad,_0x537a26)=>{const _0x3bceac=a45_0x1a3cf3,{whatsappId:_0x2a6e50}=_0x5cafad[_0x3bceac(0x19b)],{companyId:_0x21ed76}=_0x5cafad['user'],_0x40e4df=(0x0,socket_1[_0x3bceac(0x1a5)])(),_0x4d9590=await(0x0,ShowWhatsAppService_1[_0x3bceac(0x180)])(_0x2a6e50,_0x21ed76);if(_0x4d9590[_0x3bceac(0x18b)]===_0x3bceac(0x171)){const _0x44aaa1=await _0x4d9590[_0x3bceac(0x179)](_0x3bceac(0x1a1),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x3bceac(0x19d),_0x3bceac(0x173)]}}});if(_0x44aaa1[_0x3bceac(0x1a6)]>0x0)throw new AppError_1[(_0x3bceac(0x180))](_0x3bceac(0x177));await(0x0,DeleteBaileysService_1['default'])(_0x2a6e50),await(0x0,DeleteWhatsAppService_1[_0x3bceac(0x180)])(_0x2a6e50),await cache_1[_0x3bceac(0x172)][_0x3bceac(0x18c)](_0x3bceac(0x1a7)+_0x2a6e50+':*'),(0x0,wbot_1[_0x3bceac(0x18e)])(+_0x2a6e50),_0x40e4df[_0x3bceac(0x191)](_0x3bceac(0x1a9)+_0x21ed76+_0x3bceac(0x1a3),{'action':'delete','whatsappId':+_0x2a6e50});}if(_0x4d9590['channel']===_0x3bceac(0x1a0)||_0x4d9590[_0x3bceac(0x18b)]===_0x3bceac(0x184)){const {facebookUserToken:_0x149fab}=_0x4d9590,_0x1d066a=await Whatsapp_1[_0x3bceac(0x180)][_0x3bceac(0x17f)]({'where':{'facebookUserToken':_0x149fab}});await Whatsapp_1[_0x3bceac(0x180)][_0x3bceac(0x185)]({'where':{'facebookUserToken':_0x149fab}}),_0x1d066a[_0x3bceac(0x16c)](_0x8713da=>{const _0x3938bb=_0x3bceac;_0x40e4df[_0x3938bb(0x191)]('company-'+_0x21ed76+_0x3938bb(0x1a3),{'action':'delete','whatsappId':_0x8713da['id']});});}return _0x537a26[_0x3bceac(0x18a)](0xc8)[_0x3bceac(0x198)]({'message':_0x3bceac(0x17b)});};function a45_0x46da(_0xdcd53d,_0x168edf){const _0x4dbb5c=a45_0x4ecf();return a45_0x46da=function(_0x309cf9,_0x117d42){_0x309cf9=_0x309cf9-0x168;let _0x4ecff5=_0x4dbb5c[_0x309cf9];return _0x4ecff5;},a45_0x46da(_0xdcd53d,_0x168edf);}exports[a45_0x1a3cf3(0x19a)]=remove;