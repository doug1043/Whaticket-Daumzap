const a45_0x3533d2=a45_0x2752;(function(_0x3b8f0c,_0x5397b7){const _0x27209a=a45_0x2752,_0x1872ec=_0x3b8f0c();while(!![]){try{const _0x127e87=-parseInt(_0x27209a(0x1f0))/0x1*(-parseInt(_0x27209a(0x1e0))/0x2)+parseInt(_0x27209a(0x1d1))/0x3+parseInt(_0x27209a(0x1fe))/0x4+parseInt(_0x27209a(0x1dd))/0x5+-parseInt(_0x27209a(0x1ff))/0x6*(-parseInt(_0x27209a(0x1e6))/0x7)+parseInt(_0x27209a(0x1cc))/0x8+parseInt(_0x27209a(0x1db))/0x9*(-parseInt(_0x27209a(0x1ca))/0xa);if(_0x127e87===_0x5397b7)break;else _0x1872ec['push'](_0x1872ec['shift']());}catch(_0x1b9502){_0x1872ec['push'](_0x1872ec['shift']());}}}(a45_0x2331,0xbfb8e));const a45_0x3b70fd=(function(){let _0x4997ce=!![];return function(_0x5469d6,_0x13ff7e){const _0x1d9e83=_0x4997ce?function(){const _0x5cef37=a45_0x2752;if(_0x13ff7e){const _0x572188=_0x13ff7e[_0x5cef37(0x1f4)](_0x5469d6,arguments);return _0x13ff7e=null,_0x572188;}}:function(){};return _0x4997ce=![],_0x1d9e83;};}()),a45_0x87201a=a45_0x3b70fd(this,function(){const _0x12c28c=a45_0x2752;return a45_0x87201a['toString']()[_0x12c28c(0x200)](_0x12c28c(0x1e7))[_0x12c28c(0x1d0)]()['constructor'](a45_0x87201a)[_0x12c28c(0x200)](_0x12c28c(0x1e7));});function a45_0x2752(_0x3102c9,_0xfaa4d4){const _0x34ae53=a45_0x2331();return a45_0x2752=function(_0x87201a,_0x3b70fd){_0x87201a=_0x87201a-0x1c8;let _0x23316a=_0x34ae53[_0x87201a];return _0x23316a;},a45_0x2752(_0x3102c9,_0xfaa4d4);}a45_0x87201a();'use strict';var __importDefault=this&&this[a45_0x3533d2(0x1e1)]||function(_0xd24e51){return _0xd24e51&&_0xd24e51['__esModule']?_0xd24e51:{'default':_0xd24e51};};Object[a45_0x3533d2(0x1cd)](exports,a45_0x3533d2(0x1d6),{'value':!![]}),exports[a45_0x3533d2(0x1e3)]=exports[a45_0x3533d2(0x1d2)]=exports[a45_0x3533d2(0x1fc)]=exports['show']=exports[a45_0x3533d2(0x1f2)]=exports[a45_0x3533d2(0x1f3)]=void 0x0;const sequelize_1=require('sequelize'),cache_1=require('../libs/cache'),socket_1=require(a45_0x3533d2(0x1f5)),wbot_1=require(a45_0x3533d2(0x1de)),Whatsapp_1=__importDefault(require(a45_0x3533d2(0x1da))),DeleteBaileysService_1=__importDefault(require(a45_0x3533d2(0x1cf))),StartWhatsAppSession_1=require('../services/WbotServices/StartWhatsAppSession'),CreateWhatsAppService_1=__importDefault(require(a45_0x3533d2(0x1f7))),DeleteWhatsAppService_1=__importDefault(require(a45_0x3533d2(0x1e9))),ListWhatsAppsService_1=__importDefault(require(a45_0x3533d2(0x201))),ShowWhatsAppService_1=__importDefault(require(a45_0x3533d2(0x1d9))),UpdateWhatsAppService_1=__importDefault(require(a45_0x3533d2(0x1d7))),AppError_1=__importDefault(require('../errors/AppError')),index=async(_0xef24f,_0x235aad)=>{const _0x1054f9=a45_0x3533d2,{companyId:_0x3adad5}=_0xef24f[_0x1054f9(0x1ce)],{session:_0xc63216}=_0xef24f['query'],_0xf34da1=await(0x0,ListWhatsAppsService_1[_0x1054f9(0x1d8)])({'companyId':_0x3adad5,'session':_0xc63216});return _0x235aad[_0x1054f9(0x1e2)](0xc8)['json'](_0xf34da1);};exports[a45_0x3533d2(0x1f3)]=index;const store=async(_0x364176,_0xcc1d0a)=>{const _0x3a0d1d=a45_0x3533d2,{name:_0x3485ec,status:_0x451eae,isDefault:_0x51555f,greetingMessage:_0x386fdc,complationMessage:_0x47044a,outOfHoursMessage:_0x1306b7,allowGroup:_0x2e2219,timeSendQueue:_0x150811,sendIdQueue:_0x214826,useRating:_0x14f288,ratingMessage:_0x363e1a,transferMessage:_0x14adbf,queueIds:_0x669888,token:_0x345cb1,maxUseBotQueues:_0x18f62e,expiresTicket:_0xd682e4,expiresInactiveMessage:_0x74aaab,importOldMessages:_0x5ce9dd,schedules:_0x84bd56,whenExpireTicket:_0xdec185,inactiveMessageTime:_0x1dd375,inactiveMessage:_0x52690a,automaticRestart:_0x2864d9,period:_0x22b650}=_0x364176[_0x3a0d1d(0x1fd)],{companyId:_0x2682a0}=_0x364176[_0x3a0d1d(0x1ce)],{whatsapp:_0x40f76d,oldDefaultWhatsapp:_0x35fb7e}=await(0x0,CreateWhatsAppService_1[_0x3a0d1d(0x1d8)])({'name':_0x3485ec,'status':_0x451eae,'isDefault':_0x51555f,'greetingMessage':_0x386fdc,'complationMessage':_0x47044a,'outOfHoursMessage':_0x1306b7,'useRating':_0x14f288,'ratingMessage':_0x363e1a,'transferMessage':_0x14adbf,'queueIds':_0x669888,'companyId':_0x2682a0,'token':_0x345cb1,'maxUseBotQueues':_0x18f62e,'timeSendQueue':_0x150811,'sendIdQueue':_0x214826,'expiresTicket':_0xd682e4,'expiresInactiveMessage':_0x74aaab,'allowGroup':_0x2e2219,'importOldMessages':_0x5ce9dd,'schedules':_0x84bd56,'whenExpireTicket':_0xdec185,'inactiveMessageTime':_0x1dd375,'inactiveMessage':_0x52690a,'automaticRestart':_0x2864d9,'period':_0x22b650});(0x0,StartWhatsAppSession_1[_0x3a0d1d(0x1f1)])(_0x40f76d,_0x2682a0);const _0x3112c4=(0x0,socket_1[_0x3a0d1d(0x1fa)])();return _0x3112c4['emit'](_0x3a0d1d(0x1e5)+_0x2682a0+_0x3a0d1d(0x1dc),{'action':_0x3a0d1d(0x1fc),'whatsapp':_0x40f76d}),_0x35fb7e&&_0x3112c4[_0x3a0d1d(0x1e8)]('company-'+_0x2682a0+_0x3a0d1d(0x1dc),{'action':'update','whatsapp':_0x35fb7e}),_0xcc1d0a[_0x3a0d1d(0x1e2)](0xc8)[_0x3a0d1d(0x1ef)](_0x40f76d);};exports[a45_0x3533d2(0x1f2)]=store;const show=async(_0x1d8356,_0x5710a2)=>{const _0x144501=a45_0x3533d2,{whatsappId:_0x555774}=_0x1d8356['params'],{companyId:_0x19cfcb}=_0x1d8356[_0x144501(0x1ce)],{session:_0x26eaf2}=_0x1d8356[_0x144501(0x1e4)],_0x166313=await(0x0,ShowWhatsAppService_1[_0x144501(0x1d8)])(_0x555774,_0x19cfcb,_0x26eaf2);return _0x5710a2[_0x144501(0x1e2)](0xc8)[_0x144501(0x1ef)](_0x166313);};exports[a45_0x3533d2(0x1df)]=show;const update=async(_0x4987d9,_0x37989d)=>{const _0x2adb83=a45_0x3533d2,{whatsappId:_0x87e28b}=_0x4987d9[_0x2adb83(0x1f9)],_0x1df4e1=_0x4987d9[_0x2adb83(0x1fd)],{companyId:_0x42316a}=_0x4987d9['user'],{whatsapp:_0x5770e1,oldDefaultWhatsapp:_0x4ccdc1}=await(0x0,UpdateWhatsAppService_1[_0x2adb83(0x1d8)])({'whatsappData':_0x1df4e1,'whatsappId':_0x87e28b,'companyId':_0x42316a}),_0x598fce=(0x0,socket_1[_0x2adb83(0x1fa)])();return _0x598fce[_0x2adb83(0x1e8)](_0x2adb83(0x1e5)+_0x42316a+'-whatsapp',{'action':_0x2adb83(0x1fc),'whatsapp':_0x5770e1}),_0x4ccdc1&&_0x598fce[_0x2adb83(0x1e8)]('company-'+_0x42316a+'-whatsapp',{'action':_0x2adb83(0x1fc),'whatsapp':_0x4ccdc1}),_0x37989d['status'](0xc8)[_0x2adb83(0x1ef)](_0x5770e1);};exports[a45_0x3533d2(0x1fc)]=update;function a45_0x2331(){const _0x268918=['-whatsapp','5438755VqzCNk','../libs/wbot','show','14yYdgPs','__importDefault','status','remove','query','company-','118867GONaUy','(((.+)+)+)+$','emit','../services/WhatsappService/DeleteWhatsAppService','admin','forEach','pending','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','$get','json','195798wOrdGa','StartWhatsAppSession','store','index','apply','../libs/socket','findAll','../services/WhatsappService/CreateWhatsAppService','delFromPattern','params','getIO','destroy','update','body','2553324RDdWVO','102lLSNUG','search','../services/WhatsappService/ListWhatsAppsService','channel','ERR_NO_PERMISSION','45283060tlbElR','Whatsapp\x20connections\x20restarted.','3787104rzIAZW','defineProperty','user','../services/BaileysServices/DeleteBaileysService','toString','4364601GpWgcL','restart','removeWbot','delete','sessions:','__esModule','../services/WhatsappService/UpdateWhatsAppService','default','../services/WhatsappService/ShowWhatsAppService','../models/Whatsapp','9MoOGdL'];a45_0x2331=function(){return _0x268918;};return a45_0x2331();}const restart=async(_0x2468fe,_0x49fb7c)=>{const _0x5d2b27=a45_0x3533d2,{companyId:_0x32f7c6,profile:_0x5c72f7}=_0x2468fe['user'];if(_0x5c72f7!==_0x5d2b27(0x1ea))throw new AppError_1['default'](_0x5d2b27(0x1c9),0x193);const _0x521319=await Whatsapp_1[_0x5d2b27(0x1d8)][_0x5d2b27(0x1f6)]({'where':{'companyId':_0x32f7c6}});for(const _0x5082f9 of _0x521319){await(0x0,wbot_1[_0x5d2b27(0x1d3)])(_0x5082f9['id'],![]),await new Promise(_0x36aece=>setTimeout(_0x36aece,0xbb8)),await(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x5082f9,_0x32f7c6),await _0x5082f9[_0x5d2b27(0x1fc)]({'lastRestartAt':new Date()});}return _0x49fb7c[_0x5d2b27(0x1e2)](0xc8)['json']({'message':_0x5d2b27(0x1cb)});};exports[a45_0x3533d2(0x1d2)]=restart;const remove=async(_0x1673ae,_0x55ed18)=>{const _0x1647e9=a45_0x3533d2,{whatsappId:_0x4b8d03}=_0x1673ae[_0x1647e9(0x1f9)],{companyId:_0xc6ba8e}=_0x1673ae[_0x1647e9(0x1ce)],_0x102f52=(0x0,socket_1[_0x1647e9(0x1fa)])(),_0x594899=await(0x0,ShowWhatsAppService_1['default'])(_0x4b8d03,_0xc6ba8e);if(_0x594899[_0x1647e9(0x1c8)]==='whatsapp'){const _0x4269f3=await _0x594899[_0x1647e9(0x1ee)]('tickets',{'where':{'status':{[sequelize_1['Op']['or']]:['open',_0x1647e9(0x1ec)]}}});if(_0x4269f3['length']>0x0)throw new AppError_1[(_0x1647e9(0x1d8))](_0x1647e9(0x1ed));await(0x0,DeleteBaileysService_1['default'])(_0x4b8d03),await(0x0,DeleteWhatsAppService_1[_0x1647e9(0x1d8)])(_0x4b8d03),await cache_1['cacheLayer'][_0x1647e9(0x1f8)](_0x1647e9(0x1d5)+_0x4b8d03+':*'),(0x0,wbot_1['removeWbot'])(+_0x4b8d03),_0x102f52[_0x1647e9(0x1e8)]('company-'+_0xc6ba8e+_0x1647e9(0x1dc),{'action':_0x1647e9(0x1d4),'whatsappId':+_0x4b8d03});}if(_0x594899[_0x1647e9(0x1c8)]==='facebook'||_0x594899[_0x1647e9(0x1c8)]==='instagram'){const {facebookUserToken:_0x319555}=_0x594899,_0xb0eb0a=await Whatsapp_1[_0x1647e9(0x1d8)][_0x1647e9(0x1f6)]({'where':{'facebookUserToken':_0x319555}});await Whatsapp_1['default'][_0x1647e9(0x1fb)]({'where':{'facebookUserToken':_0x319555}}),_0xb0eb0a[_0x1647e9(0x1eb)](_0xb3d380=>{const _0x501be3=_0x1647e9;_0x102f52[_0x501be3(0x1e8)](_0x501be3(0x1e5)+_0xc6ba8e+_0x501be3(0x1dc),{'action':'delete','whatsappId':_0xb3d380['id']});});}return _0x55ed18['status'](0xc8)[_0x1647e9(0x1ef)]({'message':'Session\x20disconnected.'});};exports['remove']=remove;