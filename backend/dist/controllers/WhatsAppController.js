const a45_0x383126=a45_0x454b;(function(_0x371705,_0xfb633e){const _0x341373=a45_0x454b,_0x5762c2=_0x371705();while(!![]){try{const _0x1cc0d5=parseInt(_0x341373(0xf3))/0x1+-parseInt(_0x341373(0xe5))/0x2+parseInt(_0x341373(0xce))/0x3+-parseInt(_0x341373(0xdb))/0x4*(parseInt(_0x341373(0xe4))/0x5)+parseInt(_0x341373(0xcd))/0x6*(-parseInt(_0x341373(0x101))/0x7)+parseInt(_0x341373(0xf0))/0x8*(-parseInt(_0x341373(0xd0))/0x9)+parseInt(_0x341373(0xf6))/0xa;if(_0x1cc0d5===_0xfb633e)break;else _0x5762c2['push'](_0x5762c2['shift']());}catch(_0x169ffb){_0x5762c2['push'](_0x5762c2['shift']());}}}(a45_0x1eeb,0xc6b9e));const a45_0xee3318=(function(){let _0x3ddf1d=!![];return function(_0x5aa6f5,_0x51d08a){const _0x20e818=_0x3ddf1d?function(){const _0x1627ce=a45_0x454b;if(_0x51d08a){const _0x569215=_0x51d08a[_0x1627ce(0xf9)](_0x5aa6f5,arguments);return _0x51d08a=null,_0x569215;}}:function(){};return _0x3ddf1d=![],_0x20e818;};}()),a45_0x1ebffb=a45_0xee3318(this,function(){const _0x42f06c=a45_0x454b;return a45_0x1ebffb[_0x42f06c(0xd1)]()[_0x42f06c(0xff)](_0x42f06c(0xdd))[_0x42f06c(0xd1)]()[_0x42f06c(0xd6)](a45_0x1ebffb)['search'](_0x42f06c(0xdd));});a45_0x1ebffb();'use strict';var __importDefault=this&&this[a45_0x383126(0xcf)]||function(_0x15aa8a){const _0x4405d0=a45_0x383126;return _0x15aa8a&&_0x15aa8a[_0x4405d0(0xf8)]?_0x15aa8a:{'default':_0x15aa8a};};Object[a45_0x383126(0xde)](exports,a45_0x383126(0xf8),{'value':!![]}),exports['remove']=exports[a45_0x383126(0xe3)]=exports[a45_0x383126(0xd4)]=exports[a45_0x383126(0xf2)]=exports['store']=exports[a45_0x383126(0xe1)]=void 0x0;const sequelize_1=require(a45_0x383126(0xe0)),cache_1=require('../libs/cache'),socket_1=require(a45_0x383126(0xd2)),wbot_1=require(a45_0x383126(0xc6)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),DeleteBaileysService_1=__importDefault(require(a45_0x383126(0xe9))),StartWhatsAppSession_1=require(a45_0x383126(0x104)),CreateWhatsAppService_1=__importDefault(require(a45_0x383126(0xd7))),DeleteWhatsAppService_1=__importDefault(require(a45_0x383126(0xdf))),ListWhatsAppsService_1=__importDefault(require(a45_0x383126(0x100))),ShowWhatsAppService_1=__importDefault(require(a45_0x383126(0xeb))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),AppError_1=__importDefault(require(a45_0x383126(0xd9))),index=async(_0x39501d,_0xdeea7e)=>{const _0x1af248=a45_0x383126,{companyId:_0x576615}=_0x39501d[_0x1af248(0x103)],{session:_0x567524}=_0x39501d['query'],_0x424aaf=await(0x0,ListWhatsAppsService_1[_0x1af248(0xfc)])({'companyId':_0x576615,'session':_0x567524});return _0xdeea7e[_0x1af248(0xc7)](0xc8)['json'](_0x424aaf);};exports[a45_0x383126(0xe1)]=index;const store=async(_0x332a77,_0x13007e)=>{const _0x46f5de=a45_0x383126,{name:_0x1ca145,status:_0x3dd1d8,isDefault:_0x42f0cf,greetingMessage:_0x2f8cab,complationMessage:_0x3415f7,outOfHoursMessage:_0x297fea,allowGroup:_0x952707,timeSendQueue:_0x900bf,sendIdQueue:_0x2af2d0,useRating:_0x28f0f5,ratingMessage:_0x28cdb6,transferMessage:_0x178058,queueIds:_0x361403,token:_0x3c6c0e,maxUseBotQueues:_0x2cb165,expiresTicket:_0x584ae7,expiresInactiveMessage:_0x248e5d,importOldMessages:_0x51bcca,schedules:_0x251179,whenExpireTicket:_0x2530f9,inactiveMessageTime:_0xb19d69,inactiveMessage:_0xb82414,automaticRestart:_0x4246ae,period:_0x295f62}=_0x332a77[_0x46f5de(0xca)],{companyId:_0x4d4e58}=_0x332a77[_0x46f5de(0x103)],{whatsapp:_0x317444,oldDefaultWhatsapp:_0x4b48e4}=await(0x0,CreateWhatsAppService_1[_0x46f5de(0xfc)])({'name':_0x1ca145,'status':_0x3dd1d8,'isDefault':_0x42f0cf,'greetingMessage':_0x2f8cab,'complationMessage':_0x3415f7,'outOfHoursMessage':_0x297fea,'useRating':_0x28f0f5,'ratingMessage':_0x28cdb6,'transferMessage':_0x178058,'queueIds':_0x361403,'companyId':_0x4d4e58,'token':_0x3c6c0e,'maxUseBotQueues':_0x2cb165,'timeSendQueue':_0x900bf,'sendIdQueue':_0x2af2d0,'expiresTicket':_0x584ae7,'expiresInactiveMessage':_0x248e5d,'allowGroup':_0x952707,'importOldMessages':_0x51bcca,'schedules':_0x251179,'whenExpireTicket':_0x2530f9,'inactiveMessageTime':_0xb19d69,'inactiveMessage':_0xb82414,'automaticRestart':_0x4246ae,'period':_0x295f62});(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x317444,_0x4d4e58);const _0x17429f=(0x0,socket_1[_0x46f5de(0xf4)])();return _0x17429f[_0x46f5de(0xdc)]('company-'+_0x4d4e58+_0x46f5de(0xed),{'action':_0x46f5de(0xd4),'whatsapp':_0x317444}),_0x4b48e4&&_0x17429f[_0x46f5de(0xdc)](_0x46f5de(0xf7)+_0x4d4e58+'-whatsapp',{'action':_0x46f5de(0xd4),'whatsapp':_0x4b48e4}),_0x13007e[_0x46f5de(0xc7)](0xc8)[_0x46f5de(0xda)](_0x317444);};exports[a45_0x383126(0xe2)]=store;const show=async(_0x279800,_0x2e7d9c)=>{const _0x397b45=a45_0x383126,{whatsappId:_0x120b09}=_0x279800[_0x397b45(0xea)],{companyId:_0x11d6f5}=_0x279800['user'],{session:_0x3f4ae6}=_0x279800['query'],_0x32ebaf=await(0x0,ShowWhatsAppService_1[_0x397b45(0xfc)])(_0x120b09,_0x11d6f5,_0x3f4ae6);return _0x2e7d9c[_0x397b45(0xc7)](0xc8)[_0x397b45(0xda)](_0x32ebaf);};exports[a45_0x383126(0xf2)]=show;const update=async(_0x3aa2b4,_0x32c6a8)=>{const _0x4fd874=a45_0x383126,{whatsappId:_0x3566f0}=_0x3aa2b4[_0x4fd874(0xea)],_0x1ca40a=_0x3aa2b4[_0x4fd874(0xca)],{companyId:_0xf4c249}=_0x3aa2b4[_0x4fd874(0x103)],{whatsapp:_0x40bb4f,oldDefaultWhatsapp:_0xbf8fc1}=await(0x0,UpdateWhatsAppService_1[_0x4fd874(0xfc)])({'whatsappData':_0x1ca40a,'whatsappId':_0x3566f0,'companyId':_0xf4c249}),_0x36ad1d=(0x0,socket_1[_0x4fd874(0xf4)])();return _0x36ad1d[_0x4fd874(0xdc)](_0x4fd874(0xf7)+_0xf4c249+_0x4fd874(0xed),{'action':_0x4fd874(0xd4),'whatsapp':_0x40bb4f}),_0xbf8fc1&&_0x36ad1d['emit'](_0x4fd874(0xf7)+_0xf4c249+'-whatsapp',{'action':'update','whatsapp':_0xbf8fc1}),_0x32c6a8[_0x4fd874(0xc7)](0xc8)[_0x4fd874(0xda)](_0x40bb4f);};exports[a45_0x383126(0xd4)]=update;function a45_0x454b(_0x377efa,_0x23a1c1){const _0x35342f=a45_0x1eeb();return a45_0x454b=function(_0x1ebffb,_0xee3318){_0x1ebffb=_0x1ebffb-0xc6;let _0x1eeb26=_0x35342f[_0x1ebffb];return _0x1eeb26;},a45_0x454b(_0x377efa,_0x23a1c1);}function a45_0x1eeb(){const _0x7a2781=['../services/WhatsappService/CreateWhatsAppService','tickets','../errors/AppError','json','36fRAAnb','emit','(((.+)+)+)+$','defineProperty','../services/WhatsappService/DeleteWhatsAppService','sequelize','index','store','restart','255405gTVPlu','2503862rcsIBm','StartWhatsAppSession','cacheLayer','open','../services/BaileysServices/DeleteBaileysService','params','../services/WhatsappService/ShowWhatsAppService','destroy','-whatsapp','ERR_NO_PERMISSION','removeWbot','4563304rlFkgC','Session\x20disconnected.','show','209871IEjNpR','getIO','facebook','41216640cFkcnq','company-','__esModule','apply','whatsapp','Whatsapp\x20connections\x20restarted.','default','length','delete','search','../services/WhatsappService/ListWhatsAppsService','7488579fGtzcu','findAll','user','../services/WbotServices/StartWhatsAppSession','../libs/wbot','status','channel','pending','body','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','admin','6iKdwsW','1214190xTOXOp','__importDefault','18ohnlvF','toString','../libs/socket','instagram','update','remove','constructor'];a45_0x1eeb=function(){return _0x7a2781;};return a45_0x1eeb();}const restart=async(_0x1d1a70,_0x455459)=>{const _0x570eb4=a45_0x383126,{companyId:_0x5c8ea1,profile:_0x5a36d1}=_0x1d1a70[_0x570eb4(0x103)];if(_0x5a36d1!==_0x570eb4(0xcc))throw new AppError_1[(_0x570eb4(0xfc))](_0x570eb4(0xee),0x193);const _0x38054f=await Whatsapp_1[_0x570eb4(0xfc)]['findAll']({'where':{'companyId':_0x5c8ea1}});for(const _0x551703 of _0x38054f){await(0x0,wbot_1['removeWbot'])(_0x551703['id'],![]),await new Promise(_0x54f04f=>setTimeout(_0x54f04f,0xbb8)),await(0x0,StartWhatsAppSession_1[_0x570eb4(0xe6)])(_0x551703,_0x5c8ea1),await _0x551703['update']({'lastRestartAt':new Date()});}return _0x455459[_0x570eb4(0xc7)](0xc8)['json']({'message':_0x570eb4(0xfb)});};exports[a45_0x383126(0xe3)]=restart;const remove=async(_0x93d7a8,_0x302b08)=>{const _0x23dc0c=a45_0x383126,{whatsappId:_0x5d4605}=_0x93d7a8[_0x23dc0c(0xea)],{companyId:_0x554900}=_0x93d7a8[_0x23dc0c(0x103)],_0xc6bda8=(0x0,socket_1[_0x23dc0c(0xf4)])(),_0xb192f9=await(0x0,ShowWhatsAppService_1['default'])(_0x5d4605,_0x554900);if(_0xb192f9[_0x23dc0c(0xc8)]===_0x23dc0c(0xfa)){const _0xd76493=await _0xb192f9['$get'](_0x23dc0c(0xd8),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x23dc0c(0xe8),_0x23dc0c(0xc9)]}}});if(_0xd76493[_0x23dc0c(0xfd)]>0x0)throw new AppError_1['default'](_0x23dc0c(0xcb));await(0x0,DeleteBaileysService_1[_0x23dc0c(0xfc)])(_0x5d4605),await(0x0,DeleteWhatsAppService_1[_0x23dc0c(0xfc)])(_0x5d4605),await cache_1[_0x23dc0c(0xe7)]['delFromPattern']('sessions:'+_0x5d4605+':*'),(0x0,wbot_1[_0x23dc0c(0xef)])(+_0x5d4605),_0xc6bda8['emit']('company-'+_0x554900+_0x23dc0c(0xed),{'action':_0x23dc0c(0xfe),'whatsappId':+_0x5d4605});}if(_0xb192f9[_0x23dc0c(0xc8)]===_0x23dc0c(0xf5)||_0xb192f9[_0x23dc0c(0xc8)]===_0x23dc0c(0xd3)){const {facebookUserToken:_0x2c4e9d}=_0xb192f9,_0x1e1588=await Whatsapp_1['default'][_0x23dc0c(0x102)]({'where':{'facebookUserToken':_0x2c4e9d}});await Whatsapp_1[_0x23dc0c(0xfc)][_0x23dc0c(0xec)]({'where':{'facebookUserToken':_0x2c4e9d}}),_0x1e1588['forEach'](_0x24853e=>{const _0x5245f3=_0x23dc0c;_0xc6bda8[_0x5245f3(0xdc)](_0x5245f3(0xf7)+_0x554900+_0x5245f3(0xed),{'action':_0x5245f3(0xfe),'whatsappId':_0x24853e['id']});});}return _0x302b08[_0x23dc0c(0xc7)](0xc8)[_0x23dc0c(0xda)]({'message':_0x23dc0c(0xf1)});};exports[a45_0x383126(0xd5)]=remove;