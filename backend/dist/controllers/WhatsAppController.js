const a45_0x328466=a45_0x2e13;(function(_0xa773b0,_0x8988b8){const _0x23dcfe=a45_0x2e13,_0xcd792f=_0xa773b0();while(!![]){try{const _0x1c534a=-parseInt(_0x23dcfe(0x19a))/0x1+-parseInt(_0x23dcfe(0x1af))/0x2*(parseInt(_0x23dcfe(0x1b6))/0x3)+parseInt(_0x23dcfe(0x1a3))/0x4*(-parseInt(_0x23dcfe(0x187))/0x5)+-parseInt(_0x23dcfe(0x198))/0x6*(parseInt(_0x23dcfe(0x180))/0x7)+-parseInt(_0x23dcfe(0x1b4))/0x8+parseInt(_0x23dcfe(0x193))/0x9+-parseInt(_0x23dcfe(0x191))/0xa*(-parseInt(_0x23dcfe(0x1b8))/0xb);if(_0x1c534a===_0x8988b8)break;else _0xcd792f['push'](_0xcd792f['shift']());}catch(_0x1bd2cd){_0xcd792f['push'](_0xcd792f['shift']());}}}(a45_0x5bdf,0xc1f76));const a45_0x23c995=(function(){let _0x40a984=!![];return function(_0x5487b9,_0x3f5903){const _0x3adf12=_0x40a984?function(){const _0x3e2af5=a45_0x2e13;if(_0x3f5903){const _0x1c80ec=_0x3f5903[_0x3e2af5(0x17e)](_0x5487b9,arguments);return _0x3f5903=null,_0x1c80ec;}}:function(){};return _0x40a984=![],_0x3adf12;};}()),a45_0x42693c=a45_0x23c995(this,function(){const _0x414cab=a45_0x2e13;return a45_0x42693c[_0x414cab(0x199)]()[_0x414cab(0x18e)]('(((.+)+)+)+$')[_0x414cab(0x199)]()[_0x414cab(0x1ad)](a45_0x42693c)[_0x414cab(0x18e)](_0x414cab(0x188));});a45_0x42693c();'use strict';var __importDefault=this&&this[a45_0x328466(0x19e)]||function(_0x4a4f7e){const _0x4ae63b=a45_0x328466;return _0x4a4f7e&&_0x4a4f7e[_0x4ae63b(0x184)]?_0x4a4f7e:{'default':_0x4a4f7e};};Object[a45_0x328466(0x192)](exports,a45_0x328466(0x184),{'value':!![]}),exports[a45_0x328466(0x183)]=exports[a45_0x328466(0x1a0)]=exports[a45_0x328466(0x1ab)]=exports[a45_0x328466(0x1b1)]=exports[a45_0x328466(0x197)]=exports['index']=void 0x0;function a45_0x5bdf(){const _0x2a3105=['sessions:','length','store','6CiojjA','toString','596026sqxajg','facebook','../services/WhatsappService/DeleteWhatsAppService','../errors/AppError','__importDefault','emit','restart','json','open','4Ihusmc','company-','whatsapp','pending','index','findAll','tickets','Whatsapp\x20connections\x20restarted.','update','../services/WbotServices/StartWhatsAppSession','constructor','status','6SDJpHw','query','show','StartWhatsAppSession','forEach','3447896LEOzOw','sequelize','50862KSzxqJ','cacheLayer','25854796IxJweT','instagram','../services/BaileysServices/DeleteBaileysService','channel','Session\x20disconnected.','../models/Whatsapp','delete','delFromPattern','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','apply','user','3186484zbknlD','../services/WhatsappService/CreateWhatsAppService','../services/WhatsappService/ShowWhatsAppService','remove','__esModule','removeWbot','../libs/wbot','3260860GAkhJv','(((.+)+)+)+$','-whatsapp','destroy','admin','params','default','search','getIO','$get','10qVToRr','defineProperty','5663781tcMmWc','../services/WhatsappService/ListWhatsAppsService'];a45_0x5bdf=function(){return _0x2a3105;};return a45_0x5bdf();}const sequelize_1=require(a45_0x328466(0x1b5)),cache_1=require('../libs/cache'),socket_1=require('../libs/socket'),wbot_1=require(a45_0x328466(0x186)),Whatsapp_1=__importDefault(require(a45_0x328466(0x1bd))),DeleteBaileysService_1=__importDefault(require(a45_0x328466(0x1ba))),StartWhatsAppSession_1=require(a45_0x328466(0x1ac)),CreateWhatsAppService_1=__importDefault(require(a45_0x328466(0x181))),DeleteWhatsAppService_1=__importDefault(require(a45_0x328466(0x19c))),ListWhatsAppsService_1=__importDefault(require(a45_0x328466(0x194))),ShowWhatsAppService_1=__importDefault(require(a45_0x328466(0x182))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),AppError_1=__importDefault(require(a45_0x328466(0x19d))),index=async(_0x3d185c,_0x2cf4cd)=>{const _0x59cf5b=a45_0x328466,{companyId:_0x2185ec,id:_0x32e669}=_0x3d185c[_0x59cf5b(0x17f)],{session:_0xd930f0}=_0x3d185c['query'],_0x2e9d62=await(0x0,ListWhatsAppsService_1['default'])({'companyId':_0x2185ec,'session':_0xd930f0,'userId':+_0x32e669});return _0x2cf4cd[_0x59cf5b(0x1ae)](0xc8)['json'](_0x2e9d62);};exports[a45_0x328466(0x1a7)]=index;const store=async(_0x4bc572,_0x586044)=>{const _0x5e5ce4=a45_0x328466,{name:_0x26f53b,status:_0x4c2827,isDefault:_0x525b54,greetingMessage:_0x3abd64,complationMessage:_0x249441,outOfHoursMessage:_0x1fb75a,allowGroup:_0x317c3d,timeSendQueue:_0x472fc8,sendIdQueue:_0x5a4c10,useRating:_0x2ceacc,ratingMessage:_0x227310,transferMessage:_0x2ba25b,queueIds:_0x5ec584,token:_0x2c9ae1,maxUseBotQueues:_0x346935,expiresTicket:_0x4c3313,expiresInactiveMessage:_0x7bb9e3,importOldMessages:_0x57bfc7,schedules:_0x414982,whenExpireTicket:_0x3dcfdf,inactiveMessageTime:_0x4b6cd0,inactiveMessage:_0x2eb835,automaticRestart:_0x272def,period:_0x44a066}=_0x4bc572['body'],{companyId:_0x263da2}=_0x4bc572[_0x5e5ce4(0x17f)],{whatsapp:_0x4869cb,oldDefaultWhatsapp:_0x2f2796}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x26f53b,'status':_0x4c2827,'isDefault':_0x525b54,'greetingMessage':_0x3abd64,'complationMessage':_0x249441,'outOfHoursMessage':_0x1fb75a,'useRating':_0x2ceacc,'ratingMessage':_0x227310,'transferMessage':_0x2ba25b,'queueIds':_0x5ec584,'companyId':_0x263da2,'token':_0x2c9ae1,'maxUseBotQueues':_0x346935,'timeSendQueue':_0x472fc8,'sendIdQueue':_0x5a4c10,'expiresTicket':_0x4c3313,'expiresInactiveMessage':_0x7bb9e3,'allowGroup':_0x317c3d,'importOldMessages':_0x57bfc7,'schedules':_0x414982,'whenExpireTicket':_0x3dcfdf,'inactiveMessageTime':_0x4b6cd0,'inactiveMessage':_0x2eb835,'automaticRestart':_0x272def,'period':_0x44a066});(0x0,StartWhatsAppSession_1[_0x5e5ce4(0x1b2)])(_0x4869cb,_0x263da2);const _0x483f87=(0x0,socket_1[_0x5e5ce4(0x18f)])();return _0x483f87['emit'](_0x5e5ce4(0x1a4)+_0x263da2+_0x5e5ce4(0x189),{'action':_0x5e5ce4(0x1ab),'whatsapp':_0x4869cb}),_0x2f2796&&_0x483f87[_0x5e5ce4(0x19f)](_0x5e5ce4(0x1a4)+_0x263da2+_0x5e5ce4(0x189),{'action':'update','whatsapp':_0x2f2796}),_0x586044[_0x5e5ce4(0x1ae)](0xc8)['json'](_0x4869cb);};function a45_0x2e13(_0x38d087,_0x15b9a9){const _0x587da9=a45_0x5bdf();return a45_0x2e13=function(_0x42693c,_0x23c995){_0x42693c=_0x42693c-0x17e;let _0x5bdfc8=_0x587da9[_0x42693c];return _0x5bdfc8;},a45_0x2e13(_0x38d087,_0x15b9a9);}exports[a45_0x328466(0x197)]=store;const show=async(_0xce8795,_0x6f7720)=>{const _0x184b75=a45_0x328466,{whatsappId:_0x3fa08d}=_0xce8795[_0x184b75(0x18c)],{companyId:_0x3c13a1}=_0xce8795['user'],{session:_0x5a4454}=_0xce8795[_0x184b75(0x1b0)],_0xc00f21=await(0x0,ShowWhatsAppService_1[_0x184b75(0x18d)])(_0x3fa08d,_0x3c13a1,_0x5a4454);return _0x6f7720[_0x184b75(0x1ae)](0xc8)['json'](_0xc00f21);};exports[a45_0x328466(0x1b1)]=show;const update=async(_0x232bb8,_0x2036a4)=>{const _0x9029df=a45_0x328466,{whatsappId:_0x3e1648}=_0x232bb8['params'],_0x269aff=_0x232bb8['body'],{companyId:_0x534179}=_0x232bb8[_0x9029df(0x17f)],{whatsapp:_0x36dbcd,oldDefaultWhatsapp:_0x46d988}=await(0x0,UpdateWhatsAppService_1[_0x9029df(0x18d)])({'whatsappData':_0x269aff,'whatsappId':_0x3e1648,'companyId':_0x534179}),_0x80b286=(0x0,socket_1['getIO'])();return _0x80b286['emit'](_0x9029df(0x1a4)+_0x534179+_0x9029df(0x189),{'action':'update','whatsapp':_0x36dbcd}),_0x46d988&&_0x80b286[_0x9029df(0x19f)](_0x9029df(0x1a4)+_0x534179+'-whatsapp',{'action':_0x9029df(0x1ab),'whatsapp':_0x46d988}),_0x2036a4[_0x9029df(0x1ae)](0xc8)[_0x9029df(0x1a1)](_0x36dbcd);};exports[a45_0x328466(0x1ab)]=update;const restart=async(_0x5c3c78,_0x125fc8)=>{const _0x4d1cbb=a45_0x328466,{companyId:_0x3cbb91,profile:_0x5c4196}=_0x5c3c78[_0x4d1cbb(0x17f)];if(_0x5c4196!==_0x4d1cbb(0x18b))throw new AppError_1[(_0x4d1cbb(0x18d))]('ERR_NO_PERMISSION',0x193);const _0x3cf0f2=await Whatsapp_1[_0x4d1cbb(0x18d)][_0x4d1cbb(0x1a8)]({'where':{'companyId':_0x3cbb91}});for(const _0x1b583e of _0x3cf0f2){await(0x0,wbot_1[_0x4d1cbb(0x185)])(_0x1b583e['id'],![]),await new Promise(_0x3cbc30=>setTimeout(_0x3cbc30,0xbb8)),await(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x1b583e,_0x3cbb91),await _0x1b583e[_0x4d1cbb(0x1ab)]({'lastRestartAt':new Date()});}return _0x125fc8[_0x4d1cbb(0x1ae)](0xc8)['json']({'message':_0x4d1cbb(0x1aa)});};exports[a45_0x328466(0x1a0)]=restart;const remove=async(_0x1da015,_0x9fdd64)=>{const _0x59158e=a45_0x328466,{whatsappId:_0x1f7519}=_0x1da015[_0x59158e(0x18c)],{companyId:_0x30649c}=_0x1da015[_0x59158e(0x17f)],_0x3c1b08=(0x0,socket_1[_0x59158e(0x18f)])(),_0x10665f=await(0x0,ShowWhatsAppService_1[_0x59158e(0x18d)])(_0x1f7519,_0x30649c);if(_0x10665f[_0x59158e(0x1bb)]===_0x59158e(0x1a5)){const _0x5b4464=await _0x10665f[_0x59158e(0x190)](_0x59158e(0x1a9),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x59158e(0x1a2),_0x59158e(0x1a6)]}}});if(_0x5b4464[_0x59158e(0x196)]>0x0)throw new AppError_1[(_0x59158e(0x18d))](_0x59158e(0x1c0));await(0x0,DeleteBaileysService_1[_0x59158e(0x18d)])(_0x1f7519),await(0x0,DeleteWhatsAppService_1[_0x59158e(0x18d)])(_0x1f7519),await cache_1[_0x59158e(0x1b7)][_0x59158e(0x1bf)](_0x59158e(0x195)+_0x1f7519+':*'),(0x0,wbot_1['removeWbot'])(+_0x1f7519),_0x3c1b08[_0x59158e(0x19f)](_0x59158e(0x1a4)+_0x30649c+_0x59158e(0x189),{'action':_0x59158e(0x1be),'whatsappId':+_0x1f7519});}if(_0x10665f[_0x59158e(0x1bb)]===_0x59158e(0x19b)||_0x10665f[_0x59158e(0x1bb)]===_0x59158e(0x1b9)){const {facebookUserToken:_0xc90a5e}=_0x10665f,_0x135bc0=await Whatsapp_1[_0x59158e(0x18d)]['findAll']({'where':{'facebookUserToken':_0xc90a5e}});await Whatsapp_1[_0x59158e(0x18d)][_0x59158e(0x18a)]({'where':{'facebookUserToken':_0xc90a5e}}),_0x135bc0[_0x59158e(0x1b3)](_0x35c7cf=>{const _0x3c84ed=_0x59158e;_0x3c1b08[_0x3c84ed(0x19f)](_0x3c84ed(0x1a4)+_0x30649c+_0x3c84ed(0x189),{'action':_0x3c84ed(0x1be),'whatsappId':_0x35c7cf['id']});});}return _0x9fdd64[_0x59158e(0x1ae)](0xc8)['json']({'message':_0x59158e(0x1bc)});};exports[a45_0x328466(0x183)]=remove;