const a46_0x2df8c4=a46_0x2755;(function(_0x290857,_0x408bf2){const _0x434ad8=a46_0x2755,_0x1ec93b=_0x290857();while(!![]){try{const _0x3b8e75=-parseInt(_0x434ad8(0x1e3))/0x1+-parseInt(_0x434ad8(0x1e9))/0x2+-parseInt(_0x434ad8(0x1e8))/0x3+-parseInt(_0x434ad8(0x1c4))/0x4*(-parseInt(_0x434ad8(0x1e6))/0x5)+parseInt(_0x434ad8(0x1de))/0x6*(parseInt(_0x434ad8(0x1dd))/0x7)+-parseInt(_0x434ad8(0x1d9))/0x8*(parseInt(_0x434ad8(0x1e4))/0x9)+parseInt(_0x434ad8(0x1f7))/0xa*(parseInt(_0x434ad8(0x1d1))/0xb);if(_0x3b8e75===_0x408bf2)break;else _0x1ec93b['push'](_0x1ec93b['shift']());}catch(_0x5edc4e){_0x1ec93b['push'](_0x1ec93b['shift']());}}}(a46_0x4fb3,0xccd83));const a46_0x563dc6=(function(){let _0x2be22b=!![];return function(_0x2d9601,_0x3dc61b){const _0x171c03=_0x2be22b?function(){const _0x3faf08=a46_0x2755;if(_0x3dc61b){const _0x518ccd=_0x3dc61b[_0x3faf08(0x1d2)](_0x2d9601,arguments);return _0x3dc61b=null,_0x518ccd;}}:function(){};return _0x2be22b=![],_0x171c03;};}()),a46_0x1b0a40=a46_0x563dc6(this,function(){const _0x1aa097=a46_0x2755;return a46_0x1b0a40[_0x1aa097(0x1d6)]()[_0x1aa097(0x1da)]('(((.+)+)+)+$')[_0x1aa097(0x1d6)]()[_0x1aa097(0x1dc)](a46_0x1b0a40)['search'](_0x1aa097(0x1ea));});function a46_0x2755(_0x11dc2f,_0x1cc64e){const _0x184222=a46_0x4fb3();return a46_0x2755=function(_0x1b0a40,_0x563dc6){_0x1b0a40=_0x1b0a40-0x1c4;let _0x4fb3ed=_0x184222[_0x1b0a40];return _0x4fb3ed;},a46_0x2755(_0x11dc2f,_0x1cc64e);}a46_0x1b0a40();'use strict';var __importDefault=this&&this[a46_0x2df8c4(0x1e0)]||function(_0x48db67){const _0x4d5bd6=a46_0x2df8c4;return _0x48db67&&_0x48db67[_0x4d5bd6(0x1ef)]?_0x48db67:{'default':_0x48db67};};Object[a46_0x2df8c4(0x1f5)](exports,a46_0x2df8c4(0x1ef),{'value':!![]}),exports[a46_0x2df8c4(0x1f6)]=exports[a46_0x2df8c4(0x1c6)]=exports[a46_0x2df8c4(0x1e7)]=exports[a46_0x2df8c4(0x1d5)]=exports[a46_0x2df8c4(0x1db)]=exports[a46_0x2df8c4(0x1df)]=exports[a46_0x2df8c4(0x1ce)]=exports['closedTickets']=void 0x0;const socket_1=require('../libs/socket'),wbot_1=require(a46_0x2df8c4(0x1c9)),StartWhatsAppSession_1=require('../services/WbotServices/StartWhatsAppSession'),FindAllCompaniesService_1=__importDefault(require('../services/CompanyService/FindAllCompaniesService')),CreateWhatsAppService_1=__importDefault(require(a46_0x2df8c4(0x1cd))),DeleteWhatsAppService_1=__importDefault(require('../services/WhatsappService/DeleteWhatsAppService')),ListWhatsAppsService_1=__importDefault(require('../services/WhatsappService/ListWhatsAppsService')),ShowWhatsAppService_1=__importDefault(require('../services/WhatsappService/ShowWhatsAppService')),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),AppError_1=__importDefault(require(a46_0x2df8c4(0x1cb))),sequelize_1=require('sequelize'),ImportWhatsAppMessageService_1=require(a46_0x2df8c4(0x1c7)),Whatsapp_1=__importDefault(require(a46_0x2df8c4(0x1fb))),closedTickets=async(_0x27f93e,_0x26e8e5)=>{const _0x3128ee=a46_0x2df8c4,{whatsappId:_0x3e39f5}=_0x27f93e[_0x3128ee(0x1fd)];return await(0x0,ImportWhatsAppMessageService_1[_0x3128ee(0x1f1)])(_0x3e39f5),_0x26e8e5[_0x3128ee(0x1d4)](0xc8)['json'](_0x3128ee(0x200));};exports[a46_0x2df8c4(0x1eb)]=closedTickets;const index=async(_0x40b163,_0xf4d56b)=>{const _0x27e51a=a46_0x2df8c4,{companyId:_0x493cd9}=_0x40b163[_0x27e51a(0x1fa)],{session:_0x22f56e}=_0x40b163[_0x27e51a(0x203)],_0x528646=await(0x0,ListWhatsAppsService_1[_0x27e51a(0x1d7)])({'companyId':_0x493cd9,'session':_0x22f56e});return _0xf4d56b['status'](0xc8)[_0x27e51a(0x1d0)](_0x528646);};exports[a46_0x2df8c4(0x1ce)]=index;const store=async(_0x180c36,_0x337f1a)=>{const _0x1551f1=a46_0x2df8c4,{name:_0x570a45,status:_0x3ad66a,isDefault:_0x1c9b7e,greetingMessage:_0x3c7780,complationMessage:_0x2d92f,outOfHoursMessage:_0x325ef4,queueIds:_0x4bbd1d,token:_0x7180d8,allowGroup:_0x80d3b2,timeSendQueue:_0x24f12a,sendIdQueue:_0x5d53b9,promptId:_0x292ef0,maxUseBotQueues:_0xfb3aa0,timeUseBotQueues:_0x4a1104,expiresTicket:_0x23b607,expiresInactiveMessage:_0x314cd3,importOldMessages:_0x485746,importRecentMessages:_0x218a15,closedTicketsPostImported:_0x327b0c,importOldMessagesGroups:_0x108b17}=_0x180c36[_0x1551f1(0x1f0)],{companyId:_0x4a055c}=_0x180c36['user'],{whatsapp:_0x2ad4e7,oldDefaultWhatsapp:_0x1d3fd4}=await(0x0,CreateWhatsAppService_1[_0x1551f1(0x1d7)])({'name':_0x570a45,'status':_0x3ad66a,'isDefault':_0x1c9b7e,'greetingMessage':_0x3c7780,'complationMessage':_0x2d92f,'outOfHoursMessage':_0x325ef4,'queueIds':_0x4bbd1d,'companyId':_0x4a055c,'token':_0x7180d8,'timeSendQueue':_0x24f12a,'sendIdQueue':_0x5d53b9,'promptId':_0x292ef0,'maxUseBotQueues':_0xfb3aa0,'timeUseBotQueues':_0x4a1104,'expiresTicket':_0x23b607,'expiresInactiveMessage':_0x314cd3,'allowGroup':_0x80d3b2,'importOldMessages':_0x485746,'importRecentMessages':_0x218a15,'closedTicketsPostImported':_0x327b0c,'importOldMessagesGroups':_0x108b17});(0x0,StartWhatsAppSession_1[_0x1551f1(0x1e2)])(_0x2ad4e7,_0x4a055c);const _0x29ac07=(0x0,socket_1[_0x1551f1(0x1ec)])();return _0x29ac07['to']('company-'+_0x4a055c+_0x1551f1(0x1f3))['emit'](_0x1551f1(0x1ed)+_0x4a055c+'-whatsapp',{'action':_0x1551f1(0x1e7),'whatsapp':_0x2ad4e7}),_0x1d3fd4&&_0x29ac07['to']('company-'+_0x4a055c+_0x1551f1(0x1f3))[_0x1551f1(0x1ff)](_0x1551f1(0x1ed)+_0x4a055c+'-whatsapp',{'action':'update','whatsapp':_0x1d3fd4}),_0x337f1a[_0x1551f1(0x1d4)](0xc8)[_0x1551f1(0x1d0)](_0x2ad4e7);};exports[a46_0x2df8c4(0x1df)]=store;const show=async(_0x55e491,_0x1896c3)=>{const _0x547e8c=a46_0x2df8c4,{whatsappId:_0x15597b}=_0x55e491[_0x547e8c(0x1fd)],{companyId:_0x5cb138}=_0x55e491['user'],{session:_0x3674d1}=_0x55e491[_0x547e8c(0x203)],_0x5bcef9=await(0x0,ShowWhatsAppService_1[_0x547e8c(0x1d7)])(_0x15597b,_0x5cb138,_0x3674d1);return _0x1896c3['status'](0xc8)[_0x547e8c(0x1d0)](_0x5bcef9);};exports[a46_0x2df8c4(0x1db)]=show;const getAllConnections=async(_0x392629,_0x58b83e)=>{const _0x23484c=a46_0x2df8c4;try{const _0x21637d=await(0x0,FindAllCompaniesService_1[_0x23484c(0x1d7)])();if(!_0x21637d||_0x21637d[_0x23484c(0x1f4)]===0x0)return _0x58b83e[_0x23484c(0x1d4)](0x194)[_0x23484c(0x1d0)]({'error':_0x23484c(0x1ee)});const _0x459213=[];for(const _0xe7910e of _0x21637d){if(typeof _0xe7910e['id']!==_0x23484c(0x1c8))continue;const _0x5d0f4b=await Whatsapp_1[_0x23484c(0x1d7)][_0x23484c(0x1cc)]({'where':{'companyId':_0xe7910e['id']}});_0x459213[_0x23484c(0x1fe)](..._0x5d0f4b);}return _0x58b83e[_0x23484c(0x1d4)](0xc8)[_0x23484c(0x1d0)](_0x459213);}catch(_0x34f7bf){return console[_0x23484c(0x1f2)](_0x34f7bf),_0x58b83e['status'](0x1f4)['json']({'error':_0x23484c(0x201)});}};exports[a46_0x2df8c4(0x1d5)]=getAllConnections;const update=async(_0x12d5de,_0x279595)=>{const _0x89e695=a46_0x2df8c4,{whatsappId:_0x39aafb}=_0x12d5de[_0x89e695(0x1fd)],_0x2d4562=_0x12d5de[_0x89e695(0x1f0)],{companyId:_0x55153f}=_0x12d5de[_0x89e695(0x1fa)],{whatsapp:_0x26d2cb,oldDefaultWhatsapp:_0x280370}=await(0x0,UpdateWhatsAppService_1[_0x89e695(0x1d7)])({'whatsappData':_0x2d4562,'whatsappId':_0x39aafb,'companyId':_0x55153f}),_0x3ca751=(0x0,socket_1[_0x89e695(0x1ec)])();return _0x3ca751['to']('company-'+_0x55153f+'-mainchannel')[_0x89e695(0x1ff)](_0x89e695(0x1ed)+_0x55153f+_0x89e695(0x1f9),{'action':_0x89e695(0x1e7),'whatsapp':_0x26d2cb}),_0x280370&&_0x3ca751['to']('company-'+_0x55153f+_0x89e695(0x1f3))[_0x89e695(0x1ff)](_0x89e695(0x1ed)+_0x55153f+'-whatsapp',{'action':_0x89e695(0x1e7),'whatsapp':_0x280370}),_0x279595[_0x89e695(0x1d4)](0xc8)['json'](_0x26d2cb);};exports[a46_0x2df8c4(0x1e7)]=update;const remove=async(_0x8e1024,_0x136c6e)=>{const _0x433b79=a46_0x2df8c4,{whatsappId:_0x4d6e97}=_0x8e1024[_0x433b79(0x1fd)],{companyId:_0x3cfc1d}=_0x8e1024[_0x433b79(0x1fa)],_0x54afde=await(0x0,ShowWhatsAppService_1[_0x433b79(0x1d7)])(_0x4d6e97,_0x3cfc1d),_0x205572=await _0x54afde[_0x433b79(0x1d8)](_0x433b79(0x1c5),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x433b79(0x1cf),_0x433b79(0x1d3)]}}});if(_0x205572[_0x433b79(0x1f4)]>0x0)throw new AppError_1[(_0x433b79(0x1d7))](_0x433b79(0x1e1));await(0x0,DeleteWhatsAppService_1[_0x433b79(0x1d7)])(_0x4d6e97),await(0x0,wbot_1['removeWbot'])(+_0x4d6e97);const _0x1d0eea=(0x0,socket_1['getIO'])();return _0x1d0eea['to'](_0x433b79(0x1ed)+_0x3cfc1d+_0x433b79(0x1f3))[_0x433b79(0x1ff)](_0x433b79(0x1ed)+_0x3cfc1d+_0x433b79(0x1f9),{'action':_0x433b79(0x1ca),'whatsappId':+_0x4d6e97}),_0x136c6e[_0x433b79(0x1d4)](0xc8)['json']({'message':_0x433b79(0x1f8)});};exports['remove']=remove;function a46_0x4fb3(){const _0x50f67c=['constructor','5694703BPzuGc','12TEjXEp','store','__importDefault','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','StartWhatsAppSession','1355974uVkJVm','18ouXJZb','admin','51420fJSDgz','update','2128017glvxQQ','3065450lOYSDb','(((.+)+)+)+$','closedTickets','getIO','company-','No\x20companies\x20found','__esModule','body','closeImportedTickets','error','-mainchannel','length','defineProperty','restart','490tZknTL','Whatsapp\x20deleted.','-whatsapp','user','../models/Whatsapp','ERR_NO_PERMISSION','params','push','emit','whatsapp','Failed\x20to\x20fetch\x20connections','Whatsapp\x20restart.','query','144wHhfIA','tickets','remove','../services/WhatsappService/ImportWhatsAppMessageService','number','../libs/wbot','delete','../errors/AppError','findAll','../services/WhatsappService/CreateWhatsAppService','index','open','json','734239TfPqua','apply','pending','status','getAllConnections','toString','default','$get','3323608lUSEOJ','search','show'];a46_0x4fb3=function(){return _0x50f67c;};return a46_0x4fb3();}const restart=async(_0x38ffc2,_0x17c794)=>{const _0x438fbb=a46_0x2df8c4,{companyId:_0x443612,profile:_0x2d4dc1}=_0x38ffc2[_0x438fbb(0x1fa)];if(_0x2d4dc1!==_0x438fbb(0x1e5))throw new AppError_1[(_0x438fbb(0x1d7))](_0x438fbb(0x1fc),0x193);return await(0x0,wbot_1['restartWbot'])(_0x443612),_0x17c794[_0x438fbb(0x1d4)](0xc8)['json']({'message':_0x438fbb(0x202)});};exports[a46_0x2df8c4(0x1f6)]=restart;