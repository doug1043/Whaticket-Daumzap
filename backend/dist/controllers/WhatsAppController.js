const a46_0x521d8f=a46_0x121d;(function(_0x240881,_0x434947){const _0x21d2a3=a46_0x121d,_0xb2f25b=_0x240881();while(!![]){try{const _0x399d71=parseInt(_0x21d2a3(0xa8))/0x1+parseInt(_0x21d2a3(0xb8))/0x2*(parseInt(_0x21d2a3(0xbc))/0x3)+-parseInt(_0x21d2a3(0xbf))/0x4+-parseInt(_0x21d2a3(0xc9))/0x5*(parseInt(_0x21d2a3(0x92))/0x6)+-parseInt(_0x21d2a3(0xab))/0x7*(parseInt(_0x21d2a3(0x8a))/0x8)+-parseInt(_0x21d2a3(0xc0))/0x9*(-parseInt(_0x21d2a3(0xc6))/0xa)+parseInt(_0x21d2a3(0x9d))/0xb*(-parseInt(_0x21d2a3(0xb6))/0xc);if(_0x399d71===_0x434947)break;else _0xb2f25b['push'](_0xb2f25b['shift']());}catch(_0x49093e){_0xb2f25b['push'](_0xb2f25b['shift']());}}}(a46_0x4cf2,0x88acd));const a46_0x21bd30=(function(){let _0x3380b4=!![];return function(_0x1fec7f,_0x27da02){const _0x1d068f=_0x3380b4?function(){if(_0x27da02){const _0xc9a0f9=_0x27da02['apply'](_0x1fec7f,arguments);return _0x27da02=null,_0xc9a0f9;}}:function(){};return _0x3380b4=![],_0x1d068f;};}()),a46_0x4e8e6b=a46_0x21bd30(this,function(){const _0x27ec49=a46_0x121d;return a46_0x4e8e6b['toString']()[_0x27ec49(0xaf)](_0x27ec49(0xb5))[_0x27ec49(0xae)]()['constructor'](a46_0x4e8e6b)[_0x27ec49(0xaf)]('(((.+)+)+)+$');});a46_0x4e8e6b();'use strict';var __importDefault=this&&this[a46_0x521d8f(0xa0)]||function(_0x377adf){const _0x120414=a46_0x521d8f;return _0x377adf&&_0x377adf[_0x120414(0xa5)]?_0x377adf:{'default':_0x377adf};};Object[a46_0x521d8f(0x8e)](exports,'__esModule',{'value':!![]}),exports['restart']=exports[a46_0x521d8f(0xc8)]=exports[a46_0x521d8f(0xc7)]=exports[a46_0x521d8f(0xa6)]=exports[a46_0x521d8f(0xbd)]=exports[a46_0x521d8f(0xad)]=exports['index']=exports[a46_0x521d8f(0xb7)]=void 0x0;const socket_1=require(a46_0x521d8f(0x98)),wbot_1=require(a46_0x521d8f(0xaa)),StartWhatsAppSession_1=require(a46_0x521d8f(0xa9)),FindAllCompaniesService_1=__importDefault(require(a46_0x521d8f(0xb3))),CreateWhatsAppService_1=__importDefault(require(a46_0x521d8f(0x90))),DeleteWhatsAppService_1=__importDefault(require(a46_0x521d8f(0x9c))),ListWhatsAppsService_1=__importDefault(require(a46_0x521d8f(0x8f))),ShowWhatsAppService_1=__importDefault(require(a46_0x521d8f(0xb0))),UpdateWhatsAppService_1=__importDefault(require(a46_0x521d8f(0xbe))),AppError_1=__importDefault(require(a46_0x521d8f(0x91))),sequelize_1=require('sequelize'),ImportWhatsAppMessageService_1=require('../services/WhatsappService/ImportWhatsAppMessageService'),Whatsapp_1=__importDefault(require(a46_0x521d8f(0xa3))),closedTickets=async(_0x352d6d,_0x296650)=>{const _0x2b41ae=a46_0x521d8f,{whatsappId:_0x2a59df}=_0x352d6d[_0x2b41ae(0xac)];return await(0x0,ImportWhatsAppMessageService_1[_0x2b41ae(0xba)])(_0x2a59df),_0x296650['status'](0xc8)[_0x2b41ae(0xa7)](_0x2b41ae(0x9b));};exports[a46_0x521d8f(0xb7)]=closedTickets;const index=async(_0x46a877,_0x463240)=>{const _0x3a38fb=a46_0x521d8f,{companyId:_0x2f468f}=_0x46a877[_0x3a38fb(0xb4)],{session:_0x18aa41}=_0x46a877[_0x3a38fb(0x9a)],_0x1c1b0b=await(0x0,ListWhatsAppsService_1[_0x3a38fb(0xc1)])({'companyId':_0x2f468f,'session':_0x18aa41});return _0x463240[_0x3a38fb(0x94)](0xc8)['json'](_0x1c1b0b);};exports[a46_0x521d8f(0xb1)]=index;const store=async(_0x2227ea,_0x1ea429)=>{const _0x58a841=a46_0x521d8f,{name:_0x21cb1e,status:_0x438bff,isDefault:_0x3edd60,greetingMessage:_0x4816ec,complationMessage:_0x27ed81,outOfHoursMessage:_0x221acf,queueIds:_0x4375e7,token:_0x4ca0e7,allowGroup:_0x55a9df,timeSendQueue:_0x1c8901,sendIdQueue:_0x38f940,promptId:_0x416eb4,maxUseBotQueues:_0x4394a5,timeUseBotQueues:_0x594e8f,expiresTicket:_0xa6e103,expiresInactiveMessage:_0x57bdf3,importOldMessages:_0x5b6fb3,importRecentMessages:_0x5ef832,closedTicketsPostImported:_0x175f0d,importOldMessagesGroups:_0x41e622}=_0x2227ea['body'],{companyId:_0x4ed86d}=_0x2227ea[_0x58a841(0xb4)],{whatsapp:_0x514daf,oldDefaultWhatsapp:_0x4d3fc3}=await(0x0,CreateWhatsAppService_1[_0x58a841(0xc1)])({'name':_0x21cb1e,'status':_0x438bff,'isDefault':_0x3edd60,'greetingMessage':_0x4816ec,'complationMessage':_0x27ed81,'outOfHoursMessage':_0x221acf,'queueIds':_0x4375e7,'companyId':_0x4ed86d,'token':_0x4ca0e7,'timeSendQueue':_0x1c8901,'sendIdQueue':_0x38f940,'promptId':_0x416eb4,'maxUseBotQueues':_0x4394a5,'timeUseBotQueues':_0x594e8f,'expiresTicket':_0xa6e103,'expiresInactiveMessage':_0x57bdf3,'allowGroup':_0x55a9df,'importOldMessages':_0x5b6fb3,'importRecentMessages':_0x5ef832,'closedTicketsPostImported':_0x175f0d,'importOldMessagesGroups':_0x41e622});(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x514daf,_0x4ed86d);const _0x1a7856=(0x0,socket_1[_0x58a841(0xbb)])();return _0x1a7856['to'](_0x58a841(0xc4)+_0x4ed86d+'-mainchannel')[_0x58a841(0x96)](_0x58a841(0xc4)+_0x4ed86d+_0x58a841(0x95),{'action':_0x58a841(0xc7),'whatsapp':_0x514daf}),_0x4d3fc3&&_0x1a7856['to']('company-'+_0x4ed86d+_0x58a841(0xa2))[_0x58a841(0x96)](_0x58a841(0xc4)+_0x4ed86d+_0x58a841(0x95),{'action':_0x58a841(0xc7),'whatsapp':_0x4d3fc3}),_0x1ea429[_0x58a841(0x94)](0xc8)[_0x58a841(0xa7)](_0x514daf);};exports[a46_0x521d8f(0xad)]=store;function a46_0x4cf2(){const _0x4c02bd=['length','restart','company-','admin','2720HYbqoE','update','remove','25ORpevV','7149976QyLnUQ','pending','restartWbot','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','defineProperty','../services/WhatsappService/ListWhatsAppsService','../services/WhatsappService/CreateWhatsAppService','../errors/AppError','347646CamFwr','number','status','-whatsapp','emit','ERR_NO_PERMISSION','../libs/socket','Whatsapp\x20restart.','query','whatsapp','../services/WhatsappService/DeleteWhatsAppService','55vwUybS','error','open','__importDefault','Whatsapp\x20deleted.','-mainchannel','../models/Whatsapp','removeWbot','__esModule','getAllConnections','json','644228YOkdJD','../services/WbotServices/StartWhatsAppSession','../libs/wbot','7lIKzNo','params','store','toString','search','../services/WhatsappService/ShowWhatsAppService','index','tickets','../services/CompanyService/FindAllCompaniesService','user','(((.+)+)+)+$','430356RnJUVs','closedTickets','2UHwyRz','No\x20companies\x20found','closeImportedTickets','getIO','2214591WKTCCU','show','../services/WhatsappService/UpdateWhatsAppService','1882356MOzQzf','33444fcGSkM','default'];a46_0x4cf2=function(){return _0x4c02bd;};return a46_0x4cf2();}const show=async(_0x35b81a,_0x3d88b6)=>{const _0x34c1d2=a46_0x521d8f,{whatsappId:_0x35a899}=_0x35b81a[_0x34c1d2(0xac)],{companyId:_0x514b02}=_0x35b81a['user'],{session:_0x409581}=_0x35b81a[_0x34c1d2(0x9a)],_0x2ef38d=await(0x0,ShowWhatsAppService_1[_0x34c1d2(0xc1)])(_0x35a899,_0x514b02,_0x409581);return _0x3d88b6[_0x34c1d2(0x94)](0xc8)[_0x34c1d2(0xa7)](_0x2ef38d);};exports[a46_0x521d8f(0xbd)]=show;const getAllConnections=async(_0x1f2bbe,_0x462d24)=>{const _0x46a03b=a46_0x521d8f;try{const _0x1a1691=await(0x0,FindAllCompaniesService_1[_0x46a03b(0xc1)])();if(!_0x1a1691||_0x1a1691[_0x46a03b(0xc2)]===0x0)return _0x462d24[_0x46a03b(0x94)](0x194)[_0x46a03b(0xa7)]({'error':_0x46a03b(0xb9)});const _0x17e5e1=[];for(const _0x916ee of _0x1a1691){if(typeof _0x916ee['id']!==_0x46a03b(0x93))continue;const _0x52b224=await Whatsapp_1[_0x46a03b(0xc1)]['findAll']({'where':{'companyId':_0x916ee['id']}});_0x17e5e1['push'](..._0x52b224);}return _0x462d24[_0x46a03b(0x94)](0xc8)['json'](_0x17e5e1);}catch(_0x4e58f4){return console[_0x46a03b(0x9e)](_0x4e58f4),_0x462d24[_0x46a03b(0x94)](0x1f4)['json']({'error':'Failed\x20to\x20fetch\x20connections'});}};exports['getAllConnections']=getAllConnections;const update=async(_0x3ef2cc,_0x3dbb22)=>{const _0x2af959=a46_0x521d8f,{whatsappId:_0xcb5191}=_0x3ef2cc[_0x2af959(0xac)],_0x439d14=_0x3ef2cc['body'],{companyId:_0x4cd995}=_0x3ef2cc[_0x2af959(0xb4)],{whatsapp:_0x463e48,oldDefaultWhatsapp:_0x2b487b}=await(0x0,UpdateWhatsAppService_1[_0x2af959(0xc1)])({'whatsappData':_0x439d14,'whatsappId':_0xcb5191,'companyId':_0x4cd995}),_0x3745fd=(0x0,socket_1[_0x2af959(0xbb)])();return _0x3745fd['to'](_0x2af959(0xc4)+_0x4cd995+_0x2af959(0xa2))[_0x2af959(0x96)](_0x2af959(0xc4)+_0x4cd995+_0x2af959(0x95),{'action':'update','whatsapp':_0x463e48}),_0x2b487b&&_0x3745fd['to'](_0x2af959(0xc4)+_0x4cd995+_0x2af959(0xa2))['emit'](_0x2af959(0xc4)+_0x4cd995+_0x2af959(0x95),{'action':_0x2af959(0xc7),'whatsapp':_0x2b487b}),_0x3dbb22['status'](0xc8)[_0x2af959(0xa7)](_0x463e48);};exports[a46_0x521d8f(0xc7)]=update;const remove=async(_0x46dcf6,_0x3b2e6e)=>{const _0x3db946=a46_0x521d8f,{whatsappId:_0x5da86c}=_0x46dcf6['params'],{companyId:_0x1f8d12}=_0x46dcf6[_0x3db946(0xb4)],_0x19b418=await(0x0,ShowWhatsAppService_1[_0x3db946(0xc1)])(_0x5da86c,_0x1f8d12),_0x5549c9=await _0x19b418['$get'](_0x3db946(0xb2),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x3db946(0x9f),_0x3db946(0x8b)]}}});if(_0x5549c9[_0x3db946(0xc2)]>0x0)throw new AppError_1[(_0x3db946(0xc1))](_0x3db946(0x8d));await(0x0,DeleteWhatsAppService_1[_0x3db946(0xc1)])(_0x5da86c),await(0x0,wbot_1[_0x3db946(0xa4)])(+_0x5da86c);const _0x34e266=(0x0,socket_1['getIO'])();return _0x34e266['to'](_0x3db946(0xc4)+_0x1f8d12+'-mainchannel')[_0x3db946(0x96)]('company-'+_0x1f8d12+_0x3db946(0x95),{'action':'delete','whatsappId':+_0x5da86c}),_0x3b2e6e[_0x3db946(0x94)](0xc8)['json']({'message':_0x3db946(0xa1)});};exports[a46_0x521d8f(0xc8)]=remove;const restart=async(_0x190d95,_0x5c683e)=>{const _0x3e884f=a46_0x521d8f,{companyId:_0x3881e1,profile:_0x18b0f0}=_0x190d95[_0x3e884f(0xb4)];if(_0x18b0f0!==_0x3e884f(0xc5))throw new AppError_1[(_0x3e884f(0xc1))](_0x3e884f(0x97),0x193);return await(0x0,wbot_1[_0x3e884f(0x8c)])(_0x3881e1),_0x5c683e[_0x3e884f(0x94)](0xc8)[_0x3e884f(0xa7)]({'message':_0x3e884f(0x99)});};function a46_0x121d(_0x12a7db,_0x30b4fa){const _0xa5fd84=a46_0x4cf2();return a46_0x121d=function(_0x4e8e6b,_0x21bd30){_0x4e8e6b=_0x4e8e6b-0x8a;let _0x4cf255=_0xa5fd84[_0x4e8e6b];return _0x4cf255;},a46_0x121d(_0x12a7db,_0x30b4fa);}exports[a46_0x521d8f(0xc3)]=restart;