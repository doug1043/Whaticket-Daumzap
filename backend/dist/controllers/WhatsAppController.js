const a46_0x26c838=a46_0x2332;(function(_0xd6aef6,_0x1d57d3){const _0x1cc599=a46_0x2332,_0x314016=_0xd6aef6();while(!![]){try{const _0x317097=-parseInt(_0x1cc599(0x154))/0x1*(-parseInt(_0x1cc599(0x178))/0x2)+parseInt(_0x1cc599(0x149))/0x3+-parseInt(_0x1cc599(0x171))/0x4*(-parseInt(_0x1cc599(0x169))/0x5)+parseInt(_0x1cc599(0x15c))/0x6*(parseInt(_0x1cc599(0x151))/0x7)+parseInt(_0x1cc599(0x150))/0x8+parseInt(_0x1cc599(0x15d))/0x9*(-parseInt(_0x1cc599(0x17c))/0xa)+parseInt(_0x1cc599(0x174))/0xb*(-parseInt(_0x1cc599(0x170))/0xc);if(_0x317097===_0x1d57d3)break;else _0x314016['push'](_0x314016['shift']());}catch(_0x22e147){_0x314016['push'](_0x314016['shift']());}}}(a46_0x10a8,0x328b9));const a46_0xba64c6=(function(){let _0x36880a=!![];return function(_0x2863f7,_0x299ab6){const _0x5bf2b3=_0x36880a?function(){const _0x5e46a9=a46_0x2332;if(_0x299ab6){const _0x8547cd=_0x299ab6[_0x5e46a9(0x183)](_0x2863f7,arguments);return _0x299ab6=null,_0x8547cd;}}:function(){};return _0x36880a=![],_0x5bf2b3;};}()),a46_0x9925be=a46_0xba64c6(this,function(){const _0x1ec882=a46_0x2332;return a46_0x9925be[_0x1ec882(0x14f)]()[_0x1ec882(0x180)](_0x1ec882(0x143))[_0x1ec882(0x14f)]()[_0x1ec882(0x147)](a46_0x9925be)[_0x1ec882(0x180)](_0x1ec882(0x143));});a46_0x9925be();'use strict';var __importDefault=this&&this[a46_0x26c838(0x152)]||function(_0x32277d){return _0x32277d&&_0x32277d['__esModule']?_0x32277d:{'default':_0x32277d};};Object[a46_0x26c838(0x158)](exports,a46_0x26c838(0x17d),{'value':!![]}),exports['restart']=exports['remove']=exports[a46_0x26c838(0x145)]=exports['getAllConnections']=exports['show']=exports[a46_0x26c838(0x16f)]=exports[a46_0x26c838(0x160)]=exports['closedTickets']=void 0x0;function a46_0x2332(_0x455097,_0x3ac5d1){const _0x25057e=a46_0x10a8();return a46_0x2332=function(_0x9925be,_0xba64c6){_0x9925be=_0x9925be-0x143;let _0x10a8ae=_0x25057e[_0x9925be];return _0x10a8ae;},a46_0x2332(_0x455097,_0x3ac5d1);}const socket_1=require(a46_0x26c838(0x157)),wbot_1=require(a46_0x26c838(0x162)),StartWhatsAppSession_1=require(a46_0x26c838(0x163)),FindAllCompaniesService_1=__importDefault(require('../services/CompanyService/FindAllCompaniesService')),CreateWhatsAppService_1=__importDefault(require(a46_0x26c838(0x17a))),DeleteWhatsAppService_1=__importDefault(require(a46_0x26c838(0x181))),ListWhatsAppsService_1=__importDefault(require(a46_0x26c838(0x14e))),ShowWhatsAppService_1=__importDefault(require(a46_0x26c838(0x176))),UpdateWhatsAppService_1=__importDefault(require(a46_0x26c838(0x14c))),AppError_1=__importDefault(require('../errors/AppError')),sequelize_1=require('sequelize'),ImportWhatsAppMessageService_1=require(a46_0x26c838(0x155)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),closedTickets=async(_0x418430,_0x472549)=>{const _0x2dc965=a46_0x26c838,{whatsappId:_0x2b42cf}=_0x418430[_0x2dc965(0x175)];return await(0x0,ImportWhatsAppMessageService_1[_0x2dc965(0x16e)])(_0x2b42cf),_0x472549[_0x2dc965(0x16a)](0xc8)[_0x2dc965(0x146)](_0x2dc965(0x16d));};exports[a46_0x26c838(0x153)]=closedTickets;const index=async(_0x137fb6,_0x4f09fd)=>{const _0x1b710c=a46_0x26c838,{companyId:_0x1b5049}=_0x137fb6[_0x1b710c(0x164)],{session:_0x22e123}=_0x137fb6['query'],_0x34f02c=await(0x0,ListWhatsAppsService_1[_0x1b710c(0x177)])({'companyId':_0x1b5049,'session':_0x22e123});return _0x4f09fd[_0x1b710c(0x16a)](0xc8)[_0x1b710c(0x146)](_0x34f02c);};function a46_0x10a8(){const _0x5bd41c=['json','constructor','-whatsapp','971556TaBsUj','ERR_NO_PERMISSION','restart','../services/WhatsappService/UpdateWhatsAppService','push','../services/WhatsappService/ListWhatsAppsService','toString','1032912RAamfj','235991QHxRnD','__importDefault','closedTickets','5637HrXqZL','../services/WhatsappService/ImportWhatsAppMessageService','removeWbot','../libs/socket','defineProperty','getAllConnections','Failed\x20to\x20fetch\x20connections','findAll','6YPVAlr','116253tLjIol','error','Whatsapp\x20restart.','index','StartWhatsAppSession','../libs/wbot','../services/WbotServices/StartWhatsAppSession','user','$get','number','pending','query','115keeikA','status','No\x20companies\x20found','getIO','whatsapp','closeImportedTickets','store','6282228qpWOfs','24476jDpfBB','length','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','11kBwobZ','params','../services/WhatsappService/ShowWhatsAppService','default','142LSZWrs','open','../services/WhatsappService/CreateWhatsAppService','body','230aSEAEN','__esModule','Whatsapp\x20deleted.','show','search','../services/WhatsappService/DeleteWhatsAppService','emit','apply','-mainchannel','(((.+)+)+)+$','company-','update'];a46_0x10a8=function(){return _0x5bd41c;};return a46_0x10a8();}exports['index']=index;const store=async(_0x1d4b70,_0x11cc94)=>{const _0x909f28=a46_0x26c838,{name:_0x4f32e8,status:_0x16b0a3,isDefault:_0x3a3f78,greetingMessage:_0x215010,complationMessage:_0x15a1bf,outOfHoursMessage:_0x463319,queueIds:_0x46d0d7,token:_0x5a4ba3,allowGroup:_0x24663b,timeSendQueue:_0x50a2e0,sendIdQueue:_0x4332ce,promptId:_0x213f4e,maxUseBotQueues:_0x10e29f,timeUseBotQueues:_0x36ca86,expiresTicket:_0x316ce1,expiresInactiveMessage:_0x35f988,importOldMessages:_0x2a78d9,importRecentMessages:_0x8f3b7f,closedTicketsPostImported:_0x38fe0c,importOldMessagesGroups:_0x9ef3f4}=_0x1d4b70['body'],{companyId:_0x11b568}=_0x1d4b70[_0x909f28(0x164)],{whatsapp:_0x1d3967,oldDefaultWhatsapp:_0x5e5c7f}=await(0x0,CreateWhatsAppService_1[_0x909f28(0x177)])({'name':_0x4f32e8,'status':_0x16b0a3,'isDefault':_0x3a3f78,'greetingMessage':_0x215010,'complationMessage':_0x15a1bf,'outOfHoursMessage':_0x463319,'queueIds':_0x46d0d7,'companyId':_0x11b568,'token':_0x5a4ba3,'timeSendQueue':_0x50a2e0,'sendIdQueue':_0x4332ce,'promptId':_0x213f4e,'maxUseBotQueues':_0x10e29f,'timeUseBotQueues':_0x36ca86,'expiresTicket':_0x316ce1,'expiresInactiveMessage':_0x35f988,'allowGroup':_0x24663b,'importOldMessages':_0x2a78d9,'importRecentMessages':_0x8f3b7f,'closedTicketsPostImported':_0x38fe0c,'importOldMessagesGroups':_0x9ef3f4});(0x0,StartWhatsAppSession_1[_0x909f28(0x161)])(_0x1d3967,_0x11b568);const _0x301adc=(0x0,socket_1[_0x909f28(0x16c)])();return _0x301adc['to']('company-'+_0x11b568+'-mainchannel')[_0x909f28(0x182)](_0x909f28(0x144)+_0x11b568+_0x909f28(0x148),{'action':_0x909f28(0x145),'whatsapp':_0x1d3967}),_0x5e5c7f&&_0x301adc['to'](_0x909f28(0x144)+_0x11b568+'-mainchannel')[_0x909f28(0x182)](_0x909f28(0x144)+_0x11b568+'-whatsapp',{'action':_0x909f28(0x145),'whatsapp':_0x5e5c7f}),_0x11cc94['status'](0xc8)[_0x909f28(0x146)](_0x1d3967);};exports[a46_0x26c838(0x16f)]=store;const show=async(_0x46fa26,_0xe271d9)=>{const _0x45e074=a46_0x26c838,{whatsappId:_0x3d6bda}=_0x46fa26[_0x45e074(0x175)],{companyId:_0x413e0c}=_0x46fa26[_0x45e074(0x164)],{session:_0x19e6ad}=_0x46fa26[_0x45e074(0x168)],_0x2a16fe=await(0x0,ShowWhatsAppService_1['default'])(_0x3d6bda,_0x413e0c,_0x19e6ad);return _0xe271d9[_0x45e074(0x16a)](0xc8)['json'](_0x2a16fe);};exports[a46_0x26c838(0x17f)]=show;const getAllConnections=async(_0x56f252,_0x4e889f)=>{const _0x39523e=a46_0x26c838;try{const _0x28a52d=await(0x0,FindAllCompaniesService_1['default'])();if(!_0x28a52d||_0x28a52d[_0x39523e(0x172)]===0x0)return _0x4e889f[_0x39523e(0x16a)](0x194)[_0x39523e(0x146)]({'error':_0x39523e(0x16b)});const _0x4380dd=[];for(const _0x4bb830 of _0x28a52d){if(typeof _0x4bb830['id']!==_0x39523e(0x166))continue;const _0x274609=await Whatsapp_1[_0x39523e(0x177)][_0x39523e(0x15b)]({'where':{'companyId':_0x4bb830['id']}});_0x4380dd[_0x39523e(0x14d)](..._0x274609);}return _0x4e889f[_0x39523e(0x16a)](0xc8)[_0x39523e(0x146)](_0x4380dd);}catch(_0x573e12){return console[_0x39523e(0x15e)](_0x573e12),_0x4e889f[_0x39523e(0x16a)](0x1f4)[_0x39523e(0x146)]({'error':_0x39523e(0x15a)});}};exports[a46_0x26c838(0x159)]=getAllConnections;const update=async(_0x186b36,_0x4ac277)=>{const _0x1b113d=a46_0x26c838,{whatsappId:_0x4c2c18}=_0x186b36[_0x1b113d(0x175)],_0x9c3a1b=_0x186b36[_0x1b113d(0x17b)],{companyId:_0x1d5306}=_0x186b36[_0x1b113d(0x164)],{whatsapp:_0x19c4b6,oldDefaultWhatsapp:_0x4113a4}=await(0x0,UpdateWhatsAppService_1[_0x1b113d(0x177)])({'whatsappData':_0x9c3a1b,'whatsappId':_0x4c2c18,'companyId':_0x1d5306}),_0x24c0c9=(0x0,socket_1['getIO'])();return _0x24c0c9['to'](_0x1b113d(0x144)+_0x1d5306+_0x1b113d(0x184))[_0x1b113d(0x182)](_0x1b113d(0x144)+_0x1d5306+'-whatsapp',{'action':_0x1b113d(0x145),'whatsapp':_0x19c4b6}),_0x4113a4&&_0x24c0c9['to'](_0x1b113d(0x144)+_0x1d5306+_0x1b113d(0x184))[_0x1b113d(0x182)](_0x1b113d(0x144)+_0x1d5306+_0x1b113d(0x148),{'action':_0x1b113d(0x145),'whatsapp':_0x4113a4}),_0x4ac277[_0x1b113d(0x16a)](0xc8)[_0x1b113d(0x146)](_0x19c4b6);};exports[a46_0x26c838(0x145)]=update;const remove=async(_0x4a20d1,_0x120928)=>{const _0x2f7980=a46_0x26c838,{whatsappId:_0x3d1c75}=_0x4a20d1[_0x2f7980(0x175)],{companyId:_0xc87827}=_0x4a20d1[_0x2f7980(0x164)],_0x39a0f0=await(0x0,ShowWhatsAppService_1[_0x2f7980(0x177)])(_0x3d1c75,_0xc87827),_0x540add=await _0x39a0f0[_0x2f7980(0x165)]('tickets',{'where':{'status':{[sequelize_1['Op']['or']]:[_0x2f7980(0x179),_0x2f7980(0x167)]}}});if(_0x540add[_0x2f7980(0x172)]>0x0)throw new AppError_1['default'](_0x2f7980(0x173));await(0x0,DeleteWhatsAppService_1[_0x2f7980(0x177)])(_0x3d1c75),await(0x0,wbot_1[_0x2f7980(0x156)])(+_0x3d1c75);const _0x1f1f49=(0x0,socket_1[_0x2f7980(0x16c)])();return _0x1f1f49['to'](_0x2f7980(0x144)+_0xc87827+_0x2f7980(0x184))[_0x2f7980(0x182)](_0x2f7980(0x144)+_0xc87827+'-whatsapp',{'action':'delete','whatsappId':+_0x3d1c75}),_0x120928[_0x2f7980(0x16a)](0xc8)['json']({'message':_0x2f7980(0x17e)});};exports['remove']=remove;const restart=async(_0x1ca997,_0x5f16b9)=>{const _0x295610=a46_0x26c838,{companyId:_0x26914c,profile:_0x1af143}=_0x1ca997[_0x295610(0x164)];if(_0x1af143!=='admin')throw new AppError_1[(_0x295610(0x177))](_0x295610(0x14a),0x193);return await(0x0,wbot_1['restartWbot'])(_0x26914c),_0x5f16b9[_0x295610(0x16a)](0xc8)[_0x295610(0x146)]({'message':_0x295610(0x15f)});};exports[a46_0x26c838(0x14b)]=restart;