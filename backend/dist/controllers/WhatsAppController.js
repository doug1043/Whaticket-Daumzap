const a45_0x580c95=a45_0xcf39;(function(_0x559751,_0x495c29){const _0x21bd42=a45_0xcf39,_0x259369=_0x559751();while(!![]){try{const _0x28c573=-parseInt(_0x21bd42(0x95))/0x1+parseInt(_0x21bd42(0x81))/0x2+parseInt(_0x21bd42(0x9e))/0x3+parseInt(_0x21bd42(0x9f))/0x4*(parseInt(_0x21bd42(0xa6))/0x5)+parseInt(_0x21bd42(0x71))/0x6*(-parseInt(_0x21bd42(0x7b))/0x7)+parseInt(_0x21bd42(0x77))/0x8*(parseInt(_0x21bd42(0x9d))/0x9)+parseInt(_0x21bd42(0x8d))/0xa*(-parseInt(_0x21bd42(0x8f))/0xb);if(_0x28c573===_0x495c29)break;else _0x259369['push'](_0x259369['shift']());}catch(_0x1ea0a4){_0x259369['push'](_0x259369['shift']());}}}(a45_0x58e0,0xae94a));const a45_0x1a3292=(function(){let _0x55cbae=!![];return function(_0x1f0154,_0x33f389){const _0xb1c03b=_0x55cbae?function(){const _0x21c40b=a45_0xcf39;if(_0x33f389){const _0x5bcaa8=_0x33f389[_0x21c40b(0x89)](_0x1f0154,arguments);return _0x33f389=null,_0x5bcaa8;}}:function(){};return _0x55cbae=![],_0xb1c03b;};}()),a45_0x3405cc=a45_0x1a3292(this,function(){const _0xdb6f9=a45_0xcf39;return a45_0x3405cc[_0xdb6f9(0x9a)]()[_0xdb6f9(0xa3)]('(((.+)+)+)+$')[_0xdb6f9(0x9a)]()[_0xdb6f9(0x6f)](a45_0x3405cc)[_0xdb6f9(0xa3)](_0xdb6f9(0x93));});a45_0x3405cc();'use strict';function a45_0x58e0(){const _0x4bd59c=['237905igEfWc','../libs/cache','status','company-','../services/WbotServices/StartWhatsAppSession','json','length','../services/WhatsappService/UpdateWhatsAppService','tickets','default','delete','constructor','destroy','1728lLhtQc','../libs/socket','../models/Whatsapp','StartWhatsAppSession','sequelize','pending','56TIRZcG','forEach','channel','show','24997tRlULB','../services/WhatsappService/ShowWhatsAppService','index','instagram','user','$get','2079040mDNGlx','restart','store','Whatsapp\x20connections\x20restarted.','../services/WhatsappService/DeleteWhatsAppService','ERR_NO_PERMISSION','defineProperty','removeWbot','apply','findAll','open','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','5730iQIXss','query','34529ilyqKc','cacheLayer','getIO','body','(((.+)+)+)+$','whatsapp','169158nwRJBS','../libs/wbot','emit','-whatsapp','../services/WhatsappService/ListWhatsAppsService','toString','../services/BaileysServices/DeleteBaileysService','update','1123092FrLqXh','2968266AHvCOb','68lSXEOc','Session\x20disconnected.','params','../services/WhatsappService/CreateWhatsAppService','search','remove','__esModule'];a45_0x58e0=function(){return _0x4bd59c;};return a45_0x58e0();}var __importDefault=this&&this['__importDefault']||function(_0xa2f2c){const _0x1c4399=a45_0xcf39;return _0xa2f2c&&_0xa2f2c[_0x1c4399(0xa5)]?_0xa2f2c:{'default':_0xa2f2c};};Object[a45_0x580c95(0x87)](exports,a45_0x580c95(0xa5),{'value':!![]}),exports[a45_0x580c95(0xa4)]=exports[a45_0x580c95(0x82)]=exports[a45_0x580c95(0x9c)]=exports[a45_0x580c95(0x7a)]=exports[a45_0x580c95(0x83)]=exports['index']=void 0x0;const sequelize_1=require(a45_0x580c95(0x75)),cache_1=require(a45_0x580c95(0xa7)),socket_1=require(a45_0x580c95(0x72)),wbot_1=require(a45_0x580c95(0x96)),Whatsapp_1=__importDefault(require(a45_0x580c95(0x73))),DeleteBaileysService_1=__importDefault(require(a45_0x580c95(0x9b))),StartWhatsAppSession_1=require(a45_0x580c95(0xaa)),CreateWhatsAppService_1=__importDefault(require(a45_0x580c95(0xa2))),DeleteWhatsAppService_1=__importDefault(require(a45_0x580c95(0x85))),ListWhatsAppsService_1=__importDefault(require(a45_0x580c95(0x99))),ShowWhatsAppService_1=__importDefault(require(a45_0x580c95(0x7c))),UpdateWhatsAppService_1=__importDefault(require(a45_0x580c95(0xad))),AppError_1=__importDefault(require('../errors/AppError')),index=async(_0x1e3378,_0x10e814)=>{const _0x55517f=a45_0x580c95,{companyId:_0x4addbd}=_0x1e3378[_0x55517f(0x7f)],{session:_0x277d88}=_0x1e3378[_0x55517f(0x8e)],_0x26419e=await(0x0,ListWhatsAppsService_1['default'])({'companyId':_0x4addbd,'session':_0x277d88});return _0x10e814['status'](0xc8)[_0x55517f(0xab)](_0x26419e);};function a45_0xcf39(_0x39268c,_0x20467a){const _0x3b9570=a45_0x58e0();return a45_0xcf39=function(_0x3405cc,_0x1a3292){_0x3405cc=_0x3405cc-0x6e;let _0x58e0c2=_0x3b9570[_0x3405cc];return _0x58e0c2;},a45_0xcf39(_0x39268c,_0x20467a);}exports[a45_0x580c95(0x7d)]=index;const store=async(_0x7512b7,_0x223a46)=>{const _0x232e02=a45_0x580c95,{name:_0x280e46,status:_0x59eb78,isDefault:_0x4d3637,greetingMessage:_0x5a3798,complationMessage:_0x1276ef,outOfHoursMessage:_0x2b8ad4,allowGroup:_0x3b840d,timeSendQueue:_0x2c84e5,sendIdQueue:_0x7c35f,useRating:_0x200ea5,ratingMessage:_0x401b35,transferMessage:_0x4b22bd,queueIds:_0x35ef0c,token:_0x60f1bb,maxUseBotQueues:_0x771e40,expiresTicket:_0x3a8ac5,expiresInactiveMessage:_0x51fc9a,importOldMessages:_0xaa80d2,schedules:_0x339e65,whenExpireTicket:_0x52a2ba,inactiveMessageTime:_0x37d85a,inactiveMessage:_0xc10c1a,automaticRestart:_0x51ba96,period:_0x378a27}=_0x7512b7['body'],{companyId:_0x1e03d2}=_0x7512b7[_0x232e02(0x7f)],{whatsapp:_0x3dc3e3,oldDefaultWhatsapp:_0x46d127}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x280e46,'status':_0x59eb78,'isDefault':_0x4d3637,'greetingMessage':_0x5a3798,'complationMessage':_0x1276ef,'outOfHoursMessage':_0x2b8ad4,'useRating':_0x200ea5,'ratingMessage':_0x401b35,'transferMessage':_0x4b22bd,'queueIds':_0x35ef0c,'companyId':_0x1e03d2,'token':_0x60f1bb,'maxUseBotQueues':_0x771e40,'timeSendQueue':_0x2c84e5,'sendIdQueue':_0x7c35f,'expiresTicket':_0x3a8ac5,'expiresInactiveMessage':_0x51fc9a,'allowGroup':_0x3b840d,'importOldMessages':_0xaa80d2,'schedules':_0x339e65,'whenExpireTicket':_0x52a2ba,'inactiveMessageTime':_0x37d85a,'inactiveMessage':_0xc10c1a,'automaticRestart':_0x51ba96,'period':_0x378a27});(0x0,StartWhatsAppSession_1[_0x232e02(0x74)])(_0x3dc3e3,_0x1e03d2);const _0x79ca5c=(0x0,socket_1[_0x232e02(0x91)])();return _0x79ca5c[_0x232e02(0x97)](_0x232e02(0xa9)+_0x1e03d2+'-whatsapp',{'action':_0x232e02(0x9c),'whatsapp':_0x3dc3e3}),_0x46d127&&_0x79ca5c['emit'](_0x232e02(0xa9)+_0x1e03d2+'-whatsapp',{'action':_0x232e02(0x9c),'whatsapp':_0x46d127}),_0x223a46[_0x232e02(0xa8)](0xc8)[_0x232e02(0xab)](_0x3dc3e3);};exports[a45_0x580c95(0x83)]=store;const show=async(_0x2be37e,_0x650cfd)=>{const _0x178aea=a45_0x580c95,{whatsappId:_0x44bc74}=_0x2be37e[_0x178aea(0xa1)],{companyId:_0x390fd4}=_0x2be37e['user'],{session:_0x1fd562}=_0x2be37e[_0x178aea(0x8e)],_0x51970a=await(0x0,ShowWhatsAppService_1[_0x178aea(0xaf)])(_0x44bc74,_0x390fd4,_0x1fd562);return _0x650cfd[_0x178aea(0xa8)](0xc8)[_0x178aea(0xab)](_0x51970a);};exports[a45_0x580c95(0x7a)]=show;const update=async(_0x4a62d6,_0x33a116)=>{const _0x5b1f99=a45_0x580c95,{whatsappId:_0x26af64}=_0x4a62d6[_0x5b1f99(0xa1)],_0x5b31f2=_0x4a62d6[_0x5b1f99(0x92)],{companyId:_0x2c80a1}=_0x4a62d6[_0x5b1f99(0x7f)],{whatsapp:_0x166831,oldDefaultWhatsapp:_0x43eaee}=await(0x0,UpdateWhatsAppService_1[_0x5b1f99(0xaf)])({'whatsappData':_0x5b31f2,'whatsappId':_0x26af64,'companyId':_0x2c80a1}),_0x48a614=(0x0,socket_1['getIO'])();return _0x48a614['emit'](_0x5b1f99(0xa9)+_0x2c80a1+'-whatsapp',{'action':_0x5b1f99(0x9c),'whatsapp':_0x166831}),_0x43eaee&&_0x48a614[_0x5b1f99(0x97)]('company-'+_0x2c80a1+_0x5b1f99(0x98),{'action':_0x5b1f99(0x9c),'whatsapp':_0x43eaee}),_0x33a116[_0x5b1f99(0xa8)](0xc8)[_0x5b1f99(0xab)](_0x166831);};exports[a45_0x580c95(0x9c)]=update;const restart=async(_0x412951,_0x467ee6)=>{const _0x173365=a45_0x580c95,{companyId:_0x43d6b5,profile:_0x1632ed}=_0x412951[_0x173365(0x7f)];if(_0x1632ed!=='admin')throw new AppError_1['default'](_0x173365(0x86),0x193);const _0x3efa72=await Whatsapp_1[_0x173365(0xaf)][_0x173365(0x8a)]({'where':{'companyId':_0x43d6b5}});for(const _0xff17af of _0x3efa72){await(0x0,wbot_1[_0x173365(0x88)])(_0xff17af['id'],![]),await new Promise(_0x586c65=>setTimeout(_0x586c65,0xbb8)),await(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0xff17af,_0x43d6b5),await _0xff17af[_0x173365(0x9c)]({'lastRestartAt':new Date()});}return _0x467ee6['status'](0xc8)[_0x173365(0xab)]({'message':_0x173365(0x84)});};exports[a45_0x580c95(0x82)]=restart;const remove=async(_0x383747,_0x23f0aa)=>{const _0x20cd67=a45_0x580c95,{whatsappId:_0x177e99}=_0x383747['params'],{companyId:_0x4f22bb}=_0x383747[_0x20cd67(0x7f)],_0xd95ee8=(0x0,socket_1[_0x20cd67(0x91)])(),_0x191468=await(0x0,ShowWhatsAppService_1[_0x20cd67(0xaf)])(_0x177e99,_0x4f22bb);if(_0x191468['channel']===_0x20cd67(0x94)){const _0x9b5b25=await _0x191468[_0x20cd67(0x80)](_0x20cd67(0xae),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x20cd67(0x8b),_0x20cd67(0x76)]}}});if(_0x9b5b25[_0x20cd67(0xac)]>0x0)throw new AppError_1[(_0x20cd67(0xaf))](_0x20cd67(0x8c));await(0x0,DeleteBaileysService_1[_0x20cd67(0xaf)])(_0x177e99),await(0x0,DeleteWhatsAppService_1['default'])(_0x177e99),await cache_1[_0x20cd67(0x90)]['delFromPattern']('sessions:'+_0x177e99+':*'),(0x0,wbot_1[_0x20cd67(0x88)])(+_0x177e99),_0xd95ee8['emit']('company-'+_0x4f22bb+'-whatsapp',{'action':_0x20cd67(0x6e),'whatsappId':+_0x177e99});}if(_0x191468[_0x20cd67(0x79)]==='facebook'||_0x191468[_0x20cd67(0x79)]===_0x20cd67(0x7e)){const {facebookUserToken:_0x63c359}=_0x191468,_0x30bd25=await Whatsapp_1[_0x20cd67(0xaf)][_0x20cd67(0x8a)]({'where':{'facebookUserToken':_0x63c359}});await Whatsapp_1[_0x20cd67(0xaf)][_0x20cd67(0x70)]({'where':{'facebookUserToken':_0x63c359}}),_0x30bd25[_0x20cd67(0x78)](_0x156ebb=>{const _0x122942=_0x20cd67;_0xd95ee8[_0x122942(0x97)](_0x122942(0xa9)+_0x4f22bb+_0x122942(0x98),{'action':_0x122942(0x6e),'whatsappId':_0x156ebb['id']});});}return _0x23f0aa[_0x20cd67(0xa8)](0xc8)[_0x20cd67(0xab)]({'message':_0x20cd67(0xa0)});};exports[a45_0x580c95(0xa4)]=remove;