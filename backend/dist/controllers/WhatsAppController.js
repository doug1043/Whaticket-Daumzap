function a45_0x43f5(_0x242a08,_0x4fa8c4){const _0x56fc4b=a45_0x1d3d();return a45_0x43f5=function(_0x14c0ba,_0x1788af){_0x14c0ba=_0x14c0ba-0xf7;let _0x1d3dbf=_0x56fc4b[_0x14c0ba];return _0x1d3dbf;},a45_0x43f5(_0x242a08,_0x4fa8c4);}const a45_0x2d75d1=a45_0x43f5;(function(_0x72099d,_0x14d6a9){const _0xc3e2a0=a45_0x43f5,_0x27c294=_0x72099d();while(!![]){try{const _0x5a0cb0=parseInt(_0xc3e2a0(0x118))/0x1+parseInt(_0xc3e2a0(0x12a))/0x2*(parseInt(_0xc3e2a0(0x108))/0x3)+-parseInt(_0xc3e2a0(0x112))/0x4+parseInt(_0xc3e2a0(0x134))/0x5+parseInt(_0xc3e2a0(0x113))/0x6*(parseInt(_0xc3e2a0(0x12c))/0x7)+-parseInt(_0xc3e2a0(0x121))/0x8+parseInt(_0xc3e2a0(0x129))/0x9*(-parseInt(_0xc3e2a0(0x106))/0xa);if(_0x5a0cb0===_0x14d6a9)break;else _0x27c294['push'](_0x27c294['shift']());}catch(_0x33fed8){_0x27c294['push'](_0x27c294['shift']());}}}(a45_0x1d3d,0x18fb7));const a45_0x1788af=(function(){let _0x11c611=!![];return function(_0xf4c2e6,_0x88fd78){const _0x4a2367=_0x11c611?function(){const _0x542e3b=a45_0x43f5;if(_0x88fd78){const _0x1cb736=_0x88fd78[_0x542e3b(0x11c)](_0xf4c2e6,arguments);return _0x88fd78=null,_0x1cb736;}}:function(){};return _0x11c611=![],_0x4a2367;};}()),a45_0x14c0ba=a45_0x1788af(this,function(){const _0x1fe7a8=a45_0x43f5;return a45_0x14c0ba[_0x1fe7a8(0x115)]()[_0x1fe7a8(0x137)](_0x1fe7a8(0xfa))['toString']()[_0x1fe7a8(0x130)](a45_0x14c0ba)[_0x1fe7a8(0x137)](_0x1fe7a8(0xfa));});a45_0x14c0ba();'use strict';function a45_0x1d3d(){const _0x242cba=['findAll','remove','1510JlmEUO','length','72339qIGtjd','pending','cacheLayer','channel','../services/WhatsappService/UpdateWhatsAppService','update','status','../services/WhatsappService/DeleteWhatsAppService','json','default','561328ToZSLX','994854BhDGBy','index','toString','user','../services/WbotServices/StartWhatsAppSession','160576KtWGqJ','Whatsapp\x20connections\x20restarted.','sessions:','query','apply','-whatsapp','../services/WhatsappService/ListWhatsAppsService','store','getIO','1486176vCwLTm','../services/WhatsappService/ShowWhatsAppService','tickets','restart','emit','params','defineProperty','instagram','6831AvIWlO','2GGZvzX','../models/Whatsapp','7WPrmbV','delFromPattern','ERR_NO_PERMISSION','forEach','constructor','__importDefault','whatsapp','delete','962710GbFIAE','$get','../libs/cache','search','../services/BaileysServices/DeleteBaileysService','../services/WhatsappService/CreateWhatsAppService','facebook','(((.+)+)+)+$','company-','open','show','__esModule','Session\x20disconnected.','StartWhatsAppSession','removeWbot','body','destroy'];a45_0x1d3d=function(){return _0x242cba;};return a45_0x1d3d();}var __importDefault=this&&this[a45_0x2d75d1(0x131)]||function(_0x579f29){const _0xe15407=a45_0x2d75d1;return _0x579f29&&_0x579f29[_0xe15407(0xfe)]?_0x579f29:{'default':_0x579f29};};Object[a45_0x2d75d1(0x127)](exports,a45_0x2d75d1(0xfe),{'value':!![]}),exports[a45_0x2d75d1(0x105)]=exports[a45_0x2d75d1(0x124)]=exports['update']=exports['show']=exports[a45_0x2d75d1(0x11f)]=exports[a45_0x2d75d1(0x114)]=void 0x0;const sequelize_1=require('sequelize'),cache_1=require(a45_0x2d75d1(0x136)),socket_1=require('../libs/socket'),wbot_1=require('../libs/wbot'),Whatsapp_1=__importDefault(require(a45_0x2d75d1(0x12b))),DeleteBaileysService_1=__importDefault(require(a45_0x2d75d1(0xf7))),StartWhatsAppSession_1=require(a45_0x2d75d1(0x117)),CreateWhatsAppService_1=__importDefault(require(a45_0x2d75d1(0xf8))),DeleteWhatsAppService_1=__importDefault(require(a45_0x2d75d1(0x10f))),ListWhatsAppsService_1=__importDefault(require(a45_0x2d75d1(0x11e))),ShowWhatsAppService_1=__importDefault(require(a45_0x2d75d1(0x122))),UpdateWhatsAppService_1=__importDefault(require(a45_0x2d75d1(0x10c))),AppError_1=__importDefault(require('../errors/AppError')),index=async(_0x5cad7f,_0x13eaa0)=>{const _0x315759=a45_0x2d75d1,{companyId:_0x23969b}=_0x5cad7f[_0x315759(0x116)],{session:_0x5dc6b8}=_0x5cad7f[_0x315759(0x11b)],_0x3ea4f7=await(0x0,ListWhatsAppsService_1[_0x315759(0x111)])({'companyId':_0x23969b,'session':_0x5dc6b8});return _0x13eaa0['status'](0xc8)[_0x315759(0x110)](_0x3ea4f7);};exports[a45_0x2d75d1(0x114)]=index;const store=async(_0x1b1b47,_0x18b629)=>{const _0xb21013=a45_0x2d75d1,{name:_0x196355,status:_0x2b9128,isDefault:_0x4eaa23,greetingMessage:_0x2b4488,complationMessage:_0x24e710,outOfHoursMessage:_0x492c0f,allowGroup:_0x3c2f4f,timeSendQueue:_0x533bd3,sendIdQueue:_0x59a3da,useRating:_0x35a98b,ratingMessage:_0x4cbd80,transferMessage:_0x2f1773,queueIds:_0x56a149,token:_0x90525a,maxUseBotQueues:_0x167187,expiresTicket:_0x5b6484,expiresInactiveMessage:_0x3bce7a,importOldMessages:_0x41645b,schedules:_0x570f24,whenExpireTicket:_0x1884cb,inactiveMessageTime:_0x169581,inactiveMessage:_0x28b23d,automaticRestart:_0x28369d,period:_0x42b4a0}=_0x1b1b47['body'],{companyId:_0x2460a5}=_0x1b1b47[_0xb21013(0x116)],{whatsapp:_0x23cf7f,oldDefaultWhatsapp:_0x2af3cb}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x196355,'status':_0x2b9128,'isDefault':_0x4eaa23,'greetingMessage':_0x2b4488,'complationMessage':_0x24e710,'outOfHoursMessage':_0x492c0f,'useRating':_0x35a98b,'ratingMessage':_0x4cbd80,'transferMessage':_0x2f1773,'queueIds':_0x56a149,'companyId':_0x2460a5,'token':_0x90525a,'maxUseBotQueues':_0x167187,'timeSendQueue':_0x533bd3,'sendIdQueue':_0x59a3da,'expiresTicket':_0x5b6484,'expiresInactiveMessage':_0x3bce7a,'allowGroup':_0x3c2f4f,'importOldMessages':_0x41645b,'schedules':_0x570f24,'whenExpireTicket':_0x1884cb,'inactiveMessageTime':_0x169581,'inactiveMessage':_0x28b23d,'automaticRestart':_0x28369d,'period':_0x42b4a0});(0x0,StartWhatsAppSession_1[_0xb21013(0x100)])(_0x23cf7f,_0x2460a5);const _0x18b356=(0x0,socket_1[_0xb21013(0x120)])();return _0x18b356[_0xb21013(0x125)](_0xb21013(0xfb)+_0x2460a5+_0xb21013(0x11d),{'action':_0xb21013(0x10d),'whatsapp':_0x23cf7f}),_0x2af3cb&&_0x18b356[_0xb21013(0x125)]('company-'+_0x2460a5+_0xb21013(0x11d),{'action':_0xb21013(0x10d),'whatsapp':_0x2af3cb}),_0x18b629[_0xb21013(0x10e)](0xc8)[_0xb21013(0x110)](_0x23cf7f);};exports['store']=store;const show=async(_0x24a49c,_0x1d3c23)=>{const _0x5830c6=a45_0x2d75d1,{whatsappId:_0x50cf9d}=_0x24a49c[_0x5830c6(0x126)],{companyId:_0xe31245}=_0x24a49c[_0x5830c6(0x116)],{session:_0x4f6496}=_0x24a49c[_0x5830c6(0x11b)],_0xfc5abe=await(0x0,ShowWhatsAppService_1[_0x5830c6(0x111)])(_0x50cf9d,_0xe31245,_0x4f6496);return _0x1d3c23['status'](0xc8)[_0x5830c6(0x110)](_0xfc5abe);};exports[a45_0x2d75d1(0xfd)]=show;const update=async(_0xf5e767,_0xe4934b)=>{const _0x39142f=a45_0x2d75d1,{whatsappId:_0x117c24}=_0xf5e767[_0x39142f(0x126)],_0x73e96f=_0xf5e767[_0x39142f(0x102)],{companyId:_0x3ea7d4}=_0xf5e767[_0x39142f(0x116)],{whatsapp:_0x58e7a4,oldDefaultWhatsapp:_0x9aa889}=await(0x0,UpdateWhatsAppService_1[_0x39142f(0x111)])({'whatsappData':_0x73e96f,'whatsappId':_0x117c24,'companyId':_0x3ea7d4}),_0x2b9ac0=(0x0,socket_1[_0x39142f(0x120)])();return _0x2b9ac0[_0x39142f(0x125)](_0x39142f(0xfb)+_0x3ea7d4+_0x39142f(0x11d),{'action':'update','whatsapp':_0x58e7a4}),_0x9aa889&&_0x2b9ac0[_0x39142f(0x125)](_0x39142f(0xfb)+_0x3ea7d4+'-whatsapp',{'action':_0x39142f(0x10d),'whatsapp':_0x9aa889}),_0xe4934b[_0x39142f(0x10e)](0xc8)[_0x39142f(0x110)](_0x58e7a4);};exports[a45_0x2d75d1(0x10d)]=update;const restart=async(_0x4fb41e,_0x5adef5)=>{const _0x2919f2=a45_0x2d75d1,{companyId:_0x572608,profile:_0x5c02bb}=_0x4fb41e[_0x2919f2(0x116)];if(_0x5c02bb!=='admin')throw new AppError_1[(_0x2919f2(0x111))](_0x2919f2(0x12e),0x193);const _0x20cfff=await Whatsapp_1[_0x2919f2(0x111)][_0x2919f2(0x104)]({'where':{'companyId':_0x572608}});for(const _0x40fd76 of _0x20cfff){await(0x0,wbot_1[_0x2919f2(0x101)])(_0x40fd76['id'],![]),await new Promise(_0x35f3ae=>setTimeout(_0x35f3ae,0xbb8)),await(0x0,StartWhatsAppSession_1[_0x2919f2(0x100)])(_0x40fd76,_0x572608),await _0x40fd76[_0x2919f2(0x10d)]({'lastRestartAt':new Date()});}return _0x5adef5['status'](0xc8)[_0x2919f2(0x110)]({'message':_0x2919f2(0x119)});};exports['restart']=restart;const remove=async(_0x1e0472,_0x222251)=>{const _0x105c96=a45_0x2d75d1,{whatsappId:_0x3d8bb}=_0x1e0472[_0x105c96(0x126)],{companyId:_0x2df011}=_0x1e0472[_0x105c96(0x116)],_0xb89912=(0x0,socket_1['getIO'])(),_0xc90c0f=await(0x0,ShowWhatsAppService_1[_0x105c96(0x111)])(_0x3d8bb,_0x2df011);if(_0xc90c0f[_0x105c96(0x10b)]===_0x105c96(0x132)){const _0x5171cb=await _0xc90c0f[_0x105c96(0x135)](_0x105c96(0x123),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x105c96(0xfc),_0x105c96(0x109)]}}});if(_0x5171cb[_0x105c96(0x107)]>0x0)throw new AppError_1[(_0x105c96(0x111))]('Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos');await(0x0,DeleteBaileysService_1[_0x105c96(0x111)])(_0x3d8bb),await(0x0,DeleteWhatsAppService_1[_0x105c96(0x111)])(_0x3d8bb),await cache_1[_0x105c96(0x10a)][_0x105c96(0x12d)](_0x105c96(0x11a)+_0x3d8bb+':*'),(0x0,wbot_1[_0x105c96(0x101)])(+_0x3d8bb),_0xb89912[_0x105c96(0x125)](_0x105c96(0xfb)+_0x2df011+_0x105c96(0x11d),{'action':_0x105c96(0x133),'whatsappId':+_0x3d8bb});}if(_0xc90c0f['channel']===_0x105c96(0xf9)||_0xc90c0f[_0x105c96(0x10b)]===_0x105c96(0x128)){const {facebookUserToken:_0x9e231f}=_0xc90c0f,_0x5bf8bc=await Whatsapp_1[_0x105c96(0x111)][_0x105c96(0x104)]({'where':{'facebookUserToken':_0x9e231f}});await Whatsapp_1[_0x105c96(0x111)][_0x105c96(0x103)]({'where':{'facebookUserToken':_0x9e231f}}),_0x5bf8bc[_0x105c96(0x12f)](_0x1c463b=>{const _0x4f1930=_0x105c96;_0xb89912[_0x4f1930(0x125)](_0x4f1930(0xfb)+_0x2df011+_0x4f1930(0x11d),{'action':'delete','whatsappId':_0x1c463b['id']});});}return _0x222251[_0x105c96(0x10e)](0xc8)['json']({'message':_0x105c96(0xff)});};exports[a45_0x2d75d1(0x105)]=remove;