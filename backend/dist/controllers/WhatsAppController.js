const a54_0x5b083d=a54_0x4adf;(function(_0x59b8b8,_0x52182e){const _0x3fa289=a54_0x4adf,_0x2f9172=_0x59b8b8();while(!![]){try{const _0x737e5e=parseInt(_0x3fa289(0x16c))/0x1*(-parseInt(_0x3fa289(0x169))/0x2)+-parseInt(_0x3fa289(0x139))/0x3*(-parseInt(_0x3fa289(0x12d))/0x4)+-parseInt(_0x3fa289(0x16e))/0x5*(parseInt(_0x3fa289(0x147))/0x6)+-parseInt(_0x3fa289(0x159))/0x7*(-parseInt(_0x3fa289(0x16d))/0x8)+-parseInt(_0x3fa289(0x162))/0x9*(parseInt(_0x3fa289(0x133))/0xa)+-parseInt(_0x3fa289(0x15f))/0xb*(-parseInt(_0x3fa289(0x135))/0xc)+-parseInt(_0x3fa289(0x168))/0xd*(-parseInt(_0x3fa289(0x160))/0xe);if(_0x737e5e===_0x52182e)break;else _0x2f9172['push'](_0x2f9172['shift']());}catch(_0x3ff08e){_0x2f9172['push'](_0x2f9172['shift']());}}}(a54_0x240d,0x2fa05));const a54_0x3dd501=(function(){let _0x21866d=!![];return function(_0x1d9619,_0x5a6977){const _0x29c61f=_0x21866d?function(){const _0x1dd6b7=a54_0x4adf;if(_0x5a6977){const _0x7a390=_0x5a6977[_0x1dd6b7(0x16f)](_0x1d9619,arguments);return _0x5a6977=null,_0x7a390;}}:function(){};return _0x21866d=![],_0x29c61f;};}()),a54_0x4fb114=a54_0x3dd501(this,function(){const _0x9015a7=a54_0x4adf;return a54_0x4fb114['toString']()[_0x9015a7(0x142)](_0x9015a7(0x143))['toString']()[_0x9015a7(0x148)](a54_0x4fb114)[_0x9015a7(0x142)](_0x9015a7(0x143));});a54_0x4fb114();'use strict';var __importDefault=this&&this[a54_0x5b083d(0x172)]||function(_0x222446){const _0x2d5e53=a54_0x5b083d;return _0x222446&&_0x222446[_0x2d5e53(0x165)]?_0x222446:{'default':_0x222446};};Object['defineProperty'](exports,a54_0x5b083d(0x165),{'value':!![]}),exports['deleteMedia']=exports[a54_0x5b083d(0x134)]=exports[a54_0x5b083d(0x146)]=exports[a54_0x5b083d(0x167)]=exports[a54_0x5b083d(0x12e)]=exports['show']=exports[a54_0x5b083d(0x13a)]=exports[a54_0x5b083d(0x137)]=void 0x0;const sequelize_1=require('sequelize'),lodash_1=require(a54_0x5b083d(0x173)),cache_1=require(a54_0x5b083d(0x15b)),socket_1=require('../libs/socket'),wbot_1=require(a54_0x5b083d(0x145)),Whatsapp_1=__importDefault(require(a54_0x5b083d(0x136))),DeleteBaileysService_1=__importDefault(require(a54_0x5b083d(0x132))),StartWhatsAppSession_1=require('../services/WbotServices/StartWhatsAppSession'),CreateWhatsAppService_1=__importDefault(require('../services/WhatsappService/CreateWhatsAppService')),DeleteWhatsAppService_1=__importDefault(require('../services/WhatsappService/DeleteWhatsAppService')),ListWhatsAppsService_1=__importDefault(require(a54_0x5b083d(0x155))),ShowWhatsAppService_1=__importDefault(require('../services/WhatsappService/ShowWhatsAppService')),UpdateWhatsAppService_1=__importDefault(require(a54_0x5b083d(0x131))),AppError_1=__importDefault(require('../errors/AppError')),StorageService_1=__importDefault(require(a54_0x5b083d(0x12f))),index=async(_0x1bcaf2,_0x24dcfe)=>{const _0xf08429=a54_0x5b083d,{companyId:_0x1d470a,id:_0x3547cd}=_0x1bcaf2[_0xf08429(0x14d)],{session:_0x1f3c20}=_0x1bcaf2[_0xf08429(0x15e)],_0x510464=await(0x0,ListWhatsAppsService_1['default'])({'companyId':_0x1d470a,'session':_0x1f3c20,'userId':+_0x3547cd});return _0x24dcfe[_0xf08429(0x154)](0xc8)['json'](_0x510464);};exports[a54_0x5b083d(0x137)]=index;const store=async(_0x4c5cfd,_0x7d7d35)=>{const _0x1bdb13=a54_0x5b083d,{name:_0x3180db,status:_0x222584,isDefault:_0x10165c,greetingMessage:_0x35d182,complationMessage:_0x5e0130,outOfHoursMessage:_0x2640a6,allowGroup:_0x4f8010,timeSendQueue:_0x453f34,sendIdQueue:_0x34bec5,useRating:_0x175ea5,ratingMessage:_0x35b4cf,transferMessage:_0x578eea,queueIds:_0x507ec5,token:_0x86b2f5,maxUseBotQueues:_0x41a9f6,expiresTicket:_0x320c7a,expiresInactiveMessage:_0x5c8564,importOldMessages:_0x2e2cbb,whenExpireTicket:_0x300f3b,inactiveMessageTime:_0x375154,inactiveMessage:_0xf0e055,automaticRestart:_0x75293d,period:_0x1c3f7d}=_0x4c5cfd[_0x1bdb13(0x157)],{companyId:_0x22a32c}=_0x4c5cfd[_0x1bdb13(0x14d)],{whatsapp:_0x1eb157,oldDefaultWhatsapp:_0x3a2f96}=await(0x0,CreateWhatsAppService_1[_0x1bdb13(0x158)])({'name':_0x3180db,'status':_0x222584,'isDefault':_0x10165c,'greetingMessage':_0x35d182,'complationMessage':_0x5e0130,'outOfHoursMessage':_0x2640a6,'useRating':_0x175ea5,'ratingMessage':_0x35b4cf,'transferMessage':_0x578eea,'queueIds':_0x507ec5,'companyId':_0x22a32c,'token':_0x86b2f5,'maxUseBotQueues':_0x41a9f6,'timeSendQueue':_0x453f34,'sendIdQueue':_0x34bec5,'expiresTicket':_0x320c7a,'expiresInactiveMessage':_0x5c8564,'allowGroup':_0x4f8010,'importOldMessages':_0x2e2cbb,'whenExpireTicket':_0x300f3b,'inactiveMessageTime':_0x375154,'inactiveMessage':_0xf0e055,'automaticRestart':_0x75293d,'period':_0x1c3f7d});(0x0,StartWhatsAppSession_1[_0x1bdb13(0x150)])(_0x1eb157,_0x22a32c);const _0x105d29=(0x0,socket_1[_0x1bdb13(0x171)])();return _0x105d29[_0x1bdb13(0x13c)](_0x1bdb13(0x13e)+_0x22a32c+_0x1bdb13(0x16a),{'action':'update','whatsapp':_0x1eb157}),_0x3a2f96&&_0x105d29[_0x1bdb13(0x13c)]('company-'+_0x22a32c+_0x1bdb13(0x16a),{'action':_0x1bdb13(0x12e),'whatsapp':_0x3a2f96}),_0x7d7d35['status'](0xc8)['json'](_0x1eb157);};exports[a54_0x5b083d(0x13a)]=store;const show=async(_0x398e9a,_0x214b8a)=>{const _0x27a589=a54_0x5b083d,{whatsappId:_0x1de0d8}=_0x398e9a[_0x27a589(0x13d)],{companyId:_0x5e20b5}=_0x398e9a[_0x27a589(0x14d)],{session:_0x30abfb}=_0x398e9a['query'],_0x11752a=await(0x0,ShowWhatsAppService_1[_0x27a589(0x158)])(_0x1de0d8,_0x5e20b5,_0x30abfb);return _0x214b8a['status'](0xc8)['json'](_0x11752a);};exports[a54_0x5b083d(0x144)]=show;const update=async(_0x5c0327,_0x59664c)=>{const _0xbe1aac=a54_0x5b083d,{whatsappId:_0x5a7001}=_0x5c0327[_0xbe1aac(0x13d)],_0x30d41d=_0x5c0327[_0xbe1aac(0x157)],{companyId:_0x292684}=_0x5c0327[_0xbe1aac(0x14d)],{whatsapp:_0x148b7e,oldDefaultWhatsapp:_0x225840}=await(0x0,UpdateWhatsAppService_1[_0xbe1aac(0x158)])({'whatsappData':_0x30d41d,'whatsappId':_0x5a7001,'companyId':_0x292684}),_0x7188ac=(0x0,socket_1[_0xbe1aac(0x171)])();return _0x7188ac[_0xbe1aac(0x13c)]('company-'+_0x292684+_0xbe1aac(0x16a),{'action':_0xbe1aac(0x12e),'whatsapp':_0x148b7e}),_0x225840&&_0x7188ac[_0xbe1aac(0x13c)](_0xbe1aac(0x13e)+_0x292684+_0xbe1aac(0x16a),{'action':'update','whatsapp':_0x225840}),_0x59664c['status'](0xc8)['json'](_0x148b7e);};function a54_0x240d(){const _0x5802dd=['../libs/cache','$get','json','query','23441YqqqeC','1044764vNweXc','removeWbot','16371hwCFOP','conexao','facebook','__esModule','channel','restart','13ZipYFC','44mumqCv','-whatsapp','delete','14096uBBciB','8TDMnQj','352955YFkBIa','apply','ERR_NO_PERMISSION','getIO','__importDefault','lodash','5996cIYYkn','update','../services/StorageService/StorageService','Session\x20disconnected.','../services/WhatsappService/UpdateWhatsAppService','../services/BaileysServices/DeleteBaileysService','810bKOVFE','mediaUpload','2172qzSvKL','../models/Whatsapp','index','filename','165deXXeC','store','message','emit','params','company-','admin','whatsapp','pending','search','(((.+)+)+)+$','show','../libs/wbot','remove','6Eqkqre','constructor','mimetype','Whatsapp\x20connections\x20restarted.','path','open','user','tickets','Arquivo\x20excluído','StartWhatsAppSession','findByPk','findAll','forEach','status','../services/WhatsappService/ListWhatsAppsService','greetingMediaAttachment','body','default','1262359fhwgQu','head'];a54_0x240d=function(){return _0x5802dd;};return a54_0x240d();}exports[a54_0x5b083d(0x12e)]=update;const restart=async(_0x19b076,_0x3f7285)=>{const _0x5b05f6=a54_0x5b083d,{companyId:_0x5d5959,profile:_0x261fc9}=_0x19b076[_0x5b05f6(0x14d)];if(_0x261fc9!==_0x5b05f6(0x13f))throw new AppError_1[(_0x5b05f6(0x158))](_0x5b05f6(0x170),0x193);const _0x113086=await Whatsapp_1['default'][_0x5b05f6(0x152)]({'where':{'companyId':_0x5d5959}});for(const _0x53e54c of _0x113086){await(0x0,wbot_1[_0x5b05f6(0x161)])(_0x53e54c['id'],![]),await new Promise(_0x148635=>setTimeout(_0x148635,0xbb8)),await(0x0,StartWhatsAppSession_1[_0x5b05f6(0x150)])(_0x53e54c,_0x5d5959),await _0x53e54c[_0x5b05f6(0x12e)]({'lastRestartAt':new Date()});}return _0x3f7285[_0x5b05f6(0x154)](0xc8)[_0x5b05f6(0x15d)]({'message':_0x5b05f6(0x14a)});};exports[a54_0x5b083d(0x167)]=restart;const remove=async(_0x223473,_0x671e14)=>{const _0x28c86e=a54_0x5b083d,{whatsappId:_0x3100cc}=_0x223473[_0x28c86e(0x13d)],{companyId:_0x553011}=_0x223473[_0x28c86e(0x14d)],_0x3d728a=(0x0,socket_1[_0x28c86e(0x171)])(),_0x59f309=await(0x0,ShowWhatsAppService_1[_0x28c86e(0x158)])(_0x3100cc,_0x553011);if(_0x59f309[_0x28c86e(0x166)]===_0x28c86e(0x140)){const _0x62e6db=await _0x59f309[_0x28c86e(0x15c)](_0x28c86e(0x14e),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x28c86e(0x14c),_0x28c86e(0x141)]}}});if(_0x62e6db['length']>0x0)throw new AppError_1[(_0x28c86e(0x158))]('Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos');await(0x0,DeleteBaileysService_1['default'])(_0x3100cc),await(0x0,DeleteWhatsAppService_1[_0x28c86e(0x158)])(_0x3100cc),await cache_1['cacheLayer']['delFromPattern']('sessions:'+_0x3100cc+':*'),(0x0,wbot_1[_0x28c86e(0x161)])(+_0x3100cc),_0x3d728a['emit'](_0x28c86e(0x13e)+_0x553011+_0x28c86e(0x16a),{'action':_0x28c86e(0x16b),'whatsappId':+_0x3100cc});}if(_0x59f309[_0x28c86e(0x166)]===_0x28c86e(0x164)||_0x59f309[_0x28c86e(0x166)]==='instagram'){const {facebookUserToken:_0x35e9cc}=_0x59f309,_0xca3b79=await Whatsapp_1[_0x28c86e(0x158)][_0x28c86e(0x152)]({'where':{'facebookUserToken':_0x35e9cc}});await Whatsapp_1['default']['destroy']({'where':{'facebookUserToken':_0x35e9cc}}),_0xca3b79[_0x28c86e(0x153)](_0x5302a6=>{const _0x4e00dc=_0x28c86e;_0x3d728a[_0x4e00dc(0x13c)](_0x4e00dc(0x13e)+_0x553011+_0x4e00dc(0x16a),{'action':'delete','whatsappId':_0x5302a6['id']});});}return _0x671e14[_0x28c86e(0x154)](0xc8)[_0x28c86e(0x15d)]({'message':_0x28c86e(0x130)});};exports[a54_0x5b083d(0x146)]=remove;const mediaUpload=async(_0xbb4df6,_0x9a354c)=>{const _0x4dafe1=a54_0x5b083d,{whatsappId:_0x237978}=_0xbb4df6[_0x4dafe1(0x13d)],{companyId:_0x4f35f6}=_0xbb4df6[_0x4dafe1(0x14d)],_0x399640=_0xbb4df6['files'],_0x4d08dd=(0x0,lodash_1[_0x4dafe1(0x15a)])(_0x399640);try{const _0x3dbda2=await Whatsapp_1[_0x4dafe1(0x158)][_0x4dafe1(0x151)](_0x237978),{url:_0x4130a4}=await StorageService_1['default']['uploadFile'](_0x4f35f6,_0x4dafe1(0x163),_0x4d08dd[_0x4dafe1(0x138)],_0x4d08dd[_0x4dafe1(0x14b)],_0x4d08dd[_0x4dafe1(0x149)]);return await _0x3dbda2[_0x4dafe1(0x12e)]({'greetingMediaAttachment':_0x4130a4}),_0x9a354c['send']({'message':'Arquivo\x20salvo'});}catch(_0x956bd2){throw new AppError_1['default'](_0x956bd2['message']);}};exports[a54_0x5b083d(0x134)]=mediaUpload;const deleteMedia=async(_0x1195e3,_0x2e6f50)=>{const _0x348384=a54_0x5b083d,{whatsappId:_0x29bf48}=_0x1195e3[_0x348384(0x13d)],{companyId:_0x485777}=_0x1195e3['user'];try{const _0x357b59=await Whatsapp_1['default'][_0x348384(0x151)](_0x29bf48);return _0x357b59[_0x348384(0x156)]&&await StorageService_1[_0x348384(0x158)]['deleteFile'](_0x485777,_0x357b59[_0x348384(0x156)]),await _0x357b59['update']({'greetingMediaAttachment':null}),_0x2e6f50['send']({'message':_0x348384(0x14f)});}catch(_0xc70206){throw new AppError_1[(_0x348384(0x158))](_0xc70206[_0x348384(0x13b)]);}};function a54_0x4adf(_0x3d0a50,_0x347228){const _0x533c39=a54_0x240d();return a54_0x4adf=function(_0x4fb114,_0x3dd501){_0x4fb114=_0x4fb114-0x12d;let _0x240dc7=_0x533c39[_0x4fb114];return _0x240dc7;},a54_0x4adf(_0x3d0a50,_0x347228);}exports['deleteMedia']=deleteMedia;