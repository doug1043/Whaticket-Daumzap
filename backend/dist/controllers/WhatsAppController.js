const a46_0x502fb9=a46_0x4f6e;(function(_0x6f77df,_0x16a17c){const _0x238a11=a46_0x4f6e,_0x3bb5ed=_0x6f77df();while(!![]){try{const _0x4c1ff8=parseInt(_0x238a11(0xb9))/0x1*(parseInt(_0x238a11(0xc3))/0x2)+-parseInt(_0x238a11(0xc8))/0x3*(-parseInt(_0x238a11(0xaa))/0x4)+-parseInt(_0x238a11(0xc5))/0x5+parseInt(_0x238a11(0xc7))/0x6*(parseInt(_0x238a11(0xc9))/0x7)+parseInt(_0x238a11(0x9c))/0x8+parseInt(_0x238a11(0xd2))/0x9*(parseInt(_0x238a11(0xd9))/0xa)+-parseInt(_0x238a11(0xc2))/0xb;if(_0x4c1ff8===_0x16a17c)break;else _0x3bb5ed['push'](_0x3bb5ed['shift']());}catch(_0x513a92){_0x3bb5ed['push'](_0x3bb5ed['shift']());}}}(a46_0x5647,0xe4c73));const a46_0x25d6d1=(function(){let _0xe964cf=!![];return function(_0x2969e7,_0x5dde73){const _0x21eb84=_0xe964cf?function(){const _0x305544=a46_0x4f6e;if(_0x5dde73){const _0x3c2e4f=_0x5dde73[_0x305544(0xce)](_0x2969e7,arguments);return _0x5dde73=null,_0x3c2e4f;}}:function(){};return _0xe964cf=![],_0x21eb84;};}()),a46_0x27a51f=a46_0x25d6d1(this,function(){const _0x4110ed=a46_0x4f6e;return a46_0x27a51f[_0x4110ed(0xb7)]()[_0x4110ed(0xb8)](_0x4110ed(0x9b))[_0x4110ed(0xb7)]()[_0x4110ed(0xac)](a46_0x27a51f)[_0x4110ed(0xb8)](_0x4110ed(0x9b));});a46_0x27a51f();'use strict';function a46_0x5647(){const _0x24be7e=['params','push','update','company-','__esModule','Whatsapp\x20deleted.','remove','index','26009379IlhzxA','26SNgpJZ','../services/WhatsappService/ShowWhatsAppService','3953625NbIPCy','__importDefault','9630mroAlC','15qojUSp','28YmCoyt','../services/WhatsappService/CreateWhatsAppService','defineProperty','ERR_NO_PERMISSION','Whatsapp\x20restart.','apply','pending','No\x20companies\x20found','user','432ZLkWWF','../services/WhatsappService/UpdateWhatsAppService','show','-mainchannel','../errors/AppError','length','default','172450cXoArY','delete','getAllConnections','(((.+)+)+)+$','10332976tssKFa','query','restart','whatsapp','sequelize','restartWbot','../models/Whatsapp','admin','../libs/socket','store','body','-whatsapp','../services/WhatsappService/ListWhatsAppsService','error','942024MHTQJi','closeImportedTickets','constructor','Failed\x20to\x20fetch\x20connections','status','getIO','tickets','../services/CompanyService/FindAllCompaniesService','../services/WbotServices/StartWhatsAppSession','emit','open','../libs/wbot','json','toString','search','60689sWeCQT'];a46_0x5647=function(){return _0x24be7e;};return a46_0x5647();}var __importDefault=this&&this[a46_0x502fb9(0xc6)]||function(_0x2da837){return _0x2da837&&_0x2da837['__esModule']?_0x2da837:{'default':_0x2da837};};Object[a46_0x502fb9(0xcb)](exports,a46_0x502fb9(0xbe),{'value':!![]}),exports[a46_0x502fb9(0x9e)]=exports[a46_0x502fb9(0xc0)]=exports[a46_0x502fb9(0xbc)]=exports[a46_0x502fb9(0xdb)]=exports[a46_0x502fb9(0xd4)]=exports[a46_0x502fb9(0xa5)]=exports['index']=exports['closedTickets']=void 0x0;function a46_0x4f6e(_0x8d439e,_0x3c1704){const _0x403bca=a46_0x5647();return a46_0x4f6e=function(_0x27a51f,_0x25d6d1){_0x27a51f=_0x27a51f-0x9b;let _0x5647b7=_0x403bca[_0x27a51f];return _0x5647b7;},a46_0x4f6e(_0x8d439e,_0x3c1704);}const socket_1=require(a46_0x502fb9(0xa4)),wbot_1=require(a46_0x502fb9(0xb5)),StartWhatsAppSession_1=require(a46_0x502fb9(0xb2)),FindAllCompaniesService_1=__importDefault(require(a46_0x502fb9(0xb1))),CreateWhatsAppService_1=__importDefault(require(a46_0x502fb9(0xca))),DeleteWhatsAppService_1=__importDefault(require('../services/WhatsappService/DeleteWhatsAppService')),ListWhatsAppsService_1=__importDefault(require(a46_0x502fb9(0xa8))),ShowWhatsAppService_1=__importDefault(require(a46_0x502fb9(0xc4))),UpdateWhatsAppService_1=__importDefault(require(a46_0x502fb9(0xd3))),AppError_1=__importDefault(require(a46_0x502fb9(0xd6))),sequelize_1=require(a46_0x502fb9(0xa0)),ImportWhatsAppMessageService_1=require('../services/WhatsappService/ImportWhatsAppMessageService'),Whatsapp_1=__importDefault(require(a46_0x502fb9(0xa2))),closedTickets=async(_0x971079,_0x5dde01)=>{const _0x1fb652=a46_0x502fb9,{whatsappId:_0x437742}=_0x971079[_0x1fb652(0xba)];return await(0x0,ImportWhatsAppMessageService_1[_0x1fb652(0xab)])(_0x437742),_0x5dde01[_0x1fb652(0xae)](0xc8)[_0x1fb652(0xb6)](_0x1fb652(0x9f));};exports['closedTickets']=closedTickets;const index=async(_0x538dc3,_0x146e64)=>{const _0x571ef3=a46_0x502fb9,{companyId:_0x153473}=_0x538dc3[_0x571ef3(0xd1)],{session:_0x427f51}=_0x538dc3[_0x571ef3(0x9d)],_0x48aab7=await(0x0,ListWhatsAppsService_1[_0x571ef3(0xd8)])({'companyId':_0x153473,'session':_0x427f51});return _0x146e64['status'](0xc8)[_0x571ef3(0xb6)](_0x48aab7);};exports[a46_0x502fb9(0xc1)]=index;const store=async(_0x529e02,_0x4731b1)=>{const _0x57f4c9=a46_0x502fb9,{name:_0xdd7307,status:_0x40ef68,isDefault:_0xa2c76a,greetingMessage:_0xd13f2e,complationMessage:_0x1392b1,outOfHoursMessage:_0x4890a5,queueIds:_0x15ea3,token:_0x587a49,allowGroup:_0x1995c0,timeSendQueue:_0xe33db8,sendIdQueue:_0x25330c,promptId:_0x31b926,maxUseBotQueues:_0x7b4d1a,timeUseBotQueues:_0x31b5cf,expiresTicket:_0x45824e,expiresInactiveMessage:_0x3a0160,importOldMessages:_0x46a7ed,importRecentMessages:_0x3f39ea,closedTicketsPostImported:_0x44cf2e,importOldMessagesGroups:_0xaf1879}=_0x529e02[_0x57f4c9(0xa6)],{companyId:_0x46062e}=_0x529e02[_0x57f4c9(0xd1)],{whatsapp:_0x2a3ff9,oldDefaultWhatsapp:_0x20951c}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0xdd7307,'status':_0x40ef68,'isDefault':_0xa2c76a,'greetingMessage':_0xd13f2e,'complationMessage':_0x1392b1,'outOfHoursMessage':_0x4890a5,'queueIds':_0x15ea3,'companyId':_0x46062e,'token':_0x587a49,'timeSendQueue':_0xe33db8,'sendIdQueue':_0x25330c,'promptId':_0x31b926,'maxUseBotQueues':_0x7b4d1a,'timeUseBotQueues':_0x31b5cf,'expiresTicket':_0x45824e,'expiresInactiveMessage':_0x3a0160,'allowGroup':_0x1995c0,'importOldMessages':_0x46a7ed,'importRecentMessages':_0x3f39ea,'closedTicketsPostImported':_0x44cf2e,'importOldMessagesGroups':_0xaf1879});(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x2a3ff9,_0x46062e);const _0x56cef6=(0x0,socket_1[_0x57f4c9(0xaf)])();return _0x56cef6['to'](_0x57f4c9(0xbd)+_0x46062e+_0x57f4c9(0xd5))[_0x57f4c9(0xb3)](_0x57f4c9(0xbd)+_0x46062e+_0x57f4c9(0xa7),{'action':_0x57f4c9(0xbc),'whatsapp':_0x2a3ff9}),_0x20951c&&_0x56cef6['to']('company-'+_0x46062e+_0x57f4c9(0xd5))['emit'](_0x57f4c9(0xbd)+_0x46062e+_0x57f4c9(0xa7),{'action':_0x57f4c9(0xbc),'whatsapp':_0x20951c}),_0x4731b1['status'](0xc8)[_0x57f4c9(0xb6)](_0x2a3ff9);};exports[a46_0x502fb9(0xa5)]=store;const show=async(_0x39b8af,_0x172e41)=>{const _0xd8bb76=a46_0x502fb9,{whatsappId:_0x45105e}=_0x39b8af['params'],{companyId:_0x258159}=_0x39b8af[_0xd8bb76(0xd1)],{session:_0x3d9e24}=_0x39b8af[_0xd8bb76(0x9d)],_0x3dff36=await(0x0,ShowWhatsAppService_1[_0xd8bb76(0xd8)])(_0x45105e,_0x258159,_0x3d9e24);return _0x172e41[_0xd8bb76(0xae)](0xc8)[_0xd8bb76(0xb6)](_0x3dff36);};exports[a46_0x502fb9(0xd4)]=show;const getAllConnections=async(_0x43e77f,_0x46ddae)=>{const _0x54adce=a46_0x502fb9;try{const _0xe6b5d3=await(0x0,FindAllCompaniesService_1[_0x54adce(0xd8)])();if(!_0xe6b5d3||_0xe6b5d3[_0x54adce(0xd7)]===0x0)return _0x46ddae['status'](0x194)[_0x54adce(0xb6)]({'error':_0x54adce(0xd0)});const _0x5d8118=[];for(const _0x16d99c of _0xe6b5d3){if(typeof _0x16d99c['id']!=='number')continue;const _0x547a85=await Whatsapp_1['default']['findAll']({'where':{'companyId':_0x16d99c['id']}});_0x5d8118[_0x54adce(0xbb)](..._0x547a85);}return _0x46ddae[_0x54adce(0xae)](0xc8)['json'](_0x5d8118);}catch(_0x48ec20){return console[_0x54adce(0xa9)](_0x48ec20),_0x46ddae[_0x54adce(0xae)](0x1f4)[_0x54adce(0xb6)]({'error':_0x54adce(0xad)});}};exports[a46_0x502fb9(0xdb)]=getAllConnections;const update=async(_0x2ad94d,_0x18a6c1)=>{const _0x417d10=a46_0x502fb9,{whatsappId:_0x591f93}=_0x2ad94d[_0x417d10(0xba)],_0x5e1890=_0x2ad94d[_0x417d10(0xa6)],{companyId:_0xfae82c}=_0x2ad94d[_0x417d10(0xd1)],{whatsapp:_0x4d71cb,oldDefaultWhatsapp:_0x49218e}=await(0x0,UpdateWhatsAppService_1[_0x417d10(0xd8)])({'whatsappData':_0x5e1890,'whatsappId':_0x591f93,'companyId':_0xfae82c}),_0x45726c=(0x0,socket_1[_0x417d10(0xaf)])();return _0x45726c['to'](_0x417d10(0xbd)+_0xfae82c+'-mainchannel')[_0x417d10(0xb3)](_0x417d10(0xbd)+_0xfae82c+_0x417d10(0xa7),{'action':_0x417d10(0xbc),'whatsapp':_0x4d71cb}),_0x49218e&&_0x45726c['to']('company-'+_0xfae82c+_0x417d10(0xd5))[_0x417d10(0xb3)](_0x417d10(0xbd)+_0xfae82c+_0x417d10(0xa7),{'action':_0x417d10(0xbc),'whatsapp':_0x49218e}),_0x18a6c1[_0x417d10(0xae)](0xc8)[_0x417d10(0xb6)](_0x4d71cb);};exports[a46_0x502fb9(0xbc)]=update;const remove=async(_0x227370,_0x2a6ba9)=>{const _0x1085aa=a46_0x502fb9,{whatsappId:_0x32c9bc}=_0x227370[_0x1085aa(0xba)],{companyId:_0x50eafe}=_0x227370[_0x1085aa(0xd1)],_0x14f57e=await(0x0,ShowWhatsAppService_1[_0x1085aa(0xd8)])(_0x32c9bc,_0x50eafe),_0x41ed11=await _0x14f57e['$get'](_0x1085aa(0xb0),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x1085aa(0xb4),_0x1085aa(0xcf)]}}});if(_0x41ed11[_0x1085aa(0xd7)]>0x0)throw new AppError_1['default']('Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos');await(0x0,DeleteWhatsAppService_1['default'])(_0x32c9bc),await(0x0,wbot_1['removeWbot'])(+_0x32c9bc);const _0x15a292=(0x0,socket_1['getIO'])();return _0x15a292['to'](_0x1085aa(0xbd)+_0x50eafe+_0x1085aa(0xd5))[_0x1085aa(0xb3)](_0x1085aa(0xbd)+_0x50eafe+_0x1085aa(0xa7),{'action':_0x1085aa(0xda),'whatsappId':+_0x32c9bc}),_0x2a6ba9['status'](0xc8)[_0x1085aa(0xb6)]({'message':_0x1085aa(0xbf)});};exports[a46_0x502fb9(0xc0)]=remove;const restart=async(_0x1dd3c4,_0x4e4241)=>{const _0x2ddec6=a46_0x502fb9,{companyId:_0x21a76f,profile:_0x223bfe}=_0x1dd3c4['user'];if(_0x223bfe!==_0x2ddec6(0xa3))throw new AppError_1[(_0x2ddec6(0xd8))](_0x2ddec6(0xcc),0x193);return await(0x0,wbot_1[_0x2ddec6(0xa1)])(_0x21a76f),_0x4e4241['status'](0xc8)[_0x2ddec6(0xb6)]({'message':_0x2ddec6(0xcd)});};exports[a46_0x502fb9(0x9e)]=restart;