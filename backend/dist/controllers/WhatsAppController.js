const a45_0x28a915=a45_0x556d;(function(_0x4b2dce,_0x48e4a4){const _0x9db8cd=a45_0x556d,_0x182b77=_0x4b2dce();while(!![]){try{const _0x34258a=parseInt(_0x9db8cd(0x125))/0x1*(parseInt(_0x9db8cd(0x11e))/0x2)+parseInt(_0x9db8cd(0x122))/0x3+-parseInt(_0x9db8cd(0x124))/0x4*(parseInt(_0x9db8cd(0xf5))/0x5)+-parseInt(_0x9db8cd(0xff))/0x6+parseInt(_0x9db8cd(0xef))/0x7*(parseInt(_0x9db8cd(0x123))/0x8)+-parseInt(_0x9db8cd(0x110))/0x9+parseInt(_0x9db8cd(0x111))/0xa;if(_0x34258a===_0x48e4a4)break;else _0x182b77['push'](_0x182b77['shift']());}catch(_0x13cadb){_0x182b77['push'](_0x182b77['shift']());}}}(a45_0x48bd,0xd7e2f));const a45_0x3a5498=(function(){let _0x530617=!![];return function(_0x1f8ea3,_0x316c20){const _0x73df61=_0x530617?function(){const _0x543da4=a45_0x556d;if(_0x316c20){const _0x2a3bd9=_0x316c20[_0x543da4(0x10a)](_0x1f8ea3,arguments);return _0x316c20=null,_0x2a3bd9;}}:function(){};return _0x530617=![],_0x73df61;};}()),a45_0x540a7b=a45_0x3a5498(this,function(){const _0x4815ea=a45_0x556d;return a45_0x540a7b['toString']()['search']('(((.+)+)+)+$')[_0x4815ea(0x126)]()[_0x4815ea(0xf2)](a45_0x540a7b)['search'](_0x4815ea(0x114));});a45_0x540a7b();function a45_0x556d(_0x3fc243,_0x3344b7){const _0x4e1f88=a45_0x48bd();return a45_0x556d=function(_0x540a7b,_0x3a5498){_0x540a7b=_0x540a7b-0xeb;let _0x48bd95=_0x4e1f88[_0x540a7b];return _0x48bd95;},a45_0x556d(_0x3fc243,_0x3344b7);}'use strict';var __importDefault=this&&this[a45_0x28a915(0x102)]||function(_0x75559){const _0x55dbf0=a45_0x28a915;return _0x75559&&_0x75559[_0x55dbf0(0x100)]?_0x75559:{'default':_0x75559};};Object[a45_0x28a915(0x11d)](exports,a45_0x28a915(0x100),{'value':!![]}),exports[a45_0x28a915(0xf3)]=exports[a45_0x28a915(0xfa)]=exports[a45_0x28a915(0xfb)]=exports[a45_0x28a915(0x103)]=exports[a45_0x28a915(0x10d)]=exports['index']=void 0x0;const sequelize_1=require('sequelize'),cache_1=require(a45_0x28a915(0xfc)),socket_1=require(a45_0x28a915(0x118)),wbot_1=require(a45_0x28a915(0x11b)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),DeleteBaileysService_1=__importDefault(require(a45_0x28a915(0x121))),StartWhatsAppSession_1=require('../services/WbotServices/StartWhatsAppSession'),CreateWhatsAppService_1=__importDefault(require(a45_0x28a915(0xeb))),DeleteWhatsAppService_1=__importDefault(require(a45_0x28a915(0xfe))),ListWhatsAppsService_1=__importDefault(require('../services/WhatsappService/ListWhatsAppsService')),ShowWhatsAppService_1=__importDefault(require(a45_0x28a915(0x107))),UpdateWhatsAppService_1=__importDefault(require(a45_0x28a915(0x117))),AppError_1=__importDefault(require(a45_0x28a915(0xf4))),index=async(_0x2e8af8,_0x20e6e6)=>{const _0x148298=a45_0x28a915,{companyId:_0x40d17b}=_0x2e8af8[_0x148298(0xf1)],{session:_0x4a8b35}=_0x2e8af8[_0x148298(0x105)],_0x2cf5d9=await(0x0,ListWhatsAppsService_1[_0x148298(0xf0)])({'companyId':_0x40d17b,'session':_0x4a8b35});return _0x20e6e6['status'](0xc8)[_0x148298(0x112)](_0x2cf5d9);};exports[a45_0x28a915(0xee)]=index;function a45_0x48bd(){const _0x15aa5b=['toString','admin','forEach','../services/WhatsappService/CreateWhatsAppService','ERR_NO_PERMISSION','removeWbot','index','4151ckSgGE','default','user','constructor','remove','../errors/AppError','3640055YzKNPu','params','channel','sessions:','company-','restart','update','../libs/cache','$get','../services/WhatsappService/DeleteWhatsAppService','4612128XEonDW','__esModule','Whatsapp\x20connections\x20restarted.','__importDefault','show','destroy','query','instagram','../services/WhatsappService/ShowWhatsAppService','-whatsapp','StartWhatsAppSession','apply','Session\x20disconnected.','findAll','store','emit','getIO','9283329qNFphY','5002290kbdHGG','json','status','(((.+)+)+)+$','body','delete','../services/WhatsappService/UpdateWhatsAppService','../libs/socket','delFromPattern','tickets','../libs/wbot','cacheLayer','defineProperty','1724JfXoFr','whatsapp','open','../services/BaileysServices/DeleteBaileysService','2591781IfiRhL','14248GLQcHY','4xiwbgP','1151LlZXcL'];a45_0x48bd=function(){return _0x15aa5b;};return a45_0x48bd();}const store=async(_0x2767a3,_0xee06f)=>{const _0x5cf7a9=a45_0x28a915,{name:_0x5e6b96,status:_0x105dbc,isDefault:_0x18eb01,greetingMessage:_0xc22f9e,complationMessage:_0x40abe8,outOfHoursMessage:_0x251bde,allowGroup:_0x4d585e,timeSendQueue:_0x306ec4,sendIdQueue:_0x89a676,useRating:_0x17c749,ratingMessage:_0xc5a8f1,transferMessage:_0x239da6,queueIds:_0x351234,token:_0x2baf08,maxUseBotQueues:_0x40fc10,expiresTicket:_0x48fc2e,expiresInactiveMessage:_0xaa6b6c,importOldMessages:_0x506230,schedules:_0x1398e3,whenExpireTicket:_0x4decc8,inactiveMessageTime:_0x45a2f7,inactiveMessage:_0x117375,automaticRestart:_0x253636,period:_0x13f3e3}=_0x2767a3[_0x5cf7a9(0x115)],{companyId:_0x5523dd}=_0x2767a3[_0x5cf7a9(0xf1)],{whatsapp:_0x436168,oldDefaultWhatsapp:_0x45c77f}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x5e6b96,'status':_0x105dbc,'isDefault':_0x18eb01,'greetingMessage':_0xc22f9e,'complationMessage':_0x40abe8,'outOfHoursMessage':_0x251bde,'useRating':_0x17c749,'ratingMessage':_0xc5a8f1,'transferMessage':_0x239da6,'queueIds':_0x351234,'companyId':_0x5523dd,'token':_0x2baf08,'maxUseBotQueues':_0x40fc10,'timeSendQueue':_0x306ec4,'sendIdQueue':_0x89a676,'expiresTicket':_0x48fc2e,'expiresInactiveMessage':_0xaa6b6c,'allowGroup':_0x4d585e,'importOldMessages':_0x506230,'schedules':_0x1398e3,'whenExpireTicket':_0x4decc8,'inactiveMessageTime':_0x45a2f7,'inactiveMessage':_0x117375,'automaticRestart':_0x253636,'period':_0x13f3e3});(0x0,StartWhatsAppSession_1[_0x5cf7a9(0x109)])(_0x436168,_0x5523dd);const _0xe38118=(0x0,socket_1[_0x5cf7a9(0x10f)])();return _0xe38118[_0x5cf7a9(0x10e)]('company-'+_0x5523dd+_0x5cf7a9(0x108),{'action':_0x5cf7a9(0xfb),'whatsapp':_0x436168}),_0x45c77f&&_0xe38118[_0x5cf7a9(0x10e)]('company-'+_0x5523dd+_0x5cf7a9(0x108),{'action':_0x5cf7a9(0xfb),'whatsapp':_0x45c77f}),_0xee06f[_0x5cf7a9(0x113)](0xc8)[_0x5cf7a9(0x112)](_0x436168);};exports[a45_0x28a915(0x10d)]=store;const show=async(_0x261b49,_0x271173)=>{const _0x56ad29=a45_0x28a915,{whatsappId:_0x45e158}=_0x261b49[_0x56ad29(0xf6)],{companyId:_0x285048}=_0x261b49[_0x56ad29(0xf1)],{session:_0x1120a9}=_0x261b49[_0x56ad29(0x105)],_0x1aff8f=await(0x0,ShowWhatsAppService_1[_0x56ad29(0xf0)])(_0x45e158,_0x285048,_0x1120a9);return _0x271173['status'](0xc8)[_0x56ad29(0x112)](_0x1aff8f);};exports[a45_0x28a915(0x103)]=show;const update=async(_0x378459,_0xc642d4)=>{const _0x320510=a45_0x28a915,{whatsappId:_0x4c1886}=_0x378459['params'],_0x57a3ab=_0x378459[_0x320510(0x115)],{companyId:_0x4c19f9}=_0x378459[_0x320510(0xf1)],{whatsapp:_0x5e3cae,oldDefaultWhatsapp:_0x811fed}=await(0x0,UpdateWhatsAppService_1['default'])({'whatsappData':_0x57a3ab,'whatsappId':_0x4c1886,'companyId':_0x4c19f9}),_0x20b6dd=(0x0,socket_1[_0x320510(0x10f)])();return _0x20b6dd['emit']('company-'+_0x4c19f9+'-whatsapp',{'action':_0x320510(0xfb),'whatsapp':_0x5e3cae}),_0x811fed&&_0x20b6dd[_0x320510(0x10e)](_0x320510(0xf9)+_0x4c19f9+_0x320510(0x108),{'action':_0x320510(0xfb),'whatsapp':_0x811fed}),_0xc642d4[_0x320510(0x113)](0xc8)[_0x320510(0x112)](_0x5e3cae);};exports[a45_0x28a915(0xfb)]=update;const restart=async(_0x31de1d,_0x50300f)=>{const _0x80d9a6=a45_0x28a915,{companyId:_0x2d6570,profile:_0x289f2e}=_0x31de1d[_0x80d9a6(0xf1)];if(_0x289f2e!==_0x80d9a6(0x127))throw new AppError_1[(_0x80d9a6(0xf0))](_0x80d9a6(0xec),0x193);const _0x471877=await Whatsapp_1[_0x80d9a6(0xf0)][_0x80d9a6(0x10c)]({'where':{'companyId':_0x2d6570}});for(const _0x13f568 of _0x471877){await(0x0,wbot_1[_0x80d9a6(0xed)])(_0x13f568['id'],![]),await new Promise(_0x1ceb2b=>setTimeout(_0x1ceb2b,0xbb8)),await(0x0,StartWhatsAppSession_1[_0x80d9a6(0x109)])(_0x13f568,_0x2d6570),await _0x13f568[_0x80d9a6(0xfb)]({'lastRestartAt':new Date()});}return _0x50300f[_0x80d9a6(0x113)](0xc8)[_0x80d9a6(0x112)]({'message':_0x80d9a6(0x101)});};exports[a45_0x28a915(0xfa)]=restart;const remove=async(_0x1c00f0,_0x2c3765)=>{const _0x13708a=a45_0x28a915,{whatsappId:_0x10e271}=_0x1c00f0[_0x13708a(0xf6)],{companyId:_0x555d6d}=_0x1c00f0[_0x13708a(0xf1)],_0x12948c=(0x0,socket_1['getIO'])(),_0x405d07=await(0x0,ShowWhatsAppService_1[_0x13708a(0xf0)])(_0x10e271,_0x555d6d);if(_0x405d07[_0x13708a(0xf7)]===_0x13708a(0x11f)){const _0x1b8bf0=await _0x405d07[_0x13708a(0xfd)](_0x13708a(0x11a),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x13708a(0x120),'pending']}}});if(_0x1b8bf0['length']>0x0)throw new AppError_1['default']('Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos');await(0x0,DeleteBaileysService_1['default'])(_0x10e271),await(0x0,DeleteWhatsAppService_1[_0x13708a(0xf0)])(_0x10e271),await cache_1[_0x13708a(0x11c)][_0x13708a(0x119)](_0x13708a(0xf8)+_0x10e271+':*'),(0x0,wbot_1['removeWbot'])(+_0x10e271),_0x12948c[_0x13708a(0x10e)]('company-'+_0x555d6d+_0x13708a(0x108),{'action':_0x13708a(0x116),'whatsappId':+_0x10e271});}if(_0x405d07[_0x13708a(0xf7)]==='facebook'||_0x405d07[_0x13708a(0xf7)]===_0x13708a(0x106)){const {facebookUserToken:_0xa7cbf3}=_0x405d07,_0x5dd3b1=await Whatsapp_1[_0x13708a(0xf0)]['findAll']({'where':{'facebookUserToken':_0xa7cbf3}});await Whatsapp_1[_0x13708a(0xf0)][_0x13708a(0x104)]({'where':{'facebookUserToken':_0xa7cbf3}}),_0x5dd3b1[_0x13708a(0x128)](_0x5b8ac2=>{const _0x230736=_0x13708a;_0x12948c[_0x230736(0x10e)](_0x230736(0xf9)+_0x555d6d+_0x230736(0x108),{'action':'delete','whatsappId':_0x5b8ac2['id']});});}return _0x2c3765[_0x13708a(0x113)](0xc8)['json']({'message':_0x13708a(0x10b)});};exports[a45_0x28a915(0xf3)]=remove;