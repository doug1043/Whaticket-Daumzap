const a45_0x53c880=a45_0x805d;function a45_0x51ad(){const _0x1ffba1=['sequelize','398768puYIeS','../services/WbotServices/StartWhatsAppSession','index','StartWhatsAppSession','remove','search','channel','getIO','destroy','status','show','-whatsapp','query','(((.+)+)+)+$','body','delFromPattern','default','instagram','__esModule','emit','Session\x20disconnected.','1356236UkWIIo','1531626NsPUlW','../services/BaileysServices/DeleteBaileysService','2575910iDGZNb','../libs/wbot','../services/WhatsappService/UpdateWhatsAppService','store','company-','3851588SpgmXR','constructor','json','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','findAll','params','sessions:','toString','9NTZTCD','forEach','2180696jqPMqX','update','6CeltDZ','../libs/socket','tickets','defineProperty','user','pending','whatsapp','apply','length','15351090TQBLDK','2gDgbAT','delete'];a45_0x51ad=function(){return _0x1ffba1;};return a45_0x51ad();}(function(_0x378965,_0x464321){const _0xf57dbc=a45_0x805d,_0x4e9f48=_0x378965();while(!![]){try{const _0x51eb2a=-parseInt(_0xf57dbc(0x17b))/0x1+-parseInt(_0xf57dbc(0x178))/0x2*(-parseInt(_0xf57dbc(0x15b))/0x3)+parseInt(_0xf57dbc(0x162))/0x4+parseInt(_0xf57dbc(0x15d))/0x5*(parseInt(_0xf57dbc(0x16e))/0x6)+parseInt(_0xf57dbc(0x15a))/0x7+parseInt(_0xf57dbc(0x16c))/0x8*(parseInt(_0xf57dbc(0x16a))/0x9)+-parseInt(_0xf57dbc(0x177))/0xa;if(_0x51eb2a===_0x464321)break;else _0x4e9f48['push'](_0x4e9f48['shift']());}catch(_0x596cb8){_0x4e9f48['push'](_0x4e9f48['shift']());}}}(a45_0x51ad,0x7f377));const a45_0x581725=(function(){let _0x2eb97a=!![];return function(_0x2f9184,_0x33bed0){const _0x2d70ac=_0x2eb97a?function(){const _0x10bf0d=a45_0x805d;if(_0x33bed0){const _0x2fe5d4=_0x33bed0[_0x10bf0d(0x175)](_0x2f9184,arguments);return _0x33bed0=null,_0x2fe5d4;}}:function(){};return _0x2eb97a=![],_0x2d70ac;};}()),a45_0x5bc0a5=a45_0x581725(this,function(){const _0x3947b6=a45_0x805d;return a45_0x5bc0a5['toString']()[_0x3947b6(0x180)](_0x3947b6(0x152))[_0x3947b6(0x169)]()[_0x3947b6(0x163)](a45_0x5bc0a5)[_0x3947b6(0x180)](_0x3947b6(0x152));});a45_0x5bc0a5();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x121990){const _0xb03c97=a45_0x805d;return _0x121990&&_0x121990[_0xb03c97(0x157)]?_0x121990:{'default':_0x121990};};Object[a45_0x53c880(0x171)](exports,'__esModule',{'value':!![]}),exports['remove']=exports[a45_0x53c880(0x16d)]=exports[a45_0x53c880(0x185)]=exports['store']=exports[a45_0x53c880(0x17d)]=void 0x0;const sequelize_1=require(a45_0x53c880(0x17a)),cache_1=require('../libs/cache'),socket_1=require(a45_0x53c880(0x16f)),wbot_1=require(a45_0x53c880(0x15e)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),DeleteBaileysService_1=__importDefault(require(a45_0x53c880(0x15c))),StartWhatsAppSession_1=require(a45_0x53c880(0x17c)),CreateWhatsAppService_1=__importDefault(require('../services/WhatsappService/CreateWhatsAppService')),DeleteWhatsAppService_1=__importDefault(require('../services/WhatsappService/DeleteWhatsAppService')),ListWhatsAppsService_1=__importDefault(require('../services/WhatsappService/ListWhatsAppsService')),ShowWhatsAppService_1=__importDefault(require('../services/WhatsappService/ShowWhatsAppService')),UpdateWhatsAppService_1=__importDefault(require(a45_0x53c880(0x15f))),AppError_1=__importDefault(require('../errors/AppError')),index=async(_0x2a5056,_0x34bbd9)=>{const _0x2f7ec3=a45_0x53c880,{companyId:_0xa63ec3}=_0x2a5056[_0x2f7ec3(0x172)],{session:_0x43ae30}=_0x2a5056['query'],_0x21bb75=await(0x0,ListWhatsAppsService_1['default'])({'companyId':_0xa63ec3,'session':_0x43ae30});return _0x34bbd9[_0x2f7ec3(0x184)](0xc8)['json'](_0x21bb75);};exports[a45_0x53c880(0x17d)]=index;const store=async(_0x4d43e9,_0x4e665f)=>{const _0xe5a0d0=a45_0x53c880,{name:_0x1a8964,status:_0x229afb,isDefault:_0x2e8d8a,greetingMessage:_0x23bec8,complationMessage:_0x41b5d2,outOfHoursMessage:_0x4997f5,allowGroup:_0x556880,timeSendQueue:_0x5159d0,sendIdQueue:_0x18aa0e,ratingMessage:_0x51f98f,transferMessage:_0x2389e1,queueIds:_0x1d593d,token:_0x45bfdf,maxUseBotQueues:_0x3ad4b5,expiresTicket:_0x4185bf,expiresInactiveMessage:_0x3d8d70,importOldMessages:_0x1328a4,schedules:_0x238d50}=_0x4d43e9[_0xe5a0d0(0x153)],{companyId:_0x27618e}=_0x4d43e9[_0xe5a0d0(0x172)],{whatsapp:_0x16d791,oldDefaultWhatsapp:_0x22bcb0}=await(0x0,CreateWhatsAppService_1[_0xe5a0d0(0x155)])({'name':_0x1a8964,'status':_0x229afb,'isDefault':_0x2e8d8a,'greetingMessage':_0x23bec8,'complationMessage':_0x41b5d2,'outOfHoursMessage':_0x4997f5,'ratingMessage':_0x51f98f,'transferMessage':_0x2389e1,'queueIds':_0x1d593d,'companyId':_0x27618e,'token':_0x45bfdf,'maxUseBotQueues':_0x3ad4b5,'timeSendQueue':_0x5159d0,'sendIdQueue':_0x18aa0e,'expiresTicket':_0x4185bf,'expiresInactiveMessage':_0x3d8d70,'allowGroup':_0x556880,'importOldMessages':_0x1328a4,'schedules':_0x238d50});(0x0,StartWhatsAppSession_1[_0xe5a0d0(0x17e)])(_0x16d791,_0x27618e);const _0x40f872=(0x0,socket_1['getIO'])();return _0x40f872[_0xe5a0d0(0x158)](_0xe5a0d0(0x161)+_0x27618e+'-whatsapp',{'action':_0xe5a0d0(0x16d),'whatsapp':_0x16d791}),_0x22bcb0&&_0x40f872[_0xe5a0d0(0x158)](_0xe5a0d0(0x161)+_0x27618e+_0xe5a0d0(0x150),{'action':_0xe5a0d0(0x16d),'whatsapp':_0x22bcb0}),_0x4e665f['status'](0xc8)['json'](_0x16d791);};exports[a45_0x53c880(0x160)]=store;const show=async(_0xbdfb6b,_0x1d697c)=>{const _0x52f845=a45_0x53c880,{whatsappId:_0x2df41c}=_0xbdfb6b['params'],{companyId:_0x45b81b}=_0xbdfb6b[_0x52f845(0x172)],{session:_0x41f7ed}=_0xbdfb6b[_0x52f845(0x151)],_0x1545dd=await(0x0,ShowWhatsAppService_1[_0x52f845(0x155)])(_0x2df41c,_0x45b81b,_0x41f7ed);return _0x1d697c[_0x52f845(0x184)](0xc8)['json'](_0x1545dd);};function a45_0x805d(_0x15df39,_0x49ba3d){const _0x37196b=a45_0x51ad();return a45_0x805d=function(_0x5bc0a5,_0x581725){_0x5bc0a5=_0x5bc0a5-0x150;let _0x51ad2f=_0x37196b[_0x5bc0a5];return _0x51ad2f;},a45_0x805d(_0x15df39,_0x49ba3d);}exports['show']=show;const update=async(_0x11d467,_0x15a8da)=>{const _0x5cab7c=a45_0x53c880,{whatsappId:_0x479456}=_0x11d467['params'],_0x47da05=_0x11d467['body'],{companyId:_0x553c30}=_0x11d467[_0x5cab7c(0x172)],{whatsapp:_0x32ecc5,oldDefaultWhatsapp:_0x3c1a26}=await(0x0,UpdateWhatsAppService_1[_0x5cab7c(0x155)])({'whatsappData':_0x47da05,'whatsappId':_0x479456,'companyId':_0x553c30}),_0x395753=(0x0,socket_1[_0x5cab7c(0x182)])();return _0x395753[_0x5cab7c(0x158)](_0x5cab7c(0x161)+_0x553c30+_0x5cab7c(0x150),{'action':'update','whatsapp':_0x32ecc5}),_0x3c1a26&&_0x395753[_0x5cab7c(0x158)](_0x5cab7c(0x161)+_0x553c30+_0x5cab7c(0x150),{'action':_0x5cab7c(0x16d),'whatsapp':_0x3c1a26}),_0x15a8da[_0x5cab7c(0x184)](0xc8)[_0x5cab7c(0x164)](_0x32ecc5);};exports['update']=update;const remove=async(_0x18f46a,_0x47d69e)=>{const _0x254c0d=a45_0x53c880,{whatsappId:_0x23d2ba}=_0x18f46a[_0x254c0d(0x167)],{companyId:_0x580eb}=_0x18f46a['user'],_0x587fdf=(0x0,socket_1['getIO'])(),_0x494ffa=await(0x0,ShowWhatsAppService_1[_0x254c0d(0x155)])(_0x23d2ba,_0x580eb);if(_0x494ffa['channel']===_0x254c0d(0x174)){const _0x183d48=await _0x494ffa['$get'](_0x254c0d(0x170),{'where':{'status':{[sequelize_1['Op']['or']]:['open',_0x254c0d(0x173)]}}});if(_0x183d48[_0x254c0d(0x176)]>0x0)throw new AppError_1[(_0x254c0d(0x155))](_0x254c0d(0x165));await(0x0,DeleteBaileysService_1[_0x254c0d(0x155)])(_0x23d2ba),await(0x0,DeleteWhatsAppService_1[_0x254c0d(0x155)])(_0x23d2ba),await cache_1['cacheLayer'][_0x254c0d(0x154)](_0x254c0d(0x168)+_0x23d2ba+':*'),(0x0,wbot_1['removeWbot'])(+_0x23d2ba),_0x587fdf[_0x254c0d(0x158)]('company-'+_0x580eb+_0x254c0d(0x150),{'action':_0x254c0d(0x179),'whatsappId':+_0x23d2ba});}if(_0x494ffa[_0x254c0d(0x181)]==='facebook'||_0x494ffa[_0x254c0d(0x181)]===_0x254c0d(0x156)){const {facebookUserToken:_0x754078}=_0x494ffa,_0x12d7e7=await Whatsapp_1[_0x254c0d(0x155)][_0x254c0d(0x166)]({'where':{'facebookUserToken':_0x754078}});await Whatsapp_1[_0x254c0d(0x155)][_0x254c0d(0x183)]({'where':{'facebookUserToken':_0x754078}}),_0x12d7e7[_0x254c0d(0x16b)](_0x36bafd=>{const _0x3fd60e=_0x254c0d;_0x587fdf['emit'](_0x3fd60e(0x161)+_0x580eb+'-whatsapp',{'action':_0x3fd60e(0x179),'whatsappId':_0x36bafd['id']});});}return _0x47d69e[_0x254c0d(0x184)](0xc8)[_0x254c0d(0x164)]({'message':_0x254c0d(0x159)});};exports[a45_0x53c880(0x17f)]=remove;