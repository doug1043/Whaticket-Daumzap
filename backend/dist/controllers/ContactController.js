'use strict';const a13_0x323ac2=a13_0x16b5;(function(_0x4161b6,_0x4f7d1f){const _0x1a95ef=a13_0x16b5,_0x2a40ce=_0x4161b6();while(!![]){try{const _0x385a92=-parseInt(_0x1a95ef(0x148))/0x1+parseInt(_0x1a95ef(0x165))/0x2+-parseInt(_0x1a95ef(0x120))/0x3*(parseInt(_0x1a95ef(0x15d))/0x4)+-parseInt(_0x1a95ef(0x169))/0x5*(-parseInt(_0x1a95ef(0x128))/0x6)+-parseInt(_0x1a95ef(0x155))/0x7*(parseInt(_0x1a95ef(0x132))/0x8)+parseInt(_0x1a95ef(0x171))/0x9*(-parseInt(_0x1a95ef(0x13e))/0xa)+-parseInt(_0x1a95ef(0x16d))/0xb*(-parseInt(_0x1a95ef(0x11c))/0xc);if(_0x385a92===_0x4f7d1f)break;else _0x2a40ce['push'](_0x2a40ce['shift']());}catch(_0x2b7397){_0x2a40ce['push'](_0x2a40ce['shift']());}}}(a13_0x30e3,0xc8b3f));var __createBinding=this&&this['__createBinding']||(Object[a13_0x323ac2(0x141)]?function(_0x35e3cb,_0x18637a,_0x402218,_0x327d56){const _0x2320c8=a13_0x323ac2;if(_0x327d56===undefined)_0x327d56=_0x402218;var _0x541613=Object[_0x2320c8(0x116)](_0x18637a,_0x402218);(!_0x541613||('get'in _0x541613?!_0x18637a[_0x2320c8(0x158)]:_0x541613['writable']||_0x541613['configurable']))&&(_0x541613={'enumerable':!![],'get':function(){return _0x18637a[_0x402218];}}),Object['defineProperty'](_0x35e3cb,_0x327d56,_0x541613);}:function(_0x564e28,_0x2ff645,_0x41c192,_0x592068){if(_0x592068===undefined)_0x592068=_0x41c192;_0x564e28[_0x592068]=_0x2ff645[_0x41c192];}),__setModuleDefault=this&&this[a13_0x323ac2(0x112)]||(Object[a13_0x323ac2(0x141)]?function(_0x2b4d76,_0x133273){const _0x528c93=a13_0x323ac2;Object[_0x528c93(0x143)](_0x2b4d76,_0x528c93(0x174),{'enumerable':!![],'value':_0x133273});}:function(_0x419578,_0x1a69c8){const _0x394cd4=a13_0x323ac2;_0x419578[_0x394cd4(0x174)]=_0x1a69c8;}),__importStar=this&&this[a13_0x323ac2(0x14b)]||(function(){const _0x31b3c4=(function(){let _0x4cd2ef=!![];return function(_0x27bc65,_0x4cb858){const _0xc9ad7b=_0x4cd2ef?function(){const _0xace66d=a13_0x16b5;if(_0x4cb858){const _0x9b1921=_0x4cb858[_0xace66d(0x11b)](_0x27bc65,arguments);return _0x4cb858=null,_0x9b1921;}}:function(){};return _0x4cd2ef=![],_0xc9ad7b;};}()),_0x1b936b=_0x31b3c4(this,function(){const _0x20e12f=a13_0x16b5;return _0x1b936b[_0x20e12f(0x129)]()['search'](_0x20e12f(0x15a))['toString']()[_0x20e12f(0x14a)](_0x1b936b)[_0x20e12f(0x175)](_0x20e12f(0x15a));});_0x1b936b();var _0x5f146b=function(_0x20d0f4){const _0x58b61e=a13_0x16b5;return _0x5f146b=Object[_0x58b61e(0x131)]||function(_0x249b76){const _0x259c74=_0x58b61e;var _0x51a887=[];for(var _0x119f48 in _0x249b76)if(Object[_0x259c74(0x16c)]['hasOwnProperty'][_0x259c74(0x135)](_0x249b76,_0x119f48))_0x51a887[_0x51a887['length']]=_0x119f48;return _0x51a887;},_0x5f146b(_0x20d0f4);};return function(_0x33020a){const _0x4ed171=a13_0x16b5;if(_0x33020a&&_0x33020a['__esModule'])return _0x33020a;var _0x4fc909={};if(_0x33020a!=null){for(var _0x35de89=_0x5f146b(_0x33020a),_0x712915=0x0;_0x712915<_0x35de89[_0x4ed171(0x176)];_0x712915++)if(_0x35de89[_0x712915]!==_0x4ed171(0x174))__createBinding(_0x4fc909,_0x33020a,_0x35de89[_0x712915]);}return __setModuleDefault(_0x4fc909,_0x33020a),_0x4fc909;};}()),__importDefault=this&&this[a13_0x323ac2(0x144)]||function(_0xc87395){const _0x365aa2=a13_0x323ac2;return _0xc87395&&_0xc87395[_0x365aa2(0x158)]?_0xc87395:{'default':_0xc87395};};Object[a13_0x323ac2(0x143)](exports,'__esModule',{'value':!![]}),exports[a13_0x323ac2(0x150)]=exports['importCsv']=exports[a13_0x323ac2(0x15b)]=exports[a13_0x323ac2(0x11f)]=exports[a13_0x323ac2(0x170)]=exports[a13_0x323ac2(0x163)]=exports[a13_0x323ac2(0x137)]=exports['getContact']=exports[a13_0x323ac2(0x121)]=void 0x0;const Yup=__importStar(require('yup')),csv_1=require(a13_0x323ac2(0x166)),fs_1=__importDefault(require('fs')),socket_1=require(a13_0x323ac2(0x133)),ListContactsService_1=__importDefault(require(a13_0x323ac2(0x161))),CreateContactService_1=__importDefault(require(a13_0x323ac2(0x14d))),ShowContactService_1=__importDefault(require('../services/ContactServices/ShowContactService')),UpdateContactService_1=__importDefault(require(a13_0x323ac2(0x149))),DeleteContactService_1=__importDefault(require(a13_0x323ac2(0x15c))),GetContactService_1=__importDefault(require(a13_0x323ac2(0x114))),CheckNumber_1=__importDefault(require(a13_0x323ac2(0x157))),AppError_1=__importDefault(require('../errors/AppError')),SimpleListService_1=__importDefault(require(a13_0x323ac2(0x13a))),ContactCustomField_1=__importDefault(require(a13_0x323ac2(0x16f))),logger_1=require(a13_0x323ac2(0x153)),Contact_1=__importDefault(require(a13_0x323ac2(0x147))),index=async(_0x45b069,_0x15ce6e)=>{const _0x1afc8f=a13_0x323ac2,{searchParam:_0x51a6a7,pageNumber:_0x4c7f8f}=_0x45b069[_0x1afc8f(0x13c)],{companyId:_0x37113e}=_0x45b069[_0x1afc8f(0x14c)],{contacts:_0x4f9365,count:_0x27c41c,hasMore:_0x4cc59b}=await(0x0,ListContactsService_1[_0x1afc8f(0x174)])({'searchParam':_0x51a6a7,'pageNumber':_0x4c7f8f,'companyId':_0x37113e});return _0x15ce6e['json']({'contacts':_0x4f9365,'count':_0x27c41c,'hasMore':_0x4cc59b});};exports[a13_0x323ac2(0x121)]=index;const getContact=async(_0x444440,_0x2f3404)=>{const _0x375b0a=a13_0x323ac2,{name:_0x157443,number:_0x1ce96c}=_0x444440[_0x375b0a(0x15e)],{companyId:_0x2abd64}=_0x444440[_0x375b0a(0x14c)],_0x4d365f=await(0x0,GetContactService_1['default'])({'name':_0x157443,'number':_0x1ce96c,'companyId':_0x2abd64});return _0x2f3404[_0x375b0a(0x11a)](0xc8)[_0x375b0a(0x12f)](_0x4d365f);};exports[a13_0x323ac2(0x146)]=getContact;const store=async(_0x22f82a,_0x5b7208)=>{const _0x5d0e65=a13_0x323ac2,{companyId:_0xc1cb62}=_0x22f82a[_0x5d0e65(0x14c)],_0x48b5d1=_0x22f82a[_0x5d0e65(0x15e)];_0x48b5d1[_0x5d0e65(0x14f)]=_0x48b5d1[_0x5d0e65(0x14f)]['replace']('-','')[_0x5d0e65(0x13d)]('\x20','');const _0xf17d4a=Yup[_0x5d0e65(0x152)]()[_0x5d0e65(0x126)]({'name':Yup[_0x5d0e65(0x123)]()[_0x5d0e65(0x167)](),'number':Yup['string']()['required']()[_0x5d0e65(0x125)](/^\d+$/,_0x5d0e65(0x111))});try{await _0xf17d4a['validate'](_0x48b5d1);}catch(_0x2c8e17){throw new AppError_1[(_0x5d0e65(0x174))](_0x2c8e17[_0x5d0e65(0x13f)]);}if(!_0x48b5d1[_0x5d0e65(0x136)]){const _0xec790d=await(0x0,CheckNumber_1['default'])(_0x48b5d1['number'],_0xc1cb62),_0x13d382=_0xec790d[_0x5d0e65(0x159)][_0x5d0e65(0x13d)](/\D/g,'');_0x48b5d1['number']=_0x13d382;}const _0x2269f1=await(0x0,CreateContactService_1[_0x5d0e65(0x174)])({..._0x48b5d1,'companyId':_0xc1cb62}),_0x5694ec=(0x0,socket_1['getIO'])();return _0x5694ec['to'](_0x5d0e65(0x172)+_0xc1cb62+_0x5d0e65(0x160))[_0x5d0e65(0x118)](_0x5d0e65(0x172)+_0xc1cb62+_0x5d0e65(0x119),{'action':_0x5d0e65(0x141),'contact':_0x2269f1}),_0x5b7208['status'](0xc8)[_0x5d0e65(0x12f)](_0x2269f1);};exports['store']=store;const show=async(_0x324aa8,_0x43239f)=>{const _0x50dffd=a13_0x323ac2,{contactId:_0x33f5c3}=_0x324aa8['params'],{companyId:_0x7f8089}=_0x324aa8['user'],_0x40d557=await(0x0,ShowContactService_1[_0x50dffd(0x174)])(_0x33f5c3,_0x7f8089);return _0x43239f[_0x50dffd(0x11a)](0xc8)['json'](_0x40d557);};exports[a13_0x323ac2(0x163)]=show;const update=async(_0x1f521c,_0x46c020)=>{const _0x4c4ce5=a13_0x323ac2,_0x2f9763=_0x1f521c[_0x4c4ce5(0x15e)],{companyId:_0x33ae91}=_0x1f521c['user'],_0x48f67e=Yup[_0x4c4ce5(0x152)]()['shape']({'name':Yup[_0x4c4ce5(0x123)](),'number':Yup['string']()[_0x4c4ce5(0x125)](/^\d+$/,_0x4c4ce5(0x111))});try{await _0x48f67e[_0x4c4ce5(0x142)](_0x2f9763);}catch(_0x4db0b4){throw new AppError_1[(_0x4c4ce5(0x174))](_0x4db0b4['message']);}if(!_0x2f9763[_0x4c4ce5(0x136)]){const _0x3d58e6=await(0x0,CheckNumber_1[_0x4c4ce5(0x174)])(_0x2f9763[_0x4c4ce5(0x14f)],_0x33ae91),_0x56295e=_0x3d58e6[_0x4c4ce5(0x159)][_0x4c4ce5(0x13d)](/\D/g,'');_0x2f9763[_0x4c4ce5(0x14f)]=_0x56295e;}const {contactId:_0x303ac6}=_0x1f521c[_0x4c4ce5(0x124)],_0x3f88e0=await(0x0,UpdateContactService_1[_0x4c4ce5(0x174)])({'contactData':_0x2f9763,'contactId':_0x303ac6,'companyId':_0x33ae91}),_0x2b28b3=(0x0,socket_1[_0x4c4ce5(0x138)])();return _0x2b28b3['to']('company-'+_0x33ae91+_0x4c4ce5(0x160))[_0x4c4ce5(0x118)](_0x4c4ce5(0x172)+_0x33ae91+_0x4c4ce5(0x119),{'action':_0x4c4ce5(0x170),'contact':_0x3f88e0}),_0x46c020[_0x4c4ce5(0x11a)](0xc8)[_0x4c4ce5(0x12f)](_0x3f88e0);};exports[a13_0x323ac2(0x170)]=update;const remove=async(_0x4ff9c9,_0x24e24c)=>{const _0x387483=a13_0x323ac2,{contactId:_0x24aadc}=_0x4ff9c9[_0x387483(0x124)],{companyId:_0x34eed9}=_0x4ff9c9['user'];await(0x0,ShowContactService_1[_0x387483(0x174)])(_0x24aadc,_0x34eed9),await(0x0,DeleteContactService_1['default'])(_0x24aadc);const _0x24e36c=(0x0,socket_1[_0x387483(0x138)])();return _0x24e36c['to'](_0x387483(0x172)+_0x34eed9+_0x387483(0x160))[_0x387483(0x118)](_0x387483(0x172)+_0x34eed9+'-contact',{'action':_0x387483(0x115),'contactId':_0x24aadc}),_0x24e24c['status'](0xc8)[_0x387483(0x12f)]({'message':_0x387483(0x12e)});};exports['remove']=remove;function a13_0x30e3(){const _0x15a852=['update','1206lcUiyi','company-','unlinkSync','default','search','length','whatsapp','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','__setModuleDefault','set','../services/ContactServices/GetContactService','delete','getOwnPropertyDescriptor','push','emit','-contact','status','apply','2292rFSPvo','forEach','map','remove','46338ZjROZL','index','send','string','params','matches','shape','Contacts\x20being\x20imported','234678BIGdPH','toString','error','extraInfo','attachment;\x20filename=contacts.csv','importCsv','Contact\x20deleted','json','Name','getOwnPropertyNames','3608MxhaQL','../libs/socket','setHeader','call','isGroup','store','getIO','ExtraInfo','../services/ContactServices/SimpleListService','email','query','replace','82370TczsDA','message','createReadStream','create','validate','defineProperty','__importDefault','Number','getContact','../models/Contact','1021063RXGAfY','../services/ContactServices/UpdateContactService','constructor','__importStar','user','../services/ContactServices/CreateContactService','path','number','exportCsv','Email','object','../utils/logger','pipe','8778Ybpisd','Content-Type','../services/WbotServices/CheckNumber','__esModule','jid','(((.+)+)+)+$','list','../services/ContactServices/DeleteContactService','292bQrhGo','body','stringify','-mainchannel','../services/ContactServices/ListContactsService','logger','show','Error\x20creating\x20contact:\x20','2958496wuCkCQ','csv','required','parse','125FcjYed','name','text/csv','prototype','125719zgsAlr','ERR_GENERATING_CSV','../models/ContactCustomField'];a13_0x30e3=function(){return _0x15a852;};return a13_0x30e3();}function a13_0x16b5(_0x1bb81c,_0x410072){const _0x38ddcb=a13_0x30e3();return a13_0x16b5=function(_0x518830,_0x106811){_0x518830=_0x518830-0x111;let _0x30e363=_0x38ddcb[_0x518830];return _0x30e363;},a13_0x16b5(_0x1bb81c,_0x410072);}const list=async(_0x112532,_0x21f43b)=>{const _0x45daaf=a13_0x323ac2,{name:_0x2be66b}=_0x112532[_0x45daaf(0x13c)],{companyId:_0x10e2d5}=_0x112532['user'],_0x28e558=await(0x0,SimpleListService_1[_0x45daaf(0x174)])({'name':_0x2be66b,'companyId':_0x10e2d5});return _0x21f43b[_0x45daaf(0x12f)](_0x28e558);};exports[a13_0x323ac2(0x15b)]=list;const importCsv=async(_0x4a3b3a,_0x40e943)=>{const _0x44933f=a13_0x323ac2,{companyId:_0x1fbbee}=_0x4a3b3a[_0x44933f(0x14c)],{file:_0x308515}=_0x4a3b3a;if(!_0x308515)throw new AppError_1[(_0x44933f(0x174))]('ERR_NO_FILE',0x190);const _0xd81a8d=(0x0,csv_1['parse'])({'delimiter':',','columns':!![]},async(_0x322999,_0x14d3d7)=>{const _0x418795=_0x44933f;if(_0x322999)throw new AppError_1[(_0x418795(0x174))]('ERR_INVALID_CSV',0x190);_0x14d3d7[_0x418795(0x11d)](async _0x2412ba=>{const _0x88d9ee=_0x418795;let _0x51d0f4;try{_0x51d0f4=JSON[_0x88d9ee(0x168)](_0x2412ba[_0x88d9ee(0x139)]);}catch(_0x2e652d){_0x51d0f4=[];}const _0x26a7b8={'companyId':_0x1fbbee,'name':_0x2412ba[_0x88d9ee(0x16a)]||_0x2412ba[_0x88d9ee(0x130)],'number':_0x2412ba[_0x88d9ee(0x14f)]||_0x2412ba['Number'],'email':_0x2412ba[_0x88d9ee(0x13b)]||_0x2412ba[_0x88d9ee(0x151)],'extraInfo':_0x51d0f4};Object['keys'](_0x2412ba)['forEach'](_0x2f79d7=>{const _0xa10af3=_0x88d9ee;_0x2f79d7!==_0xa10af3(0x16a)&&_0x2f79d7!==_0xa10af3(0x14f)&&_0x2f79d7!==_0xa10af3(0x13b)&&_0x2f79d7!==_0xa10af3(0x130)&&_0x2f79d7!==_0xa10af3(0x145)&&_0x2f79d7!==_0xa10af3(0x151)&&_0x2f79d7!==_0xa10af3(0x139)&&_0x2412ba[_0x2f79d7]&&_0x26a7b8[_0xa10af3(0x12b)][_0xa10af3(0x117)]({'name':_0x2f79d7,'value':_0x2412ba[_0x2f79d7]});});try{const _0x536c1b=await(0x0,CreateContactService_1['default'])(_0x26a7b8),_0xf55728=(0x0,socket_1['getIO'])();_0xf55728['to'](_0x88d9ee(0x172)+_0x1fbbee+_0x88d9ee(0x160))[_0x88d9ee(0x118)](_0x88d9ee(0x172)+_0x1fbbee+_0x88d9ee(0x119),{'action':'update','contact':_0x536c1b});}catch(_0x537f87){logger_1[_0x88d9ee(0x162)][_0x88d9ee(0x12a)]({'contact':_0x26a7b8},_0x88d9ee(0x164)+_0x537f87['message']);}});}),_0x2ae37f=fs_1[_0x44933f(0x174)][_0x44933f(0x140)](_0x308515[_0x44933f(0x14e)]);return _0xd81a8d['on']('end',()=>{const _0x311e01=_0x44933f;_0x2ae37f['destroy'](),fs_1[_0x311e01(0x174)][_0x311e01(0x173)](_0x308515[_0x311e01(0x14e)]);}),_0x2ae37f[_0x44933f(0x154)](_0xd81a8d),_0x40e943[_0x44933f(0x11a)](0xc8)[_0x44933f(0x12f)]({'message':_0x44933f(0x127)});};exports[a13_0x323ac2(0x12d)]=importCsv;const exportCsv=async(_0x1b5d75,_0x532da9)=>{const _0x1e3403=a13_0x323ac2,{companyId:_0x21b7eb}=_0x1b5d75[_0x1e3403(0x14c)],_0xc6e868=await Contact_1[_0x1e3403(0x174)]['findAll']({'where':{'companyId':_0x21b7eb,'channel':_0x1e3403(0x177),'isGroup':![]},'include':[{'model':ContactCustomField_1[_0x1e3403(0x174)],'as':_0x1e3403(0x12b)}]}),_0x11e025=_0xc6e868[_0x1e3403(0x11e)](_0x5b8d7a=>{const _0x237858=_0x1e3403,_0x264d84=_0x5b8d7a[_0x237858(0x12b)][_0x237858(0x11e)](_0x4bff7a=>({'name':_0x4bff7a[_0x237858(0x16a)],'value':_0x4bff7a['value']}));return{'Name':_0x5b8d7a['name'],'Number':_0x5b8d7a[_0x237858(0x14f)],'Email':_0x5b8d7a[_0x237858(0x13b)]||'','ExtraInfo':JSON[_0x237858(0x15f)](_0x264d84)};});return(0x0,csv_1[_0x1e3403(0x15f)])(_0x11e025,{'header':!![]},(_0x49c728,_0x4cf6fe)=>{const _0x333de7=_0x1e3403;if(_0x49c728)throw new AppError_1[(_0x333de7(0x174))](_0x333de7(0x16e),0x1f4);_0x532da9[_0x333de7(0x134)]('Content-disposition',_0x333de7(0x12c)),_0x532da9[_0x333de7(0x113)](_0x333de7(0x156),_0x333de7(0x16b)),_0x532da9['status'](0xc8)[_0x333de7(0x122)](_0x4cf6fe);}),_0x532da9;};exports[a13_0x323ac2(0x150)]=exportCsv;