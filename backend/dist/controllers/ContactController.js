'use strict';const a13_0x4e90fe=a13_0x3dac;function a13_0x3dac(_0x32e103,_0x5e9706){const _0xd382b7=a13_0x3185();return a13_0x3dac=function(_0x22af5d,_0x2e6447){_0x22af5d=_0x22af5d-0x183;let _0x31850e=_0xd382b7[_0x22af5d];return _0x31850e;},a13_0x3dac(_0x32e103,_0x5e9706);}(function(_0x3296e0,_0x5a782b){const _0x1d4efb=a13_0x3dac,_0x4e616c=_0x3296e0();while(!![]){try{const _0x192930=-parseInt(_0x1d4efb(0x1b2))/0x1*(-parseInt(_0x1d4efb(0x1d8))/0x2)+-parseInt(_0x1d4efb(0x1be))/0x3+-parseInt(_0x1d4efb(0x1b4))/0x4*(parseInt(_0x1d4efb(0x1d3))/0x5)+-parseInt(_0x1d4efb(0x183))/0x6*(parseInt(_0x1d4efb(0x1db))/0x7)+parseInt(_0x1d4efb(0x198))/0x8+-parseInt(_0x1d4efb(0x1ac))/0x9*(-parseInt(_0x1d4efb(0x1b9))/0xa)+parseInt(_0x1d4efb(0x1d6))/0xb;if(_0x192930===_0x5a782b)break;else _0x4e616c['push'](_0x4e616c['shift']());}catch(_0x1e3d05){_0x4e616c['push'](_0x4e616c['shift']());}}}(a13_0x3185,0xac26f));var __createBinding=this&&this['__createBinding']||(Object[a13_0x4e90fe(0x1bb)]?function(_0xd40acf,_0x47f95e,_0x161c04,_0x1ba7e6){const _0x420fc=a13_0x4e90fe;if(_0x1ba7e6===undefined)_0x1ba7e6=_0x161c04;var _0x63a3d9=Object['getOwnPropertyDescriptor'](_0x47f95e,_0x161c04);(!_0x63a3d9||(_0x420fc(0x1d5)in _0x63a3d9?!_0x47f95e[_0x420fc(0x1ce)]:_0x63a3d9[_0x420fc(0x1b7)]||_0x63a3d9[_0x420fc(0x1d2)]))&&(_0x63a3d9={'enumerable':!![],'get':function(){return _0x47f95e[_0x161c04];}}),Object[_0x420fc(0x1da)](_0xd40acf,_0x1ba7e6,_0x63a3d9);}:function(_0x5e37f5,_0x2ad300,_0x588862,_0x49afd5){if(_0x49afd5===undefined)_0x49afd5=_0x588862;_0x5e37f5[_0x49afd5]=_0x2ad300[_0x588862];}),__setModuleDefault=this&&this[a13_0x4e90fe(0x1a1)]||(Object[a13_0x4e90fe(0x1bb)]?function(_0x46582b,_0x503bef){const _0x58cf83=a13_0x4e90fe;Object[_0x58cf83(0x1da)](_0x46582b,_0x58cf83(0x19b),{'enumerable':!![],'value':_0x503bef});}:function(_0x1104e6,_0x48db0a){const _0x2c7906=a13_0x4e90fe;_0x1104e6[_0x2c7906(0x19b)]=_0x48db0a;}),__importStar=this&&this['__importStar']||(function(){const _0x2fbabe=(function(){let _0x22f85b=!![];return function(_0x32449b,_0x25fb64){const _0x3ebf52=_0x22f85b?function(){const _0x4d752a=a13_0x3dac;if(_0x25fb64){const _0xe7b0d=_0x25fb64[_0x4d752a(0x18d)](_0x32449b,arguments);return _0x25fb64=null,_0xe7b0d;}}:function(){};return _0x22f85b=![],_0x3ebf52;};}()),_0x2b8e15=_0x2fbabe(this,function(){const _0x370972=a13_0x3dac;return _0x2b8e15[_0x370972(0x1d0)]()[_0x370972(0x1a5)](_0x370972(0x1ab))[_0x370972(0x1d0)]()['constructor'](_0x2b8e15)[_0x370972(0x1a5)](_0x370972(0x1ab));});_0x2b8e15();var _0x82c040=function(_0x57a78a){const _0x539881=a13_0x3dac;return _0x82c040=Object[_0x539881(0x1bd)]||function(_0x54b0f4){const _0x5fabb4=_0x539881;var _0x2bcc80=[];for(var _0x9b212 in _0x54b0f4)if(Object[_0x5fabb4(0x18c)][_0x5fabb4(0x19e)][_0x5fabb4(0x1b5)](_0x54b0f4,_0x9b212))_0x2bcc80[_0x2bcc80[_0x5fabb4(0x1cb)]]=_0x9b212;return _0x2bcc80;},_0x82c040(_0x57a78a);};return function(_0x1d99d5){const _0x27dca8=a13_0x3dac;if(_0x1d99d5&&_0x1d99d5['__esModule'])return _0x1d99d5;var _0x4db959={};if(_0x1d99d5!=null){for(var _0xae0f37=_0x82c040(_0x1d99d5),_0x20c329=0x0;_0x20c329<_0xae0f37[_0x27dca8(0x1cb)];_0x20c329++)if(_0xae0f37[_0x20c329]!==_0x27dca8(0x19b))__createBinding(_0x4db959,_0x1d99d5,_0xae0f37[_0x20c329]);}return __setModuleDefault(_0x4db959,_0x1d99d5),_0x4db959;};}()),__importDefault=this&&this['__importDefault']||function(_0x3eb740){const _0x442644=a13_0x4e90fe;return _0x3eb740&&_0x3eb740[_0x442644(0x1ce)]?_0x3eb740:{'default':_0x3eb740};};Object[a13_0x4e90fe(0x1da)](exports,a13_0x4e90fe(0x1ce),{'value':!![]}),exports[a13_0x4e90fe(0x1bc)]=exports[a13_0x4e90fe(0x186)]=exports[a13_0x4e90fe(0x1c4)]=exports['remove']=exports[a13_0x4e90fe(0x199)]=exports[a13_0x4e90fe(0x1d9)]=exports[a13_0x4e90fe(0x197)]=exports[a13_0x4e90fe(0x18f)]=exports[a13_0x4e90fe(0x193)]=void 0x0;function a13_0x3185(){const _0x5d8623=['prototype','apply','user','getContact','Contacts\x20being\x20imported','Name','../utils/logger','index','isGroup','remove','message','store','2092928umVOUL','update','number','default','json','Error\x20creating\x20contact:\x20','hasOwnProperty','../services/ContactServices/ShowContactService','path','__setModuleDefault','ERR_NO_FILE','ExtraInfo','Content-disposition','search','string','replace','jid','-mainchannel','csv','(((.+)+)+)+$','3212244BiljES','query','extraInfo','findAll','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','ERR_GENERATING_CSV','23417VEoReK','Content-Type','396mWisyw','call','object','writable','parse','20mjGkgd','unlinkSync','create','exportCsv','getOwnPropertyNames','1060671mJktSn','matches','../services/ContactServices/GetContactService','map','text/csv','email','list','getIO','params','emit','value','yup','error','length','company-','end','__esModule','../models/ContactCustomField','toString','set','configurable','45895ODJCmr','body','get','497640UDZchj','validate','94qqBgeE','show','defineProperty','76937hAigWL','attachment;\x20filename=contacts.csv','Email','logger','84dnjkNe','status','../services/ContactServices/SimpleListService','importCsv','-contact','name','shape','stringify','send'];a13_0x3185=function(){return _0x5d8623;};return a13_0x3185();}const Yup=__importStar(require(a13_0x4e90fe(0x1c9))),csv_1=require(a13_0x4e90fe(0x1aa)),fs_1=__importDefault(require('fs')),socket_1=require('../libs/socket'),ListContactsService_1=__importDefault(require('../services/ContactServices/ListContactsService')),CreateContactService_1=__importDefault(require('../services/ContactServices/CreateContactService')),ShowContactService_1=__importDefault(require(a13_0x4e90fe(0x19f))),UpdateContactService_1=__importDefault(require('../services/ContactServices/UpdateContactService')),DeleteContactService_1=__importDefault(require('../services/ContactServices/DeleteContactService')),GetContactService_1=__importDefault(require(a13_0x4e90fe(0x1c0))),CheckNumber_1=__importDefault(require('../services/WbotServices/CheckNumber')),AppError_1=__importDefault(require('../errors/AppError')),SimpleListService_1=__importDefault(require(a13_0x4e90fe(0x185))),ContactCustomField_1=__importDefault(require(a13_0x4e90fe(0x1cf))),logger_1=require(a13_0x4e90fe(0x192)),Contact_1=__importDefault(require('../models/Contact')),index=async(_0x50f64f,_0x447e20)=>{const _0xd172cd=a13_0x4e90fe,{searchParam:_0x42f9f7,pageNumber:_0x1e7499}=_0x50f64f[_0xd172cd(0x1ad)],{companyId:_0x3d0eac}=_0x50f64f[_0xd172cd(0x18e)],{contacts:_0x45799e,count:_0x33ba6e,hasMore:_0x1e4e35}=await(0x0,ListContactsService_1[_0xd172cd(0x19b)])({'searchParam':_0x42f9f7,'pageNumber':_0x1e7499,'companyId':_0x3d0eac});return _0x447e20[_0xd172cd(0x19c)]({'contacts':_0x45799e,'count':_0x33ba6e,'hasMore':_0x1e4e35});};exports[a13_0x4e90fe(0x193)]=index;const getContact=async(_0x43cfc6,_0x334029)=>{const _0x5dad7a=a13_0x4e90fe,{name:_0x51d2b0,number:_0x98d2d3}=_0x43cfc6[_0x5dad7a(0x1d4)],{companyId:_0x1c3fb7}=_0x43cfc6[_0x5dad7a(0x18e)],_0x260957=await(0x0,GetContactService_1[_0x5dad7a(0x19b)])({'name':_0x51d2b0,'number':_0x98d2d3,'companyId':_0x1c3fb7});return _0x334029[_0x5dad7a(0x184)](0xc8)[_0x5dad7a(0x19c)](_0x260957);};exports['getContact']=getContact;const store=async(_0x1da09a,_0x4044c5)=>{const _0x596676=a13_0x4e90fe,{companyId:_0x14b089}=_0x1da09a['user'],_0x40a7d1=_0x1da09a[_0x596676(0x1d4)];_0x40a7d1[_0x596676(0x19a)]=_0x40a7d1[_0x596676(0x19a)][_0x596676(0x1a7)]('-','')[_0x596676(0x1a7)]('\x20','');const _0x4ee9fb=Yup[_0x596676(0x1b6)]()[_0x596676(0x189)]({'name':Yup[_0x596676(0x1a6)]()['required'](),'number':Yup[_0x596676(0x1a6)]()['required']()[_0x596676(0x1bf)](/^\d+$/,_0x596676(0x1b0))});try{await _0x4ee9fb[_0x596676(0x1d7)](_0x40a7d1);}catch(_0x41014d){throw new AppError_1[(_0x596676(0x19b))](_0x41014d['message']);}if(!_0x40a7d1[_0x596676(0x194)]){const _0x3018c3=await(0x0,CheckNumber_1[_0x596676(0x19b)])(_0x40a7d1[_0x596676(0x19a)],_0x14b089),_0x5956d0=_0x3018c3[_0x596676(0x1a8)][_0x596676(0x1a7)](/\D/g,'');_0x40a7d1[_0x596676(0x19a)]=_0x5956d0;}const _0x50035e=await(0x0,CreateContactService_1[_0x596676(0x19b)])({..._0x40a7d1,'companyId':_0x14b089}),_0x3f1ce5=(0x0,socket_1[_0x596676(0x1c5)])();return _0x3f1ce5['to'](_0x596676(0x1cc)+_0x14b089+_0x596676(0x1a9))[_0x596676(0x1c7)](_0x596676(0x1cc)+_0x14b089+_0x596676(0x187),{'action':_0x596676(0x1bb),'contact':_0x50035e}),_0x4044c5[_0x596676(0x184)](0xc8)[_0x596676(0x19c)](_0x50035e);};exports[a13_0x4e90fe(0x197)]=store;const show=async(_0x84ef96,_0x41dfb3)=>{const _0x296db0=a13_0x4e90fe,{contactId:_0x29bb99}=_0x84ef96[_0x296db0(0x1c6)],{companyId:_0x182670}=_0x84ef96[_0x296db0(0x18e)],_0x5d0cee=await(0x0,ShowContactService_1[_0x296db0(0x19b)])(_0x29bb99,_0x182670);return _0x41dfb3['status'](0xc8)[_0x296db0(0x19c)](_0x5d0cee);};exports[a13_0x4e90fe(0x1d9)]=show;const update=async(_0x379949,_0x2d119f)=>{const _0x5a3558=a13_0x4e90fe,_0x38b6db=_0x379949['body'],{companyId:_0x37938b}=_0x379949[_0x5a3558(0x18e)],_0x1a9184=Yup[_0x5a3558(0x1b6)]()[_0x5a3558(0x189)]({'name':Yup['string'](),'number':Yup[_0x5a3558(0x1a6)]()[_0x5a3558(0x1bf)](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0x1a9184[_0x5a3558(0x1d7)](_0x38b6db);}catch(_0x2ed0ed){throw new AppError_1[(_0x5a3558(0x19b))](_0x2ed0ed[_0x5a3558(0x196)]);}if(!_0x38b6db[_0x5a3558(0x194)]){const _0x4f13ee=await(0x0,CheckNumber_1[_0x5a3558(0x19b)])(_0x38b6db[_0x5a3558(0x19a)],_0x37938b),_0x34315b=_0x4f13ee[_0x5a3558(0x1a8)][_0x5a3558(0x1a7)](/\D/g,'');_0x38b6db['number']=_0x34315b;}const {contactId:_0x45afa3}=_0x379949['params'],_0x579bca=await(0x0,UpdateContactService_1[_0x5a3558(0x19b)])({'contactData':_0x38b6db,'contactId':_0x45afa3,'companyId':_0x37938b}),_0x465f23=(0x0,socket_1[_0x5a3558(0x1c5)])();return _0x465f23['to'](_0x5a3558(0x1cc)+_0x37938b+_0x5a3558(0x1a9))[_0x5a3558(0x1c7)](_0x5a3558(0x1cc)+_0x37938b+_0x5a3558(0x187),{'action':_0x5a3558(0x199),'contact':_0x579bca}),_0x2d119f[_0x5a3558(0x184)](0xc8)['json'](_0x579bca);};exports['update']=update;const remove=async(_0x4aeec4,_0x31b083)=>{const _0x5c2f02=a13_0x4e90fe,{contactId:_0x56b8ea}=_0x4aeec4['params'],{companyId:_0x124f46}=_0x4aeec4['user'];await(0x0,ShowContactService_1[_0x5c2f02(0x19b)])(_0x56b8ea,_0x124f46),await(0x0,DeleteContactService_1[_0x5c2f02(0x19b)])(_0x56b8ea);const _0x10a784=(0x0,socket_1[_0x5c2f02(0x1c5)])();return _0x10a784['to'](_0x5c2f02(0x1cc)+_0x124f46+_0x5c2f02(0x1a9))[_0x5c2f02(0x1c7)](_0x5c2f02(0x1cc)+_0x124f46+_0x5c2f02(0x187),{'action':'delete','contactId':_0x56b8ea}),_0x31b083[_0x5c2f02(0x184)](0xc8)[_0x5c2f02(0x19c)]({'message':'Contact\x20deleted'});};exports[a13_0x4e90fe(0x195)]=remove;const list=async(_0x47f353,_0x3ed791)=>{const _0x37c94f=a13_0x4e90fe,{name:_0x5cd36f}=_0x47f353[_0x37c94f(0x1ad)],{companyId:_0x1a979d}=_0x47f353['user'],_0x54e719=await(0x0,SimpleListService_1[_0x37c94f(0x19b)])({'name':_0x5cd36f,'companyId':_0x1a979d});return _0x3ed791['json'](_0x54e719);};exports[a13_0x4e90fe(0x1c4)]=list;const importCsv=async(_0x200700,_0x3bd5b5)=>{const _0x4e0018=a13_0x4e90fe,{companyId:_0x213bec}=_0x200700[_0x4e0018(0x18e)],{file:_0x48c914}=_0x200700;if(!_0x48c914)throw new AppError_1[(_0x4e0018(0x19b))](_0x4e0018(0x1a2),0x190);const _0x2b798e=(0x0,csv_1[_0x4e0018(0x1b8)])({'delimiter':',','columns':!![]},async(_0x2b67d2,_0x5c1306)=>{const _0x53af68=_0x4e0018;if(_0x2b67d2)throw new AppError_1[(_0x53af68(0x19b))]('ERR_INVALID_CSV',0x190);_0x5c1306['forEach'](async _0x9eb1ef=>{const _0x22b584=_0x53af68;let _0x52d41e;try{_0x52d41e=JSON[_0x22b584(0x1b8)](_0x9eb1ef['ExtraInfo']);}catch(_0x38819a){_0x52d41e=[];}const _0x6d5410={'companyId':_0x213bec,'name':_0x9eb1ef[_0x22b584(0x188)]||_0x9eb1ef[_0x22b584(0x191)],'number':_0x9eb1ef[_0x22b584(0x19a)]||_0x9eb1ef['Number'],'email':_0x9eb1ef[_0x22b584(0x1c3)]||_0x9eb1ef[_0x22b584(0x1dd)],'extraInfo':_0x52d41e};Object['keys'](_0x9eb1ef)['forEach'](_0x175a8d=>{const _0x131a4c=_0x22b584;_0x175a8d!==_0x131a4c(0x188)&&_0x175a8d!==_0x131a4c(0x19a)&&_0x175a8d!==_0x131a4c(0x1c3)&&_0x175a8d!==_0x131a4c(0x191)&&_0x175a8d!=='Number'&&_0x175a8d!=='Email'&&_0x175a8d!==_0x131a4c(0x1a3)&&_0x9eb1ef[_0x175a8d]&&_0x6d5410[_0x131a4c(0x1ae)]['push']({'name':_0x175a8d,'value':_0x9eb1ef[_0x175a8d]});});try{const _0x1355b6=await(0x0,CreateContactService_1['default'])(_0x6d5410),_0x678d13=(0x0,socket_1[_0x22b584(0x1c5)])();_0x678d13['to'](_0x22b584(0x1cc)+_0x213bec+'-mainchannel')[_0x22b584(0x1c7)](_0x22b584(0x1cc)+_0x213bec+_0x22b584(0x187),{'action':_0x22b584(0x199),'contact':_0x1355b6});}catch(_0x46132b){logger_1[_0x22b584(0x1de)][_0x22b584(0x1ca)]({'contact':_0x6d5410},_0x22b584(0x19d)+_0x46132b[_0x22b584(0x196)]);}});}),_0x4c4e68=fs_1[_0x4e0018(0x19b)]['createReadStream'](_0x48c914[_0x4e0018(0x1a0)]);return _0x2b798e['on'](_0x4e0018(0x1cd),()=>{const _0x347f84=_0x4e0018;_0x4c4e68['destroy'](),fs_1[_0x347f84(0x19b)][_0x347f84(0x1ba)](_0x48c914['path']);}),_0x4c4e68['pipe'](_0x2b798e),_0x3bd5b5[_0x4e0018(0x184)](0xc8)[_0x4e0018(0x19c)]({'message':_0x4e0018(0x190)});};exports[a13_0x4e90fe(0x186)]=importCsv;const exportCsv=async(_0x56f838,_0xc34069)=>{const _0x4646b7=a13_0x4e90fe,{companyId:_0x45e3a2}=_0x56f838[_0x4646b7(0x18e)],_0x43ec52=await Contact_1[_0x4646b7(0x19b)][_0x4646b7(0x1af)]({'where':{'companyId':_0x45e3a2,'channel':'whatsapp','isGroup':![]},'include':[{'model':ContactCustomField_1['default'],'as':_0x4646b7(0x1ae)}]}),_0x47997b=_0x43ec52[_0x4646b7(0x1c1)](_0x9a7131=>{const _0x652d94=_0x4646b7,_0x438c61=_0x9a7131[_0x652d94(0x1ae)]['map'](_0x3905ce=>({'name':_0x3905ce[_0x652d94(0x188)],'value':_0x3905ce[_0x652d94(0x1c8)]}));return{'Name':_0x9a7131['name'],'Number':_0x9a7131[_0x652d94(0x19a)],'Email':_0x9a7131[_0x652d94(0x1c3)]||'','ExtraInfo':JSON[_0x652d94(0x18a)](_0x438c61)};});return(0x0,csv_1['stringify'])(_0x47997b,{'header':!![]},(_0x461637,_0x4c85a0)=>{const _0x3f30c8=_0x4646b7;if(_0x461637)throw new AppError_1[(_0x3f30c8(0x19b))](_0x3f30c8(0x1b1),0x1f4);_0xc34069['setHeader'](_0x3f30c8(0x1a4),_0x3f30c8(0x1dc)),_0xc34069[_0x3f30c8(0x1d1)](_0x3f30c8(0x1b3),_0x3f30c8(0x1c2)),_0xc34069[_0x3f30c8(0x184)](0xc8)[_0x3f30c8(0x18b)](_0x4c85a0);}),_0xc34069;};exports[a13_0x4e90fe(0x1bc)]=exportCsv;