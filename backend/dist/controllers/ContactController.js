'use strict';const a13_0x49ee18=a13_0x8b66;(function(_0x377ad5,_0x4e4161){const _0x29abd5=a13_0x8b66,_0x51824f=_0x377ad5();while(!![]){try{const _0x1926f9=-parseInt(_0x29abd5(0x21d))/0x1*(-parseInt(_0x29abd5(0x21b))/0x2)+parseInt(_0x29abd5(0x1dc))/0x3*(-parseInt(_0x29abd5(0x1d2))/0x4)+parseInt(_0x29abd5(0x235))/0x5+-parseInt(_0x29abd5(0x1e4))/0x6+-parseInt(_0x29abd5(0x1e5))/0x7*(-parseInt(_0x29abd5(0x200))/0x8)+-parseInt(_0x29abd5(0x218))/0x9*(parseInt(_0x29abd5(0x1db))/0xa)+parseInt(_0x29abd5(0x22c))/0xb*(parseInt(_0x29abd5(0x1e3))/0xc);if(_0x1926f9===_0x4e4161)break;else _0x51824f['push'](_0x51824f['shift']());}catch(_0x578d5c){_0x51824f['push'](_0x51824f['shift']());}}}(a13_0x1d0b,0xee085));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x4c68d5,_0x158656,_0x54588,_0x32fbc1){const _0x52e1ea=a13_0x8b66;if(_0x32fbc1===undefined)_0x32fbc1=_0x54588;var _0x16f9e0=Object[_0x52e1ea(0x247)](_0x158656,_0x54588);(!_0x16f9e0||(_0x52e1ea(0x242)in _0x16f9e0?!_0x158656[_0x52e1ea(0x205)]:_0x16f9e0[_0x52e1ea(0x1d9)]||_0x16f9e0[_0x52e1ea(0x22f)]))&&(_0x16f9e0={'enumerable':!![],'get':function(){return _0x158656[_0x54588];}}),Object['defineProperty'](_0x4c68d5,_0x32fbc1,_0x16f9e0);}:function(_0x470267,_0x5b0216,_0x486cec,_0x3b4321){if(_0x3b4321===undefined)_0x3b4321=_0x486cec;_0x470267[_0x3b4321]=_0x5b0216[_0x486cec];}),__setModuleDefault=this&&this[a13_0x49ee18(0x20f)]||(Object['create']?function(_0x745e86,_0x57abf9){const _0x39c14c=a13_0x49ee18;Object[_0x39c14c(0x1d5)](_0x745e86,'default',{'enumerable':!![],'value':_0x57abf9});}:function(_0x4923a1,_0x43f7f6){const _0x26662b=a13_0x49ee18;_0x4923a1[_0x26662b(0x236)]=_0x43f7f6;}),__importStar=this&&this['__importStar']||(function(){const _0x23b5d0=(function(){let _0x1ef740=!![];return function(_0x5b38bc,_0x57f656){const _0x413693=_0x1ef740?function(){const _0x599354=a13_0x8b66;if(_0x57f656){const _0xe38bac=_0x57f656[_0x599354(0x1fd)](_0x5b38bc,arguments);return _0x57f656=null,_0xe38bac;}}:function(){};return _0x1ef740=![],_0x413693;};}()),_0x13c792=_0x23b5d0(this,function(){const _0x2620fc=a13_0x8b66;return _0x13c792[_0x2620fc(0x241)]()[_0x2620fc(0x217)](_0x2620fc(0x209))[_0x2620fc(0x241)]()[_0x2620fc(0x222)](_0x13c792)[_0x2620fc(0x217)](_0x2620fc(0x209));});_0x13c792();var _0x1964ce=function(_0x17a386){const _0x1a698a=a13_0x8b66;return _0x1964ce=Object[_0x1a698a(0x238)]||function(_0x327995){const _0x2066be=_0x1a698a;var _0x8f763a=[];for(var _0x4ab3c6 in _0x327995)if(Object['prototype'][_0x2066be(0x1ef)][_0x2066be(0x210)](_0x327995,_0x4ab3c6))_0x8f763a[_0x8f763a['length']]=_0x4ab3c6;return _0x8f763a;},_0x1964ce(_0x17a386);};return function(_0x3c0af2){const _0x254aa7=a13_0x8b66;if(_0x3c0af2&&_0x3c0af2[_0x254aa7(0x205)])return _0x3c0af2;var _0xf03691={};if(_0x3c0af2!=null){for(var _0x3da59b=_0x1964ce(_0x3c0af2),_0x2bac7a=0x0;_0x2bac7a<_0x3da59b[_0x254aa7(0x234)];_0x2bac7a++)if(_0x3da59b[_0x2bac7a]!==_0x254aa7(0x236))__createBinding(_0xf03691,_0x3c0af2,_0x3da59b[_0x2bac7a]);}return __setModuleDefault(_0xf03691,_0x3c0af2),_0xf03691;};}()),__importDefault=this&&this[a13_0x49ee18(0x1e2)]||function(_0x45fa7){const _0x2259ea=a13_0x49ee18;return _0x45fa7&&_0x45fa7[_0x2259ea(0x205)]?_0x45fa7:{'default':_0x45fa7};};Object[a13_0x49ee18(0x1d5)](exports,a13_0x49ee18(0x205),{'value':!![]}),exports[a13_0x49ee18(0x1f2)]=exports[a13_0x49ee18(0x206)]=exports[a13_0x49ee18(0x232)]=exports[a13_0x49ee18(0x24e)]=exports['remove']=exports[a13_0x49ee18(0x22e)]=exports[a13_0x49ee18(0x1fb)]=exports['store']=exports['getContact']=exports['index']=void 0x0;const Yup=__importStar(require('yup')),csv_1=require(a13_0x49ee18(0x20d)),fs_1=__importDefault(require('fs')),path_1=require('path'),socket_1=require(a13_0x49ee18(0x1f8)),GetPublicPath_1=require('../helpers/GetPublicPath'),ListContactsService_1=__importDefault(require('../services/ContactServices/ListContactsService')),CreateContactService_1=__importDefault(require('../services/ContactServices/CreateContactService')),ShowContactService_1=__importDefault(require(a13_0x49ee18(0x1e6))),UpdateContactService_1=__importDefault(require(a13_0x49ee18(0x208))),DeleteContactService_1=__importDefault(require('../services/ContactServices/DeleteContactService')),GetContactService_1=__importDefault(require(a13_0x49ee18(0x21c))),CheckNumber_1=__importDefault(require(a13_0x49ee18(0x1d3))),AppError_1=__importDefault(require(a13_0x49ee18(0x1fa))),SimpleListService_1=__importDefault(require(a13_0x49ee18(0x22b))),ContactCustomField_1=__importDefault(require(a13_0x49ee18(0x22a))),logger_1=require(a13_0x49ee18(0x212)),Contact_1=__importDefault(require(a13_0x49ee18(0x22d))),index=async(_0x54bdf4,_0x32fd2a)=>{const _0x4c6389=a13_0x49ee18,{searchParam:_0x54c61d,pageNumber:_0x262ed9}=_0x54bdf4[_0x4c6389(0x1ff)],{companyId:_0x3b96c1}=_0x54bdf4[_0x4c6389(0x1e8)],{contacts:_0x614375,count:_0x3d0b53,hasMore:_0x285f4b}=await(0x0,ListContactsService_1[_0x4c6389(0x236)])({'searchParam':_0x54c61d,'pageNumber':_0x262ed9,'companyId':_0x3b96c1});return _0x32fd2a[_0x4c6389(0x24d)]({'contacts':_0x614375,'count':_0x3d0b53,'hasMore':_0x285f4b});};exports['index']=index;function a13_0x1d0b(){const _0x5d21f6=['number','CSV\x20parsing\x20error:\x20','object','writable','required','1150qWnNVK','3ntgmKh','Error\x20converting\x20scientific\x20notation:\x20','email','isGroup','stringify','end','__importDefault','2639244jGtTKL','6188652evPqeS','9343670UynKWA','../services/ContactServices/ShowContactService','emit','user','rmSync','text/csv','CSV\x20file\x20is\x20empty\x20or\x20invalid','keys','Content-disposition','writeFileSync','hasOwnProperty','debug','Contact\x20created\x20successfully:\x20','exportCsv','\x20-\x20','CSV\x20import\x20finished.\x20Processed:\x20','extraInfo','set','findAll','../libs/socket','body','../errors/AppError','show',',\x20Success:\x20','apply','includes','query','8yvzdNN','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','getPublicPath',',\x20Errors:\x20','Name','__esModule','removeAll','name','../services/ContactServices/UpdateContactService','(((.+)+)+)+$','ERR_NO_FILE','Invalid\x20phone\x20number\x20after\x20cleaning:\x20','Contacts\x20being\x20imported','csv','logger','__setModuleDefault','call','map','../utils/logger','ExtraInfo','delete-all','Error\x20deleting\x20all\x20contacts:\x20','charCodeAt','search','9756oHnAVU','toUpperCase','Content-Type','6ADLbSz','../services/ContactServices/GetContactService','215315OolAQv','validate','Email','destroy','params','constructor','path','-contact','utf8','jid','matches','ERR_INVALID_CSV','getContact','../models/ContactCustomField','../services/ContactServices/SimpleListService','11fBBfyc','../models/Contact','update','configurable','pipe','getIO','importCsv','ERR_GENERATING_CSV','length','4192050qSySqi','default','ERR_DELETING_CONTACTS','getOwnPropertyNames','Missing\x20phone\x20number\x20in\x20record:\x20','parse','-mainchannel','error','All\x20contacts\x20have\x20been\x20deleted','readFileSync','remove','split','toString','get','status','ERR_EMPTY_CSV','push','replace','getOwnPropertyDescriptor','trim','string','shape','message','Number','json','list','value','Error\x20processing\x20CSV\x20file:\x20','company-','3632076olqfOH','../services/WbotServices/CheckNumber','media','defineProperty'];a13_0x1d0b=function(){return _0x5d21f6;};return a13_0x1d0b();}const getContact=async(_0x15f311,_0x3feeb4)=>{const _0x4bd89e=a13_0x49ee18,{name:_0xd18aa2,number:_0x53cc85}=_0x15f311[_0x4bd89e(0x1f9)],{companyId:_0x5b1db6}=_0x15f311[_0x4bd89e(0x1e8)],_0x41922c=await(0x0,GetContactService_1[_0x4bd89e(0x236)])({'name':_0xd18aa2,'number':_0x53cc85,'companyId':_0x5b1db6});return _0x3feeb4[_0x4bd89e(0x243)](0xc8)[_0x4bd89e(0x24d)](_0x41922c);};exports[a13_0x49ee18(0x229)]=getContact;const store=async(_0x43a32f,_0x2e167a)=>{const _0x109f7e=a13_0x49ee18,{companyId:_0x346610}=_0x43a32f[_0x109f7e(0x1e8)],_0x2c768d=_0x43a32f[_0x109f7e(0x1f9)];_0x2c768d[_0x109f7e(0x1d6)]=_0x2c768d[_0x109f7e(0x1d6)][_0x109f7e(0x246)]('-','')['replace']('\x20','');const _0x1a47ae=Yup[_0x109f7e(0x1d8)]()[_0x109f7e(0x24a)]({'name':Yup['string']()[_0x109f7e(0x1da)](),'number':Yup[_0x109f7e(0x249)]()[_0x109f7e(0x1da)]()[_0x109f7e(0x227)](/^\d+$/,_0x109f7e(0x201))});try{await _0x1a47ae['validate'](_0x2c768d);}catch(_0x274cc8){throw new AppError_1[(_0x109f7e(0x236))](_0x274cc8[_0x109f7e(0x24b)]);}if(!_0x2c768d[_0x109f7e(0x1df)]){const _0x41dd08=await(0x0,CheckNumber_1['default'])(_0x2c768d[_0x109f7e(0x1d6)],_0x346610),_0x15745c=_0x41dd08[_0x109f7e(0x226)][_0x109f7e(0x246)](/\D/g,'');_0x2c768d[_0x109f7e(0x1d6)]=_0x15745c;}const _0x2c4b54=await(0x0,CreateContactService_1['default'])({..._0x2c768d,'companyId':_0x346610}),_0x1a4259=(0x0,socket_1['getIO'])();return _0x1a4259['to']('company-'+_0x346610+_0x109f7e(0x23b))[_0x109f7e(0x1e7)](_0x109f7e(0x1d1)+_0x346610+_0x109f7e(0x224),{'action':'create','contact':_0x2c4b54}),_0x2e167a[_0x109f7e(0x243)](0xc8)['json'](_0x2c4b54);};exports['store']=store;const show=async(_0x8cd0cb,_0x29d7ed)=>{const _0x491c1c=a13_0x49ee18,{contactId:_0x1c875d}=_0x8cd0cb['params'],{companyId:_0x50607e}=_0x8cd0cb[_0x491c1c(0x1e8)],_0xde4649=await(0x0,ShowContactService_1[_0x491c1c(0x236)])(_0x1c875d,_0x50607e);return _0x29d7ed['status'](0xc8)[_0x491c1c(0x24d)](_0xde4649);};exports[a13_0x49ee18(0x1fb)]=show;const update=async(_0xe9daa5,_0x2db277)=>{const _0x1d3a54=a13_0x49ee18,_0x511f54=_0xe9daa5[_0x1d3a54(0x1f9)],{companyId:_0x5c369a}=_0xe9daa5[_0x1d3a54(0x1e8)],_0x5a76ea=Yup['object']()['shape']({'name':Yup[_0x1d3a54(0x249)](),'number':Yup[_0x1d3a54(0x249)]()['matches'](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0x5a76ea[_0x1d3a54(0x21e)](_0x511f54);}catch(_0x35333e){throw new AppError_1[(_0x1d3a54(0x236))](_0x35333e[_0x1d3a54(0x24b)]);}if(!_0x511f54[_0x1d3a54(0x1df)]){const _0xe205cf=await(0x0,CheckNumber_1[_0x1d3a54(0x236)])(_0x511f54[_0x1d3a54(0x1d6)],_0x5c369a),_0x5a053b=_0xe205cf[_0x1d3a54(0x226)][_0x1d3a54(0x246)](/\D/g,'');_0x511f54[_0x1d3a54(0x1d6)]=_0x5a053b;}const {contactId:_0x1b3f2f}=_0xe9daa5['params'],_0x5d6031=await(0x0,UpdateContactService_1[_0x1d3a54(0x236)])({'contactData':_0x511f54,'contactId':_0x1b3f2f,'companyId':_0x5c369a}),_0x596684=(0x0,socket_1[_0x1d3a54(0x231)])();return _0x596684['to'](_0x1d3a54(0x1d1)+_0x5c369a+_0x1d3a54(0x23b))['emit']('company-'+_0x5c369a+_0x1d3a54(0x224),{'action':'update','contact':_0x5d6031}),_0x2db277['status'](0xc8)['json'](_0x5d6031);};function a13_0x8b66(_0x491999,_0x1a3227){const _0x578017=a13_0x1d0b();return a13_0x8b66=function(_0x5e6c93,_0xb30790){_0x5e6c93=_0x5e6c93-0x1cf;let _0x1d0b62=_0x578017[_0x5e6c93];return _0x1d0b62;},a13_0x8b66(_0x491999,_0x1a3227);}exports[a13_0x49ee18(0x22e)]=update;const remove=async(_0x7f2a9d,_0x40b431)=>{const _0x359690=a13_0x49ee18,{contactId:_0x47b294}=_0x7f2a9d[_0x359690(0x221)],{companyId:_0x5da529}=_0x7f2a9d[_0x359690(0x1e8)];await(0x0,ShowContactService_1[_0x359690(0x236)])(_0x47b294,_0x5da529),await(0x0,DeleteContactService_1[_0x359690(0x236)])(_0x47b294);const _0x480dd7=(0x0,socket_1[_0x359690(0x231)])();return _0x480dd7['to'](_0x359690(0x1d1)+_0x5da529+_0x359690(0x23b))[_0x359690(0x1e7)](_0x359690(0x1d1)+_0x5da529+'-contact',{'action':'delete','contactId':_0x47b294}),_0x40b431[_0x359690(0x243)](0xc8)[_0x359690(0x24d)]({'message':'Contact\x20deleted'});};exports[a13_0x49ee18(0x23f)]=remove;const list=async(_0x35f9b5,_0x2e7731)=>{const _0x447fb0=a13_0x49ee18,{name:_0x220aff}=_0x35f9b5[_0x447fb0(0x1ff)],{companyId:_0x34f3e0}=_0x35f9b5['user'],_0x1bff47=await(0x0,SimpleListService_1['default'])({'name':_0x220aff,'companyId':_0x34f3e0});return _0x2e7731[_0x447fb0(0x24d)](_0x1bff47);};exports[a13_0x49ee18(0x24e)]=list;const importCsv=async(_0x508c89,_0xc3f2c9)=>{const _0x594bd8=a13_0x49ee18,{companyId:_0x1b78d4}=_0x508c89[_0x594bd8(0x1e8)],{file:_0x4ae9e6}=_0x508c89;if(!_0x4ae9e6)throw new AppError_1[(_0x594bd8(0x236))](_0x594bd8(0x20a),0x190);let _0xbf6087=',';try{let _0x414efb=fs_1['default'][_0x594bd8(0x23e)](_0x4ae9e6['path'],{'encoding':_0x594bd8(0x225)});_0x414efb[_0x594bd8(0x216)](0x0)===0xfeff&&(logger_1[_0x594bd8(0x20e)]['info']('UTF-8\x20BOM\x20detected,\x20removing\x20it'),_0x414efb=_0x414efb['substring'](0x1),fs_1[_0x594bd8(0x236)][_0x594bd8(0x1ee)](_0x4ae9e6[_0x594bd8(0x223)],_0x414efb,{'encoding':_0x594bd8(0x225)}));const _0x1befcb=_0x414efb[_0x594bd8(0x240)]('\x0a')[0x0];if(_0x1befcb[_0x594bd8(0x1fe)](';'))_0xbf6087=';';else _0x1befcb[_0x594bd8(0x1fe)]('\x09')&&(_0xbf6087='\x09');logger_1[_0x594bd8(0x20e)]['info']('Detected\x20CSV\x20delimiter:\x20'+_0xbf6087);}catch(_0x111b3a){logger_1[_0x594bd8(0x20e)]['error'](_0x594bd8(0x1d0)+_0x111b3a[_0x594bd8(0x24b)]);}const _0x13c7b1=(0x0,csv_1[_0x594bd8(0x23a)])({'delimiter':_0xbf6087,'columns':!![],'trim':!![],'relaxColumnCount':!![]},async(_0x294427,_0x2da1a9)=>{const _0x4039b5=_0x594bd8;if(_0x294427){logger_1[_0x4039b5(0x20e)][_0x4039b5(0x23c)](_0x4039b5(0x1d7)+_0x294427[_0x4039b5(0x24b)]);throw new AppError_1['default'](_0x4039b5(0x228),0x190);}if(!_0x2da1a9||_0x2da1a9[_0x4039b5(0x234)]===0x0){logger_1[_0x4039b5(0x20e)][_0x4039b5(0x23c)](_0x4039b5(0x1eb));throw new AppError_1['default'](_0x4039b5(0x244),0x190);}_0x2da1a9['forEach'](async _0x130420=>{const _0x3809c4=_0x4039b5;_0x391b8b++;let _0xd67e5f;try{_0xd67e5f=JSON[_0x3809c4(0x23a)](_0x130420[_0x3809c4(0x213)]);}catch(_0x2a6af1){_0xd67e5f=[];}let _0x55b9fc=_0x130420['number']||_0x130420[_0x3809c4(0x24c)];if(!_0x55b9fc){logger_1['logger'][_0x3809c4(0x23c)](_0x3809c4(0x239)+JSON[_0x3809c4(0x1e0)](_0x130420));return;}_0x55b9fc=String(_0x55b9fc)[_0x3809c4(0x248)]();if(_0x55b9fc[_0x3809c4(0x219)]()[_0x3809c4(0x1fe)]('E+')||/^\d+([.,]\d+)?[eE][+-]?\d+$/['test'](_0x55b9fc))try{const _0x4607e7=_0x55b9fc[_0x3809c4(0x246)](',','.');_0x55b9fc=parseFloat(_0x4607e7)[_0x3809c4(0x241)]();}catch(_0x36c86e){logger_1[_0x3809c4(0x20e)][_0x3809c4(0x23c)](_0x3809c4(0x1dd)+_0x55b9fc);}_0x55b9fc=_0x55b9fc['replace'](/\D/g,'');if(!_0x55b9fc||_0x55b9fc[_0x3809c4(0x234)]<0x8){logger_1[_0x3809c4(0x20e)][_0x3809c4(0x23c)](_0x3809c4(0x20b)+_0x55b9fc);return;}const _0x33c7da={'companyId':_0x1b78d4,'name':_0x130420[_0x3809c4(0x207)]||_0x130420[_0x3809c4(0x204)],'number':_0x55b9fc,'email':_0x130420[_0x3809c4(0x1de)]||_0x130420[_0x3809c4(0x21f)],'extraInfo':_0xd67e5f};Object[_0x3809c4(0x1ec)](_0x130420)['forEach'](_0x29c575=>{const _0x29c73e=_0x3809c4;_0x29c575!==_0x29c73e(0x207)&&_0x29c575!=='number'&&_0x29c575!==_0x29c73e(0x1de)&&_0x29c575!==_0x29c73e(0x204)&&_0x29c575!=='Number'&&_0x29c575!==_0x29c73e(0x21f)&&_0x29c575!==_0x29c73e(0x213)&&_0x130420[_0x29c575]&&_0x33c7da[_0x29c73e(0x1f5)][_0x29c73e(0x245)]({'name':_0x29c575,'value':_0x130420[_0x29c575]});});try{const _0x549ce0=await(0x0,CreateContactService_1[_0x3809c4(0x236)])(_0x33c7da);_0x553a81++,logger_1[_0x3809c4(0x20e)][_0x3809c4(0x1f0)](_0x3809c4(0x1f1)+_0x33c7da[_0x3809c4(0x207)]+_0x3809c4(0x1f3)+_0x33c7da['number']);const _0x38ae2b=(0x0,socket_1[_0x3809c4(0x231)])();_0x38ae2b['to']('company-'+_0x1b78d4+_0x3809c4(0x23b))['emit'](_0x3809c4(0x1d1)+_0x1b78d4+'-contact',{'action':_0x3809c4(0x22e),'contact':_0x549ce0});}catch(_0x3b49a9){_0x50c884++,logger_1[_0x3809c4(0x20e)]['error']({'contact':_0x33c7da},'Error\x20creating\x20contact:\x20'+_0x3b49a9[_0x3809c4(0x24b)]);}});}),_0x4926a0=fs_1[_0x594bd8(0x236)]['createReadStream'](_0x4ae9e6['path']);let _0x391b8b=0x0,_0x553a81=0x0,_0x50c884=0x0;return _0x13c7b1['on'](_0x594bd8(0x1e1),()=>{const _0x750343=_0x594bd8;_0x4926a0[_0x750343(0x220)](),fs_1[_0x750343(0x236)]['unlinkSync'](_0x4ae9e6[_0x750343(0x223)]),logger_1[_0x750343(0x20e)]['info'](_0x750343(0x1f4)+_0x391b8b+_0x750343(0x1fc)+_0x553a81+_0x750343(0x203)+_0x50c884);}),_0x4926a0[_0x594bd8(0x230)](_0x13c7b1),_0xc3f2c9[_0x594bd8(0x243)](0xc8)[_0x594bd8(0x24d)]({'message':_0x594bd8(0x20c)});};exports['importCsv']=importCsv;const removeAll=async(_0x4aebc9,_0x135448)=>{const _0x5434b3=a13_0x49ee18,{companyId:_0x1288dd}=_0x4aebc9['user'];try{const _0x277751=await Contact_1[_0x5434b3(0x236)][_0x5434b3(0x1f7)]({'where':{'companyId':_0x1288dd}});for(const _0x3acddc of _0x277751){const _0x118505=(0x0,path_1['join'])((0x0,GetPublicPath_1[_0x5434b3(0x202)])(),_0x5434b3(0x1d4),_0x3acddc['companyId']+'/'+_0x3acddc['id']);fs_1[_0x5434b3(0x236)][_0x5434b3(0x1e9)](_0x118505,{'recursive':!![],'force':!![]});}await Contact_1[_0x5434b3(0x236)][_0x5434b3(0x220)]({'where':{'companyId':_0x1288dd}});const _0x1e84bc=(0x0,socket_1[_0x5434b3(0x231)])();return _0x1e84bc['to'](_0x5434b3(0x1d1)+_0x1288dd+'-mainchannel')[_0x5434b3(0x1e7)](_0x5434b3(0x1d1)+_0x1288dd+'-contact',{'action':_0x5434b3(0x214)}),_0x135448[_0x5434b3(0x243)](0xc8)[_0x5434b3(0x24d)]({'message':_0x5434b3(0x23d)});}catch(_0x47f3f2){logger_1[_0x5434b3(0x20e)]['error']({'companyId':_0x1288dd},_0x5434b3(0x215)+_0x47f3f2['message']);throw new AppError_1[(_0x5434b3(0x236))](_0x5434b3(0x237),0x1f4);}};exports[a13_0x49ee18(0x206)]=removeAll;const exportCsv=async(_0x1ac61b,_0x248f6d)=>{const _0x15e65e=a13_0x49ee18,{companyId:_0xb628cd}=_0x1ac61b[_0x15e65e(0x1e8)],_0x2cb75e=await Contact_1[_0x15e65e(0x236)][_0x15e65e(0x1f7)]({'where':{'companyId':_0xb628cd,'channel':'whatsapp','isGroup':![]},'include':[{'model':ContactCustomField_1['default'],'as':_0x15e65e(0x1f5)}]}),_0x543926=_0x2cb75e[_0x15e65e(0x211)](_0x202f26=>{const _0x223bc9=_0x15e65e,_0x2b008a=_0x202f26[_0x223bc9(0x1f5)][_0x223bc9(0x211)](_0x586f8c=>({'name':_0x586f8c[_0x223bc9(0x207)],'value':_0x586f8c[_0x223bc9(0x1cf)]}));return{'Name':_0x202f26[_0x223bc9(0x207)],'Number':_0x202f26['number'],'Email':_0x202f26[_0x223bc9(0x1de)]||'','ExtraInfo':JSON[_0x223bc9(0x1e0)](_0x2b008a)};});return(0x0,csv_1[_0x15e65e(0x1e0)])(_0x543926,{'header':!![]},(_0x47f710,_0x28cc74)=>{const _0x922d28=_0x15e65e;if(_0x47f710)throw new AppError_1[(_0x922d28(0x236))](_0x922d28(0x233),0x1f4);_0x248f6d['setHeader'](_0x922d28(0x1ed),'attachment;\x20filename=contacts.csv'),_0x248f6d[_0x922d28(0x1f6)](_0x922d28(0x21a),_0x922d28(0x1ea)),_0x248f6d[_0x922d28(0x243)](0xc8)['send'](_0x28cc74);}),_0x248f6d;};exports[a13_0x49ee18(0x1f2)]=exportCsv;