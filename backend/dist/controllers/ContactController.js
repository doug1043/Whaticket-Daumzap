'use strict';const a13_0x3875bd=a13_0x1dbc;(function(_0x5f1bfd,_0x9deb36){const _0x488cab=a13_0x1dbc,_0x48030f=_0x5f1bfd();while(!![]){try{const _0x493f88=-parseInt(_0x488cab(0x1f3))/0x1+-parseInt(_0x488cab(0x20b))/0x2+-parseInt(_0x488cab(0x223))/0x3*(parseInt(_0x488cab(0x24c))/0x4)+-parseInt(_0x488cab(0x212))/0x5*(parseInt(_0x488cab(0x245))/0x6)+-parseInt(_0x488cab(0x24a))/0x7+-parseInt(_0x488cab(0x259))/0x8*(parseInt(_0x488cab(0x238))/0x9)+-parseInt(_0x488cab(0x227))/0xa*(-parseInt(_0x488cab(0x252))/0xb);if(_0x493f88===_0x9deb36)break;else _0x48030f['push'](_0x48030f['shift']());}catch(_0x4d9e14){_0x48030f['push'](_0x48030f['shift']());}}}(a13_0x2919,0x3dd36));var __createBinding=this&&this[a13_0x3875bd(0x1e9)]||(Object['create']?function(_0x59f567,_0x4cceab,_0x401ea1,_0x36a7b4){const _0x279345=a13_0x3875bd;if(_0x36a7b4===undefined)_0x36a7b4=_0x401ea1;var _0x244167=Object[_0x279345(0x1fd)](_0x4cceab,_0x401ea1);(!_0x244167||(_0x279345(0x22e)in _0x244167?!_0x4cceab[_0x279345(0x26b)]:_0x244167['writable']||_0x244167[_0x279345(0x255)]))&&(_0x244167={'enumerable':!![],'get':function(){return _0x4cceab[_0x401ea1];}}),Object[_0x279345(0x224)](_0x59f567,_0x36a7b4,_0x244167);}:function(_0x37ac40,_0x76948a,_0xc24add,_0x4a333c){if(_0x4a333c===undefined)_0x4a333c=_0xc24add;_0x37ac40[_0x4a333c]=_0x76948a[_0xc24add];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a13_0x3875bd(0x221)]?function(_0x4033b2,_0x2b2ec9){const _0x1cb431=a13_0x3875bd;Object[_0x1cb431(0x224)](_0x4033b2,_0x1cb431(0x262),{'enumerable':!![],'value':_0x2b2ec9});}:function(_0x5f2e00,_0x45dba8){_0x5f2e00['default']=_0x45dba8;}),__importStar=this&&this[a13_0x3875bd(0x1f4)]||(function(){const _0x5cefee=(function(){let _0x176731=!![];return function(_0x414124,_0x164d4e){const _0x3d7f49=_0x176731?function(){const _0x5666b4=a13_0x1dbc;if(_0x164d4e){const _0x340ff8=_0x164d4e[_0x5666b4(0x1fb)](_0x414124,arguments);return _0x164d4e=null,_0x340ff8;}}:function(){};return _0x176731=![],_0x3d7f49;};}()),_0x290296=_0x5cefee(this,function(){const _0x47c780=a13_0x1dbc;return _0x290296[_0x47c780(0x25d)]()[_0x47c780(0x237)](_0x47c780(0x1ff))[_0x47c780(0x25d)]()['constructor'](_0x290296)[_0x47c780(0x237)](_0x47c780(0x1ff));});_0x290296();var _0x3dc253=function(_0x14204c){const _0x42844e=a13_0x1dbc;return _0x3dc253=Object[_0x42844e(0x25c)]||function(_0x11238e){const _0x5ed9f9=_0x42844e;var _0x51b6df=[];for(var _0x3e0244 in _0x11238e)if(Object[_0x5ed9f9(0x220)][_0x5ed9f9(0x20e)][_0x5ed9f9(0x250)](_0x11238e,_0x3e0244))_0x51b6df[_0x51b6df[_0x5ed9f9(0x244)]]=_0x3e0244;return _0x51b6df;},_0x3dc253(_0x14204c);};return function(_0x4c597e){const _0x16a322=a13_0x1dbc;if(_0x4c597e&&_0x4c597e['__esModule'])return _0x4c597e;var _0x4b0f19={};if(_0x4c597e!=null){for(var _0x21d11a=_0x3dc253(_0x4c597e),_0x472a87=0x0;_0x472a87<_0x21d11a['length'];_0x472a87++)if(_0x21d11a[_0x472a87]!==_0x16a322(0x262))__createBinding(_0x4b0f19,_0x4c597e,_0x21d11a[_0x472a87]);}return __setModuleDefault(_0x4b0f19,_0x4c597e),_0x4b0f19;};}()),__importDefault=this&&this['__importDefault']||function(_0x537916){const _0x4ecfd8=a13_0x3875bd;return _0x537916&&_0x537916[_0x4ecfd8(0x26b)]?_0x537916:{'default':_0x537916};};Object[a13_0x3875bd(0x224)](exports,'__esModule',{'value':!![]}),exports[a13_0x3875bd(0x217)]=exports[a13_0x3875bd(0x253)]=exports[a13_0x3875bd(0x210)]=exports['list']=exports[a13_0x3875bd(0x266)]=exports[a13_0x3875bd(0x225)]=exports[a13_0x3875bd(0x216)]=exports[a13_0x3875bd(0x25f)]=exports[a13_0x3875bd(0x201)]=exports['index']=void 0x0;const Yup=__importStar(require(a13_0x3875bd(0x1fc))),csv_1=require('csv'),fs_1=__importDefault(require('fs')),path_1=require(a13_0x3875bd(0x222)),socket_1=require('../libs/socket'),GetPublicPath_1=require(a13_0x3875bd(0x22b)),ListContactsService_1=__importDefault(require(a13_0x3875bd(0x207))),CreateContactService_1=__importDefault(require(a13_0x3875bd(0x1ef))),ShowContactService_1=__importDefault(require(a13_0x3875bd(0x235))),UpdateContactService_1=__importDefault(require(a13_0x3875bd(0x271))),DeleteContactService_1=__importDefault(require(a13_0x3875bd(0x25a))),GetContactService_1=__importDefault(require(a13_0x3875bd(0x23e))),CheckNumber_1=__importDefault(require('../services/WbotServices/CheckNumber')),AppError_1=__importDefault(require(a13_0x3875bd(0x208))),SimpleListService_1=__importDefault(require(a13_0x3875bd(0x20a))),ContactCustomField_1=__importDefault(require(a13_0x3875bd(0x241))),User_1=__importDefault(require(a13_0x3875bd(0x200))),logger_1=require(a13_0x3875bd(0x209)),Contact_1=__importDefault(require('../models/Contact')),index=async(_0x3df94f,_0x3a3ebd)=>{const _0x127e84=a13_0x3875bd,{searchParam:_0x333fc0,pageNumber:_0x89cc37}=_0x3df94f[_0x127e84(0x205)],{companyId:_0x1fd132,id:_0x3f9da8}=_0x3df94f[_0x127e84(0x274)],_0x1f6083=await User_1[_0x127e84(0x262)][_0x127e84(0x240)](_0x3f9da8);if(_0x1f6083&&_0x1f6083[_0x127e84(0x26c)]!==_0x127e84(0x230)&&_0x1f6083[_0x127e84(0x206)]===_0x127e84(0x1f2))throw new AppError_1['default'](_0x127e84(0x1f8),0x193);const {contacts:_0x1a6b98,count:_0xfa1908,hasMore:_0x5149e9}=await(0x0,ListContactsService_1[_0x127e84(0x262)])({'searchParam':_0x333fc0,'pageNumber':_0x89cc37,'companyId':_0x1fd132});return _0x3a3ebd[_0x127e84(0x26a)]({'contacts':_0x1a6b98,'count':_0xfa1908,'hasMore':_0x5149e9});};exports[a13_0x3875bd(0x257)]=index;const getContact=async(_0x29be0b,_0x2644a4)=>{const _0x58dad7=a13_0x3875bd,{name:_0x1002d1,number:_0x47ae58}=_0x29be0b[_0x58dad7(0x1fe)],{companyId:_0xd3b456}=_0x29be0b[_0x58dad7(0x274)],_0x67723f=await(0x0,GetContactService_1[_0x58dad7(0x262)])({'name':_0x1002d1,'number':_0x47ae58,'companyId':_0xd3b456});return _0x2644a4[_0x58dad7(0x1ea)](0xc8)[_0x58dad7(0x26a)](_0x67723f);};exports['getContact']=getContact;const store=async(_0x22940f,_0x3d5edb)=>{const _0x379068=a13_0x3875bd,{companyId:_0x543319}=_0x22940f[_0x379068(0x274)],_0x115dce=_0x22940f[_0x379068(0x1fe)];_0x115dce[_0x379068(0x24b)]=_0x115dce[_0x379068(0x24b)][_0x379068(0x249)]('-','')[_0x379068(0x249)]('\x20','');const _0xcd01eb=Yup[_0x379068(0x26e)]()[_0x379068(0x1f7)]({'name':Yup[_0x379068(0x219)]()[_0x379068(0x1e6)](),'number':Yup[_0x379068(0x219)]()[_0x379068(0x1e6)]()[_0x379068(0x1f1)](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0xcd01eb[_0x379068(0x23f)](_0x115dce);}catch(_0x1ce4bf){throw new AppError_1[(_0x379068(0x262))](_0x1ce4bf[_0x379068(0x270)]);}if(!_0x115dce[_0x379068(0x1f6)]){const _0x56db9d=await(0x0,CheckNumber_1[_0x379068(0x262)])(_0x115dce[_0x379068(0x24b)],_0x543319),_0x23f085=_0x56db9d[_0x379068(0x272)][_0x379068(0x249)](/\D/g,'');_0x115dce[_0x379068(0x24b)]=_0x23f085;}const _0xa7d7e7=await(0x0,CreateContactService_1[_0x379068(0x262)])({..._0x115dce,'companyId':_0x543319}),_0x4c45c8=(0x0,socket_1[_0x379068(0x258)])();return _0x4c45c8['to']('company-'+_0x543319+_0x379068(0x21e))[_0x379068(0x269)]('company-'+_0x543319+_0x379068(0x231),{'action':_0x379068(0x221),'contact':_0xa7d7e7}),_0x3d5edb['status'](0xc8)[_0x379068(0x26a)](_0xa7d7e7);};exports[a13_0x3875bd(0x25f)]=store;const show=async(_0x4d4623,_0x5912af)=>{const _0x16cb8e=a13_0x3875bd,{contactId:_0x3ddf46}=_0x4d4623[_0x16cb8e(0x24f)],{companyId:_0x1b3741}=_0x4d4623[_0x16cb8e(0x274)],_0x4a7ab4=await(0x0,ShowContactService_1[_0x16cb8e(0x262)])(_0x3ddf46,_0x1b3741);return _0x5912af[_0x16cb8e(0x1ea)](0xc8)[_0x16cb8e(0x26a)](_0x4a7ab4);};exports[a13_0x3875bd(0x216)]=show;function a13_0x1dbc(_0x1f9194,_0x509010){const _0x546fa2=a13_0x2919();return a13_0x1dbc=function(_0x4d7ed2,_0x4c69ff){_0x4d7ed2=_0x4d7ed2-0x1e6;let _0x2919f9=_0x546fa2[_0x4d7ed2];return _0x2919f9;},a13_0x1dbc(_0x1f9194,_0x509010);}const update=async(_0x1f081c,_0x5d2a2c)=>{const _0x4f2a4e=a13_0x3875bd,_0x5c6ed9=_0x1f081c[_0x4f2a4e(0x1fe)],{companyId:_0x3c7d0f}=_0x1f081c['user'],_0x3bee58=Yup[_0x4f2a4e(0x26e)]()[_0x4f2a4e(0x1f7)]({'name':Yup[_0x4f2a4e(0x219)](),'number':Yup['string']()[_0x4f2a4e(0x1f1)](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0x3bee58['validate'](_0x5c6ed9);}catch(_0x5c4086){throw new AppError_1[(_0x4f2a4e(0x262))](_0x5c4086[_0x4f2a4e(0x270)]);}if(!_0x5c6ed9[_0x4f2a4e(0x1f6)]){const _0x49d50f=await(0x0,CheckNumber_1['default'])(_0x5c6ed9[_0x4f2a4e(0x24b)],_0x3c7d0f),_0xc40b=_0x49d50f[_0x4f2a4e(0x272)][_0x4f2a4e(0x249)](/\D/g,'');_0x5c6ed9[_0x4f2a4e(0x24b)]=_0xc40b;}const {contactId:_0x378521}=_0x1f081c[_0x4f2a4e(0x24f)],_0x503926=await(0x0,UpdateContactService_1[_0x4f2a4e(0x262)])({'contactData':_0x5c6ed9,'contactId':_0x378521,'companyId':_0x3c7d0f}),_0x2458b5=(0x0,socket_1[_0x4f2a4e(0x258)])();return _0x2458b5['to'](_0x4f2a4e(0x1e8)+_0x3c7d0f+_0x4f2a4e(0x21e))['emit'](_0x4f2a4e(0x1e8)+_0x3c7d0f+_0x4f2a4e(0x231),{'action':'update','contact':_0x503926}),_0x5d2a2c[_0x4f2a4e(0x1ea)](0xc8)['json'](_0x503926);};function a13_0x2919(){const _0x1025b6=['extraInfo','message','../services/ContactServices/UpdateContactService','jid','Email','user','join','required','findAll','company-','__createBinding','status','Missing\x20phone\x20number\x20in\x20record:\x20','parse','Error\x20creating\x20contact:\x20','push','../services/ContactServices/CreateContactService','pipe','matches','disabled','130396TeYRbg','__importStar','test','isGroup','shape','ERR_NO_PERMISSION','unlinkSync','writeFileSync','apply','yup','getOwnPropertyDescriptor','body','(((.+)+)+)+$','../models/User','getContact',',\x20Success:\x20','map','keys','query','isTricked','../services/ContactServices/ListContactsService','../errors/AppError','../utils/logger','../services/ContactServices/SimpleListService','640078VTXnLJ','Name','ExtraInfo','hasOwnProperty','Detected\x20CSV\x20delimiter:\x20','importCsv','UTF-8\x20BOM\x20detected,\x20removing\x20it','20lFXDiG','list','ERR_GENERATING_CSV','CSV\x20file\x20is\x20empty\x20or\x20invalid','show','exportCsv','All\x20contacts\x20have\x20been\x20deleted','string','Content-disposition','rmSync','readFileSync','attachment;\x20filename=contacts.csv','-mainchannel','Contact\x20created\x20successfully:\x20','prototype','create','path','82284lMAeyO','defineProperty','update','stringify','119610QnMuYu','error','Contact\x20deleted','Number','../helpers/GetPublicPath','split','charCodeAt','get','utf8','admin','-contact','substring','send','ERR_EMPTY_CSV','../services/ContactServices/ShowContactService','set','search','18dnlYkW','delete','Invalid\x20phone\x20number\x20after\x20cleaning:\x20','ERR_NO_FILE','Content-Type','setHeader','../services/ContactServices/GetContactService','validate','findByPk','../models/ContactCustomField','info',',\x20Errors:\x20','length','276762KlcNqr','end','companyId','value','replace','869071VlHHvU','number','52dfthRQ','CSV\x20parsing\x20error:\x20','ERR_DELETING_CONTACTS','params','call','debug','1452HzZkYP','removeAll','\x20-\x20','configurable','includes','index','getIO','839816wspXfS','../services/ContactServices/DeleteContactService','Error\x20processing\x20CSV\x20file:\x20','getOwnPropertyNames','toString','whatsapp','store','Contacts\x20being\x20imported','name','default','forEach','toUpperCase','logger','remove','destroy','email','emit','json','__esModule','profile','Error\x20converting\x20scientific\x20notation:\x20','object'];a13_0x2919=function(){return _0x1025b6;};return a13_0x2919();}exports['update']=update;const remove=async(_0x224b38,_0x3a7af9)=>{const _0xdd91a0=a13_0x3875bd,{contactId:_0x3e7cbc}=_0x224b38[_0xdd91a0(0x24f)],{companyId:_0x42f584}=_0x224b38['user'];await(0x0,ShowContactService_1[_0xdd91a0(0x262)])(_0x3e7cbc,_0x42f584),await(0x0,DeleteContactService_1['default'])(_0x3e7cbc);const _0xd9a636=(0x0,socket_1[_0xdd91a0(0x258)])();return _0xd9a636['to'](_0xdd91a0(0x1e8)+_0x42f584+_0xdd91a0(0x21e))[_0xdd91a0(0x269)]('company-'+_0x42f584+_0xdd91a0(0x231),{'action':_0xdd91a0(0x239),'contactId':_0x3e7cbc}),_0x3a7af9[_0xdd91a0(0x1ea)](0xc8)[_0xdd91a0(0x26a)]({'message':_0xdd91a0(0x229)});};exports[a13_0x3875bd(0x266)]=remove;const list=async(_0x4b1f69,_0x283ef9)=>{const _0x1e7cc1=a13_0x3875bd,{name:_0x283c6d}=_0x4b1f69[_0x1e7cc1(0x205)],{companyId:_0x283eb7}=_0x4b1f69[_0x1e7cc1(0x274)],_0xef924f=await(0x0,SimpleListService_1['default'])({'name':_0x283c6d,'companyId':_0x283eb7});return _0x283ef9[_0x1e7cc1(0x26a)](_0xef924f);};exports[a13_0x3875bd(0x213)]=list;const importCsv=async(_0x456375,_0x367fab)=>{const _0x29c39b=a13_0x3875bd,{companyId:_0x34f865}=_0x456375[_0x29c39b(0x274)],{file:_0x2264ec}=_0x456375;if(!_0x2264ec)throw new AppError_1[(_0x29c39b(0x262))](_0x29c39b(0x23b),0x190);let _0x32a96a=',';try{let _0x1ccfa2=fs_1[_0x29c39b(0x262)][_0x29c39b(0x21c)](_0x2264ec[_0x29c39b(0x222)],{'encoding':'utf8'});_0x1ccfa2[_0x29c39b(0x22d)](0x0)===0xfeff&&(logger_1[_0x29c39b(0x265)]['info'](_0x29c39b(0x211)),_0x1ccfa2=_0x1ccfa2[_0x29c39b(0x232)](0x1),fs_1['default'][_0x29c39b(0x1fa)](_0x2264ec[_0x29c39b(0x222)],_0x1ccfa2,{'encoding':_0x29c39b(0x22f)}));const _0xf48007=_0x1ccfa2[_0x29c39b(0x22c)]('\x0a')[0x0];if(_0xf48007['includes'](';'))_0x32a96a=';';else _0xf48007[_0x29c39b(0x256)]('\x09')&&(_0x32a96a='\x09');logger_1[_0x29c39b(0x265)][_0x29c39b(0x242)](_0x29c39b(0x20f)+_0x32a96a);}catch(_0x3dd011){logger_1[_0x29c39b(0x265)]['error'](_0x29c39b(0x25b)+_0x3dd011['message']);}const _0x53ff1c=(0x0,csv_1[_0x29c39b(0x1ec)])({'delimiter':_0x32a96a,'columns':!![],'trim':!![],'relaxColumnCount':!![]},async(_0x119c94,_0x36a533)=>{const _0x3de39c=_0x29c39b;if(_0x119c94){logger_1[_0x3de39c(0x265)][_0x3de39c(0x228)](_0x3de39c(0x24d)+_0x119c94[_0x3de39c(0x270)]);throw new AppError_1[(_0x3de39c(0x262))]('ERR_INVALID_CSV',0x190);}if(!_0x36a533||_0x36a533[_0x3de39c(0x244)]===0x0){logger_1[_0x3de39c(0x265)][_0x3de39c(0x228)](_0x3de39c(0x215));throw new AppError_1['default'](_0x3de39c(0x234),0x190);}_0x36a533[_0x3de39c(0x263)](async _0x3fd4f8=>{const _0x1acf55=_0x3de39c;_0x79b45a++;let _0xdc5849;try{_0xdc5849=JSON[_0x1acf55(0x1ec)](_0x3fd4f8[_0x1acf55(0x20d)]);}catch(_0x21623c){_0xdc5849=[];}let _0x2eca3c=_0x3fd4f8['number']||_0x3fd4f8[_0x1acf55(0x22a)];if(!_0x2eca3c){logger_1[_0x1acf55(0x265)][_0x1acf55(0x228)](_0x1acf55(0x1eb)+JSON[_0x1acf55(0x226)](_0x3fd4f8));return;}_0x2eca3c=String(_0x2eca3c)['trim']();if(_0x2eca3c[_0x1acf55(0x264)]()[_0x1acf55(0x256)]('E+')||/^\d+([.,]\d+)?[eE][+-]?\d+$/[_0x1acf55(0x1f5)](_0x2eca3c))try{const _0x44be33=_0x2eca3c[_0x1acf55(0x249)](',','.');_0x2eca3c=parseFloat(_0x44be33)['toString']();}catch(_0x3672c9){logger_1[_0x1acf55(0x265)][_0x1acf55(0x228)](_0x1acf55(0x26d)+_0x2eca3c);}_0x2eca3c=_0x2eca3c[_0x1acf55(0x249)](/\D/g,'');if(!_0x2eca3c||_0x2eca3c['length']<0x8){logger_1['logger'][_0x1acf55(0x228)](_0x1acf55(0x23a)+_0x2eca3c);return;}const _0x46f1c9={'companyId':_0x34f865,'name':_0x3fd4f8[_0x1acf55(0x261)]||_0x3fd4f8[_0x1acf55(0x20c)],'number':_0x2eca3c,'email':_0x3fd4f8[_0x1acf55(0x268)]||_0x3fd4f8[_0x1acf55(0x273)],'extraInfo':_0xdc5849};Object[_0x1acf55(0x204)](_0x3fd4f8)[_0x1acf55(0x263)](_0x281d8e=>{const _0x5eb261=_0x1acf55;_0x281d8e!==_0x5eb261(0x261)&&_0x281d8e!==_0x5eb261(0x24b)&&_0x281d8e!=='email'&&_0x281d8e!==_0x5eb261(0x20c)&&_0x281d8e!=='Number'&&_0x281d8e!==_0x5eb261(0x273)&&_0x281d8e!==_0x5eb261(0x20d)&&_0x3fd4f8[_0x281d8e]&&_0x46f1c9[_0x5eb261(0x26f)][_0x5eb261(0x1ee)]({'name':_0x281d8e,'value':_0x3fd4f8[_0x281d8e]});});try{const _0x2bb7ee=await(0x0,CreateContactService_1[_0x1acf55(0x262)])(_0x46f1c9);_0xfda7a7++,logger_1[_0x1acf55(0x265)][_0x1acf55(0x251)](_0x1acf55(0x21f)+_0x46f1c9[_0x1acf55(0x261)]+_0x1acf55(0x254)+_0x46f1c9[_0x1acf55(0x24b)]);const _0xb0094f=(0x0,socket_1[_0x1acf55(0x258)])();_0xb0094f['to'](_0x1acf55(0x1e8)+_0x34f865+'-mainchannel')[_0x1acf55(0x269)](_0x1acf55(0x1e8)+_0x34f865+_0x1acf55(0x231),{'action':'update','contact':_0x2bb7ee});}catch(_0x2e4186){_0x246760++,logger_1[_0x1acf55(0x265)][_0x1acf55(0x228)]({'contact':_0x46f1c9},_0x1acf55(0x1ed)+_0x2e4186['message']);}});}),_0x264983=fs_1['default']['createReadStream'](_0x2264ec[_0x29c39b(0x222)]);let _0x79b45a=0x0,_0xfda7a7=0x0,_0x246760=0x0;return _0x53ff1c['on'](_0x29c39b(0x246),()=>{const _0x3f1e19=_0x29c39b;_0x264983['destroy'](),fs_1[_0x3f1e19(0x262)][_0x3f1e19(0x1f9)](_0x2264ec[_0x3f1e19(0x222)]),logger_1['logger']['info']('CSV\x20import\x20finished.\x20Processed:\x20'+_0x79b45a+_0x3f1e19(0x202)+_0xfda7a7+_0x3f1e19(0x243)+_0x246760);}),_0x264983[_0x29c39b(0x1f0)](_0x53ff1c),_0x367fab[_0x29c39b(0x1ea)](0xc8)[_0x29c39b(0x26a)]({'message':_0x29c39b(0x260)});};exports['importCsv']=importCsv;const removeAll=async(_0x3b09bf,_0x39de65)=>{const _0x228c9a=a13_0x3875bd,{companyId:_0x2518ce}=_0x3b09bf[_0x228c9a(0x274)];try{const _0x3faecb=await Contact_1['default'][_0x228c9a(0x1e7)]({'where':{'companyId':_0x2518ce}});for(const _0x2db8ed of _0x3faecb){const _0x7eb6db=(0x0,path_1[_0x228c9a(0x275)])((0x0,GetPublicPath_1['getPublicPath'])(),'media',_0x2db8ed[_0x228c9a(0x247)]+'/'+_0x2db8ed['id']);fs_1[_0x228c9a(0x262)][_0x228c9a(0x21b)](_0x7eb6db,{'recursive':!![],'force':!![]});}await Contact_1[_0x228c9a(0x262)][_0x228c9a(0x267)]({'where':{'companyId':_0x2518ce}});const _0x13c110=(0x0,socket_1[_0x228c9a(0x258)])();return _0x13c110['to'](_0x228c9a(0x1e8)+_0x2518ce+_0x228c9a(0x21e))[_0x228c9a(0x269)](_0x228c9a(0x1e8)+_0x2518ce+'-contact',{'action':'delete-all'}),_0x39de65[_0x228c9a(0x1ea)](0xc8)[_0x228c9a(0x26a)]({'message':_0x228c9a(0x218)});}catch(_0x1548e1){logger_1[_0x228c9a(0x265)]['error']({'companyId':_0x2518ce},'Error\x20deleting\x20all\x20contacts:\x20'+_0x1548e1[_0x228c9a(0x270)]);throw new AppError_1['default'](_0x228c9a(0x24e),0x1f4);}};exports['removeAll']=removeAll;const exportCsv=async(_0x22c6c5,_0x48f7a)=>{const _0x302232=a13_0x3875bd,{companyId:_0x674d64}=_0x22c6c5[_0x302232(0x274)],_0x2f64ec=await Contact_1[_0x302232(0x262)][_0x302232(0x1e7)]({'where':{'companyId':_0x674d64,'channel':_0x302232(0x25e),'isGroup':![]},'include':[{'model':ContactCustomField_1[_0x302232(0x262)],'as':_0x302232(0x26f)}]}),_0x2c530f=_0x2f64ec['map'](_0x3e1f7c=>{const _0x863904=_0x302232,_0x298253=_0x3e1f7c[_0x863904(0x26f)][_0x863904(0x203)](_0x253e69=>({'name':_0x253e69[_0x863904(0x261)],'value':_0x253e69[_0x863904(0x248)]}));return{'Name':_0x3e1f7c[_0x863904(0x261)],'Number':_0x3e1f7c[_0x863904(0x24b)],'Email':_0x3e1f7c['email']||'','ExtraInfo':JSON[_0x863904(0x226)](_0x298253)};});return(0x0,csv_1[_0x302232(0x226)])(_0x2c530f,{'header':!![]},(_0x1d5d74,_0x2ca85e)=>{const _0xcb6eb7=_0x302232;if(_0x1d5d74)throw new AppError_1['default'](_0xcb6eb7(0x214),0x1f4);_0x48f7a[_0xcb6eb7(0x23d)](_0xcb6eb7(0x21a),_0xcb6eb7(0x21d)),_0x48f7a[_0xcb6eb7(0x236)](_0xcb6eb7(0x23c),'text/csv'),_0x48f7a[_0xcb6eb7(0x1ea)](0xc8)[_0xcb6eb7(0x233)](_0x2ca85e);}),_0x48f7a;};exports['exportCsv']=exportCsv;