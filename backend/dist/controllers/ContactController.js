'use strict';const a13_0x297455=a13_0x522c;(function(_0x5efe7a,_0x555385){const _0x7728f3=a13_0x522c,_0x26ea2a=_0x5efe7a();while(!![]){try{const _0xcf3122=parseInt(_0x7728f3(0x185))/0x1+-parseInt(_0x7728f3(0x161))/0x2+-parseInt(_0x7728f3(0x1a7))/0x3+-parseInt(_0x7728f3(0x178))/0x4*(parseInt(_0x7728f3(0x195))/0x5)+parseInt(_0x7728f3(0x1a1))/0x6+parseInt(_0x7728f3(0x157))/0x7*(-parseInt(_0x7728f3(0x15e))/0x8)+parseInt(_0x7728f3(0x197))/0x9;if(_0xcf3122===_0x555385)break;else _0x26ea2a['push'](_0x26ea2a['shift']());}catch(_0x421d43){_0x26ea2a['push'](_0x26ea2a['shift']());}}}(a13_0x520b,0xe07e1));var __createBinding=this&&this['__createBinding']||(Object[a13_0x297455(0x155)]?function(_0x3c8313,_0x210b32,_0x4d1c0d,_0x4bcbbf){const _0x4d2cd4=a13_0x297455;if(_0x4bcbbf===undefined)_0x4bcbbf=_0x4d1c0d;var _0x4425eb=Object['getOwnPropertyDescriptor'](_0x210b32,_0x4d1c0d);(!_0x4425eb||(_0x4d2cd4(0x1a4)in _0x4425eb?!_0x210b32[_0x4d2cd4(0x174)]:_0x4425eb[_0x4d2cd4(0x15a)]||_0x4425eb[_0x4d2cd4(0x194)]))&&(_0x4425eb={'enumerable':!![],'get':function(){return _0x210b32[_0x4d1c0d];}}),Object[_0x4d2cd4(0x18b)](_0x3c8313,_0x4bcbbf,_0x4425eb);}:function(_0x48f894,_0x576873,_0xa8d7c,_0x12bbf9){if(_0x12bbf9===undefined)_0x12bbf9=_0xa8d7c;_0x48f894[_0x12bbf9]=_0x576873[_0xa8d7c];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x5bf31d,_0x41285f){const _0xceada1=a13_0x297455;Object[_0xceada1(0x18b)](_0x5bf31d,_0xceada1(0x18f),{'enumerable':!![],'value':_0x41285f});}:function(_0x233572,_0xd7298e){const _0x5ac753=a13_0x297455;_0x233572[_0x5ac753(0x18f)]=_0xd7298e;}),__importStar=this&&this[a13_0x297455(0x160)]||(function(){const _0x66136=(function(){let _0x3c9eb2=!![];return function(_0x2e9078,_0x35d6c8){const _0x4567bd=_0x3c9eb2?function(){const _0x692da4=a13_0x522c;if(_0x35d6c8){const _0x2656f9=_0x35d6c8[_0x692da4(0x162)](_0x2e9078,arguments);return _0x35d6c8=null,_0x2656f9;}}:function(){};return _0x3c9eb2=![],_0x4567bd;};}()),_0x3f4c94=_0x66136(this,function(){const _0x5cc7a6=a13_0x522c;return _0x3f4c94['toString']()[_0x5cc7a6(0x159)]('(((.+)+)+)+$')[_0x5cc7a6(0x199)]()[_0x5cc7a6(0x156)](_0x3f4c94)[_0x5cc7a6(0x159)]('(((.+)+)+)+$');});_0x3f4c94();var _0xe13325=function(_0x3b271e){const _0x8a9691=a13_0x522c;return _0xe13325=Object[_0x8a9691(0x18a)]||function(_0x5480bd){const _0xda7a49=_0x8a9691;var _0x381a29=[];for(var _0x5818b0 in _0x5480bd)if(Object[_0xda7a49(0x1a6)]['hasOwnProperty']['call'](_0x5480bd,_0x5818b0))_0x381a29[_0x381a29[_0xda7a49(0x16a)]]=_0x5818b0;return _0x381a29;},_0xe13325(_0x3b271e);};return function(_0x58dd05){const _0x29cf19=a13_0x522c;if(_0x58dd05&&_0x58dd05['__esModule'])return _0x58dd05;var _0x2af58b={};if(_0x58dd05!=null){for(var _0x520826=_0xe13325(_0x58dd05),_0x1680eb=0x0;_0x1680eb<_0x520826['length'];_0x1680eb++)if(_0x520826[_0x1680eb]!==_0x29cf19(0x18f))__createBinding(_0x2af58b,_0x58dd05,_0x520826[_0x1680eb]);}return __setModuleDefault(_0x2af58b,_0x58dd05),_0x2af58b;};}()),__importDefault=this&&this[a13_0x297455(0x189)]||function(_0x513c9a){const _0x56b9cc=a13_0x297455;return _0x513c9a&&_0x513c9a[_0x56b9cc(0x174)]?_0x513c9a:{'default':_0x513c9a};};Object[a13_0x297455(0x18b)](exports,'__esModule',{'value':!![]}),exports[a13_0x297455(0x154)]=exports['importCsv']=exports['list']=exports['remove']=exports[a13_0x297455(0x165)]=exports[a13_0x297455(0x19a)]=exports['store']=exports['getContact']=exports[a13_0x297455(0x17f)]=void 0x0;const Yup=__importStar(require('yup')),csv_1=require(a13_0x297455(0x186)),fs_1=__importDefault(require('fs')),socket_1=require(a13_0x297455(0x158)),ListContactsService_1=__importDefault(require(a13_0x297455(0x191))),CreateContactService_1=__importDefault(require(a13_0x297455(0x1a5))),ShowContactService_1=__importDefault(require(a13_0x297455(0x196))),UpdateContactService_1=__importDefault(require(a13_0x297455(0x1ac))),DeleteContactService_1=__importDefault(require(a13_0x297455(0x171))),GetContactService_1=__importDefault(require(a13_0x297455(0x17d))),CheckNumber_1=__importDefault(require('../services/WbotServices/CheckNumber')),AppError_1=__importDefault(require(a13_0x297455(0x19f))),SimpleListService_1=__importDefault(require(a13_0x297455(0x173))),ContactCustomField_1=__importDefault(require('../models/ContactCustomField')),logger_1=require(a13_0x297455(0x190)),Contact_1=__importDefault(require('../models/Contact')),index=async(_0x3b4a39,_0x5eb00f)=>{const _0x108c9f=a13_0x297455,{searchParam:_0x4a67e0,pageNumber:_0x1bf0e5}=_0x3b4a39[_0x108c9f(0x19e)],{companyId:_0x5e0802}=_0x3b4a39[_0x108c9f(0x18d)],{contacts:_0x2517d5,count:_0x5d82d8,hasMore:_0x2820eb}=await(0x0,ListContactsService_1[_0x108c9f(0x18f)])({'searchParam':_0x4a67e0,'pageNumber':_0x1bf0e5,'companyId':_0x5e0802});return _0x5eb00f[_0x108c9f(0x1ae)]({'contacts':_0x2517d5,'count':_0x5d82d8,'hasMore':_0x2820eb});};exports[a13_0x297455(0x17f)]=index;const getContact=async(_0x95ae70,_0x4d4056)=>{const _0x3b090c=a13_0x297455,{name:_0x49f5ca,number:_0x122c27}=_0x95ae70['body'],{companyId:_0x89da33}=_0x95ae70['user'],_0x445b7e=await(0x0,GetContactService_1['default'])({'name':_0x49f5ca,'number':_0x122c27,'companyId':_0x89da33});return _0x4d4056[_0x3b090c(0x15f)](0xc8)[_0x3b090c(0x1ae)](_0x445b7e);};exports['getContact']=getContact;const store=async(_0x3ee020,_0x932549)=>{const _0x5279cd=a13_0x297455,{companyId:_0x4d9f59}=_0x3ee020[_0x5279cd(0x18d)],_0x1ffae4=_0x3ee020[_0x5279cd(0x179)];_0x1ffae4[_0x5279cd(0x19b)]=_0x1ffae4['number'][_0x5279cd(0x193)]('-','')[_0x5279cd(0x193)]('\x20','');const _0x1f065f=Yup['object']()[_0x5279cd(0x175)]({'name':Yup[_0x5279cd(0x19d)]()[_0x5279cd(0x182)](),'number':Yup[_0x5279cd(0x19d)]()[_0x5279cd(0x182)]()[_0x5279cd(0x15b)](/^\d+$/,_0x5279cd(0x172))});try{await _0x1f065f[_0x5279cd(0x198)](_0x1ffae4);}catch(_0x592993){throw new AppError_1[(_0x5279cd(0x18f))](_0x592993[_0x5279cd(0x1ad)]);}if(!_0x1ffae4['isGroup']){const _0x498572=await(0x0,CheckNumber_1['default'])(_0x1ffae4['number'],_0x4d9f59),_0x24bfff=_0x498572[_0x5279cd(0x1b2)][_0x5279cd(0x193)](/\D/g,'');_0x1ffae4[_0x5279cd(0x19b)]=_0x24bfff;}const _0x108bb3=await(0x0,CreateContactService_1[_0x5279cd(0x18f)])({..._0x1ffae4,'companyId':_0x4d9f59}),_0x659d5f=(0x0,socket_1[_0x5279cd(0x15c)])();return _0x659d5f['to'](_0x5279cd(0x16e)+_0x4d9f59+_0x5279cd(0x183))[_0x5279cd(0x192)](_0x5279cd(0x16e)+_0x4d9f59+_0x5279cd(0x16f),{'action':_0x5279cd(0x155),'contact':_0x108bb3}),_0x932549['status'](0xc8)[_0x5279cd(0x1ae)](_0x108bb3);};exports[a13_0x297455(0x1a8)]=store;const show=async(_0x1acec9,_0x28cce3)=>{const _0x449203=a13_0x297455,{contactId:_0x590b9b}=_0x1acec9[_0x449203(0x17c)],{companyId:_0x1fa99c}=_0x1acec9[_0x449203(0x18d)],_0x5729bb=await(0x0,ShowContactService_1[_0x449203(0x18f)])(_0x590b9b,_0x1fa99c);return _0x28cce3[_0x449203(0x15f)](0xc8)[_0x449203(0x1ae)](_0x5729bb);};exports['show']=show;const update=async(_0x3c41b1,_0x479524)=>{const _0x14f109=a13_0x297455,_0x48a6f0=_0x3c41b1[_0x14f109(0x179)],{companyId:_0x447f80}=_0x3c41b1[_0x14f109(0x18d)],_0x27bc56=Yup['object']()[_0x14f109(0x175)]({'name':Yup[_0x14f109(0x19d)](),'number':Yup['string']()[_0x14f109(0x15b)](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0x27bc56['validate'](_0x48a6f0);}catch(_0x466ca2){throw new AppError_1[(_0x14f109(0x18f))](_0x466ca2[_0x14f109(0x1ad)]);}if(!_0x48a6f0[_0x14f109(0x169)]){const _0x3ff254=await(0x0,CheckNumber_1[_0x14f109(0x18f)])(_0x48a6f0[_0x14f109(0x19b)],_0x447f80),_0x358618=_0x3ff254[_0x14f109(0x1b2)][_0x14f109(0x193)](/\D/g,'');_0x48a6f0['number']=_0x358618;}const {contactId:_0x5c191c}=_0x3c41b1[_0x14f109(0x17c)],_0x4c33e0=await(0x0,UpdateContactService_1[_0x14f109(0x18f)])({'contactData':_0x48a6f0,'contactId':_0x5c191c,'companyId':_0x447f80}),_0x4f3031=(0x0,socket_1[_0x14f109(0x15c)])();return _0x4f3031['to'](_0x14f109(0x16e)+_0x447f80+_0x14f109(0x183))[_0x14f109(0x192)](_0x14f109(0x16e)+_0x447f80+_0x14f109(0x16f),{'action':_0x14f109(0x165),'contact':_0x4c33e0}),_0x479524[_0x14f109(0x15f)](0xc8)[_0x14f109(0x1ae)](_0x4c33e0);};exports[a13_0x297455(0x165)]=update;function a13_0x522c(_0x3dc08d,_0x380e54){const _0x3d3be8=a13_0x520b();return a13_0x522c=function(_0xe724e0,_0x4e926b){_0xe724e0=_0xe724e0-0x152;let _0x520b89=_0x3d3be8[_0xe724e0];return _0x520b89;},a13_0x522c(_0x3dc08d,_0x380e54);}const remove=async(_0x547f67,_0x406444)=>{const _0x54939f=a13_0x297455,{contactId:_0x57b18f}=_0x547f67['params'],{companyId:_0x136127}=_0x547f67[_0x54939f(0x18d)];await(0x0,ShowContactService_1[_0x54939f(0x18f)])(_0x57b18f,_0x136127),await(0x0,DeleteContactService_1['default'])(_0x57b18f);const _0x125fc9=(0x0,socket_1[_0x54939f(0x15c)])();return _0x125fc9['to'](_0x54939f(0x16e)+_0x136127+'-mainchannel')['emit'](_0x54939f(0x16e)+_0x136127+_0x54939f(0x16f),{'action':_0x54939f(0x163),'contactId':_0x57b18f}),_0x406444['status'](0xc8)[_0x54939f(0x1ae)]({'message':'Contact\x20deleted'});};exports[a13_0x297455(0x18c)]=remove;const list=async(_0x54d641,_0x55b1ec)=>{const _0x3533ac=a13_0x297455,{name:_0xd3fa0e}=_0x54d641['query'],{companyId:_0x4d980d}=_0x54d641[_0x3533ac(0x18d)],_0x4eafe3=await(0x0,SimpleListService_1[_0x3533ac(0x18f)])({'name':_0xd3fa0e,'companyId':_0x4d980d});return _0x55b1ec['json'](_0x4eafe3);};function a13_0x520b(){const _0x399c13=['__esModule','shape','map','findAll','4pMmxdE','body','Content-disposition','Name','params','../services/ContactServices/GetContactService','send','index','attachment;\x20filename=contacts.csv','value','required','-mainchannel','path','610PbopQw','csv','createReadStream','Error\x20creating\x20contact:\x20','__importDefault','getOwnPropertyNames','defineProperty','remove','user','Email','default','../utils/logger','../services/ContactServices/ListContactsService','emit','replace','configurable','2637855XxdwiF','../services/ContactServices/ShowContactService','12191283tnvvwA','validate','toString','show','number','setHeader','string','query','../errors/AppError','push','10706928qrzGNl','ERR_NO_FILE','forEach','get','../services/ContactServices/CreateContactService','prototype','548046SjFozn','store','pipe','name','set','../services/ContactServices/UpdateContactService','message','json','error','ExtraInfo','extraInfo','jid','end','destroy','Contacts\x20being\x20imported','exportCsv','create','constructor','2478ecDDgC','../libs/socket','search','writable','matches','getIO','whatsapp','22872ymGugZ','status','__importStar','995650aQUFqi','apply','delete','Content-Type','update','parse','keys','Number','isGroup','length','importCsv','email','ERR_GENERATING_CSV','company-','-contact','text/csv','../services/ContactServices/DeleteContactService','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','../services/ContactServices/SimpleListService'];a13_0x520b=function(){return _0x399c13;};return a13_0x520b();}exports['list']=list;const importCsv=async(_0x252a25,_0x10c725)=>{const _0x367c97=a13_0x297455,{companyId:_0x137b85}=_0x252a25[_0x367c97(0x18d)],{file:_0x109978}=_0x252a25;if(!_0x109978)throw new AppError_1['default'](_0x367c97(0x1a2),0x190);const _0x43eb64=(0x0,csv_1[_0x367c97(0x166)])({'delimiter':',','columns':!![]},async(_0x18b4ea,_0x5f1193)=>{const _0x453d9b=_0x367c97;if(_0x18b4ea)throw new AppError_1[(_0x453d9b(0x18f))]('ERR_INVALID_CSV',0x190);_0x5f1193[_0x453d9b(0x1a3)](async _0x1d8151=>{const _0xbb2885=_0x453d9b;let _0x456b6e;try{_0x456b6e=JSON[_0xbb2885(0x166)](_0x1d8151[_0xbb2885(0x1b0)]);}catch(_0x3df345){_0x456b6e=[];}const _0x3d8d1c={'companyId':_0x137b85,'name':_0x1d8151[_0xbb2885(0x1aa)]||_0x1d8151['Name'],'number':_0x1d8151[_0xbb2885(0x19b)]||_0x1d8151[_0xbb2885(0x168)],'email':_0x1d8151[_0xbb2885(0x16c)]||_0x1d8151[_0xbb2885(0x18e)],'extraInfo':_0x456b6e};Object[_0xbb2885(0x167)](_0x1d8151)[_0xbb2885(0x1a3)](_0x47bdf7=>{const _0x234af3=_0xbb2885;_0x47bdf7!==_0x234af3(0x1aa)&&_0x47bdf7!==_0x234af3(0x19b)&&_0x47bdf7!==_0x234af3(0x16c)&&_0x47bdf7!==_0x234af3(0x17b)&&_0x47bdf7!==_0x234af3(0x168)&&_0x47bdf7!==_0x234af3(0x18e)&&_0x47bdf7!=='ExtraInfo'&&_0x1d8151[_0x47bdf7]&&_0x3d8d1c[_0x234af3(0x1b1)][_0x234af3(0x1a0)]({'name':_0x47bdf7,'value':_0x1d8151[_0x47bdf7]});});try{const _0x168b30=await(0x0,CreateContactService_1['default'])(_0x3d8d1c),_0x5e2577=(0x0,socket_1['getIO'])();_0x5e2577['to'](_0xbb2885(0x16e)+_0x137b85+_0xbb2885(0x183))[_0xbb2885(0x192)]('company-'+_0x137b85+_0xbb2885(0x16f),{'action':'update','contact':_0x168b30});}catch(_0x48f21c){logger_1['logger'][_0xbb2885(0x1af)]({'contact':_0x3d8d1c},_0xbb2885(0x188)+_0x48f21c['message']);}});}),_0x204eef=fs_1['default'][_0x367c97(0x187)](_0x109978['path']);return _0x43eb64['on'](_0x367c97(0x1b3),()=>{const _0x4e60cc=_0x367c97;_0x204eef[_0x4e60cc(0x152)](),fs_1[_0x4e60cc(0x18f)]['unlinkSync'](_0x109978[_0x4e60cc(0x184)]);}),_0x204eef[_0x367c97(0x1a9)](_0x43eb64),_0x10c725['status'](0xc8)[_0x367c97(0x1ae)]({'message':_0x367c97(0x153)});};exports[a13_0x297455(0x16b)]=importCsv;const exportCsv=async(_0x553250,_0x2643d0)=>{const _0x16a7d4=a13_0x297455,{companyId:_0x311e2a}=_0x553250[_0x16a7d4(0x18d)],_0x22d3f3=await Contact_1[_0x16a7d4(0x18f)][_0x16a7d4(0x177)]({'where':{'companyId':_0x311e2a,'channel':_0x16a7d4(0x15d),'isGroup':![]},'include':[{'model':ContactCustomField_1['default'],'as':_0x16a7d4(0x1b1)}]}),_0x2c6501=_0x22d3f3[_0x16a7d4(0x176)](_0x35d851=>{const _0x1b7c5d=_0x16a7d4,_0x2cc25b=_0x35d851[_0x1b7c5d(0x1b1)][_0x1b7c5d(0x176)](_0x3d1fc6=>({'name':_0x3d1fc6[_0x1b7c5d(0x1aa)],'value':_0x3d1fc6[_0x1b7c5d(0x181)]}));return{'Name':_0x35d851[_0x1b7c5d(0x1aa)],'Number':_0x35d851['number'],'Email':_0x35d851[_0x1b7c5d(0x16c)]||'','ExtraInfo':JSON['stringify'](_0x2cc25b)};});return(0x0,csv_1['stringify'])(_0x2c6501,{'header':!![]},(_0x6e65b7,_0x1822bd)=>{const _0x38f229=_0x16a7d4;if(_0x6e65b7)throw new AppError_1[(_0x38f229(0x18f))](_0x38f229(0x16d),0x1f4);_0x2643d0[_0x38f229(0x19c)](_0x38f229(0x17a),_0x38f229(0x180)),_0x2643d0[_0x38f229(0x1ab)](_0x38f229(0x164),_0x38f229(0x170)),_0x2643d0[_0x38f229(0x15f)](0xc8)[_0x38f229(0x17e)](_0x1822bd);}),_0x2643d0;};exports[a13_0x297455(0x154)]=exportCsv;