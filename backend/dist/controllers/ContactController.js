'use strict';const a13_0x3d1acc=a13_0x3a30;function a13_0x3a30(_0x1dc8ec,_0x4fdd54){const _0x3d81d3=a13_0x5b3a();return a13_0x3a30=function(_0x50fa9a,_0x4b93e9){_0x50fa9a=_0x50fa9a-0x1ef;let _0x5b3ad9=_0x3d81d3[_0x50fa9a];return _0x5b3ad9;},a13_0x3a30(_0x1dc8ec,_0x4fdd54);}(function(_0x4dc6eb,_0x337cc8){const _0x418fbf=a13_0x3a30,_0xe04ff=_0x4dc6eb();while(!![]){try{const _0x405ba1=parseInt(_0x418fbf(0x22e))/0x1+-parseInt(_0x418fbf(0x204))/0x2*(parseInt(_0x418fbf(0x256))/0x3)+parseInt(_0x418fbf(0x242))/0x4+-parseInt(_0x418fbf(0x252))/0x5+parseInt(_0x418fbf(0x1f6))/0x6+-parseInt(_0x418fbf(0x213))/0x7+parseInt(_0x418fbf(0x201))/0x8;if(_0x405ba1===_0x337cc8)break;else _0xe04ff['push'](_0xe04ff['shift']());}catch(_0x3e93d9){_0xe04ff['push'](_0xe04ff['shift']());}}}(a13_0x5b3a,0xbe342));var __createBinding=this&&this[a13_0x3d1acc(0x1fe)]||(Object['create']?function(_0x41d936,_0x4b5832,_0x959d81,_0x31a856){const _0x59e211=a13_0x3d1acc;if(_0x31a856===undefined)_0x31a856=_0x959d81;var _0x15a290=Object[_0x59e211(0x23a)](_0x4b5832,_0x959d81);(!_0x15a290||('get'in _0x15a290?!_0x4b5832[_0x59e211(0x253)]:_0x15a290[_0x59e211(0x222)]||_0x15a290[_0x59e211(0x246)]))&&(_0x15a290={'enumerable':!![],'get':function(){return _0x4b5832[_0x959d81];}}),Object[_0x59e211(0x23e)](_0x41d936,_0x31a856,_0x15a290);}:function(_0x292a50,_0x35f399,_0x37e3ef,_0x2fcde8){if(_0x2fcde8===undefined)_0x2fcde8=_0x37e3ef;_0x292a50[_0x2fcde8]=_0x35f399[_0x37e3ef];}),__setModuleDefault=this&&this[a13_0x3d1acc(0x211)]||(Object[a13_0x3d1acc(0x233)]?function(_0x45bd3e,_0xab625){const _0xa3f4c1=a13_0x3d1acc;Object[_0xa3f4c1(0x23e)](_0x45bd3e,_0xa3f4c1(0x234),{'enumerable':!![],'value':_0xab625});}:function(_0x378c1c,_0x299bc7){_0x378c1c['default']=_0x299bc7;}),__importStar=this&&this[a13_0x3d1acc(0x23d)]||(function(){const _0x340f03=(function(){let _0x12a168=!![];return function(_0x48bb87,_0x4e0910){const _0x484979=_0x12a168?function(){const _0x161b6b=a13_0x3a30;if(_0x4e0910){const _0xa6d16d=_0x4e0910[_0x161b6b(0x22f)](_0x48bb87,arguments);return _0x4e0910=null,_0xa6d16d;}}:function(){};return _0x12a168=![],_0x484979;};}()),_0x42aed4=_0x340f03(this,function(){const _0x454cbf=a13_0x3a30;return _0x42aed4['toString']()[_0x454cbf(0x23c)](_0x454cbf(0x247))[_0x454cbf(0x241)]()[_0x454cbf(0x1f5)](_0x42aed4)[_0x454cbf(0x23c)](_0x454cbf(0x247));});_0x42aed4();var _0x14dc5b=function(_0x547ea2){const _0xf6f2de=a13_0x3a30;return _0x14dc5b=Object[_0xf6f2de(0x226)]||function(_0x1d41e0){const _0x33d1a4=_0xf6f2de;var _0x4c078a=[];for(var _0x36531e in _0x1d41e0)if(Object['prototype'][_0x33d1a4(0x1ef)][_0x33d1a4(0x205)](_0x1d41e0,_0x36531e))_0x4c078a[_0x4c078a[_0x33d1a4(0x236)]]=_0x36531e;return _0x4c078a;},_0x14dc5b(_0x547ea2);};return function(_0x223bef){const _0x57c562=a13_0x3a30;if(_0x223bef&&_0x223bef['__esModule'])return _0x223bef;var _0x4e47ff={};if(_0x223bef!=null){for(var _0x3831b7=_0x14dc5b(_0x223bef),_0x3ec281=0x0;_0x3ec281<_0x3831b7[_0x57c562(0x236)];_0x3ec281++)if(_0x3831b7[_0x3ec281]!==_0x57c562(0x234))__createBinding(_0x4e47ff,_0x223bef,_0x3831b7[_0x3ec281]);}return __setModuleDefault(_0x4e47ff,_0x223bef),_0x4e47ff;};}()),__importDefault=this&&this[a13_0x3d1acc(0x214)]||function(_0x202a27){const _0x12add1=a13_0x3d1acc;return _0x202a27&&_0x202a27[_0x12add1(0x253)]?_0x202a27:{'default':_0x202a27};};Object[a13_0x3d1acc(0x23e)](exports,a13_0x3d1acc(0x253),{'value':!![]}),exports[a13_0x3d1acc(0x223)]=exports[a13_0x3d1acc(0x20d)]=exports[a13_0x3d1acc(0x22b)]=exports[a13_0x3d1acc(0x1fa)]=exports[a13_0x3d1acc(0x221)]=exports['show']=exports[a13_0x3d1acc(0x24c)]=exports[a13_0x3d1acc(0x225)]=exports['index']=void 0x0;const Yup=__importStar(require(a13_0x3d1acc(0x202))),csv_1=require('csv'),fs_1=__importDefault(require('fs')),socket_1=require(a13_0x3d1acc(0x244)),ListContactsService_1=__importDefault(require(a13_0x3d1acc(0x243))),CreateContactService_1=__importDefault(require(a13_0x3d1acc(0x1f9))),ShowContactService_1=__importDefault(require(a13_0x3d1acc(0x219))),UpdateContactService_1=__importDefault(require('../services/ContactServices/UpdateContactService')),DeleteContactService_1=__importDefault(require('../services/ContactServices/DeleteContactService')),GetContactService_1=__importDefault(require(a13_0x3d1acc(0x1ff))),CheckNumber_1=__importDefault(require(a13_0x3d1acc(0x20a))),AppError_1=__importDefault(require(a13_0x3d1acc(0x227))),SimpleListService_1=__importDefault(require(a13_0x3d1acc(0x235))),ContactCustomField_1=__importDefault(require(a13_0x3d1acc(0x21b))),logger_1=require(a13_0x3d1acc(0x200)),Contact_1=__importDefault(require(a13_0x3d1acc(0x240))),index=async(_0x34badc,_0x5d2724)=>{const _0x1a6bf1=a13_0x3d1acc,{searchParam:_0x1ce11b,pageNumber:_0x62d4a6}=_0x34badc[_0x1a6bf1(0x24b)],{companyId:_0x9e7da5}=_0x34badc['user'],{contacts:_0x20a380,count:_0x1ed78a,hasMore:_0x519588}=await(0x0,ListContactsService_1[_0x1a6bf1(0x234)])({'searchParam':_0x1ce11b,'pageNumber':_0x62d4a6,'companyId':_0x9e7da5});return _0x5d2724[_0x1a6bf1(0x230)]({'contacts':_0x20a380,'count':_0x1ed78a,'hasMore':_0x519588});};exports[a13_0x3d1acc(0x21f)]=index;const getContact=async(_0x302e5c,_0x3bbdd3)=>{const _0x5582ba=a13_0x3d1acc,{name:_0x59aa79,number:_0x4b8fa0}=_0x302e5c[_0x5582ba(0x1f3)],{companyId:_0x1ffb87}=_0x302e5c[_0x5582ba(0x209)],_0x22d5bf=await(0x0,GetContactService_1[_0x5582ba(0x234)])({'name':_0x59aa79,'number':_0x4b8fa0,'companyId':_0x1ffb87});return _0x3bbdd3[_0x5582ba(0x1f8)](0xc8)['json'](_0x22d5bf);};exports[a13_0x3d1acc(0x225)]=getContact;const store=async(_0x40401c,_0x21092d)=>{const _0xb962d2=a13_0x3d1acc,{companyId:_0x356094}=_0x40401c[_0xb962d2(0x209)],_0xe1bf30=_0x40401c[_0xb962d2(0x1f3)];_0xe1bf30[_0xb962d2(0x23f)]=_0xe1bf30[_0xb962d2(0x23f)]['replace']('-','')[_0xb962d2(0x24d)]('\x20','');const _0x178207=Yup[_0xb962d2(0x249)]()[_0xb962d2(0x239)]({'name':Yup['string']()[_0xb962d2(0x21a)](),'number':Yup[_0xb962d2(0x24a)]()[_0xb962d2(0x21a)]()[_0xb962d2(0x24e)](/^\d+$/,_0xb962d2(0x24f))});try{await _0x178207['validate'](_0xe1bf30);}catch(_0x5743fd){throw new AppError_1[(_0xb962d2(0x234))](_0x5743fd['message']);}if(!_0xe1bf30[_0xb962d2(0x21e)]){const _0x3b35e3=await(0x0,CheckNumber_1[_0xb962d2(0x234)])(_0xe1bf30[_0xb962d2(0x23f)],_0x356094),_0x22434b=_0x3b35e3[_0xb962d2(0x238)]['replace'](/\D/g,'');_0xe1bf30[_0xb962d2(0x23f)]=_0x22434b;}const _0x1bc96e=await(0x0,CreateContactService_1[_0xb962d2(0x234)])({..._0xe1bf30,'companyId':_0x356094}),_0x1c8322=(0x0,socket_1[_0xb962d2(0x257)])();return _0x1c8322['to'](_0xb962d2(0x1fb)+_0x356094+_0xb962d2(0x21c))[_0xb962d2(0x22c)](_0xb962d2(0x1fb)+_0x356094+_0xb962d2(0x245),{'action':_0xb962d2(0x233),'contact':_0x1bc96e}),_0x21092d[_0xb962d2(0x1f8)](0xc8)['json'](_0x1bc96e);};exports['store']=store;const show=async(_0x1500bf,_0x2df09b)=>{const _0x281189=a13_0x3d1acc,{contactId:_0x4a6911}=_0x1500bf['params'],{companyId:_0xdf793d}=_0x1500bf[_0x281189(0x209)],_0xc1a7e7=await(0x0,ShowContactService_1[_0x281189(0x234)])(_0x4a6911,_0xdf793d);return _0x2df09b['status'](0xc8)[_0x281189(0x230)](_0xc1a7e7);};exports[a13_0x3d1acc(0x203)]=show;const update=async(_0x4fd1f3,_0x4c51f5)=>{const _0x7872a0=a13_0x3d1acc,_0x5b03ea=_0x4fd1f3[_0x7872a0(0x1f3)],{companyId:_0x4918ec}=_0x4fd1f3[_0x7872a0(0x209)],_0x5a83a0=Yup[_0x7872a0(0x249)]()['shape']({'name':Yup[_0x7872a0(0x24a)](),'number':Yup['string']()[_0x7872a0(0x24e)](/^\d+$/,_0x7872a0(0x24f))});try{await _0x5a83a0[_0x7872a0(0x206)](_0x5b03ea);}catch(_0x308d54){throw new AppError_1['default'](_0x308d54[_0x7872a0(0x20c)]);}if(!_0x5b03ea[_0x7872a0(0x21e)]){const _0x3193ec=await(0x0,CheckNumber_1[_0x7872a0(0x234)])(_0x5b03ea[_0x7872a0(0x23f)],_0x4918ec),_0xb5403b=_0x3193ec[_0x7872a0(0x238)][_0x7872a0(0x24d)](/\D/g,'');_0x5b03ea[_0x7872a0(0x23f)]=_0xb5403b;}const {contactId:_0x1688f3}=_0x4fd1f3[_0x7872a0(0x248)],_0x4a9b0f=await(0x0,UpdateContactService_1['default'])({'contactData':_0x5b03ea,'contactId':_0x1688f3,'companyId':_0x4918ec}),_0x974b9d=(0x0,socket_1[_0x7872a0(0x257)])();return _0x974b9d['to'](_0x7872a0(0x1fb)+_0x4918ec+_0x7872a0(0x21c))['emit'](_0x7872a0(0x1fb)+_0x4918ec+_0x7872a0(0x245),{'action':_0x7872a0(0x221),'contact':_0x4a9b0f}),_0x4c51f5['status'](0xc8)[_0x7872a0(0x230)](_0x4a9b0f);};exports[a13_0x3d1acc(0x221)]=update;const remove=async(_0x46bcab,_0x37ccf2)=>{const _0x2ed954=a13_0x3d1acc,{contactId:_0x5e7764}=_0x46bcab[_0x2ed954(0x248)],{companyId:_0x3a254b}=_0x46bcab[_0x2ed954(0x209)];await(0x0,ShowContactService_1[_0x2ed954(0x234)])(_0x5e7764,_0x3a254b),await(0x0,DeleteContactService_1['default'])(_0x5e7764);const _0x160554=(0x0,socket_1[_0x2ed954(0x257)])();return _0x160554['to'](_0x2ed954(0x1fb)+_0x3a254b+_0x2ed954(0x21c))['emit']('company-'+_0x3a254b+_0x2ed954(0x245),{'action':_0x2ed954(0x250),'contactId':_0x5e7764}),_0x37ccf2[_0x2ed954(0x1f8)](0xc8)[_0x2ed954(0x230)]({'message':_0x2ed954(0x220)});};exports[a13_0x3d1acc(0x1fa)]=remove;const list=async(_0x2a4794,_0x4e7db7)=>{const _0x2edfad=a13_0x3d1acc,{name:_0x186115}=_0x2a4794[_0x2edfad(0x24b)],{companyId:_0x2cb570}=_0x2a4794[_0x2edfad(0x209)],_0xf415eb=await(0x0,SimpleListService_1[_0x2edfad(0x234)])({'name':_0x186115,'companyId':_0x2cb570});return _0x4e7db7[_0x2edfad(0x230)](_0xf415eb);};exports[a13_0x3d1acc(0x22b)]=list;const importCsv=async(_0x4079cf,_0x4e80d5)=>{const _0x28fd4f=a13_0x3d1acc,{companyId:_0x5626fa}=_0x4079cf[_0x28fd4f(0x209)],{file:_0x3375fe}=_0x4079cf;if(!_0x3375fe)throw new AppError_1[(_0x28fd4f(0x234))](_0x28fd4f(0x254),0x190);const _0x1cf164=(0x0,csv_1[_0x28fd4f(0x22a)])({'delimiter':',','columns':!![]},async(_0x195ee9,_0x584810)=>{const _0x57150d=_0x28fd4f;if(_0x195ee9)throw new AppError_1[(_0x57150d(0x234))](_0x57150d(0x1fd),0x190);_0x584810[_0x57150d(0x23b)](async _0x131fec=>{const _0x4dfddf=_0x57150d;let _0x43c0d2;try{_0x43c0d2=JSON[_0x4dfddf(0x22a)](_0x131fec[_0x4dfddf(0x20f)]);}catch(_0x57e968){_0x43c0d2=[];}const _0x59e5bb={'companyId':_0x5626fa,'name':_0x131fec['name']||_0x131fec[_0x4dfddf(0x215)],'number':_0x131fec[_0x4dfddf(0x23f)]||_0x131fec[_0x4dfddf(0x251)],'email':_0x131fec[_0x4dfddf(0x232)]||_0x131fec['Email'],'extraInfo':_0x43c0d2};Object[_0x4dfddf(0x208)](_0x131fec)['forEach'](_0x41ad54=>{const _0x564bab=_0x4dfddf;_0x41ad54!==_0x564bab(0x1fc)&&_0x41ad54!==_0x564bab(0x23f)&&_0x41ad54!==_0x564bab(0x232)&&_0x41ad54!==_0x564bab(0x215)&&_0x41ad54!==_0x564bab(0x251)&&_0x41ad54!==_0x564bab(0x255)&&_0x41ad54!=='ExtraInfo'&&_0x131fec[_0x41ad54]&&_0x59e5bb['extraInfo'][_0x564bab(0x231)]({'name':_0x41ad54,'value':_0x131fec[_0x41ad54]});});try{const _0x176182=await(0x0,CreateContactService_1[_0x4dfddf(0x234)])(_0x59e5bb),_0x75d0b2=(0x0,socket_1['getIO'])();_0x75d0b2['to']('company-'+_0x5626fa+_0x4dfddf(0x21c))['emit'](_0x4dfddf(0x1fb)+_0x5626fa+_0x4dfddf(0x245),{'action':_0x4dfddf(0x221),'contact':_0x176182});}catch(_0x29003f){logger_1[_0x4dfddf(0x224)][_0x4dfddf(0x216)]({'contact':_0x59e5bb},_0x4dfddf(0x20e)+_0x29003f['message']);}});}),_0x94638d=fs_1[_0x28fd4f(0x234)][_0x28fd4f(0x237)](_0x3375fe[_0x28fd4f(0x212)]);return _0x1cf164['on']('end',()=>{const _0x47e43b=_0x28fd4f;_0x94638d[_0x47e43b(0x217)](),fs_1[_0x47e43b(0x234)][_0x47e43b(0x228)](_0x3375fe[_0x47e43b(0x212)]);}),_0x94638d[_0x28fd4f(0x207)](_0x1cf164),_0x4e80d5['status'](0xc8)[_0x28fd4f(0x230)]({'message':_0x28fd4f(0x218)});};exports[a13_0x3d1acc(0x20d)]=importCsv;function a13_0x5b3a(){const _0x162fba=['getOwnPropertyDescriptor','forEach','search','__importStar','defineProperty','number','../models/Contact','toString','3498520NPdVBx','../services/ContactServices/ListContactsService','../libs/socket','-contact','configurable','(((.+)+)+)+$','params','object','string','query','store','replace','matches','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','delete','Number','2338965WEKPNa','__esModule','ERR_NO_FILE','Email','1664511XTuxbI','getIO','hasOwnProperty','map','set','attachment;\x20filename=contacts.csv','body','Content-disposition','constructor','2096052uhdmHv','text/csv','status','../services/ContactServices/CreateContactService','remove','company-','name','ERR_INVALID_CSV','__createBinding','../services/ContactServices/GetContactService','../utils/logger','5632376gVEohU','yup','show','2qANztV','call','validate','pipe','keys','user','../services/WbotServices/CheckNumber','send','message','importCsv','Error\x20creating\x20contact:\x20','ExtraInfo','setHeader','__setModuleDefault','path','7519407VXmyiu','__importDefault','Name','error','destroy','Contacts\x20being\x20imported','../services/ContactServices/ShowContactService','required','../models/ContactCustomField','-mainchannel','extraInfo','isGroup','index','Contact\x20deleted','update','writable','exportCsv','logger','getContact','getOwnPropertyNames','../errors/AppError','unlinkSync','findAll','parse','list','emit','ERR_GENERATING_CSV','947886mqPMNw','apply','json','push','email','create','default','../services/ContactServices/SimpleListService','length','createReadStream','jid','shape'];a13_0x5b3a=function(){return _0x162fba;};return a13_0x5b3a();}const exportCsv=async(_0x52005c,_0x374a8c)=>{const _0x48451a=a13_0x3d1acc,{companyId:_0x5bc28a}=_0x52005c[_0x48451a(0x209)],_0x2b2dab=await Contact_1[_0x48451a(0x234)][_0x48451a(0x229)]({'where':{'companyId':_0x5bc28a,'channel':'whatsapp','isGroup':![]},'include':[{'model':ContactCustomField_1['default'],'as':'extraInfo'}]}),_0x886cc6=_0x2b2dab[_0x48451a(0x1f0)](_0x2bb519=>{const _0x234753=_0x48451a,_0xc5a9d6=_0x2bb519[_0x234753(0x21d)][_0x234753(0x1f0)](_0x38bb02=>({'name':_0x38bb02['name'],'value':_0x38bb02['value']}));return{'Name':_0x2bb519[_0x234753(0x1fc)],'Number':_0x2bb519[_0x234753(0x23f)],'Email':_0x2bb519[_0x234753(0x232)]||'','ExtraInfo':JSON['stringify'](_0xc5a9d6)};});return(0x0,csv_1['stringify'])(_0x886cc6,{'header':!![]},(_0x2ac8b4,_0x641b62)=>{const _0x51e337=_0x48451a;if(_0x2ac8b4)throw new AppError_1[(_0x51e337(0x234))](_0x51e337(0x22d),0x1f4);_0x374a8c[_0x51e337(0x210)](_0x51e337(0x1f4),_0x51e337(0x1f2)),_0x374a8c[_0x51e337(0x1f1)]('Content-Type',_0x51e337(0x1f7)),_0x374a8c[_0x51e337(0x1f8)](0xc8)[_0x51e337(0x20b)](_0x641b62);}),_0x374a8c;};exports[a13_0x3d1acc(0x223)]=exportCsv;