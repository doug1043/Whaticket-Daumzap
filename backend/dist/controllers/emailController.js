const a17_0x296d79=a17_0x5050;(function(_0x5d5318,_0x55c427){const _0x49ab17=a17_0x5050,_0x3ecccd=_0x5d5318();while(!![]){try{const _0x147b4a=-parseInt(_0x49ab17(0x11b))/0x1*(-parseInt(_0x49ab17(0x12f))/0x2)+-parseInt(_0x49ab17(0x12b))/0x3*(-parseInt(_0x49ab17(0x126))/0x4)+-parseInt(_0x49ab17(0x141))/0x5+-parseInt(_0x49ab17(0x11e))/0x6*(-parseInt(_0x49ab17(0x119))/0x7)+-parseInt(_0x49ab17(0x149))/0x8*(parseInt(_0x49ab17(0x13b))/0x9)+parseInt(_0x49ab17(0x13e))/0xa+parseInt(_0x49ab17(0x142))/0xb*(-parseInt(_0x49ab17(0x137))/0xc);if(_0x147b4a===_0x55c427)break;else _0x3ecccd['push'](_0x3ecccd['shift']());}catch(_0x178e93){_0x3ecccd['push'](_0x3ecccd['shift']());}}}(a17_0xeb10,0xa2f43));function a17_0x5050(_0x4f6fee,_0x285d66){const _0xb18e1c=a17_0xeb10();return a17_0x5050=function(_0x2d64e8,_0x56bad0){_0x2d64e8=_0x2d64e8-0x10a;let _0xeb1045=_0xb18e1c[_0x2d64e8];return _0xeb1045;},a17_0x5050(_0x4f6fee,_0x285d66);}const a17_0x56bad0=(function(){let _0x7718d8=!![];return function(_0x419a83,_0x2ed8d3){const _0x2e546c=_0x7718d8?function(){if(_0x2ed8d3){const _0x131179=_0x2ed8d3['apply'](_0x419a83,arguments);return _0x2ed8d3=null,_0x131179;}}:function(){};return _0x7718d8=![],_0x2e546c;};}()),a17_0x2d64e8=a17_0x56bad0(this,function(){const _0x158530=a17_0x5050;return a17_0x2d64e8[_0x158530(0x140)]()[_0x158530(0x139)](_0x158530(0x115))[_0x158530(0x140)]()['constructor'](a17_0x2d64e8)[_0x158530(0x139)](_0x158530(0x115));});a17_0x2d64e8();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x407064){const _0x4257dc=a17_0x5050;return _0x407064&&_0x407064[_0x4257dc(0x122)]?_0x407064:{'default':_0x407064};};Object[a17_0x296d79(0x145)](exports,'__esModule',{'value':!![]}),exports['agendarEnvioEmail']=exports[a17_0x296d79(0x147)]=exports['listarEmailsEnviados']=exports[a17_0x296d79(0x136)]=void 0x0;const EmailService_1=require(a17_0x296d79(0x123)),Email_1=__importDefault(require(a17_0x296d79(0x13a))),moment_1=__importDefault(require(a17_0x296d79(0x10f))),node_cron_1=__importDefault(require(a17_0x296d79(0x125))),sequelize_1=require('sequelize'),winston_1=__importDefault(require('winston')),logger=winston_1[a17_0x296d79(0x121)][a17_0x296d79(0x117)]({'level':a17_0x296d79(0x13c),'format':winston_1[a17_0x296d79(0x121)][a17_0x296d79(0x12e)][a17_0x296d79(0x14a)](winston_1[a17_0x296d79(0x121)][a17_0x296d79(0x12e)][a17_0x296d79(0x127)](),winston_1[a17_0x296d79(0x121)][a17_0x296d79(0x12e)][a17_0x296d79(0x146)](({timestamp:_0xb22e22,level:_0x30d3ee,message:_0x468bea})=>{return _0xb22e22+'\x20'+_0x30d3ee+':\x20'+_0x468bea;})),'transports':[new winston_1[(a17_0x296d79(0x121))][(a17_0x296d79(0x10c))]['Console']()]}),enviarEmail=async(_0x250e7c,_0x3951e3)=>{const _0x20e211=a17_0x296d79;try{const _0x4c7c73=_0x250e7c['user'][_0x20e211(0x135)],{email:_0x1e1d12,tokenSenha:_0x44b75e,assunto:_0x47f438,mensagem:_0x610d5}=_0x250e7c[_0x20e211(0x144)],_0x3608c7=(0x0,moment_1[_0x20e211(0x121)])()[_0x20e211(0x110)](0x1,_0x20e211(0x12c))['format'](_0x20e211(0x143)),_0x34c5d6=await(0x0,EmailService_1[_0x20e211(0x130)])(_0x4c7c73,_0x1e1d12,_0x44b75e,_0x47f438,_0x610d5,_0x3608c7);if(_0x34c5d6[_0x20e211(0x12d)])return _0x3951e3[_0x20e211(0x116)](0x1f4)[_0x20e211(0x133)]({'error':_0x34c5d6['error']});_0x3951e3[_0x20e211(0x116)](0xc8)[_0x20e211(0x133)]({'message':_0x20e211(0x11f)});}catch(_0xaa6456){console[_0x20e211(0x12d)](_0x20e211(0x128),_0xaa6456),_0x3951e3[_0x20e211(0x116)](0x1f4)[_0x20e211(0x133)]({'error':_0x20e211(0x118)});}};exports[a17_0x296d79(0x136)]=enviarEmail;const listarEmailsEnviados=async(_0x5c562f,_0x280718)=>{const _0x6f5eb4=a17_0x296d79;try{const _0x3f6569=await Email_1['default'][_0x6f5eb4(0x129)]({'where':{'companyId':_0x5c562f[_0x6f5eb4(0x13d)]['companyId'],'scheduled':null,'sendAt':null}});_0x280718['status'](0xc8)[_0x6f5eb4(0x133)](_0x3f6569);}catch(_0x29fc86){console['error'](_0x6f5eb4(0x114),_0x29fc86),_0x280718[_0x6f5eb4(0x116)](0x1f4)[_0x6f5eb4(0x133)]({'error':'Erro\x20ao\x20listar\x20e-mails\x20enviados'});}};exports['listarEmailsEnviados']=listarEmailsEnviados;const listarEmailsAgendados=async(_0x110cd0,_0x25465b)=>{const _0x37727f=a17_0x296d79;try{const _0xa90f5c=await Email_1['default'][_0x37727f(0x129)]({'where':{'companyId':_0x110cd0[_0x37727f(0x13d)][_0x37727f(0x135)],'scheduled':!![],'sendAt':{[sequelize_1['Op']['not']]:null}}});_0x25465b[_0x37727f(0x116)](0xc8)[_0x37727f(0x133)](_0xa90f5c);}catch(_0x52ef8b){console[_0x37727f(0x12d)](_0x37727f(0x132),_0x52ef8b),_0x25465b['status'](0x1f4)[_0x37727f(0x133)]({'error':_0x37727f(0x138)});}};function a17_0xeb10(){const _0x67c273=['status','createLogger','Erro\x20ao\x20enviar\x20e-mail','1246mJoFPZ','Erro\x20ao\x20enviar\x20e-mail\x20agendado\x20para:\x20','1CAAwOQ','toDate','*/30\x20*\x20*\x20*\x20*\x20*','25332uNkert','E-mail\x20enviado\x20com\x20sucesso','schedule','default','__esModule','../services/EmailService/EmailService','toISOString','node-cron','1005948dsZVWJ','timestamp','Erro\x20ao\x20enviar\x20e-mail:','findAll',',\x20erro:\x20','9FnDoHZ','hour','error','format','945830hVbvex','SendMail','sender','Erro\x20ao\x20listar\x20e-mails\x20agendados:','json','lte','companyId','enviarEmail','10236XOilEI','Erro\x20ao\x20listar\x20e-mails\x20agendados','search','../models/Email','8543529ZpBkEE','info','user','12060880GoTtSB','sendAt','toString','5823855cqJkTq','5203HqkBIG','YYYY-MM-DDTHH:mm','body','defineProperty','printf','listarEmailsAgendados','E-mail\x20agendado\x20enviado\x20com\x20sucesso\x20para:\x20','8tFKGSd','combine','A\x20data\x20de\x20envio\x20deve\x20ser\x20no\x20futuro','email','transports','assunto','Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail:','moment','add','update','agendarEnvioEmail','Erro\x20ao\x20enviar\x20agendamentos\x20pendentes:','Erro\x20ao\x20listar\x20e-mails\x20enviados:','(((.+)+)+)+$'];a17_0xeb10=function(){return _0x67c273;};return a17_0xeb10();}exports['listarEmailsAgendados']=listarEmailsAgendados;const agendarEnvioEmail=async(_0x43815e,_0x3ef8f3)=>{const _0x2b544a=a17_0x296d79;try{const _0x4db504=_0x43815e[_0x2b544a(0x13d)][_0x2b544a(0x135)],{recipient:_0x3110c5,subject:_0x217d42,message:_0xacc9dd,sendAt:_0x5c71fd}=_0x43815e[_0x2b544a(0x144)],_0x270629=new Date(_0x5c71fd);if(_0x270629<=new Date())return _0x3ef8f3['status'](0x190)[_0x2b544a(0x133)]({'error':_0x2b544a(0x10a)});await Email_1['default']['create']({'sender':_0x43815e[_0x2b544a(0x144)][_0x2b544a(0x10b)],'subject':_0x43815e[_0x2b544a(0x144)][_0x2b544a(0x10d)],'message':_0x43815e[_0x2b544a(0x144)]['mensagem'],'companyId':_0x4db504,'scheduled':!![],'sendAt':new Date(_0x5c71fd)}),_0x3ef8f3['status'](0xc8)[_0x2b544a(0x133)]({'message':'E-mail\x20agendado\x20com\x20sucesso'});}catch(_0x5efbcf){console[_0x2b544a(0x12d)](_0x2b544a(0x10e),_0x5efbcf),_0x3ef8f3[_0x2b544a(0x116)](0x1f4)[_0x2b544a(0x133)]({'error':'Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail'});}};exports[a17_0x296d79(0x112)]=agendarEnvioEmail;const enviarAgendamentosPendentes=async()=>{const _0x36bd3c=a17_0x296d79;try{const _0x16327b=(0x0,moment_1[_0x36bd3c(0x121)])(),_0x3f3b16=await Email_1[_0x36bd3c(0x121)]['findAll']({'where':{'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x36bd3c(0x134)]]:_0x16327b[_0x36bd3c(0x11c)]()}}});for(const _0xad7f3f of _0x3f3b16){const _0x5e5b00=await(0x0,EmailService_1['SendMail'])(_0xad7f3f[_0x36bd3c(0x135)],_0xad7f3f[_0x36bd3c(0x131)],'',_0xad7f3f['subject'],_0xad7f3f['message'],_0xad7f3f[_0x36bd3c(0x13f)][_0x36bd3c(0x124)](),'');!_0x5e5b00[_0x36bd3c(0x12d)]?(await _0xad7f3f[_0x36bd3c(0x111)]({'scheduled':![]}),logger[_0x36bd3c(0x13c)](_0x36bd3c(0x148)+_0xad7f3f[_0x36bd3c(0x131)])):logger['error'](_0x36bd3c(0x11a)+_0xad7f3f[_0x36bd3c(0x131)]+_0x36bd3c(0x12a)+_0x5e5b00[_0x36bd3c(0x12d)]);}}catch(_0x3515e4){logger[_0x36bd3c(0x12d)](_0x36bd3c(0x113),_0x3515e4);}};node_cron_1['default'][a17_0x296d79(0x120)](a17_0x296d79(0x11d),enviarAgendamentosPendentes);