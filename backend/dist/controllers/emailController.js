const a18_0x34c443=a18_0x9977;(function(_0x1e5362,_0x2604b7){const _0x5c508f=a18_0x9977,_0x4e5046=_0x1e5362();while(!![]){try{const _0x3ac2f1=-parseInt(_0x5c508f(0x1b2))/0x1+-parseInt(_0x5c508f(0x1a2))/0x2+-parseInt(_0x5c508f(0x17a))/0x3*(parseInt(_0x5c508f(0x188))/0x4)+parseInt(_0x5c508f(0x1b1))/0x5+-parseInt(_0x5c508f(0x191))/0x6+parseInt(_0x5c508f(0x195))/0x7*(parseInt(_0x5c508f(0x199))/0x8)+parseInt(_0x5c508f(0x1b9))/0x9*(parseInt(_0x5c508f(0x19f))/0xa);if(_0x3ac2f1===_0x2604b7)break;else _0x4e5046['push'](_0x4e5046['shift']());}catch(_0x2d2f36){_0x4e5046['push'](_0x4e5046['shift']());}}}(a18_0x280b,0x373cd));const a18_0x37049a=(function(){let _0x50b09f=!![];return function(_0x309382,_0x332e27){const _0x21b423=_0x50b09f?function(){const _0x4e1d97=a18_0x9977;if(_0x332e27){const _0x5b783c=_0x332e27[_0x4e1d97(0x19e)](_0x309382,arguments);return _0x332e27=null,_0x5b783c;}}:function(){};return _0x50b09f=![],_0x21b423;};}()),a18_0x596e5a=a18_0x37049a(this,function(){const _0x36bcd9=a18_0x9977;return a18_0x596e5a[_0x36bcd9(0x18e)]()[_0x36bcd9(0x19a)](_0x36bcd9(0x179))[_0x36bcd9(0x18e)]()[_0x36bcd9(0x180)](a18_0x596e5a)[_0x36bcd9(0x19a)](_0x36bcd9(0x179));});a18_0x596e5a();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x490a8a){const _0x100849=a18_0x9977;return _0x490a8a&&_0x490a8a[_0x100849(0x178)]?_0x490a8a:{'default':_0x490a8a};};function a18_0x9977(_0x30adad,_0x3826f2){const _0xc52638=a18_0x280b();return a18_0x9977=function(_0x596e5a,_0x37049a){_0x596e5a=_0x596e5a-0x177;let _0x280b5b=_0xc52638[_0x596e5a];return _0x280b5b;},a18_0x9977(_0x30adad,_0x3826f2);}Object[a18_0x34c443(0x1a5)](exports,'__esModule',{'value':!![]}),exports[a18_0x34c443(0x18c)]=exports[a18_0x34c443(0x197)]=exports[a18_0x34c443(0x1ab)]=exports[a18_0x34c443(0x192)]=void 0x0;const EmailService_1=require(a18_0x34c443(0x17b)),Email_1=__importDefault(require('../models/Email')),moment_1=__importDefault(require(a18_0x34c443(0x185))),node_cron_1=__importDefault(require(a18_0x34c443(0x1b3))),sequelize_1=require(a18_0x34c443(0x18f)),winston_1=__importDefault(require(a18_0x34c443(0x1a4))),logger=winston_1[a18_0x34c443(0x19b)][a18_0x34c443(0x184)]({'level':a18_0x34c443(0x1b0),'format':winston_1[a18_0x34c443(0x19b)][a18_0x34c443(0x1a9)]['combine'](winston_1[a18_0x34c443(0x19b)]['format'][a18_0x34c443(0x198)](),winston_1[a18_0x34c443(0x19b)]['format'][a18_0x34c443(0x1aa)](({timestamp:_0x1fecf1,level:_0x17fef6,message:_0x2e6105})=>{return _0x1fecf1+'\x20'+_0x17fef6+':\x20'+_0x2e6105;})),'transports':[new winston_1[(a18_0x34c443(0x19b))][(a18_0x34c443(0x17c))][(a18_0x34c443(0x1b7))]()]}),enviarEmail=async(_0x41a202,_0x50b7a0)=>{const _0x719abb=a18_0x34c443;try{const _0x50c70b=_0x41a202['user'][_0x719abb(0x19c)],{email:_0x184721,tokenSenha:_0x2531a3,assunto:_0x2779d3,mensagem:_0x367fc1}=_0x41a202['body'],_0x196d4e=(0x0,moment_1[_0x719abb(0x19b)])()[_0x719abb(0x190)](0x1,'hour')[_0x719abb(0x1a9)](_0x719abb(0x1a3)),_0x56dc23=await(0x0,EmailService_1[_0x719abb(0x189)])(_0x50c70b,_0x184721,_0x2531a3,_0x2779d3,_0x367fc1,_0x196d4e);if(_0x56dc23[_0x719abb(0x1ae)])return _0x50b7a0[_0x719abb(0x1ba)](0x1f4)[_0x719abb(0x177)]({'error':_0x56dc23[_0x719abb(0x1ae)]});_0x50b7a0[_0x719abb(0x1ba)](0xc8)[_0x719abb(0x177)]({'message':_0x719abb(0x17e)});}catch(_0x73880f){console[_0x719abb(0x1ae)](_0x719abb(0x1a8),_0x73880f),_0x50b7a0['status'](0x1f4)[_0x719abb(0x177)]({'error':_0x719abb(0x1b4)});}};exports[a18_0x34c443(0x192)]=enviarEmail;const listarEmailsEnviados=async(_0x3daae7,_0xfac9eb)=>{const _0xceda74=a18_0x34c443;try{const _0x2eed46=await Email_1[_0xceda74(0x19b)][_0xceda74(0x1b6)]({'where':{'companyId':_0x3daae7['user'][_0xceda74(0x19c)],'scheduled':null,'sendAt':null}});_0xfac9eb[_0xceda74(0x1ba)](0xc8)[_0xceda74(0x177)](_0x2eed46);}catch(_0x210c8b){console['error']('Erro\x20ao\x20listar\x20e-mails\x20enviados:',_0x210c8b),_0xfac9eb[_0xceda74(0x1ba)](0x1f4)[_0xceda74(0x177)]({'error':_0xceda74(0x1a1)});}};exports[a18_0x34c443(0x1ab)]=listarEmailsEnviados;const listarEmailsAgendados=async(_0x604b24,_0x284a15)=>{const _0x869485=a18_0x34c443;try{const _0x38e449=await Email_1[_0x869485(0x19b)][_0x869485(0x1b6)]({'where':{'companyId':_0x604b24[_0x869485(0x1b5)]['companyId'],'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x869485(0x181)]]:null}}});_0x284a15[_0x869485(0x1ba)](0xc8)[_0x869485(0x177)](_0x38e449);}catch(_0x47a01d){console[_0x869485(0x1ae)](_0x869485(0x19d),_0x47a01d),_0x284a15[_0x869485(0x1ba)](0x1f4)['json']({'error':_0x869485(0x196)});}};exports[a18_0x34c443(0x197)]=listarEmailsAgendados;const agendarEnvioEmail=async(_0x40632e,_0x48a5bb)=>{const _0xdab18e=a18_0x34c443;try{const _0x40bf6b=_0x40632e[_0xdab18e(0x1b5)][_0xdab18e(0x19c)],{recipient:_0x4435e8,subject:_0x457cac,message:_0x39c438,sendAt:_0x510074}=_0x40632e['body'],_0x6e40b=new Date(_0x510074);if(_0x6e40b<=new Date())return _0x48a5bb[_0xdab18e(0x1ba)](0x190)['json']({'error':_0xdab18e(0x18d)});await Email_1['default'][_0xdab18e(0x194)]({'sender':_0x40632e[_0xdab18e(0x1b8)][_0xdab18e(0x187)],'subject':_0x40632e[_0xdab18e(0x1b8)][_0xdab18e(0x182)],'message':_0x40632e[_0xdab18e(0x1b8)][_0xdab18e(0x1a6)],'companyId':_0x40bf6b,'scheduled':!![],'sendAt':new Date(_0x510074)}),_0x48a5bb[_0xdab18e(0x1ba)](0xc8)[_0xdab18e(0x177)]({'message':_0xdab18e(0x1ac)});}catch(_0x4e26fa){console[_0xdab18e(0x1ae)](_0xdab18e(0x1a7),_0x4e26fa),_0x48a5bb[_0xdab18e(0x1ba)](0x1f4)[_0xdab18e(0x177)]({'error':_0xdab18e(0x1a0)});}};function a18_0x280b(){const _0x5c7d40=['Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail:','Erro\x20ao\x20enviar\x20e-mail:','format','printf','listarEmailsEnviados','E-mail\x20agendado\x20com\x20sucesso','subject','error','Erro\x20ao\x20enviar\x20e-mail\x20agendado\x20para:\x20','info','1029075GsqqBO','251330Eukmxo','node-cron','Erro\x20ao\x20enviar\x20e-mail','user','findAll','Console','body','9UEKtQw','status','json','__esModule','(((.+)+)+)+$','807LPXRZQ','../services/EmailService/EmailService','transports','E-mail\x20agendado\x20enviado\x20com\x20sucesso\x20para:\x20','E-mail\x20enviado\x20com\x20sucesso','schedule','constructor','not','assunto','update','createLogger','moment','sender','email','2588zuYGEw','SendMail','*/30\x20*\x20*\x20*\x20*\x20*','toISOString','agendarEnvioEmail','A\x20data\x20de\x20envio\x20deve\x20ser\x20no\x20futuro','toString','sequelize','add','1712136gxRLko','enviarEmail','toDate','create','518plznSu','Erro\x20ao\x20listar\x20e-mails\x20agendados','listarEmailsAgendados','timestamp','1712RFAomM','search','default','companyId','Erro\x20ao\x20listar\x20e-mails\x20agendados:','apply','8691530iREEgG','Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail','Erro\x20ao\x20listar\x20e-mails\x20enviados','307644xNpCPj','YYYY-MM-DDTHH:mm','winston','defineProperty','mensagem'];a18_0x280b=function(){return _0x5c7d40;};return a18_0x280b();}exports[a18_0x34c443(0x18c)]=agendarEnvioEmail;const enviarAgendamentosPendentes=async()=>{const _0x440aeb=a18_0x34c443;try{const _0x764fea=(0x0,moment_1['default'])(),_0x297cc1=await Email_1[_0x440aeb(0x19b)][_0x440aeb(0x1b6)]({'where':{'scheduled':!![],'sendAt':{[sequelize_1['Op']['lte']]:_0x764fea[_0x440aeb(0x193)]()}}});for(const _0x2ec131 of _0x297cc1){const _0x1725a2=await(0x0,EmailService_1['SendMail'])(_0x2ec131[_0x440aeb(0x19c)],_0x2ec131[_0x440aeb(0x186)],'',_0x2ec131[_0x440aeb(0x1ad)],_0x2ec131['message'],_0x2ec131['sendAt'][_0x440aeb(0x18b)](),'');!_0x1725a2['error']?(await _0x2ec131[_0x440aeb(0x183)]({'scheduled':![]}),logger[_0x440aeb(0x1b0)](_0x440aeb(0x17d)+_0x2ec131[_0x440aeb(0x186)])):logger['error'](_0x440aeb(0x1af)+_0x2ec131[_0x440aeb(0x186)]+',\x20erro:\x20'+_0x1725a2[_0x440aeb(0x1ae)]);}}catch(_0x215d37){logger[_0x440aeb(0x1ae)]('Erro\x20ao\x20enviar\x20agendamentos\x20pendentes:',_0x215d37);}};node_cron_1['default'][a18_0x34c443(0x17f)](a18_0x34c443(0x18a),enviarAgendamentosPendentes);