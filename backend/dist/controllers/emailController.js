function a18_0x38f3(){const _0x22391b=['companyId','findAll','apply','Erro\x20ao\x20enviar\x20e-mail:','703296eaVcqO','lte','search','not','body','sequelize','subject','error','enviarEmail','Console','__importDefault','assunto','json','1133868CgdouA','default','__esModule','Erro\x20ao\x20listar\x20e-mails\x20agendados:','mensagem','printf','../services/EmailService/EmailService','E-mail\x20enviado\x20com\x20sucesso','Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail','*/30\x20*\x20*\x20*\x20*\x20*','listarEmailsEnviados','Erro\x20ao\x20listar\x20e-mails\x20enviados:','toISOString','constructor','moment','SendMail','timestamp','3116340PHrfqP','5540290ZXrWZS','sender','message',',\x20erro:\x20','519589DkRaub','Erro\x20ao\x20enviar\x20e-mail','8qKeKqE','sendAt','toString','status','user','listarEmailsAgendados','info','create','email','node-cron','transports','3486555piCMuc','A\x20data\x20de\x20envio\x20deve\x20ser\x20no\x20futuro','Erro\x20ao\x20enviar\x20e-mail\x20agendado\x20para:\x20','32432768ADqWiJ','format','Erro\x20ao\x20listar\x20e-mails\x20agendados'];a18_0x38f3=function(){return _0x22391b;};return a18_0x38f3();}const a18_0x1f0824=a18_0x3e3b;(function(_0x42017a,_0x2c9db8){const _0x2a6059=a18_0x3e3b,_0x29d34a=_0x42017a();while(!![]){try{const _0x1b2f64=-parseInt(_0x2a6059(0x1fd))/0x1+-parseInt(_0x2a6059(0x214))/0x2+parseInt(_0x2a6059(0x221))/0x3*(-parseInt(_0x2a6059(0x1ff))/0x4)+-parseInt(_0x2a6059(0x20a))/0x5+-parseInt(_0x2a6059(0x1f8))/0x6+-parseInt(_0x2a6059(0x1f9))/0x7+parseInt(_0x2a6059(0x20d))/0x8;if(_0x1b2f64===_0x2c9db8)break;else _0x29d34a['push'](_0x29d34a['shift']());}catch(_0x276dbf){_0x29d34a['push'](_0x29d34a['shift']());}}}(a18_0x38f3,0x663d8));const a18_0x3c47ea=(function(){let _0x49cfc2=!![];return function(_0x59f116,_0x55d7ea){const _0x2fbe84=_0x49cfc2?function(){const _0x56af49=a18_0x3e3b;if(_0x55d7ea){const _0x40dba6=_0x55d7ea[_0x56af49(0x212)](_0x59f116,arguments);return _0x55d7ea=null,_0x40dba6;}}:function(){};return _0x49cfc2=![],_0x2fbe84;};}()),a18_0x572d9c=a18_0x3c47ea(this,function(){const _0x528911=a18_0x3e3b;return a18_0x572d9c[_0x528911(0x201)]()[_0x528911(0x216)]('(((.+)+)+)+$')[_0x528911(0x201)]()[_0x528911(0x1f4)](a18_0x572d9c)['search']('(((.+)+)+)+$');});a18_0x572d9c();'use strict';var __importDefault=this&&this[a18_0x1f0824(0x21e)]||function(_0x27a79a){const _0x573d75=a18_0x1f0824;return _0x27a79a&&_0x27a79a[_0x573d75(0x223)]?_0x27a79a:{'default':_0x27a79a};};Object['defineProperty'](exports,a18_0x1f0824(0x223),{'value':!![]}),exports['agendarEnvioEmail']=exports['listarEmailsAgendados']=exports[a18_0x1f0824(0x1f1)]=exports[a18_0x1f0824(0x21c)]=void 0x0;const EmailService_1=require(a18_0x1f0824(0x1ed)),Email_1=__importDefault(require('../models/Email')),moment_1=__importDefault(require(a18_0x1f0824(0x1f5))),node_cron_1=__importDefault(require(a18_0x1f0824(0x208))),sequelize_1=require(a18_0x1f0824(0x219)),winston_1=__importDefault(require('winston')),logger=winston_1['default']['createLogger']({'level':a18_0x1f0824(0x205),'format':winston_1[a18_0x1f0824(0x222)][a18_0x1f0824(0x20e)]['combine'](winston_1[a18_0x1f0824(0x222)][a18_0x1f0824(0x20e)][a18_0x1f0824(0x1f7)](),winston_1['default']['format'][a18_0x1f0824(0x1ec)](({timestamp:_0x49f313,level:_0x2323bb,message:_0x353c12})=>{return _0x49f313+'\x20'+_0x2323bb+':\x20'+_0x353c12;})),'transports':[new winston_1[(a18_0x1f0824(0x222))][(a18_0x1f0824(0x209))][(a18_0x1f0824(0x21d))]()]}),enviarEmail=async(_0x41ac7a,_0x2c3d83)=>{const _0x5857e3=a18_0x1f0824;try{const _0xd039c5=_0x41ac7a[_0x5857e3(0x203)][_0x5857e3(0x210)],{email:_0xbac0f9,tokenSenha:_0x6310f8,assunto:_0x5b4372,mensagem:_0x5831a6}=_0x41ac7a[_0x5857e3(0x218)],_0x42acde=(0x0,moment_1[_0x5857e3(0x222)])()['add'](0x1,'hour')['format']('YYYY-MM-DDTHH:mm'),_0x28d083=await(0x0,EmailService_1[_0x5857e3(0x1f6)])(_0xd039c5,_0xbac0f9,_0x6310f8,_0x5b4372,_0x5831a6,_0x42acde);if(_0x28d083[_0x5857e3(0x21b)])return _0x2c3d83[_0x5857e3(0x202)](0x1f4)[_0x5857e3(0x220)]({'error':_0x28d083[_0x5857e3(0x21b)]});_0x2c3d83['status'](0xc8)[_0x5857e3(0x220)]({'message':_0x5857e3(0x1ee)});}catch(_0x164ad1){console[_0x5857e3(0x21b)](_0x5857e3(0x213),_0x164ad1),_0x2c3d83['status'](0x1f4)['json']({'error':_0x5857e3(0x1fe)});}};exports['enviarEmail']=enviarEmail;const listarEmailsEnviados=async(_0x7982ec,_0x4f984a)=>{const _0x599c5b=a18_0x1f0824;try{const _0x37a44c=await Email_1[_0x599c5b(0x222)][_0x599c5b(0x211)]({'where':{'companyId':_0x7982ec[_0x599c5b(0x203)][_0x599c5b(0x210)],'scheduled':null,'sendAt':null}});_0x4f984a['status'](0xc8)[_0x599c5b(0x220)](_0x37a44c);}catch(_0x43461b){console[_0x599c5b(0x21b)](_0x599c5b(0x1f2),_0x43461b),_0x4f984a[_0x599c5b(0x202)](0x1f4)[_0x599c5b(0x220)]({'error':'Erro\x20ao\x20listar\x20e-mails\x20enviados'});}};exports[a18_0x1f0824(0x1f1)]=listarEmailsEnviados;const listarEmailsAgendados=async(_0x1c9280,_0x19ce88)=>{const _0x4e1024=a18_0x1f0824;try{const _0x487637=await Email_1['default'][_0x4e1024(0x211)]({'where':{'companyId':_0x1c9280[_0x4e1024(0x203)][_0x4e1024(0x210)],'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x4e1024(0x217)]]:null}}});_0x19ce88[_0x4e1024(0x202)](0xc8)[_0x4e1024(0x220)](_0x487637);}catch(_0x480e89){console[_0x4e1024(0x21b)](_0x4e1024(0x1ea),_0x480e89),_0x19ce88[_0x4e1024(0x202)](0x1f4)[_0x4e1024(0x220)]({'error':_0x4e1024(0x20f)});}};function a18_0x3e3b(_0x59036f,_0x53c615){const _0xb5acc2=a18_0x38f3();return a18_0x3e3b=function(_0x572d9c,_0x3c47ea){_0x572d9c=_0x572d9c-0x1ea;let _0x38f31f=_0xb5acc2[_0x572d9c];return _0x38f31f;},a18_0x3e3b(_0x59036f,_0x53c615);}exports[a18_0x1f0824(0x204)]=listarEmailsAgendados;const agendarEnvioEmail=async(_0x2944f2,_0x3af770)=>{const _0xab0fe7=a18_0x1f0824;try{const _0x12cc6d=_0x2944f2[_0xab0fe7(0x203)]['companyId'],{recipient:_0x165c6c,subject:_0x3ccb5d,message:_0x410746,sendAt:_0x452447}=_0x2944f2[_0xab0fe7(0x218)],_0x343d0b=new Date(_0x452447);if(_0x343d0b<=new Date())return _0x3af770[_0xab0fe7(0x202)](0x190)[_0xab0fe7(0x220)]({'error':_0xab0fe7(0x20b)});await Email_1['default'][_0xab0fe7(0x206)]({'sender':_0x2944f2[_0xab0fe7(0x218)][_0xab0fe7(0x207)],'subject':_0x2944f2[_0xab0fe7(0x218)][_0xab0fe7(0x21f)],'message':_0x2944f2[_0xab0fe7(0x218)][_0xab0fe7(0x1eb)],'companyId':_0x12cc6d,'scheduled':!![],'sendAt':new Date(_0x452447)}),_0x3af770['status'](0xc8)[_0xab0fe7(0x220)]({'message':'E-mail\x20agendado\x20com\x20sucesso'});}catch(_0x1057f8){console[_0xab0fe7(0x21b)]('Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail:',_0x1057f8),_0x3af770['status'](0x1f4)[_0xab0fe7(0x220)]({'error':_0xab0fe7(0x1ef)});}};exports['agendarEnvioEmail']=agendarEnvioEmail;const enviarAgendamentosPendentes=async()=>{const _0x1f9ae7=a18_0x1f0824;try{const _0x19ff14=(0x0,moment_1[_0x1f9ae7(0x222)])(),_0x2da378=await Email_1[_0x1f9ae7(0x222)][_0x1f9ae7(0x211)]({'where':{'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x1f9ae7(0x215)]]:_0x19ff14['toDate']()}}});for(const _0x22b9b8 of _0x2da378){const _0x190ea3=await(0x0,EmailService_1[_0x1f9ae7(0x1f6)])(_0x22b9b8[_0x1f9ae7(0x210)],_0x22b9b8[_0x1f9ae7(0x1fa)],'',_0x22b9b8[_0x1f9ae7(0x21a)],_0x22b9b8[_0x1f9ae7(0x1fb)],_0x22b9b8[_0x1f9ae7(0x200)][_0x1f9ae7(0x1f3)](),'');!_0x190ea3['error']?(await _0x22b9b8['update']({'scheduled':![]}),logger[_0x1f9ae7(0x205)]('E-mail\x20agendado\x20enviado\x20com\x20sucesso\x20para:\x20'+_0x22b9b8[_0x1f9ae7(0x1fa)])):logger[_0x1f9ae7(0x21b)](_0x1f9ae7(0x20c)+_0x22b9b8[_0x1f9ae7(0x1fa)]+_0x1f9ae7(0x1fc)+_0x190ea3[_0x1f9ae7(0x21b)]);}}catch(_0x1d285f){logger['error']('Erro\x20ao\x20enviar\x20agendamentos\x20pendentes:',_0x1d285f);}};node_cron_1[a18_0x1f0824(0x222)]['schedule'](a18_0x1f0824(0x1f0),enviarAgendamentosPendentes);