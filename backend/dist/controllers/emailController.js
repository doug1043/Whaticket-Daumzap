const a17_0x2b55a0=a17_0x1273;(function(_0x19b613,_0x5994f2){const _0x15d2b0=a17_0x1273,_0x4f1206=_0x19b613();while(!![]){try{const _0x245892=-parseInt(_0x15d2b0(0x1d7))/0x1+parseInt(_0x15d2b0(0x1f0))/0x2*(-parseInt(_0x15d2b0(0x1da))/0x3)+-parseInt(_0x15d2b0(0x1d2))/0x4*(parseInt(_0x15d2b0(0x1ea))/0x5)+parseInt(_0x15d2b0(0x1d8))/0x6*(-parseInt(_0x15d2b0(0x1b1))/0x7)+-parseInt(_0x15d2b0(0x1c6))/0x8+-parseInt(_0x15d2b0(0x1ef))/0x9*(-parseInt(_0x15d2b0(0x1e3))/0xa)+parseInt(_0x15d2b0(0x1d0))/0xb*(parseInt(_0x15d2b0(0x1e0))/0xc);if(_0x245892===_0x5994f2)break;else _0x4f1206['push'](_0x4f1206['shift']());}catch(_0x2c1d4f){_0x4f1206['push'](_0x4f1206['shift']());}}}(a17_0x2fad,0x4e165));const a17_0x3cc8eb=(function(){let _0x5e411a=!![];return function(_0x561b56,_0x378df3){const _0x1da53a=_0x5e411a?function(){const _0x31fb3b=a17_0x1273;if(_0x378df3){const _0xf64595=_0x378df3[_0x31fb3b(0x1d9)](_0x561b56,arguments);return _0x378df3=null,_0xf64595;}}:function(){};return _0x5e411a=![],_0x1da53a;};}()),a17_0x158c9a=a17_0x3cc8eb(this,function(){const _0x5298eb=a17_0x1273;return a17_0x158c9a[_0x5298eb(0x1cd)]()[_0x5298eb(0x1e6)](_0x5298eb(0x1b5))['toString']()['constructor'](a17_0x158c9a)[_0x5298eb(0x1e6)]('(((.+)+)+)+$');});function a17_0x1273(_0x2fc339,_0x32c57c){const _0x3b02f9=a17_0x2fad();return a17_0x1273=function(_0x158c9a,_0x3cc8eb){_0x158c9a=_0x158c9a-0x1b1;let _0x2fad86=_0x3b02f9[_0x158c9a];return _0x2fad86;},a17_0x1273(_0x2fc339,_0x32c57c);}a17_0x158c9a();'use strict';var __importDefault=this&&this[a17_0x2b55a0(0x1c1)]||function(_0x149b58){const _0x3c7e80=a17_0x2b55a0;return _0x149b58&&_0x149b58[_0x3c7e80(0x1be)]?_0x149b58:{'default':_0x149b58};};Object['defineProperty'](exports,a17_0x2b55a0(0x1be),{'value':!![]}),exports[a17_0x2b55a0(0x1c7)]=exports['listarEmailsAgendados']=exports[a17_0x2b55a0(0x1c3)]=exports['enviarEmail']=void 0x0;const EmailService_1=require(a17_0x2b55a0(0x1f3)),Email_1=__importDefault(require(a17_0x2b55a0(0x1b6))),moment_1=__importDefault(require('moment')),node_cron_1=__importDefault(require(a17_0x2b55a0(0x1e7))),sequelize_1=require(a17_0x2b55a0(0x1eb)),winston_1=__importDefault(require(a17_0x2b55a0(0x1d5))),logger=winston_1['default']['createLogger']({'level':a17_0x2b55a0(0x1bf),'format':winston_1[a17_0x2b55a0(0x1b9)]['format'][a17_0x2b55a0(0x1bd)](winston_1[a17_0x2b55a0(0x1b9)]['format'][a17_0x2b55a0(0x1ed)](),winston_1[a17_0x2b55a0(0x1b9)][a17_0x2b55a0(0x1ec)][a17_0x2b55a0(0x1ee)](({timestamp:_0x482386,level:_0x44ede7,message:_0x4609c7})=>{return _0x482386+'\x20'+_0x44ede7+':\x20'+_0x4609c7;})),'transports':[new winston_1[(a17_0x2b55a0(0x1b9))][(a17_0x2b55a0(0x1d6))][(a17_0x2b55a0(0x1c8))]()]}),enviarEmail=async(_0x1cbd3b,_0xe4e474)=>{const _0x4a064c=a17_0x2b55a0;try{const _0x5ad8ff=_0x1cbd3b[_0x4a064c(0x1d4)][_0x4a064c(0x1bc)],{email:_0x2f8bc2,tokenSenha:_0x34f497,assunto:_0x6bfd7a,mensagem:_0x433ddb}=_0x1cbd3b[_0x4a064c(0x1c2)],_0x5de404=(0x0,moment_1['default'])()[_0x4a064c(0x1ba)](0x1,_0x4a064c(0x1e9))['format'](_0x4a064c(0x1c4)),_0x14ea36=await(0x0,EmailService_1[_0x4a064c(0x1d1)])(_0x5ad8ff,_0x2f8bc2,_0x34f497,_0x6bfd7a,_0x433ddb,_0x5de404);if(_0x14ea36[_0x4a064c(0x1c9)])return _0xe4e474['status'](0x1f4)[_0x4a064c(0x1cc)]({'error':_0x14ea36['error']});_0xe4e474[_0x4a064c(0x1e2)](0xc8)['json']({'message':'E-mail\x20enviado\x20com\x20sucesso'});}catch(_0x3901eb){console[_0x4a064c(0x1c9)]('Erro\x20ao\x20enviar\x20e-mail:',_0x3901eb),_0xe4e474[_0x4a064c(0x1e2)](0x1f4)['json']({'error':_0x4a064c(0x1e1)});}};exports[a17_0x2b55a0(0x1c5)]=enviarEmail;const listarEmailsEnviados=async(_0x1b2a9a,_0x3f9755)=>{const _0x1e203f=a17_0x2b55a0;try{const _0x16c3dc=await Email_1[_0x1e203f(0x1b9)][_0x1e203f(0x1e4)]({'where':{'companyId':_0x1b2a9a[_0x1e203f(0x1d4)][_0x1e203f(0x1bc)],'scheduled':null,'sendAt':null}});_0x3f9755['status'](0xc8)[_0x1e203f(0x1cc)](_0x16c3dc);}catch(_0x58210b){console[_0x1e203f(0x1c9)](_0x1e203f(0x1f2),_0x58210b),_0x3f9755[_0x1e203f(0x1e2)](0x1f4)['json']({'error':_0x1e203f(0x1e8)});}};exports[a17_0x2b55a0(0x1c3)]=listarEmailsEnviados;const listarEmailsAgendados=async(_0x212cb0,_0x57ffec)=>{const _0x3b7d31=a17_0x2b55a0;try{const _0x4b015c=await Email_1[_0x3b7d31(0x1b9)][_0x3b7d31(0x1e4)]({'where':{'companyId':_0x212cb0['user'][_0x3b7d31(0x1bc)],'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x3b7d31(0x1e5)]]:null}}});_0x57ffec[_0x3b7d31(0x1e2)](0xc8)['json'](_0x4b015c);}catch(_0x2b7a8c){console['error']('Erro\x20ao\x20listar\x20e-mails\x20agendados:',_0x2b7a8c),_0x57ffec['status'](0x1f4)[_0x3b7d31(0x1cc)]({'error':_0x3b7d31(0x1ce)});}};exports[a17_0x2b55a0(0x1dd)]=listarEmailsAgendados;const agendarEnvioEmail=async(_0x1a0799,_0x47c8c8)=>{const _0x14bef2=a17_0x2b55a0;try{const _0x2c60d8=_0x1a0799[_0x14bef2(0x1d4)][_0x14bef2(0x1bc)],{recipient:_0x33df43,subject:_0x38f77b,message:_0x368409,sendAt:_0x3d849f}=_0x1a0799[_0x14bef2(0x1c2)],_0x568db6=new Date(_0x3d849f);if(_0x568db6<=new Date())return _0x47c8c8['status'](0x190)[_0x14bef2(0x1cc)]({'error':_0x14bef2(0x1ca)});await Email_1[_0x14bef2(0x1b9)][_0x14bef2(0x1df)]({'sender':_0x1a0799[_0x14bef2(0x1c2)]['email'],'subject':_0x1a0799[_0x14bef2(0x1c2)][_0x14bef2(0x1bb)],'message':_0x1a0799['body'][_0x14bef2(0x1b7)],'companyId':_0x2c60d8,'scheduled':!![],'sendAt':new Date(_0x3d849f)}),_0x47c8c8[_0x14bef2(0x1e2)](0xc8)[_0x14bef2(0x1cc)]({'message':'E-mail\x20agendado\x20com\x20sucesso'});}catch(_0x38f344){console[_0x14bef2(0x1c9)](_0x14bef2(0x1dc),_0x38f344),_0x47c8c8['status'](0x1f4)[_0x14bef2(0x1cc)]({'error':'Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail'});}};exports[a17_0x2b55a0(0x1c7)]=agendarEnvioEmail;const enviarAgendamentosPendentes=async()=>{const _0x1d9150=a17_0x2b55a0;try{const _0x2e8547=(0x0,moment_1['default'])(),_0x1df58e=await Email_1[_0x1d9150(0x1b9)][_0x1d9150(0x1e4)]({'where':{'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x1d9150(0x1cb)]]:_0x2e8547[_0x1d9150(0x1b8)]()}}});for(const _0x5225b4 of _0x1df58e){const _0x3a7226=await(0x0,EmailService_1['SendMail'])(_0x5225b4[_0x1d9150(0x1bc)],_0x5225b4[_0x1d9150(0x1b3)],'',_0x5225b4['subject'],_0x5225b4[_0x1d9150(0x1d3)],_0x5225b4[_0x1d9150(0x1b2)]['toISOString'](),'');!_0x3a7226['error']?(await _0x5225b4['update']({'scheduled':![]}),logger[_0x1d9150(0x1bf)](_0x1d9150(0x1f1)+_0x5225b4['sender'])):logger[_0x1d9150(0x1c9)](_0x1d9150(0x1cf)+_0x5225b4[_0x1d9150(0x1b3)]+_0x1d9150(0x1b4)+_0x3a7226['error']);}}catch(_0x449e89){logger[_0x1d9150(0x1c9)](_0x1d9150(0x1de),_0x449e89);}};node_cron_1[a17_0x2b55a0(0x1b9)][a17_0x2b55a0(0x1db)](a17_0x2b55a0(0x1c0),enviarAgendamentosPendentes);function a17_0x2fad(){const _0x2a6439=['Erro\x20ao\x20enviar\x20e-mail\x20agendado\x20para:\x20','14599541KPSydE','SendMail','792INoBrk','message','user','winston','transports','524723frZhuo','2219946MssKnc','apply','6eVFmml','schedule','Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail:','listarEmailsAgendados','Erro\x20ao\x20enviar\x20agendamentos\x20pendentes:','create','12OLYGib','Erro\x20ao\x20enviar\x20e-mail','status','1412140Takzyc','findAll','not','search','node-cron','Erro\x20ao\x20listar\x20e-mails\x20enviados','hour','705PUNAEY','sequelize','format','timestamp','printf','18fFBuel','77052dPbfKY','E-mail\x20agendado\x20enviado\x20com\x20sucesso\x20para:\x20','Erro\x20ao\x20listar\x20e-mails\x20enviados:','../services/EmailService/EmailService','7FoNKaC','sendAt','sender',',\x20erro:\x20','(((.+)+)+)+$','../models/Email','mensagem','toDate','default','add','assunto','companyId','combine','__esModule','info','*/30\x20*\x20*\x20*\x20*\x20*','__importDefault','body','listarEmailsEnviados','YYYY-MM-DDTHH:mm','enviarEmail','2321040iMjEuD','agendarEnvioEmail','Console','error','A\x20data\x20de\x20envio\x20deve\x20ser\x20no\x20futuro','lte','json','toString','Erro\x20ao\x20listar\x20e-mails\x20agendados'];a17_0x2fad=function(){return _0x2a6439;};return a17_0x2fad();}