const a17_0x2898fd=a17_0x9d92;(function(_0x590c9c,_0x5ece9f){const _0x386dac=a17_0x9d92,_0x18e9be=_0x590c9c();while(!![]){try{const _0x1fa274=parseInt(_0x386dac(0xc4))/0x1+parseInt(_0x386dac(0xdb))/0x2+-parseInt(_0x386dac(0xc6))/0x3*(-parseInt(_0x386dac(0xbe))/0x4)+-parseInt(_0x386dac(0xe3))/0x5*(-parseInt(_0x386dac(0xec))/0x6)+-parseInt(_0x386dac(0xd0))/0x7+-parseInt(_0x386dac(0xe8))/0x8*(parseInt(_0x386dac(0xc9))/0x9)+parseInt(_0x386dac(0xda))/0xa*(parseInt(_0x386dac(0xd6))/0xb);if(_0x1fa274===_0x5ece9f)break;else _0x18e9be['push'](_0x18e9be['shift']());}catch(_0x2e5468){_0x18e9be['push'](_0x18e9be['shift']());}}}(a17_0xde0e,0x7ea30));function a17_0xde0e(){const _0x340338=['345083EvshtO','json','6SildhM','enviarEmail','sender','927rIOCic','user','winston','agendarEnvioEmail','printf','companyId','sendAt','5971518SyKOVu','Erro\x20ao\x20listar\x20e-mails\x20enviados:','not','E-mail\x20agendado\x20com\x20sucesso','E-mail\x20enviado\x20com\x20sucesso','findAll','33LoIbId','../services/EmailService/EmailService','sequelize','__esModule','1514790YdxZUW','1309538qWGCFd','Erro\x20ao\x20enviar\x20e-mail\x20agendado\x20para:\x20','error','Erro\x20ao\x20listar\x20e-mails\x20agendados:','YYYY-MM-DDTHH:mm','lte','node-cron','message','5vWVHKq','SendMail','*/30\x20*\x20*\x20*\x20*\x20*','Erro\x20ao\x20listar\x20e-mails\x20agendados','(((.+)+)+)+$','75352cSEYNN','transports','defineProperty','body','300924tTqlew','Erro\x20ao\x20enviar\x20agendamentos\x20pendentes:','timestamp','toString','apply','Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail:','toISOString','subject','default','add','email','A\x20data\x20de\x20envio\x20deve\x20ser\x20no\x20futuro','Console','hour','listarEmailsEnviados','status','moment','format',',\x20erro:\x20','constructor','1674984qlXpoj','Erro\x20ao\x20listar\x20e-mails\x20enviados','assunto','mensagem','info','search'];a17_0xde0e=function(){return _0x340338;};return a17_0xde0e();}const a17_0x26724b=(function(){let _0x60faa2=!![];return function(_0x4840bf,_0x360c27){const _0x42abaa=_0x60faa2?function(){const _0x4f125a=a17_0x9d92;if(_0x360c27){const _0x4240a0=_0x360c27[_0x4f125a(0xf0)](_0x4840bf,arguments);return _0x360c27=null,_0x4240a0;}}:function(){};return _0x60faa2=![],_0x42abaa;};}()),a17_0x10e7da=a17_0x26724b(this,function(){const _0x326b44=a17_0x9d92;return a17_0x10e7da[_0x326b44(0xef)]()[_0x326b44(0xc3)]('(((.+)+)+)+$')['toString']()[_0x326b44(0xbd)](a17_0x10e7da)[_0x326b44(0xc3)](_0x326b44(0xe7));});a17_0x10e7da();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5a91e7){const _0x5f3332=a17_0x9d92;return _0x5a91e7&&_0x5a91e7[_0x5f3332(0xd9)]?_0x5a91e7:{'default':_0x5a91e7};};Object[a17_0x2898fd(0xea)](exports,a17_0x2898fd(0xd9),{'value':!![]}),exports[a17_0x2898fd(0xcc)]=exports['listarEmailsAgendados']=exports[a17_0x2898fd(0xfa)]=exports[a17_0x2898fd(0xc7)]=void 0x0;const EmailService_1=require(a17_0x2898fd(0xd7)),Email_1=__importDefault(require('../models/Email')),moment_1=__importDefault(require(a17_0x2898fd(0xfc))),node_cron_1=__importDefault(require(a17_0x2898fd(0xe1))),sequelize_1=require(a17_0x2898fd(0xd8)),winston_1=__importDefault(require(a17_0x2898fd(0xcb))),logger=winston_1[a17_0x2898fd(0xf4)]['createLogger']({'level':a17_0x2898fd(0xc2),'format':winston_1['default'][a17_0x2898fd(0xfd)]['combine'](winston_1['default']['format'][a17_0x2898fd(0xee)](),winston_1[a17_0x2898fd(0xf4)][a17_0x2898fd(0xfd)][a17_0x2898fd(0xcd)](({timestamp:_0x3b0737,level:_0x86a6a1,message:_0x190601})=>{return _0x3b0737+'\x20'+_0x86a6a1+':\x20'+_0x190601;})),'transports':[new winston_1['default'][(a17_0x2898fd(0xe9))][(a17_0x2898fd(0xf8))]()]}),enviarEmail=async(_0x15434d,_0x227fbe)=>{const _0x2068bf=a17_0x2898fd;try{const _0x1881e2=_0x15434d['user'][_0x2068bf(0xce)],{email:_0x53b34a,tokenSenha:_0x2aee92,assunto:_0x48ee86,mensagem:_0x190070}=_0x15434d[_0x2068bf(0xeb)],_0x1526fb=(0x0,moment_1['default'])()[_0x2068bf(0xf5)](0x1,_0x2068bf(0xf9))['format'](_0x2068bf(0xdf)),_0x4b2e51=await(0x0,EmailService_1[_0x2068bf(0xe4)])(_0x1881e2,_0x53b34a,_0x2aee92,_0x48ee86,_0x190070,_0x1526fb);if(_0x4b2e51['error'])return _0x227fbe[_0x2068bf(0xfb)](0x1f4)[_0x2068bf(0xc5)]({'error':_0x4b2e51[_0x2068bf(0xdd)]});_0x227fbe[_0x2068bf(0xfb)](0xc8)[_0x2068bf(0xc5)]({'message':_0x2068bf(0xd4)});}catch(_0x233f1c){console['error']('Erro\x20ao\x20enviar\x20e-mail:',_0x233f1c),_0x227fbe[_0x2068bf(0xfb)](0x1f4)[_0x2068bf(0xc5)]({'error':'Erro\x20ao\x20enviar\x20e-mail'});}};exports[a17_0x2898fd(0xc7)]=enviarEmail;const listarEmailsEnviados=async(_0x29f265,_0x402de6)=>{const _0x50bac1=a17_0x2898fd;try{const _0x50a81b=await Email_1[_0x50bac1(0xf4)][_0x50bac1(0xd5)]({'where':{'companyId':_0x29f265[_0x50bac1(0xca)][_0x50bac1(0xce)],'scheduled':null,'sendAt':null}});_0x402de6['status'](0xc8)['json'](_0x50a81b);}catch(_0x46e170){console[_0x50bac1(0xdd)](_0x50bac1(0xd1),_0x46e170),_0x402de6[_0x50bac1(0xfb)](0x1f4)[_0x50bac1(0xc5)]({'error':_0x50bac1(0xbf)});}};function a17_0x9d92(_0x2d16ad,_0x144cf6){const _0x546a30=a17_0xde0e();return a17_0x9d92=function(_0x10e7da,_0x26724b){_0x10e7da=_0x10e7da-0xbd;let _0xde0eeb=_0x546a30[_0x10e7da];return _0xde0eeb;},a17_0x9d92(_0x2d16ad,_0x144cf6);}exports['listarEmailsEnviados']=listarEmailsEnviados;const listarEmailsAgendados=async(_0x50056f,_0x1433a3)=>{const _0x5c7ff4=a17_0x2898fd;try{const _0x4f6c5f=await Email_1['default'][_0x5c7ff4(0xd5)]({'where':{'companyId':_0x50056f[_0x5c7ff4(0xca)][_0x5c7ff4(0xce)],'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x5c7ff4(0xd2)]]:null}}});_0x1433a3[_0x5c7ff4(0xfb)](0xc8)[_0x5c7ff4(0xc5)](_0x4f6c5f);}catch(_0x2ef0de){console['error'](_0x5c7ff4(0xde),_0x2ef0de),_0x1433a3[_0x5c7ff4(0xfb)](0x1f4)[_0x5c7ff4(0xc5)]({'error':_0x5c7ff4(0xe6)});}};exports['listarEmailsAgendados']=listarEmailsAgendados;const agendarEnvioEmail=async(_0x21c2bf,_0x16461d)=>{const _0x588ba6=a17_0x2898fd;try{const _0x4545f9=_0x21c2bf[_0x588ba6(0xca)][_0x588ba6(0xce)],{recipient:_0x38dc9d,subject:_0xd781bd,message:_0x3aa0ee,sendAt:_0x452c91}=_0x21c2bf[_0x588ba6(0xeb)],_0x2c5f45=new Date(_0x452c91);if(_0x2c5f45<=new Date())return _0x16461d[_0x588ba6(0xfb)](0x190)[_0x588ba6(0xc5)]({'error':_0x588ba6(0xf7)});await Email_1[_0x588ba6(0xf4)]['create']({'sender':_0x21c2bf[_0x588ba6(0xeb)][_0x588ba6(0xf6)],'subject':_0x21c2bf[_0x588ba6(0xeb)][_0x588ba6(0xc0)],'message':_0x21c2bf['body'][_0x588ba6(0xc1)],'companyId':_0x4545f9,'scheduled':!![],'sendAt':new Date(_0x452c91)}),_0x16461d[_0x588ba6(0xfb)](0xc8)[_0x588ba6(0xc5)]({'message':_0x588ba6(0xd3)});}catch(_0x3b0a2e){console[_0x588ba6(0xdd)](_0x588ba6(0xf1),_0x3b0a2e),_0x16461d[_0x588ba6(0xfb)](0x1f4)[_0x588ba6(0xc5)]({'error':'Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail'});}};exports[a17_0x2898fd(0xcc)]=agendarEnvioEmail;const enviarAgendamentosPendentes=async()=>{const _0x588efc=a17_0x2898fd;try{const _0x5f5024=(0x0,moment_1[_0x588efc(0xf4)])(),_0x5ee1f2=await Email_1[_0x588efc(0xf4)][_0x588efc(0xd5)]({'where':{'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x588efc(0xe0)]]:_0x5f5024['toDate']()}}});for(const _0x4dc993 of _0x5ee1f2){const _0x14181a=await(0x0,EmailService_1[_0x588efc(0xe4)])(_0x4dc993['companyId'],_0x4dc993[_0x588efc(0xc8)],'',_0x4dc993[_0x588efc(0xf3)],_0x4dc993[_0x588efc(0xe2)],_0x4dc993[_0x588efc(0xcf)][_0x588efc(0xf2)](),'');!_0x14181a[_0x588efc(0xdd)]?(await _0x4dc993['update']({'scheduled':![]}),logger[_0x588efc(0xc2)]('E-mail\x20agendado\x20enviado\x20com\x20sucesso\x20para:\x20'+_0x4dc993[_0x588efc(0xc8)])):logger['error'](_0x588efc(0xdc)+_0x4dc993[_0x588efc(0xc8)]+_0x588efc(0xfe)+_0x14181a[_0x588efc(0xdd)]);}}catch(_0x5429cc){logger[_0x588efc(0xdd)](_0x588efc(0xed),_0x5429cc);}};node_cron_1[a17_0x2898fd(0xf4)]['schedule'](a17_0x2898fd(0xe5),enviarAgendamentosPendentes);