function a18_0x7776(){const _0x5554a7=['status','sender','findAll',',\x20erro:\x20','sendAt','subject','format','json','E-mail\x20agendado\x20com\x20sucesso','1450788XbdjYm','__importDefault','Erro\x20ao\x20enviar\x20e-mail\x20agendado\x20para:\x20','listarEmailsAgendados','constructor','user','createLogger','Erro\x20ao\x20listar\x20e-mails\x20enviados','add','mensagem','transports','assunto','default','Erro\x20ao\x20listar\x20e-mails\x20agendados','30VQJNfX','companyId','Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail','info','SendMail','timestamp','../models/Email','message','printf','Erro\x20ao\x20listar\x20e-mails\x20agendados:','16494xOzmhE','search','A\x20data\x20de\x20envio\x20deve\x20ser\x20no\x20futuro','lte','Erro\x20ao\x20enviar\x20e-mail:','299bNHybH','YYYY-MM-DDTHH:mm','1790BoUycI','2932893CBIvjx','181ecdtZZ','(((.+)+)+)+$','823736toCdog','6QVqmWp','listarEmailsEnviados','sequelize','schedule','hour','464849NGfSkV','E-mail\x20agendado\x20enviado\x20com\x20sucesso\x20para:\x20','../services/EmailService/EmailService','not','body','94QDrJDG','error','node-cron','Console','Erro\x20ao\x20enviar\x20agendamentos\x20pendentes:','enviarEmail','update','agendarEnvioEmail','Erro\x20ao\x20enviar\x20e-mail','__esModule','9022772ysNIBQ','184DBMYOX','winston'];a18_0x7776=function(){return _0x5554a7;};return a18_0x7776();}const a18_0x43b878=a18_0x3b5d;(function(_0x42b838,_0x9ad6b2){const _0x26eb28=a18_0x3b5d,_0x16e40a=_0x42b838();while(!![]){try{const _0x43ab21=parseInt(_0x26eb28(0xa0))/0x1*(-parseInt(_0x26eb28(0xad))/0x2)+-parseInt(_0x26eb28(0xa3))/0x3*(-parseInt(_0x26eb28(0xa2))/0x4)+parseInt(_0x26eb28(0x9e))/0x5*(parseInt(_0x26eb28(0xdb))/0x6)+parseInt(_0x26eb28(0xa8))/0x7*(-parseInt(_0x26eb28(0xb8))/0x8)+parseInt(_0x26eb28(0x9f))/0x9*(-parseInt(_0x26eb28(0xd1))/0xa)+-parseInt(_0x26eb28(0xb7))/0xb+-parseInt(_0x26eb28(0xc3))/0xc*(-parseInt(_0x26eb28(0x9c))/0xd);if(_0x43ab21===_0x9ad6b2)break;else _0x16e40a['push'](_0x16e40a['shift']());}catch(_0x34545d){_0x16e40a['push'](_0x16e40a['shift']());}}}(a18_0x7776,0xcdcb8));const a18_0x2b7b0e=(function(){let _0x24cdae=!![];return function(_0x309f8a,_0x40d946){const _0x205cc3=_0x24cdae?function(){if(_0x40d946){const _0x5562cd=_0x40d946['apply'](_0x309f8a,arguments);return _0x40d946=null,_0x5562cd;}}:function(){};return _0x24cdae=![],_0x205cc3;};}()),a18_0x45a1fd=a18_0x2b7b0e(this,function(){const _0x16363e=a18_0x3b5d;return a18_0x45a1fd['toString']()[_0x16363e(0xdc)](_0x16363e(0xa1))['toString']()[_0x16363e(0xc7)](a18_0x45a1fd)[_0x16363e(0xdc)](_0x16363e(0xa1));});a18_0x45a1fd();'use strict';var __importDefault=this&&this[a18_0x43b878(0xc4)]||function(_0x2a2d5d){const _0x821102=a18_0x43b878;return _0x2a2d5d&&_0x2a2d5d[_0x821102(0xb6)]?_0x2a2d5d:{'default':_0x2a2d5d};};Object['defineProperty'](exports,a18_0x43b878(0xb6),{'value':!![]}),exports[a18_0x43b878(0xb4)]=exports['listarEmailsAgendados']=exports[a18_0x43b878(0xa4)]=exports[a18_0x43b878(0xb2)]=void 0x0;function a18_0x3b5d(_0x1bef38,_0x2ccd45){const _0x134369=a18_0x7776();return a18_0x3b5d=function(_0x45a1fd,_0x2b7b0e){_0x45a1fd=_0x45a1fd-0x9a;let _0x7776a4=_0x134369[_0x45a1fd];return _0x7776a4;},a18_0x3b5d(_0x1bef38,_0x2ccd45);}const EmailService_1=require(a18_0x43b878(0xaa)),Email_1=__importDefault(require(a18_0x43b878(0xd7))),moment_1=__importDefault(require('moment')),node_cron_1=__importDefault(require(a18_0x43b878(0xaf))),sequelize_1=require(a18_0x43b878(0xa5)),winston_1=__importDefault(require(a18_0x43b878(0xb9))),logger=winston_1[a18_0x43b878(0xcf)][a18_0x43b878(0xc9)]({'level':a18_0x43b878(0xd4),'format':winston_1['default'][a18_0x43b878(0xc0)]['combine'](winston_1[a18_0x43b878(0xcf)][a18_0x43b878(0xc0)][a18_0x43b878(0xd6)](),winston_1[a18_0x43b878(0xcf)][a18_0x43b878(0xc0)][a18_0x43b878(0xd9)](({timestamp:_0x46b727,level:_0x4853a9,message:_0x3b2028})=>{return _0x46b727+'\x20'+_0x4853a9+':\x20'+_0x3b2028;})),'transports':[new winston_1[(a18_0x43b878(0xcf))][(a18_0x43b878(0xcd))][(a18_0x43b878(0xb0))]()]}),enviarEmail=async(_0x3e4219,_0x5059f6)=>{const _0x18476f=a18_0x43b878;try{const _0x170f94=_0x3e4219[_0x18476f(0xc8)]['companyId'],{email:_0x4342da,tokenSenha:_0x182d2e,assunto:_0x292ca7,mensagem:_0x5a7976}=_0x3e4219[_0x18476f(0xac)],_0x1c5a5a=(0x0,moment_1[_0x18476f(0xcf)])()[_0x18476f(0xcb)](0x1,_0x18476f(0xa7))[_0x18476f(0xc0)](_0x18476f(0x9d)),_0x3b600b=await(0x0,EmailService_1[_0x18476f(0xd5)])(_0x170f94,_0x4342da,_0x182d2e,_0x292ca7,_0x5a7976,_0x1c5a5a);if(_0x3b600b[_0x18476f(0xae)])return _0x5059f6['status'](0x1f4)['json']({'error':_0x3b600b[_0x18476f(0xae)]});_0x5059f6[_0x18476f(0xba)](0xc8)[_0x18476f(0xc1)]({'message':'E-mail\x20enviado\x20com\x20sucesso'});}catch(_0x545711){console[_0x18476f(0xae)](_0x18476f(0x9b),_0x545711),_0x5059f6[_0x18476f(0xba)](0x1f4)[_0x18476f(0xc1)]({'error':_0x18476f(0xb5)});}};exports[a18_0x43b878(0xb2)]=enviarEmail;const listarEmailsEnviados=async(_0x213a50,_0x252140)=>{const _0x502942=a18_0x43b878;try{const _0x4fe639=await Email_1[_0x502942(0xcf)][_0x502942(0xbc)]({'where':{'companyId':_0x213a50['user'][_0x502942(0xd2)],'scheduled':null,'sendAt':null}});_0x252140[_0x502942(0xba)](0xc8)[_0x502942(0xc1)](_0x4fe639);}catch(_0x58709){console[_0x502942(0xae)]('Erro\x20ao\x20listar\x20e-mails\x20enviados:',_0x58709),_0x252140[_0x502942(0xba)](0x1f4)[_0x502942(0xc1)]({'error':_0x502942(0xca)});}};exports['listarEmailsEnviados']=listarEmailsEnviados;const listarEmailsAgendados=async(_0x55e9de,_0x34d352)=>{const _0x3a549c=a18_0x43b878;try{const _0xc29bd2=await Email_1[_0x3a549c(0xcf)][_0x3a549c(0xbc)]({'where':{'companyId':_0x55e9de[_0x3a549c(0xc8)]['companyId'],'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x3a549c(0xab)]]:null}}});_0x34d352[_0x3a549c(0xba)](0xc8)[_0x3a549c(0xc1)](_0xc29bd2);}catch(_0x34ef3e){console['error'](_0x3a549c(0xda),_0x34ef3e),_0x34d352['status'](0x1f4)[_0x3a549c(0xc1)]({'error':_0x3a549c(0xd0)});}};exports[a18_0x43b878(0xc6)]=listarEmailsAgendados;const agendarEnvioEmail=async(_0x20015a,_0x402d19)=>{const _0x61b101=a18_0x43b878;try{const _0x23824e=_0x20015a[_0x61b101(0xc8)]['companyId'],{recipient:_0x2ba2c8,subject:_0x471d6f,message:_0x34a091,sendAt:_0x401792}=_0x20015a[_0x61b101(0xac)],_0x58244e=new Date(_0x401792);if(_0x58244e<=new Date())return _0x402d19[_0x61b101(0xba)](0x190)[_0x61b101(0xc1)]({'error':_0x61b101(0xdd)});await Email_1['default']['create']({'sender':_0x20015a[_0x61b101(0xac)]['email'],'subject':_0x20015a['body'][_0x61b101(0xce)],'message':_0x20015a[_0x61b101(0xac)][_0x61b101(0xcc)],'companyId':_0x23824e,'scheduled':!![],'sendAt':new Date(_0x401792)}),_0x402d19['status'](0xc8)['json']({'message':_0x61b101(0xc2)});}catch(_0xd97c7a){console[_0x61b101(0xae)]('Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail:',_0xd97c7a),_0x402d19[_0x61b101(0xba)](0x1f4)[_0x61b101(0xc1)]({'error':_0x61b101(0xd3)});}};exports[a18_0x43b878(0xb4)]=agendarEnvioEmail;const enviarAgendamentosPendentes=async()=>{const _0x531f69=a18_0x43b878;try{const _0x1a7ce1=(0x0,moment_1[_0x531f69(0xcf)])(),_0x40d12a=await Email_1[_0x531f69(0xcf)][_0x531f69(0xbc)]({'where':{'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x531f69(0x9a)]]:_0x1a7ce1['toDate']()}}});for(const _0x15d610 of _0x40d12a){const _0x31a327=await(0x0,EmailService_1[_0x531f69(0xd5)])(_0x15d610[_0x531f69(0xd2)],_0x15d610[_0x531f69(0xbb)],'',_0x15d610[_0x531f69(0xbf)],_0x15d610[_0x531f69(0xd8)],_0x15d610[_0x531f69(0xbe)]['toISOString'](),'');!_0x31a327[_0x531f69(0xae)]?(await _0x15d610[_0x531f69(0xb3)]({'scheduled':![]}),logger[_0x531f69(0xd4)](_0x531f69(0xa9)+_0x15d610[_0x531f69(0xbb)])):logger['error'](_0x531f69(0xc5)+_0x15d610[_0x531f69(0xbb)]+_0x531f69(0xbd)+_0x31a327['error']);}}catch(_0x228086){logger[_0x531f69(0xae)](_0x531f69(0xb1),_0x228086);}};node_cron_1[a18_0x43b878(0xcf)][a18_0x43b878(0xa6)]('*/30\x20*\x20*\x20*\x20*\x20*',enviarAgendamentosPendentes);