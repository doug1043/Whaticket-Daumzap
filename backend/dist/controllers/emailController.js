const a18_0x2b7c60=a18_0x4d32;(function(_0x4c6ce1,_0x5ba8ce){const _0x1f9575=a18_0x4d32,_0x42b8b6=_0x4c6ce1();while(!![]){try{const _0x5b8ca5=parseInt(_0x1f9575(0x108))/0x1+parseInt(_0x1f9575(0xfd))/0x2+parseInt(_0x1f9575(0x123))/0x3*(parseInt(_0x1f9575(0x10e))/0x4)+parseInt(_0x1f9575(0x126))/0x5+-parseInt(_0x1f9575(0x112))/0x6+-parseInt(_0x1f9575(0x11c))/0x7*(-parseInt(_0x1f9575(0x113))/0x8)+-parseInt(_0x1f9575(0x128))/0x9;if(_0x5b8ca5===_0x5ba8ce)break;else _0x42b8b6['push'](_0x42b8b6['shift']());}catch(_0x318e74){_0x42b8b6['push'](_0x42b8b6['shift']());}}}(a18_0x4249,0xa263a));const a18_0x51085e=(function(){let _0x2d5944=!![];return function(_0x37f482,_0xb83bc2){const _0x414ce9=_0x2d5944?function(){const _0x329591=a18_0x4d32;if(_0xb83bc2){const _0x35ace0=_0xb83bc2[_0x329591(0x11a)](_0x37f482,arguments);return _0xb83bc2=null,_0x35ace0;}}:function(){};return _0x2d5944=![],_0x414ce9;};}()),a18_0x467f2a=a18_0x51085e(this,function(){const _0x2e02eb=a18_0x4d32;return a18_0x467f2a[_0x2e02eb(0x12a)]()[_0x2e02eb(0x117)](_0x2e02eb(0x12b))['toString']()[_0x2e02eb(0xf9)](a18_0x467f2a)[_0x2e02eb(0x117)]('(((.+)+)+)+$');});function a18_0x4d32(_0x57a401,_0x2997ca){const _0x3de2db=a18_0x4249();return a18_0x4d32=function(_0x467f2a,_0x51085e){_0x467f2a=_0x467f2a-0xf2;let _0x424949=_0x3de2db[_0x467f2a];return _0x424949;},a18_0x4d32(_0x57a401,_0x2997ca);}a18_0x467f2a();'use strict';var __importDefault=this&&this[a18_0x2b7c60(0xf8)]||function(_0x355498){const _0x2fe411=a18_0x2b7c60;return _0x355498&&_0x355498[_0x2fe411(0x11e)]?_0x355498:{'default':_0x355498};};Object['defineProperty'](exports,a18_0x2b7c60(0x11e),{'value':!![]}),exports[a18_0x2b7c60(0x110)]=exports['listarEmailsAgendados']=exports[a18_0x2b7c60(0x103)]=exports[a18_0x2b7c60(0x109)]=void 0x0;const EmailService_1=require('../services/EmailService/EmailService'),Email_1=__importDefault(require(a18_0x2b7c60(0x10a))),moment_1=__importDefault(require('moment')),node_cron_1=__importDefault(require(a18_0x2b7c60(0x111))),sequelize_1=require(a18_0x2b7c60(0x102)),winston_1=__importDefault(require(a18_0x2b7c60(0x104))),logger=winston_1[a18_0x2b7c60(0x114)][a18_0x2b7c60(0x122)]({'level':a18_0x2b7c60(0x101),'format':winston_1[a18_0x2b7c60(0x114)][a18_0x2b7c60(0xf6)]['combine'](winston_1[a18_0x2b7c60(0x114)]['format']['timestamp'](),winston_1[a18_0x2b7c60(0x114)]['format']['printf'](({timestamp:_0x216b51,level:_0x9c4d07,message:_0x59f60c})=>{return _0x216b51+'\x20'+_0x9c4d07+':\x20'+_0x59f60c;})),'transports':[new winston_1[(a18_0x2b7c60(0x114))]['transports']['Console']()]}),enviarEmail=async(_0x11d3b9,_0x448a8b)=>{const _0x3c1ee1=a18_0x2b7c60;try{const _0x22736a=_0x11d3b9['user']['companyId'],{email:_0x1a16ec,tokenSenha:_0x351723,assunto:_0x24131d,mensagem:_0x46b5b5}=_0x11d3b9[_0x3c1ee1(0xfe)],_0xc24d4=(0x0,moment_1[_0x3c1ee1(0x114)])()[_0x3c1ee1(0xf3)](0x1,'hour')[_0x3c1ee1(0xf6)](_0x3c1ee1(0x115)),_0xd5ec43=await(0x0,EmailService_1['SendMail'])(_0x22736a,_0x1a16ec,_0x351723,_0x24131d,_0x46b5b5,_0xc24d4);if(_0xd5ec43[_0x3c1ee1(0x124)])return _0x448a8b[_0x3c1ee1(0x129)](0x1f4)[_0x3c1ee1(0x119)]({'error':_0xd5ec43[_0x3c1ee1(0x124)]});_0x448a8b[_0x3c1ee1(0x129)](0xc8)[_0x3c1ee1(0x119)]({'message':_0x3c1ee1(0x105)});}catch(_0x5d3fce){console[_0x3c1ee1(0x124)](_0x3c1ee1(0xff),_0x5d3fce),_0x448a8b[_0x3c1ee1(0x129)](0x1f4)['json']({'error':'Erro\x20ao\x20enviar\x20e-mail'});}};exports[a18_0x2b7c60(0x109)]=enviarEmail;const listarEmailsEnviados=async(_0xee305d,_0x46318)=>{const _0x5592ce=a18_0x2b7c60;try{const _0x51b311=await Email_1[_0x5592ce(0x114)][_0x5592ce(0x125)]({'where':{'companyId':_0xee305d[_0x5592ce(0xf5)][_0x5592ce(0xf2)],'scheduled':null,'sendAt':null}});_0x46318[_0x5592ce(0x129)](0xc8)[_0x5592ce(0x119)](_0x51b311);}catch(_0x463ccb){console[_0x5592ce(0x124)](_0x5592ce(0x121),_0x463ccb),_0x46318['status'](0x1f4)[_0x5592ce(0x119)]({'error':'Erro\x20ao\x20listar\x20e-mails\x20enviados'});}};exports[a18_0x2b7c60(0x103)]=listarEmailsEnviados;const listarEmailsAgendados=async(_0x514f4e,_0x326a7e)=>{const _0x59246b=a18_0x2b7c60;try{const _0x117aa4=await Email_1['default'][_0x59246b(0x125)]({'where':{'companyId':_0x514f4e['user'][_0x59246b(0xf2)],'scheduled':!![],'sendAt':{[sequelize_1['Op']['not']]:null}}});_0x326a7e[_0x59246b(0x129)](0xc8)[_0x59246b(0x119)](_0x117aa4);}catch(_0x3089f9){console[_0x59246b(0x124)](_0x59246b(0x106),_0x3089f9),_0x326a7e['status'](0x1f4)[_0x59246b(0x119)]({'error':'Erro\x20ao\x20listar\x20e-mails\x20agendados'});}};exports[a18_0x2b7c60(0x10d)]=listarEmailsAgendados;const agendarEnvioEmail=async(_0x25eb9f,_0x4925e3)=>{const _0x464ff3=a18_0x2b7c60;try{const _0x568839=_0x25eb9f[_0x464ff3(0xf5)][_0x464ff3(0xf2)],{recipient:_0x315fe3,subject:_0xf297b3,message:_0x457d38,sendAt:_0x20e7c5}=_0x25eb9f[_0x464ff3(0xfe)],_0x2eb120=new Date(_0x20e7c5);if(_0x2eb120<=new Date())return _0x4925e3[_0x464ff3(0x129)](0x190)[_0x464ff3(0x119)]({'error':_0x464ff3(0x120)});await Email_1['default'][_0x464ff3(0x127)]({'sender':_0x25eb9f[_0x464ff3(0xfe)][_0x464ff3(0xf4)],'subject':_0x25eb9f[_0x464ff3(0xfe)][_0x464ff3(0x107)],'message':_0x25eb9f['body'][_0x464ff3(0x10c)],'companyId':_0x568839,'scheduled':!![],'sendAt':new Date(_0x20e7c5)}),_0x4925e3[_0x464ff3(0x129)](0xc8)['json']({'message':_0x464ff3(0x11f)});}catch(_0x5daca2){console[_0x464ff3(0x124)](_0x464ff3(0xfa),_0x5daca2),_0x4925e3[_0x464ff3(0x129)](0x1f4)['json']({'error':'Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail'});}};exports[a18_0x2b7c60(0x110)]=agendarEnvioEmail;const enviarAgendamentosPendentes=async()=>{const _0x40b466=a18_0x2b7c60;try{const _0x4b2959=(0x0,moment_1[_0x40b466(0x114)])(),_0x24045c=await Email_1[_0x40b466(0x114)]['findAll']({'where':{'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x40b466(0x100)]]:_0x4b2959[_0x40b466(0x11d)]()}}});for(const _0x1f62d2 of _0x24045c){const _0x50ea6c=await(0x0,EmailService_1[_0x40b466(0x11b)])(_0x1f62d2[_0x40b466(0xf2)],_0x1f62d2[_0x40b466(0x10f)],'',_0x1f62d2['subject'],_0x1f62d2[_0x40b466(0x116)],_0x1f62d2['sendAt']['toISOString'](),'');!_0x50ea6c[_0x40b466(0x124)]?(await _0x1f62d2[_0x40b466(0x10b)]({'scheduled':![]}),logger[_0x40b466(0x101)](_0x40b466(0xfc)+_0x1f62d2[_0x40b466(0x10f)])):logger['error'](_0x40b466(0x12c)+_0x1f62d2['sender']+_0x40b466(0xf7)+_0x50ea6c[_0x40b466(0x124)]);}}catch(_0x93053d){logger[_0x40b466(0x124)](_0x40b466(0x118),_0x93053d);}};function a18_0x4249(){const _0x22b43=['(((.+)+)+)+$','Erro\x20ao\x20enviar\x20e-mail\x20agendado\x20para:\x20','companyId','add','email','user','format',',\x20erro:\x20','__importDefault','constructor','Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail:','schedule','E-mail\x20agendado\x20enviado\x20com\x20sucesso\x20para:\x20','1077698GaBZxZ','body','Erro\x20ao\x20enviar\x20e-mail:','lte','info','sequelize','listarEmailsEnviados','winston','E-mail\x20enviado\x20com\x20sucesso','Erro\x20ao\x20listar\x20e-mails\x20agendados:','assunto','801639uElAbb','enviarEmail','../models/Email','update','mensagem','listarEmailsAgendados','4CQRptG','sender','agendarEnvioEmail','node-cron','803484RpzGmz','8963256ZKFuvt','default','YYYY-MM-DDTHH:mm','message','search','Erro\x20ao\x20enviar\x20agendamentos\x20pendentes:','json','apply','SendMail','7FNbpzB','toDate','__esModule','E-mail\x20agendado\x20com\x20sucesso','A\x20data\x20de\x20envio\x20deve\x20ser\x20no\x20futuro','Erro\x20ao\x20listar\x20e-mails\x20enviados:','createLogger','3293229NqitcD','error','findAll','691595DTMXpJ','create','26081073gRdsVC','status','toString'];a18_0x4249=function(){return _0x22b43;};return a18_0x4249();}node_cron_1[a18_0x2b7c60(0x114)][a18_0x2b7c60(0xfb)]('*/30\x20*\x20*\x20*\x20*\x20*',enviarAgendamentosPendentes);