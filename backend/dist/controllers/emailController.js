const a17_0xd7f114=a17_0x3c59;(function(_0x5becd3,_0x14b835){const _0x1aa571=a17_0x3c59,_0x2c1437=_0x5becd3();while(!![]){try{const _0x1a75a0=parseInt(_0x1aa571(0x110))/0x1*(-parseInt(_0x1aa571(0x132))/0x2)+-parseInt(_0x1aa571(0x112))/0x3+-parseInt(_0x1aa571(0x142))/0x4*(-parseInt(_0x1aa571(0x11d))/0x5)+parseInt(_0x1aa571(0x13d))/0x6*(-parseInt(_0x1aa571(0x105))/0x7)+parseInt(_0x1aa571(0x12b))/0x8+-parseInt(_0x1aa571(0x11c))/0x9*(parseInt(_0x1aa571(0x120))/0xa)+parseInt(_0x1aa571(0x13b))/0xb*(parseInt(_0x1aa571(0x13a))/0xc);if(_0x1a75a0===_0x14b835)break;else _0x2c1437['push'](_0x2c1437['shift']());}catch(_0x31568b){_0x2c1437['push'](_0x2c1437['shift']());}}}(a17_0x1a91,0x4e7a4));const a17_0x31f878=(function(){let _0x121a4a=!![];return function(_0x17a509,_0x273240){const _0x42a03c=_0x121a4a?function(){const _0x207057=a17_0x3c59;if(_0x273240){const _0x5a7458=_0x273240[_0x207057(0x104)](_0x17a509,arguments);return _0x273240=null,_0x5a7458;}}:function(){};return _0x121a4a=![],_0x42a03c;};}()),a17_0x322c47=a17_0x31f878(this,function(){const _0x4f1f49=a17_0x3c59;return a17_0x322c47[_0x4f1f49(0x113)]()['search'](_0x4f1f49(0x12f))[_0x4f1f49(0x113)]()[_0x4f1f49(0x136)](a17_0x322c47)[_0x4f1f49(0x116)](_0x4f1f49(0x12f));});a17_0x322c47();'use strict';function a17_0x1a91(){const _0x3bdcec=['Erro\x20ao\x20enviar\x20e-mail\x20agendado\x20para:\x20','create','listarEmailsAgendados','createLogger','../models/Email','Console','apply','37989BOMchB','YYYY-MM-DDTHH:mm','winston','moment','not','findAll','node-cron','user','__esModule','agendarEnvioEmail','email','50474MoRHkW',',\x20erro:\x20','385857DaLsct','toString','companyId','defineProperty','search','hour','subject','mensagem','default','body','27whzMOF','815NQiUYU','Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail','update','1792310iKaMfc','Erro\x20ao\x20agendar\x20o\x20envio\x20de\x20e-mail:','message','E-mail\x20agendado\x20enviado\x20com\x20sucesso\x20para:\x20','SendMail','format','Erro\x20ao\x20listar\x20e-mails\x20agendados','transports','schedule','toISOString','Erro\x20ao\x20listar\x20e-mails\x20enviados:','4320832vQOrpF','enviarEmail','add','sender','(((.+)+)+)+$','info','error','6NSLXjY','*/30\x20*\x20*\x20*\x20*\x20*','lte','Erro\x20ao\x20enviar\x20e-mail','constructor','sendAt','Erro\x20ao\x20enviar\x20agendamentos\x20pendentes:','Erro\x20ao\x20enviar\x20e-mail:','12yxlLqU','9674863yyWmMx','A\x20data\x20de\x20envio\x20deve\x20ser\x20no\x20futuro','318unfcqo','E-mail\x20agendado\x20com\x20sucesso','timestamp','status','json','176KDOKVL'];a17_0x1a91=function(){return _0x3bdcec;};return a17_0x1a91();}var __importDefault=this&&this['__importDefault']||function(_0x4abed5){const _0x362b57=a17_0x3c59;return _0x4abed5&&_0x4abed5[_0x362b57(0x10d)]?_0x4abed5:{'default':_0x4abed5};};Object[a17_0xd7f114(0x115)](exports,'__esModule',{'value':!![]}),exports[a17_0xd7f114(0x10e)]=exports[a17_0xd7f114(0x100)]=exports['listarEmailsEnviados']=exports[a17_0xd7f114(0x12c)]=void 0x0;const EmailService_1=require('../services/EmailService/EmailService'),Email_1=__importDefault(require(a17_0xd7f114(0x102))),moment_1=__importDefault(require(a17_0xd7f114(0x108))),node_cron_1=__importDefault(require(a17_0xd7f114(0x10b))),sequelize_1=require('sequelize'),winston_1=__importDefault(require(a17_0xd7f114(0x107))),logger=winston_1['default'][a17_0xd7f114(0x101)]({'level':'info','format':winston_1[a17_0xd7f114(0x11a)][a17_0xd7f114(0x125)]['combine'](winston_1[a17_0xd7f114(0x11a)]['format'][a17_0xd7f114(0x13f)](),winston_1[a17_0xd7f114(0x11a)][a17_0xd7f114(0x125)]['printf'](({timestamp:_0x5c41e7,level:_0x40dc7e,message:_0x4354e6})=>{return _0x5c41e7+'\x20'+_0x40dc7e+':\x20'+_0x4354e6;})),'transports':[new winston_1[(a17_0xd7f114(0x11a))][(a17_0xd7f114(0x127))][(a17_0xd7f114(0x103))]()]}),enviarEmail=async(_0x7a1ab7,_0x41a80a)=>{const _0x5a3ba4=a17_0xd7f114;try{const _0xb64bc1=_0x7a1ab7[_0x5a3ba4(0x10c)][_0x5a3ba4(0x114)],{email:_0x364829,tokenSenha:_0x52da2f,assunto:_0x2b55f4,mensagem:_0x20d5be}=_0x7a1ab7[_0x5a3ba4(0x11b)],_0x4c1d3d=(0x0,moment_1[_0x5a3ba4(0x11a)])()[_0x5a3ba4(0x12d)](0x1,_0x5a3ba4(0x117))[_0x5a3ba4(0x125)](_0x5a3ba4(0x106)),_0x365a01=await(0x0,EmailService_1[_0x5a3ba4(0x124)])(_0xb64bc1,_0x364829,_0x52da2f,_0x2b55f4,_0x20d5be,_0x4c1d3d);if(_0x365a01[_0x5a3ba4(0x131)])return _0x41a80a[_0x5a3ba4(0x140)](0x1f4)[_0x5a3ba4(0x141)]({'error':_0x365a01[_0x5a3ba4(0x131)]});_0x41a80a[_0x5a3ba4(0x140)](0xc8)['json']({'message':'E-mail\x20enviado\x20com\x20sucesso'});}catch(_0x315963){console['error'](_0x5a3ba4(0x139),_0x315963),_0x41a80a[_0x5a3ba4(0x140)](0x1f4)[_0x5a3ba4(0x141)]({'error':_0x5a3ba4(0x135)});}};exports[a17_0xd7f114(0x12c)]=enviarEmail;const listarEmailsEnviados=async(_0x126643,_0x95ad36)=>{const _0x29e1eb=a17_0xd7f114;try{const _0x59bb99=await Email_1[_0x29e1eb(0x11a)][_0x29e1eb(0x10a)]({'where':{'companyId':_0x126643[_0x29e1eb(0x10c)][_0x29e1eb(0x114)],'scheduled':null,'sendAt':null}});_0x95ad36[_0x29e1eb(0x140)](0xc8)[_0x29e1eb(0x141)](_0x59bb99);}catch(_0x4f87f4){console[_0x29e1eb(0x131)](_0x29e1eb(0x12a),_0x4f87f4),_0x95ad36[_0x29e1eb(0x140)](0x1f4)[_0x29e1eb(0x141)]({'error':'Erro\x20ao\x20listar\x20e-mails\x20enviados'});}};exports['listarEmailsEnviados']=listarEmailsEnviados;const listarEmailsAgendados=async(_0x142e0c,_0x552d9a)=>{const _0xf56e3d=a17_0xd7f114;try{const _0x113d83=await Email_1[_0xf56e3d(0x11a)][_0xf56e3d(0x10a)]({'where':{'companyId':_0x142e0c['user']['companyId'],'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0xf56e3d(0x109)]]:null}}});_0x552d9a[_0xf56e3d(0x140)](0xc8)['json'](_0x113d83);}catch(_0x5af7a2){console['error']('Erro\x20ao\x20listar\x20e-mails\x20agendados:',_0x5af7a2),_0x552d9a['status'](0x1f4)[_0xf56e3d(0x141)]({'error':_0xf56e3d(0x126)});}};exports[a17_0xd7f114(0x100)]=listarEmailsAgendados;const agendarEnvioEmail=async(_0x3e5275,_0x1e1680)=>{const _0x20797b=a17_0xd7f114;try{const _0xa9eaf8=_0x3e5275['user'][_0x20797b(0x114)],{recipient:_0x31b179,subject:_0x563744,message:_0x295d27,sendAt:_0x43f55b}=_0x3e5275[_0x20797b(0x11b)],_0x1f0b0a=new Date(_0x43f55b);if(_0x1f0b0a<=new Date())return _0x1e1680[_0x20797b(0x140)](0x190)[_0x20797b(0x141)]({'error':_0x20797b(0x13c)});await Email_1[_0x20797b(0x11a)][_0x20797b(0xff)]({'sender':_0x3e5275[_0x20797b(0x11b)][_0x20797b(0x10f)],'subject':_0x3e5275['body']['assunto'],'message':_0x3e5275[_0x20797b(0x11b)][_0x20797b(0x119)],'companyId':_0xa9eaf8,'scheduled':!![],'sendAt':new Date(_0x43f55b)}),_0x1e1680[_0x20797b(0x140)](0xc8)[_0x20797b(0x141)]({'message':_0x20797b(0x13e)});}catch(_0x557471){console[_0x20797b(0x131)](_0x20797b(0x121),_0x557471),_0x1e1680[_0x20797b(0x140)](0x1f4)[_0x20797b(0x141)]({'error':_0x20797b(0x11e)});}};exports['agendarEnvioEmail']=agendarEnvioEmail;const enviarAgendamentosPendentes=async()=>{const _0x28f575=a17_0xd7f114;try{const _0x46065d=(0x0,moment_1[_0x28f575(0x11a)])(),_0x44d4a2=await Email_1[_0x28f575(0x11a)][_0x28f575(0x10a)]({'where':{'scheduled':!![],'sendAt':{[sequelize_1['Op'][_0x28f575(0x134)]]:_0x46065d['toDate']()}}});for(const _0x13c31b of _0x44d4a2){const _0x47b752=await(0x0,EmailService_1[_0x28f575(0x124)])(_0x13c31b[_0x28f575(0x114)],_0x13c31b[_0x28f575(0x12e)],'',_0x13c31b[_0x28f575(0x118)],_0x13c31b[_0x28f575(0x122)],_0x13c31b[_0x28f575(0x137)][_0x28f575(0x129)](),'');!_0x47b752[_0x28f575(0x131)]?(await _0x13c31b[_0x28f575(0x11f)]({'scheduled':![]}),logger[_0x28f575(0x130)](_0x28f575(0x123)+_0x13c31b[_0x28f575(0x12e)])):logger[_0x28f575(0x131)](_0x28f575(0x143)+_0x13c31b[_0x28f575(0x12e)]+_0x28f575(0x111)+_0x47b752[_0x28f575(0x131)]);}}catch(_0x360f4d){logger['error'](_0x28f575(0x138),_0x360f4d);}};function a17_0x3c59(_0xe0ccb,_0x2b758f){const _0x270a5d=a17_0x1a91();return a17_0x3c59=function(_0x322c47,_0x31f878){_0x322c47=_0x322c47-0xff;let _0x1a919f=_0x270a5d[_0x322c47];return _0x1a919f;},a17_0x3c59(_0xe0ccb,_0x2b758f);}node_cron_1[a17_0xd7f114(0x11a)][a17_0xd7f114(0x128)](a17_0xd7f114(0x133),enviarAgendamentosPendentes);