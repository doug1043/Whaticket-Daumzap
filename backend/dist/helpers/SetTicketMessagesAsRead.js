const a354_0x63e8a5=a354_0xbe98;(function(_0x50ddfa,_0x2b36d1){const _0x1af9a1=a354_0xbe98,_0x25dab7=_0x50ddfa();while(!![]){try{const _0x5a704b=parseInt(_0x1af9a1(0x1db))/0x1*(-parseInt(_0x1af9a1(0x1e7))/0x2)+parseInt(_0x1af9a1(0x1b3))/0x3+parseInt(_0x1af9a1(0x1d0))/0x4+-parseInt(_0x1af9a1(0x1c4))/0x5*(-parseInt(_0x1af9a1(0x1cf))/0x6)+-parseInt(_0x1af9a1(0x1dc))/0x7*(-parseInt(_0x1af9a1(0x1e4))/0x8)+-parseInt(_0x1af9a1(0x1c8))/0x9+parseInt(_0x1af9a1(0x1c2))/0xa*(-parseInt(_0x1af9a1(0x1e8))/0xb);if(_0x5a704b===_0x2b36d1)break;else _0x25dab7['push'](_0x25dab7['shift']());}catch(_0x339c24){_0x25dab7['push'](_0x25dab7['shift']());}}}(a354_0x50af,0x87005));const a354_0x35f54f=(function(){let _0x14c1d8=!![];return function(_0xe23e4a,_0x5b343d){const _0x10a207=_0x14c1d8?function(){const _0x419b4d=a354_0xbe98;if(_0x5b343d){const _0x5deb79=_0x5b343d[_0x419b4d(0x1b2)](_0xe23e4a,arguments);return _0x5b343d=null,_0x5deb79;}}:function(){};return _0x14c1d8=![],_0x10a207;};}()),a354_0x1bf72b=a354_0x35f54f(this,function(){const _0x112985=a354_0xbe98;return a354_0x1bf72b[_0x112985(0x1b5)]()[_0x112985(0x1e5)](_0x112985(0x1d5))[_0x112985(0x1b5)]()[_0x112985(0x1de)](a354_0x1bf72b)[_0x112985(0x1e5)](_0x112985(0x1d5));});a354_0x1bf72b();function a354_0xbe98(_0x2b3399,_0xbb1540){const _0x4ddb90=a354_0x50af();return a354_0xbe98=function(_0x1bf72b,_0x35f54f){_0x1bf72b=_0x1bf72b-0x1b1;let _0x50af2c=_0x4ddb90[_0x1bf72b];return _0x50af2c;},a354_0xbe98(_0x2b3399,_0xbb1540);}'use strict';function a354_0x50af(){const _0x2f5843=[':unreads','default','3963195duGOup','contactId','logger','status','map','remoteJid','\x20messages\x20of\x20ticket\x20','510GjNnbE','4302236iMuPdG','length','__importDefault','companyId','../models/Message','(((.+)+)+)+$','../libs/socket','./GetTicketWbot','../utils/logger','getIO','key','403RigHVd','7QnEDAW','error','constructor','fromMe','cacheLayer','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20','Marking\x20','chatModify','2236528isWuMI','search','message','172wDzyNy','6809VpHjIO','__esModule','queue-','queueId','apply','269355kKyKqI','set','toString','DESC','readMessages','defineProperty','update','parse','findAll','updateUnread','dataJson','contacts:','catch','debug','-ticket','23130HfAfCf','company-','59695orzpuj','createdAt'];a354_0x50af=function(){return _0x2f5843;};return a354_0x50af();}var __importDefault=this&&this[a354_0x63e8a5(0x1d2)]||function(_0x46aa82){const _0x5dc131=a354_0x63e8a5;return _0x46aa82&&_0x46aa82[_0x5dc131(0x1e9)]?_0x46aa82:{'default':_0x46aa82};};Object[a354_0x63e8a5(0x1b8)](exports,a354_0x63e8a5(0x1e9),{'value':!![]});const cache_1=require('../libs/cache'),socket_1=require(a354_0x63e8a5(0x1d6)),Message_1=__importDefault(require(a354_0x63e8a5(0x1d4))),logger_1=require(a354_0x63e8a5(0x1d8)),GetTicketWbot_1=__importDefault(require(a354_0x63e8a5(0x1d7))),SetTicketMessagesAsRead=async _0x3aec77=>{const _0x592495=a354_0x63e8a5;await _0x3aec77[_0x592495(0x1b9)]({'unreadMessages':0x0},{'silent':!![]}),await cache_1[_0x592495(0x1e0)][_0x592495(0x1b4)](_0x592495(0x1be)+_0x3aec77[_0x592495(0x1c9)]+_0x592495(0x1c6),'0');let _0x4a4f75;try{const _0x193129=await(0x0,GetTicketWbot_1[_0x592495(0x1c7)])(_0x3aec77),_0x387b98=await Message_1['default'][_0x592495(0x1bb)]({'attributes':['id',_0x592495(0x1d3),_0x592495(0x1bd)],'where':{'ticketId':_0x3aec77['id'],'fromMe':![],'read':![]},'order':[[_0x592495(0x1c5),_0x592495(0x1b6)]]});if(_0x387b98['length']===0x0)return;_0x4a4f75=_0x387b98[0x0]?.['companyId'];const _0x4387bf=_0x387b98[_0x592495(0x1cc)](_0x1bc4b5=>{const _0x73a034=_0x592495,_0x13c1da=JSON['parse'](_0x1bc4b5[_0x73a034(0x1bd)]);return _0x13c1da['key'];})['filter'](_0x437a8f=>_0x437a8f!==undefined);logger_1[_0x592495(0x1ca)][_0x592495(0x1c0)]({'messageKeys':_0x4387bf,'ticketId':_0x3aec77['id']},_0x592495(0x1e2)+_0x4387bf[_0x592495(0x1d1)]+_0x592495(0x1ce)+_0x3aec77['id']+'\x20as\x20read');const _0x3a56ef=0xfa;for(let _0x4c4c33=0x0;_0x4c4c33<_0x4387bf[_0x592495(0x1d1)];_0x4c4c33+=_0x3a56ef){const _0x13a54e=_0x4387bf['slice'](_0x4c4c33,_0x4c4c33+_0x3a56ef);_0x193129[_0x592495(0x1b7)](_0x13a54e)[_0x592495(0x1bf)](_0x1bae6e=>{const _0x290133=_0x592495;logger_1[_0x290133(0x1ca)][_0x290133(0x1dd)]({'error':_0x1bae6e},'Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20'+_0x1bae6e?.[_0x290133(0x1e6)]);});}const _0x544b1c=JSON[_0x592495(0x1ba)](_0x387b98[0x0][_0x592495(0x1bd)]),_0x5aac79=_0x544b1c?.[_0x592495(0x1da)];_0x5aac79?.[_0x592495(0x1cd)]&&!_0x5aac79[_0x592495(0x1df)]&&_0x193129[_0x592495(0x1e3)]({'markRead':!![],'lastMessages':[_0x544b1c]},_0x5aac79[_0x592495(0x1cd)])[_0x592495(0x1bf)](_0xf3dd3c=>{const _0x5cbe86=_0x592495;logger_1[_0x5cbe86(0x1ca)][_0x5cbe86(0x1dd)]({'error':_0xf3dd3c},'Could\x20not\x20modify\x20chat.\x20Err:\x20'+_0xf3dd3c?.[_0x5cbe86(0x1e6)]);}),await Message_1['default']['update']({'read':!![]},{'where':{'ticketId':_0x3aec77['id'],'read':![]}});}catch(_0x303f1d){logger_1[_0x592495(0x1ca)][_0x592495(0x1dd)]({'error':_0x303f1d},_0x592495(0x1e1)+_0x303f1d?.[_0x592495(0x1e6)]);}const _0x2cbe9e=(0x0,socket_1[_0x592495(0x1d9)])();_0x4a4f75&&_0x2cbe9e['to'](_0x3aec77['id']['toString']())['to'](_0x592495(0x1c3)+_0x4a4f75+'-'+_0x3aec77[_0x592495(0x1cb)])['to'](_0x592495(0x1ea)+_0x3aec77[_0x592495(0x1b1)]+'-'+_0x3aec77[_0x592495(0x1cb)])['emit'](_0x592495(0x1c3)+_0x4a4f75+_0x592495(0x1c1),{'action':_0x592495(0x1bc),'ticketId':_0x3aec77['id']});};exports[a354_0x63e8a5(0x1c7)]=SetTicketMessagesAsRead;