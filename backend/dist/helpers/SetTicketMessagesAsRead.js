const a285_0x520366=a285_0x4135;(function(_0x49bb94,_0x17f874){const _0x3638aa=a285_0x4135,_0x59730d=_0x49bb94();while(!![]){try{const _0x21dfd1=-parseInt(_0x3638aa(0xcd))/0x1*(-parseInt(_0x3638aa(0xb2))/0x2)+-parseInt(_0x3638aa(0xc6))/0x3*(parseInt(_0x3638aa(0x9a))/0x4)+parseInt(_0x3638aa(0xba))/0x5*(-parseInt(_0x3638aa(0xa0))/0x6)+parseInt(_0x3638aa(0xab))/0x7+-parseInt(_0x3638aa(0xce))/0x8+parseInt(_0x3638aa(0xc4))/0x9*(parseInt(_0x3638aa(0xca))/0xa)+parseInt(_0x3638aa(0xb8))/0xb*(-parseInt(_0x3638aa(0xc0))/0xc);if(_0x21dfd1===_0x17f874)break;else _0x59730d['push'](_0x59730d['shift']());}catch(_0x558231){_0x59730d['push'](_0x59730d['shift']());}}}(a285_0xf613,0x962e2));const a285_0x4821cd=(function(){let _0x50c97b=!![];return function(_0x1cda6e,_0x4dfb36){const _0x547b4c=_0x50c97b?function(){const _0x3cf85f=a285_0x4135;if(_0x4dfb36){const _0x1f3f88=_0x4dfb36[_0x3cf85f(0xcf)](_0x1cda6e,arguments);return _0x4dfb36=null,_0x1f3f88;}}:function(){};return _0x50c97b=![],_0x547b4c;};}()),a285_0xf06f09=a285_0x4821cd(this,function(){const _0x20ad23=a285_0x4135;return a285_0xf06f09[_0x20ad23(0xb9)]()[_0x20ad23(0xb0)](_0x20ad23(0xcc))['toString']()['constructor'](a285_0xf06f09)[_0x20ad23(0xb0)](_0x20ad23(0xcc));});a285_0xf06f09();'use strict';var __importDefault=this&&this[a285_0x520366(0xc9)]||function(_0x5b4540){const _0x2ac5f9=a285_0x520366;return _0x5b4540&&_0x5b4540[_0x2ac5f9(0xc7)]?_0x5b4540:{'default':_0x5b4540};};function a285_0x4135(_0x38eb36,_0x252ba9){const _0x670f9f=a285_0xf613();return a285_0x4135=function(_0xf06f09,_0x4821cd){_0xf06f09=_0xf06f09-0x9a;let _0xf61380=_0x670f9f[_0xf06f09];return _0xf61380;},a285_0x4135(_0x38eb36,_0x252ba9);}Object[a285_0x520366(0xb5)](exports,a285_0x520366(0xc7),{'value':!![]});const cache_1=require(a285_0x520366(0xae)),socket_1=require('../libs/socket'),Message_1=__importDefault(require('../models/Message')),logger_1=require('../utils/logger'),GetTicketWbot_1=__importDefault(require(a285_0x520366(0xaa))),SetTicketMessagesAsRead=async _0x30fc64=>{const _0x218327=a285_0x520366;await _0x30fc64['update']({'unreadMessages':0x0},{'silent':!![]}),await cache_1[_0x218327(0xc8)][_0x218327(0xb7)](_0x218327(0xd0)+_0x30fc64['contactId']+_0x218327(0xbe),'0');let _0x413cca;try{const _0x5c657f=await(0x0,GetTicketWbot_1[_0x218327(0xad)])(_0x30fc64),_0x1c4780=await Message_1[_0x218327(0xad)]['findAll']({'attributes':['id',_0x218327(0xbf),_0x218327(0xbc)],'where':{'ticketId':_0x30fc64['id'],'fromMe':![],'read':![]},'order':[[_0x218327(0xa8),_0x218327(0xbb)]]});if(_0x1c4780[_0x218327(0xd1)]===0x0)return;_0x413cca=_0x1c4780[0x0]?.[_0x218327(0xbf)];const _0x8e0cba=_0x1c4780[_0x218327(0x9f)](_0x1882ab=>{const _0x4cf46a=_0x218327,_0x295908=JSON[_0x4cf46a(0xb1)](_0x1882ab[_0x4cf46a(0xbc)]);return _0x295908[_0x4cf46a(0xa6)];})[_0x218327(0x9d)](_0x361442=>_0x361442!==undefined);logger_1[_0x218327(0xa4)]['debug']({'messageKeys':_0x8e0cba,'ticketId':_0x30fc64['id']},_0x218327(0xa3)+_0x8e0cba[_0x218327(0xd1)]+_0x218327(0x9b)+_0x30fc64['id']+_0x218327(0xc2));const _0x577d74=0xfa;for(let _0x55ebe9=0x0;_0x55ebe9<_0x8e0cba[_0x218327(0xd1)];_0x55ebe9+=_0x577d74){const _0x3ef3de=_0x8e0cba[_0x218327(0x9c)](_0x55ebe9,_0x55ebe9+_0x577d74);_0x5c657f[_0x218327(0xaf)](_0x3ef3de)[_0x218327(0xc1)](_0x584d49=>{const _0x2da7b1=_0x218327;logger_1[_0x2da7b1(0xa4)]['error']({'error':_0x584d49},'Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20'+_0x584d49?.[_0x2da7b1(0xa7)]);});}const _0x4fe5c7=JSON['parse'](_0x1c4780[0x0][_0x218327(0xbc)]);_0x4fe5c7?.[_0x218327(0xa6)]?.[_0x218327(0xa9)]&&!_0x4fe5c7[_0x218327(0xa6)][_0x218327(0xa1)]&&_0x5c657f[_0x218327(0xd2)]({'markRead':!![],'lastMessages':[_0x4fe5c7]},_0x4fe5c7[_0x218327(0xa6)]['remoteJid'])[_0x218327(0xc1)](_0x3ca2c0=>{const _0x3191bd=_0x218327;logger_1[_0x3191bd(0xa4)][_0x3191bd(0xb4)]({'error':_0x3ca2c0},_0x3191bd(0xc3)+_0x3ca2c0?.[_0x3191bd(0xa7)]);}),await Message_1[_0x218327(0xad)][_0x218327(0xb6)]({'read':!![]},{'where':{'ticketId':_0x30fc64['id'],'read':![]}});}catch(_0x519759){logger_1[_0x218327(0xa4)]['error']({'error':_0x519759},_0x218327(0xb3)+_0x519759?.[_0x218327(0xa7)]);}const _0x42e4a3=(0x0,socket_1[_0x218327(0xac)])();_0x413cca&&_0x42e4a3['to'](_0x30fc64['id'][_0x218327(0xb9)]())['to'](_0x218327(0xcb)+_0x413cca+'-'+_0x30fc64[_0x218327(0xa2)])['to']('queue-'+_0x30fc64[_0x218327(0x9e)]+'-'+_0x30fc64[_0x218327(0xa2)])[_0x218327(0xa5)](_0x218327(0xcb)+_0x413cca+_0x218327(0xbd),{'action':_0x218327(0xc5),'ticketId':_0x30fc64['id']});};function a285_0xf613(){const _0x476cd8=['queueId','map','2442KCjTjN','fromMe','status','Marking\x20','logger','emit','key','message','createdAt','remoteJid','./GetTicketWbot','5795566jwlBQS','getIO','default','../libs/cache','readMessages','search','parse','2jzScpv','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20','error','defineProperty','update','set','110hLYfqz','toString','6005aVRxTl','DESC','dataJson','-ticket',':unreads','companyId','61596EFEOAp','catch','\x20as\x20read','Could\x20not\x20modify\x20chat.\x20Err:\x20','99lMOPFF','updateUnread','257514vMkrBA','__esModule','cacheLayer','__importDefault','688810MtYxTD','company-','(((.+)+)+)+$','175307ZgAqEP','3471880zIXoDz','apply','contacts:','length','chatModify','8xPykdD','\x20messages\x20of\x20ticket\x20','slice','filter'];a285_0xf613=function(){return _0x476cd8;};return a285_0xf613();}exports[a285_0x520366(0xad)]=SetTicketMessagesAsRead;