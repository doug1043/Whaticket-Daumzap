const a249_0x391220=a249_0x3f50;(function(_0xee2be2,_0x1d12c9){const _0x4413a4=a249_0x3f50,_0x2b7a44=_0xee2be2();while(!![]){try{const _0x4c5ce0=-parseInt(_0x4413a4(0x84))/0x1*(parseInt(_0x4413a4(0x89))/0x2)+-parseInt(_0x4413a4(0x98))/0x3*(parseInt(_0x4413a4(0x92))/0x4)+-parseInt(_0x4413a4(0x7e))/0x5*(parseInt(_0x4413a4(0x90))/0x6)+-parseInt(_0x4413a4(0x87))/0x7+-parseInt(_0x4413a4(0x79))/0x8+-parseInt(_0x4413a4(0x7f))/0x9*(parseInt(_0x4413a4(0x88))/0xa)+-parseInt(_0x4413a4(0xa1))/0xb*(-parseInt(_0x4413a4(0x82))/0xc);if(_0x4c5ce0===_0x1d12c9)break;else _0x2b7a44['push'](_0x2b7a44['shift']());}catch(_0x4e2755){_0x2b7a44['push'](_0x2b7a44['shift']());}}}(a249_0x2774,0x9366a));const a249_0x3c94db=(function(){let _0x7ec93a=!![];return function(_0x2478fa,_0x844880){const _0x43d4c4=_0x7ec93a?function(){if(_0x844880){const _0x502d38=_0x844880['apply'](_0x2478fa,arguments);return _0x844880=null,_0x502d38;}}:function(){};return _0x7ec93a=![],_0x43d4c4;};}()),a249_0x144218=a249_0x3c94db(this,function(){const _0x44654f=a249_0x3f50;return a249_0x144218[_0x44654f(0x6f)]()[_0x44654f(0x9e)](_0x44654f(0x96))[_0x44654f(0x6f)]()[_0x44654f(0x94)](a249_0x144218)[_0x44654f(0x9e)](_0x44654f(0x96));});a249_0x144218();'use strict';function a249_0x2774(){const _0x480f52=['status','logger','warn','@s.whatsapp.net','5523672asyaoh','__esModule','readMessages','-ticket','sendReceipt','8995XgpNAw','91548FTuUfY','emit','key','31644gBQXdi','../libs/cache','2EIdXpC','length','contacts:','4436075ZQzciw','100zdQKYg','764086vADmOC','defineProperty','../libs/socket','dataJson','contactId','DESC','fromMe','438iMTNpM','companyId','4FdwsUX','../utils/logger','constructor','__importDefault','(((.+)+)+)+$','default','1422066PrfypG','read','updateUnread','findAll','cacheLayer','getIO','search','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','createdAt','14179ArrjYp','contact','substring','toString','company-','number','@g.us','update','parse'];a249_0x2774=function(){return _0x480f52;};return a249_0x2774();}var __importDefault=this&&this[a249_0x391220(0x95)]||function(_0x501afa){const _0x5cfea9=a249_0x391220;return _0x501afa&&_0x501afa[_0x5cfea9(0x7a)]?_0x501afa:{'default':_0x501afa};};function a249_0x3f50(_0x1b8fd6,_0x322fbc){const _0x13a55c=a249_0x2774();return a249_0x3f50=function(_0x144218,_0x3c94db){_0x144218=_0x144218-0x6f;let _0x27748a=_0x13a55c[_0x144218];return _0x27748a;},a249_0x3f50(_0x1b8fd6,_0x322fbc);}Object[a249_0x391220(0x8a)](exports,a249_0x391220(0x7a),{'value':!![]});const socket_1=require(a249_0x391220(0x8b)),Message_1=__importDefault(require('../models/Message')),logger_1=require(a249_0x391220(0x93)),GetTicketWbot_1=__importDefault(require('./GetTicketWbot')),cache_1=require(a249_0x391220(0x83)),SetTicketMessagesAsRead=async _0x545099=>{const _0x525219=a249_0x391220;async function _0x3266d9(_0x4bfff0,_0x114d5f,_0x169abb,_0x251c61){const _0x1ef9d3=a249_0x3f50;await _0x4bfff0[_0x1ef9d3(0x7d)](_0x114d5f,_0x169abb,[_0x251c61],_0x1ef9d3(0x99));}await _0x545099['update']({'unreadMessages':0x0});try{const _0x2191eb=await(0x0,GetTicketWbot_1[_0x525219(0x97)])(_0x545099),_0xe208ba=await Message_1[_0x525219(0x97)][_0x525219(0x9b)]({'where':{'ticketId':_0x545099['id'],'fromMe':![],'read':![]},'order':[[_0x525219(0xa0),_0x525219(0x8e)]]});_0xe208ba['map'](async _0x4d538b=>{const _0xcfef52=_0x525219,_0x570e01=JSON[_0xcfef52(0x74)](_0x4d538b[_0xcfef52(0x8c)]);_0x570e01['key']&&await _0x2191eb[_0xcfef52(0x7b)]([_0x570e01[_0xcfef52(0x81)]]);});if(_0xe208ba[_0x525219(0x85)]>0x0){const _0x3d9627=JSON[_0x525219(0x74)](_0xe208ba[0x0]['dataJson']),_0x122463=_0x545099['isGroup']?_0x545099[_0x525219(0xa2)][_0x525219(0x71)][_0x525219(0xa3)](0xc,0x0)+'-'+_0x545099[_0x525219(0xa2)]['number']['substring'](0xc)+_0x525219(0x72):_0x545099[_0x525219(0xa2)]['number']+_0x525219(0x78);_0x3d9627[_0x525219(0x81)]&&_0x3d9627['key'][_0x525219(0x8f)]===![]&&await _0x2191eb['chatModify']({'markRead':!![],'lastMessages':[_0x3d9627]},_0x122463);}await Message_1[_0x525219(0x97)][_0x525219(0x73)]({'read':!![]},{'where':{'ticketId':_0x545099['id'],'read':![]}}),await cache_1[_0x525219(0x9c)]['set'](_0x525219(0x86)+_0x545099[_0x525219(0x8d)]+':unreads','0');}catch(_0x100f73){logger_1[_0x525219(0x76)][_0x525219(0x77)](_0x525219(0x9f)+_0x100f73);}const _0x5942d6=(0x0,socket_1[_0x525219(0x9d)])();_0x5942d6['to'](_0x525219(0x70)+_0x545099['companyId']+'-'+_0x545099[_0x525219(0x75)])['to'](_0x525219(0x70)+_0x545099[_0x525219(0x91)]+'-notification')[_0x525219(0x80)](_0x525219(0x70)+_0x545099[_0x525219(0x91)]+_0x525219(0x7c),{'action':_0x525219(0x9a),'ticketId':_0x545099['id']});};exports[a249_0x391220(0x97)]=SetTicketMessagesAsRead;