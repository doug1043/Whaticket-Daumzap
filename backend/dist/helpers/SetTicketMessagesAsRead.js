const a286_0x43fa0e=a286_0x5b66;function a286_0x43c3(){const _0x24cc86=['13193780dVmAEr','length','444dVPZTP','key','emit','25900TTxQzG','catch','29HPsyfk','map','cacheLayer','apply','defineProperty','createdAt','__esModule','807168FoZHfi','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20','getIO','__importDefault',':unreads','updateUnread','Could\x20not\x20modify\x20chat.\x20Err:\x20','(((.+)+)+)+$','DESC','contactId','1890tSRofQ','set','6WgVexB','companyId','chatModify','debug','default','607264ZqLxjv','error','toString','../utils/logger','queue-','dataJson','findAll','company-','../models/Message','Marking\x20','search','filter','10731465KkXvqd','parse','status','remoteJid','../libs/socket','8781241zoqTmA','-ticket','message','logger','slice'];a286_0x43c3=function(){return _0x24cc86;};return a286_0x43c3();}(function(_0xf78579,_0x4ae934){const _0xdf6013=a286_0x5b66,_0x33db98=_0xf78579();while(!![]){try{const _0x312902=parseInt(_0xdf6013(0x1fb))/0x1*(-parseInt(_0xdf6013(0x1f9))/0x2)+-parseInt(_0xdf6013(0x202))/0x3+parseInt(_0xdf6013(0x1f6))/0x4*(-parseInt(_0xdf6013(0x20c))/0x5)+parseInt(_0xdf6013(0x20e))/0x6*(-parseInt(_0xdf6013(0x1ef))/0x7)+parseInt(_0xdf6013(0x1de))/0x8+parseInt(_0xdf6013(0x1ea))/0x9+parseInt(_0xdf6013(0x1f4))/0xa;if(_0x312902===_0x4ae934)break;else _0x33db98['push'](_0x33db98['shift']());}catch(_0x5c0893){_0x33db98['push'](_0x33db98['shift']());}}}(a286_0x43c3,0x9ddf4));function a286_0x5b66(_0x47b20f,_0x4887f0){const _0x18b2ea=a286_0x43c3();return a286_0x5b66=function(_0x26666b,_0x37cbb3){_0x26666b=_0x26666b-0x1db;let _0x43c3a2=_0x18b2ea[_0x26666b];return _0x43c3a2;},a286_0x5b66(_0x47b20f,_0x4887f0);}const a286_0x37cbb3=(function(){let _0x529de1=!![];return function(_0x53e82f,_0x4b9a4d){const _0x25cee3=_0x529de1?function(){const _0x3312c=a286_0x5b66;if(_0x4b9a4d){const _0x1168f7=_0x4b9a4d[_0x3312c(0x1fe)](_0x53e82f,arguments);return _0x4b9a4d=null,_0x1168f7;}}:function(){};return _0x529de1=![],_0x25cee3;};}()),a286_0x26666b=a286_0x37cbb3(this,function(){const _0xecd1d4=a286_0x5b66;return a286_0x26666b[_0xecd1d4(0x1e0)]()[_0xecd1d4(0x1e8)](_0xecd1d4(0x209))[_0xecd1d4(0x1e0)]()['constructor'](a286_0x26666b)[_0xecd1d4(0x1e8)](_0xecd1d4(0x209));});a286_0x26666b();'use strict';var __importDefault=this&&this[a286_0x43fa0e(0x205)]||function(_0x33238e){const _0x1fde7e=a286_0x43fa0e;return _0x33238e&&_0x33238e[_0x1fde7e(0x201)]?_0x33238e:{'default':_0x33238e};};Object[a286_0x43fa0e(0x1ff)](exports,a286_0x43fa0e(0x201),{'value':!![]});const cache_1=require('../libs/cache'),socket_1=require(a286_0x43fa0e(0x1ee)),Message_1=__importDefault(require(a286_0x43fa0e(0x1e6))),logger_1=require(a286_0x43fa0e(0x1e1)),GetTicketWbot_1=__importDefault(require('./GetTicketWbot')),SetTicketMessagesAsRead=async _0x2535af=>{const _0x4320da=a286_0x43fa0e;await _0x2535af['update']({'unreadMessages':0x0},{'silent':!![]}),await cache_1[_0x4320da(0x1fd)][_0x4320da(0x20d)]('contacts:'+_0x2535af[_0x4320da(0x20b)]+_0x4320da(0x206),'0');let _0x26a52a;try{const _0x42564c=await(0x0,GetTicketWbot_1['default'])(_0x2535af),_0x3ac21c=await Message_1['default'][_0x4320da(0x1e4)]({'attributes':['id',_0x4320da(0x20f),'dataJson'],'where':{'ticketId':_0x2535af['id'],'fromMe':![],'read':![]},'order':[[_0x4320da(0x200),_0x4320da(0x20a)]]});if(_0x3ac21c[_0x4320da(0x1f5)]===0x0)return;_0x26a52a=_0x3ac21c[0x0]?.[_0x4320da(0x20f)];const _0x215335=_0x3ac21c[_0x4320da(0x1fc)](_0x15b124=>{const _0x364a10=_0x4320da,_0x13f453=JSON['parse'](_0x15b124['dataJson']);return _0x13f453[_0x364a10(0x1f7)];})[_0x4320da(0x1e9)](_0xc3f68b=>_0xc3f68b!==undefined);logger_1[_0x4320da(0x1f2)][_0x4320da(0x1dc)]({'messageKeys':_0x215335,'ticketId':_0x2535af['id']},_0x4320da(0x1e7)+_0x215335[_0x4320da(0x1f5)]+'\x20messages\x20of\x20ticket\x20'+_0x2535af['id']+'\x20as\x20read');const _0x290890=0xfa;for(let _0x1d002f=0x0;_0x1d002f<_0x215335[_0x4320da(0x1f5)];_0x1d002f+=_0x290890){const _0x44caa8=_0x215335[_0x4320da(0x1f3)](_0x1d002f,_0x1d002f+_0x290890);_0x42564c['readMessages'](_0x44caa8)[_0x4320da(0x1fa)](_0x350262=>{const _0x2c59bc=_0x4320da;logger_1[_0x2c59bc(0x1f2)][_0x2c59bc(0x1df)]({'error':_0x350262},'Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20'+_0x350262?.['message']);});}const _0x5a267c=JSON[_0x4320da(0x1eb)](_0x3ac21c[0x0][_0x4320da(0x1e3)]);_0x5a267c?.[_0x4320da(0x1f7)]?.[_0x4320da(0x1ed)]&&!_0x5a267c[_0x4320da(0x1f7)]['fromMe']&&_0x42564c[_0x4320da(0x1db)]({'markRead':!![],'lastMessages':[_0x5a267c]},_0x5a267c[_0x4320da(0x1f7)][_0x4320da(0x1ed)])[_0x4320da(0x1fa)](_0x367dc3=>{const _0x5ee904=_0x4320da;logger_1[_0x5ee904(0x1f2)][_0x5ee904(0x1df)]({'error':_0x367dc3},_0x5ee904(0x208)+_0x367dc3?.[_0x5ee904(0x1f1)]);}),await Message_1['default']['update']({'read':!![]},{'where':{'ticketId':_0x2535af['id'],'read':![]}});}catch(_0x94706b){logger_1[_0x4320da(0x1f2)][_0x4320da(0x1df)]({'error':_0x94706b},_0x4320da(0x203)+_0x94706b?.[_0x4320da(0x1f1)]);}const _0x3464f8=(0x0,socket_1[_0x4320da(0x204)])();_0x26a52a&&_0x3464f8['to'](_0x2535af['id'][_0x4320da(0x1e0)]())['to'](_0x4320da(0x1e5)+_0x26a52a+'-'+_0x2535af[_0x4320da(0x1ec)])['to'](_0x4320da(0x1e2)+_0x2535af['queueId']+'-'+_0x2535af[_0x4320da(0x1ec)])[_0x4320da(0x1f8)](_0x4320da(0x1e5)+_0x26a52a+_0x4320da(0x1f0),{'action':_0x4320da(0x207),'ticketId':_0x2535af['id']});};exports[a286_0x43fa0e(0x1dd)]=SetTicketMessagesAsRead;