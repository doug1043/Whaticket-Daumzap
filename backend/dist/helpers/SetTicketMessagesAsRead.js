const a287_0x45e828=a287_0xf17b;(function(_0x46b488,_0x33e544){const _0x3ef772=a287_0xf17b,_0x5e73f2=_0x46b488();while(!![]){try{const _0x548d90=-parseInt(_0x3ef772(0x185))/0x1+parseInt(_0x3ef772(0x18d))/0x2*(parseInt(_0x3ef772(0x192))/0x3)+-parseInt(_0x3ef772(0x190))/0x4+-parseInt(_0x3ef772(0x1b7))/0x5*(-parseInt(_0x3ef772(0x19e))/0x6)+parseInt(_0x3ef772(0x1a0))/0x7*(-parseInt(_0x3ef772(0x197))/0x8)+-parseInt(_0x3ef772(0x1a4))/0x9*(parseInt(_0x3ef772(0x181))/0xa)+parseInt(_0x3ef772(0x191))/0xb;if(_0x548d90===_0x33e544)break;else _0x5e73f2['push'](_0x5e73f2['shift']());}catch(_0x58ab37){_0x5e73f2['push'](_0x5e73f2['shift']());}}}(a287_0x5c3f,0xb215b));const a287_0xadcaa6=(function(){let _0xb84c81=!![];return function(_0x191a9d,_0x3a4e09){const _0x46ba16=_0xb84c81?function(){const _0x12fca1=a287_0xf17b;if(_0x3a4e09){const _0x3a7950=_0x3a4e09[_0x12fca1(0x19c)](_0x191a9d,arguments);return _0x3a4e09=null,_0x3a7950;}}:function(){};return _0xb84c81=![],_0x46ba16;};}()),a287_0x3f4347=a287_0xadcaa6(this,function(){const _0x19090c=a287_0xf17b;return a287_0x3f4347[_0x19090c(0x1a2)]()[_0x19090c(0x193)](_0x19090c(0x1b4))['toString']()[_0x19090c(0x1a1)](a287_0x3f4347)[_0x19090c(0x193)](_0x19090c(0x1b4));});a287_0x3f4347();function a287_0x5c3f(){const _0xf46ee3=['updateUnread','parse','dataJson','catch','\x20messages\x20of\x20ticket\x20','company-','__esModule','remoteJid','../libs/socket','update','Could\x20not\x20modify\x20chat.\x20Err:\x20','key','logger','(((.+)+)+)+$','createdAt','readMessages','460JYbbLO','1326270xCEQfG','error','fromMe','companyId','930458bScVfu','defineProperty','Marking\x20','length','message','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20','queueId','chatModify','31534BWuqkr','../utils/logger','contacts:','113508dZqTrH','20464620rKsGBh','9MJvFYD','search','status','__importDefault','filter','2221872uKXQWD','slice','debug','emit','../models/Message','apply','getIO','65976rbdRVv','default','21tkGaPW','constructor','toString',':unreads','27UTZZkd','DESC','map'];a287_0x5c3f=function(){return _0xf46ee3;};return a287_0x5c3f();}'use strict';var __importDefault=this&&this[a287_0x45e828(0x195)]||function(_0x14c006){const _0x61df5=a287_0x45e828;return _0x14c006&&_0x14c006[_0x61df5(0x1ad)]?_0x14c006:{'default':_0x14c006};};function a287_0xf17b(_0x40bb04,_0x511d9e){const _0x2a84a5=a287_0x5c3f();return a287_0xf17b=function(_0x3f4347,_0xadcaa6){_0x3f4347=_0x3f4347-0x181;let _0x5c3fb8=_0x2a84a5[_0x3f4347];return _0x5c3fb8;},a287_0xf17b(_0x40bb04,_0x511d9e);}Object[a287_0x45e828(0x186)](exports,a287_0x45e828(0x1ad),{'value':!![]});const cache_1=require('../libs/cache'),socket_1=require(a287_0x45e828(0x1af)),Message_1=__importDefault(require(a287_0x45e828(0x19b))),logger_1=require(a287_0x45e828(0x18e)),GetTicketWbot_1=__importDefault(require('./GetTicketWbot')),SetTicketMessagesAsRead=async _0x27785e=>{const _0x49df76=a287_0x45e828;await _0x27785e['update']({'unreadMessages':0x0},{'silent':!![]}),await cache_1['cacheLayer']['set'](_0x49df76(0x18f)+_0x27785e['contactId']+_0x49df76(0x1a3),'0');let _0x552bcd;try{const _0x46cfdc=await(0x0,GetTicketWbot_1['default'])(_0x27785e),_0x366236=await Message_1[_0x49df76(0x19f)]['findAll']({'attributes':['id','companyId',_0x49df76(0x1a9)],'where':{'ticketId':_0x27785e['id'],'fromMe':![],'read':![]},'order':[[_0x49df76(0x1b5),_0x49df76(0x1a5)]]});if(_0x366236[_0x49df76(0x188)]===0x0)return;_0x552bcd=_0x366236[0x0]?.[_0x49df76(0x184)];const _0x4f686b=_0x366236[_0x49df76(0x1a6)](_0x2954a2=>{const _0x30fd66=_0x49df76,_0x4e5bc4=JSON['parse'](_0x2954a2['dataJson']);return _0x4e5bc4[_0x30fd66(0x1b2)];})[_0x49df76(0x196)](_0x532909=>_0x532909!==undefined);logger_1[_0x49df76(0x1b3)][_0x49df76(0x199)]({'messageKeys':_0x4f686b,'ticketId':_0x27785e['id']},_0x49df76(0x187)+_0x4f686b[_0x49df76(0x188)]+_0x49df76(0x1ab)+_0x27785e['id']+'\x20as\x20read');const _0x51cee3=0xfa;for(let _0x2e218a=0x0;_0x2e218a<_0x4f686b[_0x49df76(0x188)];_0x2e218a+=_0x51cee3){const _0x7437ee=_0x4f686b[_0x49df76(0x198)](_0x2e218a,_0x2e218a+_0x51cee3);_0x46cfdc[_0x49df76(0x1b6)](_0x7437ee)[_0x49df76(0x1aa)](_0x4081a=>{const _0x24fd81=_0x49df76;logger_1[_0x24fd81(0x1b3)][_0x24fd81(0x182)]({'error':_0x4081a},'Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20'+_0x4081a?.[_0x24fd81(0x189)]);});}const _0x4858b5=JSON[_0x49df76(0x1a8)](_0x366236[0x0][_0x49df76(0x1a9)]),_0x2c8298=_0x4858b5?.['key'];_0x2c8298?.[_0x49df76(0x1ae)]&&!_0x2c8298[_0x49df76(0x183)]&&_0x46cfdc[_0x49df76(0x18c)]({'markRead':!![],'lastMessages':[_0x4858b5]},_0x2c8298[_0x49df76(0x1ae)])[_0x49df76(0x1aa)](_0x5f43d7=>{const _0x4f9f7f=_0x49df76;logger_1[_0x4f9f7f(0x1b3)]['error']({'error':_0x5f43d7},_0x4f9f7f(0x1b1)+_0x5f43d7?.[_0x4f9f7f(0x189)]);}),await Message_1[_0x49df76(0x19f)][_0x49df76(0x1b0)]({'read':!![]},{'where':{'ticketId':_0x27785e['id'],'read':![]}});}catch(_0x4ff596){logger_1['logger']['error']({'error':_0x4ff596},_0x49df76(0x18a)+_0x4ff596?.['message']);}const _0xdda086=(0x0,socket_1[_0x49df76(0x19d)])();_0x552bcd&&_0xdda086['to'](_0x27785e['id'][_0x49df76(0x1a2)]())['to']('company-'+_0x552bcd+'-'+_0x27785e['status'])['to']('queue-'+_0x27785e[_0x49df76(0x18b)]+'-'+_0x27785e[_0x49df76(0x194)])[_0x49df76(0x19a)](_0x49df76(0x1ac)+_0x552bcd+'-ticket',{'action':_0x49df76(0x1a7),'ticketId':_0x27785e['id']});};exports[a287_0x45e828(0x19f)]=SetTicketMessagesAsRead;