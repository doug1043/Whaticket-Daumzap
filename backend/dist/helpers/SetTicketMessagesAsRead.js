const a281_0x52118d=a281_0x1003;(function(_0x3565f6,_0x4a7c68){const _0x1ff7cd=a281_0x1003,_0x579778=_0x3565f6();while(!![]){try{const _0x498220=parseInt(_0x1ff7cd(0xa0))/0x1+parseInt(_0x1ff7cd(0x94))/0x2+-parseInt(_0x1ff7cd(0x95))/0x3*(parseInt(_0x1ff7cd(0x78))/0x4)+-parseInt(_0x1ff7cd(0x7b))/0x5*(-parseInt(_0x1ff7cd(0x84))/0x6)+parseInt(_0x1ff7cd(0x8e))/0x7+parseInt(_0x1ff7cd(0x96))/0x8+-parseInt(_0x1ff7cd(0x99))/0x9;if(_0x498220===_0x4a7c68)break;else _0x579778['push'](_0x579778['shift']());}catch(_0x4f5a74){_0x579778['push'](_0x579778['shift']());}}}(a281_0x50a8,0x4d771));const a281_0x5f47d0=(function(){let _0x2da3f4=!![];return function(_0x4a06e4,_0x348835){const _0x54feee=_0x2da3f4?function(){const _0xa2bc97=a281_0x1003;if(_0x348835){const _0x2f8b87=_0x348835[_0xa2bc97(0x90)](_0x4a06e4,arguments);return _0x348835=null,_0x2f8b87;}}:function(){};return _0x2da3f4=![],_0x54feee;};}()),a281_0x4d9f94=a281_0x5f47d0(this,function(){const _0x23e82f=a281_0x1003;return a281_0x4d9f94[_0x23e82f(0x8f)]()['search']('(((.+)+)+)+$')['toString']()[_0x23e82f(0x8c)](a281_0x4d9f94)[_0x23e82f(0x70)](_0x23e82f(0x83));});a281_0x4d9f94();'use strict';var __importDefault=this&&this[a281_0x52118d(0x6f)]||function(_0x4b49ba){return _0x4b49ba&&_0x4b49ba['__esModule']?_0x4b49ba:{'default':_0x4b49ba};};function a281_0x50a8(){const _0x10d7a3=['275297xRQQAG','contactId','../libs/cache','readMessages','status','default','catch','__importDefault','search','defineProperty','company-','length','companyId','message','debug','../utils/logger','988824StrKZy','set','queueId','5PyoGgJ','error',':unreads','../models/Message','getIO','\x20messages\x20of\x20ticket\x20','remoteJid','fromMe','(((.+)+)+)+$','1980858VRzjmk','slice','parse','dataJson','Marking\x20','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20','filter','\x20as\x20read','constructor','key','695807oQPIQc','toString','apply','findAll','map','__esModule','1130046IHGotK','3yacGoQ','4133096xPicOg','Could\x20not\x20modify\x20chat.\x20Err:\x20','-ticket','10997982RpCsim','logger','./GetTicketWbot','update','cacheLayer','queue-','chatModify'];a281_0x50a8=function(){return _0x10d7a3;};return a281_0x50a8();}Object[a281_0x52118d(0x71)](exports,a281_0x52118d(0x93),{'value':!![]});const cache_1=require(a281_0x52118d(0xa2)),socket_1=require('../libs/socket'),Message_1=__importDefault(require(a281_0x52118d(0x7e))),logger_1=require(a281_0x52118d(0x77)),GetTicketWbot_1=__importDefault(require(a281_0x52118d(0x9b))),SetTicketMessagesAsRead=async _0x1fdea0=>{const _0x3385b2=a281_0x52118d;await _0x1fdea0[_0x3385b2(0x9c)]({'unreadMessages':0x0},{'silent':!![]}),await cache_1[_0x3385b2(0x9d)][_0x3385b2(0x79)]('contacts:'+_0x1fdea0[_0x3385b2(0xa1)]+_0x3385b2(0x7d),'0');let _0x4ad59f;try{const _0xcdb0bd=await(0x0,GetTicketWbot_1[_0x3385b2(0xa5)])(_0x1fdea0),_0x33ae15=await Message_1[_0x3385b2(0xa5)][_0x3385b2(0x91)]({'attributes':['id','companyId',_0x3385b2(0x87)],'where':{'ticketId':_0x1fdea0['id'],'fromMe':![],'read':![]},'order':[['createdAt','DESC']]});if(_0x33ae15[_0x3385b2(0x73)]===0x0)return;_0x4ad59f=_0x33ae15[0x0]?.[_0x3385b2(0x74)];const _0x361046=_0x33ae15[_0x3385b2(0x92)](_0x6e7083=>{const _0x43b96a=_0x3385b2,_0x4be9be=JSON['parse'](_0x6e7083[_0x43b96a(0x87)]);return _0x4be9be[_0x43b96a(0x8d)];})[_0x3385b2(0x8a)](_0x68c55f=>_0x68c55f!==undefined);logger_1['logger'][_0x3385b2(0x76)]({'messageKeys':_0x361046,'ticketId':_0x1fdea0['id']},_0x3385b2(0x88)+_0x361046[_0x3385b2(0x73)]+_0x3385b2(0x80)+_0x1fdea0['id']+_0x3385b2(0x8b));const _0x161b8a=0xfa;for(let _0x38e9b3=0x0;_0x38e9b3<_0x361046['length'];_0x38e9b3+=_0x161b8a){const _0x8b174f=_0x361046[_0x3385b2(0x85)](_0x38e9b3,_0x38e9b3+_0x161b8a);_0xcdb0bd[_0x3385b2(0xa3)](_0x8b174f)[_0x3385b2(0xa6)](_0x561774=>{const _0x2d6df4=_0x3385b2;logger_1[_0x2d6df4(0x9a)][_0x2d6df4(0x7c)]({'error':_0x561774},_0x2d6df4(0x89)+_0x561774?.[_0x2d6df4(0x75)]);});}const _0x2faf5c=JSON[_0x3385b2(0x86)](_0x33ae15[0x0][_0x3385b2(0x87)]);_0x2faf5c?.[_0x3385b2(0x8d)]?.[_0x3385b2(0x81)]&&!_0x2faf5c['key'][_0x3385b2(0x82)]&&_0xcdb0bd[_0x3385b2(0x9f)]({'markRead':!![],'lastMessages':[_0x2faf5c]},_0x2faf5c[_0x3385b2(0x8d)][_0x3385b2(0x81)])['catch'](_0xd7b5bf=>{const _0x16c2ce=_0x3385b2;logger_1[_0x16c2ce(0x9a)]['error']({'error':_0xd7b5bf},_0x16c2ce(0x97)+_0xd7b5bf?.[_0x16c2ce(0x75)]);}),await Message_1[_0x3385b2(0xa5)]['update']({'read':!![]},{'where':{'ticketId':_0x1fdea0['id'],'read':![]}});}catch(_0x1619da){logger_1[_0x3385b2(0x9a)]['error']({'error':_0x1619da},'Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20'+_0x1619da?.[_0x3385b2(0x75)]);}const _0x452a8a=(0x0,socket_1[_0x3385b2(0x7f)])();_0x4ad59f&&_0x452a8a['to'](_0x1fdea0['id'][_0x3385b2(0x8f)]())['to'](_0x3385b2(0x72)+_0x4ad59f+'-'+_0x1fdea0[_0x3385b2(0xa4)])['to'](_0x3385b2(0x9e)+_0x1fdea0[_0x3385b2(0x7a)]+'-'+_0x1fdea0[_0x3385b2(0xa4)])['emit'](_0x3385b2(0x72)+_0x4ad59f+_0x3385b2(0x98),{'action':'updateUnread','ticketId':_0x1fdea0['id']});};function a281_0x1003(_0x13d8ed,_0x572dcd){const _0x105706=a281_0x50a8();return a281_0x1003=function(_0x4d9f94,_0x5f47d0){_0x4d9f94=_0x4d9f94-0x6f;let _0x50a84b=_0x105706[_0x4d9f94];return _0x50a84b;},a281_0x1003(_0x13d8ed,_0x572dcd);}exports[a281_0x52118d(0xa5)]=SetTicketMessagesAsRead;