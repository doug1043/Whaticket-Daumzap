const a250_0x5643da=a250_0x473b;(function(_0x49755f,_0x3c2f33){const _0x3d5200=a250_0x473b,_0x369fdb=_0x49755f();while(!![]){try{const _0x27036c=-parseInt(_0x3d5200(0xad))/0x1*(parseInt(_0x3d5200(0xa9))/0x2)+parseInt(_0x3d5200(0x99))/0x3*(parseInt(_0x3d5200(0x9c))/0x4)+-parseInt(_0x3d5200(0xbc))/0x5+parseInt(_0x3d5200(0xaf))/0x6+parseInt(_0x3d5200(0xab))/0x7+parseInt(_0x3d5200(0xb8))/0x8+parseInt(_0x3d5200(0xb1))/0x9*(-parseInt(_0x3d5200(0xc1))/0xa);if(_0x27036c===_0x3c2f33)break;else _0x369fdb['push'](_0x369fdb['shift']());}catch(_0xff9c06){_0x369fdb['push'](_0x369fdb['shift']());}}}(a250_0x45de,0x73654));const a250_0x14e292=(function(){let _0x3db99a=!![];return function(_0x463dbd,_0x282935){const _0x3489aa=_0x3db99a?function(){const _0x59a083=a250_0x473b;if(_0x282935){const _0x529cae=_0x282935[_0x59a083(0xbf)](_0x463dbd,arguments);return _0x282935=null,_0x529cae;}}:function(){};return _0x3db99a=![],_0x3489aa;};}()),a250_0x3eec83=a250_0x14e292(this,function(){const _0x335683=a250_0x473b;return a250_0x3eec83['toString']()[_0x335683(0xac)](_0x335683(0x9e))['toString']()['constructor'](a250_0x3eec83)[_0x335683(0xac)](_0x335683(0x9e));});a250_0x3eec83();'use strict';var __importDefault=this&&this[a250_0x5643da(0xbd)]||function(_0x59414e){const _0x390a6c=a250_0x5643da;return _0x59414e&&_0x59414e[_0x390a6c(0xb9)]?_0x59414e:{'default':_0x59414e};};Object[a250_0x5643da(0xca)](exports,a250_0x5643da(0xb9),{'value':!![]});function a250_0x473b(_0x5f009e,_0x182c94){const _0x2752d9=a250_0x45de();return a250_0x473b=function(_0x3eec83,_0x14e292){_0x3eec83=_0x3eec83-0x99;let _0x45ded3=_0x2752d9[_0x3eec83];return _0x45ded3;},a250_0x473b(_0x5f009e,_0x182c94);}const socket_1=require(a250_0x5643da(0xc4)),Message_1=__importDefault(require(a250_0x5643da(0xb2))),logger_1=require('../utils/logger'),GetTicketWbot_1=__importDefault(require(a250_0x5643da(0xa5))),cache_1=require(a250_0x5643da(0xb5)),SetTicketMessagesAsRead=async _0x280ee2=>{const _0x2b649c=a250_0x5643da;async function _0x742910(_0x36ec73,_0x52318d,_0x281196,_0x733a1c){const _0x585055=a250_0x473b;await _0x36ec73[_0x585055(0xa6)](_0x52318d,_0x281196,[_0x733a1c],_0x585055(0xc2));}await _0x280ee2['update']({'unreadMessages':0x0});try{const _0x51eafa=await(0x0,GetTicketWbot_1['default'])(_0x280ee2),_0x5c7f76=await Message_1['default']['findAll']({'where':{'ticketId':_0x280ee2['id'],'fromMe':![],'read':![]},'order':[[_0x2b649c(0x9f),'DESC']]});_0x5c7f76[_0x2b649c(0xbb)](async _0xd12df0=>{const _0xaf61ec=_0x2b649c,_0x3c15a8=JSON[_0xaf61ec(0xc9)](_0xd12df0[_0xaf61ec(0xc3)]);_0x3c15a8[_0xaf61ec(0xc5)]&&await _0x51eafa[_0xaf61ec(0xc0)]([_0x3c15a8[_0xaf61ec(0xc5)]]);});if(_0x5c7f76[_0x2b649c(0xb3)]>0x0){const _0x354393=JSON[_0x2b649c(0xc9)](_0x5c7f76[0x0][_0x2b649c(0xc3)]),_0x2f55a8=_0x280ee2[_0x2b649c(0xa0)]?_0x280ee2[_0x2b649c(0xaa)]['number'][_0x2b649c(0xc7)](0xc,0x0)+'-'+_0x280ee2[_0x2b649c(0xaa)][_0x2b649c(0xbe)][_0x2b649c(0xc7)](0xc)+_0x2b649c(0x9d):_0x280ee2[_0x2b649c(0xaa)][_0x2b649c(0xbe)]+_0x2b649c(0xba);_0x354393['key']&&_0x354393[_0x2b649c(0xc5)][_0x2b649c(0xc6)]===![]&&await _0x51eafa[_0x2b649c(0xb4)]({'markRead':!![],'lastMessages':[_0x354393]},_0x2f55a8);}await Message_1[_0x2b649c(0xae)]['update']({'read':!![]},{'where':{'ticketId':_0x280ee2['id'],'read':![]}}),await cache_1[_0x2b649c(0x9a)][_0x2b649c(0xcb)]('contacts:'+_0x280ee2[_0x2b649c(0xa2)]+_0x2b649c(0xb6),'0');}catch(_0x41dbde){logger_1[_0x2b649c(0xa4)]['warn'](_0x2b649c(0xa3)+_0x41dbde);}const _0x3e739c=(0x0,socket_1[_0x2b649c(0xc8)])();_0x3e739c['to'](_0x2b649c(0xa1)+_0x280ee2['companyId']+'-'+_0x280ee2[_0x2b649c(0x9b)])['to'](_0x2b649c(0xa1)+_0x280ee2['companyId']+_0x2b649c(0xb0))['emit'](_0x2b649c(0xa1)+_0x280ee2[_0x2b649c(0xa7)]+_0x2b649c(0xb7),{'action':_0x2b649c(0xa8),'ticketId':_0x280ee2['id']});};function a250_0x45de(){const _0x541ab5=['__importDefault','number','apply','readMessages','2780twvPZN','read','dataJson','../libs/socket','key','fromMe','substring','getIO','parse','defineProperty','set','1888929GUbMci','cacheLayer','status','4RfzeSm','@g.us','(((.+)+)+)+$','createdAt','isGroup','company-','contactId','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','logger','./GetTicketWbot','sendReceipt','companyId','updateUnread','2DNoChB','contact','1969639Wkmlwp','search','383004CyUfjt','default','450144lRKEyo','-notification','8397SfAerC','../models/Message','length','chatModify','../libs/cache',':unreads','-ticket','2454688RMIVbw','__esModule','@s.whatsapp.net','map','889210CDRSoH'];a250_0x45de=function(){return _0x541ab5;};return a250_0x45de();}exports[a250_0x5643da(0xae)]=SetTicketMessagesAsRead;