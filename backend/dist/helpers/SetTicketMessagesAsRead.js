const a251_0x24cdc4=a251_0x539a;function a251_0x2f78(){const _0xa720d7=['read','fromMe','541477UwzzjT','DESC','19413CCwetV','createdAt','@s.whatsapp.net','../libs/socket','2142QOIMPg','toString','map','emit','default','number','3574634xdapCG','company-','14smGnJm','../models/Message','companyId','search','sendReceipt','apply','isGroup','(((.+)+)+)+$','parse','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','chatModify','../libs/cache','update','5368DXjFDk','../utils/logger','substring','6JcLUoL','findAll','status','-notification','36710uUSmtr','@g.us','key','warn','updateUnread','set','828050NoAMTL','35152kWbanM','contact','__esModule','readMessages','logger','dataJson','230812sLEMHZ'];a251_0x2f78=function(){return _0xa720d7;};return a251_0x2f78();}(function(_0x4630a3,_0x1f31d3){const _0x2fd7f2=a251_0x539a,_0x36c470=_0x4630a3();while(!![]){try{const _0x159f43=parseInt(_0x2fd7f2(0xec))/0x1+parseInt(_0x2fd7f2(0xc8))/0x2*(parseInt(_0x2fd7f2(0xee))/0x3)+parseInt(_0x2fd7f2(0xe9))/0x4+parseInt(_0x2fd7f2(0xe2))/0x5*(parseInt(_0x2fd7f2(0xd8))/0x6)+parseInt(_0x2fd7f2(0xc6))/0x7+-parseInt(_0x2fd7f2(0xe3))/0x8*(-parseInt(_0x2fd7f2(0xf2))/0x9)+parseInt(_0x2fd7f2(0xdc))/0xa*(-parseInt(_0x2fd7f2(0xd5))/0xb);if(_0x159f43===_0x1f31d3)break;else _0x36c470['push'](_0x36c470['shift']());}catch(_0x137423){_0x36c470['push'](_0x36c470['shift']());}}}(a251_0x2f78,0x8c661));const a251_0x590820=(function(){let _0x3298d7=!![];return function(_0x225d8c,_0x275d3a){const _0x4df9e6=_0x3298d7?function(){const _0x5e28b3=a251_0x539a;if(_0x275d3a){const _0x4e0654=_0x275d3a[_0x5e28b3(0xcd)](_0x225d8c,arguments);return _0x275d3a=null,_0x4e0654;}}:function(){};return _0x3298d7=![],_0x4df9e6;};}()),a251_0x28134c=a251_0x590820(this,function(){const _0x42a11f=a251_0x539a;return a251_0x28134c[_0x42a11f(0xf3)]()[_0x42a11f(0xcb)](_0x42a11f(0xcf))[_0x42a11f(0xf3)]()['constructor'](a251_0x28134c)[_0x42a11f(0xcb)](_0x42a11f(0xcf));});a251_0x28134c();'use strict';function a251_0x539a(_0x2cdae9,_0xa0ef11){const _0x2eb4bf=a251_0x2f78();return a251_0x539a=function(_0x28134c,_0x590820){_0x28134c=_0x28134c-0xc4;let _0x2f7859=_0x2eb4bf[_0x28134c];return _0x2f7859;},a251_0x539a(_0x2cdae9,_0xa0ef11);}var __importDefault=this&&this['__importDefault']||function(_0x47e70e){const _0x21a3a9=a251_0x539a;return _0x47e70e&&_0x47e70e[_0x21a3a9(0xe5)]?_0x47e70e:{'default':_0x47e70e};};Object['defineProperty'](exports,a251_0x24cdc4(0xe5),{'value':!![]});const socket_1=require(a251_0x24cdc4(0xf1)),Message_1=__importDefault(require(a251_0x24cdc4(0xc9))),logger_1=require(a251_0x24cdc4(0xd6)),GetTicketWbot_1=__importDefault(require('./GetTicketWbot')),cache_1=require(a251_0x24cdc4(0xd3)),SetTicketMessagesAsRead=async _0xee083=>{const _0x3a6918=a251_0x24cdc4;async function _0x21b53d(_0x250bb1,_0x28e4db,_0x1ba1f2,_0x11f917){const _0x52b5b4=a251_0x539a;await _0x250bb1[_0x52b5b4(0xcc)](_0x28e4db,_0x1ba1f2,[_0x11f917],_0x52b5b4(0xea));}await _0xee083[_0x3a6918(0xd4)]({'unreadMessages':0x0});try{const _0x4b7b23=await(0x0,GetTicketWbot_1[_0x3a6918(0xc4)])(_0xee083),_0x3eb45a=await Message_1[_0x3a6918(0xc4)][_0x3a6918(0xd9)]({'where':{'ticketId':_0xee083['id'],'fromMe':![],'read':![]},'order':[[_0x3a6918(0xef),_0x3a6918(0xed)]]});_0x3eb45a[_0x3a6918(0xf4)](async _0x2e70f9=>{const _0xd71124=_0x3a6918,_0x4ed455=JSON[_0xd71124(0xd0)](_0x2e70f9[_0xd71124(0xe8)]);_0x4ed455['key']&&await _0x4b7b23[_0xd71124(0xe6)]([_0x4ed455[_0xd71124(0xde)]]);});if(_0x3eb45a['length']>0x0){const _0xe7d52c=JSON[_0x3a6918(0xd0)](_0x3eb45a[0x0][_0x3a6918(0xe8)]),_0x3177ed=_0xee083[_0x3a6918(0xce)]?_0xee083['contact'][_0x3a6918(0xc5)][_0x3a6918(0xd7)](0xc,0x0)+'-'+_0xee083[_0x3a6918(0xe4)][_0x3a6918(0xc5)][_0x3a6918(0xd7)](0xc)+_0x3a6918(0xdd):_0xee083['contact']['number']+_0x3a6918(0xf0);_0xe7d52c[_0x3a6918(0xde)]&&_0xe7d52c[_0x3a6918(0xde)][_0x3a6918(0xeb)]===![]&&await _0x4b7b23[_0x3a6918(0xd2)]({'markRead':!![],'lastMessages':[_0xe7d52c]},_0x3177ed);}await Message_1['default']['update']({'read':!![]},{'where':{'ticketId':_0xee083['id'],'read':![]}}),await cache_1['cacheLayer'][_0x3a6918(0xe1)]('contacts:'+_0xee083['contactId']+':unreads','0');}catch(_0x19eaa1){logger_1[_0x3a6918(0xe7)][_0x3a6918(0xdf)](_0x3a6918(0xd1)+_0x19eaa1);}const _0x251cb8=(0x0,socket_1['getIO'])();_0x251cb8['to'](_0x3a6918(0xc7)+_0xee083[_0x3a6918(0xca)]+'-'+_0xee083[_0x3a6918(0xda)])['to'](_0x3a6918(0xc7)+_0xee083['companyId']+_0x3a6918(0xdb))[_0x3a6918(0xf5)](_0x3a6918(0xc7)+_0xee083[_0x3a6918(0xca)]+'-ticket',{'action':_0x3a6918(0xe0),'ticketId':_0xee083['id']});};exports[a251_0x24cdc4(0xc4)]=SetTicketMessagesAsRead;