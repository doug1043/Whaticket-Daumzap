const a290_0x4c2ed8=a290_0x20e9;(function(_0x142fd2,_0x264c1e){const _0x2dc993=a290_0x20e9,_0x38cb95=_0x142fd2();while(!![]){try{const _0xd7c703=-parseInt(_0x2dc993(0x207))/0x1+-parseInt(_0x2dc993(0x1ec))/0x2*(parseInt(_0x2dc993(0x209))/0x3)+-parseInt(_0x2dc993(0x1f5))/0x4+parseInt(_0x2dc993(0x1e4))/0x5+parseInt(_0x2dc993(0x1f1))/0x6+-parseInt(_0x2dc993(0x1fa))/0x7*(parseInt(_0x2dc993(0x206))/0x8)+parseInt(_0x2dc993(0x1f7))/0x9*(parseInt(_0x2dc993(0x1ee))/0xa);if(_0xd7c703===_0x264c1e)break;else _0x38cb95['push'](_0x38cb95['shift']());}catch(_0x30589d){_0x38cb95['push'](_0x38cb95['shift']());}}}(a290_0x59b3,0xc2ece));const a290_0x4edb48=(function(){let _0x220a6e=!![];return function(_0x2e5d15,_0x743ef7){const _0x24f3c1=_0x220a6e?function(){const _0x2cf829=a290_0x20e9;if(_0x743ef7){const _0x35e6af=_0x743ef7[_0x2cf829(0x205)](_0x2e5d15,arguments);return _0x743ef7=null,_0x35e6af;}}:function(){};return _0x220a6e=![],_0x24f3c1;};}()),a290_0x36e5c1=a290_0x4edb48(this,function(){const _0x1eed47=a290_0x20e9;return a290_0x36e5c1[_0x1eed47(0x1e7)]()[_0x1eed47(0x203)](_0x1eed47(0x1f0))[_0x1eed47(0x1e7)]()[_0x1eed47(0x1e3)](a290_0x36e5c1)[_0x1eed47(0x203)]('(((.+)+)+)+$');});a290_0x36e5c1();function a290_0x59b3(){const _0x35ed75=['395776uUjfkV','1483759XmEQuh','catch','35034MGElPZ','key','parse','update','updateUnread',':unreads','error','Could\x20not\x20modify\x20chat.\x20Err:\x20','map','status','default','contacts:','constructor','1374195wnlDfW','debug','../libs/cache','toString','logger','chatModify','remoteJid','filter','48DmUjYY','slice','20080LOCDql','../models/Message','(((.+)+)+)+$','8096280TSXlcC','__esModule','dataJson','length','4254904urGfum','\x20messages\x20of\x20ticket\x20','11412zDumcE','contactId','createdAt','77wlpbOJ','-ticket','../utils/logger','__importDefault','DESC','companyId','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20','message','../libs/socket','search','findAll','apply'];a290_0x59b3=function(){return _0x35ed75;};return a290_0x59b3();}function a290_0x20e9(_0x5877a7,_0x20f487){const _0x4b8bec=a290_0x59b3();return a290_0x20e9=function(_0x36e5c1,_0x4edb48){_0x36e5c1=_0x36e5c1-0x1e0;let _0x59b32d=_0x4b8bec[_0x36e5c1];return _0x59b32d;},a290_0x20e9(_0x5877a7,_0x20f487);}'use strict';var __importDefault=this&&this[a290_0x4c2ed8(0x1fd)]||function(_0x273564){return _0x273564&&_0x273564['__esModule']?_0x273564:{'default':_0x273564};};Object['defineProperty'](exports,a290_0x4c2ed8(0x1f2),{'value':!![]});const cache_1=require(a290_0x4c2ed8(0x1e6)),socket_1=require(a290_0x4c2ed8(0x202)),Message_1=__importDefault(require(a290_0x4c2ed8(0x1ef))),logger_1=require(a290_0x4c2ed8(0x1fc)),GetTicketWbot_1=__importDefault(require('./GetTicketWbot')),SetTicketMessagesAsRead=async _0x3e8a9b=>{const _0x54e959=a290_0x4c2ed8;await _0x3e8a9b[_0x54e959(0x20c)]({'unreadMessages':0x0},{'silent':!![]}),await cache_1['cacheLayer']['set'](_0x54e959(0x1e2)+_0x3e8a9b[_0x54e959(0x1f8)]+_0x54e959(0x20e),'0');let _0x32cf89;try{const _0x502be9=await(0x0,GetTicketWbot_1[_0x54e959(0x1e1)])(_0x3e8a9b),_0xfd8c40=await Message_1[_0x54e959(0x1e1)][_0x54e959(0x204)]({'attributes':['id',_0x54e959(0x1ff),_0x54e959(0x1f3)],'where':{'ticketId':_0x3e8a9b['id'],'fromMe':![],'read':![]},'order':[[_0x54e959(0x1f9),_0x54e959(0x1fe)]]});if(_0xfd8c40[_0x54e959(0x1f4)]===0x0)return;_0x32cf89=_0xfd8c40[0x0]?.['companyId'];const _0x155236=_0xfd8c40[_0x54e959(0x211)](_0x11db96=>{const _0x2023a8=_0x54e959,_0x34ad1f=JSON[_0x2023a8(0x20b)](_0x11db96[_0x2023a8(0x1f3)]);return _0x34ad1f[_0x2023a8(0x20a)];})[_0x54e959(0x1eb)](_0x4314c2=>_0x4314c2!==undefined);logger_1[_0x54e959(0x1e8)][_0x54e959(0x1e5)]({'messageKeys':_0x155236,'ticketId':_0x3e8a9b['id']},'Marking\x20'+_0x155236['length']+_0x54e959(0x1f6)+_0x3e8a9b['id']+'\x20as\x20read');const _0x5b5b31=0xfa;for(let _0x176473=0x0;_0x176473<_0x155236[_0x54e959(0x1f4)];_0x176473+=_0x5b5b31){const _0x3ac72e=_0x155236[_0x54e959(0x1ed)](_0x176473,_0x176473+_0x5b5b31);_0x502be9['readMessages'](_0x3ac72e)[_0x54e959(0x208)](_0x571425=>{const _0x3883b4=_0x54e959;logger_1[_0x3883b4(0x1e8)][_0x3883b4(0x20f)]({'error':_0x571425},_0x3883b4(0x200)+_0x571425?.[_0x3883b4(0x201)]);});}const _0x1ae6f1=JSON[_0x54e959(0x20b)](_0xfd8c40[0x0][_0x54e959(0x1f3)]),_0x4a0fee=_0x1ae6f1?.[_0x54e959(0x20a)];_0x4a0fee?.['remoteJid']&&!_0x4a0fee['fromMe']&&_0x502be9[_0x54e959(0x1e9)]({'markRead':!![],'lastMessages':[_0x1ae6f1]},_0x4a0fee[_0x54e959(0x1ea)])[_0x54e959(0x208)](_0x8fbe2d=>{const _0x1d0f90=_0x54e959;logger_1[_0x1d0f90(0x1e8)][_0x1d0f90(0x20f)]({'error':_0x8fbe2d},_0x1d0f90(0x210)+_0x8fbe2d?.['message']);}),await Message_1['default'][_0x54e959(0x20c)]({'read':!![]},{'where':{'ticketId':_0x3e8a9b['id'],'read':![]}});}catch(_0x51842b){logger_1['logger'][_0x54e959(0x20f)]({'error':_0x51842b},_0x54e959(0x200)+_0x51842b?.['message']);}const _0x407b06=(0x0,socket_1['getIO'])();_0x32cf89&&_0x407b06['to'](_0x3e8a9b['id']['toString']())['to']('company-'+_0x32cf89+'-'+_0x3e8a9b['status'])['to']('queue-'+_0x3e8a9b['queueId']+'-'+_0x3e8a9b[_0x54e959(0x1e0)])['emit']('company-'+_0x32cf89+_0x54e959(0x1fb),{'action':_0x54e959(0x20d),'ticketId':_0x3e8a9b['id']});};exports[a290_0x4c2ed8(0x1e1)]=SetTicketMessagesAsRead;