const a290_0x27d987=a290_0x1346;(function(_0x5a3a57,_0xc37c10){const _0x51af1e=a290_0x1346,_0x56822c=_0x5a3a57();while(!![]){try{const _0x50b93c=-parseInt(_0x51af1e(0x11d))/0x1*(parseInt(_0x51af1e(0x103))/0x2)+-parseInt(_0x51af1e(0x110))/0x3+-parseInt(_0x51af1e(0x123))/0x4+-parseInt(_0x51af1e(0xf8))/0x5+-parseInt(_0x51af1e(0xea))/0x6*(parseInt(_0x51af1e(0x105))/0x7)+-parseInt(_0x51af1e(0x11b))/0x8*(-parseInt(_0x51af1e(0xed))/0x9)+parseInt(_0x51af1e(0x109))/0xa*(parseInt(_0x51af1e(0x11f))/0xb);if(_0x50b93c===_0xc37c10)break;else _0x56822c['push'](_0x56822c['shift']());}catch(_0x26a128){_0x56822c['push'](_0x56822c['shift']());}}}(a290_0x2d0d,0x609ce));const a290_0x1dd15f=(function(){let _0x2fce45=!![];return function(_0x2c0c68,_0x5be97a){const _0x34bf92=_0x2fce45?function(){const _0x3451b7=a290_0x1346;if(_0x5be97a){const _0x34e906=_0x5be97a[_0x3451b7(0x120)](_0x2c0c68,arguments);return _0x5be97a=null,_0x34e906;}}:function(){};return _0x2fce45=![],_0x34bf92;};}()),a290_0xa6b71a=a290_0x1dd15f(this,function(){const _0x199303=a290_0x1346;return a290_0xa6b71a[_0x199303(0xf4)]()[_0x199303(0x117)](_0x199303(0x107))[_0x199303(0xf4)]()[_0x199303(0x108)](a290_0xa6b71a)[_0x199303(0x117)](_0x199303(0x107));});a290_0xa6b71a();'use strict';var __importDefault=this&&this[a290_0x27d987(0xfe)]||function(_0x58b20c){const _0x41a4a7=a290_0x27d987;return _0x58b20c&&_0x58b20c[_0x41a4a7(0xf0)]?_0x58b20c:{'default':_0x58b20c};};Object[a290_0x27d987(0x10b)](exports,a290_0x27d987(0xf0),{'value':!![]});function a290_0x2d0d(){const _0x11295f=['default','6ptEKAl','company-','cacheLayer','83313mAZKMi','fromMe','parse','__esModule','queue-','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20','slice','toString','findAll','error','Could\x20not\x20modify\x20chat.\x20Err:\x20','3539190AelTHY','-ticket','../utils/logger','length','update','key','__importDefault','../models/Message','catch','map','emit','2hFAhDO','set','365855ijXwrI','queueId','(((.+)+)+)+$','constructor','15298170MywbTm','companyId','defineProperty','status','contacts:','contactId','createdAt','99888VIeBNV','logger','readMessages','DESC','./GetTicketWbot','debug','Marking\x20','search','../libs/cache','remoteJid',':unreads','16KhFtYR','dataJson','80017alCwOg','filter','11jjgaCh','apply','\x20as\x20read','message','1116756UaNZBo'];a290_0x2d0d=function(){return _0x11295f;};return a290_0x2d0d();}function a290_0x1346(_0x5900de,_0x1a025b){const _0x4579d7=a290_0x2d0d();return a290_0x1346=function(_0xa6b71a,_0x1dd15f){_0xa6b71a=_0xa6b71a-0xea;let _0x2d0dfd=_0x4579d7[_0xa6b71a];return _0x2d0dfd;},a290_0x1346(_0x5900de,_0x1a025b);}const cache_1=require(a290_0x27d987(0x118)),socket_1=require('../libs/socket'),Message_1=__importDefault(require(a290_0x27d987(0xff))),logger_1=require(a290_0x27d987(0xfa)),GetTicketWbot_1=__importDefault(require(a290_0x27d987(0x114))),SetTicketMessagesAsRead=async _0xb6e6a=>{const _0x428839=a290_0x27d987;await _0xb6e6a[_0x428839(0xfc)]({'unreadMessages':0x0},{'silent':!![]}),await cache_1[_0x428839(0xec)][_0x428839(0x104)](_0x428839(0x10d)+_0xb6e6a[_0x428839(0x10e)]+_0x428839(0x11a),'0');let _0x433a;try{const _0x382c04=await(0x0,GetTicketWbot_1['default'])(_0xb6e6a),_0x441410=await Message_1[_0x428839(0x124)][_0x428839(0xf5)]({'attributes':['id',_0x428839(0x10a),'dataJson'],'where':{'ticketId':_0xb6e6a['id'],'fromMe':![],'read':![]},'order':[[_0x428839(0x10f),_0x428839(0x113)]]});if(_0x441410[_0x428839(0xfb)]===0x0)return;_0x433a=_0x441410[0x0]?.[_0x428839(0x10a)];const _0x54e542=_0x441410[_0x428839(0x101)](_0x16ab34=>{const _0xcd1e86=_0x428839,_0x4fbad7=JSON[_0xcd1e86(0xef)](_0x16ab34[_0xcd1e86(0x11c)]);return _0x4fbad7[_0xcd1e86(0xfd)];})[_0x428839(0x11e)](_0x56c73e=>_0x56c73e!==undefined);logger_1['logger'][_0x428839(0x115)]({'messageKeys':_0x54e542,'ticketId':_0xb6e6a['id']},_0x428839(0x116)+_0x54e542[_0x428839(0xfb)]+'\x20messages\x20of\x20ticket\x20'+_0xb6e6a['id']+_0x428839(0x121));const _0xb19fce=0xfa;for(let _0x3ed637=0x0;_0x3ed637<_0x54e542['length'];_0x3ed637+=_0xb19fce){const _0x3b7a99=_0x54e542[_0x428839(0xf3)](_0x3ed637,_0x3ed637+_0xb19fce);_0x382c04[_0x428839(0x112)](_0x3b7a99)[_0x428839(0x100)](_0x585221=>{const _0x48349f=_0x428839;logger_1[_0x48349f(0x111)][_0x48349f(0xf6)]({'error':_0x585221},_0x48349f(0xf2)+_0x585221?.[_0x48349f(0x122)]);});}const _0x4fc203=JSON[_0x428839(0xef)](_0x441410[0x0]['dataJson']),_0x3b1018=_0x4fc203?.['key'];_0x3b1018?.[_0x428839(0x119)]&&!_0x3b1018[_0x428839(0xee)]&&_0x382c04['chatModify']({'markRead':!![],'lastMessages':[_0x4fc203]},_0x3b1018['remoteJid'])['catch'](_0x3e9581=>{const _0x5ee64d=_0x428839;logger_1['logger'][_0x5ee64d(0xf6)]({'error':_0x3e9581},_0x5ee64d(0xf7)+_0x3e9581?.['message']);}),await Message_1[_0x428839(0x124)][_0x428839(0xfc)]({'read':!![]},{'where':{'ticketId':_0xb6e6a['id'],'read':![]}});}catch(_0x5122f0){logger_1[_0x428839(0x111)][_0x428839(0xf6)]({'error':_0x5122f0},_0x428839(0xf2)+_0x5122f0?.[_0x428839(0x122)]);}const _0x2da08=(0x0,socket_1['getIO'])();_0x433a&&_0x2da08['to'](_0xb6e6a['id'][_0x428839(0xf4)]())['to'](_0x428839(0xeb)+_0x433a+'-'+_0xb6e6a[_0x428839(0x10c)])['to'](_0x428839(0xf1)+_0xb6e6a[_0x428839(0x106)]+'-'+_0xb6e6a[_0x428839(0x10c)])[_0x428839(0x102)](_0x428839(0xeb)+_0x433a+_0x428839(0xf9),{'action':'updateUnread','ticketId':_0xb6e6a['id']});};exports[a290_0x27d987(0x124)]=SetTicketMessagesAsRead;