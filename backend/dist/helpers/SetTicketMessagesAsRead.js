const a251_0x85dced=a251_0x22ce;(function(_0x20125d,_0x1b7b8d){const _0x2268f6=a251_0x22ce,_0x5c4b40=_0x20125d();while(!![]){try{const _0xd85f3d=parseInt(_0x2268f6(0x1b4))/0x1+parseInt(_0x2268f6(0x1db))/0x2+-parseInt(_0x2268f6(0x1c1))/0x3+-parseInt(_0x2268f6(0x1bb))/0x4*(parseInt(_0x2268f6(0x1d6))/0x5)+parseInt(_0x2268f6(0x1d0))/0x6*(parseInt(_0x2268f6(0x1df))/0x7)+parseInt(_0x2268f6(0x1dd))/0x8+-parseInt(_0x2268f6(0x1d9))/0x9*(-parseInt(_0x2268f6(0x1d7))/0xa);if(_0xd85f3d===_0x1b7b8d)break;else _0x5c4b40['push'](_0x5c4b40['shift']());}catch(_0xee6c83){_0x5c4b40['push'](_0x5c4b40['shift']());}}}(a251_0x2cf6,0xc6228));const a251_0x2a1acb=(function(){let _0x528f0b=!![];return function(_0x768ee5,_0x17534f){const _0xcec90c=_0x528f0b?function(){if(_0x17534f){const _0x451bb8=_0x17534f['apply'](_0x768ee5,arguments);return _0x17534f=null,_0x451bb8;}}:function(){};return _0x528f0b=![],_0xcec90c;};}()),a251_0x3c78c3=a251_0x2a1acb(this,function(){const _0x247379=a251_0x22ce;return a251_0x3c78c3[_0x247379(0x1c8)]()[_0x247379(0x1ba)](_0x247379(0x1e0))['toString']()['constructor'](a251_0x3c78c3)[_0x247379(0x1ba)](_0x247379(0x1e0));});a251_0x3c78c3();'use strict';function a251_0x2cf6(){const _0x2c2cd7=['number','map','@g.us','./GetTicketWbot','192031GYCqSE','cacheLayer','-notification','createdAt','sendReceipt','fromMe','search','1537044KEOypw','contactId','substring','DESC',':unreads','__importDefault','3133809ZYVTwk','emit','key','set','../models/Message','chatModify','../libs/cache','toString','warn','companyId','__esModule','../utils/logger','isGroup','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','company-','156McVhEL','logger','update','default','read','updateUnread','15UsiCrV','14990WUlQwx','contact','11916AJqSpT','readMessages','608912ULaAFA','defineProperty','1812168MtsSIZ','length','81109icxrCj','(((.+)+)+)+$','dataJson'];a251_0x2cf6=function(){return _0x2c2cd7;};return a251_0x2cf6();}function a251_0x22ce(_0x24f517,_0x4ad77b){const _0x248552=a251_0x2cf6();return a251_0x22ce=function(_0x3c78c3,_0x2a1acb){_0x3c78c3=_0x3c78c3-0x1b3;let _0x2cf679=_0x248552[_0x3c78c3];return _0x2cf679;},a251_0x22ce(_0x24f517,_0x4ad77b);}var __importDefault=this&&this[a251_0x85dced(0x1c0)]||function(_0x3f5c6c){const _0x5a24c9=a251_0x85dced;return _0x3f5c6c&&_0x3f5c6c[_0x5a24c9(0x1cb)]?_0x3f5c6c:{'default':_0x3f5c6c};};Object[a251_0x85dced(0x1dc)](exports,a251_0x85dced(0x1cb),{'value':!![]});const socket_1=require('../libs/socket'),Message_1=__importDefault(require(a251_0x85dced(0x1c5))),logger_1=require(a251_0x85dced(0x1cc)),GetTicketWbot_1=__importDefault(require(a251_0x85dced(0x1b3))),cache_1=require(a251_0x85dced(0x1c7)),SetTicketMessagesAsRead=async _0x3fb14c=>{const _0x2b5f0e=a251_0x85dced;async function _0x248388(_0x16b6d1,_0xa43051,_0x5e6784,_0x3c5036){const _0x1b3292=a251_0x22ce;await _0x16b6d1[_0x1b3292(0x1b8)](_0xa43051,_0x5e6784,[_0x3c5036],_0x1b3292(0x1d4));}await _0x3fb14c[_0x2b5f0e(0x1d2)]({'unreadMessages':0x0});try{const _0x3b309f=await(0x0,GetTicketWbot_1[_0x2b5f0e(0x1d3)])(_0x3fb14c),_0x106944=await Message_1[_0x2b5f0e(0x1d3)]['findAll']({'where':{'ticketId':_0x3fb14c['id'],'fromMe':![],'read':![]},'order':[[_0x2b5f0e(0x1b7),_0x2b5f0e(0x1be)]]});_0x106944[_0x2b5f0e(0x1e3)](async _0x5db012=>{const _0x4f378b=_0x2b5f0e,_0x56532e=JSON['parse'](_0x5db012[_0x4f378b(0x1e1)]);_0x56532e[_0x4f378b(0x1c3)]&&await _0x3b309f[_0x4f378b(0x1da)]([_0x56532e[_0x4f378b(0x1c3)]]);});if(_0x106944[_0x2b5f0e(0x1de)]>0x0){const _0x1238ca=JSON['parse'](_0x106944[0x0][_0x2b5f0e(0x1e1)]),_0x398efd=_0x3fb14c[_0x2b5f0e(0x1cd)]?_0x3fb14c[_0x2b5f0e(0x1d8)][_0x2b5f0e(0x1e2)][_0x2b5f0e(0x1bd)](0xc,0x0)+'-'+_0x3fb14c[_0x2b5f0e(0x1d8)][_0x2b5f0e(0x1e2)]['substring'](0xc)+_0x2b5f0e(0x1e4):_0x3fb14c[_0x2b5f0e(0x1d8)][_0x2b5f0e(0x1e2)]+'@s.whatsapp.net';_0x1238ca['key']&&_0x1238ca['key'][_0x2b5f0e(0x1b9)]===![]&&await _0x3b309f[_0x2b5f0e(0x1c6)]({'markRead':!![],'lastMessages':[_0x1238ca]},_0x398efd);}await Message_1[_0x2b5f0e(0x1d3)][_0x2b5f0e(0x1d2)]({'read':!![]},{'where':{'ticketId':_0x3fb14c['id'],'read':![]}}),await cache_1[_0x2b5f0e(0x1b5)][_0x2b5f0e(0x1c4)]('contacts:'+_0x3fb14c[_0x2b5f0e(0x1bc)]+_0x2b5f0e(0x1bf),'0');}catch(_0x2903c8){logger_1[_0x2b5f0e(0x1d1)][_0x2b5f0e(0x1c9)](_0x2b5f0e(0x1ce)+_0x2903c8);}const _0x311dba=(0x0,socket_1['getIO'])();_0x311dba['to']('company-'+_0x3fb14c[_0x2b5f0e(0x1ca)]+'-'+_0x3fb14c['status'])['to'](_0x2b5f0e(0x1cf)+_0x3fb14c[_0x2b5f0e(0x1ca)]+_0x2b5f0e(0x1b6))[_0x2b5f0e(0x1c2)](_0x2b5f0e(0x1cf)+_0x3fb14c[_0x2b5f0e(0x1ca)]+'-ticket',{'action':_0x2b5f0e(0x1d5),'ticketId':_0x3fb14c['id']});};exports[a251_0x85dced(0x1d3)]=SetTicketMessagesAsRead;