const a354_0x4e4315=a354_0x416a;(function(_0x2be8ac,_0x35b2f8){const _0x37136d=a354_0x416a,_0x246d36=_0x2be8ac();while(!![]){try{const _0x2fd333=-parseInt(_0x37136d(0x198))/0x1*(parseInt(_0x37136d(0x16b))/0x2)+parseInt(_0x37136d(0x165))/0x3+parseInt(_0x37136d(0x185))/0x4*(-parseInt(_0x37136d(0x188))/0x5)+parseInt(_0x37136d(0x196))/0x6+parseInt(_0x37136d(0x171))/0x7*(parseInt(_0x37136d(0x16d))/0x8)+-parseInt(_0x37136d(0x16c))/0x9*(parseInt(_0x37136d(0x197))/0xa)+parseInt(_0x37136d(0x192))/0xb;if(_0x2fd333===_0x35b2f8)break;else _0x246d36['push'](_0x246d36['shift']());}catch(_0x443cf2){_0x246d36['push'](_0x246d36['shift']());}}}(a354_0x4448,0x87a10));function a354_0x4448(){const _0x598856=['constructor','findAll','contactId','updateUnread','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20','../libs/socket','5566759maTjcn','company-','debug','chatModify','5951754VdPFch','152170cQexCz','44tZtrdT','../utils/logger','./GetTicketWbot','getIO','938085mERnSh','logger','error','parse','length','search','35956OBkztR','387djyiRG','8586128wfyIEy','Could\x20not\x20modify\x20chat.\x20Err:\x20','slice',':unreads','7HmsDCg','\x20as\x20read','status','queueId','remoteJid','dataJson','key','\x20messages\x20of\x20ticket\x20','-ticket','cacheLayer','__esModule','contacts:','set','readMessages','Marking\x20','catch','apply','update','companyId','queue-','3532360aQqCoR','message','default','5hoXGwz','(((.+)+)+)+$','toString','DESC'];a354_0x4448=function(){return _0x598856;};return a354_0x4448();}const a354_0x20a3f3=(function(){let _0x2b2f75=!![];return function(_0xedb807,_0x349620){const _0x700587=_0x2b2f75?function(){const _0x4c0774=a354_0x416a;if(_0x349620){const _0x2ecca7=_0x349620[_0x4c0774(0x181)](_0xedb807,arguments);return _0x349620=null,_0x2ecca7;}}:function(){};return _0x2b2f75=![],_0x700587;};}()),a354_0xc413d5=a354_0x20a3f3(this,function(){const _0x27dc49=a354_0x416a;return a354_0xc413d5[_0x27dc49(0x18a)]()[_0x27dc49(0x16a)]('(((.+)+)+)+$')[_0x27dc49(0x18a)]()[_0x27dc49(0x18c)](a354_0xc413d5)[_0x27dc49(0x16a)](_0x27dc49(0x189));});a354_0xc413d5();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x503016){const _0x43cbb3=a354_0x416a;return _0x503016&&_0x503016[_0x43cbb3(0x17b)]?_0x503016:{'default':_0x503016};};function a354_0x416a(_0x48fdc3,_0x324744){const _0x3544e1=a354_0x4448();return a354_0x416a=function(_0xc413d5,_0x20a3f3){_0xc413d5=_0xc413d5-0x165;let _0x44484c=_0x3544e1[_0xc413d5];return _0x44484c;},a354_0x416a(_0x48fdc3,_0x324744);}Object['defineProperty'](exports,a354_0x4e4315(0x17b),{'value':!![]});const cache_1=require('../libs/cache'),socket_1=require(a354_0x4e4315(0x191)),Message_1=__importDefault(require('../models/Message')),logger_1=require(a354_0x4e4315(0x199)),GetTicketWbot_1=__importDefault(require(a354_0x4e4315(0x19a))),SetTicketMessagesAsRead=async _0x30ce68=>{const _0x647111=a354_0x4e4315;await _0x30ce68['update']({'unreadMessages':0x0},{'silent':!![]}),await cache_1[_0x647111(0x17a)][_0x647111(0x17d)](_0x647111(0x17c)+_0x30ce68[_0x647111(0x18e)]+_0x647111(0x170),'0');let _0x581d32;try{const _0x5d5ee6=await(0x0,GetTicketWbot_1[_0x647111(0x187)])(_0x30ce68),_0x3ce539=await Message_1['default'][_0x647111(0x18d)]({'attributes':['id','companyId',_0x647111(0x176)],'where':{'ticketId':_0x30ce68['id'],'fromMe':![],'read':![]},'order':[['createdAt',_0x647111(0x18b)]]});if(_0x3ce539['length']===0x0)return;_0x581d32=_0x3ce539[0x0]?.[_0x647111(0x183)];const _0x4621a9=_0x3ce539['map'](_0x2db203=>{const _0xac4ec=_0x647111,_0x18f321=JSON[_0xac4ec(0x168)](_0x2db203[_0xac4ec(0x176)]);return _0x18f321[_0xac4ec(0x177)];})['filter'](_0x454f18=>_0x454f18!==undefined);logger_1[_0x647111(0x166)][_0x647111(0x194)]({'messageKeys':_0x4621a9,'ticketId':_0x30ce68['id']},_0x647111(0x17f)+_0x4621a9['length']+_0x647111(0x178)+_0x30ce68['id']+_0x647111(0x172));const _0x106885=0xfa;for(let _0x585a9c=0x0;_0x585a9c<_0x4621a9[_0x647111(0x169)];_0x585a9c+=_0x106885){const _0x389a17=_0x4621a9[_0x647111(0x16f)](_0x585a9c,_0x585a9c+_0x106885);_0x5d5ee6[_0x647111(0x17e)](_0x389a17)[_0x647111(0x180)](_0x208159=>{const _0x1e431c=_0x647111;logger_1['logger'][_0x1e431c(0x167)]({'error':_0x208159},'Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20'+_0x208159?.[_0x1e431c(0x186)]);});}const _0x116f24=JSON[_0x647111(0x168)](_0x3ce539[0x0][_0x647111(0x176)]),_0x599122=_0x116f24?.[_0x647111(0x177)];_0x599122?.[_0x647111(0x175)]&&!_0x599122['fromMe']&&_0x5d5ee6[_0x647111(0x195)]({'markRead':!![],'lastMessages':[_0x116f24]},_0x599122[_0x647111(0x175)])[_0x647111(0x180)](_0x3c6f2a=>{const _0x1bc3a9=_0x647111;logger_1[_0x1bc3a9(0x166)][_0x1bc3a9(0x167)]({'error':_0x3c6f2a},_0x1bc3a9(0x16e)+_0x3c6f2a?.[_0x1bc3a9(0x186)]);}),await Message_1[_0x647111(0x187)][_0x647111(0x182)]({'read':!![]},{'where':{'ticketId':_0x30ce68['id'],'read':![]}});}catch(_0x3fc4b8){logger_1[_0x647111(0x166)][_0x647111(0x167)]({'error':_0x3fc4b8},_0x647111(0x190)+_0x3fc4b8?.['message']);}const _0x3e9eca=(0x0,socket_1[_0x647111(0x19b)])();_0x581d32&&_0x3e9eca['to'](_0x30ce68['id'][_0x647111(0x18a)]())['to'](_0x647111(0x193)+_0x581d32+'-'+_0x30ce68[_0x647111(0x173)])['to'](_0x647111(0x184)+_0x30ce68[_0x647111(0x174)]+'-'+_0x30ce68['status'])['emit'](_0x647111(0x193)+_0x581d32+_0x647111(0x179),{'action':_0x647111(0x18f),'ticketId':_0x30ce68['id']});};exports[a354_0x4e4315(0x187)]=SetTicketMessagesAsRead;