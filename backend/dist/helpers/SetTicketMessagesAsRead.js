const a291_0x5d15fb=a291_0x57a3;(function(_0x3e28f1,_0x387cf0){const _0x8ba015=a291_0x57a3,_0x5e7001=_0x3e28f1();while(!![]){try{const _0x12e292=parseInt(_0x8ba015(0x142))/0x1+-parseInt(_0x8ba015(0x145))/0x2+-parseInt(_0x8ba015(0x139))/0x3+parseInt(_0x8ba015(0x123))/0x4+-parseInt(_0x8ba015(0x141))/0x5+-parseInt(_0x8ba015(0x134))/0x6+parseInt(_0x8ba015(0x12f))/0x7;if(_0x12e292===_0x387cf0)break;else _0x5e7001['push'](_0x5e7001['shift']());}catch(_0x16c07e){_0x5e7001['push'](_0x5e7001['shift']());}}}(a291_0x1c6e,0xf312e));const a291_0x1bb303=(function(){let _0x3b4cb5=!![];return function(_0x45905a,_0x3ea4c7){const _0x1d550a=_0x3b4cb5?function(){const _0x4f73f0=a291_0x57a3;if(_0x3ea4c7){const _0x5c3438=_0x3ea4c7[_0x4f73f0(0x146)](_0x45905a,arguments);return _0x3ea4c7=null,_0x5c3438;}}:function(){};return _0x3b4cb5=![],_0x1d550a;};}()),a291_0x40703c=a291_0x1bb303(this,function(){const _0x4ecb03=a291_0x57a3;return a291_0x40703c[_0x4ecb03(0x135)]()[_0x4ecb03(0x136)](_0x4ecb03(0x12d))[_0x4ecb03(0x135)]()[_0x4ecb03(0x11e)](a291_0x40703c)['search'](_0x4ecb03(0x12d));});a291_0x40703c();'use strict';function a291_0x57a3(_0x37d930,_0x4d3268){const _0x5324e8=a291_0x1c6e();return a291_0x57a3=function(_0x40703c,_0x1bb303){_0x40703c=_0x40703c-0x112;let _0x1c6e88=_0x5324e8[_0x40703c];return _0x1c6e88;},a291_0x57a3(_0x37d930,_0x4d3268);}var __importDefault=this&&this['__importDefault']||function(_0x157522){return _0x157522&&_0x157522['__esModule']?_0x157522:{'default':_0x157522};};Object['defineProperty'](exports,a291_0x5d15fb(0x13d),{'value':!![]});function a291_0x1c6e(){const _0x1e87d6=['toString','search','logger','key','5514786DrCZtG','\x20messages\x20of\x20ticket\x20','remoteJid','chatModify','__esModule','Could\x20not\x20modify\x20chat.\x20Err:\x20','map','contactId','9038965isTylk','314804cwCXdH','DESC','updateUnread','961394msSLCG','apply','getIO','./GetTicketWbot','update','fromMe','set','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20','contacts:','dataJson','default','../libs/cache','filter','cacheLayer','constructor','Marking\x20','status','error','../utils/logger','6476884ZatcCR','company-','readMessages','debug','slice','companyId','queueId','findAll','-ticket','message','(((.+)+)+)+$','length','29297478qxQXFX','catch','\x20as\x20read','../libs/socket','queue-','5981982hNJCUs'];a291_0x1c6e=function(){return _0x1e87d6;};return a291_0x1c6e();}const cache_1=require(a291_0x5d15fb(0x11b)),socket_1=require(a291_0x5d15fb(0x132)),Message_1=__importDefault(require('../models/Message')),logger_1=require(a291_0x5d15fb(0x122)),GetTicketWbot_1=__importDefault(require(a291_0x5d15fb(0x113))),SetTicketMessagesAsRead=async _0x20d590=>{const _0x2d2514=a291_0x5d15fb;await _0x20d590[_0x2d2514(0x114)]({'unreadMessages':0x0},{'silent':!![]}),await cache_1[_0x2d2514(0x11d)][_0x2d2514(0x116)](_0x2d2514(0x118)+_0x20d590[_0x2d2514(0x140)]+':unreads','0');let _0x57377c;try{const _0x2868da=await(0x0,GetTicketWbot_1[_0x2d2514(0x11a)])(_0x20d590),_0x624dbd=await Message_1[_0x2d2514(0x11a)][_0x2d2514(0x12a)]({'attributes':['id','companyId',_0x2d2514(0x119)],'where':{'ticketId':_0x20d590['id'],'fromMe':![],'read':![]},'order':[['createdAt',_0x2d2514(0x143)]]});if(_0x624dbd[_0x2d2514(0x12e)]===0x0)return;_0x57377c=_0x624dbd[0x0]?.[_0x2d2514(0x128)];const _0x5cc6b0=_0x624dbd[_0x2d2514(0x13f)](_0x406393=>{const _0x1f4415=JSON['parse'](_0x406393['dataJson']);return _0x1f4415['key'];})[_0x2d2514(0x11c)](_0x31d2d5=>_0x31d2d5!==undefined);logger_1[_0x2d2514(0x137)][_0x2d2514(0x126)]({'messageKeys':_0x5cc6b0,'ticketId':_0x20d590['id']},_0x2d2514(0x11f)+_0x5cc6b0[_0x2d2514(0x12e)]+_0x2d2514(0x13a)+_0x20d590['id']+_0x2d2514(0x131));const _0x5431bf=0xfa;for(let _0x22546c=0x0;_0x22546c<_0x5cc6b0[_0x2d2514(0x12e)];_0x22546c+=_0x5431bf){const _0x2f2ed4=_0x5cc6b0[_0x2d2514(0x127)](_0x22546c,_0x22546c+_0x5431bf);_0x2868da[_0x2d2514(0x125)](_0x2f2ed4)[_0x2d2514(0x130)](_0xb68c21=>{const _0x5b5e70=_0x2d2514;logger_1[_0x5b5e70(0x137)]['error']({'error':_0xb68c21},_0x5b5e70(0x117)+_0xb68c21?.[_0x5b5e70(0x12c)]);});}const _0x4d2709=JSON['parse'](_0x624dbd[0x0]['dataJson']),_0x321fc1=_0x4d2709?.[_0x2d2514(0x138)];_0x321fc1?.[_0x2d2514(0x13b)]&&!_0x321fc1[_0x2d2514(0x115)]&&_0x2868da[_0x2d2514(0x13c)]({'markRead':!![],'lastMessages':[_0x4d2709]},_0x321fc1['remoteJid'])['catch'](_0x464830=>{const _0x167579=_0x2d2514;logger_1[_0x167579(0x137)]['error']({'error':_0x464830},_0x167579(0x13e)+_0x464830?.[_0x167579(0x12c)]);}),await Message_1['default'][_0x2d2514(0x114)]({'read':!![]},{'where':{'ticketId':_0x20d590['id'],'read':![]}});}catch(_0x334b0d){logger_1[_0x2d2514(0x137)][_0x2d2514(0x121)]({'error':_0x334b0d},'Could\x20not\x20mark\x20messages\x20as\x20read.\x20Err:\x20'+_0x334b0d?.['message']);}const _0x43ca2e=(0x0,socket_1[_0x2d2514(0x112)])();_0x57377c&&_0x43ca2e['to'](_0x20d590['id'][_0x2d2514(0x135)]())['to'](_0x2d2514(0x124)+_0x57377c+'-'+_0x20d590[_0x2d2514(0x120)])['to'](_0x2d2514(0x133)+_0x20d590[_0x2d2514(0x129)]+'-'+_0x20d590[_0x2d2514(0x120)])['emit'](_0x2d2514(0x124)+_0x57377c+_0x2d2514(0x12b),{'action':_0x2d2514(0x144),'ticketId':_0x20d590['id']});};exports['default']=SetTicketMessagesAsRead;