const a250_0x4f1a15=a250_0x4f83;function a250_0x4f83(_0xcd13c2,_0x592b71){const _0x4fcead=a250_0x5170();return a250_0x4f83=function(_0x4736c4,_0x2eaefb){_0x4736c4=_0x4736c4-0xc6;let _0x517067=_0x4fcead[_0x4736c4];return _0x517067;},a250_0x4f83(_0xcd13c2,_0x592b71);}(function(_0x397371,_0x2dc61b){const _0x3f5ef7=a250_0x4f83,_0x46215d=_0x397371();while(!![]){try{const _0x3e008c=parseInt(_0x3f5ef7(0xed))/0x1*(parseInt(_0x3f5ef7(0xd3))/0x2)+parseInt(_0x3f5ef7(0xdd))/0x3*(-parseInt(_0x3f5ef7(0xe3))/0x4)+parseInt(_0x3f5ef7(0xec))/0x5+-parseInt(_0x3f5ef7(0xfc))/0x6*(-parseInt(_0x3f5ef7(0xd9))/0x7)+-parseInt(_0x3f5ef7(0xd0))/0x8*(-parseInt(_0x3f5ef7(0xd6))/0x9)+-parseInt(_0x3f5ef7(0xcd))/0xa+parseInt(_0x3f5ef7(0xf7))/0xb*(-parseInt(_0x3f5ef7(0xf6))/0xc);if(_0x3e008c===_0x2dc61b)break;else _0x46215d['push'](_0x46215d['shift']());}catch(_0x343b89){_0x46215d['push'](_0x46215d['shift']());}}}(a250_0x5170,0x3d31e));const a250_0x2eaefb=(function(){let _0x22e146=!![];return function(_0x1c15c2,_0x54fd1e){const _0x332537=_0x22e146?function(){const _0x22194c=a250_0x4f83;if(_0x54fd1e){const _0x3a8090=_0x54fd1e[_0x22194c(0xf1)](_0x1c15c2,arguments);return _0x54fd1e=null,_0x3a8090;}}:function(){};return _0x22e146=![],_0x332537;};}()),a250_0x4736c4=a250_0x2eaefb(this,function(){const _0x42678b=a250_0x4f83;return a250_0x4736c4[_0x42678b(0xe1)]()[_0x42678b(0xe8)](_0x42678b(0xcb))[_0x42678b(0xe1)]()[_0x42678b(0xe6)](a250_0x4736c4)['search'](_0x42678b(0xcb));});a250_0x4736c4();'use strict';var __importDefault=this&&this[a250_0x4f1a15(0xf3)]||function(_0x1cde9b){const _0x23962f=a250_0x4f1a15;return _0x1cde9b&&_0x1cde9b[_0x23962f(0xfb)]?_0x1cde9b:{'default':_0x1cde9b};};Object[a250_0x4f1a15(0xea)](exports,a250_0x4f1a15(0xfb),{'value':!![]});function a250_0x5170(){const _0x4d0aa3=['64293FFmSYj','chatModify','DESC','update','toString','updateUnread','32VtKbHn','../models/Message','emit','constructor','substring','search','default','defineProperty','dataJson','1695005ENMpLr','332939uwbDCG','@s.whatsapp.net','read','warn','apply','@g.us','__importDefault','contactId','company-','12luHEpA','7879476TKeJLl','length','map',':unreads','__esModule','508350EKzpDV','-ticket','key','-notification','sendReceipt','contact','findAll','companyId','parse','(((.+)+)+)+$','status','845590KOIqOs','fromMe','./GetTicketWbot','48VtRJuk','getIO','contacts:','2GXzOkE','cacheLayer','createdAt','445293WByvkk','number','../utils/logger','21gzhaYN','logger','../libs/cache','isGroup'];a250_0x5170=function(){return _0x4d0aa3;};return a250_0x5170();}const socket_1=require('../libs/socket'),Message_1=__importDefault(require(a250_0x4f1a15(0xe4))),logger_1=require(a250_0x4f1a15(0xd8)),GetTicketWbot_1=__importDefault(require(a250_0x4f1a15(0xcf))),cache_1=require(a250_0x4f1a15(0xdb)),SetTicketMessagesAsRead=async _0x380f1e=>{const _0x33d18f=a250_0x4f1a15;async function _0x514642(_0x5de8b9,_0x484cf7,_0x410b50,_0x380102){const _0x402f16=a250_0x4f83;await _0x5de8b9[_0x402f16(0xc6)](_0x484cf7,_0x410b50,[_0x380102],_0x402f16(0xef));}await _0x380f1e[_0x33d18f(0xe0)]({'unreadMessages':0x0});try{const _0x2ef6be=await(0x0,GetTicketWbot_1[_0x33d18f(0xe9)])(_0x380f1e),_0x50cba0=await Message_1[_0x33d18f(0xe9)][_0x33d18f(0xc8)]({'where':{'ticketId':_0x380f1e['id'],'fromMe':![],'read':![]},'order':[[_0x33d18f(0xd5),_0x33d18f(0xdf)]]});_0x50cba0[_0x33d18f(0xf9)](async _0x463056=>{const _0x2ffb7e=_0x33d18f,_0xafd3c6=JSON[_0x2ffb7e(0xca)](_0x463056['dataJson']);_0xafd3c6[_0x2ffb7e(0xfe)]&&await _0x2ef6be['readMessages']([_0xafd3c6['key']]);});if(_0x50cba0[_0x33d18f(0xf8)]>0x0){const _0xc283b7=JSON['parse'](_0x50cba0[0x0][_0x33d18f(0xeb)]),_0x2a3fc7=_0x380f1e[_0x33d18f(0xdc)]?_0x380f1e[_0x33d18f(0xc7)][_0x33d18f(0xd7)][_0x33d18f(0xe7)](0xc,0x0)+'-'+_0x380f1e[_0x33d18f(0xc7)][_0x33d18f(0xd7)][_0x33d18f(0xe7)](0xc)+_0x33d18f(0xf2):_0x380f1e[_0x33d18f(0xc7)][_0x33d18f(0xd7)]+_0x33d18f(0xee);_0xc283b7[_0x33d18f(0xfe)]&&_0xc283b7[_0x33d18f(0xfe)][_0x33d18f(0xce)]===![]&&await _0x2ef6be[_0x33d18f(0xde)]({'markRead':!![],'lastMessages':[_0xc283b7]},_0x2a3fc7);}await Message_1['default'][_0x33d18f(0xe0)]({'read':!![]},{'where':{'ticketId':_0x380f1e['id'],'read':![]}}),await cache_1[_0x33d18f(0xd4)]['set'](_0x33d18f(0xd2)+_0x380f1e[_0x33d18f(0xf4)]+_0x33d18f(0xfa),'0');}catch(_0x1dd8fc){logger_1[_0x33d18f(0xda)][_0x33d18f(0xf0)]('Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20'+_0x1dd8fc);}const _0x30aa5e=(0x0,socket_1[_0x33d18f(0xd1)])();_0x30aa5e['to'](_0x33d18f(0xf5)+_0x380f1e[_0x33d18f(0xc9)]+'-'+_0x380f1e[_0x33d18f(0xcc)])['to']('company-'+_0x380f1e[_0x33d18f(0xc9)]+_0x33d18f(0xff))[_0x33d18f(0xe5)](_0x33d18f(0xf5)+_0x380f1e[_0x33d18f(0xc9)]+_0x33d18f(0xfd),{'action':_0x33d18f(0xe2),'ticketId':_0x380f1e['id']});};exports['default']=SetTicketMessagesAsRead;