const a247_0x139321=a247_0x2d33;function a247_0x70bf(){const _0x4aae8e=['-notification','dataJson','../libs/cache','587349JHNyIw','-ticket','415650SCAOQJ','search','emit','key','update','parse','35980gwSdnx','getIO','read','companyId','477edNsvE','14437236tYzmjk','defineProperty','number','10fqbrSe','contactId','substring',':unreads','set','contact','findAll','status','__esModule','8OYnABt','warn','company-','861637WOvgWW','default','../models/Message','../libs/socket','839292ZpxKEf','logger','map','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','apply','createdAt','sendReceipt','585236UUpNZy','@g.us','./GetTicketWbot','readMessages','DESC','2NYotKr','constructor','contacts:','toString','(((.+)+)+)+$','length'];a247_0x70bf=function(){return _0x4aae8e;};return a247_0x70bf();}(function(_0x54a148,_0x59e3d3){const _0x462a93=a247_0x2d33,_0x447655=_0x54a148();while(!![]){try{const _0x5d9b4a=-parseInt(_0x462a93(0x155))/0x1+-parseInt(_0x462a93(0x14a))/0x2*(parseInt(_0x462a93(0x153))/0x3)+-parseInt(_0x462a93(0x145))/0x4*(parseInt(_0x462a93(0x163))/0x5)+parseInt(_0x462a93(0x13e))/0x6+parseInt(_0x462a93(0x16f))/0x7*(-parseInt(_0x462a93(0x16c))/0x8)+parseInt(_0x462a93(0x15f))/0x9*(-parseInt(_0x462a93(0x15b))/0xa)+parseInt(_0x462a93(0x160))/0xb;if(_0x5d9b4a===_0x59e3d3)break;else _0x447655['push'](_0x447655['shift']());}catch(_0x532c5e){_0x447655['push'](_0x447655['shift']());}}}(a247_0x70bf,0x3941a));const a247_0x4bfc53=(function(){let _0x58d084=!![];return function(_0x158713,_0x14ca97){const _0x566313=_0x58d084?function(){const _0x8c977a=a247_0x2d33;if(_0x14ca97){const _0x5c85a1=_0x14ca97[_0x8c977a(0x142)](_0x158713,arguments);return _0x14ca97=null,_0x5c85a1;}}:function(){};return _0x58d084=![],_0x566313;};}()),a247_0x1e541b=a247_0x4bfc53(this,function(){const _0x4723a6=a247_0x2d33;return a247_0x1e541b['toString']()[_0x4723a6(0x156)](_0x4723a6(0x14e))[_0x4723a6(0x14d)]()[_0x4723a6(0x14b)](a247_0x1e541b)['search'](_0x4723a6(0x14e));});a247_0x1e541b();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5227a3){const _0x43ac64=a247_0x2d33;return _0x5227a3&&_0x5227a3[_0x43ac64(0x16b)]?_0x5227a3:{'default':_0x5227a3};};Object[a247_0x139321(0x161)](exports,a247_0x139321(0x16b),{'value':!![]});function a247_0x2d33(_0x47cb68,_0x58ed74){const _0x35fb68=a247_0x70bf();return a247_0x2d33=function(_0x1e541b,_0x4bfc53){_0x1e541b=_0x1e541b-0x13b;let _0x70bf6b=_0x35fb68[_0x1e541b];return _0x70bf6b;},a247_0x2d33(_0x47cb68,_0x58ed74);}const socket_1=require(a247_0x139321(0x13d)),Message_1=__importDefault(require(a247_0x139321(0x13c))),logger_1=require('../utils/logger'),GetTicketWbot_1=__importDefault(require(a247_0x139321(0x147))),cache_1=__importDefault(require(a247_0x139321(0x152))),SetTicketMessagesAsRead=async _0x3b6477=>{const _0x3bd6b9=a247_0x139321;async function _0x33b56e(_0xb0d5b4,_0x2a81a2,_0x53da0c,_0x181ae5){const _0x15c8c5=a247_0x2d33;await _0xb0d5b4[_0x15c8c5(0x144)](_0x2a81a2,_0x53da0c,[_0x181ae5],_0x15c8c5(0x15d));}await _0x3b6477[_0x3bd6b9(0x159)]({'unreadMessages':0x0});try{const _0x3b6da8=await(0x0,GetTicketWbot_1[_0x3bd6b9(0x13b)])(_0x3b6477),_0x8c89b6=await Message_1[_0x3bd6b9(0x13b)][_0x3bd6b9(0x169)]({'where':{'ticketId':_0x3b6477['id'],'fromMe':![],'read':![]},'order':[[_0x3bd6b9(0x143),_0x3bd6b9(0x149)]]});_0x8c89b6[_0x3bd6b9(0x140)](async _0x2a70fb=>{const _0xef2ad9=_0x3bd6b9,_0x5a7937=JSON[_0xef2ad9(0x15a)](_0x2a70fb[_0xef2ad9(0x151)]);_0x5a7937[_0xef2ad9(0x158)]&&await _0x3b6da8[_0xef2ad9(0x148)]([_0x5a7937[_0xef2ad9(0x158)]]);});if(_0x8c89b6[_0x3bd6b9(0x14f)]>0x0){const _0x2e9502=JSON['parse'](_0x8c89b6[0x0][_0x3bd6b9(0x151)]),_0x52dc25=_0x3b6477['isGroup']?_0x3b6477[_0x3bd6b9(0x168)][_0x3bd6b9(0x162)]['substring'](0xc,0x0)+'-'+_0x3b6477[_0x3bd6b9(0x168)]['number'][_0x3bd6b9(0x165)](0xc)+_0x3bd6b9(0x146):_0x3b6477['contact'][_0x3bd6b9(0x162)]+'@s.whatsapp.net';_0x2e9502[_0x3bd6b9(0x158)]&&_0x2e9502[_0x3bd6b9(0x158)]['fromMe']===![]&&await _0x3b6da8['chatModify']({'markRead':!![],'lastMessages':[_0x2e9502]},_0x52dc25);}await Message_1[_0x3bd6b9(0x13b)][_0x3bd6b9(0x159)]({'read':!![]},{'where':{'ticketId':_0x3b6477['id'],'read':![]}}),await cache_1[_0x3bd6b9(0x13b)][_0x3bd6b9(0x167)](_0x3bd6b9(0x14c)+_0x3b6477[_0x3bd6b9(0x164)]+_0x3bd6b9(0x166),'0');}catch(_0xd16350){logger_1[_0x3bd6b9(0x13f)][_0x3bd6b9(0x16d)](_0x3bd6b9(0x141)+_0xd16350);}const _0x10bc2f=(0x0,socket_1[_0x3bd6b9(0x15c)])();_0x10bc2f['to'](_0x3bd6b9(0x16e)+_0x3b6477[_0x3bd6b9(0x15e)]+'-'+_0x3b6477[_0x3bd6b9(0x16a)])['to']('company-'+_0x3b6477[_0x3bd6b9(0x15e)]+_0x3bd6b9(0x150))[_0x3bd6b9(0x157)]('company-'+_0x3b6477['companyId']+_0x3bd6b9(0x154),{'action':'updateUnread','ticketId':_0x3b6477['id']});};exports[a247_0x139321(0x13b)]=SetTicketMessagesAsRead;