const a244_0xe8cd8b=a244_0x5a8f;(function(_0x5742c7,_0xefeaaf){const _0x4ff861=a244_0x5a8f,_0x1b5884=_0x5742c7();while(!![]){try{const _0x37b83f=-parseInt(_0x4ff861(0x1ad))/0x1*(parseInt(_0x4ff861(0x1c7))/0x2)+-parseInt(_0x4ff861(0x1dd))/0x3+-parseInt(_0x4ff861(0x1db))/0x4*(-parseInt(_0x4ff861(0x1e1))/0x5)+parseInt(_0x4ff861(0x1d2))/0x6*(parseInt(_0x4ff861(0x1e4))/0x7)+parseInt(_0x4ff861(0x1b3))/0x8+parseInt(_0x4ff861(0x1ca))/0x9+parseInt(_0x4ff861(0x1e5))/0xa;if(_0x37b83f===_0xefeaaf)break;else _0x1b5884['push'](_0x1b5884['shift']());}catch(_0x2ca70f){_0x1b5884['push'](_0x1b5884['shift']());}}}(a244_0x5f40,0x974c8));function a244_0x5f40(){const _0x56365d=['verifyQuotedMessage','unknown','isGroup','apply','verifyMessage','11498EGFSBX','getMessageOptions','./GetWhatsappWbot','2580462SygNTN','fromMe','number','(((.+)+)+)+$','../services/WbotServices/wbotMessageListener','g.us','mime','body\x20is\x20not\x20a\x20string','2280kihVIu','__importDefault','sendMessage','trace','SendMessage','search','finalName','../helpers/SetTicketMessagesAsRead','SendPresenceStatus','313048CQNLch','remoteJid','1529346aeojNd','../helpers/Mustache','lookup','./SendPresenceStatus','65ocKhEC','../services/WbotServices/SendWhatsAppMedia','__esModule','49xrBKzR','114620FtZVOW','participant','61Esbbxb','key','toString','replace','fileName','jid','1295560ubDSeU','update','toLocaleString','../services/WbotServices/CheckNumber','../services/TicketServices/FindOrCreateTicketService','string','defineProperty','s.whatsapp.net','split','default','companyId','body','constructor','contact','mediaPath'];a244_0x5f40=function(){return _0x56365d;};return a244_0x5f40();}const a244_0x4620da=(function(){let _0x5c607c=!![];return function(_0x423e3e,_0x3214ef){const _0x4f9950=_0x5c607c?function(){const _0x3096a4=a244_0x5a8f;if(_0x3214ef){const _0x522d63=_0x3214ef[_0x3096a4(0x1c5)](_0x423e3e,arguments);return _0x3214ef=null,_0x522d63;}}:function(){};return _0x5c607c=![],_0x4f9950;};}()),a244_0x337c7c=a244_0x4620da(this,function(){const _0x5f036f=a244_0x5a8f;return a244_0x337c7c['toString']()[_0x5f036f(0x1d7)](_0x5f036f(0x1cd))[_0x5f036f(0x1af)]()[_0x5f036f(0x1bf)](a244_0x337c7c)[_0x5f036f(0x1d7)]('(((.+)+)+)+$');});a244_0x337c7c();'use strict';var __importDefault=this&&this[a244_0xe8cd8b(0x1d3)]||function(_0x24ce6d){const _0x50d9eb=a244_0xe8cd8b;return _0x24ce6d&&_0x24ce6d[_0x50d9eb(0x1e3)]?_0x24ce6d:{'default':_0x24ce6d};};function a244_0x5a8f(_0x4fbf76,_0x2b99a1){const _0x5b1d9e=a244_0x5f40();return a244_0x5a8f=function(_0x337c7c,_0x4620da){_0x337c7c=_0x337c7c-0x1ad;let _0x5f40fa=_0x5b1d9e[_0x337c7c];return _0x5f40fa;},a244_0x5a8f(_0x4fbf76,_0x2b99a1);}Object[a244_0xe8cd8b(0x1b9)](exports,a244_0xe8cd8b(0x1e3),{'value':!![]}),exports[a244_0xe8cd8b(0x1d6)]=void 0x0;const GetWhatsappWbot_1=__importDefault(require(a244_0xe8cd8b(0x1c9))),SendWhatsAppMedia_1=require(a244_0xe8cd8b(0x1e2)),CreateOrUpdateContactService_1=__importDefault(require('../services/ContactServices/CreateOrUpdateContactService')),FindOrCreateTicketService_1=__importDefault(require(a244_0xe8cd8b(0x1b7))),CheckNumber_1=__importDefault(require(a244_0xe8cd8b(0x1b6))),SetTicketMessagesAsRead_1=__importDefault(require(a244_0xe8cd8b(0x1d9))),Mustache_1=__importDefault(require(a244_0xe8cd8b(0x1de))),wbotMessageListener_1=require(a244_0xe8cd8b(0x1ce)),mime_1=__importDefault(require(a244_0xe8cd8b(0x1d0))),CreateMessageService_1=__importDefault(require('../services/MessageServices/CreateMessageService')),SendPresenceStatus_1=require(a244_0xe8cd8b(0x1e0)),SendMessage=async(_0x1090f9,_0x38cb7b)=>{const _0x53dd9c=a244_0xe8cd8b;try{const _0xc02e60=await(0x0,GetWhatsappWbot_1[_0x53dd9c(0x1bc)])(_0x1090f9),_0x1f09be=_0x38cb7b['number'],_0x5ed88e=_0x38cb7b[_0x53dd9c(0x1be)],_0x2a1f37=_0x1090f9[_0x53dd9c(0x1bd)],_0x2a9d85=await(0x0,CheckNumber_1['default'])(_0x1f09be[_0x53dd9c(0x1b5)](),_0x2a1f37),_0x2c69ce=_0x2a9d85[_0x53dd9c(0x1b2)][_0x53dd9c(0x1b0)](/\D/g,''),_0x52be73={'name':''+_0x2c69ce,'number':_0x2c69ce,'isGroup':![],'companyId':_0x2a1f37},_0x48546a=await(0x0,CreateOrUpdateContactService_1['default'])(_0x52be73,_0xc02e60,_0x2a9d85['jid']),_0x579653=await(0x0,FindOrCreateTicketService_1[_0x53dd9c(0x1bc)])(_0x48546a,_0x1090f9['id'],0x0,_0x2a1f37),_0x5d17a7=_0x579653[_0x53dd9c(0x1c0)][_0x53dd9c(0x1cc)]+'@'+(_0x579653[_0x53dd9c(0x1c4)]?_0x53dd9c(0x1cf):_0x53dd9c(0x1ba));let _0x2c6d79;if(_0x38cb7b[_0x53dd9c(0x1c1)]){const _0x59d131=await(0x0,SendWhatsAppMedia_1[_0x53dd9c(0x1c8)])(_0x38cb7b[_0x53dd9c(0x1b1)],_0x38cb7b['mediaPath'],_0x38cb7b[_0x53dd9c(0x1be)],_0x2a1f37);if(_0x59d131){await(0x0,SendPresenceStatus_1[_0x53dd9c(0x1da)])(_0xc02e60,_0x5d17a7,0x0,0x2710);let _0xf50e82=_0x2c6d79=await _0xc02e60[_0x53dd9c(0x1d4)](_0x5d17a7,{..._0x59d131});const _0x3b33c3=mime_1['default'][_0x53dd9c(0x1df)](_0x38cb7b[_0x53dd9c(0x1c1)]),_0x4743b3=await(0x0,wbotMessageListener_1[_0x53dd9c(0x1c2)])(_0xf50e82),_0x14543c={'id':_0xf50e82[_0x53dd9c(0x1ae)]['id'],'ticketId':_0x579653['id'],'contactId':_0xf50e82[_0x53dd9c(0x1ae)][_0x53dd9c(0x1cb)]?undefined:_0x48546a['id'],'body':_0x5ed88e?(0x0,Mustache_1['default'])(_0x5ed88e,_0x579653):_0x38cb7b[_0x53dd9c(0x1b1)],'fromMe':_0xf50e82['key']['fromMe'],'read':_0xf50e82[_0x53dd9c(0x1ae)][_0x53dd9c(0x1cb)],'mediaUrl':_0x38cb7b[_0x53dd9c(0x1d8)],'mediaType':typeof _0x3b33c3===_0x53dd9c(0x1b8)?_0x3b33c3[_0x53dd9c(0x1bb)]('/')[0x0]:_0x53dd9c(0x1c3),'quotedMsgId':_0x4743b3?.['id'],'ack':0x0,'remoteJid':_0xf50e82[_0x53dd9c(0x1ae)][_0x53dd9c(0x1dc)],'participant':_0xf50e82['key'][_0x53dd9c(0x1e6)],'dataJson':JSON['stringify'](_0xf50e82)};typeof _0x14543c[_0x53dd9c(0x1be)]!=_0x53dd9c(0x1b8)&&console['trace']('body\x20is\x20not\x20a\x20string',_0x14543c['body']),await _0x579653[_0x53dd9c(0x1b4)]({'lastMessage':_0x14543c['body']}),await(0x0,CreateMessageService_1[_0x53dd9c(0x1bc)])({'messageData':_0x14543c,'ticket':_0x579653,'companyId':_0x579653[_0x53dd9c(0x1bd)]});}}else{const _0x504541='â€Ž\x20'+_0x38cb7b['body'];await(0x0,SendPresenceStatus_1[_0x53dd9c(0x1da)])(_0xc02e60,_0x5d17a7);const _0x4e1199=await _0xc02e60[_0x53dd9c(0x1d4)](_0x5d17a7,{'text':(0x0,Mustache_1[_0x53dd9c(0x1bc)])(_0x504541,_0x579653)});await(0x0,wbotMessageListener_1[_0x53dd9c(0x1c6)])(_0x4e1199,_0x579653,_0x579653[_0x53dd9c(0x1c0)]);}return typeof _0x5ed88e!='string'&&console[_0x53dd9c(0x1d5)](_0x53dd9c(0x1d1),_0x5ed88e),await _0x579653['update']({'lastMessage':_0x5ed88e}),(0x0,SetTicketMessagesAsRead_1['default'])(_0x579653),_0x2c6d79;}catch(_0x16064c){throw new Error(_0x16064c);}};exports[a244_0xe8cd8b(0x1d6)]=SendMessage;