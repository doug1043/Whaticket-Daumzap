const a247_0x548820=a247_0x5250;(function(_0x527bf2,_0x17983e){const _0x5a80ff=a247_0x5250,_0x56cf68=_0x527bf2();while(!![]){try{const _0x19dc84=-parseInt(_0x5a80ff(0x140))/0x1+parseInt(_0x5a80ff(0x163))/0x2+-parseInt(_0x5a80ff(0x165))/0x3+-parseInt(_0x5a80ff(0x162))/0x4*(parseInt(_0x5a80ff(0x152))/0x5)+parseInt(_0x5a80ff(0x150))/0x6*(parseInt(_0x5a80ff(0x149))/0x7)+parseInt(_0x5a80ff(0x141))/0x8+parseInt(_0x5a80ff(0x135))/0x9*(-parseInt(_0x5a80ff(0x145))/0xa);if(_0x19dc84===_0x17983e)break;else _0x56cf68['push'](_0x56cf68['shift']());}catch(_0x413e5f){_0x56cf68['push'](_0x56cf68['shift']());}}}(a247_0x3969,0x65627));function a247_0x5250(_0x38abcd,_0x1bdffa){const _0x5c5c72=a247_0x3969();return a247_0x5250=function(_0x43618f,_0x1d878a){_0x43618f=_0x43618f-0x133;let _0x396908=_0x5c5c72[_0x43618f];return _0x396908;},a247_0x5250(_0x38abcd,_0x1bdffa);}const a247_0x1d878a=(function(){let _0xda2a0d=!![];return function(_0x367295,_0x83f435){const _0x5d8c0a=_0xda2a0d?function(){const _0x31421b=a247_0x5250;if(_0x83f435){const _0x349ab2=_0x83f435[_0x31421b(0x160)](_0x367295,arguments);return _0x83f435=null,_0x349ab2;}}:function(){};return _0xda2a0d=![],_0x5d8c0a;};}()),a247_0x43618f=a247_0x1d878a(this,function(){const _0xcbfbd9=a247_0x5250;return a247_0x43618f['toString']()[_0xcbfbd9(0x154)]('(((.+)+)+)+$')[_0xcbfbd9(0x13e)]()[_0xcbfbd9(0x151)](a247_0x43618f)[_0xcbfbd9(0x154)](_0xcbfbd9(0x13a));});a247_0x43618f();'use strict';var __importDefault=this&&this[a247_0x548820(0x161)]||function(_0x7d12c2){const _0x4117ec=a247_0x548820;return _0x7d12c2&&_0x7d12c2[_0x4117ec(0x168)]?_0x7d12c2:{'default':_0x7d12c2};};Object[a247_0x548820(0x169)](exports,a247_0x548820(0x168),{'value':!![]}),exports[a247_0x548820(0x134)]=void 0x0;function a247_0x3969(){const _0x3b146b=['SendMessage','9mfpOBj','contact','trace','body','number','(((.+)+)+)+$','SendPresenceStatus','verifyQuotedMessage','g.us','toString','body\x20is\x20not\x20a\x20string','57866ekTBDQ','3694504uLDZnQ','update','./GetWhatsappWbot','s.whatsapp.net','2260370XrwbOn','companyId','replace','stringify','2572507lQyigz','verifyMessage','split','../services/WbotServices/CheckNumber','mediaPath','string','../services/MessageServices/CreateMessageService','6erVsyu','constructor','105XKiCdZ','getMessageOptions','search','mime','default','key','fromMe','toLocaleString','participant','jid','isGroup','sendMessage','fileName','lookup','apply','__importDefault','130196uMzBcT','1300116iGdvMF','../helpers/SetTicketMessagesAsRead','290007WxTlhZ','remoteJid','./SendPresenceStatus','__esModule','defineProperty','../services/ContactServices/CreateOrUpdateContactService','../services/TicketServices/FindOrCreateTicketService'];a247_0x3969=function(){return _0x3b146b;};return a247_0x3969();}const GetWhatsappWbot_1=__importDefault(require(a247_0x548820(0x143))),SendWhatsAppMedia_1=require('../services/WbotServices/SendWhatsAppMedia'),CreateOrUpdateContactService_1=__importDefault(require(a247_0x548820(0x16a))),FindOrCreateTicketService_1=__importDefault(require(a247_0x548820(0x133))),CheckNumber_1=__importDefault(require(a247_0x548820(0x14c))),SetTicketMessagesAsRead_1=__importDefault(require(a247_0x548820(0x164))),Mustache_1=__importDefault(require('../helpers/Mustache')),wbotMessageListener_1=require('../services/WbotServices/wbotMessageListener'),mime_1=__importDefault(require(a247_0x548820(0x155))),CreateMessageService_1=__importDefault(require(a247_0x548820(0x14f))),SendPresenceStatus_1=require(a247_0x548820(0x167)),SendMessage=async(_0x937785,_0x13300e)=>{const _0x3400d4=a247_0x548820;try{const _0x4fdd4d=await(0x0,GetWhatsappWbot_1[_0x3400d4(0x156)])(_0x937785),_0x1a807e=_0x13300e[_0x3400d4(0x139)],_0x201460=_0x13300e[_0x3400d4(0x138)],_0xb66f6=_0x937785[_0x3400d4(0x146)],_0x48ab88=await(0x0,CheckNumber_1['default'])(_0x1a807e[_0x3400d4(0x159)](),_0xb66f6),_0x2814ec=_0x48ab88[_0x3400d4(0x15b)][_0x3400d4(0x147)](/\D/g,''),_0x31322a={'name':''+_0x2814ec,'number':_0x2814ec,'isGroup':![],'companyId':_0xb66f6},_0x5ec472=await(0x0,CreateOrUpdateContactService_1[_0x3400d4(0x156)])(_0x31322a,_0x4fdd4d,_0x48ab88['jid']),_0x385514=await(0x0,FindOrCreateTicketService_1[_0x3400d4(0x156)])(_0x5ec472,_0x937785['id'],0x0,_0xb66f6),_0x499cb0=_0x385514[_0x3400d4(0x136)][_0x3400d4(0x139)]+'@'+(_0x385514[_0x3400d4(0x15c)]?_0x3400d4(0x13d):_0x3400d4(0x144));let _0x2c7a7c;if(_0x13300e[_0x3400d4(0x14d)]){const _0x4707e7=await(0x0,SendWhatsAppMedia_1[_0x3400d4(0x153)])(_0x13300e[_0x3400d4(0x15e)],_0x13300e[_0x3400d4(0x14d)],_0x13300e[_0x3400d4(0x138)],_0xb66f6);if(_0x4707e7){await(0x0,SendPresenceStatus_1[_0x3400d4(0x13b)])(_0x4fdd4d,_0x499cb0,0x0,0x2710);let _0x14d025=_0x2c7a7c=await _0x4fdd4d[_0x3400d4(0x15d)](_0x499cb0,{..._0x4707e7});const _0xa8e496=mime_1[_0x3400d4(0x156)][_0x3400d4(0x15f)](_0x13300e[_0x3400d4(0x14d)]),_0x2aa491=await(0x0,wbotMessageListener_1[_0x3400d4(0x13c)])(_0x14d025),_0x59ba17={'id':_0x14d025[_0x3400d4(0x157)]['id'],'ticketId':_0x385514['id'],'contactId':_0x14d025[_0x3400d4(0x157)]['fromMe']?undefined:_0x5ec472['id'],'body':_0x201460?(0x0,Mustache_1['default'])(_0x201460,_0x385514):_0x13300e[_0x3400d4(0x15e)],'fromMe':_0x14d025[_0x3400d4(0x157)][_0x3400d4(0x158)],'read':_0x14d025[_0x3400d4(0x157)][_0x3400d4(0x158)],'mediaUrl':_0x13300e['finalName'],'mediaType':typeof _0xa8e496===_0x3400d4(0x14e)?_0xa8e496[_0x3400d4(0x14b)]('/')[0x0]:'unknown','quotedMsgId':_0x2aa491?.['id'],'ack':0x0,'remoteJid':_0x14d025[_0x3400d4(0x157)][_0x3400d4(0x166)],'participant':_0x14d025[_0x3400d4(0x157)][_0x3400d4(0x15a)],'dataJson':JSON[_0x3400d4(0x148)](_0x14d025)};typeof _0x59ba17[_0x3400d4(0x138)]!=_0x3400d4(0x14e)&&console[_0x3400d4(0x137)]('body\x20is\x20not\x20a\x20string',_0x59ba17[_0x3400d4(0x138)]),await _0x385514[_0x3400d4(0x142)]({'lastMessage':_0x59ba17[_0x3400d4(0x138)]}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x59ba17,'ticket':_0x385514,'companyId':_0x385514[_0x3400d4(0x146)]});}}else{const _0xc6a07d='â€Ž\x20'+_0x13300e[_0x3400d4(0x138)];await(0x0,SendPresenceStatus_1[_0x3400d4(0x13b)])(_0x4fdd4d,_0x499cb0);const _0x43ba6f=await _0x4fdd4d[_0x3400d4(0x15d)](_0x499cb0,{'text':(0x0,Mustache_1[_0x3400d4(0x156)])(_0xc6a07d,_0x385514)});await(0x0,wbotMessageListener_1[_0x3400d4(0x14a)])(_0x43ba6f,_0x385514,_0x385514[_0x3400d4(0x136)]);}return typeof _0x201460!=_0x3400d4(0x14e)&&console[_0x3400d4(0x137)](_0x3400d4(0x13f),_0x201460),await _0x385514['update']({'lastMessage':_0x201460}),(0x0,SetTicketMessagesAsRead_1[_0x3400d4(0x156)])(_0x385514),_0x2c7a7c;}catch(_0x34ef42){throw new Error(_0x34ef42);}};exports[a247_0x548820(0x134)]=SendMessage;