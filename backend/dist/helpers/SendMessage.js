const a246_0x17d22d=a246_0x2eaf;(function(_0x4e7eb9,_0x32837d){const _0x145544=a246_0x2eaf,_0x3e26d1=_0x4e7eb9();while(!![]){try{const _0x5b28a4=parseInt(_0x145544(0x198))/0x1*(-parseInt(_0x145544(0x189))/0x2)+parseInt(_0x145544(0x1b7))/0x3+-parseInt(_0x145544(0x1b2))/0x4+parseInt(_0x145544(0x1a5))/0x5+parseInt(_0x145544(0x18a))/0x6*(parseInt(_0x145544(0x184))/0x7)+parseInt(_0x145544(0x18c))/0x8*(parseInt(_0x145544(0x193))/0x9)+parseInt(_0x145544(0x19a))/0xa;if(_0x5b28a4===_0x32837d)break;else _0x3e26d1['push'](_0x3e26d1['shift']());}catch(_0x3f4d06){_0x3e26d1['push'](_0x3e26d1['shift']());}}}(a246_0x41be,0xd0dcf));const a246_0x3084f5=(function(){let _0x26d565=!![];return function(_0xd57fda,_0x6a6b9d){const _0x43910f=_0x26d565?function(){if(_0x6a6b9d){const _0x2a1163=_0x6a6b9d['apply'](_0xd57fda,arguments);return _0x6a6b9d=null,_0x2a1163;}}:function(){};return _0x26d565=![],_0x43910f;};}()),a246_0x4c53c2=a246_0x3084f5(this,function(){const _0x540ec7=a246_0x2eaf;return a246_0x4c53c2[_0x540ec7(0x1a3)]()['search'](_0x540ec7(0x1ae))[_0x540ec7(0x1a3)]()[_0x540ec7(0x1b1)](a246_0x4c53c2)['search'](_0x540ec7(0x1ae));});a246_0x4c53c2();'use strict';function a246_0x2eaf(_0x1d5967,_0x289749){const _0x12a273=a246_0x41be();return a246_0x2eaf=function(_0x4c53c2,_0x3084f5){_0x4c53c2=_0x4c53c2-0x184;let _0x41beea=_0x12a273[_0x4c53c2];return _0x41beea;},a246_0x2eaf(_0x1d5967,_0x289749);}var __importDefault=this&&this[a246_0x17d22d(0x188)]||function(_0x486a4c){const _0x1d4eb=a246_0x17d22d;return _0x486a4c&&_0x486a4c[_0x1d4eb(0x1ac)]?_0x486a4c:{'default':_0x486a4c};};Object[a246_0x17d22d(0x191)](exports,a246_0x17d22d(0x1ac),{'value':!![]}),exports['SendMessage']=void 0x0;const GetWhatsappWbot_1=__importDefault(require(a246_0x17d22d(0x195))),SendWhatsAppMedia_1=require(a246_0x17d22d(0x1ad)),CreateOrUpdateContactService_1=__importDefault(require('../services/ContactServices/CreateOrUpdateContactService')),FindOrCreateTicketService_1=__importDefault(require('../services/TicketServices/FindOrCreateTicketService')),CheckNumber_1=__importDefault(require(a246_0x17d22d(0x192))),SetTicketMessagesAsRead_1=__importDefault(require('../helpers/SetTicketMessagesAsRead')),Mustache_1=__importDefault(require(a246_0x17d22d(0x1b3))),wbotMessageListener_1=require(a246_0x17d22d(0x1aa)),mime_1=__importDefault(require(a246_0x17d22d(0x1a0))),CreateMessageService_1=__importDefault(require(a246_0x17d22d(0x19b))),SendPresenceStatus_1=require('./SendPresenceStatus'),SendMessage=async(_0x441446,_0x35a9db)=>{const _0x357dc9=a246_0x17d22d;try{const _0x31ebe9=await(0x0,GetWhatsappWbot_1[_0x357dc9(0x18f)])(_0x441446),_0x3e6245=_0x35a9db[_0x357dc9(0x197)],_0xa07e0f=_0x35a9db['body'],_0x5b65b4=_0x441446[_0x357dc9(0x19e)],_0x41dbfc=await(0x0,CheckNumber_1['default'])(_0x3e6245[_0x357dc9(0x1b4)](),_0x5b65b4),_0x39f8f9=_0x41dbfc[_0x357dc9(0x199)][_0x357dc9(0x1a6)](/\D/g,''),_0x4081f2={'name':''+_0x39f8f9,'number':_0x39f8f9,'isGroup':![],'companyId':_0x5b65b4},_0x506ce4=await(0x0,CreateOrUpdateContactService_1['default'])(_0x4081f2,_0x31ebe9,_0x41dbfc[_0x357dc9(0x199)]),_0x44c5bf=await(0x0,FindOrCreateTicketService_1[_0x357dc9(0x18f)])(_0x506ce4,_0x441446['id'],0x0,_0x5b65b4),_0x29dc2d=_0x44c5bf[_0x357dc9(0x186)][_0x357dc9(0x197)]+'@'+(_0x44c5bf['isGroup']?_0x357dc9(0x18d):_0x357dc9(0x19f));let _0x3bf7c7;if(_0x35a9db[_0x357dc9(0x196)]){const _0x28960a=await(0x0,SendWhatsAppMedia_1[_0x357dc9(0x185)])(_0x35a9db[_0x357dc9(0x194)],_0x35a9db['mediaPath'],_0x35a9db[_0x357dc9(0x190)],_0x5b65b4);if(_0x28960a){await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x31ebe9,_0x29dc2d,0x0,0x2710);let _0x44a3c4=_0x3bf7c7=await _0x31ebe9[_0x357dc9(0x1b6)](_0x29dc2d,{..._0x28960a});const _0x466792=mime_1['default'][_0x357dc9(0x1a4)](_0x35a9db[_0x357dc9(0x196)]),_0x266ede=await(0x0,wbotMessageListener_1[_0x357dc9(0x187)])(_0x44a3c4),_0x3234a2={'id':_0x44a3c4['key']['id'],'ticketId':_0x44c5bf['id'],'contactId':_0x44a3c4[_0x357dc9(0x1ab)][_0x357dc9(0x1a8)]?undefined:_0x506ce4['id'],'body':_0xa07e0f?(0x0,Mustache_1['default'])(_0xa07e0f,_0x44c5bf):_0x35a9db[_0x357dc9(0x194)],'fromMe':_0x44a3c4['key']['fromMe'],'read':_0x44a3c4['key'][_0x357dc9(0x1a8)],'mediaUrl':_0x35a9db[_0x357dc9(0x1a1)],'mediaType':typeof _0x466792===_0x357dc9(0x1b0)?_0x466792[_0x357dc9(0x1b5)]('/')[0x0]:_0x357dc9(0x1a7),'quotedMsgId':_0x266ede?.['id'],'ack':0x0,'remoteJid':_0x44a3c4['key'][_0x357dc9(0x18b)],'participant':_0x44a3c4[_0x357dc9(0x1ab)][_0x357dc9(0x18e)],'dataJson':JSON[_0x357dc9(0x1b8)](_0x44a3c4)};typeof _0x3234a2['body']!=_0x357dc9(0x1b0)&&console[_0x357dc9(0x1a9)](_0x357dc9(0x19c),_0x3234a2[_0x357dc9(0x190)]),await _0x44c5bf[_0x357dc9(0x19d)]({'lastMessage':_0x3234a2[_0x357dc9(0x190)]}),await(0x0,CreateMessageService_1[_0x357dc9(0x18f)])({'messageData':_0x3234a2,'ticket':_0x44c5bf,'companyId':_0x44c5bf['companyId']});}}else{const _0x4b08b8='â€Ž\x20'+_0x35a9db['body'];await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x31ebe9,_0x29dc2d);const _0x3bef9b=await _0x31ebe9['sendMessage'](_0x29dc2d,{'text':(0x0,Mustache_1[_0x357dc9(0x18f)])(_0x4b08b8,_0x44c5bf)});await(0x0,wbotMessageListener_1[_0x357dc9(0x1a2)])(_0x3bef9b,_0x44c5bf,_0x44c5bf[_0x357dc9(0x186)]);}return typeof _0xa07e0f!=_0x357dc9(0x1b0)&&console['trace'](_0x357dc9(0x19c),_0xa07e0f),await _0x44c5bf[_0x357dc9(0x19d)]({'lastMessage':_0xa07e0f}),(0x0,SetTicketMessagesAsRead_1[_0x357dc9(0x18f)])(_0x44c5bf),_0x3bf7c7;}catch(_0x423a98){throw new Error(_0x423a98);}};function a246_0x41be(){const _0x1aeb05=['trace','../services/WbotServices/wbotMessageListener','key','__esModule','../services/WbotServices/SendWhatsAppMedia','(((.+)+)+)+$','SendMessage','string','constructor','3294224VhCHKD','../helpers/Mustache','toLocaleString','split','sendMessage','516033ybmZgd','stringify','56RHefFe','getMessageOptions','contact','verifyQuotedMessage','__importDefault','799526XFZDkY','1214142mWiDwF','remoteJid','1379744COEZwD','g.us','participant','default','body','defineProperty','../services/WbotServices/CheckNumber','18hJsbnK','fileName','./GetWhatsappWbot','mediaPath','number','2NrdNNo','jid','2366250erTZIH','../services/MessageServices/CreateMessageService','body\x20is\x20not\x20a\x20string','update','companyId','s.whatsapp.net','mime','finalName','verifyMessage','toString','lookup','530785QDcEyg','replace','unknown','fromMe'];a246_0x41be=function(){return _0x1aeb05;};return a246_0x41be();}exports[a246_0x17d22d(0x1af)]=SendMessage;