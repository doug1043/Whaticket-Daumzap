const a244_0x4b5702=a244_0x2c76;(function(_0x566060,_0x4c458d){const _0x2571d6=a244_0x2c76,_0x5e3181=_0x566060();while(!![]){try{const _0x13a556=parseInt(_0x2571d6(0x79))/0x1+parseInt(_0x2571d6(0x70))/0x2+-parseInt(_0x2571d6(0x97))/0x3+-parseInt(_0x2571d6(0x96))/0x4*(-parseInt(_0x2571d6(0x9b))/0x5)+-parseInt(_0x2571d6(0x7d))/0x6+parseInt(_0x2571d6(0x7b))/0x7+parseInt(_0x2571d6(0x95))/0x8;if(_0x13a556===_0x4c458d)break;else _0x5e3181['push'](_0x5e3181['shift']());}catch(_0xf231d9){_0x5e3181['push'](_0x5e3181['shift']());}}}(a244_0x44e2,0xbefd7));const a244_0x4597f9=(function(){let _0x50879e=!![];return function(_0x1cf4a4,_0x1db309){const _0xd36d3a=_0x50879e?function(){const _0x8f6344=a244_0x2c76;if(_0x1db309){const _0x4d298a=_0x1db309[_0x8f6344(0x80)](_0x1cf4a4,arguments);return _0x1db309=null,_0x4d298a;}}:function(){};return _0x50879e=![],_0xd36d3a;};}()),a244_0x4d2677=a244_0x4597f9(this,function(){const _0x119d2a=a244_0x2c76;return a244_0x4d2677[_0x119d2a(0x87)]()[_0x119d2a(0x85)](_0x119d2a(0x98))[_0x119d2a(0x87)]()[_0x119d2a(0x7e)](a244_0x4d2677)[_0x119d2a(0x85)](_0x119d2a(0x98));});function a244_0x44e2(){const _0x389d17=['defineProperty','body\x20is\x20not\x20a\x20string','default','split','2989568ahWlAX','../services/TicketServices/FindOrCreateTicketService','verifyQuotedMessage','../services/WbotServices/wbotMessageListener','g.us','../services/WbotServices/SendWhatsAppMedia','string','body','contact','988491WFzxWz','fromMe','51975mGwcGl','stringify','9319182xIwYYu','constructor','__importDefault','apply','sendMessage','s.whatsapp.net','replace','participant','search','lookup','toString','../services/ContactServices/CreateOrUpdateContactService','number','remoteJid','SendPresenceStatus','key','mediaPath','../services/MessageServices/CreateMessageService','../helpers/SetTicketMessagesAsRead','companyId','update','toLocaleString','fileName','__esModule','5376256QYsJaK','1693584TqfQCE','3751908OyDnpY','(((.+)+)+)+$','jid','../helpers/Mustache','5trvqmB'];a244_0x44e2=function(){return _0x389d17;};return a244_0x44e2();}a244_0x4d2677();function a244_0x2c76(_0x5ba401,_0x503ba){const _0x1e98cb=a244_0x44e2();return a244_0x2c76=function(_0x4d2677,_0x4597f9){_0x4d2677=_0x4d2677-0x6d;let _0x44e266=_0x1e98cb[_0x4d2677];return _0x44e266;},a244_0x2c76(_0x5ba401,_0x503ba);}'use strict';var __importDefault=this&&this[a244_0x4b5702(0x7f)]||function(_0x1d4742){const _0x1dd80b=a244_0x4b5702;return _0x1d4742&&_0x1d4742[_0x1dd80b(0x94)]?_0x1d4742:{'default':_0x1d4742};};Object[a244_0x4b5702(0x9c)](exports,a244_0x4b5702(0x94),{'value':!![]}),exports['SendMessage']=void 0x0;const GetWhatsappWbot_1=__importDefault(require('./GetWhatsappWbot')),SendWhatsAppMedia_1=require(a244_0x4b5702(0x75)),CreateOrUpdateContactService_1=__importDefault(require(a244_0x4b5702(0x88))),FindOrCreateTicketService_1=__importDefault(require(a244_0x4b5702(0x71))),CheckNumber_1=__importDefault(require('../services/WbotServices/CheckNumber')),SetTicketMessagesAsRead_1=__importDefault(require(a244_0x4b5702(0x8f))),Mustache_1=__importDefault(require(a244_0x4b5702(0x9a))),wbotMessageListener_1=require(a244_0x4b5702(0x73)),mime_1=__importDefault(require('mime')),CreateMessageService_1=__importDefault(require(a244_0x4b5702(0x8e))),SendPresenceStatus_1=require('./SendPresenceStatus'),SendMessage=async(_0x46d9f6,_0x27a3fa)=>{const _0x30be2b=a244_0x4b5702;try{const _0xe2b0b2=await(0x0,GetWhatsappWbot_1[_0x30be2b(0x6e)])(_0x46d9f6),_0x4dc794=_0x27a3fa['number'],_0x37ec14=_0x27a3fa[_0x30be2b(0x77)],_0x44582a=_0x46d9f6[_0x30be2b(0x90)],_0xfe446b=await(0x0,CheckNumber_1[_0x30be2b(0x6e)])(_0x4dc794[_0x30be2b(0x92)](),_0x44582a),_0x3e4d7c=_0xfe446b[_0x30be2b(0x99)][_0x30be2b(0x83)](/\D/g,''),_0xbf363b={'name':''+_0x3e4d7c,'number':_0x3e4d7c,'isGroup':![],'companyId':_0x44582a},_0x297acf=await(0x0,CreateOrUpdateContactService_1[_0x30be2b(0x6e)])(_0xbf363b,_0xe2b0b2,_0xfe446b[_0x30be2b(0x99)]),_0x1153b1=await(0x0,FindOrCreateTicketService_1['default'])(_0x297acf,_0x46d9f6['id'],0x0,_0x44582a),_0x3ccb8e=_0x1153b1['contact'][_0x30be2b(0x89)]+'@'+(_0x1153b1['isGroup']?_0x30be2b(0x74):_0x30be2b(0x82));let _0x61708d;if(_0x27a3fa[_0x30be2b(0x8d)]){const _0x12bdca=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x27a3fa['fileName'],_0x27a3fa[_0x30be2b(0x8d)],_0x27a3fa['body'],_0x44582a);if(_0x12bdca){await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0xe2b0b2,_0x3ccb8e,0x0,0x2710);let _0x5069f2=_0x61708d=await _0xe2b0b2[_0x30be2b(0x81)](_0x3ccb8e,{..._0x12bdca});const _0x6755f6=mime_1['default'][_0x30be2b(0x86)](_0x27a3fa[_0x30be2b(0x8d)]),_0x5719de=await(0x0,wbotMessageListener_1[_0x30be2b(0x72)])(_0x5069f2),_0x11ef36={'id':_0x5069f2[_0x30be2b(0x8c)]['id'],'ticketId':_0x1153b1['id'],'contactId':_0x5069f2[_0x30be2b(0x8c)]['fromMe']?undefined:_0x297acf['id'],'body':_0x37ec14?(0x0,Mustache_1['default'])(_0x37ec14,_0x1153b1):_0x27a3fa[_0x30be2b(0x93)],'fromMe':_0x5069f2[_0x30be2b(0x8c)][_0x30be2b(0x7a)],'read':_0x5069f2[_0x30be2b(0x8c)][_0x30be2b(0x7a)],'mediaUrl':_0x27a3fa['finalName'],'mediaType':typeof _0x6755f6===_0x30be2b(0x76)?_0x6755f6[_0x30be2b(0x6f)]('/')[0x0]:'unknown','quotedMsgId':_0x5719de?.['id'],'ack':0x0,'remoteJid':_0x5069f2[_0x30be2b(0x8c)][_0x30be2b(0x8a)],'participant':_0x5069f2[_0x30be2b(0x8c)][_0x30be2b(0x84)],'dataJson':JSON[_0x30be2b(0x7c)](_0x5069f2)};typeof _0x11ef36[_0x30be2b(0x77)]!=_0x30be2b(0x76)&&console['trace']('body\x20is\x20not\x20a\x20string',_0x11ef36[_0x30be2b(0x77)]),await _0x1153b1[_0x30be2b(0x91)]({'lastMessage':_0x11ef36['body']}),await(0x0,CreateMessageService_1[_0x30be2b(0x6e)])({'messageData':_0x11ef36,'ticket':_0x1153b1,'companyId':_0x1153b1['companyId']});}}else{const _0xe3f0d8='â€Ž\x20'+_0x27a3fa[_0x30be2b(0x77)];await(0x0,SendPresenceStatus_1[_0x30be2b(0x8b)])(_0xe2b0b2,_0x3ccb8e);const _0x35a67b=await _0xe2b0b2[_0x30be2b(0x81)](_0x3ccb8e,{'text':(0x0,Mustache_1['default'])(_0xe3f0d8,_0x1153b1)});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x35a67b,_0x1153b1,_0x1153b1[_0x30be2b(0x78)]);}return typeof _0x37ec14!=_0x30be2b(0x76)&&console['trace'](_0x30be2b(0x6d),_0x37ec14),await _0x1153b1[_0x30be2b(0x91)]({'lastMessage':_0x37ec14}),(0x0,SetTicketMessagesAsRead_1[_0x30be2b(0x6e)])(_0x1153b1),_0x61708d;}catch(_0x3fe94e){throw new Error(_0x3fe94e);}};exports['SendMessage']=SendMessage;