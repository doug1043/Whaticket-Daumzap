const a245_0x43a28f=a245_0x3d6b;function a245_0x3d6b(_0xa038b1,_0x5977bd){const _0x29bb1a=a245_0x7a13();return a245_0x3d6b=function(_0x415c04,_0x261d32){_0x415c04=_0x415c04-0x8c;let _0x7a13b3=_0x29bb1a[_0x415c04];return _0x7a13b3;},a245_0x3d6b(_0xa038b1,_0x5977bd);}(function(_0x4cbfd1,_0xabd3ea){const _0x5ef5a4=a245_0x3d6b,_0x3b2a50=_0x4cbfd1();while(!![]){try{const _0x4f0b76=-parseInt(_0x5ef5a4(0xc1))/0x1+parseInt(_0x5ef5a4(0xbc))/0x2+-parseInt(_0x5ef5a4(0xbb))/0x3*(parseInt(_0x5ef5a4(0xc0))/0x4)+parseInt(_0x5ef5a4(0xa2))/0x5+-parseInt(_0x5ef5a4(0xae))/0x6*(parseInt(_0x5ef5a4(0x8e))/0x7)+parseInt(_0x5ef5a4(0xb6))/0x8*(-parseInt(_0x5ef5a4(0xa4))/0x9)+parseInt(_0x5ef5a4(0xb2))/0xa*(parseInt(_0x5ef5a4(0x8c))/0xb);if(_0x4f0b76===_0xabd3ea)break;else _0x3b2a50['push'](_0x3b2a50['shift']());}catch(_0x193695){_0x3b2a50['push'](_0x3b2a50['shift']());}}}(a245_0x7a13,0xbd995));const a245_0x261d32=(function(){let _0x30a19c=!![];return function(_0x3bb927,_0x556e2e){const _0x4a5f95=_0x30a19c?function(){const _0xcb63d0=a245_0x3d6b;if(_0x556e2e){const _0x5b223d=_0x556e2e[_0xcb63d0(0x9b)](_0x3bb927,arguments);return _0x556e2e=null,_0x5b223d;}}:function(){};return _0x30a19c=![],_0x4a5f95;};}()),a245_0x415c04=a245_0x261d32(this,function(){const _0xcc449c=a245_0x3d6b;return a245_0x415c04[_0xcc449c(0x91)]()[_0xcc449c(0x8d)](_0xcc449c(0x94))[_0xcc449c(0x91)]()[_0xcc449c(0xb4)](a245_0x415c04)[_0xcc449c(0x8d)](_0xcc449c(0x94));});a245_0x415c04();'use strict';var __importDefault=this&&this[a245_0x43a28f(0xa5)]||function(_0x460b90){const _0x55139d=a245_0x43a28f;return _0x460b90&&_0x460b90[_0x55139d(0x99)]?_0x460b90:{'default':_0x460b90};};Object[a245_0x43a28f(0x98)](exports,a245_0x43a28f(0x99),{'value':!![]}),exports[a245_0x43a28f(0x8f)]=void 0x0;function a245_0x7a13(){const _0x3c878f=['string','12600pCWmOW','key','body\x20is\x20not\x20a\x20string','SendPresenceStatus','trace','1855191aHRdlE','3011344GmrZiq','finalName','companyId','getMessageOptions','4foFqzn','1010742WgXraD','mime','6937887DipciK','search','49yAyjkc','SendMessage','replace','toString','fileName','update','(((.+)+)+)+$','number','verifyQuotedMessage','participant','defineProperty','__esModule','default','apply','../helpers/Mustache','../helpers/SetTicketMessagesAsRead','unknown','body','isGroup','lookup','7556995FyuSdc','../services/WbotServices/SendWhatsAppMedia','6957NftEbV','__importDefault','g.us','stringify','s.whatsapp.net','../services/MessageServices/CreateMessageService','verifyMessage','mediaPath','fromMe','jid','21066FMfcvO','../services/WbotServices/CheckNumber','sendMessage','contact','10dDZxBb','./GetWhatsappWbot','constructor'];a245_0x7a13=function(){return _0x3c878f;};return a245_0x7a13();}const GetWhatsappWbot_1=__importDefault(require(a245_0x43a28f(0xb3))),SendWhatsAppMedia_1=require(a245_0x43a28f(0xa3)),CreateOrUpdateContactService_1=__importDefault(require('../services/ContactServices/CreateOrUpdateContactService')),FindOrCreateTicketService_1=__importDefault(require('../services/TicketServices/FindOrCreateTicketService')),CheckNumber_1=__importDefault(require(a245_0x43a28f(0xaf))),SetTicketMessagesAsRead_1=__importDefault(require(a245_0x43a28f(0x9d))),Mustache_1=__importDefault(require(a245_0x43a28f(0x9c))),wbotMessageListener_1=require('../services/WbotServices/wbotMessageListener'),mime_1=__importDefault(require(a245_0x43a28f(0xc2))),CreateMessageService_1=__importDefault(require(a245_0x43a28f(0xa9))),SendPresenceStatus_1=require('./SendPresenceStatus'),SendMessage=async(_0x4da393,_0x2d545e)=>{const _0x3c8ff5=a245_0x43a28f;try{const _0x2ba4a4=await(0x0,GetWhatsappWbot_1[_0x3c8ff5(0x9a)])(_0x4da393),_0x5e2475=_0x2d545e[_0x3c8ff5(0x95)],_0xe00cec=_0x2d545e['body'],_0x392dba=_0x4da393[_0x3c8ff5(0xbe)],_0x4c5722=await(0x0,CheckNumber_1[_0x3c8ff5(0x9a)])(_0x5e2475['toLocaleString'](),_0x392dba),_0x29ec0d=_0x4c5722[_0x3c8ff5(0xad)][_0x3c8ff5(0x90)](/\D/g,''),_0x2b2d87={'name':''+_0x29ec0d,'number':_0x29ec0d,'isGroup':![],'companyId':_0x392dba},_0x1a069b=await(0x0,CreateOrUpdateContactService_1[_0x3c8ff5(0x9a)])(_0x2b2d87,_0x2ba4a4,_0x4c5722[_0x3c8ff5(0xad)]),_0x3fe2ef=await(0x0,FindOrCreateTicketService_1[_0x3c8ff5(0x9a)])(_0x1a069b,_0x4da393['id'],0x0,_0x392dba),_0x2e987b=_0x3fe2ef['contact'][_0x3c8ff5(0x95)]+'@'+(_0x3fe2ef[_0x3c8ff5(0xa0)]?_0x3c8ff5(0xa6):_0x3c8ff5(0xa8));let _0x3198b4;if(_0x2d545e['mediaPath']){const _0x4e5889=await(0x0,SendWhatsAppMedia_1[_0x3c8ff5(0xbf)])(_0x2d545e[_0x3c8ff5(0x92)],_0x2d545e[_0x3c8ff5(0xab)],_0x2d545e[_0x3c8ff5(0x9f)],_0x392dba);if(_0x4e5889){await(0x0,SendPresenceStatus_1[_0x3c8ff5(0xb9)])(_0x2ba4a4,_0x2e987b,0x0,0x2710);let _0x2b00a6=_0x3198b4=await _0x2ba4a4[_0x3c8ff5(0xb0)](_0x2e987b,{..._0x4e5889});const _0x593dca=mime_1['default'][_0x3c8ff5(0xa1)](_0x2d545e[_0x3c8ff5(0xab)]),_0x51eeb7=await(0x0,wbotMessageListener_1[_0x3c8ff5(0x96)])(_0x2b00a6),_0x5c9c60={'id':_0x2b00a6[_0x3c8ff5(0xb7)]['id'],'ticketId':_0x3fe2ef['id'],'contactId':_0x2b00a6[_0x3c8ff5(0xb7)][_0x3c8ff5(0xac)]?undefined:_0x1a069b['id'],'body':_0xe00cec?(0x0,Mustache_1[_0x3c8ff5(0x9a)])(_0xe00cec,_0x3fe2ef):_0x2d545e[_0x3c8ff5(0x92)],'fromMe':_0x2b00a6[_0x3c8ff5(0xb7)]['fromMe'],'read':_0x2b00a6['key']['fromMe'],'mediaUrl':_0x2d545e[_0x3c8ff5(0xbd)],'mediaType':typeof _0x593dca===_0x3c8ff5(0xb5)?_0x593dca['split']('/')[0x0]:_0x3c8ff5(0x9e),'quotedMsgId':_0x51eeb7?.['id'],'ack':0x0,'remoteJid':_0x2b00a6[_0x3c8ff5(0xb7)]['remoteJid'],'participant':_0x2b00a6['key'][_0x3c8ff5(0x97)],'dataJson':JSON[_0x3c8ff5(0xa7)](_0x2b00a6)};typeof _0x5c9c60['body']!='string'&&console[_0x3c8ff5(0xba)](_0x3c8ff5(0xb8),_0x5c9c60[_0x3c8ff5(0x9f)]),await _0x3fe2ef[_0x3c8ff5(0x93)]({'lastMessage':_0x5c9c60[_0x3c8ff5(0x9f)]}),await(0x0,CreateMessageService_1[_0x3c8ff5(0x9a)])({'messageData':_0x5c9c60,'ticket':_0x3fe2ef,'companyId':_0x3fe2ef['companyId']});}}else{const _0x17faa5='â€Ž\x20'+_0x2d545e[_0x3c8ff5(0x9f)];await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x2ba4a4,_0x2e987b);const _0x5aadc7=await _0x2ba4a4[_0x3c8ff5(0xb0)](_0x2e987b,{'text':(0x0,Mustache_1[_0x3c8ff5(0x9a)])(_0x17faa5,_0x3fe2ef)});await(0x0,wbotMessageListener_1[_0x3c8ff5(0xaa)])(_0x5aadc7,_0x3fe2ef,_0x3fe2ef[_0x3c8ff5(0xb1)]);}return typeof _0xe00cec!='string'&&console['trace']('body\x20is\x20not\x20a\x20string',_0xe00cec),await _0x3fe2ef[_0x3c8ff5(0x93)]({'lastMessage':_0xe00cec}),(0x0,SetTicketMessagesAsRead_1['default'])(_0x3fe2ef),_0x3198b4;}catch(_0x5dff4f){throw new Error(_0x5dff4f);}};exports[a245_0x43a28f(0x8f)]=SendMessage;