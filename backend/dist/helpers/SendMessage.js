const a244_0x30783a=a244_0x467b;(function(_0x54e890,_0x5128bf){const _0x1e2f83=a244_0x467b,_0x446592=_0x54e890();while(!![]){try{const _0x488b4a=-parseInt(_0x1e2f83(0x1a2))/0x1+parseInt(_0x1e2f83(0x192))/0x2*(parseInt(_0x1e2f83(0x17f))/0x3)+-parseInt(_0x1e2f83(0x1b3))/0x4*(-parseInt(_0x1e2f83(0x199))/0x5)+-parseInt(_0x1e2f83(0x19c))/0x6*(parseInt(_0x1e2f83(0x1b1))/0x7)+-parseInt(_0x1e2f83(0x1ae))/0x8*(parseInt(_0x1e2f83(0x189))/0x9)+parseInt(_0x1e2f83(0x186))/0xa*(parseInt(_0x1e2f83(0x1a5))/0xb)+parseInt(_0x1e2f83(0x1aa))/0xc;if(_0x488b4a===_0x5128bf)break;else _0x446592['push'](_0x446592['shift']());}catch(_0x4bebf3){_0x446592['push'](_0x446592['shift']());}}}(a244_0x510f,0x92b90));function a244_0x510f(){const _0x565cc7=['2136jOaSQp','sendMessage','mediaPath','196063pBAUQT','number','10552DeZmLm','toString','unknown','3537IwiEID','toLocaleString','__esModule','SendMessage','__importDefault','isGroup','constructor','28020dYTIAd','fromMe','../helpers/Mustache','22653jFqtIX','defineProperty','body\x20is\x20not\x20a\x20string','companyId','trace','../services/WbotServices/SendWhatsAppMedia','contact','replace','fileName','46lZWTGu','key','../helpers/SetTicketMessagesAsRead','mime','getMessageOptions','(((.+)+)+)+$','g.us','2045sQZQnx','./GetWhatsappWbot','string','174lOixiL','default','lookup','SendPresenceStatus','../services/MessageServices/CreateMessageService','split','883271oHHxGc','../services/WbotServices/wbotMessageListener','search','1892LHRrzq','participant','verifyMessage','update','stringify','16566528LFlGio','../services/WbotServices/CheckNumber','body','jid'];a244_0x510f=function(){return _0x565cc7;};return a244_0x510f();}function a244_0x467b(_0x168757,_0x399b87){const _0x33834f=a244_0x510f();return a244_0x467b=function(_0x12ed24,_0x3c5efa){_0x12ed24=_0x12ed24-0x17e;let _0x510fc1=_0x33834f[_0x12ed24];return _0x510fc1;},a244_0x467b(_0x168757,_0x399b87);}const a244_0x3c5efa=(function(){let _0x37cf9b=!![];return function(_0x37ccbc,_0x73feb0){const _0xc51aeb=_0x37cf9b?function(){if(_0x73feb0){const _0xa84486=_0x73feb0['apply'](_0x37ccbc,arguments);return _0x73feb0=null,_0xa84486;}}:function(){};return _0x37cf9b=![],_0xc51aeb;};}()),a244_0x12ed24=a244_0x3c5efa(this,function(){const _0x19bfae=a244_0x467b;return a244_0x12ed24[_0x19bfae(0x1b4)]()['search'](_0x19bfae(0x197))[_0x19bfae(0x1b4)]()[_0x19bfae(0x185)](a244_0x12ed24)[_0x19bfae(0x1a4)](_0x19bfae(0x197));});a244_0x12ed24();'use strict';var __importDefault=this&&this[a244_0x30783a(0x183)]||function(_0x23ebd0){const _0x2dfbe0=a244_0x30783a;return _0x23ebd0&&_0x23ebd0[_0x2dfbe0(0x181)]?_0x23ebd0:{'default':_0x23ebd0};};Object[a244_0x30783a(0x18a)](exports,a244_0x30783a(0x181),{'value':!![]}),exports['SendMessage']=void 0x0;const GetWhatsappWbot_1=__importDefault(require(a244_0x30783a(0x19a))),SendWhatsAppMedia_1=require(a244_0x30783a(0x18e)),CreateOrUpdateContactService_1=__importDefault(require('../services/ContactServices/CreateOrUpdateContactService')),FindOrCreateTicketService_1=__importDefault(require('../services/TicketServices/FindOrCreateTicketService')),CheckNumber_1=__importDefault(require(a244_0x30783a(0x1ab))),SetTicketMessagesAsRead_1=__importDefault(require(a244_0x30783a(0x194))),Mustache_1=__importDefault(require(a244_0x30783a(0x188))),wbotMessageListener_1=require(a244_0x30783a(0x1a3)),mime_1=__importDefault(require(a244_0x30783a(0x195))),CreateMessageService_1=__importDefault(require(a244_0x30783a(0x1a0))),SendPresenceStatus_1=require('./SendPresenceStatus'),SendMessage=async(_0x12c5f7,_0x487c06)=>{const _0x19d25c=a244_0x30783a;try{const _0x594665=await(0x0,GetWhatsappWbot_1[_0x19d25c(0x19d)])(_0x12c5f7),_0x379ab1=_0x487c06[_0x19d25c(0x1b2)],_0x3fffc3=_0x487c06[_0x19d25c(0x1ac)],_0xa5c663=_0x12c5f7[_0x19d25c(0x18c)],_0x59887a=await(0x0,CheckNumber_1[_0x19d25c(0x19d)])(_0x379ab1[_0x19d25c(0x180)](),_0xa5c663),_0x119377=_0x59887a[_0x19d25c(0x1ad)][_0x19d25c(0x190)](/\D/g,''),_0x33468c={'name':''+_0x119377,'number':_0x119377,'isGroup':![],'companyId':_0xa5c663},_0x5d81f6=await(0x0,CreateOrUpdateContactService_1[_0x19d25c(0x19d)])(_0x33468c,_0x594665,_0x59887a[_0x19d25c(0x1ad)]),_0x170141=await(0x0,FindOrCreateTicketService_1[_0x19d25c(0x19d)])(_0x5d81f6,_0x12c5f7['id'],0x0,_0xa5c663),_0x2521c8=_0x170141[_0x19d25c(0x18f)][_0x19d25c(0x1b2)]+'@'+(_0x170141[_0x19d25c(0x184)]?_0x19d25c(0x198):'s.whatsapp.net');let _0x65dff6;if(_0x487c06['mediaPath']){const _0x3e701b=await(0x0,SendWhatsAppMedia_1[_0x19d25c(0x196)])(_0x487c06[_0x19d25c(0x191)],_0x487c06[_0x19d25c(0x1b0)],_0x487c06[_0x19d25c(0x1ac)],_0xa5c663);if(_0x3e701b){await(0x0,SendPresenceStatus_1[_0x19d25c(0x19f)])(_0x594665,_0x2521c8,0x0,0x2710);let _0x180b02=_0x65dff6=await _0x594665[_0x19d25c(0x1af)](_0x2521c8,{..._0x3e701b});const _0x5ddd4a=mime_1['default'][_0x19d25c(0x19e)](_0x487c06[_0x19d25c(0x1b0)]),_0x5a5e02=await(0x0,wbotMessageListener_1['verifyQuotedMessage'])(_0x180b02),_0x4e370b={'id':_0x180b02['key']['id'],'ticketId':_0x170141['id'],'contactId':_0x180b02[_0x19d25c(0x193)][_0x19d25c(0x187)]?undefined:_0x5d81f6['id'],'body':_0x3fffc3?(0x0,Mustache_1[_0x19d25c(0x19d)])(_0x3fffc3,_0x170141):_0x487c06[_0x19d25c(0x191)],'fromMe':_0x180b02[_0x19d25c(0x193)][_0x19d25c(0x187)],'read':_0x180b02[_0x19d25c(0x193)]['fromMe'],'mediaUrl':_0x487c06['finalName'],'mediaType':typeof _0x5ddd4a==='string'?_0x5ddd4a[_0x19d25c(0x1a1)]('/')[0x0]:_0x19d25c(0x17e),'quotedMsgId':_0x5a5e02?.['id'],'ack':0x0,'remoteJid':_0x180b02['key']['remoteJid'],'participant':_0x180b02['key'][_0x19d25c(0x1a6)],'dataJson':JSON[_0x19d25c(0x1a9)](_0x180b02)};typeof _0x4e370b[_0x19d25c(0x1ac)]!='string'&&console[_0x19d25c(0x18d)]('body\x20is\x20not\x20a\x20string',_0x4e370b['body']),await _0x170141['update']({'lastMessage':_0x4e370b['body']}),await(0x0,CreateMessageService_1[_0x19d25c(0x19d)])({'messageData':_0x4e370b,'ticket':_0x170141,'companyId':_0x170141[_0x19d25c(0x18c)]});}}else{const _0x1c776e='â€Ž\x20'+_0x487c06[_0x19d25c(0x1ac)];await(0x0,SendPresenceStatus_1[_0x19d25c(0x19f)])(_0x594665,_0x2521c8);const _0xa12958=await _0x594665[_0x19d25c(0x1af)](_0x2521c8,{'text':(0x0,Mustache_1[_0x19d25c(0x19d)])(_0x1c776e,_0x170141)});await(0x0,wbotMessageListener_1[_0x19d25c(0x1a7)])(_0xa12958,_0x170141,_0x170141[_0x19d25c(0x18f)]);}return typeof _0x3fffc3!=_0x19d25c(0x19b)&&console[_0x19d25c(0x18d)](_0x19d25c(0x18b),_0x3fffc3),await _0x170141[_0x19d25c(0x1a8)]({'lastMessage':_0x3fffc3}),(0x0,SetTicketMessagesAsRead_1['default'])(_0x170141),_0x65dff6;}catch(_0x438753){throw new Error(_0x438753);}};exports[a244_0x30783a(0x182)]=SendMessage;