const a476_0x371565=a476_0x32cb;(function(_0x49a9ab,_0x2b978c){const _0x48fb37=a476_0x32cb,_0x58f3fc=_0x49a9ab();while(!![]){try{const _0x1ea38a=parseInt(_0x48fb37(0x123))/0x1+parseInt(_0x48fb37(0x116))/0x2*(parseInt(_0x48fb37(0x104))/0x3)+-parseInt(_0x48fb37(0x112))/0x4*(parseInt(_0x48fb37(0x10a))/0x5)+parseInt(_0x48fb37(0x11b))/0x6+parseInt(_0x48fb37(0x11c))/0x7*(parseInt(_0x48fb37(0x11a))/0x8)+parseInt(_0x48fb37(0x106))/0x9+-parseInt(_0x48fb37(0x107))/0xa;if(_0x1ea38a===_0x2b978c)break;else _0x58f3fc['push'](_0x58f3fc['shift']());}catch(_0xd86822){_0x58f3fc['push'](_0x58f3fc['shift']());}}}(a476_0x4dca,0x642e3));const a476_0x14fb2d=(function(){let _0x5a4491=!![];return function(_0xdb38d0,_0x4762e7){const _0xdb57f0=_0x5a4491?function(){const _0x5eadfe=a476_0x32cb;if(_0x4762e7){const _0x4a931c=_0x4762e7[_0x5eadfe(0x118)](_0xdb38d0,arguments);return _0x4762e7=null,_0x4a931c;}}:function(){};return _0x5a4491=![],_0xdb57f0;};}()),a476_0xa87110=a476_0x14fb2d(this,function(){const _0x3d1103=a476_0x32cb;return a476_0xa87110['toString']()[_0x3d1103(0x10c)](_0x3d1103(0x111))['toString']()['constructor'](a476_0xa87110)[_0x3d1103(0x10c)](_0x3d1103(0x111));});function a476_0x32cb(_0x22c46e,_0x11ba82){const _0x429042=a476_0x4dca();return a476_0x32cb=function(_0xa87110,_0x14fb2d){_0xa87110=_0xa87110-0xfc;let _0x4dca28=_0x429042[_0xa87110];return _0x4dca28;},a476_0x32cb(_0x22c46e,_0x11ba82);}a476_0xa87110();'use strict';function a476_0x4dca(){const _0x3a4225=['number','__esModule','whatsapp','../../libs/wbot','(((.+)+)+)+$','30508KkXywP','contact','dataJson','ticket','20PwxzgE','channel','apply','../../utils/logger','110512XdFqod','2312346OdRxwM','238WJKSQX','logger','isGroup','error','__importDefault','getWbot','ERR_CREATING_TICKET','495939yMNwYS','mediaUrl','ERR_SENDING_WAPP_MSG','../../helpers/GetDefaultWhatsApp','companyId','sendMessage','../WbotServices/VerifyHandlers','ERR_NO_DEF_WAPP_FOUND','userId','parse','96708gPPlgY','../../errors/AppError','4181751CjCzoQ','9878470mMaXQz','ERR_OTHER_OPEN_TICKET','default','485vvMnjR','../../helpers/CheckContactOpenTickets','search'];a476_0x4dca=function(){return _0x3a4225;};return a476_0x4dca();}var __importDefault=this&&this[a476_0x371565(0x120)]||function(_0xa33510){const _0x27999d=a476_0x371565;return _0xa33510&&_0xa33510[_0x27999d(0x10e)]?_0xa33510:{'default':_0xa33510};};Object['defineProperty'](exports,a476_0x371565(0x10e),{'value':!![]});const logger_1=require(a476_0x371565(0x119)),GetDefaultWhatsApp_1=__importDefault(require(a476_0x371565(0xfd))),AppError_1=__importDefault(require(a476_0x371565(0x105))),wbot_1=require(a476_0x371565(0x110)),VerifyHandlers_1=require(a476_0x371565(0x100)),CheckContactOpenTickets_1=__importDefault(require(a476_0x371565(0x10b))),CreateTicketService_1=__importDefault(require('../TicketServices/CreateTicketService')),ForwardMessageService=async(_0x4c363b,_0x6f9b3,_0xb89807,_0x417fb7)=>{const _0x4601df=a476_0x371565,_0x1c1940=_0x6f9b3[_0x4601df(0x115)]['whatsapp']||await(0x0,GetDefaultWhatsApp_1[_0x4601df(0x109)])(_0xb89807[_0x4601df(0xfe)]);if(!_0x1c1940)throw new AppError_1[(_0x4601df(0x109))](_0x4601df(0x101),0x194);if(_0x1c1940[_0x4601df(0x117)]!==_0x4601df(0x10f))throw new AppError_1[(_0x4601df(0x109))]('ERR_INVALID_CHANNEL',0x190);let _0x206092=await(0x0,CheckContactOpenTickets_1['default'])(_0xb89807['id'],_0x1c1940['id'],!![]);if(_0x206092&&_0x206092[_0x4601df(0x102)]!==_0x4c363b['id'])throw new AppError_1['default'](_0x4601df(0x108),0x190);!_0x206092&&(_0x206092=await(0x0,CreateTicketService_1[_0x4601df(0x109)])({'contactId':_0xb89807['id'],'userId':_0x4c363b['id'],'companyId':_0xb89807[_0x4601df(0xfe)],'queueId':_0x417fb7?.['id']}));if(!_0x206092)throw new AppError_1['default'](_0x4601df(0x122),0x1f4);if(_0x1c1940['channel']===_0x4601df(0x10f))try{const _0x455012=(0x0,wbot_1[_0x4601df(0x121)])(_0x1c1940['id']),_0x5cb4f8=JSON[_0x4601df(0x103)](_0x6f9b3[_0x4601df(0x114)]),_0x391618=_0xb89807[_0x4601df(0x11e)]?_0xb89807[_0x4601df(0x10d)]+'@g.us':_0xb89807[_0x4601df(0x10d)]+'@s.whatsapp.net',_0x47803a=await _0x455012[_0x4601df(0xff)](_0x391618,{'forward':_0x5cb4f8}),_0x1ce2a7=_0x6f9b3[_0x4601df(0x124)]?await(0x0,VerifyHandlers_1['verifyMediaMessage'])(_0x47803a,_0x206092,_0x206092[_0x4601df(0x113)],_0x455012,null,_0x4c363b['id']):await(0x0,VerifyHandlers_1['verifyMessage'])(_0x47803a,_0x206092,_0x206092[_0x4601df(0x113)],_0x4c363b['id']);return _0x1ce2a7;}catch(_0x5634b4){logger_1[_0x4601df(0x11d)][_0x4601df(0x11f)](_0x5634b4);throw new AppError_1[(_0x4601df(0x109))](_0x4601df(0xfc),0x1f4);}return null;};exports[a476_0x371565(0x109)]=ForwardMessageService;