const a476_0x499245=a476_0x380b;function a476_0x380b(_0x896b2,_0x54e4ec){const _0x43fc20=a476_0x1a01();return a476_0x380b=function(_0x34a7ef,_0x4389ef){_0x34a7ef=_0x34a7ef-0xd9;let _0x1a0110=_0x43fc20[_0x34a7ef];return _0x1a0110;},a476_0x380b(_0x896b2,_0x54e4ec);}(function(_0x36c930,_0x36c0f8){const _0x2114ae=a476_0x380b,_0x29fdb4=_0x36c930();while(!![]){try{const _0xbad13=parseInt(_0x2114ae(0xfb))/0x1*(-parseInt(_0x2114ae(0xdb))/0x2)+parseInt(_0x2114ae(0xe0))/0x3*(-parseInt(_0x2114ae(0xdc))/0x4)+-parseInt(_0x2114ae(0x103))/0x5*(parseInt(_0x2114ae(0xff))/0x6)+-parseInt(_0x2114ae(0xf8))/0x7+-parseInt(_0x2114ae(0xf1))/0x8+parseInt(_0x2114ae(0xdf))/0x9+-parseInt(_0x2114ae(0xe3))/0xa*(-parseInt(_0x2114ae(0xef))/0xb);if(_0xbad13===_0x36c0f8)break;else _0x29fdb4['push'](_0x29fdb4['shift']());}catch(_0xbe7728){_0x29fdb4['push'](_0x29fdb4['shift']());}}}(a476_0x1a01,0x7fee7));const a476_0x4389ef=(function(){let _0x36653b=!![];return function(_0x2c26d5,_0xa043d1){const _0x190216=_0x36653b?function(){const _0x3e44b6=a476_0x380b;if(_0xa043d1){const _0x2dbc77=_0xa043d1[_0x3e44b6(0xf3)](_0x2c26d5,arguments);return _0xa043d1=null,_0x2dbc77;}}:function(){};return _0x36653b=![],_0x190216;};}()),a476_0x34a7ef=a476_0x4389ef(this,function(){const _0x4574cd=a476_0x380b;return a476_0x34a7ef[_0x4574cd(0xfa)]()[_0x4574cd(0xfe)](_0x4574cd(0x104))[_0x4574cd(0xfa)]()[_0x4574cd(0xe7)](a476_0x34a7ef)[_0x4574cd(0xfe)](_0x4574cd(0x104));});a476_0x34a7ef();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x29da5d){const _0x2ed491=a476_0x380b;return _0x29da5d&&_0x29da5d[_0x2ed491(0xe8)]?_0x29da5d:{'default':_0x29da5d};};Object['defineProperty'](exports,a476_0x499245(0xe8),{'value':!![]});const socket_1=require(a476_0x499245(0xe6)),Message_1=__importDefault(require(a476_0x499245(0xea))),OldMessage_1=__importDefault(require(a476_0x499245(0xf5))),Ticket_1=__importDefault(require('../../models/Ticket')),Whatsapp_1=__importDefault(require(a476_0x499245(0xe4))),logger_1=require(a476_0x499245(0x100)),CreateMessageService=async({messageData:_0x328488,companyId:_0x4147c6})=>{const _0x7dd7de=a476_0x499245;await Message_1[_0x7dd7de(0xee)]['upsert']({..._0x328488,'companyId':_0x4147c6});const _0x2a9571=await Message_1[_0x7dd7de(0xee)][_0x7dd7de(0xf9)]({'where':{'id':_0x328488['id'],'ticketId':_0x328488[_0x7dd7de(0xd9)]},'include':[_0x7dd7de(0xe1),{'model':Ticket_1['default'],'as':_0x7dd7de(0xde),'include':[_0x7dd7de(0xe1),_0x7dd7de(0x102),{'model':Whatsapp_1[_0x7dd7de(0xee)],'as':_0x7dd7de(0xfc),'attributes':['name','id']}]},{'model':Message_1[_0x7dd7de(0xee)],'as':_0x7dd7de(0xfd),'include':[_0x7dd7de(0xe1)],'where':{'companyId':_0x4147c6},'required':![]},{'model':OldMessage_1[_0x7dd7de(0xee)],'as':_0x7dd7de(0xf0),'where':{'ticketId':_0x328488[_0x7dd7de(0xd9)]},'required':![]}]});await _0x2a9571[_0x7dd7de(0xde)][_0x7dd7de(0xe1)]['update']({'presence':'available'}),await _0x2a9571[_0x7dd7de(0xde)][_0x7dd7de(0xe1)][_0x7dd7de(0xdd)]();_0x2a9571[_0x7dd7de(0xde)][_0x7dd7de(0x101)]!==null&&_0x2a9571[_0x7dd7de(0x101)]===null&&await _0x2a9571[_0x7dd7de(0xe9)]({'queueId':_0x2a9571[_0x7dd7de(0xde)]['queueId']});if(!_0x2a9571)throw new Error(_0x7dd7de(0xed));const _0x5e4876=(0x0,socket_1[_0x7dd7de(0xda)])();return _0x5e4876['to'](_0x2a9571['ticketId'][_0x7dd7de(0xfa)]())['to'](_0x7dd7de(0xec)+_0x4147c6+'-'+_0x2a9571[_0x7dd7de(0xde)][_0x7dd7de(0xf2)])['to'](_0x7dd7de(0xec)+_0x4147c6+_0x7dd7de(0xeb))['to']('queue-'+_0x2a9571['ticket'][_0x7dd7de(0x101)]+'-'+_0x2a9571[_0x7dd7de(0xde)]['status'])['to']('queue-'+_0x2a9571[_0x7dd7de(0xde)][_0x7dd7de(0x101)]+_0x7dd7de(0xeb))[_0x7dd7de(0xe2)](_0x7dd7de(0xec)+_0x4147c6+_0x7dd7de(0xf6),{'action':'create','message':_0x2a9571,'ticket':_0x2a9571[_0x7dd7de(0xde)],'contact':_0x2a9571['ticket']['contact']}),_0x5e4876['to']('company-'+_0x4147c6+_0x7dd7de(0xf7))[_0x7dd7de(0xe2)](_0x7dd7de(0xec)+_0x4147c6+_0x7dd7de(0xf4),{'action':'update','contact':_0x2a9571[_0x7dd7de(0xde)]['contact']}),logger_1['logger'][_0x7dd7de(0xe5)]({'company':_0x4147c6,'ticket':_0x2a9571[_0x7dd7de(0xd9)],'queue':_0x2a9571['ticket'][_0x7dd7de(0x101)],'status':_0x2a9571['ticket']['status']},'sending\x20create\x20message\x20to\x20clients'),_0x2a9571;};exports[a476_0x499245(0xee)]=CreateMessageService;function a476_0x1a01(){const _0x152f5f=['constructor','__esModule','update','../../models/Message','-notification','company-','ERR_CREATING_MESSAGE','default','2964071DAtczR','oldMessages','4944672wiwWuR','status','apply','-contact','../../models/OldMessage','-appMessage','-mainchannel','5361160BcqFSR','findOne','toString','87546SuAJyS','whatsapp','quotedMsg','search','426960nYRqfk','../../utils/logger','queueId','queue','5kfibRp','(((.+)+)+)+$','ticketId','getIO','18tcnQZd','824pdhGxq','reload','ticket','9061659lrAQNH','13608cejNqF','contact','emit','100hSGVWm','../../models/Whatsapp','debug','../../libs/socket'];a476_0x1a01=function(){return _0x152f5f;};return a476_0x1a01();}