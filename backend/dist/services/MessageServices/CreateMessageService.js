const a581_0x32a816=a581_0x3854;(function(_0x344a49,_0xeb4489){const _0x28cdf3=a581_0x3854,_0x41c081=_0x344a49();while(!![]){try{const _0x1229ae=parseInt(_0x28cdf3(0xf7))/0x1+parseInt(_0x28cdf3(0x114))/0x2*(-parseInt(_0x28cdf3(0x118))/0x3)+parseInt(_0x28cdf3(0x121))/0x4+-parseInt(_0x28cdf3(0x117))/0x5*(-parseInt(_0x28cdf3(0x112))/0x6)+-parseInt(_0x28cdf3(0xfb))/0x7+-parseInt(_0x28cdf3(0x11c))/0x8+parseInt(_0x28cdf3(0x11e))/0x9*(-parseInt(_0x28cdf3(0x10c))/0xa);if(_0x1229ae===_0xeb4489)break;else _0x41c081['push'](_0x41c081['shift']());}catch(_0x99b9d7){_0x41c081['push'](_0x41c081['shift']());}}}(a581_0x4400,0x34987));const a581_0x3d60f5=(function(){let _0x40c33f=!![];return function(_0xab1498,_0x16908d){const _0x1bb4ee=_0x40c33f?function(){const _0xbda8a1=a581_0x3854;if(_0x16908d){const _0x5b9c91=_0x16908d[_0xbda8a1(0x10f)](_0xab1498,arguments);return _0x16908d=null,_0x5b9c91;}}:function(){};return _0x40c33f=![],_0x1bb4ee;};}()),a581_0x4db117=a581_0x3d60f5(this,function(){const _0x4aa40e=a581_0x3854;return a581_0x4db117[_0x4aa40e(0xf9)]()['search']('(((.+)+)+)+$')[_0x4aa40e(0xf9)]()[_0x4aa40e(0x10d)](a581_0x4db117)['search'](_0x4aa40e(0x103));});function a581_0x3854(_0x152929,_0x5b82e1){const _0x48bf46=a581_0x4400();return a581_0x3854=function(_0x4db117,_0x3d60f5){_0x4db117=_0x4db117-0xf7;let _0x4400ca=_0x48bf46[_0x4db117];return _0x4400ca;},a581_0x3854(_0x152929,_0x5b82e1);}a581_0x4db117();'use strict';var __importDefault=this&&this[a581_0x32a816(0x102)]||function(_0x2cde81){const _0x3c7b70=a581_0x32a816;return _0x2cde81&&_0x2cde81[_0x3c7b70(0xff)]?_0x2cde81:{'default':_0x2cde81};};function a581_0x4400(){const _0x35dfe6=['4608VgwaQk','upsert','8wfOOxI','../../models/OldMessage','reload','45FsXjuc','3279GSKDsk','name','defineProperty','-contact','1986632JfMCHF','create','6714mOoYWK','contact','sending\x20create\x20message\x20to\x20clients','1586492bUvKRr','179068xdStvg','-appMessage','toString','logger','623749RoDsuO','queue','ticket','queueId','__esModule','-mainchannel','-notification','__importDefault','(((.+)+)+)+$','getIO','findOne','emit','update','../../models/Ticket','status','../../models/Whatsapp','whatsapp','340AZarrj','constructor','default','apply','oldMessages','ticketId'];a581_0x4400=function(){return _0x35dfe6;};return a581_0x4400();}Object[a581_0x32a816(0x11a)](exports,a581_0x32a816(0xff),{'value':!![]});const socket_1=require('../../libs/socket'),Message_1=__importDefault(require('../../models/Message')),OldMessage_1=__importDefault(require(a581_0x32a816(0x115))),Ticket_1=__importDefault(require(a581_0x32a816(0x108))),Whatsapp_1=__importDefault(require(a581_0x32a816(0x10a))),logger_1=require('../../utils/logger'),CreateMessageService=async({messageData:_0x17ff32,companyId:_0x19b4b4})=>{const _0x53f6cc=a581_0x32a816;await Message_1['default'][_0x53f6cc(0x113)]({..._0x17ff32,'companyId':_0x19b4b4});const _0x4e266a=await Message_1[_0x53f6cc(0x10e)][_0x53f6cc(0x105)]({'where':{'id':_0x17ff32['id'],'ticketId':_0x17ff32[_0x53f6cc(0x111)]},'include':[_0x53f6cc(0x11f),{'model':Ticket_1[_0x53f6cc(0x10e)],'as':_0x53f6cc(0xfd),'include':[_0x53f6cc(0x11f),_0x53f6cc(0xfc),{'model':Whatsapp_1[_0x53f6cc(0x10e)],'as':_0x53f6cc(0x10b),'attributes':[_0x53f6cc(0x119),'id']}]},{'model':Message_1[_0x53f6cc(0x10e)],'as':'quotedMsg','include':[_0x53f6cc(0x11f)],'where':{'companyId':_0x19b4b4},'required':![]},{'model':OldMessage_1[_0x53f6cc(0x10e)],'as':_0x53f6cc(0x110),'where':{'ticketId':_0x17ff32[_0x53f6cc(0x111)]},'required':![]}]});await _0x4e266a[_0x53f6cc(0xfd)]['contact'][_0x53f6cc(0x107)]({'presence':'available'}),await _0x4e266a['ticket']['contact'][_0x53f6cc(0x116)]();_0x4e266a[_0x53f6cc(0xfd)][_0x53f6cc(0xfe)]!==null&&_0x4e266a[_0x53f6cc(0xfe)]===null&&await _0x4e266a['update']({'queueId':_0x4e266a['ticket'][_0x53f6cc(0xfe)]});if(!_0x4e266a)throw new Error('ERR_CREATING_MESSAGE');const _0x3e4abb=(0x0,socket_1[_0x53f6cc(0x104)])();return _0x3e4abb['to'](_0x4e266a[_0x53f6cc(0x111)][_0x53f6cc(0xf9)]())['to']('company-'+_0x19b4b4+'-'+_0x4e266a[_0x53f6cc(0xfd)][_0x53f6cc(0x109)])['to']('company-'+_0x19b4b4+_0x53f6cc(0x101))['to']('queue-'+_0x4e266a[_0x53f6cc(0xfd)]['queueId']+'-'+_0x4e266a['ticket'][_0x53f6cc(0x109)])['to']('queue-'+_0x4e266a[_0x53f6cc(0xfd)][_0x53f6cc(0xfe)]+_0x53f6cc(0x101))['emit']('company-'+_0x19b4b4+_0x53f6cc(0xf8),{'action':_0x53f6cc(0x11d),'message':_0x4e266a,'ticket':_0x4e266a[_0x53f6cc(0xfd)],'contact':_0x4e266a[_0x53f6cc(0xfd)][_0x53f6cc(0x11f)]}),_0x3e4abb['to']('company-'+_0x19b4b4+_0x53f6cc(0x100))[_0x53f6cc(0x106)]('company-'+_0x19b4b4+_0x53f6cc(0x11b),{'action':_0x53f6cc(0x107),'contact':_0x4e266a[_0x53f6cc(0xfd)][_0x53f6cc(0x11f)]}),logger_1[_0x53f6cc(0xfa)]['debug']({'company':_0x19b4b4,'ticket':_0x4e266a[_0x53f6cc(0x111)],'queue':_0x4e266a['ticket'][_0x53f6cc(0xfe)],'status':_0x4e266a[_0x53f6cc(0xfd)][_0x53f6cc(0x109)]},_0x53f6cc(0x120)),_0x4e266a;};exports[a581_0x32a816(0x10e)]=CreateMessageService;