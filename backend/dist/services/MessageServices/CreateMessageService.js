const a446_0x3f8291=a446_0x4a00;(function(_0x2c2260,_0x58756f){const _0x15ea08=a446_0x4a00,_0x2cf036=_0x2c2260();while(!![]){try{const _0x4f9dd8=-parseInt(_0x15ea08(0x1e1))/0x1*(parseInt(_0x15ea08(0x1e7))/0x2)+-parseInt(_0x15ea08(0x1ed))/0x3+parseInt(_0x15ea08(0x1d9))/0x4*(-parseInt(_0x15ea08(0x1e2))/0x5)+-parseInt(_0x15ea08(0x1df))/0x6+parseInt(_0x15ea08(0x1dc))/0x7+-parseInt(_0x15ea08(0x1f3))/0x8*(parseInt(_0x15ea08(0x1e9))/0x9)+-parseInt(_0x15ea08(0x1d7))/0xa*(-parseInt(_0x15ea08(0x1ea))/0xb);if(_0x4f9dd8===_0x58756f)break;else _0x2cf036['push'](_0x2cf036['shift']());}catch(_0x5ca8b4){_0x2cf036['push'](_0x2cf036['shift']());}}}(a446_0x10ab,0x2e897));function a446_0x4a00(_0xbe8703,_0x23fec2){const _0x1dac32=a446_0x10ab();return a446_0x4a00=function(_0x378611,_0x56b370){_0x378611=_0x378611-0x1d2;let _0x10ab96=_0x1dac32[_0x378611];return _0x10ab96;},a446_0x4a00(_0xbe8703,_0x23fec2);}const a446_0x56b370=(function(){let _0xaf7968=!![];return function(_0x74a4f9,_0x30b7fc){const _0x1bf2b7=_0xaf7968?function(){const _0x18098e=a446_0x4a00;if(_0x30b7fc){const _0x44400d=_0x30b7fc[_0x18098e(0x1db)](_0x74a4f9,arguments);return _0x30b7fc=null,_0x44400d;}}:function(){};return _0xaf7968=![],_0x1bf2b7;};}()),a446_0x378611=a446_0x56b370(this,function(){const _0x2ec1bb=a446_0x4a00;return a446_0x378611[_0x2ec1bb(0x1eb)]()[_0x2ec1bb(0x1f6)]('(((.+)+)+)+$')['toString']()[_0x2ec1bb(0x1de)](a446_0x378611)['search'](_0x2ec1bb(0x1ef));});function a446_0x10ab(){const _0x2b4fcb=['26460fJmrtA','quotedMsg','(((.+)+)+)+$','update','emit','findByPk','32YtRVqx','ERR_CREATING_MESSAGE','company-','search','-appMessage','status','defineProperty','__esModule','default','__importDefault','queue-','4133150NQKFUp','../../models/OldMessage','76cSnbpa','queueId','apply','285460qcmvBk','../../models/Ticket','constructor','520704eUgTTZ','ticket','1243fcjzjZ','26815TQPckw','create','../../models/Message','contact','queue','252IOvCzD','-notification','726021qoaNsy','22iCKxow','toString','ticketId'];a446_0x10ab=function(){return _0x2b4fcb;};return a446_0x10ab();}a446_0x378611();'use strict';var __importDefault=this&&this[a446_0x3f8291(0x1d5)]||function(_0x2203e6){return _0x2203e6&&_0x2203e6['__esModule']?_0x2203e6:{'default':_0x2203e6};};Object[a446_0x3f8291(0x1d2)](exports,a446_0x3f8291(0x1d3),{'value':!![]});const socket_1=require('../../libs/socket'),Message_1=__importDefault(require(a446_0x3f8291(0x1e4))),Ticket_1=__importDefault(require(a446_0x3f8291(0x1dd))),OldMessage_1=__importDefault(require(a446_0x3f8291(0x1d8))),CreateMessageService=async({messageData:_0x125e7d,ticket:_0x1c5e65,companyId:_0x445c64})=>{const _0x4a8e44=a446_0x3f8291;await Message_1['default']['upsert']({..._0x125e7d,'companyId':_0x445c64});const _0x206093=await Message_1[_0x4a8e44(0x1d4)][_0x4a8e44(0x1f2)](_0x125e7d['id'],{'include':[_0x4a8e44(0x1e5),{'model':Ticket_1[_0x4a8e44(0x1d4)],'as':_0x4a8e44(0x1e0),'include':['contact',_0x4a8e44(0x1e6),'whatsapp']},{'model':Message_1['default'],'as':_0x4a8e44(0x1ee),'include':[_0x4a8e44(0x1e5)]},{'model':OldMessage_1[_0x4a8e44(0x1d4)],'as':'oldMessages'}]});if(_0x1c5e65['contact'])await _0x1c5e65[_0x4a8e44(0x1e5)][_0x4a8e44(0x1f0)]({'presence':'available'}),await _0x1c5e65[_0x4a8e44(0x1e5)]['reload'](),_0x1c5e65[_0x4a8e44(0x1da)]!==null&&_0x206093[_0x4a8e44(0x1da)]===null&&await _0x206093[_0x4a8e44(0x1f0)]({'queueId':_0x1c5e65[_0x4a8e44(0x1da)]});else throw new Error(_0x4a8e44(0x1f4));if(!_0x206093)throw new Error(_0x4a8e44(0x1f4));const _0xc40140=(0x0,socket_1['getIO'])();return _0xc40140['to'](_0x206093[_0x4a8e44(0x1ec)]['toString']())['to']('company-'+_0x445c64+'-'+_0x1c5e65[_0x4a8e44(0x1f8)])['to'](_0x4a8e44(0x1f5)+_0x445c64+_0x4a8e44(0x1e8))['to'](_0x4a8e44(0x1d6)+_0x206093['queueId']+'-notification')['to'](_0x4a8e44(0x1d6)+_0x206093[_0x4a8e44(0x1da)]+'-'+_0x1c5e65['status'])[_0x4a8e44(0x1f1)](_0x4a8e44(0x1f5)+_0x445c64+_0x4a8e44(0x1f7),{'action':_0x4a8e44(0x1e3),'message':_0x206093,'ticket':_0x1c5e65,'contact':_0x1c5e65[_0x4a8e44(0x1e5)]}),_0xc40140['to']('company-'+_0x445c64+'-mainchannel')['emit']('company-'+_0x445c64+'-contact',{'action':_0x4a8e44(0x1f0),'contact':_0x1c5e65['contact']}),_0x206093;};exports[a446_0x3f8291(0x1d4)]=CreateMessageService;