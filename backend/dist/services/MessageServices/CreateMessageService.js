const a447_0x5b94e4=a447_0x4333;function a447_0x4333(_0x1fb5c4,_0x2ee695){const _0x509f15=a447_0x3cc3();return a447_0x4333=function(_0x1b61cf,_0x505073){_0x1b61cf=_0x1b61cf-0x131;let _0x3cc333=_0x509f15[_0x1b61cf];return _0x3cc333;},a447_0x4333(_0x1fb5c4,_0x2ee695);}(function(_0x4ba9cb,_0x4aeb24){const _0x1cd2b=a447_0x4333,_0x4db2ac=_0x4ba9cb();while(!![]){try{const _0x528435=parseInt(_0x1cd2b(0x143))/0x1*(parseInt(_0x1cd2b(0x152))/0x2)+-parseInt(_0x1cd2b(0x14a))/0x3*(-parseInt(_0x1cd2b(0x154))/0x4)+parseInt(_0x1cd2b(0x135))/0x5+parseInt(_0x1cd2b(0x138))/0x6+-parseInt(_0x1cd2b(0x131))/0x7*(parseInt(_0x1cd2b(0x158))/0x8)+parseInt(_0x1cd2b(0x139))/0x9*(parseInt(_0x1cd2b(0x13a))/0xa)+-parseInt(_0x1cd2b(0x140))/0xb*(parseInt(_0x1cd2b(0x157))/0xc);if(_0x528435===_0x4aeb24)break;else _0x4db2ac['push'](_0x4db2ac['shift']());}catch(_0x55d80b){_0x4db2ac['push'](_0x4db2ac['shift']());}}}(a447_0x3cc3,0xd2840));const a447_0x505073=(function(){let _0x43a58f=!![];return function(_0x463a3a,_0x3fa88f){const _0x30aea4=_0x43a58f?function(){const _0x51c4cf=a447_0x4333;if(_0x3fa88f){const _0x4ddddd=_0x3fa88f[_0x51c4cf(0x153)](_0x463a3a,arguments);return _0x3fa88f=null,_0x4ddddd;}}:function(){};return _0x43a58f=![],_0x30aea4;};}()),a447_0x1b61cf=a447_0x505073(this,function(){const _0x5bf016=a447_0x4333;return a447_0x1b61cf[_0x5bf016(0x132)]()[_0x5bf016(0x137)](_0x5bf016(0x13b))[_0x5bf016(0x132)]()[_0x5bf016(0x13f)](a447_0x1b61cf)[_0x5bf016(0x137)](_0x5bf016(0x13b));});a447_0x1b61cf();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x26d210){return _0x26d210&&_0x26d210['__esModule']?_0x26d210:{'default':_0x26d210};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const socket_1=require(a447_0x5b94e4(0x156)),Message_1=__importDefault(require(a447_0x5b94e4(0x14c))),Ticket_1=__importDefault(require(a447_0x5b94e4(0x155))),OldMessage_1=__importDefault(require(a447_0x5b94e4(0x149))),CreateMessageService=async({messageData:_0x56cbae,ticket:_0x96cd99,companyId:_0x4c53bd})=>{const _0x4383f6=a447_0x5b94e4;await Message_1['default']['upsert']({..._0x56cbae,'companyId':_0x4c53bd});const _0xc219d8=await Message_1[_0x4383f6(0x144)][_0x4383f6(0x141)](_0x56cbae['id'],{'include':[_0x4383f6(0x145),{'model':Ticket_1[_0x4383f6(0x144)],'as':_0x4383f6(0x151),'include':['contact',_0x4383f6(0x14e),_0x4383f6(0x146)]},{'model':Message_1[_0x4383f6(0x144)],'as':_0x4383f6(0x134),'include':['contact']},{'model':OldMessage_1[_0x4383f6(0x144)],'as':'oldMessages'}]});if(_0x96cd99[_0x4383f6(0x145)])await _0x96cd99[_0x4383f6(0x145)]['update']({'presence':'available'}),await _0x96cd99['contact'][_0x4383f6(0x142)](),_0x96cd99[_0x4383f6(0x14d)]!==null&&_0xc219d8[_0x4383f6(0x14d)]===null&&await _0xc219d8[_0x4383f6(0x159)]({'queueId':_0x96cd99[_0x4383f6(0x14d)]});else throw new Error('ERR_CREATING_MESSAGE');if(!_0xc219d8)throw new Error('ERR_CREATING_MESSAGE');const _0x290407=(0x0,socket_1[_0x4383f6(0x13c)])();return _0x290407['to'](_0xc219d8[_0x4383f6(0x14f)][_0x4383f6(0x132)]())['to'](_0x4383f6(0x14b)+_0x4c53bd+'-'+_0x96cd99[_0x4383f6(0x13e)])['to'](_0x4383f6(0x14b)+_0x4c53bd+_0x4383f6(0x150))['to']('queue-'+_0xc219d8[_0x4383f6(0x14d)]+_0x4383f6(0x150))['to'](_0x4383f6(0x133)+_0xc219d8[_0x4383f6(0x14d)]+'-'+_0x96cd99['status'])[_0x4383f6(0x136)](_0x4383f6(0x14b)+_0x4c53bd+_0x4383f6(0x148),{'action':_0x4383f6(0x147),'message':_0xc219d8,'ticket':_0x96cd99,'contact':_0x96cd99[_0x4383f6(0x145)]}),_0x290407['to'](_0x4383f6(0x14b)+_0x4c53bd+_0x4383f6(0x13d))[_0x4383f6(0x136)](_0x4383f6(0x14b)+_0x4c53bd+'-contact',{'action':'update','contact':_0x96cd99[_0x4383f6(0x145)]}),_0xc219d8;};exports[a447_0x5b94e4(0x144)]=CreateMessageService;function a447_0x3cc3(){const _0x2aa11f=['ticketId','-notification','ticket','34MpxHCZ','apply','532232krEKEx','../../models/Ticket','../../libs/socket','20801436mjgWbX','8jAAzao','update','9588607YBlQzO','toString','queue-','quotedMsg','2368760HooiYU','emit','search','8022558jUxLTL','27gGwDVe','1108300gIVAoT','(((.+)+)+)+$','getIO','-mainchannel','status','constructor','11wRRJAr','findByPk','reload','68053aMXUDy','default','contact','whatsapp','create','-appMessage','../../models/OldMessage','15ksxtYc','company-','../../models/Message','queueId','queue'];a447_0x3cc3=function(){return _0x2aa11f;};return a447_0x3cc3();}