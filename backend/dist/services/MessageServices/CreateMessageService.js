const a474_0x1ab3a8=a474_0x2520;(function(_0x343651,_0x4c01e5){const _0xf019cf=a474_0x2520,_0x48bbb2=_0x343651();while(!![]){try{const _0x9f2a35=-parseInt(_0xf019cf(0x197))/0x1*(-parseInt(_0xf019cf(0x194))/0x2)+-parseInt(_0xf019cf(0x188))/0x3*(-parseInt(_0xf019cf(0x1a4))/0x4)+-parseInt(_0xf019cf(0x19b))/0x5*(parseInt(_0xf019cf(0x18e))/0x6)+-parseInt(_0xf019cf(0x181))/0x7+parseInt(_0xf019cf(0x198))/0x8+parseInt(_0xf019cf(0x187))/0x9+parseInt(_0xf019cf(0x19c))/0xa*(-parseInt(_0xf019cf(0x17f))/0xb);if(_0x9f2a35===_0x4c01e5)break;else _0x48bbb2['push'](_0x48bbb2['shift']());}catch(_0x5cd72d){_0x48bbb2['push'](_0x48bbb2['shift']());}}}(a474_0x5d0c,0xe9e95));const a474_0x58b3e9=(function(){let _0x23ff41=!![];return function(_0x51c6c3,_0x1ed60d){const _0x2cd241=_0x23ff41?function(){const _0x4a4478=a474_0x2520;if(_0x1ed60d){const _0x502e8d=_0x1ed60d[_0x4a4478(0x182)](_0x51c6c3,arguments);return _0x1ed60d=null,_0x502e8d;}}:function(){};return _0x23ff41=![],_0x2cd241;};}()),a474_0x3f8e2e=a474_0x58b3e9(this,function(){const _0x50222e=a474_0x2520;return a474_0x3f8e2e[_0x50222e(0x1a9)]()[_0x50222e(0x1a8)](_0x50222e(0x183))[_0x50222e(0x1a9)]()['constructor'](a474_0x3f8e2e)[_0x50222e(0x1a8)](_0x50222e(0x183));});a474_0x3f8e2e();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2b607e){const _0x508a33=a474_0x2520;return _0x2b607e&&_0x2b607e[_0x508a33(0x18d)]?_0x2b607e:{'default':_0x2b607e};};Object[a474_0x1ab3a8(0x1aa)](exports,a474_0x1ab3a8(0x18d),{'value':!![]});const socket_1=require(a474_0x1ab3a8(0x199)),Message_1=__importDefault(require(a474_0x1ab3a8(0x1ac))),OldMessage_1=__importDefault(require('../../models/OldMessage')),Ticket_1=__importDefault(require(a474_0x1ab3a8(0x195))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),logger_1=require(a474_0x1ab3a8(0x193)),CreateMessageService=async({messageData:_0x3de493,companyId:_0xac44ad})=>{const _0x28775e=a474_0x1ab3a8;await Message_1[_0x28775e(0x1ad)][_0x28775e(0x184)]({..._0x3de493,'companyId':_0xac44ad});const _0x4ca084=await Message_1[_0x28775e(0x1ad)][_0x28775e(0x18c)]({'where':{'id':_0x3de493['id'],'ticketId':_0x3de493[_0x28775e(0x1a6)]},'include':['contact',{'model':Ticket_1[_0x28775e(0x1ad)],'as':_0x28775e(0x1a2),'include':[_0x28775e(0x18a),_0x28775e(0x186),{'model':Whatsapp_1[_0x28775e(0x1ad)],'as':_0x28775e(0x19d),'attributes':[_0x28775e(0x1a7),'id']}]},{'model':Message_1[_0x28775e(0x1ad)],'as':_0x28775e(0x180),'include':[_0x28775e(0x18a)],'where':{'companyId':_0xac44ad},'required':![]},{'model':OldMessage_1['default'],'as':_0x28775e(0x196),'where':{'ticketId':_0x3de493[_0x28775e(0x1a6)]},'required':![]}]});await _0x4ca084[_0x28775e(0x1a2)][_0x28775e(0x18a)][_0x28775e(0x189)]({'presence':_0x28775e(0x1a1)}),await _0x4ca084['ticket']['contact'][_0x28775e(0x1a0)]();_0x4ca084[_0x28775e(0x1a2)][_0x28775e(0x191)]!==null&&_0x4ca084[_0x28775e(0x191)]===null&&await _0x4ca084[_0x28775e(0x189)]({'queueId':_0x4ca084[_0x28775e(0x1a2)][_0x28775e(0x191)]});if(!_0x4ca084)throw new Error(_0x28775e(0x190));const _0x393c0e=(0x0,socket_1[_0x28775e(0x1a5)])();return _0x393c0e['to'](_0x4ca084[_0x28775e(0x1a6)]['toString']())['to'](_0x28775e(0x18f)+_0xac44ad+'-'+_0x4ca084[_0x28775e(0x1a2)]['status'])['to'](_0x28775e(0x18f)+_0xac44ad+'-notification')['to']('queue-'+_0x4ca084[_0x28775e(0x1a2)]['queueId']+'-'+_0x4ca084[_0x28775e(0x1a2)]['status'])['to'](_0x28775e(0x19e)+_0x4ca084[_0x28775e(0x1a2)]['queueId']+_0x28775e(0x19a))[_0x28775e(0x1ab)](_0x28775e(0x18f)+_0xac44ad+'-appMessage',{'action':_0x28775e(0x185),'message':_0x4ca084,'ticket':_0x4ca084[_0x28775e(0x1a2)],'contact':_0x4ca084[_0x28775e(0x1a2)][_0x28775e(0x18a)]}),_0x393c0e['to']('company-'+_0xac44ad+_0x28775e(0x1a3))[_0x28775e(0x1ab)](_0x28775e(0x18f)+_0xac44ad+_0x28775e(0x192),{'action':'update','contact':_0x4ca084[_0x28775e(0x1a2)][_0x28775e(0x18a)]}),logger_1[_0x28775e(0x18b)][_0x28775e(0x19f)]({'company':_0xac44ad,'ticket':_0x4ca084['ticketId'],'queue':_0x4ca084['ticket'][_0x28775e(0x191)],'status':_0x4ca084['ticket']['status']},'sending\x20create\x20message\x20to\x20clients'),_0x4ca084;};function a474_0x5d0c(){const _0x3872d0=['toString','defineProperty','emit','../../models/Message','default','11ufQBlg','quotedMsg','5436151xVggVg','apply','(((.+)+)+)+$','upsert','create','queue','11803113mxWYfU','99WiCkPv','update','contact','logger','findOne','__esModule','48XgIiiV','company-','ERR_CREATING_MESSAGE','queueId','-contact','../../utils/logger','194VAKLcY','../../models/Ticket','oldMessages','12mOoeRI','12164168clGMdu','../../libs/socket','-notification','710340mmerub','15958660ngEIpK','whatsapp','queue-','debug','reload','available','ticket','-mainchannel','198056XjitBD','getIO','ticketId','name','search'];a474_0x5d0c=function(){return _0x3872d0;};return a474_0x5d0c();}function a474_0x2520(_0x3ce393,_0x2b7c94){const _0x11a78f=a474_0x5d0c();return a474_0x2520=function(_0x3f8e2e,_0x58b3e9){_0x3f8e2e=_0x3f8e2e-0x17f;let _0x5d0cf1=_0x11a78f[_0x3f8e2e];return _0x5d0cf1;},a474_0x2520(_0x3ce393,_0x2b7c94);}exports[a474_0x1ab3a8(0x1ad)]=CreateMessageService;