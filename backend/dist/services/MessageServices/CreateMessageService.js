const a444_0x302652=a444_0x5c19;function a444_0x5c19(_0x1d4332,_0x134816){const _0x1dd988=a444_0x5c44();return a444_0x5c19=function(_0x65a0a5,_0x38a283){_0x65a0a5=_0x65a0a5-0x14e;let _0x5c442c=_0x1dd988[_0x65a0a5];return _0x5c442c;},a444_0x5c19(_0x1d4332,_0x134816);}(function(_0x27736f,_0x9f44d6){const _0x28c062=a444_0x5c19,_0x564a02=_0x27736f();while(!![]){try{const _0x33e3d4=parseInt(_0x28c062(0x159))/0x1+parseInt(_0x28c062(0x16b))/0x2+parseInt(_0x28c062(0x14f))/0x3*(-parseInt(_0x28c062(0x15e))/0x4)+-parseInt(_0x28c062(0x152))/0x5*(parseInt(_0x28c062(0x15b))/0x6)+parseInt(_0x28c062(0x165))/0x7*(parseInt(_0x28c062(0x15f))/0x8)+parseInt(_0x28c062(0x161))/0x9+parseInt(_0x28c062(0x16f))/0xa*(-parseInt(_0x28c062(0x156))/0xb);if(_0x33e3d4===_0x9f44d6)break;else _0x564a02['push'](_0x564a02['shift']());}catch(_0x4872a8){_0x564a02['push'](_0x564a02['shift']());}}}(a444_0x5c44,0x5239c));const a444_0x38a283=(function(){let _0x1a12fb=!![];return function(_0x1cff8b,_0x2c4ce2){const _0x6f8bf4=_0x1a12fb?function(){if(_0x2c4ce2){const _0x5368dc=_0x2c4ce2['apply'](_0x1cff8b,arguments);return _0x2c4ce2=null,_0x5368dc;}}:function(){};return _0x1a12fb=![],_0x6f8bf4;};}()),a444_0x65a0a5=a444_0x38a283(this,function(){const _0x12db8e=a444_0x5c19;return a444_0x65a0a5[_0x12db8e(0x164)]()[_0x12db8e(0x155)](_0x12db8e(0x16e))['toString']()[_0x12db8e(0x150)](a444_0x65a0a5)[_0x12db8e(0x155)](_0x12db8e(0x16e));});a444_0x65a0a5();'use strict';var __importDefault=this&&this['__importDefault']||function(_0xe2729f){const _0x33376a=a444_0x5c19;return _0xe2729f&&_0xe2729f[_0x33376a(0x16a)]?_0xe2729f:{'default':_0xe2729f};};Object['defineProperty'](exports,a444_0x302652(0x16a),{'value':!![]});function a444_0x5c44(){const _0x4da5f8=['1290yupAzK','queueId','whatsapp','4UVFnAM','1432anxzec','-mainchannel','2572335lBvFwq','upsert','../../libs/socket','toString','15421HjFzqU','ticket','queue','available','company-','__esModule','35804KyEDDu','quotedMsg','emit','(((.+)+)+)+$','1077330burWFa','findByPk','reload','update','-notification','default','1698738WtSZqm','constructor','getIO','6685WKLpSr','../../models/Ticket','contact','search','11HQJPNc','queue-','status','600176XqeKSR','oldMessages'];a444_0x5c44=function(){return _0x4da5f8;};return a444_0x5c44();}const socket_1=require(a444_0x302652(0x163)),Message_1=__importDefault(require('../../models/Message')),Ticket_1=__importDefault(require(a444_0x302652(0x153))),OldMessage_1=__importDefault(require('../../models/OldMessage')),CreateMessageService=async({messageData:_0xcd603a,ticket:_0x1c0651,companyId:_0x3c9d7c})=>{const _0x1fba03=a444_0x302652;await Message_1[_0x1fba03(0x14e)][_0x1fba03(0x162)]({..._0xcd603a,'companyId':_0x3c9d7c});const _0x1f8454=await Message_1['default'][_0x1fba03(0x170)](_0xcd603a['id'],{'include':[_0x1fba03(0x154),{'model':Ticket_1[_0x1fba03(0x14e)],'as':_0x1fba03(0x166),'include':['contact',_0x1fba03(0x167),_0x1fba03(0x15d)]},{'model':Message_1[_0x1fba03(0x14e)],'as':_0x1fba03(0x16c),'include':[_0x1fba03(0x154)]},{'model':OldMessage_1[_0x1fba03(0x14e)],'as':_0x1fba03(0x15a)}]});if(_0x1c0651['contact'])await _0x1c0651[_0x1fba03(0x154)][_0x1fba03(0x172)]({'presence':_0x1fba03(0x168)}),await _0x1c0651[_0x1fba03(0x154)][_0x1fba03(0x171)](),_0x1c0651[_0x1fba03(0x15c)]!==null&&_0x1f8454['queueId']===null&&await _0x1f8454['update']({'queueId':_0x1c0651[_0x1fba03(0x15c)]});else throw new Error('ERR_CREATING_MESSAGE');if(!_0x1f8454)throw new Error('ERR_CREATING_MESSAGE');const _0x7c6103=(0x0,socket_1[_0x1fba03(0x151)])();return _0x7c6103['to'](_0x1f8454['ticketId'][_0x1fba03(0x164)]())['to'](_0x1fba03(0x169)+_0x3c9d7c+'-'+_0x1c0651[_0x1fba03(0x158)])['to'](_0x1fba03(0x169)+_0x3c9d7c+_0x1fba03(0x173))['to'](_0x1fba03(0x157)+_0x1f8454['queueId']+'-notification')['to'](_0x1fba03(0x157)+_0x1f8454[_0x1fba03(0x15c)]+'-'+_0x1c0651['status'])['emit']('company-'+_0x3c9d7c+'-appMessage',{'action':'create','message':_0x1f8454,'ticket':_0x1c0651,'contact':_0x1c0651[_0x1fba03(0x154)]}),_0x7c6103['to'](_0x1fba03(0x169)+_0x3c9d7c+_0x1fba03(0x160))[_0x1fba03(0x16d)]('company-'+_0x3c9d7c+'-contact',{'action':'update','contact':_0x1c0651[_0x1fba03(0x154)]}),_0x1f8454;};exports['default']=CreateMessageService;