const a475_0x3e1325=a475_0x3453;(function(_0x41c0d0,_0x333959){const _0x145397=a475_0x3453,_0x376f54=_0x41c0d0();while(!![]){try{const _0x94b645=-parseInt(_0x145397(0xcc))/0x1+parseInt(_0x145397(0xbd))/0x2+-parseInt(_0x145397(0xd5))/0x3+parseInt(_0x145397(0xd6))/0x4+-parseInt(_0x145397(0xc3))/0x5+-parseInt(_0x145397(0xb7))/0x6+parseInt(_0x145397(0xbc))/0x7;if(_0x94b645===_0x333959)break;else _0x376f54['push'](_0x376f54['shift']());}catch(_0x40d7ea){_0x376f54['push'](_0x376f54['shift']());}}}(a475_0x3ddf,0x87f11));const a475_0x54d5a3=(function(){let _0x24974c=!![];return function(_0x1d320c,_0x2c43d1){const _0x5795f4=_0x24974c?function(){const _0x4f0193=a475_0x3453;if(_0x2c43d1){const _0x4b0415=_0x2c43d1[_0x4f0193(0xd1)](_0x1d320c,arguments);return _0x2c43d1=null,_0x4b0415;}}:function(){};return _0x24974c=![],_0x5795f4;};}()),a475_0x19a91b=a475_0x54d5a3(this,function(){const _0x8ae5f0=a475_0x3453;return a475_0x19a91b[_0x8ae5f0(0xc4)]()['search'](_0x8ae5f0(0xbb))[_0x8ae5f0(0xc4)]()['constructor'](a475_0x19a91b)[_0x8ae5f0(0xd7)](_0x8ae5f0(0xbb));});a475_0x19a91b();'use strict';var __importDefault=this&&this[a475_0x3e1325(0xc6)]||function(_0x3c0450){const _0x5a2f76=a475_0x3e1325;return _0x3c0450&&_0x3c0450[_0x5a2f76(0xd4)]?_0x3c0450:{'default':_0x3c0450};};function a475_0x3453(_0x420c26,_0x2aa916){const _0x1a3d7c=a475_0x3ddf();return a475_0x3453=function(_0x19a91b,_0x54d5a3){_0x19a91b=_0x19a91b-0xb3;let _0x3ddf22=_0x1a3d7c[_0x19a91b];return _0x3ddf22;},a475_0x3453(_0x420c26,_0x2aa916);}Object[a475_0x3e1325(0xcf)](exports,a475_0x3e1325(0xd4),{'value':!![]});function a475_0x3ddf(){const _0x3b81ac=['defineProperty','../../models/Whatsapp','apply','default','-notification','__esModule','298467Smzgoq','3340036vJECrv','search','queueId','ticketId','../../libs/socket','sending\x20create\x20message\x20to\x20clients','oldMessages','create','upsert','company-','whatsapp','4325706UaDHAJ','ticket','emit','getIO','(((.+)+)+)+$','14756840oXeZBP','799900VrlBYE','queue','status','../../models/Message','update','ERR_CREATING_MESSAGE','4899830ubNoJh','toString','contact','__importDefault','name','../../utils/logger','queue-','available','../../models/OldMessage','985856yQwebR','-appMessage','logger'];a475_0x3ddf=function(){return _0x3b81ac;};return a475_0x3ddf();}const socket_1=require(a475_0x3e1325(0xda)),Message_1=__importDefault(require(a475_0x3e1325(0xc0))),OldMessage_1=__importDefault(require(a475_0x3e1325(0xcb))),Ticket_1=__importDefault(require('../../models/Ticket')),Whatsapp_1=__importDefault(require(a475_0x3e1325(0xd0))),logger_1=require(a475_0x3e1325(0xc8)),CreateMessageService=async({messageData:_0x5a4961,companyId:_0x2b94e3})=>{const _0x2bf6f8=a475_0x3e1325;await Message_1[_0x2bf6f8(0xd2)][_0x2bf6f8(0xb4)]({..._0x5a4961,'companyId':_0x2b94e3});const _0x28df43=await Message_1['default']['findOne']({'where':{'id':_0x5a4961['id'],'ticketId':_0x5a4961['ticketId']},'include':[_0x2bf6f8(0xc5),{'model':Ticket_1[_0x2bf6f8(0xd2)],'as':_0x2bf6f8(0xb8),'include':[_0x2bf6f8(0xc5),_0x2bf6f8(0xbe),{'model':Whatsapp_1[_0x2bf6f8(0xd2)],'as':_0x2bf6f8(0xb6),'attributes':[_0x2bf6f8(0xc7),'id']}]},{'model':Message_1[_0x2bf6f8(0xd2)],'as':'quotedMsg','include':[_0x2bf6f8(0xc5)],'where':{'companyId':_0x2b94e3},'required':![]},{'model':OldMessage_1['default'],'as':_0x2bf6f8(0xdc),'where':{'ticketId':_0x5a4961[_0x2bf6f8(0xd9)]},'required':![]}]});await _0x28df43[_0x2bf6f8(0xb8)]['contact']['update']({'presence':_0x2bf6f8(0xca)}),await _0x28df43[_0x2bf6f8(0xb8)][_0x2bf6f8(0xc5)]['reload']();_0x28df43[_0x2bf6f8(0xb8)]['queueId']!==null&&_0x28df43[_0x2bf6f8(0xd8)]===null&&await _0x28df43[_0x2bf6f8(0xc1)]({'queueId':_0x28df43['ticket'][_0x2bf6f8(0xd8)]});if(!_0x28df43)throw new Error(_0x2bf6f8(0xc2));const _0x100a33=(0x0,socket_1[_0x2bf6f8(0xba)])();return _0x100a33['to'](_0x28df43[_0x2bf6f8(0xd9)][_0x2bf6f8(0xc4)]())['to']('company-'+_0x2b94e3+'-'+_0x28df43['ticket']['status'])['to'](_0x2bf6f8(0xb5)+_0x2b94e3+_0x2bf6f8(0xd3))['to'](_0x2bf6f8(0xc9)+_0x28df43[_0x2bf6f8(0xb8)][_0x2bf6f8(0xd8)]+'-'+_0x28df43['ticket'][_0x2bf6f8(0xbf)])['to']('queue-'+_0x28df43[_0x2bf6f8(0xb8)]['queueId']+'-notification')['emit'](_0x2bf6f8(0xb5)+_0x2b94e3+_0x2bf6f8(0xcd),{'action':_0x2bf6f8(0xb3),'message':_0x28df43,'ticket':_0x28df43[_0x2bf6f8(0xb8)],'contact':_0x28df43[_0x2bf6f8(0xb8)]['contact']}),_0x100a33['to'](_0x2bf6f8(0xb5)+_0x2b94e3+'-mainchannel')[_0x2bf6f8(0xb9)]('company-'+_0x2b94e3+'-contact',{'action':_0x2bf6f8(0xc1),'contact':_0x28df43[_0x2bf6f8(0xb8)][_0x2bf6f8(0xc5)]}),logger_1[_0x2bf6f8(0xce)]['debug']({'company':_0x2b94e3,'ticket':_0x28df43['ticketId'],'queue':_0x28df43[_0x2bf6f8(0xb8)][_0x2bf6f8(0xd8)],'status':_0x28df43['ticket'][_0x2bf6f8(0xbf)]},_0x2bf6f8(0xdb)),_0x28df43;};exports[a475_0x3e1325(0xd2)]=CreateMessageService;