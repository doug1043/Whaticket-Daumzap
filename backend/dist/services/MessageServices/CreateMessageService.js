const a446_0x955652=a446_0x2261;(function(_0x615d4c,_0x9c4322){const _0x3d2a50=a446_0x2261,_0x515f0a=_0x615d4c();while(!![]){try{const _0x2f4b16=-parseInt(_0x3d2a50(0x10f))/0x1*(-parseInt(_0x3d2a50(0x108))/0x2)+-parseInt(_0x3d2a50(0xfa))/0x3*(parseInt(_0x3d2a50(0xf8))/0x4)+parseInt(_0x3d2a50(0x119))/0x5+-parseInt(_0x3d2a50(0x10b))/0x6*(parseInt(_0x3d2a50(0x107))/0x7)+-parseInt(_0x3d2a50(0x110))/0x8*(-parseInt(_0x3d2a50(0x105))/0x9)+-parseInt(_0x3d2a50(0xfe))/0xa*(-parseInt(_0x3d2a50(0x120))/0xb)+parseInt(_0x3d2a50(0xfd))/0xc*(-parseInt(_0x3d2a50(0x104))/0xd);if(_0x2f4b16===_0x9c4322)break;else _0x515f0a['push'](_0x515f0a['shift']());}catch(_0x386bd4){_0x515f0a['push'](_0x515f0a['shift']());}}}(a446_0x5b51,0xbc7d2));const a446_0x463f58=(function(){let _0x30c8a8=!![];return function(_0x4560bc,_0x29dc2f){const _0x30701e=_0x30c8a8?function(){const _0x14bc96=a446_0x2261;if(_0x29dc2f){const _0x21a440=_0x29dc2f[_0x14bc96(0x118)](_0x4560bc,arguments);return _0x29dc2f=null,_0x21a440;}}:function(){};return _0x30c8a8=![],_0x30701e;};}()),a446_0x5f40b3=a446_0x463f58(this,function(){const _0x400a04=a446_0x2261;return a446_0x5f40b3[_0x400a04(0x10c)]()[_0x400a04(0x10e)](_0x400a04(0x112))[_0x400a04(0x10c)]()[_0x400a04(0x114)](a446_0x5f40b3)[_0x400a04(0x10e)](_0x400a04(0x112));});a446_0x5f40b3();'use strict';var __importDefault=this&&this[a446_0x955652(0xf7)]||function(_0x326160){return _0x326160&&_0x326160['__esModule']?_0x326160:{'default':_0x326160};};function a446_0x5b51(){const _0x3fb734=['available','getIO','__esModule','contact','company-','22gzXxsU','../../libs/socket','create','__importDefault','1340oYOOZd','ticketId','10749UBdoiy','findByPk','update','12OcGRBX','7425050jEuMlg','queueId','-mainchannel','status','whatsapp','ERR_CREATING_MESSAGE','21230521JvLOWg','11523852GvAOOg','-notification','371YDXZAI','425938lTsdvk','emit','queue','101202UKiGOC','toString','queue-','search','3JEZvJt','8LHRlVM','../../models/Message','(((.+)+)+)+$','-appMessage','constructor','quotedMsg','../../models/OldMessage','upsert','apply','5475390eMueRh','default'];a446_0x5b51=function(){return _0x3fb734;};return a446_0x5b51();}Object['defineProperty'](exports,a446_0x955652(0x11d),{'value':!![]});function a446_0x2261(_0x59435d,_0x5e9b7e){const _0x3f8b22=a446_0x5b51();return a446_0x2261=function(_0x5f40b3,_0x463f58){_0x5f40b3=_0x5f40b3-0xf6;let _0x5b5134=_0x3f8b22[_0x5f40b3];return _0x5b5134;},a446_0x2261(_0x59435d,_0x5e9b7e);}const socket_1=require(a446_0x955652(0x121)),Message_1=__importDefault(require(a446_0x955652(0x111))),Ticket_1=__importDefault(require('../../models/Ticket')),OldMessage_1=__importDefault(require(a446_0x955652(0x116))),CreateMessageService=async({messageData:_0x77d0b,ticket:_0x4d5bea,companyId:_0xa7a783})=>{const _0x3c79ae=a446_0x955652;await Message_1[_0x3c79ae(0x11a)][_0x3c79ae(0x117)]({..._0x77d0b,'companyId':_0xa7a783});const _0x3b6cd2=await Message_1['default'][_0x3c79ae(0xfb)](_0x77d0b['id'],{'include':[_0x3c79ae(0x11e),{'model':Ticket_1[_0x3c79ae(0x11a)],'as':'ticket','include':[_0x3c79ae(0x11e),_0x3c79ae(0x10a),_0x3c79ae(0x102)]},{'model':Message_1['default'],'as':_0x3c79ae(0x115),'include':[_0x3c79ae(0x11e)]},{'model':OldMessage_1[_0x3c79ae(0x11a)],'as':'oldMessages'}]});if(_0x4d5bea['contact'])await _0x4d5bea[_0x3c79ae(0x11e)][_0x3c79ae(0xfc)]({'presence':_0x3c79ae(0x11b)}),await _0x4d5bea[_0x3c79ae(0x11e)]['reload'](),_0x4d5bea[_0x3c79ae(0xff)]!==null&&_0x3b6cd2[_0x3c79ae(0xff)]===null&&await _0x3b6cd2[_0x3c79ae(0xfc)]({'queueId':_0x4d5bea['queueId']});else throw new Error('ERR_CREATING_MESSAGE');if(!_0x3b6cd2)throw new Error(_0x3c79ae(0x103));const _0x485d38=(0x0,socket_1[_0x3c79ae(0x11c)])();return _0x485d38['to'](_0x3b6cd2[_0x3c79ae(0xf9)]['toString']())['to'](_0x3c79ae(0x11f)+_0xa7a783+'-'+_0x4d5bea[_0x3c79ae(0x101)])['to']('company-'+_0xa7a783+_0x3c79ae(0x106))['to'](_0x3c79ae(0x10d)+_0x3b6cd2['queueId']+'-notification')['to'](_0x3c79ae(0x10d)+_0x3b6cd2[_0x3c79ae(0xff)]+'-'+_0x4d5bea[_0x3c79ae(0x101)])[_0x3c79ae(0x109)]('company-'+_0xa7a783+_0x3c79ae(0x113),{'action':_0x3c79ae(0xf6),'message':_0x3b6cd2,'ticket':_0x4d5bea,'contact':_0x4d5bea[_0x3c79ae(0x11e)]}),_0x485d38['to'](_0x3c79ae(0x11f)+_0xa7a783+_0x3c79ae(0x100))[_0x3c79ae(0x109)](_0x3c79ae(0x11f)+_0xa7a783+'-contact',{'action':_0x3c79ae(0xfc),'contact':_0x4d5bea['contact']}),_0x3b6cd2;};exports[a446_0x955652(0x11a)]=CreateMessageService;