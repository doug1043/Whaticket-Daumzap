const a480_0x3998cb=a480_0x34bb;(function(_0x186f99,_0x297542){const _0x58fa59=a480_0x34bb,_0x238e1e=_0x186f99();while(!![]){try{const _0x4b3437=parseInt(_0x58fa59(0x14e))/0x1+-parseInt(_0x58fa59(0x157))/0x2+-parseInt(_0x58fa59(0x153))/0x3+parseInt(_0x58fa59(0x14d))/0x4*(-parseInt(_0x58fa59(0x143))/0x5)+parseInt(_0x58fa59(0x14a))/0x6*(-parseInt(_0x58fa59(0x166))/0x7)+-parseInt(_0x58fa59(0x145))/0x8+-parseInt(_0x58fa59(0x14f))/0x9*(-parseInt(_0x58fa59(0x144))/0xa);if(_0x4b3437===_0x297542)break;else _0x238e1e['push'](_0x238e1e['shift']());}catch(_0x34f9c5){_0x238e1e['push'](_0x238e1e['shift']());}}}(a480_0x29cd,0x55c91));const a480_0x444773=(function(){let _0x885e79=!![];return function(_0x239e8d,_0x1e7003){const _0x1ba15c=_0x885e79?function(){const _0x5efcbe=a480_0x34bb;if(_0x1e7003){const _0xc7fa26=_0x1e7003[_0x5efcbe(0x152)](_0x239e8d,arguments);return _0x1e7003=null,_0xc7fa26;}}:function(){};return _0x885e79=![],_0x1ba15c;};}()),a480_0x42f64a=a480_0x444773(this,function(){const _0x226a27=a480_0x34bb;return a480_0x42f64a['toString']()[_0x226a27(0x156)]('(((.+)+)+)+$')[_0x226a27(0x162)]()[_0x226a27(0x14c)](a480_0x42f64a)[_0x226a27(0x156)](_0x226a27(0x154));});a480_0x42f64a();function a480_0x29cd(){const _0x407496=['ticket','../../utils/logger','../../models/Whatsapp','toString','../../models/OldMessage','ticketId','available','217BRkgPf','oldMessages','-mainchannel','upsert','create','../../libs/socket','update','company-','logger','__esModule','-contact','whatsapp','getIO','53150NvhKmp','1760qYWZFG','1645720sXOdJq','../../models/Message','name','default','debug','110568jPUDRI','quotedMsg','constructor','84hObqYX','688467cbxiJy','44172rQbdhD','contact','findOne','apply','332520lzRmjA','(((.+)+)+)+$','-notification','search','179690usFSDZ','sending\x20create\x20message\x20to\x20clients','queue-','queue','defineProperty','status','queueId','reload'];a480_0x29cd=function(){return _0x407496;};return a480_0x29cd();}'use strict';function a480_0x34bb(_0x4eff69,_0x4613c5){const _0x14d560=a480_0x29cd();return a480_0x34bb=function(_0x42f64a,_0x444773){_0x42f64a=_0x42f64a-0x13e;let _0x29cd9f=_0x14d560[_0x42f64a];return _0x29cd9f;},a480_0x34bb(_0x4eff69,_0x4613c5);}var __importDefault=this&&this['__importDefault']||function(_0x2fc89c){return _0x2fc89c&&_0x2fc89c['__esModule']?_0x2fc89c:{'default':_0x2fc89c};};Object[a480_0x3998cb(0x15b)](exports,a480_0x3998cb(0x13f),{'value':!![]});const socket_1=require(a480_0x3998cb(0x16b)),Message_1=__importDefault(require(a480_0x3998cb(0x146))),OldMessage_1=__importDefault(require(a480_0x3998cb(0x163))),Ticket_1=__importDefault(require('../../models/Ticket')),Whatsapp_1=__importDefault(require(a480_0x3998cb(0x161))),logger_1=require(a480_0x3998cb(0x160)),CreateMessageService=async({messageData:_0x4349a4,companyId:_0x1b188e})=>{const _0x48627e=a480_0x3998cb;await Message_1[_0x48627e(0x148)][_0x48627e(0x169)]({..._0x4349a4,'companyId':_0x1b188e});const _0x2a8e87=await Message_1[_0x48627e(0x148)][_0x48627e(0x151)]({'where':{'id':_0x4349a4['id'],'ticketId':_0x4349a4[_0x48627e(0x164)]},'include':[_0x48627e(0x150),{'model':Ticket_1[_0x48627e(0x148)],'as':_0x48627e(0x15f),'include':[_0x48627e(0x150),_0x48627e(0x15a),{'model':Whatsapp_1[_0x48627e(0x148)],'as':_0x48627e(0x141),'attributes':[_0x48627e(0x147),'id']}]},{'model':Message_1['default'],'as':_0x48627e(0x14b),'include':[_0x48627e(0x150)],'where':{'companyId':_0x1b188e},'required':![]},{'model':OldMessage_1[_0x48627e(0x148)],'as':_0x48627e(0x167),'where':{'ticketId':_0x4349a4[_0x48627e(0x164)]},'required':![]}]});await _0x2a8e87[_0x48627e(0x15f)][_0x48627e(0x150)]['update']({'presence':_0x48627e(0x165)}),await _0x2a8e87[_0x48627e(0x15f)][_0x48627e(0x150)][_0x48627e(0x15e)]();_0x2a8e87['ticket'][_0x48627e(0x15d)]!==null&&_0x2a8e87[_0x48627e(0x15d)]===null&&await _0x2a8e87[_0x48627e(0x16c)]({'queueId':_0x2a8e87[_0x48627e(0x15f)][_0x48627e(0x15d)]});if(!_0x2a8e87)throw new Error('ERR_CREATING_MESSAGE');const _0x493551=(0x0,socket_1[_0x48627e(0x142)])();return _0x493551['to'](_0x2a8e87[_0x48627e(0x164)][_0x48627e(0x162)]())['to'](_0x48627e(0x16d)+_0x1b188e+'-'+_0x2a8e87['ticket']['status'])['to']('company-'+_0x1b188e+_0x48627e(0x155))['to']('queue-'+_0x2a8e87[_0x48627e(0x15f)][_0x48627e(0x15d)]+'-'+_0x2a8e87[_0x48627e(0x15f)][_0x48627e(0x15c)])['to'](_0x48627e(0x159)+_0x2a8e87[_0x48627e(0x15f)][_0x48627e(0x15d)]+_0x48627e(0x155))['emit'](_0x48627e(0x16d)+_0x1b188e+'-appMessage',{'action':_0x48627e(0x16a),'message':_0x2a8e87,'ticket':_0x2a8e87[_0x48627e(0x15f)],'contact':_0x2a8e87[_0x48627e(0x15f)][_0x48627e(0x150)]}),_0x493551['to'](_0x48627e(0x16d)+_0x1b188e+_0x48627e(0x168))['emit'](_0x48627e(0x16d)+_0x1b188e+_0x48627e(0x140),{'action':_0x48627e(0x16c),'contact':_0x2a8e87[_0x48627e(0x15f)]['contact']}),logger_1[_0x48627e(0x13e)][_0x48627e(0x149)]({'company':_0x1b188e,'ticket':_0x2a8e87[_0x48627e(0x164)],'queue':_0x2a8e87['ticket'][_0x48627e(0x15d)],'status':_0x2a8e87['ticket'][_0x48627e(0x15c)]},_0x48627e(0x158)),_0x2a8e87;};exports[a480_0x3998cb(0x148)]=CreateMessageService;