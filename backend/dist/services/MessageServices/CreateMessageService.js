const a445_0x49e5ae=a445_0x24c4;(function(_0x51d3b5,_0x51e3d0){const _0x23af5d=a445_0x24c4,_0xd2a04a=_0x51d3b5();while(!![]){try{const _0x57eb42=-parseInt(_0x23af5d(0xc3))/0x1*(-parseInt(_0x23af5d(0xab))/0x2)+-parseInt(_0x23af5d(0xb1))/0x3*(parseInt(_0x23af5d(0xb2))/0x4)+-parseInt(_0x23af5d(0xa2))/0x5*(parseInt(_0x23af5d(0xbc))/0x6)+parseInt(_0x23af5d(0xb6))/0x7*(parseInt(_0x23af5d(0xa4))/0x8)+parseInt(_0x23af5d(0xb7))/0x9+-parseInt(_0x23af5d(0xb5))/0xa+parseInt(_0x23af5d(0xba))/0xb;if(_0x57eb42===_0x51e3d0)break;else _0xd2a04a['push'](_0xd2a04a['shift']());}catch(_0x59c7b7){_0xd2a04a['push'](_0xd2a04a['shift']());}}}(a445_0x4b89,0x7d887));function a445_0x4b89(){const _0x25f9bc=['534468DkiwGT','queue-','__importDefault','search','whatsapp','../../libs/socket','ticket','3uDDTrw','oldMessages','defineProperty','-appMessage','toString','create','__esModule','update','-mainchannel','45ZwAdiE','-contact','24iIDWnV','-notification','company-','constructor','getIO','../../models/Message','contact','184374gFmAxX','available','queueId','queue','quotedMsg','ERR_CREATING_MESSAGE','3JdnSNr','2955044YMWABr','../../models/Ticket','findByPk','1045890kSktfu','812609EXtXac','9035271yoNJah','status','emit','5835434ulwNDA','default'];a445_0x4b89=function(){return _0x25f9bc;};return a445_0x4b89();}function a445_0x24c4(_0x48eb47,_0x1e5f59){const _0x107bc5=a445_0x4b89();return a445_0x24c4=function(_0x3a1ac3,_0x2c2690){_0x3a1ac3=_0x3a1ac3-0xa1;let _0x4b8909=_0x107bc5[_0x3a1ac3];return _0x4b8909;},a445_0x24c4(_0x48eb47,_0x1e5f59);}const a445_0x2c2690=(function(){let _0x125cc9=!![];return function(_0x3fab54,_0x43e764){const _0xc95f4a=_0x125cc9?function(){if(_0x43e764){const _0x19a1bc=_0x43e764['apply'](_0x3fab54,arguments);return _0x43e764=null,_0x19a1bc;}}:function(){};return _0x125cc9=![],_0xc95f4a;};}()),a445_0x3a1ac3=a445_0x2c2690(this,function(){const _0x1146ff=a445_0x24c4;return a445_0x3a1ac3[_0x1146ff(0xc7)]()[_0x1146ff(0xbf)]('(((.+)+)+)+$')[_0x1146ff(0xc7)]()[_0x1146ff(0xa7)](a445_0x3a1ac3)[_0x1146ff(0xbf)]('(((.+)+)+)+$');});a445_0x3a1ac3();'use strict';var __importDefault=this&&this[a445_0x49e5ae(0xbe)]||function(_0xba570){return _0xba570&&_0xba570['__esModule']?_0xba570:{'default':_0xba570};};Object[a445_0x49e5ae(0xc5)](exports,a445_0x49e5ae(0xc9),{'value':!![]});const socket_1=require(a445_0x49e5ae(0xc1)),Message_1=__importDefault(require(a445_0x49e5ae(0xa9))),Ticket_1=__importDefault(require(a445_0x49e5ae(0xb3))),OldMessage_1=__importDefault(require('../../models/OldMessage')),CreateMessageService=async({messageData:_0x3418ea,ticket:_0x53325e,companyId:_0x410601})=>{const _0x299f2d=a445_0x49e5ae;await Message_1['default']['upsert']({..._0x3418ea,'companyId':_0x410601});const _0x8f2111=await Message_1[_0x299f2d(0xbb)][_0x299f2d(0xb4)](_0x3418ea['id'],{'include':[_0x299f2d(0xaa),{'model':Ticket_1[_0x299f2d(0xbb)],'as':_0x299f2d(0xc2),'include':[_0x299f2d(0xaa),_0x299f2d(0xae),_0x299f2d(0xc0)]},{'model':Message_1[_0x299f2d(0xbb)],'as':_0x299f2d(0xaf),'include':[_0x299f2d(0xaa)]},{'model':OldMessage_1[_0x299f2d(0xbb)],'as':_0x299f2d(0xc4)}]});if(_0x53325e[_0x299f2d(0xaa)])await _0x53325e[_0x299f2d(0xaa)]['update']({'presence':_0x299f2d(0xac)}),await _0x53325e[_0x299f2d(0xaa)]['reload'](),_0x53325e[_0x299f2d(0xad)]!==null&&_0x8f2111[_0x299f2d(0xad)]===null&&await _0x8f2111[_0x299f2d(0xca)]({'queueId':_0x53325e[_0x299f2d(0xad)]});else throw new Error(_0x299f2d(0xb0));if(!_0x8f2111)throw new Error(_0x299f2d(0xb0));const _0x11a481=(0x0,socket_1[_0x299f2d(0xa8)])();return _0x11a481['to'](_0x8f2111['ticketId']['toString']())['to'](_0x299f2d(0xa6)+_0x410601+'-'+_0x53325e[_0x299f2d(0xb8)])['to']('company-'+_0x410601+_0x299f2d(0xa5))['to'](_0x299f2d(0xbd)+_0x8f2111[_0x299f2d(0xad)]+_0x299f2d(0xa5))['to']('queue-'+_0x8f2111[_0x299f2d(0xad)]+'-'+_0x53325e[_0x299f2d(0xb8)])[_0x299f2d(0xb9)](_0x299f2d(0xa6)+_0x410601+_0x299f2d(0xc6),{'action':_0x299f2d(0xc8),'message':_0x8f2111,'ticket':_0x53325e,'contact':_0x53325e['contact']}),_0x11a481['to']('company-'+_0x410601+_0x299f2d(0xa1))[_0x299f2d(0xb9)](_0x299f2d(0xa6)+_0x410601+_0x299f2d(0xa3),{'action':_0x299f2d(0xca),'contact':_0x53325e[_0x299f2d(0xaa)]}),_0x8f2111;};exports[a445_0x49e5ae(0xbb)]=CreateMessageService;