const a580_0x58c097=a580_0xb559;function a580_0x5ece(){const _0x27e29f=['22997412VmPYRb','constructor','../../models/Message','contact','../../models/Ticket','__importDefault','whatsapp','getIO','debug','sending\x20create\x20message\x20to\x20clients','../../utils/logger','findOne','1928YLRCND','25648iVHsKE','3MjcHQC','-notification','2573034JQVjlb','status','queueId','ticketId','default','logger','(((.+)+)+)+$','company-','queue-','432348YwVBMu','update','apply','create','../../models/OldMessage','quotedMsg','queue','toString','119373xXUAVu','1463498DpzjZC','__esModule','ticket','../../models/Whatsapp','search','-appMessage','upsert','name','reload','emit','../../libs/socket','ERR_CREATING_MESSAGE','4021645DtABji'];a580_0x5ece=function(){return _0x27e29f;};return a580_0x5ece();}(function(_0x1a4e28,_0x4e8ab1){const _0x2acc59=a580_0xb559,_0x15566b=_0x1a4e28();while(!![]){try{const _0x21a127=-parseInt(_0x2acc59(0x19f))/0x1+parseInt(_0x2acc59(0x1a0))/0x2*(-parseInt(_0x2acc59(0x18c))/0x3)+parseInt(_0x2acc59(0x197))/0x4+-parseInt(_0x2acc59(0x17d))/0x5+parseInt(_0x2acc59(0x18e))/0x6+parseInt(_0x2acc59(0x18b))/0x7*(-parseInt(_0x2acc59(0x18a))/0x8)+parseInt(_0x2acc59(0x17e))/0x9;if(_0x21a127===_0x4e8ab1)break;else _0x15566b['push'](_0x15566b['shift']());}catch(_0x581e01){_0x15566b['push'](_0x15566b['shift']());}}}(a580_0x5ece,0x872f7));function a580_0xb559(_0x598133,_0x395bd5){const _0x2834bf=a580_0x5ece();return a580_0xb559=function(_0x31bd76,_0x1e56d8){_0x31bd76=_0x31bd76-0x17a;let _0x5ece06=_0x2834bf[_0x31bd76];return _0x5ece06;},a580_0xb559(_0x598133,_0x395bd5);}const a580_0x1e56d8=(function(){let _0x167a31=!![];return function(_0x3adbda,_0x59896d){const _0x3e8d22=_0x167a31?function(){const _0x4537bc=a580_0xb559;if(_0x59896d){const _0x3ea4b4=_0x59896d[_0x4537bc(0x199)](_0x3adbda,arguments);return _0x59896d=null,_0x3ea4b4;}}:function(){};return _0x167a31=![],_0x3e8d22;};}()),a580_0x31bd76=a580_0x1e56d8(this,function(){const _0x4f3a63=a580_0xb559;return a580_0x31bd76[_0x4f3a63(0x19e)]()[_0x4f3a63(0x1a4)](_0x4f3a63(0x194))[_0x4f3a63(0x19e)]()[_0x4f3a63(0x17f)](a580_0x31bd76)[_0x4f3a63(0x1a4)](_0x4f3a63(0x194));});a580_0x31bd76();'use strict';var __importDefault=this&&this[a580_0x58c097(0x183)]||function(_0x1f5dc3){const _0x1dfa6f=a580_0x58c097;return _0x1f5dc3&&_0x1f5dc3[_0x1dfa6f(0x1a1)]?_0x1f5dc3:{'default':_0x1f5dc3};};Object['defineProperty'](exports,a580_0x58c097(0x1a1),{'value':!![]});const socket_1=require(a580_0x58c097(0x17b)),Message_1=__importDefault(require(a580_0x58c097(0x180))),OldMessage_1=__importDefault(require(a580_0x58c097(0x19b))),Ticket_1=__importDefault(require(a580_0x58c097(0x182))),Whatsapp_1=__importDefault(require(a580_0x58c097(0x1a3))),logger_1=require(a580_0x58c097(0x188)),CreateMessageService=async({messageData:_0x9b0dc2,companyId:_0x17f8bd})=>{const _0x59bed9=a580_0x58c097;await Message_1[_0x59bed9(0x192)][_0x59bed9(0x1a6)]({..._0x9b0dc2,'companyId':_0x17f8bd});const _0x450a64=await Message_1['default'][_0x59bed9(0x189)]({'where':{'id':_0x9b0dc2['id'],'ticketId':_0x9b0dc2[_0x59bed9(0x191)]},'include':[_0x59bed9(0x181),{'model':Ticket_1['default'],'as':_0x59bed9(0x1a2),'include':[_0x59bed9(0x181),_0x59bed9(0x19d),{'model':Whatsapp_1['default'],'as':_0x59bed9(0x184),'attributes':[_0x59bed9(0x1a7),'id']}]},{'model':Message_1[_0x59bed9(0x192)],'as':_0x59bed9(0x19c),'include':[_0x59bed9(0x181)],'where':{'companyId':_0x17f8bd},'required':![]},{'model':OldMessage_1['default'],'as':'oldMessages','where':{'ticketId':_0x9b0dc2[_0x59bed9(0x191)]},'required':![]}]});await _0x450a64['ticket'][_0x59bed9(0x181)][_0x59bed9(0x198)]({'presence':'available'}),await _0x450a64[_0x59bed9(0x1a2)][_0x59bed9(0x181)][_0x59bed9(0x1a8)]();_0x450a64[_0x59bed9(0x1a2)][_0x59bed9(0x190)]!==null&&_0x450a64[_0x59bed9(0x190)]===null&&await _0x450a64[_0x59bed9(0x198)]({'queueId':_0x450a64['ticket'][_0x59bed9(0x190)]});if(!_0x450a64)throw new Error(_0x59bed9(0x17c));const _0x5b81fe=(0x0,socket_1[_0x59bed9(0x185)])();return _0x5b81fe['to'](_0x450a64[_0x59bed9(0x191)][_0x59bed9(0x19e)]())['to'](_0x59bed9(0x195)+_0x17f8bd+'-'+_0x450a64[_0x59bed9(0x1a2)][_0x59bed9(0x18f)])['to'](_0x59bed9(0x195)+_0x17f8bd+_0x59bed9(0x18d))['to'](_0x59bed9(0x196)+_0x450a64['ticket'][_0x59bed9(0x190)]+'-'+_0x450a64[_0x59bed9(0x1a2)][_0x59bed9(0x18f)])['to'](_0x59bed9(0x196)+_0x450a64['ticket'][_0x59bed9(0x190)]+_0x59bed9(0x18d))[_0x59bed9(0x17a)]('company-'+_0x17f8bd+_0x59bed9(0x1a5),{'action':_0x59bed9(0x19a),'message':_0x450a64,'ticket':_0x450a64[_0x59bed9(0x1a2)],'contact':_0x450a64[_0x59bed9(0x1a2)][_0x59bed9(0x181)]}),_0x5b81fe['to'](_0x59bed9(0x195)+_0x17f8bd+'-mainchannel')[_0x59bed9(0x17a)](_0x59bed9(0x195)+_0x17f8bd+'-contact',{'action':'update','contact':_0x450a64[_0x59bed9(0x1a2)][_0x59bed9(0x181)]}),logger_1[_0x59bed9(0x193)][_0x59bed9(0x186)]({'company':_0x17f8bd,'ticket':_0x450a64[_0x59bed9(0x191)],'queue':_0x450a64[_0x59bed9(0x1a2)][_0x59bed9(0x190)],'status':_0x450a64['ticket'][_0x59bed9(0x18f)]},_0x59bed9(0x187)),_0x450a64;};exports[a580_0x58c097(0x192)]=CreateMessageService;