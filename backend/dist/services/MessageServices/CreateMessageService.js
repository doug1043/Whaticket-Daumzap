const a479_0x3e2913=a479_0x2897;(function(_0x2cfbd0,_0x3931de){const _0x476334=a479_0x2897,_0x448a38=_0x2cfbd0();while(!![]){try{const _0x4098f3=parseInt(_0x476334(0x93))/0x1*(-parseInt(_0x476334(0x9c))/0x2)+-parseInt(_0x476334(0xa0))/0x3+parseInt(_0x476334(0x88))/0x4+parseInt(_0x476334(0xa7))/0x5*(-parseInt(_0x476334(0x9f))/0x6)+parseInt(_0x476334(0x95))/0x7+-parseInt(_0x476334(0xb3))/0x8*(parseInt(_0x476334(0x9d))/0x9)+-parseInt(_0x476334(0x8e))/0xa*(-parseInt(_0x476334(0x87))/0xb);if(_0x4098f3===_0x3931de)break;else _0x448a38['push'](_0x448a38['shift']());}catch(_0x5cca99){_0x448a38['push'](_0x448a38['shift']());}}}(a479_0xc342,0x90480));const a479_0x357e3b=(function(){let _0x1878a1=!![];return function(_0x4985ed,_0x5a2081){const _0x538323=_0x1878a1?function(){const _0x5c3990=a479_0x2897;if(_0x5a2081){const _0x4d69b4=_0x5a2081[_0x5c3990(0xb0)](_0x4985ed,arguments);return _0x5a2081=null,_0x4d69b4;}}:function(){};return _0x1878a1=![],_0x538323;};}()),a479_0x5484f7=a479_0x357e3b(this,function(){const _0x327571=a479_0x2897;return a479_0x5484f7[_0x327571(0x8c)]()[_0x327571(0x90)](_0x327571(0xa1))['toString']()[_0x327571(0xa2)](a479_0x5484f7)['search'](_0x327571(0xa1));});a479_0x5484f7();'use strict';function a479_0xc342(){const _0x5e6f46=['toString','../../models/OldMessage','67130kHaStA','../../libs/socket','search','-contact','update','1cIteyL','../../models/Whatsapp','1863988ZVyrGK','available','ticketId','queueId','../../models/Message','company-','contact','1134818otebgZ','27YngVbI','create','4122QaEqdj','1657473BWtEjm','(((.+)+)+)+$','constructor','emit','__importDefault','ticket','default','6535rWHakc','-appMessage','__esModule','oldMessages','upsert','status','name','-notification','ERR_CREATING_MESSAGE','apply','defineProperty','sending\x20create\x20message\x20to\x20clients','1834528FItFle','../../utils/logger','getIO','3619rUtHiP','3287488QRTDmp','reload','queue','findOne'];a479_0xc342=function(){return _0x5e6f46;};return a479_0xc342();}function a479_0x2897(_0x3c713c,_0x30c051){const _0x190399=a479_0xc342();return a479_0x2897=function(_0x5484f7,_0x357e3b){_0x5484f7=_0x5484f7-0x86;let _0xc34290=_0x190399[_0x5484f7];return _0xc34290;},a479_0x2897(_0x3c713c,_0x30c051);}var __importDefault=this&&this[a479_0x3e2913(0xa4)]||function(_0x1643d2){return _0x1643d2&&_0x1643d2['__esModule']?_0x1643d2:{'default':_0x1643d2};};Object[a479_0x3e2913(0xb1)](exports,a479_0x3e2913(0xa9),{'value':!![]});const socket_1=require(a479_0x3e2913(0x8f)),Message_1=__importDefault(require(a479_0x3e2913(0x99))),OldMessage_1=__importDefault(require(a479_0x3e2913(0x8d))),Ticket_1=__importDefault(require('../../models/Ticket')),Whatsapp_1=__importDefault(require(a479_0x3e2913(0x94))),logger_1=require(a479_0x3e2913(0xb4)),CreateMessageService=async({messageData:_0x528e56,companyId:_0x1d93d6})=>{const _0x59c8ed=a479_0x3e2913;await Message_1[_0x59c8ed(0xa6)][_0x59c8ed(0xab)]({..._0x528e56,'companyId':_0x1d93d6});const _0x499c88=await Message_1['default'][_0x59c8ed(0x8b)]({'where':{'id':_0x528e56['id'],'ticketId':_0x528e56['ticketId']},'include':[_0x59c8ed(0x9b),{'model':Ticket_1[_0x59c8ed(0xa6)],'as':_0x59c8ed(0xa5),'include':[_0x59c8ed(0x9b),_0x59c8ed(0x8a),{'model':Whatsapp_1[_0x59c8ed(0xa6)],'as':'whatsapp','attributes':[_0x59c8ed(0xad),'id']}]},{'model':Message_1[_0x59c8ed(0xa6)],'as':'quotedMsg','include':[_0x59c8ed(0x9b)],'where':{'companyId':_0x1d93d6},'required':![]},{'model':OldMessage_1['default'],'as':_0x59c8ed(0xaa),'where':{'ticketId':_0x528e56[_0x59c8ed(0x97)]},'required':![]}]});await _0x499c88[_0x59c8ed(0xa5)][_0x59c8ed(0x9b)][_0x59c8ed(0x92)]({'presence':_0x59c8ed(0x96)}),await _0x499c88[_0x59c8ed(0xa5)][_0x59c8ed(0x9b)][_0x59c8ed(0x89)]();_0x499c88[_0x59c8ed(0xa5)][_0x59c8ed(0x98)]!==null&&_0x499c88[_0x59c8ed(0x98)]===null&&await _0x499c88[_0x59c8ed(0x92)]({'queueId':_0x499c88[_0x59c8ed(0xa5)][_0x59c8ed(0x98)]});if(!_0x499c88)throw new Error(_0x59c8ed(0xaf));const _0x57ef76=(0x0,socket_1[_0x59c8ed(0x86)])();return _0x57ef76['to'](_0x499c88[_0x59c8ed(0x97)][_0x59c8ed(0x8c)]())['to'](_0x59c8ed(0x9a)+_0x1d93d6+'-'+_0x499c88[_0x59c8ed(0xa5)][_0x59c8ed(0xac)])['to'](_0x59c8ed(0x9a)+_0x1d93d6+_0x59c8ed(0xae))['to']('queue-'+_0x499c88[_0x59c8ed(0xa5)][_0x59c8ed(0x98)]+'-'+_0x499c88['ticket'][_0x59c8ed(0xac)])['to']('queue-'+_0x499c88[_0x59c8ed(0xa5)][_0x59c8ed(0x98)]+_0x59c8ed(0xae))[_0x59c8ed(0xa3)](_0x59c8ed(0x9a)+_0x1d93d6+_0x59c8ed(0xa8),{'action':_0x59c8ed(0x9e),'message':_0x499c88,'ticket':_0x499c88[_0x59c8ed(0xa5)],'contact':_0x499c88[_0x59c8ed(0xa5)][_0x59c8ed(0x9b)]}),_0x57ef76['to']('company-'+_0x1d93d6+'-mainchannel')[_0x59c8ed(0xa3)](_0x59c8ed(0x9a)+_0x1d93d6+_0x59c8ed(0x91),{'action':'update','contact':_0x499c88[_0x59c8ed(0xa5)]['contact']}),logger_1['logger']['debug']({'company':_0x1d93d6,'ticket':_0x499c88[_0x59c8ed(0x97)],'queue':_0x499c88[_0x59c8ed(0xa5)][_0x59c8ed(0x98)],'status':_0x499c88[_0x59c8ed(0xa5)][_0x59c8ed(0xac)]},_0x59c8ed(0xb2)),_0x499c88;};exports[a479_0x3e2913(0xa6)]=CreateMessageService;