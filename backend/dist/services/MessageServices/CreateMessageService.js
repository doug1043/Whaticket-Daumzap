const a476_0x266737=a476_0x3761;function a476_0x4a98(){const _0x11b84f=['ticketId','findOne','constructor','3527660JydlmW','update','../../models/Whatsapp','../../utils/logger','default','../../models/Ticket','search','create','5721990zUzqkB','contact','defineProperty','oldMessages','__importDefault','debug','-notification','4883764DFXhVV','338379rWMdRC','logger','-contact','-mainchannel','-appMessage','8bGprEl','8RqowJJ','ERR_CREATING_MESSAGE','48175020UEiymk','whatsapp','queue','../../models/Message','queueId','(((.+)+)+)+$','toString','1215949pnjHFg','upsert','emit','reload','status','452070sZRbYL','../../libs/socket','queue-','ticket','__esModule','sending\x20create\x20message\x20to\x20clients','company-'];a476_0x4a98=function(){return _0x11b84f;};return a476_0x4a98();}(function(_0x2e1d98,_0x8d5803){const _0x2b064a=a476_0x3761,_0x59e704=_0x2e1d98();while(!![]){try{const _0x13c105=parseInt(_0x2b064a(0x178))/0x1*(-parseInt(_0x2b064a(0x17e))/0x2)+-parseInt(_0x2b064a(0x18c))/0x3+-parseInt(_0x2b064a(0x177))/0x4+-parseInt(_0x2b064a(0x196))/0x5+-parseInt(_0x2b064a(0x19e))/0x6+parseInt(_0x2b064a(0x187))/0x7*(-parseInt(_0x2b064a(0x17d))/0x8)+parseInt(_0x2b064a(0x180))/0x9;if(_0x13c105===_0x8d5803)break;else _0x59e704['push'](_0x59e704['shift']());}catch(_0x26189a){_0x59e704['push'](_0x59e704['shift']());}}}(a476_0x4a98,0xc2069));const a476_0x3d2883=(function(){let _0x5beb77=!![];return function(_0x219ee8,_0x4fb45d){const _0x268eb3=_0x5beb77?function(){if(_0x4fb45d){const _0x252373=_0x4fb45d['apply'](_0x219ee8,arguments);return _0x4fb45d=null,_0x252373;}}:function(){};return _0x5beb77=![],_0x268eb3;};}()),a476_0x1eb29a=a476_0x3d2883(this,function(){const _0x5a1f0d=a476_0x3761;return a476_0x1eb29a['toString']()[_0x5a1f0d(0x19c)](_0x5a1f0d(0x185))['toString']()[_0x5a1f0d(0x195)](a476_0x1eb29a)[_0x5a1f0d(0x19c)](_0x5a1f0d(0x185));});a476_0x1eb29a();'use strict';var __importDefault=this&&this[a476_0x266737(0x1a2)]||function(_0x57198b){const _0x2b6040=a476_0x266737;return _0x57198b&&_0x57198b[_0x2b6040(0x190)]?_0x57198b:{'default':_0x57198b};};Object[a476_0x266737(0x1a0)](exports,a476_0x266737(0x190),{'value':!![]});function a476_0x3761(_0xc4c356,_0x9f9a){const _0x20dea4=a476_0x4a98();return a476_0x3761=function(_0x1eb29a,_0x3d2883){_0x1eb29a=_0x1eb29a-0x175;let _0x4a98fc=_0x20dea4[_0x1eb29a];return _0x4a98fc;},a476_0x3761(_0xc4c356,_0x9f9a);}const socket_1=require(a476_0x266737(0x18d)),Message_1=__importDefault(require(a476_0x266737(0x183))),OldMessage_1=__importDefault(require('../../models/OldMessage')),Ticket_1=__importDefault(require(a476_0x266737(0x19b))),Whatsapp_1=__importDefault(require(a476_0x266737(0x198))),logger_1=require(a476_0x266737(0x199)),CreateMessageService=async({messageData:_0x461d07,companyId:_0x22135c})=>{const _0x3238fa=a476_0x266737;await Message_1[_0x3238fa(0x19a)][_0x3238fa(0x188)]({..._0x461d07,'companyId':_0x22135c});const _0x3d00ac=await Message_1['default'][_0x3238fa(0x194)]({'where':{'id':_0x461d07['id'],'ticketId':_0x461d07[_0x3238fa(0x193)]},'include':[_0x3238fa(0x19f),{'model':Ticket_1[_0x3238fa(0x19a)],'as':_0x3238fa(0x18f),'include':[_0x3238fa(0x19f),_0x3238fa(0x182),{'model':Whatsapp_1[_0x3238fa(0x19a)],'as':_0x3238fa(0x181),'attributes':['name','id']}]},{'model':Message_1[_0x3238fa(0x19a)],'as':'quotedMsg','include':[_0x3238fa(0x19f)],'where':{'companyId':_0x22135c},'required':![]},{'model':OldMessage_1[_0x3238fa(0x19a)],'as':_0x3238fa(0x1a1),'where':{'ticketId':_0x461d07[_0x3238fa(0x193)]},'required':![]}]});await _0x3d00ac[_0x3238fa(0x18f)][_0x3238fa(0x19f)][_0x3238fa(0x197)]({'presence':'available'}),await _0x3d00ac['ticket'][_0x3238fa(0x19f)][_0x3238fa(0x18a)]();_0x3d00ac['ticket'][_0x3238fa(0x184)]!==null&&_0x3d00ac[_0x3238fa(0x184)]===null&&await _0x3d00ac[_0x3238fa(0x197)]({'queueId':_0x3d00ac[_0x3238fa(0x18f)][_0x3238fa(0x184)]});if(!_0x3d00ac)throw new Error(_0x3238fa(0x17f));const _0x1d44e6=(0x0,socket_1['getIO'])();return _0x1d44e6['to'](_0x3d00ac[_0x3238fa(0x193)][_0x3238fa(0x186)]())['to'](_0x3238fa(0x192)+_0x22135c+'-'+_0x3d00ac['ticket'][_0x3238fa(0x18b)])['to'](_0x3238fa(0x192)+_0x22135c+_0x3238fa(0x176))['to'](_0x3238fa(0x18e)+_0x3d00ac['ticket']['queueId']+'-'+_0x3d00ac['ticket']['status'])['to'](_0x3238fa(0x18e)+_0x3d00ac[_0x3238fa(0x18f)][_0x3238fa(0x184)]+_0x3238fa(0x176))[_0x3238fa(0x189)](_0x3238fa(0x192)+_0x22135c+_0x3238fa(0x17c),{'action':_0x3238fa(0x19d),'message':_0x3d00ac,'ticket':_0x3d00ac['ticket'],'contact':_0x3d00ac['ticket'][_0x3238fa(0x19f)]}),_0x1d44e6['to']('company-'+_0x22135c+_0x3238fa(0x17b))[_0x3238fa(0x189)]('company-'+_0x22135c+_0x3238fa(0x17a),{'action':_0x3238fa(0x197),'contact':_0x3d00ac['ticket']['contact']}),logger_1[_0x3238fa(0x179)][_0x3238fa(0x175)]({'company':_0x22135c,'ticket':_0x3d00ac[_0x3238fa(0x193)],'queue':_0x3d00ac[_0x3238fa(0x18f)][_0x3238fa(0x184)],'status':_0x3d00ac['ticket'][_0x3238fa(0x18b)]},_0x3238fa(0x191)),_0x3d00ac;};exports['default']=CreateMessageService;