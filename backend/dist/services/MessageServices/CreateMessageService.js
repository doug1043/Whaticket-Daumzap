function a479_0x2487(_0x3dbdb5,_0x2d18f1){const _0xbf0f11=a479_0x273b();return a479_0x2487=function(_0x5acbf2,_0x28a4b1){_0x5acbf2=_0x5acbf2-0x143;let _0x273b2c=_0xbf0f11[_0x5acbf2];return _0x273b2c;},a479_0x2487(_0x3dbdb5,_0x2d18f1);}const a479_0x29987d=a479_0x2487;(function(_0x572d15,_0x2332ad){const _0x869aca=a479_0x2487,_0x55983c=_0x572d15();while(!![]){try{const _0x3bb7d3=-parseInt(_0x869aca(0x150))/0x1*(parseInt(_0x869aca(0x15c))/0x2)+parseInt(_0x869aca(0x158))/0x3+-parseInt(_0x869aca(0x161))/0x4+-parseInt(_0x869aca(0x144))/0x5+parseInt(_0x869aca(0x14f))/0x6+-parseInt(_0x869aca(0x167))/0x7*(parseInt(_0x869aca(0x148))/0x8)+parseInt(_0x869aca(0x169))/0x9*(parseInt(_0x869aca(0x165))/0xa);if(_0x3bb7d3===_0x2332ad)break;else _0x55983c['push'](_0x55983c['shift']());}catch(_0x4d53c3){_0x55983c['push'](_0x55983c['shift']());}}}(a479_0x273b,0x5ce6c));const a479_0x28a4b1=(function(){let _0x1ed5c5=!![];return function(_0x34c414,_0x26af38){const _0x24c3bd=_0x1ed5c5?function(){const _0x193e08=a479_0x2487;if(_0x26af38){const _0x653ce=_0x26af38[_0x193e08(0x147)](_0x34c414,arguments);return _0x26af38=null,_0x653ce;}}:function(){};return _0x1ed5c5=![],_0x24c3bd;};}()),a479_0x5acbf2=a479_0x28a4b1(this,function(){const _0x21ee84=a479_0x2487;return a479_0x5acbf2[_0x21ee84(0x14b)]()[_0x21ee84(0x159)](_0x21ee84(0x145))[_0x21ee84(0x14b)]()['constructor'](a479_0x5acbf2)[_0x21ee84(0x159)](_0x21ee84(0x145));});a479_0x5acbf2();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x341795){const _0x2dca58=a479_0x2487;return _0x341795&&_0x341795[_0x2dca58(0x151)]?_0x341795:{'default':_0x341795};};Object[a479_0x29987d(0x157)](exports,'__esModule',{'value':!![]});function a479_0x273b(){const _0x482c30=['sending\x20create\x20message\x20to\x20clients','queue','16PwgziM','emit','company-','-notification','-appMessage','1567548tTwTAi','update','debug','queue-','2050ASGopN','queueId','532vOwfkk','ticketId','68877SOSJdv','ticket','oldMessages','quotedMsg','1623980ozDYwZ','(((.+)+)+)+$','default','apply','63736maUlve','ERR_CREATING_MESSAGE','name','toString','upsert','status','findOne','1715226EUIChG','91603BdVQhW','__esModule','getIO','../../utils/logger','../../models/Whatsapp','contact','../../models/Message','defineProperty','1742361GdPCCO','search'];a479_0x273b=function(){return _0x482c30;};return a479_0x273b();}const socket_1=require('../../libs/socket'),Message_1=__importDefault(require(a479_0x29987d(0x156))),OldMessage_1=__importDefault(require('../../models/OldMessage')),Ticket_1=__importDefault(require('../../models/Ticket')),Whatsapp_1=__importDefault(require(a479_0x29987d(0x154))),logger_1=require(a479_0x29987d(0x153)),CreateMessageService=async({messageData:_0x50dafc,companyId:_0x96636a})=>{const _0x26297d=a479_0x29987d;await Message_1['default'][_0x26297d(0x14c)]({..._0x50dafc,'companyId':_0x96636a});const _0x966824=await Message_1[_0x26297d(0x146)][_0x26297d(0x14e)]({'where':{'id':_0x50dafc['id'],'ticketId':_0x50dafc['ticketId']},'include':['contact',{'model':Ticket_1[_0x26297d(0x146)],'as':_0x26297d(0x16a),'include':['contact',_0x26297d(0x15b),{'model':Whatsapp_1[_0x26297d(0x146)],'as':'whatsapp','attributes':[_0x26297d(0x14a),'id']}]},{'model':Message_1['default'],'as':_0x26297d(0x143),'include':[_0x26297d(0x155)],'where':{'companyId':_0x96636a},'required':![]},{'model':OldMessage_1['default'],'as':_0x26297d(0x16b),'where':{'ticketId':_0x50dafc[_0x26297d(0x168)]},'required':![]}]});await _0x966824[_0x26297d(0x16a)][_0x26297d(0x155)][_0x26297d(0x162)]({'presence':'available'}),await _0x966824[_0x26297d(0x16a)][_0x26297d(0x155)]['reload']();_0x966824[_0x26297d(0x16a)][_0x26297d(0x166)]!==null&&_0x966824[_0x26297d(0x166)]===null&&await _0x966824[_0x26297d(0x162)]({'queueId':_0x966824[_0x26297d(0x16a)]['queueId']});if(!_0x966824)throw new Error(_0x26297d(0x149));const _0x5e4b13=(0x0,socket_1[_0x26297d(0x152)])();return _0x5e4b13['to'](_0x966824[_0x26297d(0x168)]['toString']())['to'](_0x26297d(0x15e)+_0x96636a+'-'+_0x966824['ticket'][_0x26297d(0x14d)])['to'](_0x26297d(0x15e)+_0x96636a+'-notification')['to'](_0x26297d(0x164)+_0x966824[_0x26297d(0x16a)][_0x26297d(0x166)]+'-'+_0x966824[_0x26297d(0x16a)][_0x26297d(0x14d)])['to'](_0x26297d(0x164)+_0x966824[_0x26297d(0x16a)][_0x26297d(0x166)]+_0x26297d(0x15f))[_0x26297d(0x15d)]('company-'+_0x96636a+_0x26297d(0x160),{'action':'create','message':_0x966824,'ticket':_0x966824[_0x26297d(0x16a)],'contact':_0x966824[_0x26297d(0x16a)]['contact']}),_0x5e4b13['to'](_0x26297d(0x15e)+_0x96636a+'-mainchannel')[_0x26297d(0x15d)](_0x26297d(0x15e)+_0x96636a+'-contact',{'action':_0x26297d(0x162),'contact':_0x966824['ticket']['contact']}),logger_1['logger'][_0x26297d(0x163)]({'company':_0x96636a,'ticket':_0x966824[_0x26297d(0x168)],'queue':_0x966824[_0x26297d(0x16a)][_0x26297d(0x166)],'status':_0x966824[_0x26297d(0x16a)]['status']},_0x26297d(0x15a)),_0x966824;};exports[a479_0x29987d(0x146)]=CreateMessageService;