const a470_0x1ecf70=a470_0x1879;(function(_0x21fb1d,_0x24156a){const _0x3d0275=a470_0x1879,_0x24f285=_0x21fb1d();while(!![]){try{const _0x26b1b8=parseInt(_0x3d0275(0xa7))/0x1+parseInt(_0x3d0275(0xaa))/0x2*(-parseInt(_0x3d0275(0x8d))/0x3)+parseInt(_0x3d0275(0x8f))/0x4*(-parseInt(_0x3d0275(0x9d))/0x5)+-parseInt(_0x3d0275(0x87))/0x6+-parseInt(_0x3d0275(0x96))/0x7*(-parseInt(_0x3d0275(0x8a))/0x8)+parseInt(_0x3d0275(0x88))/0x9+parseInt(_0x3d0275(0x9c))/0xa;if(_0x26b1b8===_0x24156a)break;else _0x24f285['push'](_0x24f285['shift']());}catch(_0x4c81ce){_0x24f285['push'](_0x24f285['shift']());}}}(a470_0x8879,0xdfa0b));function a470_0x8879(){const _0x5a9591=['../../models/Message','../../models/OldMessage','6411560gWkxWc','60PgyAgd','__importDefault','toString','(((.+)+)+)+$','debug','queueId','available','constructor','contact','default','705671xVkgur','upsert','ticketId','2rGLFnQ','-contact','update','oldMessages','-mainchannel','defineProperty','../../models/Ticket','status','3785832bQiQqx','15136119PJoefJ','__esModule','24LpwLDq','reload','queue','5418459TfFGDf','-notification','234008PJdzyq','ticket','create','sending\x20create\x20message\x20to\x20clients','search','-appMessage','name','2395190HwEyXZ','../../libs/socket','company-','ERR_CREATING_MESSAGE'];a470_0x8879=function(){return _0x5a9591;};return a470_0x8879();}const a470_0x3ae114=(function(){let _0xb5fcaf=!![];return function(_0xe48294,_0x4e5e83){const _0x31229e=_0xb5fcaf?function(){if(_0x4e5e83){const _0x2e9b64=_0x4e5e83['apply'](_0xe48294,arguments);return _0x4e5e83=null,_0x2e9b64;}}:function(){};return _0xb5fcaf=![],_0x31229e;};}()),a470_0x3bcbd4=a470_0x3ae114(this,function(){const _0x1094fe=a470_0x1879;return a470_0x3bcbd4['toString']()[_0x1094fe(0x93)](_0x1094fe(0xa0))[_0x1094fe(0x9f)]()[_0x1094fe(0xa4)](a470_0x3bcbd4)[_0x1094fe(0x93)](_0x1094fe(0xa0));});function a470_0x1879(_0x1ff380,_0x52cad8){const _0xb115bc=a470_0x8879();return a470_0x1879=function(_0x3bcbd4,_0x3ae114){_0x3bcbd4=_0x3bcbd4-0x84;let _0x8879cb=_0xb115bc[_0x3bcbd4];return _0x8879cb;},a470_0x1879(_0x1ff380,_0x52cad8);}a470_0x3bcbd4();'use strict';var __importDefault=this&&this[a470_0x1ecf70(0x9e)]||function(_0x2d7fe5){const _0x4043ee=a470_0x1ecf70;return _0x2d7fe5&&_0x2d7fe5[_0x4043ee(0x89)]?_0x2d7fe5:{'default':_0x2d7fe5};};Object[a470_0x1ecf70(0x84)](exports,'__esModule',{'value':!![]});const socket_1=require(a470_0x1ecf70(0x97)),Message_1=__importDefault(require(a470_0x1ecf70(0x9a))),OldMessage_1=__importDefault(require(a470_0x1ecf70(0x9b))),Ticket_1=__importDefault(require(a470_0x1ecf70(0x85))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),logger_1=require('../../utils/logger'),CreateMessageService=async({messageData:_0x2f93c3,companyId:_0x43e18f})=>{const _0x22a7de=a470_0x1ecf70;await Message_1[_0x22a7de(0xa6)][_0x22a7de(0xa8)]({..._0x2f93c3,'companyId':_0x43e18f});const _0x2f00af=await Message_1['default']['findOne']({'where':{'id':_0x2f93c3['id'],'ticketId':_0x2f93c3[_0x22a7de(0xa9)]},'include':[_0x22a7de(0xa5),{'model':Ticket_1[_0x22a7de(0xa6)],'as':_0x22a7de(0x90),'include':['contact',_0x22a7de(0x8c),{'model':Whatsapp_1[_0x22a7de(0xa6)],'as':'whatsapp','attributes':[_0x22a7de(0x95),'id']}]},{'model':Message_1[_0x22a7de(0xa6)],'as':'quotedMsg','include':[_0x22a7de(0xa5)],'where':{'companyId':_0x43e18f},'required':![]},{'model':OldMessage_1[_0x22a7de(0xa6)],'as':_0x22a7de(0xad),'where':{'ticketId':_0x2f93c3[_0x22a7de(0xa9)]},'required':![]}]});await _0x2f00af[_0x22a7de(0x90)][_0x22a7de(0xa5)][_0x22a7de(0xac)]({'presence':_0x22a7de(0xa3)}),await _0x2f00af['ticket'][_0x22a7de(0xa5)][_0x22a7de(0x8b)]();_0x2f00af['ticket'][_0x22a7de(0xa2)]!==null&&_0x2f00af['queueId']===null&&await _0x2f00af[_0x22a7de(0xac)]({'queueId':_0x2f00af[_0x22a7de(0x90)][_0x22a7de(0xa2)]});if(!_0x2f00af)throw new Error(_0x22a7de(0x99));const _0x20a96e=(0x0,socket_1['getIO'])();return _0x20a96e['to'](_0x2f00af['ticketId']['toString']())['to'](_0x22a7de(0x98)+_0x43e18f+'-'+_0x2f00af[_0x22a7de(0x90)][_0x22a7de(0x86)])['to'](_0x22a7de(0x98)+_0x43e18f+_0x22a7de(0x8e))['to']('queue-'+_0x2f00af[_0x22a7de(0x90)]['queueId']+'-'+_0x2f00af[_0x22a7de(0x90)][_0x22a7de(0x86)])['to']('queue-'+_0x2f00af['ticket'][_0x22a7de(0xa2)]+_0x22a7de(0x8e))['emit'](_0x22a7de(0x98)+_0x43e18f+_0x22a7de(0x94),{'action':_0x22a7de(0x91),'message':_0x2f00af,'ticket':_0x2f00af[_0x22a7de(0x90)],'contact':_0x2f00af[_0x22a7de(0x90)][_0x22a7de(0xa5)]}),_0x20a96e['to']('company-'+_0x43e18f+_0x22a7de(0xae))['emit'](_0x22a7de(0x98)+_0x43e18f+_0x22a7de(0xab),{'action':_0x22a7de(0xac),'contact':_0x2f00af['ticket'][_0x22a7de(0xa5)]}),logger_1['logger'][_0x22a7de(0xa1)]({'company':_0x43e18f,'ticket':_0x2f00af[_0x22a7de(0xa9)],'queue':_0x2f00af['ticket'][_0x22a7de(0xa2)],'status':_0x2f00af[_0x22a7de(0x90)][_0x22a7de(0x86)]},_0x22a7de(0x92)),_0x2f00af;};exports[a470_0x1ecf70(0xa6)]=CreateMessageService;