function a579_0x2571(_0x321851,_0x2156a1){const _0x2aea6b=a579_0x24cc();return a579_0x2571=function(_0x856b7f,_0x35f33e){_0x856b7f=_0x856b7f-0x1f1;let _0x24cc96=_0x2aea6b[_0x856b7f];return _0x24cc96;},a579_0x2571(_0x321851,_0x2156a1);}const a579_0x12cb4e=a579_0x2571;(function(_0x25d7cc,_0x570f0c){const _0x58647c=a579_0x2571,_0xf07fa4=_0x25d7cc();while(!![]){try{const _0x22e563=parseInt(_0x58647c(0x1ff))/0x1+-parseInt(_0x58647c(0x21c))/0x2*(parseInt(_0x58647c(0x1f8))/0x3)+parseInt(_0x58647c(0x202))/0x4+-parseInt(_0x58647c(0x21a))/0x5+-parseInt(_0x58647c(0x1f5))/0x6+-parseInt(_0x58647c(0x1fb))/0x7*(-parseInt(_0x58647c(0x208))/0x8)+-parseInt(_0x58647c(0x1f9))/0x9*(-parseInt(_0x58647c(0x205))/0xa);if(_0x22e563===_0x570f0c)break;else _0xf07fa4['push'](_0xf07fa4['shift']());}catch(_0x2528da){_0xf07fa4['push'](_0xf07fa4['shift']());}}}(a579_0x24cc,0x1cfc4));const a579_0x35f33e=(function(){let _0x47cd9b=!![];return function(_0x464da8,_0x3f39bf){const _0x3cd6e8=_0x47cd9b?function(){const _0xe7d0de=a579_0x2571;if(_0x3f39bf){const _0x3e28da=_0x3f39bf[_0xe7d0de(0x1f2)](_0x464da8,arguments);return _0x3f39bf=null,_0x3e28da;}}:function(){};return _0x47cd9b=![],_0x3cd6e8;};}()),a579_0x856b7f=a579_0x35f33e(this,function(){const _0x4b11b2=a579_0x2571;return a579_0x856b7f[_0x4b11b2(0x1fc)]()['search'](_0x4b11b2(0x1f6))[_0x4b11b2(0x1fc)]()['constructor'](a579_0x856b7f)['search'](_0x4b11b2(0x1f6));});a579_0x856b7f();'use strict';var __importDefault=this&&this[a579_0x12cb4e(0x1f7)]||function(_0x5e28a2){return _0x5e28a2&&_0x5e28a2['__esModule']?_0x5e28a2:{'default':_0x5e28a2};};function a579_0x24cc(){const _0x2d70a8=['873076qvOHVU','emit','default','10McGXtu','defineProperty','../../libs/socket','16VEcezt','../../models/Whatsapp','queue','reload','../../models/Ticket','getIO','contact','ticketId','quotedMsg','findOne','company-','queueId','ticket','sending\x20create\x20message\x20to\x20clients','oldMessages','update','-mainchannel','-notification','784400JAKMCr','ERR_CREATING_MESSAGE','3694QBPGTi','-appMessage','apply','debug','../../models/Message','1049922ORUiYF','(((.+)+)+)+$','__importDefault','348BRyeOC','520452aHumVz','name','550718ArfsQm','toString','available','queue-','231398heosMK','status','logger'];a579_0x24cc=function(){return _0x2d70a8;};return a579_0x24cc();}Object[a579_0x12cb4e(0x206)](exports,'__esModule',{'value':!![]});const socket_1=require(a579_0x12cb4e(0x207)),Message_1=__importDefault(require(a579_0x12cb4e(0x1f4))),OldMessage_1=__importDefault(require('../../models/OldMessage')),Ticket_1=__importDefault(require(a579_0x12cb4e(0x20c))),Whatsapp_1=__importDefault(require(a579_0x12cb4e(0x209))),logger_1=require('../../utils/logger'),CreateMessageService=async({messageData:_0x5ca9cc,companyId:_0xbd9e7e})=>{const _0x232c0c=a579_0x12cb4e;await Message_1['default']['upsert']({..._0x5ca9cc,'companyId':_0xbd9e7e});const _0x37a55a=await Message_1[_0x232c0c(0x204)][_0x232c0c(0x211)]({'where':{'id':_0x5ca9cc['id'],'ticketId':_0x5ca9cc[_0x232c0c(0x20f)]},'include':[_0x232c0c(0x20e),{'model':Ticket_1[_0x232c0c(0x204)],'as':_0x232c0c(0x214),'include':['contact',_0x232c0c(0x20a),{'model':Whatsapp_1['default'],'as':'whatsapp','attributes':[_0x232c0c(0x1fa),'id']}]},{'model':Message_1['default'],'as':_0x232c0c(0x210),'include':[_0x232c0c(0x20e)],'where':{'companyId':_0xbd9e7e},'required':![]},{'model':OldMessage_1[_0x232c0c(0x204)],'as':_0x232c0c(0x216),'where':{'ticketId':_0x5ca9cc[_0x232c0c(0x20f)]},'required':![]}]});await _0x37a55a[_0x232c0c(0x214)]['contact'][_0x232c0c(0x217)]({'presence':_0x232c0c(0x1fd)}),await _0x37a55a[_0x232c0c(0x214)]['contact'][_0x232c0c(0x20b)]();_0x37a55a[_0x232c0c(0x214)]['queueId']!==null&&_0x37a55a[_0x232c0c(0x213)]===null&&await _0x37a55a['update']({'queueId':_0x37a55a[_0x232c0c(0x214)][_0x232c0c(0x213)]});if(!_0x37a55a)throw new Error(_0x232c0c(0x21b));const _0x361336=(0x0,socket_1[_0x232c0c(0x20d)])();return _0x361336['to'](_0x37a55a[_0x232c0c(0x20f)][_0x232c0c(0x1fc)]())['to'](_0x232c0c(0x212)+_0xbd9e7e+'-'+_0x37a55a[_0x232c0c(0x214)][_0x232c0c(0x200)])['to'](_0x232c0c(0x212)+_0xbd9e7e+_0x232c0c(0x219))['to'](_0x232c0c(0x1fe)+_0x37a55a['ticket'][_0x232c0c(0x213)]+'-'+_0x37a55a[_0x232c0c(0x214)][_0x232c0c(0x200)])['to']('queue-'+_0x37a55a['ticket']['queueId']+'-notification')[_0x232c0c(0x203)]('company-'+_0xbd9e7e+_0x232c0c(0x1f1),{'action':'create','message':_0x37a55a,'ticket':_0x37a55a[_0x232c0c(0x214)],'contact':_0x37a55a['ticket'][_0x232c0c(0x20e)]}),_0x361336['to'](_0x232c0c(0x212)+_0xbd9e7e+_0x232c0c(0x218))[_0x232c0c(0x203)]('company-'+_0xbd9e7e+'-contact',{'action':_0x232c0c(0x217),'contact':_0x37a55a['ticket'][_0x232c0c(0x20e)]}),logger_1[_0x232c0c(0x201)][_0x232c0c(0x1f3)]({'company':_0xbd9e7e,'ticket':_0x37a55a[_0x232c0c(0x20f)],'queue':_0x37a55a[_0x232c0c(0x214)][_0x232c0c(0x213)],'status':_0x37a55a[_0x232c0c(0x214)][_0x232c0c(0x200)]},_0x232c0c(0x215)),_0x37a55a;};exports[a579_0x12cb4e(0x204)]=CreateMessageService;