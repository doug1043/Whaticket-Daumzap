const a491_0x2a3e57=a491_0x3341;(function(_0x171dad,_0x228842){const _0x1f022c=a491_0x3341,_0x2b0952=_0x171dad();while(!![]){try{const _0x53eb3a=-parseInt(_0x1f022c(0x13b))/0x1+parseInt(_0x1f022c(0x160))/0x2+-parseInt(_0x1f022c(0x14f))/0x3+parseInt(_0x1f022c(0x143))/0x4+parseInt(_0x1f022c(0x15f))/0x5+parseInt(_0x1f022c(0x13a))/0x6*(-parseInt(_0x1f022c(0x146))/0x7)+parseInt(_0x1f022c(0x155))/0x8;if(_0x53eb3a===_0x228842)break;else _0x2b0952['push'](_0x2b0952['shift']());}catch(_0x1b9c10){_0x2b0952['push'](_0x2b0952['shift']());}}}(a491_0x1a5c,0xedfb3));function a491_0x3341(_0x25c8c8,_0x27bf6a){const _0x210684=a491_0x1a5c();return a491_0x3341=function(_0x531891,_0x246bc2){_0x531891=_0x531891-0x138;let _0x1a5c00=_0x210684[_0x531891];return _0x1a5c00;},a491_0x3341(_0x25c8c8,_0x27bf6a);}const a491_0x246bc2=(function(){let _0x446443=!![];return function(_0x2e6e74,_0x2cfca6){const _0x47e1f6=_0x446443?function(){const _0x1057f0=a491_0x3341;if(_0x2cfca6){const _0x49b4a6=_0x2cfca6[_0x1057f0(0x153)](_0x2e6e74,arguments);return _0x2cfca6=null,_0x49b4a6;}}:function(){};return _0x446443=![],_0x47e1f6;};}()),a491_0x531891=a491_0x246bc2(this,function(){const _0x2ef55e=a491_0x3341;return a491_0x531891[_0x2ef55e(0x149)]()['search'](_0x2ef55e(0x144))[_0x2ef55e(0x149)]()[_0x2ef55e(0x157)](a491_0x531891)[_0x2ef55e(0x154)](_0x2ef55e(0x144));});a491_0x531891();'use strict';function a491_0x1a5c(){const _0x191e61=['Erro\x20ao\x20redefinir\x20senha:','error','UPDATE\x20\x22Users\x22\x20SET\x20\x22passwordHash\x22=\x20\x27','sequelize','1158420fchXKz','717254NRpZPR','Erro\x20interno\x20do\x20servidor','nodemailer','222990lbTsXO','1535544SWPSbv','__importDefault','SELECT\x20*\x20FROM\x20\x22Users\x22\x20WHERE\x20email\x20=\x20\x27','length','UPDATE','query','sendMail','createTransport','6504424lMAGym','(((.+)+)+)+$','clientsecretsmtpauth','245MmKKoP','Email\x20ou\x20token\x20não\x20encontrado','findOne','toString','Token\x20não\x20encontrado\x20ou\x20inválido','bcryptjs','smtpauth','usersmtpauth','value','5812431AjUIoO','\x27,\x20\x22resetPassword\x22\x20=\x20\x27\x27\x20WHERE\x20email=\x20\x27','default','QueryTypes','apply','search','28257200tHseMJ','SELECT','constructor','Senha\x20Alterada\x20com\x20Sucesso','__esModule','../../database'];a491_0x1a5c=function(){return _0x191e61;};return a491_0x1a5c();}var __importDefault=this&&this[a491_0x2a3e57(0x13c)]||function(_0x4642f3){const _0x1beaf0=a491_0x2a3e57;return _0x4642f3&&_0x4642f3[_0x1beaf0(0x159)]?_0x4642f3:{'default':_0x4642f3};};Object['defineProperty'](exports,a491_0x2a3e57(0x159),{'value':!![]});const sequelize_1=__importDefault(require(a491_0x2a3e57(0x15e))),database_1=__importDefault(require(a491_0x2a3e57(0x15a))),nodemailer_1=__importDefault(require(a491_0x2a3e57(0x139))),Setting_1=__importDefault(require('../../models/Setting')),bcryptjs_1=require(a491_0x2a3e57(0x14b)),ResetPassword=async(_0x31a817,_0x3d2265,_0x460054)=>{const _0x5aa42e=a491_0x2a3e57;try{const {hasResult:_0x3f03cf,data:_0x380519}=await filterUser(_0x31a817,_0x3d2265);if(!_0x3f03cf)return{'status':0x194,'message':_0x5aa42e(0x147)};const _0x470f9e=await(0x0,bcryptjs_1['hash'])(_0x460054,0x8),{hasResults:_0x59a571,datas:_0x225e08}=await insertHasPassword(_0x31a817,_0x3d2265,_0x470f9e);if(!_0x59a571)return{'status':0x194,'message':_0x5aa42e(0x14a)};const [_0x5b79d5,_0x1c3965,_0x29dcfb,_0x2d9d1b]=await Promise['all']([Setting_1[_0x5aa42e(0x151)]['findOne']({'where':{'key':_0x5aa42e(0x14c)}}),Setting_1[_0x5aa42e(0x151)][_0x5aa42e(0x148)]({'where':{'key':_0x5aa42e(0x14d)}}),Setting_1[_0x5aa42e(0x151)]['findOne']({'where':{'key':_0x5aa42e(0x145)}}),Setting_1['default'][_0x5aa42e(0x148)]({'where':{'key':'smtpport'}})]),_0x4975fb=_0x5b79d5?.[_0x5aa42e(0x14e)],_0x253024=_0x1c3965?.['value'],_0x431b70=_0x29dcfb?.[_0x5aa42e(0x14e)],_0x112c87=_0x253024,_0x424138=_0x2d9d1b?.['value'];if(!_0x4975fb||!_0x253024||!_0x431b70||!_0x424138)throw new Error('Configurações\x20SMTP\x20estão\x20incompletas');const _0x1d7426=nodemailer_1[_0x5aa42e(0x151)][_0x5aa42e(0x142)]({'host':_0x4975fb,'port':Number(_0x424138),'secure':![],'auth':{'user':_0x253024,'pass':_0x431b70}}),_0x482cce={'from':_0x112c87,'to':_0x31a817,'subject':_0x5aa42e(0x158),'text':'Olá,\x0a\x0aSua\x20senha\x20foi\x20alterada\x20com\x20sucesso.\x0a\x0aSe\x20você\x20não\x20realizou\x20essa\x20alteração,\x20entre\x20em\x20contato\x20conosco\x20imediatamente.\x0a\x0aAtenciosamente'},_0x477167=await _0x1d7426[_0x5aa42e(0x141)](_0x482cce);return _0x477167;}catch(_0x19b9fd){return console[_0x5aa42e(0x15c)](_0x5aa42e(0x15b),_0x19b9fd),{'status':0x1f4,'message':_0x5aa42e(0x138)};}},filterUser=async(_0x347fdf,_0x284bfc)=>{const _0xecd56b=a491_0x2a3e57,_0x241d11='SELECT\x20*\x20FROM\x20\x22Users\x22\x20WHERE\x20email\x20=\x20\x27'+_0x347fdf+'\x27\x20AND\x20\x22resetPassword\x22\x20!=\x20\x27\x27',_0x33a624=await database_1['default'][_0xecd56b(0x140)](_0x241d11,{'type':sequelize_1[_0xecd56b(0x151)][_0xecd56b(0x152)][_0xecd56b(0x156)]});return{'hasResult':_0x33a624[_0xecd56b(0x13e)]>0x0,'data':_0x33a624};},insertHasPassword=async(_0x2707d7,_0xa79f63,_0x3f98e9)=>{const _0x4840f2=a491_0x2a3e57,_0x2021e3=_0x4840f2(0x13d)+_0x2707d7+'\x27\x20AND\x20\x22resetPassword\x22\x20=\x20\x27'+_0xa79f63+'\x27',_0x239649=await database_1[_0x4840f2(0x151)][_0x4840f2(0x140)](_0x2021e3,{'type':sequelize_1[_0x4840f2(0x151)][_0x4840f2(0x152)]['SELECT']}),_0x37a28c=_0x4840f2(0x15d)+_0x3f98e9+_0x4840f2(0x150)+_0x2707d7+'\x27\x20AND\x20\x22resetPassword\x22\x20=\x20\x27'+_0xa79f63+'\x27',_0x581a83=await database_1[_0x4840f2(0x151)][_0x4840f2(0x140)](_0x37a28c,{'type':sequelize_1[_0x4840f2(0x151)]['QueryTypes'][_0x4840f2(0x13f)]});return{'hasResults':_0x581a83[0x1]>0x0,'datas':_0x239649};};exports[a491_0x2a3e57(0x151)]=ResetPassword;