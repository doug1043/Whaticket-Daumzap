const a588_0x10742b=a588_0x370e;function a588_0x2112(){const _0x2230b1=['setDate','search','owenCreateSubscription','update','Error\x20getting\x20detail\x20of\x20txid','owenPollCheckStatus:\x20Invoice\x20','770jMOoqG','15ZpqkYJ','reload','paid','findByPk','defineProperty','../../models/Company','debug','owenWebhook','_owenSecretKey','CONCLUIDA','data','get','json','sender','../../utils/logger','apply','2KFdenP','Problema\x20encontrado,\x20entre\x20em\x20contato\x20com\x20o\x20suporte!','toISOString','925300SBbfkN','status','__importDefault','478860qqLKDe','constructor','qrcodeId','error','dueDate','APPROVED','436611qOyvrQ','-payment','../../models/Invoices','getIO','toString','263118FFAKKz','#Fatura:','477qQLRRj','company','processInvoicePaid','companyId','./PaymentGatewayServices','valor','Invoice\x20not\x20found','49863HQIgCv','stringify','axios','company-','__esModule','findOne','logger','super','107208MmqUnf','value','\x20already\x20paid,\x20finishing\x20polling','txId','emit','33176NDMYLc','_owenToken','open','getDate','split','default','(((.+)+)+)+$','owenCreateSubscription\x20error','toFixed','owenCheckStatus'];a588_0x2112=function(){return _0x2230b1;};return a588_0x2112();}(function(_0x32529c,_0x58ef51){const _0x1c79eb=a588_0x370e,_0x5a65a5=_0x32529c();while(!![]){try{const _0x163d46=-parseInt(_0x1c79eb(0x19f))/0x1*(-parseInt(_0x1c79eb(0x1c5))/0x2)+-parseInt(_0x1c79eb(0x1cb))/0x3+parseInt(_0x1c79eb(0x1c8))/0x4+-parseInt(_0x1c79eb(0x1b5))/0x5*(-parseInt(_0x1c79eb(0x18e))/0x6)+-parseInt(_0x1c79eb(0x1d1))/0x7+-parseInt(_0x1c79eb(0x1a4))/0x8*(-parseInt(_0x1c79eb(0x190))/0x9)+parseInt(_0x1c79eb(0x1b4))/0xa*(-parseInt(_0x1c79eb(0x197))/0xb);if(_0x163d46===_0x58ef51)break;else _0x5a65a5['push'](_0x5a65a5['shift']());}catch(_0x4b8692){_0x5a65a5['push'](_0x5a65a5['shift']());}}}(a588_0x2112,0x1d041));const a588_0x59627c=(function(){let _0x8f4cab=!![];return function(_0x4f3126,_0x20dae7){const _0x4a075a=_0x8f4cab?function(){const _0xb3ae9b=a588_0x370e;if(_0x20dae7){const _0x12333f=_0x20dae7[_0xb3ae9b(0x1c4)](_0x4f3126,arguments);return _0x20dae7=null,_0x12333f;}}:function(){};return _0x8f4cab=![],_0x4a075a;};}()),a588_0x7c06fa=a588_0x59627c(this,function(){const _0x579c84=a588_0x370e;return a588_0x7c06fa[_0x579c84(0x18d)]()[_0x579c84(0x1af)]('(((.+)+)+)+$')[_0x579c84(0x18d)]()[_0x579c84(0x1cc)](a588_0x7c06fa)[_0x579c84(0x1af)](_0x579c84(0x1aa));});a588_0x7c06fa();'use strict';var __importDefault=this&&this[a588_0x10742b(0x1ca)]||function(_0x5c7d3f){const _0x38d21f=a588_0x10742b;return _0x5c7d3f&&_0x5c7d3f[_0x38d21f(0x19b)]?_0x5c7d3f:{'default':_0x5c7d3f};};Object[a588_0x10742b(0x1b9)](exports,'__esModule',{'value':!![]}),exports[a588_0x10742b(0x1b0)]=exports[a588_0x10742b(0x1ad)]=exports[a588_0x10742b(0x1bc)]=void 0x0;const axios_1=__importDefault(require(a588_0x10742b(0x199))),GetSuperSettingService_1=__importDefault(require('../SettingServices/GetSuperSettingService')),logger_1=require(a588_0x10742b(0x1c3)),socket_1=require('../../libs/socket'),Invoices_1=__importDefault(require(a588_0x10742b(0x18b))),Company_1=__importDefault(require(a588_0x10742b(0x1ba))),AppError_1=__importDefault(require('../../errors/AppError')),PaymentGatewayServices_1=require(a588_0x10742b(0x194)),owenBaseURL='https://api.apipix.me/v1',owenLoadConfig=async()=>{const _0x2b5d63=a588_0x10742b;return{'user':await(0x0,GetSuperSettingService_1[_0x2b5d63(0x1a9)])({'key':'_owenCnpj'}),'password':await(0x0,GetSuperSettingService_1['default'])({'key':_0x2b5d63(0x1a5)}),'secretkey':await(0x0,GetSuperSettingService_1[_0x2b5d63(0x1a9)])({'key':_0x2b5d63(0x1bd)})};},owenWebhook=async(_0x30e828,_0x257f50)=>{const _0x3228bd=a588_0x10742b,{data:_0x2953d8}=_0x30e828['body'];if(_0x2953d8[_0x3228bd(0x1c9)]===_0x3228bd(0x1d0)){const {qrcodeId:_0x4e9e1c}=_0x2953d8,_0x360854=await Invoices_1[_0x3228bd(0x1a9)][_0x3228bd(0x19c)]({'where':{'txId':_0x4e9e1c,'status':_0x3228bd(0x1a6)},'include':{'model':Company_1[_0x3228bd(0x1a9)],'as':'company'}});if(!_0x360854||_0x2953d8[_0x3228bd(0x195)]<_0x360854[_0x3228bd(0x1a0)])return _0x257f50[_0x3228bd(0x1c1)]({'ok':!![]});const _0x57e376=new Date(_0x360854[_0x3228bd(0x191)][_0x3228bd(0x1cf)]);_0x57e376[_0x3228bd(0x1ae)](_0x57e376[_0x3228bd(0x1a7)]()+0x1e);const _0x4bc8df=_0x57e376[_0x3228bd(0x1c7)]()[_0x3228bd(0x1a8)]('T')[0x0];await _0x360854[_0x3228bd(0x191)][_0x3228bd(0x1b1)]({'dueDate':_0x4bc8df}),await _0x360854['update']({'status':_0x3228bd(0x1b7)}),await _0x360854[_0x3228bd(0x191)][_0x3228bd(0x1b6)]();const _0x5dc97e=(0x0,socket_1[_0x3228bd(0x18c)])();_0x5dc97e['to'](_0x3228bd(0x19a)+_0x360854[_0x3228bd(0x193)]+'-mainchannel')['to'](_0x3228bd(0x19e))[_0x3228bd(0x1a3)]('company-'+_0x360854[_0x3228bd(0x193)]+_0x3228bd(0x1d2),{'action':_0x3228bd(0x1be),'company':_0x360854[_0x3228bd(0x191)],'invoiceId':_0x360854['id']});}return _0x257f50[_0x3228bd(0x1c1)]({'ok':!![]});};exports['owenWebhook']=owenWebhook;const owenCheckStatus=async(_0x45f128,_0xaf4606=null)=>{const _0x4655c7=a588_0x10742b;try{!_0xaf4606&&(_0xaf4606=await owenLoadConfig());const _0x1449ee=await axios_1[_0x4655c7(0x1a9)][_0x4655c7(0x1c0)](owenBaseURL+'/qrstatus',{'params':{'qrcodeId':_0x45f128[_0x4655c7(0x1a2)],..._0xaf4606}});if(_0x1449ee?.[_0x4655c7(0x1bf)]?.[_0x4655c7(0x1bf)]?.[_0x4655c7(0x1c9)]!==_0x4655c7(0x1d0))return![];if(_0x1449ee?.[_0x4655c7(0x1bf)]?.['data']?.[_0x4655c7(0x1c2)]?.['valor']>=_0x45f128[_0x4655c7(0x1a0)])return await(0x0,PaymentGatewayServices_1[_0x4655c7(0x192)])(_0x45f128),!![];return![];}catch(_0x4b1896){logger_1[_0x4655c7(0x19d)][_0x4655c7(0x1ce)](_0x4b1896,_0x4655c7(0x1b2));}return![];};function a588_0x370e(_0x33374d,_0x4b8630){const _0x31b837=a588_0x2112();return a588_0x370e=function(_0x7c06fa,_0x59627c){_0x7c06fa=_0x7c06fa-0x18b;let _0x2112a9=_0x31b837[_0x7c06fa];return _0x2112a9;},a588_0x370e(_0x33374d,_0x4b8630);}exports['owenCheckStatus']=owenCheckStatus;const owenPollCheckStatus=async(_0x29c65a,_0x1de95e,_0x4b134f=0xa,_0x289c9b=0x7530)=>{let _0x419821=0x0;async function _0x371478(){const _0x3c997b=a588_0x370e;await _0x1de95e[_0x3c997b(0x1b6)]();if(_0x1de95e[_0x3c997b(0x1c9)]===_0x3c997b(0x1b7)){logger_1[_0x3c997b(0x19d)][_0x3c997b(0x1bb)](_0x3c997b(0x1b3)+_0x1de95e['id']+_0x3c997b(0x1a1));return;}const _0x45bef9=await(0x0,exports['owenCheckStatus'])(_0x1de95e,_0x29c65a);if(_0x45bef9)return;_0x419821+=0x1;if(_0x419821>=_0x4b134f){(0x0,PaymentGatewayServices_1['processInvoiceExpired'])(_0x1de95e);return;}await new Promise(_0x223c7a=>{setTimeout(_0x223c7a,_0x289c9b);}),await _0x371478();}return _0x371478();},owenCreateSubscription=async(_0x58229b,_0x1fc7e1)=>{const _0x5028b5=a588_0x10742b,{price:_0x4310fa,invoiceId:_0x2d61a9}=_0x58229b['body'],_0x420d33=await owenLoadConfig(),_0x103b12={'params':{'valor':_0x4310fa[_0x5028b5(0x1ac)]([0x2]),'minutos':0x5,'mensagem':_0x5028b5(0x18f)+_0x2d61a9,..._0x420d33}};try{const _0x3e9bb2=await Invoices_1[_0x5028b5(0x1a9)][_0x5028b5(0x1b8)](_0x2d61a9);if(!_0x3e9bb2)throw new Error(_0x5028b5(0x196));const _0x372a19=await axios_1[_0x5028b5(0x1a9)][_0x5028b5(0x1c0)](owenBaseURL+'/qrdinamico',_0x103b12);return _0x3e9bb2[_0x5028b5(0x1b1)]({'value':_0x4310fa,'txId':_0x372a19[_0x5028b5(0x1bf)][_0x5028b5(0x1bf)][_0x5028b5(0x1cd)],'payGw':'owen','payGwData':JSON[_0x5028b5(0x198)](_0x372a19[_0x5028b5(0x1bf)][_0x5028b5(0x1bf)])}),owenPollCheckStatus(_0x420d33,_0x3e9bb2),_0x1fc7e1[_0x5028b5(0x1c1)]({'qrcode':{'qrcode':_0x372a19['data'][_0x5028b5(0x1bf)]['qrcode']},'valor':{'original':_0x4310fa}});}catch(_0x1a3bc6){logger_1[_0x5028b5(0x19d)]['error']({'error':_0x1a3bc6},_0x5028b5(0x1ab));throw new AppError_1[(_0x5028b5(0x1a9))](_0x5028b5(0x1c6),0x190);}};exports['owenCreateSubscription']=owenCreateSubscription;