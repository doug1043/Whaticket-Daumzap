function a478_0xfc86(_0x47044c,_0x1c769a){const _0x3e5f6f=a478_0x32df();return a478_0xfc86=function(_0x3dbafa,_0x2b6669){_0x3dbafa=_0x3dbafa-0x1af;let _0x32df86=_0x3e5f6f[_0x3dbafa];return _0x32df86;},a478_0xfc86(_0x47044c,_0x1c769a);}const a478_0x2ba6fd=a478_0xfc86;(function(_0x4668b0,_0x213973){const _0x2383bf=a478_0xfc86,_0x5b7a67=_0x4668b0();while(!![]){try{const _0x197c0c=-parseInt(_0x2383bf(0x1ce))/0x1+-parseInt(_0x2383bf(0x1bb))/0x2+parseInt(_0x2383bf(0x1d2))/0x3+parseInt(_0x2383bf(0x1b9))/0x4+-parseInt(_0x2383bf(0x1d9))/0x5+-parseInt(_0x2383bf(0x1b5))/0x6*(-parseInt(_0x2383bf(0x1d0))/0x7)+-parseInt(_0x2383bf(0x1c6))/0x8*(-parseInt(_0x2383bf(0x1b6))/0x9);if(_0x197c0c===_0x213973)break;else _0x5b7a67['push'](_0x5b7a67['shift']());}catch(_0x2ea910){_0x5b7a67['push'](_0x5b7a67['shift']());}}}(a478_0x32df,0x71c97));const a478_0x2b6669=(function(){let _0x4d6710=!![];return function(_0x131a61,_0x57ba27){const _0x452a7d=_0x4d6710?function(){const _0x2f3bfe=a478_0xfc86;if(_0x57ba27){const _0x4d9242=_0x57ba27[_0x2f3bfe(0x1e2)](_0x131a61,arguments);return _0x57ba27=null,_0x4d9242;}}:function(){};return _0x4d6710=![],_0x452a7d;};}()),a478_0x3dbafa=a478_0x2b6669(this,function(){const _0x3b5bbe=a478_0xfc86;return a478_0x3dbafa[_0x3b5bbe(0x1b3)]()[_0x3b5bbe(0x1b4)]('(((.+)+)+)+$')[_0x3b5bbe(0x1b3)]()['constructor'](a478_0x3dbafa)[_0x3b5bbe(0x1b4)](_0x3b5bbe(0x1e1));});a478_0x3dbafa();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4dd95a){const _0x3f4cfb=a478_0xfc86;return _0x4dd95a&&_0x4dd95a[_0x3f4cfb(0x1b7)]?_0x4dd95a:{'default':_0x4dd95a};};Object[a478_0x2ba6fd(0x1ec)](exports,a478_0x2ba6fd(0x1b7),{'value':!![]}),exports[a478_0x2ba6fd(0x1e7)]=exports['owenCheckStatus']=exports[a478_0x2ba6fd(0x1f2)]=void 0x0;const axios_1=__importDefault(require('axios')),GetSuperSettingService_1=__importDefault(require(a478_0x2ba6fd(0x1ea))),logger_1=require(a478_0x2ba6fd(0x1cb)),socket_1=require(a478_0x2ba6fd(0x1d8)),Invoices_1=__importDefault(require('../../models/Invoices')),Company_1=__importDefault(require('../../models/Company')),AppError_1=__importDefault(require(a478_0x2ba6fd(0x1cf))),PaymentGatewayServices_1=require(a478_0x2ba6fd(0x1ee)),owenBaseURL=a478_0x2ba6fd(0x1f4),owenLoadConfig=async()=>{const _0x544056=a478_0x2ba6fd;return{'user':await(0x0,GetSuperSettingService_1['default'])({'key':_0x544056(0x1ba)}),'password':await(0x0,GetSuperSettingService_1[_0x544056(0x1de)])({'key':_0x544056(0x1e3)}),'secretkey':await(0x0,GetSuperSettingService_1[_0x544056(0x1de)])({'key':_0x544056(0x1d4)})};},owenWebhook=async(_0x4631bb,_0x2da66c)=>{const _0x4a78c8=a478_0x2ba6fd,{data:_0x4b8ade}=_0x4631bb[_0x4a78c8(0x1e8)];if(_0x4b8ade['status']==='APPROVED'){const {qrcodeId:_0x3525f7}=_0x4b8ade,_0x4f7653=await Invoices_1[_0x4a78c8(0x1de)][_0x4a78c8(0x1c4)]({'where':{'txId':_0x3525f7,'status':'open'},'include':{'model':Company_1[_0x4a78c8(0x1de)],'as':'company'}});if(!_0x4f7653||_0x4b8ade[_0x4a78c8(0x1e0)]<_0x4f7653['value'])return _0x2da66c[_0x4a78c8(0x1c0)]({'ok':!![]});const _0x33e7fb=new Date(_0x4f7653[_0x4a78c8(0x1bc)]['dueDate']);_0x33e7fb[_0x4a78c8(0x1c2)](_0x33e7fb[_0x4a78c8(0x1ed)]()+0x1e);const _0x3e2f00=_0x33e7fb['toISOString']()[_0x4a78c8(0x1c3)]('T')[0x0];await _0x4f7653['company'][_0x4a78c8(0x1c5)]({'dueDate':_0x3e2f00}),await _0x4f7653['update']({'status':_0x4a78c8(0x1d1)}),await _0x4f7653[_0x4a78c8(0x1bc)][_0x4a78c8(0x1cd)]();const _0x536ef1=(0x0,socket_1['getIO'])();_0x536ef1['to']('company-'+_0x4f7653[_0x4a78c8(0x1f0)]+_0x4a78c8(0x1f3))['to'](_0x4a78c8(0x1e5))[_0x4a78c8(0x1f1)](_0x4a78c8(0x1dd)+_0x4f7653[_0x4a78c8(0x1f0)]+'-payment',{'action':_0x4a78c8(0x1db),'company':_0x4f7653['company'],'invoiceId':_0x4f7653['id']});}return _0x2da66c[_0x4a78c8(0x1c0)]({'ok':!![]});};exports[a478_0x2ba6fd(0x1f2)]=owenWebhook;const owenCheckStatus=async(_0x3a5f4a,_0x19c9a6=null)=>{const _0xcb7509=a478_0x2ba6fd;try{!_0x19c9a6&&(_0x19c9a6=await owenLoadConfig());const _0x6f7026=await axios_1[_0xcb7509(0x1de)][_0xcb7509(0x1e4)](owenBaseURL+_0xcb7509(0x1b1),{'params':{'qrcodeId':_0x3a5f4a[_0xcb7509(0x1d5)],..._0x19c9a6}});if(_0x6f7026?.[_0xcb7509(0x1e6)]?.[_0xcb7509(0x1e6)]?.[_0xcb7509(0x1c7)]!==_0xcb7509(0x1eb))return![];if(_0x6f7026?.['data']?.['data']?.['sender']?.[_0xcb7509(0x1e0)]>=_0x3a5f4a[_0xcb7509(0x1d3)])return await(0x0,PaymentGatewayServices_1[_0xcb7509(0x1b0)])(_0x3a5f4a),!![];return![];}catch(_0x22116c){logger_1[_0xcb7509(0x1da)][_0xcb7509(0x1e9)](_0x22116c,_0xcb7509(0x1c1));}return![];};exports[a478_0x2ba6fd(0x1c9)]=owenCheckStatus;const owenPollCheckStatus=async(_0x269410,_0x25c74a,_0x3e9ece=0xa,_0x39271d=0x7530)=>{let _0x31b7d7=0x0;async function _0x5ac9d4(){const _0x417417=a478_0xfc86;await _0x25c74a[_0x417417(0x1cd)]();if(_0x25c74a['status']===_0x417417(0x1d1)){logger_1['logger'][_0x417417(0x1be)](_0x417417(0x1bf)+_0x25c74a['id']+_0x417417(0x1df));return;}const _0xa94868=await(0x0,exports[_0x417417(0x1c9)])(_0x25c74a,_0x269410);if(_0xa94868)return;_0x31b7d7+=0x1;if(_0x31b7d7>=_0x3e9ece){(0x0,PaymentGatewayServices_1[_0x417417(0x1b2)])(_0x25c74a);return;}await new Promise(_0x12ed06=>{setTimeout(_0x12ed06,_0x39271d);}),await _0x5ac9d4();}return _0x5ac9d4();},owenCreateSubscription=async(_0x3e68c4,_0x32ac48)=>{const _0x1d390c=a478_0x2ba6fd,{price:_0x137567,invoiceId:_0xe6dc0f}=_0x3e68c4[_0x1d390c(0x1e8)],_0x53ea59=await owenLoadConfig(),_0x4d43d8={'params':{'valor':_0x137567[_0x1d390c(0x1bd)]([0x2]),'minutos':0x5,'mensagem':_0x1d390c(0x1ca)+_0xe6dc0f,..._0x53ea59}};try{const _0x3f2cae=await Invoices_1['default'][_0x1d390c(0x1b8)](_0xe6dc0f);if(!_0x3f2cae)throw new Error(_0x1d390c(0x1d7));const _0x2fb592=await axios_1['default']['get'](owenBaseURL+_0x1d390c(0x1c8),_0x4d43d8);return _0x3f2cae[_0x1d390c(0x1c5)]({'value':_0x137567,'txId':_0x2fb592[_0x1d390c(0x1e6)][_0x1d390c(0x1e6)][_0x1d390c(0x1ef)],'payGw':_0x1d390c(0x1cc),'payGwData':JSON[_0x1d390c(0x1af)](_0x2fb592[_0x1d390c(0x1e6)][_0x1d390c(0x1e6)])}),owenPollCheckStatus(_0x53ea59,_0x3f2cae),_0x32ac48[_0x1d390c(0x1c0)]({'qrcode':{'qrcode':_0x2fb592[_0x1d390c(0x1e6)][_0x1d390c(0x1e6)][_0x1d390c(0x1d6)]},'valor':{'original':_0x137567}});}catch(_0x49daee){logger_1[_0x1d390c(0x1da)][_0x1d390c(0x1e9)]({'error':_0x49daee},_0x1d390c(0x1dc));throw new AppError_1['default']('Problema\x20encontrado,\x20entre\x20em\x20contato\x20com\x20o\x20suporte!',0x190);}};exports['owenCreateSubscription']=owenCreateSubscription;function a478_0x32df(){const _0xaa6175=['3124780splwhB','_owenCnpj','933772MHROAA','company','toFixed','debug','owenPollCheckStatus:\x20Invoice\x20','json','Error\x20getting\x20detail\x20of\x20txid','setDate','split','findOne','update','8BEZBcQ','status','/qrdinamico','owenCheckStatus','#Fatura:','../../utils/logger','owen','reload','753345oQHPEq','../../errors/AppError','134337rbLpDl','paid','927165UfCOOz','value','_owenSecretKey','txId','qrcode','Invoice\x20not\x20found','../../libs/socket','1106025qvdEpY','logger','CONCLUIDA','owenCreateSubscription\x20error','company-','default','\x20already\x20paid,\x20finishing\x20polling','valor','(((.+)+)+)+$','apply','_owenToken','get','super','data','owenCreateSubscription','body','error','../SettingServices/GetSuperSettingService','APPROVED','defineProperty','getDate','./PaymentGatewayServices','qrcodeId','companyId','emit','owenWebhook','-mainchannel','https://api.apipix.me/v1','stringify','processInvoicePaid','/qrstatus','processInvoiceExpired','toString','search','234qxiBIU','619272CMqKvM','__esModule','findByPk'];a478_0x32df=function(){return _0xaa6175;};return a478_0x32df();}