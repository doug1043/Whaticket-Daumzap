const a488_0x28f006=a488_0x7b82;(function(_0xf32d3b,_0x56d4b0){const _0x30c32c=a488_0x7b82,_0x492034=_0xf32d3b();while(!![]){try{const _0x128ef9=parseInt(_0x30c32c(0x11e))/0x1*(-parseInt(_0x30c32c(0xfd))/0x2)+-parseInt(_0x30c32c(0x126))/0x3+-parseInt(_0x30c32c(0x128))/0x4+-parseInt(_0x30c32c(0x115))/0x5*(parseInt(_0x30c32c(0x100))/0x6)+parseInt(_0x30c32c(0x102))/0x7*(parseInt(_0x30c32c(0xf9))/0x8)+parseInt(_0x30c32c(0x118))/0x9+-parseInt(_0x30c32c(0x10e))/0xa*(-parseInt(_0x30c32c(0xee))/0xb);if(_0x128ef9===_0x56d4b0)break;else _0x492034['push'](_0x492034['shift']());}catch(_0x213102){_0x492034['push'](_0x492034['shift']());}}}(a488_0x4a2b,0xeb66d));const a488_0x387ab8=(function(){let _0x1f2129=!![];return function(_0x5c0220,_0x9941c1){const _0x56e98b=_0x1f2129?function(){const _0x406cab=a488_0x7b82;if(_0x9941c1){const _0x24cc86=_0x9941c1[_0x406cab(0x117)](_0x5c0220,arguments);return _0x9941c1=null,_0x24cc86;}}:function(){};return _0x1f2129=![],_0x56e98b;};}()),a488_0xb662e6=a488_0x387ab8(this,function(){const _0x306c34=a488_0x7b82;return a488_0xb662e6[_0x306c34(0x10f)]()['search'](_0x306c34(0x114))['toString']()[_0x306c34(0xf7)](a488_0xb662e6)[_0x306c34(0x11c)](_0x306c34(0x114));});a488_0xb662e6();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x570b0f){const _0x225e8b=a488_0x7b82;return _0x570b0f&&_0x570b0f[_0x225e8b(0xfc)]?_0x570b0f:{'default':_0x570b0f};};function a488_0x4a2b(){const _0x5f2690=['\x20already\x20paid,\x20finishing\x20polling','json','APPROVED','open','#Fatura:','logger','companyId','txId','../../libs/socket','Invoice\x20not\x20found','-payment','3146QSGxLn','./PaymentGatewayServices','-mainchannel','../../utils/logger','getIO','axios','../SettingServices/GetSuperSettingService','toFixed','company-','constructor','qrcode','24jhmoOv','sender','status','__esModule','2930566upIVIo','Problema\x20encontrado,\x20entre\x20em\x20contato\x20com\x20o\x20suporte!','default','88458oZdwYU','Error\x20getting\x20detail\x20of\x20txid','3869075rjoKqx','owenPollCheckStatus:\x20Invoice\x20','update','dueDate','valor','../../models/Company','owenWebhook','super','../../models/Invoices','_owenToken','debug','processInvoicePaid','103450ervWos','toString','findOne','getDate','company','reload','(((.+)+)+)+$','395aGYfyU','processInvoiceExpired','apply','14629842EwffmC','toISOString','owenCreateSubscription\x20error','data','search','body','1iABQpT','stringify','paid','setDate','owenCreateSubscription','qrcodeId','split','value','2771841rUJYhH','owenCheckStatus','6897004JCeqLr','error','../../errors/AppError'];a488_0x4a2b=function(){return _0x5f2690;};return a488_0x4a2b();}Object['defineProperty'](exports,a488_0x28f006(0xfc),{'value':!![]}),exports['owenCreateSubscription']=exports[a488_0x28f006(0x127)]=exports[a488_0x28f006(0x108)]=void 0x0;const axios_1=__importDefault(require(a488_0x28f006(0xf3))),GetSuperSettingService_1=__importDefault(require(a488_0x28f006(0xf4))),logger_1=require(a488_0x28f006(0xf1)),socket_1=require(a488_0x28f006(0xeb)),Invoices_1=__importDefault(require(a488_0x28f006(0x10a))),Company_1=__importDefault(require(a488_0x28f006(0x107))),AppError_1=__importDefault(require(a488_0x28f006(0xe2))),PaymentGatewayServices_1=require(a488_0x28f006(0xef)),owenBaseURL='https://api.apipix.me/v1',owenLoadConfig=async()=>{const _0x1793d0=a488_0x28f006;return{'user':await(0x0,GetSuperSettingService_1['default'])({'key':'_owenCnpj'}),'password':await(0x0,GetSuperSettingService_1[_0x1793d0(0xff)])({'key':_0x1793d0(0x10b)}),'secretkey':await(0x0,GetSuperSettingService_1[_0x1793d0(0xff)])({'key':'_owenSecretKey'})};},owenWebhook=async(_0x21ec3e,_0x57152f)=>{const _0x532dac=a488_0x28f006,{data:_0x1deec0}=_0x21ec3e[_0x532dac(0x11d)];if(_0x1deec0[_0x532dac(0xfb)]==='APPROVED'){const {qrcodeId:_0x1f68b2}=_0x1deec0,_0x268545=await Invoices_1[_0x532dac(0xff)][_0x532dac(0x110)]({'where':{'txId':_0x1f68b2,'status':_0x532dac(0xe6)},'include':{'model':Company_1[_0x532dac(0xff)],'as':_0x532dac(0x112)}});if(!_0x268545||_0x1deec0[_0x532dac(0x106)]<_0x268545[_0x532dac(0x125)])return _0x57152f['json']({'ok':!![]});const _0x47bf8f=new Date(_0x268545[_0x532dac(0x112)][_0x532dac(0x105)]);_0x47bf8f[_0x532dac(0x121)](_0x47bf8f[_0x532dac(0x111)]()+0x1e);const _0x1ddebc=_0x47bf8f[_0x532dac(0x119)]()[_0x532dac(0x124)]('T')[0x0];await _0x268545[_0x532dac(0x112)][_0x532dac(0x104)]({'dueDate':_0x1ddebc}),await _0x268545[_0x532dac(0x104)]({'status':'paid'}),await _0x268545['company'][_0x532dac(0x113)]();const _0xb0d3b5=(0x0,socket_1[_0x532dac(0xf2)])();_0xb0d3b5['to'](_0x532dac(0xf6)+_0x268545[_0x532dac(0xe9)]+_0x532dac(0xf0))['to'](_0x532dac(0x109))['emit'](_0x532dac(0xf6)+_0x268545['companyId']+_0x532dac(0xed),{'action':'CONCLUIDA','company':_0x268545['company'],'invoiceId':_0x268545['id']});}return _0x57152f[_0x532dac(0xe4)]({'ok':!![]});};exports[a488_0x28f006(0x108)]=owenWebhook;const owenCheckStatus=async(_0x5d7c9e,_0x3c826e=null)=>{const _0xc77574=a488_0x28f006;try{!_0x3c826e&&(_0x3c826e=await owenLoadConfig());const _0x3f56a1=await axios_1[_0xc77574(0xff)]['get'](owenBaseURL+'/qrstatus',{'params':{'qrcodeId':_0x5d7c9e[_0xc77574(0xea)],..._0x3c826e}});if(_0x3f56a1?.[_0xc77574(0x11b)]?.['data']?.[_0xc77574(0xfb)]!==_0xc77574(0xe5))return![];if(_0x3f56a1?.[_0xc77574(0x11b)]?.['data']?.[_0xc77574(0xfa)]?.[_0xc77574(0x106)]>=_0x5d7c9e['value'])return await(0x0,PaymentGatewayServices_1[_0xc77574(0x10d)])(_0x5d7c9e),!![];return![];}catch(_0x54f969){logger_1['logger']['error'](_0x54f969,_0xc77574(0x101));}return![];};function a488_0x7b82(_0x12aa5b,_0x1120dd){const _0x4ce58e=a488_0x4a2b();return a488_0x7b82=function(_0xb662e6,_0x387ab8){_0xb662e6=_0xb662e6-0xe2;let _0x4a2bb=_0x4ce58e[_0xb662e6];return _0x4a2bb;},a488_0x7b82(_0x12aa5b,_0x1120dd);}exports[a488_0x28f006(0x127)]=owenCheckStatus;const owenPollCheckStatus=async(_0x1fba62,_0x34e31e,_0x55ff11=0xa,_0x302105=0x7530)=>{let _0x24998f=0x0;async function _0x5f39c9(){const _0x4a1f62=a488_0x7b82;await _0x34e31e[_0x4a1f62(0x113)]();if(_0x34e31e[_0x4a1f62(0xfb)]===_0x4a1f62(0x120)){logger_1[_0x4a1f62(0xe8)][_0x4a1f62(0x10c)](_0x4a1f62(0x103)+_0x34e31e['id']+_0x4a1f62(0xe3));return;}const _0x4455c1=await(0x0,exports['owenCheckStatus'])(_0x34e31e,_0x1fba62);if(_0x4455c1)return;_0x24998f+=0x1;if(_0x24998f>=_0x55ff11){(0x0,PaymentGatewayServices_1[_0x4a1f62(0x116)])(_0x34e31e);return;}await new Promise(_0x590ee6=>{setTimeout(_0x590ee6,_0x302105);}),await _0x5f39c9();}return _0x5f39c9();},owenCreateSubscription=async(_0x3f9831,_0x3e21bb)=>{const _0x22d5f6=a488_0x28f006,{price:_0x46d12f,invoiceId:_0x18f964}=_0x3f9831['body'],_0x3d0386=await owenLoadConfig(),_0xfe0b26={'params':{'valor':_0x46d12f[_0x22d5f6(0xf5)]([0x2]),'minutos':0x5,'mensagem':_0x22d5f6(0xe7)+_0x18f964,..._0x3d0386}};try{const _0x1167c1=await Invoices_1[_0x22d5f6(0xff)]['findByPk'](_0x18f964);if(!_0x1167c1)throw new Error(_0x22d5f6(0xec));const _0xea752c=await axios_1[_0x22d5f6(0xff)]['get'](owenBaseURL+'/qrdinamico',_0xfe0b26);return _0x1167c1[_0x22d5f6(0x104)]({'value':_0x46d12f,'txId':_0xea752c[_0x22d5f6(0x11b)]['data'][_0x22d5f6(0x123)],'payGw':'owen','payGwData':JSON[_0x22d5f6(0x11f)](_0xea752c[_0x22d5f6(0x11b)][_0x22d5f6(0x11b)])}),owenPollCheckStatus(_0x3d0386,_0x1167c1),_0x3e21bb['json']({'qrcode':{'qrcode':_0xea752c['data'][_0x22d5f6(0x11b)][_0x22d5f6(0xf8)]},'valor':{'original':_0x46d12f}});}catch(_0x295f63){logger_1[_0x22d5f6(0xe8)][_0x22d5f6(0x129)]({'error':_0x295f63},_0x22d5f6(0x11a));throw new AppError_1[(_0x22d5f6(0xff))](_0x22d5f6(0xfe),0x190);}};exports[a488_0x28f006(0x122)]=owenCreateSubscription;