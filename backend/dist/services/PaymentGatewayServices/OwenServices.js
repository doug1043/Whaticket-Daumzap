const a587_0xfe3418=a587_0x4804;(function(_0x56ae69,_0x556d38){const _0x554dc2=a587_0x4804,_0xe405f2=_0x56ae69();while(!![]){try{const _0x3c1d45=-parseInt(_0x554dc2(0x1c3))/0x1+-parseInt(_0x554dc2(0x1dd))/0x2+parseInt(_0x554dc2(0x1d9))/0x3*(parseInt(_0x554dc2(0x1c9))/0x4)+-parseInt(_0x554dc2(0x1ec))/0x5+-parseInt(_0x554dc2(0x1d7))/0x6*(-parseInt(_0x554dc2(0x1ef))/0x7)+parseInt(_0x554dc2(0x1d4))/0x8*(-parseInt(_0x554dc2(0x1bb))/0x9)+parseInt(_0x554dc2(0x1c7))/0xa;if(_0x3c1d45===_0x556d38)break;else _0xe405f2['push'](_0xe405f2['shift']());}catch(_0x4e6d85){_0xe405f2['push'](_0xe405f2['shift']());}}}(a587_0x41ab,0xa4e21));function a587_0x41ab(){const _0xe455a4=['./PaymentGatewayServices','default','../../models/Invoices','Invoice\x20not\x20found','axios','processInvoiceExpired','search','qrcode','\x20already\x20paid,\x20finishing\x20polling','findByPk','__importDefault','getIO','owenCreateSubscription','owenWebhook','4312285rVMlHp','companyId','APPROVED','35zcSTDA','update','#Fatura:','toString','(((.+)+)+)+$','logger','status','/qrdinamico','error','../../errors/AppError','txId','CONCLUIDA','../../libs/socket','body','3798kSkqdV','json','Error\x20getting\x20detail\x20of\x20txid','owenCheckStatus','../../models/Company','__esModule','../SettingServices/GetSuperSettingService','paid','731926PLLXzz','defineProperty','company-','data','25255110BKfGQb','debug','159092hwBlfy','owen','constructor','dueDate','super','open','processInvoicePaid','company','../../utils/logger','findOne','toISOString','12544ohIYGE','apply','emit','684048nqFzjJ','reload','39DCyZze','valor','get','value','1362320SpbOiE'];a587_0x41ab=function(){return _0xe455a4;};return a587_0x41ab();}const a587_0x5d1dbe=(function(){let _0x48fdbc=!![];return function(_0x2e4dc5,_0x55b1f9){const _0x22b1bb=_0x48fdbc?function(){const _0x3f7152=a587_0x4804;if(_0x55b1f9){const _0x593420=_0x55b1f9[_0x3f7152(0x1d5)](_0x2e4dc5,arguments);return _0x55b1f9=null,_0x593420;}}:function(){};return _0x48fdbc=![],_0x22b1bb;};}()),a587_0x31fc89=a587_0x5d1dbe(this,function(){const _0x372d46=a587_0x4804;return a587_0x31fc89[_0x372d46(0x1f2)]()[_0x372d46(0x1e4)](_0x372d46(0x1f3))[_0x372d46(0x1f2)]()[_0x372d46(0x1cb)](a587_0x31fc89)[_0x372d46(0x1e4)](_0x372d46(0x1f3));});function a587_0x4804(_0x7639a,_0x192a48){const _0x2e3fb1=a587_0x41ab();return a587_0x4804=function(_0x31fc89,_0x5d1dbe){_0x31fc89=_0x31fc89-0x1b6;let _0x41ab1c=_0x2e3fb1[_0x31fc89];return _0x41ab1c;},a587_0x4804(_0x7639a,_0x192a48);}a587_0x31fc89();'use strict';var __importDefault=this&&this[a587_0xfe3418(0x1e8)]||function(_0x13fe3f){const _0x329724=a587_0xfe3418;return _0x13fe3f&&_0x13fe3f[_0x329724(0x1c0)]?_0x13fe3f:{'default':_0x13fe3f};};Object[a587_0xfe3418(0x1c4)](exports,'__esModule',{'value':!![]}),exports[a587_0xfe3418(0x1ea)]=exports[a587_0xfe3418(0x1be)]=exports['owenWebhook']=void 0x0;const axios_1=__importDefault(require(a587_0xfe3418(0x1e2))),GetSuperSettingService_1=__importDefault(require(a587_0xfe3418(0x1c1))),logger_1=require(a587_0xfe3418(0x1d1)),socket_1=require(a587_0xfe3418(0x1b9)),Invoices_1=__importDefault(require(a587_0xfe3418(0x1e0))),Company_1=__importDefault(require(a587_0xfe3418(0x1bf))),AppError_1=__importDefault(require(a587_0xfe3418(0x1b6))),PaymentGatewayServices_1=require(a587_0xfe3418(0x1de)),owenBaseURL='https://api.apipix.me/v1',owenLoadConfig=async()=>{const _0x13ffe4=a587_0xfe3418;return{'user':await(0x0,GetSuperSettingService_1[_0x13ffe4(0x1df)])({'key':'_owenCnpj'}),'password':await(0x0,GetSuperSettingService_1[_0x13ffe4(0x1df)])({'key':'_owenToken'}),'secretkey':await(0x0,GetSuperSettingService_1[_0x13ffe4(0x1df)])({'key':'_owenSecretKey'})};},owenWebhook=async(_0x455f0a,_0x13d1f3)=>{const _0x58c85c=a587_0xfe3418,{data:_0x2a18cf}=_0x455f0a['body'];if(_0x2a18cf[_0x58c85c(0x1f5)]===_0x58c85c(0x1ee)){const {qrcodeId:_0x189954}=_0x2a18cf,_0x555200=await Invoices_1[_0x58c85c(0x1df)][_0x58c85c(0x1d2)]({'where':{'txId':_0x189954,'status':_0x58c85c(0x1ce)},'include':{'model':Company_1[_0x58c85c(0x1df)],'as':_0x58c85c(0x1d0)}});if(!_0x555200||_0x2a18cf['valor']<_0x555200[_0x58c85c(0x1dc)])return _0x13d1f3['json']({'ok':!![]});const _0x5a8d9f=new Date(_0x555200[_0x58c85c(0x1d0)][_0x58c85c(0x1cc)]);_0x5a8d9f['setDate'](_0x5a8d9f['getDate']()+0x1e);const _0x74bc77=_0x5a8d9f[_0x58c85c(0x1d3)]()['split']('T')[0x0];await _0x555200[_0x58c85c(0x1d0)]['update']({'dueDate':_0x74bc77}),await _0x555200[_0x58c85c(0x1f0)]({'status':_0x58c85c(0x1c2)}),await _0x555200[_0x58c85c(0x1d0)]['reload']();const _0x12e239=(0x0,socket_1[_0x58c85c(0x1e9)])();_0x12e239['to'](_0x58c85c(0x1c5)+_0x555200[_0x58c85c(0x1ed)]+'-mainchannel')['to'](_0x58c85c(0x1cd))[_0x58c85c(0x1d6)](_0x58c85c(0x1c5)+_0x555200[_0x58c85c(0x1ed)]+'-payment',{'action':_0x58c85c(0x1b8),'company':_0x555200[_0x58c85c(0x1d0)],'invoiceId':_0x555200['id']});}return _0x13d1f3['json']({'ok':!![]});};exports[a587_0xfe3418(0x1eb)]=owenWebhook;const owenCheckStatus=async(_0x417c6d,_0x36f03f=null)=>{const _0x71d44e=a587_0xfe3418;try{!_0x36f03f&&(_0x36f03f=await owenLoadConfig());const _0x20881f=await axios_1[_0x71d44e(0x1df)][_0x71d44e(0x1db)](owenBaseURL+'/qrstatus',{'params':{'qrcodeId':_0x417c6d[_0x71d44e(0x1b7)],..._0x36f03f}});if(_0x20881f?.[_0x71d44e(0x1c6)]?.[_0x71d44e(0x1c6)]?.[_0x71d44e(0x1f5)]!==_0x71d44e(0x1ee))return![];if(_0x20881f?.[_0x71d44e(0x1c6)]?.[_0x71d44e(0x1c6)]?.['sender']?.[_0x71d44e(0x1da)]>=_0x417c6d[_0x71d44e(0x1dc)])return await(0x0,PaymentGatewayServices_1[_0x71d44e(0x1cf)])(_0x417c6d),!![];return![];}catch(_0x297933){logger_1['logger'][_0x71d44e(0x1f7)](_0x297933,_0x71d44e(0x1bd));}return![];};exports['owenCheckStatus']=owenCheckStatus;const owenPollCheckStatus=async(_0x4b8028,_0x56bbd2,_0x27d42c=0xa,_0x4dbac4=0x7530)=>{let _0x129a25=0x0;async function _0x24de3a(){const _0x462549=a587_0x4804;await _0x56bbd2[_0x462549(0x1d8)]();if(_0x56bbd2[_0x462549(0x1f5)]===_0x462549(0x1c2)){logger_1[_0x462549(0x1f4)][_0x462549(0x1c8)]('owenPollCheckStatus:\x20Invoice\x20'+_0x56bbd2['id']+_0x462549(0x1e6));return;}const _0x3babf2=await(0x0,exports[_0x462549(0x1be)])(_0x56bbd2,_0x4b8028);if(_0x3babf2)return;_0x129a25+=0x1;if(_0x129a25>=_0x27d42c){(0x0,PaymentGatewayServices_1[_0x462549(0x1e3)])(_0x56bbd2);return;}await new Promise(_0x952cf6=>{setTimeout(_0x952cf6,_0x4dbac4);}),await _0x24de3a();}return _0x24de3a();},owenCreateSubscription=async(_0x348abf,_0x4cf9a1)=>{const _0x33764b=a587_0xfe3418,{price:_0x3f0ff6,invoiceId:_0x1f320c}=_0x348abf[_0x33764b(0x1ba)],_0x2cfe62=await owenLoadConfig(),_0x1c1b05={'params':{'valor':_0x3f0ff6['toFixed']([0x2]),'minutos':0x5,'mensagem':_0x33764b(0x1f1)+_0x1f320c,..._0x2cfe62}};try{const _0x592db4=await Invoices_1[_0x33764b(0x1df)][_0x33764b(0x1e7)](_0x1f320c);if(!_0x592db4)throw new Error(_0x33764b(0x1e1));const _0x17b1ea=await axios_1[_0x33764b(0x1df)][_0x33764b(0x1db)](owenBaseURL+_0x33764b(0x1f6),_0x1c1b05);return _0x592db4['update']({'value':_0x3f0ff6,'txId':_0x17b1ea['data'][_0x33764b(0x1c6)]['qrcodeId'],'payGw':_0x33764b(0x1ca),'payGwData':JSON['stringify'](_0x17b1ea[_0x33764b(0x1c6)]['data'])}),owenPollCheckStatus(_0x2cfe62,_0x592db4),_0x4cf9a1[_0x33764b(0x1bc)]({'qrcode':{'qrcode':_0x17b1ea[_0x33764b(0x1c6)][_0x33764b(0x1c6)][_0x33764b(0x1e5)]},'valor':{'original':_0x3f0ff6}});}catch(_0x400b8c){logger_1[_0x33764b(0x1f4)][_0x33764b(0x1f7)]({'error':_0x400b8c},'owenCreateSubscription\x20error');throw new AppError_1[(_0x33764b(0x1df))]('Problema\x20encontrado,\x20entre\x20em\x20contato\x20com\x20o\x20suporte!',0x190);}};exports[a587_0xfe3418(0x1ea)]=owenCreateSubscription;