const a589_0x1adb00=a589_0x19d4;(function(_0x543044,_0x28d8e3){const _0x3ea4c9=a589_0x19d4,_0x44c404=_0x543044();while(!![]){try{const _0x5c3420=-parseInt(_0x3ea4c9(0x1c1))/0x1+-parseInt(_0x3ea4c9(0x199))/0x2+parseInt(_0x3ea4c9(0x1aa))/0x3*(parseInt(_0x3ea4c9(0x1cc))/0x4)+parseInt(_0x3ea4c9(0x1af))/0x5*(parseInt(_0x3ea4c9(0x19b))/0x6)+parseInt(_0x3ea4c9(0x19e))/0x7*(-parseInt(_0x3ea4c9(0x1a9))/0x8)+-parseInt(_0x3ea4c9(0x1d5))/0x9+parseInt(_0x3ea4c9(0x1a2))/0xa;if(_0x5c3420===_0x28d8e3)break;else _0x44c404['push'](_0x44c404['shift']());}catch(_0x706a04){_0x44c404['push'](_0x44c404['shift']());}}}(a589_0x351d,0x6ad0e));const a589_0x4be2da=(function(){let _0x2125a8=!![];return function(_0x48ad0d,_0x38dd1a){const _0x5edbe5=_0x2125a8?function(){if(_0x38dd1a){const _0x1ca00d=_0x38dd1a['apply'](_0x48ad0d,arguments);return _0x38dd1a=null,_0x1ca00d;}}:function(){};return _0x2125a8=![],_0x5edbe5;};}()),a589_0x47f3a6=a589_0x4be2da(this,function(){const _0x1f5def=a589_0x19d4;return a589_0x47f3a6[_0x1f5def(0x1db)]()['search'](_0x1f5def(0x1bd))[_0x1f5def(0x1db)]()[_0x1f5def(0x1bc)](a589_0x47f3a6)['search'](_0x1f5def(0x1bd));});a589_0x47f3a6();function a589_0x19d4(_0x54ffa5,_0x9c65a7){const _0x2e8b1a=a589_0x351d();return a589_0x19d4=function(_0x47f3a6,_0x4be2da){_0x47f3a6=_0x47f3a6-0x197;let _0x351df6=_0x2e8b1a[_0x47f3a6];return _0x351df6;},a589_0x19d4(_0x54ffa5,_0x9c65a7);}'use strict';var __importDefault=this&&this[a589_0x1adb00(0x1d7)]||function(_0x1c4cfe){const _0x48a07c=a589_0x1adb00;return _0x1c4cfe&&_0x1c4cfe[_0x48a07c(0x1a0)]?_0x1c4cfe:{'default':_0x1c4cfe};};Object['defineProperty'](exports,a589_0x1adb00(0x1a0),{'value':!![]}),exports[a589_0x1adb00(0x1ce)]=exports[a589_0x1adb00(0x1b8)]=exports['owenWebhook']=void 0x0;const axios_1=__importDefault(require(a589_0x1adb00(0x1c2))),GetSuperSettingService_1=__importDefault(require(a589_0x1adb00(0x1b5))),logger_1=require(a589_0x1adb00(0x1d8)),socket_1=require(a589_0x1adb00(0x1bf)),Invoices_1=__importDefault(require('../../models/Invoices')),Company_1=__importDefault(require(a589_0x1adb00(0x1b6))),AppError_1=__importDefault(require(a589_0x1adb00(0x1b0))),PaymentGatewayServices_1=require(a589_0x1adb00(0x1a3)),owenBaseURL='https://api.apipix.me/v1',owenLoadConfig=async()=>{const _0xd3b08e=a589_0x1adb00;return{'user':await(0x0,GetSuperSettingService_1[_0xd3b08e(0x1da)])({'key':_0xd3b08e(0x198)}),'password':await(0x0,GetSuperSettingService_1[_0xd3b08e(0x1da)])({'key':'_owenToken'}),'secretkey':await(0x0,GetSuperSettingService_1['default'])({'key':_0xd3b08e(0x1d4)})};},owenWebhook=async(_0x292e45,_0x2adf28)=>{const _0x433947=a589_0x1adb00,{data:_0x51d4d4}=_0x292e45[_0x433947(0x1a5)];if(_0x51d4d4[_0x433947(0x1d6)]==='APPROVED'){const {qrcodeId:_0x38ee3b}=_0x51d4d4,_0x2827ee=await Invoices_1[_0x433947(0x1da)][_0x433947(0x1a6)]({'where':{'txId':_0x38ee3b,'status':_0x433947(0x1b9)},'include':{'model':Company_1[_0x433947(0x1da)],'as':_0x433947(0x1ac)}});if(!_0x2827ee||_0x51d4d4[_0x433947(0x1d1)]<_0x2827ee[_0x433947(0x1b3)])return _0x2adf28[_0x433947(0x1cd)]({'ok':!![]});const _0x554ddd=new Date(_0x2827ee[_0x433947(0x1ac)][_0x433947(0x1be)]);_0x554ddd[_0x433947(0x1b1)](_0x554ddd[_0x433947(0x1d9)]()+0x1e);const _0x4d7462=_0x554ddd[_0x433947(0x197)]()[_0x433947(0x1ca)]('T')[0x0];await _0x2827ee[_0x433947(0x1ac)][_0x433947(0x1c5)]({'dueDate':_0x4d7462}),await _0x2827ee['update']({'status':_0x433947(0x1a7)}),await _0x2827ee[_0x433947(0x1ac)][_0x433947(0x1a8)]();const _0x22a8ac=(0x0,socket_1[_0x433947(0x19c)])();_0x22a8ac['to'](_0x433947(0x1bb)+_0x2827ee[_0x433947(0x1b2)]+_0x433947(0x1dd))['to'](_0x433947(0x1d3))[_0x433947(0x1ad)](_0x433947(0x1bb)+_0x2827ee[_0x433947(0x1b2)]+'-payment',{'action':_0x433947(0x1ba),'company':_0x2827ee['company'],'invoiceId':_0x2827ee['id']});}return _0x2adf28['json']({'ok':!![]});};exports[a589_0x1adb00(0x1c0)]=owenWebhook;const owenCheckStatus=async(_0x439958,_0x318f6b=null)=>{const _0x4e0dd8=a589_0x1adb00;try{!_0x318f6b&&(_0x318f6b=await owenLoadConfig());const _0x32ecfa=await axios_1['default']['get'](owenBaseURL+_0x4e0dd8(0x1b4),{'params':{'qrcodeId':_0x439958[_0x4e0dd8(0x1c9)],..._0x318f6b}});if(_0x32ecfa?.[_0x4e0dd8(0x1c6)]?.['data']?.[_0x4e0dd8(0x1d6)]!==_0x4e0dd8(0x1a1))return![];if(_0x32ecfa?.[_0x4e0dd8(0x1c6)]?.[_0x4e0dd8(0x1c6)]?.[_0x4e0dd8(0x1c7)]?.['valor']>=_0x439958[_0x4e0dd8(0x1b3)])return await(0x0,PaymentGatewayServices_1['processInvoicePaid'])(_0x439958),!![];return![];}catch(_0x4f754a){logger_1[_0x4e0dd8(0x19a)][_0x4e0dd8(0x1c3)](_0x4f754a,_0x4e0dd8(0x19d));}return![];};exports[a589_0x1adb00(0x1b8)]=owenCheckStatus;const owenPollCheckStatus=async(_0x4213d5,_0x4a7c63,_0x4e2cd1=0xa,_0xf402da=0x7530)=>{let _0x341bc4=0x0;async function _0x39d79e(){const _0x282948=a589_0x19d4;await _0x4a7c63[_0x282948(0x1a8)]();if(_0x4a7c63['status']===_0x282948(0x1a7)){logger_1[_0x282948(0x19a)][_0x282948(0x1ab)](_0x282948(0x1cf)+_0x4a7c63['id']+_0x282948(0x1dc));return;}const _0x85c47b=await(0x0,exports[_0x282948(0x1b8)])(_0x4a7c63,_0x4213d5);if(_0x85c47b)return;_0x341bc4+=0x1;if(_0x341bc4>=_0x4e2cd1){(0x0,PaymentGatewayServices_1['processInvoiceExpired'])(_0x4a7c63);return;}await new Promise(_0x1227af=>{setTimeout(_0x1227af,_0xf402da);}),await _0x39d79e();}return _0x39d79e();},owenCreateSubscription=async(_0x159cb7,_0x29c7f6)=>{const _0x15f078=a589_0x1adb00,{price:_0x4012f4,invoiceId:_0x421818}=_0x159cb7['body'],_0x4f6e8a=await owenLoadConfig(),_0x321545={'params':{'valor':_0x4012f4[_0x15f078(0x1cb)]([0x2]),'minutos':0x5,'mensagem':_0x15f078(0x1a4)+_0x421818,..._0x4f6e8a}};try{const _0x503f6b=await Invoices_1[_0x15f078(0x1da)][_0x15f078(0x1ae)](_0x421818);if(!_0x503f6b)throw new Error(_0x15f078(0x19f));const _0x3e2d28=await axios_1[_0x15f078(0x1da)][_0x15f078(0x1c8)](owenBaseURL+'/qrdinamico',_0x321545);return _0x503f6b[_0x15f078(0x1c5)]({'value':_0x4012f4,'txId':_0x3e2d28['data'][_0x15f078(0x1c6)][_0x15f078(0x1c4)],'payGw':_0x15f078(0x1b7),'payGwData':JSON[_0x15f078(0x1d2)](_0x3e2d28[_0x15f078(0x1c6)][_0x15f078(0x1c6)])}),owenPollCheckStatus(_0x4f6e8a,_0x503f6b),_0x29c7f6['json']({'qrcode':{'qrcode':_0x3e2d28[_0x15f078(0x1c6)][_0x15f078(0x1c6)]['qrcode']},'valor':{'original':_0x4012f4}});}catch(_0x6a1b73){logger_1[_0x15f078(0x19a)][_0x15f078(0x1c3)]({'error':_0x6a1b73},'owenCreateSubscription\x20error');throw new AppError_1[(_0x15f078(0x1da))](_0x15f078(0x1d0),0x190);}};exports[a589_0x1adb00(0x1ce)]=owenCreateSubscription;function a589_0x351d(){const _0x3341da=['Error\x20getting\x20detail\x20of\x20txid','28phKIXB','Invoice\x20not\x20found','__esModule','APPROVED','14221150QqjEXg','./PaymentGatewayServices','#Fatura:','body','findOne','paid','reload','1151488oNhEhU','57RhzkPq','debug','company','emit','findByPk','5EAijxB','../../errors/AppError','setDate','companyId','value','/qrstatus','../SettingServices/GetSuperSettingService','../../models/Company','owen','owenCheckStatus','open','CONCLUIDA','company-','constructor','(((.+)+)+)+$','dueDate','../../libs/socket','owenWebhook','392434aoJMeL','axios','error','qrcodeId','update','data','sender','get','txId','split','toFixed','140548HsJQCd','json','owenCreateSubscription','owenPollCheckStatus:\x20Invoice\x20','Problema\x20encontrado,\x20entre\x20em\x20contato\x20com\x20o\x20suporte!','valor','stringify','super','_owenSecretKey','4713084dJKktv','status','__importDefault','../../utils/logger','getDate','default','toString','\x20already\x20paid,\x20finishing\x20polling','-mainchannel','toISOString','_owenCnpj','1557098wRzKjq','logger','3709218ljojEy','getIO'];a589_0x351d=function(){return _0x3341da;};return a589_0x351d();}