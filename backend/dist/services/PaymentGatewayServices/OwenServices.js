const a483_0x1bd9f4=a483_0x2aa5;function a483_0x11d9(){const _0x34865d=['owen','split','/qrstatus','qrcodeId','reload','owenCheckStatus','get','Error\x20getting\x20detail\x20of\x20txid','-mainchannel','companyId','value','APPROVED','../../libs/socket','search','sender','stringify','toString','apply','findOne','Problema\x20encontrado,\x20entre\x20em\x20contato\x20com\x20o\x20suporte!','../../models/Invoices','defineProperty','owenCreateSubscription','1211994GmsXYH','paid','(((.+)+)+)+$','logger','\x20already\x20paid,\x20finishing\x20polling','owenCreateSubscription\x20error','getIO','update','688869NkZube','txId','6rqThHN','_owenCnpj','owenWebhook','../SettingServices/GetSuperSettingService','valor','10HKHAFY','toFixed','Invoice\x20not\x20found','setDate','super','emit','constructor','debug','default','__importDefault','60682zXAPgT','data','__esModule','body','2752048Lsivrg','dueDate','processInvoiceExpired','606242pgmCkq','company','status','getDate','2857955CBDwzp','company-','json','processInvoicePaid','owenPollCheckStatus:\x20Invoice\x20','51wjYXcw','../../utils/logger','415980vlMwkO','toISOString','open'];a483_0x11d9=function(){return _0x34865d;};return a483_0x11d9();}(function(_0x3f818b,_0x10e611){const _0x51714f=a483_0x2aa5,_0x52b3e8=_0x3f818b();while(!![]){try{const _0x4c47a2=parseInt(_0x51714f(0x10c))/0x1+-parseInt(_0x51714f(0x105))/0x2*(parseInt(_0x51714f(0x115))/0x3)+parseInt(_0x51714f(0x117))/0x4+-parseInt(_0x51714f(0x110))/0x5*(-parseInt(_0x51714f(0xf6))/0x6)+-parseInt(_0x51714f(0xec))/0x7+-parseInt(_0x51714f(0x109))/0x8+-parseInt(_0x51714f(0xf4))/0x9*(-parseInt(_0x51714f(0xfb))/0xa);if(_0x4c47a2===_0x10e611)break;else _0x52b3e8['push'](_0x52b3e8['shift']());}catch(_0x3bb58b){_0x52b3e8['push'](_0x52b3e8['shift']());}}}(a483_0x11d9,0x4f730));const a483_0x25690d=(function(){let _0xa97ab5=!![];return function(_0x11ace5,_0x17192b){const _0x42fdc5=_0xa97ab5?function(){const _0x350108=a483_0x2aa5;if(_0x17192b){const _0x598556=_0x17192b[_0x350108(0xe6)](_0x11ace5,arguments);return _0x17192b=null,_0x598556;}}:function(){};return _0xa97ab5=![],_0x42fdc5;};}()),a483_0x17676e=a483_0x25690d(this,function(){const _0x2f9433=a483_0x2aa5;return a483_0x17676e['toString']()[_0x2f9433(0x127)](_0x2f9433(0xee))[_0x2f9433(0x12a)]()[_0x2f9433(0x101)](a483_0x17676e)['search']('(((.+)+)+)+$');});a483_0x17676e();'use strict';var __importDefault=this&&this[a483_0x1bd9f4(0x104)]||function(_0x246fbb){const _0x5eafe7=a483_0x1bd9f4;return _0x246fbb&&_0x246fbb[_0x5eafe7(0x107)]?_0x246fbb:{'default':_0x246fbb};};Object[a483_0x1bd9f4(0xea)](exports,a483_0x1bd9f4(0x107),{'value':!![]}),exports[a483_0x1bd9f4(0xeb)]=exports['owenCheckStatus']=exports[a483_0x1bd9f4(0xf8)]=void 0x0;const axios_1=__importDefault(require('axios')),GetSuperSettingService_1=__importDefault(require(a483_0x1bd9f4(0xf9))),logger_1=require(a483_0x1bd9f4(0x116)),socket_1=require(a483_0x1bd9f4(0x126)),Invoices_1=__importDefault(require(a483_0x1bd9f4(0xe9))),Company_1=__importDefault(require('../../models/Company')),AppError_1=__importDefault(require('../../errors/AppError')),PaymentGatewayServices_1=require('./PaymentGatewayServices'),owenBaseURL='https://api.apipix.me/v1',owenLoadConfig=async()=>{const _0x216675=a483_0x1bd9f4;return{'user':await(0x0,GetSuperSettingService_1[_0x216675(0x103)])({'key':_0x216675(0xf7)}),'password':await(0x0,GetSuperSettingService_1[_0x216675(0x103)])({'key':'_owenToken'}),'secretkey':await(0x0,GetSuperSettingService_1[_0x216675(0x103)])({'key':'_owenSecretKey'})};},owenWebhook=async(_0x16df28,_0x229c43)=>{const _0x31b774=a483_0x1bd9f4,{data:_0x5a4fbe}=_0x16df28[_0x31b774(0x108)];if(_0x5a4fbe[_0x31b774(0x10e)]===_0x31b774(0x125)){const {qrcodeId:_0x4029fc}=_0x5a4fbe,_0x1925a9=await Invoices_1[_0x31b774(0x103)][_0x31b774(0xe7)]({'where':{'txId':_0x4029fc,'status':_0x31b774(0x119)},'include':{'model':Company_1['default'],'as':_0x31b774(0x10d)}});if(!_0x1925a9||_0x5a4fbe[_0x31b774(0xfa)]<_0x1925a9[_0x31b774(0x124)])return _0x229c43[_0x31b774(0x112)]({'ok':!![]});const _0xba01cd=new Date(_0x1925a9[_0x31b774(0x10d)][_0x31b774(0x10a)]);_0xba01cd[_0x31b774(0xfe)](_0xba01cd[_0x31b774(0x10f)]()+0x1e);const _0x14802a=_0xba01cd[_0x31b774(0x118)]()[_0x31b774(0x11b)]('T')[0x0];await _0x1925a9[_0x31b774(0x10d)][_0x31b774(0xf3)]({'dueDate':_0x14802a}),await _0x1925a9[_0x31b774(0xf3)]({'status':_0x31b774(0xed)}),await _0x1925a9[_0x31b774(0x10d)]['reload']();const _0x2380d8=(0x0,socket_1[_0x31b774(0xf2)])();_0x2380d8['to'](_0x31b774(0x111)+_0x1925a9[_0x31b774(0x123)]+_0x31b774(0x122))['to'](_0x31b774(0xff))[_0x31b774(0x100)]('company-'+_0x1925a9[_0x31b774(0x123)]+'-payment',{'action':'CONCLUIDA','company':_0x1925a9['company'],'invoiceId':_0x1925a9['id']});}return _0x229c43[_0x31b774(0x112)]({'ok':!![]});};exports[a483_0x1bd9f4(0xf8)]=owenWebhook;function a483_0x2aa5(_0x568083,_0x3e93d0){const _0x5ed38a=a483_0x11d9();return a483_0x2aa5=function(_0x17676e,_0x25690d){_0x17676e=_0x17676e-0xe6;let _0x11d990=_0x5ed38a[_0x17676e];return _0x11d990;},a483_0x2aa5(_0x568083,_0x3e93d0);}const owenCheckStatus=async(_0x1994c9,_0x530ae4=null)=>{const _0x5cb368=a483_0x1bd9f4;try{!_0x530ae4&&(_0x530ae4=await owenLoadConfig());const _0x3c66cb=await axios_1['default'][_0x5cb368(0x120)](owenBaseURL+_0x5cb368(0x11c),{'params':{'qrcodeId':_0x1994c9[_0x5cb368(0xf5)],..._0x530ae4}});if(_0x3c66cb?.['data']?.[_0x5cb368(0x106)]?.[_0x5cb368(0x10e)]!==_0x5cb368(0x125))return![];if(_0x3c66cb?.['data']?.[_0x5cb368(0x106)]?.[_0x5cb368(0x128)]?.[_0x5cb368(0xfa)]>=_0x1994c9[_0x5cb368(0x124)])return await(0x0,PaymentGatewayServices_1[_0x5cb368(0x113)])(_0x1994c9),!![];return![];}catch(_0x531623){logger_1[_0x5cb368(0xef)]['error'](_0x531623,_0x5cb368(0x121));}return![];};exports[a483_0x1bd9f4(0x11f)]=owenCheckStatus;const owenPollCheckStatus=async(_0x5605c7,_0x251a32,_0x17a827=0xa,_0x219e5f=0x7530)=>{let _0x31eba4=0x0;async function _0x1475dc(){const _0x526e60=a483_0x2aa5;await _0x251a32[_0x526e60(0x11e)]();if(_0x251a32[_0x526e60(0x10e)]===_0x526e60(0xed)){logger_1[_0x526e60(0xef)][_0x526e60(0x102)](_0x526e60(0x114)+_0x251a32['id']+_0x526e60(0xf0));return;}const _0x277624=await(0x0,exports['owenCheckStatus'])(_0x251a32,_0x5605c7);if(_0x277624)return;_0x31eba4+=0x1;if(_0x31eba4>=_0x17a827){(0x0,PaymentGatewayServices_1[_0x526e60(0x10b)])(_0x251a32);return;}await new Promise(_0xa11105=>{setTimeout(_0xa11105,_0x219e5f);}),await _0x1475dc();}return _0x1475dc();},owenCreateSubscription=async(_0x592837,_0x5d8696)=>{const _0x482194=a483_0x1bd9f4,{price:_0x4e89b8,invoiceId:_0x500a4a}=_0x592837['body'],_0x48beea=await owenLoadConfig(),_0x207024={'params':{'valor':_0x4e89b8[_0x482194(0xfc)]([0x2]),'minutos':0x5,'mensagem':'#Fatura:'+_0x500a4a,..._0x48beea}};try{const _0x2949c2=await Invoices_1[_0x482194(0x103)]['findByPk'](_0x500a4a);if(!_0x2949c2)throw new Error(_0x482194(0xfd));const _0x387866=await axios_1[_0x482194(0x103)][_0x482194(0x120)](owenBaseURL+'/qrdinamico',_0x207024);return _0x2949c2['update']({'value':_0x4e89b8,'txId':_0x387866[_0x482194(0x106)]['data'][_0x482194(0x11d)],'payGw':_0x482194(0x11a),'payGwData':JSON[_0x482194(0x129)](_0x387866[_0x482194(0x106)][_0x482194(0x106)])}),owenPollCheckStatus(_0x48beea,_0x2949c2),_0x5d8696[_0x482194(0x112)]({'qrcode':{'qrcode':_0x387866['data'][_0x482194(0x106)]['qrcode']},'valor':{'original':_0x4e89b8}});}catch(_0xb1e12b){logger_1[_0x482194(0xef)]['error']({'error':_0xb1e12b},_0x482194(0xf1));throw new AppError_1[(_0x482194(0x103))](_0x482194(0xe8),0x190);}};exports[a483_0x1bd9f4(0xeb)]=owenCreateSubscription;