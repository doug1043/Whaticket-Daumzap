const a487_0x464699=a487_0x2c2a;(function(_0x3b3fb4,_0x47f2f0){const _0x49de90=a487_0x2c2a,_0x51cf19=_0x3b3fb4();while(!![]){try{const _0x5a52e7=parseInt(_0x49de90(0x1b0))/0x1*(-parseInt(_0x49de90(0x1e2))/0x2)+parseInt(_0x49de90(0x1ab))/0x3+-parseInt(_0x49de90(0x1f3))/0x4*(-parseInt(_0x49de90(0x1d6))/0x5)+parseInt(_0x49de90(0x1f4))/0x6*(-parseInt(_0x49de90(0x1be))/0x7)+parseInt(_0x49de90(0x1bd))/0x8*(-parseInt(_0x49de90(0x1f7))/0x9)+parseInt(_0x49de90(0x1f2))/0xa*(parseInt(_0x49de90(0x1cc))/0xb)+-parseInt(_0x49de90(0x1d1))/0xc*(-parseInt(_0x49de90(0x1f5))/0xd);if(_0x5a52e7===_0x47f2f0)break;else _0x51cf19['push'](_0x51cf19['shift']());}catch(_0x41917f){_0x51cf19['push'](_0x51cf19['shift']());}}}(a487_0x4350,0xca553));function a487_0x4350(){const _0x2c63cb=['90fqyuiG','1852029TkiIYA','findByPk','emit','json','valor','332nnRSRu','_owenCnpj','owenCheckStatus','../SettingServices/GetSuperSettingService','https://api.apipix.me/v1','setDate','-mainchannel','reload','logger','toString','open','../../utils/logger','../../libs/socket','341720itwURt','6812057aQIYGj','../../models/Company','value','/qrstatus','__esModule','companyId','Problema\x20encontrado,\x20entre\x20em\x20contato\x20com\x20o\x20suporte!','toISOString','owenCreateSubscription','txId','status','owenWebhook','update','-payment','11eSPhTz','company','axios','default','Error\x20getting\x20detail\x20of\x20txid','3842544EgsbXy','#Fatura:','/qrdinamico','findOne','processInvoicePaid','4454780MbdReP','company-','error','qrcode','(((.+)+)+)+$','owen','body','owenCreateSubscription\x20error','defineProperty','getDate','../../models/Invoices','../../errors/AppError','2386PVPOXB','_owenToken','search','stringify','constructor','get','sender','./PaymentGatewayServices','apply','data','debug','Invoice\x20not\x20found','processInvoiceExpired','paid','owenPollCheckStatus:\x20Invoice\x20','split','1561970YsDXOr','4PDtQOg','6hBXVRg','39BrPfGf','qrcodeId'];a487_0x4350=function(){return _0x2c63cb;};return a487_0x4350();}const a487_0x1d63bf=(function(){let _0x12d154=!![];return function(_0xb32eca,_0x2cc557){const _0x35d8a5=_0x12d154?function(){const _0x5dc026=a487_0x2c2a;if(_0x2cc557){const _0x1506c2=_0x2cc557[_0x5dc026(0x1ea)](_0xb32eca,arguments);return _0x2cc557=null,_0x1506c2;}}:function(){};return _0x12d154=![],_0x35d8a5;};}()),a487_0x4af164=a487_0x1d63bf(this,function(){const _0x503dfc=a487_0x2c2a;return a487_0x4af164[_0x503dfc(0x1b9)]()[_0x503dfc(0x1e4)](_0x503dfc(0x1da))[_0x503dfc(0x1b9)]()[_0x503dfc(0x1e6)](a487_0x4af164)[_0x503dfc(0x1e4)](_0x503dfc(0x1da));});a487_0x4af164();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2f95d1){return _0x2f95d1&&_0x2f95d1['__esModule']?_0x2f95d1:{'default':_0x2f95d1};};Object[a487_0x464699(0x1de)](exports,a487_0x464699(0x1c2),{'value':!![]}),exports['owenCreateSubscription']=exports[a487_0x464699(0x1b2)]=exports[a487_0x464699(0x1c9)]=void 0x0;const axios_1=__importDefault(require(a487_0x464699(0x1ce))),GetSuperSettingService_1=__importDefault(require(a487_0x464699(0x1b3))),logger_1=require(a487_0x464699(0x1bb)),socket_1=require(a487_0x464699(0x1bc)),Invoices_1=__importDefault(require(a487_0x464699(0x1e0))),Company_1=__importDefault(require(a487_0x464699(0x1bf))),AppError_1=__importDefault(require(a487_0x464699(0x1e1))),PaymentGatewayServices_1=require(a487_0x464699(0x1e9)),owenBaseURL=a487_0x464699(0x1b4),owenLoadConfig=async()=>{const _0x41327a=a487_0x464699;return{'user':await(0x0,GetSuperSettingService_1['default'])({'key':_0x41327a(0x1b1)}),'password':await(0x0,GetSuperSettingService_1[_0x41327a(0x1cf)])({'key':_0x41327a(0x1e3)}),'secretkey':await(0x0,GetSuperSettingService_1[_0x41327a(0x1cf)])({'key':'_owenSecretKey'})};},owenWebhook=async(_0x359858,_0x15b21a)=>{const _0x10293d=a487_0x464699,{data:_0x2d780f}=_0x359858[_0x10293d(0x1dc)];if(_0x2d780f['status']==='APPROVED'){const {qrcodeId:_0x53047d}=_0x2d780f,_0x721a1=await Invoices_1[_0x10293d(0x1cf)][_0x10293d(0x1d4)]({'where':{'txId':_0x53047d,'status':_0x10293d(0x1ba)},'include':{'model':Company_1[_0x10293d(0x1cf)],'as':'company'}});if(!_0x721a1||_0x2d780f[_0x10293d(0x1af)]<_0x721a1[_0x10293d(0x1c0)])return _0x15b21a['json']({'ok':!![]});const _0x4165f7=new Date(_0x721a1[_0x10293d(0x1cd)]['dueDate']);_0x4165f7[_0x10293d(0x1b5)](_0x4165f7[_0x10293d(0x1df)]()+0x1e);const _0x37863e=_0x4165f7[_0x10293d(0x1c5)]()[_0x10293d(0x1f1)]('T')[0x0];await _0x721a1[_0x10293d(0x1cd)][_0x10293d(0x1ca)]({'dueDate':_0x37863e}),await _0x721a1[_0x10293d(0x1ca)]({'status':_0x10293d(0x1ef)}),await _0x721a1[_0x10293d(0x1cd)][_0x10293d(0x1b7)]();const _0x47db69=(0x0,socket_1['getIO'])();_0x47db69['to']('company-'+_0x721a1[_0x10293d(0x1c3)]+_0x10293d(0x1b6))['to']('super')[_0x10293d(0x1ad)](_0x10293d(0x1d7)+_0x721a1[_0x10293d(0x1c3)]+_0x10293d(0x1cb),{'action':'CONCLUIDA','company':_0x721a1['company'],'invoiceId':_0x721a1['id']});}return _0x15b21a[_0x10293d(0x1ae)]({'ok':!![]});};function a487_0x2c2a(_0x48c59d,_0xa5e90a){const _0x38a21a=a487_0x4350();return a487_0x2c2a=function(_0x4af164,_0x1d63bf){_0x4af164=_0x4af164-0x1ab;let _0x435091=_0x38a21a[_0x4af164];return _0x435091;},a487_0x2c2a(_0x48c59d,_0xa5e90a);}exports['owenWebhook']=owenWebhook;const owenCheckStatus=async(_0x1741de,_0x1d2159=null)=>{const _0x217b29=a487_0x464699;try{!_0x1d2159&&(_0x1d2159=await owenLoadConfig());const _0x4f8bf8=await axios_1['default'][_0x217b29(0x1e7)](owenBaseURL+_0x217b29(0x1c1),{'params':{'qrcodeId':_0x1741de[_0x217b29(0x1c7)],..._0x1d2159}});if(_0x4f8bf8?.[_0x217b29(0x1eb)]?.[_0x217b29(0x1eb)]?.[_0x217b29(0x1c8)]!=='APPROVED')return![];if(_0x4f8bf8?.[_0x217b29(0x1eb)]?.[_0x217b29(0x1eb)]?.[_0x217b29(0x1e8)]?.['valor']>=_0x1741de[_0x217b29(0x1c0)])return await(0x0,PaymentGatewayServices_1[_0x217b29(0x1d5)])(_0x1741de),!![];return![];}catch(_0x1ffefc){logger_1[_0x217b29(0x1b8)][_0x217b29(0x1d8)](_0x1ffefc,_0x217b29(0x1d0));}return![];};exports[a487_0x464699(0x1b2)]=owenCheckStatus;const owenPollCheckStatus=async(_0x1696b5,_0x5d4d21,_0x44cc71=0xa,_0x42ff3b=0x7530)=>{let _0x329a97=0x0;async function _0x173a97(){const _0x28d64e=a487_0x2c2a;await _0x5d4d21[_0x28d64e(0x1b7)]();if(_0x5d4d21[_0x28d64e(0x1c8)]==='paid'){logger_1[_0x28d64e(0x1b8)][_0x28d64e(0x1ec)](_0x28d64e(0x1f0)+_0x5d4d21['id']+'\x20already\x20paid,\x20finishing\x20polling');return;}const _0x4df575=await(0x0,exports['owenCheckStatus'])(_0x5d4d21,_0x1696b5);if(_0x4df575)return;_0x329a97+=0x1;if(_0x329a97>=_0x44cc71){(0x0,PaymentGatewayServices_1[_0x28d64e(0x1ee)])(_0x5d4d21);return;}await new Promise(_0xf9e356=>{setTimeout(_0xf9e356,_0x42ff3b);}),await _0x173a97();}return _0x173a97();},owenCreateSubscription=async(_0x50bf60,_0x12f5c6)=>{const _0x529c32=a487_0x464699,{price:_0xf6f06f,invoiceId:_0x1060e2}=_0x50bf60['body'],_0x5ea2ee=await owenLoadConfig(),_0x221964={'params':{'valor':_0xf6f06f['toFixed']([0x2]),'minutos':0x5,'mensagem':_0x529c32(0x1d2)+_0x1060e2,..._0x5ea2ee}};try{const _0x1fda57=await Invoices_1['default'][_0x529c32(0x1ac)](_0x1060e2);if(!_0x1fda57)throw new Error(_0x529c32(0x1ed));const _0x109aa6=await axios_1[_0x529c32(0x1cf)][_0x529c32(0x1e7)](owenBaseURL+_0x529c32(0x1d3),_0x221964);return _0x1fda57[_0x529c32(0x1ca)]({'value':_0xf6f06f,'txId':_0x109aa6['data'][_0x529c32(0x1eb)][_0x529c32(0x1f6)],'payGw':_0x529c32(0x1db),'payGwData':JSON[_0x529c32(0x1e5)](_0x109aa6['data'][_0x529c32(0x1eb)])}),owenPollCheckStatus(_0x5ea2ee,_0x1fda57),_0x12f5c6[_0x529c32(0x1ae)]({'qrcode':{'qrcode':_0x109aa6[_0x529c32(0x1eb)]['data'][_0x529c32(0x1d9)]},'valor':{'original':_0xf6f06f}});}catch(_0x5cc176){logger_1[_0x529c32(0x1b8)][_0x529c32(0x1d8)]({'error':_0x5cc176},_0x529c32(0x1dd));throw new AppError_1[(_0x529c32(0x1cf))](_0x529c32(0x1c4),0x190);}};exports[a487_0x464699(0x1c6)]=owenCreateSubscription;