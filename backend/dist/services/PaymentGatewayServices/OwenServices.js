const a487_0x15bf4f=a487_0x1255;(function(_0x107985,_0x196721){const _0x5b7ac2=a487_0x1255,_0xaafb22=_0x107985();while(!![]){try{const _0xa1193b=-parseInt(_0x5b7ac2(0x102))/0x1*(parseInt(_0x5b7ac2(0x12f))/0x2)+-parseInt(_0x5b7ac2(0x108))/0x3+parseInt(_0x5b7ac2(0xfc))/0x4*(parseInt(_0x5b7ac2(0x10d))/0x5)+-parseInt(_0x5b7ac2(0x139))/0x6+-parseInt(_0x5b7ac2(0x134))/0x7+parseInt(_0x5b7ac2(0x12d))/0x8*(parseInt(_0x5b7ac2(0xfe))/0x9)+parseInt(_0x5b7ac2(0x11e))/0xa;if(_0xa1193b===_0x196721)break;else _0xaafb22['push'](_0xaafb22['shift']());}catch(_0x365eb0){_0xaafb22['push'](_0xaafb22['shift']());}}}(a487_0x5cf1,0xa0c9d));const a487_0x59a6f8=(function(){let _0x1d8577=!![];return function(_0x9c8b1c,_0x1057a1){const _0x4c47a7=_0x1d8577?function(){const _0x8ebc2b=a487_0x1255;if(_0x1057a1){const _0x178a01=_0x1057a1[_0x8ebc2b(0x13a)](_0x9c8b1c,arguments);return _0x1057a1=null,_0x178a01;}}:function(){};return _0x1d8577=![],_0x4c47a7;};}()),a487_0x50253d=a487_0x59a6f8(this,function(){const _0xc4e33=a487_0x1255;return a487_0x50253d[_0xc4e33(0x11b)]()[_0xc4e33(0x129)]('(((.+)+)+)+$')[_0xc4e33(0x11b)]()['constructor'](a487_0x50253d)[_0xc4e33(0x129)](_0xc4e33(0x122));});a487_0x50253d();'use strict';function a487_0x5cf1(){const _0x3a201d=['#Fatura:','Problema\x20encontrado,\x20entre\x20em\x20contato\x20com\x20o\x20suporte!','stringify','getIO','qrcode','paid','owenWebhook','valor','_owenToken','sender','toString','../../utils/logger','super','10998770QYJiez','logger','companyId','_owenSecretKey','(((.+)+)+)+$','status','__esModule','company-','processInvoiceExpired','toFixed','txId','search','default','owen','../../models/Invoices','304isPGGQ','reload','281948ehNGnN','-mainchannel','/qrstatus','https://api.apipix.me/v1','\x20already\x20paid,\x20finishing\x20polling','6551902jHWcjI','emit','debug','axios','../../errors/AppError','4112106dATzjI','apply','data','APPROVED','body','524UNaEoK','owenCreateSubscription','163314jQAYVa','setDate','../../models/Company','open','3GjOhsU','defineProperty','Error\x20getting\x20detail\x20of\x20txid','error','json','value','490584WMqqks','update','owenCheckStatus','Invoice\x20not\x20found','_owenCnpj','41105vbJMIR','findByPk','company','dueDate'];a487_0x5cf1=function(){return _0x3a201d;};return a487_0x5cf1();}var __importDefault=this&&this['__importDefault']||function(_0xba999){const _0x433fd2=a487_0x1255;return _0xba999&&_0xba999[_0x433fd2(0x124)]?_0xba999:{'default':_0xba999};};Object[a487_0x15bf4f(0x103)](exports,'__esModule',{'value':!![]}),exports[a487_0x15bf4f(0xfd)]=exports[a487_0x15bf4f(0x10a)]=exports['owenWebhook']=void 0x0;function a487_0x1255(_0x4e26d6,_0x520296){const _0x2809d2=a487_0x5cf1();return a487_0x1255=function(_0x50253d,_0x59a6f8){_0x50253d=_0x50253d-0xfa;let _0x5cf14a=_0x2809d2[_0x50253d];return _0x5cf14a;},a487_0x1255(_0x4e26d6,_0x520296);}const axios_1=__importDefault(require(a487_0x15bf4f(0x137))),GetSuperSettingService_1=__importDefault(require('../SettingServices/GetSuperSettingService')),logger_1=require(a487_0x15bf4f(0x11c)),socket_1=require('../../libs/socket'),Invoices_1=__importDefault(require(a487_0x15bf4f(0x12c))),Company_1=__importDefault(require(a487_0x15bf4f(0x100))),AppError_1=__importDefault(require(a487_0x15bf4f(0x138))),PaymentGatewayServices_1=require('./PaymentGatewayServices'),owenBaseURL=a487_0x15bf4f(0x132),owenLoadConfig=async()=>{const _0x3dad60=a487_0x15bf4f;return{'user':await(0x0,GetSuperSettingService_1[_0x3dad60(0x12a)])({'key':_0x3dad60(0x10c)}),'password':await(0x0,GetSuperSettingService_1[_0x3dad60(0x12a)])({'key':_0x3dad60(0x119)}),'secretkey':await(0x0,GetSuperSettingService_1[_0x3dad60(0x12a)])({'key':_0x3dad60(0x121)})};},owenWebhook=async(_0x43a9f7,_0x114486)=>{const _0x23fd03=a487_0x15bf4f,{data:_0x22b856}=_0x43a9f7[_0x23fd03(0xfb)];if(_0x22b856[_0x23fd03(0x123)]===_0x23fd03(0xfa)){const {qrcodeId:_0x51eb86}=_0x22b856,_0x2fcb61=await Invoices_1[_0x23fd03(0x12a)]['findOne']({'where':{'txId':_0x51eb86,'status':_0x23fd03(0x101)},'include':{'model':Company_1[_0x23fd03(0x12a)],'as':_0x23fd03(0x10f)}});if(!_0x2fcb61||_0x22b856[_0x23fd03(0x118)]<_0x2fcb61[_0x23fd03(0x107)])return _0x114486[_0x23fd03(0x106)]({'ok':!![]});const _0x25b9db=new Date(_0x2fcb61[_0x23fd03(0x10f)][_0x23fd03(0x110)]);_0x25b9db[_0x23fd03(0xff)](_0x25b9db['getDate']()+0x1e);const _0x11f5c7=_0x25b9db['toISOString']()['split']('T')[0x0];await _0x2fcb61[_0x23fd03(0x10f)][_0x23fd03(0x109)]({'dueDate':_0x11f5c7}),await _0x2fcb61[_0x23fd03(0x109)]({'status':'paid'}),await _0x2fcb61[_0x23fd03(0x10f)][_0x23fd03(0x12e)]();const _0x9fa30f=(0x0,socket_1[_0x23fd03(0x114)])();_0x9fa30f['to'](_0x23fd03(0x125)+_0x2fcb61[_0x23fd03(0x120)]+_0x23fd03(0x130))['to'](_0x23fd03(0x11d))[_0x23fd03(0x135)]('company-'+_0x2fcb61[_0x23fd03(0x120)]+'-payment',{'action':'CONCLUIDA','company':_0x2fcb61[_0x23fd03(0x10f)],'invoiceId':_0x2fcb61['id']});}return _0x114486[_0x23fd03(0x106)]({'ok':!![]});};exports[a487_0x15bf4f(0x117)]=owenWebhook;const owenCheckStatus=async(_0x400fde,_0x462fbb=null)=>{const _0xa7271d=a487_0x15bf4f;try{!_0x462fbb&&(_0x462fbb=await owenLoadConfig());const _0x3afd41=await axios_1[_0xa7271d(0x12a)]['get'](owenBaseURL+_0xa7271d(0x131),{'params':{'qrcodeId':_0x400fde[_0xa7271d(0x128)],..._0x462fbb}});if(_0x3afd41?.[_0xa7271d(0x13b)]?.[_0xa7271d(0x13b)]?.[_0xa7271d(0x123)]!==_0xa7271d(0xfa))return![];if(_0x3afd41?.['data']?.[_0xa7271d(0x13b)]?.[_0xa7271d(0x11a)]?.['valor']>=_0x400fde['value'])return await(0x0,PaymentGatewayServices_1['processInvoicePaid'])(_0x400fde),!![];return![];}catch(_0x18da17){logger_1['logger'][_0xa7271d(0x105)](_0x18da17,_0xa7271d(0x104));}return![];};exports[a487_0x15bf4f(0x10a)]=owenCheckStatus;const owenPollCheckStatus=async(_0x53431f,_0x443be9,_0xb2224d=0xa,_0x31ff4b=0x7530)=>{let _0x46a8cb=0x0;async function _0x587c6b(){const _0x5b0355=a487_0x1255;await _0x443be9[_0x5b0355(0x12e)]();if(_0x443be9[_0x5b0355(0x123)]===_0x5b0355(0x116)){logger_1['logger'][_0x5b0355(0x136)]('owenPollCheckStatus:\x20Invoice\x20'+_0x443be9['id']+_0x5b0355(0x133));return;}const _0x5d989f=await(0x0,exports[_0x5b0355(0x10a)])(_0x443be9,_0x53431f);if(_0x5d989f)return;_0x46a8cb+=0x1;if(_0x46a8cb>=_0xb2224d){(0x0,PaymentGatewayServices_1[_0x5b0355(0x126)])(_0x443be9);return;}await new Promise(_0x254777=>{setTimeout(_0x254777,_0x31ff4b);}),await _0x587c6b();}return _0x587c6b();},owenCreateSubscription=async(_0x397bb0,_0x1b44a0)=>{const _0x48690c=a487_0x15bf4f,{price:_0x5bd4f0,invoiceId:_0x445ec0}=_0x397bb0[_0x48690c(0xfb)],_0x1e51fc=await owenLoadConfig(),_0x1af47e={'params':{'valor':_0x5bd4f0[_0x48690c(0x127)]([0x2]),'minutos':0x5,'mensagem':_0x48690c(0x111)+_0x445ec0,..._0x1e51fc}};try{const _0x740fc0=await Invoices_1[_0x48690c(0x12a)][_0x48690c(0x10e)](_0x445ec0);if(!_0x740fc0)throw new Error(_0x48690c(0x10b));const _0x3bffef=await axios_1['default']['get'](owenBaseURL+'/qrdinamico',_0x1af47e);return _0x740fc0[_0x48690c(0x109)]({'value':_0x5bd4f0,'txId':_0x3bffef[_0x48690c(0x13b)]['data']['qrcodeId'],'payGw':_0x48690c(0x12b),'payGwData':JSON[_0x48690c(0x113)](_0x3bffef[_0x48690c(0x13b)][_0x48690c(0x13b)])}),owenPollCheckStatus(_0x1e51fc,_0x740fc0),_0x1b44a0[_0x48690c(0x106)]({'qrcode':{'qrcode':_0x3bffef['data'][_0x48690c(0x13b)][_0x48690c(0x115)]},'valor':{'original':_0x5bd4f0}});}catch(_0x3050b9){logger_1[_0x48690c(0x11f)][_0x48690c(0x105)]({'error':_0x3050b9},'owenCreateSubscription\x20error');throw new AppError_1[(_0x48690c(0x12a))](_0x48690c(0x112),0x190);}};exports['owenCreateSubscription']=owenCreateSubscription;