const a484_0x4261dd=a484_0x4e02;(function(_0x4f8608,_0x2492b9){const _0x25b750=a484_0x4e02,_0xb9521e=_0x4f8608();while(!![]){try{const _0x3de3ac=-parseInt(_0x25b750(0x190))/0x1+parseInt(_0x25b750(0x17e))/0x2*(parseInt(_0x25b750(0x19f))/0x3)+parseInt(_0x25b750(0x198))/0x4+-parseInt(_0x25b750(0x165))/0x5*(parseInt(_0x25b750(0x1a0))/0x6)+parseInt(_0x25b750(0x193))/0x7*(parseInt(_0x25b750(0x162))/0x8)+parseInt(_0x25b750(0x16c))/0x9*(-parseInt(_0x25b750(0x18d))/0xa)+-parseInt(_0x25b750(0x17a))/0xb*(-parseInt(_0x25b750(0x180))/0xc);if(_0x3de3ac===_0x2492b9)break;else _0xb9521e['push'](_0xb9521e['shift']());}catch(_0x1c39a5){_0xb9521e['push'](_0xb9521e['shift']());}}}(a484_0x3d7c,0x21487));const a484_0x8774cf=(function(){let _0x5d7d0f=!![];return function(_0x465b36,_0x3eac80){const _0xb077ba=_0x5d7d0f?function(){if(_0x3eac80){const _0x629764=_0x3eac80['apply'](_0x465b36,arguments);return _0x3eac80=null,_0x629764;}}:function(){};return _0x5d7d0f=![],_0xb077ba;};}()),a484_0x218b62=a484_0x8774cf(this,function(){const _0x3f0b05=a484_0x4e02;return a484_0x218b62['toString']()[_0x3f0b05(0x18b)](_0x3f0b05(0x189))['toString']()[_0x3f0b05(0x1a2)](a484_0x218b62)[_0x3f0b05(0x18b)](_0x3f0b05(0x189));});a484_0x218b62();'use strict';function a484_0x4e02(_0xe4da39,_0x409d47){const _0x38d21a=a484_0x3d7c();return a484_0x4e02=function(_0x218b62,_0x8774cf){_0x218b62=_0x218b62-0x15f;let _0x3d7c88=_0x38d21a[_0x218b62];return _0x3d7c88;},a484_0x4e02(_0xe4da39,_0x409d47);}function a484_0x3d7c(){const _0x311b14=['qrcode','company','_owenCnpj','error','_owenSecretKey','valor','76428VsrtgY','company-','getIO','owen','33692dNRQTz','../../utils/logger','264lqnEuD','getDate','emit','APPROVED','sender','#Fatura:','open','../SettingServices/GetSuperSettingService','logger','(((.+)+)+)+$','status','search','_owenToken','3900zmvYgf','update','get','252382UqhCkH','split','processInvoicePaid','6839Xfzncc','body','owenWebhook','paid','findByPk','56088HJQPRk','owenCreateSubscription','owenCheckStatus','./PaymentGatewayServices','-payment','data','stringify','45dJqDfm','348cnaXvp','json','constructor','default','reload','value','companyId','dueDate','\x20already\x20paid,\x20finishing\x20polling','setDate','936yDnLOQ','qrcodeId','__importDefault','1655kXlVDz','defineProperty','toFixed','/qrstatus','../../models/Invoices','owenCreateSubscription\x20error','processInvoiceExpired','2907hvDUzR','CONCLUIDA','/qrdinamico','owenPollCheckStatus:\x20Invoice\x20','__esModule','debug','-mainchannel','findOne'];a484_0x3d7c=function(){return _0x311b14;};return a484_0x3d7c();}var __importDefault=this&&this[a484_0x4261dd(0x164)]||function(_0x3602fd){return _0x3602fd&&_0x3602fd['__esModule']?_0x3602fd:{'default':_0x3602fd};};Object[a484_0x4261dd(0x166)](exports,a484_0x4261dd(0x170),{'value':!![]}),exports[a484_0x4261dd(0x199)]=exports[a484_0x4261dd(0x19a)]=exports['owenWebhook']=void 0x0;const axios_1=__importDefault(require('axios')),GetSuperSettingService_1=__importDefault(require(a484_0x4261dd(0x187))),logger_1=require(a484_0x4261dd(0x17f)),socket_1=require('../../libs/socket'),Invoices_1=__importDefault(require(a484_0x4261dd(0x169))),Company_1=__importDefault(require('../../models/Company')),AppError_1=__importDefault(require('../../errors/AppError')),PaymentGatewayServices_1=require(a484_0x4261dd(0x19b)),owenBaseURL='https://api.apipix.me/v1',owenLoadConfig=async()=>{const _0x443d48=a484_0x4261dd;return{'user':await(0x0,GetSuperSettingService_1['default'])({'key':_0x443d48(0x176)}),'password':await(0x0,GetSuperSettingService_1[_0x443d48(0x1a3)])({'key':_0x443d48(0x18c)}),'secretkey':await(0x0,GetSuperSettingService_1['default'])({'key':_0x443d48(0x178)})};},owenWebhook=async(_0x3c0665,_0x3aafc0)=>{const _0x327535=a484_0x4261dd,{data:_0x2c0693}=_0x3c0665[_0x327535(0x194)];if(_0x2c0693[_0x327535(0x18a)]===_0x327535(0x183)){const {qrcodeId:_0x5f0d89}=_0x2c0693,_0x337704=await Invoices_1['default'][_0x327535(0x173)]({'where':{'txId':_0x5f0d89,'status':_0x327535(0x186)},'include':{'model':Company_1[_0x327535(0x1a3)],'as':_0x327535(0x175)}});if(!_0x337704||_0x2c0693[_0x327535(0x179)]<_0x337704[_0x327535(0x1a5)])return _0x3aafc0[_0x327535(0x1a1)]({'ok':!![]});const _0x214108=new Date(_0x337704[_0x327535(0x175)][_0x327535(0x15f)]);_0x214108[_0x327535(0x161)](_0x214108[_0x327535(0x181)]()+0x1e);const _0x1cdc97=_0x214108['toISOString']()[_0x327535(0x191)]('T')[0x0];await _0x337704['company']['update']({'dueDate':_0x1cdc97}),await _0x337704['update']({'status':_0x327535(0x196)}),await _0x337704['company'][_0x327535(0x1a4)]();const _0x3baa04=(0x0,socket_1[_0x327535(0x17c)])();_0x3baa04['to'](_0x327535(0x17b)+_0x337704[_0x327535(0x1a6)]+_0x327535(0x172))['to']('super')[_0x327535(0x182)](_0x327535(0x17b)+_0x337704['companyId']+_0x327535(0x19c),{'action':_0x327535(0x16d),'company':_0x337704['company'],'invoiceId':_0x337704['id']});}return _0x3aafc0[_0x327535(0x1a1)]({'ok':!![]});};exports[a484_0x4261dd(0x195)]=owenWebhook;const owenCheckStatus=async(_0x440b14,_0x2046bd=null)=>{const _0x5976f4=a484_0x4261dd;try{!_0x2046bd&&(_0x2046bd=await owenLoadConfig());const _0x439a92=await axios_1[_0x5976f4(0x1a3)]['get'](owenBaseURL+_0x5976f4(0x168),{'params':{'qrcodeId':_0x440b14['txId'],..._0x2046bd}});if(_0x439a92?.[_0x5976f4(0x19d)]?.[_0x5976f4(0x19d)]?.[_0x5976f4(0x18a)]!==_0x5976f4(0x183))return![];if(_0x439a92?.[_0x5976f4(0x19d)]?.[_0x5976f4(0x19d)]?.[_0x5976f4(0x184)]?.['valor']>=_0x440b14['value'])return await(0x0,PaymentGatewayServices_1[_0x5976f4(0x192)])(_0x440b14),!![];return![];}catch(_0x218433){logger_1[_0x5976f4(0x188)][_0x5976f4(0x177)](_0x218433,'Error\x20getting\x20detail\x20of\x20txid');}return![];};exports[a484_0x4261dd(0x19a)]=owenCheckStatus;const owenPollCheckStatus=async(_0x571564,_0x43f499,_0x5a71e8=0xa,_0x1dc07f=0x7530)=>{let _0x53523f=0x0;async function _0x492f62(){const _0x60d505=a484_0x4e02;await _0x43f499[_0x60d505(0x1a4)]();if(_0x43f499[_0x60d505(0x18a)]===_0x60d505(0x196)){logger_1[_0x60d505(0x188)][_0x60d505(0x171)](_0x60d505(0x16f)+_0x43f499['id']+_0x60d505(0x160));return;}const _0x2c06d3=await(0x0,exports[_0x60d505(0x19a)])(_0x43f499,_0x571564);if(_0x2c06d3)return;_0x53523f+=0x1;if(_0x53523f>=_0x5a71e8){(0x0,PaymentGatewayServices_1[_0x60d505(0x16b)])(_0x43f499);return;}await new Promise(_0x176b9b=>{setTimeout(_0x176b9b,_0x1dc07f);}),await _0x492f62();}return _0x492f62();},owenCreateSubscription=async(_0x53ceed,_0x4dcb14)=>{const _0x14f32b=a484_0x4261dd,{price:_0x5eeb75,invoiceId:_0x104dc8}=_0x53ceed['body'],_0xeae49d=await owenLoadConfig(),_0x167df3={'params':{'valor':_0x5eeb75[_0x14f32b(0x167)]([0x2]),'minutos':0x5,'mensagem':_0x14f32b(0x185)+_0x104dc8,..._0xeae49d}};try{const _0x4e8383=await Invoices_1[_0x14f32b(0x1a3)][_0x14f32b(0x197)](_0x104dc8);if(!_0x4e8383)throw new Error('Invoice\x20not\x20found');const _0x31169b=await axios_1[_0x14f32b(0x1a3)][_0x14f32b(0x18f)](owenBaseURL+_0x14f32b(0x16e),_0x167df3);return _0x4e8383[_0x14f32b(0x18e)]({'value':_0x5eeb75,'txId':_0x31169b['data'][_0x14f32b(0x19d)][_0x14f32b(0x163)],'payGw':_0x14f32b(0x17d),'payGwData':JSON[_0x14f32b(0x19e)](_0x31169b[_0x14f32b(0x19d)][_0x14f32b(0x19d)])}),owenPollCheckStatus(_0xeae49d,_0x4e8383),_0x4dcb14[_0x14f32b(0x1a1)]({'qrcode':{'qrcode':_0x31169b[_0x14f32b(0x19d)]['data'][_0x14f32b(0x174)]},'valor':{'original':_0x5eeb75}});}catch(_0x2fabda){logger_1[_0x14f32b(0x188)][_0x14f32b(0x177)]({'error':_0x2fabda},_0x14f32b(0x16a));throw new AppError_1[(_0x14f32b(0x1a3))]('Problema\x20encontrado,\x20entre\x20em\x20contato\x20com\x20o\x20suporte!',0x190);}};exports[a484_0x4261dd(0x199)]=owenCreateSubscription;