function a484_0x5922(){const _0x1689cc=['2737662VJawPz','logger','Problema\x20encontrado,\x20entre\x20em\x20contato\x20com\x20o\x20suporte!','json','open','search','stringify','../../models/Invoices','1626328fHdxWH','18venJmM','-payment','owenCreateSubscription','#Fatura:','debug','dueDate','error','toFixed','sender','./PaymentGatewayServices','qrcode','49AIaymk','owenCheckStatus','APPROVED','/qrdinamico','setDate','company-','txId','_owenToken','findOne','toString','25ssaFlx','263212OEviZE','update','processInvoiceExpired','company','../../utils/logger','Invoice\x20not\x20found','default','618149CAYckN','__esModule','emit','3386NymfMC','companyId','/qrstatus','reload','owenWebhook','status','_owenSecretKey','apply','findByPk','axios','value','body','16mGOgyN','get','https://api.apipix.me/v1','(((.+)+)+)+$','processInvoicePaid','313290ZPJNjL','935121uLJpbs','valor','data','constructor','_owenCnpj','getIO','paid','\x20already\x20paid,\x20finishing\x20polling','owenCreateSubscription\x20error','owen','split','-mainchannel','../SettingServices/GetSuperSettingService','owenPollCheckStatus:\x20Invoice\x20'];a484_0x5922=function(){return _0x1689cc;};return a484_0x5922();}const a484_0x3a3416=a484_0x3076;function a484_0x3076(_0xf856a7,_0x44ee85){const _0x39323d=a484_0x5922();return a484_0x3076=function(_0x36c2fe,_0x5f1a73){_0x36c2fe=_0x36c2fe-0x15f;let _0x592234=_0x39323d[_0x36c2fe];return _0x592234;},a484_0x3076(_0xf856a7,_0x44ee85);}(function(_0x15c98f,_0x32b802){const _0x592e65=a484_0x3076,_0x584277=_0x15c98f();while(!![]){try{const _0x405f18=parseInt(_0x592e65(0x172))/0x1*(parseInt(_0x592e65(0x187))/0x2)+parseInt(_0x592e65(0x199))/0x3+parseInt(_0x592e65(0x17d))/0x4*(parseInt(_0x592e65(0x17c))/0x5)+-parseInt(_0x592e65(0x1a7))/0x6+-parseInt(_0x592e65(0x184))/0x7*(-parseInt(_0x592e65(0x193))/0x8)+parseInt(_0x592e65(0x167))/0x9*(-parseInt(_0x592e65(0x198))/0xa)+-parseInt(_0x592e65(0x166))/0xb;if(_0x405f18===_0x32b802)break;else _0x584277['push'](_0x584277['shift']());}catch(_0x495127){_0x584277['push'](_0x584277['shift']());}}}(a484_0x5922,0x39026));const a484_0x5f1a73=(function(){let _0x3668d3=!![];return function(_0x3dfd4b,_0x395623){const _0x10b613=_0x3668d3?function(){const _0x53b308=a484_0x3076;if(_0x395623){const _0x4f5cc4=_0x395623[_0x53b308(0x18e)](_0x3dfd4b,arguments);return _0x395623=null,_0x4f5cc4;}}:function(){};return _0x3668d3=![],_0x10b613;};}()),a484_0x36c2fe=a484_0x5f1a73(this,function(){const _0x523f77=a484_0x3076;return a484_0x36c2fe[_0x523f77(0x17b)]()[_0x523f77(0x163)]('(((.+)+)+)+$')[_0x523f77(0x17b)]()[_0x523f77(0x19c)](a484_0x36c2fe)['search'](_0x523f77(0x196));});a484_0x36c2fe();'use strict';var __importDefault=this&&this['__importDefault']||function(_0xa3cf98){const _0x50575a=a484_0x3076;return _0xa3cf98&&_0xa3cf98[_0x50575a(0x185)]?_0xa3cf98:{'default':_0xa3cf98};};Object['defineProperty'](exports,a484_0x3a3416(0x185),{'value':!![]}),exports[a484_0x3a3416(0x169)]=exports[a484_0x3a3416(0x173)]=exports[a484_0x3a3416(0x18b)]=void 0x0;const axios_1=__importDefault(require(a484_0x3a3416(0x190))),GetSuperSettingService_1=__importDefault(require(a484_0x3a3416(0x1a5))),logger_1=require(a484_0x3a3416(0x181)),socket_1=require('../../libs/socket'),Invoices_1=__importDefault(require(a484_0x3a3416(0x165))),Company_1=__importDefault(require('../../models/Company')),AppError_1=__importDefault(require('../../errors/AppError')),PaymentGatewayServices_1=require(a484_0x3a3416(0x170)),owenBaseURL=a484_0x3a3416(0x195),owenLoadConfig=async()=>{const _0x2f0ad6=a484_0x3a3416;return{'user':await(0x0,GetSuperSettingService_1['default'])({'key':_0x2f0ad6(0x19d)}),'password':await(0x0,GetSuperSettingService_1[_0x2f0ad6(0x183)])({'key':_0x2f0ad6(0x179)}),'secretkey':await(0x0,GetSuperSettingService_1[_0x2f0ad6(0x183)])({'key':_0x2f0ad6(0x18d)})};},owenWebhook=async(_0x171be9,_0x2cbee1)=>{const _0x5ddc37=a484_0x3a3416,{data:_0x29e317}=_0x171be9[_0x5ddc37(0x192)];if(_0x29e317[_0x5ddc37(0x18c)]===_0x5ddc37(0x174)){const {qrcodeId:_0x279107}=_0x29e317,_0x1f11a3=await Invoices_1['default'][_0x5ddc37(0x17a)]({'where':{'txId':_0x279107,'status':_0x5ddc37(0x162)},'include':{'model':Company_1[_0x5ddc37(0x183)],'as':_0x5ddc37(0x180)}});if(!_0x1f11a3||_0x29e317[_0x5ddc37(0x19a)]<_0x1f11a3[_0x5ddc37(0x191)])return _0x2cbee1[_0x5ddc37(0x161)]({'ok':!![]});const _0x42a05d=new Date(_0x1f11a3[_0x5ddc37(0x180)][_0x5ddc37(0x16c)]);_0x42a05d[_0x5ddc37(0x176)](_0x42a05d['getDate']()+0x1e);const _0x576592=_0x42a05d['toISOString']()[_0x5ddc37(0x1a3)]('T')[0x0];await _0x1f11a3[_0x5ddc37(0x180)]['update']({'dueDate':_0x576592}),await _0x1f11a3[_0x5ddc37(0x17e)]({'status':_0x5ddc37(0x19f)}),await _0x1f11a3[_0x5ddc37(0x180)][_0x5ddc37(0x18a)]();const _0x227b58=(0x0,socket_1[_0x5ddc37(0x19e)])();_0x227b58['to'](_0x5ddc37(0x177)+_0x1f11a3[_0x5ddc37(0x188)]+_0x5ddc37(0x1a4))['to']('super')[_0x5ddc37(0x186)](_0x5ddc37(0x177)+_0x1f11a3[_0x5ddc37(0x188)]+_0x5ddc37(0x168),{'action':'CONCLUIDA','company':_0x1f11a3[_0x5ddc37(0x180)],'invoiceId':_0x1f11a3['id']});}return _0x2cbee1[_0x5ddc37(0x161)]({'ok':!![]});};exports[a484_0x3a3416(0x18b)]=owenWebhook;const owenCheckStatus=async(_0x4702b8,_0x1ee46c=null)=>{const _0x256308=a484_0x3a3416;try{!_0x1ee46c&&(_0x1ee46c=await owenLoadConfig());const _0x497cd1=await axios_1['default'][_0x256308(0x194)](owenBaseURL+_0x256308(0x189),{'params':{'qrcodeId':_0x4702b8[_0x256308(0x178)],..._0x1ee46c}});if(_0x497cd1?.['data']?.[_0x256308(0x19b)]?.[_0x256308(0x18c)]!=='APPROVED')return![];if(_0x497cd1?.[_0x256308(0x19b)]?.['data']?.[_0x256308(0x16f)]?.['valor']>=_0x4702b8[_0x256308(0x191)])return await(0x0,PaymentGatewayServices_1[_0x256308(0x197)])(_0x4702b8),!![];return![];}catch(_0x29d767){logger_1[_0x256308(0x15f)][_0x256308(0x16d)](_0x29d767,'Error\x20getting\x20detail\x20of\x20txid');}return![];};exports[a484_0x3a3416(0x173)]=owenCheckStatus;const owenPollCheckStatus=async(_0xe73ac6,_0xad07b7,_0x21be0c=0xa,_0x30bc8c=0x7530)=>{let _0x8cab74=0x0;async function _0xfce8c0(){const _0x5283f4=a484_0x3076;await _0xad07b7[_0x5283f4(0x18a)]();if(_0xad07b7[_0x5283f4(0x18c)]===_0x5283f4(0x19f)){logger_1[_0x5283f4(0x15f)][_0x5283f4(0x16b)](_0x5283f4(0x1a6)+_0xad07b7['id']+_0x5283f4(0x1a0));return;}const _0x3d7b36=await(0x0,exports[_0x5283f4(0x173)])(_0xad07b7,_0xe73ac6);if(_0x3d7b36)return;_0x8cab74+=0x1;if(_0x8cab74>=_0x21be0c){(0x0,PaymentGatewayServices_1[_0x5283f4(0x17f)])(_0xad07b7);return;}await new Promise(_0x47ebf6=>{setTimeout(_0x47ebf6,_0x30bc8c);}),await _0xfce8c0();}return _0xfce8c0();},owenCreateSubscription=async(_0x474e01,_0x3c6129)=>{const _0x1813b9=a484_0x3a3416,{price:_0x4737b7,invoiceId:_0x9a0d66}=_0x474e01[_0x1813b9(0x192)],_0x21d5c4=await owenLoadConfig(),_0x47750b={'params':{'valor':_0x4737b7[_0x1813b9(0x16e)]([0x2]),'minutos':0x5,'mensagem':_0x1813b9(0x16a)+_0x9a0d66,..._0x21d5c4}};try{const _0x28dc6a=await Invoices_1[_0x1813b9(0x183)][_0x1813b9(0x18f)](_0x9a0d66);if(!_0x28dc6a)throw new Error(_0x1813b9(0x182));const _0x277156=await axios_1['default'][_0x1813b9(0x194)](owenBaseURL+_0x1813b9(0x175),_0x47750b);return _0x28dc6a[_0x1813b9(0x17e)]({'value':_0x4737b7,'txId':_0x277156[_0x1813b9(0x19b)][_0x1813b9(0x19b)]['qrcodeId'],'payGw':_0x1813b9(0x1a2),'payGwData':JSON[_0x1813b9(0x164)](_0x277156[_0x1813b9(0x19b)][_0x1813b9(0x19b)])}),owenPollCheckStatus(_0x21d5c4,_0x28dc6a),_0x3c6129[_0x1813b9(0x161)]({'qrcode':{'qrcode':_0x277156[_0x1813b9(0x19b)]['data'][_0x1813b9(0x171)]},'valor':{'original':_0x4737b7}});}catch(_0x5c1d70){logger_1[_0x1813b9(0x15f)][_0x1813b9(0x16d)]({'error':_0x5c1d70},_0x1813b9(0x1a1));throw new AppError_1[(_0x1813b9(0x183))](_0x1813b9(0x160),0x190);}};exports[a484_0x3a3416(0x169)]=owenCreateSubscription;