const a452_0x495259=a452_0xadb5;(function(_0x46f25d,_0x14f557){const _0x5723f9=a452_0xadb5,_0x384643=_0x46f25d();while(!![]){try{const _0x191af6=parseInt(_0x5723f9(0x1f3))/0x1+parseInt(_0x5723f9(0x1c5))/0x2*(parseInt(_0x5723f9(0x1c7))/0x3)+parseInt(_0x5723f9(0x1f4))/0x4*(-parseInt(_0x5723f9(0x1ee))/0x5)+-parseInt(_0x5723f9(0x1fe))/0x6*(-parseInt(_0x5723f9(0x1ef))/0x7)+-parseInt(_0x5723f9(0x1eb))/0x8*(-parseInt(_0x5723f9(0x1d8))/0x9)+-parseInt(_0x5723f9(0x1ed))/0xa*(parseInt(_0x5723f9(0x1c9))/0xb)+-parseInt(_0x5723f9(0x1cd))/0xc*(parseInt(_0x5723f9(0x1cb))/0xd);if(_0x191af6===_0x14f557)break;else _0x384643['push'](_0x384643['shift']());}catch(_0x4b81ca){_0x384643['push'](_0x384643['shift']());}}}(a452_0x4994,0xa8149));const a452_0x548ea2=(function(){let _0x4240c8=!![];return function(_0xdee01d,_0xc1548a){const _0x214c39=_0x4240c8?function(){const _0x483959=a452_0xadb5;if(_0xc1548a){const _0x11db77=_0xc1548a[_0x483959(0x1dd)](_0xdee01d,arguments);return _0xc1548a=null,_0x11db77;}}:function(){};return _0x4240c8=![],_0x214c39;};}()),a452_0x13939c=a452_0x548ea2(this,function(){const _0x3b1ae3=a452_0xadb5;return a452_0x13939c[_0x3b1ae3(0x1d2)]()[_0x3b1ae3(0x1e6)](_0x3b1ae3(0x1d3))['toString']()[_0x3b1ae3(0x1d1)](a452_0x13939c)[_0x3b1ae3(0x1e6)](_0x3b1ae3(0x1d3));});function a452_0x4994(){const _0x3a2a6f=['CONCLUIDA','forEach','super','../../models/Company','644319zAJKQM','payGatewayCreateSubscription','payGw','reload','stripeCreateSubscription','apply','defineProperty','stripeCheckStatus','companyId','dueDate','company-','stripeInitialize','emit','setDate','search','payGatewayReceiveWebhook','checkInvoicePayment','findByPk','__importDefault','104mhihRs','stripe','20GHXFRR','1285XzKJoe','27769RzPTOn','-payment','efi','__esModule','866499btjJgd','5972bKAMej','default','efiCreateSubscription','checkOpenInvoices','-mainchannel','update','efiInitialize','getDate','efiCheckStatus','payGatewayInitialize','708PTDygD','processInvoiceExpired','processInvoicePaid','Unsupported\x20payment\x20gateway','_paymentGateway','2732182vYIdPs','stripeWebhookHandler','3CstEAs','./EfiServices','2819069GwjhUP','EXPIRADA','2956291awlbTz','../InvoicesService/FindOpenInvoiceService','108MnBXsN','getIO','./StripeServices','../SettingServices/GetSuperSettingService','constructor','toString','(((.+)+)+)+$'];a452_0x4994=function(){return _0x3a2a6f;};return a452_0x4994();}a452_0x13939c();'use strict';var __importDefault=this&&this[a452_0x495259(0x1ea)]||function(_0x2c713f){return _0x2c713f&&_0x2c713f['__esModule']?_0x2c713f:{'default':_0x2c713f};};Object[a452_0x495259(0x1de)](exports,a452_0x495259(0x1f2),{'value':!![]}),exports[a452_0x495259(0x1f7)]=exports[a452_0x495259(0x1e8)]=exports['processInvoiceExpired']=exports[a452_0x495259(0x1c2)]=exports['payGatewayReceiveWebhook']=exports[a452_0x495259(0x1d9)]=exports['payGatewayInitialize']=void 0x0;const AppError_1=__importDefault(require('../../errors/AppError')),GetSuperSettingService_1=__importDefault(require(a452_0x495259(0x1d0))),EfiServices_1=require(a452_0x495259(0x1c8)),StripeServices_1=require(a452_0x495259(0x1cf)),Invoices_1=__importDefault(require('../../models/Invoices')),socket_1=require('../../libs/socket'),Company_1=__importDefault(require(a452_0x495259(0x1d7))),FindOpenInvoiceService_1=__importDefault(require(a452_0x495259(0x1cc))),payGatewayInitialize=async()=>{const _0x3688ac=a452_0x495259,_0x4f0ab2=await(0x0,GetSuperSettingService_1[_0x3688ac(0x1f5)])({'key':_0x3688ac(0x1c4)});switch(_0x4f0ab2){case _0x3688ac(0x1f1):return(0x0,EfiServices_1[_0x3688ac(0x1fa)])();case _0x3688ac(0x1ec):return(0x0,StripeServices_1[_0x3688ac(0x1e3)])();default:throw new AppError_1[(_0x3688ac(0x1f5))]('Unsupported\x20payment\x20gateway',0x190);}};exports[a452_0x495259(0x1fd)]=payGatewayInitialize;const payGatewayCreateSubscription=async(_0xc48452,_0x4bcadb)=>{const _0xfb5366=a452_0x495259,_0x194ec9=await(0x0,GetSuperSettingService_1['default'])({'key':_0xfb5366(0x1c4)});switch(_0x194ec9){case _0xfb5366(0x1f1):return(0x0,EfiServices_1[_0xfb5366(0x1f6)])(_0xc48452,_0x4bcadb);case'stripe':return(0x0,StripeServices_1[_0xfb5366(0x1dc)])(_0xc48452,_0x4bcadb);default:throw new AppError_1[(_0xfb5366(0x1f5))]('Unsupported\x20payment\x20gateway',0x190);}};exports[a452_0x495259(0x1d9)]=payGatewayCreateSubscription;const payGatewayReceiveWebhook=async(_0x411244,_0x213e05)=>{const _0x20601=a452_0x495259,_0x362793=await(0x0,GetSuperSettingService_1[_0x20601(0x1f5)])({'key':'_paymentGateway'});switch(_0x362793){case _0x20601(0x1f1):return(0x0,EfiServices_1['efiWebhook'])(_0x411244,_0x213e05);case _0x20601(0x1ec):return(0x0,StripeServices_1[_0x20601(0x1c6)])(_0x411244,_0x213e05);default:throw new AppError_1[(_0x20601(0x1f5))](_0x20601(0x1c3),0x190);}};exports[a452_0x495259(0x1e7)]=payGatewayReceiveWebhook;const processInvoicePaid=async _0x18fb9c=>{const _0x419d05=a452_0x495259,_0x1a63cf=_0x18fb9c['company']||await Company_1['default'][_0x419d05(0x1e9)](_0x18fb9c[_0x419d05(0x1e0)]);if(_0x1a63cf){const _0x4b7dcc=new Date(_0x1a63cf[_0x419d05(0x1e1)]);_0x4b7dcc[_0x419d05(0x1e5)](_0x4b7dcc[_0x419d05(0x1fb)]()+0x1e),await _0x1a63cf['update']({'dueDate':_0x4b7dcc}),await _0x18fb9c['update']({'status':'paid'}),await _0x1a63cf[_0x419d05(0x1db)]();const _0x4e6ad4=(0x0,socket_1['getIO'])();_0x4e6ad4['to']('company-'+_0x18fb9c[_0x419d05(0x1e0)]+_0x419d05(0x1f8))['to']('super')[_0x419d05(0x1e4)](_0x419d05(0x1e2)+_0x18fb9c[_0x419d05(0x1e0)]+_0x419d05(0x1f0),{'action':_0x419d05(0x1d4),'company':_0x1a63cf,'invoiceId':_0x18fb9c['id']});}};exports[a452_0x495259(0x1c2)]=processInvoicePaid;const processInvoiceExpired=async _0x4781f5=>{const _0xa7928c=a452_0x495259,_0x4523ca=(0x0,socket_1[_0xa7928c(0x1ce)])();await _0x4781f5[_0xa7928c(0x1f9)]({'txId':null,'payGw':null,'payGwData':null}),await _0x4781f5['reload'](),_0x4523ca['to']('company-'+_0x4781f5[_0xa7928c(0x1e0)]+_0xa7928c(0x1f8))['to'](_0xa7928c(0x1d6))[_0xa7928c(0x1e4)](_0xa7928c(0x1e2)+_0x4781f5[_0xa7928c(0x1e0)]+'-payment',{'action':_0xa7928c(0x1ca),'company':_0x4781f5['company']||await Invoices_1[_0xa7928c(0x1f5)][_0xa7928c(0x1e9)](_0x4781f5[_0xa7928c(0x1e0)]),'invoiceId':_0x4781f5['id']});};exports[a452_0x495259(0x1c1)]=processInvoiceExpired;const checkInvoicePayment=async _0x1c2a42=>{const _0x1cb37c=a452_0x495259;if(_0x1c2a42[_0x1cb37c(0x1da)]===_0x1cb37c(0x1f1))(0x0,EfiServices_1[_0x1cb37c(0x1fc)])(_0x1c2a42);else _0x1c2a42[_0x1cb37c(0x1da)]===_0x1cb37c(0x1ec)&&(0x0,StripeServices_1[_0x1cb37c(0x1df)])(_0x1c2a42['id']);};exports[a452_0x495259(0x1e8)]=checkInvoicePayment;const checkOpenInvoices=async _0x12cd27=>{const _0x4b5197=a452_0x495259,_0x8b1678=await(0x0,FindOpenInvoiceService_1['default'])(_0x12cd27);_0x8b1678[_0x4b5197(0x1d5)](_0x24ef9c=>{const _0x38a70c=_0x4b5197;(0x0,exports[_0x38a70c(0x1e8)])(_0x24ef9c);});};function a452_0xadb5(_0x18c33e,_0xaaf1b9){const _0x38bc6f=a452_0x4994();return a452_0xadb5=function(_0x13939c,_0x548ea2){_0x13939c=_0x13939c-0x1c1;let _0x499492=_0x38bc6f[_0x13939c];return _0x499492;},a452_0xadb5(_0x18c33e,_0xaaf1b9);}exports['checkOpenInvoices']=checkOpenInvoices;