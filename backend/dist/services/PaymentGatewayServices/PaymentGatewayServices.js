const a485_0x11108b=a485_0x65a0;(function(_0x426798,_0x4d104d){const _0x3a44be=a485_0x65a0,_0x3182fb=_0x426798();while(!![]){try{const _0x59b512=-parseInt(_0x3a44be(0x1a4))/0x1+parseInt(_0x3a44be(0x1d7))/0x2+-parseInt(_0x3a44be(0x1de))/0x3+-parseInt(_0x3a44be(0x1dc))/0x4+-parseInt(_0x3a44be(0x1c3))/0x5+-parseInt(_0x3a44be(0x1a6))/0x6+parseInt(_0x3a44be(0x1a3))/0x7*(parseInt(_0x3a44be(0x1aa))/0x8);if(_0x59b512===_0x4d104d)break;else _0x3182fb['push'](_0x3182fb['shift']());}catch(_0xf744a){_0x3182fb['push'](_0x3182fb['shift']());}}}(a485_0x13d4,0xc1ce8));const a485_0x123e48=(function(){let _0x40b5fb=!![];return function(_0x35862c,_0x1c4c1f){const _0x4a10ec=_0x40b5fb?function(){const _0x17e32d=a485_0x65a0;if(_0x1c4c1f){const _0x4b8a61=_0x1c4c1f[_0x17e32d(0x1d9)](_0x35862c,arguments);return _0x1c4c1f=null,_0x4b8a61;}}:function(){};return _0x40b5fb=![],_0x4a10ec;};}()),a485_0x42a5e6=a485_0x123e48(this,function(){const _0x3681cb=a485_0x65a0;return a485_0x42a5e6[_0x3681cb(0x1c9)]()[_0x3681cb(0x1c8)](_0x3681cb(0x1a5))[_0x3681cb(0x1c9)]()[_0x3681cb(0x1a2)](a485_0x42a5e6)[_0x3681cb(0x1c8)](_0x3681cb(0x1a5));});a485_0x42a5e6();'use strict';var __importDefault=this&&this[a485_0x11108b(0x1d4)]||function(_0x2cf6be){const _0x456126=a485_0x11108b;return _0x2cf6be&&_0x2cf6be[_0x456126(0x1cb)]?_0x2cf6be:{'default':_0x2cf6be};};Object[a485_0x11108b(0x1ba)](exports,'__esModule',{'value':!![]}),exports['checkOpenInvoices']=exports['checkInvoicePayment']=exports[a485_0x11108b(0x1c0)]=exports[a485_0x11108b(0x1d2)]=exports[a485_0x11108b(0x1c1)]=exports[a485_0x11108b(0x1b1)]=exports['payGatewayInitialize']=void 0x0;const sequelize_1=require(a485_0x11108b(0x1d6)),moment_1=__importDefault(require(a485_0x11108b(0x1b8))),AppError_1=__importDefault(require(a485_0x11108b(0x1c5))),GetSuperSettingService_1=__importDefault(require(a485_0x11108b(0x1b0))),EfiServices_1=require(a485_0x11108b(0x1cd)),OwenServices_1=require(a485_0x11108b(0x1d1)),Invoices_1=__importDefault(require('../../models/Invoices')),socket_1=require(a485_0x11108b(0x1cc)),Company_1=__importDefault(require(a485_0x11108b(0x1af))),payGatewayInitialize=async()=>{const _0x4dc8a9=a485_0x11108b,_0x26acf2=await(0x0,GetSuperSettingService_1[_0x4dc8a9(0x1a8)])({'key':_0x4dc8a9(0x1db)});if(_0x26acf2===_0x4dc8a9(0x1a7))return(0x0,EfiServices_1['efiInitialize'])();return null;};exports[a485_0x11108b(0x1d0)]=payGatewayInitialize;const payGatewayCreateSubscription=async(_0x3a5076,_0x2016d6)=>{const _0x54fc2a=a485_0x11108b,_0x4849f6=await(0x0,GetSuperSettingService_1[_0x54fc2a(0x1a8)])({'key':'_paymentGateway'});switch(_0x4849f6){case _0x54fc2a(0x1a7):{return(0x0,EfiServices_1[_0x54fc2a(0x1ac)])(_0x3a5076,_0x2016d6);}case'owen':{return(0x0,OwenServices_1[_0x54fc2a(0x1bd)])(_0x3a5076,_0x2016d6);}default:{throw new AppError_1[(_0x54fc2a(0x1a8))](_0x54fc2a(0x1df),0x190);}}};function a485_0x65a0(_0x51aeed,_0x3f3006){const _0x4449db=a485_0x13d4();return a485_0x65a0=function(_0x42a5e6,_0x123e48){_0x42a5e6=_0x42a5e6-0x1a0;let _0x13d4de=_0x4449db[_0x42a5e6];return _0x13d4de;},a485_0x65a0(_0x51aeed,_0x3f3006);}exports[a485_0x11108b(0x1b1)]=payGatewayCreateSubscription;const payGatewayReceiveWebhook=async(_0x24da4e,_0x242ff0)=>{const _0x1dad5f=a485_0x11108b,_0x5d621f=await(0x0,GetSuperSettingService_1[_0x1dad5f(0x1a8)])({'key':_0x1dad5f(0x1db)});switch(_0x5d621f){case _0x1dad5f(0x1a7):{return(0x0,EfiServices_1[_0x1dad5f(0x1c4)])(_0x24da4e,_0x242ff0);}case'owen':{return(0x0,OwenServices_1[_0x1dad5f(0x1b9)])(_0x24da4e,_0x242ff0);}default:{throw new AppError_1['default'](_0x1dad5f(0x1df),0x190);}}};exports[a485_0x11108b(0x1c1)]=payGatewayReceiveWebhook;const processInvoicePaid=async _0x223d2c=>{const _0x5148f5=a485_0x11108b,_0x16c8b6=_0x223d2c[_0x5148f5(0x1bb)]||await Company_1[_0x5148f5(0x1a8)][_0x5148f5(0x1c7)](_0x223d2c[_0x5148f5(0x1c6)]);if(_0x16c8b6){const _0x1285ef=(0x0,moment_1[_0x5148f5(0x1a8)])(_0x16c8b6['dueDate']);let {dueDate:_0x552b6a}=_0x16c8b6;switch(_0x16c8b6[_0x5148f5(0x1d8)]){case _0x5148f5(0x1be):_0x552b6a=_0x1285ef[_0x5148f5(0x1b3)](0x2,_0x5148f5(0x1b2))[_0x5148f5(0x1ae)](_0x5148f5(0x1a0));break;case _0x5148f5(0x1ab):_0x552b6a=_0x1285ef[_0x5148f5(0x1b3)](0x3,_0x5148f5(0x1b2))[_0x5148f5(0x1ae)]('YYYY-MM-DD');break;case _0x5148f5(0x1a1):_0x552b6a=_0x1285ef[_0x5148f5(0x1b3)](0x6,'month')[_0x5148f5(0x1ae)](_0x5148f5(0x1a0));break;case _0x5148f5(0x1bf):_0x552b6a=_0x1285ef[_0x5148f5(0x1b3)](0xc,_0x5148f5(0x1b2))[_0x5148f5(0x1ae)](_0x5148f5(0x1a0));break;case _0x5148f5(0x1b4):default:_0x552b6a=_0x1285ef[_0x5148f5(0x1b3)](0x1,_0x5148f5(0x1b2))[_0x5148f5(0x1ae)](_0x5148f5(0x1a0));break;}await _0x16c8b6[_0x5148f5(0x1e4)]({'dueDate':_0x552b6a}),await _0x223d2c[_0x5148f5(0x1e4)]({'status':_0x5148f5(0x1da)}),await _0x16c8b6[_0x5148f5(0x1e0)]();const _0x1536fa=(0x0,socket_1[_0x5148f5(0x1bc)])();_0x1536fa['to'](_0x5148f5(0x1b6)+_0x223d2c[_0x5148f5(0x1c6)]+_0x5148f5(0x1ce))['to'](_0x5148f5(0x1ca))[_0x5148f5(0x1a9)](_0x5148f5(0x1b6)+_0x223d2c[_0x5148f5(0x1c6)]+_0x5148f5(0x1e3),{'action':'CONCLUIDA','company':_0x16c8b6,'invoiceId':_0x223d2c['id']});}};exports['processInvoicePaid']=processInvoicePaid;const processInvoiceExpired=async _0x940d2=>{const _0x7d8e10=a485_0x11108b,_0x4d13bf=(0x0,socket_1[_0x7d8e10(0x1bc)])();await _0x940d2[_0x7d8e10(0x1e4)]({'txId':null,'payGw':null,'payGwData':null}),await _0x940d2['reload'](),_0x4d13bf['to'](_0x7d8e10(0x1b6)+_0x940d2['companyId']+'-mainchannel')['to'](_0x7d8e10(0x1ca))[_0x7d8e10(0x1a9)](_0x7d8e10(0x1b6)+_0x940d2[_0x7d8e10(0x1c6)]+'-payment',{'action':_0x7d8e10(0x1e1),'company':_0x940d2[_0x7d8e10(0x1bb)]||await Invoices_1[_0x7d8e10(0x1a8)][_0x7d8e10(0x1c7)](_0x940d2[_0x7d8e10(0x1c6)]),'invoiceId':_0x940d2['id']});};function a485_0x13d4(){const _0x5c1987=['moment','owenWebhook','defineProperty','company','getIO','owenCreateSubscription','BIMESTRAL','ANUAL','processInvoiceExpired','payGatewayReceiveWebhook','forEach','5170925ecKpKf','efiWebhook','../../errors/AppError','companyId','findByPk','search','toString','super','__esModule','../../libs/socket','./EfiServices','-mainchannel','findAll','payGatewayInitialize','./OwenServices','processInvoicePaid','not','__importDefault','owen','sequelize','604922vZIPSY','recurrence','apply','paid','_paymentGateway','3660944lDdDOK','checkInvoicePayment','2600811wlpuGw','Unsupported\x20payment\x20gateway','reload','EXPIRADA','payGw','-payment','update','YYYY-MM-DD','SEMESTRAL','constructor','42819490NUVHgJ','1447117fcfjQm','(((.+)+)+)+$','8173344orBXUP','efi','default','emit','8yCLsHs','TRIMESTRAL','efiCreateSubscription','owenCheckStatus','format','../../models/Company','../SettingServices/GetSuperSettingService','payGatewayCreateSubscription','month','add','MENSAL','open','company-','checkOpenInvoices'];a485_0x13d4=function(){return _0x5c1987;};return a485_0x13d4();}exports[a485_0x11108b(0x1c0)]=processInvoiceExpired;const checkInvoicePayment=async _0x19f534=>{const _0x3cf103=a485_0x11108b;if(_0x19f534['payGw']===_0x3cf103(0x1a7))(0x0,EfiServices_1['efiCheckStatus'])(_0x19f534);else _0x19f534[_0x3cf103(0x1e2)]===_0x3cf103(0x1d5)&&(0x0,OwenServices_1[_0x3cf103(0x1ad)])(_0x19f534);};exports['checkInvoicePayment']=checkInvoicePayment;const checkOpenInvoices=async()=>{const _0x1edfb8=a485_0x11108b,_0x442d12=await Invoices_1['default'][_0x1edfb8(0x1cf)]({'where':{'status':_0x1edfb8(0x1b5),'txId':{[sequelize_1['Op']['or']]:[{[sequelize_1['Op'][_0x1edfb8(0x1d3)]]:''},{[sequelize_1['Op'][_0x1edfb8(0x1d3)]]:null}]}},'include':{'model':Company_1[_0x1edfb8(0x1a8)],'as':_0x1edfb8(0x1bb)}});_0x442d12[_0x1edfb8(0x1c2)](_0x576c1e=>{const _0x28c0a9=_0x1edfb8;(0x0,exports[_0x28c0a9(0x1dd)])(_0x576c1e);});};exports[a485_0x11108b(0x1b7)]=checkOpenInvoices;