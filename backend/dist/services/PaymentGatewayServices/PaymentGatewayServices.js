const a588_0x3ee92e=a588_0x3a50;(function(_0x32c124,_0x5ca1d6){const _0x1860a1=a588_0x3a50,_0x2c0e03=_0x32c124();while(!![]){try{const _0x2ab9d4=-parseInt(_0x1860a1(0xad))/0x1*(-parseInt(_0x1860a1(0xe6))/0x2)+-parseInt(_0x1860a1(0xe2))/0x3+parseInt(_0x1860a1(0xa7))/0x4*(-parseInt(_0x1860a1(0xa3))/0x5)+-parseInt(_0x1860a1(0xaf))/0x6+parseInt(_0x1860a1(0xca))/0x7*(parseInt(_0x1860a1(0xd8))/0x8)+-parseInt(_0x1860a1(0xbb))/0x9*(parseInt(_0x1860a1(0xbf))/0xa)+parseInt(_0x1860a1(0xbd))/0xb;if(_0x2ab9d4===_0x5ca1d6)break;else _0x2c0e03['push'](_0x2c0e03['shift']());}catch(_0x38edfa){_0x2c0e03['push'](_0x2c0e03['shift']());}}}(a588_0x2f4a,0x9db7d));const a588_0x39470a=(function(){let _0x34de99=!![];return function(_0xf780a0,_0x2d4018){const _0x5f687b=_0x34de99?function(){if(_0x2d4018){const _0x296006=_0x2d4018['apply'](_0xf780a0,arguments);return _0x2d4018=null,_0x296006;}}:function(){};return _0x34de99=![],_0x5f687b;};}()),a588_0x1d2369=a588_0x39470a(this,function(){const _0x37efc1=a588_0x3a50;return a588_0x1d2369[_0x37efc1(0xa9)]()['search']('(((.+)+)+)+$')[_0x37efc1(0xa9)]()[_0x37efc1(0xdd)](a588_0x1d2369)[_0x37efc1(0xab)]('(((.+)+)+)+$');});a588_0x1d2369();'use strict';var __importDefault=this&&this[a588_0x3ee92e(0xc5)]||function(_0x409287){const _0x4d061e=a588_0x3ee92e;return _0x409287&&_0x409287[_0x4d061e(0xc2)]?_0x409287:{'default':_0x409287};};Object[a588_0x3ee92e(0xa6)](exports,a588_0x3ee92e(0xc2),{'value':!![]}),exports[a588_0x3ee92e(0xd6)]=exports[a588_0x3ee92e(0xdf)]=exports[a588_0x3ee92e(0xb6)]=exports['processInvoicePaid']=exports[a588_0x3ee92e(0xd0)]=exports[a588_0x3ee92e(0xde)]=exports[a588_0x3ee92e(0xcf)]=void 0x0;const sequelize_1=require(a588_0x3ee92e(0xb1)),moment_1=__importDefault(require(a588_0x3ee92e(0xd4))),AppError_1=__importDefault(require(a588_0x3ee92e(0xcc))),GetSuperSettingService_1=__importDefault(require(a588_0x3ee92e(0xdc))),EfiServices_1=require(a588_0x3ee92e(0xe0)),OwenServices_1=require(a588_0x3ee92e(0xb4)),Invoices_1=__importDefault(require(a588_0x3ee92e(0xc4))),socket_1=require(a588_0x3ee92e(0xb2)),Company_1=__importDefault(require(a588_0x3ee92e(0xc7))),payGatewayInitialize=async()=>{const _0x5baea4=a588_0x3ee92e,_0x1d179f=await(0x0,GetSuperSettingService_1[_0x5baea4(0xac)])({'key':_0x5baea4(0xb5)});if(_0x1d179f===_0x5baea4(0xcd))return(0x0,EfiServices_1['efiInitialize'])();return null;};exports[a588_0x3ee92e(0xcf)]=payGatewayInitialize;const payGatewayCreateSubscription=async(_0x5155fd,_0x2e8011)=>{const _0x9adeff=a588_0x3ee92e,_0x11a567=await(0x0,GetSuperSettingService_1[_0x9adeff(0xac)])({'key':_0x9adeff(0xb5)});switch(_0x11a567){case _0x9adeff(0xcd):{return(0x0,EfiServices_1[_0x9adeff(0xd3)])(_0x5155fd,_0x2e8011);}case'owen':{return(0x0,OwenServices_1[_0x9adeff(0xc3)])(_0x5155fd,_0x2e8011);}default:{throw new AppError_1[(_0x9adeff(0xac))](_0x9adeff(0xba),0x190);}}};exports[a588_0x3ee92e(0xde)]=payGatewayCreateSubscription;const payGatewayReceiveWebhook=async(_0x59d337,_0x35b511)=>{const _0x414fad=a588_0x3ee92e,_0xf0b48=await(0x0,GetSuperSettingService_1[_0x414fad(0xac)])({'key':_0x414fad(0xb5)});switch(_0xf0b48){case _0x414fad(0xcd):{return(0x0,EfiServices_1[_0x414fad(0xc9)])(_0x59d337,_0x35b511);}case _0x414fad(0xc0):{return(0x0,OwenServices_1[_0x414fad(0xce)])(_0x59d337,_0x35b511);}default:{throw new AppError_1[(_0x414fad(0xac))](_0x414fad(0xba),0x190);}}};function a588_0x3a50(_0x911491,_0x4076a8){const _0x339ccb=a588_0x2f4a();return a588_0x3a50=function(_0x1d2369,_0x39470a){_0x1d2369=_0x1d2369-0xa3;let _0x2f4ad0=_0x339ccb[_0x1d2369];return _0x2f4ad0;},a588_0x3a50(_0x911491,_0x4076a8);}exports[a588_0x3ee92e(0xd0)]=payGatewayReceiveWebhook;const processInvoicePaid=async _0x893eca=>{const _0x1aa786=a588_0x3ee92e,_0x82d87e=_0x893eca['company']||await Company_1[_0x1aa786(0xac)]['findByPk'](_0x893eca['companyId']);if(_0x82d87e){const _0x5a75c8=(0x0,moment_1[_0x1aa786(0xac)])(_0x82d87e[_0x1aa786(0xc8)]);let {dueDate:_0x56452}=_0x82d87e;switch(_0x82d87e[_0x1aa786(0xbe)]){case _0x1aa786(0xc6):_0x56452=_0x5a75c8[_0x1aa786(0xb7)](0x2,_0x1aa786(0xd7))['format'](_0x1aa786(0xa4));break;case _0x1aa786(0xa5):_0x56452=_0x5a75c8['add'](0x3,_0x1aa786(0xd7))[_0x1aa786(0xaa)](_0x1aa786(0xa4));break;case _0x1aa786(0xe3):_0x56452=_0x5a75c8[_0x1aa786(0xb7)](0x6,_0x1aa786(0xd7))[_0x1aa786(0xaa)](_0x1aa786(0xa4));break;case _0x1aa786(0xb3):_0x56452=_0x5a75c8[_0x1aa786(0xb7)](0xc,_0x1aa786(0xd7))[_0x1aa786(0xaa)](_0x1aa786(0xa4));break;case _0x1aa786(0xe1):default:_0x56452=_0x5a75c8[_0x1aa786(0xb7)](0x1,_0x1aa786(0xd7))[_0x1aa786(0xaa)](_0x1aa786(0xa4));break;}await _0x82d87e[_0x1aa786(0xda)]({'dueDate':_0x56452}),await _0x893eca[_0x1aa786(0xda)]({'status':_0x1aa786(0xb8)}),await _0x82d87e[_0x1aa786(0xdb)]();const _0x4aedb7=(0x0,socket_1['getIO'])();_0x4aedb7['to'](_0x1aa786(0xe5)+_0x893eca[_0x1aa786(0xa8)]+_0x1aa786(0xb0))['to'](_0x1aa786(0xae))[_0x1aa786(0xb9)]('company-'+_0x893eca['companyId']+_0x1aa786(0xc1),{'action':'CONCLUIDA','company':_0x82d87e,'invoiceId':_0x893eca['id']});}};exports[a588_0x3ee92e(0xe4)]=processInvoicePaid;const processInvoiceExpired=async _0x2c0af0=>{const _0x599909=a588_0x3ee92e,_0x3efc7e=(0x0,socket_1['getIO'])();await _0x2c0af0[_0x599909(0xda)]({'txId':null,'payGw':null,'payGwData':null}),await _0x2c0af0[_0x599909(0xdb)](),_0x3efc7e['to']('company-'+_0x2c0af0[_0x599909(0xa8)]+_0x599909(0xb0))['to'](_0x599909(0xae))['emit'](_0x599909(0xe5)+_0x2c0af0[_0x599909(0xa8)]+_0x599909(0xc1),{'action':'EXPIRADA','company':_0x2c0af0[_0x599909(0xd9)]||await Invoices_1[_0x599909(0xac)][_0x599909(0xd5)](_0x2c0af0[_0x599909(0xa8)]),'invoiceId':_0x2c0af0['id']});};exports[a588_0x3ee92e(0xb6)]=processInvoiceExpired;const checkInvoicePayment=async _0x7dea6c=>{const _0x35f170=a588_0x3ee92e;if(_0x7dea6c[_0x35f170(0xd2)]===_0x35f170(0xcd))(0x0,EfiServices_1[_0x35f170(0xd1)])(_0x7dea6c);else _0x7dea6c[_0x35f170(0xd2)]===_0x35f170(0xc0)&&(0x0,OwenServices_1['owenCheckStatus'])(_0x7dea6c);};exports[a588_0x3ee92e(0xdf)]=checkInvoicePayment;function a588_0x2f4a(){const _0x2494a5=['format','search','default','432JMzQJY','super','926172TSmYRg','-mainchannel','sequelize','../../libs/socket','ANUAL','./OwenServices','_paymentGateway','processInvoiceExpired','add','paid','emit','Unsupported\x20payment\x20gateway','52011KfnqhK','open','5258495vsIyrX','recurrence','180tGkpDh','owen','-payment','__esModule','owenCreateSubscription','../../models/Invoices','__importDefault','BIMESTRAL','../../models/Company','dueDate','efiWebhook','10087UPkPxP','findAll','../../errors/AppError','efi','owenWebhook','payGatewayInitialize','payGatewayReceiveWebhook','efiCheckStatus','payGw','efiCreateSubscription','moment','findByPk','checkOpenInvoices','month','824ybCiFY','company','update','reload','../SettingServices/GetSuperSettingService','constructor','payGatewayCreateSubscription','checkInvoicePayment','./EfiServices','MENSAL','1528890jbLjHl','SEMESTRAL','processInvoicePaid','company-','4792DUAnPP','176795DcNyIh','YYYY-MM-DD','TRIMESTRAL','defineProperty','28QTplCs','companyId','toString'];a588_0x2f4a=function(){return _0x2494a5;};return a588_0x2f4a();}const checkOpenInvoices=async()=>{const _0x360c71=a588_0x3ee92e,_0x1a8bb2=await Invoices_1['default'][_0x360c71(0xcb)]({'where':{'status':_0x360c71(0xbc),'txId':{[sequelize_1['Op']['or']]:[{[sequelize_1['Op']['not']]:''},{[sequelize_1['Op']['not']]:null}]}},'include':{'model':Company_1[_0x360c71(0xac)],'as':_0x360c71(0xd9)}});_0x1a8bb2['forEach'](_0xe2d6b6=>{const _0xeab5d=_0x360c71;(0x0,exports[_0xeab5d(0xdf)])(_0xe2d6b6);});};exports[a588_0x3ee92e(0xd6)]=checkOpenInvoices;