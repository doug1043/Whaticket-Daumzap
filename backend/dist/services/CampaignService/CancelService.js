const a363_0x383ac2=a363_0xef40;(function(_0x49bd82,_0x1055c){const _0x29cd02=a363_0xef40,_0x295fc3=_0x49bd82();while(!![]){try{const _0x275d6b=parseInt(_0x29cd02(0x20d))/0x1+-parseInt(_0x29cd02(0x208))/0x2*(-parseInt(_0x29cd02(0x201))/0x3)+parseInt(_0x29cd02(0x22b))/0x4+parseInt(_0x29cd02(0x211))/0x5+-parseInt(_0x29cd02(0x1f7))/0x6*(-parseInt(_0x29cd02(0x222))/0x7)+-parseInt(_0x29cd02(0x203))/0x8*(-parseInt(_0x29cd02(0x200))/0x9)+parseInt(_0x29cd02(0x1f3))/0xa*(-parseInt(_0x29cd02(0x1fb))/0xb);if(_0x275d6b===_0x1055c)break;else _0x295fc3['push'](_0x295fc3['shift']());}catch(_0x51e146){_0x295fc3['push'](_0x295fc3['shift']());}}}(a363_0xc74e,0xc5fb6));const a363_0x1ce859=(function(){let _0x1fa54d=!![];return function(_0x2e9b99,_0x4fc105){const _0x315a5d=_0x1fa54d?function(){const _0x52752c=a363_0xef40;if(_0x4fc105){const _0x2fd55f=_0x4fc105[_0x52752c(0x216)](_0x2e9b99,arguments);return _0x4fc105=null,_0x2fd55f;}}:function(){};return _0x1fa54d=![],_0x315a5d;};}()),a363_0x4418b9=a363_0x1ce859(this,function(){const _0x55f7b6=a363_0xef40;return a363_0x4418b9['toString']()['search'](_0x55f7b6(0x215))['toString']()[_0x55f7b6(0x205)](a363_0x4418b9)['search'](_0x55f7b6(0x215));});a363_0x4418b9();'use strict';var __createBinding=this&&this[a363_0x383ac2(0x227)]||(Object[a363_0x383ac2(0x202)]?function(_0x5862ad,_0x1597ab,_0xc5ca1a,_0x100e03){const _0x5231b2=a363_0x383ac2;if(_0x100e03===undefined)_0x100e03=_0xc5ca1a;var _0x329141=Object['getOwnPropertyDescriptor'](_0x1597ab,_0xc5ca1a);(!_0x329141||(_0x5231b2(0x219)in _0x329141?!_0x1597ab[_0x5231b2(0x20b)]:_0x329141[_0x5231b2(0x214)]||_0x329141['configurable']))&&(_0x329141={'enumerable':!![],'get':function(){return _0x1597ab[_0xc5ca1a];}}),Object[_0x5231b2(0x21c)](_0x5862ad,_0x100e03,_0x329141);}:function(_0x441d7e,_0x387f28,_0x279f69,_0x474d8a){if(_0x474d8a===undefined)_0x474d8a=_0x279f69;_0x441d7e[_0x474d8a]=_0x387f28[_0x279f69];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a363_0x383ac2(0x202)]?function(_0x4a05ac,_0x2be921){const _0x214ef2=a363_0x383ac2;Object[_0x214ef2(0x21c)](_0x4a05ac,_0x214ef2(0x21d),{'enumerable':!![],'value':_0x2be921});}:function(_0x57ed14,_0x506e71){const _0x35e80f=a363_0x383ac2;_0x57ed14[_0x35e80f(0x21d)]=_0x506e71;}),__importStar=this&&this[a363_0x383ac2(0x206)]||function(_0x48e7d0){const _0x17ed89=a363_0x383ac2;if(_0x48e7d0&&_0x48e7d0['__esModule'])return _0x48e7d0;var _0x1f1f22={};if(_0x48e7d0!=null){for(var _0x4c8af8 in _0x48e7d0)if(_0x4c8af8!=='default'&&Object['prototype'][_0x17ed89(0x1f8)][_0x17ed89(0x218)](_0x48e7d0,_0x4c8af8))__createBinding(_0x1f1f22,_0x48e7d0,_0x4c8af8);}return __setModuleDefault(_0x1f1f22,_0x48e7d0),_0x1f1f22;},__importDefault=this&&this[a363_0x383ac2(0x224)]||function(_0x1ee119){const _0x492424=a363_0x383ac2;return _0x1ee119&&_0x1ee119[_0x492424(0x20b)]?_0x1ee119:{'default':_0x1ee119};};Object[a363_0x383ac2(0x21c)](exports,a363_0x383ac2(0x20b),{'value':!![]}),exports['CancelService']=void 0x0;const Campaign_1=__importDefault(require('../../models/Campaign')),CampaignShipping_1=__importDefault(require(a363_0x383ac2(0x21b))),queues_1=require('../../queues'),logger_1=require(a363_0x383ac2(0x1fa)),Sentry=__importStar(require(a363_0x383ac2(0x207))),socket_1=require(a363_0x383ac2(0x225)),campaingJob_1=__importDefault(require('../../workers/campaingJob')),campaignQueueManager=new campaingJob_1[(a363_0x383ac2(0x21d))]();async function CancelService(_0x1b43c3){const _0x5bb2fe=a363_0x383ac2;try{const _0x5bfb14=await Campaign_1[_0x5bb2fe(0x21d)][_0x5bb2fe(0x22c)](_0x1b43c3);if(!_0x5bfb14)throw new Error(_0x5bb2fe(0x22a));await _0x5bfb14[_0x5bb2fe(0x213)]({'status':'CANCELADA','completedAt':new Date()});const _0x43fc2a=await CampaignShipping_1[_0x5bb2fe(0x21d)][_0x5bb2fe(0x20f)]({'where':{'campaignId':_0x5bfb14['id'],'deliveredAt':null}}),_0x44b688=[queues_1[_0x5bb2fe(0x229)],campaignQueueManager['getCampaignQueue'](),campaignQueueManager['getProcessingQueue'](),campaignQueueManager[_0x5bb2fe(0x1ff)](),queues_1[_0x5bb2fe(0x1f2)]],_0xb2aacf=async _0x3e0401=>{const _0x3dd5ec=_0x5bb2fe;for(const _0x2ca9ad of _0x44b688){try{const _0x45c409=await _0x2ca9ad[_0x3dd5ec(0x217)](_0x3e0401);_0x45c409&&(await _0x45c409[_0x3dd5ec(0x210)](),logger_1['logger'][_0x3dd5ec(0x22e)](_0x3dd5ec(0x20e)+_0x3e0401+_0x3dd5ec(0x223)+_0x2ca9ad[_0x3dd5ec(0x21f)]));}catch(_0x1491a1){logger_1[_0x3dd5ec(0x1f6)][_0x3dd5ec(0x1fc)](_0x3dd5ec(0x21a)+_0x3e0401+_0x3dd5ec(0x204)+_0x2ca9ad[_0x3dd5ec(0x21f)]+':\x20'+_0x1491a1),Sentry['captureException'](_0x1491a1);}}},_0x2eef9a=_0x43fc2a[_0x5bb2fe(0x1fd)](async _0x1bfe90=>{const _0x4aa0e0=_0x5bb2fe;try{await _0xb2aacf(_0x1bfe90[_0x4aa0e0(0x20a)]),await _0x1bfe90[_0x4aa0e0(0x213)]({'deliveredAt':new Date(),'status':_0x4aa0e0(0x212)});}catch(_0x2e75a2){logger_1[_0x4aa0e0(0x1f6)]['error'](_0x4aa0e0(0x21e)+_0x1bfe90['jobId']+':\x20'+_0x2e75a2),Sentry['captureException'](_0x2e75a2);}});await Promise['allSettled'](_0x2eef9a);const _0x3021a7=(0x0,socket_1[_0x5bb2fe(0x20c)])();return _0x3021a7['to'](_0x5bb2fe(0x1fe)+_0x5bfb14[_0x5bb2fe(0x1f9)]+_0x5bb2fe(0x221))[_0x5bb2fe(0x226)]('company-'+_0x5bfb14['companyId']+_0x5bb2fe(0x220),{'action':_0x5bb2fe(0x213),'record':{..._0x5bfb14[_0x5bb2fe(0x22d)](),'status':_0x5bb2fe(0x209)}}),logger_1[_0x5bb2fe(0x1f6)]['info']('Campanha\x20'+_0x1b43c3+'\x20cancelada\x20com\x20sucesso'),_0x5bfb14;}catch(_0x56ce6c){logger_1[_0x5bb2fe(0x1f6)]['error'](_0x5bb2fe(0x1f5)+_0x1b43c3+':\x20'+_0x56ce6c),Sentry[_0x5bb2fe(0x228)](_0x56ce6c);throw _0x56ce6c;}}exports[a363_0x383ac2(0x1f4)]=CancelService;function a363_0xef40(_0x1ae02e,_0x35b86a){const _0x2a01f6=a363_0xc74e();return a363_0xef40=function(_0x4418b9,_0x1ce859){_0x4418b9=_0x4418b9-0x1f2;let _0xc74ea4=_0x2a01f6[_0x4418b9];return _0xc74ea4;},a363_0xef40(_0x1ae02e,_0x35b86a);}function a363_0xc74e(){const _0x2f3db8=['constructor','__importStar','@sentry/node','1096ZtQgoC','CANCELADA','jobId','__esModule','getIO','1133999dNSXRK','Job\x20','findAll','remove','2224220diRjZh','CANCELED','update','writable','(((.+)+)+)+$','apply','getJob','call','get','Erro\x20ao\x20remover\x20job\x20','../../models/CampaignShipping','defineProperty','default','Erro\x20ao\x20cancelar\x20job\x20','name','-campaign','-mainchannel','10925411RsTdFH','\x20removido\x20da\x20fila\x20','__importDefault','../../libs/socket','emit','__createBinding','captureException','campaignQueue','Campanha\x20n√£o\x20encontrada','2827384InzgaD','findByPk','toJSON','info','messageQueue','60YQCAop','CancelService','Erro\x20no\x20cancelamento\x20da\x20campanha\x20','logger','6kQdMzF','hasOwnProperty','companyId','../../utils/logger','9513471NpIYbg','error','map','company-','getDispatchQueue','2205OiaXrj','5403BwUiCO','create','38096kZNaDU','\x20da\x20fila\x20'];a363_0xc74e=function(){return _0x2f3db8;};return a363_0xc74e();}