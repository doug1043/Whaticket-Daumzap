'use strict';const a521_0x18b69e=a521_0x4a1b;function a521_0x4a1b(_0x957aa3,_0xce5ee6){const _0x3c1cd2=a521_0x3d99();return a521_0x4a1b=function(_0x10ef0f,_0x19df8c){_0x10ef0f=_0x10ef0f-0x19b;let _0x3d9929=_0x3c1cd2[_0x10ef0f];return _0x3d9929;},a521_0x4a1b(_0x957aa3,_0xce5ee6);}(function(_0x3c7caa,_0x4704cc){const _0x2b84bc=a521_0x4a1b,_0x5eab89=_0x3c7caa();while(!![]){try{const _0x297631=-parseInt(_0x2b84bc(0x1af))/0x1+-parseInt(_0x2b84bc(0x1c9))/0x2*(parseInt(_0x2b84bc(0x19f))/0x3)+parseInt(_0x2b84bc(0x1b2))/0x4*(-parseInt(_0x2b84bc(0x19c))/0x5)+parseInt(_0x2b84bc(0x1a6))/0x6*(-parseInt(_0x2b84bc(0x1ae))/0x7)+-parseInt(_0x2b84bc(0x1b1))/0x8+-parseInt(_0x2b84bc(0x1b0))/0x9*(-parseInt(_0x2b84bc(0x1a8))/0xa)+parseInt(_0x2b84bc(0x1cd))/0xb;if(_0x297631===_0x4704cc)break;else _0x5eab89['push'](_0x5eab89['shift']());}catch(_0x428235){_0x5eab89['push'](_0x5eab89['shift']());}}}(a521_0x3d99,0x20a74));var __createBinding=this&&this[a521_0x18b69e(0x1b9)]||(Object[a521_0x18b69e(0x1ca)]?function(_0x4c573d,_0x3bee3b,_0x5db169,_0x5ac58a){const _0x404c1c=a521_0x18b69e;if(_0x5ac58a===undefined)_0x5ac58a=_0x5db169;var _0x15374f=Object['getOwnPropertyDescriptor'](_0x3bee3b,_0x5db169);(!_0x15374f||(_0x404c1c(0x1c7)in _0x15374f?!_0x3bee3b[_0x404c1c(0x1be)]:_0x15374f['writable']||_0x15374f[_0x404c1c(0x1b7)]))&&(_0x15374f={'enumerable':!![],'get':function(){return _0x3bee3b[_0x5db169];}}),Object['defineProperty'](_0x4c573d,_0x5ac58a,_0x15374f);}:function(_0x8e3b68,_0x1ef403,_0x3f9dad,_0x2d82d0){if(_0x2d82d0===undefined)_0x2d82d0=_0x3f9dad;_0x8e3b68[_0x2d82d0]=_0x1ef403[_0x3f9dad];}),__setModuleDefault=this&&this[a521_0x18b69e(0x1b5)]||(Object[a521_0x18b69e(0x1ca)]?function(_0x64ac64,_0x1d6d4a){const _0x58c5ad=a521_0x18b69e;Object[_0x58c5ad(0x1a2)](_0x64ac64,'default',{'enumerable':!![],'value':_0x1d6d4a});}:function(_0x20ff71,_0x3b313a){const _0x1cefba=a521_0x18b69e;_0x20ff71[_0x1cefba(0x1a9)]=_0x3b313a;}),__importStar=this&&this['__importStar']||(function(){const _0x57ecd7=(function(){let _0x5cb5a5=!![];return function(_0x4c511e,_0x2496c4){const _0x10a5d4=_0x5cb5a5?function(){const _0x45d710=a521_0x4a1b;if(_0x2496c4){const _0xcf457c=_0x2496c4[_0x45d710(0x1ab)](_0x4c511e,arguments);return _0x2496c4=null,_0xcf457c;}}:function(){};return _0x5cb5a5=![],_0x10a5d4;};}()),_0x50daa0=_0x57ecd7(this,function(){const _0x5ada4e=a521_0x4a1b;return _0x50daa0['toString']()['search'](_0x5ada4e(0x1c4))['toString']()['constructor'](_0x50daa0)[_0x5ada4e(0x1a7)]('(((.+)+)+)+$');});_0x50daa0();var _0x2dbe15=function(_0x1d6541){return _0x2dbe15=Object['getOwnPropertyNames']||function(_0x10746e){const _0x1eaf73=a521_0x4a1b;var _0x222d16=[];for(var _0x37a3fe in _0x10746e)if(Object[_0x1eaf73(0x1a0)][_0x1eaf73(0x1ad)][_0x1eaf73(0x1b8)](_0x10746e,_0x37a3fe))_0x222d16[_0x222d16['length']]=_0x37a3fe;return _0x222d16;},_0x2dbe15(_0x1d6541);};return function(_0x1939ce){const _0x3b3db0=a521_0x4a1b;if(_0x1939ce&&_0x1939ce[_0x3b3db0(0x1be)])return _0x1939ce;var _0x147e24={};if(_0x1939ce!=null){for(var _0x5bc799=_0x2dbe15(_0x1939ce),_0x3e6a04=0x0;_0x3e6a04<_0x5bc799[_0x3b3db0(0x1bd)];_0x3e6a04++)if(_0x5bc799[_0x3e6a04]!=='default')__createBinding(_0x147e24,_0x1939ce,_0x5bc799[_0x3e6a04]);}return __setModuleDefault(_0x147e24,_0x1939ce),_0x147e24;};}()),__importDefault=this&&this[a521_0x18b69e(0x19e)]||function(_0x5c4e97){const _0x46cff3=a521_0x18b69e;return _0x5c4e97&&_0x5c4e97[_0x46cff3(0x1be)]?_0x5c4e97:{'default':_0x5c4e97};};Object[a521_0x18b69e(0x1a2)](exports,a521_0x18b69e(0x1be),{'value':!![]}),exports[a521_0x18b69e(0x1a9)]=DashboardDataService;function a521_0x3d99(){const _0x3e3837=['1338ueAlct','search','80mycQbF','default','disabled','apply','days','hasOwnProperty','6839jhYrtk','67203IAxArg','137682WqMvKo','1836224sUMZOH','4YNSlBb','\x20and\x20tt.\x22createdAt\x22\x20>=\x20(now()\x20-\x20\x27?\x20days\x27::interval)','push','__setModuleDefault','date_to','configurable','call','__createBinding','\x0a\x20\x20\x20\x20with\x0a\x20\x20\x20\x20traking\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.name\x20\x22companyName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name\x20\x22userName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20tu\x20where\x20tu.\x22userId\x22\x20=\x20tt.\x22userId\x22\x20and\x20tu.\x22active\x22\x20is\x20True)\x20\x22userOnline\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20w.name\x20\x22whatsappName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.name\x20\x22contactName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.number\x20\x22contactNumber\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22finishedAt\x22\x20is\x20not\x20null)\x20\x22finished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22userId\x22\x20is\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22pending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22startedAt\x22\x20is\x20not\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22open\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22)\x20,\x20tt.\x22startedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22supportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22waitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20t.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20tt.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.\x22id\x22\x20\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20from\x20\x22TicketTraking\x22\x20tt\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Companies\x22\x20c\x20on\x20c.id\x20=\x20tt.\x22companyId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20u.id\x20=\x20tt.\x22userId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20w.id\x20=\x20tt.\x22whatsappId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t\x20on\x20t.id\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct\x20on\x20ct.id\x20=\x20t.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20--\x20filterPeriod\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20counters\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22supportTime\x22)\x20from\x20traking\x20where\x20\x22supportTime\x22\x20>\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22waitTime\x22)\x20from\x20traking\x20where\x20\x22waitTime\x22\x20>\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27open\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportHappening\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27pending\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','replace','../../database','length','__esModule','CheckMsgIsGroup','\x20and\x20tt.\x22createdAt\x22\x20>=\x20?','\x20and\x20tt.\x22createdAt\x22\x20<=\x20?','\x2023:59:59','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportPending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20finished)\x20\x22supportFinished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(leads.id)\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ct1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(tt1.id)\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20tt1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t1\x20on\x20t1.id\x20=\x20tt1.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct1\x20on\x20ct1.id\x20=\x20t1.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20having\x20count(tt1.id)\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20leads\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22leads\x22\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20attedants\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgSupportTime\x22,\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgWaitTime\x22,\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.rating,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us\x20where\x20us.\x22userId\x22\x20=\x20u.id\x20and\x20us.\x22active\x22\x20is\x20True)\x20online,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22closeCount\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22openCount\x22\x0a\x09from\x20\x22Users\x22\x20u\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.\x22name\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us1\x20where\x20us1.\x22userId\x22\x20=\x20u1.id\x20and\x20us1.\x22active\x22\x20is\x20True)\x20\x22online\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22supportTime\x22)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22waitTime\x22)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(t.\x22id\x22)\x20tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20coalesce(avg(ur.rate),\x200)\x20rating,\x0a\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22finishedAt\x22\x20is\x20not\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22closeCount\x22\x20\x20\x20,\x20\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22startedAt\x22\x20is\x20not\x20null\x20and\x20\x22finishedAt\x22\x20is\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22openCount\x22\x0a\x09\x09\x20\x20from\x20\x22Users\x22\x20u1\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20traking\x20t\x20on\x20t.\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22userId\x22\x20=\x20t.\x22userId\x22\x20and\x20ur.\x22createdAt\x22::date\x20=\x20t.\x22finishedAt\x22::date\x0a\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201,\x202\x0a\x20\x20\x20\x20\x20\x20)\x20att\x20on\x20att.id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20where\x20u.\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20att.name\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(jsonb_build_object(\x27counters\x27,\x20c.*)->>\x27counters\x27,\x20\x27{}\x27)::jsonb\x20from\x20counters\x20c)\x20counters,\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(json_agg(a.*),\x20\x27[]\x27)::jsonb\x20from\x20attedants\x20a)\x20attendants;\x0a\x20\x20','(((.+)+)+)+$','GetCompanySetting','groupsTab','get','sequelize','18dwpsHR','create','SELECT','enabled','8110124oWpRwK','date_from','334205JdZBWU','\x2000:00:00','__importDefault','48159cRGPAq','prototype','--\x20filterPeriod','defineProperty','QueryTypes','query','has'];a521_0x3d99=function(){return _0x3e3837;};return a521_0x3d99();}const sequelize_1=require(a521_0x18b69e(0x1c8)),_=__importStar(require('lodash')),database_1=__importDefault(require(a521_0x18b69e(0x1bc))),CheckSettings_1=require('../../helpers/CheckSettings');async function DashboardDataService(_0x8a418c,_0x281843){const _0x58d05f=a521_0x18b69e,_0x1f4d20=await(0x0,CheckSettings_1[_0x58d05f(0x1c5)])(Number(_0x8a418c),_0x58d05f(0x1c6),_0x58d05f(0x1aa))===_0x58d05f(0x1cc),_0x3008d8=await(0x0,CheckSettings_1[_0x58d05f(0x1c5)])(Number(_0x8a418c),_0x58d05f(0x1bf),_0x58d05f(0x1cc))==='enabled',_0x17b35a=_0x3008d8||_0x1f4d20?'AND\x20NOT\x20\x22isGroup\x22':'',_0x1cf465=_0x58d05f(0x1ba)+_0x17b35a+_0x58d05f(0x1c3);let _0x367413='where\x20tt.\x22companyId\x22\x20=\x20?';const _0x106659=[_0x8a418c];_[_0x58d05f(0x1a5)](_0x281843,_0x58d05f(0x1ac))&&(_0x367413+=_0x58d05f(0x1b3),_0x106659[_0x58d05f(0x1b4)](parseInt((''+_0x281843[_0x58d05f(0x1ac)])[_0x58d05f(0x1bb)](/\D/g,''),0xa)));_[_0x58d05f(0x1a5)](_0x281843,'date_from')&&(_0x367413+=_0x58d05f(0x1c0),_0x106659['push'](_0x281843[_0x58d05f(0x19b)]+_0x58d05f(0x19d)));_[_0x58d05f(0x1a5)](_0x281843,_0x58d05f(0x1b6))&&(_0x367413+=_0x58d05f(0x1c1),_0x106659[_0x58d05f(0x1b4)](_0x281843[_0x58d05f(0x1b6)]+_0x58d05f(0x1c2)));_0x106659[_0x58d05f(0x1b4)](_0x8a418c),_0x106659[_0x58d05f(0x1b4)](_0x8a418c),_0x106659[_0x58d05f(0x1b4)](_0x8a418c),_0x106659['push'](_0x8a418c),_0x106659['push'](_0x8a418c);const _0xb26ff3=_0x1cf465['replace'](_0x58d05f(0x1a1),_0x367413),_0xcc837=await database_1[_0x58d05f(0x1a9)][_0x58d05f(0x1a4)](_0xb26ff3,{'replacements':_0x106659,'type':sequelize_1[_0x58d05f(0x1a3)][_0x58d05f(0x1cb)],'plain':!![]});return _0xcc837;}