'use strict';function a515_0xb62d(_0x87c897,_0x5de717){const _0xc4934f=a515_0x244f();return a515_0xb62d=function(_0x1cd4b1,_0xd47e64){_0x1cd4b1=_0x1cd4b1-0x105;let _0x244fc9=_0xc4934f[_0x1cd4b1];return _0x244fc9;},a515_0xb62d(_0x87c897,_0x5de717);}const a515_0x5e393b=a515_0xb62d;(function(_0x59d48b,_0x23ba7){const _0x4b1d62=a515_0xb62d,_0x20601b=_0x59d48b();while(!![]){try{const _0x221af5=parseInt(_0x4b1d62(0x10b))/0x1+-parseInt(_0x4b1d62(0x11a))/0x2+parseInt(_0x4b1d62(0x108))/0x3*(-parseInt(_0x4b1d62(0x118))/0x4)+parseInt(_0x4b1d62(0x125))/0x5+-parseInt(_0x4b1d62(0x129))/0x6+-parseInt(_0x4b1d62(0x10a))/0x7+parseInt(_0x4b1d62(0x119))/0x8;if(_0x221af5===_0x23ba7)break;else _0x20601b['push'](_0x20601b['shift']());}catch(_0x2ecc29){_0x20601b['push'](_0x20601b['shift']());}}}(a515_0x244f,0xd4578));var __createBinding=this&&this[a515_0x5e393b(0x124)]||(Object[a515_0x5e393b(0x120)]?function(_0x3e696f,_0x2a25aa,_0x2c1587,_0x55ba67){const _0x4ef583=a515_0x5e393b;if(_0x55ba67===undefined)_0x55ba67=_0x2c1587;var _0x2e0907=Object['getOwnPropertyDescriptor'](_0x2a25aa,_0x2c1587);(!_0x2e0907||(_0x4ef583(0x10e)in _0x2e0907?!_0x2a25aa['__esModule']:_0x2e0907['writable']||_0x2e0907['configurable']))&&(_0x2e0907={'enumerable':!![],'get':function(){return _0x2a25aa[_0x2c1587];}}),Object[_0x4ef583(0x11f)](_0x3e696f,_0x55ba67,_0x2e0907);}:function(_0x74ef5a,_0x3f27fe,_0x4cd946,_0x58daf0){if(_0x58daf0===undefined)_0x58daf0=_0x4cd946;_0x74ef5a[_0x58daf0]=_0x3f27fe[_0x4cd946];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a515_0x5e393b(0x120)]?function(_0x119fc3,_0x18e3be){const _0x50e039=a515_0x5e393b;Object[_0x50e039(0x11f)](_0x119fc3,_0x50e039(0x105),{'enumerable':!![],'value':_0x18e3be});}:function(_0x4ae602,_0x5412fa){_0x4ae602['default']=_0x5412fa;}),__importStar=this&&this['__importStar']||(function(){const _0x3a9fab=(function(){let _0x49ea1b=!![];return function(_0x150393,_0x1c13fb){const _0x4f90de=_0x49ea1b?function(){const _0x328d34=a515_0xb62d;if(_0x1c13fb){const _0x2ff164=_0x1c13fb[_0x328d34(0x11e)](_0x150393,arguments);return _0x1c13fb=null,_0x2ff164;}}:function(){};return _0x49ea1b=![],_0x4f90de;};}()),_0x5f30f8=_0x3a9fab(this,function(){const _0x3e960d=a515_0xb62d;return _0x5f30f8['toString']()[_0x3e960d(0x122)](_0x3e960d(0x121))[_0x3e960d(0x126)]()[_0x3e960d(0x115)](_0x5f30f8)[_0x3e960d(0x122)](_0x3e960d(0x121));});_0x5f30f8();var _0x48f874=function(_0x566c31){return _0x48f874=Object['getOwnPropertyNames']||function(_0x3e074a){const _0x5ae3ca=a515_0xb62d;var _0x1c3b7c=[];for(var _0xbdb4ba in _0x3e074a)if(Object[_0x5ae3ca(0x12b)]['hasOwnProperty'][_0x5ae3ca(0x12e)](_0x3e074a,_0xbdb4ba))_0x1c3b7c[_0x1c3b7c[_0x5ae3ca(0x123)]]=_0xbdb4ba;return _0x1c3b7c;},_0x48f874(_0x566c31);};return function(_0x2a2f8e){const _0x4eacc2=a515_0xb62d;if(_0x2a2f8e&&_0x2a2f8e[_0x4eacc2(0x110)])return _0x2a2f8e;var _0x4d279f={};if(_0x2a2f8e!=null){for(var _0x46671d=_0x48f874(_0x2a2f8e),_0x5700b0=0x0;_0x5700b0<_0x46671d[_0x4eacc2(0x123)];_0x5700b0++)if(_0x46671d[_0x5700b0]!=='default')__createBinding(_0x4d279f,_0x2a2f8e,_0x46671d[_0x5700b0]);}return __setModuleDefault(_0x4d279f,_0x2a2f8e),_0x4d279f;};}()),__importDefault=this&&this[a515_0x5e393b(0x12d)]||function(_0x3c1004){const _0x404dd4=a515_0x5e393b;return _0x3c1004&&_0x3c1004[_0x404dd4(0x110)]?_0x3c1004:{'default':_0x3c1004};};Object[a515_0x5e393b(0x11f)](exports,a515_0x5e393b(0x110),{'value':!![]}),exports[a515_0x5e393b(0x105)]=DashboardDataService;const sequelize_1=require(a515_0x5e393b(0x109)),_=__importStar(require(a515_0x5e393b(0x113))),database_1=__importDefault(require(a515_0x5e393b(0x128))),CheckSettings_1=require(a515_0x5e393b(0x12c));async function DashboardDataService(_0x9c5a8a,_0x1edccc){const _0x55abc5=a515_0x5e393b,_0x16a524=await(0x0,CheckSettings_1['GetCompanySetting'])(Number(_0x9c5a8a),'groupsTab',_0x55abc5(0x130))===_0x55abc5(0x106),_0x4a1882=await(0x0,CheckSettings_1[_0x55abc5(0x12f)])(Number(_0x9c5a8a),_0x55abc5(0x10d),'enabled')==='enabled',_0x145ce0=_0x4a1882||_0x16a524?_0x55abc5(0x112):'',_0x2f45eb='\x0a\x20\x20\x20\x20with\x0a\x20\x20\x20\x20traking\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.name\x20\x22companyName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name\x20\x22userName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20tu\x20where\x20tu.\x22userId\x22\x20=\x20tt.\x22userId\x22\x20and\x20tu.\x22active\x22\x20is\x20True)\x20\x22userOnline\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20w.name\x20\x22whatsappName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.name\x20\x22contactName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.number\x20\x22contactNumber\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22finishedAt\x22\x20is\x20not\x20null)\x20\x22finished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22userId\x22\x20is\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22pending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22startedAt\x22\x20is\x20not\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22open\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22)\x20,\x20tt.\x22startedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22supportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22waitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20t.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20tt.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.\x22id\x22\x20\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20from\x20\x22TicketTraking\x22\x20tt\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Companies\x22\x20c\x20on\x20c.id\x20=\x20tt.\x22companyId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20u.id\x20=\x20tt.\x22userId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20w.id\x20=\x20tt.\x22whatsappId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t\x20on\x20t.id\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct\x20on\x20ct.id\x20=\x20t.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20--\x20filterPeriod\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20counters\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22supportTime\x22)\x20from\x20traking\x20where\x20\x22supportTime\x22\x20>\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22waitTime\x22)\x20from\x20traking\x20where\x20\x22waitTime\x22\x20>\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27open\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportHappening\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27pending\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x145ce0+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportPending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20finished)\x20\x22supportFinished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(leads.id)\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ct1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(tt1.id)\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20tt1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t1\x20on\x20t1.id\x20=\x20tt1.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct1\x20on\x20ct1.id\x20=\x20t1.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20having\x20count(tt1.id)\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20leads\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22leads\x22\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20attedants\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgSupportTime\x22,\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgWaitTime\x22,\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.rating,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us\x20where\x20us.\x22userId\x22\x20=\x20u.id\x20and\x20us.\x22active\x22\x20is\x20True)\x20online,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22closeCount\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22openCount\x22\x0a\x09from\x20\x22Users\x22\x20u\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.\x22name\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us1\x20where\x20us1.\x22userId\x22\x20=\x20u1.id\x20and\x20us1.\x22active\x22\x20is\x20True)\x20\x22online\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22supportTime\x22)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22waitTime\x22)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(t.\x22id\x22)\x20tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20coalesce(avg(ur.rate),\x200)\x20rating,\x0a\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22finishedAt\x22\x20is\x20not\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22closeCount\x22\x20\x20\x20,\x20\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22startedAt\x22\x20is\x20not\x20null\x20and\x20\x22finishedAt\x22\x20is\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22openCount\x22\x0a\x09\x09\x20\x20from\x20\x22Users\x22\x20u1\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20traking\x20t\x20on\x20t.\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22userId\x22\x20=\x20t.\x22userId\x22\x20and\x20ur.\x22createdAt\x22::date\x20=\x20t.\x22finishedAt\x22::date\x0a\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201,\x202\x0a\x20\x20\x20\x20\x20\x20)\x20att\x20on\x20att.id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20where\x20u.\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20att.name\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(jsonb_build_object(\x27counters\x27,\x20c.*)->>\x27counters\x27,\x20\x27{}\x27)::jsonb\x20from\x20counters\x20c)\x20counters,\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(json_agg(a.*),\x20\x27[]\x27)::jsonb\x20from\x20attedants\x20a)\x20attendants;\x0a\x20\x20';let _0x33caa0=_0x55abc5(0x11b);const _0x583248=[_0x9c5a8a];_[_0x55abc5(0x127)](_0x1edccc,_0x55abc5(0x107))&&(_0x33caa0+=_0x55abc5(0x11c),_0x583248['push'](parseInt((''+_0x1edccc[_0x55abc5(0x107)])['replace'](/\D/g,''),0xa)));_['has'](_0x1edccc,_0x55abc5(0x116))&&(_0x33caa0+=_0x55abc5(0x12a),_0x583248['push'](_0x1edccc[_0x55abc5(0x116)]+'\x2000:00:00'));_[_0x55abc5(0x127)](_0x1edccc,_0x55abc5(0x117))&&(_0x33caa0+=_0x55abc5(0x111),_0x583248[_0x55abc5(0x10c)](_0x1edccc[_0x55abc5(0x117)]+_0x55abc5(0x114)));_0x583248[_0x55abc5(0x10c)](_0x9c5a8a),_0x583248[_0x55abc5(0x10c)](_0x9c5a8a),_0x583248['push'](_0x9c5a8a),_0x583248[_0x55abc5(0x10c)](_0x9c5a8a),_0x583248['push'](_0x9c5a8a);const _0x3db3c3=_0x2f45eb[_0x55abc5(0x11d)](_0x55abc5(0x132),_0x33caa0),_0x2dc576=await database_1[_0x55abc5(0x105)][_0x55abc5(0x131)](_0x3db3c3,{'replacements':_0x583248,'type':sequelize_1['QueryTypes'][_0x55abc5(0x10f)],'plain':!![]});return _0x2dc576;}function a515_0x244f(){const _0x5207b6=['585610CEdWCn','where\x20tt.\x22companyId\x22\x20=\x20?','\x20and\x20tt.\x22createdAt\x22\x20>=\x20(now()\x20-\x20\x27?\x20days\x27::interval)','replace','apply','defineProperty','create','(((.+)+)+)+$','search','length','__createBinding','3064195HJIyRs','toString','has','../../database','7976958rsWxKJ','\x20and\x20tt.\x22createdAt\x22\x20>=\x20?','prototype','../../helpers/CheckSettings','__importDefault','call','GetCompanySetting','disabled','query','--\x20filterPeriod','default','enabled','days','453cJKcDj','sequelize','5368888rntLqY','633617ujJubD','push','CheckMsgIsGroup','get','SELECT','__esModule','\x20and\x20tt.\x22createdAt\x22\x20<=\x20?','AND\x20NOT\x20\x22isGroup\x22','lodash','\x2023:59:59','constructor','date_from','date_to','45856wLpuNv','29949136BoEFLm'];a515_0x244f=function(){return _0x5207b6;};return a515_0x244f();}