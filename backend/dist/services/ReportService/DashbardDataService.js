'use strict';function a516_0x3d6f(){const _0x3f633d=['__createBinding','configurable','__importDefault','__esModule','(((.+)+)+)+$','groupsTab','1069128mRUjXF','date_to','days','length','CheckMsgIsGroup','apply','\x20and\x20tt.\x22createdAt\x22\x20>=\x20(now()\x20-\x20\x27?\x20days\x27::interval)','push','search','7517900tzEBUZ','GetCompanySetting','1nLPAkX','query','985935ZkFiBb','734144HURPNl','has','635740zBFiDs','prototype','2312358BKKxNN','toString','default','date_from','\x20and\x20tt.\x22createdAt\x22\x20>=\x20?','98lzGUiJ','\x0a\x20\x20\x20\x20with\x0a\x20\x20\x20\x20traking\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.name\x20\x22companyName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name\x20\x22userName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20tu\x20where\x20tu.\x22userId\x22\x20=\x20tt.\x22userId\x22\x20and\x20tu.\x22active\x22\x20is\x20True)\x20\x22userOnline\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20w.name\x20\x22whatsappName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.name\x20\x22contactName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.number\x20\x22contactNumber\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22finishedAt\x22\x20is\x20not\x20null)\x20\x22finished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22userId\x22\x20is\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22pending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22startedAt\x22\x20is\x20not\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22open\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22)\x20,\x20tt.\x22startedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22supportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22waitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20t.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20tt.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.\x22id\x22\x20\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20from\x20\x22TicketTraking\x22\x20tt\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Companies\x22\x20c\x20on\x20c.id\x20=\x20tt.\x22companyId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20u.id\x20=\x20tt.\x22userId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20w.id\x20=\x20tt.\x22whatsappId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t\x20on\x20t.id\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct\x20on\x20ct.id\x20=\x20t.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20--\x20filterPeriod\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20counters\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22supportTime\x22)\x20from\x20traking\x20where\x20\x22supportTime\x22\x20>\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22waitTime\x22)\x20from\x20traking\x20where\x20\x22waitTime\x22\x20>\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27open\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportHappening\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27pending\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','enabled','replace','287436YVhWeZ','getOwnPropertyDescriptor','../../helpers/CheckSettings','lodash','../../database','where\x20tt.\x22companyId\x22\x20=\x20?','__setModuleDefault','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportPending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20finished)\x20\x22supportFinished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(leads.id)\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ct1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(tt1.id)\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20tt1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t1\x20on\x20t1.id\x20=\x20tt1.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct1\x20on\x20ct1.id\x20=\x20t1.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20having\x20count(tt1.id)\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20leads\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22leads\x22\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20attedants\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgSupportTime\x22,\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgWaitTime\x22,\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.rating,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us\x20where\x20us.\x22userId\x22\x20=\x20u.id\x20and\x20us.\x22active\x22\x20is\x20True)\x20online,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22closeCount\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22openCount\x22\x0a\x09from\x20\x22Users\x22\x20u\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.\x22name\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us1\x20where\x20us1.\x22userId\x22\x20=\x20u1.id\x20and\x20us1.\x22active\x22\x20is\x20True)\x20\x22online\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22supportTime\x22)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22waitTime\x22)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(t.\x22id\x22)\x20tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20coalesce(avg(ur.rate),\x200)\x20rating,\x0a\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22finishedAt\x22\x20is\x20not\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22closeCount\x22\x20\x20\x20,\x20\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22startedAt\x22\x20is\x20not\x20null\x20and\x20\x22finishedAt\x22\x20is\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22openCount\x22\x0a\x09\x09\x20\x20from\x20\x22Users\x22\x20u1\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20traking\x20t\x20on\x20t.\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22userId\x22\x20=\x20t.\x22userId\x22\x20and\x20ur.\x22createdAt\x22::date\x20=\x20t.\x22finishedAt\x22::date\x0a\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201,\x202\x0a\x20\x20\x20\x20\x20\x20)\x20att\x20on\x20att.id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20where\x20u.\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20att.name\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(jsonb_build_object(\x27counters\x27,\x20c.*)->>\x27counters\x27,\x20\x27{}\x27)::jsonb\x20from\x20counters\x20c)\x20counters,\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(json_agg(a.*),\x20\x27[]\x27)::jsonb\x20from\x20attedants\x20a)\x20attendants;\x0a\x20\x20','create','9taEaWf','defineProperty','AND\x20NOT\x20\x22isGroup\x22'];a516_0x3d6f=function(){return _0x3f633d;};return a516_0x3d6f();}const a516_0x4334f0=a516_0x3580;(function(_0x4c659a,_0x408ee0){const _0x59d121=a516_0x3580,_0x54e842=_0x4c659a();while(!![]){try{const _0x8dec93=-parseInt(_0x59d121(0x18d))/0x1*(-parseInt(_0x59d121(0x192))/0x2)+-parseInt(_0x59d121(0x194))/0x3+-parseInt(_0x59d121(0x182))/0x4+-parseInt(_0x59d121(0x18f))/0x5+-parseInt(_0x59d121(0x19d))/0x6*(-parseInt(_0x59d121(0x199))/0x7)+parseInt(_0x59d121(0x190))/0x8*(-parseInt(_0x59d121(0x1a6))/0x9)+parseInt(_0x59d121(0x18b))/0xa;if(_0x8dec93===_0x408ee0)break;else _0x54e842['push'](_0x54e842['shift']());}catch(_0x47cc25){_0x54e842['push'](_0x54e842['shift']());}}}(a516_0x3d6f,0x64e89));function a516_0x3580(_0x16e396,_0x50cedf){const _0x12d494=a516_0x3d6f();return a516_0x3580=function(_0xe813e4,_0x6af41b){_0xe813e4=_0xe813e4-0x17c;let _0x3d6fff=_0x12d494[_0xe813e4];return _0x3d6fff;},a516_0x3580(_0x16e396,_0x50cedf);}var __createBinding=this&&this[a516_0x4334f0(0x17c)]||(Object[a516_0x4334f0(0x1a5)]?function(_0x3e2607,_0x26e978,_0x57d12e,_0x38a886){const _0x42c8a5=a516_0x4334f0;if(_0x38a886===undefined)_0x38a886=_0x57d12e;var _0x2a8363=Object[_0x42c8a5(0x19e)](_0x26e978,_0x57d12e);(!_0x2a8363||('get'in _0x2a8363?!_0x26e978[_0x42c8a5(0x17f)]:_0x2a8363['writable']||_0x2a8363[_0x42c8a5(0x17d)]))&&(_0x2a8363={'enumerable':!![],'get':function(){return _0x26e978[_0x57d12e];}}),Object[_0x42c8a5(0x1a7)](_0x3e2607,_0x38a886,_0x2a8363);}:function(_0x274800,_0x2be0d0,_0x59db43,_0x32f9bc){if(_0x32f9bc===undefined)_0x32f9bc=_0x59db43;_0x274800[_0x32f9bc]=_0x2be0d0[_0x59db43];}),__setModuleDefault=this&&this[a516_0x4334f0(0x1a3)]||(Object[a516_0x4334f0(0x1a5)]?function(_0x2cebb9,_0x4d7f37){const _0x1d4880=a516_0x4334f0;Object['defineProperty'](_0x2cebb9,_0x1d4880(0x196),{'enumerable':!![],'value':_0x4d7f37});}:function(_0x383e66,_0x363de2){_0x383e66['default']=_0x363de2;}),__importStar=this&&this['__importStar']||(function(){const _0x45e1fa=(function(){let _0x52116c=!![];return function(_0x2104ec,_0x136757){const _0xc73f57=_0x52116c?function(){const _0x196361=a516_0x3580;if(_0x136757){const _0x422b97=_0x136757[_0x196361(0x187)](_0x2104ec,arguments);return _0x136757=null,_0x422b97;}}:function(){};return _0x52116c=![],_0xc73f57;};}()),_0x244440=_0x45e1fa(this,function(){const _0x5c34d2=a516_0x3580;return _0x244440[_0x5c34d2(0x195)]()[_0x5c34d2(0x18a)](_0x5c34d2(0x180))[_0x5c34d2(0x195)]()['constructor'](_0x244440)[_0x5c34d2(0x18a)](_0x5c34d2(0x180));});_0x244440();var _0x5bbbe6=function(_0x618d10){return _0x5bbbe6=Object['getOwnPropertyNames']||function(_0x579fbb){const _0x7100f8=a516_0x3580;var _0xa9f27b=[];for(var _0x41ad43 in _0x579fbb)if(Object[_0x7100f8(0x193)]['hasOwnProperty']['call'](_0x579fbb,_0x41ad43))_0xa9f27b[_0xa9f27b[_0x7100f8(0x185)]]=_0x41ad43;return _0xa9f27b;},_0x5bbbe6(_0x618d10);};return function(_0x396bbe){if(_0x396bbe&&_0x396bbe['__esModule'])return _0x396bbe;var _0x5ce362={};if(_0x396bbe!=null){for(var _0x31ec3d=_0x5bbbe6(_0x396bbe),_0x806a71=0x0;_0x806a71<_0x31ec3d['length'];_0x806a71++)if(_0x31ec3d[_0x806a71]!=='default')__createBinding(_0x5ce362,_0x396bbe,_0x31ec3d[_0x806a71]);}return __setModuleDefault(_0x5ce362,_0x396bbe),_0x5ce362;};}()),__importDefault=this&&this[a516_0x4334f0(0x17e)]||function(_0x24e081){const _0x3171e7=a516_0x4334f0;return _0x24e081&&_0x24e081[_0x3171e7(0x17f)]?_0x24e081:{'default':_0x24e081};};Object[a516_0x4334f0(0x1a7)](exports,'__esModule',{'value':!![]}),exports[a516_0x4334f0(0x196)]=DashboardDataService;const sequelize_1=require('sequelize'),_=__importStar(require(a516_0x4334f0(0x1a0))),database_1=__importDefault(require(a516_0x4334f0(0x1a1))),CheckSettings_1=require(a516_0x4334f0(0x19f));async function DashboardDataService(_0x2c4b69,_0x2c97fe){const _0x46576f=a516_0x4334f0,_0x2357d5=await(0x0,CheckSettings_1[_0x46576f(0x18c)])(Number(_0x2c4b69),_0x46576f(0x181),'disabled')===_0x46576f(0x19b),_0x5bc31f=await(0x0,CheckSettings_1[_0x46576f(0x18c)])(Number(_0x2c4b69),_0x46576f(0x186),'enabled')===_0x46576f(0x19b),_0x4422a2=_0x5bc31f||_0x2357d5?_0x46576f(0x1a8):'',_0x4a42d1=_0x46576f(0x19a)+_0x4422a2+_0x46576f(0x1a4);let _0x3491bc=_0x46576f(0x1a2);const _0x25f980=[_0x2c4b69];_[_0x46576f(0x191)](_0x2c97fe,'days')&&(_0x3491bc+=_0x46576f(0x188),_0x25f980[_0x46576f(0x189)](parseInt((''+_0x2c97fe[_0x46576f(0x184)])[_0x46576f(0x19c)](/\D/g,''),0xa)));_[_0x46576f(0x191)](_0x2c97fe,_0x46576f(0x197))&&(_0x3491bc+=_0x46576f(0x198),_0x25f980['push'](_0x2c97fe[_0x46576f(0x197)]+'\x2000:00:00'));_[_0x46576f(0x191)](_0x2c97fe,_0x46576f(0x183))&&(_0x3491bc+='\x20and\x20tt.\x22createdAt\x22\x20<=\x20?',_0x25f980[_0x46576f(0x189)](_0x2c97fe[_0x46576f(0x183)]+'\x2023:59:59'));_0x25f980[_0x46576f(0x189)](_0x2c4b69),_0x25f980[_0x46576f(0x189)](_0x2c4b69),_0x25f980[_0x46576f(0x189)](_0x2c4b69),_0x25f980[_0x46576f(0x189)](_0x2c4b69),_0x25f980[_0x46576f(0x189)](_0x2c4b69);const _0x5e3c71=_0x4a42d1[_0x46576f(0x19c)]('--\x20filterPeriod',_0x3491bc),_0x57a2d7=await database_1[_0x46576f(0x196)][_0x46576f(0x18e)](_0x5e3c71,{'replacements':_0x25f980,'type':sequelize_1['QueryTypes']['SELECT'],'plain':!![]});return _0x57a2d7;}