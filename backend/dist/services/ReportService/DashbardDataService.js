'use strict';const a517_0x251d20=a517_0x15d4;(function(_0x575248,_0x424d0a){const _0x4a1b69=a517_0x15d4,_0x4c8321=_0x575248();while(!![]){try{const _0x142c7a=parseInt(_0x4a1b69(0x211))/0x1*(-parseInt(_0x4a1b69(0x1ef))/0x2)+-parseInt(_0x4a1b69(0x1f7))/0x3*(parseInt(_0x4a1b69(0x204))/0x4)+-parseInt(_0x4a1b69(0x207))/0x5*(-parseInt(_0x4a1b69(0x216))/0x6)+parseInt(_0x4a1b69(0x1f4))/0x7*(parseInt(_0x4a1b69(0x1ec))/0x8)+-parseInt(_0x4a1b69(0x200))/0x9*(-parseInt(_0x4a1b69(0x217))/0xa)+-parseInt(_0x4a1b69(0x1f6))/0xb*(-parseInt(_0x4a1b69(0x209))/0xc)+parseInt(_0x4a1b69(0x214))/0xd*(-parseInt(_0x4a1b69(0x1f3))/0xe);if(_0x142c7a===_0x424d0a)break;else _0x4c8321['push'](_0x4c8321['shift']());}catch(_0x5131b8){_0x4c8321['push'](_0x4c8321['shift']());}}}(a517_0x5915,0x34829));var __createBinding=this&&this[a517_0x251d20(0x202)]||(Object[a517_0x251d20(0x1e4)]?function(_0x5c258c,_0x5c7aff,_0x50e902,_0x4e9722){const _0x38f60c=a517_0x251d20;if(_0x4e9722===undefined)_0x4e9722=_0x50e902;var _0x33bf97=Object['getOwnPropertyDescriptor'](_0x5c7aff,_0x50e902);(!_0x33bf97||(_0x38f60c(0x1f5)in _0x33bf97?!_0x5c7aff[_0x38f60c(0x1e6)]:_0x33bf97[_0x38f60c(0x20f)]||_0x33bf97[_0x38f60c(0x1fb)]))&&(_0x33bf97={'enumerable':!![],'get':function(){return _0x5c7aff[_0x50e902];}}),Object[_0x38f60c(0x1ea)](_0x5c258c,_0x4e9722,_0x33bf97);}:function(_0x28479a,_0x4cf1b8,_0x439f5c,_0x4a5a8d){if(_0x4a5a8d===undefined)_0x4a5a8d=_0x439f5c;_0x28479a[_0x4a5a8d]=_0x4cf1b8[_0x439f5c];}),__setModuleDefault=this&&this[a517_0x251d20(0x20e)]||(Object[a517_0x251d20(0x1e4)]?function(_0x4b2f16,_0x5cf2b4){Object['defineProperty'](_0x4b2f16,'default',{'enumerable':!![],'value':_0x5cf2b4});}:function(_0xe91580,_0x1ecfdb){const _0x32d566=a517_0x251d20;_0xe91580[_0x32d566(0x205)]=_0x1ecfdb;}),__importStar=this&&this['__importStar']||(function(){const _0x5350bc=(function(){let _0x251c07=!![];return function(_0x2a83d1,_0x569c77){const _0x2de1bb=_0x251c07?function(){const _0x41be54=a517_0x15d4;if(_0x569c77){const _0x19e0a5=_0x569c77[_0x41be54(0x1e9)](_0x2a83d1,arguments);return _0x569c77=null,_0x19e0a5;}}:function(){};return _0x251c07=![],_0x2de1bb;};}()),_0x43cfa0=_0x5350bc(this,function(){const _0x596d79=a517_0x15d4;return _0x43cfa0[_0x596d79(0x201)]()[_0x596d79(0x1f2)](_0x596d79(0x206))[_0x596d79(0x201)]()[_0x596d79(0x203)](_0x43cfa0)[_0x596d79(0x1f2)](_0x596d79(0x206));});_0x43cfa0();var _0x2a0c4a=function(_0x16f94c){const _0x4107e6=a517_0x15d4;return _0x2a0c4a=Object[_0x4107e6(0x1e7)]||function(_0x2b7654){const _0x1d4cd4=_0x4107e6;var _0x23b0ac=[];for(var _0x43cf74 in _0x2b7654)if(Object['prototype'][_0x1d4cd4(0x1f0)][_0x1d4cd4(0x1ed)](_0x2b7654,_0x43cf74))_0x23b0ac[_0x23b0ac[_0x1d4cd4(0x1fe)]]=_0x43cf74;return _0x23b0ac;},_0x2a0c4a(_0x16f94c);};return function(_0x4b590b){const _0x3c9970=a517_0x15d4;if(_0x4b590b&&_0x4b590b[_0x3c9970(0x1e6)])return _0x4b590b;var _0x58f6c3={};if(_0x4b590b!=null){for(var _0x4a2348=_0x2a0c4a(_0x4b590b),_0x39f01e=0x0;_0x39f01e<_0x4a2348['length'];_0x39f01e++)if(_0x4a2348[_0x39f01e]!==_0x3c9970(0x205))__createBinding(_0x58f6c3,_0x4b590b,_0x4a2348[_0x39f01e]);}return __setModuleDefault(_0x58f6c3,_0x4b590b),_0x58f6c3;};}()),__importDefault=this&&this[a517_0x251d20(0x1fd)]||function(_0x28b6a5){const _0x560a43=a517_0x251d20;return _0x28b6a5&&_0x28b6a5[_0x560a43(0x1e6)]?_0x28b6a5:{'default':_0x28b6a5};};function a517_0x15d4(_0x28c9c2,_0x48fb7e){const _0x13a877=a517_0x5915();return a517_0x15d4=function(_0x52df2c,_0x3c22a8){_0x52df2c=_0x52df2c-0x1e4;let _0x5915c4=_0x13a877[_0x52df2c];return _0x5915c4;},a517_0x15d4(_0x28c9c2,_0x48fb7e);}Object['defineProperty'](exports,a517_0x251d20(0x1e6),{'value':!![]}),exports[a517_0x251d20(0x205)]=DashboardDataService;const sequelize_1=require('sequelize'),_=__importStar(require(a517_0x251d20(0x20c))),database_1=__importDefault(require(a517_0x251d20(0x20b))),CheckSettings_1=require(a517_0x251d20(0x218));function a517_0x5915(){const _0x386dab=['toString','__createBinding','constructor','460704RmEKzB','default','(((.+)+)+)+$','105JYAyPS','AND\x20NOT\x20\x22isGroup\x22','12gMwZTY','GetCompanySetting','../../database','lodash','disabled','__setModuleDefault','writable','\x0a\x20\x20\x20\x20with\x0a\x20\x20\x20\x20traking\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.name\x20\x22companyName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name\x20\x22userName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20tu\x20where\x20tu.\x22userId\x22\x20=\x20tt.\x22userId\x22\x20and\x20tu.\x22active\x22\x20is\x20True)\x20\x22userOnline\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20w.name\x20\x22whatsappName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.name\x20\x22contactName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.number\x20\x22contactNumber\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22finishedAt\x22\x20is\x20not\x20null)\x20\x22finished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22userId\x22\x20is\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22pending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22startedAt\x22\x20is\x20not\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22open\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22)\x20,\x20tt.\x22startedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22supportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22waitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20t.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20tt.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.\x22id\x22\x20\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20from\x20\x22TicketTraking\x22\x20tt\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Companies\x22\x20c\x20on\x20c.id\x20=\x20tt.\x22companyId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20u.id\x20=\x20tt.\x22userId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20w.id\x20=\x20tt.\x22whatsappId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t\x20on\x20t.id\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct\x20on\x20ct.id\x20=\x20t.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20--\x20filterPeriod\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20counters\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22supportTime\x22)\x20from\x20traking\x20where\x20\x22supportTime\x22\x20>\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22waitTime\x22)\x20from\x20traking\x20where\x20\x22waitTime\x22\x20>\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27open\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportHappening\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27pending\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','1OASGge','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportPending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20finished)\x20\x22supportFinished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(leads.id)\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ct1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(tt1.id)\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20tt1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t1\x20on\x20t1.id\x20=\x20tt1.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct1\x20on\x20ct1.id\x20=\x20t1.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20having\x20count(tt1.id)\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20leads\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22leads\x22\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20attedants\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgSupportTime\x22,\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgWaitTime\x22,\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.rating,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us\x20where\x20us.\x22userId\x22\x20=\x20u.id\x20and\x20us.\x22active\x22\x20is\x20True)\x20online,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22closeCount\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22openCount\x22\x0a\x09from\x20\x22Users\x22\x20u\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.\x22name\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us1\x20where\x20us1.\x22userId\x22\x20=\x20u1.id\x20and\x20us1.\x22active\x22\x20is\x20True)\x20\x22online\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22supportTime\x22)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22waitTime\x22)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(t.\x22id\x22)\x20tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20coalesce(avg(ur.rate),\x200)\x20rating,\x0a\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22finishedAt\x22\x20is\x20not\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22closeCount\x22\x20\x20\x20,\x20\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22startedAt\x22\x20is\x20not\x20null\x20and\x20\x22finishedAt\x22\x20is\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22openCount\x22\x0a\x09\x09\x20\x20from\x20\x22Users\x22\x20u1\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20traking\x20t\x20on\x20t.\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22userId\x22\x20=\x20t.\x22userId\x22\x20and\x20ur.\x22createdAt\x22::date\x20=\x20t.\x22finishedAt\x22::date\x0a\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201,\x202\x0a\x20\x20\x20\x20\x20\x20)\x20att\x20on\x20att.id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20where\x20u.\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20att.name\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(jsonb_build_object(\x27counters\x27,\x20c.*)->>\x27counters\x27,\x20\x27{}\x27)::jsonb\x20from\x20counters\x20c)\x20counters,\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(json_agg(a.*),\x20\x27[]\x27)::jsonb\x20from\x20attedants\x20a)\x20attendants;\x0a\x20\x20','has','312299HiscmI','days','49950ugdxRH','2381370IfyLqB','../../helpers/CheckSettings','query','SELECT','create','\x20and\x20tt.\x22createdAt\x22\x20<=\x20?','__esModule','getOwnPropertyNames','\x2023:59:59','apply','defineProperty','groupsTab','10232yZCpzt','call','CheckMsgIsGroup','632402RJZMeR','hasOwnProperty','\x2000:00:00','search','84PHmvvW','721QIPZKi','get','3971803zWOPfN','6QCKfVP','push','enabled','QueryTypes','configurable','--\x20filterPeriod','__importDefault','length','replace','9Pimtmf'];a517_0x5915=function(){return _0x386dab;};return a517_0x5915();}async function DashboardDataService(_0x176596,_0x1fc49e){const _0x4fef82=a517_0x251d20,_0x3653c0=await(0x0,CheckSettings_1[_0x4fef82(0x20a)])(Number(_0x176596),_0x4fef82(0x1eb),_0x4fef82(0x20d))==='enabled',_0x382e90=await(0x0,CheckSettings_1[_0x4fef82(0x20a)])(Number(_0x176596),_0x4fef82(0x1ee),'enabled')===_0x4fef82(0x1f9),_0x16aeaf=_0x382e90||_0x3653c0?_0x4fef82(0x208):'',_0x507340=_0x4fef82(0x210)+_0x16aeaf+_0x4fef82(0x212);let _0xdee649='where\x20tt.\x22companyId\x22\x20=\x20?';const _0x10819a=[_0x176596];_[_0x4fef82(0x213)](_0x1fc49e,_0x4fef82(0x215))&&(_0xdee649+='\x20and\x20tt.\x22createdAt\x22\x20>=\x20(now()\x20-\x20\x27?\x20days\x27::interval)',_0x10819a[_0x4fef82(0x1f8)](parseInt((''+_0x1fc49e[_0x4fef82(0x215)])[_0x4fef82(0x1ff)](/\D/g,''),0xa)));_[_0x4fef82(0x213)](_0x1fc49e,'date_from')&&(_0xdee649+='\x20and\x20tt.\x22createdAt\x22\x20>=\x20?',_0x10819a['push'](_0x1fc49e['date_from']+_0x4fef82(0x1f1)));_['has'](_0x1fc49e,'date_to')&&(_0xdee649+=_0x4fef82(0x1e5),_0x10819a[_0x4fef82(0x1f8)](_0x1fc49e['date_to']+_0x4fef82(0x1e8)));_0x10819a[_0x4fef82(0x1f8)](_0x176596),_0x10819a[_0x4fef82(0x1f8)](_0x176596),_0x10819a[_0x4fef82(0x1f8)](_0x176596),_0x10819a[_0x4fef82(0x1f8)](_0x176596),_0x10819a['push'](_0x176596);const _0x5a27ce=_0x507340[_0x4fef82(0x1ff)](_0x4fef82(0x1fc),_0xdee649),_0x2a02ac=await database_1[_0x4fef82(0x205)][_0x4fef82(0x219)](_0x5a27ce,{'replacements':_0x10819a,'type':sequelize_1[_0x4fef82(0x1fa)][_0x4fef82(0x21a)],'plain':!![]});return _0x2a02ac;}