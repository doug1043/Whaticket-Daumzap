'use strict';const a627_0x23fb44=a627_0x4a20;(function(_0x3d0142,_0x4d962c){const _0x4dad92=a627_0x4a20,_0x5c1575=_0x3d0142();while(!![]){try{const _0x1d41f8=parseInt(_0x4dad92(0x136))/0x1*(-parseInt(_0x4dad92(0x119))/0x2)+-parseInt(_0x4dad92(0x11d))/0x3+-parseInt(_0x4dad92(0x132))/0x4+-parseInt(_0x4dad92(0x133))/0x5+parseInt(_0x4dad92(0x10c))/0x6*(parseInt(_0x4dad92(0x118))/0x7)+parseInt(_0x4dad92(0x139))/0x8*(-parseInt(_0x4dad92(0x13b))/0x9)+parseInt(_0x4dad92(0x12e))/0xa;if(_0x1d41f8===_0x4d962c)break;else _0x5c1575['push'](_0x5c1575['shift']());}catch(_0x2ecbfb){_0x5c1575['push'](_0x5c1575['shift']());}}}(a627_0x2f6b,0x1adfb));var __createBinding=this&&this[a627_0x23fb44(0x123)]||(Object[a627_0x23fb44(0x12f)]?function(_0x41300a,_0x275e2b,_0x261a4c,_0x198ec4){const _0x4fc7de=a627_0x23fb44;if(_0x198ec4===undefined)_0x198ec4=_0x261a4c;var _0x23843d=Object[_0x4fc7de(0x11e)](_0x275e2b,_0x261a4c);(!_0x23843d||(_0x4fc7de(0x117)in _0x23843d?!_0x275e2b[_0x4fc7de(0x120)]:_0x23843d[_0x4fc7de(0x130)]||_0x23843d['configurable']))&&(_0x23843d={'enumerable':!![],'get':function(){return _0x275e2b[_0x261a4c];}}),Object['defineProperty'](_0x41300a,_0x198ec4,_0x23843d);}:function(_0x1ff72e,_0x5b7beb,_0x529328,_0x59b11e){if(_0x59b11e===undefined)_0x59b11e=_0x529328;_0x1ff72e[_0x59b11e]=_0x5b7beb[_0x529328];}),__setModuleDefault=this&&this[a627_0x23fb44(0x131)]||(Object['create']?function(_0x429018,_0x2a629a){const _0x136b09=a627_0x23fb44;Object[_0x136b09(0x134)](_0x429018,'default',{'enumerable':!![],'value':_0x2a629a});}:function(_0x557f07,_0x5546db){const _0x4cc4aa=a627_0x23fb44;_0x557f07[_0x4cc4aa(0x110)]=_0x5546db;}),__importStar=this&&this['__importStar']||(function(){const _0x3a6124=(function(){let _0x2546ce=!![];return function(_0x3fd105,_0x3c5b3f){const _0x8a50c0=_0x2546ce?function(){const _0x56da6d=a627_0x4a20;if(_0x3c5b3f){const _0x1b410c=_0x3c5b3f[_0x56da6d(0x10e)](_0x3fd105,arguments);return _0x3c5b3f=null,_0x1b410c;}}:function(){};return _0x2546ce=![],_0x8a50c0;};}()),_0x9d5259=_0x3a6124(this,function(){const _0x22042b=a627_0x4a20;return _0x9d5259[_0x22042b(0x128)]()['search']('(((.+)+)+)+$')[_0x22042b(0x128)]()['constructor'](_0x9d5259)[_0x22042b(0x11a)](_0x22042b(0x125));});_0x9d5259();var _0x328ac6=function(_0x598bd2){const _0x47af2a=a627_0x4a20;return _0x328ac6=Object[_0x47af2a(0x112)]||function(_0x2b8bf3){const _0x561fdc=_0x47af2a;var _0x298a3a=[];for(var _0x32ce98 in _0x2b8bf3)if(Object['prototype'][_0x561fdc(0x127)][_0x561fdc(0x135)](_0x2b8bf3,_0x32ce98))_0x298a3a[_0x298a3a[_0x561fdc(0x11f)]]=_0x32ce98;return _0x298a3a;},_0x328ac6(_0x598bd2);};return function(_0x322005){const _0x52ae78=a627_0x4a20;if(_0x322005&&_0x322005['__esModule'])return _0x322005;var _0x24a1b2={};if(_0x322005!=null){for(var _0x2d1d79=_0x328ac6(_0x322005),_0x5b9e6e=0x0;_0x5b9e6e<_0x2d1d79[_0x52ae78(0x11f)];_0x5b9e6e++)if(_0x2d1d79[_0x5b9e6e]!==_0x52ae78(0x110))__createBinding(_0x24a1b2,_0x322005,_0x2d1d79[_0x5b9e6e]);}return __setModuleDefault(_0x24a1b2,_0x322005),_0x24a1b2;};}()),__importDefault=this&&this[a627_0x23fb44(0x137)]||function(_0x34aa7e){const _0x594dda=a627_0x23fb44;return _0x34aa7e&&_0x34aa7e[_0x594dda(0x120)]?_0x34aa7e:{'default':_0x34aa7e};};Object[a627_0x23fb44(0x134)](exports,a627_0x23fb44(0x120),{'value':!![]}),exports[a627_0x23fb44(0x110)]=DashboardDataService;function a627_0x4a20(_0x3b3038,_0x3a841b){const _0x51c2b0=a627_0x2f6b();return a627_0x4a20=function(_0x378bf3,_0x4d1881){_0x378bf3=_0x378bf3-0x108;let _0x2f6b7b=_0x51c2b0[_0x378bf3];return _0x2f6b7b;},a627_0x4a20(_0x3b3038,_0x3a841b);}const sequelize_1=require(a627_0x23fb44(0x114)),_=__importStar(require(a627_0x23fb44(0x113))),database_1=__importDefault(require(a627_0x23fb44(0x109))),CheckSettings_1=require(a627_0x23fb44(0x12c));function a627_0x2f6b(){const _0x5d5963=['create','writable','__setModuleDefault','318152hIQVYj','966635AWDyXP','defineProperty','call','3vqjfgB','__importDefault','days','27400AzIxsU','date_from','252GTPTJo','\x0a\x20\x20\x20\x20with\x0a\x20\x20\x20\x20traking\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.name\x20\x22companyName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name\x20\x22userName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20tu\x20where\x20tu.\x22userId\x22\x20=\x20tt.\x22userId\x22\x20and\x20tu.\x22active\x22\x20is\x20True)\x20\x22userOnline\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20w.name\x20\x22whatsappName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.name\x20\x22contactName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.number\x20\x22contactNumber\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22finishedAt\x22\x20is\x20not\x20null)\x20\x22finished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22userId\x22\x20is\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22pending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22startedAt\x22\x20is\x20not\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22open\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22)\x20,\x20tt.\x22startedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22supportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22waitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20t.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20tt.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.\x22id\x22\x20\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20from\x20\x22TicketTraking\x22\x20tt\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Companies\x22\x20c\x20on\x20c.id\x20=\x20tt.\x22companyId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20u.id\x20=\x20tt.\x22userId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20w.id\x20=\x20tt.\x22whatsappId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t\x20on\x20t.id\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct\x20on\x20ct.id\x20=\x20t.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20--\x20filterPeriod\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20counters\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22supportTime\x22)\x20from\x20traking\x20where\x20\x22supportTime\x22\x20>\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22waitTime\x22)\x20from\x20traking\x20where\x20\x22waitTime\x22\x20>\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27open\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportHappening\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27pending\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','../../database','\x2023:59:59','--\x20filterPeriod','6LPWsbh','where\x20tt.\x22companyId\x22\x20=\x20?','apply','\x2000:00:00','default','query','getOwnPropertyNames','lodash','sequelize','push','\x20and\x20tt.\x22createdAt\x22\x20>=\x20(now()\x20-\x20\x27?\x20days\x27::interval)','get','637889kGYpDW','119138TYqVWL','search','has','SELECT','307872akKSdc','getOwnPropertyDescriptor','length','__esModule','AND\x20NOT\x20\x22isGroup\x22','GetCompanySetting','__createBinding','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportPending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20finished)\x20\x22supportFinished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(leads.id)\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ct1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(tt1.id)\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20tt1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t1\x20on\x20t1.id\x20=\x20tt1.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct1\x20on\x20ct1.id\x20=\x20t1.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20having\x20count(tt1.id)\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20leads\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22leads\x22\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20attedants\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgSupportTime\x22,\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgWaitTime\x22,\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.rating,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us\x20where\x20us.\x22userId\x22\x20=\x20u.id\x20and\x20us.\x22active\x22\x20is\x20True)\x20online,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22closeCount\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22openCount\x22\x0a\x09from\x20\x22Users\x22\x20u\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.\x22name\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us1\x20where\x20us1.\x22userId\x22\x20=\x20u1.id\x20and\x20us1.\x22active\x22\x20is\x20True)\x20\x22online\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22supportTime\x22)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22waitTime\x22)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(t.\x22id\x22)\x20tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20coalesce(avg(ur.rate),\x200)\x20rating,\x0a\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22finishedAt\x22\x20is\x20not\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22closeCount\x22\x20\x20\x20,\x20\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22startedAt\x22\x20is\x20not\x20null\x20and\x20\x22finishedAt\x22\x20is\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22openCount\x22\x0a\x09\x09\x20\x20from\x20\x22Users\x22\x20u1\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20traking\x20t\x20on\x20t.\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22userId\x22\x20=\x20t.\x22userId\x22\x20and\x20ur.\x22createdAt\x22::date\x20=\x20t.\x22finishedAt\x22::date\x0a\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201,\x202\x0a\x20\x20\x20\x20\x20\x20)\x20att\x20on\x20att.id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20where\x20u.\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20att.name\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(jsonb_build_object(\x27counters\x27,\x20c.*)->>\x27counters\x27,\x20\x27{}\x27)::jsonb\x20from\x20counters\x20c)\x20counters,\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(json_agg(a.*),\x20\x27[]\x27)::jsonb\x20from\x20attedants\x20a)\x20attendants;\x0a\x20\x20','(((.+)+)+)+$','disabled','hasOwnProperty','toString','enabled','date_to','\x20and\x20tt.\x22createdAt\x22\x20>=\x20?','../../helpers/CheckSettings','\x20and\x20tt.\x22createdAt\x22\x20<=\x20?','6690440TXxeQt'];a627_0x2f6b=function(){return _0x5d5963;};return a627_0x2f6b();}async function DashboardDataService(_0x4597f7,_0x2c0816){const _0x128974=a627_0x23fb44,_0x4cba15=await(0x0,CheckSettings_1[_0x128974(0x122)])(Number(_0x4597f7),'groupsTab',_0x128974(0x126))===_0x128974(0x129),_0x4f1a7f=await(0x0,CheckSettings_1['GetCompanySetting'])(Number(_0x4597f7),'CheckMsgIsGroup',_0x128974(0x129))===_0x128974(0x129),_0x568515=_0x4f1a7f||_0x4cba15?_0x128974(0x121):'',_0x34b674=_0x128974(0x108)+_0x568515+_0x128974(0x124);let _0x18c6af=_0x128974(0x10d);const _0x5a7231=[_0x4597f7];_[_0x128974(0x11b)](_0x2c0816,_0x128974(0x138))&&(_0x18c6af+=_0x128974(0x116),_0x5a7231['push'](parseInt((''+_0x2c0816[_0x128974(0x138)])['replace'](/\D/g,''),0xa)));_['has'](_0x2c0816,_0x128974(0x13a))&&(_0x18c6af+=_0x128974(0x12b),_0x5a7231['push'](_0x2c0816['date_from']+_0x128974(0x10f)));_[_0x128974(0x11b)](_0x2c0816,_0x128974(0x12a))&&(_0x18c6af+=_0x128974(0x12d),_0x5a7231[_0x128974(0x115)](_0x2c0816[_0x128974(0x12a)]+_0x128974(0x10a)));_0x5a7231[_0x128974(0x115)](_0x4597f7),_0x5a7231[_0x128974(0x115)](_0x4597f7),_0x5a7231[_0x128974(0x115)](_0x4597f7),_0x5a7231['push'](_0x4597f7),_0x5a7231[_0x128974(0x115)](_0x4597f7);const _0x549531=_0x34b674['replace'](_0x128974(0x10b),_0x18c6af),_0x523618=await database_1[_0x128974(0x110)][_0x128974(0x111)](_0x549531,{'replacements':_0x5a7231,'type':sequelize_1['QueryTypes'][_0x128974(0x11c)],'plain':!![]});return _0x523618;}