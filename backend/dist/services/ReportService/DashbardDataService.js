'use strict';function a517_0x49b9(_0x31d73f,_0x1b1d3c){const _0x48ecb6=a517_0x36b9();return a517_0x49b9=function(_0x264a53,_0x4af50d){_0x264a53=_0x264a53-0xe4;let _0x36b949=_0x48ecb6[_0x264a53];return _0x36b949;},a517_0x49b9(_0x31d73f,_0x1b1d3c);}const a517_0x1f651f=a517_0x49b9;(function(_0x275d42,_0x52df5d){const _0x4dce8f=a517_0x49b9,_0x13eeb5=_0x275d42();while(!![]){try{const _0x37022a=-parseInt(_0x4dce8f(0xf2))/0x1+-parseInt(_0x4dce8f(0xf6))/0x2*(-parseInt(_0x4dce8f(0x108))/0x3)+parseInt(_0x4dce8f(0x104))/0x4+-parseInt(_0x4dce8f(0x112))/0x5*(-parseInt(_0x4dce8f(0x100))/0x6)+parseInt(_0x4dce8f(0xf7))/0x7+-parseInt(_0x4dce8f(0xec))/0x8*(parseInt(_0x4dce8f(0xfc))/0x9)+-parseInt(_0x4dce8f(0xf8))/0xa*(-parseInt(_0x4dce8f(0x101))/0xb);if(_0x37022a===_0x52df5d)break;else _0x13eeb5['push'](_0x13eeb5['shift']());}catch(_0x2fef81){_0x13eeb5['push'](_0x13eeb5['shift']());}}}(a517_0x36b9,0xa16e1));var __createBinding=this&&this[a517_0x1f651f(0xfd)]||(Object['create']?function(_0x409db9,_0x229b82,_0x55aedf,_0x21464e){const _0x542f4c=a517_0x1f651f;if(_0x21464e===undefined)_0x21464e=_0x55aedf;var _0x9638ff=Object[_0x542f4c(0xeb)](_0x229b82,_0x55aedf);(!_0x9638ff||(_0x542f4c(0x111)in _0x9638ff?!_0x229b82[_0x542f4c(0x115)]:_0x9638ff['writable']||_0x9638ff[_0x542f4c(0xf1)]))&&(_0x9638ff={'enumerable':!![],'get':function(){return _0x229b82[_0x55aedf];}}),Object[_0x542f4c(0x110)](_0x409db9,_0x21464e,_0x9638ff);}:function(_0x3b2e3f,_0x4ca499,_0x235038,_0x369d0f){if(_0x369d0f===undefined)_0x369d0f=_0x235038;_0x3b2e3f[_0x369d0f]=_0x4ca499[_0x235038];}),__setModuleDefault=this&&this[a517_0x1f651f(0x107)]||(Object[a517_0x1f651f(0x10d)]?function(_0x538a08,_0x48c808){const _0x7a62ae=a517_0x1f651f;Object[_0x7a62ae(0x110)](_0x538a08,'default',{'enumerable':!![],'value':_0x48c808});}:function(_0x4fc064,_0x1b3a08){const _0x1776c0=a517_0x1f651f;_0x4fc064[_0x1776c0(0xfa)]=_0x1b3a08;}),__importStar=this&&this[a517_0x1f651f(0xf0)]||(function(){const _0x1219eb=(function(){let _0x42e3ba=!![];return function(_0x3d8d37,_0x27ed56){const _0x45a86c=_0x42e3ba?function(){const _0x10a472=a517_0x49b9;if(_0x27ed56){const _0x186b5e=_0x27ed56[_0x10a472(0xfb)](_0x3d8d37,arguments);return _0x27ed56=null,_0x186b5e;}}:function(){};return _0x42e3ba=![],_0x45a86c;};}()),_0x363fe4=_0x1219eb(this,function(){const _0x27879d=a517_0x49b9;return _0x363fe4['toString']()['search'](_0x27879d(0xe9))['toString']()[_0x27879d(0x116)](_0x363fe4)[_0x27879d(0xf4)](_0x27879d(0xe9));});_0x363fe4();var _0x57b389=function(_0x3cb9ec){const _0x6279bf=a517_0x49b9;return _0x57b389=Object[_0x6279bf(0xf9)]||function(_0x40f186){const _0x1af51a=_0x6279bf;var _0x3b3d4b=[];for(var _0x526a78 in _0x40f186)if(Object[_0x1af51a(0xea)][_0x1af51a(0xe5)][_0x1af51a(0x10e)](_0x40f186,_0x526a78))_0x3b3d4b[_0x3b3d4b[_0x1af51a(0x10f)]]=_0x526a78;return _0x3b3d4b;},_0x57b389(_0x3cb9ec);};return function(_0x2dc816){const _0x24ebd8=a517_0x49b9;if(_0x2dc816&&_0x2dc816[_0x24ebd8(0x115)])return _0x2dc816;var _0x21f73f={};if(_0x2dc816!=null){for(var _0x3d11c1=_0x57b389(_0x2dc816),_0x207c5f=0x0;_0x207c5f<_0x3d11c1['length'];_0x207c5f++)if(_0x3d11c1[_0x207c5f]!=='default')__createBinding(_0x21f73f,_0x2dc816,_0x3d11c1[_0x207c5f]);}return __setModuleDefault(_0x21f73f,_0x2dc816),_0x21f73f;};}()),__importDefault=this&&this['__importDefault']||function(_0xb35e6d){const _0x478782=a517_0x1f651f;return _0xb35e6d&&_0xb35e6d[_0x478782(0x115)]?_0xb35e6d:{'default':_0xb35e6d};};Object[a517_0x1f651f(0x110)](exports,a517_0x1f651f(0x115),{'value':!![]}),exports['default']=DashboardDataService;const sequelize_1=require(a517_0x1f651f(0xee)),_=__importStar(require(a517_0x1f651f(0x105))),database_1=__importDefault(require(a517_0x1f651f(0xef))),CheckSettings_1=require(a517_0x1f651f(0x109));function a517_0x36b9(){const _0x375526=['length','defineProperty','get','12060NiuXPx','enabled','days','__esModule','constructor','\x0a\x20\x20\x20\x20with\x0a\x20\x20\x20\x20traking\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.name\x20\x22companyName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name\x20\x22userName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20tu\x20where\x20tu.\x22userId\x22\x20=\x20tt.\x22userId\x22\x20and\x20tu.\x22active\x22\x20is\x20True)\x20\x22userOnline\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20w.name\x20\x22whatsappName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.name\x20\x22contactName\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.number\x20\x22contactNumber\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22finishedAt\x22\x20is\x20not\x20null)\x20\x22finished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22userId\x22\x20is\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22pending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(tt.\x22startedAt\x22\x20is\x20not\x20null\x20and\x20tt.\x22finishedAt\x22\x20is\x20null)\x20\x22open\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22)\x20,\x20tt.\x22startedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(coalesce(tt.\x22ratingAt\x22,\x20tt.\x22finishedAt\x22),\x20tt.\x22startedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22supportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce((\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27day\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2024\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27hour\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22))\x20*\x2060)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(date_part(\x27minutes\x27,\x20age(tt.\x22startedAt\x22,\x20tt.\x22queuedAt\x22)))\x0a\x20\x20\x20\x20\x20\x20\x20\x20),\x200)\x20\x22waitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20t.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20tt.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ct.\x22id\x22\x20\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20from\x20\x22TicketTraking\x22\x20tt\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Companies\x22\x20c\x20on\x20c.id\x20=\x20tt.\x22companyId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20u.id\x20=\x20tt.\x22userId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20w.id\x20=\x20tt.\x22whatsappId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t\x20on\x20t.id\x20=\x20tt.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct\x20on\x20ct.id\x20=\x20t.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20--\x20filterPeriod\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20counters\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22supportTime\x22)\x20from\x20traking\x20where\x20\x22supportTime\x22\x20>\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20avg(\x22waitTime\x22)\x20from\x20traking\x20where\x20\x22waitTime\x22\x20>\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27open\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportHappening\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x22Tickets\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20status\x20like\x20\x27pending\x27\x20and\x20\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22supportPending\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(id)\x20from\x20traking\x20where\x20finished)\x20\x22supportFinished\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(leads.id)\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ct1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(tt1.id)\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x20tt1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Tickets\x22\x20t1\x20on\x20t1.id\x20=\x20tt1.\x22ticketId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20ct1\x20on\x20ct1.id\x20=\x20t1.\x22contactId\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20having\x20count(tt1.id)\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20leads\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x22leads\x22\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20attedants\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgSupportTime\x22,\x200)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20coalesce(att.\x22avgWaitTime\x22,\x200)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.rating,\x0a\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us\x20where\x20us.\x22userId\x22\x20=\x20u.id\x20and\x20us.\x22active\x22\x20is\x20True)\x20online,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22closeCount\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20att.\x22openCount\x22\x0a\x09from\x20\x22Users\x22\x20u\x0a\x20\x20\x20\x20\x20\x20left\x20join\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.\x22name\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20count(*)\x20>\x200\x20as\x20online\x20from\x20\x22UserSocketSessions\x22\x20us1\x20where\x20us1.\x22userId\x22\x20=\x20u1.id\x20and\x20us1.\x22active\x22\x20is\x20True)\x20\x22online\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22supportTime\x22)\x20\x22avgSupportTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20avg(t.\x22waitTime\x22)\x20\x22avgWaitTime\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(t.\x22id\x22)\x20tickets,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20coalesce(avg(ur.rate),\x200)\x20rating,\x0a\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22finishedAt\x22\x20is\x20not\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22closeCount\x22\x20\x20\x20,\x20\x09\x09(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20count(distinct\x20\x22id\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20traking\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x22startedAt\x22\x20is\x20not\x20null\x20and\x20\x22finishedAt\x22\x20is\x20null\x20and\x20\x22companyId\x22\x20=\x20?\x20and\x20\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20\x20AS\x20\x22openCount\x22\x0a\x09\x09\x20\x20from\x20\x22Users\x22\x20u1\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20traking\x20t\x20on\x20t.\x22userId\x22\x20=\x20u1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x22UserRatings\x22\x20ur\x20on\x20ur.\x22userId\x22\x20=\x20t.\x22userId\x22\x20and\x20ur.\x22createdAt\x22::date\x20=\x20t.\x22finishedAt\x22::date\x0a\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x201,\x202\x0a\x20\x20\x20\x20\x20\x20)\x20att\x20on\x20att.id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20where\x20u.\x22companyId\x22\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20att.name\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(jsonb_build_object(\x27counters\x27,\x20c.*)->>\x27counters\x27,\x20\x27{}\x27)::jsonb\x20from\x20counters\x20c)\x20counters,\x0a\x20\x20\x20\x20\x20\x20(select\x20coalesce(json_agg(a.*),\x20\x27[]\x27)::jsonb\x20from\x20attedants\x20a)\x20attendants;\x0a\x20\x20','hasOwnProperty','\x20and\x20tt.\x22createdAt\x22\x20>=\x20(now()\x20-\x20\x27?\x20days\x27::interval)','\x2000:00:00','replace','(((.+)+)+)+$','prototype','getOwnPropertyDescriptor','8HmlWNC','\x2023:59:59','sequelize','../../database','__importStar','configurable','994836SxvKlD','\x20and\x20tt.\x22createdAt\x22\x20>=\x20?','search','\x20and\x20tt.\x22createdAt\x22\x20<=\x20?','2577964tUEfTU','1995777nZSpxn','16790ENuToG','getOwnPropertyNames','default','apply','10598823BcEmMw','__createBinding','date_from','CheckMsgIsGroup','1548XhXbWc','286SVoVZB','AND\x20NOT\x20\x22isGroup\x22','push','2374628QxSjoD','lodash','date_to','__setModuleDefault','3nGdSSK','../../helpers/CheckSettings','SELECT','has','QueryTypes','create','call'];a517_0x36b9=function(){return _0x375526;};return a517_0x36b9();}async function DashboardDataService(_0x442569,_0x2c66b5){const _0x566b86=a517_0x1f651f,_0xb71166=await(0x0,CheckSettings_1['GetCompanySetting'])(Number(_0x442569),'groupsTab','disabled')==='enabled',_0x3eeefe=await(0x0,CheckSettings_1['GetCompanySetting'])(Number(_0x442569),_0x566b86(0xff),_0x566b86(0x113))===_0x566b86(0x113),_0x3ae050=_0x3eeefe||_0xb71166?_0x566b86(0x102):'',_0x3dea1a=_0x566b86(0x117)+_0x3ae050+_0x566b86(0xe4);let _0x4754d3='where\x20tt.\x22companyId\x22\x20=\x20?';const _0x4700c8=[_0x442569];_[_0x566b86(0x10b)](_0x2c66b5,'days')&&(_0x4754d3+=_0x566b86(0xe6),_0x4700c8[_0x566b86(0x103)](parseInt((''+_0x2c66b5[_0x566b86(0x114)])[_0x566b86(0xe8)](/\D/g,''),0xa)));_[_0x566b86(0x10b)](_0x2c66b5,_0x566b86(0xfe))&&(_0x4754d3+=_0x566b86(0xf3),_0x4700c8[_0x566b86(0x103)](_0x2c66b5[_0x566b86(0xfe)]+_0x566b86(0xe7)));_[_0x566b86(0x10b)](_0x2c66b5,_0x566b86(0x106))&&(_0x4754d3+=_0x566b86(0xf5),_0x4700c8['push'](_0x2c66b5[_0x566b86(0x106)]+_0x566b86(0xed)));_0x4700c8[_0x566b86(0x103)](_0x442569),_0x4700c8[_0x566b86(0x103)](_0x442569),_0x4700c8[_0x566b86(0x103)](_0x442569),_0x4700c8[_0x566b86(0x103)](_0x442569),_0x4700c8['push'](_0x442569);const _0x5f5dd7=_0x3dea1a['replace']('--\x20filterPeriod',_0x4754d3),_0x3bc58b=await database_1[_0x566b86(0xfa)]['query'](_0x5f5dd7,{'replacements':_0x4700c8,'type':sequelize_1[_0x566b86(0x10c)][_0x566b86(0x10a)],'plain':!![]});return _0x3bc58b;}