const a540_0x30ea7d=a540_0xb53b;(function(_0x17e461,_0x546eb5){const _0x321d58=a540_0xb53b,_0x33927d=_0x17e461();while(!![]){try{const _0x5ee019=parseInt(_0x321d58(0xec))/0x1*(-parseInt(_0x321d58(0xf7))/0x2)+-parseInt(_0x321d58(0xcd))/0x3*(-parseInt(_0x321d58(0xd9))/0x4)+parseInt(_0x321d58(0xd1))/0x5+-parseInt(_0x321d58(0xd3))/0x6+-parseInt(_0x321d58(0xef))/0x7*(-parseInt(_0x321d58(0xee))/0x8)+parseInt(_0x321d58(0xcb))/0x9*(-parseInt(_0x321d58(0xe9))/0xa)+-parseInt(_0x321d58(0xf9))/0xb;if(_0x5ee019===_0x546eb5)break;else _0x33927d['push'](_0x33927d['shift']());}catch(_0xbf7fba){_0x33927d['push'](_0x33927d['shift']());}}}(a540_0x3061,0x4e7b5));const a540_0x25491b=(function(){let _0x1095ba=!![];return function(_0x3e7cbe,_0x49410d){const _0x4f837b=_0x1095ba?function(){if(_0x49410d){const _0x561680=_0x49410d['apply'](_0x3e7cbe,arguments);return _0x49410d=null,_0x561680;}}:function(){};return _0x1095ba=![],_0x4f837b;};}()),a540_0x42fbc0=a540_0x25491b(this,function(){const _0x35d83a=a540_0xb53b;return a540_0x42fbc0['toString']()['search'](_0x35d83a(0xe6))[_0x35d83a(0xcf)]()[_0x35d83a(0xde)](a540_0x42fbc0)['search'](_0x35d83a(0xe6));});a540_0x42fbc0();'use strict';var __importDefault=this&&this[a540_0x30ea7d(0xfb)]||function(_0x574782){const _0xa35b89=a540_0x30ea7d;return _0x574782&&_0x574782[_0xa35b89(0xd5)]?_0x574782:{'default':_0x574782};};Object['defineProperty'](exports,a540_0x30ea7d(0xd5),{'value':!![]}),exports['TestSMTPConnection']=exports[a540_0x30ea7d(0xea)]=void 0x0;function a540_0x3061(){const _0x2205b9=['Configurações\x20de\x20SMTP\x20incompletas.\x20Verifique\x20URL,\x20usuário\x20e\x20senha.','message','Não\x20foi\x20possível\x20conectar\x20ao\x20servidor\x20SMTP:\x20','smtpauth','default','154412TSEULW','clientsecretsmtpauth','538802hgyPxk','smtpport','__importDefault','test','9chHexl','Erro\x20ao\x20enviar\x20e-mail\x20para\x20','198819BuFgoz','close','toString','createTransport','2512795HyHHNF','findOne','917598aSjeol','587','__esModule','Erro\x20ao\x20enviar\x20e-mail:\x20','Falha\x20na\x20verificação\x20SMTP:\x20','error','16JvJoge','Conexão\x20SMTP\x20estabelecida\x20com\x20sucesso!','TLSv1.2','../../models/Setting','Email,\x20assunto\x20e\x20mensagem\x20são\x20obrigatórios','constructor','nodemailer','../../utils/logger','messageId','value','all','Conexão\x20SMTP\x20verificada\x20com\x20sucesso\x20para\x20company\x20','info','(((.+)+)+)+$','Erro\x20desconhecido','logger','6268710uDqCyH','SendMail','.\x20MessageId:\x20','2wWhzYS','verify','16QHiLFO','1879528dIHTkm','Formato\x20de\x20email\x20inválido','requireTLS'];a540_0x3061=function(){return _0x2205b9;};return a540_0x3061();}const nodemailer_1=__importDefault(require(a540_0x30ea7d(0xdf))),Setting_1=__importDefault(require(a540_0x30ea7d(0xdc))),Email_1=__importDefault(require('../../models/Email')),logger_1=require(a540_0x30ea7d(0xe0)),createTransporter=async _0x6b4aa5=>{const _0x4fc56e=a540_0x30ea7d,[_0x5aad43,_0x5ca2f0,_0x41407b,_0x28ce10]=await Promise[_0x4fc56e(0xe3)]([Setting_1['default'][_0x4fc56e(0xd2)]({'where':{'companyId':_0x6b4aa5,'key':_0x4fc56e(0xf5)}}),Setting_1[_0x4fc56e(0xf6)]['findOne']({'where':{'companyId':_0x6b4aa5,'key':'usersmtpauth'}}),Setting_1[_0x4fc56e(0xf6)][_0x4fc56e(0xd2)]({'where':{'companyId':_0x6b4aa5,'key':_0x4fc56e(0xf8)}}),Setting_1[_0x4fc56e(0xf6)]['findOne']({'where':{'companyId':_0x6b4aa5,'key':_0x4fc56e(0xfa)}})]);if(!_0x5aad43?.['value']||!_0x5ca2f0?.[_0x4fc56e(0xe2)]||!_0x41407b?.[_0x4fc56e(0xe2)])throw new Error(_0x4fc56e(0xf2));const _0x5903ff=_0x5aad43[_0x4fc56e(0xe2)],_0xf00aa4=_0x5ca2f0[_0x4fc56e(0xe2)],_0x33f6e0=_0x41407b[_0x4fc56e(0xe2)],_0x45645f=parseInt(_0x28ce10?.['value']||_0x4fc56e(0xd4),0xa),_0x4a578b=_0x45645f===0x1d1,_0x3214d1=_0x45645f===0x24b||_0x45645f===0x19,_0x5ba628={'host':_0x5903ff,'port':_0x45645f,'secure':_0x4a578b,'auth':{'user':_0xf00aa4,'pass':_0x33f6e0},'connectionTimeout':0x7530,'greetingTimeout':0x7530,'socketTimeout':0xea60,'pool':![],'tls':{'rejectUnauthorized':![],'minVersion':_0x4fc56e(0xdb)}};_0x3214d1&&(_0x5ba628[_0x4fc56e(0xf1)]=!![]);const _0x4cce66=nodemailer_1['default'][_0x4fc56e(0xd0)](_0x5ba628);try{await _0x4cce66[_0x4fc56e(0xed)](),logger_1[_0x4fc56e(0xe8)][_0x4fc56e(0xe5)](_0x4fc56e(0xe4)+_0x6b4aa5);}catch(_0x4921b0){logger_1[_0x4fc56e(0xe8)][_0x4fc56e(0xd8)](_0x4fc56e(0xd7)+_0x4921b0[_0x4fc56e(0xf3)]);throw new Error(_0x4fc56e(0xf4)+_0x4921b0['message']);}return{'transporter':_0x4cce66,'userSmtp':_0xf00aa4};},SendMail=async(_0x58e778,_0x3cec2f,_0x4f93c6,_0x3a68b4,_0x467689,_0x480a03,_0x354dc5)=>{const _0x2d71fe=a540_0x30ea7d;try{if(!_0x3cec2f||!_0x3a68b4||!_0x467689)return{'error':_0x2d71fe(0xdd)};const _0x1e0eba=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!_0x1e0eba[_0x2d71fe(0xfc)](_0x3cec2f))return{'error':_0x2d71fe(0xf0)};const {transporter:_0x314941,userSmtp:_0x1a6b97}=await createTransporter(_0x58e778),_0x310f82={'from':_0x1a6b97,'to':_0x3cec2f,'subject':_0x3a68b4,'text':_0x467689,'html':_0x467689['replace'](/\n/g,'<br>')},_0x479c56=await _0x314941['sendMail'](_0x310f82);return logger_1[_0x2d71fe(0xe8)]['info']('Email\x20enviado\x20com\x20sucesso\x20para\x20'+_0x3cec2f+_0x2d71fe(0xeb)+_0x479c56[_0x2d71fe(0xe1)]),await Email_1[_0x2d71fe(0xf6)]['create']({'sender':_0x3cec2f,'subject':_0x3a68b4,'message':_0x467689,'companyId':_0x58e778,'scheduled':![],'sendAt':null}),_0x314941[_0x2d71fe(0xce)](),{'success':!![],'message':'E-mail\x20enviado\x20com\x20sucesso'};}catch(_0x2d67e0){const _0xe90478=_0x2d67e0 instanceof Error?_0x2d67e0[_0x2d71fe(0xf3)]:_0x2d71fe(0xe7);return logger_1[_0x2d71fe(0xe8)][_0x2d71fe(0xd8)](_0x2d71fe(0xcc)+_0x3cec2f+':\x20'+_0xe90478),{'error':_0x2d71fe(0xd6)+_0xe90478};}};exports['SendMail']=SendMail;const TestSMTPConnection=async _0x3b27eb=>{const _0x441b7d=a540_0x30ea7d;try{return await createTransporter(_0x3b27eb),{'success':!![],'message':_0x441b7d(0xda)};}catch(_0x1fb038){const _0x337c59=_0x1fb038 instanceof Error?_0x1fb038[_0x441b7d(0xf3)]:'Erro\x20desconhecido';return{'error':_0x337c59};}};function a540_0xb53b(_0x792e65,_0x1e5640){const _0x19794f=a540_0x3061();return a540_0xb53b=function(_0x42fbc0,_0x25491b){_0x42fbc0=_0x42fbc0-0xcb;let _0x306116=_0x19794f[_0x42fbc0];return _0x306116;},a540_0xb53b(_0x792e65,_0x1e5640);}exports['TestSMTPConnection']=TestSMTPConnection,exports['default']=exports['SendMail'];