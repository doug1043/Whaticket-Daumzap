'use strict';const a459_0x30b685=a459_0x497a;function a459_0x3ea6(){const _0x1b06ee=['toString','apply','__esModule','6EyiIil','smtpauth','__importStar','(((.+)+)+)+$','Erro\x20ao\x20enviar\x20e-mail:','493457ItzsrG','__importDefault','prototype','smtpport','E-mail\x20agendado\x20e\x20salvo\x20com\x20sucesso','getOwnPropertyDescriptor','1341812fXlJDV','12IyGzRL','__setModuleDefault','call','hasOwnProperty','E-mail\x20enviado\x20imediatamente','YYYY-MM-DDTHH:mm','getOwnPropertyNames','configurable','value','7202951qezAOr','length','get','defineProperty','Erro\x20ao\x20enviar\x20e-mail:\x20','format','nodemailer','hour','constructor','search','1876810hqAqcZ','message','writable','createTransport','10836CINBMI','sendMail','error','3jKYnJJ','Erro\x20ao\x20agendar\x20e-mail:\x20','3322504TmjiaQ','add','../../models/Setting','Erro\x20ao\x20agendar\x20e-mail:','6560cobtjw','schedule','usersmtpauth','SendMail','14663CpFfhC','default','findOne','20652pPXsSo','create'];a459_0x3ea6=function(){return _0x1b06ee;};return a459_0x3ea6();}(function(_0x619d10,_0x20f5f7){const _0x73b216=a459_0x497a,_0x538161=_0x619d10();while(!![]){try{const _0x55fb1d=parseInt(_0x73b216(0x1e5))/0x1*(parseInt(_0x73b216(0x1e0))/0x2)+-parseInt(_0x73b216(0x206))/0x3*(-parseInt(_0x73b216(0x1eb))/0x4)+parseInt(_0x73b216(0x1ff))/0x5*(parseInt(_0x73b216(0x1ec))/0x6)+parseInt(_0x73b216(0x1f5))/0x7+parseInt(_0x73b216(0x208))/0x8+parseInt(_0x73b216(0x203))/0x9*(-parseInt(_0x73b216(0x20c))/0xa)+parseInt(_0x73b216(0x210))/0xb*(-parseInt(_0x73b216(0x213))/0xc);if(_0x55fb1d===_0x20f5f7)break;else _0x538161['push'](_0x538161['shift']());}catch(_0x50bf30){_0x538161['push'](_0x538161['shift']());}}}(a459_0x3ea6,0xe24d9));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x56506a,_0x356887,_0x4a5669,_0x4513c6){const _0x5ec8ef=a459_0x497a;if(_0x4513c6===undefined)_0x4513c6=_0x4a5669;var _0x24951b=Object[_0x5ec8ef(0x1ea)](_0x356887,_0x4a5669);(!_0x24951b||(_0x5ec8ef(0x1f7)in _0x24951b?!_0x356887['__esModule']:_0x24951b[_0x5ec8ef(0x201)]||_0x24951b[_0x5ec8ef(0x1f3)]))&&(_0x24951b={'enumerable':!![],'get':function(){return _0x356887[_0x4a5669];}}),Object[_0x5ec8ef(0x1f8)](_0x56506a,_0x4513c6,_0x24951b);}:function(_0x43e239,_0x442fd3,_0x41da0d,_0x13bbfb){if(_0x13bbfb===undefined)_0x13bbfb=_0x41da0d;_0x43e239[_0x13bbfb]=_0x442fd3[_0x41da0d];}),__setModuleDefault=this&&this[a459_0x30b685(0x1ed)]||(Object[a459_0x30b685(0x214)]?function(_0x1c52d3,_0x5d0788){const _0xde48cd=a459_0x30b685;Object[_0xde48cd(0x1f8)](_0x1c52d3,_0xde48cd(0x211),{'enumerable':!![],'value':_0x5d0788});}:function(_0x434803,_0x490afd){const _0x2a638f=a459_0x30b685;_0x434803[_0x2a638f(0x211)]=_0x490afd;}),__importStar=this&&this[a459_0x30b685(0x1e2)]||(function(){const _0x280059=(function(){let _0x31f25f=!![];return function(_0x12b7dc,_0x4ec3e5){const _0x5c16d4=_0x31f25f?function(){const _0x8557c1=a459_0x497a;if(_0x4ec3e5){const _0x1d4bcc=_0x4ec3e5[_0x8557c1(0x1de)](_0x12b7dc,arguments);return _0x4ec3e5=null,_0x1d4bcc;}}:function(){};return _0x31f25f=![],_0x5c16d4;};}()),_0x494de7=_0x280059(this,function(){const _0x5374ae=a459_0x497a;return _0x494de7[_0x5374ae(0x1dd)]()['search']('(((.+)+)+)+$')[_0x5374ae(0x1dd)]()[_0x5374ae(0x1fd)](_0x494de7)[_0x5374ae(0x1fe)](_0x5374ae(0x1e3));});_0x494de7();var _0xb68dc=function(_0x11d94b){const _0xc21b4b=a459_0x497a;return _0xb68dc=Object[_0xc21b4b(0x1f2)]||function(_0x3ae106){const _0x5f4ab8=_0xc21b4b;var _0x5c38db=[];for(var _0x448a85 in _0x3ae106)if(Object[_0x5f4ab8(0x1e7)][_0x5f4ab8(0x1ef)][_0x5f4ab8(0x1ee)](_0x3ae106,_0x448a85))_0x5c38db[_0x5c38db[_0x5f4ab8(0x1f6)]]=_0x448a85;return _0x5c38db;},_0xb68dc(_0x11d94b);};return function(_0x2a03ec){const _0x5b3ea2=a459_0x497a;if(_0x2a03ec&&_0x2a03ec[_0x5b3ea2(0x1df)])return _0x2a03ec;var _0xc27a14={};if(_0x2a03ec!=null){for(var _0x1c977d=_0xb68dc(_0x2a03ec),_0x2a4d71=0x0;_0x2a4d71<_0x1c977d[_0x5b3ea2(0x1f6)];_0x2a4d71++)if(_0x1c977d[_0x2a4d71]!==_0x5b3ea2(0x211))__createBinding(_0xc27a14,_0x2a03ec,_0x1c977d[_0x2a4d71]);}return __setModuleDefault(_0xc27a14,_0x2a03ec),_0xc27a14;};}()),__importDefault=this&&this[a459_0x30b685(0x1e6)]||function(_0x52eb77){const _0x481207=a459_0x30b685;return _0x52eb77&&_0x52eb77[_0x481207(0x1df)]?_0x52eb77:{'default':_0x52eb77};};function a459_0x497a(_0x5aaedd,_0xb12c0a){const _0x212bcc=a459_0x3ea6();return a459_0x497a=function(_0x1c27d9,_0x58e1aa){_0x1c27d9=_0x1c27d9-0x1dd;let _0x3ea683=_0x212bcc[_0x1c27d9];return _0x3ea683;},a459_0x497a(_0x5aaedd,_0xb12c0a);}Object[a459_0x30b685(0x1f8)](exports,a459_0x30b685(0x1df),{'value':!![]}),exports['SendMail']=void 0x0;const nodemailer_1=__importDefault(require(a459_0x30b685(0x1fb))),Setting_1=__importDefault(require(a459_0x30b685(0x20a))),Email_1=__importDefault(require('../../models/Email')),cron=__importStar(require('node-cron')),moment_1=__importDefault(require('moment')),SendMail=async(_0x37ab19,_0x21a7b6,_0x3f7441,_0xa0bbf,_0x13541c,_0x78b10,_0x5b2870)=>{const _0xcca53=a459_0x30b685;try{const _0x2caaca=await Setting_1[_0xcca53(0x211)][_0xcca53(0x212)]({'where':{'companyId':_0x37ab19,'key':_0xcca53(0x1e1)}}),_0xe2872e=await Setting_1[_0xcca53(0x211)][_0xcca53(0x212)]({'where':{'companyId':_0x37ab19,'key':_0xcca53(0x20e)}}),_0x1b35dd=await Setting_1[_0xcca53(0x211)][_0xcca53(0x212)]({'where':{'companyId':_0x37ab19,'key':'clientsecretsmtpauth'}}),_0x308e45=await Setting_1[_0xcca53(0x211)][_0xcca53(0x212)]({'where':{'companyId':_0x37ab19,'key':_0xcca53(0x1e8)}}),_0x65400b=_0x2caaca[_0xcca53(0x1f4)],_0x35f037=_0xe2872e['value'],_0xbf2f74=_0x1b35dd[_0xcca53(0x1f4)],_0x4e5ccf=_0x308e45[_0xcca53(0x1f4)],_0x4fb2de=nodemailer_1[_0xcca53(0x211)][_0xcca53(0x202)]({'host':_0x65400b,'port':Number(_0x4e5ccf),'secure':![],'auth':{'user':_0x35f037,'pass':_0xbf2f74}});async function _0x4f5bda(_0x29d087){const _0x11efcb=_0xcca53;try{const _0x5ded8a={'from':_0x35f037,'to':_0x21a7b6,'subject':_0xa0bbf,'text':_0x13541c};return await _0x4fb2de[_0x11efcb(0x204)](_0x5ded8a),await Email_1[_0x11efcb(0x211)][_0x11efcb(0x214)]({'sender':_0x21a7b6,'subject':_0xa0bbf,'message':_0x13541c,'companyId':_0x37ab19}),{'message':_0x11efcb(0x1e9)};}catch(_0x25d576){console[_0x11efcb(0x205)](_0x11efcb(0x1e4),_0x25d576);throw new Error(_0x11efcb(0x1f9)+_0x25d576);}}if(_0x5b2870)return cron[_0xcca53(0x20d)](_0x5b2870,()=>{const _0x355253=_0xcca53,_0x4d1c6e=(0x0,moment_1[_0x355253(0x211)])()[_0x355253(0x209)](0x1,'hour')[_0x355253(0x1fa)](_0x355253(0x1f1));_0x4f5bda(_0x4d1c6e);}),{'message':'Agendamento\x20de\x20e-mail\x20realizado\x20com\x20sucesso'};else{const _0x45693e=(0x0,moment_1[_0xcca53(0x211)])()[_0xcca53(0x209)](0x1,_0xcca53(0x1fc))[_0xcca53(0x1fa)](_0xcca53(0x1f1));return _0x4f5bda(_0x45693e),{'message':_0xcca53(0x1f0)};}}catch(_0x52a14e){return console[_0xcca53(0x205)](_0xcca53(0x20b),_0x52a14e),{'error':_0xcca53(0x207)+_0x52a14e[_0xcca53(0x200)]};}};exports[a459_0x30b685(0x20f)]=SendMail,exports[a459_0x30b685(0x211)]=exports[a459_0x30b685(0x20f)];