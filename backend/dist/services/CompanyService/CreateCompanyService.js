'use strict';const a505_0xaa6f45=a505_0x5331;(function(_0x1e8665,_0x5d26c7){const _0x17dfbf=a505_0x5331,_0xc709af=_0x1e8665();while(!![]){try{const _0x5e8193=-parseInt(_0x17dfbf(0x1b7))/0x1*(parseInt(_0x17dfbf(0x1d3))/0x2)+parseInt(_0x17dfbf(0x1d8))/0x3+parseInt(_0x17dfbf(0x1dc))/0x4+parseInt(_0x17dfbf(0x1e7))/0x5*(parseInt(_0x17dfbf(0x1bf))/0x6)+-parseInt(_0x17dfbf(0x1c3))/0x7+-parseInt(_0x17dfbf(0x1ce))/0x8*(parseInt(_0x17dfbf(0x1d9))/0x9)+-parseInt(_0x17dfbf(0x1cc))/0xa;if(_0x5e8193===_0x5d26c7)break;else _0xc709af['push'](_0xc709af['shift']());}catch(_0x1c08c2){_0xc709af['push'](_0xc709af['shift']());}}}(a505_0x325f,0xeb35e));function a505_0x5331(_0x111e2c,_0x1af70e){const _0x4ad629=a505_0x325f();return a505_0x5331=function(_0x1b9852,_0x3a2aaa){_0x1b9852=_0x1b9852-0x1af;let _0x325f33=_0x4ad629[_0x1b9852];return _0x325f33;},a505_0x5331(_0x111e2c,_0x1af70e);}var __createBinding=this&&this[a505_0xaa6f45(0x1c5)]||(Object['create']?function(_0x546599,_0x4dc0a4,_0x5e6191,_0x5e2feb){const _0x5110e3=a505_0xaa6f45;if(_0x5e2feb===undefined)_0x5e2feb=_0x5e6191;var _0x49325b=Object[_0x5110e3(0x1db)](_0x4dc0a4,_0x5e6191);(!_0x49325b||(_0x5110e3(0x1e6)in _0x49325b?!_0x4dc0a4['__esModule']:_0x49325b[_0x5110e3(0x1b0)]||_0x49325b[_0x5110e3(0x1b8)]))&&(_0x49325b={'enumerable':!![],'get':function(){return _0x4dc0a4[_0x5e6191];}}),Object[_0x5110e3(0x1de)](_0x546599,_0x5e2feb,_0x49325b);}:function(_0x1f9bc2,_0x26b7fe,_0x44b214,_0x2903ac){if(_0x2903ac===undefined)_0x2903ac=_0x44b214;_0x1f9bc2[_0x2903ac]=_0x26b7fe[_0x44b214];}),__setModuleDefault=this&&this[a505_0xaa6f45(0x1c9)]||(Object[a505_0xaa6f45(0x1bd)]?function(_0x5287c0,_0x545b39){const _0x5e677f=a505_0xaa6f45;Object[_0x5e677f(0x1de)](_0x5287c0,'default',{'enumerable':!![],'value':_0x545b39});}:function(_0x4ee226,_0x25d3c3){const _0x2ba104=a505_0xaa6f45;_0x4ee226[_0x2ba104(0x1ba)]=_0x25d3c3;}),__importStar=this&&this[a505_0xaa6f45(0x1be)]||(function(){const _0x4e4fc7=(function(){let _0x105e25=!![];return function(_0x1e29c0,_0x55a1bc){const _0x4fce07=_0x105e25?function(){const _0x3deea5=a505_0x5331;if(_0x55a1bc){const _0x231595=_0x55a1bc[_0x3deea5(0x1e3)](_0x1e29c0,arguments);return _0x55a1bc=null,_0x231595;}}:function(){};return _0x105e25=![],_0x4fce07;};}()),_0x47376b=_0x4e4fc7(this,function(){const _0x1e4c98=a505_0x5331;return _0x47376b['toString']()[_0x1e4c98(0x1b6)](_0x1e4c98(0x1c6))[_0x1e4c98(0x1d0)]()[_0x1e4c98(0x1af)](_0x47376b)[_0x1e4c98(0x1b6)](_0x1e4c98(0x1c6));});_0x47376b();var _0x4b8f72=function(_0x182421){return _0x4b8f72=Object['getOwnPropertyNames']||function(_0x3ab9ca){const _0x3987d0=a505_0x5331;var _0x39aebd=[];for(var _0x17452d in _0x3ab9ca)if(Object['prototype']['hasOwnProperty']['call'](_0x3ab9ca,_0x17452d))_0x39aebd[_0x39aebd[_0x3987d0(0x1d5)]]=_0x17452d;return _0x39aebd;},_0x4b8f72(_0x182421);};return function(_0x1a61b0){const _0x114df3=a505_0x5331;if(_0x1a61b0&&_0x1a61b0['__esModule'])return _0x1a61b0;var _0x32693b={};if(_0x1a61b0!=null){for(var _0xb28254=_0x4b8f72(_0x1a61b0),_0x58a7dd=0x0;_0x58a7dd<_0xb28254[_0x114df3(0x1d5)];_0x58a7dd++)if(_0xb28254[_0x58a7dd]!==_0x114df3(0x1ba))__createBinding(_0x32693b,_0x1a61b0,_0xb28254[_0x58a7dd]);}return __setModuleDefault(_0x32693b,_0x1a61b0),_0x32693b;};}()),__importDefault=this&&this[a505_0xaa6f45(0x1e1)]||function(_0x1d6f99){const _0x563247=a505_0xaa6f45;return _0x1d6f99&&_0x1d6f99[_0x563247(0x1b3)]?_0x1d6f99:{'default':_0x1d6f99};};Object[a505_0xaa6f45(0x1de)](exports,'__esModule',{'value':!![]});const Yup=__importStar(require(a505_0xaa6f45(0x1df))),AppError_1=__importDefault(require(a505_0xaa6f45(0x1d4))),Company_1=__importDefault(require('../../models/Company')),User_1=__importDefault(require(a505_0xaa6f45(0x1da))),Setting_1=__importDefault(require(a505_0xaa6f45(0x1bc))),StorageService_1=__importDefault(require(a505_0xaa6f45(0x1d1))),CreateCompanyService=async _0x5a76ae=>{const _0x39e6ff=a505_0xaa6f45,{name:_0x42e98b,phone:_0x5bfe29,email:_0x101d98,status:_0x52306f,planId:_0x331834,password:_0x49bfab,campaignsEnabled:_0x5cd60b,dueDate:_0x57368e,recurrence:_0x2f1159,bucketName:_0x420864}=_0x5a76ae,_0x355faa=Yup[_0x39e6ff(0x1b4)]()[_0x39e6ff(0x1e0)]({'name':Yup[_0x39e6ff(0x1b9)]()[_0x39e6ff(0x1c7)](0x2,_0x39e6ff(0x1b5))[_0x39e6ff(0x1b1)](_0x39e6ff(0x1b5))[_0x39e6ff(0x1d2)](_0x39e6ff(0x1c8),_0x39e6ff(0x1c1),async _0x102667=>{if(_0x102667){const _0xe66218=await Company_1['default']['findOne']({'where':{'name':_0x102667}});return!_0xe66218;}return![];})});try{await _0x355faa[_0x39e6ff(0x1dd)]({'name':_0x42e98b});}catch(_0xcb5578){throw new AppError_1[(_0x39e6ff(0x1ba))](_0xcb5578[_0x39e6ff(0x1cf)]);}const _0x253217=await Company_1[_0x39e6ff(0x1ba)][_0x39e6ff(0x1bd)]({'name':_0x42e98b,'phone':_0x5bfe29,'email':_0x101d98,'status':_0x52306f,'planId':_0x331834,'dueDate':_0x57368e,'recurrence':_0x2f1159,'bucketName':_0x420864?_0x420864[_0x39e6ff(0x1e2)]()['replace'](/[^a-z0-9-]/g,'-'):undefined}),[_0x334128,_0x11daf9]=await User_1['default'][_0x39e6ff(0x1b2)]({'where':{'name':_0x42e98b,'email':_0x101d98},'defaults':{'name':_0x42e98b,'email':_0x101d98,'password':_0x49bfab||'mudar123','profile':_0x39e6ff(0x1d6),'companyId':_0x253217['id']}});!_0x11daf9&&await _0x334128[_0x39e6ff(0x1cb)]({'companyId':_0x253217['id']});await Setting_1['default']['findOrCreate']({'where':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1c0)},'defaults':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1d7),'value':''}}),await Setting_1[_0x39e6ff(0x1ba)][_0x39e6ff(0x1b2)]({'where':{'companyId':_0x253217['id'],'key':''},'defaults':{'companyId':_0x253217['id'],'key':'call','value':_0x39e6ff(0x1cd)}}),await Setting_1['default'][_0x39e6ff(0x1b2)]({'where':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1c2)},'defaults':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1c2),'value':_0x39e6ff(0x1cd)}}),await Setting_1[_0x39e6ff(0x1ba)]['findOrCreate']({'where':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1e4)},'defaults':{'companyId':_0x253217['id'],'key':'sendGreetingAccepted','value':_0x39e6ff(0x1cd)}}),await Setting_1['default']['findOrCreate']({'where':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1e8)},'defaults':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1e8),'value':_0x39e6ff(0x1cd)}}),await Setting_1[_0x39e6ff(0x1ba)][_0x39e6ff(0x1b2)]({'where':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1bb)},'defaults':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1bb),'value':'text'}}),await Setting_1[_0x39e6ff(0x1ba)]['findOrCreate']({'where':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1ca),'value':_0x39e6ff(0x1e5)}});if(_0x5a76ae[_0x39e6ff(0x1c4)]!==undefined){const [_0x27a960,_0x5162b7]=await Setting_1[_0x39e6ff(0x1ba)][_0x39e6ff(0x1b2)]({'where':{'companyId':_0x253217['id'],'key':_0x39e6ff(0x1c4)},'defaults':{'companyId':_0x253217['id'],'key':'campaignsEnabled','value':''+_0x5cd60b}});!_0x5162b7&&await _0x27a960['update']({'value':''+_0x5cd60b});}try{await StorageService_1['default']['createCompanyStorage'](_0x253217['id']);}catch(_0x321f87){console[_0x39e6ff(0x1e9)]('Erro\x20ao\x20criar\x20estrutura\x20de\x20armazenamento:',_0x321f87);}return _0x253217;};function a505_0x325f(){const _0x2d371d=['string','default','chatBotType','../../models/Setting','create','__importStar','6iQCgEE','CheckMsgIsGroup','ERR_COMPANY_NAME_ALREADY_EXISTS','scheduleType','1591695YCvLch','campaignsEnabled','__createBinding','(((.+)+)+)+$','min','Check-unique-name','__setModuleDefault','versionWA','update','2480720OEcGhu','disabled','11208496TPaKbc','message','toString','../StorageService/StorageService','test','3437058TiTsgw','../../errors/AppError','length','admin','enabled','5207025LStqYL','9JUAsqc','../../models/User','getOwnPropertyDescriptor','7466728bIIBCD','validate','defineProperty','yup','shape','__importDefault','toLowerCase','apply','sendGreetingAccepted','2.3000.1020713899','get','4780565UTauYI','sendMsgTransfTicket','error','constructor','writable','required','findOrCreate','__esModule','object','ERR_COMPANY_INVALID_NAME','search','1KHWAEm','configurable'];a505_0x325f=function(){return _0x2d371d;};return a505_0x325f();}exports['default']=CreateCompanyService;