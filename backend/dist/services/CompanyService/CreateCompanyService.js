'use strict';const a504_0x376dc4=a504_0x36f2;(function(_0x527d1f,_0x5340e8){const _0x477255=a504_0x36f2,_0x499d1f=_0x527d1f();while(!![]){try{const _0x27d223=parseInt(_0x477255(0x13a))/0x1*(parseInt(_0x477255(0x142))/0x2)+parseInt(_0x477255(0x139))/0x3*(-parseInt(_0x477255(0x132))/0x4)+parseInt(_0x477255(0x14d))/0x5*(parseInt(_0x477255(0x144))/0x6)+-parseInt(_0x477255(0x160))/0x7*(parseInt(_0x477255(0x155))/0x8)+-parseInt(_0x477255(0x148))/0x9*(-parseInt(_0x477255(0x165))/0xa)+parseInt(_0x477255(0x169))/0xb*(-parseInt(_0x477255(0x16c))/0xc)+parseInt(_0x477255(0x168))/0xd;if(_0x27d223===_0x5340e8)break;else _0x499d1f['push'](_0x499d1f['shift']());}catch(_0x1c3015){_0x499d1f['push'](_0x499d1f['shift']());}}}(a504_0x46f9,0x3390b));function a504_0x46f9(){const _0x2f2d26=['length','4356XDqhMX','required','disabled','message','88119WlqYdR','findOrCreate','__createBinding','(((.+)+)+)+$','__esModule','5VKQZYU','constructor','defineProperty','2.3000.1020713899','ERR_COMPANY_INVALID_NAME','text','enabled','object','24rReMkx','../../errors/AppError','validate','configurable','getOwnPropertyDescriptor','Check-unique-name','sendMsgTransfTicket','sendGreetingAccepted','mudar123','replace','prototype','918967hmUNIE','campaignsEnabled','min','get','create','430JjLUgP','../StorageService/StorageService','../../models/Company','6383962NKkTqE','97702NrmlOU','findOne','writable','264DpmlkG','ERR_COMPANY_NAME_ALREADY_EXISTS','636284EuNdBP','../../models/Setting','CheckMsgIsGroup','yup','search','scheduleType','versionWA','6YfWnAy','2819NUjWeE','default','call','apply','hasOwnProperty','__setModuleDefault','update','__importStar','146LnSHlA'];a504_0x46f9=function(){return _0x2f2d26;};return a504_0x46f9();}var __createBinding=this&&this[a504_0x376dc4(0x14a)]||(Object['create']?function(_0x1ff7b1,_0x275a19,_0x4dc59d,_0x404a06){const _0x37cab7=a504_0x376dc4;if(_0x404a06===undefined)_0x404a06=_0x4dc59d;var _0x352aed=Object[_0x37cab7(0x159)](_0x275a19,_0x4dc59d);(!_0x352aed||(_0x37cab7(0x163)in _0x352aed?!_0x275a19['__esModule']:_0x352aed[_0x37cab7(0x16b)]||_0x352aed[_0x37cab7(0x158)]))&&(_0x352aed={'enumerable':!![],'get':function(){return _0x275a19[_0x4dc59d];}}),Object[_0x37cab7(0x14f)](_0x1ff7b1,_0x404a06,_0x352aed);}:function(_0x4b57d2,_0x4ba6e9,_0x3ea921,_0x1f3e00){if(_0x1f3e00===undefined)_0x1f3e00=_0x3ea921;_0x4b57d2[_0x1f3e00]=_0x4ba6e9[_0x3ea921];}),__setModuleDefault=this&&this[a504_0x376dc4(0x13f)]||(Object[a504_0x376dc4(0x164)]?function(_0x4df776,_0x591fd6){const _0x20d130=a504_0x376dc4;Object[_0x20d130(0x14f)](_0x4df776,_0x20d130(0x13b),{'enumerable':!![],'value':_0x591fd6});}:function(_0x5b2bad,_0x3acbaa){const _0x8eeb8e=a504_0x376dc4;_0x5b2bad[_0x8eeb8e(0x13b)]=_0x3acbaa;}),__importStar=this&&this[a504_0x376dc4(0x141)]||(function(){const _0x1eda79=(function(){let _0x4281b2=!![];return function(_0x3e2fd3,_0x4b6f24){const _0x91d75c=_0x4281b2?function(){const _0x6f924b=a504_0x36f2;if(_0x4b6f24){const _0x55e1c2=_0x4b6f24[_0x6f924b(0x13d)](_0x3e2fd3,arguments);return _0x4b6f24=null,_0x55e1c2;}}:function(){};return _0x4281b2=![],_0x91d75c;};}()),_0x3d0334=_0x1eda79(this,function(){const _0x27251a=a504_0x36f2;return _0x3d0334['toString']()[_0x27251a(0x136)](_0x27251a(0x14b))['toString']()[_0x27251a(0x14e)](_0x3d0334)[_0x27251a(0x136)](_0x27251a(0x14b));});_0x3d0334();var _0x1cc935=function(_0x3b0189){return _0x1cc935=Object['getOwnPropertyNames']||function(_0x201fe3){const _0x1ae610=a504_0x36f2;var _0x926e0f=[];for(var _0x4160ab in _0x201fe3)if(Object[_0x1ae610(0x15f)][_0x1ae610(0x13e)][_0x1ae610(0x13c)](_0x201fe3,_0x4160ab))_0x926e0f[_0x926e0f['length']]=_0x4160ab;return _0x926e0f;},_0x1cc935(_0x3b0189);};return function(_0x272930){const _0x50163c=a504_0x36f2;if(_0x272930&&_0x272930[_0x50163c(0x14c)])return _0x272930;var _0x28cb9e={};if(_0x272930!=null){for(var _0x264a9c=_0x1cc935(_0x272930),_0x366568=0x0;_0x366568<_0x264a9c[_0x50163c(0x143)];_0x366568++)if(_0x264a9c[_0x366568]!=='default')__createBinding(_0x28cb9e,_0x272930,_0x264a9c[_0x366568]);}return __setModuleDefault(_0x28cb9e,_0x272930),_0x28cb9e;};}()),__importDefault=this&&this['__importDefault']||function(_0x213185){const _0x3767b8=a504_0x376dc4;return _0x213185&&_0x213185[_0x3767b8(0x14c)]?_0x213185:{'default':_0x213185};};Object['defineProperty'](exports,a504_0x376dc4(0x14c),{'value':!![]});const Yup=__importStar(require(a504_0x376dc4(0x135))),AppError_1=__importDefault(require(a504_0x376dc4(0x156))),Company_1=__importDefault(require(a504_0x376dc4(0x167))),User_1=__importDefault(require('../../models/User')),Setting_1=__importDefault(require(a504_0x376dc4(0x133))),StorageService_1=__importDefault(require(a504_0x376dc4(0x166))),CreateCompanyService=async _0x1e52d0=>{const _0x3c13ec=a504_0x376dc4,{name:_0x5d315b,phone:_0xde3ff3,email:_0x596a53,status:_0x5d9e49,planId:_0xc3ed35,password:_0xa325d4,campaignsEnabled:_0x29aa96,dueDate:_0x42fb52,recurrence:_0x481114,bucketName:_0x4a1763}=_0x1e52d0,_0x2d85d3=Yup[_0x3c13ec(0x154)]()['shape']({'name':Yup['string']()[_0x3c13ec(0x162)](0x2,'ERR_COMPANY_INVALID_NAME')[_0x3c13ec(0x145)](_0x3c13ec(0x151))['test'](_0x3c13ec(0x15a),_0x3c13ec(0x131),async _0x3c46dc=>{const _0x58ff8a=_0x3c13ec;if(_0x3c46dc){const _0x36d614=await Company_1[_0x58ff8a(0x13b)][_0x58ff8a(0x16a)]({'where':{'name':_0x3c46dc}});return!_0x36d614;}return![];})});try{await _0x2d85d3[_0x3c13ec(0x157)]({'name':_0x5d315b});}catch(_0x2c20d9){throw new AppError_1[(_0x3c13ec(0x13b))](_0x2c20d9[_0x3c13ec(0x147)]);}const _0x371e12=await Company_1[_0x3c13ec(0x13b)]['create']({'name':_0x5d315b,'phone':_0xde3ff3,'email':_0x596a53,'status':_0x5d9e49,'planId':_0xc3ed35,'dueDate':_0x42fb52,'recurrence':_0x481114,'bucketName':_0x4a1763?_0x4a1763['toLowerCase']()[_0x3c13ec(0x15e)](/[^a-z0-9-]/g,'-'):undefined}),[_0x314248,_0x28856a]=await User_1[_0x3c13ec(0x13b)][_0x3c13ec(0x149)]({'where':{'name':_0x5d315b,'email':_0x596a53},'defaults':{'name':_0x5d315b,'email':_0x596a53,'password':_0xa325d4||_0x3c13ec(0x15d),'profile':'admin','companyId':_0x371e12['id']}});!_0x28856a&&await _0x314248[_0x3c13ec(0x140)]({'companyId':_0x371e12['id']});await Setting_1['default'][_0x3c13ec(0x149)]({'where':{'companyId':_0x371e12['id'],'key':_0x3c13ec(0x134)},'defaults':{'companyId':_0x371e12['id'],'key':_0x3c13ec(0x153),'value':''}}),await Setting_1[_0x3c13ec(0x13b)][_0x3c13ec(0x149)]({'where':{'companyId':_0x371e12['id'],'key':''},'defaults':{'companyId':_0x371e12['id'],'key':'call','value':_0x3c13ec(0x146)}}),await Setting_1[_0x3c13ec(0x13b)][_0x3c13ec(0x149)]({'where':{'companyId':_0x371e12['id'],'key':_0x3c13ec(0x137)},'defaults':{'companyId':_0x371e12['id'],'key':_0x3c13ec(0x137),'value':_0x3c13ec(0x146)}}),await Setting_1[_0x3c13ec(0x13b)][_0x3c13ec(0x149)]({'where':{'companyId':_0x371e12['id'],'key':'sendGreetingAccepted'},'defaults':{'companyId':_0x371e12['id'],'key':_0x3c13ec(0x15c),'value':_0x3c13ec(0x146)}}),await Setting_1[_0x3c13ec(0x13b)][_0x3c13ec(0x149)]({'where':{'companyId':_0x371e12['id'],'key':_0x3c13ec(0x15b)},'defaults':{'companyId':_0x371e12['id'],'key':_0x3c13ec(0x15b),'value':_0x3c13ec(0x146)}}),await Setting_1[_0x3c13ec(0x13b)]['findOrCreate']({'where':{'companyId':_0x371e12['id'],'key':'chatBotType'},'defaults':{'companyId':_0x371e12['id'],'key':'chatBotType','value':_0x3c13ec(0x152)}}),await Setting_1[_0x3c13ec(0x13b)]['findOrCreate']({'where':{'companyId':_0x371e12['id'],'key':_0x3c13ec(0x138),'value':_0x3c13ec(0x150)}});if(_0x1e52d0[_0x3c13ec(0x161)]!==undefined){const [_0x7abe7f,_0x26742c]=await Setting_1[_0x3c13ec(0x13b)][_0x3c13ec(0x149)]({'where':{'companyId':_0x371e12['id'],'key':_0x3c13ec(0x161)},'defaults':{'companyId':_0x371e12['id'],'key':'campaignsEnabled','value':''+_0x29aa96}});!_0x26742c&&await _0x7abe7f[_0x3c13ec(0x140)]({'value':''+_0x29aa96});}try{await StorageService_1[_0x3c13ec(0x13b)]['createCompanyStorage'](_0x371e12['id']);}catch(_0x5d28d1){console['error']('Erro\x20ao\x20criar\x20estrutura\x20de\x20armazenamento:',_0x5d28d1);}return _0x371e12;};function a504_0x36f2(_0x29097c,_0x134e5e){const _0x451713=a504_0x46f9();return a504_0x36f2=function(_0xbb33bc,_0x524af2){_0xbb33bc=_0xbb33bc-0x131;let _0x46f928=_0x451713[_0xbb33bc];return _0x46f928;},a504_0x36f2(_0x29097c,_0x134e5e);}exports[a504_0x376dc4(0x13b)]=CreateCompanyService;