'use strict';const a505_0x3e4500=a505_0x15e2;(function(_0xe999b4,_0x37ed9a){const _0xfd41ca=a505_0x15e2,_0x4fafdc=_0xe999b4();while(!![]){try{const _0x19de54=-parseInt(_0xfd41ca(0x181))/0x1+-parseInt(_0xfd41ca(0x17f))/0x2+parseInt(_0xfd41ca(0x191))/0x3*(parseInt(_0xfd41ca(0x170))/0x4)+parseInt(_0xfd41ca(0x171))/0x5+-parseInt(_0xfd41ca(0x17b))/0x6+parseInt(_0xfd41ca(0x173))/0x7*(-parseInt(_0xfd41ca(0x189))/0x8)+-parseInt(_0xfd41ca(0x188))/0x9;if(_0x19de54===_0x37ed9a)break;else _0x4fafdc['push'](_0x4fafdc['shift']());}catch(_0x5095e5){_0x4fafdc['push'](_0x4fafdc['shift']());}}}(a505_0x4691,0x7fd42));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x2db557,_0x105713,_0x1a04b8,_0xc0fb95){const _0x4860c1=a505_0x15e2;if(_0xc0fb95===undefined)_0xc0fb95=_0x1a04b8;var _0x54ca22=Object[_0x4860c1(0x176)](_0x105713,_0x1a04b8);(!_0x54ca22||(_0x4860c1(0x16f)in _0x54ca22?!_0x105713[_0x4860c1(0x19e)]:_0x54ca22[_0x4860c1(0x196)]||_0x54ca22[_0x4860c1(0x18e)]))&&(_0x54ca22={'enumerable':!![],'get':function(){return _0x105713[_0x1a04b8];}}),Object[_0x4860c1(0x18f)](_0x2db557,_0xc0fb95,_0x54ca22);}:function(_0x1fb63a,_0x2b95e8,_0x1aa298,_0x1981f1){if(_0x1981f1===undefined)_0x1981f1=_0x1aa298;_0x1fb63a[_0x1981f1]=_0x2b95e8[_0x1aa298];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a505_0x3e4500(0x174)]?function(_0x2fd39f,_0x50d3a5){const _0x2858d7=a505_0x3e4500;Object[_0x2858d7(0x18f)](_0x2fd39f,_0x2858d7(0x19c),{'enumerable':!![],'value':_0x50d3a5});}:function(_0x32668c,_0x38f65){const _0x280632=a505_0x3e4500;_0x32668c[_0x280632(0x19c)]=_0x38f65;}),__importStar=this&&this[a505_0x3e4500(0x1a5)]||(function(){const _0x105f6b=(function(){let _0x141bf5=!![];return function(_0x5f4094,_0x3392c7){const _0x22f750=_0x141bf5?function(){const _0x6a7dfb=a505_0x15e2;if(_0x3392c7){const _0x2e76d0=_0x3392c7[_0x6a7dfb(0x193)](_0x5f4094,arguments);return _0x3392c7=null,_0x2e76d0;}}:function(){};return _0x141bf5=![],_0x22f750;};}()),_0x41b096=_0x105f6b(this,function(){const _0x13eb69=a505_0x15e2;return _0x41b096['toString']()['search']('(((.+)+)+)+$')[_0x13eb69(0x1a3)]()[_0x13eb69(0x19b)](_0x41b096)[_0x13eb69(0x19f)](_0x13eb69(0x194));});_0x41b096();var _0x55e93c=function(_0x3cd93a){const _0x48260b=a505_0x15e2;return _0x55e93c=Object[_0x48260b(0x17e)]||function(_0x395a45){const _0x5d5eb1=_0x48260b;var _0x3de3ed=[];for(var _0x3a9ce9 in _0x395a45)if(Object[_0x5d5eb1(0x1a2)]['hasOwnProperty'][_0x5d5eb1(0x182)](_0x395a45,_0x3a9ce9))_0x3de3ed[_0x3de3ed['length']]=_0x3a9ce9;return _0x3de3ed;},_0x55e93c(_0x3cd93a);};return function(_0xadc8eb){const _0x364f31=a505_0x15e2;if(_0xadc8eb&&_0xadc8eb['__esModule'])return _0xadc8eb;var _0x5998dc={};if(_0xadc8eb!=null){for(var _0x4a44f1=_0x55e93c(_0xadc8eb),_0x5ef6c0=0x0;_0x5ef6c0<_0x4a44f1[_0x364f31(0x18c)];_0x5ef6c0++)if(_0x4a44f1[_0x5ef6c0]!=='default')__createBinding(_0x5998dc,_0xadc8eb,_0x4a44f1[_0x5ef6c0]);}return __setModuleDefault(_0x5998dc,_0xadc8eb),_0x5998dc;};}()),__importDefault=this&&this[a505_0x3e4500(0x172)]||function(_0x442ca6){const _0x1c1d50=a505_0x3e4500;return _0x442ca6&&_0x442ca6[_0x1c1d50(0x19e)]?_0x442ca6:{'default':_0x442ca6};};function a505_0x15e2(_0x346349,_0x46f9bb){const _0x4cca05=a505_0x4691();return a505_0x15e2=function(_0x41089a,_0x56c6af){_0x41089a=_0x41089a-0x16d;let _0x46915d=_0x4cca05[_0x41089a];return _0x46915d;},a505_0x15e2(_0x346349,_0x46f9bb);}function a505_0x4691(){const _0x3f14d6=['__importDefault','49tNthKs','create','sendGreetingAccepted','getOwnPropertyDescriptor','mudar123','2.3000.1020713899','findOne','message','1243710AzJwxI','error','../StorageService/StorageService','getOwnPropertyNames','1053102pRvLqx','findOrCreate','18488kMREdY','call','Erro\x20ao\x20criar\x20estrutura\x20de\x20armazenamento:','update','campaignsEnabled','sendMsgTransfTicket','ERR_COMPANY_INVALID_NAME','389772PssvHf','9216pFnyHy','validate','../../models/Company','length','createCompanyStorage','configurable','defineProperty','enabled','1326783MWPnQM','Check-unique-name','apply','(((.+)+)+)+$','admin','writable','toLowerCase','../../models/User','object','disabled','constructor','default','min','__esModule','search','replace','test','prototype','toString','../../errors/AppError','__importStar','text','shape','scheduleType','get','4afEoKz','4425105bCbGhh'];a505_0x4691=function(){return _0x3f14d6;};return a505_0x4691();}Object[a505_0x3e4500(0x18f)](exports,a505_0x3e4500(0x19e),{'value':!![]});const Yup=__importStar(require('yup')),AppError_1=__importDefault(require(a505_0x3e4500(0x1a4))),Company_1=__importDefault(require(a505_0x3e4500(0x18b))),User_1=__importDefault(require(a505_0x3e4500(0x198))),Setting_1=__importDefault(require('../../models/Setting')),StorageService_1=__importDefault(require(a505_0x3e4500(0x17d))),CreateCompanyService=async _0x2f4f13=>{const _0x13c101=a505_0x3e4500,{name:_0x5d132f,phone:_0x21ae85,email:_0x492389,status:_0x45ec01,planId:_0x48a01b,password:_0x2255b1,campaignsEnabled:_0x3ca198,dueDate:_0x34bd44,recurrence:_0x47f81b,bucketName:_0x112f9e}=_0x2f4f13,_0x2a7bea=Yup[_0x13c101(0x199)]()[_0x13c101(0x16d)]({'name':Yup['string']()[_0x13c101(0x19d)](0x2,_0x13c101(0x187))['required']('ERR_COMPANY_INVALID_NAME')[_0x13c101(0x1a1)](_0x13c101(0x192),'ERR_COMPANY_NAME_ALREADY_EXISTS',async _0x165ec7=>{const _0x549083=_0x13c101;if(_0x165ec7){const _0x42bc15=await Company_1[_0x549083(0x19c)][_0x549083(0x179)]({'where':{'name':_0x165ec7}});return!_0x42bc15;}return![];})});try{await _0x2a7bea[_0x13c101(0x18a)]({'name':_0x5d132f});}catch(_0x51a4b1){throw new AppError_1[(_0x13c101(0x19c))](_0x51a4b1[_0x13c101(0x17a)]);}const _0x46bf10=await Company_1[_0x13c101(0x19c)][_0x13c101(0x174)]({'name':_0x5d132f,'phone':_0x21ae85,'email':_0x492389,'status':_0x45ec01,'planId':_0x48a01b,'dueDate':_0x34bd44,'recurrence':_0x47f81b,'bucketName':_0x112f9e?_0x112f9e[_0x13c101(0x197)]()[_0x13c101(0x1a0)](/[^a-z0-9-]/g,'-'):undefined}),[_0x5ed67b,_0x345fbc]=await User_1['default'][_0x13c101(0x180)]({'where':{'name':_0x5d132f,'email':_0x492389},'defaults':{'name':_0x5d132f,'email':_0x492389,'password':_0x2255b1||_0x13c101(0x177),'profile':_0x13c101(0x195),'companyId':_0x46bf10['id']}});!_0x345fbc&&await _0x5ed67b[_0x13c101(0x184)]({'companyId':_0x46bf10['id']});await Setting_1[_0x13c101(0x19c)][_0x13c101(0x180)]({'where':{'companyId':_0x46bf10['id'],'key':'CheckMsgIsGroup'},'defaults':{'companyId':_0x46bf10['id'],'key':_0x13c101(0x190),'value':''}}),await Setting_1[_0x13c101(0x19c)]['findOrCreate']({'where':{'companyId':_0x46bf10['id'],'key':''},'defaults':{'companyId':_0x46bf10['id'],'key':_0x13c101(0x182),'value':_0x13c101(0x19a)}}),await Setting_1[_0x13c101(0x19c)][_0x13c101(0x180)]({'where':{'companyId':_0x46bf10['id'],'key':_0x13c101(0x16e)},'defaults':{'companyId':_0x46bf10['id'],'key':'scheduleType','value':'disabled'}}),await Setting_1[_0x13c101(0x19c)][_0x13c101(0x180)]({'where':{'companyId':_0x46bf10['id'],'key':_0x13c101(0x175)},'defaults':{'companyId':_0x46bf10['id'],'key':_0x13c101(0x175),'value':_0x13c101(0x19a)}}),await Setting_1['default']['findOrCreate']({'where':{'companyId':_0x46bf10['id'],'key':'sendMsgTransfTicket'},'defaults':{'companyId':_0x46bf10['id'],'key':_0x13c101(0x186),'value':_0x13c101(0x19a)}}),await Setting_1[_0x13c101(0x19c)][_0x13c101(0x180)]({'where':{'companyId':_0x46bf10['id'],'key':'chatBotType'},'defaults':{'companyId':_0x46bf10['id'],'key':'chatBotType','value':_0x13c101(0x1a6)}}),await Setting_1[_0x13c101(0x19c)][_0x13c101(0x180)]({'where':{'companyId':_0x46bf10['id'],'key':'versionWA','value':_0x13c101(0x178)}});if(_0x2f4f13['campaignsEnabled']!==undefined){const [_0x346555,_0xa93dcf]=await Setting_1['default'][_0x13c101(0x180)]({'where':{'companyId':_0x46bf10['id'],'key':_0x13c101(0x185)},'defaults':{'companyId':_0x46bf10['id'],'key':_0x13c101(0x185),'value':''+_0x3ca198}});!_0xa93dcf&&await _0x346555[_0x13c101(0x184)]({'value':''+_0x3ca198});}try{await StorageService_1['default'][_0x13c101(0x18d)](_0x46bf10['id']);}catch(_0x3c55b1){console[_0x13c101(0x17c)](_0x13c101(0x183),_0x3c55b1);}return _0x46bf10;};exports[a505_0x3e4500(0x19c)]=CreateCompanyService;