const a376_0x496653=a376_0x1ef6;(function(_0x418ca8,_0x358a3b){const _0x16232a=a376_0x1ef6,_0x38e03c=_0x418ca8();while(!![]){try{const _0x37fd81=parseInt(_0x16232a(0x9e))/0x1*(parseInt(_0x16232a(0xb9))/0x2)+parseInt(_0x16232a(0x9c))/0x3*(-parseInt(_0x16232a(0xb5))/0x4)+-parseInt(_0x16232a(0xa8))/0x5*(parseInt(_0x16232a(0xa6))/0x6)+parseInt(_0x16232a(0xb3))/0x7*(parseInt(_0x16232a(0xb4))/0x8)+-parseInt(_0x16232a(0xb6))/0x9*(-parseInt(_0x16232a(0x9d))/0xa)+-parseInt(_0x16232a(0xb0))/0xb+parseInt(_0x16232a(0xaf))/0xc;if(_0x37fd81===_0x358a3b)break;else _0x38e03c['push'](_0x38e03c['shift']());}catch(_0x4bd277){_0x38e03c['push'](_0x38e03c['shift']());}}}(a376_0x1152,0x837f0));const a376_0xb492cb=(function(){let _0x8b5edb=!![];return function(_0x488c65,_0x3fc262){const _0x59fe9c=_0x8b5edb?function(){const _0x193f2f=a376_0x1ef6;if(_0x3fc262){const _0x1d688b=_0x3fc262[_0x193f2f(0xa2)](_0x488c65,arguments);return _0x3fc262=null,_0x1d688b;}}:function(){};return _0x8b5edb=![],_0x59fe9c;};}()),a376_0x4224cd=a376_0xb492cb(this,function(){const _0x100ec1=a376_0x1ef6;return a376_0x4224cd[_0x100ec1(0x9f)]()[_0x100ec1(0xab)](_0x100ec1(0xb2))[_0x100ec1(0x9f)]()[_0x100ec1(0xa1)](a376_0x4224cd)['search'](_0x100ec1(0xb2));});a376_0x4224cd();'use strict';function a376_0x1152(){const _0x3da3d0=['16385OPqVGV','__esModule','create','search','__importDefault','default','chat','4560672DiJKFR','1966877vFNDzs','findAll','(((.+)+)+)+$','7203SzTefA','5840sVBewa','551844EBGEcV','45fVwBZw','users','../../models/ChatMessage','215484nnJDwm','../../models/User','15XRTgcx','1050890NTKoOZ','1SrndDf','toString','findByPk','constructor','apply','defineProperty','name','../../models/Chat','654HXwQci','sender'];a376_0x1152=function(){return _0x3da3d0;};return a376_0x1152();}var __importDefault=this&&this[a376_0x496653(0xac)]||function(_0xdef0f6){const _0x582305=a376_0x496653;return _0xdef0f6&&_0xdef0f6[_0x582305(0xa9)]?_0xdef0f6:{'default':_0xdef0f6};};Object[a376_0x496653(0xa3)](exports,a376_0x496653(0xa9),{'value':!![]});const Chat_1=__importDefault(require(a376_0x496653(0xa5))),ChatMessage_1=__importDefault(require(a376_0x496653(0xb8))),ChatUser_1=__importDefault(require('../../models/ChatUser')),User_1=__importDefault(require(a376_0x496653(0xba)));function a376_0x1ef6(_0x40c53e,_0x53d7ef){const _0x702394=a376_0x1152();return a376_0x1ef6=function(_0x4224cd,_0xb492cb){_0x4224cd=_0x4224cd-0x9c;let _0x115238=_0x702394[_0x4224cd];return _0x115238;},a376_0x1ef6(_0x40c53e,_0x53d7ef);}async function CreateMessageService({senderId:_0x26bc3a,chatId:_0x3263e0,message:_0x11e722}){const _0x31af7c=a376_0x496653,_0x3d0102=await ChatMessage_1['default'][_0x31af7c(0xaa)]({'senderId':_0x26bc3a,'chatId':_0x3263e0,'message':_0x11e722});await _0x3d0102['reload']({'include':[{'model':User_1['default'],'as':_0x31af7c(0xa7),'attributes':['id',_0x31af7c(0xa4)]},{'model':Chat_1['default'],'as':_0x31af7c(0xae),'include':[{'model':ChatUser_1[_0x31af7c(0xad)],'as':_0x31af7c(0xb7)}]}]});const _0x2f4550=await User_1[_0x31af7c(0xad)][_0x31af7c(0xa0)](_0x26bc3a);await _0x3d0102[_0x31af7c(0xae)]['update']({'lastMessage':_0x2f4550[_0x31af7c(0xa4)]+':\x20'+_0x11e722});const _0x1643d9=await ChatUser_1[_0x31af7c(0xad)][_0x31af7c(0xb1)]({'where':{'chatId':_0x3263e0}});for(let _0x270c2c of _0x1643d9){_0x270c2c['userId']===_0x26bc3a?await _0x270c2c['update']({'unreads':0x0}):await _0x270c2c['update']({'unreads':_0x270c2c['unreads']+0x1});}return _0x3d0102;}exports[a376_0x496653(0xad)]=CreateMessageService;