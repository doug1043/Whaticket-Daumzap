const a493_0x558cfd=a493_0x17e6;(function(_0x811c48,_0x43fd95){const _0x53b7ca=a493_0x17e6,_0x212ccc=_0x811c48();while(!![]){try{const _0x5b6d57=parseInt(_0x53b7ca(0x15d))/0x1*(-parseInt(_0x53b7ca(0x159))/0x2)+parseInt(_0x53b7ca(0x15f))/0x3+parseInt(_0x53b7ca(0x163))/0x4*(parseInt(_0x53b7ca(0x15b))/0x5)+parseInt(_0x53b7ca(0x15c))/0x6*(parseInt(_0x53b7ca(0x16a))/0x7)+parseInt(_0x53b7ca(0x168))/0x8*(parseInt(_0x53b7ca(0x16d))/0x9)+-parseInt(_0x53b7ca(0x171))/0xa*(parseInt(_0x53b7ca(0x167))/0xb)+-parseInt(_0x53b7ca(0x157))/0xc;if(_0x5b6d57===_0x43fd95)break;else _0x212ccc['push'](_0x212ccc['shift']());}catch(_0xc9b9a2){_0x212ccc['push'](_0x212ccc['shift']());}}}(a493_0x32d6,0x3c031));const a493_0x5093ab=(function(){let _0x2ea84e=!![];return function(_0x3c8e0e,_0x54c14a){const _0x1ee357=_0x2ea84e?function(){const _0x2237bb=a493_0x17e6;if(_0x54c14a){const _0x2b344a=_0x54c14a[_0x2237bb(0x170)](_0x3c8e0e,arguments);return _0x54c14a=null,_0x2b344a;}}:function(){};return _0x2ea84e=![],_0x1ee357;};}()),a493_0x19316e=a493_0x5093ab(this,function(){const _0x15438e=a493_0x17e6;return a493_0x19316e[_0x15438e(0x15a)]()[_0x15438e(0x152)](_0x15438e(0x15e))['toString']()['constructor'](a493_0x19316e)[_0x15438e(0x152)]('(((.+)+)+)+$');});function a493_0x17e6(_0x2fb3cd,_0x2b42e5){const _0x100848=a493_0x32d6();return a493_0x17e6=function(_0x19316e,_0x5093ab){_0x19316e=_0x19316e-0x152;let _0x32d667=_0x100848[_0x19316e];return _0x32d667;},a493_0x17e6(_0x2fb3cd,_0x2b42e5);}a493_0x19316e();'use strict';var __importDefault=this&&this[a493_0x558cfd(0x16b)]||function(_0x4f4179){return _0x4f4179&&_0x4f4179['__esModule']?_0x4f4179:{'default':_0x4f4179};};Object[a493_0x558cfd(0x153)](exports,'__esModule',{'value':!![]}),exports[a493_0x558cfd(0x165)]=CreateMessageService;function a493_0x32d6(){const _0x49c515=['184527GhrLNW','../../models/User','findAll','apply','93560hioGJg','search','defineProperty','chat','sender','users','3535608dAiMka','unreads','100IynzEx','toString','5GmluQk','2646vLbPYC','1433vnQOqT','(((.+)+)+)+$','1257822dHZFTG','create','name','../../models/ChatMessage','156916BGzSuX','findByPk','default','update','11tAGaQW','8dVwnLM','userId','2261qWeLhw','__importDefault','text'];a493_0x32d6=function(){return _0x49c515;};return a493_0x32d6();}const Chat_1=__importDefault(require('../../models/Chat')),ChatMessage_1=__importDefault(require(a493_0x558cfd(0x162))),ChatUser_1=__importDefault(require('../../models/ChatUser')),User_1=__importDefault(require(a493_0x558cfd(0x16e)));async function CreateMessageService({senderId:_0xfbefff,chatId:_0x2312a4,message:_0x3a2727,mediaName:_0x341585,mediaPath:_0x4e8135,mediaType:mediaType=a493_0x558cfd(0x16c)}){const _0x584f80=a493_0x558cfd,_0x2f312c=await ChatMessage_1['default'][_0x584f80(0x160)]({'senderId':_0xfbefff,'chatId':_0x2312a4,'message':_0x3a2727,'mediaName':_0x341585,'mediaPath':_0x4e8135,'mediaType':mediaType});await _0x2f312c['reload']({'include':[{'model':User_1[_0x584f80(0x165)],'as':_0x584f80(0x155),'attributes':['id',_0x584f80(0x161)]},{'model':Chat_1[_0x584f80(0x165)],'as':_0x584f80(0x154),'include':[{'model':ChatUser_1[_0x584f80(0x165)],'as':_0x584f80(0x156)}]}]});const _0x2d36d5=await User_1[_0x584f80(0x165)][_0x584f80(0x164)](_0xfbefff);await _0x2f312c[_0x584f80(0x154)]['update']({'lastMessage':_0x2d36d5['name']+':\x20'+(_0x341585!=null?_0x341585:_0x3a2727)});const _0xb43cb1=await ChatUser_1['default'][_0x584f80(0x16f)]({'where':{'chatId':_0x2312a4}});for(let _0x2c5fcf of _0xb43cb1){_0x2c5fcf[_0x584f80(0x169)]===_0xfbefff?await _0x2c5fcf[_0x584f80(0x166)]({'unreads':0x0}):await _0x2c5fcf['update']({'unreads':_0x2c5fcf[_0x584f80(0x158)]+0x1});}return _0x2f312c;}