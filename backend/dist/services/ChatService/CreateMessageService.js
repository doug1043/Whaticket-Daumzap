const a409_0x5a3314=a409_0x2de3;(function(_0x2a9476,_0x37900b){const _0x39fbf9=a409_0x2de3,_0x3a58e1=_0x2a9476();while(!![]){try{const _0x1f5161=parseInt(_0x39fbf9(0xaf))/0x1+parseInt(_0x39fbf9(0xa7))/0x2*(parseInt(_0x39fbf9(0xa4))/0x3)+-parseInt(_0x39fbf9(0xbc))/0x4*(-parseInt(_0x39fbf9(0xb4))/0x5)+parseInt(_0x39fbf9(0xb6))/0x6*(-parseInt(_0x39fbf9(0xb8))/0x7)+-parseInt(_0x39fbf9(0xa0))/0x8+-parseInt(_0x39fbf9(0xa6))/0x9+-parseInt(_0x39fbf9(0x9f))/0xa*(-parseInt(_0x39fbf9(0xb5))/0xb);if(_0x1f5161===_0x37900b)break;else _0x3a58e1['push'](_0x3a58e1['shift']());}catch(_0x569784){_0x3a58e1['push'](_0x3a58e1['shift']());}}}(a409_0x65e8,0xe5c7a));const a409_0x78309b=(function(){let _0x32a38d=!![];return function(_0x3069c0,_0x5bdf42){const _0x41b988=_0x32a38d?function(){const _0x21094a=a409_0x2de3;if(_0x5bdf42){const _0x3a3681=_0x5bdf42[_0x21094a(0xad)](_0x3069c0,arguments);return _0x5bdf42=null,_0x3a3681;}}:function(){};return _0x32a38d=![],_0x41b988;};}()),a409_0x58395f=a409_0x78309b(this,function(){const _0x340cfd=a409_0x2de3;return a409_0x58395f[_0x340cfd(0xa3)]()[_0x340cfd(0xb2)](_0x340cfd(0xbb))[_0x340cfd(0xa3)]()[_0x340cfd(0xb1)](a409_0x58395f)[_0x340cfd(0xb2)](_0x340cfd(0xbb));});function a409_0x2de3(_0x5451e1,_0x1b0c5d){const _0x12b3e0=a409_0x65e8();return a409_0x2de3=function(_0x58395f,_0x78309b){_0x58395f=_0x58395f-0x9f;let _0x65e860=_0x12b3e0[_0x58395f];return _0x65e860;},a409_0x2de3(_0x5451e1,_0x1b0c5d);}a409_0x58395f();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x202f33){return _0x202f33&&_0x202f33['__esModule']?_0x202f33:{'default':_0x202f33};};Object[a409_0x5a3314(0xa2)](exports,a409_0x5a3314(0xa9),{'value':!![]}),exports[a409_0x5a3314(0xae)]=CreateMessageService;function a409_0x65e8(){const _0x5ca66b=['1072390xjXbSp','../../models/Chat','constructor','search','../../models/ChatMessage','4434960LVMXHF','55cFXGAV','4795380fhPUSx','reload','7cERnVy','sender','name','(((.+)+)+)+$','4BtNjvT','create','2170470pvlGya','10763336WaGmfm','findAll','defineProperty','toString','1344XEiMpI','update','431496lehjsE','398KEAnMd','users','__esModule','chat','findByPk','../../models/User','apply','default'];a409_0x65e8=function(){return _0x5ca66b;};return a409_0x65e8();}const Chat_1=__importDefault(require(a409_0x5a3314(0xb0))),ChatMessage_1=__importDefault(require(a409_0x5a3314(0xb3))),ChatUser_1=__importDefault(require('../../models/ChatUser')),User_1=__importDefault(require(a409_0x5a3314(0xac)));async function CreateMessageService({senderId:_0x50e29f,chatId:_0x4e4341,message:_0x41f71f,mediaName:_0x56cb49,mediaPath:_0x4e6c55,mediaType:mediaType='text'}){const _0x412bc8=a409_0x5a3314,_0x567c2a=await ChatMessage_1['default'][_0x412bc8(0xbd)]({'senderId':_0x50e29f,'chatId':_0x4e4341,'message':_0x41f71f,'mediaName':_0x56cb49,'mediaPath':_0x4e6c55,'mediaType':mediaType});await _0x567c2a[_0x412bc8(0xb7)]({'include':[{'model':User_1[_0x412bc8(0xae)],'as':_0x412bc8(0xb9),'attributes':['id',_0x412bc8(0xba)]},{'model':Chat_1[_0x412bc8(0xae)],'as':'chat','include':[{'model':ChatUser_1['default'],'as':_0x412bc8(0xa8)}]}]});const _0x1d89c6=await User_1[_0x412bc8(0xae)][_0x412bc8(0xab)](_0x50e29f);await _0x567c2a[_0x412bc8(0xaa)]['update']({'lastMessage':_0x1d89c6[_0x412bc8(0xba)]+':\x20'+(_0x56cb49!=null?_0x56cb49:_0x41f71f)});const _0x5639b5=await ChatUser_1[_0x412bc8(0xae)][_0x412bc8(0xa1)]({'where':{'chatId':_0x4e4341}});for(let _0x15bfbc of _0x5639b5){_0x15bfbc['userId']===_0x50e29f?await _0x15bfbc[_0x412bc8(0xa5)]({'unreads':0x0}):await _0x15bfbc[_0x412bc8(0xa5)]({'unreads':_0x15bfbc['unreads']+0x1});}return _0x567c2a;}