const a403_0x522b24=a403_0x380c;(function(_0x4634ee,_0x205dcc){const _0x1b9a2a=a403_0x380c,_0x161842=_0x4634ee();while(!![]){try{const _0x484dae=parseInt(_0x1b9a2a(0x17e))/0x1*(parseInt(_0x1b9a2a(0x171))/0x2)+parseInt(_0x1b9a2a(0x16f))/0x3*(parseInt(_0x1b9a2a(0x16a))/0x4)+parseInt(_0x1b9a2a(0x169))/0x5*(-parseInt(_0x1b9a2a(0x17b))/0x6)+-parseInt(_0x1b9a2a(0x17a))/0x7+parseInt(_0x1b9a2a(0x167))/0x8*(-parseInt(_0x1b9a2a(0x175))/0x9)+parseInt(_0x1b9a2a(0x164))/0xa+-parseInt(_0x1b9a2a(0x182))/0xb*(parseInt(_0x1b9a2a(0x177))/0xc);if(_0x484dae===_0x205dcc)break;else _0x161842['push'](_0x161842['shift']());}catch(_0x29727d){_0x161842['push'](_0x161842['shift']());}}}(a403_0x5a07,0x6609e));const a403_0x1a5e2a=(function(){let _0x43389a=!![];return function(_0xd1c2f8,_0x52f432){const _0x2cf197=_0x43389a?function(){const _0x1555e5=a403_0x380c;if(_0x52f432){const _0x271c65=_0x52f432[_0x1555e5(0x176)](_0xd1c2f8,arguments);return _0x52f432=null,_0x271c65;}}:function(){};return _0x43389a=![],_0x2cf197;};}()),a403_0x54283c=a403_0x1a5e2a(this,function(){const _0x1cf8eb=a403_0x380c;return a403_0x54283c[_0x1cf8eb(0x170)]()[_0x1cf8eb(0x17d)](_0x1cf8eb(0x17c))[_0x1cf8eb(0x170)]()[_0x1cf8eb(0x16d)](a403_0x54283c)[_0x1cf8eb(0x17d)]('(((.+)+)+)+$');});a403_0x54283c();'use strict';function a403_0x380c(_0x35e302,_0x4efd73){const _0x426891=a403_0x5a07();return a403_0x380c=function(_0x54283c,_0x1a5e2a){_0x54283c=_0x54283c-0x162;let _0x5a075c=_0x426891[_0x54283c];return _0x5a075c;},a403_0x380c(_0x35e302,_0x4efd73);}var __importDefault=this&&this['__importDefault']||function(_0x4920de){return _0x4920de&&_0x4920de['__esModule']?_0x4920de:{'default':_0x4920de};};function a403_0x5a07(){const _0x22d102=['search','102gTADgT','reload','findAll','chat','396jrJhxz','findByPk','sender','defineProperty','509340SMhDwF','text','name','597504IHAcmo','default','5vwCPcb','419884NhdhRc','../../models/ChatUser','../../models/User','constructor','update','15qPtGLj','toString','9916USFdKX','../../models/ChatMessage','create','../../models/Chat','9dMfBSd','apply','125124kHPCZU','userId','unreads','360052CMydLK','972354BQScep','(((.+)+)+)+$'];a403_0x5a07=function(){return _0x22d102;};return a403_0x5a07();}Object[a403_0x522b24(0x163)](exports,'__esModule',{'value':!![]}),exports['default']=CreateMessageService;const Chat_1=__importDefault(require(a403_0x522b24(0x174))),ChatMessage_1=__importDefault(require(a403_0x522b24(0x172))),ChatUser_1=__importDefault(require(a403_0x522b24(0x16b))),User_1=__importDefault(require(a403_0x522b24(0x16c)));async function CreateMessageService({senderId:_0x141124,chatId:_0xe62ef5,message:_0x5af9f4,mediaName:_0x3a66db,mediaPath:_0x3985e5,mediaType:mediaType=a403_0x522b24(0x165)}){const _0x51367b=a403_0x522b24,_0x57eabb=await ChatMessage_1[_0x51367b(0x168)][_0x51367b(0x173)]({'senderId':_0x141124,'chatId':_0xe62ef5,'message':_0x5af9f4,'mediaName':_0x3a66db,'mediaPath':_0x3985e5,'mediaType':mediaType});await _0x57eabb[_0x51367b(0x17f)]({'include':[{'model':User_1[_0x51367b(0x168)],'as':_0x51367b(0x162),'attributes':['id',_0x51367b(0x166)]},{'model':Chat_1[_0x51367b(0x168)],'as':'chat','include':[{'model':ChatUser_1['default'],'as':'users'}]}]});const _0x28b7fa=await User_1['default'][_0x51367b(0x183)](_0x141124);await _0x57eabb[_0x51367b(0x181)][_0x51367b(0x16e)]({'lastMessage':_0x28b7fa[_0x51367b(0x166)]+':\x20'+(_0x3a66db!=null?_0x3a66db:_0x5af9f4)});const _0x3646ff=await ChatUser_1[_0x51367b(0x168)][_0x51367b(0x180)]({'where':{'chatId':_0xe62ef5}});for(let _0x30d866 of _0x3646ff){_0x30d866[_0x51367b(0x178)]===_0x141124?await _0x30d866[_0x51367b(0x16e)]({'unreads':0x0}):await _0x30d866[_0x51367b(0x16e)]({'unreads':_0x30d866[_0x51367b(0x179)]+0x1});}return _0x57eabb;}