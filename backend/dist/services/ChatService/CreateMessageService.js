const a409_0x32b2e0=a409_0x1e87;(function(_0x29d4d9,_0xc6d7ff){const _0x157e25=a409_0x1e87,_0x3d8533=_0x29d4d9();while(!![]){try{const _0x123602=-parseInt(_0x157e25(0xc2))/0x1*(parseInt(_0x157e25(0xd6))/0x2)+-parseInt(_0x157e25(0xdb))/0x3*(parseInt(_0x157e25(0xbe))/0x4)+parseInt(_0x157e25(0xc9))/0x5+-parseInt(_0x157e25(0xcf))/0x6+parseInt(_0x157e25(0xce))/0x7*(parseInt(_0x157e25(0xc5))/0x8)+parseInt(_0x157e25(0xc1))/0x9+parseInt(_0x157e25(0xc7))/0xa;if(_0x123602===_0xc6d7ff)break;else _0x3d8533['push'](_0x3d8533['shift']());}catch(_0x13aaf8){_0x3d8533['push'](_0x3d8533['shift']());}}}(a409_0x2a7c,0xabd71));const a409_0x466df8=(function(){let _0x26df45=!![];return function(_0x1375bf,_0x30929a){const _0x4c090b=_0x26df45?function(){const _0x49b4a4=a409_0x1e87;if(_0x30929a){const _0x161772=_0x30929a[_0x49b4a4(0xcd)](_0x1375bf,arguments);return _0x30929a=null,_0x161772;}}:function(){};return _0x26df45=![],_0x4c090b;};}()),a409_0x88ebaf=a409_0x466df8(this,function(){const _0x5a2f65=a409_0x1e87;return a409_0x88ebaf[_0x5a2f65(0xd7)]()['search']('(((.+)+)+)+$')[_0x5a2f65(0xd7)]()['constructor'](a409_0x88ebaf)['search'](_0x5a2f65(0xcc));});a409_0x88ebaf();'use strict';function a409_0x1e87(_0x53c0f1,_0xf87b12){const _0xd62527=a409_0x2a7c();return a409_0x1e87=function(_0x88ebaf,_0x466df8){_0x88ebaf=_0x88ebaf-0xbe;let _0x2a7ce8=_0xd62527[_0x88ebaf];return _0x2a7ce8;},a409_0x1e87(_0x53c0f1,_0xf87b12);}function a409_0x2a7c(){const _0x18fc12=['reload','../../models/Chat','55482qePRcE','toString','unreads','name','__esModule','2646591EJojwt','update','4YwUdwH','defineProperty','users','6523785MIDvoI','2kJKSBx','chat','../../models/ChatMessage','8CsKxOo','findAll','6926200mMKEgp','default','331620ZMpRlA','sender','create','(((.+)+)+)+$','apply','4299029cxVKQi','2738520gtifml','../../models/User','../../models/ChatUser','userId','findByPk'];a409_0x2a7c=function(){return _0x18fc12;};return a409_0x2a7c();}var __importDefault=this&&this['__importDefault']||function(_0x5a4a2c){return _0x5a4a2c&&_0x5a4a2c['__esModule']?_0x5a4a2c:{'default':_0x5a4a2c};};Object[a409_0x32b2e0(0xbf)](exports,a409_0x32b2e0(0xda),{'value':!![]}),exports[a409_0x32b2e0(0xc8)]=CreateMessageService;const Chat_1=__importDefault(require(a409_0x32b2e0(0xd5))),ChatMessage_1=__importDefault(require(a409_0x32b2e0(0xc4))),ChatUser_1=__importDefault(require(a409_0x32b2e0(0xd1))),User_1=__importDefault(require(a409_0x32b2e0(0xd0)));async function CreateMessageService({senderId:_0xbfd610,chatId:_0x120a76,message:_0x18151a,mediaName:_0x27b076,mediaPath:_0x366639,mediaType:mediaType='text'}){const _0x3c2003=a409_0x32b2e0,_0x11abb0=await ChatMessage_1['default'][_0x3c2003(0xcb)]({'senderId':_0xbfd610,'chatId':_0x120a76,'message':_0x18151a,'mediaName':_0x27b076,'mediaPath':_0x366639,'mediaType':mediaType});await _0x11abb0[_0x3c2003(0xd4)]({'include':[{'model':User_1[_0x3c2003(0xc8)],'as':_0x3c2003(0xca),'attributes':['id',_0x3c2003(0xd9)]},{'model':Chat_1[_0x3c2003(0xc8)],'as':'chat','include':[{'model':ChatUser_1[_0x3c2003(0xc8)],'as':_0x3c2003(0xc0)}]}]});const _0x16839e=await User_1[_0x3c2003(0xc8)][_0x3c2003(0xd3)](_0xbfd610);await _0x11abb0[_0x3c2003(0xc3)][_0x3c2003(0xdc)]({'lastMessage':_0x16839e[_0x3c2003(0xd9)]+':\x20'+(_0x27b076!=null?_0x27b076:_0x18151a)});const _0x20df7f=await ChatUser_1['default'][_0x3c2003(0xc6)]({'where':{'chatId':_0x120a76}});for(let _0x498c28 of _0x20df7f){_0x498c28[_0x3c2003(0xd2)]===_0xbfd610?await _0x498c28[_0x3c2003(0xdc)]({'unreads':0x0}):await _0x498c28['update']({'unreads':_0x498c28[_0x3c2003(0xd8)]+0x1});}return _0x11abb0;}