const a407_0x2c47a8=a407_0x1fed;(function(_0x242796,_0x2f8e76){const _0x311cee=a407_0x1fed,_0x1ffbc4=_0x242796();while(!![]){try{const _0x308c3d=parseInt(_0x311cee(0x1dc))/0x1*(-parseInt(_0x311cee(0x1d1))/0x2)+-parseInt(_0x311cee(0x1c2))/0x3*(-parseInt(_0x311cee(0x1c7))/0x4)+parseInt(_0x311cee(0x1c6))/0x5*(-parseInt(_0x311cee(0x1cb))/0x6)+parseInt(_0x311cee(0x1d3))/0x7*(-parseInt(_0x311cee(0x1d4))/0x8)+parseInt(_0x311cee(0x1c4))/0x9+parseInt(_0x311cee(0x1d6))/0xa+parseInt(_0x311cee(0x1d7))/0xb*(parseInt(_0x311cee(0x1d5))/0xc);if(_0x308c3d===_0x2f8e76)break;else _0x1ffbc4['push'](_0x1ffbc4['shift']());}catch(_0x282aca){_0x1ffbc4['push'](_0x1ffbc4['shift']());}}}(a407_0x3eab,0x854d9));const a407_0x3d6bd0=(function(){let _0x1ae092=!![];return function(_0x1bc9cc,_0x144bdf){const _0x43ccd3=_0x1ae092?function(){if(_0x144bdf){const _0x4b329d=_0x144bdf['apply'](_0x1bc9cc,arguments);return _0x144bdf=null,_0x4b329d;}}:function(){};return _0x1ae092=![],_0x43ccd3;};}()),a407_0x1b0e55=a407_0x3d6bd0(this,function(){const _0x2d49c3=a407_0x1fed;return a407_0x1b0e55['toString']()['search'](_0x2d49c3(0x1da))['toString']()[_0x2d49c3(0x1d8)](a407_0x1b0e55)[_0x2d49c3(0x1d0)]('(((.+)+)+)+$');});function a407_0x3eab(){const _0x46700f=['1ugvpxd','unreads','create','name','update','3poDlyh','default','5018958RPxoXf','__importDefault','5XDFKfm','2426212YWtgkf','findAll','chat','__esModule','6241518OjsHpM','../../models/ChatUser','userId','sender','text','search','967102NiamiL','../../models/User','475132zKJKRj','104bLQxEz','9888icMQPZ','7604580ZumEKd','13717NRcZyt','constructor','reload','(((.+)+)+)+$','../../models/Chat'];a407_0x3eab=function(){return _0x46700f;};return a407_0x3eab();}a407_0x1b0e55();function a407_0x1fed(_0x4b4a42,_0x1ce488){const _0x28b0ea=a407_0x3eab();return a407_0x1fed=function(_0x1b0e55,_0x3d6bd0){_0x1b0e55=_0x1b0e55-0x1c1;let _0x3eab86=_0x28b0ea[_0x1b0e55];return _0x3eab86;},a407_0x1fed(_0x4b4a42,_0x1ce488);}'use strict';var __importDefault=this&&this[a407_0x2c47a8(0x1c5)]||function(_0x591326){const _0x54cbc8=a407_0x2c47a8;return _0x591326&&_0x591326[_0x54cbc8(0x1ca)]?_0x591326:{'default':_0x591326};};Object['defineProperty'](exports,a407_0x2c47a8(0x1ca),{'value':!![]}),exports[a407_0x2c47a8(0x1c3)]=CreateMessageService;const Chat_1=__importDefault(require(a407_0x2c47a8(0x1db))),ChatMessage_1=__importDefault(require('../../models/ChatMessage')),ChatUser_1=__importDefault(require(a407_0x2c47a8(0x1cc))),User_1=__importDefault(require(a407_0x2c47a8(0x1d2)));async function CreateMessageService({senderId:_0x1d94eb,chatId:_0xbf2bf0,message:_0x14621c,mediaName:_0xe11995,mediaPath:_0x5f6fd4,mediaType:mediaType=a407_0x2c47a8(0x1cf)}){const _0x2e3d35=a407_0x2c47a8,_0x3dc27=await ChatMessage_1['default'][_0x2e3d35(0x1de)]({'senderId':_0x1d94eb,'chatId':_0xbf2bf0,'message':_0x14621c,'mediaName':_0xe11995,'mediaPath':_0x5f6fd4,'mediaType':mediaType});await _0x3dc27[_0x2e3d35(0x1d9)]({'include':[{'model':User_1[_0x2e3d35(0x1c3)],'as':_0x2e3d35(0x1ce),'attributes':['id',_0x2e3d35(0x1df)]},{'model':Chat_1['default'],'as':_0x2e3d35(0x1c9),'include':[{'model':ChatUser_1[_0x2e3d35(0x1c3)],'as':'users'}]}]});const _0x51a961=await User_1[_0x2e3d35(0x1c3)]['findByPk'](_0x1d94eb);await _0x3dc27[_0x2e3d35(0x1c9)][_0x2e3d35(0x1c1)]({'lastMessage':_0x51a961[_0x2e3d35(0x1df)]+':\x20'+(_0xe11995!=null?_0xe11995:_0x14621c)});const _0x442f29=await ChatUser_1[_0x2e3d35(0x1c3)][_0x2e3d35(0x1c8)]({'where':{'chatId':_0xbf2bf0}});for(let _0x3f7661 of _0x442f29){_0x3f7661[_0x2e3d35(0x1cd)]===_0x1d94eb?await _0x3f7661[_0x2e3d35(0x1c1)]({'unreads':0x0}):await _0x3f7661[_0x2e3d35(0x1c1)]({'unreads':_0x3f7661[_0x2e3d35(0x1dd)]+0x1});}return _0x3dc27;}