const a494_0x44b193=a494_0x1dc8;(function(_0x283d39,_0x3e1999){const _0x584d0a=a494_0x1dc8,_0x5c2757=_0x283d39();while(!![]){try{const _0x3d90d7=parseInt(_0x584d0a(0x1ec))/0x1+-parseInt(_0x584d0a(0x1f6))/0x2+parseInt(_0x584d0a(0x1e4))/0x3*(parseInt(_0x584d0a(0x1e0))/0x4)+parseInt(_0x584d0a(0x1ee))/0x5+parseInt(_0x584d0a(0x1e7))/0x6*(parseInt(_0x584d0a(0x1ef))/0x7)+-parseInt(_0x584d0a(0x1e2))/0x8+parseInt(_0x584d0a(0x1f1))/0x9;if(_0x3d90d7===_0x3e1999)break;else _0x5c2757['push'](_0x5c2757['shift']());}catch(_0x2d41f0){_0x5c2757['push'](_0x5c2757['shift']());}}}(a494_0xbe2e,0x6bfe6));const a494_0x552d67=(function(){let _0x58a1f0=!![];return function(_0x401152,_0x3b28fd){const _0x1a728d=_0x58a1f0?function(){const _0x49fd1a=a494_0x1dc8;if(_0x3b28fd){const _0x560efa=_0x3b28fd[_0x49fd1a(0x1f2)](_0x401152,arguments);return _0x3b28fd=null,_0x560efa;}}:function(){};return _0x58a1f0=![],_0x1a728d;};}()),a494_0x5987ac=a494_0x552d67(this,function(){const _0x240ea2=a494_0x1dc8;return a494_0x5987ac[_0x240ea2(0x1f4)]()[_0x240ea2(0x1e1)](_0x240ea2(0x1e3))[_0x240ea2(0x1f4)]()['constructor'](a494_0x5987ac)[_0x240ea2(0x1e1)](_0x240ea2(0x1e3));});function a494_0x1dc8(_0x4be788,_0x406427){const _0x3750d4=a494_0xbe2e();return a494_0x1dc8=function(_0x5987ac,_0x552d67){_0x5987ac=_0x5987ac-0x1db;let _0xbe2ec4=_0x3750d4[_0x5987ac];return _0xbe2ec4;},a494_0x1dc8(_0x4be788,_0x406427);}function a494_0xbe2e(){const _0x415dc9=['../../models/User','1119780kjzeHw','341509DmpffP','findAll','4126032EwUsUb','apply','update','toString','findByPk','663970dHOEkE','chat','../../models/ChatMessage','reload','__importDefault','sender','name','defineProperty','8Lduweb','search','3274600BNAIDo','(((.+)+)+)+$','321654uBJOnJ','users','__esModule','24jFzFFm','unreads','userId','default','../../models/ChatUser','91664WxEpfH'];a494_0xbe2e=function(){return _0x415dc9;};return a494_0xbe2e();}a494_0x5987ac();'use strict';var __importDefault=this&&this[a494_0x44b193(0x1dc)]||function(_0x4689d2){const _0x71c92d=a494_0x44b193;return _0x4689d2&&_0x4689d2[_0x71c92d(0x1e6)]?_0x4689d2:{'default':_0x4689d2};};Object[a494_0x44b193(0x1df)](exports,a494_0x44b193(0x1e6),{'value':!![]}),exports[a494_0x44b193(0x1ea)]=CreateMessageService;const Chat_1=__importDefault(require('../../models/Chat')),ChatMessage_1=__importDefault(require(a494_0x44b193(0x1f8))),ChatUser_1=__importDefault(require(a494_0x44b193(0x1eb))),User_1=__importDefault(require(a494_0x44b193(0x1ed)));async function CreateMessageService({senderId:_0x28ed40,chatId:_0x2f8ed0,message:_0x58d855,mediaName:_0xe66732,mediaPath:_0x96c146,mediaType:mediaType='text'}){const _0x20360e=a494_0x44b193,_0x5b1df4=await ChatMessage_1[_0x20360e(0x1ea)]['create']({'senderId':_0x28ed40,'chatId':_0x2f8ed0,'message':_0x58d855,'mediaName':_0xe66732,'mediaPath':_0x96c146,'mediaType':mediaType});await _0x5b1df4[_0x20360e(0x1db)]({'include':[{'model':User_1[_0x20360e(0x1ea)],'as':_0x20360e(0x1dd),'attributes':['id',_0x20360e(0x1de)]},{'model':Chat_1[_0x20360e(0x1ea)],'as':_0x20360e(0x1f7),'include':[{'model':ChatUser_1[_0x20360e(0x1ea)],'as':_0x20360e(0x1e5)}]}]});const _0x20cc49=await User_1['default'][_0x20360e(0x1f5)](_0x28ed40);await _0x5b1df4['chat']['update']({'lastMessage':_0x20cc49[_0x20360e(0x1de)]+':\x20'+(_0xe66732!=null?_0xe66732:_0x58d855)});const _0x41fe84=await ChatUser_1['default'][_0x20360e(0x1f0)]({'where':{'chatId':_0x2f8ed0}});for(let _0x243c11 of _0x41fe84){_0x243c11[_0x20360e(0x1e9)]===_0x28ed40?await _0x243c11[_0x20360e(0x1f3)]({'unreads':0x0}):await _0x243c11[_0x20360e(0x1f3)]({'unreads':_0x243c11[_0x20360e(0x1e8)]+0x1});}return _0x5b1df4;}