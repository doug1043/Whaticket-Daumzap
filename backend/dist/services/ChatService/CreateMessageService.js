const a374_0x78fbe9=a374_0xc8c3;(function(_0x2bcecb,_0x3bc82e){const _0xc914a8=a374_0xc8c3,_0x58aedb=_0x2bcecb();while(!![]){try{const _0x201d48=parseInt(_0xc914a8(0x17f))/0x1*(parseInt(_0xc914a8(0x178))/0x2)+-parseInt(_0xc914a8(0x169))/0x3+parseInt(_0xc914a8(0x179))/0x4+-parseInt(_0xc914a8(0x17d))/0x5+parseInt(_0xc914a8(0x17a))/0x6*(-parseInt(_0xc914a8(0x16c))/0x7)+parseInt(_0xc914a8(0x176))/0x8+parseInt(_0xc914a8(0x17c))/0x9;if(_0x201d48===_0x3bc82e)break;else _0x58aedb['push'](_0x58aedb['shift']());}catch(_0x154701){_0x58aedb['push'](_0x58aedb['shift']());}}}(a374_0xa932,0x7fa13));const a374_0x52e2d4=(function(){let _0x345ec0=!![];return function(_0x23b108,_0x1e49cc){const _0x3a9e4a=_0x345ec0?function(){const _0x13e506=a374_0xc8c3;if(_0x1e49cc){const _0x1994dc=_0x1e49cc[_0x13e506(0x17b)](_0x23b108,arguments);return _0x1e49cc=null,_0x1994dc;}}:function(){};return _0x345ec0=![],_0x3a9e4a;};}()),a374_0x30a100=a374_0x52e2d4(this,function(){const _0x376439=a374_0xc8c3;return a374_0x30a100[_0x376439(0x170)]()[_0x376439(0x168)](_0x376439(0x182))[_0x376439(0x170)]()['constructor'](a374_0x30a100)[_0x376439(0x168)](_0x376439(0x182));});a374_0x30a100();'use strict';var __importDefault=this&&this[a374_0x78fbe9(0x180)]||function(_0x7ab2f8){const _0x58c141=a374_0x78fbe9;return _0x7ab2f8&&_0x7ab2f8[_0x58c141(0x16b)]?_0x7ab2f8:{'default':_0x7ab2f8};};Object[a374_0x78fbe9(0x181)](exports,a374_0x78fbe9(0x16b),{'value':!![]});const Chat_1=__importDefault(require('../../models/Chat')),ChatMessage_1=__importDefault(require(a374_0x78fbe9(0x177))),ChatUser_1=__importDefault(require(a374_0x78fbe9(0x171))),User_1=__importDefault(require(a374_0x78fbe9(0x183)));function a374_0xc8c3(_0x289de5,_0x5a0e9b){const _0x396ec9=a374_0xa932();return a374_0xc8c3=function(_0x30a100,_0x52e2d4){_0x30a100=_0x30a100-0x166;let _0xa93261=_0x396ec9[_0x30a100];return _0xa93261;},a374_0xc8c3(_0x289de5,_0x5a0e9b);}function a374_0xa932(){const _0x280aa3=['findByPk','sender','toString','../../models/ChatUser','update','unreads','default','userId','195720AfOSpF','../../models/ChatMessage','328638IRyEMn','1908412QbVuqG','6JnZbgS','apply','8300754BpFwEY','1661740OognsR','users','2nVwGBM','__importDefault','defineProperty','(((.+)+)+)+$','../../models/User','chat','findAll','search','1164774pSjDyl','reload','__esModule','3563945lPehtO','name'];a374_0xa932=function(){return _0x280aa3;};return a374_0xa932();}async function CreateMessageService({senderId:_0x4ff3bf,chatId:_0xf151f1,message:_0x2757a3}){const _0xc5bd65=a374_0x78fbe9,_0x160053=await ChatMessage_1[_0xc5bd65(0x174)]['create']({'senderId':_0x4ff3bf,'chatId':_0xf151f1,'message':_0x2757a3});await _0x160053[_0xc5bd65(0x16a)]({'include':[{'model':User_1['default'],'as':_0xc5bd65(0x16f),'attributes':['id',_0xc5bd65(0x16d)]},{'model':Chat_1[_0xc5bd65(0x174)],'as':'chat','include':[{'model':ChatUser_1[_0xc5bd65(0x174)],'as':_0xc5bd65(0x17e)}]}]});const _0x16b70a=await User_1[_0xc5bd65(0x174)][_0xc5bd65(0x16e)](_0x4ff3bf);await _0x160053[_0xc5bd65(0x166)][_0xc5bd65(0x172)]({'lastMessage':_0x16b70a[_0xc5bd65(0x16d)]+':\x20'+_0x2757a3});const _0x2df7c5=await ChatUser_1['default'][_0xc5bd65(0x167)]({'where':{'chatId':_0xf151f1}});for(let _0x177b52 of _0x2df7c5){_0x177b52[_0xc5bd65(0x175)]===_0x4ff3bf?await _0x177b52[_0xc5bd65(0x172)]({'unreads':0x0}):await _0x177b52[_0xc5bd65(0x172)]({'unreads':_0x177b52[_0xc5bd65(0x173)]+0x1});}return _0x160053;}exports['default']=CreateMessageService;