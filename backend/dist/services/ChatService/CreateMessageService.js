function a413_0xd504(){const _0x1c866d=['47pFGeDO','unreads','__importDefault','../../models/ChatUser','reload','682779yLhkrV','707184loEGts','defineProperty','create','(((.+)+)+)+$','findByPk','3681963YBlLYQ','constructor','19956UKrPXi','userId','10stpcro','default','../../models/User','chat','text','update','44ZnrMzQ','2356752TiMEGA','3228vEpJyb','17590cDcBtO','__esModule','apply','1099hwAWIn','910UMgcDn','../../models/Chat','search','toString','sender','findAll','name','users'];a413_0xd504=function(){return _0x1c866d;};return a413_0xd504();}const a413_0x20cf70=a413_0x32d5;function a413_0x32d5(_0x1ce330,_0xbb9c19){const _0xce45cc=a413_0xd504();return a413_0x32d5=function(_0x1bbacb,_0xdeeabb){_0x1bbacb=_0x1bbacb-0xbc;let _0xd50440=_0xce45cc[_0x1bbacb];return _0xd50440;},a413_0x32d5(_0x1ce330,_0xbb9c19);}(function(_0x538145,_0x4a7daf){const _0x367e29=a413_0x32d5,_0x39c4b8=_0x538145();while(!![]){try{const _0xb3cf73=parseInt(_0x367e29(0xc5))/0x1*(parseInt(_0x367e29(0xdd))/0x2)+-parseInt(_0x367e29(0xca))/0x3+-parseInt(_0x367e29(0xdc))/0x4*(-parseInt(_0x367e29(0xbd))/0x5)+-parseInt(_0x367e29(0xd2))/0x6*(parseInt(_0x367e29(0xbc))/0x7)+parseInt(_0x367e29(0xdb))/0x8+-parseInt(_0x367e29(0xd0))/0x9*(-parseInt(_0x367e29(0xd4))/0xa)+parseInt(_0x367e29(0xda))/0xb*(-parseInt(_0x367e29(0xcb))/0xc);if(_0xb3cf73===_0x4a7daf)break;else _0x39c4b8['push'](_0x39c4b8['shift']());}catch(_0x3e2ad4){_0x39c4b8['push'](_0x39c4b8['shift']());}}}(a413_0xd504,0x43fa5));const a413_0xdeeabb=(function(){let _0x28b61d=!![];return function(_0x3066e9,_0xfb3098){const _0x2b87d6=_0x28b61d?function(){const _0x43226d=a413_0x32d5;if(_0xfb3098){const _0x88dbaf=_0xfb3098[_0x43226d(0xdf)](_0x3066e9,arguments);return _0xfb3098=null,_0x88dbaf;}}:function(){};return _0x28b61d=![],_0x2b87d6;};}()),a413_0x1bbacb=a413_0xdeeabb(this,function(){const _0xd819b8=a413_0x32d5;return a413_0x1bbacb[_0xd819b8(0xc0)]()[_0xd819b8(0xbf)](_0xd819b8(0xce))[_0xd819b8(0xc0)]()[_0xd819b8(0xd1)](a413_0x1bbacb)[_0xd819b8(0xbf)](_0xd819b8(0xce));});a413_0x1bbacb();'use strict';var __importDefault=this&&this[a413_0x20cf70(0xc7)]||function(_0x36a863){const _0x418679=a413_0x20cf70;return _0x36a863&&_0x36a863[_0x418679(0xde)]?_0x36a863:{'default':_0x36a863};};Object[a413_0x20cf70(0xcc)](exports,'__esModule',{'value':!![]}),exports[a413_0x20cf70(0xd5)]=CreateMessageService;const Chat_1=__importDefault(require(a413_0x20cf70(0xbe))),ChatMessage_1=__importDefault(require('../../models/ChatMessage')),ChatUser_1=__importDefault(require(a413_0x20cf70(0xc8))),User_1=__importDefault(require(a413_0x20cf70(0xd6)));async function CreateMessageService({senderId:_0x45ea9b,chatId:_0x3c882c,message:_0x4d194d,mediaName:_0x4324b3,mediaPath:_0x4bce30,mediaType:mediaType=a413_0x20cf70(0xd8)}){const _0x35e173=a413_0x20cf70,_0xc1ac18=await ChatMessage_1[_0x35e173(0xd5)][_0x35e173(0xcd)]({'senderId':_0x45ea9b,'chatId':_0x3c882c,'message':_0x4d194d,'mediaName':_0x4324b3,'mediaPath':_0x4bce30,'mediaType':mediaType});await _0xc1ac18[_0x35e173(0xc9)]({'include':[{'model':User_1['default'],'as':_0x35e173(0xc1),'attributes':['id',_0x35e173(0xc3)]},{'model':Chat_1[_0x35e173(0xd5)],'as':_0x35e173(0xd7),'include':[{'model':ChatUser_1[_0x35e173(0xd5)],'as':_0x35e173(0xc4)}]}]});const _0x19b87b=await User_1[_0x35e173(0xd5)][_0x35e173(0xcf)](_0x45ea9b);await _0xc1ac18['chat'][_0x35e173(0xd9)]({'lastMessage':_0x19b87b['name']+':\x20'+(_0x4324b3!=null?_0x4324b3:_0x4d194d)});const _0x348b05=await ChatUser_1[_0x35e173(0xd5)][_0x35e173(0xc2)]({'where':{'chatId':_0x3c882c}});for(let _0x8085da of _0x348b05){_0x8085da[_0x35e173(0xd3)]===_0x45ea9b?await _0x8085da[_0x35e173(0xd9)]({'unreads':0x0}):await _0x8085da['update']({'unreads':_0x8085da[_0x35e173(0xc6)]+0x1});}return _0xc1ac18;}