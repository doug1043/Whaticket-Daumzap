const a414_0x306dee=a414_0x569a;function a414_0x569a(_0x2c0dc9,_0x5d2f19){const _0x2b54e6=a414_0x4746();return a414_0x569a=function(_0x4ff205,_0x48ea64){_0x4ff205=_0x4ff205-0x1be;let _0x4746c3=_0x2b54e6[_0x4ff205];return _0x4746c3;},a414_0x569a(_0x2c0dc9,_0x5d2f19);}(function(_0x27d0ce,_0x1200cc){const _0x34f3a0=a414_0x569a,_0x1be244=_0x27d0ce();while(!![]){try{const _0x13fe72=parseInt(_0x34f3a0(0x1e1))/0x1*(parseInt(_0x34f3a0(0x1c2))/0x2)+-parseInt(_0x34f3a0(0x1e9))/0x3*(parseInt(_0x34f3a0(0x1cc))/0x4)+parseInt(_0x34f3a0(0x1e3))/0x5*(parseInt(_0x34f3a0(0x1e6))/0x6)+parseInt(_0x34f3a0(0x1c5))/0x7*(-parseInt(_0x34f3a0(0x1d7))/0x8)+parseInt(_0x34f3a0(0x1d5))/0x9+-parseInt(_0x34f3a0(0x1c1))/0xa+-parseInt(_0x34f3a0(0x1c7))/0xb*(-parseInt(_0x34f3a0(0x1e4))/0xc);if(_0x13fe72===_0x1200cc)break;else _0x1be244['push'](_0x1be244['shift']());}catch(_0x72bb98){_0x1be244['push'](_0x1be244['shift']());}}}(a414_0x4746,0xde4eb));const a414_0x48ea64=(function(){let _0x322fd4=!![];return function(_0x1441cb,_0x1b416e){const _0x390f1c=_0x322fd4?function(){const _0x61ff61=a414_0x569a;if(_0x1b416e){const _0x44d663=_0x1b416e[_0x61ff61(0x1c8)](_0x1441cb,arguments);return _0x1b416e=null,_0x44d663;}}:function(){};return _0x322fd4=![],_0x390f1c;};}()),a414_0x4ff205=a414_0x48ea64(this,function(){const _0x1c6348=a414_0x569a;return a414_0x4ff205[_0x1c6348(0x1da)]()[_0x1c6348(0x1e0)](_0x1c6348(0x1d4))[_0x1c6348(0x1da)]()[_0x1c6348(0x1e2)](a414_0x4ff205)['search'](_0x1c6348(0x1d4));});a414_0x4ff205();function a414_0x4746(){const _0x27d561=['ceil','getTime','nopicture.png','../../libs/socket','search','39553GrYQHe','constructor','48445AHugin','2172tAWVrJ','__importDefault','12bFsRWk','updatedAt','getIO','5103183fLYxql','endsWith','../../models/Contact','log','env','4514840zXaKsX','4VsslWw','-mainchannel','replace','11104807bHrtGP','__esModule','230879DzVAzD','apply','update','findOne','isNil','4ATmpon','default','profilePicUrl','create','changed','defineProperty','company-','match','(((.+)+)+)+$','6768216yhqmdR','../WbotServices/GetProfilePicUrl','8ZlCmqc','Error\x20getting\x20profile\x20picture:\x20','emit','toString','name'];a414_0x4746=function(){return _0x27d561;};return a414_0x4746();}'use strict';var __importDefault=this&&this[a414_0x306dee(0x1e5)]||function(_0x3da2f0){return _0x3da2f0&&_0x3da2f0['__esModule']?_0x3da2f0:{'default':_0x3da2f0};};Object[a414_0x306dee(0x1d1)](exports,a414_0x306dee(0x1c6),{'value':!![]});const socket_1=require(a414_0x306dee(0x1df)),Contact_1=__importDefault(require(a414_0x306dee(0x1be))),lodash_1=require('lodash'),GetProfilePicUrl_1=__importDefault(require(a414_0x306dee(0x1d6))),CreateOrUpdateContactService=async({name:_0x40939f,number:_0x58822d,remoteJid:_0x94ccba,isGroup:_0x5c0d5b,email:email='',companyId:_0x3fd4a1,extraInfo:extraInfo=[],disableBot:disableBot=![],whatsappId:_0x21db16},_0x5b2218,_0x4a57f9)=>{const _0x25c709=a414_0x306dee,_0x3d34dd=_0x5c0d5b?_0x58822d:_0x58822d[_0x25c709(0x1c4)](/[^0-9]/g,''),_0x11cd4d=(0x0,socket_1[_0x25c709(0x1e8)])();let _0x43dd26;_0x43dd26=await Contact_1[_0x25c709(0x1cd)][_0x25c709(0x1ca)]({'where':{'number':_0x3d34dd,'companyId':_0x3fd4a1}});if(_0x43dd26){if(_0x40939f&&(!_0x43dd26[_0x25c709(0x1db)]||_0x43dd26['name'][_0x25c709(0x1d3)](/^[0-9]*$/))&&!_0x40939f[_0x25c709(0x1d3)](/^[0-9]*$/)){_0x43dd26[_0x25c709(0x1d0)](_0x25c709(0x1db),!![]),_0x43dd26[_0x25c709(0x1d0)]('updatedAt',!![]);let _0x45b6ed;try{_0x45b6ed=await(0x0,GetProfilePicUrl_1[_0x25c709(0x1cd)])(_0x58822d,_0x3fd4a1);}catch(_0x4e4035){console[_0x25c709(0x1bf)]('Error\x20getting\x20profile\x20picture\x202:\x20'+_0x4e4035);}_0x45b6ed?.[_0x25c709(0x1ea)](_0x25c709(0x1de))&&(_0x45b6ed=_0x43dd26[_0x25c709(0x1ce)]),_0x43dd26[_0x25c709(0x1c9)]({'name':_0x40939f,'profilePicUrl':_0x45b6ed});}const _0x14b25c=new Date(_0x43dd26['updatedAt']),_0x1f9d18=new Date(),_0x5cc709=_0x1f9d18[_0x25c709(0x1dd)]()-_0x14b25c[_0x25c709(0x1dd)](),_0x9de0d2=Math[_0x25c709(0x1dc)](_0x5cc709/(0x3e8*0xe10*0x18));if(_0x9de0d2>=0x3){let _0x2930c4;try{_0x2930c4=await(0x0,GetProfilePicUrl_1[_0x25c709(0x1cd)])(_0x58822d,_0x3fd4a1);}catch(_0x2baeb8){console[_0x25c709(0x1bf)](_0x25c709(0x1d8)+_0x2baeb8);}_0x43dd26[_0x25c709(0x1d0)](_0x25c709(0x1e7),!![]),!_0x2930c4?.[_0x25c709(0x1ea)]('nopicture.png')?_0x43dd26[_0x25c709(0x1c9)]({'profilePicUrl':_0x2930c4,'updatedAt':new Date()}):_0x43dd26['update']({'updatedAt':new Date()});}(0x0,lodash_1[_0x25c709(0x1cb)])(_0x43dd26['whatsappId']===null)&&_0x43dd26['update']({'whatsappId':_0x21db16}),_0x11cd4d['to']('company-'+_0x3fd4a1+_0x25c709(0x1c3))[_0x25c709(0x1d9)](_0x25c709(0x1d2)+_0x3fd4a1+'-contact',{'action':_0x25c709(0x1c9),'contact':_0x43dd26});}else{let _0x2f53fc;try{_0x2f53fc=await(0x0,GetProfilePicUrl_1[_0x25c709(0x1cd)])(_0x58822d,_0x3fd4a1);}catch(_0xdf8c96){_0x2f53fc=process[_0x25c709(0x1c0)]['FRONTEND_URL']+'/nopicture.png';}_0x43dd26=await Contact_1[_0x25c709(0x1cd)][_0x25c709(0x1cf)]({'name':_0x40939f,'number':_0x3d34dd,'profilePicUrl':_0x2f53fc,'email':email,'isGroup':_0x5c0d5b,'extraInfo':extraInfo,'companyId':_0x3fd4a1,'disableBot':disableBot,'whatsappId':_0x21db16}),_0x11cd4d['to'](_0x25c709(0x1d2)+_0x3fd4a1+_0x25c709(0x1c3))[_0x25c709(0x1d9)](_0x25c709(0x1d2)+_0x3fd4a1+'-contact',{'action':_0x25c709(0x1cf),'contact':_0x43dd26});}return _0x43dd26;};exports['default']=CreateOrUpdateContactService;