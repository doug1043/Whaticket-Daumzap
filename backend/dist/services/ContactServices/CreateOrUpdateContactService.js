const a531_0x20f33e=a531_0xa1d9;function a531_0x4015(){const _0x53ad80=['now','85616FUvcrz','225mUonnN','push','temp_','340Oisagi',',\x20LID:\x20','replace','ASC','-mainchannel','remoteJid','includes','\x20updated:','-contact','297516MdXYcJ','Desconhecido','constructor','findOne','[CreateOrUpdateContact]\x20Creating\x20new\x20contact\x20-\x20Name:\x20','5915308vVOlpW','startsWith','5459870YqXEBF','emit','keys','__esModule','lid','6906vLpejc','22rAssTk',',\x20lid:\x20','default','createdAt','FRONTEND_URL',',\x20Number:\x20','log','11940nwwnEl','search','Contato\x20','/nopicture.png','...','../../models/Contact','defineProperty','@lid','[CreateOrUpdateContact]\x20Adicionando\x20LID:\x20','getIO','name','length','number','create','apply','[CreateOrUpdateContact]\x20Contact\x20','error','[CreateOrUpdateContact]\x20Unique\x20constraint\x20error\x20-\x20searching\x20existing\x20contact','[CreateOrUpdateContact]\x20Atualizando\x20number\x20para\x20PN\x20real:\x20','__importDefault','44XkHGBM','profilePicUrl','update',',\x20isLidAsNumber:\x20','company-','\x20(number:\x20','whatsapp',')\x20for\x20PN:\x20','Error\x20creating\x20contact:','1136064ZcPOVQ','(((.+)+)+)+$','env'];a531_0x4015=function(){return _0x53ad80;};return a531_0x4015();}(function(_0x1bf62b,_0x18a28b){const _0x3bbfa8=a531_0xa1d9,_0x4e6594=_0x1bf62b();while(!![]){try{const _0x5a3cc4=-parseInt(_0x3bbfa8(0x104))/0x1*(parseInt(_0x3bbfa8(0x103))/0x2)+-parseInt(_0x3bbfa8(0xf7))/0x3+-parseInt(_0x3bbfa8(0x10b))/0x4*(parseInt(_0x3bbfa8(0x130))/0x5)+-parseInt(_0x3bbfa8(0x128))/0x6+-parseInt(_0x3bbfa8(0xfc))/0x7+-parseInt(_0x3bbfa8(0x12c))/0x8*(parseInt(_0x3bbfa8(0x12d))/0x9)+-parseInt(_0x3bbfa8(0xfe))/0xa*(-parseInt(_0x3bbfa8(0x11f))/0xb);if(_0x5a3cc4===_0x18a28b)break;else _0x4e6594['push'](_0x4e6594['shift']());}catch(_0x22e794){_0x4e6594['push'](_0x4e6594['shift']());}}}(a531_0x4015,0x7b054));const a531_0x8efef5=(function(){let _0x49e867=!![];return function(_0x411ea4,_0x7e0f2c){const _0x587db0=_0x49e867?function(){const _0xc10998=a531_0xa1d9;if(_0x7e0f2c){const _0x49ea45=_0x7e0f2c[_0xc10998(0x119)](_0x411ea4,arguments);return _0x7e0f2c=null,_0x49ea45;}}:function(){};return _0x49e867=![],_0x587db0;};}()),a531_0x5d6e9e=a531_0x8efef5(this,function(){const _0x244789=a531_0xa1d9;return a531_0x5d6e9e['toString']()[_0x244789(0x10c)](_0x244789(0x129))['toString']()[_0x244789(0xf9)](a531_0x5d6e9e)[_0x244789(0x10c)]('(((.+)+)+)+$');});a531_0x5d6e9e();'use strict';function a531_0xa1d9(_0x523ae8,_0x36245b){const _0x4374e6=a531_0x4015();return a531_0xa1d9=function(_0x5d6e9e,_0x8efef5){_0x5d6e9e=_0x5d6e9e-0xf2;let _0x40157d=_0x4374e6[_0x5d6e9e];return _0x40157d;},a531_0xa1d9(_0x523ae8,_0x36245b);}var __importDefault=this&&this[a531_0x20f33e(0x11e)]||function(_0x551aa5){const _0xca9eb4=a531_0x20f33e;return _0x551aa5&&_0x551aa5[_0xca9eb4(0x101)]?_0x551aa5:{'default':_0x551aa5};};Object[a531_0x20f33e(0x111)](exports,a531_0x20f33e(0x101),{'value':!![]});const socket_1=require('../../libs/socket'),Contact_1=__importDefault(require(a531_0x20f33e(0x110))),sequelize_1=require('sequelize'),CreateOrUpdateContactService=async({name:_0x575e91,number:_0x394b5c,profilePicUrl:_0x175dee,isGroup:_0x537c3d,email:email='',companyId:_0x4c4bbf,extraInfo:extraInfo=[],channel:channel=a531_0x20f33e(0x125),disableBot:disableBot=![],remoteJid:_0x101088,lid:_0x5161e6})=>{const _0x68fbc=a531_0x20f33e,_0x36dc0f=_0x537c3d?_0x394b5c:_0x394b5c[_0x68fbc(0x132)](/[^0-9]/g,''),_0x53cf07=_0x36dc0f&&(_0x36dc0f[_0x68fbc(0x116)]>=0xe||_0x36dc0f===_0x5161e6),_0x220f15=_0x53cf07?null:_0x36dc0f,_0x4fbd12=_0x5161e6||(_0x53cf07?_0x36dc0f:null),_0x5a2e0f=(0x0,socket_1[_0x68fbc(0x114)])();let _0x50925f;const _0x56b0c7=[];_0x220f15&&_0x56b0c7['push']({'number':_0x220f15,'companyId':_0x4c4bbf});_0x101088&&_0x56b0c7[_0x68fbc(0x12e)]({'remoteJid':_0x101088,'companyId':_0x4c4bbf});_0x4fbd12&&_0x56b0c7['push']({'lid':_0x4fbd12,'companyId':_0x4c4bbf});_0x175dee&&_0x175dee!==process[_0x68fbc(0x12a)]['FRONTEND_URL']+_0x68fbc(0x10e)&&_0x56b0c7[_0x68fbc(0x12e)]({'profilePicUrl':_0x175dee,'companyId':_0x4c4bbf,'isGroup':![]});if(_0x56b0c7[_0x68fbc(0x116)]>0x0){const _0x4d9f09=await Contact_1[_0x68fbc(0x106)][_0x68fbc(0xfa)]({'where':{[sequelize_1['Op']['or']]:_0x56b0c7},'order':[[_0x68fbc(0x107),_0x68fbc(0x133)]]});if(_0x4d9f09){console['log']('[CreateOrUpdateContact]\x20Found\x20existing\x20contact\x20'+_0x4d9f09['id']+_0x68fbc(0x124)+_0x4d9f09['number']+_0x68fbc(0x105)+_0x4d9f09[_0x68fbc(0x102)]+_0x68fbc(0x126)+_0x220f15+_0x68fbc(0x131)+_0x4fbd12);const _0x81cdcd={},_0x44c86d=!_0x4d9f09[_0x68fbc(0x115)]||_0x4d9f09['name'][_0x68fbc(0xfd)](_0x68fbc(0x10d))||_0x4d9f09[_0x68fbc(0x115)]===_0x4d9f09[_0x68fbc(0x117)]||_0x4d9f09['name']===_0x4d9f09['lid'];_0x575e91&&_0x44c86d&&_0x575e91!==_0x4fbd12&&(_0x81cdcd[_0x68fbc(0x115)]=_0x575e91);_0x220f15&&(!_0x4d9f09[_0x68fbc(0x117)]||_0x4d9f09[_0x68fbc(0x117)][_0x68fbc(0x116)]>=0xe)&&(_0x81cdcd['number']=_0x220f15,console[_0x68fbc(0x10a)](_0x68fbc(0x11d)+_0x220f15));_0x4fbd12&&!_0x4d9f09['lid']&&(_0x81cdcd['lid']=_0x4fbd12,console[_0x68fbc(0x10a)](_0x68fbc(0x113)+_0x4fbd12));_0x175dee&&_0x175dee!==process[_0x68fbc(0x12a)]['FRONTEND_URL']+_0x68fbc(0x10e)&&((!_0x4d9f09[_0x68fbc(0x120)]||_0x4d9f09[_0x68fbc(0x120)]===''||_0x4d9f09[_0x68fbc(0x120)]===process[_0x68fbc(0x12a)][_0x68fbc(0x108)]+_0x68fbc(0x10e))&&(_0x81cdcd['profilePicUrl']=_0x175dee));if(_0x101088){const _0x425a4e=_0x4d9f09[_0x68fbc(0xf3)]?.[_0x68fbc(0xf4)](_0x68fbc(0x112)),_0x117868=_0x101088[_0x68fbc(0xf4)](_0x68fbc(0x112));(!_0x4d9f09[_0x68fbc(0xf3)]||_0x425a4e&&!_0x117868)&&(_0x81cdcd['remoteJid']=_0x101088);}return Object[_0x68fbc(0x100)](_0x81cdcd)['length']>0x0&&(await _0x4d9f09['update'](_0x81cdcd),console[_0x68fbc(0x10a)](_0x68fbc(0x11a)+_0x4d9f09['id']+_0x68fbc(0xf5),_0x81cdcd)),_0x5a2e0f['to'](_0x68fbc(0x123)+_0x4c4bbf+_0x68fbc(0xf2))[_0x68fbc(0xff)](_0x68fbc(0x123)+_0x4c4bbf+_0x68fbc(0xf6),{'action':_0x68fbc(0x121),'contact':_0x4d9f09}),_0x4d9f09;}}const _0x3ddbac=_0x220f15||_0x4fbd12||_0x68fbc(0x12f)+Date[_0x68fbc(0x12b)](),_0x3f5d90=_0x575e91&&_0x575e91!==_0x4fbd12?_0x575e91:_0x220f15||_0x68fbc(0x10d)+(_0x4fbd12?.['substring'](0x0,0x8)||_0x68fbc(0xf8))+_0x68fbc(0x10f);console[_0x68fbc(0x10a)](_0x68fbc(0xfb)+_0x3f5d90+_0x68fbc(0x109)+_0x3ddbac+_0x68fbc(0x131)+_0x4fbd12+_0x68fbc(0x122)+(!_0x220f15&&!!_0x4fbd12));try{_0x50925f=await Contact_1[_0x68fbc(0x106)][_0x68fbc(0x118)]({'name':_0x3f5d90,'number':_0x3ddbac,'profilePicUrl':_0x175dee,'email':email,'isGroup':_0x537c3d,'extraInfo':extraInfo,'companyId':_0x4c4bbf,'channel':channel,'disableBot':disableBot,'remoteJid':_0x101088,'lid':_0x4fbd12}),_0x5a2e0f['to'](_0x68fbc(0x123)+_0x4c4bbf+'-mainchannel')[_0x68fbc(0xff)](_0x68fbc(0x123)+_0x4c4bbf+_0x68fbc(0xf6),{'action':_0x68fbc(0x118),'contact':_0x50925f});}catch(_0x22ed62){if(_0x22ed62[_0x68fbc(0x115)]==='SequelizeUniqueConstraintError'){console['log'](_0x68fbc(0x11c));const _0x50d01b=[];if(_0x3ddbac)_0x50d01b[_0x68fbc(0x12e)]({'number':_0x3ddbac,'companyId':_0x4c4bbf});if(_0x4fbd12)_0x50d01b[_0x68fbc(0x12e)]({'lid':_0x4fbd12,'companyId':_0x4c4bbf});_0x50925f=await Contact_1[_0x68fbc(0x106)][_0x68fbc(0xfa)]({'where':{[sequelize_1['Op']['or']]:_0x50d01b}});if(_0x50925f){console[_0x68fbc(0x10a)]('[CreateOrUpdateContact]\x20Found\x20existing\x20contact\x20after\x20constraint\x20error:\x20'+_0x50925f['id']);const _0x113e5f={};if(_0x175dee&&!_0x50925f[_0x68fbc(0x120)])_0x113e5f[_0x68fbc(0x120)]=_0x175dee;if(_0x4fbd12&&!_0x50925f['lid'])_0x113e5f[_0x68fbc(0x102)]=_0x4fbd12;if(_0x220f15&&(!_0x50925f[_0x68fbc(0x117)]||_0x50925f['number']['length']>=0xe))_0x113e5f[_0x68fbc(0x117)]=_0x220f15;Object[_0x68fbc(0x100)](_0x113e5f)[_0x68fbc(0x116)]>0x0&&await _0x50925f[_0x68fbc(0x121)](_0x113e5f),_0x5a2e0f['to'](_0x68fbc(0x123)+_0x4c4bbf+_0x68fbc(0xf2))[_0x68fbc(0xff)]('company-'+_0x4c4bbf+_0x68fbc(0xf6),{'action':'update','contact':_0x50925f});}}else{console[_0x68fbc(0x11b)](_0x68fbc(0x127),_0x22ed62);throw _0x22ed62;}}return _0x50925f;};exports[a531_0x20f33e(0x106)]=CreateOrUpdateContactService;