function a563_0x1e94(_0x37ef75,_0x2b421f){const _0x449f83=a563_0x935a();return a563_0x1e94=function(_0x352f5e,_0x294169){_0x352f5e=_0x352f5e-0x123;let _0x935aa6=_0x449f83[_0x352f5e];return _0x935aa6;},a563_0x1e94(_0x37ef75,_0x2b421f);}const a563_0x156750=a563_0x1e94;function a563_0x935a(){const _0xa59064=['893076vPaeAI','object','connections','ERR_WAPP_GREETING_REQUIRED','default','boolean','required','length','apply','getOwnPropertyDescriptor','defineProperty','10979058FmHwit','get','../../errors/AppError','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','string','3062250fzbLGJ','__setModuleDefault','19342104PPTzYO','search','create','yup','36UDUmHY','toString','8YjQMgp','../../models/Plan','plan','2vPlAHU','(((.+)+)+)+$','prototype','constructor','__createBinding','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','shape','update','hasOwnProperty','queues','validate','2439080BuRuEo','message','__importDefault','min','4088103CgXvFm','This\x20whatsapp\x20token\x20is\x20already\x20used.','__esModule','11urDnii','findOne','7xBTztZ','beta','test','configurable','6354568eMRUVP','count','OPENING'];a563_0x935a=function(){return _0xa59064;};return a563_0x935a();}(function(_0x198443,_0x3b558c){const _0x22ee4f=a563_0x1e94,_0x4f0edb=_0x198443();while(!![]){try{const _0x11fe98=-parseInt(_0x22ee4f(0x12d))/0x1+-parseInt(_0x22ee4f(0x148))/0x2*(-parseInt(_0x22ee4f(0x157))/0x3)+-parseInt(_0x22ee4f(0x145))/0x4*(parseInt(_0x22ee4f(0x153))/0x5)+-parseInt(_0x22ee4f(0x138))/0x6*(-parseInt(_0x22ee4f(0x126))/0x7)+-parseInt(_0x22ee4f(0x12a))/0x8+parseInt(_0x22ee4f(0x143))/0x9*(-parseInt(_0x22ee4f(0x13d))/0xa)+-parseInt(_0x22ee4f(0x124))/0xb*(-parseInt(_0x22ee4f(0x13f))/0xc);if(_0x11fe98===_0x3b558c)break;else _0x4f0edb['push'](_0x4f0edb['shift']());}catch(_0x351a50){_0x4f0edb['push'](_0x4f0edb['shift']());}}}(a563_0x935a,0xdfbe9));const a563_0x294169=(function(){let _0x40a535=!![];return function(_0x3a6d9b,_0x535535){const _0x119a68=_0x40a535?function(){const _0x5d5153=a563_0x1e94;if(_0x535535){const _0x418956=_0x535535[_0x5d5153(0x135)](_0x3a6d9b,arguments);return _0x535535=null,_0x418956;}}:function(){};return _0x40a535=![],_0x119a68;};}()),a563_0x352f5e=a563_0x294169(this,function(){const _0x10d476=a563_0x1e94;return a563_0x352f5e[_0x10d476(0x144)]()['search'](_0x10d476(0x149))[_0x10d476(0x144)]()[_0x10d476(0x14b)](a563_0x352f5e)[_0x10d476(0x140)](_0x10d476(0x149));});a563_0x352f5e();'use strict';var __createBinding=this&&this[a563_0x156750(0x14c)]||(Object[a563_0x156750(0x141)]?function(_0x26b2b,_0x59e030,_0x5e645a,_0x566c1e){const _0x49b755=a563_0x156750;if(_0x566c1e===undefined)_0x566c1e=_0x5e645a;var _0x59ccd0=Object[_0x49b755(0x136)](_0x59e030,_0x5e645a);(!_0x59ccd0||(_0x49b755(0x139)in _0x59ccd0?!_0x59e030['__esModule']:_0x59ccd0['writable']||_0x59ccd0[_0x49b755(0x129)]))&&(_0x59ccd0={'enumerable':!![],'get':function(){return _0x59e030[_0x5e645a];}}),Object['defineProperty'](_0x26b2b,_0x566c1e,_0x59ccd0);}:function(_0x453729,_0x262c4b,_0x54996e,_0x3e412c){if(_0x3e412c===undefined)_0x3e412c=_0x54996e;_0x453729[_0x3e412c]=_0x262c4b[_0x54996e];}),__setModuleDefault=this&&this[a563_0x156750(0x13e)]||(Object['create']?function(_0x204e76,_0x4cfb5c){const _0x1b2a37=a563_0x156750;Object[_0x1b2a37(0x137)](_0x204e76,_0x1b2a37(0x131),{'enumerable':!![],'value':_0x4cfb5c});}:function(_0x5f5763,_0x2de020){_0x5f5763['default']=_0x2de020;}),__importStar=this&&this['__importStar']||function(_0x21bf9d){const _0x48638e=a563_0x156750;if(_0x21bf9d&&_0x21bf9d[_0x48638e(0x123)])return _0x21bf9d;var _0x103838={};if(_0x21bf9d!=null){for(var _0x3d8a52 in _0x21bf9d)if(_0x3d8a52!==_0x48638e(0x131)&&Object[_0x48638e(0x14a)][_0x48638e(0x150)]['call'](_0x21bf9d,_0x3d8a52))__createBinding(_0x103838,_0x21bf9d,_0x3d8a52);}return __setModuleDefault(_0x103838,_0x21bf9d),_0x103838;},__importDefault=this&&this[a563_0x156750(0x155)]||function(_0x3dd6c7){return _0x3dd6c7&&_0x3dd6c7['__esModule']?_0x3dd6c7:{'default':_0x3dd6c7};};Object[a563_0x156750(0x137)](exports,a563_0x156750(0x123),{'value':!![]});const Yup=__importStar(require(a563_0x156750(0x142))),AppError_1=__importDefault(require(a563_0x156750(0x13a))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),Company_1=__importDefault(require('../../models/Company')),Plan_1=__importDefault(require(a563_0x156750(0x146))),AssociateWhatsappQueue_1=__importDefault(require('./AssociateWhatsappQueue')),CreateWhatsAppService=async({name:_0x365107,status:status=a563_0x156750(0x12c),queueIds:queueIds=[],greetingMessage:_0x4f95af,complationMessage:_0x31b41a,outOfHoursMessage:_0x596a4a,ratingMessage:_0x1396ea,isDefault:isDefault=![],companyId:_0x21852a,token:token='',provider:provider=a563_0x156750(0x127),timeSendQueue:_0x22e703,sendIdQueue:_0x4378bc,promptId:_0x3d0330,integrationId:_0x12bf46,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x39ad0b,importOldMessages:_0x2fd05f,importRecentMessages:_0x3e5e01,closedTicketsPostImported:_0x31f77c,importOldMessagesGroups:_0x2958bf})=>{const _0x26ac2c=a563_0x156750,_0x516b02=await Company_1[_0x26ac2c(0x131)][_0x26ac2c(0x125)]({'where':{'id':_0x21852a},'include':[{'model':Plan_1[_0x26ac2c(0x131)],'as':_0x26ac2c(0x147)}]});if(_0x516b02!==null){const _0xb347f3=await Whatsapp_1[_0x26ac2c(0x131)][_0x26ac2c(0x12b)]({'where':{'companyId':_0x21852a}});if(_0xb347f3>=_0x516b02[_0x26ac2c(0x147)][_0x26ac2c(0x12f)])throw new AppError_1[(_0x26ac2c(0x131))](_0x26ac2c(0x14d)+_0xb347f3);}const _0x34073d=Yup[_0x26ac2c(0x12e)]()[_0x26ac2c(0x14e)]({'name':Yup[_0x26ac2c(0x13c)]()[_0x26ac2c(0x133)]()['min'](0x2)[_0x26ac2c(0x128)]('Check-name',_0x26ac2c(0x13b),async _0x31b097=>{const _0x2a1d54=_0x26ac2c;if(!_0x31b097)return![];const _0xcc966c=await Whatsapp_1[_0x2a1d54(0x131)][_0x2a1d54(0x125)]({'where':{'name':_0x31b097}});return!_0xcc966c;}),'isDefault':Yup[_0x26ac2c(0x132)]()[_0x26ac2c(0x133)]()});try{await _0x34073d[_0x26ac2c(0x152)]({'name':_0x365107,'status':status,'isDefault':isDefault});}catch(_0x2c22c1){throw new AppError_1[(_0x26ac2c(0x131))](_0x2c22c1['message']);}const _0xffaa0e=await Whatsapp_1['default'][_0x26ac2c(0x125)]({'where':{'companyId':_0x21852a}});isDefault=!_0xffaa0e;let _0x317a7c=null;isDefault&&(_0x317a7c=await Whatsapp_1[_0x26ac2c(0x131)]['findOne']({'where':{'isDefault':!![],'companyId':_0x21852a}}),_0x317a7c&&await _0x317a7c[_0x26ac2c(0x14f)]({'isDefault':![],'companyId':_0x21852a}));if(queueIds[_0x26ac2c(0x134)]>0x1&&!_0x4f95af)throw new AppError_1['default'](_0x26ac2c(0x130));if(token!==null&&token!==''){const _0x47530f=Yup['object']()[_0x26ac2c(0x14e)]({'token':Yup[_0x26ac2c(0x13c)]()[_0x26ac2c(0x133)]()[_0x26ac2c(0x156)](0x2)[_0x26ac2c(0x128)]('Check-token',_0x26ac2c(0x158),async _0x3856e5=>{const _0x3e91cf=_0x26ac2c;if(!_0x3856e5)return![];const _0x4ad412=await Whatsapp_1['default'][_0x3e91cf(0x125)]({'where':{'token':_0x3856e5}});return!_0x4ad412;})});try{await _0x47530f['validate']({'token':token});}catch(_0x2cb580){throw new AppError_1[(_0x26ac2c(0x131))](_0x2cb580[_0x26ac2c(0x154)]);}}const _0x2d7b0d=await Whatsapp_1[_0x26ac2c(0x131)][_0x26ac2c(0x141)]({'name':_0x365107,'status':status,'greetingMessage':_0x4f95af,'complationMessage':_0x31b41a,'outOfHoursMessage':_0x596a4a,'ratingMessage':_0x1396ea,'isDefault':isDefault,'companyId':_0x21852a,'token':token,'provider':provider,'timeSendQueue':_0x22e703,'sendIdQueue':_0x4378bc,'promptId':_0x3d0330&&_0x3d0330>0x0?_0x3d0330:null,'integrationId':_0x12bf46&&_0x12bf46>0x0?_0x12bf46:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x39ad0b,'importOldMessages':_0x2fd05f,'importRecentMessages':_0x3e5e01,'closedTicketsPostImported':_0x31f77c,'importOldMessagesGroups':_0x2958bf},{'include':[_0x26ac2c(0x151)]});return await(0x0,AssociateWhatsappQueue_1[_0x26ac2c(0x131)])(_0x2d7b0d,queueIds),{'whatsapp':_0x2d7b0d,'oldDefaultWhatsapp':_0x317a7c};};exports['default']=CreateWhatsAppService;