'use strict';function a590_0x58fe(_0xefec32,_0x23388b){const _0x460691=a590_0x156e();return a590_0x58fe=function(_0x14a967,_0x4d3015){_0x14a967=_0x14a967-0x83;let _0x156ef1=_0x460691[_0x14a967];return _0x156ef1;},a590_0x58fe(_0xefec32,_0x23388b);}const a590_0x22ff8a=a590_0x58fe;(function(_0x307aeb,_0x39a0e4){const _0x445231=a590_0x58fe,_0x4d63d2=_0x307aeb();while(!![]){try{const _0xdcedaa=parseInt(_0x445231(0xa0))/0x1*(-parseInt(_0x445231(0x87))/0x2)+-parseInt(_0x445231(0xb8))/0x3+parseInt(_0x445231(0x97))/0x4+-parseInt(_0x445231(0xb4))/0x5+-parseInt(_0x445231(0xa1))/0x6*(-parseInt(_0x445231(0xb5))/0x7)+parseInt(_0x445231(0x92))/0x8*(-parseInt(_0x445231(0xa7))/0x9)+-parseInt(_0x445231(0xb2))/0xa;if(_0xdcedaa===_0x39a0e4)break;else _0x4d63d2['push'](_0x4d63d2['shift']());}catch(_0x3b4fec){_0x4d63d2['push'](_0x4d63d2['shift']());}}}(a590_0x156e,0xc168e));var __createBinding=this&&this[a590_0x22ff8a(0x98)]||(Object['create']?function(_0x337b68,_0x3de77d,_0x9628c,_0x57868b){const _0x2e2fd7=a590_0x22ff8a;if(_0x57868b===undefined)_0x57868b=_0x9628c;var _0x5b8612=Object[_0x2e2fd7(0xa9)](_0x3de77d,_0x9628c);(!_0x5b8612||(_0x2e2fd7(0xb9)in _0x5b8612?!_0x3de77d[_0x2e2fd7(0x89)]:_0x5b8612[_0x2e2fd7(0x8e)]||_0x5b8612[_0x2e2fd7(0xa2)]))&&(_0x5b8612={'enumerable':!![],'get':function(){return _0x3de77d[_0x9628c];}}),Object['defineProperty'](_0x337b68,_0x57868b,_0x5b8612);}:function(_0x40c8a2,_0x54a034,_0x33723f,_0x15dab0){if(_0x15dab0===undefined)_0x15dab0=_0x33723f;_0x40c8a2[_0x15dab0]=_0x54a034[_0x33723f];}),__setModuleDefault=this&&this[a590_0x22ff8a(0x8f)]||(Object[a590_0x22ff8a(0x88)]?function(_0x13356d,_0x1e6e53){const _0x5a0e26=a590_0x22ff8a;Object[_0x5a0e26(0x86)](_0x13356d,_0x5a0e26(0x99),{'enumerable':!![],'value':_0x1e6e53});}:function(_0x4aaaff,_0x8902a4){const _0x2faae2=a590_0x22ff8a;_0x4aaaff[_0x2faae2(0x99)]=_0x8902a4;}),__importStar=this&&this[a590_0x22ff8a(0x9c)]||(function(){const _0x3d1f2b=(function(){let _0x436339=!![];return function(_0x4e8817,_0x5809f3){const _0x445ef5=_0x436339?function(){const _0x377131=a590_0x58fe;if(_0x5809f3){const _0x37f371=_0x5809f3[_0x377131(0x9e)](_0x4e8817,arguments);return _0x5809f3=null,_0x37f371;}}:function(){};return _0x436339=![],_0x445ef5;};}()),_0x205af4=_0x3d1f2b(this,function(){const _0x5cb0fa=a590_0x58fe;return _0x205af4[_0x5cb0fa(0x83)]()[_0x5cb0fa(0x9a)](_0x5cb0fa(0xaa))[_0x5cb0fa(0x83)]()[_0x5cb0fa(0x96)](_0x205af4)[_0x5cb0fa(0x9a)](_0x5cb0fa(0xaa));});_0x205af4();var _0x326e57=function(_0x2f0f1b){return _0x326e57=Object['getOwnPropertyNames']||function(_0x461c80){const _0x27eec2=a590_0x58fe;var _0x3cdb82=[];for(var _0x4bbcf4 in _0x461c80)if(Object[_0x27eec2(0xb6)][_0x27eec2(0x95)][_0x27eec2(0x8b)](_0x461c80,_0x4bbcf4))_0x3cdb82[_0x3cdb82[_0x27eec2(0xab)]]=_0x4bbcf4;return _0x3cdb82;},_0x326e57(_0x2f0f1b);};return function(_0x30b84a){const _0x2f519b=a590_0x58fe;if(_0x30b84a&&_0x30b84a[_0x2f519b(0x89)])return _0x30b84a;var _0x4b6f14={};if(_0x30b84a!=null){for(var _0x2312be=_0x326e57(_0x30b84a),_0x261640=0x0;_0x261640<_0x2312be['length'];_0x261640++)if(_0x2312be[_0x261640]!==_0x2f519b(0x99))__createBinding(_0x4b6f14,_0x30b84a,_0x2312be[_0x261640]);}return __setModuleDefault(_0x4b6f14,_0x30b84a),_0x4b6f14;};}()),__importDefault=this&&this[a590_0x22ff8a(0xb1)]||function(_0x1555e4){const _0xef4663=a590_0x22ff8a;return _0x1555e4&&_0x1555e4[_0xef4663(0x89)]?_0x1555e4:{'default':_0x1555e4};};Object[a590_0x22ff8a(0x86)](exports,a590_0x22ff8a(0x89),{'value':!![]});const Yup=__importStar(require(a590_0x22ff8a(0xb7))),AppError_1=__importDefault(require('../../errors/AppError')),Whatsapp_1=__importDefault(require(a590_0x22ff8a(0x8c))),Company_1=__importDefault(require('../../models/Company')),Plan_1=__importDefault(require('../../models/Plan')),AssociateWhatsappQueue_1=__importDefault(require(a590_0x22ff8a(0xaf))),CreateWhatsAppService=async({name:_0x51ee97,status:status=a590_0x22ff8a(0x94),queueIds:queueIds=[],greetingMessage:_0x2b1aeb,complationMessage:_0x24263e,outOfHoursMessage:_0x43ee08,useRating:_0x11b663,ratingMessage:_0x51e106,transferMessage:_0x1d0c1d,isDefault:isDefault=![],companyId:_0x2bc49d,token:token='',provider:provider=a590_0x22ff8a(0x84),facebookUserId:_0x44a33f,facebookUserToken:_0xb90b3d,facebookPageUserId:_0xf6b2e1,tokenMeta:_0x11aeea,channel:channel=a590_0x22ff8a(0xa8),integrationId:_0x264b8b,maxUseBotQueues:maxUseBotQueues=0x3,sendIdQueue:_0x4e217b,timeSendQueue:_0x25eaa8,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:allowGroup=![],importOldMessages:_0x264100,schedules:schedules=[],whenExpireTicket:_0x468a33,inactiveMessageTime:_0x4eca43,inactiveMessage:_0x232ba6,automaticRestart:_0x530c4a,period:_0x4d35c0,lastRestartAt:_0x6d2d75})=>{const _0x1250dc=a590_0x22ff8a,_0x416c5c=await Company_1[_0x1250dc(0x99)][_0x1250dc(0xb0)]({'where':{'id':_0x2bc49d},'include':[{'model':Plan_1[_0x1250dc(0x99)],'as':_0x1250dc(0x8a)}]});if(_0x416c5c){const _0x4fb3e9=await Whatsapp_1['default'][_0x1250dc(0x9d)]({'where':{'companyId':_0x2bc49d,'channel':channel}});if(_0x4fb3e9>=_0x416c5c[_0x1250dc(0x8a)][_0x1250dc(0xa5)])throw new AppError_1['default'](_0x1250dc(0x8d)+_0x4fb3e9);}const _0x1869fc=Yup[_0x1250dc(0x85)]()[_0x1250dc(0x9b)]({'name':Yup[_0x1250dc(0xac)]()[_0x1250dc(0xa3)]()['min'](0x2)[_0x1250dc(0xa4)](_0x1250dc(0x9f),'Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão',async _0x428d59=>{if(!_0x428d59)return![];const _0x58395d=await Whatsapp_1['default']['findOne']({'where':{'name':_0x428d59,'companyId':_0x2bc49d}});return!_0x58395d;}),'isDefault':Yup[_0x1250dc(0xad)]()[_0x1250dc(0xa3)]()});try{await _0x1869fc[_0x1250dc(0x91)]({'name':_0x51ee97,'status':status,'isDefault':isDefault});}catch(_0x394662){throw new AppError_1['default'](_0x394662[_0x1250dc(0xb3)]);}const _0x26192c=await Whatsapp_1[_0x1250dc(0x99)][_0x1250dc(0xb0)]({'where':{'companyId':_0x2bc49d}});isDefault=channel===_0x1250dc(0xa8)?!_0x26192c:![];let _0x192064=null;channel==='whatsapp'&&isDefault&&(_0x192064=await Whatsapp_1[_0x1250dc(0x99)][_0x1250dc(0xb0)]({'where':{'isDefault':!![],'companyId':_0x2bc49d,'channel':channel}}),_0x192064&&await _0x192064['update']({'isDefault':![]}));if(queueIds[_0x1250dc(0xab)]>0x1&&!_0x2b1aeb)throw new AppError_1['default'](_0x1250dc(0xa6));if(token){const _0x48eae2=Yup[_0x1250dc(0x85)]()[_0x1250dc(0x9b)]({'token':Yup[_0x1250dc(0xac)]()[_0x1250dc(0xa3)]()[_0x1250dc(0xae)](0x2)[_0x1250dc(0xa4)](_0x1250dc(0x90),'This\x20whatsapp\x20token\x20is\x20already\x20used.',async _0x17cef3=>{const _0x50bfac=_0x1250dc;if(!_0x17cef3)return![];const _0x31a494=await Whatsapp_1[_0x50bfac(0x99)][_0x50bfac(0xb0)]({'where':{'token':_0x17cef3,'channel':channel}});return!_0x31a494;})});try{await _0x48eae2[_0x1250dc(0x91)]({'token':token});}catch(_0x1cb99b){throw new AppError_1[(_0x1250dc(0x99))](_0x1cb99b[_0x1250dc(0xb3)]);}}const _0x5df021=await Whatsapp_1[_0x1250dc(0x99)][_0x1250dc(0x88)]({'name':_0x51ee97,'status':status,'greetingMessage':_0x2b1aeb,'complationMessage':_0x24263e,'outOfHoursMessage':_0x43ee08,'useRating':_0x11b663,'ratingMessage':_0x51e106,'transferMessage':_0x1d0c1d,'isDefault':isDefault,'companyId':_0x2bc49d,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x44a33f,'facebookUserToken':_0xb90b3d,'facebookPageUserId':_0xf6b2e1,'tokenMeta':_0x11aeea,'integrationId':_0x264b8b&&_0x264b8b>0x0?_0x264b8b:null,'maxUseBotQueues':maxUseBotQueues,'sendIdQueue':_0x4e217b,'timeSendQueue':_0x25eaa8,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':allowGroup,'importOldMessages':_0x264100,'schedules':schedules,'whenExpireTicket':_0x468a33,'inactiveMessageTime':_0x4eca43,'inactiveMessage':_0x232ba6,'automaticRestart':_0x530c4a,'period':_0x4d35c0,'lastRestartAt':_0x6d2d75},{'include':[_0x1250dc(0x93)]});return await(0x0,AssociateWhatsappQueue_1[_0x1250dc(0x99)])(_0x5df021,queueIds),{'whatsapp':_0x5df021,'oldDefaultWhatsapp':_0x192064};};function a590_0x156e(){const _0x107c85=['default','search','shape','__importStar','count','apply','Check-name','71znAdPI','3340794oxKdcR','configurable','required','test','connections','ERR_WAPP_GREETING_REQUIRED','99WtOAJP','whatsapp','getOwnPropertyDescriptor','(((.+)+)+)+$','length','string','boolean','min','./AssociateWhatsappQueue','findOne','__importDefault','1348160dGFSpv','message','483735rZkkRl','14DHAWdW','prototype','yup','3272442gCIgCZ','get','toString','beta','object','defineProperty','1846auUife','create','__esModule','plan','call','../../models/Whatsapp','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','writable','__setModuleDefault','Check-token','validate','73864VrtRTZ','queues','OPENING','hasOwnProperty','constructor','4672324UStoWj','__createBinding'];a590_0x156e=function(){return _0x107c85;};return a590_0x156e();}exports[a590_0x22ff8a(0x99)]=CreateWhatsAppService;