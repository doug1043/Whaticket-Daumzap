'use strict';const a585_0x541ec6=a585_0x299e;(function(_0x51316f,_0x36cbdd){const _0xf30d55=a585_0x299e,_0x3695fe=_0x51316f();while(!![]){try{const _0x2acddb=parseInt(_0xf30d55(0xa4))/0x1+parseInt(_0xf30d55(0x90))/0x2+parseInt(_0xf30d55(0x9c))/0x3*(parseInt(_0xf30d55(0xa8))/0x4)+-parseInt(_0xf30d55(0x91))/0x5*(-parseInt(_0xf30d55(0xb0))/0x6)+parseInt(_0xf30d55(0x8a))/0x7+-parseInt(_0xf30d55(0xa0))/0x8*(-parseInt(_0xf30d55(0x8f))/0x9)+-parseInt(_0xf30d55(0xab))/0xa*(parseInt(_0xf30d55(0xb1))/0xb);if(_0x2acddb===_0x36cbdd)break;else _0x3695fe['push'](_0x3695fe['shift']());}catch(_0x48b5fc){_0x3695fe['push'](_0x3695fe['shift']());}}}(a585_0x3de2,0x3da3e));function a585_0x299e(_0x5db56d,_0x3539aa){const _0xac22aa=a585_0x3de2();return a585_0x299e=function(_0x4c51ea,_0x20d084){_0x4c51ea=_0x4c51ea-0x85;let _0x3de22d=_0xac22aa[_0x4c51ea];return _0x3de22d;},a585_0x299e(_0x5db56d,_0x3539aa);}var __createBinding=this&&this[a585_0x541ec6(0x86)]||(Object['create']?function(_0x2a76ed,_0x157859,_0x5a6a6b,_0x880cf9){const _0x27bca2=a585_0x541ec6;if(_0x880cf9===undefined)_0x880cf9=_0x5a6a6b;var _0x3e79e5=Object['getOwnPropertyDescriptor'](_0x157859,_0x5a6a6b);(!_0x3e79e5||(_0x27bca2(0x9e)in _0x3e79e5?!_0x157859[_0x27bca2(0xb3)]:_0x3e79e5['writable']||_0x3e79e5[_0x27bca2(0xa1)]))&&(_0x3e79e5={'enumerable':!![],'get':function(){return _0x157859[_0x5a6a6b];}}),Object[_0x27bca2(0x92)](_0x2a76ed,_0x880cf9,_0x3e79e5);}:function(_0x44f2e4,_0x36b387,_0xf0f479,_0x2bc8eb){if(_0x2bc8eb===undefined)_0x2bc8eb=_0xf0f479;_0x44f2e4[_0x2bc8eb]=_0x36b387[_0xf0f479];}),__setModuleDefault=this&&this[a585_0x541ec6(0xa3)]||(Object[a585_0x541ec6(0xb8)]?function(_0x295320,_0x15ee98){Object['defineProperty'](_0x295320,'default',{'enumerable':!![],'value':_0x15ee98});}:function(_0x4059e1,_0x4ea900){const _0x28ed10=a585_0x541ec6;_0x4059e1[_0x28ed10(0xa5)]=_0x4ea900;}),__importStar=this&&this[a585_0x541ec6(0x93)]||(function(){const _0x3fee0e=(function(){let _0x3334b9=!![];return function(_0x1f48dc,_0x5ba5fe){const _0x8505d1=_0x3334b9?function(){const _0x2677a6=a585_0x299e;if(_0x5ba5fe){const _0x330b6b=_0x5ba5fe[_0x2677a6(0xb4)](_0x1f48dc,arguments);return _0x5ba5fe=null,_0x330b6b;}}:function(){};return _0x3334b9=![],_0x8505d1;};}()),_0x41a23e=_0x3fee0e(this,function(){const _0x4f04cd=a585_0x299e;return _0x41a23e[_0x4f04cd(0x94)]()[_0x4f04cd(0xaf)](_0x4f04cd(0xb2))[_0x4f04cd(0x94)]()[_0x4f04cd(0x98)](_0x41a23e)[_0x4f04cd(0xaf)](_0x4f04cd(0xb2));});_0x41a23e();var _0x1f736c=function(_0x442568){return _0x1f736c=Object['getOwnPropertyNames']||function(_0x176b4b){const _0x251232=a585_0x299e;var _0x3f5b4a=[];for(var _0x367df0 in _0x176b4b)if(Object[_0x251232(0x87)]['hasOwnProperty']['call'](_0x176b4b,_0x367df0))_0x3f5b4a[_0x3f5b4a[_0x251232(0x9f)]]=_0x367df0;return _0x3f5b4a;},_0x1f736c(_0x442568);};return function(_0x2de90b){const _0x545f8a=a585_0x299e;if(_0x2de90b&&_0x2de90b['__esModule'])return _0x2de90b;var _0x622c0c={};if(_0x2de90b!=null){for(var _0x3b57f0=_0x1f736c(_0x2de90b),_0x11fc6c=0x0;_0x11fc6c<_0x3b57f0[_0x545f8a(0x9f)];_0x11fc6c++)if(_0x3b57f0[_0x11fc6c]!=='default')__createBinding(_0x622c0c,_0x2de90b,_0x3b57f0[_0x11fc6c]);}return __setModuleDefault(_0x622c0c,_0x2de90b),_0x622c0c;};}()),__importDefault=this&&this[a585_0x541ec6(0xaa)]||function(_0x432118){const _0x34f871=a585_0x541ec6;return _0x432118&&_0x432118[_0x34f871(0xb3)]?_0x432118:{'default':_0x432118};};function a585_0x3de2(){const _0x219b09=['__importDefault','5810QyFPEI','Check-token','../../models/Whatsapp','test','search','757020DahIbY','27313dKNNxB','(((.+)+)+)+$','__esModule','apply','min','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','string','create','This\x20whatsapp\x20token\x20is\x20already\x20used.','Check-name','__createBinding','prototype','findOne','plan','595322OlAkKf','update','../../models/Company','shape','./AssociateWhatsappQueue','18dcjXDG','429280aOqOdJ','10aObuRN','defineProperty','__importStar','toString','whatsapp','yup','message','constructor','../../errors/AppError','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','validate','3bQwswR','ERR_WAPP_GREETING_REQUIRED','get','length','1332304YTIdvE','configurable','../../models/Plan','__setModuleDefault','328408QHkpUh','default','beta','boolean','1926364dfTEqf','required'];a585_0x3de2=function(){return _0x219b09;};return a585_0x3de2();}Object['defineProperty'](exports,a585_0x541ec6(0xb3),{'value':!![]});const Yup=__importStar(require(a585_0x541ec6(0x96))),AppError_1=__importDefault(require(a585_0x541ec6(0x99))),Whatsapp_1=__importDefault(require(a585_0x541ec6(0xad))),Company_1=__importDefault(require(a585_0x541ec6(0x8c))),Plan_1=__importDefault(require(a585_0x541ec6(0xa2))),AssociateWhatsappQueue_1=__importDefault(require(a585_0x541ec6(0x8e))),CreateWhatsAppService=async({name:_0x968f0c,status:status='OPENING',queueIds:queueIds=[],greetingMessage:_0x3db36a,complationMessage:_0x5b27a6,outOfHoursMessage:_0x19bb21,useRating:_0x218df1,ratingMessage:_0x5baeec,transferMessage:_0x233c97,isDefault:isDefault=![],companyId:_0x11aa4f,token:token='',provider:provider=a585_0x541ec6(0xa6),facebookUserId:_0x21213e,facebookUserToken:_0x3a68f6,facebookPageUserId:_0x263f82,tokenMeta:_0x549530,channel:channel=a585_0x541ec6(0x95),integrationId:_0x5e92e9,maxUseBotQueues:maxUseBotQueues=0x3,sendIdQueue:_0x5e1fd6,timeSendQueue:_0x4e8e17,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:allowGroup=![],importOldMessages:_0x11f850,schedules:schedules=[],whenExpireTicket:_0x30ddcd,inactiveMessageTime:_0x4c751e,inactiveMessage:_0x30e83e,automaticRestart:_0x23ac69,period:_0x2b2b1,lastRestartAt:_0x58eff2})=>{const _0x5fdda9=a585_0x541ec6,_0x27cbf3=await Company_1['default'][_0x5fdda9(0x88)]({'where':{'id':_0x11aa4f},'include':[{'model':Plan_1[_0x5fdda9(0xa5)],'as':_0x5fdda9(0x89)}]});if(_0x27cbf3){const _0x299cfa=await Whatsapp_1[_0x5fdda9(0xa5)]['count']({'where':{'companyId':_0x11aa4f,'channel':channel}});if(_0x299cfa>=_0x27cbf3[_0x5fdda9(0x89)]['connections'])throw new AppError_1[(_0x5fdda9(0xa5))](_0x5fdda9(0x9a)+_0x299cfa);}const _0x9c5ab3=Yup['object']()[_0x5fdda9(0x8d)]({'name':Yup[_0x5fdda9(0xb7)]()[_0x5fdda9(0xa9)]()[_0x5fdda9(0xb5)](0x2)[_0x5fdda9(0xae)](_0x5fdda9(0x85),_0x5fdda9(0xb6),async _0x5f143f=>{const _0x4b81e6=_0x5fdda9;if(!_0x5f143f)return![];const _0x56a3f3=await Whatsapp_1[_0x4b81e6(0xa5)][_0x4b81e6(0x88)]({'where':{'name':_0x5f143f,'companyId':_0x11aa4f}});return!_0x56a3f3;}),'isDefault':Yup[_0x5fdda9(0xa7)]()[_0x5fdda9(0xa9)]()});try{await _0x9c5ab3[_0x5fdda9(0x9b)]({'name':_0x968f0c,'status':status,'isDefault':isDefault});}catch(_0x407162){throw new AppError_1['default'](_0x407162['message']);}const _0x34a8fa=await Whatsapp_1[_0x5fdda9(0xa5)][_0x5fdda9(0x88)]({'where':{'companyId':_0x11aa4f}});isDefault=channel==='whatsapp'?!_0x34a8fa:![];let _0x77e143=null;channel==='whatsapp'&&isDefault&&(_0x77e143=await Whatsapp_1[_0x5fdda9(0xa5)]['findOne']({'where':{'isDefault':!![],'companyId':_0x11aa4f,'channel':channel}}),_0x77e143&&await _0x77e143[_0x5fdda9(0x8b)]({'isDefault':![]}));if(queueIds['length']>0x1&&!_0x3db36a)throw new AppError_1['default'](_0x5fdda9(0x9d));if(token){const _0x3b165a=Yup['object']()[_0x5fdda9(0x8d)]({'token':Yup['string']()[_0x5fdda9(0xa9)]()[_0x5fdda9(0xb5)](0x2)[_0x5fdda9(0xae)](_0x5fdda9(0xac),_0x5fdda9(0xb9),async _0x111b5b=>{const _0x47abe5=_0x5fdda9;if(!_0x111b5b)return![];const _0x3db076=await Whatsapp_1[_0x47abe5(0xa5)]['findOne']({'where':{'token':_0x111b5b,'channel':channel}});return!_0x3db076;})});try{await _0x3b165a[_0x5fdda9(0x9b)]({'token':token});}catch(_0x36488d){throw new AppError_1[(_0x5fdda9(0xa5))](_0x36488d[_0x5fdda9(0x97)]);}}const _0x43b581=await Whatsapp_1['default']['create']({'name':_0x968f0c,'status':status,'greetingMessage':_0x3db36a,'complationMessage':_0x5b27a6,'outOfHoursMessage':_0x19bb21,'useRating':_0x218df1,'ratingMessage':_0x5baeec,'transferMessage':_0x233c97,'isDefault':isDefault,'companyId':_0x11aa4f,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x21213e,'facebookUserToken':_0x3a68f6,'facebookPageUserId':_0x263f82,'tokenMeta':_0x549530,'integrationId':_0x5e92e9&&_0x5e92e9>0x0?_0x5e92e9:null,'maxUseBotQueues':maxUseBotQueues,'sendIdQueue':_0x5e1fd6,'timeSendQueue':_0x4e8e17,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':allowGroup,'importOldMessages':_0x11f850,'schedules':schedules,'whenExpireTicket':_0x30ddcd,'inactiveMessageTime':_0x4c751e,'inactiveMessage':_0x30e83e,'automaticRestart':_0x23ac69,'period':_0x2b2b1,'lastRestartAt':_0x58eff2},{'include':['queues']});return await(0x0,AssociateWhatsappQueue_1['default'])(_0x43b581,queueIds),{'whatsapp':_0x43b581,'oldDefaultWhatsapp':_0x77e143};};exports[a585_0x541ec6(0xa5)]=CreateWhatsAppService;