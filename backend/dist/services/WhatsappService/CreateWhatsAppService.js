const a561_0x59ba37=a561_0x1011;(function(_0x1e1597,_0x3948e6){const _0x43adec=a561_0x1011,_0x22c63d=_0x1e1597();while(!![]){try{const _0x48de60=parseInt(_0x43adec(0xf0))/0x1+parseInt(_0x43adec(0x10c))/0x2+-parseInt(_0x43adec(0x11d))/0x3+-parseInt(_0x43adec(0x100))/0x4*(-parseInt(_0x43adec(0x104))/0x5)+parseInt(_0x43adec(0xfd))/0x6+-parseInt(_0x43adec(0x11a))/0x7*(-parseInt(_0x43adec(0xfa))/0x8)+-parseInt(_0x43adec(0x11e))/0x9;if(_0x48de60===_0x3948e6)break;else _0x22c63d['push'](_0x22c63d['shift']());}catch(_0x14dcb4){_0x22c63d['push'](_0x22c63d['shift']());}}}(a561_0xd84c,0x22f48));const a561_0x354108=(function(){let _0x200799=!![];return function(_0x2b6835,_0x3b6a83){const _0x24f513=_0x200799?function(){const _0xaeb60b=a561_0x1011;if(_0x3b6a83){const _0x453781=_0x3b6a83[_0xaeb60b(0x108)](_0x2b6835,arguments);return _0x3b6a83=null,_0x453781;}}:function(){};return _0x200799=![],_0x24f513;};}()),a561_0x5cc93e=a561_0x354108(this,function(){const _0x3c2938=a561_0x1011;return a561_0x5cc93e[_0x3c2938(0x116)]()[_0x3c2938(0x115)](_0x3c2938(0xfe))['toString']()['constructor'](a561_0x5cc93e)['search']('(((.+)+)+)+$');});a561_0x5cc93e();function a561_0x1011(_0x3c4f9c,_0x362b29){const _0x2d656d=a561_0xd84c();return a561_0x1011=function(_0x5cc93e,_0x354108){_0x5cc93e=_0x5cc93e-0xf0;let _0xd84c80=_0x2d656d[_0x5cc93e];return _0xd84c80;},a561_0x1011(_0x3c4f9c,_0x362b29);}'use strict';var __createBinding=this&&this[a561_0x59ba37(0x106)]||(Object[a561_0x59ba37(0x10d)]?function(_0x359b6f,_0x396d95,_0x48e556,_0x4512b5){const _0x2e3fad=a561_0x59ba37;if(_0x4512b5===undefined)_0x4512b5=_0x48e556;var _0xdd6dbd=Object[_0x2e3fad(0xf1)](_0x396d95,_0x48e556);(!_0xdd6dbd||('get'in _0xdd6dbd?!_0x396d95['__esModule']:_0xdd6dbd[_0x2e3fad(0xf4)]||_0xdd6dbd[_0x2e3fad(0x112)]))&&(_0xdd6dbd={'enumerable':!![],'get':function(){return _0x396d95[_0x48e556];}}),Object['defineProperty'](_0x359b6f,_0x4512b5,_0xdd6dbd);}:function(_0x4f489e,_0x13b00c,_0x261937,_0x43dd54){if(_0x43dd54===undefined)_0x43dd54=_0x261937;_0x4f489e[_0x43dd54]=_0x13b00c[_0x261937];}),__setModuleDefault=this&&this[a561_0x59ba37(0x105)]||(Object[a561_0x59ba37(0x10d)]?function(_0xaa0432,_0x52c252){const _0xa80ee0=a561_0x59ba37;Object['defineProperty'](_0xaa0432,_0xa80ee0(0x114),{'enumerable':!![],'value':_0x52c252});}:function(_0x174484,_0x295ad8){const _0x3dfb94=a561_0x59ba37;_0x174484[_0x3dfb94(0x114)]=_0x295ad8;}),__importStar=this&&this[a561_0x59ba37(0x11c)]||function(_0x4e0ab9){const _0x231d49=a561_0x59ba37;if(_0x4e0ab9&&_0x4e0ab9[_0x231d49(0xf3)])return _0x4e0ab9;var _0x5ed417={};if(_0x4e0ab9!=null){for(var _0x1b5695 in _0x4e0ab9)if(_0x1b5695!==_0x231d49(0x114)&&Object[_0x231d49(0x103)][_0x231d49(0x107)][_0x231d49(0x117)](_0x4e0ab9,_0x1b5695))__createBinding(_0x5ed417,_0x4e0ab9,_0x1b5695);}return __setModuleDefault(_0x5ed417,_0x4e0ab9),_0x5ed417;},__importDefault=this&&this['__importDefault']||function(_0x513c31){const _0x106b41=a561_0x59ba37;return _0x513c31&&_0x513c31[_0x106b41(0xf3)]?_0x513c31:{'default':_0x513c31};};Object['defineProperty'](exports,a561_0x59ba37(0xf3),{'value':!![]});const Yup=__importStar(require('yup')),AppError_1=__importDefault(require(a561_0x59ba37(0x102))),Whatsapp_1=__importDefault(require(a561_0x59ba37(0xfc))),Company_1=__importDefault(require(a561_0x59ba37(0x111))),Plan_1=__importDefault(require(a561_0x59ba37(0xf6))),AssociateWhatsappQueue_1=__importDefault(require(a561_0x59ba37(0x10f))),CreateWhatsAppService=async({name:_0x3525cd,status:status='OPENING',queueIds:queueIds=[],greetingMessage:_0x568dc3,complationMessage:_0x19a028,outOfHoursMessage:_0x178e3d,ratingMessage:_0x446de8,isDefault:isDefault=![],companyId:_0x32915c,token:token='',provider:provider='beta',timeSendQueue:_0x3acf40,sendIdQueue:_0x517e0d,promptId:_0x7a650a,integrationId:_0x4f3349,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x437539,importOldMessages:_0x1a61f0,importRecentMessages:_0x52d229,closedTicketsPostImported:_0x1c0190,importOldMessagesGroups:_0x3b09c4})=>{const _0x285a04=a561_0x59ba37,_0x27c179=await Company_1[_0x285a04(0x114)][_0x285a04(0x113)]({'where':{'id':_0x32915c},'include':[{'model':Plan_1[_0x285a04(0x114)],'as':'plan'}]});if(_0x27c179!==null){const _0x19b613=await Whatsapp_1[_0x285a04(0x114)][_0x285a04(0xf7)]({'where':{'companyId':_0x32915c}});if(_0x19b613>=_0x27c179['plan'][_0x285a04(0x109)])throw new AppError_1[(_0x285a04(0x114))](_0x285a04(0x10b)+_0x19b613);}const _0x1b90f7=Yup[_0x285a04(0x119)]()[_0x285a04(0x118)]({'name':Yup['string']()[_0x285a04(0xf9)]()[_0x285a04(0x11b)](0x2)[_0x285a04(0x101)](_0x285a04(0xf5),'Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão',async _0x3b1229=>{const _0x2b0ffc=_0x285a04;if(!_0x3b1229)return![];const _0x100f11=await Whatsapp_1['default'][_0x2b0ffc(0x113)]({'where':{'name':_0x3b1229}});return!_0x100f11;}),'isDefault':Yup['boolean']()[_0x285a04(0xf9)]()});try{await _0x1b90f7['validate']({'name':_0x3525cd,'status':status,'isDefault':isDefault});}catch(_0x3f8705){throw new AppError_1[(_0x285a04(0x114))](_0x3f8705['message']);}const _0x2fbed7=await Whatsapp_1[_0x285a04(0x114)][_0x285a04(0x113)]({'where':{'companyId':_0x32915c}});isDefault=!_0x2fbed7;let _0x2cad33=null;isDefault&&(_0x2cad33=await Whatsapp_1[_0x285a04(0x114)][_0x285a04(0x113)]({'where':{'isDefault':!![],'companyId':_0x32915c}}),_0x2cad33&&await _0x2cad33[_0x285a04(0x11f)]({'isDefault':![],'companyId':_0x32915c}));if(queueIds['length']>0x1&&!_0x568dc3)throw new AppError_1[(_0x285a04(0x114))](_0x285a04(0x10e));if(token!==null&&token!==''){const _0x2c3c0a=Yup[_0x285a04(0x119)]()['shape']({'token':Yup[_0x285a04(0x110)]()[_0x285a04(0xf9)]()[_0x285a04(0x11b)](0x2)['test'](_0x285a04(0xf2),_0x285a04(0xff),async _0x38242e=>{const _0x238e5a=_0x285a04;if(!_0x38242e)return![];const _0x5d1c19=await Whatsapp_1[_0x238e5a(0x114)]['findOne']({'where':{'token':_0x38242e}});return!_0x5d1c19;})});try{await _0x2c3c0a[_0x285a04(0xf8)]({'token':token});}catch(_0x2ef649){throw new AppError_1[(_0x285a04(0x114))](_0x2ef649[_0x285a04(0x10a)]);}}const _0x2f6640=await Whatsapp_1[_0x285a04(0x114)][_0x285a04(0x10d)]({'name':_0x3525cd,'status':status,'greetingMessage':_0x568dc3,'complationMessage':_0x19a028,'outOfHoursMessage':_0x178e3d,'ratingMessage':_0x446de8,'isDefault':isDefault,'companyId':_0x32915c,'token':token,'provider':provider,'timeSendQueue':_0x3acf40,'sendIdQueue':_0x517e0d,'promptId':_0x7a650a&&_0x7a650a>0x0?_0x7a650a:null,'integrationId':_0x4f3349&&_0x4f3349>0x0?_0x4f3349:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x437539,'importOldMessages':_0x1a61f0,'importRecentMessages':_0x52d229,'closedTicketsPostImported':_0x1c0190,'importOldMessagesGroups':_0x3b09c4},{'include':[_0x285a04(0xfb)]});return await(0x0,AssociateWhatsappQueue_1['default'])(_0x2f6640,queueIds),{'whatsapp':_0x2f6640,'oldDefaultWhatsapp':_0x2cad33};};exports['default']=CreateWhatsAppService;function a561_0xd84c(){const _0x3c7c28=['min','__importStar','624366ZACTbA','2496888YEvppf','update','108587BbJmtY','getOwnPropertyDescriptor','Check-token','__esModule','writable','Check-name','../../models/Plan','count','validate','required','35176xbIWUE','queues','../../models/Whatsapp','341010vPyfCw','(((.+)+)+)+$','This\x20whatsapp\x20token\x20is\x20already\x20used.','48160FpoPYD','test','../../errors/AppError','prototype','80DdvqLe','__setModuleDefault','__createBinding','hasOwnProperty','apply','connections','message','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','427014BguCqv','create','ERR_WAPP_GREETING_REQUIRED','./AssociateWhatsappQueue','string','../../models/Company','configurable','findOne','default','search','toString','call','shape','object','91dYFgAi'];a561_0xd84c=function(){return _0x3c7c28;};return a561_0xd84c();}