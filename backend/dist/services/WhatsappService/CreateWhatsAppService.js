function a553_0x6228(){const _0x1fffec=['getOwnPropertyDescriptor','1136084cqvctI','configurable','This\x20whatsapp\x20token\x20is\x20already\x20used.','create','7182234gSNPei','constructor','min','test','(((.+)+)+)+$','shape','writable','findOne','plan','apply','./AssociateWhatsappQueue','validate','call','toString','1074417aoWNmn','length','526932rMAxLe','../../models/Company','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','__createBinding','5PUqZYx','required','6107675WYEyzP','search','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','__importDefault','beta','22249288NfjTVM','boolean','../../errors/AppError','object','get','message','__esModule','Check-name','__importStar','defineProperty','__setModuleDefault','3669627wZvBYA','count','connections','string','Check-token','default'];a553_0x6228=function(){return _0x1fffec;};return a553_0x6228();}const a553_0x47af1d=a553_0x2d89;(function(_0x3b4656,_0x41cba9){const _0x30e35d=a553_0x2d89,_0x3a800b=_0x3b4656();while(!![]){try{const _0x50d6fd=-parseInt(_0x30e35d(0x172))/0x1+-parseInt(_0x30e35d(0x174))/0x2+parseInt(_0x30e35d(0x159))/0x3+-parseInt(_0x30e35d(0x160))/0x4*(-parseInt(_0x30e35d(0x178))/0x5)+-parseInt(_0x30e35d(0x164))/0x6+-parseInt(_0x30e35d(0x17a))/0x7+parseInt(_0x30e35d(0x17f))/0x8;if(_0x50d6fd===_0x41cba9)break;else _0x3a800b['push'](_0x3a800b['shift']());}catch(_0x46d000){_0x3a800b['push'](_0x3a800b['shift']());}}}(a553_0x6228,0xd7130));const a553_0x472010=(function(){let _0x1ec9c0=!![];return function(_0x5c9377,_0x22348c){const _0x3cc172=_0x1ec9c0?function(){const _0x1d944f=a553_0x2d89;if(_0x22348c){const _0x3c322f=_0x22348c[_0x1d944f(0x16d)](_0x5c9377,arguments);return _0x22348c=null,_0x3c322f;}}:function(){};return _0x1ec9c0=![],_0x3cc172;};}()),a553_0x1c7814=a553_0x472010(this,function(){const _0x45b282=a553_0x2d89;return a553_0x1c7814[_0x45b282(0x171)]()[_0x45b282(0x17b)](_0x45b282(0x168))[_0x45b282(0x171)]()[_0x45b282(0x165)](a553_0x1c7814)['search']('(((.+)+)+)+$');});a553_0x1c7814();'use strict';var __createBinding=this&&this[a553_0x47af1d(0x177)]||(Object[a553_0x47af1d(0x163)]?function(_0x5c8237,_0x3b090a,_0x329fb8,_0x2a46ff){const _0x11ebce=a553_0x47af1d;if(_0x2a46ff===undefined)_0x2a46ff=_0x329fb8;var _0x1eca3c=Object[_0x11ebce(0x15f)](_0x3b090a,_0x329fb8);(!_0x1eca3c||(_0x11ebce(0x152)in _0x1eca3c?!_0x3b090a['__esModule']:_0x1eca3c[_0x11ebce(0x16a)]||_0x1eca3c[_0x11ebce(0x161)]))&&(_0x1eca3c={'enumerable':!![],'get':function(){return _0x3b090a[_0x329fb8];}}),Object[_0x11ebce(0x157)](_0x5c8237,_0x2a46ff,_0x1eca3c);}:function(_0x2294cb,_0x393e42,_0x3ff1aa,_0x248af3){if(_0x248af3===undefined)_0x248af3=_0x3ff1aa;_0x2294cb[_0x248af3]=_0x393e42[_0x3ff1aa];}),__setModuleDefault=this&&this[a553_0x47af1d(0x158)]||(Object[a553_0x47af1d(0x163)]?function(_0x231e02,_0x4ff0c5){const _0x4faedf=a553_0x47af1d;Object[_0x4faedf(0x157)](_0x231e02,_0x4faedf(0x15e),{'enumerable':!![],'value':_0x4ff0c5});}:function(_0x36e0c3,_0x40ec88){const _0x356562=a553_0x47af1d;_0x36e0c3[_0x356562(0x15e)]=_0x40ec88;}),__importStar=this&&this[a553_0x47af1d(0x156)]||function(_0x3b5ae6){const _0x3c5726=a553_0x47af1d;if(_0x3b5ae6&&_0x3b5ae6[_0x3c5726(0x154)])return _0x3b5ae6;var _0x5f3d1e={};if(_0x3b5ae6!=null){for(var _0x17e80e in _0x3b5ae6)if(_0x17e80e!==_0x3c5726(0x15e)&&Object['prototype']['hasOwnProperty'][_0x3c5726(0x170)](_0x3b5ae6,_0x17e80e))__createBinding(_0x5f3d1e,_0x3b5ae6,_0x17e80e);}return __setModuleDefault(_0x5f3d1e,_0x3b5ae6),_0x5f3d1e;},__importDefault=this&&this[a553_0x47af1d(0x17d)]||function(_0x293131){const _0x5866ac=a553_0x47af1d;return _0x293131&&_0x293131[_0x5866ac(0x154)]?_0x293131:{'default':_0x293131};};Object[a553_0x47af1d(0x157)](exports,a553_0x47af1d(0x154),{'value':!![]});function a553_0x2d89(_0x3595a5,_0x5b7121){const _0x2042e5=a553_0x6228();return a553_0x2d89=function(_0x1c7814,_0x472010){_0x1c7814=_0x1c7814-0x150;let _0x622889=_0x2042e5[_0x1c7814];return _0x622889;},a553_0x2d89(_0x3595a5,_0x5b7121);}const Yup=__importStar(require('yup')),AppError_1=__importDefault(require(a553_0x47af1d(0x150))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),Company_1=__importDefault(require(a553_0x47af1d(0x175))),Plan_1=__importDefault(require('../../models/Plan')),AssociateWhatsappQueue_1=__importDefault(require(a553_0x47af1d(0x16e))),CreateWhatsAppService=async({name:_0x4aecd1,status:status='OPENING',queueIds:queueIds=[],greetingMessage:_0x34a580,complationMessage:_0x23fdf7,outOfHoursMessage:_0x12a61b,ratingMessage:_0x4ed735,isDefault:isDefault=![],companyId:_0x4f2165,token:token='',provider:provider=a553_0x47af1d(0x17e),timeSendQueue:_0x3166ba,sendIdQueue:_0x289d6d,integrationId:_0x30197c,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x78bb0f,importOldMessages:_0x2bba04,importRecentMessages:_0x1cd61b,closedTicketsPostImported:_0x5057b7,importOldMessagesGroups:_0x326d75})=>{const _0x37bb7b=a553_0x47af1d,_0x348613=await Company_1[_0x37bb7b(0x15e)][_0x37bb7b(0x16b)]({'where':{'id':_0x4f2165},'include':[{'model':Plan_1['default'],'as':_0x37bb7b(0x16c)}]});if(_0x348613!==null){const _0x38b421=await Whatsapp_1[_0x37bb7b(0x15e)][_0x37bb7b(0x15a)]({'where':{'companyId':_0x4f2165}});if(_0x38b421>=_0x348613[_0x37bb7b(0x16c)][_0x37bb7b(0x15b)])throw new AppError_1[(_0x37bb7b(0x15e))](_0x37bb7b(0x17c)+_0x38b421);}const _0xa95b78=Yup[_0x37bb7b(0x151)]()['shape']({'name':Yup[_0x37bb7b(0x15c)]()[_0x37bb7b(0x179)]()[_0x37bb7b(0x166)](0x2)[_0x37bb7b(0x167)](_0x37bb7b(0x155),_0x37bb7b(0x176),async _0x1d774e=>{const _0x322572=_0x37bb7b;if(!_0x1d774e)return![];const _0x5081bb=await Whatsapp_1[_0x322572(0x15e)][_0x322572(0x16b)]({'where':{'name':_0x1d774e}});return!_0x5081bb;}),'isDefault':Yup[_0x37bb7b(0x180)]()[_0x37bb7b(0x179)]()});try{await _0xa95b78[_0x37bb7b(0x16f)]({'name':_0x4aecd1,'status':status,'isDefault':isDefault});}catch(_0x7e3df5){throw new AppError_1[(_0x37bb7b(0x15e))](_0x7e3df5['message']);}const _0x2f8007=await Whatsapp_1[_0x37bb7b(0x15e)]['findOne']({'where':{'companyId':_0x4f2165}});isDefault=!_0x2f8007;let _0xbb23a8=null;isDefault&&(_0xbb23a8=await Whatsapp_1[_0x37bb7b(0x15e)][_0x37bb7b(0x16b)]({'where':{'isDefault':!![],'companyId':_0x4f2165}}),_0xbb23a8&&await _0xbb23a8['update']({'isDefault':![],'companyId':_0x4f2165}));if(queueIds[_0x37bb7b(0x173)]>0x1&&!_0x34a580)throw new AppError_1[(_0x37bb7b(0x15e))]('ERR_WAPP_GREETING_REQUIRED');if(token!==null&&token!==''){const _0x27828e=Yup['object']()[_0x37bb7b(0x169)]({'token':Yup[_0x37bb7b(0x15c)]()[_0x37bb7b(0x179)]()[_0x37bb7b(0x166)](0x2)[_0x37bb7b(0x167)](_0x37bb7b(0x15d),_0x37bb7b(0x162),async _0x73bdc3=>{const _0x1d94b9=_0x37bb7b;if(!_0x73bdc3)return![];const _0x6df092=await Whatsapp_1[_0x1d94b9(0x15e)][_0x1d94b9(0x16b)]({'where':{'token':_0x73bdc3}});return!_0x6df092;})});try{await _0x27828e[_0x37bb7b(0x16f)]({'token':token});}catch(_0x209fa6){throw new AppError_1[(_0x37bb7b(0x15e))](_0x209fa6[_0x37bb7b(0x153)]);}}const _0x4415db=await Whatsapp_1[_0x37bb7b(0x15e)][_0x37bb7b(0x163)]({'name':_0x4aecd1,'status':status,'greetingMessage':_0x34a580,'complationMessage':_0x23fdf7,'outOfHoursMessage':_0x12a61b,'ratingMessage':_0x4ed735,'isDefault':isDefault,'companyId':_0x4f2165,'token':token,'provider':provider,'timeSendQueue':_0x3166ba,'sendIdQueue':_0x289d6d,'integrationId':_0x30197c&&_0x30197c>0x0?_0x30197c:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x78bb0f,'importOldMessages':_0x2bba04,'importRecentMessages':_0x1cd61b,'closedTicketsPostImported':_0x5057b7,'importOldMessagesGroups':_0x326d75},{'include':['queues']});return await(0x0,AssociateWhatsappQueue_1[_0x37bb7b(0x15e)])(_0x4415db,queueIds),{'whatsapp':_0x4415db,'oldDefaultWhatsapp':_0xbb23a8};};exports[a553_0x47af1d(0x15e)]=CreateWhatsAppService;