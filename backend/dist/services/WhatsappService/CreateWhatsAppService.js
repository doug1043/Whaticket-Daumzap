'use strict';const a586_0x450822=a586_0xf461;(function(_0x1bbe91,_0x2cd918){const _0x305a4f=a586_0xf461,_0x5ce44b=_0x1bbe91();while(!![]){try{const _0x39c80c=-parseInt(_0x305a4f(0x183))/0x1+parseInt(_0x305a4f(0x187))/0x2+parseInt(_0x305a4f(0x178))/0x3+-parseInt(_0x305a4f(0x194))/0x4*(-parseInt(_0x305a4f(0x172))/0x5)+parseInt(_0x305a4f(0x168))/0x6*(-parseInt(_0x305a4f(0x193))/0x7)+parseInt(_0x305a4f(0x18a))/0x8*(-parseInt(_0x305a4f(0x164))/0x9)+-parseInt(_0x305a4f(0x17d))/0xa;if(_0x39c80c===_0x2cd918)break;else _0x5ce44b['push'](_0x5ce44b['shift']());}catch(_0x31fd52){_0x5ce44b['push'](_0x5ce44b['shift']());}}}(a586_0x2a95,0x5fa2c));function a586_0xf461(_0x5a2e21,_0x303958){const _0xc39e52=a586_0x2a95();return a586_0xf461=function(_0x657178,_0x339cd9){_0x657178=_0x657178-0x164;let _0x2a9514=_0xc39e52[_0x657178];return _0x2a9514;},a586_0xf461(_0x5a2e21,_0x303958);}function a586_0x2a95(){const _0xabe403=['../../models/Company','prototype','../../errors/AppError','whatsapp','required','yup','toString','4378619uxNTDq','408QZMrnj','ERR_WAPP_GREETING_REQUIRED','getOwnPropertyNames','3652767BgdaMq','getOwnPropertyDescriptor','Check-token','__createBinding','6foVdRV','__importDefault','create','shape','__importStar','count','__esModule','apply','../../models/Whatsapp','(((.+)+)+)+$','30515BPnfTN','validate','update','default','connections','./AssociateWhatsappQueue','1660782QZJIdP','string','findOne','This\x20whatsapp\x20token\x20is\x20already\x20used.','defineProperty','1084220YWMYav','writable','message','__setModuleDefault','test','plan','416428VzjxvG','OPENING','Check-name','search','1543708BXwgwa','object','length','8FaTYIz','min'];a586_0x2a95=function(){return _0xabe403;};return a586_0x2a95();}var __createBinding=this&&this[a586_0x450822(0x167)]||(Object[a586_0x450822(0x16a)]?function(_0x55dbe5,_0x46f4c9,_0x1ba05f,_0x33a5c3){const _0x3aa91d=a586_0x450822;if(_0x33a5c3===undefined)_0x33a5c3=_0x1ba05f;var _0x48b1a6=Object[_0x3aa91d(0x165)](_0x46f4c9,_0x1ba05f);(!_0x48b1a6||('get'in _0x48b1a6?!_0x46f4c9[_0x3aa91d(0x16e)]:_0x48b1a6[_0x3aa91d(0x17e)]||_0x48b1a6['configurable']))&&(_0x48b1a6={'enumerable':!![],'get':function(){return _0x46f4c9[_0x1ba05f];}}),Object[_0x3aa91d(0x17c)](_0x55dbe5,_0x33a5c3,_0x48b1a6);}:function(_0x6b6a78,_0xb7a368,_0x3dee9a,_0x2e033f){if(_0x2e033f===undefined)_0x2e033f=_0x3dee9a;_0x6b6a78[_0x2e033f]=_0xb7a368[_0x3dee9a];}),__setModuleDefault=this&&this[a586_0x450822(0x180)]||(Object[a586_0x450822(0x16a)]?function(_0x1ced41,_0x4da702){const _0x57d359=a586_0x450822;Object['defineProperty'](_0x1ced41,_0x57d359(0x175),{'enumerable':!![],'value':_0x4da702});}:function(_0x1ec534,_0x7f70ce){const _0x3b437c=a586_0x450822;_0x1ec534[_0x3b437c(0x175)]=_0x7f70ce;}),__importStar=this&&this[a586_0x450822(0x16c)]||(function(){const _0x5b2708=(function(){let _0x4182cc=!![];return function(_0xb5a919,_0x247b2e){const _0x2dffa4=_0x4182cc?function(){const _0x47e18d=a586_0xf461;if(_0x247b2e){const _0x4ec836=_0x247b2e[_0x47e18d(0x16f)](_0xb5a919,arguments);return _0x247b2e=null,_0x4ec836;}}:function(){};return _0x4182cc=![],_0x2dffa4;};}()),_0x1e50dc=_0x5b2708(this,function(){const _0x5d1253=a586_0xf461;return _0x1e50dc[_0x5d1253(0x192)]()[_0x5d1253(0x186)](_0x5d1253(0x171))[_0x5d1253(0x192)]()['constructor'](_0x1e50dc)[_0x5d1253(0x186)](_0x5d1253(0x171));});_0x1e50dc();var _0x357557=function(_0x49e6d3){const _0x3d09a1=a586_0xf461;return _0x357557=Object[_0x3d09a1(0x196)]||function(_0x4e1b3e){const _0x90fab1=_0x3d09a1;var _0x2eb944=[];for(var _0x503a97 in _0x4e1b3e)if(Object[_0x90fab1(0x18d)]['hasOwnProperty']['call'](_0x4e1b3e,_0x503a97))_0x2eb944[_0x2eb944['length']]=_0x503a97;return _0x2eb944;},_0x357557(_0x49e6d3);};return function(_0x454283){const _0x5879eb=a586_0xf461;if(_0x454283&&_0x454283[_0x5879eb(0x16e)])return _0x454283;var _0x2e262d={};if(_0x454283!=null){for(var _0x5a5e78=_0x357557(_0x454283),_0x25d687=0x0;_0x25d687<_0x5a5e78[_0x5879eb(0x189)];_0x25d687++)if(_0x5a5e78[_0x25d687]!=='default')__createBinding(_0x2e262d,_0x454283,_0x5a5e78[_0x25d687]);}return __setModuleDefault(_0x2e262d,_0x454283),_0x2e262d;};}()),__importDefault=this&&this[a586_0x450822(0x169)]||function(_0x2054d2){const _0x50f861=a586_0x450822;return _0x2054d2&&_0x2054d2[_0x50f861(0x16e)]?_0x2054d2:{'default':_0x2054d2};};Object[a586_0x450822(0x17c)](exports,a586_0x450822(0x16e),{'value':!![]});const Yup=__importStar(require(a586_0x450822(0x191))),AppError_1=__importDefault(require(a586_0x450822(0x18e))),Whatsapp_1=__importDefault(require(a586_0x450822(0x170))),Company_1=__importDefault(require(a586_0x450822(0x18c))),Plan_1=__importDefault(require('../../models/Plan')),AssociateWhatsappQueue_1=__importDefault(require(a586_0x450822(0x177))),CreateWhatsAppService=async({name:_0x3dc973,status:status=a586_0x450822(0x184),queueIds:queueIds=[],greetingMessage:_0x3a9978,complationMessage:_0x3fd85c,outOfHoursMessage:_0x4a07a2,useRating:_0x131753,ratingMessage:_0xbe9416,transferMessage:_0x4ecd31,isDefault:isDefault=![],companyId:_0x26ba41,token:token='',provider:provider='beta',facebookUserId:_0x21091e,facebookUserToken:_0x27b561,facebookPageUserId:_0x3472c2,tokenMeta:_0x3bdd83,channel:channel=a586_0x450822(0x18f),integrationId:_0x3eb21e,maxUseBotQueues:maxUseBotQueues=0x3,sendIdQueue:_0x205d70,timeSendQueue:_0x5a167a,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:allowGroup=![],importOldMessages:_0x4b73c2,schedules:schedules=[],whenExpireTicket:_0x4cf25f,inactiveMessageTime:_0x4f961b,inactiveMessage:_0x204fb9,automaticRestart:_0x59d959,period:_0x1c1227,lastRestartAt:_0x368995})=>{const _0x50e92a=a586_0x450822,_0xa4345b=await Company_1[_0x50e92a(0x175)][_0x50e92a(0x17a)]({'where':{'id':_0x26ba41},'include':[{'model':Plan_1['default'],'as':'plan'}]});if(_0xa4345b){const _0x3cbe06=await Whatsapp_1[_0x50e92a(0x175)][_0x50e92a(0x16d)]({'where':{'companyId':_0x26ba41,'channel':channel}});if(_0x3cbe06>=_0xa4345b[_0x50e92a(0x182)][_0x50e92a(0x176)])throw new AppError_1[(_0x50e92a(0x175))]('Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20'+_0x3cbe06);}const _0x10e11a=Yup[_0x50e92a(0x188)]()[_0x50e92a(0x16b)]({'name':Yup[_0x50e92a(0x179)]()[_0x50e92a(0x190)]()[_0x50e92a(0x18b)](0x2)['test'](_0x50e92a(0x185),'Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão',async _0x5e3c1f=>{const _0x511791=_0x50e92a;if(!_0x5e3c1f)return![];const _0x455d83=await Whatsapp_1['default'][_0x511791(0x17a)]({'where':{'name':_0x5e3c1f,'companyId':_0x26ba41}});return!_0x455d83;}),'isDefault':Yup['boolean']()[_0x50e92a(0x190)]()});try{await _0x10e11a['validate']({'name':_0x3dc973,'status':status,'isDefault':isDefault});}catch(_0x1490cd){throw new AppError_1[(_0x50e92a(0x175))](_0x1490cd[_0x50e92a(0x17f)]);}const _0x44fe3a=await Whatsapp_1['default'][_0x50e92a(0x17a)]({'where':{'companyId':_0x26ba41}});isDefault=channel===_0x50e92a(0x18f)?!_0x44fe3a:![];let _0x436ad8=null;channel===_0x50e92a(0x18f)&&isDefault&&(_0x436ad8=await Whatsapp_1[_0x50e92a(0x175)][_0x50e92a(0x17a)]({'where':{'isDefault':!![],'companyId':_0x26ba41,'channel':channel}}),_0x436ad8&&await _0x436ad8[_0x50e92a(0x174)]({'isDefault':![]}));if(queueIds['length']>0x1&&!_0x3a9978)throw new AppError_1[(_0x50e92a(0x175))](_0x50e92a(0x195));if(token){const _0x426a32=Yup['object']()[_0x50e92a(0x16b)]({'token':Yup[_0x50e92a(0x179)]()[_0x50e92a(0x190)]()[_0x50e92a(0x18b)](0x2)[_0x50e92a(0x181)](_0x50e92a(0x166),_0x50e92a(0x17b),async _0x21dd93=>{const _0x50489d=_0x50e92a;if(!_0x21dd93)return![];const _0x697997=await Whatsapp_1[_0x50489d(0x175)][_0x50489d(0x17a)]({'where':{'token':_0x21dd93,'channel':channel}});return!_0x697997;})});try{await _0x426a32[_0x50e92a(0x173)]({'token':token});}catch(_0x1a4978){throw new AppError_1[(_0x50e92a(0x175))](_0x1a4978['message']);}}const _0x502798=await Whatsapp_1['default'][_0x50e92a(0x16a)]({'name':_0x3dc973,'status':status,'greetingMessage':_0x3a9978,'complationMessage':_0x3fd85c,'outOfHoursMessage':_0x4a07a2,'useRating':_0x131753,'ratingMessage':_0xbe9416,'transferMessage':_0x4ecd31,'isDefault':isDefault,'companyId':_0x26ba41,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x21091e,'facebookUserToken':_0x27b561,'facebookPageUserId':_0x3472c2,'tokenMeta':_0x3bdd83,'integrationId':_0x3eb21e&&_0x3eb21e>0x0?_0x3eb21e:null,'maxUseBotQueues':maxUseBotQueues,'sendIdQueue':_0x205d70,'timeSendQueue':_0x5a167a,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':allowGroup,'importOldMessages':_0x4b73c2,'schedules':schedules,'whenExpireTicket':_0x4cf25f,'inactiveMessageTime':_0x4f961b,'inactiveMessage':_0x204fb9,'automaticRestart':_0x59d959,'period':_0x1c1227,'lastRestartAt':_0x368995},{'include':['queues']});return await(0x0,AssociateWhatsappQueue_1[_0x50e92a(0x175)])(_0x502798,queueIds),{'whatsapp':_0x502798,'oldDefaultWhatsapp':_0x436ad8};};exports['default']=CreateWhatsAppService;