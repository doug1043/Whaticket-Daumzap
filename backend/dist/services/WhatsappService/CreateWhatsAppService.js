const a561_0x345871=a561_0x5b86;(function(_0x4882b1,_0x4b4bb5){const _0x500c24=a561_0x5b86,_0x3873fc=_0x4882b1();while(!![]){try{const _0x2e296d=-parseInt(_0x500c24(0x197))/0x1+parseInt(_0x500c24(0x19b))/0x2*(-parseInt(_0x500c24(0x195))/0x3)+-parseInt(_0x500c24(0x196))/0x4+parseInt(_0x500c24(0x18d))/0x5+parseInt(_0x500c24(0x18c))/0x6+-parseInt(_0x500c24(0x17e))/0x7+parseInt(_0x500c24(0x1a0))/0x8;if(_0x2e296d===_0x4b4bb5)break;else _0x3873fc['push'](_0x3873fc['shift']());}catch(_0x411bdd){_0x3873fc['push'](_0x3873fc['shift']());}}}(a561_0x2190,0x71903));function a561_0x2190(){const _0x1ad12b=['1802143sVffQP','shape','validate','plan','../../errors/AppError','getOwnPropertyDescriptor','configurable','./AssociateWhatsappQueue','__esModule','../../models/Whatsapp','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','__createBinding','Check-token','message','2422080fBtJMQ','3395940GlFrbv','toString','update','findOne','length','apply','writable','count','450gnpsSR','3036112HTdMJN','926747BvlcIq','required','../../models/Company','string','372bSntVk','__importDefault','__importStar','default','min','10827288KllOEl','get','defineProperty','yup','beta','create','(((.+)+)+)+$','queues','ERR_WAPP_GREETING_REQUIRED','hasOwnProperty','object','test'];a561_0x2190=function(){return _0x1ad12b;};return a561_0x2190();}const a561_0x67d295=(function(){let _0x2e61f0=!![];return function(_0x1bb79f,_0x5a4dec){const _0x580b9c=_0x2e61f0?function(){const _0x34c8f8=a561_0x5b86;if(_0x5a4dec){const _0x21d484=_0x5a4dec[_0x34c8f8(0x192)](_0x1bb79f,arguments);return _0x5a4dec=null,_0x21d484;}}:function(){};return _0x2e61f0=![],_0x580b9c;};}()),a561_0x504661=a561_0x67d295(this,function(){const _0x2e5dd1=a561_0x5b86;return a561_0x504661[_0x2e5dd1(0x18e)]()['search'](_0x2e5dd1(0x1a6))[_0x2e5dd1(0x18e)]()['constructor'](a561_0x504661)['search']('(((.+)+)+)+$');});a561_0x504661();'use strict';function a561_0x5b86(_0x597fed,_0x53869b){const _0x113594=a561_0x2190();return a561_0x5b86=function(_0x504661,_0x67d295){_0x504661=_0x504661-0x179;let _0x2190e8=_0x113594[_0x504661];return _0x2190e8;},a561_0x5b86(_0x597fed,_0x53869b);}var __createBinding=this&&this[a561_0x345871(0x189)]||(Object['create']?function(_0x507201,_0x5d1938,_0x3f0ee9,_0x596b60){const _0x104d43=a561_0x345871;if(_0x596b60===undefined)_0x596b60=_0x3f0ee9;var _0x1756db=Object[_0x104d43(0x183)](_0x5d1938,_0x3f0ee9);(!_0x1756db||(_0x104d43(0x1a1)in _0x1756db?!_0x5d1938[_0x104d43(0x186)]:_0x1756db[_0x104d43(0x193)]||_0x1756db[_0x104d43(0x184)]))&&(_0x1756db={'enumerable':!![],'get':function(){return _0x5d1938[_0x3f0ee9];}}),Object['defineProperty'](_0x507201,_0x596b60,_0x1756db);}:function(_0xaa9e37,_0x63f209,_0x4190fd,_0x339b24){if(_0x339b24===undefined)_0x339b24=_0x4190fd;_0xaa9e37[_0x339b24]=_0x63f209[_0x4190fd];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a561_0x345871(0x1a5)]?function(_0xbc38a7,_0x4902ca){const _0x692de0=a561_0x345871;Object[_0x692de0(0x1a2)](_0xbc38a7,_0x692de0(0x19e),{'enumerable':!![],'value':_0x4902ca});}:function(_0x12750a,_0x1b758c){const _0x26f829=a561_0x345871;_0x12750a[_0x26f829(0x19e)]=_0x1b758c;}),__importStar=this&&this[a561_0x345871(0x19d)]||function(_0x3c2fb9){const _0x3f0b90=a561_0x345871;if(_0x3c2fb9&&_0x3c2fb9[_0x3f0b90(0x186)])return _0x3c2fb9;var _0x2669ab={};if(_0x3c2fb9!=null){for(var _0x5d6a2c in _0x3c2fb9)if(_0x5d6a2c!==_0x3f0b90(0x19e)&&Object['prototype'][_0x3f0b90(0x17b)]['call'](_0x3c2fb9,_0x5d6a2c))__createBinding(_0x2669ab,_0x3c2fb9,_0x5d6a2c);}return __setModuleDefault(_0x2669ab,_0x3c2fb9),_0x2669ab;},__importDefault=this&&this[a561_0x345871(0x19c)]||function(_0x19706b){const _0x34f804=a561_0x345871;return _0x19706b&&_0x19706b[_0x34f804(0x186)]?_0x19706b:{'default':_0x19706b};};Object[a561_0x345871(0x1a2)](exports,'__esModule',{'value':!![]});const Yup=__importStar(require(a561_0x345871(0x1a3))),AppError_1=__importDefault(require(a561_0x345871(0x182))),Whatsapp_1=__importDefault(require(a561_0x345871(0x187))),Company_1=__importDefault(require(a561_0x345871(0x199))),Plan_1=__importDefault(require('../../models/Plan')),AssociateWhatsappQueue_1=__importDefault(require(a561_0x345871(0x185))),CreateWhatsAppService=async({name:_0x476e4b,status:status='OPENING',queueIds:queueIds=[],greetingMessage:_0x23e063,complationMessage:_0xf1cb1f,outOfHoursMessage:_0x48c24d,ratingMessage:_0x107b10,isDefault:isDefault=![],companyId:_0x4d4a4f,token:token='',provider:provider=a561_0x345871(0x1a4),timeSendQueue:_0x4779ff,sendIdQueue:_0x17ba37,promptId:_0x33e9ff,integrationId:_0x284257,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x443eda,importOldMessages:_0x1cab41,importRecentMessages:_0x5e5361,closedTicketsPostImported:_0x1e1335,importOldMessagesGroups:_0x30cf0a})=>{const _0x57907e=a561_0x345871,_0x5782f4=await Company_1[_0x57907e(0x19e)][_0x57907e(0x190)]({'where':{'id':_0x4d4a4f},'include':[{'model':Plan_1['default'],'as':_0x57907e(0x181)}]});if(_0x5782f4!==null){const _0xa439c4=await Whatsapp_1[_0x57907e(0x19e)][_0x57907e(0x194)]({'where':{'companyId':_0x4d4a4f}});if(_0xa439c4>=_0x5782f4[_0x57907e(0x181)]['connections'])throw new AppError_1[(_0x57907e(0x19e))](_0x57907e(0x188)+_0xa439c4);}const _0x11657e=Yup[_0x57907e(0x17c)]()[_0x57907e(0x17f)]({'name':Yup['string']()[_0x57907e(0x198)]()[_0x57907e(0x19f)](0x2)[_0x57907e(0x17d)]('Check-name','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão',async _0x23fe44=>{const _0x1b9240=_0x57907e;if(!_0x23fe44)return![];const _0x15a6b0=await Whatsapp_1[_0x1b9240(0x19e)]['findOne']({'where':{'name':_0x23fe44}});return!_0x15a6b0;}),'isDefault':Yup['boolean']()['required']()});try{await _0x11657e[_0x57907e(0x180)]({'name':_0x476e4b,'status':status,'isDefault':isDefault});}catch(_0x32c406){throw new AppError_1[(_0x57907e(0x19e))](_0x32c406[_0x57907e(0x18b)]);}const _0x116e46=await Whatsapp_1[_0x57907e(0x19e)][_0x57907e(0x190)]({'where':{'companyId':_0x4d4a4f}});isDefault=!_0x116e46;let _0x3bcfcc=null;isDefault&&(_0x3bcfcc=await Whatsapp_1[_0x57907e(0x19e)]['findOne']({'where':{'isDefault':!![],'companyId':_0x4d4a4f}}),_0x3bcfcc&&await _0x3bcfcc[_0x57907e(0x18f)]({'isDefault':![],'companyId':_0x4d4a4f}));if(queueIds[_0x57907e(0x191)]>0x1&&!_0x23e063)throw new AppError_1[(_0x57907e(0x19e))](_0x57907e(0x17a));if(token!==null&&token!==''){const _0x540baf=Yup['object']()[_0x57907e(0x17f)]({'token':Yup[_0x57907e(0x19a)]()[_0x57907e(0x198)]()[_0x57907e(0x19f)](0x2)[_0x57907e(0x17d)](_0x57907e(0x18a),'This\x20whatsapp\x20token\x20is\x20already\x20used.',async _0x34bb0b=>{if(!_0x34bb0b)return![];const _0x35aeaf=await Whatsapp_1['default']['findOne']({'where':{'token':_0x34bb0b}});return!_0x35aeaf;})});try{await _0x540baf[_0x57907e(0x180)]({'token':token});}catch(_0xcf1044){throw new AppError_1['default'](_0xcf1044[_0x57907e(0x18b)]);}}const _0x4c5293=await Whatsapp_1[_0x57907e(0x19e)][_0x57907e(0x1a5)]({'name':_0x476e4b,'status':status,'greetingMessage':_0x23e063,'complationMessage':_0xf1cb1f,'outOfHoursMessage':_0x48c24d,'ratingMessage':_0x107b10,'isDefault':isDefault,'companyId':_0x4d4a4f,'token':token,'provider':provider,'timeSendQueue':_0x4779ff,'sendIdQueue':_0x17ba37,'promptId':_0x33e9ff&&_0x33e9ff>0x0?_0x33e9ff:null,'integrationId':_0x284257&&_0x284257>0x0?_0x284257:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x443eda,'importOldMessages':_0x1cab41,'importRecentMessages':_0x5e5361,'closedTicketsPostImported':_0x1e1335,'importOldMessagesGroups':_0x30cf0a},{'include':[_0x57907e(0x179)]});return await(0x0,AssociateWhatsappQueue_1[_0x57907e(0x19e)])(_0x4c5293,queueIds),{'whatsapp':_0x4c5293,'oldDefaultWhatsapp':_0x3bcfcc};};exports['default']=CreateWhatsAppService;