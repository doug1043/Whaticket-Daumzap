const a562_0x53efa3=a562_0x5c1d;(function(_0x29c9ea,_0x242da7){const _0x5ca4c3=a562_0x5c1d,_0x2a3d87=_0x29c9ea();while(!![]){try{const _0x3f47d0=parseInt(_0x5ca4c3(0x1af))/0x1+-parseInt(_0x5ca4c3(0x181))/0x2+-parseInt(_0x5ca4c3(0x199))/0x3+parseInt(_0x5ca4c3(0x1aa))/0x4*(-parseInt(_0x5ca4c3(0x19f))/0x5)+parseInt(_0x5ca4c3(0x1a5))/0x6*(-parseInt(_0x5ca4c3(0x18c))/0x7)+-parseInt(_0x5ca4c3(0x19a))/0x8*(-parseInt(_0x5ca4c3(0x180))/0x9)+-parseInt(_0x5ca4c3(0x187))/0xa*(parseInt(_0x5ca4c3(0x18f))/0xb);if(_0x3f47d0===_0x242da7)break;else _0x2a3d87['push'](_0x2a3d87['shift']());}catch(_0x2728bd){_0x2a3d87['push'](_0x2a3d87['shift']());}}}(a562_0xfd8a,0xaeae2));const a562_0x30804a=(function(){let _0x523532=!![];return function(_0x3266cd,_0xe9c18a){const _0x209dcc=_0x523532?function(){const _0x3b6241=a562_0x5c1d;if(_0xe9c18a){const _0x59ef3f=_0xe9c18a[_0x3b6241(0x19d)](_0x3266cd,arguments);return _0xe9c18a=null,_0x59ef3f;}}:function(){};return _0x523532=![],_0x209dcc;};}()),a562_0x2e1b81=a562_0x30804a(this,function(){const _0x4d654e=a562_0x5c1d;return a562_0x2e1b81[_0x4d654e(0x18d)]()['search'](_0x4d654e(0x17f))[_0x4d654e(0x18d)]()[_0x4d654e(0x198)](a562_0x2e1b81)[_0x4d654e(0x194)]('(((.+)+)+)+$');});function a562_0x5c1d(_0x560e47,_0x212ed8){const _0x188f8a=a562_0xfd8a();return a562_0x5c1d=function(_0x2e1b81,_0x30804a){_0x2e1b81=_0x2e1b81-0x17f;let _0xfd8a5a=_0x188f8a[_0x2e1b81];return _0xfd8a5a;},a562_0x5c1d(_0x560e47,_0x212ed8);}a562_0x2e1b81();'use strict';var __createBinding=this&&this[a562_0x53efa3(0x182)]||(Object['create']?function(_0x1730be,_0x29ea15,_0x2796ef,_0x28c6f2){const _0x5d29c5=a562_0x53efa3;if(_0x28c6f2===undefined)_0x28c6f2=_0x2796ef;var _0x2a3807=Object[_0x5d29c5(0x195)](_0x29ea15,_0x2796ef);(!_0x2a3807||(_0x5d29c5(0x1a4)in _0x2a3807?!_0x29ea15[_0x5d29c5(0x193)]:_0x2a3807[_0x5d29c5(0x1a1)]||_0x2a3807[_0x5d29c5(0x1a2)]))&&(_0x2a3807={'enumerable':!![],'get':function(){return _0x29ea15[_0x2796ef];}}),Object[_0x5d29c5(0x1a6)](_0x1730be,_0x28c6f2,_0x2a3807);}:function(_0x479966,_0x499110,_0x16de41,_0x2190dc){if(_0x2190dc===undefined)_0x2190dc=_0x16de41;_0x479966[_0x2190dc]=_0x499110[_0x16de41];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x2ca45e,_0x28e92b){const _0x333891=a562_0x53efa3;Object[_0x333891(0x1a6)](_0x2ca45e,_0x333891(0x1a7),{'enumerable':!![],'value':_0x28e92b});}:function(_0xd081f7,_0x176af5){const _0x428f71=a562_0x53efa3;_0xd081f7[_0x428f71(0x1a7)]=_0x176af5;}),__importStar=this&&this['__importStar']||function(_0xe0c90b){const _0x30c469=a562_0x53efa3;if(_0xe0c90b&&_0xe0c90b[_0x30c469(0x193)])return _0xe0c90b;var _0x4e60e7={};if(_0xe0c90b!=null){for(var _0xc65c83 in _0xe0c90b)if(_0xc65c83!=='default'&&Object['prototype'][_0x30c469(0x19e)][_0x30c469(0x190)](_0xe0c90b,_0xc65c83))__createBinding(_0x4e60e7,_0xe0c90b,_0xc65c83);}return __setModuleDefault(_0x4e60e7,_0xe0c90b),_0x4e60e7;},__importDefault=this&&this[a562_0x53efa3(0x1ae)]||function(_0x46fc6a){const _0x5a735e=a562_0x53efa3;return _0x46fc6a&&_0x46fc6a[_0x5a735e(0x193)]?_0x46fc6a:{'default':_0x46fc6a};};Object[a562_0x53efa3(0x1a6)](exports,a562_0x53efa3(0x193),{'value':!![]});function a562_0xfd8a(){const _0xd0351=['33RnUesD','call','plan','../../models/Plan','__esModule','search','getOwnPropertyDescriptor','length','Check-token','constructor','2781558FebIuy','8jHijfL','beta','This\x20whatsapp\x20token\x20is\x20already\x20used.','apply','hasOwnProperty','5aQTFeV','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','writable','configurable','shape','get','426uwyLcl','defineProperty','default','create','OPENING','281420HtLKGw','update','message','count','__importDefault','665007RcWdHu','../../models/Whatsapp','(((.+)+)+)+$','12127329ucwlnl','335218mPFTeG','__createBinding','../../errors/AppError','connections','validate','object','181290hOXrYe','Check-name','test','findOne','queues','7637zOKPlB','toString','required'];a562_0xfd8a=function(){return _0xd0351;};return a562_0xfd8a();}const Yup=__importStar(require('yup')),AppError_1=__importDefault(require(a562_0x53efa3(0x183))),Whatsapp_1=__importDefault(require(a562_0x53efa3(0x1b0))),Company_1=__importDefault(require('../../models/Company')),Plan_1=__importDefault(require(a562_0x53efa3(0x192))),AssociateWhatsappQueue_1=__importDefault(require('./AssociateWhatsappQueue')),CreateWhatsAppService=async({name:_0x13c62f,status:status=a562_0x53efa3(0x1a9),queueIds:queueIds=[],greetingMessage:_0x2b0ca3,complationMessage:_0x5b4326,outOfHoursMessage:_0x15a50a,ratingMessage:_0x4e11fb,isDefault:isDefault=![],companyId:_0x38d37a,token:token='',provider:provider=a562_0x53efa3(0x19b),timeSendQueue:_0x2b860a,sendIdQueue:_0x2c6a45,promptId:_0x486429,integrationId:_0x4d3a93,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x274301,importOldMessages:_0x379e6e,importRecentMessages:_0xfa9daf,closedTicketsPostImported:_0x3c48d6,importOldMessagesGroups:_0x554ea4})=>{const _0x5e6048=a562_0x53efa3,_0xe4a7d8=await Company_1['default'][_0x5e6048(0x18a)]({'where':{'id':_0x38d37a},'include':[{'model':Plan_1[_0x5e6048(0x1a7)],'as':_0x5e6048(0x191)}]});if(_0xe4a7d8!==null){const _0x29b6a7=await Whatsapp_1['default'][_0x5e6048(0x1ad)]({'where':{'companyId':_0x38d37a}});if(_0x29b6a7>=_0xe4a7d8[_0x5e6048(0x191)][_0x5e6048(0x184)])throw new AppError_1[(_0x5e6048(0x1a7))]('Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20'+_0x29b6a7);}const _0x2d314d=Yup[_0x5e6048(0x186)]()[_0x5e6048(0x1a3)]({'name':Yup['string']()[_0x5e6048(0x18e)]()['min'](0x2)[_0x5e6048(0x189)](_0x5e6048(0x188),_0x5e6048(0x1a0),async _0xb6c3c4=>{const _0x45551a=_0x5e6048;if(!_0xb6c3c4)return![];const _0x31d058=await Whatsapp_1[_0x45551a(0x1a7)][_0x45551a(0x18a)]({'where':{'name':_0xb6c3c4}});return!_0x31d058;}),'isDefault':Yup['boolean']()['required']()});try{await _0x2d314d[_0x5e6048(0x185)]({'name':_0x13c62f,'status':status,'isDefault':isDefault});}catch(_0x57d617){throw new AppError_1[(_0x5e6048(0x1a7))](_0x57d617[_0x5e6048(0x1ac)]);}const _0x57fbc7=await Whatsapp_1[_0x5e6048(0x1a7)][_0x5e6048(0x18a)]({'where':{'companyId':_0x38d37a}});isDefault=!_0x57fbc7;let _0x3aa247=null;isDefault&&(_0x3aa247=await Whatsapp_1[_0x5e6048(0x1a7)][_0x5e6048(0x18a)]({'where':{'isDefault':!![],'companyId':_0x38d37a}}),_0x3aa247&&await _0x3aa247[_0x5e6048(0x1ab)]({'isDefault':![],'companyId':_0x38d37a}));if(queueIds[_0x5e6048(0x196)]>0x1&&!_0x2b0ca3)throw new AppError_1[(_0x5e6048(0x1a7))]('ERR_WAPP_GREETING_REQUIRED');if(token!==null&&token!==''){const _0x2d7521=Yup[_0x5e6048(0x186)]()[_0x5e6048(0x1a3)]({'token':Yup['string']()[_0x5e6048(0x18e)]()['min'](0x2)[_0x5e6048(0x189)](_0x5e6048(0x197),_0x5e6048(0x19c),async _0x587c5e=>{const _0x3ce9f7=_0x5e6048;if(!_0x587c5e)return![];const _0x466e28=await Whatsapp_1[_0x3ce9f7(0x1a7)]['findOne']({'where':{'token':_0x587c5e}});return!_0x466e28;})});try{await _0x2d7521[_0x5e6048(0x185)]({'token':token});}catch(_0x3fdd2d){throw new AppError_1[(_0x5e6048(0x1a7))](_0x3fdd2d['message']);}}const _0x29b0b5=await Whatsapp_1[_0x5e6048(0x1a7)][_0x5e6048(0x1a8)]({'name':_0x13c62f,'status':status,'greetingMessage':_0x2b0ca3,'complationMessage':_0x5b4326,'outOfHoursMessage':_0x15a50a,'ratingMessage':_0x4e11fb,'isDefault':isDefault,'companyId':_0x38d37a,'token':token,'provider':provider,'timeSendQueue':_0x2b860a,'sendIdQueue':_0x2c6a45,'promptId':_0x486429&&_0x486429>0x0?_0x486429:null,'integrationId':_0x4d3a93&&_0x4d3a93>0x0?_0x4d3a93:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x274301,'importOldMessages':_0x379e6e,'importRecentMessages':_0xfa9daf,'closedTicketsPostImported':_0x3c48d6,'importOldMessagesGroups':_0x554ea4},{'include':[_0x5e6048(0x18b)]});return await(0x0,AssociateWhatsappQueue_1[_0x5e6048(0x1a7)])(_0x29b0b5,queueIds),{'whatsapp':_0x29b0b5,'oldDefaultWhatsapp':_0x3aa247};};exports['default']=CreateWhatsAppService;