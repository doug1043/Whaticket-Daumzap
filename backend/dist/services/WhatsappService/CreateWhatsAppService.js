'use strict';const a587_0x479073=a587_0x3978;(function(_0x3dfadc,_0x8f385a){const _0x3748de=a587_0x3978,_0x54317a=_0x3dfadc();while(!![]){try{const _0x68c7c8=-parseInt(_0x3748de(0x11c))/0x1*(parseInt(_0x3748de(0x142))/0x2)+parseInt(_0x3748de(0x127))/0x3+-parseInt(_0x3748de(0x118))/0x4*(-parseInt(_0x3748de(0x10b))/0x5)+-parseInt(_0x3748de(0x133))/0x6*(-parseInt(_0x3748de(0x10e))/0x7)+-parseInt(_0x3748de(0x108))/0x8+parseInt(_0x3748de(0x12e))/0x9+parseInt(_0x3748de(0x11d))/0xa*(parseInt(_0x3748de(0x125))/0xb);if(_0x68c7c8===_0x8f385a)break;else _0x54317a['push'](_0x54317a['shift']());}catch(_0x1ce270){_0x54317a['push'](_0x54317a['shift']());}}}(a587_0x5618,0xb171c));var __createBinding=this&&this[a587_0x479073(0x10d)]||(Object[a587_0x479073(0x13e)]?function(_0x1fe122,_0x67ce1b,_0x178a70,_0x139a34){const _0x3beebe=a587_0x479073;if(_0x139a34===undefined)_0x139a34=_0x178a70;var _0x1ebfb9=Object[_0x3beebe(0x134)](_0x67ce1b,_0x178a70);(!_0x1ebfb9||(_0x3beebe(0x111)in _0x1ebfb9?!_0x67ce1b[_0x3beebe(0x11a)]:_0x1ebfb9[_0x3beebe(0x141)]||_0x1ebfb9[_0x3beebe(0x116)]))&&(_0x1ebfb9={'enumerable':!![],'get':function(){return _0x67ce1b[_0x178a70];}}),Object[_0x3beebe(0x12f)](_0x1fe122,_0x139a34,_0x1ebfb9);}:function(_0x58d9de,_0x1c80d3,_0x200fde,_0x383f97){if(_0x383f97===undefined)_0x383f97=_0x200fde;_0x58d9de[_0x383f97]=_0x1c80d3[_0x200fde];}),__setModuleDefault=this&&this[a587_0x479073(0x11f)]||(Object[a587_0x479073(0x13e)]?function(_0x3c5786,_0x5a5aef){const _0x12ba1c=a587_0x479073;Object['defineProperty'](_0x3c5786,_0x12ba1c(0x13c),{'enumerable':!![],'value':_0x5a5aef});}:function(_0x2d57e5,_0x2170bc){const _0x4524ee=a587_0x479073;_0x2d57e5[_0x4524ee(0x13c)]=_0x2170bc;}),__importStar=this&&this[a587_0x479073(0x10a)]||(function(){const _0x100596=(function(){let _0x2c0757=!![];return function(_0x7852d9,_0x3a2217){const _0x5792b4=_0x2c0757?function(){const _0x2f4811=a587_0x3978;if(_0x3a2217){const _0x70a5a2=_0x3a2217[_0x2f4811(0x10f)](_0x7852d9,arguments);return _0x3a2217=null,_0x70a5a2;}}:function(){};return _0x2c0757=![],_0x5792b4;};}()),_0x5ce958=_0x100596(this,function(){const _0x2caa34=a587_0x3978;return _0x5ce958[_0x2caa34(0x114)]()[_0x2caa34(0x121)](_0x2caa34(0x12a))[_0x2caa34(0x114)]()[_0x2caa34(0x12b)](_0x5ce958)[_0x2caa34(0x121)](_0x2caa34(0x12a));});_0x5ce958();var _0x85aa88=function(_0x89060a){const _0x3f1ff6=a587_0x3978;return _0x85aa88=Object[_0x3f1ff6(0x130)]||function(_0x354a80){const _0x1961e3=_0x3f1ff6;var _0x3bf871=[];for(var _0x2e908e in _0x354a80)if(Object['prototype'][_0x1961e3(0x119)][_0x1961e3(0x13a)](_0x354a80,_0x2e908e))_0x3bf871[_0x3bf871[_0x1961e3(0x138)]]=_0x2e908e;return _0x3bf871;},_0x85aa88(_0x89060a);};return function(_0xcf2dd9){const _0x4b38ac=a587_0x3978;if(_0xcf2dd9&&_0xcf2dd9[_0x4b38ac(0x11a)])return _0xcf2dd9;var _0x51e1ba={};if(_0xcf2dd9!=null){for(var _0x4d07e2=_0x85aa88(_0xcf2dd9),_0x3508ec=0x0;_0x3508ec<_0x4d07e2[_0x4b38ac(0x138)];_0x3508ec++)if(_0x4d07e2[_0x3508ec]!=='default')__createBinding(_0x51e1ba,_0xcf2dd9,_0x4d07e2[_0x3508ec]);}return __setModuleDefault(_0x51e1ba,_0xcf2dd9),_0x51e1ba;};}()),__importDefault=this&&this['__importDefault']||function(_0x448c03){return _0x448c03&&_0x448c03['__esModule']?_0x448c03:{'default':_0x448c03};};Object[a587_0x479073(0x12f)](exports,a587_0x479073(0x11a),{'value':!![]});function a587_0x3978(_0x4305f3,_0x2ebed1){const _0x2c13b6=a587_0x5618();return a587_0x3978=function(_0x7c5555,_0x1cfb3d){_0x7c5555=_0x7c5555-0x108;let _0x56181d=_0x2c13b6[_0x7c5555];return _0x56181d;},a587_0x3978(_0x4305f3,_0x2ebed1);}function a587_0x5618(){const _0x173f21=['default','connections','create','min','test','writable','107884FTxycC','11424768JKETAC','beta','__importStar','182050ZdouIU','update','__createBinding','135646VCtIld','apply','boolean','get','required','./AssociateWhatsappQueue','toString','This\x20whatsapp\x20token\x20is\x20already\x20used.','configurable','object','116UdkeDH','hasOwnProperty','__esModule','whatsapp','18pQGvRo','3140fCWxIO','queues','__setModuleDefault','Check-token','search','yup','../../models/Whatsapp','count','7810JCNOqY','shape','2277771zgynEM','string','../../models/Company','(((.+)+)+)+$','constructor','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','5778747jWLeBM','defineProperty','getOwnPropertyNames','Check-name','validate','138bTYTby','getOwnPropertyDescriptor','plan','OPENING','ERR_WAPP_GREETING_REQUIRED','length','message','call','findOne'];a587_0x5618=function(){return _0x173f21;};return a587_0x5618();}const Yup=__importStar(require(a587_0x479073(0x122))),AppError_1=__importDefault(require('../../errors/AppError')),Whatsapp_1=__importDefault(require(a587_0x479073(0x123))),Company_1=__importDefault(require(a587_0x479073(0x129))),Plan_1=__importDefault(require('../../models/Plan')),AssociateWhatsappQueue_1=__importDefault(require(a587_0x479073(0x113))),CreateWhatsAppService=async({name:_0x34c4de,status:status=a587_0x479073(0x136),queueIds:queueIds=[],greetingMessage:_0x12ac8b,complationMessage:_0xf32757,outOfHoursMessage:_0x121bd3,useRating:_0x2f9ef0,ratingMessage:_0x3b1257,transferMessage:_0x7aa71d,isDefault:isDefault=![],companyId:_0x101fbf,token:token='',provider:provider=a587_0x479073(0x109),facebookUserId:_0x507a13,facebookUserToken:_0x60f094,facebookPageUserId:_0x30d794,tokenMeta:_0x4dceb8,channel:channel=a587_0x479073(0x11b),integrationId:_0x4e30a4,maxUseBotQueues:maxUseBotQueues=0x3,sendIdQueue:_0x147957,timeSendQueue:_0x46dae4,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:allowGroup=![],importOldMessages:_0x1884a4,schedules:schedules=[],whenExpireTicket:_0x25c164,inactiveMessageTime:_0x1db200,inactiveMessage:_0x55a4af,automaticRestart:_0x35dfde,period:_0x5821e3,lastRestartAt:_0x420698})=>{const _0x310a16=a587_0x479073,_0x25ac26=await Company_1[_0x310a16(0x13c)]['findOne']({'where':{'id':_0x101fbf},'include':[{'model':Plan_1['default'],'as':_0x310a16(0x135)}]});if(_0x25ac26){const _0x1ca552=await Whatsapp_1[_0x310a16(0x13c)][_0x310a16(0x124)]({'where':{'companyId':_0x101fbf,'channel':channel}});if(_0x1ca552>=_0x25ac26[_0x310a16(0x135)][_0x310a16(0x13d)])throw new AppError_1['default'](_0x310a16(0x12d)+_0x1ca552);}const _0x5211ab=Yup[_0x310a16(0x117)]()[_0x310a16(0x126)]({'name':Yup[_0x310a16(0x128)]()['required']()['min'](0x2)[_0x310a16(0x140)](_0x310a16(0x131),_0x310a16(0x12c),async _0x42e6dc=>{const _0x556b54=_0x310a16;if(!_0x42e6dc)return![];const _0x1c9e5b=await Whatsapp_1[_0x556b54(0x13c)][_0x556b54(0x13b)]({'where':{'name':_0x42e6dc,'companyId':_0x101fbf}});return!_0x1c9e5b;}),'isDefault':Yup[_0x310a16(0x110)]()[_0x310a16(0x112)]()});try{await _0x5211ab['validate']({'name':_0x34c4de,'status':status,'isDefault':isDefault});}catch(_0x15748e){throw new AppError_1['default'](_0x15748e[_0x310a16(0x139)]);}const _0x172144=await Whatsapp_1[_0x310a16(0x13c)]['findOne']({'where':{'companyId':_0x101fbf}});isDefault=channel==='whatsapp'?!_0x172144:![];let _0x3f53bd=null;channel==='whatsapp'&&isDefault&&(_0x3f53bd=await Whatsapp_1[_0x310a16(0x13c)][_0x310a16(0x13b)]({'where':{'isDefault':!![],'companyId':_0x101fbf,'channel':channel}}),_0x3f53bd&&await _0x3f53bd[_0x310a16(0x10c)]({'isDefault':![]}));if(queueIds['length']>0x1&&!_0x12ac8b)throw new AppError_1[(_0x310a16(0x13c))](_0x310a16(0x137));if(token){const _0x64f22f=Yup[_0x310a16(0x117)]()[_0x310a16(0x126)]({'token':Yup[_0x310a16(0x128)]()[_0x310a16(0x112)]()[_0x310a16(0x13f)](0x2)['test'](_0x310a16(0x120),_0x310a16(0x115),async _0x4f95d0=>{const _0x11b291=_0x310a16;if(!_0x4f95d0)return![];const _0x4dbd49=await Whatsapp_1[_0x11b291(0x13c)]['findOne']({'where':{'token':_0x4f95d0,'channel':channel}});return!_0x4dbd49;})});try{await _0x64f22f[_0x310a16(0x132)]({'token':token});}catch(_0x32dad4){throw new AppError_1[(_0x310a16(0x13c))](_0x32dad4['message']);}}const _0x29b81d=await Whatsapp_1[_0x310a16(0x13c)]['create']({'name':_0x34c4de,'status':status,'greetingMessage':_0x12ac8b,'complationMessage':_0xf32757,'outOfHoursMessage':_0x121bd3,'useRating':_0x2f9ef0,'ratingMessage':_0x3b1257,'transferMessage':_0x7aa71d,'isDefault':isDefault,'companyId':_0x101fbf,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x507a13,'facebookUserToken':_0x60f094,'facebookPageUserId':_0x30d794,'tokenMeta':_0x4dceb8,'integrationId':_0x4e30a4&&_0x4e30a4>0x0?_0x4e30a4:null,'maxUseBotQueues':maxUseBotQueues,'sendIdQueue':_0x147957,'timeSendQueue':_0x46dae4,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':allowGroup,'importOldMessages':_0x1884a4,'schedules':schedules,'whenExpireTicket':_0x25c164,'inactiveMessageTime':_0x1db200,'inactiveMessage':_0x55a4af,'automaticRestart':_0x35dfde,'period':_0x5821e3,'lastRestartAt':_0x420698},{'include':[_0x310a16(0x11e)]});return await(0x0,AssociateWhatsappQueue_1[_0x310a16(0x13c)])(_0x29b81d,queueIds),{'whatsapp':_0x29b81d,'oldDefaultWhatsapp':_0x3f53bd};};exports[a587_0x479073(0x13c)]=CreateWhatsAppService;