'use strict';const a711_0x1fbbab=a711_0x3b0e;(function(_0x20d725,_0x1e81f3){const _0x394d33=a711_0x3b0e,_0x351a08=_0x20d725();while(!![]){try{const _0x5ec581=parseInt(_0x394d33(0x105))/0x1+parseInt(_0x394d33(0x11c))/0x2+-parseInt(_0x394d33(0xef))/0x3*(parseInt(_0x394d33(0x100))/0x4)+-parseInt(_0x394d33(0x106))/0x5*(-parseInt(_0x394d33(0x114))/0x6)+-parseInt(_0x394d33(0x118))/0x7+parseInt(_0x394d33(0x119))/0x8*(-parseInt(_0x394d33(0x107))/0x9)+-parseInt(_0x394d33(0x121))/0xa;if(_0x5ec581===_0x1e81f3)break;else _0x351a08['push'](_0x351a08['shift']());}catch(_0x4339fc){_0x351a08['push'](_0x351a08['shift']());}}}(a711_0x1918,0x686b8));function a711_0x3b0e(_0x340525,_0x77276e){const _0x59dd30=a711_0x1918();return a711_0x3b0e=function(_0x2a0db8,_0x4a8fcd){_0x2a0db8=_0x2a0db8-0xed;let _0x19184e=_0x59dd30[_0x2a0db8];return _0x19184e;},a711_0x3b0e(_0x340525,_0x77276e);}var __createBinding=this&&this[a711_0x1fbbab(0x102)]||(Object['create']?function(_0x111c1f,_0x5ab581,_0x3c8006,_0x33f700){const _0x53f59f=a711_0x1fbbab;if(_0x33f700===undefined)_0x33f700=_0x3c8006;var _0x21fae5=Object['getOwnPropertyDescriptor'](_0x5ab581,_0x3c8006);(!_0x21fae5||(_0x53f59f(0x11d)in _0x21fae5?!_0x5ab581['__esModule']:_0x21fae5[_0x53f59f(0xf8)]||_0x21fae5['configurable']))&&(_0x21fae5={'enumerable':!![],'get':function(){return _0x5ab581[_0x3c8006];}}),Object[_0x53f59f(0xfe)](_0x111c1f,_0x33f700,_0x21fae5);}:function(_0x57d4bc,_0x58e461,_0x1192e2,_0x2298a6){if(_0x2298a6===undefined)_0x2298a6=_0x1192e2;_0x57d4bc[_0x2298a6]=_0x58e461[_0x1192e2];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a711_0x1fbbab(0xfd)]?function(_0x5f3039,_0x5a6974){const _0x2f6867=a711_0x1fbbab;Object[_0x2f6867(0xfe)](_0x5f3039,_0x2f6867(0xee),{'enumerable':!![],'value':_0x5a6974});}:function(_0x4b8d47,_0x5064b5){_0x4b8d47['default']=_0x5064b5;}),__importStar=this&&this['__importStar']||(function(){const _0x2a86e8=(function(){let _0x377ebb=!![];return function(_0x12288a,_0xa509b9){const _0x244589=_0x377ebb?function(){const _0x6ed8bb=a711_0x3b0e;if(_0xa509b9){const _0x54f856=_0xa509b9[_0x6ed8bb(0xf5)](_0x12288a,arguments);return _0xa509b9=null,_0x54f856;}}:function(){};return _0x377ebb=![],_0x244589;};}()),_0x603551=_0x2a86e8(this,function(){const _0xc85b3a=a711_0x3b0e;return _0x603551[_0xc85b3a(0x10c)]()[_0xc85b3a(0xf0)](_0xc85b3a(0xfc))[_0xc85b3a(0x10c)]()[_0xc85b3a(0x10e)](_0x603551)[_0xc85b3a(0xf0)](_0xc85b3a(0xfc));});_0x603551();var _0x5e79ec=function(_0x1de58f){const _0x59aa44=a711_0x3b0e;return _0x5e79ec=Object[_0x59aa44(0xf1)]||function(_0x1454d9){const _0x2ae726=_0x59aa44;var _0x36e28e=[];for(var _0x220bc0 in _0x1454d9)if(Object['prototype'][_0x2ae726(0x104)][_0x2ae726(0x124)](_0x1454d9,_0x220bc0))_0x36e28e[_0x36e28e[_0x2ae726(0xfb)]]=_0x220bc0;return _0x36e28e;},_0x5e79ec(_0x1de58f);};return function(_0x2d9365){const _0x5107e5=a711_0x3b0e;if(_0x2d9365&&_0x2d9365[_0x5107e5(0x11b)])return _0x2d9365;var _0x31e9a7={};if(_0x2d9365!=null){for(var _0xe4181d=_0x5e79ec(_0x2d9365),_0x1f4f41=0x0;_0x1f4f41<_0xe4181d[_0x5107e5(0xfb)];_0x1f4f41++)if(_0xe4181d[_0x1f4f41]!==_0x5107e5(0xee))__createBinding(_0x31e9a7,_0x2d9365,_0xe4181d[_0x1f4f41]);}return __setModuleDefault(_0x31e9a7,_0x2d9365),_0x31e9a7;};}()),__importDefault=this&&this[a711_0x1fbbab(0x11e)]||function(_0x391a49){const _0x1373ca=a711_0x1fbbab;return _0x391a49&&_0x391a49[_0x1373ca(0x11b)]?_0x391a49:{'default':_0x391a49};};Object[a711_0x1fbbab(0xfe)](exports,a711_0x1fbbab(0x11b),{'value':!![]});const Yup=__importStar(require(a711_0x1fbbab(0xf3))),AppError_1=__importDefault(require(a711_0x1fbbab(0x10d))),Whatsapp_1=__importDefault(require(a711_0x1fbbab(0x111))),Company_1=__importDefault(require(a711_0x1fbbab(0xf4))),Plan_1=__importDefault(require(a711_0x1fbbab(0x120))),AssociateWhatsappQueue_1=__importDefault(require('./AssociateWhatsappQueue')),AssociateWhatsappFlow_1=__importDefault(require('./AssociateWhatsappFlow')),CreateWhatsAppService=async({name:_0x37712a,status:status=a711_0x1fbbab(0x11a),queueIds:queueIds=[],flowIds:flowIds=[],greetingMessage:_0x359a13,greetingAcceptedMessage:_0x50083f,complationMessage:_0x1edb34,outOfHoursMessage:_0x5f2cb0,useRating:_0x233075,ratingMessage:_0xc5a58e,transferMessage:_0x1d005e,sendTransferMessage:_0x220e33,sendGreetingAccepted:_0x3fb33d,sendRejectCall:_0x57e4e7,rejectCallMessage:_0xc49251,isDefault:isDefault=![],companyId:_0x26e3a3,token:token='',provider:provider='beta',facebookUserId:_0x2b6e8a,facebookUserToken:_0x5a5809,facebookPageUserId:_0x3ed510,tokenMeta:_0x574279,channel:channel=a711_0x1fbbab(0x10f),integrationId:_0x395d73,maxUseBotQueues:maxUseBotQueues=0x3,sendIdQueue:_0x39c194,timeSendQueue:_0x5cbf3d,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:_0x4a3a9b,allowGroup:allowGroup=![],importOldMessages:_0x207ca8,whenExpireTicket:_0x471866,inactiveMessageTime:_0x59c374,inactiveMessage:_0xcf6dd6,automaticRestart:_0x152229,period:_0x70910a,lastRestartAt:_0x33d598,collectiveVacationMessage:_0x5b8d41,collectiveVacationStart:_0x2e6e05,collectiveVacationEnd:_0x5d0142})=>{const _0x408a97=a711_0x1fbbab,_0x4481f3=await Company_1['default']['findOne']({'where':{'id':_0x26e3a3},'include':[{'model':Plan_1['default'],'as':_0x408a97(0xff)}]});if(_0x4481f3){const _0x18f77a=await Whatsapp_1[_0x408a97(0xee)][_0x408a97(0xfa)]({'where':{'companyId':_0x26e3a3,'channel':channel}});if(_0x18f77a>=_0x4481f3[_0x408a97(0xff)][_0x408a97(0x117)])throw new AppError_1[(_0x408a97(0xee))](_0x408a97(0x125)+_0x18f77a);}const _0x5542cc=Yup[_0x408a97(0x11f)]()[_0x408a97(0xed)]({'name':Yup[_0x408a97(0xf9)]()[_0x408a97(0x112)]()['min'](0x2)[_0x408a97(0x108)](_0x408a97(0x115),_0x408a97(0x109),async _0x2ed5b3=>{const _0x5e667=_0x408a97;if(!_0x2ed5b3)return![];const _0x46479c=await Whatsapp_1[_0x5e667(0xee)]['findOne']({'where':{'name':_0x2ed5b3,'companyId':_0x26e3a3}});return!_0x46479c;}),'isDefault':Yup[_0x408a97(0x110)]()['required']()});try{await _0x5542cc[_0x408a97(0x113)]({'name':_0x37712a,'status':status,'isDefault':isDefault});}catch(_0x2d7832){throw new AppError_1[(_0x408a97(0xee))](_0x2d7832[_0x408a97(0x10a)]);}const _0x316b08=await Whatsapp_1[_0x408a97(0xee)]['findOne']({'where':{'companyId':_0x26e3a3}});isDefault=channel===_0x408a97(0x10f)?!_0x316b08:![];let _0x4d459a=null;channel===_0x408a97(0x10f)&&isDefault&&(_0x4d459a=await Whatsapp_1[_0x408a97(0xee)]['findOne']({'where':{'isDefault':!![],'companyId':_0x26e3a3,'channel':channel}}),_0x4d459a&&await _0x4d459a[_0x408a97(0x116)]({'isDefault':![]}));if(queueIds[_0x408a97(0xfb)]>0x1&&!_0x359a13)throw new AppError_1[(_0x408a97(0xee))]('ERR_WAPP_GREETING_REQUIRED');if(token){const _0x2fd33b=Yup[_0x408a97(0x11f)]()[_0x408a97(0xed)]({'token':Yup[_0x408a97(0xf9)]()[_0x408a97(0x112)]()['min'](0x2)['test'](_0x408a97(0xf2),_0x408a97(0xf6),async _0x44b0b5=>{const _0x1a4cbf=_0x408a97;if(!_0x44b0b5)return![];const _0x2d108e=await Whatsapp_1[_0x1a4cbf(0xee)][_0x1a4cbf(0x103)]({'where':{'token':_0x44b0b5,'channel':channel}});return!_0x2d108e;})});try{await _0x2fd33b[_0x408a97(0x113)]({'token':token});}catch(_0x56f776){throw new AppError_1['default'](_0x56f776[_0x408a97(0x10a)]);}}const _0x9b5cb9=parseInt(expiresTicket?.[_0x408a97(0x10c)]()||'0',0xa),_0x59de55=parseInt(_0x59c374?.['toString']()||'0',0xa),_0x5d8866=_0x4a3a9b?.['trim']()||'',_0x29d847=_0xcf6dd6?.[_0x408a97(0x122)]()||'';if(_0x9b5cb9>0x0&&!_0x5d8866)throw new AppError_1['default'](_0x408a97(0x10b));if(_0x5d8866&&_0x9b5cb9===0x0)throw new AppError_1['default'](_0x408a97(0x101));if(_0x59de55>0x0&&!_0x29d847)throw new AppError_1[(_0x408a97(0xee))](_0x408a97(0xf7));if(_0x29d847&&_0x59de55===0x0)throw new AppError_1[(_0x408a97(0xee))](_0x408a97(0x123));const _0x7f6e2f=await Whatsapp_1[_0x408a97(0xee)][_0x408a97(0xfd)]({'name':_0x37712a,'status':status,'greetingMessage':_0x359a13,'greetingAcceptedMessage':_0x50083f,'complationMessage':_0x1edb34,'outOfHoursMessage':_0x5f2cb0,'useRating':_0x233075,'ratingMessage':_0xc5a58e,'transferMessage':_0x1d005e,'sendTransferMessage':_0x220e33,'sendGreetingAccepted':_0x3fb33d,'sendRejectCall':_0x57e4e7,'rejectCallMessage':_0xc49251,'isDefault':isDefault,'companyId':_0x26e3a3,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x2b6e8a,'facebookUserToken':_0x5a5809,'facebookPageUserId':_0x3ed510,'tokenMeta':_0x574279,'integrationId':_0x395d73&&_0x395d73>0x0?_0x395d73:null,'maxUseBotQueues':maxUseBotQueues,'sendIdQueue':_0x39c194,'timeSendQueue':_0x5cbf3d,'expiresTicket':expiresTicket,'expiresInactiveMessage':_0x4a3a9b,'allowGroup':allowGroup,'importOldMessages':_0x207ca8,'whenExpireTicket':_0x471866,'inactiveMessageTime':_0x59c374,'inactiveMessage':_0xcf6dd6,'automaticRestart':_0x152229,'period':_0x70910a,'lastRestartAt':_0x33d598,'collectiveVacationMessage':_0x5b8d41,'collectiveVacationStart':_0x2e6e05||null,'collectiveVacationEnd':_0x5d0142||null},{'include':['queues']});return await(0x0,AssociateWhatsappQueue_1[_0x408a97(0xee)])(_0x7f6e2f,queueIds),await(0x0,AssociateWhatsappFlow_1[_0x408a97(0xee)])(_0x7f6e2f,flowIds),{'whatsapp':_0x7f6e2f,'oldDefaultWhatsapp':_0x4d459a};};exports[a711_0x1fbbab(0xee)]=CreateWhatsAppService;function a711_0x1918(){const _0xeb7c8b=['__esModule','1607992lzaOja','get','__importDefault','object','../../models/Plan','982310pVGNQi','trim','Defina\x20um\x20tempo\x20para\x20aviso\x20maior\x20que\x200\x20ou\x20remova\x20a\x20mensagem','call','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','shape','default','921519GbTwvh','search','getOwnPropertyNames','Check-token','yup','../../models/Company','apply','This\x20whatsapp\x20token\x20is\x20already\x20used.','Defina\x20uma\x20mensagem\x20de\x20aviso\x20de\x20inatividade\x20ou\x20configure\x20o\x20tempo\x20para\x200','writable','string','count','length','(((.+)+)+)+$','create','defineProperty','plan','4aWRtGk','Defina\x20um\x20tempo\x20de\x20encerramento\x20maior\x20que\x200\x20ou\x20remova\x20a\x20mensagem','__createBinding','findOne','hasOwnProperty','222238MemWrP','4125dCaMAO','86760TXtkAJ','test','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','message','Defina\x20uma\x20mensagem\x20de\x20encerramento\x20por\x20inatividade\x20ou\x20configure\x20o\x20tempo\x20para\x200','toString','../../errors/AppError','constructor','whatsapp','boolean','../../models/Whatsapp','required','validate','2352mucUZT','Check-name','update','connections','3480722ZpHphN','16cmKBtX','OPENING'];a711_0x1918=function(){return _0xeb7c8b;};return a711_0x1918();}