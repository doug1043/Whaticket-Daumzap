const a561_0x1ab72d=a561_0x1f19;function a561_0x13a9(){const _0x42214a=['queues','1994502sFPpgO','defineProperty','__createBinding','__setModuleDefault','36189tEgfWo','10ISbctF','../../models/Company','connections','findOne','plan','OPENING','get','259665bNvuaK','writable','200BxZFUZ','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','validate','default','(((.+)+)+)+$','search','__importDefault','../../errors/AppError','ERR_WAPP_GREETING_REQUIRED','shape','length','../../models/Whatsapp','2IlzGft','apply','message','count','configurable','./AssociateWhatsappQueue','test','7645198TFQcXN','create','call','This\x20whatsapp\x20token\x20is\x20already\x20used.','string','required','664PMGPmH','toString','yup','__esModule','3413788boIPCp','getOwnPropertyDescriptor','Check-name','constructor','boolean','min','46412EVJgWh','433091RCIcyn','hasOwnProperty','Check-token','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20'];a561_0x13a9=function(){return _0x42214a;};return a561_0x13a9();}(function(_0x11555c,_0x4c8630){const _0x363ae1=a561_0x1f19,_0x100e55=_0x11555c();while(!![]){try{const _0x2c42e1=parseInt(_0x363ae1(0x169))/0x1+parseInt(_0x363ae1(0x188))/0x2*(parseInt(_0x363ae1(0x17a))/0x3)+parseInt(_0x363ae1(0x168))/0x4*(-parseInt(_0x363ae1(0x17c))/0x5)+parseInt(_0x363ae1(0x16e))/0x6+-parseInt(_0x363ae1(0x199))/0x7+-parseInt(_0x363ae1(0x195))/0x8*(parseInt(_0x363ae1(0x172))/0x9)+-parseInt(_0x363ae1(0x173))/0xa*(-parseInt(_0x363ae1(0x18f))/0xb);if(_0x2c42e1===_0x4c8630)break;else _0x100e55['push'](_0x100e55['shift']());}catch(_0x20b88a){_0x100e55['push'](_0x100e55['shift']());}}}(a561_0x13a9,0x3fd9e));const a561_0x34cc74=(function(){let _0x18d1de=!![];return function(_0x417521,_0x11d29a){const _0x13f174=_0x18d1de?function(){const _0x23bae1=a561_0x1f19;if(_0x11d29a){const _0x299892=_0x11d29a[_0x23bae1(0x189)](_0x417521,arguments);return _0x11d29a=null,_0x299892;}}:function(){};return _0x18d1de=![],_0x13f174;};}()),a561_0x4ed67c=a561_0x34cc74(this,function(){const _0x42f960=a561_0x1f19;return a561_0x4ed67c[_0x42f960(0x196)]()['search'](_0x42f960(0x180))[_0x42f960(0x196)]()[_0x42f960(0x19c)](a561_0x4ed67c)[_0x42f960(0x181)](_0x42f960(0x180));});a561_0x4ed67c();function a561_0x1f19(_0x3ac15c,_0x4257a4){const _0x14635f=a561_0x13a9();return a561_0x1f19=function(_0x4ed67c,_0x34cc74){_0x4ed67c=_0x4ed67c-0x166;let _0x13a907=_0x14635f[_0x4ed67c];return _0x13a907;},a561_0x1f19(_0x3ac15c,_0x4257a4);}'use strict';var __createBinding=this&&this[a561_0x1ab72d(0x170)]||(Object[a561_0x1ab72d(0x190)]?function(_0x3e46f6,_0x464d79,_0x3d3833,_0x4da2c8){const _0x5a2d59=a561_0x1ab72d;if(_0x4da2c8===undefined)_0x4da2c8=_0x3d3833;var _0x1d057b=Object[_0x5a2d59(0x19a)](_0x464d79,_0x3d3833);(!_0x1d057b||(_0x5a2d59(0x179)in _0x1d057b?!_0x464d79[_0x5a2d59(0x198)]:_0x1d057b[_0x5a2d59(0x17b)]||_0x1d057b[_0x5a2d59(0x18c)]))&&(_0x1d057b={'enumerable':!![],'get':function(){return _0x464d79[_0x3d3833];}}),Object[_0x5a2d59(0x16f)](_0x3e46f6,_0x4da2c8,_0x1d057b);}:function(_0x3c686e,_0x2f376d,_0x136536,_0x478137){if(_0x478137===undefined)_0x478137=_0x136536;_0x3c686e[_0x478137]=_0x2f376d[_0x136536];}),__setModuleDefault=this&&this[a561_0x1ab72d(0x171)]||(Object[a561_0x1ab72d(0x190)]?function(_0x54be75,_0x172397){const _0x2908db=a561_0x1ab72d;Object[_0x2908db(0x16f)](_0x54be75,_0x2908db(0x17f),{'enumerable':!![],'value':_0x172397});}:function(_0x579d83,_0x3c6454){_0x579d83['default']=_0x3c6454;}),__importStar=this&&this['__importStar']||function(_0xd8ef9b){const _0x27b2bb=a561_0x1ab72d;if(_0xd8ef9b&&_0xd8ef9b['__esModule'])return _0xd8ef9b;var _0x42ce1f={};if(_0xd8ef9b!=null){for(var _0x49f35f in _0xd8ef9b)if(_0x49f35f!==_0x27b2bb(0x17f)&&Object['prototype'][_0x27b2bb(0x16a)][_0x27b2bb(0x191)](_0xd8ef9b,_0x49f35f))__createBinding(_0x42ce1f,_0xd8ef9b,_0x49f35f);}return __setModuleDefault(_0x42ce1f,_0xd8ef9b),_0x42ce1f;},__importDefault=this&&this[a561_0x1ab72d(0x182)]||function(_0x144f19){const _0x2a166a=a561_0x1ab72d;return _0x144f19&&_0x144f19[_0x2a166a(0x198)]?_0x144f19:{'default':_0x144f19};};Object['defineProperty'](exports,a561_0x1ab72d(0x198),{'value':!![]});const Yup=__importStar(require(a561_0x1ab72d(0x197))),AppError_1=__importDefault(require(a561_0x1ab72d(0x183))),Whatsapp_1=__importDefault(require(a561_0x1ab72d(0x187))),Company_1=__importDefault(require(a561_0x1ab72d(0x174))),Plan_1=__importDefault(require('../../models/Plan')),AssociateWhatsappQueue_1=__importDefault(require(a561_0x1ab72d(0x18d))),CreateWhatsAppService=async({name:_0x3f8885,status:status=a561_0x1ab72d(0x178),queueIds:queueIds=[],greetingMessage:_0x1e40de,complationMessage:_0x5b6005,outOfHoursMessage:_0x12121a,ratingMessage:_0x59940a,isDefault:isDefault=![],companyId:_0x4c59dc,token:token='',provider:provider='beta',timeSendQueue:_0x1576a8,sendIdQueue:_0x55f949,promptId:_0x3c9d41,integrationId:_0x6a1240,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x48383e,importOldMessages:_0x3de2cb,importRecentMessages:_0x331639,closedTicketsPostImported:_0x2f240f,importOldMessagesGroups:_0x3b0edf})=>{const _0x4d4f35=a561_0x1ab72d,_0x472ebe=await Company_1[_0x4d4f35(0x17f)][_0x4d4f35(0x176)]({'where':{'id':_0x4c59dc},'include':[{'model':Plan_1[_0x4d4f35(0x17f)],'as':'plan'}]});if(_0x472ebe!==null){const _0x275664=await Whatsapp_1[_0x4d4f35(0x17f)][_0x4d4f35(0x18b)]({'where':{'companyId':_0x4c59dc}});if(_0x275664>=_0x472ebe[_0x4d4f35(0x177)][_0x4d4f35(0x175)])throw new AppError_1[(_0x4d4f35(0x17f))](_0x4d4f35(0x16c)+_0x275664);}const _0x5d4316=Yup['object']()[_0x4d4f35(0x185)]({'name':Yup[_0x4d4f35(0x193)]()[_0x4d4f35(0x194)]()[_0x4d4f35(0x167)](0x2)['test'](_0x4d4f35(0x19b),_0x4d4f35(0x17d),async _0x3b6a61=>{const _0x4cc1ad=_0x4d4f35;if(!_0x3b6a61)return![];const _0x5a45cc=await Whatsapp_1[_0x4cc1ad(0x17f)][_0x4cc1ad(0x176)]({'where':{'name':_0x3b6a61}});return!_0x5a45cc;}),'isDefault':Yup[_0x4d4f35(0x166)]()[_0x4d4f35(0x194)]()});try{await _0x5d4316[_0x4d4f35(0x17e)]({'name':_0x3f8885,'status':status,'isDefault':isDefault});}catch(_0x22479b){throw new AppError_1[(_0x4d4f35(0x17f))](_0x22479b[_0x4d4f35(0x18a)]);}const _0x5d8831=await Whatsapp_1['default']['findOne']({'where':{'companyId':_0x4c59dc}});isDefault=!_0x5d8831;let _0x1a19d9=null;isDefault&&(_0x1a19d9=await Whatsapp_1[_0x4d4f35(0x17f)][_0x4d4f35(0x176)]({'where':{'isDefault':!![],'companyId':_0x4c59dc}}),_0x1a19d9&&await _0x1a19d9['update']({'isDefault':![],'companyId':_0x4c59dc}));if(queueIds[_0x4d4f35(0x186)]>0x1&&!_0x1e40de)throw new AppError_1[(_0x4d4f35(0x17f))](_0x4d4f35(0x184));if(token!==null&&token!==''){const _0xa629b7=Yup['object']()['shape']({'token':Yup[_0x4d4f35(0x193)]()[_0x4d4f35(0x194)]()[_0x4d4f35(0x167)](0x2)[_0x4d4f35(0x18e)](_0x4d4f35(0x16b),_0x4d4f35(0x192),async _0x2727cb=>{const _0x13187e=_0x4d4f35;if(!_0x2727cb)return![];const _0x112f50=await Whatsapp_1[_0x13187e(0x17f)][_0x13187e(0x176)]({'where':{'token':_0x2727cb}});return!_0x112f50;})});try{await _0xa629b7[_0x4d4f35(0x17e)]({'token':token});}catch(_0x133f7c){throw new AppError_1[(_0x4d4f35(0x17f))](_0x133f7c['message']);}}const _0x423378=await Whatsapp_1[_0x4d4f35(0x17f)][_0x4d4f35(0x190)]({'name':_0x3f8885,'status':status,'greetingMessage':_0x1e40de,'complationMessage':_0x5b6005,'outOfHoursMessage':_0x12121a,'ratingMessage':_0x59940a,'isDefault':isDefault,'companyId':_0x4c59dc,'token':token,'provider':provider,'timeSendQueue':_0x1576a8,'sendIdQueue':_0x55f949,'promptId':_0x3c9d41&&_0x3c9d41>0x0?_0x3c9d41:null,'integrationId':_0x6a1240&&_0x6a1240>0x0?_0x6a1240:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x48383e,'importOldMessages':_0x3de2cb,'importRecentMessages':_0x331639,'closedTicketsPostImported':_0x2f240f,'importOldMessagesGroups':_0x3b0edf},{'include':[_0x4d4f35(0x16d)]});return await(0x0,AssociateWhatsappQueue_1[_0x4d4f35(0x17f)])(_0x423378,queueIds),{'whatsapp':_0x423378,'oldDefaultWhatsapp':_0x1a19d9};};exports[a561_0x1ab72d(0x17f)]=CreateWhatsAppService;