function a563_0x5862(_0x3d2fa4,_0x1d4778){const _0x32e962=a563_0x498f();return a563_0x5862=function(_0x3e9bd3,_0x5f4348){_0x3e9bd3=_0x3e9bd3-0x1b4;let _0x498f26=_0x32e962[_0x3e9bd3];return _0x498f26;},a563_0x5862(_0x3d2fa4,_0x1d4778);}const a563_0x2e2111=a563_0x5862;(function(_0x5cfcfe,_0x2dd1d9){const _0x3ea8cc=a563_0x5862,_0x438ccd=_0x5cfcfe();while(!![]){try{const _0x346d91=-parseInt(_0x3ea8cc(0x1bc))/0x1*(-parseInt(_0x3ea8cc(0x1ce))/0x2)+parseInt(_0x3ea8cc(0x1c0))/0x3+-parseInt(_0x3ea8cc(0x1e0))/0x4+parseInt(_0x3ea8cc(0x1e1))/0x5*(parseInt(_0x3ea8cc(0x1cb))/0x6)+-parseInt(_0x3ea8cc(0x1df))/0x7*(-parseInt(_0x3ea8cc(0x1cd))/0x8)+-parseInt(_0x3ea8cc(0x1c1))/0x9*(parseInt(_0x3ea8cc(0x1e6))/0xa)+parseInt(_0x3ea8cc(0x1de))/0xb*(-parseInt(_0x3ea8cc(0x1dc))/0xc);if(_0x346d91===_0x2dd1d9)break;else _0x438ccd['push'](_0x438ccd['shift']());}catch(_0x20fbe7){_0x438ccd['push'](_0x438ccd['shift']());}}}(a563_0x498f,0x875dd));const a563_0x5f4348=(function(){let _0x38871e=!![];return function(_0x4a2747,_0x49a94c){const _0x1381e6=_0x38871e?function(){const _0x45f5cd=a563_0x5862;if(_0x49a94c){const _0xd05ce5=_0x49a94c[_0x45f5cd(0x1ba)](_0x4a2747,arguments);return _0x49a94c=null,_0xd05ce5;}}:function(){};return _0x38871e=![],_0x1381e6;};}()),a563_0x3e9bd3=a563_0x5f4348(this,function(){const _0x1f8cb9=a563_0x5862;return a563_0x3e9bd3[_0x1f8cb9(0x1d0)]()[_0x1f8cb9(0x1c5)](_0x1f8cb9(0x1e5))[_0x1f8cb9(0x1d0)]()['constructor'](a563_0x3e9bd3)[_0x1f8cb9(0x1c5)]('(((.+)+)+)+$');});a563_0x3e9bd3();'use strict';var __createBinding=this&&this[a563_0x2e2111(0x1e4)]||(Object[a563_0x2e2111(0x1d9)]?function(_0x12e169,_0x135764,_0x530b46,_0x2cc1e5){const _0x4f0c71=a563_0x2e2111;if(_0x2cc1e5===undefined)_0x2cc1e5=_0x530b46;var _0x56c992=Object['getOwnPropertyDescriptor'](_0x135764,_0x530b46);(!_0x56c992||(_0x4f0c71(0x1d1)in _0x56c992?!_0x135764[_0x4f0c71(0x1cf)]:_0x56c992[_0x4f0c71(0x1e2)]||_0x56c992[_0x4f0c71(0x1b5)]))&&(_0x56c992={'enumerable':!![],'get':function(){return _0x135764[_0x530b46];}}),Object[_0x4f0c71(0x1bb)](_0x12e169,_0x2cc1e5,_0x56c992);}:function(_0x340508,_0x66388d,_0x2c41c3,_0x2c72e0){if(_0x2c72e0===undefined)_0x2c72e0=_0x2c41c3;_0x340508[_0x2c72e0]=_0x66388d[_0x2c41c3];}),__setModuleDefault=this&&this[a563_0x2e2111(0x1c9)]||(Object[a563_0x2e2111(0x1d9)]?function(_0x34ab59,_0x6b4942){const _0x380420=a563_0x2e2111;Object[_0x380420(0x1bb)](_0x34ab59,'default',{'enumerable':!![],'value':_0x6b4942});}:function(_0x20f07d,_0x5ab901){const _0x4fd87a=a563_0x2e2111;_0x20f07d[_0x4fd87a(0x1d2)]=_0x5ab901;}),__importStar=this&&this[a563_0x2e2111(0x1da)]||function(_0x5d6dfd){const _0x5dbd4b=a563_0x2e2111;if(_0x5d6dfd&&_0x5d6dfd['__esModule'])return _0x5d6dfd;var _0x47acbb={};if(_0x5d6dfd!=null){for(var _0x4b4bf9 in _0x5d6dfd)if(_0x4b4bf9!=='default'&&Object[_0x5dbd4b(0x1b9)][_0x5dbd4b(0x1be)]['call'](_0x5d6dfd,_0x4b4bf9))__createBinding(_0x47acbb,_0x5d6dfd,_0x4b4bf9);}return __setModuleDefault(_0x47acbb,_0x5d6dfd),_0x47acbb;},__importDefault=this&&this[a563_0x2e2111(0x1b7)]||function(_0x77db50){const _0x536ba2=a563_0x2e2111;return _0x77db50&&_0x77db50[_0x536ba2(0x1cf)]?_0x77db50:{'default':_0x77db50};};function a563_0x498f(){const _0x1e9b90=['count','OPENING','validate','create','__importStar','yup','12yhDFMB','Check-token','8055993KZDQbX','217iDwPGQ','1835092yhFbYE','5QvVmIL','writable','../../errors/AppError','__createBinding','(((.+)+)+)+$','190GeFlhz','Check-name','boolean','configurable','../../models/Whatsapp','__importDefault','ERR_WAPP_GREETING_REQUIRED','prototype','apply','defineProperty','10031OXeQGY','./AssociateWhatsappQueue','hasOwnProperty','queues','2463273RuwJPz','282303xiCXhP','beta','update','findOne','search','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','message','shape','__setModuleDefault','plan','3487938eDgsEU','../../models/Plan','182824XUtMyn','46vsJDck','__esModule','toString','get','default','min','test','../../models/Company'];a563_0x498f=function(){return _0x1e9b90;};return a563_0x498f();}Object[a563_0x2e2111(0x1bb)](exports,a563_0x2e2111(0x1cf),{'value':!![]});const Yup=__importStar(require(a563_0x2e2111(0x1db))),AppError_1=__importDefault(require(a563_0x2e2111(0x1e3))),Whatsapp_1=__importDefault(require(a563_0x2e2111(0x1b6))),Company_1=__importDefault(require(a563_0x2e2111(0x1d5))),Plan_1=__importDefault(require(a563_0x2e2111(0x1cc))),AssociateWhatsappQueue_1=__importDefault(require(a563_0x2e2111(0x1bd))),CreateWhatsAppService=async({name:_0x3dd14b,status:status=a563_0x2e2111(0x1d7),queueIds:queueIds=[],greetingMessage:_0x52fad2,complationMessage:_0x371802,outOfHoursMessage:_0x1d5555,ratingMessage:_0x353ef3,isDefault:isDefault=![],companyId:_0x1a62d2,token:token='',provider:provider=a563_0x2e2111(0x1c2),timeSendQueue:_0x107f0a,sendIdQueue:_0x338292,promptId:_0x411d3f,integrationId:_0x109ed9,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x24214b,importOldMessages:_0x24cfa2,importRecentMessages:_0x108707,closedTicketsPostImported:_0xfb32ce,importOldMessagesGroups:_0x137200})=>{const _0x37a91a=a563_0x2e2111,_0x3f8046=await Company_1[_0x37a91a(0x1d2)]['findOne']({'where':{'id':_0x1a62d2},'include':[{'model':Plan_1[_0x37a91a(0x1d2)],'as':_0x37a91a(0x1ca)}]});if(_0x3f8046!==null){const _0x1509e5=await Whatsapp_1['default'][_0x37a91a(0x1d6)]({'where':{'companyId':_0x1a62d2}});if(_0x1509e5>=_0x3f8046[_0x37a91a(0x1ca)]['connections'])throw new AppError_1[(_0x37a91a(0x1d2))](_0x37a91a(0x1c6)+_0x1509e5);}const _0x59c7ab=Yup['object']()[_0x37a91a(0x1c8)]({'name':Yup['string']()['required']()[_0x37a91a(0x1d3)](0x2)[_0x37a91a(0x1d4)](_0x37a91a(0x1e7),'Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão',async _0x38f649=>{const _0x43ccef=_0x37a91a;if(!_0x38f649)return![];const _0x133eea=await Whatsapp_1[_0x43ccef(0x1d2)][_0x43ccef(0x1c4)]({'where':{'name':_0x38f649}});return!_0x133eea;}),'isDefault':Yup[_0x37a91a(0x1b4)]()['required']()});try{await _0x59c7ab[_0x37a91a(0x1d8)]({'name':_0x3dd14b,'status':status,'isDefault':isDefault});}catch(_0x518496){throw new AppError_1[(_0x37a91a(0x1d2))](_0x518496[_0x37a91a(0x1c7)]);}const _0xb0b96d=await Whatsapp_1[_0x37a91a(0x1d2)][_0x37a91a(0x1c4)]({'where':{'companyId':_0x1a62d2}});isDefault=!_0xb0b96d;let _0x49e78f=null;isDefault&&(_0x49e78f=await Whatsapp_1[_0x37a91a(0x1d2)][_0x37a91a(0x1c4)]({'where':{'isDefault':!![],'companyId':_0x1a62d2}}),_0x49e78f&&await _0x49e78f[_0x37a91a(0x1c3)]({'isDefault':![],'companyId':_0x1a62d2}));if(queueIds['length']>0x1&&!_0x52fad2)throw new AppError_1[(_0x37a91a(0x1d2))](_0x37a91a(0x1b8));if(token!==null&&token!==''){const _0x39fd98=Yup['object']()[_0x37a91a(0x1c8)]({'token':Yup['string']()['required']()[_0x37a91a(0x1d3)](0x2)[_0x37a91a(0x1d4)](_0x37a91a(0x1dd),'This\x20whatsapp\x20token\x20is\x20already\x20used.',async _0x5d07e8=>{const _0x582b2e=_0x37a91a;if(!_0x5d07e8)return![];const _0x318743=await Whatsapp_1[_0x582b2e(0x1d2)][_0x582b2e(0x1c4)]({'where':{'token':_0x5d07e8}});return!_0x318743;})});try{await _0x39fd98[_0x37a91a(0x1d8)]({'token':token});}catch(_0x1beaf7){throw new AppError_1['default'](_0x1beaf7['message']);}}const _0x2077e3=await Whatsapp_1['default'][_0x37a91a(0x1d9)]({'name':_0x3dd14b,'status':status,'greetingMessage':_0x52fad2,'complationMessage':_0x371802,'outOfHoursMessage':_0x1d5555,'ratingMessage':_0x353ef3,'isDefault':isDefault,'companyId':_0x1a62d2,'token':token,'provider':provider,'timeSendQueue':_0x107f0a,'sendIdQueue':_0x338292,'promptId':_0x411d3f&&_0x411d3f>0x0?_0x411d3f:null,'integrationId':_0x109ed9&&_0x109ed9>0x0?_0x109ed9:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x24214b,'importOldMessages':_0x24cfa2,'importRecentMessages':_0x108707,'closedTicketsPostImported':_0xfb32ce,'importOldMessagesGroups':_0x137200},{'include':[_0x37a91a(0x1bf)]});return await(0x0,AssociateWhatsappQueue_1[_0x37a91a(0x1d2)])(_0x2077e3,queueIds),{'whatsapp':_0x2077e3,'oldDefaultWhatsapp':_0x49e78f};};exports[a563_0x2e2111(0x1d2)]=CreateWhatsAppService;