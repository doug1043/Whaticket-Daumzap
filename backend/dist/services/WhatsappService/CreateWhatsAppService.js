'use strict';const a712_0x574382=a712_0x358b;(function(_0x3b0264,_0x234b4e){const _0x302bb9=a712_0x358b,_0x309a6f=_0x3b0264();while(!![]){try{const _0x17f6a3=-parseInt(_0x302bb9(0x1a4))/0x1*(parseInt(_0x302bb9(0x1d8))/0x2)+parseInt(_0x302bb9(0x1af))/0x3*(parseInt(_0x302bb9(0x1c7))/0x4)+parseInt(_0x302bb9(0x1ae))/0x5+-parseInt(_0x302bb9(0x1d9))/0x6*(parseInt(_0x302bb9(0x1b6))/0x7)+-parseInt(_0x302bb9(0x1ca))/0x8*(-parseInt(_0x302bb9(0x1b3))/0x9)+-parseInt(_0x302bb9(0x1b9))/0xa+parseInt(_0x302bb9(0x1a6))/0xb*(parseInt(_0x302bb9(0x1d6))/0xc);if(_0x17f6a3===_0x234b4e)break;else _0x309a6f['push'](_0x309a6f['shift']());}catch(_0x22f2ce){_0x309a6f['push'](_0x309a6f['shift']());}}}(a712_0x2ced,0xf3b5f));function a712_0x358b(_0x5a2120,_0x4c919e){const _0x901b95=a712_0x2ced();return a712_0x358b=function(_0x7101d5,_0x2c52eb){_0x7101d5=_0x7101d5-0x1a2;let _0x2ced11=_0x901b95[_0x7101d5];return _0x2ced11;},a712_0x358b(_0x5a2120,_0x4c919e);}var __createBinding=this&&this['__createBinding']||(Object[a712_0x574382(0x1cd)]?function(_0x246da6,_0x2ae0ab,_0x55c008,_0x28d827){const _0x3dcb04=a712_0x574382;if(_0x28d827===undefined)_0x28d827=_0x55c008;var _0x204af4=Object['getOwnPropertyDescriptor'](_0x2ae0ab,_0x55c008);(!_0x204af4||('get'in _0x204af4?!_0x2ae0ab['__esModule']:_0x204af4[_0x3dcb04(0x1bd)]||_0x204af4[_0x3dcb04(0x1a2)]))&&(_0x204af4={'enumerable':!![],'get':function(){return _0x2ae0ab[_0x55c008];}}),Object[_0x3dcb04(0x1ba)](_0x246da6,_0x28d827,_0x204af4);}:function(_0x490607,_0x1d3700,_0x1af1a9,_0x1d81b7){if(_0x1d81b7===undefined)_0x1d81b7=_0x1af1a9;_0x490607[_0x1d81b7]=_0x1d3700[_0x1af1a9];}),__setModuleDefault=this&&this[a712_0x574382(0x1b7)]||(Object[a712_0x574382(0x1cd)]?function(_0x1ebe6a,_0x49ba16){const _0x5c2602=a712_0x574382;Object['defineProperty'](_0x1ebe6a,_0x5c2602(0x1cb),{'enumerable':!![],'value':_0x49ba16});}:function(_0x5068b6,_0x1fab7b){_0x5068b6['default']=_0x1fab7b;}),__importStar=this&&this[a712_0x574382(0x1a9)]||(function(){const _0x128abe=(function(){let _0x361998=!![];return function(_0x4d6fae,_0x4032f7){const _0x49c4cf=_0x361998?function(){const _0x520aa7=a712_0x358b;if(_0x4032f7){const _0x308f21=_0x4032f7[_0x520aa7(0x1c3)](_0x4d6fae,arguments);return _0x4032f7=null,_0x308f21;}}:function(){};return _0x361998=![],_0x49c4cf;};}()),_0x4d3ccf=_0x128abe(this,function(){const _0x753ac9=a712_0x358b;return _0x4d3ccf[_0x753ac9(0x1d0)]()[_0x753ac9(0x1ac)](_0x753ac9(0x1d4))[_0x753ac9(0x1d0)]()[_0x753ac9(0x1b1)](_0x4d3ccf)[_0x753ac9(0x1ac)](_0x753ac9(0x1d4));});_0x4d3ccf();var _0x54099f=function(_0x4d2b5b){const _0x1fbc31=a712_0x358b;return _0x54099f=Object[_0x1fbc31(0x1b5)]||function(_0x3c70d9){const _0x520100=_0x1fbc31;var _0x2c8ded=[];for(var _0x3081cc in _0x3c70d9)if(Object['prototype'][_0x520100(0x1c6)]['call'](_0x3c70d9,_0x3081cc))_0x2c8ded[_0x2c8ded[_0x520100(0x1bb)]]=_0x3081cc;return _0x2c8ded;},_0x54099f(_0x4d2b5b);};return function(_0x50a555){const _0x2d4eee=a712_0x358b;if(_0x50a555&&_0x50a555[_0x2d4eee(0x1a5)])return _0x50a555;var _0x2f27e7={};if(_0x50a555!=null){for(var _0x2423f0=_0x54099f(_0x50a555),_0x510e05=0x0;_0x510e05<_0x2423f0[_0x2d4eee(0x1bb)];_0x510e05++)if(_0x2423f0[_0x510e05]!=='default')__createBinding(_0x2f27e7,_0x50a555,_0x2423f0[_0x510e05]);}return __setModuleDefault(_0x2f27e7,_0x50a555),_0x2f27e7;};}()),__importDefault=this&&this[a712_0x574382(0x1ab)]||function(_0x4e29fb){const _0x3937e0=a712_0x574382;return _0x4e29fb&&_0x4e29fb[_0x3937e0(0x1a5)]?_0x4e29fb:{'default':_0x4e29fb};};Object[a712_0x574382(0x1ba)](exports,'__esModule',{'value':!![]});function a712_0x2ced(){const _0x3bde11=['trim','2902APptii','__esModule','11QjHTKg','required','../../errors/AppError','__importStar','plan','__importDefault','search','queues','6160510Wbxvbv','9EvHpmP','Check-token','constructor','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','17757FyfgZC','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','getOwnPropertyNames','56kQKVok','__setModuleDefault','This\x20whatsapp\x20token\x20is\x20already\x20used.','19247040tbQzGO','defineProperty','length','test','writable','findOne','../../models/Plan','../../models/Whatsapp','validate','min','apply','object','./AssociateWhatsappQueue','hasOwnProperty','1248812nxeBpw','shape','ERR_WAPP_GREETING_REQUIRED','4968tejKIh','default','update','create','../../models/Company','message','toString','string','whatsapp','Defina\x20uma\x20mensagem\x20de\x20aviso\x20de\x20inatividade\x20ou\x20configure\x20o\x20tempo\x20para\x200','(((.+)+)+)+$','connections','20184804cxuciT','count','652QlJTCe','905262trELYx','./AssociateWhatsappFlow','configurable'];a712_0x2ced=function(){return _0x3bde11;};return a712_0x2ced();}const Yup=__importStar(require('yup')),AppError_1=__importDefault(require(a712_0x574382(0x1a8))),Whatsapp_1=__importDefault(require(a712_0x574382(0x1c0))),Company_1=__importDefault(require(a712_0x574382(0x1ce))),Plan_1=__importDefault(require(a712_0x574382(0x1bf))),AssociateWhatsappQueue_1=__importDefault(require(a712_0x574382(0x1c5))),AssociateWhatsappFlow_1=__importDefault(require(a712_0x574382(0x1da))),CreateWhatsAppService=async({name:_0x2161dc,status:status='OPENING',queueIds:queueIds=[],flowIds:flowIds=[],greetingMessage:_0x20a670,greetingAcceptedMessage:_0xd7209d,complationMessage:_0x1df76c,outOfHoursMessage:_0x2e2637,useRating:_0x1843cd,ratingMessage:_0x5be7c4,transferMessage:_0x408176,sendTransferMessage:_0x1c55db,sendGreetingAccepted:_0x5e4602,sendRejectCall:_0x113d7e,rejectCallMessage:_0x515625,isDefault:isDefault=![],companyId:_0x169843,token:token='',provider:provider='beta',facebookUserId:_0x16150b,facebookUserToken:_0xef23e4,facebookPageUserId:_0x24d69b,tokenMeta:_0x1bda2b,channel:channel=a712_0x574382(0x1d2),integrationId:_0x5d4626,maxUseBotQueues:maxUseBotQueues=0x3,sendIdQueue:_0x47a7f8,timeSendQueue:_0x112aea,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:_0x172001,allowGroup:allowGroup=![],importOldMessages:_0x484102,whenExpireTicket:_0x2c1150,inactiveMessageTime:_0x5044f9,inactiveMessage:_0x5c3269,automaticRestart:_0x4cff1f,period:_0x479ad8,lastRestartAt:_0x17dd36,collectiveVacationMessage:_0x59671e,collectiveVacationStart:_0x38622f,collectiveVacationEnd:_0x98966a})=>{const _0x300f74=a712_0x574382,_0x523d6e=await Company_1[_0x300f74(0x1cb)][_0x300f74(0x1be)]({'where':{'id':_0x169843},'include':[{'model':Plan_1[_0x300f74(0x1cb)],'as':_0x300f74(0x1aa)}]});if(_0x523d6e){const _0x62da9f=await Whatsapp_1[_0x300f74(0x1cb)][_0x300f74(0x1d7)]({'where':{'companyId':_0x169843,'channel':channel}});if(_0x62da9f>=_0x523d6e[_0x300f74(0x1aa)][_0x300f74(0x1d5)])throw new AppError_1[(_0x300f74(0x1cb))](_0x300f74(0x1b2)+_0x62da9f);}const _0x393515=Yup[_0x300f74(0x1c4)]()['shape']({'name':Yup[_0x300f74(0x1d1)]()[_0x300f74(0x1a7)]()[_0x300f74(0x1c2)](0x2)[_0x300f74(0x1bc)]('Check-name',_0x300f74(0x1b4),async _0x2e76c2=>{const _0x3284ae=_0x300f74;if(!_0x2e76c2)return![];const _0x5779e0=await Whatsapp_1[_0x3284ae(0x1cb)][_0x3284ae(0x1be)]({'where':{'name':_0x2e76c2,'companyId':_0x169843}});return!_0x5779e0;}),'isDefault':Yup['boolean']()['required']()});try{await _0x393515[_0x300f74(0x1c1)]({'name':_0x2161dc,'status':status,'isDefault':isDefault});}catch(_0x2bb382){throw new AppError_1[(_0x300f74(0x1cb))](_0x2bb382['message']);}const _0x57db42=await Whatsapp_1[_0x300f74(0x1cb)][_0x300f74(0x1be)]({'where':{'companyId':_0x169843}});isDefault=channel===_0x300f74(0x1d2)?!_0x57db42:![];let _0x1bd95d=null;channel===_0x300f74(0x1d2)&&isDefault&&(_0x1bd95d=await Whatsapp_1[_0x300f74(0x1cb)]['findOne']({'where':{'isDefault':!![],'companyId':_0x169843,'channel':channel}}),_0x1bd95d&&await _0x1bd95d[_0x300f74(0x1cc)]({'isDefault':![]}));if(queueIds[_0x300f74(0x1bb)]>0x1&&!_0x20a670)throw new AppError_1['default'](_0x300f74(0x1c9));if(token){const _0x18932c=Yup[_0x300f74(0x1c4)]()[_0x300f74(0x1c8)]({'token':Yup[_0x300f74(0x1d1)]()['required']()[_0x300f74(0x1c2)](0x2)[_0x300f74(0x1bc)](_0x300f74(0x1b0),_0x300f74(0x1b8),async _0x16d648=>{const _0x37ad97=_0x300f74;if(!_0x16d648)return![];const _0x541915=await Whatsapp_1[_0x37ad97(0x1cb)][_0x37ad97(0x1be)]({'where':{'token':_0x16d648,'channel':channel}});return!_0x541915;})});try{await _0x18932c[_0x300f74(0x1c1)]({'token':token});}catch(_0xfa1d71){throw new AppError_1[(_0x300f74(0x1cb))](_0xfa1d71[_0x300f74(0x1cf)]);}}const _0x37af22=parseInt(expiresTicket?.[_0x300f74(0x1d0)]()||'0',0xa),_0x1138bc=parseInt(_0x5044f9?.[_0x300f74(0x1d0)]()||'0',0xa),_0x151e87=_0x172001?.['trim']()||'',_0xe726e1=_0x5c3269?.[_0x300f74(0x1a3)]()||'';if(_0x37af22>0x0&&!_0x151e87)throw new AppError_1[(_0x300f74(0x1cb))]('Defina\x20uma\x20mensagem\x20de\x20encerramento\x20por\x20inatividade\x20ou\x20configure\x20o\x20tempo\x20para\x200');if(_0x151e87&&_0x37af22===0x0)throw new AppError_1[(_0x300f74(0x1cb))]('Defina\x20um\x20tempo\x20de\x20encerramento\x20maior\x20que\x200\x20ou\x20remova\x20a\x20mensagem');if(_0x1138bc>0x0&&!_0xe726e1)throw new AppError_1[(_0x300f74(0x1cb))](_0x300f74(0x1d3));if(_0xe726e1&&_0x1138bc===0x0)throw new AppError_1[(_0x300f74(0x1cb))]('Defina\x20um\x20tempo\x20para\x20aviso\x20maior\x20que\x200\x20ou\x20remova\x20a\x20mensagem');const _0x25a619=await Whatsapp_1[_0x300f74(0x1cb)][_0x300f74(0x1cd)]({'name':_0x2161dc,'status':status,'greetingMessage':_0x20a670,'greetingAcceptedMessage':_0xd7209d,'complationMessage':_0x1df76c,'outOfHoursMessage':_0x2e2637,'useRating':_0x1843cd,'ratingMessage':_0x5be7c4,'transferMessage':_0x408176,'sendTransferMessage':_0x1c55db,'sendGreetingAccepted':_0x5e4602,'sendRejectCall':_0x113d7e,'rejectCallMessage':_0x515625,'isDefault':isDefault,'companyId':_0x169843,'token':token,'provider':provider,'channel':channel,'facebookUserId':_0x16150b,'facebookUserToken':_0xef23e4,'facebookPageUserId':_0x24d69b,'tokenMeta':_0x1bda2b,'integrationId':_0x5d4626&&_0x5d4626>0x0?_0x5d4626:null,'maxUseBotQueues':maxUseBotQueues,'sendIdQueue':_0x47a7f8,'timeSendQueue':_0x112aea,'expiresTicket':expiresTicket,'expiresInactiveMessage':_0x172001,'allowGroup':allowGroup,'importOldMessages':_0x484102,'whenExpireTicket':_0x2c1150,'inactiveMessageTime':_0x5044f9,'inactiveMessage':_0x5c3269,'automaticRestart':_0x4cff1f,'period':_0x479ad8,'lastRestartAt':_0x17dd36,'collectiveVacationMessage':_0x59671e,'collectiveVacationStart':_0x38622f||null,'collectiveVacationEnd':_0x98966a||null},{'include':[_0x300f74(0x1ad)]});return await(0x0,AssociateWhatsappQueue_1['default'])(_0x25a619,queueIds),await(0x0,AssociateWhatsappFlow_1[_0x300f74(0x1cb)])(_0x25a619,flowIds),{'whatsapp':_0x25a619,'oldDefaultWhatsapp':_0x1bd95d};};exports[a712_0x574382(0x1cb)]=CreateWhatsAppService;