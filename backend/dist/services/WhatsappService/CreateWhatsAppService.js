const a564_0x4ba538=a564_0x2b70;(function(_0x49649d,_0x12e0c2){const _0x3a26a2=a564_0x2b70,_0xb3ff32=_0x49649d();while(!![]){try{const _0x3bb6c1=parseInt(_0x3a26a2(0x12b))/0x1+-parseInt(_0x3a26a2(0x13c))/0x2+parseInt(_0x3a26a2(0x13a))/0x3+parseInt(_0x3a26a2(0x14f))/0x4+-parseInt(_0x3a26a2(0x132))/0x5*(-parseInt(_0x3a26a2(0x13b))/0x6)+-parseInt(_0x3a26a2(0x12c))/0x7*(-parseInt(_0x3a26a2(0x131))/0x8)+-parseInt(_0x3a26a2(0x151))/0x9;if(_0x3bb6c1===_0x12e0c2)break;else _0xb3ff32['push'](_0xb3ff32['shift']());}catch(_0x5b2020){_0xb3ff32['push'](_0xb3ff32['shift']());}}}(a564_0xa514,0x1abbf));const a564_0x1e807f=(function(){let _0x49b1b2=!![];return function(_0x1d54b3,_0x2e486d){const _0x19a288=_0x49b1b2?function(){const _0x41a702=a564_0x2b70;if(_0x2e486d){const _0x3cfcbe=_0x2e486d[_0x41a702(0x126)](_0x1d54b3,arguments);return _0x2e486d=null,_0x3cfcbe;}}:function(){};return _0x49b1b2=![],_0x19a288;};}()),a564_0x103de9=a564_0x1e807f(this,function(){const _0x5c26d7=a564_0x2b70;return a564_0x103de9[_0x5c26d7(0x128)]()[_0x5c26d7(0x129)](_0x5c26d7(0x14a))[_0x5c26d7(0x128)]()[_0x5c26d7(0x12f)](a564_0x103de9)[_0x5c26d7(0x129)](_0x5c26d7(0x14a));});function a564_0xa514(){const _0x7278d8=['../../errors/AppError','constructor','queues','146456MynShV','74905QbYycD','validate','required','ERR_WAPP_GREETING_REQUIRED','hasOwnProperty','../../models/Company','__importDefault','findOne','171141dIrVgm','48mSonDr','301832EQdtpa','__esModule','OPENING','Check-token','min','../../models/Whatsapp','prototype','__createBinding','length','__importStar','defineProperty','beta','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','(((.+)+)+)+$','plan','create','string','count','462136sVtSCP','default','2832588hYRerI','object','shape','test','./AssociateWhatsappQueue','get','This\x20whatsapp\x20token\x20is\x20already\x20used.','call','../../models/Plan','yup','writable','message','apply','update','toString','search','connections','209494YLJLeS','28clxiqs','configurable'];a564_0xa514=function(){return _0x7278d8;};return a564_0xa514();}a564_0x103de9();'use strict';var __createBinding=this&&this[a564_0x4ba538(0x143)]||(Object['create']?function(_0x30ff3b,_0x56a67a,_0x46288f,_0x202bb5){const _0x5ecb5d=a564_0x4ba538;if(_0x202bb5===undefined)_0x202bb5=_0x46288f;var _0x13a26e=Object['getOwnPropertyDescriptor'](_0x56a67a,_0x46288f);(!_0x13a26e||(_0x5ecb5d(0x156)in _0x13a26e?!_0x56a67a[_0x5ecb5d(0x13d)]:_0x13a26e[_0x5ecb5d(0x124)]||_0x13a26e[_0x5ecb5d(0x12d)]))&&(_0x13a26e={'enumerable':!![],'get':function(){return _0x56a67a[_0x46288f];}}),Object[_0x5ecb5d(0x146)](_0x30ff3b,_0x202bb5,_0x13a26e);}:function(_0x470784,_0x49b3eb,_0x3b71ad,_0x43815e){if(_0x43815e===undefined)_0x43815e=_0x3b71ad;_0x470784[_0x43815e]=_0x49b3eb[_0x3b71ad];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a564_0x4ba538(0x14c)]?function(_0x2a5a2a,_0x36f374){const _0xc7e33f=a564_0x4ba538;Object[_0xc7e33f(0x146)](_0x2a5a2a,_0xc7e33f(0x150),{'enumerable':!![],'value':_0x36f374});}:function(_0x36656d,_0x36ed10){_0x36656d['default']=_0x36ed10;}),__importStar=this&&this[a564_0x4ba538(0x145)]||function(_0x3773c2){const _0x38c9f4=a564_0x4ba538;if(_0x3773c2&&_0x3773c2[_0x38c9f4(0x13d)])return _0x3773c2;var _0x37e67b={};if(_0x3773c2!=null){for(var _0x11a23a in _0x3773c2)if(_0x11a23a!==_0x38c9f4(0x150)&&Object[_0x38c9f4(0x142)][_0x38c9f4(0x136)][_0x38c9f4(0x158)](_0x3773c2,_0x11a23a))__createBinding(_0x37e67b,_0x3773c2,_0x11a23a);}return __setModuleDefault(_0x37e67b,_0x3773c2),_0x37e67b;},__importDefault=this&&this[a564_0x4ba538(0x138)]||function(_0x1acfa9){return _0x1acfa9&&_0x1acfa9['__esModule']?_0x1acfa9:{'default':_0x1acfa9};};Object['defineProperty'](exports,'__esModule',{'value':!![]});function a564_0x2b70(_0x5b4655,_0x4417eb){const _0x2d49cb=a564_0xa514();return a564_0x2b70=function(_0x103de9,_0x1e807f){_0x103de9=_0x103de9-0x123;let _0xa51422=_0x2d49cb[_0x103de9];return _0xa51422;},a564_0x2b70(_0x5b4655,_0x4417eb);}const Yup=__importStar(require(a564_0x4ba538(0x123))),AppError_1=__importDefault(require(a564_0x4ba538(0x12e))),Whatsapp_1=__importDefault(require(a564_0x4ba538(0x141))),Company_1=__importDefault(require(a564_0x4ba538(0x137))),Plan_1=__importDefault(require(a564_0x4ba538(0x159))),AssociateWhatsappQueue_1=__importDefault(require(a564_0x4ba538(0x155))),CreateWhatsAppService=async({name:_0x2e5f38,status:status=a564_0x4ba538(0x13e),queueIds:queueIds=[],greetingMessage:_0x24fbab,complationMessage:_0x21d6b0,outOfHoursMessage:_0x187aef,ratingMessage:_0x3659bb,isDefault:isDefault=![],companyId:_0x324b10,token:token='',provider:provider=a564_0x4ba538(0x147),timeSendQueue:_0x26f025,sendIdQueue:_0x43a00b,promptId:_0x474aa4,integrationId:_0x18cbad,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x45bce0,importOldMessages:_0x398b65,importRecentMessages:_0xbd17a3,closedTicketsPostImported:_0x86ab04,importOldMessagesGroups:_0x259315})=>{const _0x571d48=a564_0x4ba538,_0x32bbf6=await Company_1[_0x571d48(0x150)][_0x571d48(0x139)]({'where':{'id':_0x324b10},'include':[{'model':Plan_1[_0x571d48(0x150)],'as':_0x571d48(0x14b)}]});if(_0x32bbf6!==null){const _0x5d999a=await Whatsapp_1['default'][_0x571d48(0x14e)]({'where':{'companyId':_0x324b10}});if(_0x5d999a>=_0x32bbf6[_0x571d48(0x14b)][_0x571d48(0x12a)])throw new AppError_1['default'](_0x571d48(0x148)+_0x5d999a);}const _0x4014e0=Yup[_0x571d48(0x152)]()[_0x571d48(0x153)]({'name':Yup[_0x571d48(0x14d)]()[_0x571d48(0x134)]()[_0x571d48(0x140)](0x2)[_0x571d48(0x154)]('Check-name',_0x571d48(0x149),async _0x46237c=>{const _0x2402a8=_0x571d48;if(!_0x46237c)return![];const _0x4273f3=await Whatsapp_1[_0x2402a8(0x150)][_0x2402a8(0x139)]({'where':{'name':_0x46237c}});return!_0x4273f3;}),'isDefault':Yup['boolean']()[_0x571d48(0x134)]()});try{await _0x4014e0[_0x571d48(0x133)]({'name':_0x2e5f38,'status':status,'isDefault':isDefault});}catch(_0x5e7e44){throw new AppError_1['default'](_0x5e7e44[_0x571d48(0x125)]);}const _0x9fce99=await Whatsapp_1['default'][_0x571d48(0x139)]({'where':{'companyId':_0x324b10}});isDefault=!_0x9fce99;let _0x36da94=null;isDefault&&(_0x36da94=await Whatsapp_1[_0x571d48(0x150)]['findOne']({'where':{'isDefault':!![],'companyId':_0x324b10}}),_0x36da94&&await _0x36da94[_0x571d48(0x127)]({'isDefault':![],'companyId':_0x324b10}));if(queueIds[_0x571d48(0x144)]>0x1&&!_0x24fbab)throw new AppError_1[(_0x571d48(0x150))](_0x571d48(0x135));if(token!==null&&token!==''){const _0x53ff25=Yup[_0x571d48(0x152)]()[_0x571d48(0x153)]({'token':Yup[_0x571d48(0x14d)]()[_0x571d48(0x134)]()[_0x571d48(0x140)](0x2)[_0x571d48(0x154)](_0x571d48(0x13f),_0x571d48(0x157),async _0x2b3386=>{const _0x36b335=_0x571d48;if(!_0x2b3386)return![];const _0x527089=await Whatsapp_1[_0x36b335(0x150)][_0x36b335(0x139)]({'where':{'token':_0x2b3386}});return!_0x527089;})});try{await _0x53ff25[_0x571d48(0x133)]({'token':token});}catch(_0x361dcf){throw new AppError_1[(_0x571d48(0x150))](_0x361dcf[_0x571d48(0x125)]);}}const _0x5de36c=await Whatsapp_1[_0x571d48(0x150)][_0x571d48(0x14c)]({'name':_0x2e5f38,'status':status,'greetingMessage':_0x24fbab,'complationMessage':_0x21d6b0,'outOfHoursMessage':_0x187aef,'ratingMessage':_0x3659bb,'isDefault':isDefault,'companyId':_0x324b10,'token':token,'provider':provider,'timeSendQueue':_0x26f025,'sendIdQueue':_0x43a00b,'promptId':_0x474aa4&&_0x474aa4>0x0?_0x474aa4:null,'integrationId':_0x18cbad&&_0x18cbad>0x0?_0x18cbad:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x45bce0,'importOldMessages':_0x398b65,'importRecentMessages':_0xbd17a3,'closedTicketsPostImported':_0x86ab04,'importOldMessagesGroups':_0x259315},{'include':[_0x571d48(0x130)]});return await(0x0,AssociateWhatsappQueue_1[_0x571d48(0x150)])(_0x5de36c,queueIds),{'whatsapp':_0x5de36c,'oldDefaultWhatsapp':_0x36da94};};exports['default']=CreateWhatsAppService;