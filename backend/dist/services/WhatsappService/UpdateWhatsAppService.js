'use strict';function a592_0x18c8(){var _0x197b77=['not','validate','18913iwjOyM','../../models/Whatsapp','2475672GEVojA','(((.+)+)+)+$','update','./AssociateWhatsappQueue','length','6VBewUd','object','sequelize','8365872COuArD','../../errors/AppError','__setModuleDefault','5023956fOjWTW','yup','17444754HVQWIg','2142411lnHflw','string','search','1357060LXvllH','hasOwnProperty','__esModule','getOwnPropertyDescriptor','56MbfsiU','shape','apply','default','create','call','findOne','__importDefault','defineProperty','constructor','getOwnPropertyNames','__createBinding','configurable'];a592_0x18c8=function(){return _0x197b77;};return a592_0x18c8();}var a592_0x3cb7c7=a592_0x3f46;function a592_0x3f46(_0x74f2ba,_0x4caa7e){var _0x249c3b=a592_0x18c8();return a592_0x3f46=function(_0x3eba20,_0x4c4a2b){_0x3eba20=_0x3eba20-0x137;var _0x18c858=_0x249c3b[_0x3eba20];return _0x18c858;},a592_0x3f46(_0x74f2ba,_0x4caa7e);}(function(_0x32497b,_0x58ef20){var _0x85e20a=a592_0x3f46,_0x18755f=_0x32497b();while(!![]){try{var _0x4fdd8c=parseInt(_0x85e20a(0x148))/0x1*(parseInt(_0x85e20a(0x139))/0x2)+parseInt(_0x85e20a(0x158))/0x3+-parseInt(_0x85e20a(0x14a))/0x4+-parseInt(_0x85e20a(0x15b))/0x5+-parseInt(_0x85e20a(0x14f))/0x6*(parseInt(_0x85e20a(0x155))/0x7)+-parseInt(_0x85e20a(0x152))/0x8+parseInt(_0x85e20a(0x157))/0x9;if(_0x4fdd8c===_0x58ef20)break;else _0x18755f['push'](_0x18755f['shift']());}catch(_0x2ecddd){_0x18755f['push'](_0x18755f['shift']());}}}(a592_0x18c8,0x80f6b));var __createBinding=this&&this[a592_0x3cb7c7(0x144)]||(Object[a592_0x3cb7c7(0x13d)]?function(_0x39000a,_0x37d7b6,_0x51ebb9,_0x2d10bd){var _0x2d7301=a592_0x3cb7c7;if(_0x2d10bd===undefined)_0x2d10bd=_0x51ebb9;var _0x100d3d=Object[_0x2d7301(0x138)](_0x37d7b6,_0x51ebb9);(!_0x100d3d||('get'in _0x100d3d?!_0x37d7b6[_0x2d7301(0x137)]:_0x100d3d['writable']||_0x100d3d[_0x2d7301(0x145)]))&&(_0x100d3d={'enumerable':!![],'get':function(){return _0x37d7b6[_0x51ebb9];}}),Object['defineProperty'](_0x39000a,_0x2d10bd,_0x100d3d);}:function(_0x364aa8,_0x410877,_0x50d288,_0x4d2c35){if(_0x4d2c35===undefined)_0x4d2c35=_0x50d288;_0x364aa8[_0x4d2c35]=_0x410877[_0x50d288];}),__setModuleDefault=this&&this[a592_0x3cb7c7(0x154)]||(Object[a592_0x3cb7c7(0x13d)]?function(_0x4ab7a4,_0x5aff45){Object['defineProperty'](_0x4ab7a4,'default',{'enumerable':!![],'value':_0x5aff45});}:function(_0x2da30a,_0x58fb56){var _0x2fdd96=a592_0x3cb7c7;_0x2da30a[_0x2fdd96(0x13c)]=_0x58fb56;}),__importStar=this&&this['__importStar']||(function(){var _0x3fc813=(function(){var _0x142e18=!![];return function(_0x13bc03,_0x214556){var _0x36832a=_0x142e18?function(){var _0x5383ae=a592_0x3f46;if(_0x214556){var _0x1fda88=_0x214556[_0x5383ae(0x13b)](_0x13bc03,arguments);return _0x214556=null,_0x1fda88;}}:function(){};return _0x142e18=![],_0x36832a;};}()),_0x1bb7de=_0x3fc813(this,function(){var _0x2ee3b8=a592_0x3f46;return _0x1bb7de['toString']()[_0x2ee3b8(0x15a)](_0x2ee3b8(0x14b))['toString']()[_0x2ee3b8(0x142)](_0x1bb7de)[_0x2ee3b8(0x15a)]('(((.+)+)+)+$');});_0x1bb7de();var _0x14a500=function(_0x2d53c2){var _0x517f15=a592_0x3f46;return _0x14a500=Object[_0x517f15(0x143)]||function(_0x2cb66c){var _0x30f5b9=_0x517f15,_0x778e5=[];for(var _0x2209e2 in _0x2cb66c)if(Object['prototype'][_0x30f5b9(0x15c)][_0x30f5b9(0x13e)](_0x2cb66c,_0x2209e2))_0x778e5[_0x778e5[_0x30f5b9(0x14e)]]=_0x2209e2;return _0x778e5;},_0x14a500(_0x2d53c2);};return function(_0x56b90d){var _0x2148b8=a592_0x3f46;if(_0x56b90d&&_0x56b90d[_0x2148b8(0x137)])return _0x56b90d;var _0xdc5fb8={};if(_0x56b90d!=null){for(var _0x15635a=_0x14a500(_0x56b90d),_0x153939=0x0;_0x153939<_0x15635a[_0x2148b8(0x14e)];_0x153939++)if(_0x15635a[_0x153939]!=='default')__createBinding(_0xdc5fb8,_0x56b90d,_0x15635a[_0x153939]);}return __setModuleDefault(_0xdc5fb8,_0x56b90d),_0xdc5fb8;};}()),__importDefault=this&&this[a592_0x3cb7c7(0x140)]||function(_0x505029){var _0x1c4b7a=a592_0x3cb7c7;return _0x505029&&_0x505029[_0x1c4b7a(0x137)]?_0x505029:{'default':_0x505029};};Object[a592_0x3cb7c7(0x141)](exports,a592_0x3cb7c7(0x137),{'value':!![]});const Yup=__importStar(require(a592_0x3cb7c7(0x156))),sequelize_1=require(a592_0x3cb7c7(0x151)),AppError_1=__importDefault(require(a592_0x3cb7c7(0x153))),Whatsapp_1=__importDefault(require(a592_0x3cb7c7(0x149))),ShowWhatsAppService_1=__importDefault(require('./ShowWhatsAppService')),AssociateWhatsappQueue_1=__importDefault(require(a592_0x3cb7c7(0x14d))),UpdateWhatsAppService=async({whatsappData:_0x29e468,whatsappId:_0x1700c3,companyId:_0x3d8e75})=>{var _0x48ca94=a592_0x3cb7c7;const {name:_0x51f3e2,status:_0x4f536a,isDefault:_0x33e388,session:_0x3bd77d,greetingMessage:_0x55a44a,complationMessage:_0x4f255b,outOfHoursMessage:_0xedd376,useRating:_0xe98cfe,ratingMessage:_0x438029,transferMessage:_0x2ff9a8,queueIds:queueIds=[],token:_0x2ff313,timeSendQueue:_0x3243b2,integrationId:_0x2f54af,sendIdQueue:sendIdQueue=null,maxUseBotQueues:_0x2f3cb3,expiresTicket:_0x1e8fe0,expiresInactiveMessage:_0x329724,allowGroup:_0x1255e4,importOldMessages:_0xaafd37,schedules:_0xd47ba8,whenExpireTicket:_0x3924fc,inactiveMessageTime:_0x457c95,inactiveMessage:_0xb6b57a,automaticRestart:_0x8f0b36,period:_0x4f47b2,lastRestartAt:_0x3807f1}=_0x29e468,_0x578d69=Yup[_0x48ca94(0x150)]()[_0x48ca94(0x13a)]({'name':Yup['string']()['min'](0x2),'status':Yup[_0x48ca94(0x159)](),'isDefault':Yup['boolean']()});try{await _0x578d69[_0x48ca94(0x147)]({'name':_0x51f3e2,'status':_0x4f536a,'isDefault':_0x33e388});}catch(_0x3a2bfb){throw new AppError_1[(_0x48ca94(0x13c))](_0x3a2bfb['message']);}if(queueIds[_0x48ca94(0x14e)]>0x1&&!_0x55a44a)throw new AppError_1[(_0x48ca94(0x13c))]('ERR_WAPP_GREETING_REQUIRED');let _0x4e4dbd=null;_0x33e388&&(_0x4e4dbd=await Whatsapp_1[_0x48ca94(0x13c)][_0x48ca94(0x13f)]({'where':{'isDefault':!![],'id':{[sequelize_1['Op'][_0x48ca94(0x146)]]:_0x1700c3},'companyId':_0x3d8e75}}),_0x4e4dbd&&await _0x4e4dbd[_0x48ca94(0x14c)]({'isDefault':![]}));const _0xb1bb06=await(0x0,ShowWhatsAppService_1[_0x48ca94(0x13c)])(_0x1700c3,_0x3d8e75);return await _0xb1bb06['update']({'name':_0x51f3e2,'status':_0x4f536a,'session':_0x3bd77d,'greetingMessage':_0x55a44a,'complationMessage':_0x4f255b,'outOfHoursMessage':_0xedd376,'useRating':_0xe98cfe,'ratingMessage':_0x438029,'isDefault':_0x33e388,'companyId':_0x3d8e75,'token':_0x2ff313,'transferMessage':_0x2ff9a8,'integrationId':_0x2f54af?_0x2f54af:null,'maxUseBotQueues':_0x2f3cb3,'timeSendQueue':_0x3243b2,'sendIdQueue':sendIdQueue,'expiresTicket':_0x1e8fe0,'expiresInactiveMessage':_0x329724,'allowGroup':_0x1255e4,'importOldMessages':_0xaafd37,'schedules':_0xd47ba8,'whenExpireTicket':_0x3924fc,'inactiveMessageTime':_0x457c95,'inactiveMessage':_0xb6b57a,'automaticRestart':_0x8f0b36,'period':_0x4f47b2,'lastRestartAt':_0x3807f1}),await(0x0,AssociateWhatsappQueue_1['default'])(_0xb1bb06,queueIds),{'whatsapp':_0xb1bb06,'oldDefaultWhatsapp':_0x4e4dbd};};exports[a592_0x3cb7c7(0x13c)]=UpdateWhatsAppService;