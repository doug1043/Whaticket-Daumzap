const a563_0x4ec69a=a563_0x288c;(function(_0x279883,_0x461843){const _0x25ea45=a563_0x288c,_0x3a585d=_0x279883();while(!![]){try{const _0x2bea06=-parseInt(_0x25ea45(0x1e3))/0x1+parseInt(_0x25ea45(0x1ce))/0x2+parseInt(_0x25ea45(0x1e9))/0x3*(parseInt(_0x25ea45(0x1c6))/0x4)+parseInt(_0x25ea45(0x1be))/0x5+parseInt(_0x25ea45(0x1e5))/0x6*(parseInt(_0x25ea45(0x1bc))/0x7)+-parseInt(_0x25ea45(0x1ee))/0x8+-parseInt(_0x25ea45(0x1e7))/0x9*(parseInt(_0x25ea45(0x1d0))/0xa);if(_0x2bea06===_0x461843)break;else _0x3a585d['push'](_0x3a585d['shift']());}catch(_0x224c97){_0x3a585d['push'](_0x3a585d['shift']());}}}(a563_0x2256,0x82a7f));const a563_0x387c74=(function(){let _0x3f391f=!![];return function(_0x295f89,_0x4d337b){const _0x5163b0=_0x3f391f?function(){const _0x4a7dfa=a563_0x288c;if(_0x4d337b){const _0x234e11=_0x4d337b[_0x4a7dfa(0x1d5)](_0x295f89,arguments);return _0x4d337b=null,_0x234e11;}}:function(){};return _0x3f391f=![],_0x5163b0;};}()),a563_0x31942e=a563_0x387c74(this,function(){const _0x2724d4=a563_0x288c;return a563_0x31942e[_0x2724d4(0x1e6)]()['search'](_0x2724d4(0x1d9))[_0x2724d4(0x1e6)]()[_0x2724d4(0x1ec)](a563_0x31942e)[_0x2724d4(0x1c0)](_0x2724d4(0x1d9));});a563_0x31942e();function a563_0x288c(_0x498d87,_0x2a96e8){const _0x33e379=a563_0x2256();return a563_0x288c=function(_0x31942e,_0x387c74){_0x31942e=_0x31942e-0x1bb;let _0x2256e6=_0x33e379[_0x31942e];return _0x2256e6;},a563_0x288c(_0x498d87,_0x2a96e8);}'use strict';var __importDefault=this&&this[a563_0x4ec69a(0x1db)]||function(_0x2d08a6){const _0x58fc96=a563_0x4ec69a;return _0x2d08a6&&_0x2d08a6[_0x58fc96(0x1d6)]?_0x2d08a6:{'default':_0x2d08a6};};Object[a563_0x4ec69a(0x1c5)](exports,a563_0x4ec69a(0x1d6),{'value':!![]}),exports[a563_0x4ec69a(0x1d8)]=void 0x0;const AppError_1=__importDefault(require('../../errors/AppError')),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),Ticket_1=__importDefault(require(a563_0x4ec69a(0x1eb))),UpdateTicketService_1=__importDefault(require(a563_0x4ec69a(0x1ca))),wbot_1=require('../../libs/wbot'),socket_1=require('../../libs/socket'),wbotMessageListener_1=require('../WbotServices/wbotMessageListener'),moment_1=__importDefault(require(a563_0x4ec69a(0x1c3))),sequelize_1=require(a563_0x4ec69a(0x1dd)),date_fns_1=require(a563_0x4ec69a(0x1ed)),closeImportedTickets=async _0x44353f=>{const _0x2f2d70=a563_0x4ec69a;console[_0x2f2d70(0x1c7)](_0x2f2d70(0x1d8));const _0xaf65c0=await Ticket_1[_0x2f2d70(0x1cd)][_0x2f2d70(0x1dc)]({'where':{'status':_0x2f2d70(0x1d1),'whatsappId':_0x44353f,'imported':{[sequelize_1['Op']['lt']]:(0x0,date_fns_1['add'])(new Date(),{'hours':0x5})}}});for(const _0x2db6e9 of _0xaf65c0){await new Promise(_0x580faa=>setTimeout(_0x580faa,0x14a)),await(0x0,UpdateTicketService_1[_0x2f2d70(0x1cd)])({'ticketData':{'status':_0x2f2d70(0x1d7)},'ticketId':_0x2db6e9['id'],'companyId':_0x2db6e9['companyId']});}let _0x529382=await Whatsapp_1['default'][_0x2f2d70(0x1d3)](_0x44353f);_0x529382['update']({'statusImportMessages':null});const _0x51404e=(0x0,socket_1[_0x2f2d70(0x1bd)])();_0x51404e['to']('company-'+_0x529382['companyId']+_0x2f2d70(0x1da))[_0x2f2d70(0x1c8)](_0x2f2d70(0x1d2)+_0x529382[_0x2f2d70(0x1cb)],{'action':_0x2f2d70(0x1de)});};exports[a563_0x4ec69a(0x1d8)]=closeImportedTickets;function compareMessageTimestamps(_0x1904a,_0x12104f){return _0x1904a['messageTimestamp']-_0x12104f['messageTimestamp'];}function removeDuplicateById(_0x28f7ae){const _0x3753e8=a563_0x4ec69a,_0x1e789b=new Map(),_0x435e71=[];for(const _0x342d46 of _0x28f7ae){const _0x384691=_0x342d46[_0x3753e8(0x1e0)]['id'];!_0x1e789b['has'](_0x384691)&&(_0x1e789b[_0x3753e8(0x1e2)](_0x384691,!![]),_0x435e71['push'](_0x342d46));}return _0x435e71[_0x3753e8(0x1bb)](compareMessageTimestamps);}const ImportWhatsAppService=async _0x30bd98=>{const _0x2a1aa4=a563_0x4ec69a,_0x32673f=(0x0,wbot_1[_0x2a1aa4(0x1c1)])(_0x30bd98['id']);try{const _0x508352=(0x0,socket_1[_0x2a1aa4(0x1bd)])(),_0xae5adb=removeDuplicateById(wbot_1[_0x2a1aa4(0x1d4)][_0x30bd98['id']]);console['log'](_0x2a1aa4(0x1c9));const _0x38630c=_0xae5adb['length'];let _0x52e785=0x0;while(_0x52e785<_0x38630c){try{const _0x49d144=_0xae5adb[_0x52e785];await(0x0,wbotMessageListener_1[_0x2a1aa4(0x1c2)])(_0x49d144,_0x32673f,_0x30bd98[_0x2a1aa4(0x1cb)],!![]);if(_0x52e785%0x2===0x0){const _0x2e62f4=Math[_0x2a1aa4(0x1e8)](_0x49d144['messageTimestamp'][_0x2a1aa4(0x1c4)]*0x3e8);_0x508352['emit'](_0x2a1aa4(0x1d2)+_0x30bd98[_0x2a1aa4(0x1cb)],{'action':_0x2a1aa4(0x1df),'status':{'this':_0x52e785+0x1,'all':_0x38630c,'date':(0x0,moment_1[_0x2a1aa4(0x1cd)])(_0x2e62f4)[_0x2a1aa4(0x1bf)]('DD/MM/YY\x20HH:mm:ss')}});}_0x52e785+0x1===_0x38630c&&(wbot_1[_0x2a1aa4(0x1d4)][_0x30bd98['id']]=[],_0x30bd98[_0x2a1aa4(0x1ea)]&&await(0x0,exports[_0x2a1aa4(0x1d8)])(_0x30bd98['id']),await _0x30bd98[_0x2a1aa4(0x1df)]({'statusImportMessages':_0x30bd98[_0x2a1aa4(0x1ea)]?null:_0x2a1aa4(0x1e1),'importOldMessages':null,'importRecentMessages':null}),_0x508352['to']('company-'+_0x30bd98['companyId']+_0x2a1aa4(0x1da))[_0x2a1aa4(0x1c8)]('importMessages-'+_0x30bd98[_0x2a1aa4(0x1cb)],{'action':_0x2a1aa4(0x1de)}));}catch(_0x206d21){console[_0x2a1aa4(0x1c7)](_0x206d21),console[_0x2a1aa4(0x1c7)](_0x2a1aa4(0x1cc));}_0x52e785++;}}catch(_0x543c19){console['log'](_0x543c19);throw new AppError_1[(_0x2a1aa4(0x1cd))](_0x2a1aa4(0x1e4),0x193);}return _0x2a1aa4(0x1cf);};exports[a563_0x4ec69a(0x1cd)]=ImportWhatsAppService;function a563_0x2256(){const _0x20c930=['__importDefault','findAll','sequelize','refresh','update','key','renderButtonCloseTickets','set','47186wMnZsP','ERR_NOT_MESSAGE_TO_IMPORT','6kNvHup','toString','90Apkprj','floor','3eGFhQA','closedTicketsPostImported','../../models/Ticket','constructor','date-fns','556264PDQmNQ','sort','5803238ZSTutz','getIO','4271300hgoNuC','format','search','getWbot','handleMessage','moment','low','defineProperty','270772RQZoJZ','log','emit','processImportMessagesWppId','../TicketServices/UpdateTicketService','companyId','ERROR_IMPORTING_MESSAGE','default','474158TVcCHj','whatsapps','1336180gOLwNU','pending','importMessages-','findByPk','dataMessages','apply','__esModule','closed','closeImportedTickets','(((.+)+)+)+$','-mainchannel'];a563_0x2256=function(){return _0x20c930;};return a563_0x2256();}