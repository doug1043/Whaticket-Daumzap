const a545_0x51e210=a545_0x43d7;(function(_0xd4ee5f,_0x16a702){const _0x57574e=a545_0x43d7,_0x38a309=_0xd4ee5f();while(!![]){try{const _0xe0739d=parseInt(_0x57574e(0x114))/0x1*(parseInt(_0x57574e(0x112))/0x2)+-parseInt(_0x57574e(0x10c))/0x3*(parseInt(_0x57574e(0x121))/0x4)+parseInt(_0x57574e(0x111))/0x5+parseInt(_0x57574e(0x115))/0x6*(-parseInt(_0x57574e(0x105))/0x7)+parseInt(_0x57574e(0x122))/0x8*(parseInt(_0x57574e(0x10e))/0x9)+-parseInt(_0x57574e(0x11c))/0xa*(-parseInt(_0x57574e(0x101))/0xb)+parseInt(_0x57574e(0x10f))/0xc*(-parseInt(_0x57574e(0x124))/0xd);if(_0xe0739d===_0x16a702)break;else _0x38a309['push'](_0x38a309['shift']());}catch(_0x2ece3d){_0x38a309['push'](_0x38a309['shift']());}}}(a545_0x3b46,0x71ef6));const a545_0x4742ab=(function(){let _0x590b5d=!![];return function(_0xd19baf,_0x372abf){const _0x1ceba3=_0x590b5d?function(){const _0x86df2b=a545_0x43d7;if(_0x372abf){const _0x797684=_0x372abf[_0x86df2b(0x125)](_0xd19baf,arguments);return _0x372abf=null,_0x797684;}}:function(){};return _0x590b5d=![],_0x1ceba3;};}()),a545_0x10d7be=a545_0x4742ab(this,function(){const _0x554e23=a545_0x43d7;return a545_0x10d7be[_0x554e23(0x10a)]()[_0x554e23(0x108)](_0x554e23(0x11d))[_0x554e23(0x10a)]()[_0x554e23(0x119)](a545_0x10d7be)['search'](_0x554e23(0x11d));});function a545_0x43d7(_0x3d7e27,_0x32a0c0){const _0x4452ce=a545_0x3b46();return a545_0x43d7=function(_0x10d7be,_0x4742ab){_0x10d7be=_0x10d7be-0xfe;let _0x3b4699=_0x4452ce[_0x10d7be];return _0x3b4699;},a545_0x43d7(_0x3d7e27,_0x32a0c0);}a545_0x10d7be();function a545_0x3b46(){const _0x3ce081=['constructor','userId','getIO','730JSEHTp','(((.+)+)+)+$','whatsapp','ERR_CREATING_TICKET','whatsappId','28iOtihw','349864NwyBBd','update','151385EXsiKb','apply','../ContactServices/ShowContactService','emit','__importDefault','108713ZAnyMx','../../models/Ticket','ticket','../../libs/socket','413eJLFFD','open','user','search','create','toString','../../helpers/CheckContactOpenTickets','95097nkGqzG','companyId','99cpooMJ','636DOFRVz','../../helpers/GetDefaultWhatsApp','2930750IqRYUC','63236CoLyUg','findByPk','10PpUsrw','81264tNxBQZ','contact','default','__esModule'];a545_0x3b46=function(){return _0x3ce081;};return a545_0x3b46();}'use strict';var __importDefault=this&&this[a545_0x51e210(0x100)]||function(_0xb0dda7){const _0x5efb64=a545_0x51e210;return _0xb0dda7&&_0xb0dda7[_0x5efb64(0x118)]?_0xb0dda7:{'default':_0xb0dda7};};Object['defineProperty'](exports,a545_0x51e210(0x118),{'value':!![]});const AppError_1=__importDefault(require('../../errors/AppError')),CheckContactOpenTickets_1=__importDefault(require(a545_0x51e210(0x10b))),GetDefaultWhatsApp_1=__importDefault(require(a545_0x51e210(0x110))),Ticket_1=__importDefault(require(a545_0x51e210(0x102))),ShowContactService_1=__importDefault(require(a545_0x51e210(0xfe))),socket_1=require(a545_0x51e210(0x104)),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),CreateTicketService=async({contactId:_0x16c20f,userId:_0x2ee702,queueId:_0x3a83f6,companyId:_0x464d0a})=>{const _0x4aeaa0=a545_0x51e210,_0x1cf62c=await(0x0,GetDefaultWhatsApp_1['default'])(_0x464d0a);await(0x0,CheckContactOpenTickets_1[_0x4aeaa0(0x117)])(_0x16c20f,_0x1cf62c['id']);const {isGroup:_0x3c395e}=await(0x0,ShowContactService_1['default'])(_0x16c20f,_0x464d0a),{id:_0x3b05f0}=await Ticket_1[_0x4aeaa0(0x117)][_0x4aeaa0(0x109)]({'contactId':_0x16c20f,'companyId':_0x464d0a,'queueId':_0x3a83f6,'whatsappId':_0x1cf62c['id'],'status':_0x4aeaa0(0x106),'isGroup':_0x3c395e,'userId':_0x2ee702,'lastProcessedMessageId':null}),_0x4c1f1e=await Ticket_1[_0x4aeaa0(0x117)][_0x4aeaa0(0x113)](_0x3b05f0,{'include':[_0x4aeaa0(0x116),'queue',_0x4aeaa0(0x11e),_0x4aeaa0(0x107)]});if(!_0x4c1f1e)throw new AppError_1['default'](_0x4aeaa0(0x11f));await(0x0,FindOrCreateATicketTrakingService_1[_0x4aeaa0(0x117)])({'ticketId':_0x4c1f1e['id'],'companyId':_0x4c1f1e[_0x4aeaa0(0x10d)],'whatsappId':_0x4c1f1e[_0x4aeaa0(0x120)],'userId':_0x4c1f1e[_0x4aeaa0(0x11a)]});const _0x29c35b=(0x0,socket_1[_0x4aeaa0(0x11b)])();return _0x29c35b['to'](_0x4c1f1e['id'][_0x4aeaa0(0x10a)]())[_0x4aeaa0(0xff)](_0x4aeaa0(0x103),{'action':_0x4aeaa0(0x123),'ticket':_0x4c1f1e}),_0x4c1f1e;};exports['default']=CreateTicketService;