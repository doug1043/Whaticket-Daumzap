const a523_0x41791f=a523_0x2169;(function(_0xb19d29,_0x580b34){const _0x2b1e1d=a523_0x2169,_0xd47922=_0xb19d29();while(!![]){try{const _0x59a820=parseInt(_0x2b1e1d(0x124))/0x1+parseInt(_0x2b1e1d(0x11e))/0x2*(-parseInt(_0x2b1e1d(0x12c))/0x3)+parseInt(_0x2b1e1d(0x11a))/0x4+parseInt(_0x2b1e1d(0x131))/0x5+parseInt(_0x2b1e1d(0x139))/0x6*(parseInt(_0x2b1e1d(0x122))/0x7)+parseInt(_0x2b1e1d(0x133))/0x8*(-parseInt(_0x2b1e1d(0x127))/0x9)+parseInt(_0x2b1e1d(0x137))/0xa*(-parseInt(_0x2b1e1d(0x12d))/0xb);if(_0x59a820===_0x580b34)break;else _0xd47922['push'](_0xd47922['shift']());}catch(_0x4b90c7){_0xd47922['push'](_0xd47922['shift']());}}}(a523_0x35a7,0x25dda));function a523_0x2169(_0x34bbc1,_0x4bbe56){const _0x528119=a523_0x35a7();return a523_0x2169=function(_0x4eefa2,_0x3b4135){_0x4eefa2=_0x4eefa2-0x118;let _0x35a740=_0x528119[_0x4eefa2];return _0x35a740;},a523_0x2169(_0x34bbc1,_0x4bbe56);}function a523_0x35a7(){const _0x369531=['20sAsafO','contact','48PLtSbf','update','open','apply','247544UQAgFs','../../models/Ticket','../../helpers/GetDefaultWhatsAppByUser','../../helpers/CheckContactOpenTickets','129046FbyWJW','findByPk','emit','default','200417cZNMPv','toString','148082ZZNQWS','ticket','../../errors/AppError','9ldIkez','__esModule','findOrCreate','constructor','../WhatsappService/ShowWhatsAppService','9FlRHFe','318076zJbaug','../../libs/socket','__importDefault','../../helpers/GetDefaultWhatsApp','1127105nBXrDa','defineProperty','2063504iwgdYx','../ContactServices/ShowContactService','(((.+)+)+)+$','ERR_CREATING_TICKET'];a523_0x35a7=function(){return _0x369531;};return a523_0x35a7();}const a523_0x3b4135=(function(){let _0x483bcf=!![];return function(_0x5cfad3,_0x10d439){const _0x16e159=_0x483bcf?function(){const _0x90dc7d=a523_0x2169;if(_0x10d439){const _0x4ef960=_0x10d439[_0x90dc7d(0x119)](_0x5cfad3,arguments);return _0x10d439=null,_0x4ef960;}}:function(){};return _0x483bcf=![],_0x16e159;};}()),a523_0x4eefa2=a523_0x3b4135(this,function(){const _0x57670b=a523_0x2169;return a523_0x4eefa2[_0x57670b(0x123)]()['search'](_0x57670b(0x135))[_0x57670b(0x123)]()[_0x57670b(0x12a)](a523_0x4eefa2)['search']('(((.+)+)+)+$');});a523_0x4eefa2();'use strict';var __importDefault=this&&this[a523_0x41791f(0x12f)]||function(_0xf02188){const _0x212e6d=a523_0x41791f;return _0xf02188&&_0xf02188[_0x212e6d(0x128)]?_0xf02188:{'default':_0xf02188};};Object[a523_0x41791f(0x132)](exports,a523_0x41791f(0x128),{'value':!![]});const AppError_1=__importDefault(require(a523_0x41791f(0x126))),CheckContactOpenTickets_1=__importDefault(require(a523_0x41791f(0x11d))),GetDefaultWhatsApp_1=__importDefault(require(a523_0x41791f(0x130))),Ticket_1=__importDefault(require(a523_0x41791f(0x11b))),ShowContactService_1=__importDefault(require(a523_0x41791f(0x134))),socket_1=require(a523_0x41791f(0x12e)),GetDefaultWhatsAppByUser_1=__importDefault(require(a523_0x41791f(0x11c))),ShowWhatsAppService_1=__importDefault(require(a523_0x41791f(0x12b))),CreateTicketService=async({contactId:_0x5a5a8c,status:_0x158894,userId:_0x161525,queueId:_0x50cd3f,companyId:_0x570fab,whatsappId:_0x590e10})=>{const _0x3290b=a523_0x41791f;let _0x2e2d1c;_0x590e10!==undefined&&_0x590e10!==null&&_0x590e10!==''&&(_0x2e2d1c=await(0x0,ShowWhatsAppService_1[_0x3290b(0x121)])(_0x590e10,_0x570fab));let _0x3aa9f0=await(0x0,GetDefaultWhatsAppByUser_1[_0x3290b(0x121)])(_0x161525);_0x2e2d1c&&(_0x3aa9f0=_0x2e2d1c);if(!_0x3aa9f0)_0x3aa9f0=await(0x0,GetDefaultWhatsApp_1['default'])(_0x570fab);await(0x0,CheckContactOpenTickets_1[_0x3290b(0x121)])(_0x5a5a8c,_0x590e10);const {isGroup:_0x22e007}=await(0x0,ShowContactService_1['default'])(_0x5a5a8c,_0x570fab),[{id:_0xf155ea}]=await Ticket_1[_0x3290b(0x121)][_0x3290b(0x129)]({'where':{'contactId':_0x5a5a8c,'companyId':_0x570fab,'whatsappId':_0x590e10},'defaults':{'contactId':_0x5a5a8c,'companyId':_0x570fab,'whatsappId':_0x3aa9f0['id'],'status':_0x158894,'isGroup':_0x22e007,'userId':_0x161525}});await Ticket_1[_0x3290b(0x121)]['update']({'companyId':_0x570fab,'queueId':_0x50cd3f,'userId':_0x161525,'whatsappId':_0x3aa9f0['id'],'status':_0x3290b(0x118)},{'where':{'id':_0xf155ea}});const _0x767b7a=await Ticket_1[_0x3290b(0x121)][_0x3290b(0x11f)](_0xf155ea,{'include':[_0x3290b(0x138),'queue']});if(!_0x767b7a)throw new AppError_1['default'](_0x3290b(0x136));const _0x1709d2=(0x0,socket_1['getIO'])();return _0x1709d2['to'](_0x767b7a['id'][_0x3290b(0x123)]())[_0x3290b(0x120)](_0x3290b(0x125),{'action':_0x3290b(0x13a),'ticket':_0x767b7a}),_0x767b7a;};exports['default']=CreateTicketService;