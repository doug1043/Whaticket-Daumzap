const a520_0x5aeb45=a520_0x2127;(function(_0x270564,_0x35e097){const _0x21aad4=a520_0x2127,_0x245c78=_0x270564();while(!![]){try{const _0x111174=parseInt(_0x21aad4(0x170))/0x1+-parseInt(_0x21aad4(0x167))/0x2+-parseInt(_0x21aad4(0x169))/0x3+-parseInt(_0x21aad4(0x15f))/0x4+parseInt(_0x21aad4(0x16f))/0x5+-parseInt(_0x21aad4(0x15c))/0x6+parseInt(_0x21aad4(0x173))/0x7*(parseInt(_0x21aad4(0x163))/0x8);if(_0x111174===_0x35e097)break;else _0x245c78['push'](_0x245c78['shift']());}catch(_0x5a7bee){_0x245c78['push'](_0x245c78['shift']());}}}(a520_0x409e,0x7bfc5));const a520_0x5604e8=(function(){let _0x275f36=!![];return function(_0x1bd87d,_0x5cb442){const _0x212886=_0x275f36?function(){const _0x42fe3d=a520_0x2127;if(_0x5cb442){const _0x547d6b=_0x5cb442[_0x42fe3d(0x166)](_0x1bd87d,arguments);return _0x5cb442=null,_0x547d6b;}}:function(){};return _0x275f36=![],_0x212886;};}()),a520_0x3ba7ed=a520_0x5604e8(this,function(){const _0x12ed86=a520_0x2127;return a520_0x3ba7ed[_0x12ed86(0x15e)]()[_0x12ed86(0x16e)](_0x12ed86(0x160))[_0x12ed86(0x15e)]()[_0x12ed86(0x16b)](a520_0x3ba7ed)['search'](_0x12ed86(0x160));});a520_0x3ba7ed();'use strict';var __importDefault=this&&this[a520_0x5aeb45(0x162)]||function(_0x32524d){const _0x3ad9dd=a520_0x5aeb45;return _0x32524d&&_0x32524d[_0x3ad9dd(0x164)]?_0x32524d:{'default':_0x32524d};};function a520_0x2127(_0x2d936f,_0x2ba76c){const _0x43ff22=a520_0x409e();return a520_0x2127=function(_0x3ba7ed,_0x5604e8){_0x3ba7ed=_0x3ba7ed-0x15a;let _0x409e17=_0x43ff22[_0x3ba7ed];return _0x409e17;},a520_0x2127(_0x2d936f,_0x2ba76c);}Object['defineProperty'](exports,a520_0x5aeb45(0x164),{'value':!![]});function a520_0x409e(){const _0x2ab654=['toString','3600372DTpIYy','(((.+)+)+)+$','contact','__importDefault','30072lauOGj','__esModule','../../helpers/GetDefaultWhatsAppByUser','apply','1122070cnlHDC','emit','305487xvoumM','../../errors/AppError','constructor','../WhatsappService/ShowWhatsAppService','../ContactServices/ShowContactService','search','1019890jtGVsP','926025xLFTmF','../../models/Ticket','update','3409gLixXL','default','open','5339004ThKgfs','ERR_CREATING_TICKET'];a520_0x409e=function(){return _0x2ab654;};return a520_0x409e();}const AppError_1=__importDefault(require(a520_0x5aeb45(0x16a))),CheckContactOpenTickets_1=__importDefault(require('../../helpers/CheckContactOpenTickets')),GetDefaultWhatsApp_1=__importDefault(require('../../helpers/GetDefaultWhatsApp')),Ticket_1=__importDefault(require(a520_0x5aeb45(0x171))),ShowContactService_1=__importDefault(require(a520_0x5aeb45(0x16d))),socket_1=require('../../libs/socket'),GetDefaultWhatsAppByUser_1=__importDefault(require(a520_0x5aeb45(0x165))),ShowWhatsAppService_1=__importDefault(require(a520_0x5aeb45(0x16c))),CreateTicketService=async({contactId:_0x21f346,status:_0x14bdc2,userId:_0x4d2c2f,queueId:_0x107a57,companyId:_0x218475,whatsappId:_0x2e3186})=>{const _0x364ed0=a520_0x5aeb45;let _0x4f4d96;_0x2e3186!==undefined&&_0x2e3186!==null&&_0x2e3186!==''&&(_0x4f4d96=await(0x0,ShowWhatsAppService_1[_0x364ed0(0x15a)])(_0x2e3186,_0x218475));let _0x378ef0=await(0x0,GetDefaultWhatsAppByUser_1['default'])(_0x4d2c2f);_0x4f4d96&&(_0x378ef0=_0x4f4d96);if(!_0x378ef0)_0x378ef0=await(0x0,GetDefaultWhatsApp_1[_0x364ed0(0x15a)])(_0x218475);await(0x0,CheckContactOpenTickets_1[_0x364ed0(0x15a)])(_0x21f346,_0x2e3186);const {isGroup:_0x291cfc}=await(0x0,ShowContactService_1[_0x364ed0(0x15a)])(_0x21f346,_0x218475),[{id:_0x4fb9b3}]=await Ticket_1['default']['findOrCreate']({'where':{'contactId':_0x21f346,'companyId':_0x218475,'whatsappId':_0x2e3186},'defaults':{'contactId':_0x21f346,'companyId':_0x218475,'whatsappId':_0x378ef0['id'],'status':_0x14bdc2,'isGroup':_0x291cfc,'userId':_0x4d2c2f}});await Ticket_1[_0x364ed0(0x15a)][_0x364ed0(0x172)]({'companyId':_0x218475,'queueId':_0x107a57,'userId':_0x4d2c2f,'whatsappId':_0x378ef0['id'],'status':_0x364ed0(0x15b)},{'where':{'id':_0x4fb9b3}});const _0x5a84d7=await Ticket_1['default']['findByPk'](_0x4fb9b3,{'include':[_0x364ed0(0x161),'queue']});if(!_0x5a84d7)throw new AppError_1[(_0x364ed0(0x15a))](_0x364ed0(0x15d));const _0x156bbc=(0x0,socket_1['getIO'])();return _0x156bbc['to'](_0x5a84d7['id'][_0x364ed0(0x15e)]())[_0x364ed0(0x168)]('ticket',{'action':'update','ticket':_0x5a84d7}),_0x5a84d7;};exports[a520_0x5aeb45(0x15a)]=CreateTicketService;