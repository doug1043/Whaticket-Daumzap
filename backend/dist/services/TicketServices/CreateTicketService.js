const a522_0x2cbc34=a522_0x2cab;(function(_0x3c6836,_0x23de61){const _0xb261c8=a522_0x2cab,_0x3dd3be=_0x3c6836();while(!![]){try{const _0x5808a6=parseInt(_0xb261c8(0x119))/0x1*(-parseInt(_0xb261c8(0x128))/0x2)+-parseInt(_0xb261c8(0x123))/0x3*(parseInt(_0xb261c8(0x11e))/0x4)+parseInt(_0xb261c8(0x120))/0x5*(-parseInt(_0xb261c8(0x121))/0x6)+-parseInt(_0xb261c8(0x113))/0x7*(parseInt(_0xb261c8(0x126))/0x8)+-parseInt(_0xb261c8(0x11a))/0x9+-parseInt(_0xb261c8(0x127))/0xa+-parseInt(_0xb261c8(0x115))/0xb*(-parseInt(_0xb261c8(0x10d))/0xc);if(_0x5808a6===_0x23de61)break;else _0x3dd3be['push'](_0x3dd3be['shift']());}catch(_0x255254){_0x3dd3be['push'](_0x3dd3be['shift']());}}}(a522_0x431b,0x9612c));function a522_0x431b(){const _0x37de91=['../../libs/socket','../../errors/AppError','../../helpers/CheckContactOpenTickets','ticket','1267XFNhGS','../../helpers/GetDefaultWhatsAppByUser','1394954hHVomT','getIO','../WhatsappService/ShowWhatsAppService','queue','443HbVpOh','4157010NdBkWT','emit','__importDefault','apply','938036ugUqGy','toString','2845OZVIMB','2256raYCRU','../../helpers/GetDefaultWhatsApp','3yXipAS','../ContactServices/ShowContactService','__esModule','33888yCqVoO','6401830PSMMBl','5084ECZkDT','findByPk','search','default','open','(((.+)+)+)+$','contact','constructor','update','384VETxoi','ERR_CREATING_TICKET'];a522_0x431b=function(){return _0x37de91;};return a522_0x431b();}const a522_0x50a039=(function(){let _0x627524=!![];return function(_0x2db7e7,_0x41502d){const _0x42d10c=_0x627524?function(){const _0xe4d4d=a522_0x2cab;if(_0x41502d){const _0x3a0bfa=_0x41502d[_0xe4d4d(0x11d)](_0x2db7e7,arguments);return _0x41502d=null,_0x3a0bfa;}}:function(){};return _0x627524=![],_0x42d10c;};}()),a522_0x44c6c5=a522_0x50a039(this,function(){const _0x4adb2d=a522_0x2cab;return a522_0x44c6c5[_0x4adb2d(0x11f)]()[_0x4adb2d(0x12a)]('(((.+)+)+)+$')['toString']()[_0x4adb2d(0x10b)](a522_0x44c6c5)[_0x4adb2d(0x12a)](_0x4adb2d(0x109));});a522_0x44c6c5();'use strict';function a522_0x2cab(_0x11d289,_0x8d434f){const _0x230911=a522_0x431b();return a522_0x2cab=function(_0x44c6c5,_0x50a039){_0x44c6c5=_0x44c6c5-0x107;let _0x431b45=_0x230911[_0x44c6c5];return _0x431b45;},a522_0x2cab(_0x11d289,_0x8d434f);}var __importDefault=this&&this[a522_0x2cbc34(0x11c)]||function(_0x180834){return _0x180834&&_0x180834['__esModule']?_0x180834:{'default':_0x180834};};Object['defineProperty'](exports,a522_0x2cbc34(0x125),{'value':!![]});const AppError_1=__importDefault(require(a522_0x2cbc34(0x110))),CheckContactOpenTickets_1=__importDefault(require(a522_0x2cbc34(0x111))),GetDefaultWhatsApp_1=__importDefault(require(a522_0x2cbc34(0x122))),Ticket_1=__importDefault(require('../../models/Ticket')),ShowContactService_1=__importDefault(require(a522_0x2cbc34(0x124))),socket_1=require(a522_0x2cbc34(0x10f)),GetDefaultWhatsAppByUser_1=__importDefault(require(a522_0x2cbc34(0x114))),ShowWhatsAppService_1=__importDefault(require(a522_0x2cbc34(0x117))),CreateTicketService=async({contactId:_0xc7668b,status:_0x2df7ce,userId:_0x166771,queueId:_0x170ecd,companyId:_0x3673c3,whatsappId:_0x476db8})=>{const _0x4278f0=a522_0x2cbc34;let _0x46f97e;_0x476db8!==undefined&&_0x476db8!==null&&_0x476db8!==''&&(_0x46f97e=await(0x0,ShowWhatsAppService_1[_0x4278f0(0x107)])(_0x476db8,_0x3673c3));let _0x57516b=await(0x0,GetDefaultWhatsAppByUser_1[_0x4278f0(0x107)])(_0x166771);_0x46f97e&&(_0x57516b=_0x46f97e);if(!_0x57516b)_0x57516b=await(0x0,GetDefaultWhatsApp_1[_0x4278f0(0x107)])(_0x3673c3);await(0x0,CheckContactOpenTickets_1['default'])(_0xc7668b,_0x476db8);const {isGroup:_0xb63cda}=await(0x0,ShowContactService_1['default'])(_0xc7668b,_0x3673c3),[{id:_0x10ef0b}]=await Ticket_1[_0x4278f0(0x107)]['findOrCreate']({'where':{'contactId':_0xc7668b,'companyId':_0x3673c3,'whatsappId':_0x476db8},'defaults':{'contactId':_0xc7668b,'companyId':_0x3673c3,'whatsappId':_0x57516b['id'],'status':_0x2df7ce,'isGroup':_0xb63cda,'userId':_0x166771}});await Ticket_1[_0x4278f0(0x107)][_0x4278f0(0x10c)]({'companyId':_0x3673c3,'queueId':_0x170ecd,'userId':_0x166771,'whatsappId':_0x57516b['id'],'status':_0x4278f0(0x108)},{'where':{'id':_0x10ef0b}});const _0x1fc830=await Ticket_1[_0x4278f0(0x107)][_0x4278f0(0x129)](_0x10ef0b,{'include':[_0x4278f0(0x10a),_0x4278f0(0x118)]});if(!_0x1fc830)throw new AppError_1['default'](_0x4278f0(0x10e));const _0x40da73=(0x0,socket_1[_0x4278f0(0x116)])();return _0x40da73['to'](_0x1fc830['id']['toString']())[_0x4278f0(0x11b)](_0x4278f0(0x112),{'action':_0x4278f0(0x10c),'ticket':_0x1fc830}),_0x1fc830;};exports[a522_0x2cbc34(0x107)]=CreateTicketService;