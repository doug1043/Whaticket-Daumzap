const a522_0x57cba2=a522_0x5828;(function(_0x28816a,_0x361954){const _0x1088e7=a522_0x5828,_0x24ee00=_0x28816a();while(!![]){try{const _0x47a460=parseInt(_0x1088e7(0xb4))/0x1+-parseInt(_0x1088e7(0xb5))/0x2+parseInt(_0x1088e7(0xa3))/0x3+parseInt(_0x1088e7(0xb0))/0x4+-parseInt(_0x1088e7(0xab))/0x5*(parseInt(_0x1088e7(0xa0))/0x6)+parseInt(_0x1088e7(0xaa))/0x7*(-parseInt(_0x1088e7(0xb6))/0x8)+parseInt(_0x1088e7(0xa2))/0x9;if(_0x47a460===_0x361954)break;else _0x24ee00['push'](_0x24ee00['shift']());}catch(_0x3d1719){_0x24ee00['push'](_0x24ee00['shift']());}}}(a522_0xf454,0x73227));const a522_0x32bf16=(function(){let _0x75133d=!![];return function(_0x229cf1,_0x544920){const _0x4ea832=_0x75133d?function(){const _0x4051aa=a522_0x5828;if(_0x544920){const _0x60534e=_0x544920[_0x4051aa(0xa6)](_0x229cf1,arguments);return _0x544920=null,_0x60534e;}}:function(){};return _0x75133d=![],_0x4ea832;};}()),a522_0x605d0f=a522_0x32bf16(this,function(){const _0x1f52b3=a522_0x5828;return a522_0x605d0f['toString']()[_0x1f52b3(0xae)](_0x1f52b3(0xb8))[_0x1f52b3(0xa4)]()[_0x1f52b3(0xb7)](a522_0x605d0f)[_0x1f52b3(0xae)]('(((.+)+)+)+$');});a522_0x605d0f();'use strict';function a522_0x5828(_0x3c4be9,_0x18303a){const _0x19f4e7=a522_0xf454();return a522_0x5828=function(_0x605d0f,_0x32bf16){_0x605d0f=_0x605d0f-0x9d;let _0xf45426=_0x19f4e7[_0x605d0f];return _0xf45426;},a522_0x5828(_0x3c4be9,_0x18303a);}var __importDefault=this&&this['__importDefault']||function(_0x4d0111){return _0x4d0111&&_0x4d0111['__esModule']?_0x4d0111:{'default':_0x4d0111};};Object[a522_0x57cba2(0xad)](exports,a522_0x57cba2(0xb1),{'value':!![]});const AppError_1=__importDefault(require(a522_0x57cba2(0xa7))),CheckContactOpenTickets_1=__importDefault(require('../../helpers/CheckContactOpenTickets')),GetDefaultWhatsApp_1=__importDefault(require('../../helpers/GetDefaultWhatsApp')),Ticket_1=__importDefault(require('../../models/Ticket')),ShowContactService_1=__importDefault(require('../ContactServices/ShowContactService')),socket_1=require('../../libs/socket'),GetDefaultWhatsAppByUser_1=__importDefault(require(a522_0x57cba2(0x9e))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),CreateTicketService=async({contactId:_0x104f75,status:_0x1b37e6,userId:_0x13dddb,queueId:_0x1c1295,companyId:_0x1e3b7a,whatsappId:_0x33ddc0})=>{const _0x6e353=a522_0x57cba2;let _0x378dbc;_0x33ddc0!==undefined&&_0x33ddc0!==null&&_0x33ddc0!==''&&(_0x378dbc=await(0x0,ShowWhatsAppService_1[_0x6e353(0x9d)])(_0x33ddc0,_0x1e3b7a));let _0x302b8d=await(0x0,GetDefaultWhatsAppByUser_1[_0x6e353(0x9d)])(_0x13dddb);_0x378dbc&&(_0x302b8d=_0x378dbc);if(!_0x302b8d)_0x302b8d=await(0x0,GetDefaultWhatsApp_1['default'])(_0x1e3b7a);await(0x0,CheckContactOpenTickets_1['default'])(_0x104f75,_0x33ddc0);const {isGroup:_0x32eef4}=await(0x0,ShowContactService_1[_0x6e353(0x9d)])(_0x104f75,_0x1e3b7a),[{id:_0x512572}]=await Ticket_1['default'][_0x6e353(0xa1)]({'where':{'contactId':_0x104f75,'companyId':_0x1e3b7a,'whatsappId':_0x33ddc0},'defaults':{'contactId':_0x104f75,'companyId':_0x1e3b7a,'whatsappId':_0x302b8d['id'],'status':_0x1b37e6,'isGroup':_0x32eef4,'userId':_0x13dddb}});await Ticket_1['default'][_0x6e353(0x9f)]({'companyId':_0x1e3b7a,'queueId':_0x1c1295,'userId':_0x13dddb,'whatsappId':_0x302b8d['id'],'status':_0x6e353(0xa9)},{'where':{'id':_0x512572}});const _0x2c5bca=await Ticket_1[_0x6e353(0x9d)][_0x6e353(0xaf)](_0x512572,{'include':[_0x6e353(0xac),_0x6e353(0xb3)]});if(!_0x2c5bca)throw new AppError_1[(_0x6e353(0x9d))](_0x6e353(0xb2));const _0x167e3b=(0x0,socket_1[_0x6e353(0xa5)])();return _0x167e3b['to'](_0x2c5bca['id'][_0x6e353(0xa4)]())[_0x6e353(0xa8)]('ticket',{'action':_0x6e353(0x9f),'ticket':_0x2c5bca}),_0x2c5bca;};function a522_0xf454(){const _0x5a2071=['../../helpers/GetDefaultWhatsAppByUser','update','2059542eBGJgi','findOrCreate','6650226CpljlP','1147323tRwtKj','toString','getIO','apply','../../errors/AppError','emit','open','930503oTpfWF','10pOnRfl','contact','defineProperty','search','findByPk','2415212fcxHCx','__esModule','ERR_CREATING_TICKET','queue','170791OwlTPR','412256AayqCn','32GFevCI','constructor','(((.+)+)+)+$','default'];a522_0xf454=function(){return _0x5a2071;};return a522_0xf454();}exports[a522_0x57cba2(0x9d)]=CreateTicketService;