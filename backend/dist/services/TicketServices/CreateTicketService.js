const a549_0x4a3dd8=a549_0x1e20;(function(_0x5a5fd0,_0x5dd1d1){const _0x49f530=a549_0x1e20,_0x249e98=_0x5a5fd0();while(!![]){try{const _0x620244=parseInt(_0x49f530(0x9e))/0x1*(parseInt(_0x49f530(0x95))/0x2)+-parseInt(_0x49f530(0x97))/0x3+parseInt(_0x49f530(0x99))/0x4+-parseInt(_0x49f530(0x8e))/0x5*(parseInt(_0x49f530(0x9c))/0x6)+parseInt(_0x49f530(0xa8))/0x7+parseInt(_0x49f530(0xa2))/0x8*(parseInt(_0x49f530(0x88))/0x9)+-parseInt(_0x49f530(0x93))/0xa*(parseInt(_0x49f530(0xa7))/0xb);if(_0x620244===_0x5dd1d1)break;else _0x249e98['push'](_0x249e98['shift']());}catch(_0x267582){_0x249e98['push'](_0x249e98['shift']());}}}(a549_0xb77e,0x3fbc4));const a549_0x2bba4b=(function(){let _0xabe146=!![];return function(_0x4d4f75,_0x281de9){const _0x5d3412=_0xabe146?function(){if(_0x281de9){const _0x41b417=_0x281de9['apply'](_0x4d4f75,arguments);return _0x281de9=null,_0x41b417;}}:function(){};return _0xabe146=![],_0x5d3412;};}()),a549_0x2d77e7=a549_0x2bba4b(this,function(){const _0x278117=a549_0x1e20;return a549_0x2d77e7[_0x278117(0xa0)]()['search'](_0x278117(0x90))[_0x278117(0xa0)]()['constructor'](a549_0x2d77e7)['search'](_0x278117(0x90));});a549_0x2d77e7();function a549_0xb77e(){const _0x25bc98=['32uAifBU','defineProperty','default','contact','../../errors/AppError','4015DiTTqA','3250345cqbbGs','../ContactServices/ShowContactService','166977oZxrwZ','ticket','update','create','ERR_CREATING_TICKET','open','65MTBiAk','emit','(((.+)+)+)+$','__importDefault','userId','14180vgIKDj','whatsapp','42sUiaag','../../libs/socket','84855itRDZT','companyId','891244zLmJZc','../../models/Ticket','__esModule','13488VkpAvp','getIO','3561OgCAXs','./FindOrCreateATicketTrakingService','toString','../../helpers/CheckContactOpenTickets'];a549_0xb77e=function(){return _0x25bc98;};return a549_0xb77e();}'use strict';function a549_0x1e20(_0x3cd8a2,_0x1125f8){const _0x2de802=a549_0xb77e();return a549_0x1e20=function(_0x2d77e7,_0x2bba4b){_0x2d77e7=_0x2d77e7-0x88;let _0xb77edc=_0x2de802[_0x2d77e7];return _0xb77edc;},a549_0x1e20(_0x3cd8a2,_0x1125f8);}var __importDefault=this&&this[a549_0x4a3dd8(0x91)]||function(_0x200108){const _0x8710cc=a549_0x4a3dd8;return _0x200108&&_0x200108[_0x8710cc(0x9b)]?_0x200108:{'default':_0x200108};};Object[a549_0x4a3dd8(0xa3)](exports,a549_0x4a3dd8(0x9b),{'value':!![]});const AppError_1=__importDefault(require(a549_0x4a3dd8(0xa6))),CheckContactOpenTickets_1=__importDefault(require(a549_0x4a3dd8(0xa1))),GetDefaultWhatsApp_1=__importDefault(require('../../helpers/GetDefaultWhatsApp')),Ticket_1=__importDefault(require(a549_0x4a3dd8(0x9a))),ShowContactService_1=__importDefault(require(a549_0x4a3dd8(0xa9))),socket_1=require(a549_0x4a3dd8(0x96)),FindOrCreateATicketTrakingService_1=__importDefault(require(a549_0x4a3dd8(0x9f))),CreateTicketService=async({contactId:_0x1aacde,userId:_0x3de523,queueId:_0x310b0c,companyId:_0x54ffca})=>{const _0x24f86c=a549_0x4a3dd8,_0x419122=await(0x0,GetDefaultWhatsApp_1['default'])(_0x54ffca);await(0x0,CheckContactOpenTickets_1['default'])(_0x1aacde,_0x419122['id']);const {isGroup:_0x1434ab}=await(0x0,ShowContactService_1['default'])(_0x1aacde,_0x54ffca),{id:_0x13ad90}=await Ticket_1['default'][_0x24f86c(0x8b)]({'contactId':_0x1aacde,'companyId':_0x54ffca,'queueId':_0x310b0c,'whatsappId':_0x419122['id'],'status':_0x24f86c(0x8d),'isGroup':_0x1434ab,'userId':_0x3de523,'lastProcessedMessageId':null}),_0x17c59e=await Ticket_1[_0x24f86c(0xa4)]['findByPk'](_0x13ad90,{'include':[_0x24f86c(0xa5),'queue',_0x24f86c(0x94),'user']});if(!_0x17c59e)throw new AppError_1['default'](_0x24f86c(0x8c));await(0x0,FindOrCreateATicketTrakingService_1[_0x24f86c(0xa4)])({'ticketId':_0x17c59e['id'],'companyId':_0x17c59e[_0x24f86c(0x98)],'whatsappId':_0x17c59e['whatsappId'],'userId':_0x17c59e[_0x24f86c(0x92)]});const _0x57cd74=(0x0,socket_1[_0x24f86c(0x9d)])();return _0x57cd74['to'](_0x17c59e['id']['toString']())[_0x24f86c(0x8f)](_0x24f86c(0x89),{'action':_0x24f86c(0x8a),'ticket':_0x17c59e}),_0x17c59e;};exports[a549_0x4a3dd8(0xa4)]=CreateTicketService;