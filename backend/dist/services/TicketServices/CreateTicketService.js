function a661_0x3848(){const _0x5e48de=['user','../../helpers/GetDefaultWhatsApp','create','../ContactServices/ShowContactService','../../helpers/CheckContactOpenTickets','9962981wdSLaD','(((.+)+)+)+$','1491240pHsbTQ','11NuvBJT','open','378767Jsuhdr','978HyqkQm','whatsappId','../../errors/AppError','userId','__importDefault','2585656ExqQXf','search','3517928byuwpY','./FindOrCreateATicketTrakingService','companyId','contact','__esModule','findByPk','emit','defineProperty','2JkIrAe','9oOEZCz','apply','update','toString','ticket','18365yeRcxK','16921550vRFgeb','default','constructor'];a661_0x3848=function(){return _0x5e48de;};return a661_0x3848();}const a661_0x19a99a=a661_0x2a98;(function(_0x510fc4,_0x7cf56b){const _0x2a5923=a661_0x2a98,_0x57f997=_0x510fc4();while(!![]){try{const _0x502744=-parseInt(_0x2a5923(0x1ad))/0x1*(parseInt(_0x2a5923(0x199))/0x2)+parseInt(_0x2a5923(0x1aa))/0x3+-parseInt(_0x2a5923(0x1b3))/0x4+parseInt(_0x2a5923(0x19f))/0x5*(parseInt(_0x2a5923(0x1ae))/0x6)+-parseInt(_0x2a5923(0x1a8))/0x7+parseInt(_0x2a5923(0x1b5))/0x8*(parseInt(_0x2a5923(0x19a))/0x9)+parseInt(_0x2a5923(0x1a0))/0xa*(parseInt(_0x2a5923(0x1ab))/0xb);if(_0x502744===_0x7cf56b)break;else _0x57f997['push'](_0x57f997['shift']());}catch(_0x2f2d0c){_0x57f997['push'](_0x57f997['shift']());}}}(a661_0x3848,0xbe3cb));const a661_0x16e3d4=(function(){let _0x381c95=!![];return function(_0xb949e,_0x4ae903){const _0x43afdd=_0x381c95?function(){const _0x331ebf=a661_0x2a98;if(_0x4ae903){const _0x5e8baa=_0x4ae903[_0x331ebf(0x19b)](_0xb949e,arguments);return _0x4ae903=null,_0x5e8baa;}}:function(){};return _0x381c95=![],_0x43afdd;};}()),a661_0x266ca3=a661_0x16e3d4(this,function(){const _0x5657e3=a661_0x2a98;return a661_0x266ca3[_0x5657e3(0x19d)]()[_0x5657e3(0x1b4)]('(((.+)+)+)+$')[_0x5657e3(0x19d)]()[_0x5657e3(0x1a2)](a661_0x266ca3)['search'](_0x5657e3(0x1a9));});a661_0x266ca3();'use strict';var __importDefault=this&&this[a661_0x19a99a(0x1b2)]||function(_0xec2b76){const _0x1f2df8=a661_0x19a99a;return _0xec2b76&&_0xec2b76[_0x1f2df8(0x195)]?_0xec2b76:{'default':_0xec2b76};};Object[a661_0x19a99a(0x198)](exports,a661_0x19a99a(0x195),{'value':!![]});function a661_0x2a98(_0x114042,_0x1ccfd8){const _0x5c8033=a661_0x3848();return a661_0x2a98=function(_0x266ca3,_0x16e3d4){_0x266ca3=_0x266ca3-0x194;let _0x384829=_0x5c8033[_0x266ca3];return _0x384829;},a661_0x2a98(_0x114042,_0x1ccfd8);}const AppError_1=__importDefault(require(a661_0x19a99a(0x1b0))),CheckContactOpenTickets_1=__importDefault(require(a661_0x19a99a(0x1a7))),GetDefaultWhatsApp_1=__importDefault(require(a661_0x19a99a(0x1a4))),Ticket_1=__importDefault(require('../../models/Ticket')),ShowContactService_1=__importDefault(require(a661_0x19a99a(0x1a6))),socket_1=require('../../libs/socket'),FindOrCreateATicketTrakingService_1=__importDefault(require(a661_0x19a99a(0x1b6))),CreateTicketService=async({contactId:_0x232474,userId:_0x2cc8e0,queueId:_0x5ea633,companyId:_0x57154c})=>{const _0x4ebb3a=a661_0x19a99a,_0x20977e=await(0x0,GetDefaultWhatsApp_1[_0x4ebb3a(0x1a1)])(_0x57154c);await(0x0,CheckContactOpenTickets_1[_0x4ebb3a(0x1a1)])(_0x232474,_0x20977e['id']);const {isGroup:_0x1f1c39}=await(0x0,ShowContactService_1['default'])(_0x232474,_0x57154c),{id:_0x46f01d}=await Ticket_1[_0x4ebb3a(0x1a1)][_0x4ebb3a(0x1a5)]({'contactId':_0x232474,'companyId':_0x57154c,'queueId':_0x5ea633,'whatsappId':_0x20977e['id'],'status':_0x4ebb3a(0x1ac),'isGroup':_0x1f1c39,'userId':_0x2cc8e0,'lastProcessedMessageId':null}),_0x4566ad=await Ticket_1[_0x4ebb3a(0x1a1)][_0x4ebb3a(0x196)](_0x46f01d,{'include':[_0x4ebb3a(0x194),'queue','whatsapp',_0x4ebb3a(0x1a3)]});if(!_0x4566ad)throw new AppError_1[(_0x4ebb3a(0x1a1))]('ERR_CREATING_TICKET');await(0x0,FindOrCreateATicketTrakingService_1[_0x4ebb3a(0x1a1)])({'ticketId':_0x4566ad['id'],'companyId':_0x4566ad[_0x4ebb3a(0x1b7)],'whatsappId':_0x4566ad[_0x4ebb3a(0x1af)],'userId':_0x4566ad[_0x4ebb3a(0x1b1)]});const _0x372673=(0x0,socket_1['getIO'])();return _0x372673['to'](_0x4566ad['id'][_0x4ebb3a(0x19d)]())[_0x4ebb3a(0x197)](_0x4ebb3a(0x19e),{'action':_0x4ebb3a(0x19c),'ticket':_0x4566ad}),_0x4566ad;};exports[a661_0x19a99a(0x1a1)]=CreateTicketService;