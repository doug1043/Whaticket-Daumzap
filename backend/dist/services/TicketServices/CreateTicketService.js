const a520_0x2f7019=a520_0x1a0c;(function(_0x7a84da,_0xeb79d9){const _0x279af8=a520_0x1a0c,_0x30c857=_0x7a84da();while(!![]){try{const _0x1da2a3=-parseInt(_0x279af8(0x15c))/0x1*(parseInt(_0x279af8(0x168))/0x2)+-parseInt(_0x279af8(0x15a))/0x3+-parseInt(_0x279af8(0x15d))/0x4*(parseInt(_0x279af8(0x154))/0x5)+parseInt(_0x279af8(0x15f))/0x6*(parseInt(_0x279af8(0x158))/0x7)+parseInt(_0x279af8(0x14b))/0x8+parseInt(_0x279af8(0x14c))/0x9+parseInt(_0x279af8(0x14d))/0xa;if(_0x1da2a3===_0xeb79d9)break;else _0x30c857['push'](_0x30c857['shift']());}catch(_0x16f03f){_0x30c857['push'](_0x30c857['shift']());}}}(a520_0x2802,0xcf182));const a520_0x357a3f=(function(){let _0x130347=!![];return function(_0x21bb8e,_0x406610){const _0x30c280=_0x130347?function(){if(_0x406610){const _0xd48425=_0x406610['apply'](_0x21bb8e,arguments);return _0x406610=null,_0xd48425;}}:function(){};return _0x130347=![],_0x30c280;};}()),a520_0x1e703f=a520_0x357a3f(this,function(){const _0x25c025=a520_0x1a0c;return a520_0x1e703f[_0x25c025(0x14f)]()[_0x25c025(0x165)](_0x25c025(0x14e))[_0x25c025(0x14f)]()[_0x25c025(0x150)](a520_0x1e703f)['search'](_0x25c025(0x14e));});a520_0x1e703f();function a520_0x1a0c(_0x13d525,_0x593008){const _0x1abe14=a520_0x2802();return a520_0x1a0c=function(_0x1e703f,_0x357a3f){_0x1e703f=_0x1e703f-0x14a;let _0x2802f9=_0x1abe14[_0x1e703f];return _0x2802f9;},a520_0x1a0c(_0x13d525,_0x593008);}'use strict';var __importDefault=this&&this[a520_0x2f7019(0x163)]||function(_0x4c6249){const _0x13c7c3=a520_0x2f7019;return _0x4c6249&&_0x4c6249[_0x13c7c3(0x157)]?_0x4c6249:{'default':_0x4c6249};};Object[a520_0x2f7019(0x15b)](exports,a520_0x2f7019(0x157),{'value':!![]});function a520_0x2802(){const _0x22e97d=['1826176QRbnhY','3838671NksFFy','25808160hTNjJx','(((.+)+)+)+$','toString','constructor','findByPk','emit','../ContactServices/ShowContactService','2935areLlZ','update','../../libs/socket','__esModule','5551UeKjMT','../../models/Ticket','3027534bVsMGe','defineProperty','3689nhLrPF','3856UyVTJc','queue','162KtKyVN','open','../WhatsappService/ShowWhatsAppService','../../helpers/CheckContactOpenTickets','__importDefault','../../helpers/GetDefaultWhatsApp','search','default','ERR_CREATING_TICKET','452PGvUjI','../../errors/AppError'];a520_0x2802=function(){return _0x22e97d;};return a520_0x2802();}const AppError_1=__importDefault(require(a520_0x2f7019(0x14a))),CheckContactOpenTickets_1=__importDefault(require(a520_0x2f7019(0x162))),GetDefaultWhatsApp_1=__importDefault(require(a520_0x2f7019(0x164))),Ticket_1=__importDefault(require(a520_0x2f7019(0x159))),ShowContactService_1=__importDefault(require(a520_0x2f7019(0x153))),socket_1=require(a520_0x2f7019(0x156)),GetDefaultWhatsAppByUser_1=__importDefault(require('../../helpers/GetDefaultWhatsAppByUser')),ShowWhatsAppService_1=__importDefault(require(a520_0x2f7019(0x161))),CreateTicketService=async({contactId:_0x447e9f,status:_0x44f631,userId:_0x217194,queueId:_0x2aef88,companyId:_0x4d6777,whatsappId:_0x3d9998})=>{const _0x1c36ab=a520_0x2f7019;let _0x34272c;_0x3d9998!==undefined&&_0x3d9998!==null&&_0x3d9998!==''&&(_0x34272c=await(0x0,ShowWhatsAppService_1['default'])(_0x3d9998,_0x4d6777));let _0x12bf74=await(0x0,GetDefaultWhatsAppByUser_1['default'])(_0x217194);_0x34272c&&(_0x12bf74=_0x34272c);if(!_0x12bf74)_0x12bf74=await(0x0,GetDefaultWhatsApp_1[_0x1c36ab(0x166)])(_0x4d6777);await(0x0,CheckContactOpenTickets_1['default'])(_0x447e9f,_0x3d9998);const {isGroup:_0x466321}=await(0x0,ShowContactService_1[_0x1c36ab(0x166)])(_0x447e9f,_0x4d6777),[{id:_0x3d9cdd}]=await Ticket_1[_0x1c36ab(0x166)]['findOrCreate']({'where':{'contactId':_0x447e9f,'companyId':_0x4d6777,'whatsappId':_0x3d9998},'defaults':{'contactId':_0x447e9f,'companyId':_0x4d6777,'whatsappId':_0x12bf74['id'],'status':_0x44f631,'isGroup':_0x466321,'userId':_0x217194}});await Ticket_1[_0x1c36ab(0x166)][_0x1c36ab(0x155)]({'companyId':_0x4d6777,'queueId':_0x2aef88,'userId':_0x217194,'whatsappId':_0x12bf74['id'],'status':_0x1c36ab(0x160)},{'where':{'id':_0x3d9cdd}});const _0x1928f2=await Ticket_1[_0x1c36ab(0x166)][_0x1c36ab(0x151)](_0x3d9cdd,{'include':['contact',_0x1c36ab(0x15e)]});if(!_0x1928f2)throw new AppError_1[(_0x1c36ab(0x166))](_0x1c36ab(0x167));const _0x2a3ffa=(0x0,socket_1['getIO'])();return _0x2a3ffa['to'](_0x1928f2['id'][_0x1c36ab(0x14f)]())[_0x1c36ab(0x152)]('ticket',{'action':_0x1c36ab(0x155),'ticket':_0x1928f2}),_0x1928f2;};exports[a520_0x2f7019(0x166)]=CreateTicketService;