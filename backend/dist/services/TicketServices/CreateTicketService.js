const a554_0x15a745=a554_0x8da5;(function(_0x54d883,_0x41e54f){const _0x1237e2=a554_0x8da5,_0x59b419=_0x54d883();while(!![]){try{const _0x1b972d=-parseInt(_0x1237e2(0x154))/0x1*(parseInt(_0x1237e2(0x167))/0x2)+-parseInt(_0x1237e2(0x15f))/0x3*(-parseInt(_0x1237e2(0x155))/0x4)+parseInt(_0x1237e2(0x15b))/0x5+parseInt(_0x1237e2(0x163))/0x6+-parseInt(_0x1237e2(0x166))/0x7+-parseInt(_0x1237e2(0x149))/0x8+-parseInt(_0x1237e2(0x14c))/0x9*(-parseInt(_0x1237e2(0x151))/0xa);if(_0x1b972d===_0x41e54f)break;else _0x59b419['push'](_0x59b419['shift']());}catch(_0x905e1b){_0x59b419['push'](_0x59b419['shift']());}}}(a554_0x3da8,0xa69b7));const a554_0x5443d4=(function(){let _0x23eb26=!![];return function(_0x497705,_0x370f99){const _0x375738=_0x23eb26?function(){if(_0x370f99){const _0x5d066b=_0x370f99['apply'](_0x497705,arguments);return _0x370f99=null,_0x5d066b;}}:function(){};return _0x23eb26=![],_0x375738;};}()),a554_0xaee456=a554_0x5443d4(this,function(){const _0x237e0e=a554_0x8da5;return a554_0xaee456['toString']()[_0x237e0e(0x165)](_0x237e0e(0x146))[_0x237e0e(0x14d)]()[_0x237e0e(0x14a)](a554_0xaee456)[_0x237e0e(0x165)]('(((.+)+)+)+$');});a554_0xaee456();'use strict';var __importDefault=this&&this[a554_0x15a745(0x157)]||function(_0x2556cb){const _0x378be1=a554_0x15a745;return _0x2556cb&&_0x2556cb[_0x378be1(0x15c)]?_0x2556cb:{'default':_0x2556cb};};Object[a554_0x15a745(0x162)](exports,a554_0x15a745(0x15c),{'value':!![]});function a554_0x8da5(_0x4360f2,_0x4eb9fe){const _0x4bbc39=a554_0x3da8();return a554_0x8da5=function(_0xaee456,_0x5443d4){_0xaee456=_0xaee456-0x145;let _0x3da8c4=_0x4bbc39[_0xaee456];return _0x3da8c4;},a554_0x8da5(_0x4360f2,_0x4eb9fe);}function a554_0x3da8(){const _0x370ab0=['8jJtqnX','34948ZFShdh','../../errors/AppError','__importDefault','../../helpers/GetDefaultWhatsApp','update','contact','625845SpfWBt','__esModule','default','../../libs/socket','102BkSAtK','../ContactServices/ShowContactService','../../models/Ticket','defineProperty','1959372XtrPeD','ERR_CREATING_TICKET','search','9513791uxMNAo','21466MjMaEv','open','(((.+)+)+)+$','user','findByPk','2988896THyoTB','constructor','emit','1433637lpaqkl','toString','../../helpers/CheckContactOpenTickets','whatsapp','userId','110QNbZYh','companyId','getIO'];a554_0x3da8=function(){return _0x370ab0;};return a554_0x3da8();}const AppError_1=__importDefault(require(a554_0x15a745(0x156))),CheckContactOpenTickets_1=__importDefault(require(a554_0x15a745(0x14e))),GetDefaultWhatsApp_1=__importDefault(require(a554_0x15a745(0x158))),Ticket_1=__importDefault(require(a554_0x15a745(0x161))),ShowContactService_1=__importDefault(require(a554_0x15a745(0x160))),socket_1=require(a554_0x15a745(0x15e)),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),CreateTicketService=async({contactId:_0xba33d4,userId:_0xfd389e,queueId:_0x175c37,companyId:_0x184f8c})=>{const _0x1e8f60=a554_0x15a745,_0x4b9e2b=await(0x0,GetDefaultWhatsApp_1['default'])(_0x184f8c);await(0x0,CheckContactOpenTickets_1[_0x1e8f60(0x15d)])(_0xba33d4,_0x4b9e2b['id']);const {isGroup:_0x52f55b}=await(0x0,ShowContactService_1[_0x1e8f60(0x15d)])(_0xba33d4,_0x184f8c),{id:_0x9b2716}=await Ticket_1['default']['create']({'contactId':_0xba33d4,'companyId':_0x184f8c,'queueId':_0x175c37,'whatsappId':_0x4b9e2b['id'],'status':_0x1e8f60(0x145),'isGroup':_0x52f55b,'userId':_0xfd389e,'lastProcessedMessageId':null}),_0x4f52b1=await Ticket_1[_0x1e8f60(0x15d)][_0x1e8f60(0x148)](_0x9b2716,{'include':[_0x1e8f60(0x15a),'queue',_0x1e8f60(0x14f),_0x1e8f60(0x147)]});if(!_0x4f52b1)throw new AppError_1[(_0x1e8f60(0x15d))](_0x1e8f60(0x164));await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x4f52b1['id'],'companyId':_0x4f52b1[_0x1e8f60(0x152)],'whatsappId':_0x4f52b1['whatsappId'],'userId':_0x4f52b1[_0x1e8f60(0x150)]});const _0x423cb9=(0x0,socket_1[_0x1e8f60(0x153)])();return _0x423cb9['to'](_0x4f52b1['id'][_0x1e8f60(0x14d)]())[_0x1e8f60(0x14b)]('ticket',{'action':_0x1e8f60(0x159),'ticket':_0x4f52b1}),_0x4f52b1;};exports[a554_0x15a745(0x15d)]=CreateTicketService;