const a521_0x52b6a1=a521_0x24bc;(function(_0x574821,_0x537d6d){const _0x1d5c23=a521_0x24bc,_0x34c669=_0x574821();while(!![]){try{const _0x5668e1=-parseInt(_0x1d5c23(0x101))/0x1+-parseInt(_0x1d5c23(0x108))/0x2*(-parseInt(_0x1d5c23(0x103))/0x3)+parseInt(_0x1d5c23(0x106))/0x4+-parseInt(_0x1d5c23(0x109))/0x5*(parseInt(_0x1d5c23(0x104))/0x6)+-parseInt(_0x1d5c23(0x107))/0x7*(parseInt(_0x1d5c23(0xff))/0x8)+parseInt(_0x1d5c23(0xfd))/0x9+-parseInt(_0x1d5c23(0xef))/0xa*(-parseInt(_0x1d5c23(0xfc))/0xb);if(_0x5668e1===_0x537d6d)break;else _0x34c669['push'](_0x34c669['shift']());}catch(_0x340984){_0x34c669['push'](_0x34c669['shift']());}}}(a521_0x2cc1,0xb7e7a));const a521_0x2f21a6=(function(){let _0x4c1c16=!![];return function(_0x1387de,_0x2d0f9f){const _0x1e38af=_0x4c1c16?function(){const _0x51d010=a521_0x24bc;if(_0x2d0f9f){const _0x2c5527=_0x2d0f9f[_0x51d010(0x10c)](_0x1387de,arguments);return _0x2d0f9f=null,_0x2c5527;}}:function(){};return _0x4c1c16=![],_0x1e38af;};}()),a521_0x50ea16=a521_0x2f21a6(this,function(){const _0x48a5dd=a521_0x24bc;return a521_0x50ea16[_0x48a5dd(0x10b)]()[_0x48a5dd(0x102)](_0x48a5dd(0xf9))[_0x48a5dd(0x10b)]()[_0x48a5dd(0x10a)](a521_0x50ea16)[_0x48a5dd(0x102)]('(((.+)+)+)+$');});a521_0x50ea16();'use strict';function a521_0x24bc(_0x590784,_0x1e051e){const _0x30e3a2=a521_0x2cc1();return a521_0x24bc=function(_0x50ea16,_0x2f21a6){_0x50ea16=_0x50ea16-0xee;let _0x2cc1d7=_0x30e3a2[_0x50ea16];return _0x2cc1d7;},a521_0x24bc(_0x590784,_0x1e051e);}var __importDefault=this&&this[a521_0x52b6a1(0xf3)]||function(_0x1c48c4){return _0x1c48c4&&_0x1c48c4['__esModule']?_0x1c48c4:{'default':_0x1c48c4};};Object[a521_0x52b6a1(0xf4)](exports,'__esModule',{'value':!![]});const AppError_1=__importDefault(require(a521_0x52b6a1(0xf8))),CheckContactOpenTickets_1=__importDefault(require(a521_0x52b6a1(0xfb))),GetDefaultWhatsApp_1=__importDefault(require(a521_0x52b6a1(0x105))),Ticket_1=__importDefault(require(a521_0x52b6a1(0x100))),ShowContactService_1=__importDefault(require(a521_0x52b6a1(0xee))),socket_1=require(a521_0x52b6a1(0xfa)),GetDefaultWhatsAppByUser_1=__importDefault(require('../../helpers/GetDefaultWhatsAppByUser')),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),CreateTicketService=async({contactId:_0x13418e,status:_0x510ae1,userId:_0x2e9e06,queueId:_0x3ed543,companyId:_0x1d6d1d,whatsappId:_0x3b6911})=>{const _0x5e5383=a521_0x52b6a1;let _0x930982;_0x3b6911!==undefined&&_0x3b6911!==null&&_0x3b6911!==''&&(_0x930982=await(0x0,ShowWhatsAppService_1[_0x5e5383(0xf0)])(_0x3b6911,_0x1d6d1d));let _0x1e42b6=await(0x0,GetDefaultWhatsAppByUser_1[_0x5e5383(0xf0)])(_0x2e9e06);_0x930982&&(_0x1e42b6=_0x930982);if(!_0x1e42b6)_0x1e42b6=await(0x0,GetDefaultWhatsApp_1[_0x5e5383(0xf0)])(_0x1d6d1d);await(0x0,CheckContactOpenTickets_1[_0x5e5383(0xf0)])(_0x13418e,_0x3b6911);const {isGroup:_0x14078d}=await(0x0,ShowContactService_1[_0x5e5383(0xf0)])(_0x13418e,_0x1d6d1d),[{id:_0x17c9f7}]=await Ticket_1[_0x5e5383(0xf0)]['findOrCreate']({'where':{'contactId':_0x13418e,'companyId':_0x1d6d1d,'whatsappId':_0x3b6911},'defaults':{'contactId':_0x13418e,'companyId':_0x1d6d1d,'whatsappId':_0x1e42b6['id'],'status':_0x510ae1,'isGroup':_0x14078d,'userId':_0x2e9e06}});await Ticket_1[_0x5e5383(0xf0)][_0x5e5383(0x10d)]({'companyId':_0x1d6d1d,'queueId':_0x3ed543,'userId':_0x2e9e06,'whatsappId':_0x1e42b6['id'],'status':_0x5e5383(0xf5)},{'where':{'id':_0x17c9f7}});const _0x2a02a7=await Ticket_1[_0x5e5383(0xf0)][_0x5e5383(0xf7)](_0x17c9f7,{'include':['contact',_0x5e5383(0xf1)]});if(!_0x2a02a7)throw new AppError_1[(_0x5e5383(0xf0))]('ERR_CREATING_TICKET');const _0x2c5fc9=(0x0,socket_1[_0x5e5383(0xf6)])();return _0x2c5fc9['to'](_0x2a02a7['id'][_0x5e5383(0x10b)]())[_0x5e5383(0xf2)](_0x5e5383(0xfe),{'action':_0x5e5383(0x10d),'ticket':_0x2a02a7}),_0x2a02a7;};function a521_0x2cc1(){const _0x58665a=['apply','update','../ContactServices/ShowContactService','1940oazomi','default','queue','emit','__importDefault','defineProperty','open','getIO','findByPk','../../errors/AppError','(((.+)+)+)+$','../../libs/socket','../../helpers/CheckContactOpenTickets','19514SbBVlY','3902733ndieBX','ticket','2792qSEFiS','../../models/Ticket','708706xvXhgz','search','9yyoGUN','205878NwrkfC','../../helpers/GetDefaultWhatsApp','4599704OCjCrY','1946UDCxPL','669202DSYLqI','200KEjAZT','constructor','toString'];a521_0x2cc1=function(){return _0x58665a;};return a521_0x2cc1();}exports[a521_0x52b6a1(0xf0)]=CreateTicketService;