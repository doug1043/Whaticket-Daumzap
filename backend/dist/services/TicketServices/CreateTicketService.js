const a662_0x1ae0aa=a662_0x59d8;(function(_0x335686,_0x66922f){const _0x5db053=a662_0x59d8,_0x365969=_0x335686();while(!![]){try{const _0x49840a=-parseInt(_0x5db053(0x105))/0x1+parseInt(_0x5db053(0xf4))/0x2*(parseInt(_0x5db053(0x107))/0x3)+-parseInt(_0x5db053(0xfb))/0x4+-parseInt(_0x5db053(0x10d))/0x5+-parseInt(_0x5db053(0x10c))/0x6+parseInt(_0x5db053(0xf8))/0x7+parseInt(_0x5db053(0x102))/0x8*(parseInt(_0x5db053(0x10b))/0x9);if(_0x49840a===_0x66922f)break;else _0x365969['push'](_0x365969['shift']());}catch(_0x11c45e){_0x365969['push'](_0x365969['shift']());}}}(a662_0x3556,0xe0f61));function a662_0x59d8(_0x2b9768,_0x34b955){const _0x6fef57=a662_0x3556();return a662_0x59d8=function(_0x50672a,_0xfee3fe){_0x50672a=_0x50672a-0xee;let _0x3556e4=_0x6fef57[_0x50672a];return _0x3556e4;},a662_0x59d8(_0x2b9768,_0x34b955);}const a662_0xfee3fe=(function(){let _0x83c651=!![];return function(_0x4089cd,_0x17f9b7){const _0x31e36f=_0x83c651?function(){if(_0x17f9b7){const _0xa0912e=_0x17f9b7['apply'](_0x4089cd,arguments);return _0x17f9b7=null,_0xa0912e;}}:function(){};return _0x83c651=![],_0x31e36f;};}()),a662_0x50672a=a662_0xfee3fe(this,function(){const _0x406af8=a662_0x59d8;return a662_0x50672a[_0x406af8(0xf9)]()['search'](_0x406af8(0x109))['toString']()[_0x406af8(0x110)](a662_0x50672a)[_0x406af8(0x10a)]('(((.+)+)+)+$');});function a662_0x3556(){const _0x514f5b=['./FindOrCreateATicketTrakingService','update','ERR_CREATING_TICKET','../../helpers/GetDefaultWhatsApp','default','2ahFIQX','create','findByPk','companyId','10966977UfzUus','toString','whatsapp','6665292HMIgpt','getIO','../../helpers/CheckContactOpenTickets','../../models/Ticket','__esModule','contact','ticket','104EdajcF','../ContactServices/ShowContactService','defineProperty','1090223nfzGCQ','open','362154kAotCO','userId','(((.+)+)+)+$','search','3202047AItjyZ','6881112ccSmrI','7438845nKRIgU','queue','emit','constructor','__importDefault'];a662_0x3556=function(){return _0x514f5b;};return a662_0x3556();}a662_0x50672a();'use strict';var __importDefault=this&&this[a662_0x1ae0aa(0xee)]||function(_0xe7fa48){const _0x49bba4=a662_0x1ae0aa;return _0xe7fa48&&_0xe7fa48[_0x49bba4(0xff)]?_0xe7fa48:{'default':_0xe7fa48};};Object[a662_0x1ae0aa(0x104)](exports,a662_0x1ae0aa(0xff),{'value':!![]});const AppError_1=__importDefault(require('../../errors/AppError')),CheckContactOpenTickets_1=__importDefault(require(a662_0x1ae0aa(0xfd))),GetDefaultWhatsApp_1=__importDefault(require(a662_0x1ae0aa(0xf2))),Ticket_1=__importDefault(require(a662_0x1ae0aa(0xfe))),ShowContactService_1=__importDefault(require(a662_0x1ae0aa(0x103))),socket_1=require('../../libs/socket'),FindOrCreateATicketTrakingService_1=__importDefault(require(a662_0x1ae0aa(0xef))),CreateTicketService=async({contactId:_0x3a2470,userId:_0x212e6d,queueId:_0x3d023b,companyId:_0x408662})=>{const _0x462cc5=a662_0x1ae0aa,_0x370735=await(0x0,GetDefaultWhatsApp_1[_0x462cc5(0xf3)])(_0x408662);await(0x0,CheckContactOpenTickets_1[_0x462cc5(0xf3)])(_0x3a2470,_0x370735['id']);const {isGroup:_0xa69d19}=await(0x0,ShowContactService_1[_0x462cc5(0xf3)])(_0x3a2470,_0x408662),{id:_0x5e358e}=await Ticket_1[_0x462cc5(0xf3)][_0x462cc5(0xf5)]({'contactId':_0x3a2470,'companyId':_0x408662,'queueId':_0x3d023b,'whatsappId':_0x370735['id'],'status':_0x462cc5(0x106),'isGroup':_0xa69d19,'userId':_0x212e6d,'lastProcessedMessageId':null}),_0x52f48d=await Ticket_1['default'][_0x462cc5(0xf6)](_0x5e358e,{'include':[_0x462cc5(0x100),_0x462cc5(0x10e),_0x462cc5(0xfa),'user']});if(!_0x52f48d)throw new AppError_1[(_0x462cc5(0xf3))](_0x462cc5(0xf1));await(0x0,FindOrCreateATicketTrakingService_1[_0x462cc5(0xf3)])({'ticketId':_0x52f48d['id'],'companyId':_0x52f48d[_0x462cc5(0xf7)],'whatsappId':_0x52f48d['whatsappId'],'userId':_0x52f48d[_0x462cc5(0x108)]});const _0xa21754=(0x0,socket_1[_0x462cc5(0xfc)])();return _0xa21754['to'](_0x52f48d['id'][_0x462cc5(0xf9)]())[_0x462cc5(0x10f)](_0x462cc5(0x101),{'action':_0x462cc5(0xf0),'ticket':_0x52f48d}),_0x52f48d;};exports[a662_0x1ae0aa(0xf3)]=CreateTicketService;