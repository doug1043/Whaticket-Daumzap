const a521_0x2ac825=a521_0x6ced;(function(_0xd5d9c8,_0x506a03){const _0x26fc59=a521_0x6ced,_0x1e9c39=_0xd5d9c8();while(!![]){try{const _0x198e8e=-parseInt(_0x26fc59(0xf9))/0x1+parseInt(_0x26fc59(0x100))/0x2+-parseInt(_0x26fc59(0xf6))/0x3+parseInt(_0x26fc59(0xe6))/0x4*(-parseInt(_0x26fc59(0xe8))/0x5)+-parseInt(_0x26fc59(0xf4))/0x6+parseInt(_0x26fc59(0xfc))/0x7*(parseInt(_0x26fc59(0xec))/0x8)+parseInt(_0x26fc59(0x103))/0x9;if(_0x198e8e===_0x506a03)break;else _0x1e9c39['push'](_0x1e9c39['shift']());}catch(_0x328e39){_0x1e9c39['push'](_0x1e9c39['shift']());}}}(a521_0x403b,0x6801c));const a521_0x51fc87=(function(){let _0x536d72=!![];return function(_0x689464,_0x4a5822){const _0x47948f=_0x536d72?function(){const _0x4420c9=a521_0x6ced;if(_0x4a5822){const _0x2da554=_0x4a5822[_0x4420c9(0xe9)](_0x689464,arguments);return _0x4a5822=null,_0x2da554;}}:function(){};return _0x536d72=![],_0x47948f;};}()),a521_0xfcbd73=a521_0x51fc87(this,function(){const _0x4fce60=a521_0x6ced;return a521_0xfcbd73[_0x4fce60(0xef)]()[_0x4fce60(0xf5)](_0x4fce60(0xf7))[_0x4fce60(0xef)]()[_0x4fce60(0xfa)](a521_0xfcbd73)['search'](_0x4fce60(0xf7));});function a521_0x403b(){const _0x5a8d4c=['constructor','../ContactServices/ShowContactService','958489ygQRmf','default','../WhatsappService/ShowWhatsAppService','../../models/Ticket','656462vMBZLP','open','findByPk','4941945cSMSCM','16vmAdSz','emit','273910zGMRld','apply','ERR_CREATING_TICKET','ticket','24RODxwr','defineProperty','../../helpers/GetDefaultWhatsApp','toString','queue','../../helpers/GetDefaultWhatsAppByUser','contact','__esModule','2177076EkolYk','search','244152IbLNFL','(((.+)+)+)+$','update','198747STVLYh'];a521_0x403b=function(){return _0x5a8d4c;};return a521_0x403b();}a521_0xfcbd73();'use strict';function a521_0x6ced(_0x377e3b,_0x493095){const _0x515a56=a521_0x403b();return a521_0x6ced=function(_0xfcbd73,_0x51fc87){_0xfcbd73=_0xfcbd73-0xe6;let _0x403baf=_0x515a56[_0xfcbd73];return _0x403baf;},a521_0x6ced(_0x377e3b,_0x493095);}var __importDefault=this&&this['__importDefault']||function(_0x55f190){const _0x12a39f=a521_0x6ced;return _0x55f190&&_0x55f190[_0x12a39f(0xf3)]?_0x55f190:{'default':_0x55f190};};Object[a521_0x2ac825(0xed)](exports,a521_0x2ac825(0xf3),{'value':!![]});const AppError_1=__importDefault(require('../../errors/AppError')),CheckContactOpenTickets_1=__importDefault(require('../../helpers/CheckContactOpenTickets')),GetDefaultWhatsApp_1=__importDefault(require(a521_0x2ac825(0xee))),Ticket_1=__importDefault(require(a521_0x2ac825(0xff))),ShowContactService_1=__importDefault(require(a521_0x2ac825(0xfb))),socket_1=require('../../libs/socket'),GetDefaultWhatsAppByUser_1=__importDefault(require(a521_0x2ac825(0xf1))),ShowWhatsAppService_1=__importDefault(require(a521_0x2ac825(0xfe))),CreateTicketService=async({contactId:_0x548705,status:_0x134628,userId:_0x8e62e7,queueId:_0x9f08f5,companyId:_0x17ba71,whatsappId:_0x35a030})=>{const _0x356094=a521_0x2ac825;let _0x18a96a;_0x35a030!==undefined&&_0x35a030!==null&&_0x35a030!==''&&(_0x18a96a=await(0x0,ShowWhatsAppService_1[_0x356094(0xfd)])(_0x35a030,_0x17ba71));let _0x539bda=await(0x0,GetDefaultWhatsAppByUser_1[_0x356094(0xfd)])(_0x8e62e7);_0x18a96a&&(_0x539bda=_0x18a96a);if(!_0x539bda)_0x539bda=await(0x0,GetDefaultWhatsApp_1['default'])(_0x17ba71);await(0x0,CheckContactOpenTickets_1[_0x356094(0xfd)])(_0x548705,_0x35a030);const {isGroup:_0x1c0b5c}=await(0x0,ShowContactService_1[_0x356094(0xfd)])(_0x548705,_0x17ba71),[{id:_0x9c10c9}]=await Ticket_1[_0x356094(0xfd)]['findOrCreate']({'where':{'contactId':_0x548705,'companyId':_0x17ba71,'whatsappId':_0x35a030},'defaults':{'contactId':_0x548705,'companyId':_0x17ba71,'whatsappId':_0x539bda['id'],'status':_0x134628,'isGroup':_0x1c0b5c,'userId':_0x8e62e7}});await Ticket_1['default']['update']({'companyId':_0x17ba71,'queueId':_0x9f08f5,'userId':_0x8e62e7,'whatsappId':_0x539bda['id'],'status':_0x356094(0x101)},{'where':{'id':_0x9c10c9}});const _0x5d702c=await Ticket_1[_0x356094(0xfd)][_0x356094(0x102)](_0x9c10c9,{'include':[_0x356094(0xf2),_0x356094(0xf0)]});if(!_0x5d702c)throw new AppError_1[(_0x356094(0xfd))](_0x356094(0xea));const _0x249513=(0x0,socket_1['getIO'])();return _0x249513['to'](_0x5d702c['id'][_0x356094(0xef)]())[_0x356094(0xe7)](_0x356094(0xeb),{'action':_0x356094(0xf8),'ticket':_0x5d702c}),_0x5d702c;};exports[a521_0x2ac825(0xfd)]=CreateTicketService;