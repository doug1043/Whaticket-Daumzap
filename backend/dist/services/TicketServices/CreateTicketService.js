const a520_0x1123b3=a520_0x1041;(function(_0x15f9be,_0x1361df){const _0x733674=a520_0x1041,_0xcd1ea3=_0x15f9be();while(!![]){try{const _0x2dea8b=parseInt(_0x733674(0x124))/0x1*(parseInt(_0x733674(0x121))/0x2)+-parseInt(_0x733674(0x119))/0x3+-parseInt(_0x733674(0x116))/0x4+-parseInt(_0x733674(0x11d))/0x5+-parseInt(_0x733674(0x120))/0x6+-parseInt(_0x733674(0x11f))/0x7*(-parseInt(_0x733674(0x11a))/0x8)+parseInt(_0x733674(0x10f))/0x9;if(_0x2dea8b===_0x1361df)break;else _0xcd1ea3['push'](_0xcd1ea3['shift']());}catch(_0x31de1b){_0xcd1ea3['push'](_0xcd1ea3['shift']());}}}(a520_0x2c1f,0x9549c));const a520_0x36ce1b=(function(){let _0x997210=!![];return function(_0x4b8187,_0x43b3b4){const _0x8b02b=_0x997210?function(){if(_0x43b3b4){const _0x387308=_0x43b3b4['apply'](_0x4b8187,arguments);return _0x43b3b4=null,_0x387308;}}:function(){};return _0x997210=![],_0x8b02b;};}()),a520_0x5608ae=a520_0x36ce1b(this,function(){const _0xcfdc33=a520_0x1041;return a520_0x5608ae[_0xcfdc33(0x122)]()[_0xcfdc33(0x10d)](_0xcfdc33(0x12b))['toString']()[_0xcfdc33(0x12d)](a520_0x5608ae)[_0xcfdc33(0x10d)]('(((.+)+)+)+$');});function a520_0x2c1f(){const _0x2dc64d=['findByPk','../../helpers/GetDefaultWhatsAppByUser','5849715CumaJg','update','2631776ZtmGqE','6357822xXZAtf','1327038gtKwZY','toString','../ContactServices/ShowContactService','1cOuFEr','__esModule','../../errors/AppError','open','__importDefault','emit','queue','(((.+)+)+)+$','getIO','constructor','../../models/Ticket','../../helpers/GetDefaultWhatsApp','search','contact','27853533mJrBUA','defineProperty','ticket','findOrCreate','default','ERR_CREATING_TICKET','../WhatsappService/ShowWhatsAppService','1089712EwsvyY','../../helpers/CheckContactOpenTickets','../../libs/socket','3062496UPGQZm','8FWzrIi'];a520_0x2c1f=function(){return _0x2dc64d;};return a520_0x2c1f();}a520_0x5608ae();'use strict';var __importDefault=this&&this[a520_0x1123b3(0x128)]||function(_0x538de5){const _0x1476ec=a520_0x1123b3;return _0x538de5&&_0x538de5[_0x1476ec(0x125)]?_0x538de5:{'default':_0x538de5};};Object[a520_0x1123b3(0x110)](exports,a520_0x1123b3(0x125),{'value':!![]});function a520_0x1041(_0x3e65fa,_0x3d18c9){const _0x53ff09=a520_0x2c1f();return a520_0x1041=function(_0x5608ae,_0x36ce1b){_0x5608ae=_0x5608ae-0x10b;let _0x2c1fb9=_0x53ff09[_0x5608ae];return _0x2c1fb9;},a520_0x1041(_0x3e65fa,_0x3d18c9);}const AppError_1=__importDefault(require(a520_0x1123b3(0x126))),CheckContactOpenTickets_1=__importDefault(require(a520_0x1123b3(0x117))),GetDefaultWhatsApp_1=__importDefault(require(a520_0x1123b3(0x10c))),Ticket_1=__importDefault(require(a520_0x1123b3(0x10b))),ShowContactService_1=__importDefault(require(a520_0x1123b3(0x123))),socket_1=require(a520_0x1123b3(0x118)),GetDefaultWhatsAppByUser_1=__importDefault(require(a520_0x1123b3(0x11c))),ShowWhatsAppService_1=__importDefault(require(a520_0x1123b3(0x115))),CreateTicketService=async({contactId:_0x429f94,status:_0x504786,userId:_0x2cda70,queueId:_0x27dd1e,companyId:_0x58924d,whatsappId:_0x2b5aac})=>{const _0x305b9c=a520_0x1123b3;let _0x29a8fa;_0x2b5aac!==undefined&&_0x2b5aac!==null&&_0x2b5aac!==''&&(_0x29a8fa=await(0x0,ShowWhatsAppService_1[_0x305b9c(0x113)])(_0x2b5aac,_0x58924d));let _0x3c94ef=await(0x0,GetDefaultWhatsAppByUser_1[_0x305b9c(0x113)])(_0x2cda70);_0x29a8fa&&(_0x3c94ef=_0x29a8fa);if(!_0x3c94ef)_0x3c94ef=await(0x0,GetDefaultWhatsApp_1['default'])(_0x58924d);await(0x0,CheckContactOpenTickets_1[_0x305b9c(0x113)])(_0x429f94,_0x2b5aac);const {isGroup:_0x3c0298}=await(0x0,ShowContactService_1['default'])(_0x429f94,_0x58924d),[{id:_0x52b629}]=await Ticket_1[_0x305b9c(0x113)][_0x305b9c(0x112)]({'where':{'contactId':_0x429f94,'companyId':_0x58924d,'whatsappId':_0x2b5aac},'defaults':{'contactId':_0x429f94,'companyId':_0x58924d,'whatsappId':_0x3c94ef['id'],'status':_0x504786,'isGroup':_0x3c0298,'userId':_0x2cda70}});await Ticket_1[_0x305b9c(0x113)][_0x305b9c(0x11e)]({'companyId':_0x58924d,'queueId':_0x27dd1e,'userId':_0x2cda70,'whatsappId':_0x3c94ef['id'],'status':_0x305b9c(0x127)},{'where':{'id':_0x52b629}});const _0xd8a8ab=await Ticket_1[_0x305b9c(0x113)][_0x305b9c(0x11b)](_0x52b629,{'include':[_0x305b9c(0x10e),_0x305b9c(0x12a)]});if(!_0xd8a8ab)throw new AppError_1[(_0x305b9c(0x113))](_0x305b9c(0x114));const _0x3feb89=(0x0,socket_1[_0x305b9c(0x12c)])();return _0x3feb89['to'](_0xd8a8ab['id'][_0x305b9c(0x122)]())[_0x305b9c(0x129)](_0x305b9c(0x111),{'action':_0x305b9c(0x11e),'ticket':_0xd8a8ab}),_0xd8a8ab;};exports[a520_0x1123b3(0x113)]=CreateTicketService;