const a524_0x339adb=a524_0x27da;(function(_0x4d5460,_0x42c530){const _0x165d38=a524_0x27da,_0x568e47=_0x4d5460();while(!![]){try{const _0x410dce=-parseInt(_0x165d38(0x17a))/0x1*(parseInt(_0x165d38(0x191))/0x2)+-parseInt(_0x165d38(0x189))/0x3*(-parseInt(_0x165d38(0x16b))/0x4)+-parseInt(_0x165d38(0x16f))/0x5*(-parseInt(_0x165d38(0x183))/0x6)+parseInt(_0x165d38(0x179))/0x7*(-parseInt(_0x165d38(0x182))/0x8)+-parseInt(_0x165d38(0x18d))/0x9*(parseInt(_0x165d38(0x177))/0xa)+parseInt(_0x165d38(0x17e))/0xb*(parseInt(_0x165d38(0x173))/0xc)+parseInt(_0x165d38(0x180))/0xd*(parseInt(_0x165d38(0x181))/0xe);if(_0x410dce===_0x42c530)break;else _0x568e47['push'](_0x568e47['shift']());}catch(_0x2f0486){_0x568e47['push'](_0x568e47['shift']());}}}(a524_0xcabb,0xab3b3));const a524_0x3a6437=(function(){let _0x2ab017=!![];return function(_0x42de55,_0x216e13){const _0x29a7fb=_0x2ab017?function(){const _0x1b2918=a524_0x27da;if(_0x216e13){const _0x4e9b7b=_0x216e13[_0x1b2918(0x17b)](_0x42de55,arguments);return _0x216e13=null,_0x4e9b7b;}}:function(){};return _0x2ab017=![],_0x29a7fb;};}()),a524_0x9f30ec=a524_0x3a6437(this,function(){const _0x2541ba=a524_0x27da;return a524_0x9f30ec[_0x2541ba(0x18e)]()[_0x2541ba(0x184)]('(((.+)+)+)+$')[_0x2541ba(0x18e)]()[_0x2541ba(0x178)](a524_0x9f30ec)['search'](_0x2541ba(0x17c));});a524_0x9f30ec();'use strict';var __importDefault=this&&this[a524_0x339adb(0x175)]||function(_0x1a9549){const _0x262199=a524_0x339adb;return _0x1a9549&&_0x1a9549[_0x262199(0x169)]?_0x1a9549:{'default':_0x1a9549};};function a524_0x27da(_0x97f1f4,_0x15d571){const _0x327817=a524_0xcabb();return a524_0x27da=function(_0x9f30ec,_0x3a6437){_0x9f30ec=_0x9f30ec-0x169;let _0xcabb22=_0x327817[_0x9f30ec];return _0xcabb22;},a524_0x27da(_0x97f1f4,_0x15d571);}Object[a524_0x339adb(0x186)](exports,a524_0x339adb(0x169),{'value':!![]});const date_fns_1=require(a524_0x339adb(0x17f)),sequelize_1=require('sequelize'),Ticket_1=__importDefault(require(a524_0x339adb(0x190))),ShowTicketService_1=__importDefault(require(a524_0x339adb(0x188))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),Setting_1=__importDefault(require('../../models/Setting')),Whatsapp_1=__importDefault(require(a524_0x339adb(0x174))),FindOrCreateTicketService=async(_0x11743a,_0x224ab4,_0x54b5da,_0x7f817a,_0x12d989,_0x559ee2)=>{const _0x555d79=a524_0x339adb;let _0x25c5c0=await Ticket_1['default'][_0x555d79(0x16d)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x555d79(0x16e),'pending',_0x555d79(0x18c)]},'contactId':_0x12d989?_0x12d989['id']:_0x11743a['id'],'companyId':_0x7f817a,'whatsappId':_0x224ab4},'order':[['id',_0x555d79(0x171)]]});_0x25c5c0&&(_0x25c5c0[_0x555d79(0x176)]==='closed'?await _0x25c5c0[_0x555d79(0x18b)]({'unreadMessages':_0x54b5da,'whatsappId':_0x224ab4,'queueId':null,'userId':null,'status':_0x555d79(0x18a),'imported':_0x559ee2?new Date():null}):await _0x25c5c0[_0x555d79(0x18b)]({'unreadMessages':_0x54b5da,'whatsappId':_0x224ab4,'imported':_0x559ee2?new Date():null}));if(!_0x25c5c0&&_0x12d989){_0x25c5c0=await Ticket_1[_0x555d79(0x172)][_0x555d79(0x16d)]({'where':{'contactId':_0x12d989['id'],'whatsappId':_0x224ab4},'order':[[_0x555d79(0x170),_0x555d79(0x171)]]});_0x25c5c0&&(await _0x25c5c0[_0x555d79(0x18b)]({'status':_0x555d79(0x18a),'imported':_0x559ee2?new Date():null,'userId':null,'unreadMessages':_0x54b5da,'isGroup':_0x11743a[_0x555d79(0x185)],'whatsappId':_0x224ab4,'queueId':null,'companyId':_0x7f817a}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x25c5c0['id'],'companyId':_0x7f817a,'whatsappId':_0x25c5c0['whatsappId'],'userId':_0x25c5c0['userId']}));const _0x3f6fd7=await Setting_1[_0x555d79(0x172)][_0x555d79(0x16d)]({'where':{'key':_0x555d79(0x187)}}),_0xd283ef=_0x3f6fd7?parseInt(_0x3f6fd7[_0x555d79(0x17d)],0xa):0x1c20;}!_0x25c5c0&&!_0x12d989&&(_0x25c5c0=await Ticket_1['default'][_0x555d79(0x16d)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x555d79(0x18f)]]:[+(0x0,date_fns_1['subHours'])(new Date(),0x2),+new Date()]},'contactId':_0x11743a['id'],'whatsappId':_0x224ab4},'order':[[_0x555d79(0x170),_0x555d79(0x171)]]}),_0x25c5c0&&(await _0x25c5c0[_0x555d79(0x18b)]({'status':_0x555d79(0x18a),'imported':_0x559ee2?new Date():null,'userId':null,'isGroup':_0x11743a[_0x555d79(0x185)],'unreadMessages':_0x54b5da,'whatsappId':_0x224ab4,'queueId':null,'companyId':_0x7f817a}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x25c5c0['id'],'companyId':_0x7f817a,'whatsappId':_0x25c5c0['whatsappId'],'userId':_0x25c5c0[_0x555d79(0x16c)]})));if(!_0x25c5c0){const _0x4241ea=await Whatsapp_1[_0x555d79(0x172)][_0x555d79(0x16d)]({'where':{'id':_0x224ab4}});_0x25c5c0=await Ticket_1[_0x555d79(0x172)][_0x555d79(0x16a)]({'imported':_0x559ee2?new Date():null,'contactId':_0x12d989?_0x12d989['id']:_0x11743a['id'],'status':_0x555d79(0x18a),'isGroup':!!_0x12d989||_0x11743a[_0x555d79(0x185)],'unreadMessages':_0x54b5da,'whatsappId':_0x224ab4,'whatsapp':_0x4241ea,'companyId':_0x7f817a}),await(0x0,FindOrCreateATicketTrakingService_1[_0x555d79(0x172)])({'ticketId':_0x25c5c0['id'],'companyId':_0x7f817a,'whatsappId':_0x224ab4,'userId':_0x25c5c0[_0x555d79(0x16c)]});}return _0x25c5c0=await(0x0,ShowTicketService_1[_0x555d79(0x172)])(_0x25c5c0['id'],_0x7f817a),_0x25c5c0;};exports[a524_0x339adb(0x172)]=FindOrCreateTicketService;function a524_0xcabb(){const _0x1c5824=['392blAeUu','688TrjDwo','40284ravQmD','search','isGroup','defineProperty','timeCreateNewTicket','./ShowTicketService','51phYsbt','pending','update','closed','9RqzVBp','toString','between','../../models/Ticket','2530HglTdE','__esModule','create','249416ovlZOL','userId','findOne','open','570gQWsEz','updatedAt','DESC','default','2615796iKFSBu','../../models/Whatsapp','__importDefault','status','12204560QPBmdc','constructor','96236weoiFl','141MpCJZG','apply','(((.+)+)+)+$','value','22QHxyUe','date-fns','474097NrUGAX'];a524_0xcabb=function(){return _0x1c5824;};return a524_0xcabb();}