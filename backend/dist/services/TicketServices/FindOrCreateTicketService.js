const a666_0x2fbd6f=a666_0x4571;(function(_0x382926,_0x217036){const _0x1e974e=a666_0x4571,_0x251edb=_0x382926();while(!![]){try{const _0x597e87=parseInt(_0x1e974e(0x1b1))/0x1*(-parseInt(_0x1e974e(0x1a0))/0x2)+-parseInt(_0x1e974e(0x1b4))/0x3*(-parseInt(_0x1e974e(0x1a2))/0x4)+parseInt(_0x1e974e(0x1ab))/0x5*(-parseInt(_0x1e974e(0x19e))/0x6)+-parseInt(_0x1e974e(0x186))/0x7+parseInt(_0x1e974e(0x199))/0x8*(-parseInt(_0x1e974e(0x1a8))/0x9)+parseInt(_0x1e974e(0x190))/0xa+-parseInt(_0x1e974e(0x19a))/0xb*(-parseInt(_0x1e974e(0x184))/0xc);if(_0x597e87===_0x217036)break;else _0x251edb['push'](_0x251edb['shift']());}catch(_0x5020e0){_0x251edb['push'](_0x251edb['shift']());}}}(a666_0x4e78,0xbb933));const a666_0x42a046=(function(){let _0x485bec=!![];return function(_0xc53e1c,_0x4524b8){const _0x329d8d=_0x485bec?function(){const _0x154326=a666_0x4571;if(_0x4524b8){const _0x543238=_0x4524b8[_0x154326(0x1a6)](_0xc53e1c,arguments);return _0x4524b8=null,_0x543238;}}:function(){};return _0x485bec=![],_0x329d8d;};}()),a666_0x28b74a=a666_0x42a046(this,function(){const _0x2af684=a666_0x4571;return a666_0x28b74a['toString']()[_0x2af684(0x18a)](_0x2af684(0x1b2))['toString']()[_0x2af684(0x18d)](a666_0x28b74a)[_0x2af684(0x18a)](_0x2af684(0x1b2));});a666_0x28b74a();'use strict';var __importDefault=this&&this[a666_0x2fbd6f(0x1ad)]||function(_0x24b044){const _0x200264=a666_0x2fbd6f;return _0x24b044&&_0x24b044[_0x200264(0x195)]?_0x24b044:{'default':_0x24b044};};function a666_0x4571(_0x551397,_0x2264f4){const _0xd4f85f=a666_0x4e78();return a666_0x4571=function(_0x28b74a,_0x42a046){_0x28b74a=_0x28b74a-0x183;let _0x4e78ad=_0xd4f85f[_0x28b74a];return _0x4e78ad;},a666_0x4571(_0x551397,_0x2264f4);}Object[a666_0x2fbd6f(0x198)](exports,a666_0x2fbd6f(0x195),{'value':!![]});const date_fns_1=require(a666_0x2fbd6f(0x193)),sequelize_1=require(a666_0x2fbd6f(0x1b5)),async_mutex_1=require(a666_0x2fbd6f(0x194)),Ticket_1=__importDefault(require(a666_0x2fbd6f(0x197))),ShowTicketService_1=__importDefault(require(a666_0x2fbd6f(0x1b0))),FindOrCreateATicketTrakingService_1=__importDefault(require(a666_0x2fbd6f(0x1a9))),CheckSettings_1=require(a666_0x2fbd6f(0x19c)),database_1=__importDefault(require('../../database')),Whatsapp_1=__importDefault(require(a666_0x2fbd6f(0x19f))),User_1=__importDefault(require('../../models/User')),Company_1=__importDefault(require(a666_0x2fbd6f(0x18c))),createTicketMutex=new async_mutex_1['Mutex'](),isInCollectiveVacation=_0x341c58=>{const _0x5d34d4=a666_0x2fbd6f;if(!_0x341c58[_0x5d34d4(0x1a7)]||!_0x341c58[_0x5d34d4(0x1ae)]||!_0x341c58[_0x5d34d4(0x188)])return![];const _0x455fb5=new Date();_0x455fb5['setHours'](0x0,0x0,0x0,0x0);const _0x2a7236=new Date(_0x341c58['collectiveVacationStart']);_0x2a7236['setHours'](0x0,0x0,0x0,0x0);const _0x84bda2=new Date(_0x341c58[_0x5d34d4(0x188)]);return _0x84bda2[_0x5d34d4(0x185)](0x17,0x3b,0x3b,0x3e7),_0x455fb5>=_0x2a7236&&_0x455fb5<=_0x84bda2;},internalFindOrCreateTicketService=async(_0x30adcf,_0x533122,_0x30c596,_0x5a4cbf,_0x29d450,_0x171524,_0x4a1bd0)=>{const _0x359eb7=a666_0x2fbd6f;let _0x2ce69f=![];const _0x42026c=await database_1[_0x359eb7(0x1a1)][_0x359eb7(0x183)](async()=>{const _0x100530=_0x359eb7,_0x458979=await Whatsapp_1[_0x100530(0x1a1)][_0x100530(0x189)](_0x533122),_0x1f9d46=_0x458979?isInCollectiveVacation(_0x458979):![];let _0x2b1e81=await Ticket_1[_0x100530(0x1a1)][_0x100530(0x1a4)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x100530(0x18f),_0x100530(0x1af)]},'contactId':_0x29d450?_0x29d450['id']:_0x30adcf['id'],'whatsappId':_0x533122},'order':[['id',_0x100530(0x18b)]],'include':[{'model':User_1[_0x100530(0x1a1)]},{'model':Company_1[_0x100530(0x1a1)]}]});_0x2b1e81&&await _0x2b1e81['update']({'unreadMessages':_0x30c596,'ticketsWithWarning':![],'warningSentAt':null});!_0x2b1e81&&_0x29d450&&(_0x2b1e81=await Ticket_1[_0x100530(0x1a1)]['findOne']({'where':{'contactId':_0x29d450['id'],'whatsappId':_0x533122},'order':[['updatedAt',_0x100530(0x18b)]],'include':[{'model':User_1[_0x100530(0x1a1)]},{'model':Company_1[_0x100530(0x1a1)]}]}),_0x2b1e81&&(await _0x2b1e81[_0x100530(0x187)]({'status':_0x100530(0x1af),'userId':null,'unreadMessages':_0x30c596,'companyId':_0x5a4cbf}),await(0x0,FindOrCreateATicketTrakingService_1[_0x100530(0x1a1)])({'ticketId':_0x2b1e81['id'],'companyId':_0x5a4cbf,'whatsappId':_0x2b1e81[_0x100530(0x19d)],'userId':_0x2b1e81['userId']})));if(!_0x171524&&!_0x2b1e81&&!_0x29d450){const _0x35ee69=parseInt(await(0x0,CheckSettings_1[_0x100530(0x1ac)])(_0x5a4cbf,_0x100530(0x19b),'0'),0xa);_0x2b1e81=_0x35ee69&&await Ticket_1['default'][_0x100530(0x1a4)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x100530(0x18e)]]:[+(0x0,date_fns_1[_0x100530(0x1a5)])(new Date(),_0x35ee69),+new Date()]},'contactId':_0x30adcf['id'],'whatsappId':_0x533122},'order':[[_0x100530(0x1aa),_0x100530(0x18b)]],'include':[{'model':User_1[_0x100530(0x1a1)]},{'model':Company_1[_0x100530(0x1a1)]}]}),_0x2b1e81&&(await _0x2b1e81[_0x100530(0x187)]({'status':_0x100530(0x1af),'userId':null,'unreadMessages':_0x30c596,'companyId':_0x5a4cbf}),await(0x0,FindOrCreateATicketTrakingService_1[_0x100530(0x1a1)])({'ticketId':_0x2b1e81['id'],'companyId':_0x5a4cbf,'whatsappId':_0x2b1e81[_0x100530(0x19d)],'userId':_0x2b1e81['userId']}));}let _0x53a59e=_0x4a1bd0?.['id']||null;if(_0x29d450){const _0x1dbc9b=await Whatsapp_1[_0x100530(0x1a1)][_0x100530(0x189)](_0x533122,{'include':['queues']});_0x1dbc9b?.['queues'][_0x100530(0x1a3)]===0x1&&(_0x53a59e=_0x1dbc9b['queues'][0x0]['id']);}return!_0x2b1e81&&(_0x2b1e81=await Ticket_1[_0x100530(0x1a1)][_0x100530(0x191)]({'contactId':_0x29d450?_0x29d450['id']:_0x30adcf['id'],'status':_0x100530(0x1af),'isGroup':!!_0x29d450,'unreadMessages':_0x30c596,'whatsappId':_0x533122,'queueId':_0x53a59e,'companyId':_0x5a4cbf}),_0x2ce69f=!![],_0x1f9d46&&console[_0x100530(0x1b3)]('[Férias\x20Coletivas]\x20Novo\x20ticket\x20#'+_0x2b1e81['id']+_0x100530(0x192)),await(0x0,FindOrCreateATicketTrakingService_1[_0x100530(0x1a1)])({'ticketId':_0x2b1e81['id'],'companyId':_0x5a4cbf,'whatsappId':_0x533122,'userId':_0x2b1e81[_0x100530(0x196)]})),_0x2b1e81=await(0x0,ShowTicketService_1[_0x100530(0x1a1)])(_0x2b1e81['id'],_0x5a4cbf),{'ticket':_0x2b1e81,'justCreated':_0x2ce69f,'inVacation':_0x1f9d46};});return _0x42026c;},FindOrCreateTicketService=async(_0x1fa584,_0x3747e3,_0x233d93,_0x576e89,_0x501e9a,_0x12d2e2,_0x460e2c)=>{const _0x16ccf7=await createTicketMutex['acquire']();try{return await internalFindOrCreateTicketService(_0x1fa584,_0x3747e3,_0x233d93,_0x576e89,_0x501e9a,_0x12d2e2,_0x460e2c);}finally{_0x16ccf7();}};exports[a666_0x2fbd6f(0x1a1)]=FindOrCreateTicketService;function a666_0x4e78(){const _0x38b3cd=['3673243MroGtx','update','collectiveVacationEnd','findByPk','search','DESC','../../models/Company','constructor','between','open','9778620WJTYBO','create','\x20criado\x20-\x20enviará\x20mensagem\x20de\x20férias','date-fns','async-mutex','__esModule','userId','../../models/Ticket','defineProperty','296GolPuh','30335129BoqaTk','autoReopenTimeout','../../helpers/CheckSettings','whatsappId','6LlHLsh','../../models/Whatsapp','24vuKUAu','default','548yGyhRH','length','findOne','subMinutes','apply','collectiveVacationMessage','61398ZJPitY','./FindOrCreateATicketTrakingService','updatedAt','5835965nvvDIh','GetCompanySetting','__importDefault','collectiveVacationStart','pending','./ShowTicketService','87277Wiivwo','(((.+)+)+)+$','log','534dStfvy','sequelize','transaction','12lLRmZQ','setHours'];a666_0x4e78=function(){return _0x38b3cd;};return a666_0x4e78();}