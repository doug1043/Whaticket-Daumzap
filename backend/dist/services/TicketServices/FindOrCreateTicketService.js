const a516_0x7e4280=a516_0x575d;(function(_0x18710b,_0xde041){const _0x3c4019=a516_0x575d,_0x512add=_0x18710b();while(!![]){try{const _0xdc9316=-parseInt(_0x3c4019(0xa2))/0x1+-parseInt(_0x3c4019(0xa9))/0x2*(-parseInt(_0x3c4019(0xb0))/0x3)+-parseInt(_0x3c4019(0x96))/0x4+parseInt(_0x3c4019(0xb2))/0x5+-parseInt(_0x3c4019(0xa0))/0x6*(parseInt(_0x3c4019(0xa5))/0x7)+parseInt(_0x3c4019(0xaf))/0x8+-parseInt(_0x3c4019(0x99))/0x9;if(_0xdc9316===_0xde041)break;else _0x512add['push'](_0x512add['shift']());}catch(_0x215ae9){_0x512add['push'](_0x512add['shift']());}}}(a516_0x382b,0xd670b));const a516_0x1da686=(function(){let _0xbea3e9=!![];return function(_0x4cda33,_0x5c46f2){const _0x47216d=_0xbea3e9?function(){const _0x3e0785=a516_0x575d;if(_0x5c46f2){const _0xffdd5a=_0x5c46f2[_0x3e0785(0xb8)](_0x4cda33,arguments);return _0x5c46f2=null,_0xffdd5a;}}:function(){};return _0xbea3e9=![],_0x47216d;};}()),a516_0x251578=a516_0x1da686(this,function(){const _0x23e418=a516_0x575d;return a516_0x251578[_0x23e418(0xb7)]()[_0x23e418(0x9f)](_0x23e418(0xb3))[_0x23e418(0xb7)]()[_0x23e418(0xb4)](a516_0x251578)[_0x23e418(0x9f)](_0x23e418(0xb3));});a516_0x251578();'use strict';var __importDefault=this&&this[a516_0x7e4280(0xb5)]||function(_0x59c06d){return _0x59c06d&&_0x59c06d['__esModule']?_0x59c06d:{'default':_0x59c06d};};Object[a516_0x7e4280(0xaa)](exports,'__esModule',{'value':!![]});function a516_0x575d(_0x4ea2f1,_0x3e8115){const _0x10edff=a516_0x382b();return a516_0x575d=function(_0x251578,_0x1da686){_0x251578=_0x251578-0x96;let _0x382bf6=_0x10edff[_0x251578];return _0x382bf6;},a516_0x575d(_0x4ea2f1,_0x3e8115);}function a516_0x382b(){const _0x5f40fd=['toString','apply','500740lgPIft','create','value','6921117QmfNbm','./FindOrCreateATicketTrakingService','open','DESC','isGroup','between','search','6kvdFIF','../../models/Ticket','1733091eEcTTn','closed','updatedAt','246771vZdHIR','findOne','userId','update','2dNSsUS','defineProperty','date-fns','status','whatsappId','./ShowTicketService','10252872zasoPI','1532805yHMKSv','pending','8741725ZQRBqz','(((.+)+)+)+$','constructor','__importDefault','default'];a516_0x382b=function(){return _0x5f40fd;};return a516_0x382b();}const date_fns_1=require(a516_0x7e4280(0xab)),sequelize_1=require('sequelize'),Ticket_1=__importDefault(require(a516_0x7e4280(0xa1))),ShowTicketService_1=__importDefault(require(a516_0x7e4280(0xae))),FindOrCreateATicketTrakingService_1=__importDefault(require(a516_0x7e4280(0x9a))),Setting_1=__importDefault(require('../../models/Setting')),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),FindOrCreateTicketService=async(_0x2c8bd4,_0x1e8b93,_0x1aba26,_0xb278db,_0x293eef,_0x317c78)=>{const _0x4a2d1d=a516_0x7e4280;let _0x3552c6=await Ticket_1[_0x4a2d1d(0xb6)][_0x4a2d1d(0xa6)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x4a2d1d(0x9b),_0x4a2d1d(0xb1),'closed']},'contactId':_0x293eef?_0x293eef['id']:_0x2c8bd4['id'],'companyId':_0xb278db,'whatsappId':_0x1e8b93},'order':[['id','DESC']]});_0x3552c6&&(_0x3552c6[_0x4a2d1d(0xac)]===_0x4a2d1d(0xa3)?await _0x3552c6[_0x4a2d1d(0xa8)]({'unreadMessages':_0x1aba26,'whatsappId':_0x1e8b93,'queueId':null,'userId':null,'status':_0x4a2d1d(0xb1),'imported':_0x317c78?new Date():null}):await _0x3552c6[_0x4a2d1d(0xa8)]({'unreadMessages':_0x1aba26,'whatsappId':_0x1e8b93,'imported':_0x317c78?new Date():null}));if(!_0x3552c6&&_0x293eef){_0x3552c6=await Ticket_1[_0x4a2d1d(0xb6)][_0x4a2d1d(0xa6)]({'where':{'contactId':_0x293eef['id'],'whatsappId':_0x1e8b93},'order':[[_0x4a2d1d(0xa4),'DESC']]});_0x3552c6&&(await _0x3552c6[_0x4a2d1d(0xa8)]({'status':_0x4a2d1d(0xb1),'imported':_0x317c78?new Date():null,'userId':null,'unreadMessages':_0x1aba26,'isGroup':_0x2c8bd4[_0x4a2d1d(0x9d)],'whatsappId':_0x1e8b93,'queueId':null,'companyId':_0xb278db}),await(0x0,FindOrCreateATicketTrakingService_1[_0x4a2d1d(0xb6)])({'ticketId':_0x3552c6['id'],'companyId':_0xb278db,'whatsappId':_0x3552c6['whatsappId'],'userId':_0x3552c6[_0x4a2d1d(0xa7)]}));const _0x2f1a7c=await Setting_1[_0x4a2d1d(0xb6)]['findOne']({'where':{'key':'timeCreateNewTicket'}}),_0x21357e=_0x2f1a7c?parseInt(_0x2f1a7c[_0x4a2d1d(0x98)],0xa):0x1c20;}!_0x3552c6&&!_0x293eef&&(_0x3552c6=await Ticket_1['default'][_0x4a2d1d(0xa6)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x4a2d1d(0x9e)]]:[+(0x0,date_fns_1['subHours'])(new Date(),0x2),+new Date()]},'contactId':_0x2c8bd4['id'],'whatsappId':_0x1e8b93},'order':[[_0x4a2d1d(0xa4),_0x4a2d1d(0x9c)]]}),_0x3552c6&&(await _0x3552c6[_0x4a2d1d(0xa8)]({'status':_0x4a2d1d(0xb1),'imported':_0x317c78?new Date():null,'userId':null,'isGroup':_0x2c8bd4[_0x4a2d1d(0x9d)],'unreadMessages':_0x1aba26,'whatsappId':_0x1e8b93,'queueId':null,'companyId':_0xb278db}),await(0x0,FindOrCreateATicketTrakingService_1[_0x4a2d1d(0xb6)])({'ticketId':_0x3552c6['id'],'companyId':_0xb278db,'whatsappId':_0x3552c6[_0x4a2d1d(0xad)],'userId':_0x3552c6[_0x4a2d1d(0xa7)]})));if(!_0x3552c6){const _0x5587fd=await Whatsapp_1[_0x4a2d1d(0xb6)][_0x4a2d1d(0xa6)]({'where':{'id':_0x1e8b93}});_0x3552c6=await Ticket_1[_0x4a2d1d(0xb6)][_0x4a2d1d(0x97)]({'imported':_0x317c78?new Date():null,'contactId':_0x293eef?_0x293eef['id']:_0x2c8bd4['id'],'status':'pending','isGroup':!!_0x293eef||_0x2c8bd4['isGroup'],'unreadMessages':_0x1aba26,'whatsappId':_0x1e8b93,'whatsapp':_0x5587fd,'companyId':_0xb278db}),await(0x0,FindOrCreateATicketTrakingService_1[_0x4a2d1d(0xb6)])({'ticketId':_0x3552c6['id'],'companyId':_0xb278db,'whatsappId':_0x1e8b93,'userId':_0x3552c6[_0x4a2d1d(0xa7)]});}return _0x3552c6=await(0x0,ShowTicketService_1[_0x4a2d1d(0xb6)])(_0x3552c6['id'],_0xb278db),_0x3552c6;};exports[a516_0x7e4280(0xb6)]=FindOrCreateTicketService;