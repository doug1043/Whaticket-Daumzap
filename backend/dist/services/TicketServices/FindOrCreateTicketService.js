const a525_0x4bb669=a525_0x4efd;(function(_0x16729d,_0x59d058){const _0x47260e=a525_0x4efd,_0x8feffc=_0x16729d();while(!![]){try{const _0x179289=parseInt(_0x47260e(0xe4))/0x1*(parseInt(_0x47260e(0xca))/0x2)+-parseInt(_0x47260e(0xe1))/0x3+parseInt(_0x47260e(0xd4))/0x4*(-parseInt(_0x47260e(0xed))/0x5)+parseInt(_0x47260e(0xe9))/0x6+parseInt(_0x47260e(0xe6))/0x7*(-parseInt(_0x47260e(0xcf))/0x8)+parseInt(_0x47260e(0xde))/0x9+parseInt(_0x47260e(0xd9))/0xa*(parseInt(_0x47260e(0xd6))/0xb);if(_0x179289===_0x59d058)break;else _0x8feffc['push'](_0x8feffc['shift']());}catch(_0x5c4761){_0x8feffc['push'](_0x8feffc['shift']());}}}(a525_0x4452,0xe1608));const a525_0x3162ec=(function(){let _0x3c2375=!![];return function(_0x54fa27,_0x597fc8){const _0x1f62d9=_0x3c2375?function(){const _0x419ff4=a525_0x4efd;if(_0x597fc8){const _0x670538=_0x597fc8[_0x419ff4(0xdc)](_0x54fa27,arguments);return _0x597fc8=null,_0x670538;}}:function(){};return _0x3c2375=![],_0x1f62d9;};}()),a525_0x146a12=a525_0x3162ec(this,function(){const _0x5e50f7=a525_0x4efd;return a525_0x146a12[_0x5e50f7(0xe2)]()[_0x5e50f7(0xe5)](_0x5e50f7(0xd0))[_0x5e50f7(0xe2)]()[_0x5e50f7(0xeb)](a525_0x146a12)[_0x5e50f7(0xe5)](_0x5e50f7(0xd0));});a525_0x146a12();'use strict';function a525_0x4452(){const _0x128a35=['3512890TpWRzy','subHours','date-fns','apply','defineProperty','15241788nzdhru','isGroup','update','941616JSirFN','toString','../../models/Setting','30683sLIdua','search','7zDpXbq','./ShowTicketService','./FindOrCreateATicketTrakingService','3069918EluhhO','../../models/Ticket','constructor','whatsappId','4270uIoYqz','DESC','__importDefault','between','10mCkxSy','findOne','timeCreateNewTicket','closed','userId','7904768jSUyiu','(((.+)+)+)+$','status','sequelize','pending','3916LlQcrB','default','22OoUNcX','../../models/Whatsapp','updatedAt'];a525_0x4452=function(){return _0x128a35;};return a525_0x4452();}var __importDefault=this&&this[a525_0x4bb669(0xef)]||function(_0x199c21){return _0x199c21&&_0x199c21['__esModule']?_0x199c21:{'default':_0x199c21};};function a525_0x4efd(_0x86b94f,_0x2dc359){const _0x3e5548=a525_0x4452();return a525_0x4efd=function(_0x146a12,_0x3162ec){_0x146a12=_0x146a12-0xca;let _0x4452e5=_0x3e5548[_0x146a12];return _0x4452e5;},a525_0x4efd(_0x86b94f,_0x2dc359);}Object[a525_0x4bb669(0xdd)](exports,'__esModule',{'value':!![]});const date_fns_1=require(a525_0x4bb669(0xdb)),sequelize_1=require(a525_0x4bb669(0xd2)),Ticket_1=__importDefault(require(a525_0x4bb669(0xea))),ShowTicketService_1=__importDefault(require(a525_0x4bb669(0xe7))),FindOrCreateATicketTrakingService_1=__importDefault(require(a525_0x4bb669(0xe8))),Setting_1=__importDefault(require(a525_0x4bb669(0xe3))),Whatsapp_1=__importDefault(require(a525_0x4bb669(0xd7))),FindOrCreateTicketService=async(_0x25e363,_0x118004,_0x46dd65,_0xbddb22,_0x20d141,_0x59bc5c)=>{const _0x3eeb59=a525_0x4bb669;let _0x161de8=await Ticket_1[_0x3eeb59(0xd5)][_0x3eeb59(0xcb)]({'where':{'status':{[sequelize_1['Op']['or']]:['open',_0x3eeb59(0xd3),_0x3eeb59(0xcd)]},'contactId':_0x20d141?_0x20d141['id']:_0x25e363['id'],'companyId':_0xbddb22,'whatsappId':_0x118004},'order':[['id',_0x3eeb59(0xee)]]});_0x161de8&&(_0x161de8[_0x3eeb59(0xd1)]==='closed'?await _0x161de8['update']({'unreadMessages':_0x46dd65,'whatsappId':_0x118004,'queueId':null,'userId':null,'status':_0x3eeb59(0xd3),'imported':_0x59bc5c?new Date():null}):await _0x161de8[_0x3eeb59(0xe0)]({'unreadMessages':_0x46dd65,'whatsappId':_0x118004,'imported':_0x59bc5c?new Date():null}));if(!_0x161de8&&_0x20d141){_0x161de8=await Ticket_1[_0x3eeb59(0xd5)][_0x3eeb59(0xcb)]({'where':{'contactId':_0x20d141['id'],'whatsappId':_0x118004},'order':[[_0x3eeb59(0xd8),_0x3eeb59(0xee)]]});_0x161de8&&(await _0x161de8[_0x3eeb59(0xe0)]({'status':_0x3eeb59(0xd3),'imported':_0x59bc5c?new Date():null,'userId':null,'unreadMessages':_0x46dd65,'isGroup':_0x25e363['isGroup'],'whatsappId':_0x118004,'queueId':null,'companyId':_0xbddb22}),await(0x0,FindOrCreateATicketTrakingService_1[_0x3eeb59(0xd5)])({'ticketId':_0x161de8['id'],'companyId':_0xbddb22,'whatsappId':_0x161de8[_0x3eeb59(0xec)],'userId':_0x161de8['userId']}));const _0x18d120=await Setting_1[_0x3eeb59(0xd5)][_0x3eeb59(0xcb)]({'where':{'key':_0x3eeb59(0xcc)}}),_0x5d7aed=_0x18d120?parseInt(_0x18d120['value'],0xa):0x1c20;}!_0x161de8&&!_0x20d141&&(_0x161de8=await Ticket_1[_0x3eeb59(0xd5)][_0x3eeb59(0xcb)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x3eeb59(0xf0)]]:[+(0x0,date_fns_1[_0x3eeb59(0xda)])(new Date(),0x2),+new Date()]},'contactId':_0x25e363['id'],'whatsappId':_0x118004},'order':[[_0x3eeb59(0xd8),_0x3eeb59(0xee)]]}),_0x161de8&&(await _0x161de8[_0x3eeb59(0xe0)]({'status':_0x3eeb59(0xd3),'imported':_0x59bc5c?new Date():null,'userId':null,'isGroup':_0x25e363['isGroup'],'unreadMessages':_0x46dd65,'whatsappId':_0x118004,'queueId':null,'companyId':_0xbddb22}),await(0x0,FindOrCreateATicketTrakingService_1[_0x3eeb59(0xd5)])({'ticketId':_0x161de8['id'],'companyId':_0xbddb22,'whatsappId':_0x161de8[_0x3eeb59(0xec)],'userId':_0x161de8[_0x3eeb59(0xce)]})));if(!_0x161de8){const _0x37e718=await Whatsapp_1[_0x3eeb59(0xd5)][_0x3eeb59(0xcb)]({'where':{'id':_0x118004}});_0x161de8=await Ticket_1['default']['create']({'imported':_0x59bc5c?new Date():null,'contactId':_0x20d141?_0x20d141['id']:_0x25e363['id'],'status':'pending','isGroup':!!_0x20d141||_0x25e363[_0x3eeb59(0xdf)],'unreadMessages':_0x46dd65,'whatsappId':_0x118004,'whatsapp':_0x37e718,'companyId':_0xbddb22}),await(0x0,FindOrCreateATicketTrakingService_1[_0x3eeb59(0xd5)])({'ticketId':_0x161de8['id'],'companyId':_0xbddb22,'whatsappId':_0x118004,'userId':_0x161de8[_0x3eeb59(0xce)]});}return _0x161de8=await(0x0,ShowTicketService_1['default'])(_0x161de8['id'],_0xbddb22),_0x161de8;};exports[a525_0x4bb669(0xd5)]=FindOrCreateTicketService;