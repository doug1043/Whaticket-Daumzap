const a523_0xc00490=a523_0x2816;(function(_0x287943,_0x747d3f){const _0xe2bebf=a523_0x2816,_0xb70486=_0x287943();while(!![]){try{const _0x53b15c=-parseInt(_0xe2bebf(0x183))/0x1*(parseInt(_0xe2bebf(0x176))/0x2)+parseInt(_0xe2bebf(0x186))/0x3+-parseInt(_0xe2bebf(0x18c))/0x4*(parseInt(_0xe2bebf(0x181))/0x5)+-parseInt(_0xe2bebf(0x18d))/0x6+-parseInt(_0xe2bebf(0x187))/0x7+parseInt(_0xe2bebf(0x180))/0x8+parseInt(_0xe2bebf(0x188))/0x9;if(_0x53b15c===_0x747d3f)break;else _0xb70486['push'](_0xb70486['shift']());}catch(_0x29fb9b){_0xb70486['push'](_0xb70486['shift']());}}}(a523_0x2a90,0x7d68d));const a523_0x48ecc6=(function(){let _0x5dfd74=!![];return function(_0x268b7a,_0x30ea66){const _0x2efe19=_0x5dfd74?function(){if(_0x30ea66){const _0x35a87a=_0x30ea66['apply'](_0x268b7a,arguments);return _0x30ea66=null,_0x35a87a;}}:function(){};return _0x5dfd74=![],_0x2efe19;};}()),a523_0x5ceaa2=a523_0x48ecc6(this,function(){const _0x12bcdc=a523_0x2816;return a523_0x5ceaa2[_0x12bcdc(0x179)]()[_0x12bcdc(0x171)](_0x12bcdc(0x18f))[_0x12bcdc(0x179)]()['constructor'](a523_0x5ceaa2)[_0x12bcdc(0x171)](_0x12bcdc(0x18f));});function a523_0x2816(_0x36e8d9,_0x2edb63){const _0x25fe35=a523_0x2a90();return a523_0x2816=function(_0x5ceaa2,_0x48ecc6){_0x5ceaa2=_0x5ceaa2-0x171;let _0x2a9002=_0x25fe35[_0x5ceaa2];return _0x2a9002;},a523_0x2816(_0x36e8d9,_0x2edb63);}a523_0x5ceaa2();'use strict';var __importDefault=this&&this[a523_0xc00490(0x185)]||function(_0x18e211){const _0x42164e=a523_0xc00490;return _0x18e211&&_0x18e211[_0x42164e(0x17d)]?_0x18e211:{'default':_0x18e211};};function a523_0x2a90(){const _0x4716af=['5109688hcAEfE','1905Hachvl','status','23cQkYxm','userId','__importDefault','2973135QKOVSL','3929828WtQVxj','11089359QGddIa','pending','./FindOrCreateATicketTrakingService','../../models/Ticket','156bYfbBx','4622316jiSwaa','isGroup','(((.+)+)+)+$','search','between','updatedAt','defineProperty','DESC','87094SHYhIQ','findOne','create','toString','update','./ShowTicketService','default','__esModule','timeCreateNewTicket','whatsappId'];a523_0x2a90=function(){return _0x4716af;};return a523_0x2a90();}Object[a523_0xc00490(0x174)](exports,a523_0xc00490(0x17d),{'value':!![]});const date_fns_1=require('date-fns'),sequelize_1=require('sequelize'),Ticket_1=__importDefault(require(a523_0xc00490(0x18b))),ShowTicketService_1=__importDefault(require(a523_0xc00490(0x17b))),FindOrCreateATicketTrakingService_1=__importDefault(require(a523_0xc00490(0x18a))),Setting_1=__importDefault(require('../../models/Setting')),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),FindOrCreateTicketService=async(_0x1b61fa,_0x2836e7,_0x4cd96d,_0x3aaa7d,_0x1d9b48,_0x9bb432)=>{const _0x2f6e54=a523_0xc00490;let _0xe1de86=await Ticket_1['default'][_0x2f6e54(0x177)]({'where':{'status':{[sequelize_1['Op']['or']]:['open',_0x2f6e54(0x189),'closed']},'contactId':_0x1d9b48?_0x1d9b48['id']:_0x1b61fa['id'],'companyId':_0x3aaa7d,'whatsappId':_0x2836e7},'order':[['id',_0x2f6e54(0x175)]]});_0xe1de86&&(_0xe1de86[_0x2f6e54(0x182)]==='closed'?await _0xe1de86[_0x2f6e54(0x17a)]({'unreadMessages':_0x4cd96d,'whatsappId':_0x2836e7,'queueId':null,'userId':null,'status':_0x2f6e54(0x189),'imported':_0x9bb432?new Date():null}):await _0xe1de86[_0x2f6e54(0x17a)]({'unreadMessages':_0x4cd96d,'whatsappId':_0x2836e7,'imported':_0x9bb432?new Date():null}));if(!_0xe1de86&&_0x1d9b48){_0xe1de86=await Ticket_1['default']['findOne']({'where':{'contactId':_0x1d9b48['id'],'whatsappId':_0x2836e7},'order':[[_0x2f6e54(0x173),'DESC']]});_0xe1de86&&(await _0xe1de86[_0x2f6e54(0x17a)]({'status':_0x2f6e54(0x189),'imported':_0x9bb432?new Date():null,'userId':null,'unreadMessages':_0x4cd96d,'isGroup':_0x1b61fa[_0x2f6e54(0x18e)],'whatsappId':_0x2836e7,'queueId':null,'companyId':_0x3aaa7d}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0xe1de86['id'],'companyId':_0x3aaa7d,'whatsappId':_0xe1de86['whatsappId'],'userId':_0xe1de86[_0x2f6e54(0x184)]}));const _0x16b83c=await Setting_1['default']['findOne']({'where':{'key':_0x2f6e54(0x17e)}}),_0x373712=_0x16b83c?parseInt(_0x16b83c['value'],0xa):0x1c20;}!_0xe1de86&&!_0x1d9b48&&(_0xe1de86=await Ticket_1[_0x2f6e54(0x17c)][_0x2f6e54(0x177)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x2f6e54(0x172)]]:[+(0x0,date_fns_1['subHours'])(new Date(),0x2),+new Date()]},'contactId':_0x1b61fa['id'],'whatsappId':_0x2836e7},'order':[[_0x2f6e54(0x173),_0x2f6e54(0x175)]]}),_0xe1de86&&(await _0xe1de86[_0x2f6e54(0x17a)]({'status':_0x2f6e54(0x189),'imported':_0x9bb432?new Date():null,'userId':null,'isGroup':_0x1b61fa[_0x2f6e54(0x18e)],'unreadMessages':_0x4cd96d,'whatsappId':_0x2836e7,'queueId':null,'companyId':_0x3aaa7d}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0xe1de86['id'],'companyId':_0x3aaa7d,'whatsappId':_0xe1de86[_0x2f6e54(0x17f)],'userId':_0xe1de86['userId']})));if(!_0xe1de86){const _0x476390=await Whatsapp_1['default'][_0x2f6e54(0x177)]({'where':{'id':_0x2836e7}});_0xe1de86=await Ticket_1['default'][_0x2f6e54(0x178)]({'imported':_0x9bb432?new Date():null,'contactId':_0x1d9b48?_0x1d9b48['id']:_0x1b61fa['id'],'status':_0x2f6e54(0x189),'isGroup':!!_0x1d9b48||_0x1b61fa[_0x2f6e54(0x18e)],'unreadMessages':_0x4cd96d,'whatsappId':_0x2836e7,'whatsapp':_0x476390,'companyId':_0x3aaa7d}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0xe1de86['id'],'companyId':_0x3aaa7d,'whatsappId':_0x2836e7,'userId':_0xe1de86['userId']});}return _0xe1de86=await(0x0,ShowTicketService_1[_0x2f6e54(0x17c)])(_0xe1de86['id'],_0x3aaa7d),_0xe1de86;};exports['default']=FindOrCreateTicketService;