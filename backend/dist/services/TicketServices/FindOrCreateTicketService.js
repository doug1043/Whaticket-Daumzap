function a525_0x36e0(){const _0x1d6d80=['subHours','apply','__importDefault','DESC','create','whatsappId','defineProperty','./ShowTicketService','toString','default','isGroup','update','12201iWrLqh','status','search','4278325OlfxKo','4601565hTIGYS','./FindOrCreateATicketTrakingService','10faVqgo','open','8toGWpA','2317404wsGhDf','../../models/Whatsapp','2943066jjqPuH','findOne','sequelize','constructor','(((.+)+)+)+$','userId','4408481RnznME','updatedAt','__esModule','date-fns','closed','../../models/Ticket','417098NpOJmg','pending','../../models/Setting'];a525_0x36e0=function(){return _0x1d6d80;};return a525_0x36e0();}const a525_0x5ac843=a525_0xe8e4;(function(_0x4f088a,_0x2e8051){const _0x4cd815=a525_0xe8e4,_0x422c26=_0x4f088a();while(!![]){try{const _0x271f57=-parseInt(_0x4cd815(0x1bd))/0x1+-parseInt(_0x4cd815(0x1ac))/0x2*(-parseInt(_0x4cd815(0x1a6))/0x3)+parseInt(_0x4cd815(0x1af))/0x4+parseInt(_0x4cd815(0x1a9))/0x5+-parseInt(_0x4cd815(0x1b1))/0x6+parseInt(_0x4cd815(0x1b7))/0x7*(-parseInt(_0x4cd815(0x1ae))/0x8)+parseInt(_0x4cd815(0x1aa))/0x9;if(_0x271f57===_0x2e8051)break;else _0x422c26['push'](_0x422c26['shift']());}catch(_0x259474){_0x422c26['push'](_0x422c26['shift']());}}}(a525_0x36e0,0x68cbc));function a525_0xe8e4(_0x47656e,_0x50353c){const _0x7446fb=a525_0x36e0();return a525_0xe8e4=function(_0x47020c,_0x465ada){_0x47020c=_0x47020c-0x19b;let _0x36e073=_0x7446fb[_0x47020c];return _0x36e073;},a525_0xe8e4(_0x47656e,_0x50353c);}const a525_0x465ada=(function(){let _0x3a0d8b=!![];return function(_0x4e49a6,_0x26f222){const _0x5b31df=_0x3a0d8b?function(){const _0x5d405a=a525_0xe8e4;if(_0x26f222){const _0x2ef5a3=_0x26f222[_0x5d405a(0x19b)](_0x4e49a6,arguments);return _0x26f222=null,_0x2ef5a3;}}:function(){};return _0x3a0d8b=![],_0x5b31df;};}()),a525_0x47020c=a525_0x465ada(this,function(){const _0x3709e1=a525_0xe8e4;return a525_0x47020c[_0x3709e1(0x1a2)]()[_0x3709e1(0x1a8)](_0x3709e1(0x1b5))[_0x3709e1(0x1a2)]()[_0x3709e1(0x1b4)](a525_0x47020c)['search'](_0x3709e1(0x1b5));});a525_0x47020c();'use strict';var __importDefault=this&&this[a525_0x5ac843(0x19c)]||function(_0x399ba5){return _0x399ba5&&_0x399ba5['__esModule']?_0x399ba5:{'default':_0x399ba5};};Object[a525_0x5ac843(0x1a0)](exports,a525_0x5ac843(0x1b9),{'value':!![]});const date_fns_1=require(a525_0x5ac843(0x1ba)),sequelize_1=require(a525_0x5ac843(0x1b3)),Ticket_1=__importDefault(require(a525_0x5ac843(0x1bc))),ShowTicketService_1=__importDefault(require(a525_0x5ac843(0x1a1))),FindOrCreateATicketTrakingService_1=__importDefault(require(a525_0x5ac843(0x1ab))),Setting_1=__importDefault(require(a525_0x5ac843(0x1bf))),Whatsapp_1=__importDefault(require(a525_0x5ac843(0x1b0))),FindOrCreateTicketService=async(_0x2808fa,_0x801887,_0x5b9f53,_0x29910d,_0x365427,_0x31c85d)=>{const _0x9f825b=a525_0x5ac843;let _0x2ab112=await Ticket_1[_0x9f825b(0x1a3)][_0x9f825b(0x1b2)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x9f825b(0x1ad),_0x9f825b(0x1be),_0x9f825b(0x1bb)]},'contactId':_0x365427?_0x365427['id']:_0x2808fa['id'],'companyId':_0x29910d,'whatsappId':_0x801887},'order':[['id',_0x9f825b(0x19d)]]});_0x2ab112&&(_0x2ab112[_0x9f825b(0x1a7)]===_0x9f825b(0x1bb)?await _0x2ab112[_0x9f825b(0x1a5)]({'unreadMessages':_0x5b9f53,'whatsappId':_0x801887,'queueId':null,'userId':null,'status':'pending','imported':_0x31c85d?new Date():null}):await _0x2ab112[_0x9f825b(0x1a5)]({'unreadMessages':_0x5b9f53,'whatsappId':_0x801887,'imported':_0x31c85d?new Date():null}));if(!_0x2ab112&&_0x365427){_0x2ab112=await Ticket_1[_0x9f825b(0x1a3)]['findOne']({'where':{'contactId':_0x365427['id'],'whatsappId':_0x801887},'order':[[_0x9f825b(0x1b8),_0x9f825b(0x19d)]]});_0x2ab112&&(await _0x2ab112[_0x9f825b(0x1a5)]({'status':_0x9f825b(0x1be),'imported':_0x31c85d?new Date():null,'userId':null,'unreadMessages':_0x5b9f53,'isGroup':_0x2808fa[_0x9f825b(0x1a4)],'whatsappId':_0x801887,'queueId':null,'companyId':_0x29910d}),await(0x0,FindOrCreateATicketTrakingService_1[_0x9f825b(0x1a3)])({'ticketId':_0x2ab112['id'],'companyId':_0x29910d,'whatsappId':_0x2ab112[_0x9f825b(0x19f)],'userId':_0x2ab112[_0x9f825b(0x1b6)]}));const _0xd57814=await Setting_1[_0x9f825b(0x1a3)][_0x9f825b(0x1b2)]({'where':{'key':'timeCreateNewTicket'}}),_0xfbe802=_0xd57814?parseInt(_0xd57814['value'],0xa):0x1c20;}!_0x2ab112&&!_0x365427&&(_0x2ab112=await Ticket_1[_0x9f825b(0x1a3)]['findOne']({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x9f825b(0x1c0)])(new Date(),0x2),+new Date()]},'contactId':_0x2808fa['id'],'whatsappId':_0x801887},'order':[[_0x9f825b(0x1b8),'DESC']]}),_0x2ab112&&(await _0x2ab112[_0x9f825b(0x1a5)]({'status':'pending','imported':_0x31c85d?new Date():null,'userId':null,'isGroup':_0x2808fa[_0x9f825b(0x1a4)],'unreadMessages':_0x5b9f53,'whatsappId':_0x801887,'queueId':null,'companyId':_0x29910d}),await(0x0,FindOrCreateATicketTrakingService_1[_0x9f825b(0x1a3)])({'ticketId':_0x2ab112['id'],'companyId':_0x29910d,'whatsappId':_0x2ab112[_0x9f825b(0x19f)],'userId':_0x2ab112[_0x9f825b(0x1b6)]})));if(!_0x2ab112){const _0x388647=await Whatsapp_1[_0x9f825b(0x1a3)][_0x9f825b(0x1b2)]({'where':{'id':_0x801887}});_0x2ab112=await Ticket_1[_0x9f825b(0x1a3)][_0x9f825b(0x19e)]({'imported':_0x31c85d?new Date():null,'contactId':_0x365427?_0x365427['id']:_0x2808fa['id'],'status':_0x9f825b(0x1be),'isGroup':!!_0x365427||_0x2808fa[_0x9f825b(0x1a4)],'unreadMessages':_0x5b9f53,'whatsappId':_0x801887,'whatsapp':_0x388647,'companyId':_0x29910d}),await(0x0,FindOrCreateATicketTrakingService_1[_0x9f825b(0x1a3)])({'ticketId':_0x2ab112['id'],'companyId':_0x29910d,'whatsappId':_0x801887,'userId':_0x2ab112[_0x9f825b(0x1b6)]});}return _0x2ab112=await(0x0,ShowTicketService_1['default'])(_0x2ab112['id'],_0x29910d),_0x2ab112;};exports[a525_0x5ac843(0x1a3)]=FindOrCreateTicketService;