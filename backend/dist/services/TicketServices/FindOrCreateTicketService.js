const a523_0x233260=a523_0x1b15;(function(_0x10e8bd,_0x10ceda){const _0x31bd24=a523_0x1b15,_0x1c4921=_0x10e8bd();while(!![]){try{const _0x2434ec=parseInt(_0x31bd24(0xae))/0x1+-parseInt(_0x31bd24(0x9a))/0x2+-parseInt(_0x31bd24(0xa8))/0x3*(parseInt(_0x31bd24(0x9d))/0x4)+-parseInt(_0x31bd24(0x9e))/0x5+parseInt(_0x31bd24(0xa4))/0x6*(parseInt(_0x31bd24(0xaf))/0x7)+-parseInt(_0x31bd24(0x99))/0x8+parseInt(_0x31bd24(0xa5))/0x9;if(_0x2434ec===_0x10ceda)break;else _0x1c4921['push'](_0x1c4921['shift']());}catch(_0x1b398d){_0x1c4921['push'](_0x1c4921['shift']());}}}(a523_0x4fc9,0x5e0fc));const a523_0x14f362=(function(){let _0x4a8d60=!![];return function(_0x475920,_0x161b62){const _0x5057f5=_0x4a8d60?function(){if(_0x161b62){const _0x2cea0f=_0x161b62['apply'](_0x475920,arguments);return _0x161b62=null,_0x2cea0f;}}:function(){};return _0x4a8d60=![],_0x5057f5;};}()),a523_0x7136c6=a523_0x14f362(this,function(){const _0x1a4645=a523_0x1b15;return a523_0x7136c6[_0x1a4645(0xab)]()[_0x1a4645(0xb4)](_0x1a4645(0xa3))[_0x1a4645(0xab)]()['constructor'](a523_0x7136c6)[_0x1a4645(0xb4)]('(((.+)+)+)+$');});function a523_0x4fc9(){const _0x374559=['DESC','2161064Chdsaa','3135790UlGSrs','__esModule','create','default','../../models/Ticket','(((.+)+)+)+$','6tiNToA','12284244bxeGsJ','userId','subHours','3WSyaYj','isGroup','__importDefault','toString','whatsappId','updatedAt','163747aAqYkZ','3409749oCeqkL','../../models/Setting','./ShowTicketService','defineProperty','update','search','open','closed','findOne','pending','timeCreateNewTicket','123128Nfkfuq','895358qagifW','./FindOrCreateATicketTrakingService'];a523_0x4fc9=function(){return _0x374559;};return a523_0x4fc9();}a523_0x7136c6();function a523_0x1b15(_0x4d6377,_0x3e7760){const _0x229755=a523_0x4fc9();return a523_0x1b15=function(_0x7136c6,_0x14f362){_0x7136c6=_0x7136c6-0x94;let _0x4fc9c9=_0x229755[_0x7136c6];return _0x4fc9c9;},a523_0x1b15(_0x4d6377,_0x3e7760);}'use strict';var __importDefault=this&&this[a523_0x233260(0xaa)]||function(_0x35da29){const _0x356498=a523_0x233260;return _0x35da29&&_0x35da29[_0x356498(0x9f)]?_0x35da29:{'default':_0x35da29};};Object[a523_0x233260(0xb2)](exports,a523_0x233260(0x9f),{'value':!![]});const date_fns_1=require('date-fns'),sequelize_1=require('sequelize'),Ticket_1=__importDefault(require(a523_0x233260(0xa2))),ShowTicketService_1=__importDefault(require(a523_0x233260(0xb1))),FindOrCreateATicketTrakingService_1=__importDefault(require(a523_0x233260(0x9b))),Setting_1=__importDefault(require(a523_0x233260(0xb0))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),FindOrCreateTicketService=async(_0x128f01,_0x5909de,_0x3bfae1,_0x537bbe,_0x138426,_0x502e78)=>{const _0x5b356c=a523_0x233260;let _0x520d0c=await Ticket_1['default'][_0x5b356c(0x96)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x5b356c(0x94),'pending','closed']},'contactId':_0x138426?_0x138426['id']:_0x128f01['id'],'companyId':_0x537bbe,'whatsappId':_0x5909de},'order':[['id','DESC']]});_0x520d0c&&(_0x520d0c['status']===_0x5b356c(0x95)?await _0x520d0c[_0x5b356c(0xb3)]({'unreadMessages':_0x3bfae1,'whatsappId':_0x5909de,'queueId':null,'userId':null,'status':_0x5b356c(0x97),'imported':_0x502e78?new Date():null}):await _0x520d0c[_0x5b356c(0xb3)]({'unreadMessages':_0x3bfae1,'whatsappId':_0x5909de,'imported':_0x502e78?new Date():null}));if(!_0x520d0c&&_0x138426){_0x520d0c=await Ticket_1['default'][_0x5b356c(0x96)]({'where':{'contactId':_0x138426['id'],'whatsappId':_0x5909de},'order':[[_0x5b356c(0xad),_0x5b356c(0x9c)]]});_0x520d0c&&(await _0x520d0c[_0x5b356c(0xb3)]({'status':_0x5b356c(0x97),'imported':_0x502e78?new Date():null,'userId':null,'unreadMessages':_0x3bfae1,'isGroup':_0x128f01['isGroup'],'whatsappId':_0x5909de,'queueId':null,'companyId':_0x537bbe}),await(0x0,FindOrCreateATicketTrakingService_1[_0x5b356c(0xa1)])({'ticketId':_0x520d0c['id'],'companyId':_0x537bbe,'whatsappId':_0x520d0c[_0x5b356c(0xac)],'userId':_0x520d0c[_0x5b356c(0xa6)]}));const _0x3870ed=await Setting_1[_0x5b356c(0xa1)][_0x5b356c(0x96)]({'where':{'key':_0x5b356c(0x98)}}),_0x184cc2=_0x3870ed?parseInt(_0x3870ed['value'],0xa):0x1c20;}!_0x520d0c&&!_0x138426&&(_0x520d0c=await Ticket_1['default']['findOne']({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x5b356c(0xa7)])(new Date(),0x2),+new Date()]},'contactId':_0x128f01['id'],'whatsappId':_0x5909de},'order':[[_0x5b356c(0xad),'DESC']]}),_0x520d0c&&(await _0x520d0c['update']({'status':_0x5b356c(0x97),'imported':_0x502e78?new Date():null,'userId':null,'isGroup':_0x128f01[_0x5b356c(0xa9)],'unreadMessages':_0x3bfae1,'whatsappId':_0x5909de,'queueId':null,'companyId':_0x537bbe}),await(0x0,FindOrCreateATicketTrakingService_1[_0x5b356c(0xa1)])({'ticketId':_0x520d0c['id'],'companyId':_0x537bbe,'whatsappId':_0x520d0c[_0x5b356c(0xac)],'userId':_0x520d0c[_0x5b356c(0xa6)]})));if(!_0x520d0c){const _0xbcb4b1=await Whatsapp_1[_0x5b356c(0xa1)]['findOne']({'where':{'id':_0x5909de}});_0x520d0c=await Ticket_1[_0x5b356c(0xa1)][_0x5b356c(0xa0)]({'imported':_0x502e78?new Date():null,'contactId':_0x138426?_0x138426['id']:_0x128f01['id'],'status':_0x5b356c(0x97),'isGroup':!!_0x138426||_0x128f01[_0x5b356c(0xa9)],'unreadMessages':_0x3bfae1,'whatsappId':_0x5909de,'whatsapp':_0xbcb4b1,'companyId':_0x537bbe}),await(0x0,FindOrCreateATicketTrakingService_1[_0x5b356c(0xa1)])({'ticketId':_0x520d0c['id'],'companyId':_0x537bbe,'whatsappId':_0x5909de,'userId':_0x520d0c[_0x5b356c(0xa6)]});}return _0x520d0c=await(0x0,ShowTicketService_1[_0x5b356c(0xa1)])(_0x520d0c['id'],_0x537bbe),_0x520d0c;};exports[a523_0x233260(0xa1)]=FindOrCreateTicketService;