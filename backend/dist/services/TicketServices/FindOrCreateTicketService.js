function a524_0x2dab(_0x4328a5,_0x69d6fb){const _0x82af95=a524_0x5670();return a524_0x2dab=function(_0x5b0dd8,_0x432c15){_0x5b0dd8=_0x5b0dd8-0x11b;let _0x5670b5=_0x82af95[_0x5b0dd8];return _0x5670b5;},a524_0x2dab(_0x4328a5,_0x69d6fb);}const a524_0x1a7342=a524_0x2dab;(function(_0x1a333e,_0x5cd3ce){const _0x334e0b=a524_0x2dab,_0xa86a25=_0x1a333e();while(!![]){try{const _0x3f22b2=-parseInt(_0x334e0b(0x12f))/0x1+parseInt(_0x334e0b(0x135))/0x2+parseInt(_0x334e0b(0x122))/0x3*(-parseInt(_0x334e0b(0x128))/0x4)+-parseInt(_0x334e0b(0x120))/0x5+-parseInt(_0x334e0b(0x127))/0x6+parseInt(_0x334e0b(0x126))/0x7*(parseInt(_0x334e0b(0x12a))/0x8)+-parseInt(_0x334e0b(0x136))/0x9*(parseInt(_0x334e0b(0x133))/0xa);if(_0x3f22b2===_0x5cd3ce)break;else _0xa86a25['push'](_0xa86a25['shift']());}catch(_0x1f7f78){_0xa86a25['push'](_0xa86a25['shift']());}}}(a524_0x5670,0xe9827));const a524_0x432c15=(function(){let _0xd23f61=!![];return function(_0x473918,_0x4dbcde){const _0x20c736=_0xd23f61?function(){const _0x3b0dbd=a524_0x2dab;if(_0x4dbcde){const _0x42bf58=_0x4dbcde[_0x3b0dbd(0x11f)](_0x473918,arguments);return _0x4dbcde=null,_0x42bf58;}}:function(){};return _0xd23f61=![],_0x20c736;};}()),a524_0x5b0dd8=a524_0x432c15(this,function(){const _0x409861=a524_0x2dab;return a524_0x5b0dd8['toString']()[_0x409861(0x121)](_0x409861(0x13d))[_0x409861(0x11c)]()[_0x409861(0x131)](a524_0x5b0dd8)['search'](_0x409861(0x13d));});a524_0x5b0dd8();function a524_0x5670(){const _0x4fc7bc=['default','constructor','./FindOrCreateATicketTrakingService','340kMgRaf','date-fns','2762350FqMsUw','119484OkPtfb','create','pending','./ShowTicketService','value','findOne','closed','(((.+)+)+)+$','status','toString','updatedAt','../../models/Ticket','apply','1849935NkAjDR','search','129sqVkai','update','whatsappId','open','2583546cnJPcY','6710460KOMNWz','11208sdIfNj','../../models/Setting','40tDlYbG','subHours','__esModule','isGroup','DESC','209843BuZPPN'];a524_0x5670=function(){return _0x4fc7bc;};return a524_0x5670();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2cc699){const _0x589e36=a524_0x2dab;return _0x2cc699&&_0x2cc699[_0x589e36(0x12c)]?_0x2cc699:{'default':_0x2cc699};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const date_fns_1=require(a524_0x1a7342(0x134)),sequelize_1=require('sequelize'),Ticket_1=__importDefault(require(a524_0x1a7342(0x11e))),ShowTicketService_1=__importDefault(require(a524_0x1a7342(0x139))),FindOrCreateATicketTrakingService_1=__importDefault(require(a524_0x1a7342(0x132))),Setting_1=__importDefault(require(a524_0x1a7342(0x129))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),FindOrCreateTicketService=async(_0x22664b,_0x490eec,_0x253fca,_0x408c6c,_0x35a552,_0x34cd10)=>{const _0x17e886=a524_0x1a7342;let _0x562f59=await Ticket_1[_0x17e886(0x130)][_0x17e886(0x13b)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x17e886(0x125),_0x17e886(0x138),_0x17e886(0x13c)]},'contactId':_0x35a552?_0x35a552['id']:_0x22664b['id'],'companyId':_0x408c6c,'whatsappId':_0x490eec},'order':[['id',_0x17e886(0x12e)]]});_0x562f59&&(_0x562f59[_0x17e886(0x11b)]===_0x17e886(0x13c)?await _0x562f59['update']({'unreadMessages':_0x253fca,'whatsappId':_0x490eec,'queueId':null,'userId':null,'status':'pending','imported':_0x34cd10?new Date():null}):await _0x562f59[_0x17e886(0x123)]({'unreadMessages':_0x253fca,'whatsappId':_0x490eec,'imported':_0x34cd10?new Date():null}));if(!_0x562f59&&_0x35a552){_0x562f59=await Ticket_1[_0x17e886(0x130)]['findOne']({'where':{'contactId':_0x35a552['id'],'whatsappId':_0x490eec},'order':[['updatedAt',_0x17e886(0x12e)]]});_0x562f59&&(await _0x562f59[_0x17e886(0x123)]({'status':_0x17e886(0x138),'imported':_0x34cd10?new Date():null,'userId':null,'unreadMessages':_0x253fca,'isGroup':_0x22664b[_0x17e886(0x12d)],'whatsappId':_0x490eec,'queueId':null,'companyId':_0x408c6c}),await(0x0,FindOrCreateATicketTrakingService_1[_0x17e886(0x130)])({'ticketId':_0x562f59['id'],'companyId':_0x408c6c,'whatsappId':_0x562f59[_0x17e886(0x124)],'userId':_0x562f59['userId']}));const _0x501ab9=await Setting_1[_0x17e886(0x130)][_0x17e886(0x13b)]({'where':{'key':'timeCreateNewTicket'}}),_0x163333=_0x501ab9?parseInt(_0x501ab9[_0x17e886(0x13a)],0xa):0x1c20;}!_0x562f59&&!_0x35a552&&(_0x562f59=await Ticket_1['default'][_0x17e886(0x13b)]({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x17e886(0x12b)])(new Date(),0x2),+new Date()]},'contactId':_0x22664b['id'],'whatsappId':_0x490eec},'order':[[_0x17e886(0x11d),_0x17e886(0x12e)]]}),_0x562f59&&(await _0x562f59[_0x17e886(0x123)]({'status':_0x17e886(0x138),'imported':_0x34cd10?new Date():null,'userId':null,'isGroup':_0x22664b[_0x17e886(0x12d)],'unreadMessages':_0x253fca,'whatsappId':_0x490eec,'queueId':null,'companyId':_0x408c6c}),await(0x0,FindOrCreateATicketTrakingService_1[_0x17e886(0x130)])({'ticketId':_0x562f59['id'],'companyId':_0x408c6c,'whatsappId':_0x562f59[_0x17e886(0x124)],'userId':_0x562f59['userId']})));if(!_0x562f59){const _0x58289a=await Whatsapp_1['default'][_0x17e886(0x13b)]({'where':{'id':_0x490eec}});_0x562f59=await Ticket_1[_0x17e886(0x130)][_0x17e886(0x137)]({'imported':_0x34cd10?new Date():null,'contactId':_0x35a552?_0x35a552['id']:_0x22664b['id'],'status':_0x17e886(0x138),'isGroup':!!_0x35a552||_0x22664b['isGroup'],'unreadMessages':_0x253fca,'whatsappId':_0x490eec,'whatsapp':_0x58289a,'companyId':_0x408c6c}),await(0x0,FindOrCreateATicketTrakingService_1[_0x17e886(0x130)])({'ticketId':_0x562f59['id'],'companyId':_0x408c6c,'whatsappId':_0x490eec,'userId':_0x562f59['userId']});}return _0x562f59=await(0x0,ShowTicketService_1[_0x17e886(0x130)])(_0x562f59['id'],_0x408c6c),_0x562f59;};exports[a524_0x1a7342(0x130)]=FindOrCreateTicketService;