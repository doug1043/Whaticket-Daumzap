const a526_0x1aa242=a526_0x41e2;(function(_0x172643,_0x4e085e){const _0x100470=a526_0x41e2,_0x1f20ec=_0x172643();while(!![]){try{const _0xc38f6f=-parseInt(_0x100470(0xac))/0x1*(-parseInt(_0x100470(0xb0))/0x2)+parseInt(_0x100470(0xa2))/0x3*(-parseInt(_0x100470(0x9a))/0x4)+parseInt(_0x100470(0xa9))/0x5*(-parseInt(_0x100470(0xaf))/0x6)+parseInt(_0x100470(0x97))/0x7+parseInt(_0x100470(0xb2))/0x8*(parseInt(_0x100470(0x94))/0x9)+parseInt(_0x100470(0xaa))/0xa*(parseInt(_0x100470(0x9b))/0xb)+-parseInt(_0x100470(0xad))/0xc;if(_0xc38f6f===_0x4e085e)break;else _0x1f20ec['push'](_0x1f20ec['shift']());}catch(_0x44580b){_0x1f20ec['push'](_0x1f20ec['shift']());}}}(a526_0x315f,0x745ce));const a526_0x25d54b=(function(){let _0x1440e1=!![];return function(_0x3c2b25,_0xa9da8d){const _0xe16c2e=_0x1440e1?function(){const _0x219a45=a526_0x41e2;if(_0xa9da8d){const _0x5c8c1e=_0xa9da8d[_0x219a45(0x9e)](_0x3c2b25,arguments);return _0xa9da8d=null,_0x5c8c1e;}}:function(){};return _0x1440e1=![],_0xe16c2e;};}()),a526_0x15a2e2=a526_0x25d54b(this,function(){const _0x5e8a01=a526_0x41e2;return a526_0x15a2e2[_0x5e8a01(0x93)]()[_0x5e8a01(0x95)]('(((.+)+)+)+$')[_0x5e8a01(0x93)]()['constructor'](a526_0x15a2e2)[_0x5e8a01(0x95)](_0x5e8a01(0xb4));});a526_0x15a2e2();function a526_0x41e2(_0x4c325d,_0x3a93f6){const _0x1bb909=a526_0x315f();return a526_0x41e2=function(_0x15a2e2,_0x25d54b){_0x15a2e2=_0x15a2e2-0x91;let _0x315fb5=_0x1bb909[_0x15a2e2];return _0x315fb5;},a526_0x41e2(_0x4c325d,_0x3a93f6);}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1c659f){return _0x1c659f&&_0x1c659f['__esModule']?_0x1c659f:{'default':_0x1c659f};};Object[a526_0x1aa242(0xa3)](exports,'__esModule',{'value':!![]});const date_fns_1=require(a526_0x1aa242(0xa0)),sequelize_1=require(a526_0x1aa242(0xa8)),Ticket_1=__importDefault(require(a526_0x1aa242(0x91))),ShowTicketService_1=__importDefault(require(a526_0x1aa242(0x96))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),Setting_1=__importDefault(require(a526_0x1aa242(0xa4))),Whatsapp_1=__importDefault(require(a526_0x1aa242(0x9f))),FindOrCreateTicketService=async(_0x183764,_0x589131,_0x2c2f55,_0x1c5253,_0x2acca7,_0x34ce2e)=>{const _0x233b5e=a526_0x1aa242;let _0x163eaf=await Ticket_1['default'][_0x233b5e(0xab)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x233b5e(0x9d),_0x233b5e(0xa1),_0x233b5e(0xa5)]},'contactId':_0x2acca7?_0x2acca7['id']:_0x183764['id'],'companyId':_0x1c5253,'whatsappId':_0x589131},'order':[['id',_0x233b5e(0xb5)]]});_0x163eaf&&(_0x163eaf[_0x233b5e(0x99)]===_0x233b5e(0xa5)?await _0x163eaf['update']({'unreadMessages':_0x2c2f55,'whatsappId':_0x589131,'queueId':null,'userId':null,'status':_0x233b5e(0xa1),'imported':_0x34ce2e?new Date():null}):await _0x163eaf[_0x233b5e(0xa6)]({'unreadMessages':_0x2c2f55,'whatsappId':_0x589131,'imported':_0x34ce2e?new Date():null}));if(!_0x163eaf&&_0x2acca7){_0x163eaf=await Ticket_1[_0x233b5e(0x9c)][_0x233b5e(0xab)]({'where':{'contactId':_0x2acca7['id'],'whatsappId':_0x589131},'order':[['updatedAt',_0x233b5e(0xb5)]]});_0x163eaf&&(await _0x163eaf['update']({'status':'pending','imported':_0x34ce2e?new Date():null,'userId':null,'unreadMessages':_0x2c2f55,'isGroup':_0x183764[_0x233b5e(0xa7)],'whatsappId':_0x589131,'queueId':null,'companyId':_0x1c5253}),await(0x0,FindOrCreateATicketTrakingService_1[_0x233b5e(0x9c)])({'ticketId':_0x163eaf['id'],'companyId':_0x1c5253,'whatsappId':_0x163eaf['whatsappId'],'userId':_0x163eaf['userId']}));const _0x43e937=await Setting_1['default'][_0x233b5e(0xab)]({'where':{'key':_0x233b5e(0x92)}}),_0x4cd33c=_0x43e937?parseInt(_0x43e937[_0x233b5e(0xb1)],0xa):0x1c20;}!_0x163eaf&&!_0x2acca7&&(_0x163eaf=await Ticket_1['default'][_0x233b5e(0xab)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x233b5e(0x98)]]:[+(0x0,date_fns_1[_0x233b5e(0xae)])(new Date(),0x2),+new Date()]},'contactId':_0x183764['id'],'whatsappId':_0x589131},'order':[[_0x233b5e(0xb6),'DESC']]}),_0x163eaf&&(await _0x163eaf[_0x233b5e(0xa6)]({'status':'pending','imported':_0x34ce2e?new Date():null,'userId':null,'isGroup':_0x183764[_0x233b5e(0xa7)],'unreadMessages':_0x2c2f55,'whatsappId':_0x589131,'queueId':null,'companyId':_0x1c5253}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x163eaf['id'],'companyId':_0x1c5253,'whatsappId':_0x163eaf['whatsappId'],'userId':_0x163eaf[_0x233b5e(0xb3)]})));if(!_0x163eaf){const _0x4f6a90=await Whatsapp_1[_0x233b5e(0x9c)][_0x233b5e(0xab)]({'where':{'id':_0x589131}});_0x163eaf=await Ticket_1[_0x233b5e(0x9c)]['create']({'imported':_0x34ce2e?new Date():null,'contactId':_0x2acca7?_0x2acca7['id']:_0x183764['id'],'status':_0x233b5e(0xa1),'isGroup':!!_0x2acca7||_0x183764[_0x233b5e(0xa7)],'unreadMessages':_0x2c2f55,'whatsappId':_0x589131,'whatsapp':_0x4f6a90,'companyId':_0x1c5253}),await(0x0,FindOrCreateATicketTrakingService_1[_0x233b5e(0x9c)])({'ticketId':_0x163eaf['id'],'companyId':_0x1c5253,'whatsappId':_0x589131,'userId':_0x163eaf[_0x233b5e(0xb3)]});}return _0x163eaf=await(0x0,ShowTicketService_1[_0x233b5e(0x9c)])(_0x163eaf['id'],_0x1c5253),_0x163eaf;};exports[a526_0x1aa242(0x9c)]=FindOrCreateTicketService;function a526_0x315f(){const _0x2aeb56=['pending','158583soQYlc','defineProperty','../../models/Setting','closed','update','isGroup','sequelize','5UeTDBq','3627170OfpcCS','findOne','17866lgNQTW','9127596uQdqVf','subHours','90498EGBhCz','10lZJiQL','value','96872ATcYHb','userId','(((.+)+)+)+$','DESC','updatedAt','../../models/Ticket','timeCreateNewTicket','toString','117oYmWLE','search','./ShowTicketService','4921315mUKsBS','between','status','32QoQOVk','22MyYqkP','default','open','apply','../../models/Whatsapp','date-fns'];a526_0x315f=function(){return _0x2aeb56;};return a526_0x315f();}