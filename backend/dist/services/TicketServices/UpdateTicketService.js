function a529_0x2f3b(_0x514667,_0x27d0c0){const _0x4b8a06=a529_0x1fa0();return a529_0x2f3b=function(_0xb46ad4,_0x34d85f){_0xb46ad4=_0xb46ad4-0x174;let _0x1fa051=_0x4b8a06[_0xb46ad4];return _0x1fa051;},a529_0x2f3b(_0x514667,_0x27d0c0);}const a529_0x589b99=a529_0x2f3b;(function(_0x302226,_0xec4b5){const _0x356188=a529_0x2f3b,_0x126367=_0x302226();while(!![]){try{const _0xf3afff=parseInt(_0x356188(0x1c3))/0x1*(-parseInt(_0x356188(0x1aa))/0x2)+parseInt(_0x356188(0x1a3))/0x3*(-parseInt(_0x356188(0x1e3))/0x4)+-parseInt(_0x356188(0x1b4))/0x5*(-parseInt(_0x356188(0x1b9))/0x6)+-parseInt(_0x356188(0x195))/0x7*(-parseInt(_0x356188(0x1f7))/0x8)+parseInt(_0x356188(0x1a8))/0x9+-parseInt(_0x356188(0x19d))/0xa+-parseInt(_0x356188(0x1ba))/0xb;if(_0xf3afff===_0xec4b5)break;else _0x126367['push'](_0x126367['shift']());}catch(_0x19396e){_0x126367['push'](_0x126367['shift']());}}}(a529_0x1fa0,0xcc016));const a529_0x34d85f=(function(){let _0x5380d5=!![];return function(_0x41b42f,_0x8bae56){const _0x986096=_0x5380d5?function(){const _0x481987=a529_0x2f3b;if(_0x8bae56){const _0x2be7d7=_0x8bae56[_0x481987(0x1e8)](_0x41b42f,arguments);return _0x8bae56=null,_0x2be7d7;}}:function(){};return _0x5380d5=![],_0x986096;};}()),a529_0xb46ad4=a529_0x34d85f(this,function(){const _0x28bdcd=a529_0x2f3b;return a529_0xb46ad4['toString']()[_0x28bdcd(0x1e5)]('(((.+)+)+)+$')[_0x28bdcd(0x1e2)]()['constructor'](a529_0xb46ad4)[_0x28bdcd(0x1e5)](_0x28bdcd(0x1ae));});a529_0xb46ad4();'use strict';var __createBinding=this&&this[a529_0x589b99(0x1a2)]||(Object[a529_0x589b99(0x1d8)]?function(_0x28bbc4,_0x1398b4,_0x39b44e,_0x4818b3){const _0x252c93=a529_0x589b99;if(_0x4818b3===undefined)_0x4818b3=_0x39b44e;var _0xf4f142=Object[_0x252c93(0x1d9)](_0x1398b4,_0x39b44e);(!_0xf4f142||(_0x252c93(0x197)in _0xf4f142?!_0x1398b4[_0x252c93(0x1e6)]:_0xf4f142[_0x252c93(0x1dc)]||_0xf4f142[_0x252c93(0x1d1)]))&&(_0xf4f142={'enumerable':!![],'get':function(){return _0x1398b4[_0x39b44e];}}),Object['defineProperty'](_0x28bbc4,_0x4818b3,_0xf4f142);}:function(_0x4ff225,_0x13ec20,_0x2dba5f,_0x353f79){if(_0x353f79===undefined)_0x353f79=_0x2dba5f;_0x4ff225[_0x353f79]=_0x13ec20[_0x2dba5f];}),__setModuleDefault=this&&this[a529_0x589b99(0x1f8)]||(Object[a529_0x589b99(0x1d8)]?function(_0x45d0ac,_0x4c926c){const _0xda02e7=a529_0x589b99;Object[_0xda02e7(0x1ce)](_0x45d0ac,_0xda02e7(0x1cd),{'enumerable':!![],'value':_0x4c926c});}:function(_0x4ec050,_0x50ec60){const _0x390944=a529_0x589b99;_0x4ec050[_0x390944(0x1cd)]=_0x50ec60;}),__importStar=this&&this['__importStar']||function(_0x27f844){const _0x52ed37=a529_0x589b99;if(_0x27f844&&_0x27f844[_0x52ed37(0x1e6)])return _0x27f844;var _0x371224={};if(_0x27f844!=null){for(var _0x32e0be in _0x27f844)if(_0x32e0be!=='default'&&Object[_0x52ed37(0x186)][_0x52ed37(0x1df)][_0x52ed37(0x1da)](_0x27f844,_0x32e0be))__createBinding(_0x371224,_0x27f844,_0x32e0be);}return __setModuleDefault(_0x371224,_0x27f844),_0x371224;},__importDefault=this&&this[a529_0x589b99(0x17f)]||function(_0x4f2c40){const _0x404690=a529_0x589b99;return _0x4f2c40&&_0x4f2c40[_0x404690(0x1e6)]?_0x4f2c40:{'default':_0x4f2c40};};Object[a529_0x589b99(0x1ce)](exports,a529_0x589b99(0x1e6),{'value':!![]}),exports[a529_0x589b99(0x18b)]=void 0x0;const moment_1=__importDefault(require(a529_0x589b99(0x19f))),Sentry=__importStar(require(a529_0x589b99(0x18f))),CheckContactOpenTickets_1=__importDefault(require(a529_0x589b99(0x1b0))),SetTicketMessagesAsRead_1=__importDefault(require(a529_0x589b99(0x1bc))),socket_1=require(a529_0x589b99(0x177)),Ticket_1=__importDefault(require(a529_0x589b99(0x1d3))),Setting_1=__importDefault(require(a529_0x589b99(0x1d7))),Queue_1=__importDefault(require(a529_0x589b99(0x183))),ShowTicketService_1=__importDefault(require(a529_0x589b99(0x190))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),SendWhatsAppMessage_1=__importDefault(require(a529_0x589b99(0x192))),FindOrCreateATicketTrakingService_1=__importDefault(require(a529_0x589b99(0x1a5))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),wbotMessageListener_1=require(a529_0x589b99(0x185)),ListSettingsServiceOne_1=__importDefault(require(a529_0x589b99(0x181))),ShowUserService_1=__importDefault(require(a529_0x589b99(0x1e1))),lodash_1=require(a529_0x589b99(0x1eb)),AppError_1=__importDefault(require(a529_0x589b99(0x1a7))),SendPresenceStatus_1=require(a529_0x589b99(0x1c9)),wbot_1=require(a529_0x589b99(0x1db));function a529_0x1fa0(){const _0x6cd97b=['../../helpers/SendPresenceStatus','getWbot','chatbot','-notification','default','defineProperty','findByPk','enabled','configurable','contactId','../../models/Ticket','*4*\x20-\x20_Satisfeito_\x0a','ticketId','Need\x20companyId\x20or\x20tokenData','../../models/Setting','create','getOwnPropertyDescriptor','call','../../libs/wbot','writable','companyId','SendPresenceStatus','hasOwnProperty','*\x20e\x20contará\x20com\x20a\x20presença\x20de\x20*','../UserServices/ShowUserService','toString','1048BaLwVf','useIntegration','search','__esModule','*\x20por\x20','apply','findOne','*2*\x20-\x20_Insatisfeito_\x0a','lodash','*5*\x20-\x20_Muito\x20Satisfeito_\x0a','time','newTicketOnTransfer','dest','promptId','queue-','queueId','username','amountUsedBotQueues','toDate','closed','2008jgfxFF','__setModuleDefault','\x20em\x20','open','finishedAt','../../libs/socket','unreadMessages','length','updateUnread','*1*\x20-\x20_Muito\x20Insatisfeito_\x0a','removeFromList','contact','isGroup','__importDefault','filter','../SettingServices/ListSettingsServiceOne','disableBot','../../models/Queue','sendMessage','../WbotServices/wbotMessageListener','prototype','user','getTime','verifyMessage','status','notifyUpdate','g.us','profile','ratingAt','@sentry/node','./ShowTicketService','save','../WbotServices/SendWhatsAppMessage','emit','\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','45192jDtlpI','*\x20transferiu\x20o\x20ticket\x20para\x20você,\x20*','get','pending','reload','company-','getIO','admin','943370pBaDHf','-mainchannel','moment','Apenas\x20o\x20usuário\x20ativo\x20do\x20ticket\x20ou\x20o\x20Admin\x20podem\x20fazer\x20alterações\x20no\x20ticket','push','__createBinding','9453vgMVvC','captureException','./FindOrCreateATicketTrakingService','*3*\x20-\x20_Moderadamente\x20Satisfeito_\x0a','../../errors/AppError','14856264ouBxiU','*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','34aniZwt','rated','isNil','DD/MM/YYYY\x20HH:mm:ss','(((.+)+)+)+$','number','../../helpers/CheckContactOpenTickets','integrationId','-ticket','s.whatsapp.net','310wmbREN','format','value','\x0aAguarde,\x20já\x20vamos\x20te\x20atender!','delete','17466TRJJiM','16317114VrsdyP','Digite\x20de\x201\x20à\x205\x20para\x20qualificar\x20nosso\x20atendimento:\x0a','../../helpers/SetTicketMessagesAsRead','queueOptionId','update','*Mensagem\x20automática*:\x0aFoi\x20transferido\x20para\x20o\x20atendente\x20*','find','name','userId','12515mNGKUO','whatsappId','userRating','*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*','queuedAt','sendMsgTransfTicket'];a529_0x1fa0=function(){return _0x6cd97b;};return a529_0x1fa0();}let completionMessageControl=[];const UpdateTicketService=async({ticketData:_0x70c5f8,ticketId:_0x3b7f8c,tokenData:_0xa43c9b,companyId:_0x4d4929})=>{const _0x3ea365=a529_0x589b99;try{if(!_0x4d4929&&!_0xa43c9b)throw new Error(_0x3ea365(0x1d6));_0xa43c9b&&(_0x4d4929=_0xa43c9b[_0x3ea365(0x1dd)]);let {status:_0x5973c3}=_0x70c5f8,{queueId:_0x5969f7,userId:_0x4036a7,whatsappId:_0x546327,sendFarewellMessage:_0xb9f5a2}=_0x70c5f8;_0xb9f5a2==null&&(_0xb9f5a2=!![]);let _0x248752=_0x70c5f8['chatbot']||![],_0x13dcd8=_0x70c5f8[_0x3ea365(0x1bd)]||null,_0x349a8b=_0x70c5f8[_0x3ea365(0x1f0)]||null,_0x2eb760=_0x70c5f8['useIntegration']||![],_0x29692e=_0x70c5f8[_0x3ea365(0x1b1)]||null;const _0x238372=(0x0,socket_1[_0x3ea365(0x19b)])(),_0x30efa0=_0x3ea365(0x1c5),_0x5f2bde=await Setting_1[_0x3ea365(0x1cd)][_0x3ea365(0x1e9)]({'where':{'companyId':_0x4d4929,'key':_0x30efa0}});let _0x3a1cf2=await(0x0,ShowTicketService_1['default'])(_0x3b7f8c,_0x4d4929);if(_0xa43c9b&&_0x3a1cf2[_0x3ea365(0x18a)]!=='pending'){if(_0xa43c9b[_0x3ea365(0x18d)]!==_0x3ea365(0x19c)&&_0x3a1cf2[_0x3ea365(0x1c2)]!==parseInt(_0xa43c9b['id'],0xa))throw new AppError_1['default'](_0x3ea365(0x1a0));}const _0x471ca2=await(0x0,FindOrCreateATicketTrakingService_1[_0x3ea365(0x1cd)])({'ticketId':_0x3b7f8c,'companyId':_0x4d4929,'whatsappId':_0x3a1cf2['whatsappId']});(0x0,lodash_1[_0x3ea365(0x1ac)])(_0x546327)&&(_0x546327=_0x3a1cf2[_0x3ea365(0x1c4)][_0x3ea365(0x1e2)]());(_0x5973c3===_0x3ea365(0x1f6)||_0x5973c3===_0x3ea365(0x175))&&await(0x0,SetTicketMessagesAsRead_1['default'])(_0x3a1cf2);const _0x1a23d1=_0x3a1cf2[_0x3ea365(0x18a)],_0xc1a6e0=_0x3a1cf2[_0x3ea365(0x187)]?.['id'],_0x3aaeac=_0x3a1cf2[_0x3ea365(0x1f2)];(_0x1a23d1===_0x3ea365(0x1f6)||_0x546327!==undefined&&Number(_0x546327)!==_0x3a1cf2['whatsappId'])&&(await(0x0,CheckContactOpenTickets_1['default'])(_0x3a1cf2[_0x3ea365(0x17d)]['id'],_0x546327),_0x248752=null,_0x13dcd8=null);if(_0x5973c3===_0x3ea365(0x1f6)){const {complationMessage:_0x3db278,ratingMessage:_0x401c55}=await(0x0,ShowWhatsAppService_1[_0x3ea365(0x1cd)])(_0x3a1cf2[_0x3ea365(0x1c4)],_0x4d4929);if(!_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x182)]&&_0x5f2bde?.[_0x3ea365(0x1b6)]===_0x3ea365(0x1d0)&&_0xb9f5a2&&!_0x3a1cf2[_0x3ea365(0x17e)]){if(_0x471ca2['ratingAt']==null&&!_0x3a1cf2[_0x3ea365(0x17e)]){const _0x4ec964=_0x401c55||'';let _0x3e1ec5='‎'+_0x4ec964+'\x0a\x0a';return _0x3e1ec5+=_0x3ea365(0x1bb)+_0x3ea365(0x17b)+_0x3ea365(0x1ea)+_0x3ea365(0x1a6)+_0x3ea365(0x1d4)+_0x3ea365(0x1ec),await(0x0,SendPresenceStatus_1[_0x3ea365(0x1de)])((0x0,wbot_1[_0x3ea365(0x1ca)])(_0x3a1cf2[_0x3ea365(0x1c4)]),_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x1af)]+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?_0x3ea365(0x18c):_0x3ea365(0x1b3))),await(0x0,SendWhatsAppMessage_1[_0x3ea365(0x1cd)])({'body':_0x3e1ec5,'ticket':_0x3a1cf2}),await _0x471ca2['update']({'rated':![],'ratingAt':(0x0,moment_1[_0x3ea365(0x1cd)])()[_0x3ea365(0x1f5)]()}),await _0x3a1cf2[_0x3ea365(0x1be)]({'amountUsedBotQueues':_0x70c5f8[_0x3ea365(0x1f4)]||0x0,'status':_0x5973c3,'unreadMessages':_0x70c5f8[_0x3ea365(0x178)]||0x0,'queueId':_0x5969f7,'userId':_0x4036a7,'whatsappId':_0x546327,'chatbot':_0x248752,'queueOptionId':_0x13dcd8}),_0x238372['to'](_0x3ea365(0x19a)+_0x3a1cf2[_0x3ea365(0x1dd)]+'-open')['to'](_0x3b7f8c[_0x3ea365(0x1e2)]())[_0x3ea365(0x193)](_0x3ea365(0x19a)+_0x3a1cf2[_0x3ea365(0x1dd)]+'-ticket',{'action':_0x3ea365(0x1b8),'ticketId':_0x3a1cf2['id']}),{'ticket':_0x3a1cf2,'oldStatus':_0x1a23d1,'oldUserId':_0xc1a6e0};}_0x471ca2[_0x3ea365(0x18e)]=(0x0,moment_1[_0x3ea365(0x1cd)])()[_0x3ea365(0x1f5)](),_0x471ca2[_0x3ea365(0x1ab)]=![];}if(completionMessageControl[_0x3ea365(0x179)]>=0x9c4)completionMessageControl=[];if(!(0x0,lodash_1['isNil'])(_0x3db278)&&_0x3db278!==''&&_0xb9f5a2&&!_0x3a1cf2[_0x3ea365(0x17e)]){let _0x122918=completionMessageControl[_0x3ea365(0x1c0)](_0x494409=>_0x494409[_0x3ea365(0x1d5)]===_0x3a1cf2['id']||_0x494409[_0x3ea365(0x1ef)]===_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x1af)]);if(!_0x122918||_0x122918&&_0x122918[_0x3ea365(0x1ed)]+0x3e8*0x3c*0x1e<new Date()[_0x3ea365(0x188)]()){_0x122918&&(completionMessageControl=completionMessageControl[_0x3ea365(0x180)](_0x387ebf=>_0x387ebf[_0x3ea365(0x1d5)]!==_0x3a1cf2['id']),_0x122918=null);if(!_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x182)]&&!(0x0,lodash_1['isNil'])(_0x3db278)&&_0x3db278!==''){const _0x296f9a='‎'+_0x3db278;await(0x0,SendPresenceStatus_1['SendPresenceStatus'])((0x0,wbot_1[_0x3ea365(0x1ca)])(_0x3a1cf2[_0x3ea365(0x1c4)]),_0x3a1cf2[_0x3ea365(0x17d)]['number']+'@'+(_0x3a1cf2['isGroup']?_0x3ea365(0x18c):_0x3ea365(0x1b3))),await(0x0,SendWhatsAppMessage_1[_0x3ea365(0x1cd)])({'body':_0x296f9a,'ticket':_0x3a1cf2});}}!_0x122918&&completionMessageControl[_0x3ea365(0x1a1)]({'ticketId':_0x3a1cf2['id'],'dest':_0x3a1cf2['contact']['number'],'time':new Date()['getTime']()});}await _0x3a1cf2[_0x3ea365(0x1be)]({'promptId':null,'integrationId':null,'useIntegration':![],'typebotStatus':![],'typebotSessionId':null}),_0x471ca2[_0x3ea365(0x176)]=(0x0,moment_1[_0x3ea365(0x1cd)])()[_0x3ea365(0x1f5)](),_0x471ca2[_0x3ea365(0x1c4)]=_0x3a1cf2[_0x3ea365(0x1c4)],_0x471ca2[_0x3ea365(0x1c2)]=_0x3a1cf2[_0x3ea365(0x1c2)];}_0x5969f7!==undefined&&_0x5969f7!==null&&(_0x471ca2[_0x3ea365(0x1c7)]=(0x0,moment_1['default'])()['toDate']());const _0x580c57=await(0x0,ListSettingsServiceOne_1[_0x3ea365(0x1cd)])({'companyId':_0x4d4929,'key':_0x3ea365(0x1c8)}),_0x5f7ac=await Queue_1['default'][_0x3ea365(0x1cf)](_0x5969f7);if(_0x580c57?.[_0x3ea365(0x1b6)]===_0x3ea365(0x1d0)){if(_0x3aaeac!==_0x5969f7&&_0xc1a6e0===_0x4036a7&&!(0x0,lodash_1[_0x3ea365(0x1ac)])(_0x3aaeac)&&!(0x0,lodash_1[_0x3ea365(0x1ac)])(_0x5969f7)){const _0x3cbd89=await(0x0,GetTicketWbot_1[_0x3ea365(0x1cd)])(_0x3a1cf2),_0x4c2597='*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*'+_0x5f7ac?.[_0x3ea365(0x1c1)]+_0x3ea365(0x1a9);await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x3cbd89,_0x3a1cf2['contact']['number']+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?_0x3ea365(0x18c):'s.whatsapp.net'));const _0x1d89ff=await _0x3cbd89['sendMessage'](_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x1af)]+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?_0x3ea365(0x18c):_0x3ea365(0x1b3)),{'text':_0x4c2597});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x1d89ff,_0x3a1cf2,_0x3a1cf2[_0x3ea365(0x17d)]);}else{if(_0xc1a6e0!==_0x4036a7&&_0x3aaeac===_0x5969f7&&!(0x0,lodash_1['isNil'])(_0xc1a6e0)&&!(0x0,lodash_1['isNil'])(_0x4036a7)){const _0x45064d=await(0x0,GetTicketWbot_1[_0x3ea365(0x1cd)])(_0x3a1cf2),_0x1174dd=await(0x0,ShowUserService_1['default'])(_0x70c5f8['userId']),_0x4c0775=_0x3ea365(0x1bf)+_0x1174dd[_0x3ea365(0x1c1)]+_0x3ea365(0x1e7)+_0xa43c9b[_0x3ea365(0x1f3)]+_0x3ea365(0x174)+(0x0,moment_1['default'])()[_0x3ea365(0x1b5)](_0x3ea365(0x1ad))+_0x3ea365(0x1b7);await(0x0,SendPresenceStatus_1[_0x3ea365(0x1de)])(_0x45064d,_0x3a1cf2[_0x3ea365(0x17d)]['number']+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?_0x3ea365(0x18c):_0x3ea365(0x1b3)));const _0x34dc51=await _0x45064d[_0x3ea365(0x184)](_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x1af)]+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?'g.us':_0x3ea365(0x1b3)),{'text':_0x4c0775});await(0x0,wbotMessageListener_1[_0x3ea365(0x189)])(_0x34dc51,_0x3a1cf2,_0x3a1cf2[_0x3ea365(0x17d)]);}else{if(_0xc1a6e0!==_0x4036a7&&!(0x0,lodash_1['isNil'])(_0xc1a6e0)&&!(0x0,lodash_1[_0x3ea365(0x1ac)])(_0x4036a7)&&_0x3aaeac!==_0x5969f7&&!(0x0,lodash_1[_0x3ea365(0x1ac)])(_0x3aaeac)&&!(0x0,lodash_1[_0x3ea365(0x1ac)])(_0x5969f7)){const _0x21d2e1=await(0x0,GetTicketWbot_1['default'])(_0x3a1cf2),_0x4bfded=await(0x0,ShowUserService_1[_0x3ea365(0x1cd)])(_0x70c5f8[_0x3ea365(0x1c2)]),_0x73000=await(0x0,ShowUserService_1[_0x3ea365(0x1cd)])(_0xc1a6e0),_0x1b1520=_0x3ea365(0x1c6)+_0x5f7ac?.[_0x3ea365(0x1c1)]+_0x3ea365(0x1e0)+_0x4bfded[_0x3ea365(0x1c1)]+'*\x20transferido\x20por\x20'+_0xa43c9b['username']+'\x20em\x20'+(0x0,moment_1['default'])()['format'](_0x3ea365(0x1ad))+'\x0aaguarde,\x20já\x20vamos\x20te\x20atender!';await(0x0,SendPresenceStatus_1[_0x3ea365(0x1de)])(_0x21d2e1,_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x1af)]+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?_0x3ea365(0x18c):_0x3ea365(0x1b3)));const _0x169633=await _0x21d2e1[_0x3ea365(0x184)](_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x1af)]+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?_0x3ea365(0x18c):_0x3ea365(0x1b3)),{'text':_0x1b1520});await(0x0,wbotMessageListener_1[_0x3ea365(0x189)])(_0x169633,_0x3a1cf2,_0x3a1cf2[_0x3ea365(0x17d)]);const _0x54797a=await(0x0,ShowUserService_1['default'])(_0x4036a7),_0x4e449b='*Mensagem\x20automática*:\x0aO\x20atendente\x20anterior\x20*'+_0x73000[_0x3ea365(0x1c1)]+_0x3ea365(0x196)+_0x4bfded['name']+'*,\x20em\x20'+(0x0,moment_1[_0x3ea365(0x1cd)])()[_0x3ea365(0x1b5)](_0x3ea365(0x1ad))+_0x3ea365(0x194);await(0x0,SendPresenceStatus_1[_0x3ea365(0x1de)])(_0x21d2e1,_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x1af)]+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?_0x3ea365(0x18c):_0x3ea365(0x1b3)));const _0xed9317=await _0x21d2e1[_0x3ea365(0x184)](_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x1af)]+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?_0x3ea365(0x18c):_0x3ea365(0x1b3)),{'text':_0x4e449b});await(0x0,wbotMessageListener_1[_0x3ea365(0x189)])(_0xed9317,_0x3a1cf2,_0x3a1cf2[_0x3ea365(0x17d)]);}else{if(_0xc1a6e0!==undefined&&(0x0,lodash_1[_0x3ea365(0x1ac)])(_0x4036a7)&&_0x3aaeac!==_0x5969f7&&!(0x0,lodash_1[_0x3ea365(0x1ac)])(_0x5969f7)){const _0x3bc0ad=await(0x0,GetTicketWbot_1[_0x3ea365(0x1cd)])(_0x3a1cf2),_0x1115ec=_0x3ea365(0x1c6)+_0x5f7ac?.[_0x3ea365(0x1c1)]+_0x3ea365(0x1a9);await(0x0,SendPresenceStatus_1[_0x3ea365(0x1de)])(_0x3bc0ad,_0x3a1cf2[_0x3ea365(0x17d)][_0x3ea365(0x1af)]+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?_0x3ea365(0x18c):_0x3ea365(0x1b3)));const _0x50828e=await _0x3bc0ad[_0x3ea365(0x184)](_0x3a1cf2[_0x3ea365(0x17d)]['number']+'@'+(_0x3a1cf2[_0x3ea365(0x17e)]?_0x3ea365(0x18c):_0x3ea365(0x1b3)),{'text':_0x1115ec});await(0x0,wbotMessageListener_1[_0x3ea365(0x189)])(_0x50828e,_0x3a1cf2,_0x3a1cf2[_0x3ea365(0x17d)]);}}}}}var _0x40b18b=_0x3aaeac!==_0x5969f7;return _0x5f7ac&&(_0x40b18b&&_0x5f7ac[_0x3ea365(0x1ee)]&&(_0x5973c3='closed')),await _0x3a1cf2[_0x3ea365(0x1be)]({'amountUsedBotQueues':_0x70c5f8[_0x3ea365(0x1f4)]||0x0,'status':_0x5973c3,'unreadMessages':_0x70c5f8[_0x3ea365(0x178)]||0x0,'queueId':_0x5969f7,'userId':_0x4036a7,'whatsappId':_0x546327,'chatbot':_0x248752,'queueOptionId':_0x13dcd8}),await _0x3a1cf2[_0x3ea365(0x199)](),_0x5f7ac&&_0x40b18b&&_0x5f7ac[_0x3ea365(0x1ee)]&&!_0x3a1cf2[_0x3ea365(0x1cb)]&&!_0x3a1cf2[_0x3ea365(0x1e4)]&&(_0x238372['to'](_0x3ea365(0x19a)+_0x3a1cf2[_0x3ea365(0x1dd)]+'-'+_0x1a23d1)['to']('queue-'+_0x3a1cf2[_0x3ea365(0x1f2)]+'-'+_0x1a23d1)[_0x3ea365(0x193)]('company-'+_0x4d4929+_0x3ea365(0x1b2),{'action':_0x3ea365(0x1b8),'ticketId':_0x3a1cf2['id']}),_0x238372['to'](_0x3ea365(0x19a)+_0x3a1cf2[_0x3ea365(0x1dd)]+'-'+_0x3a1cf2[_0x3ea365(0x18a)])['to'](_0x3ea365(0x19a)+_0x3a1cf2[_0x3ea365(0x1dd)]+_0x3ea365(0x1cc))['to'](_0x3ea365(0x1f1)+_0x3a1cf2[_0x3ea365(0x1f2)]+_0x3ea365(0x1cc))['to']('queue-'+_0x3a1cf2[_0x3ea365(0x1f2)]+'-'+_0x3a1cf2[_0x3ea365(0x18a)])['to'](_0x3b7f8c['toString']())[_0x3ea365(0x193)](_0x3ea365(0x19a)+_0x4d4929+'-ticket',{'action':'update','ticket':_0x3a1cf2}),_0x3a1cf2=await Ticket_1['default'][_0x3ea365(0x1d8)]({'companyId':_0x4d4929,'contactId':_0x3a1cf2[_0x3ea365(0x1d2)],'userId':_0x4036a7,'queueId':_0x5969f7,'status':_0x3ea365(0x198),'whatsappId':_0x3a1cf2[_0x3ea365(0x1c4)],'chatbot':_0x248752,'queueOptionId':_0x13dcd8,'promptId':_0x349a8b,'useIntegration':_0x2eb760,'integrationId':_0x29692e,'amountUsedBotQueues':0x0,'unreadMessages':0x0})),_0x5973c3=_0x3a1cf2[_0x3ea365(0x18a)],_0x5973c3===_0x3ea365(0x198)&&(_0x471ca2[_0x3ea365(0x1be)]({'whatsappId':_0x546327,'queuedAt':(0x0,moment_1[_0x3ea365(0x1cd)])()[_0x3ea365(0x1f5)](),'startedAt':null,'userId':null}),_0x238372['to'](_0x3ea365(0x19a)+_0x4d4929+_0x3ea365(0x19e))[_0x3ea365(0x193)]('company-'+_0x4d4929+_0x3ea365(0x1b2),{'action':_0x3ea365(0x17c),'ticketId':_0x3a1cf2?.['id']})),_0x5973c3===_0x3ea365(0x175)&&(_0x471ca2[_0x3ea365(0x1be)]({'startedAt':(0x0,moment_1[_0x3ea365(0x1cd)])()['toDate'](),'ratingAt':null,'rated':![],'whatsappId':_0x546327,'userId':_0x3a1cf2['userId']}),_0x238372['to']('company-'+_0x4d4929+_0x3ea365(0x19e))[_0x3ea365(0x193)](_0x3ea365(0x19a)+_0x4d4929+_0x3ea365(0x1b2),{'action':'removeFromList','ticketId':_0x3a1cf2?.['id']}),_0x238372['to'](_0x3ea365(0x19a)+_0x4d4929+_0x3ea365(0x19e))['emit'](_0x3ea365(0x19a)+_0x4d4929+'-ticket',{'action':_0x3ea365(0x17a),'ticketId':_0x3a1cf2?.['id']})),await _0x471ca2[_0x3ea365(0x191)](),(_0x3a1cf2[_0x3ea365(0x18a)]!==_0x1a23d1||_0x3a1cf2[_0x3ea365(0x187)]?.['id']!==_0xc1a6e0||_0x40b18b)&&_0x238372['to'](_0x3ea365(0x19a)+_0x3a1cf2[_0x3ea365(0x1dd)]+'-'+_0x1a23d1)['to'](_0x3ea365(0x1f1)+_0x3a1cf2[_0x3ea365(0x1f2)]+'-'+_0x1a23d1)['to'](_0x3ea365(0x19a)+_0x3a1cf2[_0x3ea365(0x1dd)]+_0x3ea365(0x1cc))['to']('queue-'+_0x3a1cf2[_0x3ea365(0x1f2)]+_0x3ea365(0x1cc))['to'](_0x3b7f8c[_0x3ea365(0x1e2)]())['emit'](_0x3ea365(0x19a)+_0x4d4929+_0x3ea365(0x1b2),{'action':_0x3ea365(0x1b8),'ticketId':_0x3a1cf2['id']}),_0x3a1cf2['status']!=='closed'&&_0x238372['to'](_0x3ea365(0x19a)+_0x3a1cf2['companyId']+'-'+_0x3a1cf2['status'])['to'](_0x3ea365(0x19a)+_0x3a1cf2[_0x3ea365(0x1dd)]+_0x3ea365(0x1cc))['to'](_0x3ea365(0x1f1)+_0x3a1cf2[_0x3ea365(0x1f2)]+_0x3ea365(0x1cc))['to'](_0x3ea365(0x1f1)+_0x3a1cf2[_0x3ea365(0x1f2)]+'-'+_0x3a1cf2[_0x3ea365(0x18a)])['to'](_0x3b7f8c[_0x3ea365(0x1e2)]())[_0x3ea365(0x193)](_0x3ea365(0x19a)+_0x4d4929+_0x3ea365(0x1b2),{'action':'update','ticket':_0x3a1cf2}),{'ticket':_0x3a1cf2,'oldStatus':_0x1a23d1,'oldUserId':_0xc1a6e0};}catch(_0x577d08){console['trace'](_0x577d08),Sentry[_0x3ea365(0x1a4)](_0x577d08);}};exports[a529_0x589b99(0x1cd)]=UpdateTicketService;const notifyUpdate=(_0x48e516,_0x65dcf,_0x5d952e,_0x3b9db4)=>{const _0x300d0e=a529_0x589b99;_0x48e516['to'](_0x300d0e(0x19a)+_0x65dcf[_0x300d0e(0x1dd)]+'-'+_0x65dcf[_0x300d0e(0x18a)])['to']('company-'+_0x65dcf['companyId']+_0x300d0e(0x1cc))['to'](_0x5d952e[_0x300d0e(0x1e2)]())[_0x300d0e(0x193)](_0x300d0e(0x19a)+_0x3b9db4+_0x300d0e(0x1b2),{'action':_0x300d0e(0x1be),'ticket':_0x65dcf});};exports['notifyUpdate']=notifyUpdate;