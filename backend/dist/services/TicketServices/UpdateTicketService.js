const a530_0x560e56=a530_0x7a2c;(function(_0x459c3b,_0x529a06){const _0x139c02=a530_0x7a2c,_0x4d8a1d=_0x459c3b();while(!![]){try{const _0x8cc105=parseInt(_0x139c02(0x1e7))/0x1*(parseInt(_0x139c02(0x203))/0x2)+-parseInt(_0x139c02(0x200))/0x3*(-parseInt(_0x139c02(0x201))/0x4)+-parseInt(_0x139c02(0x210))/0x5*(-parseInt(_0x139c02(0x20d))/0x6)+parseInt(_0x139c02(0x24d))/0x7*(-parseInt(_0x139c02(0x23f))/0x8)+parseInt(_0x139c02(0x1df))/0x9*(-parseInt(_0x139c02(0x212))/0xa)+parseInt(_0x139c02(0x1dd))/0xb+-parseInt(_0x139c02(0x1ff))/0xc;if(_0x8cc105===_0x529a06)break;else _0x4d8a1d['push'](_0x4d8a1d['shift']());}catch(_0x226e9c){_0x4d8a1d['push'](_0x4d8a1d['shift']());}}}(a530_0x4660,0xe323b));const a530_0x41d769=(function(){let _0xb0985a=!![];return function(_0x3ecace,_0x528aec){const _0x27b4ec=_0xb0985a?function(){const _0xa79779=a530_0x7a2c;if(_0x528aec){const _0x2e8326=_0x528aec[_0xa79779(0x1ef)](_0x3ecace,arguments);return _0x528aec=null,_0x2e8326;}}:function(){};return _0xb0985a=![],_0x27b4ec;};}()),a530_0x5ab4b0=a530_0x41d769(this,function(){const _0x1fb9fc=a530_0x7a2c;return a530_0x5ab4b0['toString']()[_0x1fb9fc(0x230)](_0x1fb9fc(0x1e6))[_0x1fb9fc(0x21c)]()[_0x1fb9fc(0x243)](a530_0x5ab4b0)['search'](_0x1fb9fc(0x1e6));});a530_0x5ab4b0();'use strict';var __createBinding=this&&this[a530_0x560e56(0x209)]||(Object['create']?function(_0x1773df,_0x25ec1b,_0x20d506,_0x5b7e03){const _0xc25ab8=a530_0x560e56;if(_0x5b7e03===undefined)_0x5b7e03=_0x20d506;var _0x22df3a=Object['getOwnPropertyDescriptor'](_0x25ec1b,_0x20d506);(!_0x22df3a||(_0xc25ab8(0x229)in _0x22df3a?!_0x25ec1b[_0xc25ab8(0x225)]:_0x22df3a[_0xc25ab8(0x237)]||_0x22df3a['configurable']))&&(_0x22df3a={'enumerable':!![],'get':function(){return _0x25ec1b[_0x20d506];}}),Object['defineProperty'](_0x1773df,_0x5b7e03,_0x22df3a);}:function(_0x13dfda,_0x215935,_0x33cd19,_0x5a9b52){if(_0x5a9b52===undefined)_0x5a9b52=_0x33cd19;_0x13dfda[_0x5a9b52]=_0x215935[_0x33cd19];}),__setModuleDefault=this&&this[a530_0x560e56(0x218)]||(Object[a530_0x560e56(0x22c)]?function(_0x464e77,_0x2e393f){const _0x491d09=a530_0x560e56;Object[_0x491d09(0x1db)](_0x464e77,'default',{'enumerable':!![],'value':_0x2e393f});}:function(_0x1f51cf,_0x1bf03d){_0x1f51cf['default']=_0x1bf03d;}),__importStar=this&&this[a530_0x560e56(0x1fb)]||function(_0x818a9a){const _0xe7e1f=a530_0x560e56;if(_0x818a9a&&_0x818a9a[_0xe7e1f(0x225)])return _0x818a9a;var _0x305d08={};if(_0x818a9a!=null){for(var _0x11804b in _0x818a9a)if(_0x11804b!==_0xe7e1f(0x1e3)&&Object['prototype'][_0xe7e1f(0x1d5)][_0xe7e1f(0x20e)](_0x818a9a,_0x11804b))__createBinding(_0x305d08,_0x818a9a,_0x11804b);}return __setModuleDefault(_0x305d08,_0x818a9a),_0x305d08;},__importDefault=this&&this[a530_0x560e56(0x244)]||function(_0x2c3d8f){const _0x364f0c=a530_0x560e56;return _0x2c3d8f&&_0x2c3d8f[_0x364f0c(0x225)]?_0x2c3d8f:{'default':_0x2c3d8f};};function a530_0x4660(){const _0x15f5d8=['toString','push','*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*','../WbotServices/wbotMessageListener','status','pending','../../models/Setting','Digite\x20de\x201\x20à\x205\x20para\x20qualificar\x20nosso\x20atendimento:\x0a','../../helpers/SendPresenceStatus','__esModule','admin','dest','promptId','get','username','emit','create','*Mensagem\x20automática*:\x0aO\x20atendente\x20anterior\x20*','whatsappId','user','search','-mainchannel','unreadMessages','companyId','filter','*\x20e\x20contará\x20com\x20a\x20presença\x20de\x20*','time','writable','-notification','../../models/Ticket','length','reload','open','SendPresenceStatus','find','8fJwxYW','contactId','getWbot','queueOptionId','constructor','__importDefault','sendMessage','findByPk','../../libs/wbot','../SettingServices/ListSettingsServiceOne','*Mensagem\x20automática*:\x0aFoi\x20transferido\x20para\x20o\x20atendente\x20*','closed','../UserServices/ShowUserService','lodash','711074cJTZUO','userRating','newTicketOnTransfer','number','trace','queuedAt','hasOwnProperty','save','userId','queueId','finishedAt','notifyUpdate','defineProperty','\x0aAguarde,\x20já\x20vamos\x20te\x20atender!','15777168Acovgr','-ticket','331947AVIeWL','chatbot','DD/MM/YYYY\x20HH:mm:ss','useIntegration','default','g.us','ticketId','(((.+)+)+)+$','1PNXOkh','contact','*,\x20em\x20','isNil','findOne','verifyMessage','queue-','../../errors/AppError','apply','Apenas\x20o\x20usuário\x20ativo\x20do\x20ticket\x20ou\x20o\x20Admin\x20podem\x20fazer\x20alterações\x20no\x20ticket','getIO','../../helpers/GetTicketWbot','../WhatsappService/ShowWhatsAppService','delete','amountUsedBotQueues','-open','value','@sentry/node','name','toDate','__importStar','ratingAt','Need\x20companyId\x20or\x20tokenData','*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','30247656iTCilP','747CdzaiV','24396IRXdxO','\x20em\x20','1247110JSPGJq','profile','enabled','s.whatsapp.net','getTime','company-','__createBinding','update','*4*\x20-\x20_Satisfeito_\x0a','*\x20por\x20','414eXMKPO','call','\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','940NqGFWZ','removeFromList','10Mabdus','../../models/Queue','isGroup','sendMsgTransfTicket','../../libs/socket','*5*\x20-\x20_Muito\x20Satisfeito_\x0a','__setModuleDefault','./FindOrCreateATicketTrakingService','rated','disableBot'];a530_0x4660=function(){return _0x15f5d8;};return a530_0x4660();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a530_0x560e56(0x1da)]=void 0x0;const moment_1=__importDefault(require('moment')),Sentry=__importStar(require(a530_0x560e56(0x1f8))),CheckContactOpenTickets_1=__importDefault(require('../../helpers/CheckContactOpenTickets')),SetTicketMessagesAsRead_1=__importDefault(require('../../helpers/SetTicketMessagesAsRead')),socket_1=require(a530_0x560e56(0x216)),Ticket_1=__importDefault(require(a530_0x560e56(0x239))),Setting_1=__importDefault(require(a530_0x560e56(0x222))),Queue_1=__importDefault(require(a530_0x560e56(0x213))),ShowTicketService_1=__importDefault(require('./ShowTicketService')),ShowWhatsAppService_1=__importDefault(require(a530_0x560e56(0x1f3))),SendWhatsAppMessage_1=__importDefault(require('../WbotServices/SendWhatsAppMessage')),FindOrCreateATicketTrakingService_1=__importDefault(require(a530_0x560e56(0x219))),GetTicketWbot_1=__importDefault(require(a530_0x560e56(0x1f2))),wbotMessageListener_1=require(a530_0x560e56(0x21f)),ListSettingsServiceOne_1=__importDefault(require(a530_0x560e56(0x248))),ShowUserService_1=__importDefault(require(a530_0x560e56(0x24b))),lodash_1=require(a530_0x560e56(0x24c)),AppError_1=__importDefault(require(a530_0x560e56(0x1ee))),SendPresenceStatus_1=require(a530_0x560e56(0x224)),wbot_1=require(a530_0x560e56(0x247));let completionMessageControl=[];const UpdateTicketService=async({ticketData:_0x33d323,ticketId:_0x6cf2ec,tokenData:_0x20f595,companyId:_0x34f695})=>{const _0x490ff7=a530_0x560e56;try{if(!_0x34f695&&!_0x20f595)throw new Error(_0x490ff7(0x1fd));_0x20f595&&(_0x34f695=_0x20f595[_0x490ff7(0x233)]);let {status:_0x3eb24d}=_0x33d323,{queueId:_0x1805a8,userId:_0x3bdf92,whatsappId:_0x3db07d,sendFarewellMessage:_0x4327c7}=_0x33d323;_0x4327c7==null&&(_0x4327c7=!![]);let _0x3c2563=_0x33d323[_0x490ff7(0x1e0)]||![],_0x441987=_0x33d323[_0x490ff7(0x242)]||null,_0xde4301=_0x33d323[_0x490ff7(0x228)]||null,_0x4d6804=_0x33d323[_0x490ff7(0x1e2)]||![],_0x2f4e96=_0x33d323['integrationId']||null;const _0x45cc57=(0x0,socket_1[_0x490ff7(0x1f1)])(),_0x463e8d=_0x490ff7(0x24e),_0x3ba71b=await Setting_1[_0x490ff7(0x1e3)][_0x490ff7(0x1eb)]({'where':{'companyId':_0x34f695,'key':_0x463e8d}});let _0x24b538=await(0x0,ShowTicketService_1[_0x490ff7(0x1e3)])(_0x6cf2ec,_0x34f695);if(_0x20f595&&_0x24b538[_0x490ff7(0x220)]!==_0x490ff7(0x221)){if(_0x20f595[_0x490ff7(0x204)]!==_0x490ff7(0x226)&&_0x24b538[_0x490ff7(0x1d7)]!==parseInt(_0x20f595['id'],0xa))throw new AppError_1['default'](_0x490ff7(0x1f0));}const _0x6559b1=await(0x0,FindOrCreateATicketTrakingService_1[_0x490ff7(0x1e3)])({'ticketId':_0x6cf2ec,'companyId':_0x34f695,'whatsappId':_0x24b538['whatsappId']});(0x0,lodash_1[_0x490ff7(0x1ea)])(_0x3db07d)&&(_0x3db07d=_0x24b538['whatsappId'][_0x490ff7(0x21c)]());(_0x3eb24d===_0x490ff7(0x24a)||_0x3eb24d===_0x490ff7(0x23c))&&await(0x0,SetTicketMessagesAsRead_1[_0x490ff7(0x1e3)])(_0x24b538);const _0xf8b209=_0x24b538[_0x490ff7(0x220)],_0x584e32=_0x24b538[_0x490ff7(0x22f)]?.['id'],_0x2cf688=_0x24b538['queueId'];(_0xf8b209===_0x490ff7(0x24a)||_0x3db07d!==undefined&&Number(_0x3db07d)!==_0x24b538['whatsappId'])&&(await(0x0,CheckContactOpenTickets_1[_0x490ff7(0x1e3)])(_0x24b538['contact']['id'],_0x3db07d),_0x3c2563=null,_0x441987=null);if(_0x3eb24d===_0x490ff7(0x24a)){const {complationMessage:_0x14a13a,ratingMessage:_0x27e661}=await(0x0,ShowWhatsAppService_1[_0x490ff7(0x1e3)])(_0x24b538['whatsappId'],_0x34f695);if(!_0x24b538[_0x490ff7(0x1e8)][_0x490ff7(0x21b)]&&_0x3ba71b?.[_0x490ff7(0x1f7)]==='enabled'&&_0x4327c7&&!_0x24b538[_0x490ff7(0x214)]){if(_0x6559b1[_0x490ff7(0x1fc)]==null&&!_0x24b538['isGroup']){const _0x4f5a0c=_0x27e661||'';let _0x51dfa4='‎'+_0x4f5a0c+'\x0a\x0a';return _0x51dfa4+=_0x490ff7(0x223)+'*1*\x20-\x20_Muito\x20Insatisfeito_\x0a'+'*2*\x20-\x20_Insatisfeito_\x0a'+'*3*\x20-\x20_Moderadamente\x20Satisfeito_\x0a'+_0x490ff7(0x20b)+_0x490ff7(0x217),await(0x0,SendPresenceStatus_1[_0x490ff7(0x23d)])((0x0,wbot_1['getWbot'])(_0x24b538[_0x490ff7(0x22e)]),_0x24b538[_0x490ff7(0x1e8)][_0x490ff7(0x250)]+'@'+(_0x24b538[_0x490ff7(0x214)]?_0x490ff7(0x1e4):_0x490ff7(0x206))),await(0x0,SendWhatsAppMessage_1[_0x490ff7(0x1e3)])({'body':_0x51dfa4,'ticket':_0x24b538}),await _0x6559b1[_0x490ff7(0x20a)]({'rated':![],'ratingAt':(0x0,moment_1['default'])()[_0x490ff7(0x1fa)]()}),await _0x24b538['update']({'amountUsedBotQueues':_0x33d323['amountUsedBotQueues']||0x0,'status':_0x3eb24d,'unreadMessages':_0x33d323[_0x490ff7(0x232)]||0x0,'queueId':_0x1805a8,'userId':_0x3bdf92,'whatsappId':_0x3db07d,'chatbot':_0x3c2563,'queueOptionId':_0x441987}),_0x45cc57['to']('company-'+_0x24b538[_0x490ff7(0x233)]+_0x490ff7(0x1f6))['to'](_0x6cf2ec['toString']())[_0x490ff7(0x22b)](_0x490ff7(0x208)+_0x24b538['companyId']+'-ticket',{'action':_0x490ff7(0x1f4),'ticketId':_0x24b538['id']}),{'ticket':_0x24b538,'oldStatus':_0xf8b209,'oldUserId':_0x584e32};}_0x6559b1[_0x490ff7(0x1fc)]=(0x0,moment_1['default'])()[_0x490ff7(0x1fa)](),_0x6559b1[_0x490ff7(0x21a)]=![];}if(completionMessageControl[_0x490ff7(0x23a)]>=0x9c4)completionMessageControl=[];if(!(0x0,lodash_1['isNil'])(_0x14a13a)&&_0x14a13a!==''&&_0x4327c7&&!_0x24b538[_0x490ff7(0x214)]){let _0x2d8b66=completionMessageControl[_0x490ff7(0x23e)](_0x2f656e=>_0x2f656e['ticketId']===_0x24b538['id']||_0x2f656e[_0x490ff7(0x227)]===_0x24b538[_0x490ff7(0x1e8)][_0x490ff7(0x250)]);if(!_0x2d8b66||_0x2d8b66&&_0x2d8b66[_0x490ff7(0x236)]+0x3e8*0x3c*0x1e<new Date()[_0x490ff7(0x207)]()){_0x2d8b66&&(completionMessageControl=completionMessageControl[_0x490ff7(0x234)](_0xdde47f=>_0xdde47f[_0x490ff7(0x1e5)]!==_0x24b538['id']),_0x2d8b66=null);if(!_0x24b538[_0x490ff7(0x1e8)][_0x490ff7(0x21b)]&&!(0x0,lodash_1['isNil'])(_0x14a13a)&&_0x14a13a!==''){const _0x39aaa4='‎'+_0x14a13a;await(0x0,SendPresenceStatus_1[_0x490ff7(0x23d)])((0x0,wbot_1[_0x490ff7(0x241)])(_0x24b538[_0x490ff7(0x22e)]),_0x24b538['contact']['number']+'@'+(_0x24b538[_0x490ff7(0x214)]?_0x490ff7(0x1e4):_0x490ff7(0x206))),await(0x0,SendWhatsAppMessage_1[_0x490ff7(0x1e3)])({'body':_0x39aaa4,'ticket':_0x24b538});}}!_0x2d8b66&&completionMessageControl[_0x490ff7(0x21d)]({'ticketId':_0x24b538['id'],'dest':_0x24b538['contact'][_0x490ff7(0x250)],'time':new Date()[_0x490ff7(0x207)]()});}await _0x24b538[_0x490ff7(0x20a)]({'promptId':null,'integrationId':null,'useIntegration':![],'typebotStatus':![],'typebotSessionId':null}),_0x6559b1[_0x490ff7(0x1d9)]=(0x0,moment_1[_0x490ff7(0x1e3)])()[_0x490ff7(0x1fa)](),_0x6559b1[_0x490ff7(0x22e)]=_0x24b538[_0x490ff7(0x22e)],_0x6559b1['userId']=_0x24b538[_0x490ff7(0x1d7)];}_0x1805a8!==undefined&&_0x1805a8!==null&&(_0x6559b1[_0x490ff7(0x1d4)]=(0x0,moment_1['default'])()[_0x490ff7(0x1fa)]());const _0x5bf62b=await(0x0,ListSettingsServiceOne_1[_0x490ff7(0x1e3)])({'companyId':_0x34f695,'key':_0x490ff7(0x215)}),_0x3c3108=await Queue_1[_0x490ff7(0x1e3)][_0x490ff7(0x246)](_0x1805a8);if(_0x5bf62b?.['value']===_0x490ff7(0x205)){if(_0x2cf688!==_0x1805a8&&_0x584e32===_0x3bdf92&&!(0x0,lodash_1['isNil'])(_0x2cf688)&&!(0x0,lodash_1[_0x490ff7(0x1ea)])(_0x1805a8)){const _0x4450e5=await(0x0,GetTicketWbot_1[_0x490ff7(0x1e3)])(_0x24b538),_0x1d5ba9='*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*'+_0x3c3108?.[_0x490ff7(0x1f9)]+_0x490ff7(0x1fe);await(0x0,SendPresenceStatus_1[_0x490ff7(0x23d)])(_0x4450e5,_0x24b538[_0x490ff7(0x1e8)][_0x490ff7(0x250)]+'@'+(_0x24b538[_0x490ff7(0x214)]?_0x490ff7(0x1e4):'s.whatsapp.net'));const _0x354f1f=await _0x4450e5[_0x490ff7(0x245)](_0x24b538[_0x490ff7(0x1e8)][_0x490ff7(0x250)]+'@'+(_0x24b538[_0x490ff7(0x214)]?_0x490ff7(0x1e4):_0x490ff7(0x206)),{'text':_0x1d5ba9});await(0x0,wbotMessageListener_1[_0x490ff7(0x1ec)])(_0x354f1f,_0x24b538,_0x24b538[_0x490ff7(0x1e8)]);}else{if(_0x584e32!==_0x3bdf92&&_0x2cf688===_0x1805a8&&!(0x0,lodash_1[_0x490ff7(0x1ea)])(_0x584e32)&&!(0x0,lodash_1[_0x490ff7(0x1ea)])(_0x3bdf92)){const _0x450e40=await(0x0,GetTicketWbot_1[_0x490ff7(0x1e3)])(_0x24b538),_0x2135f5=await(0x0,ShowUserService_1[_0x490ff7(0x1e3)])(_0x33d323[_0x490ff7(0x1d7)]),_0x28d973=_0x490ff7(0x249)+_0x2135f5[_0x490ff7(0x1f9)]+_0x490ff7(0x20c)+_0x20f595[_0x490ff7(0x22a)]+_0x490ff7(0x202)+(0x0,moment_1[_0x490ff7(0x1e3)])()['format'](_0x490ff7(0x1e1))+_0x490ff7(0x1dc);await(0x0,SendPresenceStatus_1[_0x490ff7(0x23d)])(_0x450e40,_0x24b538[_0x490ff7(0x1e8)][_0x490ff7(0x250)]+'@'+(_0x24b538['isGroup']?'g.us':'s.whatsapp.net'));const _0x158308=await _0x450e40['sendMessage'](_0x24b538[_0x490ff7(0x1e8)][_0x490ff7(0x250)]+'@'+(_0x24b538['isGroup']?_0x490ff7(0x1e4):'s.whatsapp.net'),{'text':_0x28d973});await(0x0,wbotMessageListener_1[_0x490ff7(0x1ec)])(_0x158308,_0x24b538,_0x24b538[_0x490ff7(0x1e8)]);}else{if(_0x584e32!==_0x3bdf92&&!(0x0,lodash_1['isNil'])(_0x584e32)&&!(0x0,lodash_1[_0x490ff7(0x1ea)])(_0x3bdf92)&&_0x2cf688!==_0x1805a8&&!(0x0,lodash_1[_0x490ff7(0x1ea)])(_0x2cf688)&&!(0x0,lodash_1['isNil'])(_0x1805a8)){const _0x1e6408=await(0x0,GetTicketWbot_1[_0x490ff7(0x1e3)])(_0x24b538),_0x1783ab=await(0x0,ShowUserService_1['default'])(_0x33d323[_0x490ff7(0x1d7)]),_0x326d77=await(0x0,ShowUserService_1[_0x490ff7(0x1e3)])(_0x584e32),_0x298eed=_0x490ff7(0x21e)+_0x3c3108?.['name']+_0x490ff7(0x235)+_0x1783ab[_0x490ff7(0x1f9)]+'*\x20transferido\x20por\x20'+_0x20f595[_0x490ff7(0x22a)]+_0x490ff7(0x202)+(0x0,moment_1['default'])()['format'](_0x490ff7(0x1e1))+_0x490ff7(0x20f);await(0x0,SendPresenceStatus_1[_0x490ff7(0x23d)])(_0x1e6408,_0x24b538['contact'][_0x490ff7(0x250)]+'@'+(_0x24b538[_0x490ff7(0x214)]?_0x490ff7(0x1e4):'s.whatsapp.net'));const _0x48ad42=await _0x1e6408[_0x490ff7(0x245)](_0x24b538[_0x490ff7(0x1e8)]['number']+'@'+(_0x24b538['isGroup']?'g.us':_0x490ff7(0x206)),{'text':_0x298eed});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x48ad42,_0x24b538,_0x24b538[_0x490ff7(0x1e8)]);const _0x23adf5=await(0x0,ShowUserService_1[_0x490ff7(0x1e3)])(_0x3bdf92),_0x3db7d0=_0x490ff7(0x22d)+_0x326d77[_0x490ff7(0x1f9)]+'*\x20transferiu\x20o\x20ticket\x20para\x20você,\x20*'+_0x1783ab['name']+_0x490ff7(0x1e9)+(0x0,moment_1[_0x490ff7(0x1e3)])()['format']('DD/MM/YYYY\x20HH:mm:ss')+_0x490ff7(0x20f);await(0x0,SendPresenceStatus_1[_0x490ff7(0x23d)])(_0x1e6408,_0x24b538[_0x490ff7(0x1e8)]['number']+'@'+(_0x24b538[_0x490ff7(0x214)]?_0x490ff7(0x1e4):'s.whatsapp.net'));const _0x371f50=await _0x1e6408[_0x490ff7(0x245)](_0x24b538[_0x490ff7(0x1e8)][_0x490ff7(0x250)]+'@'+(_0x24b538[_0x490ff7(0x214)]?_0x490ff7(0x1e4):_0x490ff7(0x206)),{'text':_0x3db7d0});await(0x0,wbotMessageListener_1[_0x490ff7(0x1ec)])(_0x371f50,_0x24b538,_0x24b538[_0x490ff7(0x1e8)]);}else{if(_0x584e32!==undefined&&(0x0,lodash_1['isNil'])(_0x3bdf92)&&_0x2cf688!==_0x1805a8&&!(0x0,lodash_1['isNil'])(_0x1805a8)){const _0x9b94d6=await(0x0,GetTicketWbot_1[_0x490ff7(0x1e3)])(_0x24b538),_0x56cb3a=_0x490ff7(0x21e)+_0x3c3108?.[_0x490ff7(0x1f9)]+'*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!';await(0x0,SendPresenceStatus_1[_0x490ff7(0x23d)])(_0x9b94d6,_0x24b538['contact']['number']+'@'+(_0x24b538[_0x490ff7(0x214)]?_0x490ff7(0x1e4):'s.whatsapp.net'));const _0x4e1b22=await _0x9b94d6[_0x490ff7(0x245)](_0x24b538[_0x490ff7(0x1e8)]['number']+'@'+(_0x24b538['isGroup']?_0x490ff7(0x1e4):_0x490ff7(0x206)),{'text':_0x56cb3a});await(0x0,wbotMessageListener_1[_0x490ff7(0x1ec)])(_0x4e1b22,_0x24b538,_0x24b538[_0x490ff7(0x1e8)]);}}}}}var _0x4525c7=_0x2cf688!==_0x1805a8;return _0x3c3108&&(_0x4525c7&&_0x3c3108[_0x490ff7(0x24f)]&&(_0x3eb24d=_0x490ff7(0x24a))),await _0x24b538[_0x490ff7(0x20a)]({'amountUsedBotQueues':_0x33d323[_0x490ff7(0x1f5)]||0x0,'status':_0x3eb24d,'unreadMessages':_0x33d323['unreadMessages']||0x0,'queueId':_0x1805a8,'userId':_0x3bdf92,'whatsappId':_0x3db07d,'chatbot':_0x3c2563,'queueOptionId':_0x441987}),await _0x24b538[_0x490ff7(0x23b)](),_0x3c3108&&_0x4525c7&&_0x3c3108['newTicketOnTransfer']&&!_0x24b538[_0x490ff7(0x1e0)]&&!_0x24b538[_0x490ff7(0x1e2)]&&(_0x45cc57['to']('company-'+_0x24b538['companyId']+'-'+_0xf8b209)['to']('queue-'+_0x24b538[_0x490ff7(0x1d8)]+'-'+_0xf8b209)[_0x490ff7(0x22b)](_0x490ff7(0x208)+_0x34f695+'-ticket',{'action':_0x490ff7(0x1f4),'ticketId':_0x24b538['id']}),_0x45cc57['to'](_0x490ff7(0x208)+_0x24b538['companyId']+'-'+_0x24b538[_0x490ff7(0x220)])['to'](_0x490ff7(0x208)+_0x24b538[_0x490ff7(0x233)]+_0x490ff7(0x238))['to']('queue-'+_0x24b538[_0x490ff7(0x1d8)]+'-notification')['to'](_0x490ff7(0x1ed)+_0x24b538['queueId']+'-'+_0x24b538['status'])['to'](_0x6cf2ec[_0x490ff7(0x21c)]())[_0x490ff7(0x22b)](_0x490ff7(0x208)+_0x34f695+_0x490ff7(0x1de),{'action':_0x490ff7(0x20a),'ticket':_0x24b538}),_0x24b538=await Ticket_1['default'][_0x490ff7(0x22c)]({'companyId':_0x34f695,'contactId':_0x24b538[_0x490ff7(0x240)],'userId':_0x3bdf92,'queueId':_0x1805a8,'status':_0x490ff7(0x221),'whatsappId':_0x24b538['whatsappId'],'chatbot':_0x3c2563,'queueOptionId':_0x441987,'promptId':_0xde4301,'useIntegration':_0x4d6804,'integrationId':_0x2f4e96,'amountUsedBotQueues':0x0,'unreadMessages':0x0})),_0x3eb24d=_0x24b538[_0x490ff7(0x220)],_0x3eb24d===_0x490ff7(0x221)&&(_0x6559b1[_0x490ff7(0x20a)]({'whatsappId':_0x3db07d,'queuedAt':(0x0,moment_1[_0x490ff7(0x1e3)])()['toDate'](),'startedAt':null,'userId':null}),_0x45cc57['to']('company-'+_0x34f695+_0x490ff7(0x231))[_0x490ff7(0x22b)](_0x490ff7(0x208)+_0x34f695+_0x490ff7(0x1de),{'action':_0x490ff7(0x211),'ticketId':_0x24b538?.['id']})),_0x3eb24d===_0x490ff7(0x23c)&&(_0x6559b1[_0x490ff7(0x20a)]({'startedAt':(0x0,moment_1[_0x490ff7(0x1e3)])()[_0x490ff7(0x1fa)](),'ratingAt':null,'rated':![],'whatsappId':_0x3db07d,'userId':_0x24b538['userId']}),_0x45cc57['to'](_0x490ff7(0x208)+_0x34f695+'-mainchannel')[_0x490ff7(0x22b)]('company-'+_0x34f695+'-ticket',{'action':_0x490ff7(0x211),'ticketId':_0x24b538?.['id']}),_0x45cc57['to']('company-'+_0x34f695+_0x490ff7(0x231))[_0x490ff7(0x22b)](_0x490ff7(0x208)+_0x34f695+_0x490ff7(0x1de),{'action':'updateUnread','ticketId':_0x24b538?.['id']})),await _0x6559b1[_0x490ff7(0x1d6)](),(_0x24b538[_0x490ff7(0x220)]!==_0xf8b209||_0x24b538[_0x490ff7(0x22f)]?.['id']!==_0x584e32||_0x4525c7)&&_0x45cc57['to'](_0x490ff7(0x208)+_0x24b538[_0x490ff7(0x233)]+'-'+_0xf8b209)['to'](_0x490ff7(0x1ed)+_0x24b538[_0x490ff7(0x1d8)]+'-'+_0xf8b209)['to'](_0x490ff7(0x208)+_0x24b538[_0x490ff7(0x233)]+_0x490ff7(0x238))['to'](_0x490ff7(0x1ed)+_0x24b538[_0x490ff7(0x1d8)]+_0x490ff7(0x238))['to'](_0x6cf2ec[_0x490ff7(0x21c)]())[_0x490ff7(0x22b)](_0x490ff7(0x208)+_0x34f695+'-ticket',{'action':_0x490ff7(0x1f4),'ticketId':_0x24b538['id']}),_0x24b538[_0x490ff7(0x220)]!==_0x490ff7(0x24a)&&_0x45cc57['to']('company-'+_0x24b538['companyId']+'-'+_0x24b538[_0x490ff7(0x220)])['to'](_0x490ff7(0x208)+_0x24b538[_0x490ff7(0x233)]+_0x490ff7(0x238))['to']('queue-'+_0x24b538[_0x490ff7(0x1d8)]+_0x490ff7(0x238))['to']('queue-'+_0x24b538['queueId']+'-'+_0x24b538[_0x490ff7(0x220)])['to'](_0x6cf2ec['toString']())[_0x490ff7(0x22b)]('company-'+_0x34f695+_0x490ff7(0x1de),{'action':'update','ticket':_0x24b538}),{'ticket':_0x24b538,'oldStatus':_0xf8b209,'oldUserId':_0x584e32};}catch(_0x4e8058){console[_0x490ff7(0x1d3)](_0x4e8058),Sentry['captureException'](_0x4e8058);}};exports[a530_0x560e56(0x1e3)]=UpdateTicketService;function a530_0x7a2c(_0x537071,_0x38befc){const _0x3c3780=a530_0x4660();return a530_0x7a2c=function(_0x5ab4b0,_0x41d769){_0x5ab4b0=_0x5ab4b0-0x1d3;let _0x4660ee=_0x3c3780[_0x5ab4b0];return _0x4660ee;},a530_0x7a2c(_0x537071,_0x38befc);}const notifyUpdate=(_0x42cb90,_0x28892c,_0x42a257,_0x3aee2f)=>{const _0x3b49a6=a530_0x560e56;_0x42cb90['to']('company-'+_0x28892c['companyId']+'-'+_0x28892c[_0x3b49a6(0x220)])['to']('company-'+_0x28892c[_0x3b49a6(0x233)]+_0x3b49a6(0x238))['to'](_0x42a257['toString']())['emit'](_0x3b49a6(0x208)+_0x3aee2f+_0x3b49a6(0x1de),{'action':_0x3b49a6(0x20a),'ticket':_0x28892c});};exports[a530_0x560e56(0x1da)]=notifyUpdate;