const a528_0x53e247=a528_0x3d4d;(function(_0x30f73e,_0x2627fe){const _0x1cb463=a528_0x3d4d,_0x211eb8=_0x30f73e();while(!![]){try{const _0x1168b0=parseInt(_0x1cb463(0x147))/0x1*(parseInt(_0x1cb463(0x185))/0x2)+parseInt(_0x1cb463(0x12a))/0x3*(parseInt(_0x1cb463(0x18d))/0x4)+parseInt(_0x1cb463(0x191))/0x5+-parseInt(_0x1cb463(0x15c))/0x6+parseInt(_0x1cb463(0x187))/0x7*(parseInt(_0x1cb463(0x11c))/0x8)+-parseInt(_0x1cb463(0x161))/0x9+parseInt(_0x1cb463(0x172))/0xa*(-parseInt(_0x1cb463(0x150))/0xb);if(_0x1168b0===_0x2627fe)break;else _0x211eb8['push'](_0x211eb8['shift']());}catch(_0xd72dd1){_0x211eb8['push'](_0x211eb8['shift']());}}}(a528_0x3316,0xb41b0));function a528_0x3d4d(_0x5e4972,_0x380b06){const _0x4d713b=a528_0x3316();return a528_0x3d4d=function(_0x4bd0ff,_0x5bc8f2){_0x4bd0ff=_0x4bd0ff-0x11a;let _0x3316c6=_0x4d713b[_0x4bd0ff];return _0x3316c6;},a528_0x3d4d(_0x5e4972,_0x380b06);}const a528_0x5bc8f2=(function(){let _0x51cd4e=!![];return function(_0x10185d,_0x2326c7){const _0x554058=_0x51cd4e?function(){const _0x5b3f18=a528_0x3d4d;if(_0x2326c7){const _0xc32c30=_0x2326c7[_0x5b3f18(0x167)](_0x10185d,arguments);return _0x2326c7=null,_0xc32c30;}}:function(){};return _0x51cd4e=![],_0x554058;};}()),a528_0x4bd0ff=a528_0x5bc8f2(this,function(){const _0x385fd6=a528_0x3d4d;return a528_0x4bd0ff[_0x385fd6(0x183)]()['search'](_0x385fd6(0x13e))[_0x385fd6(0x183)]()[_0x385fd6(0x170)](a528_0x4bd0ff)['search'](_0x385fd6(0x13e));});a528_0x4bd0ff();'use strict';var __createBinding=this&&this[a528_0x53e247(0x13c)]||(Object['create']?function(_0x391438,_0xe771f4,_0x32eb94,_0x245899){const _0x3971a4=a528_0x53e247;if(_0x245899===undefined)_0x245899=_0x32eb94;var _0x3a1e20=Object[_0x3971a4(0x17d)](_0xe771f4,_0x32eb94);(!_0x3a1e20||(_0x3971a4(0x15f)in _0x3a1e20?!_0xe771f4[_0x3971a4(0x18f)]:_0x3a1e20[_0x3971a4(0x154)]||_0x3a1e20[_0x3971a4(0x159)]))&&(_0x3a1e20={'enumerable':!![],'get':function(){return _0xe771f4[_0x32eb94];}}),Object['defineProperty'](_0x391438,_0x245899,_0x3a1e20);}:function(_0x2b8ff3,_0x4225d9,_0x366d9d,_0x84ad15){if(_0x84ad15===undefined)_0x84ad15=_0x366d9d;_0x2b8ff3[_0x84ad15]=_0x4225d9[_0x366d9d];}),__setModuleDefault=this&&this[a528_0x53e247(0x168)]||(Object[a528_0x53e247(0x186)]?function(_0xb3003e,_0x30970a){const _0x22d4c0=a528_0x53e247;Object[_0x22d4c0(0x14b)](_0xb3003e,_0x22d4c0(0x171),{'enumerable':!![],'value':_0x30970a});}:function(_0x553a6e,_0x57a09d){const _0x2d9fa9=a528_0x53e247;_0x553a6e[_0x2d9fa9(0x171)]=_0x57a09d;}),__importStar=this&&this[a528_0x53e247(0x155)]||function(_0x21ff4c){const _0x44c7b7=a528_0x53e247;if(_0x21ff4c&&_0x21ff4c[_0x44c7b7(0x18f)])return _0x21ff4c;var _0x5c12f2={};if(_0x21ff4c!=null){for(var _0x5ae1a3 in _0x21ff4c)if(_0x5ae1a3!==_0x44c7b7(0x171)&&Object[_0x44c7b7(0x125)][_0x44c7b7(0x16b)][_0x44c7b7(0x137)](_0x21ff4c,_0x5ae1a3))__createBinding(_0x5c12f2,_0x21ff4c,_0x5ae1a3);}return __setModuleDefault(_0x5c12f2,_0x21ff4c),_0x5c12f2;},__importDefault=this&&this['__importDefault']||function(_0x5a82ca){return _0x5a82ca&&_0x5a82ca['__esModule']?_0x5a82ca:{'default':_0x5a82ca};};Object[a528_0x53e247(0x14b)](exports,a528_0x53e247(0x18f),{'value':!![]}),exports[a528_0x53e247(0x145)]=void 0x0;const moment_1=__importDefault(require(a528_0x53e247(0x121))),Sentry=__importStar(require('@sentry/node')),CheckContactOpenTickets_1=__importDefault(require(a528_0x53e247(0x156))),SetTicketMessagesAsRead_1=__importDefault(require(a528_0x53e247(0x139))),socket_1=require(a528_0x53e247(0x15e)),Ticket_1=__importDefault(require(a528_0x53e247(0x148))),Setting_1=__importDefault(require(a528_0x53e247(0x18e))),Queue_1=__importDefault(require(a528_0x53e247(0x136))),ShowTicketService_1=__importDefault(require(a528_0x53e247(0x182))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),SendWhatsAppMessage_1=__importDefault(require(a528_0x53e247(0x164))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),GetTicketWbot_1=__importDefault(require(a528_0x53e247(0x13b))),wbotMessageListener_1=require(a528_0x53e247(0x124)),ListSettingsServiceOne_1=__importDefault(require('../SettingServices/ListSettingsServiceOne')),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),lodash_1=require('lodash'),AppError_1=__importDefault(require(a528_0x53e247(0x173))),SendPresenceStatus_1=require(a528_0x53e247(0x184)),wbot_1=require('../../libs/wbot');let completionMessageControl=[];const UpdateTicketService=async({ticketData:_0x927acf,ticketId:_0x5d0bf6,tokenData:_0x17c535,companyId:_0x36d3b8})=>{const _0x4473ea=a528_0x53e247;try{if(!_0x36d3b8&&!_0x17c535)throw new Error(_0x4473ea(0x15a));_0x17c535&&(_0x36d3b8=_0x17c535['companyId']);let {status:_0x58e588}=_0x927acf,{queueId:_0x3d0b8d,userId:_0x2f6f4f,whatsappId:_0x2d61ab,sendFarewellMessage:_0xeff64a}=_0x927acf;_0xeff64a==null&&(_0xeff64a=!![]);let _0x1fe25a=_0x927acf[_0x4473ea(0x178)]||![],_0x389e55=_0x927acf[_0x4473ea(0x13d)]||null,_0x490716=_0x927acf[_0x4473ea(0x134)]||null,_0x587955=_0x927acf[_0x4473ea(0x17f)]||![],_0x45ae32=_0x927acf[_0x4473ea(0x14f)]||null;const _0x3e4185=(0x0,socket_1[_0x4473ea(0x162)])(),_0x5b0f8e='userRating',_0x5d6e5e=await Setting_1['default'][_0x4473ea(0x14d)]({'where':{'companyId':_0x36d3b8,'key':_0x5b0f8e}});let _0x48b23f=await(0x0,ShowTicketService_1[_0x4473ea(0x171)])(_0x5d0bf6,_0x36d3b8);if(_0x17c535&&_0x48b23f[_0x4473ea(0x180)]!=='pending'){if(_0x17c535['profile']!==_0x4473ea(0x131)&&_0x48b23f[_0x4473ea(0x16d)]!==parseInt(_0x17c535['id'],0xa))throw new AppError_1[(_0x4473ea(0x171))]('Apenas\x20o\x20usuário\x20ativo\x20do\x20ticket\x20ou\x20o\x20Admin\x20podem\x20fazer\x20alterações\x20no\x20ticket');}const _0x55b1f7=await(0x0,FindOrCreateATicketTrakingService_1[_0x4473ea(0x171)])({'ticketId':_0x5d0bf6,'companyId':_0x36d3b8,'whatsappId':_0x48b23f[_0x4473ea(0x11f)]});(0x0,lodash_1[_0x4473ea(0x146)])(_0x2d61ab)&&(_0x2d61ab=_0x48b23f[_0x4473ea(0x11f)]['toString']());(_0x58e588===_0x4473ea(0x138)||_0x58e588===_0x4473ea(0x17c))&&await(0x0,SetTicketMessagesAsRead_1['default'])(_0x48b23f);const _0x4eb35d=_0x48b23f['status'],_0x54f4cf=_0x48b23f['user']?.['id'],_0x4d0e62=_0x48b23f['queueId'];(_0x4eb35d===_0x4473ea(0x138)||_0x2d61ab!==undefined&&Number(_0x2d61ab)!==_0x48b23f['whatsappId'])&&(await(0x0,CheckContactOpenTickets_1['default'])(_0x48b23f['contact']['id'],_0x2d61ab),_0x1fe25a=null,_0x389e55=null);if(_0x58e588===_0x4473ea(0x138)){const {complationMessage:_0x543276,ratingMessage:_0x33192a}=await(0x0,ShowWhatsAppService_1[_0x4473ea(0x171)])(_0x48b23f[_0x4473ea(0x11f)],_0x36d3b8);if(!_0x48b23f[_0x4473ea(0x188)][_0x4473ea(0x120)]&&_0x5d6e5e?.[_0x4473ea(0x13f)]===_0x4473ea(0x141)&&_0xeff64a&&!_0x48b23f[_0x4473ea(0x153)]){if(_0x55b1f7[_0x4473ea(0x142)]==null&&!_0x48b23f[_0x4473ea(0x153)]){const _0x2303d6=_0x33192a||'';let _0x5ec43c='‎'+_0x2303d6+'\x0a\x0a';return _0x5ec43c+='Digite\x20de\x201\x20à\x205\x20para\x20qualificar\x20nosso\x20atendimento:\x0a'+_0x4473ea(0x166)+_0x4473ea(0x15d)+'*3*\x20-\x20_Moderadamente\x20Satisfeito_\x0a'+_0x4473ea(0x181)+_0x4473ea(0x16e),await(0x0,SendPresenceStatus_1[_0x4473ea(0x126)])((0x0,wbot_1[_0x4473ea(0x12d)])(_0x48b23f[_0x4473ea(0x11f)]),_0x48b23f[_0x4473ea(0x188)]['number']+'@'+(_0x48b23f[_0x4473ea(0x153)]?_0x4473ea(0x174):_0x4473ea(0x133))),await(0x0,SendWhatsAppMessage_1[_0x4473ea(0x171)])({'body':_0x5ec43c,'ticket':_0x48b23f}),await _0x55b1f7['update']({'rated':![],'ratingAt':(0x0,moment_1[_0x4473ea(0x171)])()['toDate']()}),await _0x48b23f[_0x4473ea(0x12b)]({'amountUsedBotQueues':_0x927acf['amountUsedBotQueues']||0x0,'status':_0x58e588,'unreadMessages':_0x927acf['unreadMessages']||0x0,'queueId':_0x3d0b8d,'userId':_0x2f6f4f,'whatsappId':_0x2d61ab,'chatbot':_0x1fe25a,'queueOptionId':_0x389e55}),_0x3e4185['to'](_0x4473ea(0x129)+_0x48b23f[_0x4473ea(0x163)]+_0x4473ea(0x128))['to'](_0x5d0bf6['toString']())[_0x4473ea(0x11a)]('company-'+_0x48b23f['companyId']+_0x4473ea(0x189),{'action':_0x4473ea(0x13a),'ticketId':_0x48b23f['id']}),{'ticket':_0x48b23f,'oldStatus':_0x4eb35d,'oldUserId':_0x54f4cf};}_0x55b1f7[_0x4473ea(0x142)]=(0x0,moment_1[_0x4473ea(0x171)])()[_0x4473ea(0x17e)](),_0x55b1f7[_0x4473ea(0x12e)]=![];}if(completionMessageControl['length']>=0x9c4)completionMessageControl=[];if(!(0x0,lodash_1['isNil'])(_0x543276)&&_0x543276!==''&&_0xeff64a&&!_0x48b23f[_0x4473ea(0x153)]){let _0x18e07f=completionMessageControl[_0x4473ea(0x18a)](_0x3700d8=>_0x3700d8[_0x4473ea(0x123)]===_0x48b23f['id']||_0x3700d8[_0x4473ea(0x11b)]===_0x48b23f['contact'][_0x4473ea(0x12f)]);if(!_0x18e07f||_0x18e07f&&_0x18e07f[_0x4473ea(0x11d)]+0x3e8*0x3c*0x1e<new Date()[_0x4473ea(0x169)]()){_0x18e07f&&(completionMessageControl=completionMessageControl['filter'](_0x338580=>_0x338580[_0x4473ea(0x123)]!==_0x48b23f['id']),_0x18e07f=null);if(!_0x48b23f[_0x4473ea(0x188)][_0x4473ea(0x120)]&&!(0x0,lodash_1['isNil'])(_0x543276)&&_0x543276!==''){const _0x418a3c='‎'+_0x543276;await(0x0,SendPresenceStatus_1[_0x4473ea(0x126)])((0x0,wbot_1[_0x4473ea(0x12d)])(_0x48b23f[_0x4473ea(0x11f)]),_0x48b23f['contact']['number']+'@'+(_0x48b23f[_0x4473ea(0x153)]?_0x4473ea(0x174):_0x4473ea(0x133))),await(0x0,SendWhatsAppMessage_1[_0x4473ea(0x171)])({'body':_0x418a3c,'ticket':_0x48b23f});}}!_0x18e07f&&completionMessageControl['push']({'ticketId':_0x48b23f['id'],'dest':_0x48b23f[_0x4473ea(0x188)]['number'],'time':new Date()['getTime']()});}await _0x48b23f[_0x4473ea(0x12b)]({'promptId':null,'integrationId':null,'useIntegration':![],'typebotStatus':![],'typebotSessionId':null}),_0x55b1f7[_0x4473ea(0x192)]=(0x0,moment_1['default'])()[_0x4473ea(0x17e)](),_0x55b1f7['whatsappId']=_0x48b23f[_0x4473ea(0x11f)],_0x55b1f7['userId']=_0x48b23f[_0x4473ea(0x16d)];}_0x3d0b8d!==undefined&&_0x3d0b8d!==null&&(_0x55b1f7[_0x4473ea(0x18c)]=(0x0,moment_1['default'])()[_0x4473ea(0x17e)]());const _0x49f068=await(0x0,ListSettingsServiceOne_1['default'])({'companyId':_0x36d3b8,'key':'sendMsgTransfTicket'}),_0x27985e=await Queue_1['default'][_0x4473ea(0x158)](_0x3d0b8d);if(_0x49f068?.[_0x4473ea(0x13f)]===_0x4473ea(0x141)){if(_0x4d0e62!==_0x3d0b8d&&_0x54f4cf===_0x2f6f4f&&!(0x0,lodash_1[_0x4473ea(0x146)])(_0x4d0e62)&&!(0x0,lodash_1[_0x4473ea(0x146)])(_0x3d0b8d)){const _0x33be8d=await(0x0,GetTicketWbot_1[_0x4473ea(0x171)])(_0x48b23f),_0x1fdbb0=_0x4473ea(0x151)+_0x27985e?.['name']+_0x4473ea(0x15b);await(0x0,SendPresenceStatus_1[_0x4473ea(0x126)])(_0x33be8d,_0x48b23f[_0x4473ea(0x188)][_0x4473ea(0x12f)]+'@'+(_0x48b23f[_0x4473ea(0x153)]?_0x4473ea(0x174):_0x4473ea(0x133)));const _0x6b475c=await _0x33be8d[_0x4473ea(0x18b)](_0x48b23f[_0x4473ea(0x188)]['number']+'@'+(_0x48b23f[_0x4473ea(0x153)]?_0x4473ea(0x174):_0x4473ea(0x133)),{'text':_0x1fdbb0});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x6b475c,_0x48b23f,_0x48b23f[_0x4473ea(0x188)]);}else{if(_0x54f4cf!==_0x2f6f4f&&_0x4d0e62===_0x3d0b8d&&!(0x0,lodash_1[_0x4473ea(0x146)])(_0x54f4cf)&&!(0x0,lodash_1[_0x4473ea(0x146)])(_0x2f6f4f)){const _0x4cf5f5=await(0x0,GetTicketWbot_1[_0x4473ea(0x171)])(_0x48b23f),_0x2a843c=await(0x0,ShowUserService_1[_0x4473ea(0x171)])(_0x927acf[_0x4473ea(0x16d)]),_0x4dd02e=_0x4473ea(0x16c)+_0x2a843c[_0x4473ea(0x14c)]+_0x4473ea(0x176)+_0x17c535[_0x4473ea(0x149)]+'\x20em\x20'+(0x0,moment_1[_0x4473ea(0x171)])()[_0x4473ea(0x12c)](_0x4473ea(0x165))+_0x4473ea(0x132);await(0x0,SendPresenceStatus_1[_0x4473ea(0x126)])(_0x4cf5f5,_0x48b23f['contact'][_0x4473ea(0x12f)]+'@'+(_0x48b23f[_0x4473ea(0x153)]?_0x4473ea(0x174):_0x4473ea(0x133)));const _0x5b557e=await _0x4cf5f5[_0x4473ea(0x18b)](_0x48b23f['contact']['number']+'@'+(_0x48b23f[_0x4473ea(0x153)]?'g.us':_0x4473ea(0x133)),{'text':_0x4dd02e});await(0x0,wbotMessageListener_1[_0x4473ea(0x127)])(_0x5b557e,_0x48b23f,_0x48b23f[_0x4473ea(0x188)]);}else{if(_0x54f4cf!==_0x2f6f4f&&!(0x0,lodash_1['isNil'])(_0x54f4cf)&&!(0x0,lodash_1[_0x4473ea(0x146)])(_0x2f6f4f)&&_0x4d0e62!==_0x3d0b8d&&!(0x0,lodash_1[_0x4473ea(0x146)])(_0x4d0e62)&&!(0x0,lodash_1[_0x4473ea(0x146)])(_0x3d0b8d)){const _0x459ae9=await(0x0,GetTicketWbot_1['default'])(_0x48b23f),_0x59fb39=await(0x0,ShowUserService_1[_0x4473ea(0x171)])(_0x927acf[_0x4473ea(0x16d)]),_0x52059b=await(0x0,ShowUserService_1[_0x4473ea(0x171)])(_0x54f4cf),_0x990af=_0x4473ea(0x151)+_0x27985e?.[_0x4473ea(0x14c)]+_0x4473ea(0x16f)+_0x59fb39[_0x4473ea(0x14c)]+_0x4473ea(0x130)+_0x17c535['username']+_0x4473ea(0x17a)+(0x0,moment_1['default'])()[_0x4473ea(0x12c)]('DD/MM/YYYY\x20HH:mm:ss')+_0x4473ea(0x193);await(0x0,SendPresenceStatus_1[_0x4473ea(0x126)])(_0x459ae9,_0x48b23f[_0x4473ea(0x188)][_0x4473ea(0x12f)]+'@'+(_0x48b23f[_0x4473ea(0x153)]?_0x4473ea(0x174):_0x4473ea(0x133)));const _0x1fb553=await _0x459ae9[_0x4473ea(0x18b)](_0x48b23f[_0x4473ea(0x188)][_0x4473ea(0x12f)]+'@'+(_0x48b23f['isGroup']?_0x4473ea(0x174):'s.whatsapp.net'),{'text':_0x990af});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x1fb553,_0x48b23f,_0x48b23f['contact']);const _0x2f3055=await(0x0,ShowUserService_1[_0x4473ea(0x171)])(_0x2f6f4f),_0x500a0d=_0x4473ea(0x177)+_0x52059b['name']+_0x4473ea(0x152)+_0x59fb39[_0x4473ea(0x14c)]+_0x4473ea(0x135)+(0x0,moment_1['default'])()['format'](_0x4473ea(0x165))+'\x0aaguarde,\x20já\x20vamos\x20te\x20atender!';await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x459ae9,_0x48b23f[_0x4473ea(0x188)][_0x4473ea(0x12f)]+'@'+(_0x48b23f[_0x4473ea(0x153)]?_0x4473ea(0x174):'s.whatsapp.net'));const _0x1a0460=await _0x459ae9[_0x4473ea(0x18b)](_0x48b23f[_0x4473ea(0x188)][_0x4473ea(0x12f)]+'@'+(_0x48b23f['isGroup']?_0x4473ea(0x174):_0x4473ea(0x133)),{'text':_0x500a0d});await(0x0,wbotMessageListener_1[_0x4473ea(0x127)])(_0x1a0460,_0x48b23f,_0x48b23f['contact']);}else{if(_0x54f4cf!==undefined&&(0x0,lodash_1[_0x4473ea(0x146)])(_0x2f6f4f)&&_0x4d0e62!==_0x3d0b8d&&!(0x0,lodash_1[_0x4473ea(0x146)])(_0x3d0b8d)){const _0x781fe9=await(0x0,GetTicketWbot_1[_0x4473ea(0x171)])(_0x48b23f),_0x4236e2=_0x4473ea(0x151)+_0x27985e?.[_0x4473ea(0x14c)]+_0x4473ea(0x15b);await(0x0,SendPresenceStatus_1[_0x4473ea(0x126)])(_0x781fe9,_0x48b23f['contact'][_0x4473ea(0x12f)]+'@'+(_0x48b23f[_0x4473ea(0x153)]?'g.us':_0x4473ea(0x133)));const _0x3afe20=await _0x781fe9[_0x4473ea(0x18b)](_0x48b23f[_0x4473ea(0x188)]['number']+'@'+(_0x48b23f['isGroup']?'g.us':_0x4473ea(0x133)),{'text':_0x4236e2});await(0x0,wbotMessageListener_1[_0x4473ea(0x127)])(_0x3afe20,_0x48b23f,_0x48b23f[_0x4473ea(0x188)]);}}}}}var _0x3c5bf7=_0x4d0e62!==_0x3d0b8d;return _0x27985e&&(_0x3c5bf7&&_0x27985e[_0x4473ea(0x143)]&&(_0x58e588=_0x4473ea(0x138))),await _0x48b23f['update']({'amountUsedBotQueues':_0x927acf[_0x4473ea(0x122)]||0x0,'status':_0x58e588,'unreadMessages':_0x927acf[_0x4473ea(0x144)]||0x0,'queueId':_0x3d0b8d,'userId':_0x2f6f4f,'whatsappId':_0x2d61ab,'chatbot':_0x1fe25a,'queueOptionId':_0x389e55}),await _0x48b23f[_0x4473ea(0x16a)](),_0x27985e&&_0x3c5bf7&&_0x27985e[_0x4473ea(0x143)]&&!_0x48b23f[_0x4473ea(0x178)]&&!_0x48b23f[_0x4473ea(0x17f)]&&(_0x3e4185['to'](_0x4473ea(0x129)+_0x48b23f[_0x4473ea(0x163)]+'-'+_0x4eb35d)['to'](_0x4473ea(0x17b)+_0x48b23f[_0x4473ea(0x190)]+'-'+_0x4eb35d)[_0x4473ea(0x11a)]('company-'+_0x36d3b8+_0x4473ea(0x189),{'action':_0x4473ea(0x13a),'ticketId':_0x48b23f['id']}),_0x3e4185['to'](_0x4473ea(0x129)+_0x48b23f[_0x4473ea(0x163)]+'-'+_0x48b23f['status'])['to'](_0x4473ea(0x129)+_0x48b23f[_0x4473ea(0x163)]+_0x4473ea(0x157))['to'](_0x4473ea(0x17b)+_0x48b23f[_0x4473ea(0x190)]+_0x4473ea(0x157))['to']('queue-'+_0x48b23f[_0x4473ea(0x190)]+'-'+_0x48b23f[_0x4473ea(0x180)])['to'](_0x5d0bf6['toString']())[_0x4473ea(0x11a)](_0x4473ea(0x129)+_0x36d3b8+_0x4473ea(0x189),{'action':'update','ticket':_0x48b23f}),_0x48b23f=await Ticket_1[_0x4473ea(0x171)]['create']({'companyId':_0x36d3b8,'contactId':_0x48b23f[_0x4473ea(0x14e)],'userId':_0x2f6f4f,'queueId':_0x3d0b8d,'status':_0x4473ea(0x179),'whatsappId':_0x48b23f['whatsappId'],'chatbot':_0x1fe25a,'queueOptionId':_0x389e55,'promptId':_0x490716,'useIntegration':_0x587955,'integrationId':_0x45ae32,'amountUsedBotQueues':0x0,'unreadMessages':0x0})),_0x58e588=_0x48b23f[_0x4473ea(0x180)],_0x58e588===_0x4473ea(0x179)&&(_0x55b1f7[_0x4473ea(0x12b)]({'whatsappId':_0x2d61ab,'queuedAt':(0x0,moment_1[_0x4473ea(0x171)])()[_0x4473ea(0x17e)](),'startedAt':null,'userId':null}),_0x3e4185['to'](_0x4473ea(0x129)+_0x36d3b8+'-mainchannel')['emit'](_0x4473ea(0x129)+_0x36d3b8+_0x4473ea(0x189),{'action':_0x4473ea(0x14a),'ticketId':_0x48b23f?.['id']})),_0x58e588===_0x4473ea(0x17c)&&(_0x55b1f7[_0x4473ea(0x12b)]({'startedAt':(0x0,moment_1['default'])()['toDate'](),'ratingAt':null,'rated':![],'whatsappId':_0x2d61ab,'userId':_0x48b23f[_0x4473ea(0x16d)]}),_0x3e4185['to'](_0x4473ea(0x129)+_0x36d3b8+_0x4473ea(0x11e))[_0x4473ea(0x11a)](_0x4473ea(0x129)+_0x36d3b8+_0x4473ea(0x189),{'action':'removeFromList','ticketId':_0x48b23f?.['id']}),_0x3e4185['to'](_0x4473ea(0x129)+_0x36d3b8+'-mainchannel')[_0x4473ea(0x11a)](_0x4473ea(0x129)+_0x36d3b8+_0x4473ea(0x189),{'action':'updateUnread','ticketId':_0x48b23f?.['id']})),await _0x55b1f7[_0x4473ea(0x140)](),(_0x48b23f[_0x4473ea(0x180)]!==_0x4eb35d||_0x48b23f[_0x4473ea(0x175)]?.['id']!==_0x54f4cf||_0x3c5bf7)&&_0x3e4185['to']('company-'+_0x48b23f[_0x4473ea(0x163)]+'-'+_0x4eb35d)['to'](_0x4473ea(0x17b)+_0x48b23f[_0x4473ea(0x190)]+'-'+_0x4eb35d)['to'](_0x4473ea(0x129)+_0x48b23f[_0x4473ea(0x163)]+_0x4473ea(0x157))['to']('queue-'+_0x48b23f['queueId']+_0x4473ea(0x157))['to'](_0x5d0bf6['toString']())['emit'](_0x4473ea(0x129)+_0x36d3b8+_0x4473ea(0x189),{'action':_0x4473ea(0x13a),'ticketId':_0x48b23f['id']}),_0x48b23f[_0x4473ea(0x180)]!=='closed'&&_0x3e4185['to'](_0x4473ea(0x129)+_0x48b23f[_0x4473ea(0x163)]+'-'+_0x48b23f[_0x4473ea(0x180)])['to'](_0x4473ea(0x129)+_0x48b23f[_0x4473ea(0x163)]+'-notification')['to']('queue-'+_0x48b23f['queueId']+_0x4473ea(0x157))['to'](_0x4473ea(0x17b)+_0x48b23f['queueId']+'-'+_0x48b23f['status'])['to'](_0x5d0bf6[_0x4473ea(0x183)]())[_0x4473ea(0x11a)]('company-'+_0x36d3b8+_0x4473ea(0x189),{'action':'update','ticket':_0x48b23f}),{'ticket':_0x48b23f,'oldStatus':_0x4eb35d,'oldUserId':_0x54f4cf};}catch(_0x188c1a){console['trace'](_0x188c1a),Sentry[_0x4473ea(0x160)](_0x188c1a);}};exports[a528_0x53e247(0x171)]=UpdateTicketService;const notifyUpdate=(_0x456b1f,_0x352673,_0x3ed992,_0x59b71b)=>{const _0x3c282b=a528_0x53e247;_0x456b1f['to'](_0x3c282b(0x129)+_0x352673[_0x3c282b(0x163)]+'-'+_0x352673[_0x3c282b(0x180)])['to'](_0x3c282b(0x129)+_0x352673[_0x3c282b(0x163)]+'-notification')['to'](_0x3ed992['toString']())[_0x3c282b(0x11a)](_0x3c282b(0x129)+_0x59b71b+'-ticket',{'action':_0x3c282b(0x12b),'ticket':_0x352673});};function a528_0x3316(){const _0x4c3698=['g.us','user','*\x20por\x20','*Mensagem\x20automática*:\x0aO\x20atendente\x20anterior\x20*','chatbot','pending','\x20em\x20','queue-','open','getOwnPropertyDescriptor','toDate','useIntegration','status','*4*\x20-\x20_Satisfeito_\x0a','./ShowTicketService','toString','../../helpers/SendPresenceStatus','128DVGANd','create','820106VCRpgd','contact','-ticket','find','sendMessage','queuedAt','148QunxUN','../../models/Setting','__esModule','queueId','1353825KMPleb','finishedAt','\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','emit','dest','16UANfPF','time','-mainchannel','whatsappId','disableBot','moment','amountUsedBotQueues','ticketId','../WbotServices/wbotMessageListener','prototype','SendPresenceStatus','verifyMessage','-open','company-','112341NxpORh','update','format','getWbot','rated','number','*\x20transferido\x20por\x20','admin','\x0aAguarde,\x20já\x20vamos\x20te\x20atender!','s.whatsapp.net','promptId','*,\x20em\x20','../../models/Queue','call','closed','../../helpers/SetTicketMessagesAsRead','delete','../../helpers/GetTicketWbot','__createBinding','queueOptionId','(((.+)+)+)+$','value','save','enabled','ratingAt','newTicketOnTransfer','unreadMessages','notifyUpdate','isNil','9217roJFgF','../../models/Ticket','username','removeFromList','defineProperty','name','findOne','contactId','integrationId','422829faSgEy','*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*','*\x20transferiu\x20o\x20ticket\x20para\x20você,\x20*','isGroup','writable','__importStar','../../helpers/CheckContactOpenTickets','-notification','findByPk','configurable','Need\x20companyId\x20or\x20tokenData','*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','2420964kYpdMC','*2*\x20-\x20_Insatisfeito_\x0a','../../libs/socket','get','captureException','2021139SMVidj','getIO','companyId','../WbotServices/SendWhatsAppMessage','DD/MM/YYYY\x20HH:mm:ss','*1*\x20-\x20_Muito\x20Insatisfeito_\x0a','apply','__setModuleDefault','getTime','reload','hasOwnProperty','*Mensagem\x20automática*:\x0aFoi\x20transferido\x20para\x20o\x20atendente\x20*','userId','*5*\x20-\x20_Muito\x20Satisfeito_\x0a','*\x20e\x20contará\x20com\x20a\x20presença\x20de\x20*','constructor','default','290Zhgfol','../../errors/AppError'];a528_0x3316=function(){return _0x4c3698;};return a528_0x3316();}exports[a528_0x53e247(0x145)]=notifyUpdate;