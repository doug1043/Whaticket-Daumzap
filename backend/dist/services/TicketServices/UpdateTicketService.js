const a528_0x5468c7=a528_0x56f1;(function(_0x7cb952,_0xafa7d5){const _0x3e4479=a528_0x56f1,_0x34748d=_0x7cb952();while(!![]){try{const _0x3634fc=parseInt(_0x3e4479(0x198))/0x1*(parseInt(_0x3e4479(0x1a6))/0x2)+parseInt(_0x3e4479(0x1a8))/0x3+parseInt(_0x3e4479(0x19d))/0x4*(parseInt(_0x3e4479(0x193))/0x5)+parseInt(_0x3e4479(0x1ae))/0x6*(-parseInt(_0x3e4479(0x1a2))/0x7)+parseInt(_0x3e4479(0x19e))/0x8+parseInt(_0x3e4479(0x192))/0x9+parseInt(_0x3e4479(0x1e4))/0xa*(-parseInt(_0x3e4479(0x1d2))/0xb);if(_0x3634fc===_0xafa7d5)break;else _0x34748d['push'](_0x34748d['shift']());}catch(_0x27b563){_0x34748d['push'](_0x34748d['shift']());}}}(a528_0x46be,0x47250));const a528_0x1905d5=(function(){let _0x3a32f3=!![];return function(_0x3f0d9e,_0x48014e){const _0x205c1b=_0x3a32f3?function(){const _0x306e8c=a528_0x56f1;if(_0x48014e){const _0x205bb3=_0x48014e[_0x306e8c(0x188)](_0x3f0d9e,arguments);return _0x48014e=null,_0x205bb3;}}:function(){};return _0x3a32f3=![],_0x205c1b;};}()),a528_0xd47cd6=a528_0x1905d5(this,function(){const _0x9344f0=a528_0x56f1;return a528_0xd47cd6['toString']()['search'](_0x9344f0(0x17e))[_0x9344f0(0x1b7)]()['constructor'](a528_0xd47cd6)['search'](_0x9344f0(0x17e));});a528_0xd47cd6();'use strict';var __createBinding=this&&this[a528_0x5468c7(0x1e6)]||(Object[a528_0x5468c7(0x186)]?function(_0x4d2abd,_0x36af9b,_0x7d3df7,_0x220426){const _0x221b17=a528_0x5468c7;if(_0x220426===undefined)_0x220426=_0x7d3df7;var _0x3f6d24=Object[_0x221b17(0x1e8)](_0x36af9b,_0x7d3df7);(!_0x3f6d24||(_0x221b17(0x1a3)in _0x3f6d24?!_0x36af9b[_0x221b17(0x1b9)]:_0x3f6d24['writable']||_0x3f6d24[_0x221b17(0x1a9)]))&&(_0x3f6d24={'enumerable':!![],'get':function(){return _0x36af9b[_0x7d3df7];}}),Object['defineProperty'](_0x4d2abd,_0x220426,_0x3f6d24);}:function(_0x41ff66,_0x48eed2,_0x57b59d,_0x3e9b72){if(_0x3e9b72===undefined)_0x3e9b72=_0x57b59d;_0x41ff66[_0x3e9b72]=_0x48eed2[_0x57b59d];}),__setModuleDefault=this&&this[a528_0x5468c7(0x1cd)]||(Object[a528_0x5468c7(0x186)]?function(_0x3e25ea,_0x87f5dd){const _0xe5d5ef=a528_0x5468c7;Object[_0xe5d5ef(0x182)](_0x3e25ea,_0xe5d5ef(0x19f),{'enumerable':!![],'value':_0x87f5dd});}:function(_0x96bb48,_0x34fcae){const _0x431523=a528_0x5468c7;_0x96bb48[_0x431523(0x19f)]=_0x34fcae;}),__importStar=this&&this[a528_0x5468c7(0x17a)]||function(_0x106cac){const _0x4e8b63=a528_0x5468c7;if(_0x106cac&&_0x106cac[_0x4e8b63(0x1b9)])return _0x106cac;var _0x41980a={};if(_0x106cac!=null){for(var _0x140881 in _0x106cac)if(_0x140881!==_0x4e8b63(0x19f)&&Object['prototype']['hasOwnProperty'][_0x4e8b63(0x1ab)](_0x106cac,_0x140881))__createBinding(_0x41980a,_0x106cac,_0x140881);}return __setModuleDefault(_0x41980a,_0x106cac),_0x41980a;},__importDefault=this&&this[a528_0x5468c7(0x1ac)]||function(_0x5333bb){return _0x5333bb&&_0x5333bb['__esModule']?_0x5333bb:{'default':_0x5333bb};};Object['defineProperty'](exports,a528_0x5468c7(0x1b9),{'value':!![]}),exports[a528_0x5468c7(0x1b5)]=void 0x0;const moment_1=__importDefault(require('moment')),Sentry=__importStar(require('@sentry/node')),CheckContactOpenTickets_1=__importDefault(require(a528_0x5468c7(0x1c2))),SetTicketMessagesAsRead_1=__importDefault(require(a528_0x5468c7(0x1cb))),socket_1=require('../../libs/socket'),Ticket_1=__importDefault(require(a528_0x5468c7(0x1c9))),Setting_1=__importDefault(require('../../models/Setting')),Queue_1=__importDefault(require(a528_0x5468c7(0x1c8))),ShowTicketService_1=__importDefault(require('./ShowTicketService')),ShowWhatsAppService_1=__importDefault(require(a528_0x5468c7(0x1d9))),SendWhatsAppMessage_1=__importDefault(require(a528_0x5468c7(0x1c1))),FindOrCreateATicketTrakingService_1=__importDefault(require(a528_0x5468c7(0x18e))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),wbotMessageListener_1=require(a528_0x5468c7(0x1df)),ListSettingsServiceOne_1=__importDefault(require(a528_0x5468c7(0x190))),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),lodash_1=require(a528_0x5468c7(0x18d)),AppError_1=__importDefault(require(a528_0x5468c7(0x189))),SendPresenceStatus_1=require(a528_0x5468c7(0x181)),wbot_1=require(a528_0x5468c7(0x195));function a528_0x56f1(_0x1198ba,_0xd53be7){const _0x4f6cf4=a528_0x46be();return a528_0x56f1=function(_0xd47cd6,_0x1905d5){_0xd47cd6=_0xd47cd6-0x175;let _0x46be83=_0x4f6cf4[_0xd47cd6];return _0x46be83;},a528_0x56f1(_0x1198ba,_0xd53be7);}function a528_0x46be(){const _0x3fefde=['find','sendMsgTransfTicket','notifyUpdate','rated','toString','-mainchannel','__esModule','userId','isGroup','*\x20transferiu\x20o\x20ticket\x20para\x20você,\x20*','*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*','companyId','sendMessage','findByPk','../WbotServices/SendWhatsAppMessage','../../helpers/CheckContactOpenTickets','queue-','removeFromList','\x0aAguarde,\x20já\x20vamos\x20te\x20atender!','\x20em\x20','unreadMessages','../../models/Queue','../../models/Ticket','closed','../../helpers/SetTicketMessagesAsRead','isNil','__setModuleDefault','captureException','userRating','*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','*\x20por\x20','743094zNvTeo','dest','whatsappId','verifyMessage','number','*2*\x20-\x20_Insatisfeito_\x0a','newTicketOnTransfer','../WhatsappService/ShowWhatsAppService','push','s.whatsapp.net','length','emit','findOne','../WbotServices/wbotMessageListener','username','*4*\x20-\x20_Satisfeito_\x0a','time','queueId','190rkVeoy','format','__createBinding','SendPresenceStatus','getOwnPropertyDescriptor','update','useIntegration','amountUsedBotQueues','chatbot','-notification','getTime','contact','__importStar','user','Need\x20companyId\x20or\x20tokenData','*Mensagem\x20automática*:\x0aO\x20atendente\x20anterior\x20*','(((.+)+)+)+$','*1*\x20-\x20_Muito\x20Insatisfeito_\x0a','g.us','../../helpers/SendPresenceStatus','defineProperty','-open','contactId','getIO','create','trace','apply','../../errors/AppError','open','pending','-ticket','lodash','./FindOrCreateATicketTrakingService','ticketId','../SettingServices/ListSettingsServiceOne','finishedAt','3629997zHfopR','1108295htfbBV','integrationId','../../libs/wbot','status','DD/MM/YYYY\x20HH:mm:ss','117548CwurKM','profile','Digite\x20de\x201\x20à\x205\x20para\x20qualificar\x20nosso\x20atendimento:\x0a','value','*Mensagem\x20automática*:\x0aFoi\x20transferido\x20para\x20o\x20atendente\x20*','8gytqSs','3662568WHQkmI','default','\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','updateUnread','231lmgFTg','get','enabled','name','8NeoiRU','disableBot','1059951CKTbJx','configurable','delete','call','__importDefault','company-','100554HHXnIs','save','toDate','admin','ratingAt'];a528_0x46be=function(){return _0x3fefde;};return a528_0x46be();}let completionMessageControl=[];const UpdateTicketService=async({ticketData:_0x4506a8,ticketId:_0x125669,tokenData:_0x4b57e1,companyId:_0x313bf1})=>{const _0x121d16=a528_0x5468c7;try{if(!_0x313bf1&&!_0x4b57e1)throw new Error(_0x121d16(0x17c));_0x4b57e1&&(_0x313bf1=_0x4b57e1[_0x121d16(0x1be)]);let {status:_0x295775}=_0x4506a8,{queueId:_0xee1579,userId:_0x16a380,whatsappId:_0x3c6f6c,sendFarewellMessage:_0x4f123e}=_0x4506a8;_0x4f123e==null&&(_0x4f123e=!![]);let _0x46f102=_0x4506a8['chatbot']||![],_0x240ff9=_0x4506a8['queueOptionId']||null,_0x1b61fa=_0x4506a8['promptId']||null,_0x3a3ac5=_0x4506a8[_0x121d16(0x1ea)]||![],_0x4cbf02=_0x4506a8[_0x121d16(0x194)]||null;const _0x3d4bbc=(0x0,socket_1[_0x121d16(0x185)])(),_0x29b48a=_0x121d16(0x1cf),_0x2143e1=await Setting_1['default'][_0x121d16(0x1de)]({'where':{'companyId':_0x313bf1,'key':_0x29b48a}});let _0x4c0f1f=await(0x0,ShowTicketService_1['default'])(_0x125669,_0x313bf1);if(_0x4b57e1&&_0x4c0f1f['status']!==_0x121d16(0x18b)){if(_0x4b57e1[_0x121d16(0x199)]!==_0x121d16(0x1b1)&&_0x4c0f1f['userId']!==parseInt(_0x4b57e1['id'],0xa))throw new AppError_1[(_0x121d16(0x19f))]('Apenas\x20o\x20usuário\x20ativo\x20do\x20ticket\x20ou\x20o\x20Admin\x20podem\x20fazer\x20alterações\x20no\x20ticket');}const _0x1bca31=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x125669,'companyId':_0x313bf1,'whatsappId':_0x4c0f1f[_0x121d16(0x1d4)]});(0x0,lodash_1[_0x121d16(0x1cc)])(_0x3c6f6c)&&(_0x3c6f6c=_0x4c0f1f['whatsappId'][_0x121d16(0x1b7)]());(_0x295775===_0x121d16(0x1ca)||_0x295775===_0x121d16(0x18a))&&await(0x0,SetTicketMessagesAsRead_1[_0x121d16(0x19f)])(_0x4c0f1f);const _0x5a0f9d=_0x4c0f1f[_0x121d16(0x196)],_0x4c8da3=_0x4c0f1f[_0x121d16(0x17b)]?.['id'],_0x2332b7=_0x4c0f1f[_0x121d16(0x1e3)];(_0x5a0f9d===_0x121d16(0x1ca)||_0x3c6f6c!==undefined&&Number(_0x3c6f6c)!==_0x4c0f1f[_0x121d16(0x1d4)])&&(await(0x0,CheckContactOpenTickets_1['default'])(_0x4c0f1f[_0x121d16(0x179)]['id'],_0x3c6f6c),_0x46f102=null,_0x240ff9=null);if(_0x295775==='closed'){const {complationMessage:_0x35a058,ratingMessage:_0x15b566}=await(0x0,ShowWhatsAppService_1[_0x121d16(0x19f)])(_0x4c0f1f['whatsappId'],_0x313bf1);if(!_0x4c0f1f[_0x121d16(0x179)][_0x121d16(0x1a7)]&&_0x2143e1?.[_0x121d16(0x19b)]===_0x121d16(0x1a4)&&_0x4f123e&&!_0x4c0f1f[_0x121d16(0x1bb)]){if(_0x1bca31[_0x121d16(0x1b2)]==null&&!_0x4c0f1f[_0x121d16(0x1bb)]){const _0x4a658f=_0x15b566||'';let _0x48c989='‎'+_0x4a658f+'\x0a\x0a';return _0x48c989+=_0x121d16(0x19a)+_0x121d16(0x17f)+_0x121d16(0x1d7)+'*3*\x20-\x20_Moderadamente\x20Satisfeito_\x0a'+_0x121d16(0x1e1)+'*5*\x20-\x20_Muito\x20Satisfeito_\x0a',await(0x0,SendPresenceStatus_1['SendPresenceStatus'])((0x0,wbot_1['getWbot'])(_0x4c0f1f[_0x121d16(0x1d4)]),_0x4c0f1f[_0x121d16(0x179)][_0x121d16(0x1d6)]+'@'+(_0x4c0f1f['isGroup']?_0x121d16(0x180):_0x121d16(0x1db))),await(0x0,SendWhatsAppMessage_1[_0x121d16(0x19f)])({'body':_0x48c989,'ticket':_0x4c0f1f}),await _0x1bca31[_0x121d16(0x1e9)]({'rated':![],'ratingAt':(0x0,moment_1['default'])()[_0x121d16(0x1b0)]()}),await _0x4c0f1f['update']({'amountUsedBotQueues':_0x4506a8['amountUsedBotQueues']||0x0,'status':_0x295775,'unreadMessages':_0x4506a8[_0x121d16(0x1c7)]||0x0,'queueId':_0xee1579,'userId':_0x16a380,'whatsappId':_0x3c6f6c,'chatbot':_0x46f102,'queueOptionId':_0x240ff9}),_0x3d4bbc['to'](_0x121d16(0x1ad)+_0x4c0f1f[_0x121d16(0x1be)]+_0x121d16(0x183))['to'](_0x125669['toString']())[_0x121d16(0x1dd)](_0x121d16(0x1ad)+_0x4c0f1f[_0x121d16(0x1be)]+'-ticket',{'action':_0x121d16(0x1aa),'ticketId':_0x4c0f1f['id']}),{'ticket':_0x4c0f1f,'oldStatus':_0x5a0f9d,'oldUserId':_0x4c8da3};}_0x1bca31[_0x121d16(0x1b2)]=(0x0,moment_1[_0x121d16(0x19f)])()[_0x121d16(0x1b0)](),_0x1bca31[_0x121d16(0x1b6)]=![];}if(completionMessageControl[_0x121d16(0x1dc)]>=0x9c4)completionMessageControl=[];if(!(0x0,lodash_1['isNil'])(_0x35a058)&&_0x35a058!==''&&_0x4f123e&&!_0x4c0f1f[_0x121d16(0x1bb)]){let _0x5320a8=completionMessageControl[_0x121d16(0x1b3)](_0x210a54=>_0x210a54['ticketId']===_0x4c0f1f['id']||_0x210a54[_0x121d16(0x1d3)]===_0x4c0f1f[_0x121d16(0x179)][_0x121d16(0x1d6)]);if(!_0x5320a8||_0x5320a8&&_0x5320a8[_0x121d16(0x1e2)]+0x3e8*0x3c*0x1e<new Date()[_0x121d16(0x178)]()){_0x5320a8&&(completionMessageControl=completionMessageControl['filter'](_0x2b207e=>_0x2b207e[_0x121d16(0x18f)]!==_0x4c0f1f['id']),_0x5320a8=null);if(!_0x4c0f1f[_0x121d16(0x179)][_0x121d16(0x1a7)]&&!(0x0,lodash_1['isNil'])(_0x35a058)&&_0x35a058!==''){const _0x2ce6ca='‎'+_0x35a058;await(0x0,SendPresenceStatus_1['SendPresenceStatus'])((0x0,wbot_1['getWbot'])(_0x4c0f1f[_0x121d16(0x1d4)]),_0x4c0f1f[_0x121d16(0x179)][_0x121d16(0x1d6)]+'@'+(_0x4c0f1f[_0x121d16(0x1bb)]?_0x121d16(0x180):'s.whatsapp.net')),await(0x0,SendWhatsAppMessage_1[_0x121d16(0x19f)])({'body':_0x2ce6ca,'ticket':_0x4c0f1f});}}!_0x5320a8&&completionMessageControl[_0x121d16(0x1da)]({'ticketId':_0x4c0f1f['id'],'dest':_0x4c0f1f[_0x121d16(0x179)]['number'],'time':new Date()[_0x121d16(0x178)]()});}await _0x4c0f1f[_0x121d16(0x1e9)]({'promptId':null,'integrationId':null,'useIntegration':![],'typebotStatus':![],'typebotSessionId':null}),_0x1bca31[_0x121d16(0x191)]=(0x0,moment_1[_0x121d16(0x19f)])()[_0x121d16(0x1b0)](),_0x1bca31[_0x121d16(0x1d4)]=_0x4c0f1f[_0x121d16(0x1d4)],_0x1bca31['userId']=_0x4c0f1f[_0x121d16(0x1ba)];}_0xee1579!==undefined&&_0xee1579!==null&&(_0x1bca31['queuedAt']=(0x0,moment_1[_0x121d16(0x19f)])()['toDate']());const _0x5ee333=await(0x0,ListSettingsServiceOne_1[_0x121d16(0x19f)])({'companyId':_0x313bf1,'key':_0x121d16(0x1b4)}),_0x14d479=await Queue_1[_0x121d16(0x19f)][_0x121d16(0x1c0)](_0xee1579);if(_0x5ee333?.[_0x121d16(0x19b)]===_0x121d16(0x1a4)){if(_0x2332b7!==_0xee1579&&_0x4c8da3===_0x16a380&&!(0x0,lodash_1['isNil'])(_0x2332b7)&&!(0x0,lodash_1['isNil'])(_0xee1579)){const _0x565b31=await(0x0,GetTicketWbot_1[_0x121d16(0x19f)])(_0x4c0f1f),_0x5595f5=_0x121d16(0x1bd)+_0x14d479?.[_0x121d16(0x1a5)]+_0x121d16(0x1d0);await(0x0,SendPresenceStatus_1[_0x121d16(0x1e7)])(_0x565b31,_0x4c0f1f[_0x121d16(0x179)][_0x121d16(0x1d6)]+'@'+(_0x4c0f1f[_0x121d16(0x1bb)]?_0x121d16(0x180):'s.whatsapp.net'));const _0x2bdd51=await _0x565b31[_0x121d16(0x1bf)](_0x4c0f1f['contact'][_0x121d16(0x1d6)]+'@'+(_0x4c0f1f['isGroup']?_0x121d16(0x180):_0x121d16(0x1db)),{'text':_0x5595f5});await(0x0,wbotMessageListener_1[_0x121d16(0x1d5)])(_0x2bdd51,_0x4c0f1f,_0x4c0f1f[_0x121d16(0x179)]);}else{if(_0x4c8da3!==_0x16a380&&_0x2332b7===_0xee1579&&!(0x0,lodash_1['isNil'])(_0x4c8da3)&&!(0x0,lodash_1[_0x121d16(0x1cc)])(_0x16a380)){const _0x39bbe6=await(0x0,GetTicketWbot_1[_0x121d16(0x19f)])(_0x4c0f1f),_0x203b3b=await(0x0,ShowUserService_1[_0x121d16(0x19f)])(_0x4506a8[_0x121d16(0x1ba)]),_0x31cbf3=_0x121d16(0x19c)+_0x203b3b['name']+_0x121d16(0x1d1)+_0x4b57e1[_0x121d16(0x1e0)]+_0x121d16(0x1c6)+(0x0,moment_1[_0x121d16(0x19f)])()[_0x121d16(0x1e5)]('DD/MM/YYYY\x20HH:mm:ss')+_0x121d16(0x1c5);await(0x0,SendPresenceStatus_1[_0x121d16(0x1e7)])(_0x39bbe6,_0x4c0f1f[_0x121d16(0x179)]['number']+'@'+(_0x4c0f1f[_0x121d16(0x1bb)]?_0x121d16(0x180):_0x121d16(0x1db)));const _0x501fe2=await _0x39bbe6[_0x121d16(0x1bf)](_0x4c0f1f[_0x121d16(0x179)]['number']+'@'+(_0x4c0f1f[_0x121d16(0x1bb)]?_0x121d16(0x180):'s.whatsapp.net'),{'text':_0x31cbf3});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x501fe2,_0x4c0f1f,_0x4c0f1f[_0x121d16(0x179)]);}else{if(_0x4c8da3!==_0x16a380&&!(0x0,lodash_1[_0x121d16(0x1cc)])(_0x4c8da3)&&!(0x0,lodash_1[_0x121d16(0x1cc)])(_0x16a380)&&_0x2332b7!==_0xee1579&&!(0x0,lodash_1[_0x121d16(0x1cc)])(_0x2332b7)&&!(0x0,lodash_1[_0x121d16(0x1cc)])(_0xee1579)){const _0x967522=await(0x0,GetTicketWbot_1[_0x121d16(0x19f)])(_0x4c0f1f),_0x12a0d9=await(0x0,ShowUserService_1[_0x121d16(0x19f)])(_0x4506a8[_0x121d16(0x1ba)]),_0x39aa4e=await(0x0,ShowUserService_1[_0x121d16(0x19f)])(_0x4c8da3),_0x273c55='*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*'+_0x14d479?.['name']+'*\x20e\x20contará\x20com\x20a\x20presença\x20de\x20*'+_0x12a0d9[_0x121d16(0x1a5)]+'*\x20transferido\x20por\x20'+_0x4b57e1[_0x121d16(0x1e0)]+'\x20em\x20'+(0x0,moment_1[_0x121d16(0x19f)])()[_0x121d16(0x1e5)](_0x121d16(0x197))+'\x0aaguarde,\x20já\x20vamos\x20te\x20atender!';await(0x0,SendPresenceStatus_1[_0x121d16(0x1e7)])(_0x967522,_0x4c0f1f[_0x121d16(0x179)][_0x121d16(0x1d6)]+'@'+(_0x4c0f1f[_0x121d16(0x1bb)]?_0x121d16(0x180):_0x121d16(0x1db)));const _0x461af4=await _0x967522[_0x121d16(0x1bf)](_0x4c0f1f[_0x121d16(0x179)][_0x121d16(0x1d6)]+'@'+(_0x4c0f1f[_0x121d16(0x1bb)]?_0x121d16(0x180):_0x121d16(0x1db)),{'text':_0x273c55});await(0x0,wbotMessageListener_1[_0x121d16(0x1d5)])(_0x461af4,_0x4c0f1f,_0x4c0f1f[_0x121d16(0x179)]);const _0x1b283e=await(0x0,ShowUserService_1[_0x121d16(0x19f)])(_0x16a380),_0x28a574=_0x121d16(0x17d)+_0x39aa4e[_0x121d16(0x1a5)]+_0x121d16(0x1bc)+_0x12a0d9[_0x121d16(0x1a5)]+'*,\x20em\x20'+(0x0,moment_1[_0x121d16(0x19f)])()[_0x121d16(0x1e5)](_0x121d16(0x197))+_0x121d16(0x1a0);await(0x0,SendPresenceStatus_1[_0x121d16(0x1e7)])(_0x967522,_0x4c0f1f[_0x121d16(0x179)][_0x121d16(0x1d6)]+'@'+(_0x4c0f1f[_0x121d16(0x1bb)]?_0x121d16(0x180):_0x121d16(0x1db)));const _0x5f18a2=await _0x967522['sendMessage'](_0x4c0f1f[_0x121d16(0x179)]['number']+'@'+(_0x4c0f1f[_0x121d16(0x1bb)]?'g.us':'s.whatsapp.net'),{'text':_0x28a574});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x5f18a2,_0x4c0f1f,_0x4c0f1f[_0x121d16(0x179)]);}else{if(_0x4c8da3!==undefined&&(0x0,lodash_1[_0x121d16(0x1cc)])(_0x16a380)&&_0x2332b7!==_0xee1579&&!(0x0,lodash_1[_0x121d16(0x1cc)])(_0xee1579)){const _0x5aafc0=await(0x0,GetTicketWbot_1[_0x121d16(0x19f)])(_0x4c0f1f),_0x115af8='*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*'+_0x14d479?.[_0x121d16(0x1a5)]+'*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!';await(0x0,SendPresenceStatus_1[_0x121d16(0x1e7)])(_0x5aafc0,_0x4c0f1f[_0x121d16(0x179)]['number']+'@'+(_0x4c0f1f['isGroup']?_0x121d16(0x180):_0x121d16(0x1db)));const _0x2569b9=await _0x5aafc0['sendMessage'](_0x4c0f1f[_0x121d16(0x179)][_0x121d16(0x1d6)]+'@'+(_0x4c0f1f['isGroup']?_0x121d16(0x180):_0x121d16(0x1db)),{'text':_0x115af8});await(0x0,wbotMessageListener_1[_0x121d16(0x1d5)])(_0x2569b9,_0x4c0f1f,_0x4c0f1f[_0x121d16(0x179)]);}}}}}var _0x3e338b=_0x2332b7!==_0xee1579;return _0x14d479&&(_0x3e338b&&_0x14d479[_0x121d16(0x1d8)]&&(_0x295775='closed')),await _0x4c0f1f[_0x121d16(0x1e9)]({'amountUsedBotQueues':_0x4506a8[_0x121d16(0x175)]||0x0,'status':_0x295775,'unreadMessages':_0x4506a8[_0x121d16(0x1c7)]||0x0,'queueId':_0xee1579,'userId':_0x16a380,'whatsappId':_0x3c6f6c,'chatbot':_0x46f102,'queueOptionId':_0x240ff9}),await _0x4c0f1f['reload'](),_0x14d479&&_0x3e338b&&_0x14d479['newTicketOnTransfer']&&!_0x4c0f1f[_0x121d16(0x176)]&&!_0x4c0f1f[_0x121d16(0x1ea)]&&(_0x3d4bbc['to'](_0x121d16(0x1ad)+_0x4c0f1f[_0x121d16(0x1be)]+'-'+_0x5a0f9d)['to'](_0x121d16(0x1c3)+_0x4c0f1f['queueId']+'-'+_0x5a0f9d)['emit']('company-'+_0x313bf1+_0x121d16(0x18c),{'action':_0x121d16(0x1aa),'ticketId':_0x4c0f1f['id']}),_0x3d4bbc['to']('company-'+_0x4c0f1f[_0x121d16(0x1be)]+'-'+_0x4c0f1f['status'])['to'](_0x121d16(0x1ad)+_0x4c0f1f[_0x121d16(0x1be)]+_0x121d16(0x177))['to'](_0x121d16(0x1c3)+_0x4c0f1f[_0x121d16(0x1e3)]+_0x121d16(0x177))['to'](_0x121d16(0x1c3)+_0x4c0f1f[_0x121d16(0x1e3)]+'-'+_0x4c0f1f['status'])['to'](_0x125669[_0x121d16(0x1b7)]())[_0x121d16(0x1dd)](_0x121d16(0x1ad)+_0x313bf1+_0x121d16(0x18c),{'action':'update','ticket':_0x4c0f1f}),_0x4c0f1f=await Ticket_1[_0x121d16(0x19f)][_0x121d16(0x186)]({'companyId':_0x313bf1,'contactId':_0x4c0f1f[_0x121d16(0x184)],'userId':_0x16a380,'queueId':_0xee1579,'status':_0x121d16(0x18b),'whatsappId':_0x4c0f1f[_0x121d16(0x1d4)],'chatbot':_0x46f102,'queueOptionId':_0x240ff9,'promptId':_0x1b61fa,'useIntegration':_0x3a3ac5,'integrationId':_0x4cbf02,'amountUsedBotQueues':0x0,'unreadMessages':0x0})),_0x295775=_0x4c0f1f[_0x121d16(0x196)],_0x295775===_0x121d16(0x18b)&&(_0x1bca31[_0x121d16(0x1e9)]({'whatsappId':_0x3c6f6c,'queuedAt':(0x0,moment_1[_0x121d16(0x19f)])()[_0x121d16(0x1b0)](),'startedAt':null,'userId':null}),_0x3d4bbc['to'](_0x121d16(0x1ad)+_0x313bf1+_0x121d16(0x1b8))[_0x121d16(0x1dd)](_0x121d16(0x1ad)+_0x313bf1+_0x121d16(0x18c),{'action':'removeFromList','ticketId':_0x4c0f1f?.['id']})),_0x295775===_0x121d16(0x18a)&&(_0x1bca31[_0x121d16(0x1e9)]({'startedAt':(0x0,moment_1['default'])()[_0x121d16(0x1b0)](),'ratingAt':null,'rated':![],'whatsappId':_0x3c6f6c,'userId':_0x4c0f1f[_0x121d16(0x1ba)]}),_0x3d4bbc['to'](_0x121d16(0x1ad)+_0x313bf1+'-mainchannel')[_0x121d16(0x1dd)](_0x121d16(0x1ad)+_0x313bf1+_0x121d16(0x18c),{'action':_0x121d16(0x1c4),'ticketId':_0x4c0f1f?.['id']}),_0x3d4bbc['to'](_0x121d16(0x1ad)+_0x313bf1+_0x121d16(0x1b8))[_0x121d16(0x1dd)](_0x121d16(0x1ad)+_0x313bf1+_0x121d16(0x18c),{'action':_0x121d16(0x1a1),'ticketId':_0x4c0f1f?.['id']})),await _0x1bca31[_0x121d16(0x1af)](),(_0x4c0f1f[_0x121d16(0x196)]!==_0x5a0f9d||_0x4c0f1f[_0x121d16(0x17b)]?.['id']!==_0x4c8da3||_0x3e338b)&&_0x3d4bbc['to'](_0x121d16(0x1ad)+_0x4c0f1f[_0x121d16(0x1be)]+'-'+_0x5a0f9d)['to'](_0x121d16(0x1c3)+_0x4c0f1f[_0x121d16(0x1e3)]+'-'+_0x5a0f9d)['to'](_0x121d16(0x1ad)+_0x4c0f1f[_0x121d16(0x1be)]+_0x121d16(0x177))['to'](_0x121d16(0x1c3)+_0x4c0f1f[_0x121d16(0x1e3)]+_0x121d16(0x177))['to'](_0x125669[_0x121d16(0x1b7)]())[_0x121d16(0x1dd)]('company-'+_0x313bf1+_0x121d16(0x18c),{'action':_0x121d16(0x1aa),'ticketId':_0x4c0f1f['id']}),_0x4c0f1f[_0x121d16(0x196)]!==_0x121d16(0x1ca)&&_0x3d4bbc['to'](_0x121d16(0x1ad)+_0x4c0f1f[_0x121d16(0x1be)]+'-'+_0x4c0f1f[_0x121d16(0x196)])['to'](_0x121d16(0x1ad)+_0x4c0f1f[_0x121d16(0x1be)]+_0x121d16(0x177))['to'](_0x121d16(0x1c3)+_0x4c0f1f[_0x121d16(0x1e3)]+'-notification')['to'](_0x121d16(0x1c3)+_0x4c0f1f[_0x121d16(0x1e3)]+'-'+_0x4c0f1f['status'])['to'](_0x125669[_0x121d16(0x1b7)]())['emit']('company-'+_0x313bf1+_0x121d16(0x18c),{'action':'update','ticket':_0x4c0f1f}),{'ticket':_0x4c0f1f,'oldStatus':_0x5a0f9d,'oldUserId':_0x4c8da3};}catch(_0x438118){console[_0x121d16(0x187)](_0x438118),Sentry[_0x121d16(0x1ce)](_0x438118);}};exports[a528_0x5468c7(0x19f)]=UpdateTicketService;const notifyUpdate=(_0x3d1a29,_0x578f80,_0x2d6913,_0x45d463)=>{const _0x525bde=a528_0x5468c7;_0x3d1a29['to'](_0x525bde(0x1ad)+_0x578f80[_0x525bde(0x1be)]+'-'+_0x578f80[_0x525bde(0x196)])['to'](_0x525bde(0x1ad)+_0x578f80['companyId']+_0x525bde(0x177))['to'](_0x2d6913['toString']())[_0x525bde(0x1dd)](_0x525bde(0x1ad)+_0x45d463+_0x525bde(0x18c),{'action':_0x525bde(0x1e9),'ticket':_0x578f80});};exports['notifyUpdate']=notifyUpdate;