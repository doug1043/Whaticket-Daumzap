const a556_0x3c1bb8=a556_0xe13d;(function(_0x29689c,_0x774429){const _0x5b384c=a556_0xe13d,_0x59abe8=_0x29689c();while(!![]){try{const _0x4c932d=-parseInt(_0x5b384c(0xd3))/0x1+parseInt(_0x5b384c(0xed))/0x2*(parseInt(_0x5b384c(0xc8))/0x3)+-parseInt(_0x5b384c(0xe0))/0x4*(-parseInt(_0x5b384c(0xe2))/0x5)+-parseInt(_0x5b384c(0xca))/0x6+-parseInt(_0x5b384c(0xbe))/0x7*(parseInt(_0x5b384c(0xdf))/0x8)+parseInt(_0x5b384c(0xbb))/0x9+parseInt(_0x5b384c(0xcb))/0xa;if(_0x4c932d===_0x774429)break;else _0x59abe8['push'](_0x59abe8['shift']());}catch(_0x4f045c){_0x59abe8['push'](_0x59abe8['shift']());}}}(a556_0x37b7,0x87212));const a556_0x37faf2=(function(){let _0x3a6de4=!![];return function(_0x4e8c90,_0x6bd0ad){const _0x161e29=_0x3a6de4?function(){const _0x4545f0=a556_0xe13d;if(_0x6bd0ad){const _0x38b15=_0x6bd0ad[_0x4545f0(0xc6)](_0x4e8c90,arguments);return _0x6bd0ad=null,_0x38b15;}}:function(){};return _0x3a6de4=![],_0x161e29;};}()),a556_0x318d44=a556_0x37faf2(this,function(){const _0x2a1689=a556_0xe13d;return a556_0x318d44[_0x2a1689(0xd6)]()[_0x2a1689(0xe3)](_0x2a1689(0xc5))['toString']()[_0x2a1689(0xeb)](a556_0x318d44)[_0x2a1689(0xe3)](_0x2a1689(0xc5));});a556_0x318d44();function a556_0xe13d(_0x2c5988,_0xae37a0){const _0x5d002c=a556_0x37b7();return a556_0xe13d=function(_0x318d44,_0x37faf2){_0x318d44=_0x318d44-0xb8;let _0x37b7b1=_0x5d002c[_0x318d44];return _0x37b7b1;},a556_0xe13d(_0x2c5988,_0xae37a0);}'use strict';var __importDefault=this&&this[a556_0x3c1bb8(0xd0)]||function(_0x3ded4){const _0x49417d=a556_0x3c1bb8;return _0x3ded4&&_0x3ded4[_0x49417d(0xce)]?_0x3ded4:{'default':_0x3ded4};};function a556_0x37b7(){const _0x381236=['4uaxehK','map','3160530rmwEoq','search','../../models/TicketTag','col','body','color','startOfDay','../../models/Contact','whatsapp','constructor','tags','19978XdSgCE','true','LOWER','updatedAt','toLocaleLowerCase','queues','contact','3073302NlUpwM','pending','date-fns','7dGRPEB','lodash','user','presence','name','LIKE','../../models/Message','(((.+)+)+)+$','apply','endOfDay','183kOxMmp','contact.name','1808802UqxVTq','10451720vSxKZK','between','intersection','__esModule','number','__importDefault','parseISO','../../models/Ticket','945365MVDuzi','sequelize','ticketId','toString','findAndCountAll','isArray','length','default','where','findAll','../../models/Whatsapp','../../models/Queue','6622104nBZmyV'];a556_0x37b7=function(){return _0x381236;};return a556_0x37b7();}Object['defineProperty'](exports,a556_0x3c1bb8(0xce),{'value':!![]});const sequelize_1=require(a556_0x3c1bb8(0xd4)),date_fns_1=require(a556_0x3c1bb8(0xbd)),Ticket_1=__importDefault(require(a556_0x3c1bb8(0xd2))),Contact_1=__importDefault(require(a556_0x3c1bb8(0xe9))),Message_1=__importDefault(require(a556_0x3c1bb8(0xc4))),Queue_1=__importDefault(require(a556_0x3c1bb8(0xde))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a556_0x3c1bb8(0xe4))),lodash_1=require(a556_0x3c1bb8(0xbf)),Whatsapp_1=__importDefault(require(a556_0x3c1bb8(0xdd))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x26d145,tags:_0x2e10ec,users:_0x5189f2,status:_0x34bf37,date:_0x54b954,updatedAt:_0x4583ca,showAll:_0x1b06ed,userId:_0x18fa4d,withUnreadMessages:_0x3e2dab,companyId:_0x114601})=>{const _0x14366b=a556_0x3c1bb8;let _0x5df539={[sequelize_1['Op']['or']]:[{'userId':_0x18fa4d},{'status':_0x14366b(0xbc)}],'queueId':{[sequelize_1['Op']['or']]:[_0x26d145,null]}},_0x165bb8;_0x165bb8=[{'model':Contact_1[_0x14366b(0xda)],'as':_0x14366b(0xba),'attributes':['id',_0x14366b(0xc2),_0x14366b(0xcf),'email',_0x14366b(0xc1)]},{'model':Queue_1[_0x14366b(0xda)],'as':'queue','attributes':['id','name',_0x14366b(0xe7)]},{'model':User_1[_0x14366b(0xda)],'as':_0x14366b(0xc0),'attributes':['id',_0x14366b(0xc2)]},{'model':Tag_1[_0x14366b(0xda)],'as':_0x14366b(0xec),'attributes':['id',_0x14366b(0xc2),_0x14366b(0xe7)]},{'model':Whatsapp_1[_0x14366b(0xda)],'as':_0x14366b(0xea),'attributes':['name']}];_0x1b06ed===_0x14366b(0xee)&&(_0x5df539={'queueId':{[sequelize_1['Op']['or']]:[_0x26d145,null]},'userId':_0x18fa4d});_0x5df539={..._0x5df539,'status':{[sequelize_1['Op']['or']]:[_0x14366b(0xbc),'open']}};if(searchParam){const _0x3c4d84=searchParam[_0x14366b(0xb8)]()['trim']();_0x165bb8=[..._0x165bb8,{'model':Message_1[_0x14366b(0xda)],'as':'messages','attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x14366b(0xdb)])((0x0,sequelize_1['fn'])(_0x14366b(0xef),(0x0,sequelize_1[_0x14366b(0xe5)])(_0x14366b(0xe6))),_0x14366b(0xc3),'%'+_0x3c4d84+'%')},'required':![],'duplicating':![]}],_0x5df539={..._0x5df539,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x14366b(0xdb)])((0x0,sequelize_1['fn'])(_0x14366b(0xef),(0x0,sequelize_1[_0x14366b(0xe5)])(_0x14366b(0xc9))),_0x14366b(0xc3),'%'+_0x3c4d84+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x3c4d84+'%'}},{'$message.body$':(0x0,sequelize_1[_0x14366b(0xdb)])((0x0,sequelize_1['fn'])(_0x14366b(0xef),(0x0,sequelize_1[_0x14366b(0xe5)])(_0x14366b(0xe6))),_0x14366b(0xc3),'%'+_0x3c4d84+'%')}]};}_0x54b954&&(_0x5df539={'createdAt':{[sequelize_1['Op'][_0x14366b(0xcc)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1['parseISO'])(_0x54b954)),+(0x0,date_fns_1[_0x14366b(0xc7)])((0x0,date_fns_1[_0x14366b(0xd1)])(_0x54b954))]}});_0x4583ca&&(_0x5df539={'updatedAt':{[sequelize_1['Op'][_0x14366b(0xcc)]]:[+(0x0,date_fns_1[_0x14366b(0xe8)])((0x0,date_fns_1['parseISO'])(_0x4583ca)),+(0x0,date_fns_1[_0x14366b(0xc7)])((0x0,date_fns_1['parseISO'])(_0x4583ca))]}});if(_0x3e2dab===_0x14366b(0xee)){const _0x3056aa=await(0x0,ShowUserService_1[_0x14366b(0xda)])(_0x18fa4d),_0x3ab652=_0x3056aa[_0x14366b(0xb9)][_0x14366b(0xe1)](_0x58dec4=>_0x58dec4['id']);_0x5df539={[sequelize_1['Op']['or']]:[{'userId':_0x18fa4d},{'status':_0x14366b(0xbc)}],'queueId':{[sequelize_1['Op']['or']]:[_0x3ab652,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x14366b(0xd8)](_0x2e10ec)&&_0x2e10ec[_0x14366b(0xd9)]>0x0){const _0x390bb8=[];for(let _0x28ff55 of _0x2e10ec){const _0x2a2530=await TicketTag_1['default'][_0x14366b(0xdc)]({'where':{'tagId':_0x28ff55}});_0x2a2530&&_0x390bb8['push'](_0x2a2530[_0x14366b(0xe1)](_0x45448f=>_0x45448f[_0x14366b(0xd5)]));}const _0x141e4d=(0x0,lodash_1[_0x14366b(0xcd)])(..._0x390bb8);_0x5df539={..._0x5df539,'id':{[sequelize_1['Op']['in']]:_0x141e4d}};}if(Array[_0x14366b(0xd8)](_0x5189f2)&&_0x5189f2[_0x14366b(0xd9)]>0x0){const _0x5a03e0=[];for(let _0x3a9846 of _0x5189f2){const _0x5cfa82=await Ticket_1[_0x14366b(0xda)][_0x14366b(0xdc)]({'where':{'userId':_0x3a9846}});_0x5cfa82&&_0x5a03e0['push'](_0x5cfa82['map'](_0x189818=>_0x189818['id']));}const _0xbcf0c9=(0x0,lodash_1[_0x14366b(0xcd)])(..._0x5a03e0);_0x5df539={..._0x5df539,'id':{[sequelize_1['Op']['in']]:_0xbcf0c9}};}const _0x1ab5d0=0x28,_0x1129ce=_0x1ab5d0*(+pageNumber-0x1);_0x5df539={..._0x5df539,'companyId':_0x114601};const {count:_0x3051d8,rows:_0x1ef075}=await Ticket_1[_0x14366b(0xda)][_0x14366b(0xd7)]({'where':_0x5df539,'include':_0x165bb8,'distinct':!![],'limit':_0x1ab5d0,'offset':_0x1129ce,'order':[[_0x14366b(0xf0),'DESC']],'subQuery':![]}),_0x4c9c74=_0x3051d8>_0x1129ce+_0x1ef075[_0x14366b(0xd9)];return{'tickets':_0x1ef075,'count':_0x3051d8,'hasMore':_0x4c9c74};};exports[a556_0x3c1bb8(0xda)]=ListTicketsServiceKanban;