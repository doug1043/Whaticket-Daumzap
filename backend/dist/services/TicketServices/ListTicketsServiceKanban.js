const a525_0x136a28=a525_0x2dac;(function(_0x140e39,_0xd3147a){const _0x1f5c3b=a525_0x2dac,_0x8a8f88=_0x140e39();while(!![]){try{const _0xe92abb=parseInt(_0x1f5c3b(0x84))/0x1*(-parseInt(_0x1f5c3b(0x91))/0x2)+-parseInt(_0x1f5c3b(0x89))/0x3+-parseInt(_0x1f5c3b(0x8b))/0x4+parseInt(_0x1f5c3b(0x95))/0x5*(-parseInt(_0x1f5c3b(0xa8))/0x6)+-parseInt(_0x1f5c3b(0x9d))/0x7*(parseInt(_0x1f5c3b(0x97))/0x8)+-parseInt(_0x1f5c3b(0x8e))/0x9*(parseInt(_0x1f5c3b(0x7d))/0xa)+parseInt(_0x1f5c3b(0x96))/0xb*(parseInt(_0x1f5c3b(0xb4))/0xc);if(_0xe92abb===_0xd3147a)break;else _0x8a8f88['push'](_0x8a8f88['shift']());}catch(_0x2764f6){_0x8a8f88['push'](_0x8a8f88['shift']());}}}(a525_0x119b,0x2eaee));const a525_0x31057f=(function(){let _0x3c5508=!![];return function(_0x551cd9,_0x5dce8f){const _0x2c569f=_0x3c5508?function(){if(_0x5dce8f){const _0x2d1c00=_0x5dce8f['apply'](_0x551cd9,arguments);return _0x5dce8f=null,_0x2d1c00;}}:function(){};return _0x3c5508=![],_0x2c569f;};}()),a525_0x4b285f=a525_0x31057f(this,function(){const _0x429a5b=a525_0x2dac;return a525_0x4b285f[_0x429a5b(0x9b)]()[_0x429a5b(0xab)]('(((.+)+)+)+$')['toString']()[_0x429a5b(0x99)](a525_0x4b285f)['search'](_0x429a5b(0xb8));});a525_0x4b285f();'use strict';function a525_0x119b(){const _0x1dd1cd=['843ulBbdk','parseISO','name','push','messages','166107eZIYYp','../../models/TicketTag','116076agDdLZ','open','trim','9zBUWMd','../../models/Whatsapp','../../models/Message','362KdbVBK','sequelize','LOWER','presence','5tcfgEE','495WRwLpT','255752OqHbab','lodash','constructor','queues','toString','queue','21FrcVHp','whatsapp','toLocaleLowerCase','col','color','__esModule','DESC','endOfDay','startOfDay','where','LIKE','759570ayHGCc','../../models/User','intersection','search','body','contact','default','updatedAt','tags','like','__importDefault','../../models/Tag','246264bCaqLn','user','email','findAndCountAll','(((.+)+)+)+$','2728030bNwPzN','length','isArray','date-fns','between','findAll','map'];a525_0x119b=function(){return _0x1dd1cd;};return a525_0x119b();}function a525_0x2dac(_0x339944,_0x3b12e3){const _0x27b198=a525_0x119b();return a525_0x2dac=function(_0x4b285f,_0x31057f){_0x4b285f=_0x4b285f-0x7d;let _0x119b01=_0x27b198[_0x4b285f];return _0x119b01;},a525_0x2dac(_0x339944,_0x3b12e3);}var __importDefault=this&&this[a525_0x136a28(0xb2)]||function(_0x2da520){const _0x11ea46=a525_0x136a28;return _0x2da520&&_0x2da520[_0x11ea46(0xa2)]?_0x2da520:{'default':_0x2da520};};Object['defineProperty'](exports,a525_0x136a28(0xa2),{'value':!![]});const sequelize_1=require(a525_0x136a28(0x92)),date_fns_1=require(a525_0x136a28(0x80)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a525_0x136a28(0x90))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a525_0x136a28(0xa9))),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require(a525_0x136a28(0xb3))),TicketTag_1=__importDefault(require(a525_0x136a28(0x8a))),lodash_1=require(a525_0x136a28(0x98)),Whatsapp_1=__importDefault(require(a525_0x136a28(0x8f))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x263a36,tags:_0x3c60b3,users:_0x4fc37f,status:_0x31ce5e,date:_0x526d1e,updatedAt:_0x440764,showAll:_0x2c5b17,userId:_0x3a684e,withUnreadMessages:_0x5c81aa,companyId:_0x52246d})=>{const _0x1c79d0=a525_0x136a28;let _0x136a96={[sequelize_1['Op']['or']]:[{'userId':_0x3a684e},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x263a36,null]}},_0x3e893d;_0x3e893d=[{'model':Contact_1[_0x1c79d0(0xae)],'as':_0x1c79d0(0xad),'attributes':['id',_0x1c79d0(0x86),'number',_0x1c79d0(0xb6),_0x1c79d0(0x94)]},{'model':Queue_1[_0x1c79d0(0xae)],'as':_0x1c79d0(0x9c),'attributes':['id','name',_0x1c79d0(0xa1)]},{'model':User_1['default'],'as':_0x1c79d0(0xb5),'attributes':['id',_0x1c79d0(0x86)]},{'model':Tag_1['default'],'as':_0x1c79d0(0xb0),'attributes':['id',_0x1c79d0(0x86),'color']},{'model':Whatsapp_1[_0x1c79d0(0xae)],'as':_0x1c79d0(0x9e),'attributes':[_0x1c79d0(0x86)]}];_0x2c5b17==='true'&&(_0x136a96={'queueId':{[sequelize_1['Op']['or']]:[_0x263a36,null]},'userId':_0x3a684e});_0x136a96={..._0x136a96,'status':{[sequelize_1['Op']['or']]:['pending',_0x1c79d0(0x8c)]}};if(searchParam){const _0x2c0974=searchParam[_0x1c79d0(0x9f)]()[_0x1c79d0(0x8d)]();_0x3e893d=[..._0x3e893d,{'model':Message_1[_0x1c79d0(0xae)],'as':_0x1c79d0(0x88),'attributes':['id',_0x1c79d0(0xac)],'where':{'body':(0x0,sequelize_1[_0x1c79d0(0xa6)])((0x0,sequelize_1['fn'])(_0x1c79d0(0x93),(0x0,sequelize_1[_0x1c79d0(0xa0)])('body')),_0x1c79d0(0xa7),'%'+_0x2c0974+'%')},'required':![],'duplicating':![]}],_0x136a96={..._0x136a96,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x1c79d0(0x93),(0x0,sequelize_1['col'])('contact.name')),'LIKE','%'+_0x2c0974+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x1c79d0(0xb1)]]:'%'+_0x2c0974+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x1c79d0(0x93),(0x0,sequelize_1[_0x1c79d0(0xa0)])(_0x1c79d0(0xac))),_0x1c79d0(0xa7),'%'+_0x2c0974+'%')}]};}_0x526d1e&&(_0x136a96={'createdAt':{[sequelize_1['Op'][_0x1c79d0(0x81)]]:[+(0x0,date_fns_1[_0x1c79d0(0xa5)])((0x0,date_fns_1['parseISO'])(_0x526d1e)),+(0x0,date_fns_1[_0x1c79d0(0xa4)])((0x0,date_fns_1[_0x1c79d0(0x85)])(_0x526d1e))]}});_0x440764&&(_0x136a96={'updatedAt':{[sequelize_1['Op'][_0x1c79d0(0x81)]]:[+(0x0,date_fns_1[_0x1c79d0(0xa5)])((0x0,date_fns_1[_0x1c79d0(0x85)])(_0x440764)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x1c79d0(0x85)])(_0x440764))]}});if(_0x5c81aa==='true'){const _0x5357f8=await(0x0,ShowUserService_1['default'])(_0x3a684e),_0x33d01f=_0x5357f8[_0x1c79d0(0x9a)]['map'](_0x4a77d4=>_0x4a77d4['id']);_0x136a96={[sequelize_1['Op']['or']]:[{'userId':_0x3a684e},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x33d01f,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x1c79d0(0x7f)](_0x3c60b3)&&_0x3c60b3[_0x1c79d0(0x7e)]>0x0){const _0x4ffd21=[];for(let _0x289bb of _0x3c60b3){const _0x625905=await TicketTag_1[_0x1c79d0(0xae)][_0x1c79d0(0x82)]({'where':{'tagId':_0x289bb}});_0x625905&&_0x4ffd21['push'](_0x625905[_0x1c79d0(0x83)](_0x734a38=>_0x734a38['ticketId']));}const _0x4bc286=(0x0,lodash_1[_0x1c79d0(0xaa)])(..._0x4ffd21);_0x136a96={..._0x136a96,'id':{[sequelize_1['Op']['in']]:_0x4bc286}};}if(Array[_0x1c79d0(0x7f)](_0x4fc37f)&&_0x4fc37f['length']>0x0){const _0x4d8a76=[];for(let _0x34f6d6 of _0x4fc37f){const _0x40bb80=await Ticket_1[_0x1c79d0(0xae)][_0x1c79d0(0x82)]({'where':{'userId':_0x34f6d6}});_0x40bb80&&_0x4d8a76[_0x1c79d0(0x87)](_0x40bb80[_0x1c79d0(0x83)](_0x484e3a=>_0x484e3a['id']));}const _0x217ba2=(0x0,lodash_1[_0x1c79d0(0xaa)])(..._0x4d8a76);_0x136a96={..._0x136a96,'id':{[sequelize_1['Op']['in']]:_0x217ba2}};}const _0x25e589=0x28,_0x4ce5e1=_0x25e589*(+pageNumber-0x1);_0x136a96={..._0x136a96,'companyId':_0x52246d};const {count:_0x5aeeff,rows:_0x3e582c}=await Ticket_1[_0x1c79d0(0xae)][_0x1c79d0(0xb7)]({'where':_0x136a96,'include':_0x3e893d,'distinct':!![],'limit':_0x25e589,'offset':_0x4ce5e1,'order':[[_0x1c79d0(0xaf),_0x1c79d0(0xa3)]],'subQuery':![]}),_0x18bbc2=_0x5aeeff>_0x4ce5e1+_0x3e582c[_0x1c79d0(0x7e)];return{'tickets':_0x3e582c,'count':_0x5aeeff,'hasMore':_0x18bbc2};};exports[a525_0x136a28(0xae)]=ListTicketsServiceKanban;