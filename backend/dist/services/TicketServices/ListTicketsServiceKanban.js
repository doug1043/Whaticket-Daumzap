const a525_0x33df2d=a525_0x3a14;(function(_0x26c107,_0x4c2bb2){const _0x2c5f4b=a525_0x3a14,_0x1bbcb0=_0x26c107();while(!![]){try{const _0x1d9773=-parseInt(_0x2c5f4b(0x16b))/0x1*(parseInt(_0x2c5f4b(0x18a))/0x2)+parseInt(_0x2c5f4b(0x16c))/0x3*(-parseInt(_0x2c5f4b(0x190))/0x4)+-parseInt(_0x2c5f4b(0x16d))/0x5+-parseInt(_0x2c5f4b(0x175))/0x6+parseInt(_0x2c5f4b(0x179))/0x7*(-parseInt(_0x2c5f4b(0x15e))/0x8)+-parseInt(_0x2c5f4b(0x161))/0x9*(-parseInt(_0x2c5f4b(0x17f))/0xa)+parseInt(_0x2c5f4b(0x17c))/0xb;if(_0x1d9773===_0x4c2bb2)break;else _0x1bbcb0['push'](_0x1bbcb0['shift']());}catch(_0x5ef904){_0x1bbcb0['push'](_0x1bbcb0['shift']());}}}(a525_0x1133,0x5dcb7));function a525_0x1133(){const _0x2aa3e2=['toLocaleLowerCase','DESC','parseISO','findAll','1rFdhJi','3KAWAjy','2437700fSLjam','apply','email','where','../UserServices/ShowUserService','defineProperty','__importDefault','../../models/Tag','1707966StYVCz','default','date-fns','messages','56jLhBzN','open','ticketId','25921929txkHyO','(((.+)+)+)+$','body','20fcTxGJ','queues','name','LOWER','map','endOfDay','like','push','../../models/Contact','__esModule','updatedAt','397534UxMUlP','LIKE','toString','../../models/User','tags','length','2431112unxjoh','between','search','pending','contact.name','presence','col','number','intersection','true','719328gVVeKd','../../models/Whatsapp','../../models/Message','1465731RDlasI','trim','whatsapp','isArray','startOfDay','color'];a525_0x1133=function(){return _0x2aa3e2;};return a525_0x1133();}const a525_0x3a6bb9=(function(){let _0x1e02dd=!![];return function(_0x96f127,_0x5cbdf5){const _0x458ec3=_0x1e02dd?function(){const _0x2d299a=a525_0x3a14;if(_0x5cbdf5){const _0x4d4e10=_0x5cbdf5[_0x2d299a(0x16e)](_0x96f127,arguments);return _0x5cbdf5=null,_0x4d4e10;}}:function(){};return _0x1e02dd=![],_0x458ec3;};}()),a525_0x42b01c=a525_0x3a6bb9(this,function(){const _0x4763b1=a525_0x3a14;return a525_0x42b01c[_0x4763b1(0x18c)]()[_0x4763b1(0x156)](_0x4763b1(0x17d))[_0x4763b1(0x18c)]()['constructor'](a525_0x42b01c)['search'](_0x4763b1(0x17d));});a525_0x42b01c();'use strict';var __importDefault=this&&this[a525_0x33df2d(0x173)]||function(_0x3de704){const _0x277019=a525_0x33df2d;return _0x3de704&&_0x3de704[_0x277019(0x188)]?_0x3de704:{'default':_0x3de704};};Object[a525_0x33df2d(0x172)](exports,'__esModule',{'value':!![]});const sequelize_1=require('sequelize'),date_fns_1=require(a525_0x33df2d(0x177)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a525_0x33df2d(0x187))),Message_1=__importDefault(require(a525_0x33df2d(0x160))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a525_0x33df2d(0x18d))),ShowUserService_1=__importDefault(require(a525_0x33df2d(0x171))),Tag_1=__importDefault(require(a525_0x33df2d(0x174))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require(a525_0x33df2d(0x15f))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x3c4817,tags:_0x4b19c7,users:_0x5eb630,status:_0x4635da,date:_0x22e566,updatedAt:_0x4dc8e5,showAll:_0x1fb859,userId:_0x1ab24b,withUnreadMessages:_0x517317,companyId:_0x34bfac})=>{const _0x3268bf=a525_0x33df2d;let _0x357cb6={[sequelize_1['Op']['or']]:[{'userId':_0x1ab24b},{'status':_0x3268bf(0x157)}],'queueId':{[sequelize_1['Op']['or']]:[_0x3c4817,null]}},_0x3d9d10;_0x3d9d10=[{'model':Contact_1['default'],'as':'contact','attributes':['id',_0x3268bf(0x181),_0x3268bf(0x15b),_0x3268bf(0x16f),_0x3268bf(0x159)]},{'model':Queue_1['default'],'as':'queue','attributes':['id',_0x3268bf(0x181),_0x3268bf(0x166)]},{'model':User_1[_0x3268bf(0x176)],'as':'user','attributes':['id',_0x3268bf(0x181)]},{'model':Tag_1[_0x3268bf(0x176)],'as':_0x3268bf(0x18e),'attributes':['id','name',_0x3268bf(0x166)]},{'model':Whatsapp_1[_0x3268bf(0x176)],'as':_0x3268bf(0x163),'attributes':['name']}];_0x1fb859===_0x3268bf(0x15d)&&(_0x357cb6={'queueId':{[sequelize_1['Op']['or']]:[_0x3c4817,null]},'userId':_0x1ab24b});_0x357cb6={..._0x357cb6,'status':{[sequelize_1['Op']['or']]:[_0x3268bf(0x157),_0x3268bf(0x17a)]}};if(searchParam){const _0x1c1254=searchParam[_0x3268bf(0x167)]()[_0x3268bf(0x162)]();_0x3d9d10=[..._0x3d9d10,{'model':Message_1[_0x3268bf(0x176)],'as':_0x3268bf(0x178),'attributes':['id',_0x3268bf(0x17e)],'where':{'body':(0x0,sequelize_1[_0x3268bf(0x170)])((0x0,sequelize_1['fn'])(_0x3268bf(0x182),(0x0,sequelize_1[_0x3268bf(0x15a)])(_0x3268bf(0x17e))),'LIKE','%'+_0x1c1254+'%')},'required':![],'duplicating':![]}],_0x357cb6={..._0x357cb6,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x3268bf(0x170)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['col'])(_0x3268bf(0x158))),'LIKE','%'+_0x1c1254+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x3268bf(0x185)]]:'%'+_0x1c1254+'%'}},{'$message.body$':(0x0,sequelize_1[_0x3268bf(0x170)])((0x0,sequelize_1['fn'])(_0x3268bf(0x182),(0x0,sequelize_1[_0x3268bf(0x15a)])(_0x3268bf(0x17e))),_0x3268bf(0x18b),'%'+_0x1c1254+'%')}]};}_0x22e566&&(_0x357cb6={'createdAt':{[sequelize_1['Op'][_0x3268bf(0x155)]]:[+(0x0,date_fns_1[_0x3268bf(0x165)])((0x0,date_fns_1['parseISO'])(_0x22e566)),+(0x0,date_fns_1[_0x3268bf(0x184)])((0x0,date_fns_1[_0x3268bf(0x169)])(_0x22e566))]}});_0x4dc8e5&&(_0x357cb6={'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x3268bf(0x169)])(_0x4dc8e5)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x3268bf(0x169)])(_0x4dc8e5))]}});if(_0x517317===_0x3268bf(0x15d)){const _0x3e9ae3=await(0x0,ShowUserService_1[_0x3268bf(0x176)])(_0x1ab24b),_0x469992=_0x3e9ae3[_0x3268bf(0x180)][_0x3268bf(0x183)](_0x113bda=>_0x113bda['id']);_0x357cb6={[sequelize_1['Op']['or']]:[{'userId':_0x1ab24b},{'status':_0x3268bf(0x157)}],'queueId':{[sequelize_1['Op']['or']]:[_0x469992,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x3268bf(0x164)](_0x4b19c7)&&_0x4b19c7[_0x3268bf(0x18f)]>0x0){const _0x1a2eed=[];for(let _0x5091c4 of _0x4b19c7){const _0x17c160=await TicketTag_1[_0x3268bf(0x176)]['findAll']({'where':{'tagId':_0x5091c4}});_0x17c160&&_0x1a2eed[_0x3268bf(0x186)](_0x17c160[_0x3268bf(0x183)](_0x5ad11c=>_0x5ad11c[_0x3268bf(0x17b)]));}const _0x4ba2dc=(0x0,lodash_1['intersection'])(..._0x1a2eed);_0x357cb6={..._0x357cb6,'id':{[sequelize_1['Op']['in']]:_0x4ba2dc}};}if(Array[_0x3268bf(0x164)](_0x5eb630)&&_0x5eb630[_0x3268bf(0x18f)]>0x0){const _0x5268b0=[];for(let _0x375c30 of _0x5eb630){const _0x5cb82a=await Ticket_1[_0x3268bf(0x176)][_0x3268bf(0x16a)]({'where':{'userId':_0x375c30}});_0x5cb82a&&_0x5268b0[_0x3268bf(0x186)](_0x5cb82a['map'](_0x10de48=>_0x10de48['id']));}const _0x9656fa=(0x0,lodash_1[_0x3268bf(0x15c)])(..._0x5268b0);_0x357cb6={..._0x357cb6,'id':{[sequelize_1['Op']['in']]:_0x9656fa}};}const _0x34000a=0x28,_0x40794e=_0x34000a*(+pageNumber-0x1);_0x357cb6={..._0x357cb6,'companyId':_0x34bfac};const {count:_0x5b1ca2,rows:_0x1fb7b6}=await Ticket_1[_0x3268bf(0x176)]['findAndCountAll']({'where':_0x357cb6,'include':_0x3d9d10,'distinct':!![],'limit':_0x34000a,'offset':_0x40794e,'order':[[_0x3268bf(0x189),_0x3268bf(0x168)]],'subQuery':![]}),_0x18d584=_0x5b1ca2>_0x40794e+_0x1fb7b6[_0x3268bf(0x18f)];return{'tickets':_0x1fb7b6,'count':_0x5b1ca2,'hasMore':_0x18d584};};function a525_0x3a14(_0x46294a,_0x7b7b7){const _0x15a657=a525_0x1133();return a525_0x3a14=function(_0x42b01c,_0x3a6bb9){_0x42b01c=_0x42b01c-0x155;let _0x1133d8=_0x15a657[_0x42b01c];return _0x1133d8;},a525_0x3a14(_0x46294a,_0x7b7b7);}exports['default']=ListTicketsServiceKanban;