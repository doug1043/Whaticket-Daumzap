const a528_0x43360e=a528_0x579c;(function(_0x2530b4,_0x465e78){const _0x5603cd=a528_0x579c,_0x61f91d=_0x2530b4();while(!![]){try{const _0x828817=-parseInt(_0x5603cd(0xef))/0x1+-parseInt(_0x5603cd(0xfa))/0x2+-parseInt(_0x5603cd(0xe0))/0x3+parseInt(_0x5603cd(0xcc))/0x4*(parseInt(_0x5603cd(0xc3))/0x5)+parseInt(_0x5603cd(0xf4))/0x6*(-parseInt(_0x5603cd(0xcd))/0x7)+parseInt(_0x5603cd(0xf6))/0x8+-parseInt(_0x5603cd(0xf5))/0x9*(-parseInt(_0x5603cd(0xc6))/0xa);if(_0x828817===_0x465e78)break;else _0x61f91d['push'](_0x61f91d['shift']());}catch(_0x9f22d0){_0x61f91d['push'](_0x61f91d['shift']());}}}(a528_0x372f,0x1955c));const a528_0x502c8e=(function(){let _0x5e7f4a=!![];return function(_0x2bdc94,_0x526ade){const _0x55894d=_0x5e7f4a?function(){const _0x46e3e6=a528_0x579c;if(_0x526ade){const _0x1fa1b7=_0x526ade[_0x46e3e6(0xe4)](_0x2bdc94,arguments);return _0x526ade=null,_0x1fa1b7;}}:function(){};return _0x5e7f4a=![],_0x55894d;};}()),a528_0x5a402f=a528_0x502c8e(this,function(){const _0x3cf369=a528_0x579c;return a528_0x5a402f[_0x3cf369(0xfb)]()['search']('(((.+)+)+)+$')[_0x3cf369(0xfb)]()[_0x3cf369(0xf3)](a528_0x5a402f)[_0x3cf369(0xf2)]('(((.+)+)+)+$');});function a528_0x372f(){const _0x30fa12=['LOWER','../../models/User','like','messages','whatsapp','__importDefault','384807ulkUZQ','map','presence','ticketId','apply','findAndCountAll','contact.name','endOfDay','findAll','number','lodash','queues','../../models/Ticket','startOfDay','../../models/TicketTag','177261iMrboe','__esModule','date-fns','search','constructor','228xFMEOB','45jRZYLQ','231296xZBGtN','length','updatedAt','email','235332EbGTKa','toString','queue','true','push','user','4595aVJjUb','where','../../models/Contact','1035550gGzXOr','toLocaleLowerCase','color','parseISO','col','contact','436hekYUZ','22085HdskGy','default','LIKE','pending','name','trim','open','../../models/Message','intersection','body','isArray','../../models/Queue','defineProperty'];a528_0x372f=function(){return _0x30fa12;};return a528_0x372f();}a528_0x5a402f();'use strict';var __importDefault=this&&this[a528_0x43360e(0xdf)]||function(_0x327f44){return _0x327f44&&_0x327f44['__esModule']?_0x327f44:{'default':_0x327f44};};function a528_0x579c(_0x284c02,_0x4689dd){const _0xb1891b=a528_0x372f();return a528_0x579c=function(_0x5a402f,_0x502c8e){_0x5a402f=_0x5a402f-0xc3;let _0x372f7b=_0xb1891b[_0x5a402f];return _0x372f7b;},a528_0x579c(_0x284c02,_0x4689dd);}Object[a528_0x43360e(0xd9)](exports,a528_0x43360e(0xf0),{'value':!![]});const sequelize_1=require('sequelize'),date_fns_1=require(a528_0x43360e(0xf1)),Ticket_1=__importDefault(require(a528_0x43360e(0xec))),Contact_1=__importDefault(require(a528_0x43360e(0xc5))),Message_1=__importDefault(require(a528_0x43360e(0xd4))),Queue_1=__importDefault(require(a528_0x43360e(0xd8))),User_1=__importDefault(require(a528_0x43360e(0xdb))),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a528_0x43360e(0xee))),lodash_1=require(a528_0x43360e(0xea)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x2868c0,tags:_0xde71d6,users:_0x1cdb9f,status:_0x5b1307,date:_0x498093,updatedAt:_0x368b2d,showAll:_0x2b787e,userId:_0xb0123b,withUnreadMessages:_0x32a9f5,companyId:_0xa294e})=>{const _0x2409d8=a528_0x43360e;let _0x14bf09={[sequelize_1['Op']['or']]:[{'userId':_0xb0123b},{'status':_0x2409d8(0xd0)}],'queueId':{[sequelize_1['Op']['or']]:[_0x2868c0,null]}},_0x16aa38;_0x16aa38=[{'model':Contact_1[_0x2409d8(0xce)],'as':_0x2409d8(0xcb),'attributes':['id',_0x2409d8(0xd1),_0x2409d8(0xe9),_0x2409d8(0xf9),_0x2409d8(0xe2)]},{'model':Queue_1[_0x2409d8(0xce)],'as':_0x2409d8(0xfc),'attributes':['id','name',_0x2409d8(0xc8)]},{'model':User_1[_0x2409d8(0xce)],'as':_0x2409d8(0xff),'attributes':['id',_0x2409d8(0xd1)]},{'model':Tag_1[_0x2409d8(0xce)],'as':'tags','attributes':['id',_0x2409d8(0xd1),_0x2409d8(0xc8)]},{'model':Whatsapp_1['default'],'as':_0x2409d8(0xde),'attributes':[_0x2409d8(0xd1)]}];_0x2b787e===_0x2409d8(0xfd)&&(_0x14bf09={'queueId':{[sequelize_1['Op']['or']]:[_0x2868c0,null]},'userId':_0xb0123b});_0x14bf09={..._0x14bf09,'status':{[sequelize_1['Op']['or']]:[_0x2409d8(0xd0),_0x2409d8(0xd3)]}};if(searchParam){const _0x492e14=searchParam[_0x2409d8(0xc7)]()[_0x2409d8(0xd2)]();_0x16aa38=[..._0x16aa38,{'model':Message_1[_0x2409d8(0xce)],'as':_0x2409d8(0xdd),'attributes':['id',_0x2409d8(0xd6)],'where':{'body':(0x0,sequelize_1[_0x2409d8(0xc4)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['col'])(_0x2409d8(0xd6))),'LIKE','%'+_0x492e14+'%')},'required':![],'duplicating':![]}],_0x14bf09={..._0x14bf09,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x2409d8(0xc4)])((0x0,sequelize_1['fn'])(_0x2409d8(0xda),(0x0,sequelize_1[_0x2409d8(0xca)])(_0x2409d8(0xe6))),_0x2409d8(0xcf),'%'+_0x492e14+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x2409d8(0xdc)]]:'%'+_0x492e14+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x2409d8(0xca)])('body')),'LIKE','%'+_0x492e14+'%')}]};}_0x498093&&(_0x14bf09={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x2409d8(0xed)])((0x0,date_fns_1['parseISO'])(_0x498093)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x2409d8(0xc9)])(_0x498093))]}});_0x368b2d&&(_0x14bf09={'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x2409d8(0xed)])((0x0,date_fns_1[_0x2409d8(0xc9)])(_0x368b2d)),+(0x0,date_fns_1[_0x2409d8(0xe7)])((0x0,date_fns_1[_0x2409d8(0xc9)])(_0x368b2d))]}});if(_0x32a9f5===_0x2409d8(0xfd)){const _0x4f81d2=await(0x0,ShowUserService_1[_0x2409d8(0xce)])(_0xb0123b),_0x2c1016=_0x4f81d2[_0x2409d8(0xeb)][_0x2409d8(0xe1)](_0x55fbf7=>_0x55fbf7['id']);_0x14bf09={[sequelize_1['Op']['or']]:[{'userId':_0xb0123b},{'status':_0x2409d8(0xd0)}],'queueId':{[sequelize_1['Op']['or']]:[_0x2c1016,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x2409d8(0xd7)](_0xde71d6)&&_0xde71d6[_0x2409d8(0xf7)]>0x0){const _0x30fc51=[];for(let _0x3e20a8 of _0xde71d6){const _0xa88ff5=await TicketTag_1['default'][_0x2409d8(0xe8)]({'where':{'tagId':_0x3e20a8}});_0xa88ff5&&_0x30fc51[_0x2409d8(0xfe)](_0xa88ff5[_0x2409d8(0xe1)](_0xa91b41=>_0xa91b41[_0x2409d8(0xe3)]));}const _0x2f83f7=(0x0,lodash_1['intersection'])(..._0x30fc51);_0x14bf09={..._0x14bf09,'id':{[sequelize_1['Op']['in']]:_0x2f83f7}};}if(Array[_0x2409d8(0xd7)](_0x1cdb9f)&&_0x1cdb9f[_0x2409d8(0xf7)]>0x0){const _0x1cdced=[];for(let _0x188272 of _0x1cdb9f){const _0x193761=await Ticket_1[_0x2409d8(0xce)][_0x2409d8(0xe8)]({'where':{'userId':_0x188272}});_0x193761&&_0x1cdced[_0x2409d8(0xfe)](_0x193761[_0x2409d8(0xe1)](_0x1847c1=>_0x1847c1['id']));}const _0x59a58d=(0x0,lodash_1[_0x2409d8(0xd5)])(..._0x1cdced);_0x14bf09={..._0x14bf09,'id':{[sequelize_1['Op']['in']]:_0x59a58d}};}const _0x3d3e54=0x28,_0x1c32c1=_0x3d3e54*(+pageNumber-0x1);_0x14bf09={..._0x14bf09,'companyId':_0xa294e};const {count:_0x474056,rows:_0x4334f2}=await Ticket_1[_0x2409d8(0xce)][_0x2409d8(0xe5)]({'where':_0x14bf09,'include':_0x16aa38,'distinct':!![],'limit':_0x3d3e54,'offset':_0x1c32c1,'order':[[_0x2409d8(0xf8),'DESC']],'subQuery':![]}),_0x3650f4=_0x474056>_0x1c32c1+_0x4334f2[_0x2409d8(0xf7)];return{'tickets':_0x4334f2,'count':_0x474056,'hasMore':_0x3650f4};};exports['default']=ListTicketsServiceKanban;