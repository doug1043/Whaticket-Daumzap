const a559_0x48f04b=a559_0x5181;(function(_0x22d235,_0x370bb4){const _0x11758f=a559_0x5181,_0x324e28=_0x22d235();while(!![]){try{const _0x5c79ae=-parseInt(_0x11758f(0x92))/0x1+parseInt(_0x11758f(0x86))/0x2+-parseInt(_0x11758f(0x94))/0x3+-parseInt(_0x11758f(0xa9))/0x4+-parseInt(_0x11758f(0x99))/0x5*(parseInt(_0x11758f(0x8b))/0x6)+-parseInt(_0x11758f(0x9d))/0x7*(-parseInt(_0x11758f(0xaf))/0x8)+-parseInt(_0x11758f(0x9c))/0x9*(-parseInt(_0x11758f(0x7e))/0xa);if(_0x5c79ae===_0x370bb4)break;else _0x324e28['push'](_0x324e28['shift']());}catch(_0x4c0240){_0x324e28['push'](_0x324e28['shift']());}}}(a559_0x2be1,0x626c8));const a559_0x19df68=(function(){let _0x3d305d=!![];return function(_0x399dbb,_0x5436bc){const _0xc2a40=_0x3d305d?function(){const _0x3293c1=a559_0x5181;if(_0x5436bc){const _0x499871=_0x5436bc[_0x3293c1(0x7c)](_0x399dbb,arguments);return _0x5436bc=null,_0x499871;}}:function(){};return _0x3d305d=![],_0xc2a40;};}()),a559_0x2e9938=a559_0x19df68(this,function(){const _0x504862=a559_0x5181;return a559_0x2e9938['toString']()['search'](_0x504862(0x82))[_0x504862(0x80)]()[_0x504862(0x90)](a559_0x2e9938)[_0x504862(0x8c)]('(((.+)+)+)+$');});a559_0x2e9938();'use strict';var __importDefault=this&&this[a559_0x48f04b(0x75)]||function(_0x59ea27){return _0x59ea27&&_0x59ea27['__esModule']?_0x59ea27:{'default':_0x59ea27};};Object[a559_0x48f04b(0x93)](exports,'__esModule',{'value':!![]});function a559_0x5181(_0x5e49cf,_0x1643d3){const _0x6d9417=a559_0x2be1();return a559_0x5181=function(_0x2e9938,_0x19df68){_0x2e9938=_0x2e9938-0x72;let _0x2be1bf=_0x6d9417[_0x2e9938];return _0x2be1bf;},a559_0x5181(_0x5e49cf,_0x1643d3);}function a559_0x2be1(){const _0x3c357a=['date-fns','between','../../models/TicketTag','__importDefault','../../models/Queue','color','email','../../models/Ticket','presence','contact.name','apply','sequelize','861710iIwXnA','body','toString','true','(((.+)+)+)+$','pending','../../models/User','updatedAt','407486JNXVTL','contact','LIKE','LOWER','startOfDay','1884rCTyqc','search','length','../../models/Contact','messages','constructor','../../models/Whatsapp','569202Ncjtgp','defineProperty','892743mgAfzh','col','where','../../models/Tag','../UserServices/ShowUserService','10390GtMlAm','whatsapp','findAll','207xTLlQw','1631vxRiBV','user','queue','intersection','number','isArray','findAndCountAll','map','endOfDay','default','parseISO','open','1968252raGyLK','name','lodash','toLocaleLowerCase','push','like','7856PnYgJG','tags','trim'];a559_0x2be1=function(){return _0x3c357a;};return a559_0x2be1();}const sequelize_1=require(a559_0x48f04b(0x7d)),date_fns_1=require(a559_0x48f04b(0x72)),Ticket_1=__importDefault(require(a559_0x48f04b(0x79))),Contact_1=__importDefault(require(a559_0x48f04b(0x8e))),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require(a559_0x48f04b(0x76))),User_1=__importDefault(require(a559_0x48f04b(0x84))),ShowUserService_1=__importDefault(require(a559_0x48f04b(0x98))),Tag_1=__importDefault(require(a559_0x48f04b(0x97))),TicketTag_1=__importDefault(require(a559_0x48f04b(0x74))),lodash_1=require(a559_0x48f04b(0xab)),Whatsapp_1=__importDefault(require(a559_0x48f04b(0x91))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x5573c7,tags:_0x529ecb,users:_0x2c78bb,status:_0x596d7e,date:_0x2dacbc,updatedAt:_0x1d9da0,showAll:_0x121bb4,userId:_0x49f381,withUnreadMessages:_0x4cdc8b,companyId:_0xfbfa5c})=>{const _0x244d87=a559_0x48f04b;let _0x2607aa={[sequelize_1['Op']['or']]:[{'userId':_0x49f381},{'status':_0x244d87(0x83)}],'queueId':{[sequelize_1['Op']['or']]:[_0x5573c7,null]}},_0x2d5462;_0x2d5462=[{'model':Contact_1[_0x244d87(0xa6)],'as':_0x244d87(0x87),'attributes':['id',_0x244d87(0xaa),_0x244d87(0xa1),_0x244d87(0x78),_0x244d87(0x7a)]},{'model':Queue_1[_0x244d87(0xa6)],'as':_0x244d87(0x9f),'attributes':['id','name',_0x244d87(0x77)]},{'model':User_1[_0x244d87(0xa6)],'as':_0x244d87(0x9e),'attributes':['id',_0x244d87(0xaa)]},{'model':Tag_1[_0x244d87(0xa6)],'as':_0x244d87(0xb0),'attributes':['id',_0x244d87(0xaa),_0x244d87(0x77)]},{'model':Whatsapp_1[_0x244d87(0xa6)],'as':_0x244d87(0x9a),'attributes':[_0x244d87(0xaa)]}];_0x121bb4===_0x244d87(0x81)&&(_0x2607aa={'queueId':{[sequelize_1['Op']['or']]:[_0x5573c7,null]},'userId':_0x49f381});_0x2607aa={..._0x2607aa,'status':{[sequelize_1['Op']['or']]:[_0x244d87(0x83),_0x244d87(0xa8)]}};if(searchParam){const _0x4d9502=searchParam[_0x244d87(0xac)]()[_0x244d87(0xb1)]();_0x2d5462=[..._0x2d5462,{'model':Message_1[_0x244d87(0xa6)],'as':_0x244d87(0x8f),'attributes':['id',_0x244d87(0x7f)],'where':{'body':(0x0,sequelize_1[_0x244d87(0x96)])((0x0,sequelize_1['fn'])(_0x244d87(0x89),(0x0,sequelize_1['col'])(_0x244d87(0x7f))),'LIKE','%'+_0x4d9502+'%')},'required':![],'duplicating':![]}],_0x2607aa={..._0x2607aa,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x244d87(0x89),(0x0,sequelize_1[_0x244d87(0x95)])(_0x244d87(0x7b))),'LIKE','%'+_0x4d9502+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x244d87(0xae)]]:'%'+_0x4d9502+'%'}},{'$message.body$':(0x0,sequelize_1[_0x244d87(0x96)])((0x0,sequelize_1['fn'])(_0x244d87(0x89),(0x0,sequelize_1[_0x244d87(0x95)])(_0x244d87(0x7f))),_0x244d87(0x88),'%'+_0x4d9502+'%')}]};}_0x2dacbc&&(_0x2607aa={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x244d87(0x8a)])((0x0,date_fns_1[_0x244d87(0xa7)])(_0x2dacbc)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x244d87(0xa7)])(_0x2dacbc))]}});_0x1d9da0&&(_0x2607aa={'updatedAt':{[sequelize_1['Op'][_0x244d87(0x73)]]:[+(0x0,date_fns_1[_0x244d87(0x8a)])((0x0,date_fns_1[_0x244d87(0xa7)])(_0x1d9da0)),+(0x0,date_fns_1[_0x244d87(0xa5)])((0x0,date_fns_1[_0x244d87(0xa7)])(_0x1d9da0))]}});if(_0x4cdc8b==='true'){const _0xd641d=await(0x0,ShowUserService_1[_0x244d87(0xa6)])(_0x49f381),_0x47491b=_0xd641d['queues'][_0x244d87(0xa4)](_0x3f8610=>_0x3f8610['id']);_0x2607aa={[sequelize_1['Op']['or']]:[{'userId':_0x49f381},{'status':_0x244d87(0x83)}],'queueId':{[sequelize_1['Op']['or']]:[_0x47491b,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x244d87(0xa2)](_0x529ecb)&&_0x529ecb[_0x244d87(0x8d)]>0x0){const _0x321198=[];for(let _0xa567f8 of _0x529ecb){const _0x35243b=await TicketTag_1[_0x244d87(0xa6)][_0x244d87(0x9b)]({'where':{'tagId':_0xa567f8}});_0x35243b&&_0x321198[_0x244d87(0xad)](_0x35243b['map'](_0x4133ab=>_0x4133ab['ticketId']));}const _0x51ed68=(0x0,lodash_1['intersection'])(..._0x321198);_0x2607aa={..._0x2607aa,'id':{[sequelize_1['Op']['in']]:_0x51ed68}};}if(Array[_0x244d87(0xa2)](_0x2c78bb)&&_0x2c78bb[_0x244d87(0x8d)]>0x0){const _0x5cb8ea=[];for(let _0x1cf004 of _0x2c78bb){const _0x144a47=await Ticket_1[_0x244d87(0xa6)]['findAll']({'where':{'userId':_0x1cf004}});_0x144a47&&_0x5cb8ea[_0x244d87(0xad)](_0x144a47[_0x244d87(0xa4)](_0x499a92=>_0x499a92['id']));}const _0x2b2379=(0x0,lodash_1[_0x244d87(0xa0)])(..._0x5cb8ea);_0x2607aa={..._0x2607aa,'id':{[sequelize_1['Op']['in']]:_0x2b2379}};}const _0x72060f=0x28,_0x1b50de=_0x72060f*(+pageNumber-0x1);_0x2607aa={..._0x2607aa,'companyId':_0xfbfa5c};const {count:_0x320e74,rows:_0x18d237}=await Ticket_1['default'][_0x244d87(0xa3)]({'where':_0x2607aa,'include':_0x2d5462,'distinct':!![],'limit':_0x72060f,'offset':_0x1b50de,'order':[[_0x244d87(0x85),'DESC']],'subQuery':![]}),_0x7840d9=_0x320e74>_0x1b50de+_0x18d237[_0x244d87(0x8d)];return{'tickets':_0x18d237,'count':_0x320e74,'hasMore':_0x7840d9};};exports['default']=ListTicketsServiceKanban;