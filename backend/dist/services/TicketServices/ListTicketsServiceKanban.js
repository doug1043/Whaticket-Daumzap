const a526_0x180b79=a526_0x14ea;(function(_0x59c682,_0x2c5967){const _0x545378=a526_0x14ea,_0x319a1d=_0x59c682();while(!![]){try{const _0xf0181a=-parseInt(_0x545378(0x16f))/0x1*(parseInt(_0x545378(0x181))/0x2)+-parseInt(_0x545378(0x18c))/0x3*(-parseInt(_0x545378(0x183))/0x4)+parseInt(_0x545378(0x154))/0x5*(parseInt(_0x545378(0x171))/0x6)+parseInt(_0x545378(0x174))/0x7+-parseInt(_0x545378(0x167))/0x8*(parseInt(_0x545378(0x15f))/0x9)+parseInt(_0x545378(0x177))/0xa+-parseInt(_0x545378(0x158))/0xb;if(_0xf0181a===_0x2c5967)break;else _0x319a1d['push'](_0x319a1d['shift']());}catch(_0x122e82){_0x319a1d['push'](_0x319a1d['shift']());}}}(a526_0x49a5,0x695a6));function a526_0x14ea(_0x578c8a,_0x3a3446){const _0x4258f8=a526_0x49a5();return a526_0x14ea=function(_0x38a537,_0x1d15bc){_0x38a537=_0x38a537-0x153;let _0x49a560=_0x4258f8[_0x38a537];return _0x49a560;},a526_0x14ea(_0x578c8a,_0x3a3446);}const a526_0x1d15bc=(function(){let _0x1ed0a3=!![];return function(_0x2afe32,_0xd30050){const _0x50b0b1=_0x1ed0a3?function(){const _0x3fe224=a526_0x14ea;if(_0xd30050){const _0x2dbb07=_0xd30050[_0x3fe224(0x162)](_0x2afe32,arguments);return _0xd30050=null,_0x2dbb07;}}:function(){};return _0x1ed0a3=![],_0x50b0b1;};}()),a526_0x38a537=a526_0x1d15bc(this,function(){const _0x4105b6=a526_0x14ea;return a526_0x38a537[_0x4105b6(0x165)]()[_0x4105b6(0x16b)](_0x4105b6(0x186))[_0x4105b6(0x165)]()[_0x4105b6(0x179)](a526_0x38a537)[_0x4105b6(0x16b)](_0x4105b6(0x186));});a526_0x38a537();'use strict';var __importDefault=this&&this[a526_0x180b79(0x18b)]||function(_0x3e07cb){return _0x3e07cb&&_0x3e07cb['__esModule']?_0x3e07cb:{'default':_0x3e07cb};};Object[a526_0x180b79(0x153)](exports,a526_0x180b79(0x168),{'value':!![]});const sequelize_1=require(a526_0x180b79(0x185)),date_fns_1=require(a526_0x180b79(0x187)),Ticket_1=__importDefault(require(a526_0x180b79(0x184))),Contact_1=__importDefault(require(a526_0x180b79(0x156))),Message_1=__importDefault(require(a526_0x180b79(0x166))),Queue_1=__importDefault(require(a526_0x180b79(0x15e))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require(a526_0x180b79(0x16a))),TicketTag_1=__importDefault(require(a526_0x180b79(0x189))),lodash_1=require(a526_0x180b79(0x161)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x200fba,tags:_0x48e247,users:_0x32e96c,status:_0xc3a671,date:_0x4b3607,updatedAt:_0x572a3,showAll:_0x60ba92,userId:_0x1ff347,withUnreadMessages:_0x29c16e,companyId:_0x293ff4})=>{const _0x580bc5=a526_0x180b79;let _0x39cf98={[sequelize_1['Op']['or']]:[{'userId':_0x1ff347},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x200fba,null]}},_0x1b024a;_0x1b024a=[{'model':Contact_1[_0x580bc5(0x176)],'as':_0x580bc5(0x15a),'attributes':['id',_0x580bc5(0x190),_0x580bc5(0x164),_0x580bc5(0x15b),'presence']},{'model':Queue_1['default'],'as':_0x580bc5(0x15d),'attributes':['id',_0x580bc5(0x190),_0x580bc5(0x175)]},{'model':User_1[_0x580bc5(0x176)],'as':_0x580bc5(0x17e),'attributes':['id',_0x580bc5(0x190)]},{'model':Tag_1[_0x580bc5(0x176)],'as':'tags','attributes':['id',_0x580bc5(0x190),_0x580bc5(0x175)]},{'model':Whatsapp_1[_0x580bc5(0x176)],'as':_0x580bc5(0x15c),'attributes':[_0x580bc5(0x190)]}];_0x60ba92===_0x580bc5(0x17f)&&(_0x39cf98={'queueId':{[sequelize_1['Op']['or']]:[_0x200fba,null]},'userId':_0x1ff347});_0x39cf98={..._0x39cf98,'status':{[sequelize_1['Op']['or']]:[_0x580bc5(0x172),_0x580bc5(0x18a)]}};if(searchParam){const _0x4e5369=searchParam[_0x580bc5(0x178)]()[_0x580bc5(0x18e)]();_0x1b024a=[..._0x1b024a,{'model':Message_1['default'],'as':'messages','attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x580bc5(0x16e)])((0x0,sequelize_1['fn'])(_0x580bc5(0x155),(0x0,sequelize_1[_0x580bc5(0x191)])(_0x580bc5(0x160))),_0x580bc5(0x16c),'%'+_0x4e5369+'%')},'required':![],'duplicating':![]}],_0x39cf98={..._0x39cf98,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x580bc5(0x16e)])((0x0,sequelize_1['fn'])(_0x580bc5(0x155),(0x0,sequelize_1[_0x580bc5(0x191)])(_0x580bc5(0x173))),_0x580bc5(0x16c),'%'+_0x4e5369+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x4e5369+'%'}},{'$message.body$':(0x0,sequelize_1[_0x580bc5(0x16e)])((0x0,sequelize_1['fn'])(_0x580bc5(0x155),(0x0,sequelize_1[_0x580bc5(0x191)])('body')),_0x580bc5(0x16c),'%'+_0x4e5369+'%')}]};}_0x4b3607&&(_0x39cf98={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x580bc5(0x163)])((0x0,date_fns_1['parseISO'])(_0x4b3607)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x580bc5(0x17c)])(_0x4b3607))]}});_0x572a3&&(_0x39cf98={'updatedAt':{[sequelize_1['Op'][_0x580bc5(0x182)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x580bc5(0x17c)])(_0x572a3)),+(0x0,date_fns_1[_0x580bc5(0x169)])((0x0,date_fns_1['parseISO'])(_0x572a3))]}});if(_0x29c16e===_0x580bc5(0x17f)){const _0x516e0d=await(0x0,ShowUserService_1[_0x580bc5(0x176)])(_0x1ff347),_0x918219=_0x516e0d[_0x580bc5(0x16d)][_0x580bc5(0x17b)](_0x15ec5a=>_0x15ec5a['id']);_0x39cf98={[sequelize_1['Op']['or']]:[{'userId':_0x1ff347},{'status':_0x580bc5(0x172)}],'queueId':{[sequelize_1['Op']['or']]:[_0x918219,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x580bc5(0x188)](_0x48e247)&&_0x48e247[_0x580bc5(0x18f)]>0x0){const _0x3dc1a3=[];for(let _0x2e6d9f of _0x48e247){const _0x7dff25=await TicketTag_1[_0x580bc5(0x176)][_0x580bc5(0x157)]({'where':{'tagId':_0x2e6d9f}});_0x7dff25&&_0x3dc1a3[_0x580bc5(0x159)](_0x7dff25[_0x580bc5(0x17b)](_0x3039b7=>_0x3039b7[_0x580bc5(0x180)]));}const _0xc383cf=(0x0,lodash_1['intersection'])(..._0x3dc1a3);_0x39cf98={..._0x39cf98,'id':{[sequelize_1['Op']['in']]:_0xc383cf}};}if(Array[_0x580bc5(0x188)](_0x32e96c)&&_0x32e96c[_0x580bc5(0x18f)]>0x0){const _0x255f25=[];for(let _0x5b329b of _0x32e96c){const _0x5bb1d8=await Ticket_1[_0x580bc5(0x176)][_0x580bc5(0x157)]({'where':{'userId':_0x5b329b}});_0x5bb1d8&&_0x255f25['push'](_0x5bb1d8[_0x580bc5(0x17b)](_0x58e751=>_0x58e751['id']));}const _0x3f6ac9=(0x0,lodash_1[_0x580bc5(0x17d)])(..._0x255f25);_0x39cf98={..._0x39cf98,'id':{[sequelize_1['Op']['in']]:_0x3f6ac9}};}const _0x4a55bf=0x28,_0x2d8905=_0x4a55bf*(+pageNumber-0x1);_0x39cf98={..._0x39cf98,'companyId':_0x293ff4};const {count:_0x2b589c,rows:_0x5edb70}=await Ticket_1[_0x580bc5(0x176)][_0x580bc5(0x17a)]({'where':_0x39cf98,'include':_0x1b024a,'distinct':!![],'limit':_0x4a55bf,'offset':_0x2d8905,'order':[[_0x580bc5(0x170),_0x580bc5(0x18d)]],'subQuery':![]}),_0xa0b6b0=_0x2b589c>_0x2d8905+_0x5edb70['length'];return{'tickets':_0x5edb70,'count':_0x2b589c,'hasMore':_0xa0b6b0};};exports[a526_0x180b79(0x176)]=ListTicketsServiceKanban;function a526_0x49a5(){const _0x264ece=['open','__importDefault','177594mhITdO','DESC','trim','length','name','col','defineProperty','5WNZNbO','LOWER','../../models/Contact','findAll','3528448ZpCnOj','push','contact','email','whatsapp','queue','../../models/Queue','27FfWdPT','body','lodash','apply','startOfDay','number','toString','../../models/Message','2031968jovMSD','__esModule','endOfDay','../../models/Tag','search','LIKE','queues','where','96275fRSTas','updatedAt','879702gvGrsE','pending','contact.name','3416868hWUorO','color','default','3246380ALSVca','toLocaleLowerCase','constructor','findAndCountAll','map','parseISO','intersection','user','true','ticketId','2tCmdDC','between','44KzxUPG','../../models/Ticket','sequelize','(((.+)+)+)+$','date-fns','isArray','../../models/TicketTag'];a526_0x49a5=function(){return _0x264ece;};return a526_0x49a5();}