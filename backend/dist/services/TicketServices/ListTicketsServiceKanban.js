const a667_0xdbfc2c=a667_0x331b;(function(_0x4d1beb,_0x38890d){const _0x44f7f7=a667_0x331b,_0x18b273=_0x4d1beb();while(!![]){try{const _0x4fd98a=-parseInt(_0x44f7f7(0xb6))/0x1+-parseInt(_0x44f7f7(0xb8))/0x2*(-parseInt(_0x44f7f7(0x89))/0x3)+parseInt(_0x44f7f7(0x9d))/0x4*(-parseInt(_0x44f7f7(0x88))/0x5)+-parseInt(_0x44f7f7(0x81))/0x6+parseInt(_0x44f7f7(0x8e))/0x7*(-parseInt(_0x44f7f7(0xaa))/0x8)+-parseInt(_0x44f7f7(0x97))/0x9+parseInt(_0x44f7f7(0x8a))/0xa;if(_0x4fd98a===_0x38890d)break;else _0x18b273['push'](_0x18b273['shift']());}catch(_0x49212d){_0x18b273['push'](_0x18b273['shift']());}}}(a667_0x2daa,0x252f3));function a667_0x331b(_0x4f3de1,_0x29045d){const _0x52685a=a667_0x2daa();return a667_0x331b=function(_0x30eb7d,_0x35acf){_0x30eb7d=_0x30eb7d-0x7b;let _0x2daa32=_0x52685a[_0x30eb7d];return _0x2daa32;},a667_0x331b(_0x4f3de1,_0x29045d);}function a667_0x2daa(){const _0x9e3b33=['queue','../UserServices/ShowUserService','926946JBPFGw','../../models/Ticket','queues','profile','true','isArray','8fnTpFx','presence','whatsapp','__esModule','../../models/TicketTag','../../models/Message','parseISO','findAll','updatedAt','between','open','../../models/Whatsapp','contact','572568zIUIjr','findAndCountAll','__importDefault','pending','where','(((.+)+)+)+$','tags','col','email','superv','number','startOfDay','177813mGuaNM','../../models/Queue','6754iKOSNc','toString','../../models/Tag','trim','map','constructor','default','DESC','ticketId','883134rTXWFb','endOfDay','LIKE','color','body','like','LOWER','626335ahRAoO','117LvCfvc','7707050LzbJfc','search','toLocaleLowerCase','length','7yZVhAt','contact.name','lodash','../../models/User','intersection','name','admin'];a667_0x2daa=function(){return _0x9e3b33;};return a667_0x2daa();}const a667_0x35acf=(function(){let _0x3f9b9b=!![];return function(_0x135c1b,_0x380488){const _0x17be26=_0x3f9b9b?function(){if(_0x380488){const _0x12ad98=_0x380488['apply'](_0x135c1b,arguments);return _0x380488=null,_0x12ad98;}}:function(){};return _0x3f9b9b=![],_0x17be26;};}()),a667_0x30eb7d=a667_0x35acf(this,function(){const _0x6c31ea=a667_0x331b;return a667_0x30eb7d[_0x6c31ea(0xb9)]()[_0x6c31ea(0x8b)]('(((.+)+)+)+$')[_0x6c31ea(0xb9)]()[_0x6c31ea(0x7d)](a667_0x30eb7d)['search'](_0x6c31ea(0xaf));});a667_0x30eb7d();'use strict';var __importDefault=this&&this[a667_0xdbfc2c(0xac)]||function(_0x1c7f1d){const _0x30f99b=a667_0xdbfc2c;return _0x1c7f1d&&_0x1c7f1d[_0x30f99b(0xa0)]?_0x1c7f1d:{'default':_0x1c7f1d};};Object['defineProperty'](exports,a667_0xdbfc2c(0xa0),{'value':!![]});const sequelize_1=require('sequelize'),date_fns_1=require('date-fns'),Ticket_1=__importDefault(require(a667_0xdbfc2c(0x98))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a667_0xdbfc2c(0xa2))),Queue_1=__importDefault(require(a667_0xdbfc2c(0xb7))),User_1=__importDefault(require(a667_0xdbfc2c(0x91))),ShowUserService_1=__importDefault(require(a667_0xdbfc2c(0x96))),Tag_1=__importDefault(require(a667_0xdbfc2c(0xba))),TicketTag_1=__importDefault(require(a667_0xdbfc2c(0xa1))),lodash_1=require(a667_0xdbfc2c(0x90)),Whatsapp_1=__importDefault(require(a667_0xdbfc2c(0xa8))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x54cf3d,tags:_0x4b7186,users:_0x2c4319,status:_0xaf750a,date:_0x44341d,updatedAt:_0x106e68,showAll:_0x5a6ba7,userId:_0x52f4c7,withUnreadMessages:_0x510d11,companyId:_0x1a39ee})=>{const _0x5dd178=a667_0xdbfc2c,_0x3ee3e4=await(0x0,ShowUserService_1['default'])(_0x52f4c7);let _0x2c4f4e={};if(_0x3ee3e4[_0x5dd178(0x9a)]===_0x5dd178(0x94))_0x2c4f4e={'queueId':{[sequelize_1['Op']['or']]:_0x54cf3d[_0x5dd178(0x8d)]>0x0?[_0x54cf3d,null]:[{[sequelize_1['Op']['ne']]:null},null]}};else{if(_0x3ee3e4[_0x5dd178(0x9a)]===_0x5dd178(0xb3)){const _0x2835d8=await User_1[_0x5dd178(0x7e)][_0x5dd178(0xa4)]({'where':{'companyId':_0x1a39ee,'profile':'admin'},'attributes':['id']}),_0x86c77a=_0x2835d8[_0x5dd178(0x7c)](_0x544af1=>_0x544af1['id']);_0x2c4f4e={'queueId':{[sequelize_1['Op']['or']]:_0x54cf3d['length']>0x0?[_0x54cf3d,null]:[{[sequelize_1['Op']['ne']]:null},null]},[sequelize_1['Op']['or']]:[{'userId':{[sequelize_1['Op']['notIn']]:_0x86c77a}},{'userId':null}]};}else _0x54cf3d[_0x5dd178(0x8d)]===0x0?_0x2c4f4e={'userId':_0x52f4c7,'queueId':null}:_0x2c4f4e={[sequelize_1['Op']['or']]:[{'userId':_0x52f4c7},{'status':_0x5dd178(0xad),'queueId':{[sequelize_1['Op']['in']]:_0x54cf3d}}]};}let _0x2d4792;_0x2d4792=[{'model':Contact_1['default'],'as':_0x5dd178(0xa9),'attributes':['id',_0x5dd178(0x93),_0x5dd178(0xb4),_0x5dd178(0xb2),_0x5dd178(0x9e)]},{'model':Queue_1['default'],'as':_0x5dd178(0x95),'attributes':['id','name',_0x5dd178(0x84)]},{'model':User_1[_0x5dd178(0x7e)],'as':'user','attributes':['id','name']},{'model':Tag_1['default'],'as':_0x5dd178(0xb0),'attributes':['id','name',_0x5dd178(0x84)]},{'model':Whatsapp_1[_0x5dd178(0x7e)],'as':_0x5dd178(0x9f),'attributes':[_0x5dd178(0x93)]}];_0x5a6ba7===_0x5dd178(0x9b)&&(_0x2c4f4e={'queueId':{[sequelize_1['Op']['or']]:[_0x54cf3d,null]},'userId':_0x52f4c7});_0x2c4f4e={..._0x2c4f4e,'status':{[sequelize_1['Op']['or']]:[_0x5dd178(0xad),_0x5dd178(0xa7)]}};if(searchParam){const _0x418c0b=searchParam[_0x5dd178(0x8c)]()[_0x5dd178(0x7b)]();_0x2d4792=[..._0x2d4792,{'model':Message_1[_0x5dd178(0x7e)],'as':'messages','attributes':['id',_0x5dd178(0x85)],'where':{'body':(0x0,sequelize_1[_0x5dd178(0xae)])((0x0,sequelize_1['fn'])(_0x5dd178(0x87),(0x0,sequelize_1['col'])(_0x5dd178(0x85))),'LIKE','%'+_0x418c0b+'%')},'required':![],'duplicating':![]}],_0x2c4f4e={..._0x2c4f4e,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x5dd178(0xae)])((0x0,sequelize_1['fn'])(_0x5dd178(0x87),(0x0,sequelize_1[_0x5dd178(0xb1)])(_0x5dd178(0x8f))),_0x5dd178(0x83),'%'+_0x418c0b+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x5dd178(0x86)]]:'%'+_0x418c0b+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x5dd178(0x87),(0x0,sequelize_1[_0x5dd178(0xb1)])(_0x5dd178(0x85))),_0x5dd178(0x83),'%'+_0x418c0b+'%')}]};}_0x44341d&&(_0x2c4f4e={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x5dd178(0xb5)])((0x0,date_fns_1[_0x5dd178(0xa3)])(_0x44341d)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x5dd178(0xa3)])(_0x44341d))]}});_0x106e68&&(_0x2c4f4e={'updatedAt':{[sequelize_1['Op'][_0x5dd178(0xa6)]]:[+(0x0,date_fns_1[_0x5dd178(0xb5)])((0x0,date_fns_1['parseISO'])(_0x106e68)),+(0x0,date_fns_1[_0x5dd178(0x82)])((0x0,date_fns_1[_0x5dd178(0xa3)])(_0x106e68))]}});if(_0x510d11===_0x5dd178(0x9b)){const _0x1187e1=await(0x0,ShowUserService_1['default'])(_0x52f4c7),_0x1f1312=_0x1187e1[_0x5dd178(0x99)][_0x5dd178(0x7c)](_0x591776=>_0x591776['id']);_0x2c4f4e={[sequelize_1['Op']['or']]:[{'userId':_0x52f4c7},{'status':_0x5dd178(0xad)}],'queueId':{[sequelize_1['Op']['or']]:[_0x1f1312,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x5dd178(0x9c)](_0x4b7186)&&_0x4b7186[_0x5dd178(0x8d)]>0x0){const _0x22f94f=[];for(let _0x18e82a of _0x4b7186){const _0x433f0b=await TicketTag_1['default'][_0x5dd178(0xa4)]({'where':{'tagId':_0x18e82a}});_0x433f0b&&_0x22f94f['push'](_0x433f0b[_0x5dd178(0x7c)](_0x174381=>_0x174381[_0x5dd178(0x80)]));}const _0x36c2e3=(0x0,lodash_1[_0x5dd178(0x92)])(..._0x22f94f);_0x2c4f4e={..._0x2c4f4e,'id':{[sequelize_1['Op']['in']]:_0x36c2e3}};}if(Array[_0x5dd178(0x9c)](_0x2c4319)&&_0x2c4319['length']>0x0){const _0x4f51bf=[];for(let _0x5af288 of _0x2c4319){const _0x3fba4b=await Ticket_1['default'][_0x5dd178(0xa4)]({'where':{'userId':_0x5af288}});_0x3fba4b&&_0x4f51bf['push'](_0x3fba4b[_0x5dd178(0x7c)](_0x5a15ba=>_0x5a15ba['id']));}const _0x4b07ea=(0x0,lodash_1[_0x5dd178(0x92)])(..._0x4f51bf);_0x2c4f4e={..._0x2c4f4e,'id':{[sequelize_1['Op']['in']]:_0x4b07ea}};}const _0x548688=0x28,_0x1ea2c6=_0x548688*(+pageNumber-0x1);_0x2c4f4e={..._0x2c4f4e,'companyId':_0x1a39ee};const {count:_0x63977b,rows:_0x14d2ff}=await Ticket_1['default'][_0x5dd178(0xab)]({'where':_0x2c4f4e,'include':_0x2d4792,'distinct':!![],'limit':_0x548688,'offset':_0x1ea2c6,'order':[[_0x5dd178(0xa5),_0x5dd178(0x7f)]],'subQuery':![]}),_0x1aa84a=_0x63977b>_0x1ea2c6+_0x14d2ff[_0x5dd178(0x8d)];return{'tickets':_0x14d2ff,'count':_0x63977b,'hasMore':_0x1aa84a};};exports[a667_0xdbfc2c(0x7e)]=ListTicketsServiceKanban;