const a527_0x8b6dba=a527_0x1d2c;(function(_0x3c9e96,_0x5491c0){const _0x4919be=a527_0x1d2c,_0xdb91fe=_0x3c9e96();while(!![]){try{const _0x2f2c8b=parseInt(_0x4919be(0xb3))/0x1+parseInt(_0x4919be(0xc1))/0x2+parseInt(_0x4919be(0xca))/0x3*(parseInt(_0x4919be(0xc8))/0x4)+parseInt(_0x4919be(0xc9))/0x5*(-parseInt(_0x4919be(0xaa))/0x6)+-parseInt(_0x4919be(0xba))/0x7+parseInt(_0x4919be(0x9d))/0x8+parseInt(_0x4919be(0xa0))/0x9*(-parseInt(_0x4919be(0x98))/0xa);if(_0x2f2c8b===_0x5491c0)break;else _0xdb91fe['push'](_0xdb91fe['shift']());}catch(_0x3eaffd){_0xdb91fe['push'](_0xdb91fe['shift']());}}}(a527_0x452a,0x74be2));const a527_0x54f0f8=(function(){let _0x45ea6e=!![];return function(_0x4700bf,_0xfc9176){const _0x43ca9e=_0x45ea6e?function(){if(_0xfc9176){const _0x5be790=_0xfc9176['apply'](_0x4700bf,arguments);return _0xfc9176=null,_0x5be790;}}:function(){};return _0x45ea6e=![],_0x43ca9e;};}()),a527_0x3b5060=a527_0x54f0f8(this,function(){const _0x159f79=a527_0x1d2c;return a527_0x3b5060[_0x159f79(0x9e)]()['search']('(((.+)+)+)+$')[_0x159f79(0x9e)]()['constructor'](a527_0x3b5060)['search']('(((.+)+)+)+$');});a527_0x3b5060();'use strict';var __importDefault=this&&this[a527_0x8b6dba(0xc4)]||function(_0x9ad1d0){return _0x9ad1d0&&_0x9ad1d0['__esModule']?_0x9ad1d0:{'default':_0x9ad1d0};};function a527_0x452a(){const _0x1b71b9=['defineProperty','2448408UasWRW','toString','updatedAt','4914AoYgXl','../../models/Ticket','findAll','user','../../models/TicketTag','queues','color','startOfDay','length','between','2639310QDzBeI','date-fns','trim','messages','../../models/User','default','ticketId','tags','body','755791ttnNvo','like','map','../../models/Contact','true','open','lodash','894796cIoZRe','email','intersection','queue','pending','name','isArray','213848xzQdYH','__esModule','col','__importDefault','../UserServices/ShowUserService','parseISO','LIKE','213392XVPPKh','10dPUAcP','45NyZxXx','findAndCountAll','../../models/Whatsapp','push','DESC','8850SFcbeV','LOWER','../../models/Queue','endOfDay'];a527_0x452a=function(){return _0x1b71b9;};return a527_0x452a();}Object[a527_0x8b6dba(0x9c)](exports,a527_0x8b6dba(0xc2),{'value':!![]});function a527_0x1d2c(_0x1d96ca,_0x585cd9){const _0x3de03e=a527_0x452a();return a527_0x1d2c=function(_0x3b5060,_0x54f0f8){_0x3b5060=_0x3b5060-0x97;let _0x452a74=_0x3de03e[_0x3b5060];return _0x452a74;},a527_0x1d2c(_0x1d96ca,_0x585cd9);}const sequelize_1=require('sequelize'),date_fns_1=require(a527_0x8b6dba(0xab)),Ticket_1=__importDefault(require(a527_0x8b6dba(0xa1))),Contact_1=__importDefault(require(a527_0x8b6dba(0xb6))),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require(a527_0x8b6dba(0x9a))),User_1=__importDefault(require(a527_0x8b6dba(0xae))),ShowUserService_1=__importDefault(require(a527_0x8b6dba(0xc5))),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a527_0x8b6dba(0xa4))),lodash_1=require(a527_0x8b6dba(0xb9)),Whatsapp_1=__importDefault(require(a527_0x8b6dba(0xcc))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x55f9a2,tags:_0x4b025a,users:_0x52a336,status:_0x16e316,date:_0x4408fb,updatedAt:_0x459785,showAll:_0x20784f,userId:_0x146489,withUnreadMessages:_0x478fc1,companyId:_0x4e73b6})=>{const _0x3ceb28=a527_0x8b6dba;let _0x2b21d7={[sequelize_1['Op']['or']]:[{'userId':_0x146489},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x55f9a2,null]}},_0xb93c1a;_0xb93c1a=[{'model':Contact_1[_0x3ceb28(0xaf)],'as':'contact','attributes':['id',_0x3ceb28(0xbf),'number',_0x3ceb28(0xbb),'presence']},{'model':Queue_1[_0x3ceb28(0xaf)],'as':_0x3ceb28(0xbd),'attributes':['id',_0x3ceb28(0xbf),'color']},{'model':User_1[_0x3ceb28(0xaf)],'as':_0x3ceb28(0xa3),'attributes':['id',_0x3ceb28(0xbf)]},{'model':Tag_1[_0x3ceb28(0xaf)],'as':_0x3ceb28(0xb1),'attributes':['id',_0x3ceb28(0xbf),_0x3ceb28(0xa6)]},{'model':Whatsapp_1['default'],'as':'whatsapp','attributes':['name']}];_0x20784f===_0x3ceb28(0xb7)&&(_0x2b21d7={'queueId':{[sequelize_1['Op']['or']]:[_0x55f9a2,null]},'userId':_0x146489});_0x2b21d7={..._0x2b21d7,'status':{[sequelize_1['Op']['or']]:['pending',_0x3ceb28(0xb8)]}};if(searchParam){const _0x306d3f=searchParam['toLocaleLowerCase']()[_0x3ceb28(0xac)]();_0xb93c1a=[..._0xb93c1a,{'model':Message_1[_0x3ceb28(0xaf)],'as':_0x3ceb28(0xad),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x3ceb28(0x99),(0x0,sequelize_1[_0x3ceb28(0xc3)])('body')),'LIKE','%'+_0x306d3f+'%')},'required':![],'duplicating':![]}],_0x2b21d7={..._0x2b21d7,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['col'])('contact.name')),'LIKE','%'+_0x306d3f+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x3ceb28(0xb4)]]:'%'+_0x306d3f+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['col'])(_0x3ceb28(0xb2))),_0x3ceb28(0xc7),'%'+_0x306d3f+'%')}]};}_0x4408fb&&(_0x2b21d7={'createdAt':{[sequelize_1['Op'][_0x3ceb28(0xa9)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x3ceb28(0xc6)])(_0x4408fb)),+(0x0,date_fns_1[_0x3ceb28(0x9b)])((0x0,date_fns_1['parseISO'])(_0x4408fb))]}});_0x459785&&(_0x2b21d7={'updatedAt':{[sequelize_1['Op'][_0x3ceb28(0xa9)]]:[+(0x0,date_fns_1[_0x3ceb28(0xa7)])((0x0,date_fns_1[_0x3ceb28(0xc6)])(_0x459785)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1['parseISO'])(_0x459785))]}});if(_0x478fc1===_0x3ceb28(0xb7)){const _0x561ae7=await(0x0,ShowUserService_1[_0x3ceb28(0xaf)])(_0x146489),_0x21d573=_0x561ae7[_0x3ceb28(0xa5)][_0x3ceb28(0xb5)](_0x253ec8=>_0x253ec8['id']);_0x2b21d7={[sequelize_1['Op']['or']]:[{'userId':_0x146489},{'status':_0x3ceb28(0xbe)}],'queueId':{[sequelize_1['Op']['or']]:[_0x21d573,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x3ceb28(0xc0)](_0x4b025a)&&_0x4b025a[_0x3ceb28(0xa8)]>0x0){const _0x12f5bf=[];for(let _0x537313 of _0x4b025a){const _0x115328=await TicketTag_1['default'][_0x3ceb28(0xa2)]({'where':{'tagId':_0x537313}});_0x115328&&_0x12f5bf[_0x3ceb28(0xcd)](_0x115328[_0x3ceb28(0xb5)](_0x46f79e=>_0x46f79e[_0x3ceb28(0xb0)]));}const _0xf01658=(0x0,lodash_1[_0x3ceb28(0xbc)])(..._0x12f5bf);_0x2b21d7={..._0x2b21d7,'id':{[sequelize_1['Op']['in']]:_0xf01658}};}if(Array['isArray'](_0x52a336)&&_0x52a336[_0x3ceb28(0xa8)]>0x0){const _0x479f23=[];for(let _0x44a966 of _0x52a336){const _0x5d6dd1=await Ticket_1[_0x3ceb28(0xaf)][_0x3ceb28(0xa2)]({'where':{'userId':_0x44a966}});_0x5d6dd1&&_0x479f23[_0x3ceb28(0xcd)](_0x5d6dd1[_0x3ceb28(0xb5)](_0x23dc85=>_0x23dc85['id']));}const _0x5c12ed=(0x0,lodash_1[_0x3ceb28(0xbc)])(..._0x479f23);_0x2b21d7={..._0x2b21d7,'id':{[sequelize_1['Op']['in']]:_0x5c12ed}};}const _0x1945b1=0x28,_0x235d75=_0x1945b1*(+pageNumber-0x1);_0x2b21d7={..._0x2b21d7,'companyId':_0x4e73b6};const {count:_0x5211a5,rows:_0x5caf4f}=await Ticket_1[_0x3ceb28(0xaf)][_0x3ceb28(0xcb)]({'where':_0x2b21d7,'include':_0xb93c1a,'distinct':!![],'limit':_0x1945b1,'offset':_0x235d75,'order':[[_0x3ceb28(0x9f),_0x3ceb28(0x97)]],'subQuery':![]}),_0x6d4d9c=_0x5211a5>_0x235d75+_0x5caf4f[_0x3ceb28(0xa8)];return{'tickets':_0x5caf4f,'count':_0x5211a5,'hasMore':_0x6d4d9c};};exports[a527_0x8b6dba(0xaf)]=ListTicketsServiceKanban;