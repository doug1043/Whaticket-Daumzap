const a550_0xa267b8=a550_0x4854;(function(_0x326799,_0x5cae1f){const _0x3cdcc6=a550_0x4854,_0x4f3b4b=_0x326799();while(!![]){try{const _0x510b2a=parseInt(_0x3cdcc6(0x19d))/0x1*(-parseInt(_0x3cdcc6(0x1ac))/0x2)+-parseInt(_0x3cdcc6(0x194))/0x3+parseInt(_0x3cdcc6(0x1ae))/0x4+parseInt(_0x3cdcc6(0x1b9))/0x5*(parseInt(_0x3cdcc6(0x1a6))/0x6)+parseInt(_0x3cdcc6(0x1ba))/0x7*(-parseInt(_0x3cdcc6(0x1a3))/0x8)+parseInt(_0x3cdcc6(0x1ab))/0x9+-parseInt(_0x3cdcc6(0x19e))/0xa;if(_0x510b2a===_0x5cae1f)break;else _0x4f3b4b['push'](_0x4f3b4b['shift']());}catch(_0x4a5b72){_0x4f3b4b['push'](_0x4f3b4b['shift']());}}}(a550_0xef87,0x73a54));const a550_0x4d8600=(function(){let _0x25b5f1=!![];return function(_0x103e64,_0x2a26a3){const _0x52bcf3=_0x25b5f1?function(){const _0x3fc75b=a550_0x4854;if(_0x2a26a3){const _0xbfb15a=_0x2a26a3[_0x3fc75b(0x1b1)](_0x103e64,arguments);return _0x2a26a3=null,_0xbfb15a;}}:function(){};return _0x25b5f1=![],_0x52bcf3;};}()),a550_0xb724b2=a550_0x4d8600(this,function(){const _0x38ed7c=a550_0x4854;return a550_0xb724b2[_0x38ed7c(0x1be)]()['search'](_0x38ed7c(0x190))[_0x38ed7c(0x1be)]()[_0x38ed7c(0x1c5)](a550_0xb724b2)['search'](_0x38ed7c(0x190));});a550_0xb724b2();'use strict';function a550_0xef87(){const _0x376928=['523033rKgNzF','where','contact','../../models/Ticket','toString','../../models/TicketTag','startOfDay','messages','push','../../models/Message','LIKE','constructor','queues','between','(((.+)+)+)+$','name','../../models/User','presence','817491xXAgsp','pending','true','updatedAt','length','date-fns','intersection','parseISO','lodash','314zkfCCT','5078180ulhMDz','map','body','../../models/Queue','open','56hznxyF','findAll','number','6QBghdo','queue','default','ticketId','LOWER','5344353KzbevJ','3560daeESp','endOfDay','3646944YXQIwU','col','toLocaleLowerCase','apply','isArray','like','__esModule','email','user','../../models/Contact','__importDefault','4151995IIvqQh'];a550_0xef87=function(){return _0x376928;};return a550_0xef87();}var __importDefault=this&&this[a550_0xa267b8(0x1b8)]||function(_0x577764){return _0x577764&&_0x577764['__esModule']?_0x577764:{'default':_0x577764};};Object['defineProperty'](exports,a550_0xa267b8(0x1b4),{'value':!![]});const sequelize_1=require('sequelize'),date_fns_1=require(a550_0xa267b8(0x199)),Ticket_1=__importDefault(require(a550_0xa267b8(0x1bd))),Contact_1=__importDefault(require(a550_0xa267b8(0x1b7))),Message_1=__importDefault(require(a550_0xa267b8(0x1c3))),Queue_1=__importDefault(require(a550_0xa267b8(0x1a1))),User_1=__importDefault(require(a550_0xa267b8(0x192))),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a550_0xa267b8(0x1bf))),lodash_1=require(a550_0xa267b8(0x19c)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x4eb1d7,tags:_0x3201b4,users:_0x567c4f,status:_0xe061b0,date:_0x117efd,updatedAt:_0x2ce2d9,showAll:_0x4c9f6f,userId:_0x141259,withUnreadMessages:_0x7777a9,companyId:_0x27f4e4})=>{const _0x202a93=a550_0xa267b8;let _0x114a2f={[sequelize_1['Op']['or']]:[{'userId':_0x141259},{'status':_0x202a93(0x195)}],'queueId':{[sequelize_1['Op']['or']]:[_0x4eb1d7,null]}},_0x1099be;_0x1099be=[{'model':Contact_1['default'],'as':_0x202a93(0x1bc),'attributes':['id',_0x202a93(0x191),_0x202a93(0x1a5),_0x202a93(0x1b5),_0x202a93(0x193)]},{'model':Queue_1['default'],'as':_0x202a93(0x1a7),'attributes':['id',_0x202a93(0x191),'color']},{'model':User_1['default'],'as':_0x202a93(0x1b6),'attributes':['id',_0x202a93(0x191)]},{'model':Tag_1[_0x202a93(0x1a8)],'as':'tags','attributes':['id','name','color']},{'model':Whatsapp_1['default'],'as':'whatsapp','attributes':[_0x202a93(0x191)]}];_0x4c9f6f==='true'&&(_0x114a2f={'queueId':{[sequelize_1['Op']['or']]:[_0x4eb1d7,null]},'userId':_0x141259});_0x114a2f={..._0x114a2f,'status':{[sequelize_1['Op']['or']]:[_0x202a93(0x195),_0x202a93(0x1a2)]}};if(searchParam){const _0x70a6b5=searchParam[_0x202a93(0x1b0)]()['trim']();_0x1099be=[..._0x1099be,{'model':Message_1[_0x202a93(0x1a8)],'as':_0x202a93(0x1c1),'attributes':['id',_0x202a93(0x1a0)],'where':{'body':(0x0,sequelize_1[_0x202a93(0x1bb)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x202a93(0x1af)])(_0x202a93(0x1a0))),_0x202a93(0x1c4),'%'+_0x70a6b5+'%')},'required':![],'duplicating':![]}],_0x114a2f={..._0x114a2f,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x202a93(0x1bb)])((0x0,sequelize_1['fn'])(_0x202a93(0x1aa),(0x0,sequelize_1[_0x202a93(0x1af)])('contact.name')),'LIKE','%'+_0x70a6b5+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x202a93(0x1b3)]]:'%'+_0x70a6b5+'%'}},{'$message.body$':(0x0,sequelize_1[_0x202a93(0x1bb)])((0x0,sequelize_1['fn'])(_0x202a93(0x1aa),(0x0,sequelize_1[_0x202a93(0x1af)])('body')),'LIKE','%'+_0x70a6b5+'%')}]};}_0x117efd&&(_0x114a2f={'createdAt':{[sequelize_1['Op'][_0x202a93(0x18f)]]:[+(0x0,date_fns_1[_0x202a93(0x1c0)])((0x0,date_fns_1[_0x202a93(0x19b)])(_0x117efd)),+(0x0,date_fns_1[_0x202a93(0x1ad)])((0x0,date_fns_1['parseISO'])(_0x117efd))]}});_0x2ce2d9&&(_0x114a2f={'updatedAt':{[sequelize_1['Op'][_0x202a93(0x18f)]]:[+(0x0,date_fns_1[_0x202a93(0x1c0)])((0x0,date_fns_1[_0x202a93(0x19b)])(_0x2ce2d9)),+(0x0,date_fns_1[_0x202a93(0x1ad)])((0x0,date_fns_1[_0x202a93(0x19b)])(_0x2ce2d9))]}});if(_0x7777a9===_0x202a93(0x196)){const _0x1dbee4=await(0x0,ShowUserService_1[_0x202a93(0x1a8)])(_0x141259),_0x108761=_0x1dbee4[_0x202a93(0x18e)][_0x202a93(0x19f)](_0x50f5ae=>_0x50f5ae['id']);_0x114a2f={[sequelize_1['Op']['or']]:[{'userId':_0x141259},{'status':_0x202a93(0x195)}],'queueId':{[sequelize_1['Op']['or']]:[_0x108761,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array['isArray'](_0x3201b4)&&_0x3201b4[_0x202a93(0x198)]>0x0){const _0x7628dd=[];for(let _0x21d0fa of _0x3201b4){const _0x1553a3=await TicketTag_1[_0x202a93(0x1a8)][_0x202a93(0x1a4)]({'where':{'tagId':_0x21d0fa}});_0x1553a3&&_0x7628dd[_0x202a93(0x1c2)](_0x1553a3['map'](_0x38cdd4=>_0x38cdd4[_0x202a93(0x1a9)]));}const _0x33bd08=(0x0,lodash_1[_0x202a93(0x19a)])(..._0x7628dd);_0x114a2f={..._0x114a2f,'id':{[sequelize_1['Op']['in']]:_0x33bd08}};}if(Array[_0x202a93(0x1b2)](_0x567c4f)&&_0x567c4f[_0x202a93(0x198)]>0x0){const _0x46a093=[];for(let _0x2d350d of _0x567c4f){const _0x4c3244=await Ticket_1[_0x202a93(0x1a8)][_0x202a93(0x1a4)]({'where':{'userId':_0x2d350d}});_0x4c3244&&_0x46a093['push'](_0x4c3244['map'](_0x31951d=>_0x31951d['id']));}const _0x4df741=(0x0,lodash_1[_0x202a93(0x19a)])(..._0x46a093);_0x114a2f={..._0x114a2f,'id':{[sequelize_1['Op']['in']]:_0x4df741}};}const _0x56a9ef=0x28,_0x39731f=_0x56a9ef*(+pageNumber-0x1);_0x114a2f={..._0x114a2f,'companyId':_0x27f4e4};const {count:_0x468c6c,rows:_0x12c8d2}=await Ticket_1[_0x202a93(0x1a8)]['findAndCountAll']({'where':_0x114a2f,'include':_0x1099be,'distinct':!![],'limit':_0x56a9ef,'offset':_0x39731f,'order':[[_0x202a93(0x197),'DESC']],'subQuery':![]}),_0x31b5f8=_0x468c6c>_0x39731f+_0x12c8d2['length'];return{'tickets':_0x12c8d2,'count':_0x468c6c,'hasMore':_0x31b5f8};};function a550_0x4854(_0x1aac01,_0x5d9bf2){const _0x213678=a550_0xef87();return a550_0x4854=function(_0xb724b2,_0x4d8600){_0xb724b2=_0xb724b2-0x18e;let _0xef87b8=_0x213678[_0xb724b2];return _0xef87b8;},a550_0x4854(_0x1aac01,_0x5d9bf2);}exports[a550_0xa267b8(0x1a8)]=ListTicketsServiceKanban;