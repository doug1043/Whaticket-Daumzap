const a668_0x536693=a668_0x18d2;(function(_0x5695e2,_0x1f32d3){const _0x2a781a=a668_0x18d2,_0xb11926=_0x5695e2();while(!![]){try{const _0x12811a=parseInt(_0x2a781a(0xec))/0x1*(-parseInt(_0x2a781a(0xc5))/0x2)+parseInt(_0x2a781a(0xb5))/0x3+-parseInt(_0x2a781a(0xee))/0x4*(-parseInt(_0x2a781a(0xca))/0x5)+-parseInt(_0x2a781a(0xd6))/0x6+-parseInt(_0x2a781a(0xc6))/0x7*(parseInt(_0x2a781a(0xd8))/0x8)+parseInt(_0x2a781a(0xb3))/0x9*(parseInt(_0x2a781a(0xdd))/0xa)+parseInt(_0x2a781a(0xdb))/0xb;if(_0x12811a===_0x1f32d3)break;else _0xb11926['push'](_0xb11926['shift']());}catch(_0x39e419){_0xb11926['push'](_0xb11926['shift']());}}}(a668_0x4973,0x9a11f));const a668_0x40fd28=(function(){let _0x16ea75=!![];return function(_0x12dc1c,_0xe6cc2c){const _0x34de3e=_0x16ea75?function(){if(_0xe6cc2c){const _0x21babf=_0xe6cc2c['apply'](_0x12dc1c,arguments);return _0xe6cc2c=null,_0x21babf;}}:function(){};return _0x16ea75=![],_0x34de3e;};}()),a668_0x130590=a668_0x40fd28(this,function(){const _0x1e3d18=a668_0x18d2;return a668_0x130590[_0x1e3d18(0xc9)]()[_0x1e3d18(0xc0)](_0x1e3d18(0xde))['toString']()[_0x1e3d18(0xb9)](a668_0x130590)[_0x1e3d18(0xc0)](_0x1e3d18(0xde));});a668_0x130590();'use strict';var __importDefault=this&&this[a668_0x536693(0xbe)]||function(_0x236d90){const _0x56555a=a668_0x536693;return _0x236d90&&_0x236d90[_0x56555a(0xcb)]?_0x236d90:{'default':_0x236d90};};function a668_0x18d2(_0x186e5c,_0x4363d5){const _0x2298b1=a668_0x4973();return a668_0x18d2=function(_0x130590,_0x40fd28){_0x130590=_0x130590-0xb2;let _0x4973b4=_0x2298b1[_0x130590];return _0x4973b4;},a668_0x18d2(_0x186e5c,_0x4363d5);}function a668_0x4973(){const _0xeba5bd=['search','name','messages','pending','toLocaleLowerCase','26sEhJfR','4264393EvOYhz','../UserServices/ShowUserService','LIKE','toString','405mwRDxP','__esModule','queues','contact.name','body','email','defineProperty','map','findAndCountAll','where','date-fns','parseISO','1930794zqMNSs','push','8bnWuUW','endOfDay','notIn','17400042ZanSMo','profile','8100ycdtCk','(((.+)+)+)+$','ticketId','col','../../models/Contact','open','true','findAll','updatedAt','admin','../../models/Whatsapp','LOWER','length','presence','whatsapp','81252SQQFlb','../../models/Message','21368QgqMuL','default','2088XwwCMH','startOfDay','1247703owStPN','../../models/User','color','contact','constructor','intersection','between','isArray','tags','__importDefault','../../models/Tag'];a668_0x4973=function(){return _0xeba5bd;};return a668_0x4973();}Object[a668_0x536693(0xd0)](exports,'__esModule',{'value':!![]});const sequelize_1=require('sequelize'),date_fns_1=require(a668_0x536693(0xd4)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a668_0x536693(0xe1))),Message_1=__importDefault(require(a668_0x536693(0xed))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a668_0x536693(0xb6))),ShowUserService_1=__importDefault(require(a668_0x536693(0xc7))),Tag_1=__importDefault(require(a668_0x536693(0xbf))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require(a668_0x536693(0xe7))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x4197bf,tags:_0x4151e8,users:_0x3d30d8,status:_0x31fbc5,date:_0x386aa3,updatedAt:_0x228fff,showAll:_0x336552,userId:_0x313097,withUnreadMessages:_0x2ada2f,companyId:_0x5d2688})=>{const _0x34276f=a668_0x536693,_0x652eea=await(0x0,ShowUserService_1['default'])(_0x313097);let _0x5b4b22={};if(_0x652eea['profile']==='admin')_0x5b4b22={'queueId':{[sequelize_1['Op']['or']]:_0x4197bf[_0x34276f(0xe9)]>0x0?[_0x4197bf,null]:[{[sequelize_1['Op']['ne']]:null},null]}};else{if(_0x652eea[_0x34276f(0xdc)]==='superv'){const _0x4ab478=await User_1[_0x34276f(0xb2)]['findAll']({'where':{'companyId':_0x5d2688,'profile':_0x34276f(0xe6)},'attributes':['id']}),_0x16f9ac=_0x4ab478[_0x34276f(0xd1)](_0x164456=>_0x164456['id']);_0x5b4b22={'queueId':{[sequelize_1['Op']['or']]:_0x4197bf[_0x34276f(0xe9)]>0x0?[_0x4197bf,null]:[{[sequelize_1['Op']['ne']]:null},null]},[sequelize_1['Op']['or']]:[{'userId':{[sequelize_1['Op'][_0x34276f(0xda)]]:_0x16f9ac}},{'userId':null}]};}else _0x4197bf[_0x34276f(0xe9)]===0x0?_0x5b4b22={'userId':_0x313097,'queueId':null}:_0x5b4b22={[sequelize_1['Op']['or']]:[{'userId':_0x313097},{'status':_0x34276f(0xc3),'queueId':{[sequelize_1['Op']['in']]:_0x4197bf}}]};}let _0x36e79f;_0x36e79f=[{'model':Contact_1[_0x34276f(0xb2)],'as':_0x34276f(0xb8),'attributes':['id','name','number',_0x34276f(0xcf),_0x34276f(0xea)]},{'model':Queue_1[_0x34276f(0xb2)],'as':'queue','attributes':['id',_0x34276f(0xc1),'color']},{'model':User_1['default'],'as':'user','attributes':['id',_0x34276f(0xc1)]},{'model':Tag_1[_0x34276f(0xb2)],'as':_0x34276f(0xbd),'attributes':['id',_0x34276f(0xc1),_0x34276f(0xb7)]},{'model':Whatsapp_1[_0x34276f(0xb2)],'as':_0x34276f(0xeb),'attributes':[_0x34276f(0xc1)]}];_0x336552===_0x34276f(0xe3)&&(_0x5b4b22={'queueId':{[sequelize_1['Op']['or']]:[_0x4197bf,null]},'userId':_0x313097});_0x5b4b22={..._0x5b4b22,'status':{[sequelize_1['Op']['or']]:[_0x34276f(0xc3),_0x34276f(0xe2)]}};if(searchParam){const _0x2dfd22=searchParam[_0x34276f(0xc4)]()['trim']();_0x36e79f=[..._0x36e79f,{'model':Message_1[_0x34276f(0xb2)],'as':_0x34276f(0xc2),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x34276f(0xd3)])((0x0,sequelize_1['fn'])(_0x34276f(0xe8),(0x0,sequelize_1[_0x34276f(0xe0)])('body')),'LIKE','%'+_0x2dfd22+'%')},'required':![],'duplicating':![]}],_0x5b4b22={..._0x5b4b22,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x34276f(0xe8),(0x0,sequelize_1[_0x34276f(0xe0)])(_0x34276f(0xcd))),_0x34276f(0xc8),'%'+_0x2dfd22+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x2dfd22+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x34276f(0xe8),(0x0,sequelize_1[_0x34276f(0xe0)])(_0x34276f(0xce))),_0x34276f(0xc8),'%'+_0x2dfd22+'%')}]};}_0x386aa3&&(_0x5b4b22={'createdAt':{[sequelize_1['Op'][_0x34276f(0xbb)]]:[+(0x0,date_fns_1[_0x34276f(0xb4)])((0x0,date_fns_1['parseISO'])(_0x386aa3)),+(0x0,date_fns_1[_0x34276f(0xd9)])((0x0,date_fns_1[_0x34276f(0xd5)])(_0x386aa3))]}});_0x228fff&&(_0x5b4b22={'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x34276f(0xb4)])((0x0,date_fns_1[_0x34276f(0xd5)])(_0x228fff)),+(0x0,date_fns_1[_0x34276f(0xd9)])((0x0,date_fns_1[_0x34276f(0xd5)])(_0x228fff))]}});if(_0x2ada2f===_0x34276f(0xe3)){const _0x24afba=await(0x0,ShowUserService_1[_0x34276f(0xb2)])(_0x313097),_0x27b558=_0x24afba[_0x34276f(0xcc)][_0x34276f(0xd1)](_0x35a601=>_0x35a601['id']);_0x5b4b22={[sequelize_1['Op']['or']]:[{'userId':_0x313097},{'status':_0x34276f(0xc3)}],'queueId':{[sequelize_1['Op']['or']]:[_0x27b558,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x34276f(0xbc)](_0x4151e8)&&_0x4151e8[_0x34276f(0xe9)]>0x0){const _0x1467d5=[];for(let _0x2d75be of _0x4151e8){const _0x58c372=await TicketTag_1[_0x34276f(0xb2)][_0x34276f(0xe4)]({'where':{'tagId':_0x2d75be}});_0x58c372&&_0x1467d5[_0x34276f(0xd7)](_0x58c372[_0x34276f(0xd1)](_0x30b87d=>_0x30b87d[_0x34276f(0xdf)]));}const _0x3f46c4=(0x0,lodash_1[_0x34276f(0xba)])(..._0x1467d5);_0x5b4b22={..._0x5b4b22,'id':{[sequelize_1['Op']['in']]:_0x3f46c4}};}if(Array['isArray'](_0x3d30d8)&&_0x3d30d8[_0x34276f(0xe9)]>0x0){const _0x402c7d=[];for(let _0x432d29 of _0x3d30d8){const _0x4bffa2=await Ticket_1[_0x34276f(0xb2)][_0x34276f(0xe4)]({'where':{'userId':_0x432d29}});_0x4bffa2&&_0x402c7d[_0x34276f(0xd7)](_0x4bffa2[_0x34276f(0xd1)](_0x4396b0=>_0x4396b0['id']));}const _0xf15179=(0x0,lodash_1[_0x34276f(0xba)])(..._0x402c7d);_0x5b4b22={..._0x5b4b22,'id':{[sequelize_1['Op']['in']]:_0xf15179}};}const _0x95084=0x28,_0x74596f=_0x95084*(+pageNumber-0x1);_0x5b4b22={..._0x5b4b22,'companyId':_0x5d2688};const {count:_0x3a4330,rows:_0x25f608}=await Ticket_1[_0x34276f(0xb2)][_0x34276f(0xd2)]({'where':_0x5b4b22,'include':_0x36e79f,'distinct':!![],'limit':_0x95084,'offset':_0x74596f,'order':[[_0x34276f(0xe5),'DESC']],'subQuery':![]}),_0x282032=_0x3a4330>_0x74596f+_0x25f608[_0x34276f(0xe9)];return{'tickets':_0x25f608,'count':_0x3a4330,'hasMore':_0x282032};};exports[a668_0x536693(0xb2)]=ListTicketsServiceKanban;