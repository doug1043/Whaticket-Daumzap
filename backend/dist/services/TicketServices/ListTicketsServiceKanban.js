const a526_0x41cc5b=a526_0x2107;(function(_0x36d675,_0x57f50c){const _0x239f99=a526_0x2107,_0x5ae7f3=_0x36d675();while(!![]){try{const _0x1f08a1=-parseInt(_0x239f99(0x21c))/0x1+parseInt(_0x239f99(0x1ee))/0x2*(-parseInt(_0x239f99(0x21d))/0x3)+-parseInt(_0x239f99(0x1e6))/0x4*(parseInt(_0x239f99(0x218))/0x5)+parseInt(_0x239f99(0x212))/0x6*(-parseInt(_0x239f99(0x216))/0x7)+-parseInt(_0x239f99(0x1ef))/0x8+parseInt(_0x239f99(0x1fd))/0x9*(-parseInt(_0x239f99(0x21f))/0xa)+parseInt(_0x239f99(0x21b))/0xb;if(_0x1f08a1===_0x57f50c)break;else _0x5ae7f3['push'](_0x5ae7f3['shift']());}catch(_0x96e4c5){_0x5ae7f3['push'](_0x5ae7f3['shift']());}}}(a526_0x1f08,0xcc107));const a526_0x262a07=(function(){let _0x129424=!![];return function(_0x59c98d,_0x4639a9){const _0x1dde2c=_0x129424?function(){const _0x2e3eda=a526_0x2107;if(_0x4639a9){const _0x4648b1=_0x4639a9[_0x2e3eda(0x206)](_0x59c98d,arguments);return _0x4639a9=null,_0x4648b1;}}:function(){};return _0x129424=![],_0x1dde2c;};}()),a526_0x597528=a526_0x262a07(this,function(){const _0x245bb5=a526_0x2107;return a526_0x597528['toString']()[_0x245bb5(0x20b)](_0x245bb5(0x215))[_0x245bb5(0x1e8)]()[_0x245bb5(0x205)](a526_0x597528)[_0x245bb5(0x20b)](_0x245bb5(0x215));});a526_0x597528();function a526_0x1f08(){const _0x26855a=['tags','messages','intersection','endOfDay','col','where','updatedAt','body','../../models/Contact','LIKE','isArray','color','../../models/Message','41562Zggyaw','LOWER','__esModule','contact.name','push','queues','../../models/Whatsapp','open','constructor','apply','defineProperty','toLocaleLowerCase','DESC','pending','search','queue','../UserServices/ShowUserService','email','map','trim','findAll','6WmkLdg','length','user','(((.+)+)+)+$','2638174HFvGXM','true','1334470pjGeEF','date-fns','contact','61408149rNZcej','57069PxYZYm','1877541oZWPLV','name','1420rEQkaS','ticketId','default','sequelize','24OitpPA','between','toString','../../models/Queue','parseISO','findAndCountAll','like','startOfDay','2gXFxpH','11438352wseHoR'];a526_0x1f08=function(){return _0x26855a;};return a526_0x1f08();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1a0a9a){const _0x1e2468=a526_0x2107;return _0x1a0a9a&&_0x1a0a9a[_0x1e2468(0x1ff)]?_0x1a0a9a:{'default':_0x1a0a9a};};function a526_0x2107(_0x58eccd,_0x1c23ad){const _0x195383=a526_0x1f08();return a526_0x2107=function(_0x597528,_0x262a07){_0x597528=_0x597528-0x1e3;let _0x1f081e=_0x195383[_0x597528];return _0x1f081e;},a526_0x2107(_0x58eccd,_0x1c23ad);}Object[a526_0x41cc5b(0x207)](exports,a526_0x41cc5b(0x1ff),{'value':!![]});const sequelize_1=require(a526_0x41cc5b(0x1e5)),date_fns_1=require(a526_0x41cc5b(0x219)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a526_0x41cc5b(0x1f8))),Message_1=__importDefault(require(a526_0x41cc5b(0x1fc))),Queue_1=__importDefault(require(a526_0x41cc5b(0x1e9))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require(a526_0x41cc5b(0x20d))),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require(a526_0x41cc5b(0x203))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x2d51da,tags:_0x37d7ee,users:_0x513860,status:_0x203018,date:_0x1be1cb,updatedAt:_0x1d8ee2,showAll:_0xdeac,userId:_0x31034e,withUnreadMessages:_0x43ce77,companyId:_0x3e5566})=>{const _0xd7c4ef=a526_0x41cc5b;let _0x35db3c={[sequelize_1['Op']['or']]:[{'userId':_0x31034e},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x2d51da,null]}},_0x56b94f;_0x56b94f=[{'model':Contact_1[_0xd7c4ef(0x1e4)],'as':_0xd7c4ef(0x21a),'attributes':['id',_0xd7c4ef(0x21e),'number',_0xd7c4ef(0x20e),'presence']},{'model':Queue_1[_0xd7c4ef(0x1e4)],'as':_0xd7c4ef(0x20c),'attributes':['id',_0xd7c4ef(0x21e),_0xd7c4ef(0x1fb)]},{'model':User_1['default'],'as':_0xd7c4ef(0x214),'attributes':['id',_0xd7c4ef(0x21e)]},{'model':Tag_1[_0xd7c4ef(0x1e4)],'as':_0xd7c4ef(0x1f0),'attributes':['id','name',_0xd7c4ef(0x1fb)]},{'model':Whatsapp_1['default'],'as':'whatsapp','attributes':[_0xd7c4ef(0x21e)]}];_0xdeac===_0xd7c4ef(0x217)&&(_0x35db3c={'queueId':{[sequelize_1['Op']['or']]:[_0x2d51da,null]},'userId':_0x31034e});_0x35db3c={..._0x35db3c,'status':{[sequelize_1['Op']['or']]:[_0xd7c4ef(0x20a),_0xd7c4ef(0x204)]}};if(searchParam){const _0x5f1295=searchParam[_0xd7c4ef(0x208)]()[_0xd7c4ef(0x210)]();_0x56b94f=[..._0x56b94f,{'model':Message_1['default'],'as':_0xd7c4ef(0x1f1),'attributes':['id',_0xd7c4ef(0x1f7)],'where':{'body':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0xd7c4ef(0x1fe),(0x0,sequelize_1[_0xd7c4ef(0x1f4)])('body')),'LIKE','%'+_0x5f1295+'%')},'required':![],'duplicating':![]}],_0x35db3c={..._0x35db3c,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0xd7c4ef(0x1f5)])((0x0,sequelize_1['fn'])(_0xd7c4ef(0x1fe),(0x0,sequelize_1[_0xd7c4ef(0x1f4)])(_0xd7c4ef(0x200))),_0xd7c4ef(0x1f9),'%'+_0x5f1295+'%')},{'$contact.number$':{[sequelize_1['Op'][_0xd7c4ef(0x1ec)]]:'%'+_0x5f1295+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0xd7c4ef(0x1fe),(0x0,sequelize_1['col'])(_0xd7c4ef(0x1f7))),_0xd7c4ef(0x1f9),'%'+_0x5f1295+'%')}]};}_0x1be1cb&&(_0x35db3c={'createdAt':{[sequelize_1['Op'][_0xd7c4ef(0x1e7)]]:[+(0x0,date_fns_1[_0xd7c4ef(0x1ed)])((0x0,date_fns_1[_0xd7c4ef(0x1ea)])(_0x1be1cb)),+(0x0,date_fns_1[_0xd7c4ef(0x1f3)])((0x0,date_fns_1[_0xd7c4ef(0x1ea)])(_0x1be1cb))]}});_0x1d8ee2&&(_0x35db3c={'updatedAt':{[sequelize_1['Op'][_0xd7c4ef(0x1e7)]]:[+(0x0,date_fns_1[_0xd7c4ef(0x1ed)])((0x0,date_fns_1[_0xd7c4ef(0x1ea)])(_0x1d8ee2)),+(0x0,date_fns_1[_0xd7c4ef(0x1f3)])((0x0,date_fns_1[_0xd7c4ef(0x1ea)])(_0x1d8ee2))]}});if(_0x43ce77===_0xd7c4ef(0x217)){const _0x5e8faa=await(0x0,ShowUserService_1[_0xd7c4ef(0x1e4)])(_0x31034e),_0x422214=_0x5e8faa[_0xd7c4ef(0x202)][_0xd7c4ef(0x20f)](_0x2cbf65=>_0x2cbf65['id']);_0x35db3c={[sequelize_1['Op']['or']]:[{'userId':_0x31034e},{'status':_0xd7c4ef(0x20a)}],'queueId':{[sequelize_1['Op']['or']]:[_0x422214,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0xd7c4ef(0x1fa)](_0x37d7ee)&&_0x37d7ee[_0xd7c4ef(0x213)]>0x0){const _0x124f65=[];for(let _0x1859fb of _0x37d7ee){const _0x56e04c=await TicketTag_1[_0xd7c4ef(0x1e4)][_0xd7c4ef(0x211)]({'where':{'tagId':_0x1859fb}});_0x56e04c&&_0x124f65['push'](_0x56e04c[_0xd7c4ef(0x20f)](_0x56f0cc=>_0x56f0cc[_0xd7c4ef(0x1e3)]));}const _0x2e52b0=(0x0,lodash_1[_0xd7c4ef(0x1f2)])(..._0x124f65);_0x35db3c={..._0x35db3c,'id':{[sequelize_1['Op']['in']]:_0x2e52b0}};}if(Array[_0xd7c4ef(0x1fa)](_0x513860)&&_0x513860['length']>0x0){const _0xbaaf8b=[];for(let _0x239889 of _0x513860){const _0x1acb38=await Ticket_1[_0xd7c4ef(0x1e4)]['findAll']({'where':{'userId':_0x239889}});_0x1acb38&&_0xbaaf8b[_0xd7c4ef(0x201)](_0x1acb38['map'](_0x20277f=>_0x20277f['id']));}const _0x7645a5=(0x0,lodash_1[_0xd7c4ef(0x1f2)])(..._0xbaaf8b);_0x35db3c={..._0x35db3c,'id':{[sequelize_1['Op']['in']]:_0x7645a5}};}const _0x29875d=0x28,_0x3f4269=_0x29875d*(+pageNumber-0x1);_0x35db3c={..._0x35db3c,'companyId':_0x3e5566};const {count:_0xb94814,rows:_0x22aaab}=await Ticket_1[_0xd7c4ef(0x1e4)][_0xd7c4ef(0x1eb)]({'where':_0x35db3c,'include':_0x56b94f,'distinct':!![],'limit':_0x29875d,'offset':_0x3f4269,'order':[[_0xd7c4ef(0x1f6),_0xd7c4ef(0x209)]],'subQuery':![]}),_0x3b3daf=_0xb94814>_0x3f4269+_0x22aaab[_0xd7c4ef(0x213)];return{'tickets':_0x22aaab,'count':_0xb94814,'hasMore':_0x3b3daf};};exports['default']=ListTicketsServiceKanban;