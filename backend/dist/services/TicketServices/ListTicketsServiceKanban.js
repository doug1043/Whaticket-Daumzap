const a525_0x97c337=a525_0x540c;(function(_0x13d546,_0x54d698){const _0x202bdd=a525_0x540c,_0xeb75bd=_0x13d546();while(!![]){try{const _0x34cca9=parseInt(_0x202bdd(0xf0))/0x1+-parseInt(_0x202bdd(0x10a))/0x2+-parseInt(_0x202bdd(0xeb))/0x3+parseInt(_0x202bdd(0xfd))/0x4*(-parseInt(_0x202bdd(0xde))/0x5)+parseInt(_0x202bdd(0xec))/0x6*(parseInt(_0x202bdd(0xe4))/0x7)+-parseInt(_0x202bdd(0x10e))/0x8*(parseInt(_0x202bdd(0xf6))/0x9)+parseInt(_0x202bdd(0x10c))/0xa;if(_0x34cca9===_0x54d698)break;else _0xeb75bd['push'](_0xeb75bd['shift']());}catch(_0x5a6ebc){_0xeb75bd['push'](_0xeb75bd['shift']());}}}(a525_0x2d9b,0x27b03));function a525_0x540c(_0x3f9b07,_0x530fa3){const _0x3f4084=a525_0x2d9b();return a525_0x540c=function(_0x11064e,_0x20075a){_0x11064e=_0x11064e-0xda;let _0x2d9bf0=_0x3f4084[_0x11064e];return _0x2d9bf0;},a525_0x540c(_0x3f9b07,_0x530fa3);}const a525_0x20075a=(function(){let _0x186482=!![];return function(_0x588520,_0x320cdc){const _0xfd79fc=_0x186482?function(){const _0x4cad35=a525_0x540c;if(_0x320cdc){const _0x2921b6=_0x320cdc[_0x4cad35(0xf1)](_0x588520,arguments);return _0x320cdc=null,_0x2921b6;}}:function(){};return _0x186482=![],_0xfd79fc;};}()),a525_0x11064e=a525_0x20075a(this,function(){const _0x1385d6=a525_0x540c;return a525_0x11064e[_0x1385d6(0xea)]()['search'](_0x1385d6(0xdc))[_0x1385d6(0xea)]()[_0x1385d6(0xe3)](a525_0x11064e)[_0x1385d6(0xe5)](_0x1385d6(0xdc));});a525_0x11064e();'use strict';function a525_0x2d9b(){const _0x53d436=['ticketId','endOfDay','tags','whatsapp','../../models/TicketTag','DESC','578190tPyJCK','color','1966210PVnLkG','col','16gBIgQi','contact.name','like','date-fns','../../models/Whatsapp','../../models/User','name','where','../../models/Queue','messages','(((.+)+)+)+$','isArray','269810vheUCk','intersection','parseISO','../../models/Tag','presence','constructor','14oTQLbe','search','user','defineProperty','LOWER','map','toString','539376wTNsFY','833094urbtTP','findAndCountAll','true','length','321419UlSfpF','apply','sequelize','between','__esModule','push','10809VmmSzu','body','number','default','lodash','LIKE','updatedAt','12kZgZQw','pending','../../models/Contact','../../models/Message','contact','startOfDay','findAll'];a525_0x2d9b=function(){return _0x53d436;};return a525_0x2d9b();}var __importDefault=this&&this['__importDefault']||function(_0x296cbc){const _0x2d7429=a525_0x540c;return _0x296cbc&&_0x296cbc[_0x2d7429(0xf4)]?_0x296cbc:{'default':_0x296cbc};};Object[a525_0x97c337(0xe7)](exports,a525_0x97c337(0xf4),{'value':!![]});const sequelize_1=require(a525_0x97c337(0xf2)),date_fns_1=require(a525_0x97c337(0x111)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a525_0x97c337(0xff))),Message_1=__importDefault(require(a525_0x97c337(0x100))),Queue_1=__importDefault(require(a525_0x97c337(0xda))),User_1=__importDefault(require(a525_0x97c337(0x113))),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require(a525_0x97c337(0xe1))),TicketTag_1=__importDefault(require(a525_0x97c337(0x108))),lodash_1=require(a525_0x97c337(0xfa)),Whatsapp_1=__importDefault(require(a525_0x97c337(0x112))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x86f26b,tags:_0x608472,users:_0x2c4202,status:_0x1175da,date:_0x5b865f,updatedAt:_0x5adc27,showAll:_0x45855b,userId:_0x485dc1,withUnreadMessages:_0x23dca1,companyId:_0x2d2323})=>{const _0x16789f=a525_0x97c337;let _0x381b68={[sequelize_1['Op']['or']]:[{'userId':_0x485dc1},{'status':_0x16789f(0xfe)}],'queueId':{[sequelize_1['Op']['or']]:[_0x86f26b,null]}},_0x51dcb3;_0x51dcb3=[{'model':Contact_1[_0x16789f(0xf9)],'as':_0x16789f(0x101),'attributes':['id',_0x16789f(0x114),_0x16789f(0xf8),'email',_0x16789f(0xe2)]},{'model':Queue_1[_0x16789f(0xf9)],'as':'queue','attributes':['id',_0x16789f(0x114),_0x16789f(0x10b)]},{'model':User_1[_0x16789f(0xf9)],'as':_0x16789f(0xe6),'attributes':['id',_0x16789f(0x114)]},{'model':Tag_1[_0x16789f(0xf9)],'as':_0x16789f(0x106),'attributes':['id',_0x16789f(0x114),_0x16789f(0x10b)]},{'model':Whatsapp_1['default'],'as':_0x16789f(0x107),'attributes':[_0x16789f(0x114)]}];_0x45855b===_0x16789f(0xee)&&(_0x381b68={'queueId':{[sequelize_1['Op']['or']]:[_0x86f26b,null]},'userId':_0x485dc1});_0x381b68={..._0x381b68,'status':{[sequelize_1['Op']['or']]:[_0x16789f(0xfe),'open']}};if(searchParam){const _0x2c75c2=searchParam['toLocaleLowerCase']()['trim']();_0x51dcb3=[..._0x51dcb3,{'model':Message_1['default'],'as':_0x16789f(0xdb),'attributes':['id',_0x16789f(0xf7)],'where':{'body':(0x0,sequelize_1[_0x16789f(0x115)])((0x0,sequelize_1['fn'])(_0x16789f(0xe8),(0x0,sequelize_1['col'])(_0x16789f(0xf7))),_0x16789f(0xfb),'%'+_0x2c75c2+'%')},'required':![],'duplicating':![]}],_0x381b68={..._0x381b68,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x16789f(0x115)])((0x0,sequelize_1['fn'])(_0x16789f(0xe8),(0x0,sequelize_1['col'])(_0x16789f(0x10f))),'LIKE','%'+_0x2c75c2+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x16789f(0x110)]]:'%'+_0x2c75c2+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x16789f(0xe8),(0x0,sequelize_1[_0x16789f(0x10d)])('body')),_0x16789f(0xfb),'%'+_0x2c75c2+'%')}]};}_0x5b865f&&(_0x381b68={'createdAt':{[sequelize_1['Op'][_0x16789f(0xf3)]]:[+(0x0,date_fns_1[_0x16789f(0x102)])((0x0,date_fns_1[_0x16789f(0xe0)])(_0x5b865f)),+(0x0,date_fns_1[_0x16789f(0x105)])((0x0,date_fns_1[_0x16789f(0xe0)])(_0x5b865f))]}});_0x5adc27&&(_0x381b68={'updatedAt':{[sequelize_1['Op'][_0x16789f(0xf3)]]:[+(0x0,date_fns_1[_0x16789f(0x102)])((0x0,date_fns_1[_0x16789f(0xe0)])(_0x5adc27)),+(0x0,date_fns_1[_0x16789f(0x105)])((0x0,date_fns_1[_0x16789f(0xe0)])(_0x5adc27))]}});if(_0x23dca1==='true'){const _0x1626f1=await(0x0,ShowUserService_1[_0x16789f(0xf9)])(_0x485dc1),_0x3fb0c3=_0x1626f1['queues'][_0x16789f(0xe9)](_0x39f5d2=>_0x39f5d2['id']);_0x381b68={[sequelize_1['Op']['or']]:[{'userId':_0x485dc1},{'status':_0x16789f(0xfe)}],'queueId':{[sequelize_1['Op']['or']]:[_0x3fb0c3,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x16789f(0xdd)](_0x608472)&&_0x608472[_0x16789f(0xef)]>0x0){const _0x3385ac=[];for(let _0x5300af of _0x608472){const _0x2c62f6=await TicketTag_1[_0x16789f(0xf9)][_0x16789f(0x103)]({'where':{'tagId':_0x5300af}});_0x2c62f6&&_0x3385ac[_0x16789f(0xf5)](_0x2c62f6['map'](_0x33d715=>_0x33d715[_0x16789f(0x104)]));}const _0x537696=(0x0,lodash_1[_0x16789f(0xdf)])(..._0x3385ac);_0x381b68={..._0x381b68,'id':{[sequelize_1['Op']['in']]:_0x537696}};}if(Array[_0x16789f(0xdd)](_0x2c4202)&&_0x2c4202[_0x16789f(0xef)]>0x0){const _0x2bbe90=[];for(let _0x5687c0 of _0x2c4202){const _0x543d78=await Ticket_1[_0x16789f(0xf9)]['findAll']({'where':{'userId':_0x5687c0}});_0x543d78&&_0x2bbe90[_0x16789f(0xf5)](_0x543d78[_0x16789f(0xe9)](_0x2f415c=>_0x2f415c['id']));}const _0x12ec93=(0x0,lodash_1[_0x16789f(0xdf)])(..._0x2bbe90);_0x381b68={..._0x381b68,'id':{[sequelize_1['Op']['in']]:_0x12ec93}};}const _0x214008=0x28,_0x1c7b92=_0x214008*(+pageNumber-0x1);_0x381b68={..._0x381b68,'companyId':_0x2d2323};const {count:_0x5de6bc,rows:_0x455bc8}=await Ticket_1['default'][_0x16789f(0xed)]({'where':_0x381b68,'include':_0x51dcb3,'distinct':!![],'limit':_0x214008,'offset':_0x1c7b92,'order':[[_0x16789f(0xfc),_0x16789f(0x109)]],'subQuery':![]}),_0x2b3186=_0x5de6bc>_0x1c7b92+_0x455bc8[_0x16789f(0xef)];return{'tickets':_0x455bc8,'count':_0x5de6bc,'hasMore':_0x2b3186};};exports[a525_0x97c337(0xf9)]=ListTicketsServiceKanban;