const a560_0x3bc8ba=a560_0xff68;(function(_0x4ceb21,_0x49539e){const _0x38b69f=a560_0xff68,_0x3618c5=_0x4ceb21();while(!![]){try{const _0x3e3339=-parseInt(_0x38b69f(0xf4))/0x1+parseInt(_0x38b69f(0xf1))/0x2+-parseInt(_0x38b69f(0xcb))/0x3+parseInt(_0x38b69f(0xe4))/0x4+-parseInt(_0x38b69f(0xf0))/0x5+-parseInt(_0x38b69f(0xef))/0x6*(-parseInt(_0x38b69f(0xde))/0x7)+-parseInt(_0x38b69f(0xd3))/0x8*(-parseInt(_0x38b69f(0xe9))/0x9);if(_0x3e3339===_0x49539e)break;else _0x3618c5['push'](_0x3618c5['shift']());}catch(_0x1a3a6b){_0x3618c5['push'](_0x3618c5['shift']());}}}(a560_0x3457,0x1c79d));const a560_0x4fe282=(function(){let _0x24b49b=!![];return function(_0x184ff,_0x391fb2){const _0x1d8505=_0x24b49b?function(){if(_0x391fb2){const _0x11e7de=_0x391fb2['apply'](_0x184ff,arguments);return _0x391fb2=null,_0x11e7de;}}:function(){};return _0x24b49b=![],_0x1d8505;};}()),a560_0x52ce6f=a560_0x4fe282(this,function(){const _0x5a6260=a560_0xff68;return a560_0x52ce6f[_0x5a6260(0xc8)]()[_0x5a6260(0xfa)](_0x5a6260(0xec))['toString']()[_0x5a6260(0xfe)](a560_0x52ce6f)['search'](_0x5a6260(0xec));});a560_0x52ce6f();function a560_0x3457(){const _0x3550fe=['12GzGRoI','604720mVXvHU','8246wGxwvk','enabled','contact','80247IbUpSI','../../models/Whatsapp','parseISO','col','between','tags','search','name','map','LOWER','constructor','isArray','whatsapp','../../models/Message','startOfDay','toString','where','toLocaleLowerCase','317718OiJzxp','__importDefault','date-fns','pending','findAndCountAll','findAll','push','admin','18880LUbQmj','trim','body','profile','allTicket','length','true','DESC','endOfDay','color','sequelize','265286qgneaK','presence','contact.name','open','../../models/Ticket','defineProperty','327420cZZoQK','__esModule','default','../../models/User','like','999vGjjcC','LIKE','../../models/Tag','(((.+)+)+)+$','intersection','messages'];a560_0x3457=function(){return _0x3550fe;};return a560_0x3457();}'use strict';var __importDefault=this&&this[a560_0x3bc8ba(0xcc)]||function(_0x5d53cb){const _0x50474c=a560_0x3bc8ba;return _0x5d53cb&&_0x5d53cb[_0x50474c(0xe5)]?_0x5d53cb:{'default':_0x5d53cb};};Object[a560_0x3bc8ba(0xe3)](exports,a560_0x3bc8ba(0xe5),{'value':!![]});const sequelize_1=require(a560_0x3bc8ba(0xdd)),date_fns_1=require(a560_0x3bc8ba(0xcd)),Ticket_1=__importDefault(require(a560_0x3bc8ba(0xe2))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a560_0x3bc8ba(0xc6))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a560_0x3bc8ba(0xe7))),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require(a560_0x3bc8ba(0xeb))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require(a560_0x3bc8ba(0xf5))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x5c7f2b,tags:_0x3517ee,users:_0x42f1e2,status:_0x41bc7c,date:_0x5102c5,updatedAt:_0x3b4300,showAll:_0x3a13e3,userId:_0x4ac3a0,withUnreadMessages:_0x368c57,companyId:_0x52de6d})=>{const _0x46ac56=a560_0x3bc8ba,_0x12650a=await(0x0,ShowUserService_1[_0x46ac56(0xe6)])(_0x4ac3a0);let _0x1760b4={};_0x12650a[_0x46ac56(0xd7)]===_0x46ac56(0xf2)||_0x12650a[_0x46ac56(0xd6)]===_0x46ac56(0xd2)?_0x1760b4={'queueId':{[sequelize_1['Op']['or']]:_0x5c7f2b[_0x46ac56(0xd8)]>0x0?[_0x5c7f2b,null]:[{[sequelize_1['Op']['ne']]:null},null]}}:_0x5c7f2b[_0x46ac56(0xd8)]===0x0?_0x1760b4={[sequelize_1['Op']['or']]:[{'userId':_0x4ac3a0},{'status':_0x46ac56(0xce)}],'queueId':null}:_0x1760b4={[sequelize_1['Op']['or']]:[{'userId':_0x4ac3a0},{'status':_0x46ac56(0xce)}],'queueId':{[sequelize_1['Op']['or']]:[_0x5c7f2b]}};let _0x415284;_0x415284=[{'model':Contact_1[_0x46ac56(0xe6)],'as':_0x46ac56(0xf3),'attributes':['id',_0x46ac56(0xfb),'number','email',_0x46ac56(0xdf)]},{'model':Queue_1[_0x46ac56(0xe6)],'as':'queue','attributes':['id',_0x46ac56(0xfb),'color']},{'model':User_1[_0x46ac56(0xe6)],'as':'user','attributes':['id',_0x46ac56(0xfb)]},{'model':Tag_1[_0x46ac56(0xe6)],'as':_0x46ac56(0xf9),'attributes':['id',_0x46ac56(0xfb),_0x46ac56(0xdc)]},{'model':Whatsapp_1[_0x46ac56(0xe6)],'as':_0x46ac56(0xc5),'attributes':[_0x46ac56(0xfb)]}];_0x3a13e3===_0x46ac56(0xd9)&&(_0x1760b4={'queueId':{[sequelize_1['Op']['or']]:[_0x5c7f2b,null]},'userId':_0x4ac3a0});_0x1760b4={..._0x1760b4,'status':{[sequelize_1['Op']['or']]:['pending',_0x46ac56(0xe1)]}};if(searchParam){const _0x1c227b=searchParam[_0x46ac56(0xca)]()[_0x46ac56(0xd4)]();_0x415284=[..._0x415284,{'model':Message_1[_0x46ac56(0xe6)],'as':_0x46ac56(0xee),'attributes':['id',_0x46ac56(0xd5)],'where':{'body':(0x0,sequelize_1[_0x46ac56(0xc9)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x46ac56(0xf7)])(_0x46ac56(0xd5))),_0x46ac56(0xea),'%'+_0x1c227b+'%')},'required':![],'duplicating':![]}],_0x1760b4={..._0x1760b4,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x46ac56(0xc9)])((0x0,sequelize_1['fn'])(_0x46ac56(0xfd),(0x0,sequelize_1[_0x46ac56(0xf7)])(_0x46ac56(0xe0))),_0x46ac56(0xea),'%'+_0x1c227b+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x46ac56(0xe8)]]:'%'+_0x1c227b+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x46ac56(0xfd),(0x0,sequelize_1[_0x46ac56(0xf7)])(_0x46ac56(0xd5))),_0x46ac56(0xea),'%'+_0x1c227b+'%')}]};}_0x5102c5&&(_0x1760b4={'createdAt':{[sequelize_1['Op'][_0x46ac56(0xf8)]]:[+(0x0,date_fns_1[_0x46ac56(0xc7)])((0x0,date_fns_1[_0x46ac56(0xf6)])(_0x5102c5)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x46ac56(0xf6)])(_0x5102c5))]}});_0x3b4300&&(_0x1760b4={'updatedAt':{[sequelize_1['Op'][_0x46ac56(0xf8)]]:[+(0x0,date_fns_1[_0x46ac56(0xc7)])((0x0,date_fns_1[_0x46ac56(0xf6)])(_0x3b4300)),+(0x0,date_fns_1[_0x46ac56(0xdb)])((0x0,date_fns_1[_0x46ac56(0xf6)])(_0x3b4300))]}});if(_0x368c57===_0x46ac56(0xd9)){const _0x39557e=await(0x0,ShowUserService_1['default'])(_0x4ac3a0),_0x16aded=_0x39557e['queues']['map'](_0x1ae401=>_0x1ae401['id']);_0x1760b4={[sequelize_1['Op']['or']]:[{'userId':_0x4ac3a0},{'status':_0x46ac56(0xce)}],'queueId':{[sequelize_1['Op']['or']]:[_0x16aded,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x46ac56(0xff)](_0x3517ee)&&_0x3517ee[_0x46ac56(0xd8)]>0x0){const _0x1b9633=[];for(let _0x164bc9 of _0x3517ee){const _0x23eced=await TicketTag_1[_0x46ac56(0xe6)][_0x46ac56(0xd0)]({'where':{'tagId':_0x164bc9}});_0x23eced&&_0x1b9633[_0x46ac56(0xd1)](_0x23eced[_0x46ac56(0xfc)](_0x3b81e8=>_0x3b81e8['ticketId']));}const _0x7479c2=(0x0,lodash_1[_0x46ac56(0xed)])(..._0x1b9633);_0x1760b4={..._0x1760b4,'id':{[sequelize_1['Op']['in']]:_0x7479c2}};}if(Array['isArray'](_0x42f1e2)&&_0x42f1e2['length']>0x0){const _0x2d5cbc=[];for(let _0x35c056 of _0x42f1e2){const _0x5d6877=await Ticket_1[_0x46ac56(0xe6)]['findAll']({'where':{'userId':_0x35c056}});_0x5d6877&&_0x2d5cbc[_0x46ac56(0xd1)](_0x5d6877[_0x46ac56(0xfc)](_0x44bdde=>_0x44bdde['id']));}const _0x3bc4af=(0x0,lodash_1[_0x46ac56(0xed)])(..._0x2d5cbc);_0x1760b4={..._0x1760b4,'id':{[sequelize_1['Op']['in']]:_0x3bc4af}};}const _0x13368b=0x28,_0x5517af=_0x13368b*(+pageNumber-0x1);_0x1760b4={..._0x1760b4,'companyId':_0x52de6d};const {count:_0x3e11ca,rows:_0x3719f6}=await Ticket_1['default'][_0x46ac56(0xcf)]({'where':_0x1760b4,'include':_0x415284,'distinct':!![],'limit':_0x13368b,'offset':_0x5517af,'order':[['updatedAt',_0x46ac56(0xda)]],'subQuery':![]}),_0x4ef4e5=_0x3e11ca>_0x5517af+_0x3719f6[_0x46ac56(0xd8)];return{'tickets':_0x3719f6,'count':_0x3e11ca,'hasMore':_0x4ef4e5};};function a560_0xff68(_0x424db2,_0x20ca9b){const _0x257263=a560_0x3457();return a560_0xff68=function(_0x52ce6f,_0x4fe282){_0x52ce6f=_0x52ce6f-0xc5;let _0x3457ba=_0x257263[_0x52ce6f];return _0x3457ba;},a560_0xff68(_0x424db2,_0x20ca9b);}exports[a560_0x3bc8ba(0xe6)]=ListTicketsServiceKanban;