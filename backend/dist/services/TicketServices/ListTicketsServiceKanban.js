const a559_0x31bee0=a559_0xc491;(function(_0xd8c204,_0x2bcbc2){const _0x30ddf4=a559_0xc491,_0x32e67c=_0xd8c204();while(!![]){try{const _0xce7e32=parseInt(_0x30ddf4(0xc1))/0x1+-parseInt(_0x30ddf4(0xac))/0x2+-parseInt(_0x30ddf4(0xa8))/0x3*(parseInt(_0x30ddf4(0xb9))/0x4)+-parseInt(_0x30ddf4(0xcd))/0x5+-parseInt(_0x30ddf4(0xc5))/0x6+parseInt(_0x30ddf4(0xc0))/0x7+parseInt(_0x30ddf4(0xb0))/0x8*(parseInt(_0x30ddf4(0xd9))/0x9);if(_0xce7e32===_0x2bcbc2)break;else _0x32e67c['push'](_0x32e67c['shift']());}catch(_0x5e7d4f){_0x32e67c['push'](_0x32e67c['shift']());}}}(a559_0x5e37,0x9295e));const a559_0x4f134c=(function(){let _0x49c1b1=!![];return function(_0x13a9fa,_0x30f880){const _0x537f59=_0x49c1b1?function(){const _0x1a6856=a559_0xc491;if(_0x30f880){const _0x302aeb=_0x30f880[_0x1a6856(0xc3)](_0x13a9fa,arguments);return _0x30f880=null,_0x302aeb;}}:function(){};return _0x49c1b1=![],_0x537f59;};}()),a559_0x498828=a559_0x4f134c(this,function(){const _0x400fcf=a559_0xc491;return a559_0x498828['toString']()[_0x400fcf(0xb3)](_0x400fcf(0xb4))[_0x400fcf(0xd8)]()['constructor'](a559_0x498828)[_0x400fcf(0xb3)](_0x400fcf(0xb4));});a559_0x498828();function a559_0xc491(_0x26ae8b,_0x484018){const _0x1085fd=a559_0x5e37();return a559_0xc491=function(_0x498828,_0x4f134c){_0x498828=_0x498828-0xa1;let _0x5e3740=_0x1085fd[_0x498828];return _0x5e3740;},a559_0xc491(_0x26ae8b,_0x484018);}'use strict';var __importDefault=this&&this[a559_0x31bee0(0xa4)]||function(_0x35e5d5){return _0x35e5d5&&_0x35e5d5['__esModule']?_0x35e5d5:{'default':_0x35e5d5};};function a559_0x5e37(){const _0x1ca564=['sequelize','whatsapp','LOWER','findAndCountAll','606740eRwZGr','user','parseISO','ticketId','default','push','../../models/Contact','3592316WxCpug','1027785vqhFJy','map','apply','color','6341376TggSeu','messages','length','isArray','between','endOfDay','where','like','1932520LNaHgD','email','../../models/Whatsapp','../../models/User','col','startOfDay','updatedAt','true','LIKE','lodash','queue','toString','9efyYZp','contact','../../models/Queue','DESC','__importDefault','../../models/Tag','pending','findAll','6JKlIaT','../../models/Ticket','defineProperty','name','880700HXdYpk','date-fns','contact.name','presence','9972488qZpUAY','../UserServices/ShowUserService','body','search','(((.+)+)+)+$'];a559_0x5e37=function(){return _0x1ca564;};return a559_0x5e37();}Object[a559_0x31bee0(0xaa)](exports,'__esModule',{'value':!![]});const sequelize_1=require(a559_0x31bee0(0xb5)),date_fns_1=require(a559_0x31bee0(0xad)),Ticket_1=__importDefault(require(a559_0x31bee0(0xa9))),Contact_1=__importDefault(require(a559_0x31bee0(0xbf))),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require(a559_0x31bee0(0xa2))),User_1=__importDefault(require(a559_0x31bee0(0xd0))),ShowUserService_1=__importDefault(require(a559_0x31bee0(0xb1))),Tag_1=__importDefault(require(a559_0x31bee0(0xa5))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require(a559_0x31bee0(0xd6)),Whatsapp_1=__importDefault(require(a559_0x31bee0(0xcf))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x49f729,tags:_0x53f619,users:_0x47c6c0,status:_0x1c289d,date:_0x244ab3,updatedAt:_0x463926,showAll:_0x15a9a4,userId:_0x361266,withUnreadMessages:_0x51d72a,companyId:_0x358c42})=>{const _0x293cde=a559_0x31bee0;let _0x390358={[sequelize_1['Op']['or']]:[{'userId':_0x361266},{'status':_0x293cde(0xa6)}],'queueId':{[sequelize_1['Op']['or']]:[_0x49f729,null]}},_0x4ad862;_0x4ad862=[{'model':Contact_1[_0x293cde(0xbd)],'as':_0x293cde(0xa1),'attributes':['id',_0x293cde(0xab),'number',_0x293cde(0xce),_0x293cde(0xaf)]},{'model':Queue_1[_0x293cde(0xbd)],'as':_0x293cde(0xd7),'attributes':['id',_0x293cde(0xab),_0x293cde(0xc4)]},{'model':User_1[_0x293cde(0xbd)],'as':_0x293cde(0xba),'attributes':['id',_0x293cde(0xab)]},{'model':Tag_1[_0x293cde(0xbd)],'as':'tags','attributes':['id',_0x293cde(0xab),'color']},{'model':Whatsapp_1['default'],'as':_0x293cde(0xb6),'attributes':[_0x293cde(0xab)]}];_0x15a9a4===_0x293cde(0xd4)&&(_0x390358={'queueId':{[sequelize_1['Op']['or']]:[_0x49f729,null]},'userId':_0x361266});_0x390358={..._0x390358,'status':{[sequelize_1['Op']['or']]:[_0x293cde(0xa6),'open']}};if(searchParam){const _0x447bfc=searchParam['toLocaleLowerCase']()['trim']();_0x4ad862=[..._0x4ad862,{'model':Message_1[_0x293cde(0xbd)],'as':_0x293cde(0xc6),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x293cde(0xb7),(0x0,sequelize_1[_0x293cde(0xd1)])(_0x293cde(0xb2))),'LIKE','%'+_0x447bfc+'%')},'required':![],'duplicating':![]}],_0x390358={..._0x390358,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x293cde(0xcb)])((0x0,sequelize_1['fn'])(_0x293cde(0xb7),(0x0,sequelize_1[_0x293cde(0xd1)])(_0x293cde(0xae))),'LIKE','%'+_0x447bfc+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x293cde(0xcc)]]:'%'+_0x447bfc+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x293cde(0xd1)])(_0x293cde(0xb2))),_0x293cde(0xd5),'%'+_0x447bfc+'%')}]};}_0x244ab3&&(_0x390358={'createdAt':{[sequelize_1['Op'][_0x293cde(0xc9)]]:[+(0x0,date_fns_1[_0x293cde(0xd2)])((0x0,date_fns_1[_0x293cde(0xbb)])(_0x244ab3)),+(0x0,date_fns_1[_0x293cde(0xca)])((0x0,date_fns_1[_0x293cde(0xbb)])(_0x244ab3))]}});_0x463926&&(_0x390358={'updatedAt':{[sequelize_1['Op'][_0x293cde(0xc9)]]:[+(0x0,date_fns_1[_0x293cde(0xd2)])((0x0,date_fns_1[_0x293cde(0xbb)])(_0x463926)),+(0x0,date_fns_1[_0x293cde(0xca)])((0x0,date_fns_1[_0x293cde(0xbb)])(_0x463926))]}});if(_0x51d72a===_0x293cde(0xd4)){const _0x4242df=await(0x0,ShowUserService_1['default'])(_0x361266),_0x47e46a=_0x4242df['queues']['map'](_0x421382=>_0x421382['id']);_0x390358={[sequelize_1['Op']['or']]:[{'userId':_0x361266},{'status':_0x293cde(0xa6)}],'queueId':{[sequelize_1['Op']['or']]:[_0x47e46a,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x293cde(0xc8)](_0x53f619)&&_0x53f619[_0x293cde(0xc7)]>0x0){const _0x5348fe=[];for(let _0x5d1cd3 of _0x53f619){const _0x4102eb=await TicketTag_1['default'][_0x293cde(0xa7)]({'where':{'tagId':_0x5d1cd3}});_0x4102eb&&_0x5348fe[_0x293cde(0xbe)](_0x4102eb['map'](_0x221d5b=>_0x221d5b[_0x293cde(0xbc)]));}const _0x3abfe4=(0x0,lodash_1['intersection'])(..._0x5348fe);_0x390358={..._0x390358,'id':{[sequelize_1['Op']['in']]:_0x3abfe4}};}if(Array[_0x293cde(0xc8)](_0x47c6c0)&&_0x47c6c0[_0x293cde(0xc7)]>0x0){const _0x4bac41=[];for(let _0x4fe15a of _0x47c6c0){const _0x2ce691=await Ticket_1[_0x293cde(0xbd)][_0x293cde(0xa7)]({'where':{'userId':_0x4fe15a}});_0x2ce691&&_0x4bac41['push'](_0x2ce691[_0x293cde(0xc2)](_0x57c744=>_0x57c744['id']));}const _0x3ddbfb=(0x0,lodash_1['intersection'])(..._0x4bac41);_0x390358={..._0x390358,'id':{[sequelize_1['Op']['in']]:_0x3ddbfb}};}const _0x4786b0=0x28,_0x2aa93f=_0x4786b0*(+pageNumber-0x1);_0x390358={..._0x390358,'companyId':_0x358c42};const {count:_0x515b5b,rows:_0x46a9da}=await Ticket_1[_0x293cde(0xbd)][_0x293cde(0xb8)]({'where':_0x390358,'include':_0x4ad862,'distinct':!![],'limit':_0x4786b0,'offset':_0x2aa93f,'order':[[_0x293cde(0xd3),_0x293cde(0xa3)]],'subQuery':![]}),_0x4eecac=_0x515b5b>_0x2aa93f+_0x46a9da[_0x293cde(0xc7)];return{'tickets':_0x46a9da,'count':_0x515b5b,'hasMore':_0x4eecac};};exports['default']=ListTicketsServiceKanban;