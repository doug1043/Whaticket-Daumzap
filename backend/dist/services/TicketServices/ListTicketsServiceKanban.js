const a669_0x10b633=a669_0x15a9;(function(_0x6747ab,_0x6f393e){const _0x3e618e=a669_0x15a9,_0x58e875=_0x6747ab();while(!![]){try{const _0x254653=parseInt(_0x3e618e(0x16b))/0x1+parseInt(_0x3e618e(0x180))/0x2+-parseInt(_0x3e618e(0x14f))/0x3+-parseInt(_0x3e618e(0x17f))/0x4*(-parseInt(_0x3e618e(0x167))/0x5)+parseInt(_0x3e618e(0x172))/0x6*(-parseInt(_0x3e618e(0x14d))/0x7)+-parseInt(_0x3e618e(0x168))/0x8+parseInt(_0x3e618e(0x15b))/0x9;if(_0x254653===_0x6f393e)break;else _0x58e875['push'](_0x58e875['shift']());}catch(_0x4af1d2){_0x58e875['push'](_0x58e875['shift']());}}}(a669_0xbb20,0x78f82));const a669_0x5bf561=(function(){let _0x4a55ad=!![];return function(_0x2ffd1e,_0x3b35ad){const _0x3cab79=_0x4a55ad?function(){const _0x31e6e0=a669_0x15a9;if(_0x3b35ad){const _0xf32dad=_0x3b35ad[_0x31e6e0(0x16f)](_0x2ffd1e,arguments);return _0x3b35ad=null,_0xf32dad;}}:function(){};return _0x4a55ad=![],_0x3cab79;};}()),a669_0x422291=a669_0x5bf561(this,function(){const _0x51c6bd=a669_0x15a9;return a669_0x422291['toString']()[_0x51c6bd(0x166)](_0x51c6bd(0x164))['toString']()[_0x51c6bd(0x178)](a669_0x422291)[_0x51c6bd(0x166)](_0x51c6bd(0x164));});a669_0x422291();'use strict';var __importDefault=this&&this[a669_0x10b633(0x16c)]||function(_0x17ef33){const _0xf6dfe1=a669_0x10b633;return _0x17ef33&&_0x17ef33[_0xf6dfe1(0x150)]?_0x17ef33:{'default':_0x17ef33};};function a669_0xbb20(){const _0x109a33=['__esModule','color','LIKE','true','../../models/Queue','lodash','ticketId','../../models/Whatsapp','LOWER','length','push','4106403gQwRGu','tags','map','user','messages','defineProperty','email','findAll','open','(((.+)+)+)+$','../../models/Message','search','2054135eFXNLM','2380832dxesSc','parseISO','profile','369691kJiidn','__importDefault','../../models/Ticket','pending','apply','findAndCountAll','superv','98022AzNdPB','endOfDay','trim','presence','startOfDay','queues','constructor','name','between','DESC','sequelize','intersection','admin','8QqTFxe','880024AzVdaq','default','where','body','contact.name','col','301TQNuJW','date-fns','1776117NWHFqf'];a669_0xbb20=function(){return _0x109a33;};return a669_0xbb20();}Object[a669_0x10b633(0x160)](exports,'__esModule',{'value':!![]});const sequelize_1=require(a669_0x10b633(0x17c)),date_fns_1=require(a669_0x10b633(0x14e)),Ticket_1=__importDefault(require(a669_0x10b633(0x16d))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a669_0x10b633(0x165))),Queue_1=__importDefault(require(a669_0x10b633(0x154))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require(a669_0x10b633(0x155)),Whatsapp_1=__importDefault(require(a669_0x10b633(0x157))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x1614a8,tags:_0x9c18c9,users:_0x4d0f59,status:_0x426980,date:_0x100227,updatedAt:_0x4d8a47,showAll:_0x6aa6f,userId:_0x27632c,withUnreadMessages:_0xd56db8,companyId:_0x3c4c7e})=>{const _0x700081=a669_0x10b633,_0x426b8f=await(0x0,ShowUserService_1[_0x700081(0x181)])(_0x27632c);let _0x2cd396={};if(_0x426b8f[_0x700081(0x16a)]===_0x700081(0x17e))_0x2cd396={'queueId':{[sequelize_1['Op']['or']]:_0x1614a8[_0x700081(0x159)]>0x0?[_0x1614a8,null]:[{[sequelize_1['Op']['ne']]:null},null]}};else{if(_0x426b8f[_0x700081(0x16a)]===_0x700081(0x171)){const _0x191d2b=await User_1['default']['findAll']({'where':{'companyId':_0x3c4c7e,'profile':'admin'},'attributes':['id']}),_0x59cb0d=_0x191d2b[_0x700081(0x15d)](_0x153201=>_0x153201['id']);_0x2cd396={'queueId':{[sequelize_1['Op']['or']]:_0x1614a8[_0x700081(0x159)]>0x0?[_0x1614a8,null]:[{[sequelize_1['Op']['ne']]:null},null]},[sequelize_1['Op']['or']]:[{'userId':{[sequelize_1['Op']['notIn']]:_0x59cb0d}},{'userId':null}]};}else _0x1614a8['length']===0x0?_0x2cd396={'userId':_0x27632c,'queueId':null}:_0x2cd396={[sequelize_1['Op']['or']]:[{'userId':_0x27632c},{'status':_0x700081(0x16e),'queueId':{[sequelize_1['Op']['in']]:_0x1614a8}}]};}let _0x383335;_0x383335=[{'model':Contact_1[_0x700081(0x181)],'as':'contact','attributes':['id','name','number',_0x700081(0x161),_0x700081(0x175)]},{'model':Queue_1[_0x700081(0x181)],'as':'queue','attributes':['id',_0x700081(0x179),_0x700081(0x151)]},{'model':User_1[_0x700081(0x181)],'as':_0x700081(0x15e),'attributes':['id','name']},{'model':Tag_1[_0x700081(0x181)],'as':_0x700081(0x15c),'attributes':['id',_0x700081(0x179),'color']},{'model':Whatsapp_1[_0x700081(0x181)],'as':'whatsapp','attributes':[_0x700081(0x179)]}];_0x6aa6f===_0x700081(0x153)&&(_0x2cd396={'queueId':{[sequelize_1['Op']['or']]:[_0x1614a8,null]},'userId':_0x27632c});_0x2cd396={..._0x2cd396,'status':{[sequelize_1['Op']['or']]:[_0x700081(0x16e),_0x700081(0x163)]}};if(searchParam){const _0x48a0b0=searchParam['toLocaleLowerCase']()[_0x700081(0x174)]();_0x383335=[..._0x383335,{'model':Message_1[_0x700081(0x181)],'as':_0x700081(0x15f),'attributes':['id',_0x700081(0x14a)],'where':{'body':(0x0,sequelize_1[_0x700081(0x182)])((0x0,sequelize_1['fn'])(_0x700081(0x158),(0x0,sequelize_1['col'])(_0x700081(0x14a))),_0x700081(0x152),'%'+_0x48a0b0+'%')},'required':![],'duplicating':![]}],_0x2cd396={..._0x2cd396,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x700081(0x182)])((0x0,sequelize_1['fn'])(_0x700081(0x158),(0x0,sequelize_1[_0x700081(0x14c)])(_0x700081(0x14b))),_0x700081(0x152),'%'+_0x48a0b0+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x48a0b0+'%'}},{'$message.body$':(0x0,sequelize_1[_0x700081(0x182)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x700081(0x14c)])(_0x700081(0x14a))),'LIKE','%'+_0x48a0b0+'%')}]};}_0x100227&&(_0x2cd396={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x700081(0x176)])((0x0,date_fns_1['parseISO'])(_0x100227)),+(0x0,date_fns_1[_0x700081(0x173)])((0x0,date_fns_1[_0x700081(0x169)])(_0x100227))]}});_0x4d8a47&&(_0x2cd396={'updatedAt':{[sequelize_1['Op'][_0x700081(0x17a)]]:[+(0x0,date_fns_1[_0x700081(0x176)])((0x0,date_fns_1[_0x700081(0x169)])(_0x4d8a47)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x700081(0x169)])(_0x4d8a47))]}});if(_0xd56db8===_0x700081(0x153)){const _0x91d7a2=await(0x0,ShowUserService_1['default'])(_0x27632c),_0x5c6c18=_0x91d7a2[_0x700081(0x177)][_0x700081(0x15d)](_0x48aefc=>_0x48aefc['id']);_0x2cd396={[sequelize_1['Op']['or']]:[{'userId':_0x27632c},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x5c6c18,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array['isArray'](_0x9c18c9)&&_0x9c18c9[_0x700081(0x159)]>0x0){const _0x22fa8f=[];for(let _0x2c5a4e of _0x9c18c9){const _0x454418=await TicketTag_1[_0x700081(0x181)][_0x700081(0x162)]({'where':{'tagId':_0x2c5a4e}});_0x454418&&_0x22fa8f[_0x700081(0x15a)](_0x454418[_0x700081(0x15d)](_0x5715c0=>_0x5715c0[_0x700081(0x156)]));}const _0x396802=(0x0,lodash_1[_0x700081(0x17d)])(..._0x22fa8f);_0x2cd396={..._0x2cd396,'id':{[sequelize_1['Op']['in']]:_0x396802}};}if(Array['isArray'](_0x4d0f59)&&_0x4d0f59[_0x700081(0x159)]>0x0){const _0x1208a2=[];for(let _0x366a46 of _0x4d0f59){const _0x22b1f8=await Ticket_1[_0x700081(0x181)]['findAll']({'where':{'userId':_0x366a46}});_0x22b1f8&&_0x1208a2[_0x700081(0x15a)](_0x22b1f8['map'](_0x524e03=>_0x524e03['id']));}const _0x2fb6ba=(0x0,lodash_1[_0x700081(0x17d)])(..._0x1208a2);_0x2cd396={..._0x2cd396,'id':{[sequelize_1['Op']['in']]:_0x2fb6ba}};}const _0x2f5b24=0x28,_0x4c8721=_0x2f5b24*(+pageNumber-0x1);_0x2cd396={..._0x2cd396,'companyId':_0x3c4c7e};const {count:_0x5a67eb,rows:_0x50d3f9}=await Ticket_1[_0x700081(0x181)][_0x700081(0x170)]({'where':_0x2cd396,'include':_0x383335,'distinct':!![],'limit':_0x2f5b24,'offset':_0x4c8721,'order':[['updatedAt',_0x700081(0x17b)]],'subQuery':![]}),_0x112f8f=_0x5a67eb>_0x4c8721+_0x50d3f9[_0x700081(0x159)];return{'tickets':_0x50d3f9,'count':_0x5a67eb,'hasMore':_0x112f8f};};function a669_0x15a9(_0x3b5cc1,_0xe7b8ea){const _0x3691cd=a669_0xbb20();return a669_0x15a9=function(_0x422291,_0x5bf561){_0x422291=_0x422291-0x14a;let _0xbb20f6=_0x3691cd[_0x422291];return _0xbb20f6;},a669_0x15a9(_0x3b5cc1,_0xe7b8ea);}exports[a669_0x10b633(0x181)]=ListTicketsServiceKanban;