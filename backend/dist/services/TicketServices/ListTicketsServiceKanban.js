const a554_0x28c0b8=a554_0x896f;function a554_0x896f(_0x243f0e,_0x4d7b97){const _0x530c65=a554_0xcb4f();return a554_0x896f=function(_0x340e92,_0x284321){_0x340e92=_0x340e92-0x82;let _0xcb4f9b=_0x530c65[_0x340e92];return _0xcb4f9b;},a554_0x896f(_0x243f0e,_0x4d7b97);}(function(_0x4fdff4,_0x2884c2){const _0x28f956=a554_0x896f,_0x32722d=_0x4fdff4();while(!![]){try{const _0x13a504=-parseInt(_0x28f956(0xb6))/0x1*(parseInt(_0x28f956(0xb7))/0x2)+parseInt(_0x28f956(0x8f))/0x3*(-parseInt(_0x28f956(0x89))/0x4)+-parseInt(_0x28f956(0x9d))/0x5*(parseInt(_0x28f956(0xaa))/0x6)+parseInt(_0x28f956(0xa0))/0x7*(parseInt(_0x28f956(0x8b))/0x8)+-parseInt(_0x28f956(0x83))/0x9*(parseInt(_0x28f956(0x97))/0xa)+parseInt(_0x28f956(0x8d))/0xb*(-parseInt(_0x28f956(0x8e))/0xc)+parseInt(_0x28f956(0xa6))/0xd;if(_0x13a504===_0x2884c2)break;else _0x32722d['push'](_0x32722d['shift']());}catch(_0x43ed55){_0x32722d['push'](_0x32722d['shift']());}}}(a554_0xcb4f,0x265c3));const a554_0x284321=(function(){let _0x137157=!![];return function(_0x5874a9,_0x5c3197){const _0x3355ef=_0x137157?function(){const _0x37a1c6=a554_0x896f;if(_0x5c3197){const _0x530b15=_0x5c3197[_0x37a1c6(0x98)](_0x5874a9,arguments);return _0x5c3197=null,_0x530b15;}}:function(){};return _0x137157=![],_0x3355ef;};}()),a554_0x340e92=a554_0x284321(this,function(){const _0x3333e7=a554_0x896f;return a554_0x340e92[_0x3333e7(0xb2)]()[_0x3333e7(0xaf)](_0x3333e7(0xbb))['toString']()[_0x3333e7(0x90)](a554_0x340e92)['search']('(((.+)+)+)+$');});a554_0x340e92();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x52c754){return _0x52c754&&_0x52c754['__esModule']?_0x52c754:{'default':_0x52c754};};Object[a554_0x28c0b8(0xbd)](exports,a554_0x28c0b8(0x91),{'value':!![]});const sequelize_1=require(a554_0x28c0b8(0x9a)),date_fns_1=require(a554_0x28c0b8(0xb3)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a554_0x28c0b8(0x93))),Message_1=__importDefault(require(a554_0x28c0b8(0xa1))),Queue_1=__importDefault(require(a554_0x28c0b8(0x99))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require(a554_0x28c0b8(0xa3))),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a554_0x28c0b8(0xb0))),lodash_1=require(a554_0x28c0b8(0xa2)),Whatsapp_1=__importDefault(require(a554_0x28c0b8(0xb4))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x3437a6,tags:_0x5023c7,users:_0x490968,status:_0x3bf227,date:_0xed1661,updatedAt:_0x58247d,showAll:_0x558de8,userId:_0x4c7463,withUnreadMessages:_0x265bfe,companyId:_0x1f2252})=>{const _0x478d7e=a554_0x28c0b8;let _0x56b760={[sequelize_1['Op']['or']]:[{'userId':_0x4c7463},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x3437a6,null]}},_0x958f93;_0x958f93=[{'model':Contact_1[_0x478d7e(0xac)],'as':'contact','attributes':['id','name',_0x478d7e(0xab),_0x478d7e(0x84),_0x478d7e(0xa4)]},{'model':Queue_1[_0x478d7e(0xac)],'as':_0x478d7e(0xbc),'attributes':['id','name','color']},{'model':User_1[_0x478d7e(0xac)],'as':_0x478d7e(0xa5),'attributes':['id',_0x478d7e(0xa8)]},{'model':Tag_1[_0x478d7e(0xac)],'as':_0x478d7e(0xad),'attributes':['id',_0x478d7e(0xa8),_0x478d7e(0x85)]},{'model':Whatsapp_1['default'],'as':'whatsapp','attributes':[_0x478d7e(0xa8)]}];_0x558de8===_0x478d7e(0x92)&&(_0x56b760={'queueId':{[sequelize_1['Op']['or']]:[_0x3437a6,null]},'userId':_0x4c7463});_0x56b760={..._0x56b760,'status':{[sequelize_1['Op']['or']]:[_0x478d7e(0xa7),'open']}};if(searchParam){const _0x35f258=searchParam['toLocaleLowerCase']()[_0x478d7e(0x96)]();_0x958f93=[..._0x958f93,{'model':Message_1['default'],'as':_0x478d7e(0x95),'attributes':['id',_0x478d7e(0x8a)],'where':{'body':(0x0,sequelize_1[_0x478d7e(0xb1)])((0x0,sequelize_1['fn'])(_0x478d7e(0x9b),(0x0,sequelize_1[_0x478d7e(0x94)])(_0x478d7e(0x8a))),'LIKE','%'+_0x35f258+'%')},'required':![],'duplicating':![]}],_0x56b760={..._0x56b760,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x478d7e(0x9b),(0x0,sequelize_1['col'])(_0x478d7e(0x9e))),_0x478d7e(0x8c),'%'+_0x35f258+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x35f258+'%'}},{'$message.body$':(0x0,sequelize_1[_0x478d7e(0xb1)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['col'])('body')),_0x478d7e(0x8c),'%'+_0x35f258+'%')}]};}_0xed1661&&(_0x56b760={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x478d7e(0xa9)])((0x0,date_fns_1[_0x478d7e(0xbe)])(_0xed1661)),+(0x0,date_fns_1[_0x478d7e(0x86)])((0x0,date_fns_1[_0x478d7e(0xbe)])(_0xed1661))]}});_0x58247d&&(_0x56b760={'updatedAt':{[sequelize_1['Op'][_0x478d7e(0x87)]]:[+(0x0,date_fns_1[_0x478d7e(0xa9)])((0x0,date_fns_1[_0x478d7e(0xbe)])(_0x58247d)),+(0x0,date_fns_1[_0x478d7e(0x86)])((0x0,date_fns_1[_0x478d7e(0xbe)])(_0x58247d))]}});if(_0x265bfe==='true'){const _0x55889e=await(0x0,ShowUserService_1[_0x478d7e(0xac)])(_0x4c7463),_0x2fd6e5=_0x55889e['queues'][_0x478d7e(0xae)](_0x18b4c0=>_0x18b4c0['id']);_0x56b760={[sequelize_1['Op']['or']]:[{'userId':_0x4c7463},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x2fd6e5,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x478d7e(0x9f)](_0x5023c7)&&_0x5023c7[_0x478d7e(0xb9)]>0x0){const _0x46657d=[];for(let _0x3ccd96 of _0x5023c7){const _0x321472=await TicketTag_1[_0x478d7e(0xac)][_0x478d7e(0xb8)]({'where':{'tagId':_0x3ccd96}});_0x321472&&_0x46657d['push'](_0x321472[_0x478d7e(0xae)](_0x4979e1=>_0x4979e1['ticketId']));}const _0x15a803=(0x0,lodash_1[_0x478d7e(0x82)])(..._0x46657d);_0x56b760={..._0x56b760,'id':{[sequelize_1['Op']['in']]:_0x15a803}};}if(Array['isArray'](_0x490968)&&_0x490968['length']>0x0){const _0x3d73d1=[];for(let _0x29f494 of _0x490968){const _0x389573=await Ticket_1[_0x478d7e(0xac)][_0x478d7e(0xb8)]({'where':{'userId':_0x29f494}});_0x389573&&_0x3d73d1[_0x478d7e(0x88)](_0x389573[_0x478d7e(0xae)](_0x81743c=>_0x81743c['id']));}const _0x4a9150=(0x0,lodash_1[_0x478d7e(0x82)])(..._0x3d73d1);_0x56b760={..._0x56b760,'id':{[sequelize_1['Op']['in']]:_0x4a9150}};}const _0x42608d=0x28,_0x2b60ef=_0x42608d*(+pageNumber-0x1);_0x56b760={..._0x56b760,'companyId':_0x1f2252};const {count:_0x35c75c,rows:_0x447649}=await Ticket_1[_0x478d7e(0xac)][_0x478d7e(0xba)]({'where':_0x56b760,'include':_0x958f93,'distinct':!![],'limit':_0x42608d,'offset':_0x2b60ef,'order':[[_0x478d7e(0x9c),_0x478d7e(0xb5)]],'subQuery':![]}),_0x4eb4e3=_0x35c75c>_0x2b60ef+_0x447649[_0x478d7e(0xb9)];return{'tickets':_0x447649,'count':_0x35c75c,'hasMore':_0x4eb4e3};};function a554_0xcb4f(){const _0x295246=['__esModule','true','../../models/Contact','col','messages','trim','6910kFzlBc','apply','../../models/Queue','sequelize','LOWER','updatedAt','45BjGKTq','contact.name','isArray','252fUxPqK','../../models/Message','lodash','../UserServices/ShowUserService','presence','user','10176075ntfLtn','pending','name','startOfDay','25878Etjctj','number','default','tags','map','search','../../models/TicketTag','where','toString','date-fns','../../models/Whatsapp','DESC','5vthkxK','57648GlnYJo','findAll','length','findAndCountAll','(((.+)+)+)+$','queue','defineProperty','parseISO','intersection','3645wsQmYa','email','color','endOfDay','between','push','20arLSxE','body','27760AlWCuf','LIKE','53141YLJTii','180swaFif','129189pvjOPY','constructor'];a554_0xcb4f=function(){return _0x295246;};return a554_0xcb4f();}exports['default']=ListTicketsServiceKanban;