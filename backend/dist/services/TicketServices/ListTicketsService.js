const a524_0x5481c5=a524_0x5aef;(function(_0x2c8633,_0x3dd592){const _0x28acff=a524_0x5aef,_0x382977=_0x2c8633();while(!![]){try{const _0x2270fa=parseInt(_0x28acff(0x1e7))/0x1*(parseInt(_0x28acff(0x20b))/0x2)+parseInt(_0x28acff(0x1d5))/0x3+-parseInt(_0x28acff(0x212))/0x4*(parseInt(_0x28acff(0x1eb))/0x5)+parseInt(_0x28acff(0x1e6))/0x6*(parseInt(_0x28acff(0x1ee))/0x7)+parseInt(_0x28acff(0x1fe))/0x8*(parseInt(_0x28acff(0x1f0))/0x9)+-parseInt(_0x28acff(0x1f8))/0xa*(parseInt(_0x28acff(0x1fc))/0xb)+parseInt(_0x28acff(0x20d))/0xc*(-parseInt(_0x28acff(0x1e2))/0xd);if(_0x2270fa===_0x3dd592)break;else _0x382977['push'](_0x382977['shift']());}catch(_0x24b47a){_0x382977['push'](_0x382977['shift']());}}}(a524_0x1d2a,0x378f7));const a524_0x13027d=(function(){let _0x4b31b0=!![];return function(_0x423215,_0x554cb9){const _0x492d52=_0x4b31b0?function(){const _0x9ca3d5=a524_0x5aef;if(_0x554cb9){const _0x52ecd8=_0x554cb9[_0x9ca3d5(0x20e)](_0x423215,arguments);return _0x554cb9=null,_0x52ecd8;}}:function(){};return _0x4b31b0=![],_0x492d52;};}()),a524_0x162905=a524_0x13027d(this,function(){const _0x10469c=a524_0x5aef;return a524_0x162905[_0x10469c(0x1f9)]()[_0x10469c(0x210)](_0x10469c(0x1dc))[_0x10469c(0x1f9)]()[_0x10469c(0x209)](a524_0x162905)[_0x10469c(0x210)](_0x10469c(0x1dc));});a524_0x162905();'use strict';function a524_0x5aef(_0x2dbb60,_0x4a2cea){const _0x31c6b2=a524_0x1d2a();return a524_0x5aef=function(_0x162905,_0x13027d){_0x162905=_0x162905-0x1d4;let _0x1d2ada=_0x31c6b2[_0x162905];return _0x1d2ada;},a524_0x5aef(_0x2dbb60,_0x4a2cea);}var __importDefault=this&&this['__importDefault']||function(_0x1d53fb){return _0x1d53fb&&_0x1d53fb['__esModule']?_0x1d53fb:{'default':_0x1d53fb};};function a524_0x1d2a(){const _0x55355a=['../UserServices/ShowUserService','allTicket','trim','messages','between','where','../../models/Message','162580xnQuwO','toString','LOWER','number','66LKAKtv','true','32PwphiK','body','length','updatedAt','LIKE','pending','findAndCountAll','presence','isArray','../../models/Tag','startOfDay','constructor','queues','361956iSDpdT','../../models/Ticket','2192376OEKYmL','apply','not','search','sequelize','4ezCNau','lodash','../../models/Whatsapp','color','toLocaleLowerCase','intersection','33936YqTWWK','enabled','default','parseISO','findAll','tags','contact.name','(((.+)+)+)+$','DESC','contact','push','queue','user','39pEKvFf','endOfDay','../../models/TicketTag','col','558qjQHYb','2szjfRC','date-fns','ticketId','profile','884110GIXJFu','map','../../models/User','21301rayKoY','name','885987vqTOJj'];a524_0x1d2a=function(){return _0x55355a;};return a524_0x1d2a();}Object['defineProperty'](exports,'__esModule',{'value':!![]});const sequelize_1=require(a524_0x5481c5(0x211)),date_fns_1=require(a524_0x5481c5(0x1e8)),Ticket_1=__importDefault(require(a524_0x5481c5(0x20c))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a524_0x5481c5(0x1f7))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a524_0x5481c5(0x1ed))),ShowUserService_1=__importDefault(require(a524_0x5481c5(0x1f1))),Tag_1=__importDefault(require(a524_0x5481c5(0x207))),TicketTag_1=__importDefault(require(a524_0x5481c5(0x1e4))),lodash_1=require(a524_0x5481c5(0x213)),Whatsapp_1=__importDefault(require(a524_0x5481c5(0x214))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x1811ae,tags:_0x40886b,users:_0x3544ab,status:_0x21e78e,date:_0x4d2bca,startDate:_0x43ce8c,endDate:_0x5c31fb,updatedAt:_0x14fa2e,showAll:_0x4bc33d,userId:_0x3f2a7b,withUnreadMessages:_0x5649e7,companyId:_0x3c66ce})=>{const _0x591958=a524_0x5481c5,_0x1e05a4=await(0x0,ShowUserService_1[_0x591958(0x1d7)])(_0x3f2a7b),_0x20e5f1=_0x1e05a4['queues'][_0x591958(0x1ec)](_0x482e4c=>_0x482e4c['id']);let _0x59001f={[sequelize_1['Op']['or']]:[{'userId':_0x3f2a7b},{'status':_0x591958(0x203)}],'queueId':{[sequelize_1['Op']['or']]:[_0x1811ae,null]}},_0x376c26;_0x376c26=[{'model':Contact_1['default'],'as':_0x591958(0x1de),'attributes':['id',_0x591958(0x1ef),_0x591958(0x1fb),'email','profilePicUrl',_0x591958(0x205)]},{'model':Queue_1['default'],'as':_0x591958(0x1e0),'attributes':['id',_0x591958(0x1ef),_0x591958(0x215)]},{'model':User_1[_0x591958(0x1d7)],'as':_0x591958(0x1e1),'attributes':['id',_0x591958(0x1ef)]},{'model':Tag_1['default'],'as':_0x591958(0x1da),'attributes':['id',_0x591958(0x1ef),_0x591958(0x215)]},{'model':Whatsapp_1[_0x591958(0x1d7)],'as':'whatsapp','attributes':['name']}];if(_0x1e05a4['profile']===_0x591958(0x1e1)&&_0x1e05a4[_0x591958(0x1f2)]===_0x591958(0x1d6)){const _0x14e8ea=[];let _0x56859f=[];_0x56859f=await Ticket_1[_0x591958(0x1d7)][_0x591958(0x1d9)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x1e05a4['id'],null]},'companyId':_0x3c66ce}});_0x56859f&&_0x14e8ea['push'](_0x56859f['map'](_0x2a3ce7=>_0x2a3ce7['id']));const _0x496095=(0x0,lodash_1[_0x591958(0x1d4)])(..._0x14e8ea);_0x59001f={..._0x59001f,'id':_0x496095};}if(_0x1e05a4[_0x591958(0x1ea)]==='user'&&_0x1e05a4['allTicket']==='disabled'){const _0x4d7f6b=[];let _0xe6801a=[];_0xe6801a=await Ticket_1[_0x591958(0x1d7)][_0x591958(0x1d9)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x1e05a4['id'],null]},'companyId':_0x3c66ce,'queueId':{[sequelize_1['Op'][_0x591958(0x20f)]]:null}}});_0xe6801a&&_0x4d7f6b['push'](_0xe6801a['map'](_0x5c6013=>_0x5c6013['id']));const _0xb0b518=(0x0,lodash_1[_0x591958(0x1d4)])(..._0x4d7f6b);_0x59001f={..._0x59001f,'id':_0xb0b518};}_0x4bc33d===_0x591958(0x1fd)&&(_0x59001f={'queueId':{[sequelize_1['Op']['or']]:[_0x1811ae,null]}});_0x21e78e&&(_0x59001f={..._0x59001f,'status':_0x21e78e});_0x43ce8c&&_0x5c31fb&&(_0x59001f={..._0x59001f,'createdAt':{[sequelize_1['Op'][_0x591958(0x1f5)]]:[+(0x0,date_fns_1[_0x591958(0x208)])((0x0,date_fns_1['parseISO'])(_0x43ce8c)),+(0x0,date_fns_1[_0x591958(0x1e3)])((0x0,date_fns_1[_0x591958(0x1d8)])(_0x5c31fb))]}});if(searchParam){const _0x5f149f=searchParam[_0x591958(0x216)]()[_0x591958(0x1f3)]();_0x376c26=[..._0x376c26,{'model':Message_1[_0x591958(0x1d7)],'as':_0x591958(0x1f4),'attributes':['id',_0x591958(0x1ff)],'where':{'body':(0x0,sequelize_1[_0x591958(0x1f6)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x591958(0x1e5)])(_0x591958(0x1ff))),_0x591958(0x202),'%'+_0x5f149f+'%')},'required':![],'duplicating':![]}],_0x59001f={..._0x59001f,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x591958(0x1fa),(0x0,sequelize_1[_0x591958(0x1e5)])(_0x591958(0x1db))),_0x591958(0x202),'%'+_0x5f149f+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x5f149f+'%'}},{'$message.body$':(0x0,sequelize_1[_0x591958(0x1f6)])((0x0,sequelize_1['fn'])(_0x591958(0x1fa),(0x0,sequelize_1[_0x591958(0x1e5)])('body')),_0x591958(0x202),'%'+_0x5f149f+'%')}]};}_0x4d2bca&&(_0x59001f={'createdAt':{[sequelize_1['Op'][_0x591958(0x1f5)]]:[+(0x0,date_fns_1[_0x591958(0x208)])((0x0,date_fns_1[_0x591958(0x1d8)])(_0x4d2bca)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x591958(0x1d8)])(_0x4d2bca))]}});_0x14fa2e&&(_0x59001f={'updatedAt':{[sequelize_1['Op'][_0x591958(0x1f5)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x591958(0x1d8)])(_0x14fa2e)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x591958(0x1d8)])(_0x14fa2e))]}});if(_0x5649e7===_0x591958(0x1fd)){const _0x590add=await(0x0,ShowUserService_1[_0x591958(0x1d7)])(_0x3f2a7b),_0x307c8e=_0x590add[_0x591958(0x20a)][_0x591958(0x1ec)](_0x11f6e6=>_0x11f6e6['id']);_0x59001f={[sequelize_1['Op']['or']]:[{'userId':_0x3f2a7b},{'status':_0x591958(0x203)}],'queueId':{[sequelize_1['Op']['or']]:[_0x307c8e,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x591958(0x206)](_0x40886b)&&_0x40886b[_0x591958(0x200)]>0x0){const _0x48a45e=[];for(let _0x5ac461 of _0x40886b){const _0x2a1210=await TicketTag_1[_0x591958(0x1d7)][_0x591958(0x1d9)]({'where':{'tagId':_0x5ac461}});_0x2a1210&&_0x48a45e[_0x591958(0x1df)](_0x2a1210[_0x591958(0x1ec)](_0x538f43=>_0x538f43[_0x591958(0x1e9)]));}const _0x538aac=(0x0,lodash_1[_0x591958(0x1d4)])(..._0x48a45e);_0x59001f={..._0x59001f,'id':{[sequelize_1['Op']['in']]:_0x538aac}};}if(Array[_0x591958(0x206)](_0x3544ab)&&_0x3544ab[_0x591958(0x200)]>0x0){const _0x1ca20b=[];for(let _0x4bb32b of _0x3544ab){const _0x496bea=await Ticket_1[_0x591958(0x1d7)][_0x591958(0x1d9)]({'where':{'userId':_0x4bb32b}});_0x496bea&&_0x1ca20b[_0x591958(0x1df)](_0x496bea[_0x591958(0x1ec)](_0x4e5ea9=>_0x4e5ea9['id']));}const _0x199591=(0x0,lodash_1[_0x591958(0x1d4)])(..._0x1ca20b);_0x59001f={..._0x59001f,'id':{[sequelize_1['Op']['in']]:_0x199591}};}const _0x59a3fd=0x28,_0x5912c0=_0x59a3fd*(+pageNumber-0x1);_0x59001f={..._0x59001f,'companyId':_0x3c66ce};const {count:_0x29b441,rows:_0x11748e}=await Ticket_1[_0x591958(0x1d7)][_0x591958(0x204)]({'where':_0x59001f,'include':_0x376c26,'distinct':!![],'limit':_0x59a3fd,'offset':_0x5912c0,'order':[[_0x591958(0x201),_0x591958(0x1dd)]],'subQuery':![]}),_0x2fca6b=_0x29b441>_0x5912c0+_0x11748e[_0x591958(0x200)];return{'tickets':_0x11748e,'count':_0x29b441,'hasMore':_0x2fca6b};};exports[a524_0x5481c5(0x1d7)]=ListTicketsService;