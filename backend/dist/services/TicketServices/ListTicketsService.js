const a559_0x5a414a=a559_0x279c;(function(_0x42a85b,_0x5d221e){const _0xacdfa1=a559_0x279c,_0x339b7f=_0x42a85b();while(!![]){try{const _0x109cea=parseInt(_0xacdfa1(0xcd))/0x1*(-parseInt(_0xacdfa1(0xb6))/0x2)+parseInt(_0xacdfa1(0xe9))/0x3*(parseInt(_0xacdfa1(0xea))/0x4)+parseInt(_0xacdfa1(0xee))/0x5*(parseInt(_0xacdfa1(0xf6))/0x6)+-parseInt(_0xacdfa1(0xfb))/0x7*(-parseInt(_0xacdfa1(0xd7))/0x8)+parseInt(_0xacdfa1(0xbe))/0x9*(-parseInt(_0xacdfa1(0xda))/0xa)+parseInt(_0xacdfa1(0xc9))/0xb*(-parseInt(_0xacdfa1(0xbf))/0xc)+parseInt(_0xacdfa1(0xf9))/0xd*(parseInt(_0xacdfa1(0xca))/0xe);if(_0x109cea===_0x5d221e)break;else _0x339b7f['push'](_0x339b7f['shift']());}catch(_0x3fdb38){_0x339b7f['push'](_0x339b7f['shift']());}}}(a559_0x2541,0xaba99));const a559_0x337024=(function(){let _0x5e850e=!![];return function(_0x3924af,_0x47ce96){const _0x3c8e3e=_0x5e850e?function(){if(_0x47ce96){const _0x380cc3=_0x47ce96['apply'](_0x3924af,arguments);return _0x47ce96=null,_0x380cc3;}}:function(){};return _0x5e850e=![],_0x3c8e3e;};}()),a559_0x1f18c6=a559_0x337024(this,function(){const _0x2e4f37=a559_0x279c;return a559_0x1f18c6[_0x2e4f37(0xf0)]()[_0x2e4f37(0xbd)](_0x2e4f37(0xf1))[_0x2e4f37(0xf0)]()[_0x2e4f37(0xfd)](a559_0x1f18c6)[_0x2e4f37(0xbd)](_0x2e4f37(0xf1));});a559_0x1f18c6();'use strict';function a559_0x2541(){const _0x3bf4d3=['../../models/Whatsapp','endOfDay','contact.name','push','presence','queue','tags','email','3746748hCVTYR','4ZyIypF','isGroup','../../models/User','between','37855AkvnxZ','whatsapp','toString','(((.+)+)+)+$','color','disabled','DESC','findAndCountAll','492RUvzBJ','../../models/Contact','like','61009kaCtIn','defineProperty','27853GCQTTn','closed','constructor','where','length','enabled','2oZZDvp','../../models/Ticket','groupsTab','admin','../../models/Tag','queues','col','search','130104ZKjIDj','12PKYHRA','__esModule','profile','allTicket','updatedAt','../../helpers/CheckSettings','pending','name','default','../UserServices/ShowUserService','15376790DQBslH','658wsDlGU','number','LOWER','111323YeDKSs','isArray','findAll','contact','GetCompanySetting','toLocaleLowerCase','date-fns','user','../../models/Queue','LIKE','536sLncFF','intersection','true','100LkzdLV','startOfDay','map','messages','body','../../models/Message','parseISO'];a559_0x2541=function(){return _0x3bf4d3;};return a559_0x2541();}var __importDefault=this&&this['__importDefault']||function(_0x6263ea){return _0x6263ea&&_0x6263ea['__esModule']?_0x6263ea:{'default':_0x6263ea};};Object[a559_0x5a414a(0xfa)](exports,a559_0x5a414a(0xc0),{'value':!![]});function a559_0x279c(_0x18d31d,_0x4a96d4){const _0x5c2358=a559_0x2541();return a559_0x279c=function(_0x1f18c6,_0x337024){_0x1f18c6=_0x1f18c6-0xb6;let _0x25413a=_0x5c2358[_0x1f18c6];return _0x25413a;},a559_0x279c(_0x18d31d,_0x4a96d4);}const sequelize_1=require('sequelize'),date_fns_1=require(a559_0x5a414a(0xd3)),lodash_1=require('lodash'),Ticket_1=__importDefault(require(a559_0x5a414a(0xb7))),Contact_1=__importDefault(require(a559_0x5a414a(0xf7))),Message_1=__importDefault(require(a559_0x5a414a(0xdf))),Queue_1=__importDefault(require(a559_0x5a414a(0xd5))),User_1=__importDefault(require(a559_0x5a414a(0xec))),ShowUserService_1=__importDefault(require(a559_0x5a414a(0xc8))),Tag_1=__importDefault(require(a559_0x5a414a(0xba))),TicketTag_1=__importDefault(require('../../models/TicketTag')),Whatsapp_1=__importDefault(require(a559_0x5a414a(0xe1))),CheckSettings_1=require(a559_0x5a414a(0xc4)),ListTicketsService=async({isSearch:isSearch=![],searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x4bb105,tags:_0x554a6d,users:_0x2365b2,status:_0x30345e,groups:_0x4f44e0,date:_0x56fbbb,updatedAt:_0x3cb22f,showAll:_0x441b95,userId:_0x3c7857,withUnreadMessages:_0x54cc7d,notClosed:_0x724a2d,all:_0xcb70fe,companyId:_0x1812e5})=>{const _0x3acd26=a559_0x5a414a,_0x263599=!isSearch&&await(0x0,CheckSettings_1[_0x3acd26(0xd1)])(_0x1812e5,_0x3acd26(0xb8),_0x3acd26(0xf3))===_0x3acd26(0x100),_0x282d42=await(0x0,ShowUserService_1[_0x3acd26(0xc7)])(_0x3c7857);let _0x199ead={};_0x282d42[_0x3acd26(0xc2)]===_0x3acd26(0x100)||_0x282d42[_0x3acd26(0xc1)]===_0x3acd26(0xb9)?_0x199ead={'queueId':{[sequelize_1['Op']['or']]:_0x4bb105[_0x3acd26(0xff)]>0x0?[_0x4bb105,null]:[{[sequelize_1['Op']['ne']]:null},null]}}:_0x4bb105[_0x3acd26(0xff)]===0x0?_0x199ead={[sequelize_1['Op']['or']]:[{'userId':_0x3c7857},{'status':_0x3acd26(0xc5)}],'queueId':null}:_0x199ead={[sequelize_1['Op']['or']]:[{'userId':_0x3c7857},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x4bb105]}};_0x263599&&(_0x199ead[_0x3acd26(0xeb)]=_0x4f44e0===_0x3acd26(0xd9));let _0x13d8b6;_0x13d8b6=[{'model':Contact_1[_0x3acd26(0xc7)],'as':_0x3acd26(0xd0),'attributes':['id','name',_0x3acd26(0xcb),_0x3acd26(0xe8),'profilePicUrl',_0x3acd26(0xe5)]},{'model':Queue_1[_0x3acd26(0xc7)],'as':_0x3acd26(0xe6),'attributes':['id',_0x3acd26(0xc6),'color']},{'model':User_1[_0x3acd26(0xc7)],'as':_0x3acd26(0xd4),'attributes':['id','name']},{'model':Tag_1['default'],'as':_0x3acd26(0xe7),'attributes':['id','name',_0x3acd26(0xf2)]},{'model':Whatsapp_1[_0x3acd26(0xc7)],'as':_0x3acd26(0xef),'attributes':['id',_0x3acd26(0xc6)]}];_0x441b95===_0x3acd26(0xd9)&&_0x282d42[_0x3acd26(0xc1)]===_0x3acd26(0xb9)&&(_0x199ead={'queueId':{[sequelize_1['Op']['or']]:[_0x4bb105,null]}},_0x263599&&(_0x199ead[_0x3acd26(0xeb)]=_0x4f44e0===_0x3acd26(0xd9)));_0x30345e&&(_0x199ead={..._0x199ead,'status':_0x30345e});if(searchParam){const _0x54e773=searchParam[_0x3acd26(0xd2)]()['trim']();_0x13d8b6=[..._0x13d8b6,{'model':Message_1[_0x3acd26(0xc7)],'as':_0x3acd26(0xdd),'attributes':['id',_0x3acd26(0xde)],'where':{'body':(0x0,sequelize_1[_0x3acd26(0xfe)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x3acd26(0xbc)])('body')),_0x3acd26(0xd6),'%'+_0x54e773+'%')},'required':![],'duplicating':![]}],_0x199ead={..._0x199ead,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x3acd26(0xfe)])((0x0,sequelize_1['fn'])(_0x3acd26(0xcc),(0x0,sequelize_1[_0x3acd26(0xbc)])(_0x3acd26(0xe3))),_0x3acd26(0xd6),'%'+_0x54e773+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x3acd26(0xf8)]]:'%'+_0x54e773+'%'}},{'$message.body$':(0x0,sequelize_1[_0x3acd26(0xfe)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x3acd26(0xbc)])(_0x3acd26(0xde))),'LIKE','%'+_0x54e773+'%')}]};}_0x56fbbb&&(_0x199ead={'createdAt':{[sequelize_1['Op'][_0x3acd26(0xed)]]:[+(0x0,date_fns_1[_0x3acd26(0xdb)])((0x0,date_fns_1[_0x3acd26(0xe0)])(_0x56fbbb)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x3acd26(0xe0)])(_0x56fbbb))]}});_0x3cb22f&&(_0x199ead={'updatedAt':{[sequelize_1['Op'][_0x3acd26(0xed)]]:[+(0x0,date_fns_1[_0x3acd26(0xdb)])((0x0,date_fns_1['parseISO'])(_0x3cb22f)),+(0x0,date_fns_1[_0x3acd26(0xe2)])((0x0,date_fns_1[_0x3acd26(0xe0)])(_0x3cb22f))]}});if(_0x54cc7d===_0x3acd26(0xd9)){const _0x5c9e08=_0x282d42[_0x3acd26(0xbb)]['map'](_0x84cfef=>_0x84cfef['id']);_0x199ead={[sequelize_1['Op']['or']]:[{'userId':_0x3c7857},{'status':_0x3acd26(0xc5)}],'queueId':{[sequelize_1['Op']['or']]:_0x282d42['profile']===_0x3acd26(0xb9)?[_0x5c9e08,null]:[_0x5c9e08]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}},_0x263599&&(_0x199ead[_0x3acd26(0xeb)]=_0x4f44e0===_0x3acd26(0xd9));}if(Array[_0x3acd26(0xce)](_0x554a6d)&&_0x554a6d[_0x3acd26(0xff)]>0x0){const _0x5b91ab=[];for await(const _0x17d991 of _0x554a6d){const _0x15670e=await TicketTag_1['default']['findAll']({'where':{'tagId':_0x17d991}});_0x15670e&&_0x5b91ab['push'](_0x15670e[_0x3acd26(0xdc)](_0x282ffb=>_0x282ffb['ticketId']));}const _0x548a82=(0x0,lodash_1['intersection'])(..._0x5b91ab);_0x199ead={..._0x199ead,'id':{[sequelize_1['Op']['in']]:_0x548a82}};}if(Array['isArray'](_0x2365b2)&&_0x2365b2[_0x3acd26(0xff)]>0x0){const _0x67b752=[];for await(const _0x3dc426 of _0x2365b2){const _0x43446e=await Ticket_1['default'][_0x3acd26(0xcf)]({'where':{'userId':_0x3dc426}});_0x43446e&&_0x67b752[_0x3acd26(0xe4)](_0x43446e[_0x3acd26(0xdc)](_0x53bc7b=>_0x53bc7b['id']));}const _0x3c24fe=(0x0,lodash_1[_0x3acd26(0xd8)])(..._0x67b752);_0x199ead={..._0x199ead,'id':{[sequelize_1['Op']['in']]:_0x3c24fe}};}const _0x1c36c8=_0xcb70fe?undefined:0x28,_0x159350=_0xcb70fe?undefined:_0x1c36c8*(+pageNumber-0x1);_0x724a2d&&(_0x199ead={..._0x199ead,'status':{[sequelize_1['Op']['ne']]:_0x3acd26(0xfc)}});_0x199ead={..._0x199ead,'companyId':_0x1812e5};const {count:_0x56344f,rows:_0x4fead0}=await Ticket_1['default'][_0x3acd26(0xf5)]({'where':_0x199ead,'include':_0x13d8b6,'distinct':!![],'limit':_0x1c36c8,'offset':_0x159350,'order':[[_0x3acd26(0xc3),_0x3acd26(0xf4)]],'subQuery':![]}),_0x1dff16=_0x56344f>_0x159350+_0x4fead0[_0x3acd26(0xff)];return{'tickets':_0x4fead0,'count':_0x56344f,'hasMore':_0x1dff16};};exports[a559_0x5a414a(0xc7)]=ListTicketsService;