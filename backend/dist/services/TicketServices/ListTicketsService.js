const a666_0x4184b6=a666_0x4eac;(function(_0x473e52,_0x359d42){const _0x57e58c=a666_0x4eac,_0x5adcec=_0x473e52();while(!![]){try{const _0x4654b0=-parseInt(_0x57e58c(0x70))/0x1*(-parseInt(_0x57e58c(0xa1))/0x2)+-parseInt(_0x57e58c(0xa4))/0x3+-parseInt(_0x57e58c(0x75))/0x4+parseInt(_0x57e58c(0x7b))/0x5*(-parseInt(_0x57e58c(0x9f))/0x6)+-parseInt(_0x57e58c(0x95))/0x7+parseInt(_0x57e58c(0x7d))/0x8+parseInt(_0x57e58c(0x8a))/0x9;if(_0x4654b0===_0x359d42)break;else _0x5adcec['push'](_0x5adcec['shift']());}catch(_0x2b2505){_0x5adcec['push'](_0x5adcec['shift']());}}}(a666_0x5d6f,0x975cd));function a666_0x5d6f(){const _0x4babc7=['push','between','2566291yNlVCF','findAndCountAll','toString','body','queue','pending','../../models/Contact','toLocaleLowerCase','../../models/User','presence','6KkbcEn','../../helpers/CheckSettings','1096bFZMee','../UserServices/ShowUserService','name','1926525DGDBXj','sequelize','default','profile','../../models/Ticket','whatsapp','isArray','superv','queues','DESC','admin','parseISO','__importDefault','where','constructor','notIn','577zVVkuE','map','search','intersection','LOWER','34600jybxdY','endOfDay','col','number','../../models/Tag','profilePicUrl','1491630PiVBAJ','like','7601208zlLyMx','LIKE','../../models/Whatsapp','closed','../../models/Message','email','(((.+)+)+)+$','enabled','defineProperty','disabled','__esModule','startOfDay','findAll','6024582VNrQlm','true','length','contact','trim','color','ticketId','date-fns','messages'];a666_0x5d6f=function(){return _0x4babc7;};return a666_0x5d6f();}const a666_0x298cdb=(function(){let _0x2317ce=!![];return function(_0x3baa51,_0x34fff9){const _0x4826a0=_0x2317ce?function(){if(_0x34fff9){const _0x2485a4=_0x34fff9['apply'](_0x3baa51,arguments);return _0x34fff9=null,_0x2485a4;}}:function(){};return _0x2317ce=![],_0x4826a0;};}()),a666_0x4e7a59=a666_0x298cdb(this,function(){const _0x3c3ad3=a666_0x4eac;return a666_0x4e7a59[_0x3c3ad3(0x97)]()[_0x3c3ad3(0x72)]('(((.+)+)+)+$')[_0x3c3ad3(0x97)]()[_0x3c3ad3(0x6e)](a666_0x4e7a59)[_0x3c3ad3(0x72)](_0x3c3ad3(0x83));});a666_0x4e7a59();'use strict';function a666_0x4eac(_0x402304,_0x2a0fd7){const _0x4c6dac=a666_0x5d6f();return a666_0x4eac=function(_0x4e7a59,_0x298cdb){_0x4e7a59=_0x4e7a59-0x68;let _0x5d6f80=_0x4c6dac[_0x4e7a59];return _0x5d6f80;},a666_0x4eac(_0x402304,_0x2a0fd7);}var __importDefault=this&&this[a666_0x4184b6(0x6c)]||function(_0x5c5c39){const _0x157897=a666_0x4184b6;return _0x5c5c39&&_0x5c5c39[_0x157897(0x87)]?_0x5c5c39:{'default':_0x5c5c39};};Object[a666_0x4184b6(0x85)](exports,a666_0x4184b6(0x87),{'value':!![]});const sequelize_1=require(a666_0x4184b6(0xa5)),date_fns_1=require(a666_0x4184b6(0x91)),lodash_1=require('lodash'),Ticket_1=__importDefault(require(a666_0x4184b6(0xa8))),Contact_1=__importDefault(require(a666_0x4184b6(0x9b))),Message_1=__importDefault(require(a666_0x4184b6(0x81))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a666_0x4184b6(0x9d))),ShowUserService_1=__importDefault(require(a666_0x4184b6(0xa2))),Tag_1=__importDefault(require(a666_0x4184b6(0x79))),TicketTag_1=__importDefault(require('../../models/TicketTag')),Whatsapp_1=__importDefault(require(a666_0x4184b6(0x7f))),CheckSettings_1=require(a666_0x4184b6(0xa0)),ListTicketsService=async({isSearch:isSearch=![],searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x3c8b00,tags:_0x53ef9c,users:_0x37eaed,status:_0x5b0e80,groups:_0x59c02d,date:_0x4c0c0c,updatedAt:_0x1e91a8,showAll:_0x141e35,userId:_0x8d633,withUnreadMessages:_0x4627df,notClosed:_0x32e2fc,all:_0x1a99de,companyId:_0x2f50a3})=>{const _0x462afb=a666_0x4184b6,_0x11caa2=!isSearch&&await(0x0,CheckSettings_1['GetCompanySetting'])(_0x2f50a3,'groupsTab',_0x462afb(0x86))===_0x462afb(0x84),_0x1a0458=await(0x0,ShowUserService_1[_0x462afb(0xa6)])(_0x8d633);let _0x4f13d9={};const _0x163c4a=_0x141e35===_0x462afb(0x8b),_0x2e8cfb=()=>{const _0x457263=_0x462afb;if(_0x3c8b00[_0x457263(0x8c)]>0x0)return{[sequelize_1['Op']['or']]:[{[sequelize_1['Op']['in']]:_0x3c8b00},null]};return{[sequelize_1['Op']['or']]:[{[sequelize_1['Op']['ne']]:null},null]};},_0x200bbb=_0x5b0e80===_0x462afb(0x9a);if(_0x1a0458[_0x462afb(0xa7)]===_0x462afb(0x6a))_0x163c4a?_0x4f13d9={'queueId':_0x2e8cfb()}:_0x200bbb?_0x4f13d9={'queueId':_0x2e8cfb(),'userId':null}:_0x4f13d9={'userId':_0x1a0458['id']};else{if(_0x1a0458[_0x462afb(0xa7)]===_0x462afb(0xab)){const _0x2c132f=await User_1[_0x462afb(0xa6)]['findAll']({'where':{'companyId':_0x2f50a3,'profile':_0x462afb(0x6a)},'attributes':['id']}),_0x31d0a2=_0x2c132f['map'](_0x456023=>_0x456023['id']);_0x163c4a?_0x4f13d9={'queueId':_0x2e8cfb(),[sequelize_1['Op']['or']]:[{'userId':{[sequelize_1['Op'][_0x462afb(0x6f)]]:_0x31d0a2}},{'userId':null}]}:_0x200bbb?_0x4f13d9={'queueId':_0x2e8cfb(),'userId':null}:_0x4f13d9={'userId':_0x1a0458['id']};}else _0x3c8b00[_0x462afb(0x8c)]===0x0?_0x4f13d9={'userId':_0x1a0458['id'],'queueId':null}:_0x4f13d9={[sequelize_1['Op']['or']]:[{'userId':_0x1a0458['id']},{'status':_0x462afb(0x9a),'queueId':{[sequelize_1['Op']['in']]:_0x3c8b00}}]};}_0x11caa2&&(typeof _0x4f13d9==='object'&&!Array['isArray'](_0x4f13d9)&&(_0x4f13d9={..._0x4f13d9,'isGroup':_0x59c02d===_0x462afb(0x8b)}));let _0x26ee9d;_0x26ee9d=[{'model':Contact_1['default'],'as':_0x462afb(0x8d),'attributes':['id','name',_0x462afb(0x78),_0x462afb(0x82),_0x462afb(0x7a),_0x462afb(0x9e)]},{'model':Queue_1['default'],'as':_0x462afb(0x99),'attributes':['id','name',_0x462afb(0x8f)]},{'model':User_1[_0x462afb(0xa6)],'as':'user','attributes':['id',_0x462afb(0xa3)]},{'model':Tag_1[_0x462afb(0xa6)],'as':'tags','attributes':['id','name','color']},{'model':Whatsapp_1[_0x462afb(0xa6)],'as':_0x462afb(0xa9),'attributes':['id',_0x462afb(0xa3)]}];_0x5b0e80&&(_0x4f13d9={..._0x4f13d9,'status':_0x5b0e80});if(searchParam){const _0x1196e5=searchParam[_0x462afb(0x9c)]()[_0x462afb(0x8e)]();_0x26ee9d=[..._0x26ee9d,{'model':Message_1[_0x462afb(0xa6)],'as':_0x462afb(0x92),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x462afb(0x6d)])((0x0,sequelize_1['fn'])(_0x462afb(0x74),(0x0,sequelize_1[_0x462afb(0x77)])('body')),_0x462afb(0x7e),'%'+_0x1196e5+'%')},'required':![],'duplicating':![]}],_0x4f13d9={..._0x4f13d9,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x462afb(0x6d)])((0x0,sequelize_1['fn'])(_0x462afb(0x74),(0x0,sequelize_1[_0x462afb(0x77)])('contact.name')),_0x462afb(0x7e),'%'+_0x1196e5+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x462afb(0x7c)]]:'%'+_0x1196e5+'%'}},{'$message.body$':(0x0,sequelize_1[_0x462afb(0x6d)])((0x0,sequelize_1['fn'])(_0x462afb(0x74),(0x0,sequelize_1[_0x462afb(0x77)])(_0x462afb(0x98))),'LIKE','%'+_0x1196e5+'%')}]};}_0x4c0c0c&&(_0x4f13d9={'createdAt':{[sequelize_1['Op'][_0x462afb(0x94)]]:[+(0x0,date_fns_1[_0x462afb(0x88)])((0x0,date_fns_1[_0x462afb(0x6b)])(_0x4c0c0c)),+(0x0,date_fns_1[_0x462afb(0x76)])((0x0,date_fns_1[_0x462afb(0x6b)])(_0x4c0c0c))]}});_0x1e91a8&&(_0x4f13d9={'updatedAt':{[sequelize_1['Op'][_0x462afb(0x94)]]:[+(0x0,date_fns_1[_0x462afb(0x88)])((0x0,date_fns_1['parseISO'])(_0x1e91a8)),+(0x0,date_fns_1[_0x462afb(0x76)])((0x0,date_fns_1[_0x462afb(0x6b)])(_0x1e91a8))]}});if(_0x4627df==='true'){const _0x3ba686=_0x1a0458[_0x462afb(0x68)][_0x462afb(0x71)](_0x32d229=>_0x32d229['id']);_0x4f13d9={[sequelize_1['Op']['or']]:[{'userId':_0x8d633},{'status':_0x462afb(0x9a)}],'queueId':{[sequelize_1['Op']['or']]:_0x1a0458['profile']===_0x462afb(0x6a)?[_0x3ba686,null]:[_0x3ba686]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}},_0x11caa2&&(_0x4f13d9['isGroup']=_0x59c02d===_0x462afb(0x8b));}if(Array[_0x462afb(0xaa)](_0x53ef9c)&&_0x53ef9c[_0x462afb(0x8c)]>0x0){const _0x29c5df=[];for await(const _0xa3e44c of _0x53ef9c){const _0x3e203a=await TicketTag_1[_0x462afb(0xa6)][_0x462afb(0x89)]({'where':{'tagId':_0xa3e44c}});_0x3e203a&&_0x29c5df['push'](_0x3e203a[_0x462afb(0x71)](_0x2c1256=>_0x2c1256[_0x462afb(0x90)]));}const _0x5ba347=(0x0,lodash_1[_0x462afb(0x73)])(..._0x29c5df);_0x4f13d9={..._0x4f13d9,'id':{[sequelize_1['Op']['in']]:_0x5ba347}};}if(Array[_0x462afb(0xaa)](_0x37eaed)&&_0x37eaed[_0x462afb(0x8c)]>0x0){const _0x31dcbc=[];for await(const _0x1a0aec of _0x37eaed){const _0xdbe309=await Ticket_1[_0x462afb(0xa6)]['findAll']({'where':{'userId':_0x1a0aec}});_0xdbe309&&_0x31dcbc[_0x462afb(0x93)](_0xdbe309[_0x462afb(0x71)](_0x384173=>_0x384173['id']));}const _0x25c6c2=(0x0,lodash_1[_0x462afb(0x73)])(..._0x31dcbc);_0x4f13d9={..._0x4f13d9,'id':{[sequelize_1['Op']['in']]:_0x25c6c2}};}const _0x49dcb1=_0x1a99de?undefined:0x28,_0x16d59b=_0x1a99de?undefined:_0x49dcb1*(+pageNumber-0x1);_0x32e2fc&&(_0x4f13d9={..._0x4f13d9,'status':{[sequelize_1['Op']['ne']]:_0x462afb(0x80)}});_0x4f13d9={..._0x4f13d9,'companyId':_0x2f50a3};const {count:_0x1bc1e6,rows:_0x3d8f83}=await Ticket_1[_0x462afb(0xa6)][_0x462afb(0x96)]({'where':_0x4f13d9,'include':_0x26ee9d,'distinct':!![],'limit':_0x49dcb1,'offset':_0x16d59b,'order':[['updatedAt',_0x462afb(0x69)]],'subQuery':![]}),_0x5b200e=_0x1bc1e6>_0x16d59b+_0x3d8f83[_0x462afb(0x8c)];return{'tickets':_0x3d8f83,'count':_0x1bc1e6,'hasMore':_0x5b200e};};exports[a666_0x4184b6(0xa6)]=ListTicketsService;