const a555_0x34ac74=a555_0x3257;(function(_0x452327,_0x249fc7){const _0x2d08b3=a555_0x3257,_0x2ef39a=_0x452327();while(!![]){try{const _0x254a8a=parseInt(_0x2d08b3(0x19a))/0x1+parseInt(_0x2d08b3(0x190))/0x2*(-parseInt(_0x2d08b3(0x177))/0x3)+parseInt(_0x2d08b3(0x1a0))/0x4+parseInt(_0x2d08b3(0x1a1))/0x5*(-parseInt(_0x2d08b3(0x171))/0x6)+parseInt(_0x2d08b3(0x17b))/0x7+parseInt(_0x2d08b3(0x185))/0x8+parseInt(_0x2d08b3(0x17e))/0x9;if(_0x254a8a===_0x249fc7)break;else _0x2ef39a['push'](_0x2ef39a['shift']());}catch(_0x336659){_0x2ef39a['push'](_0x2ef39a['shift']());}}}(a555_0x4fcb,0x1ff86));const a555_0x510d05=(function(){let _0x56511d=!![];return function(_0xbff0eb,_0x1242ad){const _0x382b92=_0x56511d?function(){if(_0x1242ad){const _0x1a3563=_0x1242ad['apply'](_0xbff0eb,arguments);return _0x1242ad=null,_0x1a3563;}}:function(){};return _0x56511d=![],_0x382b92;};}()),a555_0x58a92e=a555_0x510d05(this,function(){const _0x814395=a555_0x3257;return a555_0x58a92e[_0x814395(0x1ab)]()[_0x814395(0x178)](_0x814395(0x1a5))[_0x814395(0x1ab)]()['constructor'](a555_0x58a92e)[_0x814395(0x178)](_0x814395(0x1a5));});a555_0x58a92e();function a555_0x4fcb(){const _0x4bff35=['../../helpers/CheckSettings','map','whatsapp','GetCompanySetting','isGroup','235190uVJwYt','LOWER','../../models/Queue','date-fns','defineProperty','name','187356unVxEG','508685NNtMCb','queues','DESC','user','(((.+)+)+)+$','parseISO','email','../../models/TicketTag','trim','groupsTab','toString','between','../../models/Tag','profile','true','__importDefault','../../models/Whatsapp','col','../../models/Ticket','closed','default','../../models/Message','12DhsdSJ','__esModule','updatedAt','../UserServices/ShowUserService','LIKE','disabled','111EALcvz','search','presence','ticketId','146447wnGspu','../../models/Contact','endOfDay','570915QFmVcj','intersection','like','where','number','pending','isArray','1618288bfOPmx','color','enabled','push','admin','findAndCountAll','tags','findAll','sequelize','../../models/User','contact','12662nCdAVE','toLocaleLowerCase','length','startOfDay','body'];a555_0x4fcb=function(){return _0x4bff35;};return a555_0x4fcb();}'use strict';function a555_0x3257(_0x59b60a,_0x1a3281){const _0x1b4c7c=a555_0x4fcb();return a555_0x3257=function(_0x58a92e,_0x510d05){_0x58a92e=_0x58a92e-0x167;let _0x4fcb17=_0x1b4c7c[_0x58a92e];return _0x4fcb17;},a555_0x3257(_0x59b60a,_0x1a3281);}var __importDefault=this&&this[a555_0x34ac74(0x16a)]||function(_0x5827a6){const _0x28672e=a555_0x34ac74;return _0x5827a6&&_0x5827a6[_0x28672e(0x172)]?_0x5827a6:{'default':_0x5827a6};};Object[a555_0x34ac74(0x19e)](exports,a555_0x34ac74(0x172),{'value':!![]});const sequelize_1=require(a555_0x34ac74(0x18d)),date_fns_1=require(a555_0x34ac74(0x19d)),lodash_1=require('lodash'),Ticket_1=__importDefault(require(a555_0x34ac74(0x16d))),Contact_1=__importDefault(require(a555_0x34ac74(0x17c))),Message_1=__importDefault(require(a555_0x34ac74(0x170))),Queue_1=__importDefault(require(a555_0x34ac74(0x19c))),User_1=__importDefault(require(a555_0x34ac74(0x18e))),ShowUserService_1=__importDefault(require(a555_0x34ac74(0x174))),Tag_1=__importDefault(require(a555_0x34ac74(0x167))),TicketTag_1=__importDefault(require(a555_0x34ac74(0x1a8))),Whatsapp_1=__importDefault(require(a555_0x34ac74(0x16b))),CheckSettings_1=require(a555_0x34ac74(0x195)),ListTicketsService=async({isSearch:isSearch=![],searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x136834,tags:_0x250117,users:_0x4a9f3f,status:_0x1927b4,groups:_0x469a76,date:_0x2488a3,updatedAt:_0xc3d55f,showAll:_0x2a64a4,userId:_0x295973,withUnreadMessages:_0x3c9ab8,notClosed:_0x5c67f2,all:_0x46f95d,companyId:_0x38ffd8})=>{const _0x47f6ba=a555_0x34ac74,_0x50b56b=!isSearch&&await(0x0,CheckSettings_1[_0x47f6ba(0x198)])(_0x38ffd8,_0x47f6ba(0x1aa),_0x47f6ba(0x176))===_0x47f6ba(0x187),_0x2e1ba5=await(0x0,ShowUserService_1[_0x47f6ba(0x16f)])(_0x295973);let _0x3f4fe8={[sequelize_1['Op']['or']]:[{'userId':_0x295973},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:_0x2e1ba5[_0x47f6ba(0x168)]===_0x47f6ba(0x189)?[_0x136834,null]:[_0x136834]}};_0x50b56b&&(_0x3f4fe8[_0x47f6ba(0x199)]=_0x469a76==='true');let _0x2e7d7f;_0x2e7d7f=[{'model':Contact_1[_0x47f6ba(0x16f)],'as':_0x47f6ba(0x18f),'attributes':['id',_0x47f6ba(0x19f),_0x47f6ba(0x182),_0x47f6ba(0x1a7),'profilePicUrl',_0x47f6ba(0x179)]},{'model':Queue_1[_0x47f6ba(0x16f)],'as':'queue','attributes':['id',_0x47f6ba(0x19f),_0x47f6ba(0x186)]},{'model':User_1['default'],'as':_0x47f6ba(0x1a4),'attributes':['id',_0x47f6ba(0x19f)]},{'model':Tag_1[_0x47f6ba(0x16f)],'as':_0x47f6ba(0x18b),'attributes':['id',_0x47f6ba(0x19f),_0x47f6ba(0x186)]},{'model':Whatsapp_1[_0x47f6ba(0x16f)],'as':_0x47f6ba(0x197),'attributes':['id',_0x47f6ba(0x19f)]}];_0x2a64a4===_0x47f6ba(0x169)&&_0x2e1ba5[_0x47f6ba(0x168)]===_0x47f6ba(0x189)&&(_0x3f4fe8={'queueId':{[sequelize_1['Op']['or']]:[_0x136834,null]}},_0x50b56b&&(_0x3f4fe8[_0x47f6ba(0x199)]=_0x469a76===_0x47f6ba(0x169)));_0x1927b4&&(_0x3f4fe8={..._0x3f4fe8,'status':_0x1927b4});if(searchParam){const _0x530c2a=searchParam[_0x47f6ba(0x191)]()[_0x47f6ba(0x1a9)]();_0x2e7d7f=[..._0x2e7d7f,{'model':Message_1[_0x47f6ba(0x16f)],'as':'messages','attributes':['id',_0x47f6ba(0x194)],'where':{'body':(0x0,sequelize_1[_0x47f6ba(0x181)])((0x0,sequelize_1['fn'])(_0x47f6ba(0x19b),(0x0,sequelize_1[_0x47f6ba(0x16c)])(_0x47f6ba(0x194))),_0x47f6ba(0x175),'%'+_0x530c2a+'%')},'required':![],'duplicating':![]}],_0x3f4fe8={..._0x3f4fe8,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x47f6ba(0x181)])((0x0,sequelize_1['fn'])(_0x47f6ba(0x19b),(0x0,sequelize_1[_0x47f6ba(0x16c)])('contact.name')),_0x47f6ba(0x175),'%'+_0x530c2a+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x47f6ba(0x180)]]:'%'+_0x530c2a+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x47f6ba(0x19b),(0x0,sequelize_1[_0x47f6ba(0x16c)])(_0x47f6ba(0x194))),_0x47f6ba(0x175),'%'+_0x530c2a+'%')}]};}_0x2488a3&&(_0x3f4fe8={'createdAt':{[sequelize_1['Op'][_0x47f6ba(0x1ac)]]:[+(0x0,date_fns_1[_0x47f6ba(0x193)])((0x0,date_fns_1[_0x47f6ba(0x1a6)])(_0x2488a3)),+(0x0,date_fns_1[_0x47f6ba(0x17d)])((0x0,date_fns_1[_0x47f6ba(0x1a6)])(_0x2488a3))]}});_0xc3d55f&&(_0x3f4fe8={'updatedAt':{[sequelize_1['Op'][_0x47f6ba(0x1ac)]]:[+(0x0,date_fns_1[_0x47f6ba(0x193)])((0x0,date_fns_1[_0x47f6ba(0x1a6)])(_0xc3d55f)),+(0x0,date_fns_1[_0x47f6ba(0x17d)])((0x0,date_fns_1[_0x47f6ba(0x1a6)])(_0xc3d55f))]}});if(_0x3c9ab8===_0x47f6ba(0x169)){const _0x1a898b=_0x2e1ba5[_0x47f6ba(0x1a2)][_0x47f6ba(0x196)](_0x149a81=>_0x149a81['id']);_0x3f4fe8={[sequelize_1['Op']['or']]:[{'userId':_0x295973},{'status':_0x47f6ba(0x183)}],'queueId':{[sequelize_1['Op']['or']]:_0x2e1ba5[_0x47f6ba(0x168)]===_0x47f6ba(0x189)?[_0x1a898b,null]:[_0x1a898b]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}},_0x50b56b&&(_0x3f4fe8[_0x47f6ba(0x199)]=_0x469a76===_0x47f6ba(0x169));}if(Array[_0x47f6ba(0x184)](_0x250117)&&_0x250117[_0x47f6ba(0x192)]>0x0){const _0x1c25eb=[];for await(const _0x27fff6 of _0x250117){const _0x2f6a6e=await TicketTag_1[_0x47f6ba(0x16f)][_0x47f6ba(0x18c)]({'where':{'tagId':_0x27fff6}});_0x2f6a6e&&_0x1c25eb[_0x47f6ba(0x188)](_0x2f6a6e[_0x47f6ba(0x196)](_0x203cf2=>_0x203cf2[_0x47f6ba(0x17a)]));}const _0x5ef767=(0x0,lodash_1[_0x47f6ba(0x17f)])(..._0x1c25eb);_0x3f4fe8={..._0x3f4fe8,'id':{[sequelize_1['Op']['in']]:_0x5ef767}};}if(Array[_0x47f6ba(0x184)](_0x4a9f3f)&&_0x4a9f3f[_0x47f6ba(0x192)]>0x0){const _0x2fde3d=[];for await(const _0x552c78 of _0x4a9f3f){const _0x32cfba=await Ticket_1[_0x47f6ba(0x16f)][_0x47f6ba(0x18c)]({'where':{'userId':_0x552c78}});_0x32cfba&&_0x2fde3d['push'](_0x32cfba[_0x47f6ba(0x196)](_0x4fa8f0=>_0x4fa8f0['id']));}const _0x373f86=(0x0,lodash_1[_0x47f6ba(0x17f)])(..._0x2fde3d);_0x3f4fe8={..._0x3f4fe8,'id':{[sequelize_1['Op']['in']]:_0x373f86}};}const _0x473b90=_0x46f95d?undefined:0x28,_0x5cef02=_0x46f95d?undefined:_0x473b90*(+pageNumber-0x1);_0x5c67f2&&(_0x3f4fe8={..._0x3f4fe8,'status':{[sequelize_1['Op']['ne']]:_0x47f6ba(0x16e)}});_0x3f4fe8={..._0x3f4fe8,'companyId':_0x38ffd8};const {count:_0x2be572,rows:_0x999fef}=await Ticket_1[_0x47f6ba(0x16f)][_0x47f6ba(0x18a)]({'where':_0x3f4fe8,'include':_0x2e7d7f,'distinct':!![],'limit':_0x473b90,'offset':_0x5cef02,'order':[[_0x47f6ba(0x173),_0x47f6ba(0x1a3)]],'subQuery':![]}),_0x40a633=_0x2be572>_0x5cef02+_0x999fef[_0x47f6ba(0x192)];return{'tickets':_0x999fef,'count':_0x2be572,'hasMore':_0x40a633};};exports[a555_0x34ac74(0x16f)]=ListTicketsService;