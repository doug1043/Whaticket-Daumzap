const a525_0x239018=a525_0x1329;(function(_0x40cd5d,_0x2dc7ac){const _0x2ea891=a525_0x1329,_0x571698=_0x40cd5d();while(!![]){try{const _0x14faad=-parseInt(_0x2ea891(0x1d9))/0x1+-parseInt(_0x2ea891(0x1f4))/0x2*(-parseInt(_0x2ea891(0x1d0))/0x3)+parseInt(_0x2ea891(0x200))/0x4*(parseInt(_0x2ea891(0x1e5))/0x5)+-parseInt(_0x2ea891(0x1e9))/0x6+-parseInt(_0x2ea891(0x1c5))/0x7*(-parseInt(_0x2ea891(0x1cd))/0x8)+parseInt(_0x2ea891(0x1db))/0x9+-parseInt(_0x2ea891(0x1c3))/0xa*(parseInt(_0x2ea891(0x1fc))/0xb);if(_0x14faad===_0x2dc7ac)break;else _0x571698['push'](_0x571698['shift']());}catch(_0x2a4905){_0x571698['push'](_0x571698['shift']());}}}(a525_0x3353,0x2baa9));const a525_0x371310=(function(){let _0x4fe00e=!![];return function(_0x4da7da,_0x528812){const _0x207f16=_0x4fe00e?function(){const _0x54d7ea=a525_0x1329;if(_0x528812){const _0x7654e0=_0x528812[_0x54d7ea(0x1e7)](_0x4da7da,arguments);return _0x528812=null,_0x7654e0;}}:function(){};return _0x4fe00e=![],_0x207f16;};}()),a525_0xc56a1c=a525_0x371310(this,function(){const _0x2e1244=a525_0x1329;return a525_0xc56a1c[_0x2e1244(0x1c6)]()[_0x2e1244(0x1ce)](_0x2e1244(0x1d6))[_0x2e1244(0x1c6)]()[_0x2e1244(0x1c9)](a525_0xc56a1c)[_0x2e1244(0x1ce)](_0x2e1244(0x1d6));});a525_0xc56a1c();'use strict';var __importDefault=this&&this[a525_0x239018(0x1d8)]||function(_0x33dff2){const _0x188679=a525_0x239018;return _0x33dff2&&_0x33dff2[_0x188679(0x1bf)]?_0x33dff2:{'default':_0x33dff2};};function a525_0x1329(_0x24fa1b,_0x2a2aeb){const _0x573b74=a525_0x3353();return a525_0x1329=function(_0xc56a1c,_0x371310){_0xc56a1c=_0xc56a1c-0x1be;let _0x3353b2=_0x573b74[_0xc56a1c];return _0x3353b2;},a525_0x1329(_0x24fa1b,_0x2a2aeb);}Object[a525_0x239018(0x1d5)](exports,a525_0x239018(0x1bf),{'value':!![]});const sequelize_1=require(a525_0x239018(0x1c2)),date_fns_1=require(a525_0x239018(0x1ed)),Ticket_1=__importDefault(require(a525_0x239018(0x1c0))),Contact_1=__importDefault(require(a525_0x239018(0x1e2))),Message_1=__importDefault(require(a525_0x239018(0x1cf))),Queue_1=__importDefault(require(a525_0x239018(0x1f0))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require(a525_0x239018(0x1e3))),Tag_1=__importDefault(require(a525_0x239018(0x1f7))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require(a525_0x239018(0x1c8)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x28c5e0,tags:_0x1e6cad,users:_0x461599,status:_0x45371d,date:_0x407f51,startDate:_0x5c5598,endDate:_0x505acd,updatedAt:_0x151d01,showAll:_0x240194,userId:_0x5cc69b,withUnreadMessages:_0x3310ef,companyId:_0x17454a})=>{const _0x42d747=a525_0x239018,_0x2efb0a=await(0x0,ShowUserService_1[_0x42d747(0x1ee)])(_0x5cc69b),_0x5bad43=_0x2efb0a[_0x42d747(0x1f9)][_0x42d747(0x1d4)](_0x1d3196=>_0x1d3196['id']);let _0x13ee2f={[sequelize_1['Op']['or']]:[{'userId':_0x5cc69b},{'status':_0x42d747(0x1d3)}],'queueId':{[sequelize_1['Op']['or']]:[_0x28c5e0,null]}},_0x4ff9b4;_0x4ff9b4=[{'model':Contact_1['default'],'as':_0x42d747(0x1d2),'attributes':['id',_0x42d747(0x1f3),'number','email',_0x42d747(0x1ff),_0x42d747(0x1ea)]},{'model':Queue_1[_0x42d747(0x1ee)],'as':'queue','attributes':['id',_0x42d747(0x1f3),_0x42d747(0x1fd)]},{'model':User_1[_0x42d747(0x1ee)],'as':_0x42d747(0x1ca),'attributes':['id',_0x42d747(0x1f3)]},{'model':Tag_1[_0x42d747(0x1ee)],'as':'tags','attributes':['id',_0x42d747(0x1f3),_0x42d747(0x1fd)]},{'model':Whatsapp_1[_0x42d747(0x1ee)],'as':_0x42d747(0x1f5),'attributes':[_0x42d747(0x1f3)]}];if(_0x2efb0a[_0x42d747(0x1ef)]===_0x42d747(0x1ca)&&_0x2efb0a[_0x42d747(0x1e1)]===_0x42d747(0x1f8)){const _0x5059ec=[];let _0x16c36f=[];_0x16c36f=await Ticket_1['default'][_0x42d747(0x1d7)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x2efb0a['id'],null]},'companyId':_0x17454a}});_0x16c36f&&_0x5059ec[_0x42d747(0x1e6)](_0x16c36f[_0x42d747(0x1d4)](_0x1afba1=>_0x1afba1['id']));const _0x2b95d8=(0x0,lodash_1[_0x42d747(0x1e8)])(..._0x5059ec);_0x13ee2f={..._0x13ee2f,'id':_0x2b95d8};}if(_0x2efb0a[_0x42d747(0x1ef)]===_0x42d747(0x1ca)&&_0x2efb0a[_0x42d747(0x1e1)]===_0x42d747(0x1cb)){const _0x20ec17=[];let _0x599755=[];_0x599755=await Ticket_1[_0x42d747(0x1ee)][_0x42d747(0x1d7)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x2efb0a['id'],null]},'companyId':_0x17454a,'queueId':{[sequelize_1['Op'][_0x42d747(0x1dc)]]:null}}});_0x599755&&_0x20ec17[_0x42d747(0x1e6)](_0x599755[_0x42d747(0x1d4)](_0x17fc6f=>_0x17fc6f['id']));const _0x4bb917=(0x0,lodash_1[_0x42d747(0x1e8)])(..._0x20ec17);_0x13ee2f={..._0x13ee2f,'id':_0x4bb917};}_0x240194===_0x42d747(0x1fa)&&(_0x13ee2f={'queueId':{[sequelize_1['Op']['or']]:[_0x28c5e0,null]}});_0x45371d&&(_0x13ee2f={..._0x13ee2f,'status':_0x45371d});_0x5c5598&&_0x505acd&&(_0x13ee2f={..._0x13ee2f,'createdAt':{[sequelize_1['Op'][_0x42d747(0x1f6)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1['parseISO'])(_0x5c5598)),+(0x0,date_fns_1[_0x42d747(0x1dd)])((0x0,date_fns_1['parseISO'])(_0x505acd))]}});if(searchParam){const _0x31b36a=searchParam[_0x42d747(0x1df)]()[_0x42d747(0x1eb)]();_0x4ff9b4=[..._0x4ff9b4,{'model':Message_1[_0x42d747(0x1ee)],'as':_0x42d747(0x1c4),'attributes':['id',_0x42d747(0x1d1)],'where':{'body':(0x0,sequelize_1[_0x42d747(0x1e4)])((0x0,sequelize_1['fn'])(_0x42d747(0x1c7),(0x0,sequelize_1[_0x42d747(0x1cc)])('body')),_0x42d747(0x1ec),'%'+_0x31b36a+'%')},'required':![],'duplicating':![]}],_0x13ee2f={..._0x13ee2f,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x42d747(0x1c7),(0x0,sequelize_1[_0x42d747(0x1cc)])(_0x42d747(0x1fb))),_0x42d747(0x1ec),'%'+_0x31b36a+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x31b36a+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x42d747(0x1c7),(0x0,sequelize_1[_0x42d747(0x1cc)])(_0x42d747(0x1d1))),_0x42d747(0x1ec),'%'+_0x31b36a+'%')}]};}_0x407f51&&(_0x13ee2f={'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x42d747(0x1e0)])((0x0,date_fns_1['parseISO'])(_0x407f51)),+(0x0,date_fns_1[_0x42d747(0x1dd)])((0x0,date_fns_1[_0x42d747(0x1da)])(_0x407f51))]}});_0x151d01&&(_0x13ee2f={'updatedAt':{[sequelize_1['Op'][_0x42d747(0x1f6)]]:[+(0x0,date_fns_1[_0x42d747(0x1e0)])((0x0,date_fns_1[_0x42d747(0x1da)])(_0x151d01)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x42d747(0x1da)])(_0x151d01))]}});if(_0x3310ef===_0x42d747(0x1fa)){const _0x5d15bd=await(0x0,ShowUserService_1['default'])(_0x5cc69b),_0x4e87c3=_0x5d15bd['queues'][_0x42d747(0x1d4)](_0x231905=>_0x231905['id']);_0x13ee2f={[sequelize_1['Op']['or']]:[{'userId':_0x5cc69b},{'status':_0x42d747(0x1d3)}],'queueId':{[sequelize_1['Op']['or']]:[_0x4e87c3,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x42d747(0x1c1)](_0x1e6cad)&&_0x1e6cad[_0x42d747(0x1de)]>0x0){const _0x5c097a=[];for(let _0x339ad5 of _0x1e6cad){const _0x4cf31b=await TicketTag_1[_0x42d747(0x1ee)][_0x42d747(0x1d7)]({'where':{'tagId':_0x339ad5}});_0x4cf31b&&_0x5c097a['push'](_0x4cf31b[_0x42d747(0x1d4)](_0x497bda=>_0x497bda[_0x42d747(0x1fe)]));}const _0x19e916=(0x0,lodash_1['intersection'])(..._0x5c097a);_0x13ee2f={..._0x13ee2f,'id':{[sequelize_1['Op']['in']]:_0x19e916}};}if(Array['isArray'](_0x461599)&&_0x461599[_0x42d747(0x1de)]>0x0){const _0x3a68a8=[];for(let _0x4333fe of _0x461599){const _0x5ded03=await Ticket_1[_0x42d747(0x1ee)][_0x42d747(0x1d7)]({'where':{'userId':_0x4333fe}});_0x5ded03&&_0x3a68a8['push'](_0x5ded03[_0x42d747(0x1d4)](_0x3bb191=>_0x3bb191['id']));}const _0x433980=(0x0,lodash_1[_0x42d747(0x1e8)])(..._0x3a68a8);_0x13ee2f={..._0x13ee2f,'id':{[sequelize_1['Op']['in']]:_0x433980}};}const _0x50d4bf=0x28,_0x453978=_0x50d4bf*(+pageNumber-0x1);_0x13ee2f={..._0x13ee2f,'companyId':_0x17454a};const {count:_0x758e99,rows:_0x59fe6e}=await Ticket_1['default'][_0x42d747(0x1be)]({'where':_0x13ee2f,'include':_0x4ff9b4,'distinct':!![],'limit':_0x50d4bf,'offset':_0x453978,'order':[[_0x42d747(0x1f2),_0x42d747(0x1f1)]],'subQuery':![]}),_0x40fa17=_0x758e99>_0x453978+_0x59fe6e['length'];return{'tickets':_0x59fe6e,'count':_0x758e99,'hasMore':_0x40fa17};};exports[a525_0x239018(0x1ee)]=ListTicketsService;function a525_0x3353(){const _0x2d0226=['contact.name','341aWARak','color','ticketId','profilePicUrl','348ZStUOa','findAndCountAll','__esModule','../../models/Ticket','isArray','sequelize','155320YKXyga','messages','91xjNFRD','toString','LOWER','lodash','constructor','user','disabled','col','188080njTBtb','search','../../models/Message','24693oxodPz','body','contact','pending','map','defineProperty','(((.+)+)+)+$','findAll','__importDefault','49631uhjNyA','parseISO','2515473vEFoGT','not','endOfDay','length','toLocaleLowerCase','startOfDay','allTicket','../../models/Contact','../UserServices/ShowUserService','where','5645QoMUgz','push','apply','intersection','1963818wGqiyf','presence','trim','LIKE','date-fns','default','profile','../../models/Queue','DESC','updatedAt','name','86WvDhTt','whatsapp','between','../../models/Tag','enabled','queues','true'];a525_0x3353=function(){return _0x2d0226;};return a525_0x3353();}