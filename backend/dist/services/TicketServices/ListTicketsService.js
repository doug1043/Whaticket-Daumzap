const a526_0x5e8802=a526_0x11de;(function(_0x546558,_0x218a6d){const _0x4a21de=a526_0x11de,_0x19b224=_0x546558();while(!![]){try{const _0x4d522d=parseInt(_0x4a21de(0x8f))/0x1*(parseInt(_0x4a21de(0x93))/0x2)+-parseInt(_0x4a21de(0xa1))/0x3*(-parseInt(_0x4a21de(0x82))/0x4)+-parseInt(_0x4a21de(0x9f))/0x5*(-parseInt(_0x4a21de(0x92))/0x6)+-parseInt(_0x4a21de(0xa8))/0x7+parseInt(_0x4a21de(0x83))/0x8*(-parseInt(_0x4a21de(0x86))/0x9)+parseInt(_0x4a21de(0xa9))/0xa+-parseInt(_0x4a21de(0x9e))/0xb;if(_0x4d522d===_0x218a6d)break;else _0x19b224['push'](_0x19b224['shift']());}catch(_0x59b71e){_0x19b224['push'](_0x19b224['shift']());}}}(a526_0x1599,0xeff3a));const a526_0x2dd012=(function(){let _0x164e04=!![];return function(_0x5d6f16,_0x1201d6){const _0xe2715=_0x164e04?function(){const _0x567cc8=a526_0x11de;if(_0x1201d6){const _0x191e78=_0x1201d6[_0x567cc8(0xac)](_0x5d6f16,arguments);return _0x1201d6=null,_0x191e78;}}:function(){};return _0x164e04=![],_0xe2715;};}()),a526_0x26a583=a526_0x2dd012(this,function(){const _0x3a514b=a526_0x11de;return a526_0x26a583['toString']()['search'](_0x3a514b(0xa7))['toString']()['constructor'](a526_0x26a583)[_0x3a514b(0x77)](_0x3a514b(0xa7));});a526_0x26a583();'use strict';var __importDefault=this&&this[a526_0x5e8802(0xa6)]||function(_0x4b5985){const _0x12e2cf=a526_0x5e8802;return _0x4b5985&&_0x4b5985[_0x12e2cf(0xa0)]?_0x4b5985:{'default':_0x4b5985};};function a526_0x1599(){const _0x5e0a9d=['33311641adcDOf','7652045XjAhKO','__esModule','18txsOxT','true','isArray','email','sequelize','__importDefault','(((.+)+)+)+$','1709925zoimrh','12519560xTQoXS','body','endOfDay','apply','number','user','allTicket','where','messages','findAll','search','disabled','contact','pending','like','enabled','not','../../models/TicketTag','parseISO','LOWER','../../models/Ticket','60280arnOJR','168fnHPJP','between','../../models/Whatsapp','33273ruZSft','queues','queue','defineProperty','toLocaleLowerCase','presence','LIKE','intersection','push','73015WyBTyt','col','length','6TDLxpG','40ZGxOhU','startOfDay','name','default','contact.name','date-fns','trim','map','color','DESC','ticketId'];a526_0x1599=function(){return _0x5e0a9d;};return a526_0x1599();}function a526_0x11de(_0x3ec51c,_0x240d52){const _0x5bb210=a526_0x1599();return a526_0x11de=function(_0x26a583,_0x2dd012){_0x26a583=_0x26a583-0x71;let _0x1599ef=_0x5bb210[_0x26a583];return _0x1599ef;},a526_0x11de(_0x3ec51c,_0x240d52);}Object[a526_0x5e8802(0x89)](exports,a526_0x5e8802(0xa0),{'value':!![]});const sequelize_1=require(a526_0x5e8802(0xa5)),date_fns_1=require(a526_0x5e8802(0x98)),Ticket_1=__importDefault(require(a526_0x5e8802(0x81))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a526_0x5e8802(0x7e))),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require(a526_0x5e8802(0x85))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0xc8d46a,tags:_0x18240c,users:_0x2f0540,status:_0x366ac1,date:_0x538143,startDate:_0xd86479,endDate:_0x4314c0,updatedAt:_0x125d63,showAll:_0x5c8392,userId:_0x17db00,withUnreadMessages:_0x515077,companyId:_0x2032bb})=>{const _0x2ddf3d=a526_0x5e8802,_0x5a23a8=await(0x0,ShowUserService_1[_0x2ddf3d(0x96)])(_0x17db00),_0x4b8c3b=_0x5a23a8[_0x2ddf3d(0x87)][_0x2ddf3d(0x9a)](_0x50548c=>_0x50548c['id']);let _0x5137bc={[sequelize_1['Op']['or']]:[{'userId':_0x17db00},{'status':_0x2ddf3d(0x7a)}],'queueId':{[sequelize_1['Op']['or']]:[_0xc8d46a,null]}},_0x35a059;_0x35a059=[{'model':Contact_1[_0x2ddf3d(0x96)],'as':_0x2ddf3d(0x79),'attributes':['id','name',_0x2ddf3d(0x71),_0x2ddf3d(0xa4),'profilePicUrl',_0x2ddf3d(0x8b)]},{'model':Queue_1['default'],'as':_0x2ddf3d(0x88),'attributes':['id',_0x2ddf3d(0x95),_0x2ddf3d(0x9b)]},{'model':User_1[_0x2ddf3d(0x96)],'as':_0x2ddf3d(0x72),'attributes':['id',_0x2ddf3d(0x95)]},{'model':Tag_1[_0x2ddf3d(0x96)],'as':'tags','attributes':['id',_0x2ddf3d(0x95),_0x2ddf3d(0x9b)]},{'model':Whatsapp_1[_0x2ddf3d(0x96)],'as':'whatsapp','attributes':[_0x2ddf3d(0x95)]}];if(_0x5a23a8['profile']==='user'&&_0x5a23a8['allTicket']===_0x2ddf3d(0x7c)){const _0x100121=[];let _0x329828=[];_0x329828=await Ticket_1[_0x2ddf3d(0x96)][_0x2ddf3d(0x76)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x5a23a8['id'],null]},'companyId':_0x2032bb}});_0x329828&&_0x100121[_0x2ddf3d(0x8e)](_0x329828[_0x2ddf3d(0x9a)](_0xee52a2=>_0xee52a2['id']));const _0x4adcc9=(0x0,lodash_1[_0x2ddf3d(0x8d)])(..._0x100121);_0x5137bc={..._0x5137bc,'id':_0x4adcc9};}if(_0x5a23a8['profile']===_0x2ddf3d(0x72)&&_0x5a23a8[_0x2ddf3d(0x73)]===_0x2ddf3d(0x78)){const _0x45c692=[];let _0x5b3bac=[];_0x5b3bac=await Ticket_1[_0x2ddf3d(0x96)][_0x2ddf3d(0x76)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x5a23a8['id'],null]},'companyId':_0x2032bb,'queueId':{[sequelize_1['Op'][_0x2ddf3d(0x7d)]]:null}}});_0x5b3bac&&_0x45c692[_0x2ddf3d(0x8e)](_0x5b3bac[_0x2ddf3d(0x9a)](_0x406be0=>_0x406be0['id']));const _0x1948d1=(0x0,lodash_1['intersection'])(..._0x45c692);_0x5137bc={..._0x5137bc,'id':_0x1948d1};}_0x5c8392===_0x2ddf3d(0xa2)&&(_0x5137bc={'queueId':{[sequelize_1['Op']['or']]:[_0xc8d46a,null]}});_0x366ac1&&(_0x5137bc={..._0x5137bc,'status':_0x366ac1});_0xd86479&&_0x4314c0&&(_0x5137bc={..._0x5137bc,'createdAt':{[sequelize_1['Op'][_0x2ddf3d(0x84)]]:[+(0x0,date_fns_1[_0x2ddf3d(0x94)])((0x0,date_fns_1[_0x2ddf3d(0x7f)])(_0xd86479)),+(0x0,date_fns_1[_0x2ddf3d(0xab)])((0x0,date_fns_1['parseISO'])(_0x4314c0))]}});if(searchParam){const _0x215463=searchParam[_0x2ddf3d(0x8a)]()[_0x2ddf3d(0x99)]();_0x35a059=[..._0x35a059,{'model':Message_1[_0x2ddf3d(0x96)],'as':_0x2ddf3d(0x75),'attributes':['id',_0x2ddf3d(0xaa)],'where':{'body':(0x0,sequelize_1[_0x2ddf3d(0x74)])((0x0,sequelize_1['fn'])(_0x2ddf3d(0x80),(0x0,sequelize_1[_0x2ddf3d(0x90)])('body')),_0x2ddf3d(0x8c),'%'+_0x215463+'%')},'required':![],'duplicating':![]}],_0x5137bc={..._0x5137bc,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x2ddf3d(0x74)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x2ddf3d(0x90)])(_0x2ddf3d(0x97))),'LIKE','%'+_0x215463+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x2ddf3d(0x7b)]]:'%'+_0x215463+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x2ddf3d(0x80),(0x0,sequelize_1[_0x2ddf3d(0x90)])(_0x2ddf3d(0xaa))),'LIKE','%'+_0x215463+'%')}]};}_0x538143&&(_0x5137bc={'createdAt':{[sequelize_1['Op'][_0x2ddf3d(0x84)]]:[+(0x0,date_fns_1[_0x2ddf3d(0x94)])((0x0,date_fns_1[_0x2ddf3d(0x7f)])(_0x538143)),+(0x0,date_fns_1[_0x2ddf3d(0xab)])((0x0,date_fns_1['parseISO'])(_0x538143))]}});_0x125d63&&(_0x5137bc={'updatedAt':{[sequelize_1['Op'][_0x2ddf3d(0x84)]]:[+(0x0,date_fns_1[_0x2ddf3d(0x94)])((0x0,date_fns_1[_0x2ddf3d(0x7f)])(_0x125d63)),+(0x0,date_fns_1[_0x2ddf3d(0xab)])((0x0,date_fns_1[_0x2ddf3d(0x7f)])(_0x125d63))]}});if(_0x515077===_0x2ddf3d(0xa2)){const _0x5d5764=await(0x0,ShowUserService_1[_0x2ddf3d(0x96)])(_0x17db00),_0x3134c1=_0x5d5764[_0x2ddf3d(0x87)]['map'](_0x244e98=>_0x244e98['id']);_0x5137bc={[sequelize_1['Op']['or']]:[{'userId':_0x17db00},{'status':_0x2ddf3d(0x7a)}],'queueId':{[sequelize_1['Op']['or']]:[_0x3134c1,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x2ddf3d(0xa3)](_0x18240c)&&_0x18240c[_0x2ddf3d(0x91)]>0x0){const _0x3db6b8=[];for(let _0x40bd85 of _0x18240c){const _0x26488d=await TicketTag_1[_0x2ddf3d(0x96)][_0x2ddf3d(0x76)]({'where':{'tagId':_0x40bd85}});_0x26488d&&_0x3db6b8[_0x2ddf3d(0x8e)](_0x26488d[_0x2ddf3d(0x9a)](_0x127b12=>_0x127b12[_0x2ddf3d(0x9d)]));}const _0x15034c=(0x0,lodash_1[_0x2ddf3d(0x8d)])(..._0x3db6b8);_0x5137bc={..._0x5137bc,'id':{[sequelize_1['Op']['in']]:_0x15034c}};}if(Array[_0x2ddf3d(0xa3)](_0x2f0540)&&_0x2f0540[_0x2ddf3d(0x91)]>0x0){const _0x474093=[];for(let _0x40accf of _0x2f0540){const _0x57e966=await Ticket_1[_0x2ddf3d(0x96)][_0x2ddf3d(0x76)]({'where':{'userId':_0x40accf}});_0x57e966&&_0x474093[_0x2ddf3d(0x8e)](_0x57e966['map'](_0x5f3ca8=>_0x5f3ca8['id']));}const _0x3cb266=(0x0,lodash_1['intersection'])(..._0x474093);_0x5137bc={..._0x5137bc,'id':{[sequelize_1['Op']['in']]:_0x3cb266}};}const _0x24d050=0x28,_0x3e54ea=_0x24d050*(+pageNumber-0x1);_0x5137bc={..._0x5137bc,'companyId':_0x2032bb};const {count:_0x516b0d,rows:_0x5af43c}=await Ticket_1['default']['findAndCountAll']({'where':_0x5137bc,'include':_0x35a059,'distinct':!![],'limit':_0x24d050,'offset':_0x3e54ea,'order':[['updatedAt',_0x2ddf3d(0x9c)]],'subQuery':![]}),_0x186657=_0x516b0d>_0x3e54ea+_0x5af43c['length'];return{'tickets':_0x5af43c,'count':_0x516b0d,'hasMore':_0x186657};};exports[a526_0x5e8802(0x96)]=ListTicketsService;