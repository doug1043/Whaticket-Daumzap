const a558_0x4d8d35=a558_0x238d;(function(_0x38b9e2,_0x981bc4){const _0x45a2bd=a558_0x238d,_0x26f7b1=_0x38b9e2();while(!![]){try{const _0x1ccf32=-parseInt(_0x45a2bd(0x128))/0x1+parseInt(_0x45a2bd(0x117))/0x2+-parseInt(_0x45a2bd(0x113))/0x3+-parseInt(_0x45a2bd(0x12e))/0x4*(-parseInt(_0x45a2bd(0x111))/0x5)+parseInt(_0x45a2bd(0x11b))/0x6+parseInt(_0x45a2bd(0x112))/0x7+parseInt(_0x45a2bd(0x10a))/0x8*(-parseInt(_0x45a2bd(0x10d))/0x9);if(_0x1ccf32===_0x981bc4)break;else _0x26f7b1['push'](_0x26f7b1['shift']());}catch(_0x3e038d){_0x26f7b1['push'](_0x26f7b1['shift']());}}}(a558_0x22a9,0x206cc));const a558_0x4c7a8b=(function(){let _0x59cfe9=!![];return function(_0x2b3e77,_0x106a66){const _0x36fc2e=_0x59cfe9?function(){if(_0x106a66){const _0x3e1c2c=_0x106a66['apply'](_0x2b3e77,arguments);return _0x106a66=null,_0x3e1c2c;}}:function(){};return _0x59cfe9=![],_0x36fc2e;};}()),a558_0x206adc=a558_0x4c7a8b(this,function(){const _0xfe8e92=a558_0x238d;return a558_0x206adc[_0xfe8e92(0x13d)]()[_0xfe8e92(0x130)](_0xfe8e92(0x109))[_0xfe8e92(0x13d)]()[_0xfe8e92(0x126)](a558_0x206adc)[_0xfe8e92(0x130)](_0xfe8e92(0x109));});a558_0x206adc();'use strict';var __importDefault=this&&this[a558_0x4d8d35(0x104)]||function(_0x52a3a2){const _0x21d47b=a558_0x4d8d35;return _0x52a3a2&&_0x52a3a2[_0x21d47b(0x122)]?_0x52a3a2:{'default':_0x52a3a2};};Object[a558_0x4d8d35(0x10c)](exports,a558_0x4d8d35(0x122),{'value':!![]});function a558_0x238d(_0x5cd768,_0x181cc1){const _0x8ba404=a558_0x22a9();return a558_0x238d=function(_0x206adc,_0x4c7a8b){_0x206adc=_0x206adc-0x102;let _0x22a987=_0x8ba404[_0x206adc];return _0x22a987;},a558_0x238d(_0x5cd768,_0x181cc1);}const sequelize_1=require('sequelize'),date_fns_1=require(a558_0x4d8d35(0x118)),lodash_1=require(a558_0x4d8d35(0x107)),Ticket_1=__importDefault(require(a558_0x4d8d35(0x11d))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a558_0x4d8d35(0x115))),Queue_1=__importDefault(require(a558_0x4d8d35(0x127))),User_1=__importDefault(require(a558_0x4d8d35(0x10e))),ShowUserService_1=__importDefault(require(a558_0x4d8d35(0x12a))),Tag_1=__importDefault(require(a558_0x4d8d35(0x13f))),TicketTag_1=__importDefault(require('../../models/TicketTag')),Whatsapp_1=__importDefault(require(a558_0x4d8d35(0x125))),CheckSettings_1=require(a558_0x4d8d35(0x136)),ListTicketsService=async({isSearch:isSearch=![],searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0xb20723,tags:_0x138181,users:_0x105c24,status:_0x13231c,groups:_0x12a176,date:_0xa1545a,updatedAt:_0x1f44fb,showAll:_0x5cfb13,userId:_0xadfd5b,withUnreadMessages:_0x4b1dee,notClosed:_0x35f5a2,all:_0xa0c00d,companyId:_0x3662ea})=>{const _0x99c4c9=a558_0x4d8d35,_0x4006f9=!isSearch&&await(0x0,CheckSettings_1[_0x99c4c9(0x103)])(_0x3662ea,'groupsTab','disabled')==='enabled',_0x3bae15=await(0x0,ShowUserService_1[_0x99c4c9(0x134)])(_0xadfd5b);let _0x276ca8={[sequelize_1['Op']['or']]:[{'userId':_0xadfd5b},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:_0x3bae15[_0x99c4c9(0x119)]===_0x99c4c9(0x106)?[_0xb20723,null]:[_0xb20723]}};_0x4006f9&&(_0x276ca8[_0x99c4c9(0x11f)]=_0x12a176===_0x99c4c9(0x123));let _0x26ba37;_0x26ba37=[{'model':Contact_1[_0x99c4c9(0x134)],'as':_0x99c4c9(0x110),'attributes':['id',_0x99c4c9(0x102),_0x99c4c9(0x132),'email','profilePicUrl',_0x99c4c9(0x13c)]},{'model':Queue_1[_0x99c4c9(0x134)],'as':_0x99c4c9(0x133),'attributes':['id',_0x99c4c9(0x102),_0x99c4c9(0x116)]},{'model':User_1[_0x99c4c9(0x134)],'as':_0x99c4c9(0x12f),'attributes':['id',_0x99c4c9(0x102)]},{'model':Tag_1[_0x99c4c9(0x134)],'as':_0x99c4c9(0x121),'attributes':['id','name','color']},{'model':Whatsapp_1['default'],'as':_0x99c4c9(0x12d),'attributes':['id',_0x99c4c9(0x102)]}];_0x5cfb13===_0x99c4c9(0x123)&&_0x3bae15[_0x99c4c9(0x119)]==='admin'&&(_0x276ca8={'queueId':{[sequelize_1['Op']['or']]:[_0xb20723,null]}},_0x4006f9&&(_0x276ca8[_0x99c4c9(0x11f)]=_0x12a176===_0x99c4c9(0x123)));_0x13231c&&(_0x276ca8={..._0x276ca8,'status':_0x13231c});if(searchParam){const _0xe3fbab=searchParam['toLocaleLowerCase']()['trim']();_0x26ba37=[..._0x26ba37,{'model':Message_1['default'],'as':_0x99c4c9(0x13b),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x99c4c9(0x131),(0x0,sequelize_1[_0x99c4c9(0x108)])(_0x99c4c9(0x140))),'LIKE','%'+_0xe3fbab+'%')},'required':![],'duplicating':![]}],_0x276ca8={..._0x276ca8,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x99c4c9(0x13e)])((0x0,sequelize_1['fn'])(_0x99c4c9(0x131),(0x0,sequelize_1[_0x99c4c9(0x108)])(_0x99c4c9(0x138))),_0x99c4c9(0x135),'%'+_0xe3fbab+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x99c4c9(0x114)]]:'%'+_0xe3fbab+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x99c4c9(0x131),(0x0,sequelize_1[_0x99c4c9(0x108)])(_0x99c4c9(0x140))),_0x99c4c9(0x135),'%'+_0xe3fbab+'%')}]};}_0xa1545a&&(_0x276ca8={'createdAt':{[sequelize_1['Op'][_0x99c4c9(0x10f)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x99c4c9(0x12b)])(_0xa1545a)),+(0x0,date_fns_1[_0x99c4c9(0x12c)])((0x0,date_fns_1[_0x99c4c9(0x12b)])(_0xa1545a))]}});_0x1f44fb&&(_0x276ca8={'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x99c4c9(0x12b)])(_0x1f44fb)),+(0x0,date_fns_1[_0x99c4c9(0x12c)])((0x0,date_fns_1[_0x99c4c9(0x12b)])(_0x1f44fb))]}});if(_0x4b1dee==='true'){const _0x2e63ca=_0x3bae15['queues'][_0x99c4c9(0x11e)](_0x116600=>_0x116600['id']);_0x276ca8={[sequelize_1['Op']['or']]:[{'userId':_0xadfd5b},{'status':_0x99c4c9(0x129)}],'queueId':{[sequelize_1['Op']['or']]:_0x3bae15[_0x99c4c9(0x119)]==='admin'?[_0x2e63ca,null]:[_0x2e63ca]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}},_0x4006f9&&(_0x276ca8['isGroup']=_0x12a176===_0x99c4c9(0x123));}if(Array[_0x99c4c9(0x139)](_0x138181)&&_0x138181[_0x99c4c9(0x11c)]>0x0){const _0xe1b5b0=[];for await(const _0x910373 of _0x138181){const _0x2a9b74=await TicketTag_1['default'][_0x99c4c9(0x120)]({'where':{'tagId':_0x910373}});_0x2a9b74&&_0xe1b5b0[_0x99c4c9(0x11a)](_0x2a9b74[_0x99c4c9(0x11e)](_0x532a41=>_0x532a41[_0x99c4c9(0x10b)]));}const _0x55fd40=(0x0,lodash_1['intersection'])(..._0xe1b5b0);_0x276ca8={..._0x276ca8,'id':{[sequelize_1['Op']['in']]:_0x55fd40}};}if(Array['isArray'](_0x105c24)&&_0x105c24[_0x99c4c9(0x11c)]>0x0){const _0x5eeb81=[];for await(const _0x895eb3 of _0x105c24){const _0x115945=await Ticket_1[_0x99c4c9(0x134)]['findAll']({'where':{'userId':_0x895eb3}});_0x115945&&_0x5eeb81[_0x99c4c9(0x11a)](_0x115945[_0x99c4c9(0x11e)](_0x3099fb=>_0x3099fb['id']));}const _0x1fb295=(0x0,lodash_1['intersection'])(..._0x5eeb81);_0x276ca8={..._0x276ca8,'id':{[sequelize_1['Op']['in']]:_0x1fb295}};}const _0x479aba=_0xa0c00d?undefined:0x28,_0x45174e=_0xa0c00d?undefined:_0x479aba*(+pageNumber-0x1);_0x35f5a2&&(_0x276ca8={..._0x276ca8,'status':{[sequelize_1['Op']['ne']]:_0x99c4c9(0x105)}});_0x276ca8={..._0x276ca8,'companyId':_0x3662ea};const {count:_0x54a4f6,rows:_0x3d182b}=await Ticket_1['default'][_0x99c4c9(0x13a)]({'where':_0x276ca8,'include':_0x26ba37,'distinct':!![],'limit':_0x479aba,'offset':_0x45174e,'order':[[_0x99c4c9(0x124),_0x99c4c9(0x137)]],'subQuery':![]}),_0x595da7=_0x54a4f6>_0x45174e+_0x3d182b['length'];return{'tickets':_0x3d182b,'count':_0x54a4f6,'hasMore':_0x595da7};};exports[a558_0x4d8d35(0x134)]=ListTicketsService;function a558_0x22a9(){const _0x34afc5=['lodash','col','(((.+)+)+)+$','325960RVzenP','ticketId','defineProperty','9bPzGCn','../../models/User','between','contact','5kvzCmb','1152130NpgkYU','757932mxqpzv','like','../../models/Message','color','304312gemwgz','date-fns','profile','push','439836mQfcbv','length','../../models/Ticket','map','isGroup','findAll','tags','__esModule','true','updatedAt','../../models/Whatsapp','constructor','../../models/Queue','25132RmJoOx','pending','../UserServices/ShowUserService','parseISO','endOfDay','whatsapp','245124nDVwgd','user','search','LOWER','number','queue','default','LIKE','../../helpers/CheckSettings','DESC','contact.name','isArray','findAndCountAll','messages','presence','toString','where','../../models/Tag','body','name','GetCompanySetting','__importDefault','closed','admin'];a558_0x22a9=function(){return _0x34afc5;};return a558_0x22a9();}