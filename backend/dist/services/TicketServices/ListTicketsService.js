const a527_0x1e5561=a527_0x12a2;(function(_0x53a469,_0x576cdd){const _0x443221=a527_0x12a2,_0x3469ca=_0x53a469();while(!![]){try{const _0x43eed9=parseInt(_0x443221(0x1eb))/0x1*(parseInt(_0x443221(0x1f8))/0x2)+parseInt(_0x443221(0x1ed))/0x3*(-parseInt(_0x443221(0x1e9))/0x4)+-parseInt(_0x443221(0x1de))/0x5*(-parseInt(_0x443221(0x1c9))/0x6)+-parseInt(_0x443221(0x1f3))/0x7*(-parseInt(_0x443221(0x1e1))/0x8)+-parseInt(_0x443221(0x1ce))/0x9*(-parseInt(_0x443221(0x1d6))/0xa)+-parseInt(_0x443221(0x1d1))/0xb*(-parseInt(_0x443221(0x1ec))/0xc)+-parseInt(_0x443221(0x1da))/0xd;if(_0x43eed9===_0x576cdd)break;else _0x3469ca['push'](_0x3469ca['shift']());}catch(_0x2ffa01){_0x3469ca['push'](_0x3469ca['shift']());}}}(a527_0x2514,0x18f2f));function a527_0x12a2(_0x5ab00e,_0x1fd5b7){const _0x57ae3d=a527_0x2514();return a527_0x12a2=function(_0x220303,_0x3030a2){_0x220303=_0x220303-0x1c0;let _0x251448=_0x57ae3d[_0x220303];return _0x251448;},a527_0x12a2(_0x5ab00e,_0x1fd5b7);}const a527_0x3030a2=(function(){let _0x438b9d=!![];return function(_0x12d5f0,_0x68b3f7){const _0x4f80d5=_0x438b9d?function(){if(_0x68b3f7){const _0x567e5e=_0x68b3f7['apply'](_0x12d5f0,arguments);return _0x68b3f7=null,_0x567e5e;}}:function(){};return _0x438b9d=![],_0x4f80d5;};}()),a527_0x220303=a527_0x3030a2(this,function(){const _0x4c1c7b=a527_0x12a2;return a527_0x220303[_0x4c1c7b(0x1ea)]()[_0x4c1c7b(0x1dc)]('(((.+)+)+)+$')[_0x4c1c7b(0x1ea)]()[_0x4c1c7b(0x1e5)](a527_0x220303)[_0x4c1c7b(0x1dc)]('(((.+)+)+)+$');});a527_0x220303();function a527_0x2514(){const _0x4fbac2=['../../models/Queue','body','whatsapp','default','4980uyvcHL','__esModule','map','between','4814160yUROzO','enabled','search','updatedAt','5XAOZSk','lodash','profile','96lCDwlf','../../models/TicketTag','../../models/Contact','color','constructor','disabled','push','trim','44Qedyec','toString','1LmZgYB','7380eOiayh','26529BJwQfx','pending','ticketId','user','LIKE','startOfDay','28301WxsoeR','LOWER','allTicket','contact','presence','373328WHcbzP','../../models/Ticket','like','findAndCountAll','profilePicUrl','queues','defineProperty','name','parseISO','true','findAll','../UserServices/ShowUserService','sequelize','number','where','col','length','intersection','955722InuOOq','date-fns','../../models/User','../../models/Message','__importDefault','801HVlfkK','endOfDay','isArray','2343PStEYm'];a527_0x2514=function(){return _0x4fbac2;};return a527_0x2514();}'use strict';var __importDefault=this&&this[a527_0x1e5561(0x1cd)]||function(_0x8d7c4e){const _0x587350=a527_0x1e5561;return _0x8d7c4e&&_0x8d7c4e[_0x587350(0x1d7)]?_0x8d7c4e:{'default':_0x8d7c4e};};Object[a527_0x1e5561(0x1fe)](exports,a527_0x1e5561(0x1d7),{'value':!![]});const sequelize_1=require(a527_0x1e5561(0x1c3)),date_fns_1=require(a527_0x1e5561(0x1ca)),Ticket_1=__importDefault(require(a527_0x1e5561(0x1f9))),Contact_1=__importDefault(require(a527_0x1e5561(0x1e3))),Message_1=__importDefault(require(a527_0x1e5561(0x1cc))),Queue_1=__importDefault(require(a527_0x1e5561(0x1d2))),User_1=__importDefault(require(a527_0x1e5561(0x1cb))),ShowUserService_1=__importDefault(require(a527_0x1e5561(0x1c2))),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a527_0x1e5561(0x1e2))),lodash_1=require(a527_0x1e5561(0x1df)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x19ee89,tags:_0x3aa03c,users:_0x58b50d,status:_0x577d7b,date:_0x97b731,startDate:_0x292973,endDate:_0xac7916,updatedAt:_0x13b1c,showAll:_0x4cc83a,userId:_0x29b973,withUnreadMessages:_0x51d637,companyId:_0x503602})=>{const _0x232cac=a527_0x1e5561,_0x197dd4=await(0x0,ShowUserService_1['default'])(_0x29b973),_0x2f9682=_0x197dd4[_0x232cac(0x1fd)][_0x232cac(0x1d8)](_0x5001d0=>_0x5001d0['id']);let _0x4b3a28={[sequelize_1['Op']['or']]:[{'userId':_0x29b973},{'status':_0x232cac(0x1ee)}],'queueId':{[sequelize_1['Op']['or']]:[_0x19ee89,null]}},_0x33477b;_0x33477b=[{'model':Contact_1[_0x232cac(0x1d5)],'as':_0x232cac(0x1f6),'attributes':['id','name',_0x232cac(0x1c4),'email',_0x232cac(0x1fc),_0x232cac(0x1f7)]},{'model':Queue_1[_0x232cac(0x1d5)],'as':'queue','attributes':['id',_0x232cac(0x1ff),_0x232cac(0x1e4)]},{'model':User_1['default'],'as':'user','attributes':['id',_0x232cac(0x1ff)]},{'model':Tag_1[_0x232cac(0x1d5)],'as':'tags','attributes':['id',_0x232cac(0x1ff),'color']},{'model':Whatsapp_1[_0x232cac(0x1d5)],'as':_0x232cac(0x1d4),'attributes':[_0x232cac(0x1ff)]}];if(_0x197dd4[_0x232cac(0x1e0)]===_0x232cac(0x1f0)&&_0x197dd4['allTicket']===_0x232cac(0x1db)){const _0xc7f97c=[];let _0x506fa8=[];_0x506fa8=await Ticket_1[_0x232cac(0x1d5)]['findAll']({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x197dd4['id'],null]},'companyId':_0x503602}});_0x506fa8&&_0xc7f97c['push'](_0x506fa8['map'](_0x20391c=>_0x20391c['id']));const _0xeebf87=(0x0,lodash_1[_0x232cac(0x1c8)])(..._0xc7f97c);_0x4b3a28={..._0x4b3a28,'id':_0xeebf87};}if(_0x197dd4[_0x232cac(0x1e0)]===_0x232cac(0x1f0)&&_0x197dd4[_0x232cac(0x1f5)]===_0x232cac(0x1e6)){const _0xaaa37e=[];let _0x50e918=[];_0x50e918=await Ticket_1[_0x232cac(0x1d5)][_0x232cac(0x1c1)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x197dd4['id'],null]},'companyId':_0x503602,'queueId':{[sequelize_1['Op']['not']]:null}}});_0x50e918&&_0xaaa37e[_0x232cac(0x1e7)](_0x50e918[_0x232cac(0x1d8)](_0x144216=>_0x144216['id']));const _0x3380e5=(0x0,lodash_1['intersection'])(..._0xaaa37e);_0x4b3a28={..._0x4b3a28,'id':_0x3380e5};}_0x4cc83a===_0x232cac(0x1c0)&&(_0x4b3a28={'queueId':{[sequelize_1['Op']['or']]:[_0x19ee89,null]}});_0x577d7b&&(_0x4b3a28={..._0x4b3a28,'status':_0x577d7b});_0x292973&&_0xac7916&&(_0x4b3a28={..._0x4b3a28,'createdAt':{[sequelize_1['Op'][_0x232cac(0x1d9)]]:[+(0x0,date_fns_1[_0x232cac(0x1f2)])((0x0,date_fns_1[_0x232cac(0x200)])(_0x292973)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x232cac(0x200)])(_0xac7916))]}});if(searchParam){const _0x3020fb=searchParam['toLocaleLowerCase']()[_0x232cac(0x1e8)]();_0x33477b=[..._0x33477b,{'model':Message_1['default'],'as':'messages','attributes':['id',_0x232cac(0x1d3)],'where':{'body':(0x0,sequelize_1[_0x232cac(0x1c5)])((0x0,sequelize_1['fn'])(_0x232cac(0x1f4),(0x0,sequelize_1[_0x232cac(0x1c6)])(_0x232cac(0x1d3))),_0x232cac(0x1f1),'%'+_0x3020fb+'%')},'required':![],'duplicating':![]}],_0x4b3a28={..._0x4b3a28,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x232cac(0x1c5)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x232cac(0x1c6)])('contact.name')),_0x232cac(0x1f1),'%'+_0x3020fb+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x232cac(0x1fa)]]:'%'+_0x3020fb+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x232cac(0x1c6)])(_0x232cac(0x1d3))),_0x232cac(0x1f1),'%'+_0x3020fb+'%')}]};}_0x97b731&&(_0x4b3a28={'createdAt':{[sequelize_1['Op'][_0x232cac(0x1d9)]]:[+(0x0,date_fns_1[_0x232cac(0x1f2)])((0x0,date_fns_1['parseISO'])(_0x97b731)),+(0x0,date_fns_1[_0x232cac(0x1cf)])((0x0,date_fns_1[_0x232cac(0x200)])(_0x97b731))]}});_0x13b1c&&(_0x4b3a28={'updatedAt':{[sequelize_1['Op'][_0x232cac(0x1d9)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x232cac(0x200)])(_0x13b1c)),+(0x0,date_fns_1[_0x232cac(0x1cf)])((0x0,date_fns_1[_0x232cac(0x200)])(_0x13b1c))]}});if(_0x51d637===_0x232cac(0x1c0)){const _0x34ebf2=await(0x0,ShowUserService_1[_0x232cac(0x1d5)])(_0x29b973),_0x4dfbc9=_0x34ebf2[_0x232cac(0x1fd)][_0x232cac(0x1d8)](_0x2b75b4=>_0x2b75b4['id']);_0x4b3a28={[sequelize_1['Op']['or']]:[{'userId':_0x29b973},{'status':_0x232cac(0x1ee)}],'queueId':{[sequelize_1['Op']['or']]:[_0x4dfbc9,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x232cac(0x1d0)](_0x3aa03c)&&_0x3aa03c[_0x232cac(0x1c7)]>0x0){const _0x2ad870=[];for(let _0xb17a55 of _0x3aa03c){const _0x26347b=await TicketTag_1['default'][_0x232cac(0x1c1)]({'where':{'tagId':_0xb17a55}});_0x26347b&&_0x2ad870[_0x232cac(0x1e7)](_0x26347b[_0x232cac(0x1d8)](_0x3e11ac=>_0x3e11ac[_0x232cac(0x1ef)]));}const _0x132b32=(0x0,lodash_1[_0x232cac(0x1c8)])(..._0x2ad870);_0x4b3a28={..._0x4b3a28,'id':{[sequelize_1['Op']['in']]:_0x132b32}};}if(Array[_0x232cac(0x1d0)](_0x58b50d)&&_0x58b50d['length']>0x0){const _0x55b5df=[];for(let _0x54420c of _0x58b50d){const _0x3a3e6e=await Ticket_1[_0x232cac(0x1d5)]['findAll']({'where':{'userId':_0x54420c}});_0x3a3e6e&&_0x55b5df[_0x232cac(0x1e7)](_0x3a3e6e[_0x232cac(0x1d8)](_0x48aa22=>_0x48aa22['id']));}const _0x430a13=(0x0,lodash_1[_0x232cac(0x1c8)])(..._0x55b5df);_0x4b3a28={..._0x4b3a28,'id':{[sequelize_1['Op']['in']]:_0x430a13}};}const _0x6979e1=0x28,_0x37b1cc=_0x6979e1*(+pageNumber-0x1);_0x4b3a28={..._0x4b3a28,'companyId':_0x503602};const {count:_0x22463a,rows:_0xccaf16}=await Ticket_1['default'][_0x232cac(0x1fb)]({'where':_0x4b3a28,'include':_0x33477b,'distinct':!![],'limit':_0x6979e1,'offset':_0x37b1cc,'order':[[_0x232cac(0x1dd),'DESC']],'subQuery':![]}),_0x1872bd=_0x22463a>_0x37b1cc+_0xccaf16[_0x232cac(0x1c7)];return{'tickets':_0xccaf16,'count':_0x22463a,'hasMore':_0x1872bd};};exports['default']=ListTicketsService;