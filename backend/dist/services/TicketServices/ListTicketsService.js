const a524_0x193950=a524_0x2870;(function(_0x3ff3c5,_0x400f3e){const _0x4c0b0d=a524_0x2870,_0x1e6021=_0x3ff3c5();while(!![]){try{const _0x40568e=parseInt(_0x4c0b0d(0x175))/0x1*(parseInt(_0x4c0b0d(0x196))/0x2)+-parseInt(_0x4c0b0d(0x187))/0x3+-parseInt(_0x4c0b0d(0x16f))/0x4*(-parseInt(_0x4c0b0d(0x17a))/0x5)+-parseInt(_0x4c0b0d(0x193))/0x6*(parseInt(_0x4c0b0d(0x173))/0x7)+-parseInt(_0x4c0b0d(0x1a4))/0x8+parseInt(_0x4c0b0d(0x191))/0x9*(-parseInt(_0x4c0b0d(0x1a2))/0xa)+parseInt(_0x4c0b0d(0x18c))/0xb;if(_0x40568e===_0x400f3e)break;else _0x1e6021['push'](_0x1e6021['shift']());}catch(_0x8268e4){_0x1e6021['push'](_0x1e6021['shift']());}}}(a524_0x9b64,0x85684));const a524_0x1dfcf8=(function(){let _0x5ab9e4=!![];return function(_0x28cc94,_0x263f62){const _0x11afe2=_0x5ab9e4?function(){const _0x593c22=a524_0x2870;if(_0x263f62){const _0x4d700f=_0x263f62[_0x593c22(0x1a6)](_0x28cc94,arguments);return _0x263f62=null,_0x4d700f;}}:function(){};return _0x5ab9e4=![],_0x11afe2;};}()),a524_0x34f6d3=a524_0x1dfcf8(this,function(){const _0x5fd9a9=a524_0x2870;return a524_0x34f6d3[_0x5fd9a9(0x164)]()[_0x5fd9a9(0x165)](_0x5fd9a9(0x180))[_0x5fd9a9(0x164)]()[_0x5fd9a9(0x185)](a524_0x34f6d3)[_0x5fd9a9(0x165)]('(((.+)+)+)+$');});a524_0x34f6d3();'use strict';function a524_0x2870(_0x2c8723,_0x1a80ee){const _0x3396eb=a524_0x9b64();return a524_0x2870=function(_0x34f6d3,_0x1dfcf8){_0x34f6d3=_0x34f6d3-0x163;let _0x9b642d=_0x3396eb[_0x34f6d3];return _0x9b642d;},a524_0x2870(_0x2c8723,_0x1a80ee);}var __importDefault=this&&this[a524_0x193950(0x178)]||function(_0x3dfb63){const _0x4308b9=a524_0x193950;return _0x3dfb63&&_0x3dfb63[_0x4308b9(0x1a5)]?_0x3dfb63:{'default':_0x3dfb63};};Object[a524_0x193950(0x17e)](exports,a524_0x193950(0x1a5),{'value':!![]});const sequelize_1=require('sequelize'),date_fns_1=require('date-fns'),Ticket_1=__importDefault(require(a524_0x193950(0x17c))),Contact_1=__importDefault(require(a524_0x193950(0x167))),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a524_0x193950(0x19f))),ShowUserService_1=__importDefault(require(a524_0x193950(0x190))),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a524_0x193950(0x1a3))),lodash_1=require(a524_0x193950(0x18e)),Whatsapp_1=__importDefault(require(a524_0x193950(0x170))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0xcc3d39,tags:_0x14b656,users:_0x18e553,status:_0x1c99e6,date:_0x5ca402,startDate:_0x2bc661,endDate:_0x413e44,updatedAt:_0x272309,showAll:_0x4b764d,userId:_0x288bd4,withUnreadMessages:_0x55b410,companyId:_0x2a8515})=>{const _0x49bc6f=a524_0x193950,_0x3cee7f=await(0x0,ShowUserService_1['default'])(_0x288bd4),_0x50367e=_0x3cee7f[_0x49bc6f(0x198)][_0x49bc6f(0x192)](_0x29f4a5=>_0x29f4a5['id']);let _0x331eb7={[sequelize_1['Op']['or']]:[{'userId':_0x288bd4},{'status':_0x49bc6f(0x18f)}],'queueId':{[sequelize_1['Op']['or']]:[_0xcc3d39,null]}},_0x400451;_0x400451=[{'model':Contact_1[_0x49bc6f(0x16d)],'as':_0x49bc6f(0x174),'attributes':['id','name',_0x49bc6f(0x17d),_0x49bc6f(0x195),_0x49bc6f(0x184),_0x49bc6f(0x197)]},{'model':Queue_1[_0x49bc6f(0x16d)],'as':'queue','attributes':['id',_0x49bc6f(0x176),_0x49bc6f(0x17b)]},{'model':User_1['default'],'as':_0x49bc6f(0x19b),'attributes':['id',_0x49bc6f(0x176)]},{'model':Tag_1[_0x49bc6f(0x16d)],'as':_0x49bc6f(0x16e),'attributes':['id',_0x49bc6f(0x176),_0x49bc6f(0x17b)]},{'model':Whatsapp_1[_0x49bc6f(0x16d)],'as':_0x49bc6f(0x18d),'attributes':[_0x49bc6f(0x176)]}];if(_0x3cee7f['profile']===_0x49bc6f(0x19b)&&_0x3cee7f[_0x49bc6f(0x163)]===_0x49bc6f(0x171)){const _0x5ae0ab=[];let _0x358e79=[];_0x358e79=await Ticket_1[_0x49bc6f(0x16d)]['findAll']({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x3cee7f['id'],null]},'companyId':_0x2a8515}});_0x358e79&&_0x5ae0ab['push'](_0x358e79[_0x49bc6f(0x192)](_0x39660c=>_0x39660c['id']));const _0x482580=(0x0,lodash_1[_0x49bc6f(0x189)])(..._0x5ae0ab);_0x331eb7={..._0x331eb7,'id':_0x482580};}if(_0x3cee7f[_0x49bc6f(0x183)]===_0x49bc6f(0x19b)&&_0x3cee7f[_0x49bc6f(0x163)]===_0x49bc6f(0x1a1)){const _0x3925e3=[];let _0x292d23=[];_0x292d23=await Ticket_1[_0x49bc6f(0x16d)][_0x49bc6f(0x186)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x3cee7f['id'],null]},'companyId':_0x2a8515,'queueId':{[sequelize_1['Op'][_0x49bc6f(0x181)]]:null}}});_0x292d23&&_0x3925e3[_0x49bc6f(0x169)](_0x292d23[_0x49bc6f(0x192)](_0x2b483c=>_0x2b483c['id']));const _0x469143=(0x0,lodash_1[_0x49bc6f(0x189)])(..._0x3925e3);_0x331eb7={..._0x331eb7,'id':_0x469143};}_0x4b764d==='true'&&(_0x331eb7={'queueId':{[sequelize_1['Op']['or']]:[_0xcc3d39,null]}});_0x1c99e6&&(_0x331eb7={..._0x331eb7,'status':_0x1c99e6});_0x2bc661&&_0x413e44&&(_0x331eb7={..._0x331eb7,'createdAt':{[sequelize_1['Op'][_0x49bc6f(0x194)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x49bc6f(0x19e)])(_0x2bc661)),+(0x0,date_fns_1[_0x49bc6f(0x179)])((0x0,date_fns_1[_0x49bc6f(0x19e)])(_0x413e44))]}});if(searchParam){const _0x3ea95f=searchParam[_0x49bc6f(0x16b)]()[_0x49bc6f(0x18b)]();_0x400451=[..._0x400451,{'model':Message_1[_0x49bc6f(0x16d)],'as':_0x49bc6f(0x18a),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x49bc6f(0x166)])((0x0,sequelize_1['fn'])(_0x49bc6f(0x1a0),(0x0,sequelize_1[_0x49bc6f(0x16c)])(_0x49bc6f(0x19c))),_0x49bc6f(0x19d),'%'+_0x3ea95f+'%')},'required':![],'duplicating':![]}],_0x331eb7={..._0x331eb7,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x49bc6f(0x16c)])(_0x49bc6f(0x168))),_0x49bc6f(0x19d),'%'+_0x3ea95f+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x49bc6f(0x172)]]:'%'+_0x3ea95f+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x49bc6f(0x1a0),(0x0,sequelize_1[_0x49bc6f(0x16c)])(_0x49bc6f(0x19c))),_0x49bc6f(0x19d),'%'+_0x3ea95f+'%')}]};}_0x5ca402&&(_0x331eb7={'createdAt':{[sequelize_1['Op'][_0x49bc6f(0x194)]]:[+(0x0,date_fns_1[_0x49bc6f(0x182)])((0x0,date_fns_1[_0x49bc6f(0x19e)])(_0x5ca402)),+(0x0,date_fns_1[_0x49bc6f(0x179)])((0x0,date_fns_1[_0x49bc6f(0x19e)])(_0x5ca402))]}});_0x272309&&(_0x331eb7={'updatedAt':{[sequelize_1['Op'][_0x49bc6f(0x194)]]:[+(0x0,date_fns_1[_0x49bc6f(0x182)])((0x0,date_fns_1[_0x49bc6f(0x19e)])(_0x272309)),+(0x0,date_fns_1[_0x49bc6f(0x179)])((0x0,date_fns_1[_0x49bc6f(0x19e)])(_0x272309))]}});if(_0x55b410===_0x49bc6f(0x188)){const _0xda446a=await(0x0,ShowUserService_1[_0x49bc6f(0x16d)])(_0x288bd4),_0x4ec086=_0xda446a['queues'][_0x49bc6f(0x192)](_0x2ef8e2=>_0x2ef8e2['id']);_0x331eb7={[sequelize_1['Op']['or']]:[{'userId':_0x288bd4},{'status':_0x49bc6f(0x18f)}],'queueId':{[sequelize_1['Op']['or']]:[_0x4ec086,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array['isArray'](_0x14b656)&&_0x14b656[_0x49bc6f(0x177)]>0x0){const _0x300c53=[];for(let _0x262db6 of _0x14b656){const _0x3978f1=await TicketTag_1[_0x49bc6f(0x16d)][_0x49bc6f(0x186)]({'where':{'tagId':_0x262db6}});_0x3978f1&&_0x300c53['push'](_0x3978f1['map'](_0x1c88f3=>_0x1c88f3['ticketId']));}const _0xa88403=(0x0,lodash_1['intersection'])(..._0x300c53);_0x331eb7={..._0x331eb7,'id':{[sequelize_1['Op']['in']]:_0xa88403}};}if(Array[_0x49bc6f(0x199)](_0x18e553)&&_0x18e553[_0x49bc6f(0x177)]>0x0){const _0x450494=[];for(let _0x18e973 of _0x18e553){const _0x5c9a31=await Ticket_1[_0x49bc6f(0x16d)][_0x49bc6f(0x186)]({'where':{'userId':_0x18e973}});_0x5c9a31&&_0x450494[_0x49bc6f(0x169)](_0x5c9a31['map'](_0x50d793=>_0x50d793['id']));}const _0x19a5b2=(0x0,lodash_1[_0x49bc6f(0x189)])(..._0x450494);_0x331eb7={..._0x331eb7,'id':{[sequelize_1['Op']['in']]:_0x19a5b2}};}const _0x5ce765=0x28,_0x1bde47=_0x5ce765*(+pageNumber-0x1);_0x331eb7={..._0x331eb7,'companyId':_0x2a8515};const {count:_0x3a7c12,rows:_0x5a9dd5}=await Ticket_1[_0x49bc6f(0x16d)][_0x49bc6f(0x17f)]({'where':_0x331eb7,'include':_0x400451,'distinct':!![],'limit':_0x5ce765,'offset':_0x1bde47,'order':[[_0x49bc6f(0x16a),_0x49bc6f(0x19a)]],'subQuery':![]}),_0x466854=_0x3a7c12>_0x1bde47+_0x5a9dd5[_0x49bc6f(0x177)];return{'tickets':_0x5a9dd5,'count':_0x3a7c12,'hasMore':_0x466854};};function a524_0x9b64(){const _0x4c4493=['tags','104uwLMEU','../../models/Whatsapp','enabled','like','91olKuxS','contact','7NadlIU','name','length','__importDefault','endOfDay','204395sCSHxU','color','../../models/Ticket','number','defineProperty','findAndCountAll','(((.+)+)+)+$','not','startOfDay','profile','profilePicUrl','constructor','findAll','2137845kQCNrt','true','intersection','messages','trim','17070625JOISmT','whatsapp','lodash','pending','../UserServices/ShowUserService','4785516vFiSvh','map','286626hrbFMC','between','email','211246QoUbcj','presence','queues','isArray','DESC','user','body','LIKE','parseISO','../../models/User','LOWER','disabled','10ZAmUZi','../../models/TicketTag','7538336OLWGMa','__esModule','apply','allTicket','toString','search','where','../../models/Contact','contact.name','push','updatedAt','toLocaleLowerCase','col','default'];a524_0x9b64=function(){return _0x4c4493;};return a524_0x9b64();}exports['default']=ListTicketsService;