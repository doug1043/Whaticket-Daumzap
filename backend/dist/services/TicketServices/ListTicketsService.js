const a555_0x45b9a1=a555_0x367c;function a555_0x367c(_0x63d1b7,_0x582e13){const _0x31326a=a555_0x132e();return a555_0x367c=function(_0x4020f0,_0x260224){_0x4020f0=_0x4020f0-0x175;let _0x132e4f=_0x31326a[_0x4020f0];return _0x132e4f;},a555_0x367c(_0x63d1b7,_0x582e13);}(function(_0x35f713,_0x36d438){const _0x5a46ed=a555_0x367c,_0x121162=_0x35f713();while(!![]){try{const _0x3f6ad7=parseInt(_0x5a46ed(0x188))/0x1*(-parseInt(_0x5a46ed(0x185))/0x2)+-parseInt(_0x5a46ed(0x1b4))/0x3+parseInt(_0x5a46ed(0x189))/0x4+parseInt(_0x5a46ed(0x186))/0x5+-parseInt(_0x5a46ed(0x1b6))/0x6+parseInt(_0x5a46ed(0x1b3))/0x7+-parseInt(_0x5a46ed(0x178))/0x8*(-parseInt(_0x5a46ed(0x176))/0x9);if(_0x3f6ad7===_0x36d438)break;else _0x121162['push'](_0x121162['shift']());}catch(_0x21181b){_0x121162['push'](_0x121162['shift']());}}}(a555_0x132e,0x50e99));const a555_0x260224=(function(){let _0x58b38c=!![];return function(_0x45aa84,_0x312cc0){const _0x20632b=_0x58b38c?function(){const _0x42b487=a555_0x367c;if(_0x312cc0){const _0x2ee22d=_0x312cc0[_0x42b487(0x1b8)](_0x45aa84,arguments);return _0x312cc0=null,_0x2ee22d;}}:function(){};return _0x58b38c=![],_0x20632b;};}()),a555_0x4020f0=a555_0x260224(this,function(){const _0x571590=a555_0x367c;return a555_0x4020f0[_0x571590(0x19b)]()[_0x571590(0x1b0)](_0x571590(0x17e))[_0x571590(0x19b)]()[_0x571590(0x198)](a555_0x4020f0)[_0x571590(0x1b0)](_0x571590(0x17e));});a555_0x4020f0();'use strict';var __importDefault=this&&this[a555_0x45b9a1(0x1b5)]||function(_0x5eace9){return _0x5eace9&&_0x5eace9['__esModule']?_0x5eace9:{'default':_0x5eace9};};Object[a555_0x45b9a1(0x19a)](exports,a555_0x45b9a1(0x1a7),{'value':!![]});const sequelize_1=require(a555_0x45b9a1(0x17b)),date_fns_1=require(a555_0x45b9a1(0x194)),lodash_1=require(a555_0x45b9a1(0x199)),Ticket_1=__importDefault(require(a555_0x45b9a1(0x1a9))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a555_0x45b9a1(0x17f))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a555_0x45b9a1(0x1a3))),ShowUserService_1=__importDefault(require(a555_0x45b9a1(0x19d))),Tag_1=__importDefault(require(a555_0x45b9a1(0x18d))),TicketTag_1=__importDefault(require(a555_0x45b9a1(0x19e))),Whatsapp_1=__importDefault(require(a555_0x45b9a1(0x1a1))),CheckSettings_1=require(a555_0x45b9a1(0x182)),ListTicketsService=async({isSearch:isSearch=![],searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x54df70,tags:_0xda3058,users:_0x48cd03,status:_0x4844f7,groups:_0x45477c,date:_0x451658,updatedAt:_0x3a8a29,showAll:_0x3b239c,userId:_0x7398d8,withUnreadMessages:_0x20683a,notClosed:_0x46493b,all:_0x4346d7,companyId:_0x46c5f6})=>{const _0x15d1a5=a555_0x45b9a1,_0x3c2ecf=!isSearch&&await(0x0,CheckSettings_1['GetCompanySetting'])(_0x46c5f6,_0x15d1a5(0x1b1),_0x15d1a5(0x1a0))===_0x15d1a5(0x180),_0xff5a1f=await(0x0,ShowUserService_1['default'])(_0x7398d8);let _0xe9837a={[sequelize_1['Op']['or']]:[{'userId':_0x7398d8},{'status':_0x15d1a5(0x197)}],'queueId':{[sequelize_1['Op']['or']]:_0xff5a1f[_0x15d1a5(0x181)]===_0x15d1a5(0x17a)?[_0x54df70,null]:[_0x54df70]}};_0x3c2ecf&&(_0xe9837a['isGroup']=_0x45477c===_0x15d1a5(0x196));let _0x1a10d7;_0x1a10d7=[{'model':Contact_1[_0x15d1a5(0x179)],'as':_0x15d1a5(0x192),'attributes':['id','name','number',_0x15d1a5(0x18e),'profilePicUrl',_0x15d1a5(0x1ac)]},{'model':Queue_1[_0x15d1a5(0x179)],'as':'queue','attributes':['id',_0x15d1a5(0x195),'color']},{'model':User_1[_0x15d1a5(0x179)],'as':'user','attributes':['id','name']},{'model':Tag_1[_0x15d1a5(0x179)],'as':'tags','attributes':['id',_0x15d1a5(0x195),_0x15d1a5(0x18c)]},{'model':Whatsapp_1[_0x15d1a5(0x179)],'as':_0x15d1a5(0x1b2),'attributes':['id',_0x15d1a5(0x195)]}];_0x3b239c===_0x15d1a5(0x196)&&_0xff5a1f[_0x15d1a5(0x181)]===_0x15d1a5(0x17a)&&(_0xe9837a={'queueId':{[sequelize_1['Op']['or']]:[_0x54df70,null]}},_0x3c2ecf&&(_0xe9837a[_0x15d1a5(0x1af)]=_0x45477c==='true'));_0x4844f7&&(_0xe9837a={..._0xe9837a,'status':_0x4844f7});if(searchParam){const _0x489381=searchParam[_0x15d1a5(0x191)]()[_0x15d1a5(0x18a)]();_0x1a10d7=[..._0x1a10d7,{'model':Message_1[_0x15d1a5(0x179)],'as':_0x15d1a5(0x18b),'attributes':['id',_0x15d1a5(0x193)],'where':{'body':(0x0,sequelize_1[_0x15d1a5(0x1a4)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['col'])(_0x15d1a5(0x193))),_0x15d1a5(0x177),'%'+_0x489381+'%')},'required':![],'duplicating':![]}],_0xe9837a={..._0xe9837a,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x15d1a5(0x1a4)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x15d1a5(0x1b7)])(_0x15d1a5(0x17d))),'LIKE','%'+_0x489381+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x15d1a5(0x1ad)]]:'%'+_0x489381+'%'}},{'$message.body$':(0x0,sequelize_1[_0x15d1a5(0x1a4)])((0x0,sequelize_1['fn'])(_0x15d1a5(0x1a2),(0x0,sequelize_1[_0x15d1a5(0x1b7)])(_0x15d1a5(0x193))),_0x15d1a5(0x177),'%'+_0x489381+'%')}]};}_0x451658&&(_0xe9837a={'createdAt':{[sequelize_1['Op'][_0x15d1a5(0x17c)]]:[+(0x0,date_fns_1[_0x15d1a5(0x1a5)])((0x0,date_fns_1[_0x15d1a5(0x19c)])(_0x451658)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x15d1a5(0x19c)])(_0x451658))]}});_0x3a8a29&&(_0xe9837a={'updatedAt':{[sequelize_1['Op'][_0x15d1a5(0x17c)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x15d1a5(0x19c)])(_0x3a8a29)),+(0x0,date_fns_1[_0x15d1a5(0x1ae)])((0x0,date_fns_1['parseISO'])(_0x3a8a29))]}});if(_0x20683a==='true'){const _0x470f79=_0xff5a1f[_0x15d1a5(0x1aa)][_0x15d1a5(0x175)](_0x35a9f5=>_0x35a9f5['id']);_0xe9837a={[sequelize_1['Op']['or']]:[{'userId':_0x7398d8},{'status':_0x15d1a5(0x197)}],'queueId':{[sequelize_1['Op']['or']]:_0xff5a1f[_0x15d1a5(0x181)]==='admin'?[_0x470f79,null]:[_0x470f79]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}},_0x3c2ecf&&(_0xe9837a[_0x15d1a5(0x1af)]=_0x45477c==='true');}if(Array[_0x15d1a5(0x1a6)](_0xda3058)&&_0xda3058[_0x15d1a5(0x184)]>0x0){const _0x469d4c=[];for await(const _0x24bab5 of _0xda3058){const _0xf55ecb=await TicketTag_1[_0x15d1a5(0x179)][_0x15d1a5(0x183)]({'where':{'tagId':_0x24bab5}});_0xf55ecb&&_0x469d4c[_0x15d1a5(0x1a8)](_0xf55ecb[_0x15d1a5(0x175)](_0x820206=>_0x820206[_0x15d1a5(0x19f)]));}const _0x3386da=(0x0,lodash_1['intersection'])(..._0x469d4c);_0xe9837a={..._0xe9837a,'id':{[sequelize_1['Op']['in']]:_0x3386da}};}if(Array[_0x15d1a5(0x1a6)](_0x48cd03)&&_0x48cd03[_0x15d1a5(0x184)]>0x0){const _0x4f7227=[];for await(const _0x1e149b of _0x48cd03){const _0x577f8c=await Ticket_1[_0x15d1a5(0x179)][_0x15d1a5(0x183)]({'where':{'userId':_0x1e149b}});_0x577f8c&&_0x4f7227['push'](_0x577f8c['map'](_0x1a1e42=>_0x1a1e42['id']));}const _0x11b33f=(0x0,lodash_1['intersection'])(..._0x4f7227);_0xe9837a={..._0xe9837a,'id':{[sequelize_1['Op']['in']]:_0x11b33f}};}const _0x3f0923=_0x4346d7?undefined:0x28,_0xba66dc=_0x4346d7?undefined:_0x3f0923*(+pageNumber-0x1);_0x46493b&&(_0xe9837a={..._0xe9837a,'status':{[sequelize_1['Op']['ne']]:_0x15d1a5(0x1ab)}});_0xe9837a={..._0xe9837a,'companyId':_0x46c5f6};const {count:_0x5ed72e,rows:_0x143a74}=await Ticket_1[_0x15d1a5(0x179)][_0x15d1a5(0x18f)]({'where':_0xe9837a,'include':_0x1a10d7,'distinct':!![],'limit':_0x3f0923,'offset':_0xba66dc,'order':[[_0x15d1a5(0x187),_0x15d1a5(0x190)]],'subQuery':![]}),_0x3c0d01=_0x5ed72e>_0xba66dc+_0x143a74[_0x15d1a5(0x184)];return{'tickets':_0x143a74,'count':_0x5ed72e,'hasMore':_0x3c0d01};};function a555_0x132e(){const _0x59c148=['endOfDay','isGroup','search','groupsTab','whatsapp','1397417iFRnxW','726432yMhZma','__importDefault','596076vPrvmf','col','apply','map','2556ToGeNw','LIKE','6752bwjXxR','default','admin','sequelize','between','contact.name','(((.+)+)+)+$','../../models/Message','enabled','profile','../../helpers/CheckSettings','findAll','length','20xGvJAg','2476890ZjssYn','updatedAt','50534DXIMWE','974168YLhMpo','trim','messages','color','../../models/Tag','email','findAndCountAll','DESC','toLocaleLowerCase','contact','body','date-fns','name','true','pending','constructor','lodash','defineProperty','toString','parseISO','../UserServices/ShowUserService','../../models/TicketTag','ticketId','disabled','../../models/Whatsapp','LOWER','../../models/User','where','startOfDay','isArray','__esModule','push','../../models/Ticket','queues','closed','presence','like'];a555_0x132e=function(){return _0x59c148;};return a555_0x132e();}exports['default']=ListTicketsService;