const a668_0x144e7b=a668_0x16f9;(function(_0x32606b,_0x4471eb){const _0x2628e2=a668_0x16f9,_0x3ad8e9=_0x32606b();while(!![]){try{const _0x5129eb=parseInt(_0x2628e2(0xe5))/0x1+-parseInt(_0x2628e2(0xea))/0x2+-parseInt(_0x2628e2(0x127))/0x3*(-parseInt(_0x2628e2(0xfe))/0x4)+-parseInt(_0x2628e2(0x11f))/0x5*(parseInt(_0x2628e2(0x108))/0x6)+-parseInt(_0x2628e2(0xf6))/0x7*(parseInt(_0x2628e2(0x114))/0x8)+parseInt(_0x2628e2(0x116))/0x9+parseInt(_0x2628e2(0x10b))/0xa;if(_0x5129eb===_0x4471eb)break;else _0x3ad8e9['push'](_0x3ad8e9['shift']());}catch(_0x1957aa){_0x3ad8e9['push'](_0x3ad8e9['shift']());}}}(a668_0x1a34,0x47483));function a668_0x16f9(_0x4c8ec5,_0x242d8d){const _0x15df2f=a668_0x1a34();return a668_0x16f9=function(_0x55716f,_0x5de860){_0x55716f=_0x55716f-0xe5;let _0x1a34d6=_0x15df2f[_0x55716f];return _0x1a34d6;},a668_0x16f9(_0x4c8ec5,_0x242d8d);}const a668_0x5de860=(function(){let _0x418824=!![];return function(_0x587a21,_0x594ba7){const _0xa48b7f=_0x418824?function(){const _0x43f435=a668_0x16f9;if(_0x594ba7){const _0x35382c=_0x594ba7[_0x43f435(0x111)](_0x587a21,arguments);return _0x594ba7=null,_0x35382c;}}:function(){};return _0x418824=![],_0xa48b7f;};}()),a668_0x55716f=a668_0x5de860(this,function(){const _0x5347fd=a668_0x16f9;return a668_0x55716f['toString']()[_0x5347fd(0x125)]('(((.+)+)+)+$')[_0x5347fd(0xfd)]()[_0x5347fd(0xec)](a668_0x55716f)['search'](_0x5347fd(0xfc));});a668_0x55716f();function a668_0x1a34(){const _0x2f7480=['closed','660232cjVkFF','../../models/User','3176865SOOuXW','../../models/Whatsapp','DESC','tags','pending','email','queues','trim','intersection','296735caWPqc','GetCompanySetting','../../models/Queue','findAll','notIn','isArray','search','disabled','46323rSxEly','246927eBOpak','isGroup','between','profilePicUrl','admin','456324fHLtNs','enabled','constructor','true','superv','length','profile','LIKE','object','findAndCountAll','endOfDay','col','7bgdGnO','parseISO','like','color','sequelize','default','(((.+)+)+)+$','toString','20dUjYvk','presence','name','where','LOWER','../../models/TicketTag','push','../../helpers/CheckSettings','queue','messages','54oTlHts','ticketId','map','4596680sBtYMP','../UserServices/ShowUserService','__esModule','../../models/Ticket','body','startOfDay','apply','updatedAt'];a668_0x1a34=function(){return _0x2f7480;};return a668_0x1a34();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x185b7d){const _0x2c2a37=a668_0x16f9;return _0x185b7d&&_0x185b7d[_0x2c2a37(0x10d)]?_0x185b7d:{'default':_0x185b7d};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const sequelize_1=require(a668_0x144e7b(0xfa)),date_fns_1=require('date-fns'),lodash_1=require('lodash'),Ticket_1=__importDefault(require(a668_0x144e7b(0x10e))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require(a668_0x144e7b(0x121))),User_1=__importDefault(require(a668_0x144e7b(0x115))),ShowUserService_1=__importDefault(require(a668_0x144e7b(0x10c))),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a668_0x144e7b(0x103))),Whatsapp_1=__importDefault(require(a668_0x144e7b(0x117))),CheckSettings_1=require(a668_0x144e7b(0x105)),ListTicketsService=async({isSearch:isSearch=![],searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x1b20e1,tags:_0x5818bd,users:_0x4082ca,status:_0x3db256,groups:_0x44c036,date:_0x947b40,updatedAt:_0x4cac99,showAll:_0x7cc68b,userId:_0x470307,withUnreadMessages:_0x18f99a,notClosed:_0x2c6dd5,all:_0x4fcefd,companyId:_0x4aec67})=>{const _0x4280c7=a668_0x144e7b,_0x2a5903=!isSearch&&await(0x0,CheckSettings_1[_0x4280c7(0x120)])(_0x4aec67,'groupsTab',_0x4280c7(0x126))===_0x4280c7(0xeb),_0x3feeaa=await(0x0,ShowUserService_1[_0x4280c7(0xfb)])(_0x470307);let _0x1f9f57={};const _0x4fb702=_0x7cc68b==='true',_0x21bfe0=()=>{if(_0x1b20e1['length']>0x0)return{[sequelize_1['Op']['or']]:[{[sequelize_1['Op']['in']]:_0x1b20e1},null]};return{[sequelize_1['Op']['or']]:[{[sequelize_1['Op']['ne']]:null},null]};},_0x2b5c4e=_0x3db256===_0x4280c7(0x11a);if(_0x3feeaa[_0x4280c7(0xf0)]===_0x4280c7(0xe9))_0x4fb702?_0x1f9f57={'queueId':_0x21bfe0()}:_0x2b5c4e?_0x1f9f57={'queueId':_0x21bfe0(),'userId':null}:_0x1f9f57={'userId':_0x3feeaa['id']};else{if(_0x3feeaa[_0x4280c7(0xf0)]===_0x4280c7(0xee)){const _0x3d6298=await User_1[_0x4280c7(0xfb)][_0x4280c7(0x122)]({'where':{'companyId':_0x4aec67,'profile':_0x4280c7(0xe9)},'attributes':['id']}),_0xa0b5c4=_0x3d6298['map'](_0x57d2be=>_0x57d2be['id']);_0x4fb702?_0x1f9f57={'queueId':_0x21bfe0(),[sequelize_1['Op']['or']]:[{'userId':{[sequelize_1['Op'][_0x4280c7(0x123)]]:_0xa0b5c4}},{'userId':null}]}:_0x2b5c4e?_0x1f9f57={'queueId':_0x21bfe0(),'userId':null}:_0x1f9f57={'userId':_0x3feeaa['id']};}else _0x1b20e1[_0x4280c7(0xef)]===0x0?_0x1f9f57={'userId':_0x3feeaa['id'],'queueId':null}:_0x1f9f57={[sequelize_1['Op']['or']]:[{'userId':_0x3feeaa['id']},{'status':_0x4280c7(0x11a),'queueId':{[sequelize_1['Op']['in']]:_0x1b20e1}}]};}_0x2a5903&&(typeof _0x1f9f57===_0x4280c7(0xf2)&&!Array['isArray'](_0x1f9f57)&&(_0x1f9f57={..._0x1f9f57,'isGroup':_0x44c036===_0x4280c7(0xed)}));let _0x249289;_0x249289=[{'model':Contact_1[_0x4280c7(0xfb)],'as':'contact','attributes':['id','name','number',_0x4280c7(0x11b),_0x4280c7(0xe8),_0x4280c7(0xff)]},{'model':Queue_1[_0x4280c7(0xfb)],'as':_0x4280c7(0x106),'attributes':['id',_0x4280c7(0x100),_0x4280c7(0xf9)]},{'model':User_1[_0x4280c7(0xfb)],'as':'user','attributes':['id',_0x4280c7(0x100)]},{'model':Tag_1[_0x4280c7(0xfb)],'as':_0x4280c7(0x119),'attributes':['id',_0x4280c7(0x100),_0x4280c7(0xf9)]},{'model':Whatsapp_1[_0x4280c7(0xfb)],'as':'whatsapp','attributes':['id','name']}];_0x3db256&&(_0x1f9f57={..._0x1f9f57,'status':_0x3db256});if(searchParam){const _0x1d70df=searchParam['toLocaleLowerCase']()[_0x4280c7(0x11d)]();_0x249289=[..._0x249289,{'model':Message_1[_0x4280c7(0xfb)],'as':_0x4280c7(0x107),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x4280c7(0x101)])((0x0,sequelize_1['fn'])(_0x4280c7(0x102),(0x0,sequelize_1[_0x4280c7(0xf5)])(_0x4280c7(0x10f))),_0x4280c7(0xf1),'%'+_0x1d70df+'%')},'required':![],'duplicating':![]}],_0x1f9f57={..._0x1f9f57,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x4280c7(0x101)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x4280c7(0xf5)])('contact.name')),_0x4280c7(0xf1),'%'+_0x1d70df+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x4280c7(0xf8)]]:'%'+_0x1d70df+'%'}},{'$message.body$':(0x0,sequelize_1[_0x4280c7(0x101)])((0x0,sequelize_1['fn'])(_0x4280c7(0x102),(0x0,sequelize_1[_0x4280c7(0xf5)])('body')),_0x4280c7(0xf1),'%'+_0x1d70df+'%')}]};}_0x947b40&&(_0x1f9f57={'createdAt':{[sequelize_1['Op'][_0x4280c7(0xe7)]]:[+(0x0,date_fns_1[_0x4280c7(0x110)])((0x0,date_fns_1[_0x4280c7(0xf7)])(_0x947b40)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x4280c7(0xf7)])(_0x947b40))]}});_0x4cac99&&(_0x1f9f57={'updatedAt':{[sequelize_1['Op'][_0x4280c7(0xe7)]]:[+(0x0,date_fns_1[_0x4280c7(0x110)])((0x0,date_fns_1[_0x4280c7(0xf7)])(_0x4cac99)),+(0x0,date_fns_1[_0x4280c7(0xf4)])((0x0,date_fns_1[_0x4280c7(0xf7)])(_0x4cac99))]}});if(_0x18f99a===_0x4280c7(0xed)){const _0x26086b=_0x3feeaa[_0x4280c7(0x11c)][_0x4280c7(0x10a)](_0x161498=>_0x161498['id']);_0x1f9f57={[sequelize_1['Op']['or']]:[{'userId':_0x470307},{'status':_0x4280c7(0x11a)}],'queueId':{[sequelize_1['Op']['or']]:_0x3feeaa[_0x4280c7(0xf0)]===_0x4280c7(0xe9)?[_0x26086b,null]:[_0x26086b]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}},_0x2a5903&&(_0x1f9f57[_0x4280c7(0xe6)]=_0x44c036==='true');}if(Array[_0x4280c7(0x124)](_0x5818bd)&&_0x5818bd[_0x4280c7(0xef)]>0x0){const _0x429f5e=[];for await(const _0x5384ee of _0x5818bd){const _0x423c23=await TicketTag_1[_0x4280c7(0xfb)][_0x4280c7(0x122)]({'where':{'tagId':_0x5384ee}});_0x423c23&&_0x429f5e[_0x4280c7(0x104)](_0x423c23[_0x4280c7(0x10a)](_0x2b2189=>_0x2b2189[_0x4280c7(0x109)]));}const _0x5735fb=(0x0,lodash_1[_0x4280c7(0x11e)])(..._0x429f5e);_0x1f9f57={..._0x1f9f57,'id':{[sequelize_1['Op']['in']]:_0x5735fb}};}if(Array['isArray'](_0x4082ca)&&_0x4082ca[_0x4280c7(0xef)]>0x0){const _0x479335=[];for await(const _0x323de0 of _0x4082ca){const _0x4c5a3f=await Ticket_1[_0x4280c7(0xfb)]['findAll']({'where':{'userId':_0x323de0}});_0x4c5a3f&&_0x479335[_0x4280c7(0x104)](_0x4c5a3f[_0x4280c7(0x10a)](_0x360b24=>_0x360b24['id']));}const _0x3f3714=(0x0,lodash_1['intersection'])(..._0x479335);_0x1f9f57={..._0x1f9f57,'id':{[sequelize_1['Op']['in']]:_0x3f3714}};}const _0x5f1ad0=_0x4fcefd?undefined:0x28,_0x1f831d=_0x4fcefd?undefined:_0x5f1ad0*(+pageNumber-0x1);_0x2c6dd5&&(_0x1f9f57={..._0x1f9f57,'status':{[sequelize_1['Op']['ne']]:_0x4280c7(0x113)}});_0x1f9f57={..._0x1f9f57,'companyId':_0x4aec67};const {count:_0x4d94da,rows:_0x5ee305}=await Ticket_1[_0x4280c7(0xfb)][_0x4280c7(0xf3)]({'where':_0x1f9f57,'include':_0x249289,'distinct':!![],'limit':_0x5f1ad0,'offset':_0x1f831d,'order':[[_0x4280c7(0x112),_0x4280c7(0x118)]],'subQuery':![]}),_0x1eaf85=_0x4d94da>_0x1f831d+_0x5ee305[_0x4280c7(0xef)];return{'tickets':_0x5ee305,'count':_0x4d94da,'hasMore':_0x1eaf85};};exports['default']=ListTicketsService;