const a517_0x375b56=a517_0x168d;(function(_0x4492b1,_0x5ce310){const _0x47060f=a517_0x168d,_0x37b356=_0x4492b1();while(!![]){try{const _0x55ea8c=-parseInt(_0x47060f(0x208))/0x1+-parseInt(_0x47060f(0x20f))/0x2*(parseInt(_0x47060f(0x203))/0x3)+-parseInt(_0x47060f(0x1f9))/0x4*(parseInt(_0x47060f(0x1da))/0x5)+parseInt(_0x47060f(0x1d7))/0x6+-parseInt(_0x47060f(0x205))/0x7+parseInt(_0x47060f(0x20b))/0x8*(-parseInt(_0x47060f(0x1e7))/0x9)+parseInt(_0x47060f(0x1d8))/0xa*(parseInt(_0x47060f(0x1e0))/0xb);if(_0x55ea8c===_0x5ce310)break;else _0x37b356['push'](_0x37b356['shift']());}catch(_0x5d7acd){_0x37b356['push'](_0x37b356['shift']());}}}(a517_0x4e67,0xf22ea));function a517_0x168d(_0x18b2ab,_0x354ae6){const _0x13e1f3=a517_0x4e67();return a517_0x168d=function(_0x5c79d7,_0x443a56){_0x5c79d7=_0x5c79d7-0x1d2;let _0x4e67fd=_0x13e1f3[_0x5c79d7];return _0x4e67fd;},a517_0x168d(_0x18b2ab,_0x354ae6);}const a517_0x443a56=(function(){let _0x3aef8a=!![];return function(_0x21c1db,_0x270d9c){const _0x4e3ad4=_0x3aef8a?function(){const _0x17e142=a517_0x168d;if(_0x270d9c){const _0x56fc84=_0x270d9c[_0x17e142(0x209)](_0x21c1db,arguments);return _0x270d9c=null,_0x56fc84;}}:function(){};return _0x3aef8a=![],_0x4e3ad4;};}()),a517_0x5c79d7=a517_0x443a56(this,function(){const _0x4d3739=a517_0x168d;return a517_0x5c79d7['toString']()[_0x4d3739(0x1ea)](_0x4d3739(0x1e2))[_0x4d3739(0x1e5)]()['constructor'](a517_0x5c79d7)[_0x4d3739(0x1ea)]('(((.+)+)+)+$');});a517_0x5c79d7();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1490ba){const _0x194de0=a517_0x168d;return _0x1490ba&&_0x1490ba[_0x194de0(0x210)]?_0x1490ba:{'default':_0x1490ba};};function a517_0x4e67(){const _0x59cab9=['date-fns','113258FqjmVl','apply','endOfDay','4364808jXeBMe','between','color','push','4Krdxug','__esModule','LIKE','contact.name','intersection','where','sequelize','2752320WnJiaS','690cvnpDP','queues','49325GjHbfk','../../models/Queue','updatedAt','toLocaleLowerCase','default','trim','747835ryniKx','../../models/Ticket','(((.+)+)+)+$','presence','like','toString','messages','27zOEyHm','col','name','search','whatsapp','defineProperty','LOWER','map','user','../../models/Message','disabled','startOfDay','enabled','parseISO','contact','email','DESC','allTicket','424gVRYyu','body','lodash','ticketId','true','length','findAll','../../models/Whatsapp','../../models/TicketTag','isArray','1141467suZGLQ','pending','4206846IKYxlu','profilePicUrl'];a517_0x4e67=function(){return _0x59cab9;};return a517_0x4e67();}Object[a517_0x375b56(0x1ec)](exports,a517_0x375b56(0x210),{'value':!![]});const sequelize_1=require(a517_0x375b56(0x1d6)),date_fns_1=require(a517_0x375b56(0x207)),Ticket_1=__importDefault(require(a517_0x375b56(0x1e1))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a517_0x375b56(0x1f0))),Queue_1=__importDefault(require(a517_0x375b56(0x1db))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a517_0x375b56(0x201))),lodash_1=require(a517_0x375b56(0x1fb)),Whatsapp_1=__importDefault(require(a517_0x375b56(0x200))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x2b7edb,tags:_0x11b970,users:_0x20d91c,status:_0x4ee280,date:_0x17b95c,startDate:_0x3dcde3,endDate:_0x4a96aa,updatedAt:_0xec3d5d,showAll:_0x4be5f0,userId:_0x445e14,withUnreadMessages:_0x5bcd04,companyId:_0x282480})=>{const _0x1244f3=a517_0x375b56,_0x2f3b01=await(0x0,ShowUserService_1[_0x1244f3(0x1de)])(_0x445e14),_0x90f14=_0x2f3b01['queues'][_0x1244f3(0x1ee)](_0x3b6473=>_0x3b6473['id']);let _0xa1578c={[sequelize_1['Op']['or']]:[{'userId':_0x445e14},{'status':_0x1244f3(0x204)}],'queueId':{[sequelize_1['Op']['or']]:[_0x2b7edb,null]}},_0x108c6e;_0x108c6e=[{'model':Contact_1[_0x1244f3(0x1de)],'as':_0x1244f3(0x1f5),'attributes':['id','name','number',_0x1244f3(0x1f6),_0x1244f3(0x206),_0x1244f3(0x1e3)]},{'model':Queue_1[_0x1244f3(0x1de)],'as':'queue','attributes':['id',_0x1244f3(0x1e9),_0x1244f3(0x20d)]},{'model':User_1[_0x1244f3(0x1de)],'as':_0x1244f3(0x1ef),'attributes':['id',_0x1244f3(0x1e9)]},{'model':Tag_1[_0x1244f3(0x1de)],'as':'tags','attributes':['id',_0x1244f3(0x1e9),'color']},{'model':Whatsapp_1[_0x1244f3(0x1de)],'as':_0x1244f3(0x1eb),'attributes':[_0x1244f3(0x1e9)]}];if(_0x2f3b01['profile']==='user'&&_0x2f3b01['allTicket']===_0x1244f3(0x1f3)){const _0x36b6e0=[];let _0x3faa26=[];_0x3faa26=await Ticket_1[_0x1244f3(0x1de)][_0x1244f3(0x1ff)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x2f3b01['id'],null]},'companyId':_0x282480}});_0x3faa26&&_0x36b6e0[_0x1244f3(0x20e)](_0x3faa26[_0x1244f3(0x1ee)](_0x50acbf=>_0x50acbf['id']));const _0x63654b=(0x0,lodash_1['intersection'])(..._0x36b6e0);_0xa1578c={..._0xa1578c,'id':_0x63654b};}if(_0x2f3b01['profile']===_0x1244f3(0x1ef)&&_0x2f3b01[_0x1244f3(0x1f8)]===_0x1244f3(0x1f1)){const _0x26bcc7=[];let _0x3665dc=[];_0x3665dc=await Ticket_1[_0x1244f3(0x1de)][_0x1244f3(0x1ff)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x2f3b01['id'],null]},'companyId':_0x282480,'queueId':{[sequelize_1['Op']['not']]:null}}});_0x3665dc&&_0x26bcc7[_0x1244f3(0x20e)](_0x3665dc[_0x1244f3(0x1ee)](_0x30c69b=>_0x30c69b['id']));const _0x2416c9=(0x0,lodash_1[_0x1244f3(0x1d4)])(..._0x26bcc7);_0xa1578c={..._0xa1578c,'id':_0x2416c9};}_0x4be5f0==='true'&&(_0xa1578c={'queueId':{[sequelize_1['Op']['or']]:[_0x2b7edb,null]}});_0x4ee280&&(_0xa1578c={..._0xa1578c,'status':_0x4ee280});_0x3dcde3&&_0x4a96aa&&(_0xa1578c={..._0xa1578c,'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x1244f3(0x1f2)])((0x0,date_fns_1['parseISO'])(_0x3dcde3)),+(0x0,date_fns_1[_0x1244f3(0x20a)])((0x0,date_fns_1['parseISO'])(_0x4a96aa))]}});if(searchParam){const _0x2a7019=searchParam[_0x1244f3(0x1dd)]()[_0x1244f3(0x1df)]();_0x108c6e=[..._0x108c6e,{'model':Message_1[_0x1244f3(0x1de)],'as':_0x1244f3(0x1e6),'attributes':['id',_0x1244f3(0x1fa)],'where':{'body':(0x0,sequelize_1[_0x1244f3(0x1d5)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x1244f3(0x1e8)])(_0x1244f3(0x1fa))),_0x1244f3(0x1d2),'%'+_0x2a7019+'%')},'required':![],'duplicating':![]}],_0xa1578c={..._0xa1578c,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x1244f3(0x1d5)])((0x0,sequelize_1['fn'])(_0x1244f3(0x1ed),(0x0,sequelize_1[_0x1244f3(0x1e8)])(_0x1244f3(0x1d3))),'LIKE','%'+_0x2a7019+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x1244f3(0x1e4)]]:'%'+_0x2a7019+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x1244f3(0x1e8)])(_0x1244f3(0x1fa))),_0x1244f3(0x1d2),'%'+_0x2a7019+'%')}]};}_0x17b95c&&(_0xa1578c={'createdAt':{[sequelize_1['Op'][_0x1244f3(0x20c)]]:[+(0x0,date_fns_1[_0x1244f3(0x1f2)])((0x0,date_fns_1[_0x1244f3(0x1f4)])(_0x17b95c)),+(0x0,date_fns_1[_0x1244f3(0x20a)])((0x0,date_fns_1[_0x1244f3(0x1f4)])(_0x17b95c))]}});_0xec3d5d&&(_0xa1578c={'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x1244f3(0x1f2)])((0x0,date_fns_1[_0x1244f3(0x1f4)])(_0xec3d5d)),+(0x0,date_fns_1[_0x1244f3(0x20a)])((0x0,date_fns_1[_0x1244f3(0x1f4)])(_0xec3d5d))]}});if(_0x5bcd04===_0x1244f3(0x1fd)){const _0x4392ff=await(0x0,ShowUserService_1['default'])(_0x445e14),_0x5557ea=_0x4392ff[_0x1244f3(0x1d9)][_0x1244f3(0x1ee)](_0x364a00=>_0x364a00['id']);_0xa1578c={[sequelize_1['Op']['or']]:[{'userId':_0x445e14},{'status':_0x1244f3(0x204)}],'queueId':{[sequelize_1['Op']['or']]:[_0x5557ea,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x1244f3(0x202)](_0x11b970)&&_0x11b970[_0x1244f3(0x1fe)]>0x0){const _0x3120f1=[];for(let _0x429d2c of _0x11b970){const _0x42dfe0=await TicketTag_1[_0x1244f3(0x1de)][_0x1244f3(0x1ff)]({'where':{'tagId':_0x429d2c}});_0x42dfe0&&_0x3120f1[_0x1244f3(0x20e)](_0x42dfe0[_0x1244f3(0x1ee)](_0x18241d=>_0x18241d[_0x1244f3(0x1fc)]));}const _0x16f307=(0x0,lodash_1[_0x1244f3(0x1d4)])(..._0x3120f1);_0xa1578c={..._0xa1578c,'id':{[sequelize_1['Op']['in']]:_0x16f307}};}if(Array['isArray'](_0x20d91c)&&_0x20d91c[_0x1244f3(0x1fe)]>0x0){const _0x552bff=[];for(let _0x33d87f of _0x20d91c){const _0x28dc99=await Ticket_1[_0x1244f3(0x1de)]['findAll']({'where':{'userId':_0x33d87f}});_0x28dc99&&_0x552bff['push'](_0x28dc99[_0x1244f3(0x1ee)](_0x4f4059=>_0x4f4059['id']));}const _0x275d2e=(0x0,lodash_1[_0x1244f3(0x1d4)])(..._0x552bff);_0xa1578c={..._0xa1578c,'id':{[sequelize_1['Op']['in']]:_0x275d2e}};}const _0x57b717=0x28,_0x37e036=_0x57b717*(+pageNumber-0x1);_0xa1578c={..._0xa1578c,'companyId':_0x282480};const {count:_0x2ee932,rows:_0x2f6d51}=await Ticket_1['default']['findAndCountAll']({'where':_0xa1578c,'include':_0x108c6e,'distinct':!![],'limit':_0x57b717,'offset':_0x37e036,'order':[[_0x1244f3(0x1dc),_0x1244f3(0x1f7)]],'subQuery':![]}),_0x5e7dd6=_0x2ee932>_0x37e036+_0x2f6d51[_0x1244f3(0x1fe)];return{'tickets':_0x2f6d51,'count':_0x2ee932,'hasMore':_0x5e7dd6};};exports[a517_0x375b56(0x1de)]=ListTicketsService;