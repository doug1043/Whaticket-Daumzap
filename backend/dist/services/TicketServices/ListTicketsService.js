const a524_0x4329ba=a524_0x2f34;(function(_0x1cbcd6,_0xe09423){const _0x1c90d3=a524_0x2f34,_0x3e7f19=_0x1cbcd6();while(!![]){try{const _0x4dcc36=-parseInt(_0x1c90d3(0x1eb))/0x1+-parseInt(_0x1c90d3(0x203))/0x2*(parseInt(_0x1c90d3(0x1d5))/0x3)+parseInt(_0x1c90d3(0x1e2))/0x4+parseInt(_0x1c90d3(0x1ee))/0x5*(parseInt(_0x1c90d3(0x1c6))/0x6)+parseInt(_0x1c90d3(0x1c3))/0x7+parseInt(_0x1c90d3(0x1da))/0x8*(parseInt(_0x1c90d3(0x202))/0x9)+-parseInt(_0x1c90d3(0x1e7))/0xa*(-parseInt(_0x1c90d3(0x1c0))/0xb);if(_0x4dcc36===_0xe09423)break;else _0x3e7f19['push'](_0x3e7f19['shift']());}catch(_0x4f0555){_0x3e7f19['push'](_0x3e7f19['shift']());}}}(a524_0x708d,0xe2035));const a524_0x3ec6d5=(function(){let _0x3eb93e=!![];return function(_0x394cf5,_0x1c8d36){const _0x1935ee=_0x3eb93e?function(){const _0x568ef3=a524_0x2f34;if(_0x1c8d36){const _0x5777c3=_0x1c8d36[_0x568ef3(0x1c5)](_0x394cf5,arguments);return _0x1c8d36=null,_0x5777c3;}}:function(){};return _0x3eb93e=![],_0x1935ee;};}()),a524_0x50a025=a524_0x3ec6d5(this,function(){const _0x33aee7=a524_0x2f34;return a524_0x50a025['toString']()[_0x33aee7(0x1db)](_0x33aee7(0x1c4))[_0x33aee7(0x200)]()[_0x33aee7(0x1f2)](a524_0x50a025)[_0x33aee7(0x1db)](_0x33aee7(0x1c4));});function a524_0x708d(){const _0x428390=['startOfDay','constructor','user','default','findAll','color','../../models/TicketTag','allTicket','pending','../../models/Queue','col','enabled','tags','../../models/User','trim','toString','../../models/Whatsapp','9HwUVnk','161934hPspaL','418rSozTb','disabled','contact','4045160zypMSK','(((.+)+)+)+$','apply','66qsiPew','profilePicUrl','intersection','toLocaleLowerCase','defineProperty','__esModule','number','queues','between','lodash','parseISO','sequelize','like','messages','LIKE','45QGrwiZ','LOWER','../UserServices/ShowUserService','map','whatsapp','6285848RutzSj','search','length','true','body','name','date-fns','isArray','580692RBTbCv','../../models/Contact','DESC','findAndCountAll','presence','197110FPnwmq','endOfDay','updatedAt','email','429035yaWZNT','queue','push','141585XrSvmP','__importDefault','where'];a524_0x708d=function(){return _0x428390;};return a524_0x708d();}a524_0x50a025();'use strict';var __importDefault=this&&this[a524_0x4329ba(0x1ef)]||function(_0x12d94a){return _0x12d94a&&_0x12d94a['__esModule']?_0x12d94a:{'default':_0x12d94a};};Object[a524_0x4329ba(0x1ca)](exports,a524_0x4329ba(0x1cb),{'value':!![]});const sequelize_1=require(a524_0x4329ba(0x1d1)),date_fns_1=require(a524_0x4329ba(0x1e0)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a524_0x4329ba(0x1e3))),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require(a524_0x4329ba(0x1fa))),User_1=__importDefault(require(a524_0x4329ba(0x1fe))),ShowUserService_1=__importDefault(require(a524_0x4329ba(0x1d7))),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a524_0x4329ba(0x1f7))),lodash_1=require(a524_0x4329ba(0x1cf)),Whatsapp_1=__importDefault(require(a524_0x4329ba(0x201))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x243afe,tags:_0x328f84,users:_0x486eb5,status:_0x378047,date:_0x1c839a,startDate:_0x27bf43,endDate:_0x422280,updatedAt:_0x877dd0,showAll:_0xbe95e6,userId:_0x129254,withUnreadMessages:_0x3a3ecb,companyId:_0x8c26b1})=>{const _0x316ef5=a524_0x4329ba,_0x3a21c7=await(0x0,ShowUserService_1[_0x316ef5(0x1f4)])(_0x129254),_0x11dab4=_0x3a21c7[_0x316ef5(0x1cd)]['map'](_0x45230e=>_0x45230e['id']);let _0x112773={[sequelize_1['Op']['or']]:[{'userId':_0x129254},{'status':_0x316ef5(0x1f9)}],'queueId':{[sequelize_1['Op']['or']]:[_0x243afe,null]}},_0x26600d;_0x26600d=[{'model':Contact_1[_0x316ef5(0x1f4)],'as':_0x316ef5(0x1c2),'attributes':['id','name',_0x316ef5(0x1cc),_0x316ef5(0x1ea),_0x316ef5(0x1c7),_0x316ef5(0x1e6)]},{'model':Queue_1[_0x316ef5(0x1f4)],'as':_0x316ef5(0x1ec),'attributes':['id','name',_0x316ef5(0x1f6)]},{'model':User_1['default'],'as':_0x316ef5(0x1f3),'attributes':['id',_0x316ef5(0x1df)]},{'model':Tag_1[_0x316ef5(0x1f4)],'as':_0x316ef5(0x1fd),'attributes':['id',_0x316ef5(0x1df),'color']},{'model':Whatsapp_1['default'],'as':_0x316ef5(0x1d9),'attributes':['name']}];if(_0x3a21c7['profile']==='user'&&_0x3a21c7[_0x316ef5(0x1f8)]===_0x316ef5(0x1fc)){const _0x50a866=[];let _0x31e21b=[];_0x31e21b=await Ticket_1['default'][_0x316ef5(0x1f5)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x3a21c7['id'],null]},'companyId':_0x8c26b1}});_0x31e21b&&_0x50a866['push'](_0x31e21b[_0x316ef5(0x1d8)](_0x2e53fc=>_0x2e53fc['id']));const _0x23dfaa=(0x0,lodash_1[_0x316ef5(0x1c8)])(..._0x50a866);_0x112773={..._0x112773,'id':_0x23dfaa};}if(_0x3a21c7['profile']===_0x316ef5(0x1f3)&&_0x3a21c7[_0x316ef5(0x1f8)]===_0x316ef5(0x1c1)){const _0xa0a337=[];let _0x304782=[];_0x304782=await Ticket_1[_0x316ef5(0x1f4)][_0x316ef5(0x1f5)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x3a21c7['id'],null]},'companyId':_0x8c26b1,'queueId':{[sequelize_1['Op']['not']]:null}}});_0x304782&&_0xa0a337[_0x316ef5(0x1ed)](_0x304782['map'](_0x274ff9=>_0x274ff9['id']));const _0x5e229f=(0x0,lodash_1[_0x316ef5(0x1c8)])(..._0xa0a337);_0x112773={..._0x112773,'id':_0x5e229f};}_0xbe95e6==='true'&&(_0x112773={'queueId':{[sequelize_1['Op']['or']]:[_0x243afe,null]}});_0x378047&&(_0x112773={..._0x112773,'status':_0x378047});_0x27bf43&&_0x422280&&(_0x112773={..._0x112773,'createdAt':{[sequelize_1['Op'][_0x316ef5(0x1ce)]]:[+(0x0,date_fns_1[_0x316ef5(0x1f1)])((0x0,date_fns_1['parseISO'])(_0x27bf43)),+(0x0,date_fns_1[_0x316ef5(0x1e8)])((0x0,date_fns_1[_0x316ef5(0x1d0)])(_0x422280))]}});if(searchParam){const _0x28786c=searchParam[_0x316ef5(0x1c9)]()[_0x316ef5(0x1ff)]();_0x26600d=[..._0x26600d,{'model':Message_1['default'],'as':_0x316ef5(0x1d3),'attributes':['id',_0x316ef5(0x1de)],'where':{'body':(0x0,sequelize_1[_0x316ef5(0x1f0)])((0x0,sequelize_1['fn'])(_0x316ef5(0x1d6),(0x0,sequelize_1['col'])('body')),_0x316ef5(0x1d4),'%'+_0x28786c+'%')},'required':![],'duplicating':![]}],_0x112773={..._0x112773,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x316ef5(0x1fb)])('contact.name')),_0x316ef5(0x1d4),'%'+_0x28786c+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x316ef5(0x1d2)]]:'%'+_0x28786c+'%'}},{'$message.body$':(0x0,sequelize_1[_0x316ef5(0x1f0)])((0x0,sequelize_1['fn'])(_0x316ef5(0x1d6),(0x0,sequelize_1['col'])(_0x316ef5(0x1de))),_0x316ef5(0x1d4),'%'+_0x28786c+'%')}]};}_0x1c839a&&(_0x112773={'createdAt':{[sequelize_1['Op'][_0x316ef5(0x1ce)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x316ef5(0x1d0)])(_0x1c839a)),+(0x0,date_fns_1[_0x316ef5(0x1e8)])((0x0,date_fns_1['parseISO'])(_0x1c839a))]}});_0x877dd0&&(_0x112773={'updatedAt':{[sequelize_1['Op'][_0x316ef5(0x1ce)]]:[+(0x0,date_fns_1[_0x316ef5(0x1f1)])((0x0,date_fns_1[_0x316ef5(0x1d0)])(_0x877dd0)),+(0x0,date_fns_1[_0x316ef5(0x1e8)])((0x0,date_fns_1[_0x316ef5(0x1d0)])(_0x877dd0))]}});if(_0x3a3ecb===_0x316ef5(0x1dd)){const _0x1cdf30=await(0x0,ShowUserService_1['default'])(_0x129254),_0xccf79d=_0x1cdf30[_0x316ef5(0x1cd)][_0x316ef5(0x1d8)](_0x26af92=>_0x26af92['id']);_0x112773={[sequelize_1['Op']['or']]:[{'userId':_0x129254},{'status':_0x316ef5(0x1f9)}],'queueId':{[sequelize_1['Op']['or']]:[_0xccf79d,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x316ef5(0x1e1)](_0x328f84)&&_0x328f84[_0x316ef5(0x1dc)]>0x0){const _0x360d56=[];for(let _0x491ff0 of _0x328f84){const _0x12c17a=await TicketTag_1['default'][_0x316ef5(0x1f5)]({'where':{'tagId':_0x491ff0}});_0x12c17a&&_0x360d56[_0x316ef5(0x1ed)](_0x12c17a[_0x316ef5(0x1d8)](_0x210251=>_0x210251['ticketId']));}const _0x3395f0=(0x0,lodash_1[_0x316ef5(0x1c8)])(..._0x360d56);_0x112773={..._0x112773,'id':{[sequelize_1['Op']['in']]:_0x3395f0}};}if(Array[_0x316ef5(0x1e1)](_0x486eb5)&&_0x486eb5[_0x316ef5(0x1dc)]>0x0){const _0x2be59f=[];for(let _0x508d0b of _0x486eb5){const _0x43926e=await Ticket_1[_0x316ef5(0x1f4)][_0x316ef5(0x1f5)]({'where':{'userId':_0x508d0b}});_0x43926e&&_0x2be59f[_0x316ef5(0x1ed)](_0x43926e['map'](_0x265fbc=>_0x265fbc['id']));}const _0x359ece=(0x0,lodash_1['intersection'])(..._0x2be59f);_0x112773={..._0x112773,'id':{[sequelize_1['Op']['in']]:_0x359ece}};}const _0x5694ff=0x28,_0xe157fd=_0x5694ff*(+pageNumber-0x1);_0x112773={..._0x112773,'companyId':_0x8c26b1};const {count:_0x4e0eb2,rows:_0x2fa446}=await Ticket_1[_0x316ef5(0x1f4)][_0x316ef5(0x1e5)]({'where':_0x112773,'include':_0x26600d,'distinct':!![],'limit':_0x5694ff,'offset':_0xe157fd,'order':[[_0x316ef5(0x1e9),_0x316ef5(0x1e4)]],'subQuery':![]}),_0x26c18e=_0x4e0eb2>_0xe157fd+_0x2fa446['length'];return{'tickets':_0x2fa446,'count':_0x4e0eb2,'hasMore':_0x26c18e};};function a524_0x2f34(_0x1a2858,_0x16be4d){const _0x54140e=a524_0x708d();return a524_0x2f34=function(_0x50a025,_0x3ec6d5){_0x50a025=_0x50a025-0x1c0;let _0x708da2=_0x54140e[_0x50a025];return _0x708da2;},a524_0x2f34(_0x1a2858,_0x16be4d);}exports[a524_0x4329ba(0x1f4)]=ListTicketsService;