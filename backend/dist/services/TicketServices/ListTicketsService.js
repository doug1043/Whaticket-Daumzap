const a526_0x25a51d=a526_0x2a67;function a526_0x2a67(_0x4b579a,_0x48a488){const _0x2b218f=a526_0x2516();return a526_0x2a67=function(_0x24015c,_0x74295d){_0x24015c=_0x24015c-0x7f;let _0x251643=_0x2b218f[_0x24015c];return _0x251643;},a526_0x2a67(_0x4b579a,_0x48a488);}(function(_0x3f2356,_0x3d1b3e){const _0x58a7bd=a526_0x2a67,_0x462344=_0x3f2356();while(!![]){try{const _0x4c9534=parseInt(_0x58a7bd(0x86))/0x1+-parseInt(_0x58a7bd(0x89))/0x2*(-parseInt(_0x58a7bd(0x88))/0x3)+-parseInt(_0x58a7bd(0x93))/0x4+-parseInt(_0x58a7bd(0x87))/0x5*(parseInt(_0x58a7bd(0x8b))/0x6)+-parseInt(_0x58a7bd(0xb1))/0x7+parseInt(_0x58a7bd(0x99))/0x8*(-parseInt(_0x58a7bd(0xbd))/0x9)+parseInt(_0x58a7bd(0x9d))/0xa;if(_0x4c9534===_0x3d1b3e)break;else _0x462344['push'](_0x462344['shift']());}catch(_0x28b2e2){_0x462344['push'](_0x462344['shift']());}}}(a526_0x2516,0xed6ff));const a526_0x74295d=(function(){let _0x52f13c=!![];return function(_0x518377,_0x212d17){const _0x1b3fa9=_0x52f13c?function(){const _0x5f57db=a526_0x2a67;if(_0x212d17){const _0x103fdc=_0x212d17[_0x5f57db(0x9a)](_0x518377,arguments);return _0x212d17=null,_0x103fdc;}}:function(){};return _0x52f13c=![],_0x1b3fa9;};}()),a526_0x24015c=a526_0x74295d(this,function(){const _0xcd6211=a526_0x2a67;return a526_0x24015c[_0xcd6211(0xbf)]()[_0xcd6211(0xa3)](_0xcd6211(0xaa))['toString']()[_0xcd6211(0xbb)](a526_0x24015c)['search']('(((.+)+)+)+$');});a526_0x24015c();function a526_0x2516(){const _0x1268d3=['../../models/Message','toString','length','date-fns','default','queue','DESC','enabled','user','1857395PqerxS','3997485XIpvWG','6cjucmN','1062654upSPqw','__esModule','12gSQBiK','number','lodash','where','contact','contact.name','between','not','2439844pecuWa','parseISO','col','email','../../models/Whatsapp','presence','48eeasKv','apply','profile','body','19611400RJwtar','name','isArray','endOfDay','../../models/Contact','updatedAt','search','startOfDay','true','color','map','findAndCountAll','intersection','(((.+)+)+)+$','toLocaleLowerCase','like','sequelize','disabled','allTicket','profilePicUrl','5174771rGaysi','../../models/TicketTag','LIKE','../../models/Tag','LOWER','__importDefault','push','findAll','pending','../../models/User','constructor','ticketId','1440657yIJmuR'];a526_0x2516=function(){return _0x1268d3;};return a526_0x2516();}'use strict';var __importDefault=this&&this[a526_0x25a51d(0xb6)]||function(_0x4270f5){return _0x4270f5&&_0x4270f5['__esModule']?_0x4270f5:{'default':_0x4270f5};};Object['defineProperty'](exports,a526_0x25a51d(0x8a),{'value':!![]});const sequelize_1=require(a526_0x25a51d(0xad)),date_fns_1=require(a526_0x25a51d(0x80)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a526_0x25a51d(0xa1))),Message_1=__importDefault(require(a526_0x25a51d(0xbe))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a526_0x25a51d(0xba))),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require(a526_0x25a51d(0xb4))),TicketTag_1=__importDefault(require(a526_0x25a51d(0xb2))),lodash_1=require(a526_0x25a51d(0x8d)),Whatsapp_1=__importDefault(require(a526_0x25a51d(0x97))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x340e32,tags:_0x371faa,users:_0x19dba7,status:_0x4e0ac1,date:_0x6241a6,startDate:_0x45a09a,endDate:_0x2bbe55,updatedAt:_0x595014,showAll:_0x17a240,userId:_0x426f5e,withUnreadMessages:_0x1f37f4,companyId:_0x8b6399})=>{const _0x3aa7fa=a526_0x25a51d,_0x371448=await(0x0,ShowUserService_1[_0x3aa7fa(0x81)])(_0x426f5e),_0x534493=_0x371448['queues'][_0x3aa7fa(0xa7)](_0x293313=>_0x293313['id']);let _0x20b2b5={[sequelize_1['Op']['or']]:[{'userId':_0x426f5e},{'status':_0x3aa7fa(0xb9)}],'queueId':{[sequelize_1['Op']['or']]:[_0x340e32,null]}},_0x2b1c42;_0x2b1c42=[{'model':Contact_1[_0x3aa7fa(0x81)],'as':_0x3aa7fa(0x8f),'attributes':['id',_0x3aa7fa(0x9e),_0x3aa7fa(0x8c),_0x3aa7fa(0x96),_0x3aa7fa(0xb0),_0x3aa7fa(0x98)]},{'model':Queue_1[_0x3aa7fa(0x81)],'as':_0x3aa7fa(0x82),'attributes':['id',_0x3aa7fa(0x9e),_0x3aa7fa(0xa6)]},{'model':User_1[_0x3aa7fa(0x81)],'as':_0x3aa7fa(0x85),'attributes':['id','name']},{'model':Tag_1[_0x3aa7fa(0x81)],'as':'tags','attributes':['id',_0x3aa7fa(0x9e),_0x3aa7fa(0xa6)]},{'model':Whatsapp_1[_0x3aa7fa(0x81)],'as':'whatsapp','attributes':[_0x3aa7fa(0x9e)]}];if(_0x371448['profile']==='user'&&_0x371448[_0x3aa7fa(0xaf)]===_0x3aa7fa(0x84)){const _0x4bc1d0=[];let _0x4f226a=[];_0x4f226a=await Ticket_1[_0x3aa7fa(0x81)][_0x3aa7fa(0xb8)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x371448['id'],null]},'companyId':_0x8b6399}});_0x4f226a&&_0x4bc1d0['push'](_0x4f226a[_0x3aa7fa(0xa7)](_0x424738=>_0x424738['id']));const _0x23a04e=(0x0,lodash_1[_0x3aa7fa(0xa9)])(..._0x4bc1d0);_0x20b2b5={..._0x20b2b5,'id':_0x23a04e};}if(_0x371448[_0x3aa7fa(0x9b)]===_0x3aa7fa(0x85)&&_0x371448[_0x3aa7fa(0xaf)]===_0x3aa7fa(0xae)){const _0xcc9fdd=[];let _0x451a38=[];_0x451a38=await Ticket_1[_0x3aa7fa(0x81)][_0x3aa7fa(0xb8)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x371448['id'],null]},'companyId':_0x8b6399,'queueId':{[sequelize_1['Op'][_0x3aa7fa(0x92)]]:null}}});_0x451a38&&_0xcc9fdd[_0x3aa7fa(0xb7)](_0x451a38[_0x3aa7fa(0xa7)](_0x4e0580=>_0x4e0580['id']));const _0x5069bd=(0x0,lodash_1['intersection'])(..._0xcc9fdd);_0x20b2b5={..._0x20b2b5,'id':_0x5069bd};}_0x17a240===_0x3aa7fa(0xa5)&&(_0x20b2b5={'queueId':{[sequelize_1['Op']['or']]:[_0x340e32,null]}});_0x4e0ac1&&(_0x20b2b5={..._0x20b2b5,'status':_0x4e0ac1});_0x45a09a&&_0x2bbe55&&(_0x20b2b5={..._0x20b2b5,'createdAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x3aa7fa(0xa4)])((0x0,date_fns_1[_0x3aa7fa(0x94)])(_0x45a09a)),+(0x0,date_fns_1[_0x3aa7fa(0xa0)])((0x0,date_fns_1[_0x3aa7fa(0x94)])(_0x2bbe55))]}});if(searchParam){const _0x990b11=searchParam[_0x3aa7fa(0xab)]()['trim']();_0x2b1c42=[..._0x2b1c42,{'model':Message_1[_0x3aa7fa(0x81)],'as':'messages','attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x3aa7fa(0x8e)])((0x0,sequelize_1['fn'])(_0x3aa7fa(0xb5),(0x0,sequelize_1[_0x3aa7fa(0x95)])(_0x3aa7fa(0x9c))),_0x3aa7fa(0xb3),'%'+_0x990b11+'%')},'required':![],'duplicating':![]}],_0x20b2b5={..._0x20b2b5,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x3aa7fa(0x8e)])((0x0,sequelize_1['fn'])(_0x3aa7fa(0xb5),(0x0,sequelize_1[_0x3aa7fa(0x95)])(_0x3aa7fa(0x90))),_0x3aa7fa(0xb3),'%'+_0x990b11+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x3aa7fa(0xac)]]:'%'+_0x990b11+'%'}},{'$message.body$':(0x0,sequelize_1[_0x3aa7fa(0x8e)])((0x0,sequelize_1['fn'])(_0x3aa7fa(0xb5),(0x0,sequelize_1['col'])(_0x3aa7fa(0x9c))),'LIKE','%'+_0x990b11+'%')}]};}_0x6241a6&&(_0x20b2b5={'createdAt':{[sequelize_1['Op'][_0x3aa7fa(0x91)]]:[+(0x0,date_fns_1[_0x3aa7fa(0xa4)])((0x0,date_fns_1[_0x3aa7fa(0x94)])(_0x6241a6)),+(0x0,date_fns_1[_0x3aa7fa(0xa0)])((0x0,date_fns_1[_0x3aa7fa(0x94)])(_0x6241a6))]}});_0x595014&&(_0x20b2b5={'updatedAt':{[sequelize_1['Op'][_0x3aa7fa(0x91)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x3aa7fa(0x94)])(_0x595014)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x3aa7fa(0x94)])(_0x595014))]}});if(_0x1f37f4==='true'){const _0x761884=await(0x0,ShowUserService_1[_0x3aa7fa(0x81)])(_0x426f5e),_0x16a75d=_0x761884['queues'][_0x3aa7fa(0xa7)](_0x1cdcf2=>_0x1cdcf2['id']);_0x20b2b5={[sequelize_1['Op']['or']]:[{'userId':_0x426f5e},{'status':_0x3aa7fa(0xb9)}],'queueId':{[sequelize_1['Op']['or']]:[_0x16a75d,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array['isArray'](_0x371faa)&&_0x371faa[_0x3aa7fa(0x7f)]>0x0){const _0x5f56e6=[];for(let _0x1248ef of _0x371faa){const _0x5597b6=await TicketTag_1[_0x3aa7fa(0x81)][_0x3aa7fa(0xb8)]({'where':{'tagId':_0x1248ef}});_0x5597b6&&_0x5f56e6['push'](_0x5597b6[_0x3aa7fa(0xa7)](_0x4d1937=>_0x4d1937[_0x3aa7fa(0xbc)]));}const _0x31eccf=(0x0,lodash_1[_0x3aa7fa(0xa9)])(..._0x5f56e6);_0x20b2b5={..._0x20b2b5,'id':{[sequelize_1['Op']['in']]:_0x31eccf}};}if(Array[_0x3aa7fa(0x9f)](_0x19dba7)&&_0x19dba7[_0x3aa7fa(0x7f)]>0x0){const _0xca1b3f=[];for(let _0x3efa91 of _0x19dba7){const _0x46cfff=await Ticket_1[_0x3aa7fa(0x81)][_0x3aa7fa(0xb8)]({'where':{'userId':_0x3efa91}});_0x46cfff&&_0xca1b3f['push'](_0x46cfff[_0x3aa7fa(0xa7)](_0x2e9d2a=>_0x2e9d2a['id']));}const _0x4ae433=(0x0,lodash_1['intersection'])(..._0xca1b3f);_0x20b2b5={..._0x20b2b5,'id':{[sequelize_1['Op']['in']]:_0x4ae433}};}const _0x201ebd=0x28,_0x4fbf19=_0x201ebd*(+pageNumber-0x1);_0x20b2b5={..._0x20b2b5,'companyId':_0x8b6399};const {count:_0x2d168e,rows:_0x43611d}=await Ticket_1[_0x3aa7fa(0x81)][_0x3aa7fa(0xa8)]({'where':_0x20b2b5,'include':_0x2b1c42,'distinct':!![],'limit':_0x201ebd,'offset':_0x4fbf19,'order':[[_0x3aa7fa(0xa2),_0x3aa7fa(0x83)]],'subQuery':![]}),_0x5843fa=_0x2d168e>_0x4fbf19+_0x43611d[_0x3aa7fa(0x7f)];return{'tickets':_0x43611d,'count':_0x2d168e,'hasMore':_0x5843fa};};exports[a526_0x25a51d(0x81)]=ListTicketsService;