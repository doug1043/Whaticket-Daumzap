function a525_0x46f9(){const _0xf75974=['where','contact.name','map','constructor','endOfDay','findAll','not','__importDefault','contact','1054107zGSLal','DESC','user','push','6PYjlmp','trim','LIKE','395969lKziMt','messages','6151784ISmrOB','enabled','between','148589BJmiEr','allTicket','sequelize','disabled','profilePicUrl','../../models/Queue','intersection','startOfDay','1107935CVsGXS','true','9KPaOjO','email','queues','default','../../models/Contact','length','name','color','toString','../../models/Ticket','../UserServices/ShowUserService','toLocaleLowerCase','pending','like','profile','number','presence','col','body','parseISO','search','16445990yVSCey','../../models/Whatsapp','isArray','LOWER','date-fns','whatsapp','1275916xAtecA','14vQNTkP','../../models/Message'];a525_0x46f9=function(){return _0xf75974;};return a525_0x46f9();}const a525_0x36621d=a525_0xbb1a;function a525_0xbb1a(_0x26a0f1,_0x1262b7){const _0xf68e64=a525_0x46f9();return a525_0xbb1a=function(_0xca0336,_0x711ef6){_0xca0336=_0xca0336-0x75;let _0x46f9da=_0xf68e64[_0xca0336];return _0x46f9da;},a525_0xbb1a(_0x26a0f1,_0x1262b7);}(function(_0x2e3783,_0x5c3f05){const _0x120378=a525_0xbb1a,_0x2c66c8=_0x2e3783();while(!![]){try{const _0x42d304=-parseInt(_0x120378(0x79))/0x1*(-parseInt(_0x120378(0x9f))/0x2)+-parseInt(_0x120378(0x83))/0x3*(parseInt(_0x120378(0x9e))/0x4)+parseInt(_0x120378(0x81))/0x5*(-parseInt(_0x120378(0xae))/0x6)+-parseInt(_0x120378(0xb1))/0x7+-parseInt(_0x120378(0x76))/0x8+-parseInt(_0x120378(0xaa))/0x9+parseInt(_0x120378(0x98))/0xa;if(_0x42d304===_0x5c3f05)break;else _0x2c66c8['push'](_0x2c66c8['shift']());}catch(_0x55591d){_0x2c66c8['push'](_0x2c66c8['shift']());}}}(a525_0x46f9,0x8994f));const a525_0x711ef6=(function(){let _0x40831f=!![];return function(_0x5f0f1f,_0x15cbc6){const _0x21b188=_0x40831f?function(){if(_0x15cbc6){const _0x199a32=_0x15cbc6['apply'](_0x5f0f1f,arguments);return _0x15cbc6=null,_0x199a32;}}:function(){};return _0x40831f=![],_0x21b188;};}()),a525_0xca0336=a525_0x711ef6(this,function(){const _0x3fd250=a525_0xbb1a;return a525_0xca0336[_0x3fd250(0x8b)]()[_0x3fd250(0x97)]('(((.+)+)+)+$')['toString']()[_0x3fd250(0xa4)](a525_0xca0336)[_0x3fd250(0x97)]('(((.+)+)+)+$');});a525_0xca0336();'use strict';var __importDefault=this&&this[a525_0x36621d(0xa8)]||function(_0x194d51){return _0x194d51&&_0x194d51['__esModule']?_0x194d51:{'default':_0x194d51};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const sequelize_1=require(a525_0x36621d(0x7b)),date_fns_1=require(a525_0x36621d(0x9c)),Ticket_1=__importDefault(require(a525_0x36621d(0x8c))),Contact_1=__importDefault(require(a525_0x36621d(0x87))),Message_1=__importDefault(require(a525_0x36621d(0xa0))),Queue_1=__importDefault(require(a525_0x36621d(0x7e))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require(a525_0x36621d(0x8d))),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require(a525_0x36621d(0x99))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x25d57c,tags:_0x20c209,users:_0x4ff9c2,status:_0x18e5b9,date:_0x33d569,startDate:_0x585cc3,endDate:_0x59a64c,updatedAt:_0x12e142,showAll:_0x882151,userId:_0x30bb44,withUnreadMessages:_0x355e1f,companyId:_0x16dd88})=>{const _0x279757=a525_0x36621d,_0x3c2a9c=await(0x0,ShowUserService_1[_0x279757(0x86)])(_0x30bb44),_0x41989d=_0x3c2a9c[_0x279757(0x85)]['map'](_0xd6b8de=>_0xd6b8de['id']);let _0x5401f3={[sequelize_1['Op']['or']]:[{'userId':_0x30bb44},{'status':_0x279757(0x8f)}],'queueId':{[sequelize_1['Op']['or']]:[_0x25d57c,null]}},_0x552c4c;_0x552c4c=[{'model':Contact_1[_0x279757(0x86)],'as':_0x279757(0xa9),'attributes':['id','name',_0x279757(0x92),_0x279757(0x84),_0x279757(0x7d),_0x279757(0x93)]},{'model':Queue_1['default'],'as':'queue','attributes':['id',_0x279757(0x89),_0x279757(0x8a)]},{'model':User_1['default'],'as':'user','attributes':['id',_0x279757(0x89)]},{'model':Tag_1[_0x279757(0x86)],'as':'tags','attributes':['id',_0x279757(0x89),'color']},{'model':Whatsapp_1[_0x279757(0x86)],'as':_0x279757(0x9d),'attributes':[_0x279757(0x89)]}];if(_0x3c2a9c[_0x279757(0x91)]==='user'&&_0x3c2a9c[_0x279757(0x7a)]===_0x279757(0x77)){const _0x51dbde=[];let _0x1322d8=[];_0x1322d8=await Ticket_1['default'][_0x279757(0xa6)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x3c2a9c['id'],null]},'companyId':_0x16dd88}});_0x1322d8&&_0x51dbde[_0x279757(0xad)](_0x1322d8['map'](_0x4e5e38=>_0x4e5e38['id']));const _0x3448d4=(0x0,lodash_1[_0x279757(0x7f)])(..._0x51dbde);_0x5401f3={..._0x5401f3,'id':_0x3448d4};}if(_0x3c2a9c[_0x279757(0x91)]===_0x279757(0xac)&&_0x3c2a9c[_0x279757(0x7a)]===_0x279757(0x7c)){const _0x35a1c9=[];let _0x3d6866=[];_0x3d6866=await Ticket_1['default'][_0x279757(0xa6)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x3c2a9c['id'],null]},'companyId':_0x16dd88,'queueId':{[sequelize_1['Op'][_0x279757(0xa7)]]:null}}});_0x3d6866&&_0x35a1c9[_0x279757(0xad)](_0x3d6866['map'](_0x5ab1d9=>_0x5ab1d9['id']));const _0x5808d2=(0x0,lodash_1['intersection'])(..._0x35a1c9);_0x5401f3={..._0x5401f3,'id':_0x5808d2};}_0x882151==='true'&&(_0x5401f3={'queueId':{[sequelize_1['Op']['or']]:[_0x25d57c,null]}});_0x18e5b9&&(_0x5401f3={..._0x5401f3,'status':_0x18e5b9});_0x585cc3&&_0x59a64c&&(_0x5401f3={..._0x5401f3,'createdAt':{[sequelize_1['Op'][_0x279757(0x78)]]:[+(0x0,date_fns_1[_0x279757(0x80)])((0x0,date_fns_1[_0x279757(0x96)])(_0x585cc3)),+(0x0,date_fns_1[_0x279757(0xa5)])((0x0,date_fns_1[_0x279757(0x96)])(_0x59a64c))]}});if(searchParam){const _0x6cba81=searchParam[_0x279757(0x8e)]()[_0x279757(0xaf)]();_0x552c4c=[..._0x552c4c,{'model':Message_1[_0x279757(0x86)],'as':_0x279757(0x75),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x279757(0xa1)])((0x0,sequelize_1['fn'])(_0x279757(0x9b),(0x0,sequelize_1[_0x279757(0x94)])('body')),_0x279757(0xb0),'%'+_0x6cba81+'%')},'required':![],'duplicating':![]}],_0x5401f3={..._0x5401f3,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x279757(0xa1)])((0x0,sequelize_1['fn'])(_0x279757(0x9b),(0x0,sequelize_1[_0x279757(0x94)])(_0x279757(0xa2))),'LIKE','%'+_0x6cba81+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x279757(0x90)]]:'%'+_0x6cba81+'%'}},{'$message.body$':(0x0,sequelize_1[_0x279757(0xa1)])((0x0,sequelize_1['fn'])(_0x279757(0x9b),(0x0,sequelize_1[_0x279757(0x94)])(_0x279757(0x95))),'LIKE','%'+_0x6cba81+'%')}]};}_0x33d569&&(_0x5401f3={'createdAt':{[sequelize_1['Op'][_0x279757(0x78)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x279757(0x96)])(_0x33d569)),+(0x0,date_fns_1[_0x279757(0xa5)])((0x0,date_fns_1[_0x279757(0x96)])(_0x33d569))]}});_0x12e142&&(_0x5401f3={'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x279757(0x80)])((0x0,date_fns_1[_0x279757(0x96)])(_0x12e142)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1['parseISO'])(_0x12e142))]}});if(_0x355e1f===_0x279757(0x82)){const _0x4c50c6=await(0x0,ShowUserService_1[_0x279757(0x86)])(_0x30bb44),_0x4676d7=_0x4c50c6['queues'][_0x279757(0xa3)](_0x78b189=>_0x78b189['id']);_0x5401f3={[sequelize_1['Op']['or']]:[{'userId':_0x30bb44},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x4676d7,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array['isArray'](_0x20c209)&&_0x20c209['length']>0x0){const _0x16c7a3=[];for(let _0x1fd438 of _0x20c209){const _0x1d7221=await TicketTag_1['default'][_0x279757(0xa6)]({'where':{'tagId':_0x1fd438}});_0x1d7221&&_0x16c7a3[_0x279757(0xad)](_0x1d7221[_0x279757(0xa3)](_0x35e530=>_0x35e530['ticketId']));}const _0x5ab971=(0x0,lodash_1[_0x279757(0x7f)])(..._0x16c7a3);_0x5401f3={..._0x5401f3,'id':{[sequelize_1['Op']['in']]:_0x5ab971}};}if(Array[_0x279757(0x9a)](_0x4ff9c2)&&_0x4ff9c2['length']>0x0){const _0x169836=[];for(let _0x3b1107 of _0x4ff9c2){const _0x146bba=await Ticket_1['default'][_0x279757(0xa6)]({'where':{'userId':_0x3b1107}});_0x146bba&&_0x169836['push'](_0x146bba[_0x279757(0xa3)](_0x4e7a6e=>_0x4e7a6e['id']));}const _0x389d47=(0x0,lodash_1[_0x279757(0x7f)])(..._0x169836);_0x5401f3={..._0x5401f3,'id':{[sequelize_1['Op']['in']]:_0x389d47}};}const _0x26f2f5=0x28,_0x24c72c=_0x26f2f5*(+pageNumber-0x1);_0x5401f3={..._0x5401f3,'companyId':_0x16dd88};const {count:_0x14e40f,rows:_0x3039c2}=await Ticket_1[_0x279757(0x86)]['findAndCountAll']({'where':_0x5401f3,'include':_0x552c4c,'distinct':!![],'limit':_0x26f2f5,'offset':_0x24c72c,'order':[['updatedAt',_0x279757(0xab)]],'subQuery':![]}),_0x180ec9=_0x14e40f>_0x24c72c+_0x3039c2[_0x279757(0x88)];return{'tickets':_0x3039c2,'count':_0x14e40f,'hasMore':_0x180ec9};};exports[a525_0x36621d(0x86)]=ListTicketsService;