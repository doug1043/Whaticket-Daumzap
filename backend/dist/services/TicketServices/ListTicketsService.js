const a558_0x5cba45=a558_0x1683;(function(_0xe78f08,_0x5195ab){const _0x4225aa=a558_0x1683,_0x40be01=_0xe78f08();while(!![]){try{const _0x473e28=-parseInt(_0x4225aa(0x181))/0x1*(-parseInt(_0x4225aa(0x156))/0x2)+parseInt(_0x4225aa(0x182))/0x3+parseInt(_0x4225aa(0x16d))/0x4*(parseInt(_0x4225aa(0x172))/0x5)+parseInt(_0x4225aa(0x18c))/0x6+parseInt(_0x4225aa(0x179))/0x7*(-parseInt(_0x4225aa(0x169))/0x8)+-parseInt(_0x4225aa(0x155))/0x9+-parseInt(_0x4225aa(0x163))/0xa*(parseInt(_0x4225aa(0x167))/0xb);if(_0x473e28===_0x5195ab)break;else _0x40be01['push'](_0x40be01['shift']());}catch(_0x4e853f){_0x40be01['push'](_0x40be01['shift']());}}}(a558_0x3737,0xf0f0f));const a558_0x8e2a52=(function(){let _0x3f5316=!![];return function(_0x3dc7bd,_0x4d3de1){const _0x523c3e=_0x3f5316?function(){const _0x4f18a2=a558_0x1683;if(_0x4d3de1){const _0x3abb0f=_0x4d3de1[_0x4f18a2(0x16e)](_0x3dc7bd,arguments);return _0x4d3de1=null,_0x3abb0f;}}:function(){};return _0x3f5316=![],_0x523c3e;};}()),a558_0x216ae7=a558_0x8e2a52(this,function(){const _0x5c6e13=a558_0x1683;return a558_0x216ae7[_0x5c6e13(0x16b)]()[_0x5c6e13(0x168)](_0x5c6e13(0x189))[_0x5c6e13(0x16b)]()[_0x5c6e13(0x183)](a558_0x216ae7)[_0x5c6e13(0x168)](_0x5c6e13(0x189));});function a558_0x3737(){const _0x8c0adb=['575IcoOws','name','defineProperty','groupsTab','admin','presence','LIKE','133Fgclfm','where','findAndCountAll','../../models/Contact','default','email','startOfDay','isArray','62597AlIpkL','2264490NHAScC','constructor','between','../../models/Message','queues','tags','isGroup','(((.+)+)+)+$','../../helpers/CheckSettings','pending','4405116jOoNXN','sequelize','messages','parseISO','length','../../models/Whatsapp','number','user','contact.name','color','../../models/Ticket','2364480moWauJ','36LPZQSE','lodash','endOfDay','__importDefault','findAll','__esModule','../../models/TicketTag','queue','LOWER','profile','intersection','map','ticketId','20SspYzG','col','true','enabled','15223043KUpXxI','search','221792ceNyKT','body','toString','profilePicUrl','67076HHTQYn','apply','push','../../models/User','../UserServices/ShowUserService'];a558_0x3737=function(){return _0x8c0adb;};return a558_0x3737();}a558_0x216ae7();'use strict';var __importDefault=this&&this[a558_0x5cba45(0x159)]||function(_0x363a0f){const _0x11c90c=a558_0x5cba45;return _0x363a0f&&_0x363a0f[_0x11c90c(0x15b)]?_0x363a0f:{'default':_0x363a0f};};Object[a558_0x5cba45(0x174)](exports,a558_0x5cba45(0x15b),{'value':!![]});function a558_0x1683(_0x1e0caa,_0x52fec3){const _0x182fd2=a558_0x3737();return a558_0x1683=function(_0x216ae7,_0x8e2a52){_0x216ae7=_0x216ae7-0x14e;let _0x3737eb=_0x182fd2[_0x216ae7];return _0x3737eb;},a558_0x1683(_0x1e0caa,_0x52fec3);}const sequelize_1=require(a558_0x5cba45(0x18d)),date_fns_1=require('date-fns'),lodash_1=require(a558_0x5cba45(0x157)),Ticket_1=__importDefault(require(a558_0x5cba45(0x154))),Contact_1=__importDefault(require(a558_0x5cba45(0x17c))),Message_1=__importDefault(require(a558_0x5cba45(0x185))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a558_0x5cba45(0x170))),ShowUserService_1=__importDefault(require(a558_0x5cba45(0x171))),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a558_0x5cba45(0x15c))),Whatsapp_1=__importDefault(require(a558_0x5cba45(0x14f))),CheckSettings_1=require(a558_0x5cba45(0x18a)),ListTicketsService=async({isSearch:isSearch=![],searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x40e31b,tags:_0x31e6c8,users:_0x4fd70b,status:_0x1cc9cc,groups:_0x193fac,date:_0x102a59,updatedAt:_0x3e5a9c,showAll:_0x13ca84,userId:_0xdb0463,withUnreadMessages:_0xc265f2,notClosed:_0x1702bb,all:_0x46b6be,companyId:_0x3b3baa})=>{const _0x2c6fc8=a558_0x5cba45,_0x5aba3d=!isSearch&&await(0x0,CheckSettings_1['GetCompanySetting'])(_0x3b3baa,_0x2c6fc8(0x175),'disabled')===_0x2c6fc8(0x166),_0x545060=await(0x0,ShowUserService_1[_0x2c6fc8(0x17d)])(_0xdb0463);let _0x1d8922={[sequelize_1['Op']['or']]:[{'userId':_0xdb0463},{'status':_0x2c6fc8(0x18b)}],'queueId':{[sequelize_1['Op']['or']]:_0x545060[_0x2c6fc8(0x15f)]===_0x2c6fc8(0x176)?[_0x40e31b,null]:[_0x40e31b]}};_0x5aba3d&&(_0x1d8922['isGroup']=_0x193fac===_0x2c6fc8(0x165));let _0x29f8dd;_0x29f8dd=[{'model':Contact_1[_0x2c6fc8(0x17d)],'as':'contact','attributes':['id',_0x2c6fc8(0x173),_0x2c6fc8(0x150),_0x2c6fc8(0x17e),_0x2c6fc8(0x16c),_0x2c6fc8(0x177)]},{'model':Queue_1[_0x2c6fc8(0x17d)],'as':_0x2c6fc8(0x15d),'attributes':['id',_0x2c6fc8(0x173),_0x2c6fc8(0x153)]},{'model':User_1['default'],'as':_0x2c6fc8(0x151),'attributes':['id',_0x2c6fc8(0x173)]},{'model':Tag_1[_0x2c6fc8(0x17d)],'as':_0x2c6fc8(0x187),'attributes':['id',_0x2c6fc8(0x173),'color']},{'model':Whatsapp_1[_0x2c6fc8(0x17d)],'as':'whatsapp','attributes':['id',_0x2c6fc8(0x173)]}];_0x13ca84===_0x2c6fc8(0x165)&&_0x545060['profile']===_0x2c6fc8(0x176)&&(_0x1d8922={'queueId':{[sequelize_1['Op']['or']]:[_0x40e31b,null]}},_0x5aba3d&&(_0x1d8922[_0x2c6fc8(0x188)]=_0x193fac===_0x2c6fc8(0x165)));_0x1cc9cc&&(_0x1d8922={..._0x1d8922,'status':_0x1cc9cc});if(searchParam){const _0x170c93=searchParam['toLocaleLowerCase']()['trim']();_0x29f8dd=[..._0x29f8dd,{'model':Message_1[_0x2c6fc8(0x17d)],'as':_0x2c6fc8(0x18e),'attributes':['id',_0x2c6fc8(0x16a)],'where':{'body':(0x0,sequelize_1[_0x2c6fc8(0x17a)])((0x0,sequelize_1['fn'])(_0x2c6fc8(0x15e),(0x0,sequelize_1[_0x2c6fc8(0x164)])(_0x2c6fc8(0x16a))),_0x2c6fc8(0x178),'%'+_0x170c93+'%')},'required':![],'duplicating':![]}],_0x1d8922={..._0x1d8922,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x2c6fc8(0x15e),(0x0,sequelize_1['col'])(_0x2c6fc8(0x152))),_0x2c6fc8(0x178),'%'+_0x170c93+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x170c93+'%'}},{'$message.body$':(0x0,sequelize_1[_0x2c6fc8(0x17a)])((0x0,sequelize_1['fn'])(_0x2c6fc8(0x15e),(0x0,sequelize_1[_0x2c6fc8(0x164)])(_0x2c6fc8(0x16a))),_0x2c6fc8(0x178),'%'+_0x170c93+'%')}]};}_0x102a59&&(_0x1d8922={'createdAt':{[sequelize_1['Op'][_0x2c6fc8(0x184)]]:[+(0x0,date_fns_1[_0x2c6fc8(0x17f)])((0x0,date_fns_1[_0x2c6fc8(0x18f)])(_0x102a59)),+(0x0,date_fns_1[_0x2c6fc8(0x158)])((0x0,date_fns_1[_0x2c6fc8(0x18f)])(_0x102a59))]}});_0x3e5a9c&&(_0x1d8922={'updatedAt':{[sequelize_1['Op'][_0x2c6fc8(0x184)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x2c6fc8(0x18f)])(_0x3e5a9c)),+(0x0,date_fns_1[_0x2c6fc8(0x158)])((0x0,date_fns_1['parseISO'])(_0x3e5a9c))]}});if(_0xc265f2===_0x2c6fc8(0x165)){const _0x42b250=_0x545060[_0x2c6fc8(0x186)][_0x2c6fc8(0x161)](_0x544cdd=>_0x544cdd['id']);_0x1d8922={[sequelize_1['Op']['or']]:[{'userId':_0xdb0463},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:_0x545060['profile']===_0x2c6fc8(0x176)?[_0x42b250,null]:[_0x42b250]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}},_0x5aba3d&&(_0x1d8922[_0x2c6fc8(0x188)]=_0x193fac===_0x2c6fc8(0x165));}if(Array[_0x2c6fc8(0x180)](_0x31e6c8)&&_0x31e6c8[_0x2c6fc8(0x14e)]>0x0){const _0x15c0a9=[];for await(const _0x20149c of _0x31e6c8){const _0x37e6b7=await TicketTag_1[_0x2c6fc8(0x17d)][_0x2c6fc8(0x15a)]({'where':{'tagId':_0x20149c}});_0x37e6b7&&_0x15c0a9[_0x2c6fc8(0x16f)](_0x37e6b7[_0x2c6fc8(0x161)](_0x1f416f=>_0x1f416f[_0x2c6fc8(0x162)]));}const _0x39cbd0=(0x0,lodash_1[_0x2c6fc8(0x160)])(..._0x15c0a9);_0x1d8922={..._0x1d8922,'id':{[sequelize_1['Op']['in']]:_0x39cbd0}};}if(Array[_0x2c6fc8(0x180)](_0x4fd70b)&&_0x4fd70b[_0x2c6fc8(0x14e)]>0x0){const _0xa2ba94=[];for await(const _0x307618 of _0x4fd70b){const _0x4d17a0=await Ticket_1['default'][_0x2c6fc8(0x15a)]({'where':{'userId':_0x307618}});_0x4d17a0&&_0xa2ba94[_0x2c6fc8(0x16f)](_0x4d17a0[_0x2c6fc8(0x161)](_0x4f49ac=>_0x4f49ac['id']));}const _0x3d3564=(0x0,lodash_1['intersection'])(..._0xa2ba94);_0x1d8922={..._0x1d8922,'id':{[sequelize_1['Op']['in']]:_0x3d3564}};}const _0x3b8bc1=_0x46b6be?undefined:0x28,_0x4cedcc=_0x46b6be?undefined:_0x3b8bc1*(+pageNumber-0x1);_0x1702bb&&(_0x1d8922={..._0x1d8922,'status':{[sequelize_1['Op']['ne']]:'closed'}});_0x1d8922={..._0x1d8922,'companyId':_0x3b3baa};const {count:_0x197460,rows:_0x859a7e}=await Ticket_1[_0x2c6fc8(0x17d)][_0x2c6fc8(0x17b)]({'where':_0x1d8922,'include':_0x29f8dd,'distinct':!![],'limit':_0x3b8bc1,'offset':_0x4cedcc,'order':[['updatedAt','DESC']],'subQuery':![]}),_0x2f7b7b=_0x197460>_0x4cedcc+_0x859a7e[_0x2c6fc8(0x14e)];return{'tickets':_0x859a7e,'count':_0x197460,'hasMore':_0x2f7b7b};};exports['default']=ListTicketsService;