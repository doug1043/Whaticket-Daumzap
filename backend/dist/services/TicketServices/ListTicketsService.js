const a549_0x3b92fb=a549_0x1734;(function(_0xa7e75d,_0x1571f2){const _0x34d74b=a549_0x1734,_0x2f380e=_0xa7e75d();while(!![]){try{const _0x13d40a=parseInt(_0x34d74b(0x15f))/0x1+-parseInt(_0x34d74b(0x14d))/0x2*(-parseInt(_0x34d74b(0x179))/0x3)+parseInt(_0x34d74b(0x169))/0x4*(parseInt(_0x34d74b(0x178))/0x5)+parseInt(_0x34d74b(0x189))/0x6*(-parseInt(_0x34d74b(0x157))/0x7)+parseInt(_0x34d74b(0x147))/0x8+parseInt(_0x34d74b(0x180))/0x9*(-parseInt(_0x34d74b(0x150))/0xa)+-parseInt(_0x34d74b(0x165))/0xb;if(_0x13d40a===_0x1571f2)break;else _0x2f380e['push'](_0x2f380e['shift']());}catch(_0x5e6d21){_0x2f380e['push'](_0x2f380e['shift']());}}}(a549_0x5391,0x8a0a6));const a549_0x409149=(function(){let _0x18f6c8=!![];return function(_0x430f2f,_0x127775){const _0x3e6d1f=_0x18f6c8?function(){const _0x3ef25b=a549_0x1734;if(_0x127775){const _0x5e7bbc=_0x127775[_0x3ef25b(0x15c)](_0x430f2f,arguments);return _0x127775=null,_0x5e7bbc;}}:function(){};return _0x18f6c8=![],_0x3e6d1f;};}()),a549_0x4056c5=a549_0x409149(this,function(){const _0xc5c89d=a549_0x1734;return a549_0x4056c5[_0xc5c89d(0x181)]()[_0xc5c89d(0x17e)]('(((.+)+)+)+$')[_0xc5c89d(0x181)]()[_0xc5c89d(0x184)](a549_0x4056c5)['search'](_0xc5c89d(0x155));});a549_0x4056c5();function a549_0x1734(_0x277b9f,_0x35652b){const _0x23ad31=a549_0x5391();return a549_0x1734=function(_0x4056c5,_0x409149){_0x4056c5=_0x4056c5-0x146;let _0x53914b=_0x23ad31[_0x4056c5];return _0x53914b;},a549_0x1734(_0x277b9f,_0x35652b);}'use strict';var __importDefault=this&&this[a549_0x3b92fb(0x15b)]||function(_0xa98f6e){const _0x18b85f=a549_0x3b92fb;return _0xa98f6e&&_0xa98f6e[_0x18b85f(0x188)]?_0xa98f6e:{'default':_0xa98f6e};};Object[a549_0x3b92fb(0x15e)](exports,'__esModule',{'value':!![]});function a549_0x5391(){const _0x9e60ad=['../../models/Queue','4rSveFU','length','col','push','between','GetCompanySetting','LIKE','where','intersection','profilePicUrl','name','user','startOfDay','queues','number','3832295DcKOPl','3TtmOdX','profile','../../models/Tag','default','isArray','search','admin','2454912unxzbw','toString','findAndCountAll','lodash','constructor','pending','color','true','__esModule','19926kofEeL','trim','8802072UsQDTR','groupsTab','../../models/Whatsapp','body','endOfDay','parseISO','582300DZJMwe','presence','messages','20cOxzev','LOWER','toLocaleLowerCase','enabled','isGroup','(((.+)+)+)+$','contact','588kzRelx','DESC','date-fns','../UserServices/ShowUserService','__importDefault','apply','../../models/TicketTag','defineProperty','594667GMuZJE','email','findAll','closed','map','disabled','14988831kAsvwy','ticketId','tags'];a549_0x5391=function(){return _0x9e60ad;};return a549_0x5391();}const sequelize_1=require('sequelize'),date_fns_1=require(a549_0x3b92fb(0x159)),lodash_1=require(a549_0x3b92fb(0x183)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require(a549_0x3b92fb(0x168))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require(a549_0x3b92fb(0x15a))),Tag_1=__importDefault(require(a549_0x3b92fb(0x17b))),TicketTag_1=__importDefault(require(a549_0x3b92fb(0x15d))),Whatsapp_1=__importDefault(require(a549_0x3b92fb(0x149))),CheckSettings_1=require('../../helpers/CheckSettings'),ListTicketsService=async({isSearch:isSearch=![],searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x3ab790,tags:_0x93a38b,users:_0x200166,status:_0x178cde,groups:_0x563480,date:_0x33dd64,updatedAt:_0x658757,showAll:_0x35ba6d,userId:_0x2163d8,withUnreadMessages:_0x339c9e,notClosed:_0x259f5e,all:_0x3fbfbf,companyId:_0xe4bdad})=>{const _0x5efcb5=a549_0x3b92fb,_0x5a0d4d=!isSearch&&await(0x0,CheckSettings_1[_0x5efcb5(0x16e)])(_0xe4bdad,_0x5efcb5(0x148),_0x5efcb5(0x164))===_0x5efcb5(0x153),_0x22a273=await(0x0,ShowUserService_1[_0x5efcb5(0x17c)])(_0x2163d8);let _0x6ea156={[sequelize_1['Op']['or']]:[{'userId':_0x2163d8},{'status':_0x5efcb5(0x185)}],'queueId':{[sequelize_1['Op']['or']]:_0x22a273[_0x5efcb5(0x17a)]==='admin'?[_0x3ab790,null]:[_0x3ab790]}};_0x5a0d4d&&(_0x6ea156[_0x5efcb5(0x154)]=_0x563480===_0x5efcb5(0x187));let _0x250afe;_0x250afe=[{'model':Contact_1[_0x5efcb5(0x17c)],'as':_0x5efcb5(0x156),'attributes':['id',_0x5efcb5(0x173),_0x5efcb5(0x177),_0x5efcb5(0x160),_0x5efcb5(0x172),_0x5efcb5(0x14e)]},{'model':Queue_1[_0x5efcb5(0x17c)],'as':'queue','attributes':['id',_0x5efcb5(0x173),_0x5efcb5(0x186)]},{'model':User_1[_0x5efcb5(0x17c)],'as':_0x5efcb5(0x174),'attributes':['id','name']},{'model':Tag_1[_0x5efcb5(0x17c)],'as':_0x5efcb5(0x167),'attributes':['id',_0x5efcb5(0x173),'color']},{'model':Whatsapp_1[_0x5efcb5(0x17c)],'as':'whatsapp','attributes':['id','name']}];_0x35ba6d===_0x5efcb5(0x187)&&_0x22a273[_0x5efcb5(0x17a)]===_0x5efcb5(0x17f)&&(_0x6ea156={'queueId':{[sequelize_1['Op']['or']]:[_0x3ab790,null]}},_0x5a0d4d&&(_0x6ea156[_0x5efcb5(0x154)]=_0x563480==='true'));_0x178cde&&(_0x6ea156={..._0x6ea156,'status':_0x178cde});if(searchParam){const _0x3bb797=searchParam[_0x5efcb5(0x152)]()[_0x5efcb5(0x146)]();_0x250afe=[..._0x250afe,{'model':Message_1['default'],'as':_0x5efcb5(0x14f),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x5efcb5(0x170)])((0x0,sequelize_1['fn'])(_0x5efcb5(0x151),(0x0,sequelize_1['col'])('body')),_0x5efcb5(0x16f),'%'+_0x3bb797+'%')},'required':![],'duplicating':![]}],_0x6ea156={..._0x6ea156,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x5efcb5(0x151),(0x0,sequelize_1[_0x5efcb5(0x16b)])('contact.name')),_0x5efcb5(0x16f),'%'+_0x3bb797+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x3bb797+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['col'])(_0x5efcb5(0x14a))),_0x5efcb5(0x16f),'%'+_0x3bb797+'%')}]};}_0x33dd64&&(_0x6ea156={'createdAt':{[sequelize_1['Op'][_0x5efcb5(0x16d)]]:[+(0x0,date_fns_1[_0x5efcb5(0x175)])((0x0,date_fns_1[_0x5efcb5(0x14c)])(_0x33dd64)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x5efcb5(0x14c)])(_0x33dd64))]}});_0x658757&&(_0x6ea156={'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1[_0x5efcb5(0x175)])((0x0,date_fns_1['parseISO'])(_0x658757)),+(0x0,date_fns_1[_0x5efcb5(0x14b)])((0x0,date_fns_1[_0x5efcb5(0x14c)])(_0x658757))]}});if(_0x339c9e==='true'){const _0x133987=_0x22a273[_0x5efcb5(0x176)][_0x5efcb5(0x163)](_0x35849f=>_0x35849f['id']);_0x6ea156={[sequelize_1['Op']['or']]:[{'userId':_0x2163d8},{'status':_0x5efcb5(0x185)}],'queueId':{[sequelize_1['Op']['or']]:_0x22a273['profile']===_0x5efcb5(0x17f)?[_0x133987,null]:[_0x133987]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}},_0x5a0d4d&&(_0x6ea156['isGroup']=_0x563480===_0x5efcb5(0x187));}if(Array['isArray'](_0x93a38b)&&_0x93a38b[_0x5efcb5(0x16a)]>0x0){const _0x12a807=[];for await(const _0x1a3d9b of _0x93a38b){const _0x251563=await TicketTag_1['default'][_0x5efcb5(0x161)]({'where':{'tagId':_0x1a3d9b}});_0x251563&&_0x12a807[_0x5efcb5(0x16c)](_0x251563[_0x5efcb5(0x163)](_0x4070bb=>_0x4070bb[_0x5efcb5(0x166)]));}const _0x2ac486=(0x0,lodash_1[_0x5efcb5(0x171)])(..._0x12a807);_0x6ea156={..._0x6ea156,'id':{[sequelize_1['Op']['in']]:_0x2ac486}};}if(Array[_0x5efcb5(0x17d)](_0x200166)&&_0x200166[_0x5efcb5(0x16a)]>0x0){const _0x5beb6b=[];for await(const _0x1f28b1 of _0x200166){const _0x537c99=await Ticket_1[_0x5efcb5(0x17c)][_0x5efcb5(0x161)]({'where':{'userId':_0x1f28b1}});_0x537c99&&_0x5beb6b[_0x5efcb5(0x16c)](_0x537c99['map'](_0x591fd2=>_0x591fd2['id']));}const _0x3a4327=(0x0,lodash_1[_0x5efcb5(0x171)])(..._0x5beb6b);_0x6ea156={..._0x6ea156,'id':{[sequelize_1['Op']['in']]:_0x3a4327}};}const _0x279299=_0x3fbfbf?undefined:0x28,_0x20fc50=_0x3fbfbf?undefined:_0x279299*(+pageNumber-0x1);_0x259f5e&&(_0x6ea156={..._0x6ea156,'status':{[sequelize_1['Op']['ne']]:_0x5efcb5(0x162)}});_0x6ea156={..._0x6ea156,'companyId':_0xe4bdad};const {count:_0xa6a9d1,rows:_0x561e4b}=await Ticket_1[_0x5efcb5(0x17c)][_0x5efcb5(0x182)]({'where':_0x6ea156,'include':_0x250afe,'distinct':!![],'limit':_0x279299,'offset':_0x20fc50,'order':[['updatedAt',_0x5efcb5(0x158)]],'subQuery':![]}),_0x17b397=_0xa6a9d1>_0x20fc50+_0x561e4b[_0x5efcb5(0x16a)];return{'tickets':_0x561e4b,'count':_0xa6a9d1,'hasMore':_0x17b397};};exports[a549_0x3b92fb(0x17c)]=ListTicketsService;