const a553_0x44c585=a553_0x4ca5;(function(_0x2ae187,_0x10ed44){const _0x3d2fc=a553_0x4ca5,_0x5e9c8f=_0x2ae187();while(!![]){try{const _0x45ff0f=-parseInt(_0x3d2fc(0x20b))/0x1+parseInt(_0x3d2fc(0x202))/0x2+parseInt(_0x3d2fc(0x210))/0x3+-parseInt(_0x3d2fc(0x1f0))/0x4+parseInt(_0x3d2fc(0x201))/0x5+parseInt(_0x3d2fc(0x1f1))/0x6+parseInt(_0x3d2fc(0x1fc))/0x7*(parseInt(_0x3d2fc(0x20a))/0x8);if(_0x45ff0f===_0x10ed44)break;else _0x5e9c8f['push'](_0x5e9c8f['shift']());}catch(_0x4b868c){_0x5e9c8f['push'](_0x5e9c8f['shift']());}}}(a553_0x1759,0x9bddf));const a553_0x222f39=(function(){let _0x57dfff=!![];return function(_0x15f1d2,_0x8e36ac){const _0x3ce57a=_0x57dfff?function(){if(_0x8e36ac){const _0x44f6bf=_0x8e36ac['apply'](_0x15f1d2,arguments);return _0x8e36ac=null,_0x44f6bf;}}:function(){};return _0x57dfff=![],_0x3ce57a;};}()),a553_0x3fe521=a553_0x222f39(this,function(){const _0x2135ae=a553_0x4ca5;return a553_0x3fe521[_0x2135ae(0x208)]()[_0x2135ae(0x1ef)](_0x2135ae(0x1fd))[_0x2135ae(0x208)]()['constructor'](a553_0x3fe521)['search'](_0x2135ae(0x1fd));});a553_0x3fe521();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x189a3b){const _0xcd9f78=a553_0x4ca5;return _0x189a3b&&_0x189a3b[_0xcd9f78(0x1ea)]?_0x189a3b:{'default':_0x189a3b};};Object[a553_0x44c585(0x1f4)](exports,'__esModule',{'value':!![]});const sequelize_1=require('sequelize'),date_fns_1=require(a553_0x44c585(0x1e4)),lodash_1=require('lodash'),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a553_0x44c585(0x217))),Message_1=__importDefault(require(a553_0x44c585(0x206))),Queue_1=__importDefault(require(a553_0x44c585(0x1e7))),User_1=__importDefault(require(a553_0x44c585(0x1f7))),ShowUserService_1=__importDefault(require(a553_0x44c585(0x1fa))),Tag_1=__importDefault(require(a553_0x44c585(0x211))),TicketTag_1=__importDefault(require(a553_0x44c585(0x1fb))),Whatsapp_1=__importDefault(require(a553_0x44c585(0x1e3))),CheckSettings_1=require('../../helpers/CheckSettings'),ListTicketsService=async({isSearch:isSearch=![],searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x3732a4,tags:_0x4962e8,users:_0x59bf2d,status:_0x944436,groups:_0x3a76f7,date:_0x2f9d2c,updatedAt:_0x348e7a,showAll:_0x4af04d,userId:_0x5d0979,withUnreadMessages:_0x428a4f,notClosed:_0x593f4d,all:_0x4db217,companyId:_0x10422c})=>{const _0x4d6b01=a553_0x44c585,_0x5d6789=!isSearch&&await(0x0,CheckSettings_1[_0x4d6b01(0x1f3)])(_0x10422c,_0x4d6b01(0x220),_0x4d6b01(0x1ec))===_0x4d6b01(0x1f6),_0x1a8a04=await(0x0,ShowUserService_1[_0x4d6b01(0x204)])(_0x5d0979);let _0x4290a1={[sequelize_1['Op']['or']]:[{'userId':_0x5d0979},{'status':_0x4d6b01(0x1f2)}],'queueId':{[sequelize_1['Op']['or']]:_0x1a8a04[_0x4d6b01(0x21c)]===_0x4d6b01(0x20c)?[_0x3732a4,null]:[_0x3732a4]}};_0x5d6789&&(_0x4290a1['isGroup']=_0x3a76f7==='true');let _0x5e55c7;_0x5e55c7=[{'model':Contact_1['default'],'as':_0x4d6b01(0x21a),'attributes':['id',_0x4d6b01(0x21b),_0x4d6b01(0x203),_0x4d6b01(0x1ed),'profilePicUrl',_0x4d6b01(0x1f8)]},{'model':Queue_1[_0x4d6b01(0x204)],'as':_0x4d6b01(0x214),'attributes':['id',_0x4d6b01(0x21b),_0x4d6b01(0x1e6)]},{'model':User_1['default'],'as':_0x4d6b01(0x21e),'attributes':['id',_0x4d6b01(0x21b)]},{'model':Tag_1[_0x4d6b01(0x204)],'as':'tags','attributes':['id',_0x4d6b01(0x21b),_0x4d6b01(0x1e6)]},{'model':Whatsapp_1[_0x4d6b01(0x204)],'as':'whatsapp','attributes':['id',_0x4d6b01(0x21b)]}];_0x4af04d===_0x4d6b01(0x1ff)&&_0x1a8a04[_0x4d6b01(0x21c)]===_0x4d6b01(0x20c)&&(_0x4290a1={'queueId':{[sequelize_1['Op']['or']]:[_0x3732a4,null]}},_0x5d6789&&(_0x4290a1[_0x4d6b01(0x1e9)]=_0x3a76f7==='true'));_0x944436&&(_0x4290a1={..._0x4290a1,'status':_0x944436});if(searchParam){const _0x5e6ded=searchParam['toLocaleLowerCase']()[_0x4d6b01(0x1f5)]();_0x5e55c7=[..._0x5e55c7,{'model':Message_1['default'],'as':_0x4d6b01(0x1ee),'attributes':['id',_0x4d6b01(0x212)],'where':{'body':(0x0,sequelize_1[_0x4d6b01(0x1fe)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x4d6b01(0x216)])(_0x4d6b01(0x212))),_0x4d6b01(0x1f9),'%'+_0x5e6ded+'%')},'required':![],'duplicating':![]}],_0x4290a1={..._0x4290a1,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x4d6b01(0x1e5),(0x0,sequelize_1[_0x4d6b01(0x216)])('contact.name')),_0x4d6b01(0x1f9),'%'+_0x5e6ded+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x4d6b01(0x205)]]:'%'+_0x5e6ded+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x4d6b01(0x1e5),(0x0,sequelize_1[_0x4d6b01(0x216)])('body')),_0x4d6b01(0x1f9),'%'+_0x5e6ded+'%')}]};}_0x2f9d2c&&(_0x4290a1={'createdAt':{[sequelize_1['Op'][_0x4d6b01(0x21f)]]:[+(0x0,date_fns_1[_0x4d6b01(0x20f)])((0x0,date_fns_1['parseISO'])(_0x2f9d2c)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x4d6b01(0x20d)])(_0x2f9d2c))]}});_0x348e7a&&(_0x4290a1={'updatedAt':{[sequelize_1['Op'][_0x4d6b01(0x21f)]]:[+(0x0,date_fns_1[_0x4d6b01(0x20f)])((0x0,date_fns_1[_0x4d6b01(0x20d)])(_0x348e7a)),+(0x0,date_fns_1[_0x4d6b01(0x215)])((0x0,date_fns_1[_0x4d6b01(0x20d)])(_0x348e7a))]}});if(_0x428a4f===_0x4d6b01(0x1ff)){const _0x89ea95=_0x1a8a04[_0x4d6b01(0x219)]['map'](_0x4e79c8=>_0x4e79c8['id']);_0x4290a1={[sequelize_1['Op']['or']]:[{'userId':_0x5d0979},{'status':_0x4d6b01(0x1f2)}],'queueId':{[sequelize_1['Op']['or']]:_0x1a8a04[_0x4d6b01(0x21c)]===_0x4d6b01(0x20c)?[_0x89ea95,null]:[_0x89ea95]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}},_0x5d6789&&(_0x4290a1['isGroup']=_0x3a76f7===_0x4d6b01(0x1ff));}if(Array[_0x4d6b01(0x200)](_0x4962e8)&&_0x4962e8[_0x4d6b01(0x207)]>0x0){const _0x36fa8d=[];for await(const _0x2a6878 of _0x4962e8){const _0x18edc2=await TicketTag_1[_0x4d6b01(0x204)][_0x4d6b01(0x20e)]({'where':{'tagId':_0x2a6878}});_0x18edc2&&_0x36fa8d['push'](_0x18edc2[_0x4d6b01(0x1e8)](_0x6daf5e=>_0x6daf5e[_0x4d6b01(0x21d)]));}const _0x93bf27=(0x0,lodash_1['intersection'])(..._0x36fa8d);_0x4290a1={..._0x4290a1,'id':{[sequelize_1['Op']['in']]:_0x93bf27}};}if(Array['isArray'](_0x59bf2d)&&_0x59bf2d[_0x4d6b01(0x207)]>0x0){const _0x3fe4f0=[];for await(const _0x3d36d1 of _0x59bf2d){const _0x15c971=await Ticket_1['default'][_0x4d6b01(0x20e)]({'where':{'userId':_0x3d36d1}});_0x15c971&&_0x3fe4f0[_0x4d6b01(0x1eb)](_0x15c971[_0x4d6b01(0x1e8)](_0x29cffa=>_0x29cffa['id']));}const _0x1e55af=(0x0,lodash_1[_0x4d6b01(0x213)])(..._0x3fe4f0);_0x4290a1={..._0x4290a1,'id':{[sequelize_1['Op']['in']]:_0x1e55af}};}const _0x2b9775=_0x4db217?undefined:0x28,_0x25223a=_0x4db217?undefined:_0x2b9775*(+pageNumber-0x1);_0x593f4d&&(_0x4290a1={..._0x4290a1,'status':{[sequelize_1['Op']['ne']]:'closed'}});_0x4290a1={..._0x4290a1,'companyId':_0x10422c};const {count:_0x80389d,rows:_0x4faa86}=await Ticket_1[_0x4d6b01(0x204)][_0x4d6b01(0x209)]({'where':_0x4290a1,'include':_0x5e55c7,'distinct':!![],'limit':_0x2b9775,'offset':_0x25223a,'order':[[_0x4d6b01(0x218),'DESC']],'subQuery':![]}),_0x5bfee1=_0x80389d>_0x25223a+_0x4faa86[_0x4d6b01(0x207)];return{'tickets':_0x4faa86,'count':_0x80389d,'hasMore':_0x5bfee1};};function a553_0x1759(){const _0x55b7e9=['search','5070632TOVWXb','6217062KTlXbz','pending','GetCompanySetting','defineProperty','trim','enabled','../../models/User','presence','LIKE','../UserServices/ShowUserService','../../models/TicketTag','65275FeUNAr','(((.+)+)+)+$','where','true','isArray','246805RsEmnA','2380654QLUQVJ','number','default','like','../../models/Message','length','toString','findAndCountAll','16rnhSgQ','1116693MPiAyp','admin','parseISO','findAll','startOfDay','2184801UjDarh','../../models/Tag','body','intersection','queue','endOfDay','col','../../models/Contact','updatedAt','queues','contact','name','profile','ticketId','user','between','groupsTab','../../models/Whatsapp','date-fns','LOWER','color','../../models/Queue','map','isGroup','__esModule','push','disabled','email','messages'];a553_0x1759=function(){return _0x55b7e9;};return a553_0x1759();}function a553_0x4ca5(_0x2e2c12,_0x2ba943){const _0x168434=a553_0x1759();return a553_0x4ca5=function(_0x3fe521,_0x222f39){_0x3fe521=_0x3fe521-0x1e3;let _0x175958=_0x168434[_0x3fe521];return _0x175958;},a553_0x4ca5(_0x2e2c12,_0x2ba943);}exports[a553_0x44c585(0x204)]=ListTicketsService;