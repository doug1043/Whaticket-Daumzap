'use strict';const a698_0x41e60e=a698_0x5a5e;(function(_0x59da2b,_0x238bbf){const _0x342fbb=a698_0x5a5e,_0xabc71b=_0x59da2b();while(!![]){try{const _0x4a6be7=parseInt(_0x342fbb(0x1cc))/0x1+-parseInt(_0x342fbb(0x1f6))/0x2*(-parseInt(_0x342fbb(0x199))/0x3)+-parseInt(_0x342fbb(0x1cd))/0x4+-parseInt(_0x342fbb(0x1df))/0x5+-parseInt(_0x342fbb(0x1ff))/0x6*(parseInt(_0x342fbb(0x1a1))/0x7)+-parseInt(_0x342fbb(0x1fa))/0x8*(parseInt(_0x342fbb(0x18d))/0x9)+-parseInt(_0x342fbb(0x206))/0xa*(-parseInt(_0x342fbb(0x20a))/0xb);if(_0x4a6be7===_0x238bbf)break;else _0xabc71b['push'](_0xabc71b['shift']());}catch(_0x45e8fd){_0xabc71b['push'](_0xabc71b['shift']());}}}(a698_0x9085,0xe22c3));var __createBinding=this&&this['__createBinding']||(Object[a698_0x41e60e(0x189)]?function(_0x2a835f,_0x46b697,_0x3b6ea8,_0x1ab5f9){const _0x5a3805=a698_0x41e60e;if(_0x1ab5f9===undefined)_0x1ab5f9=_0x3b6ea8;var _0xd9249d=Object[_0x5a3805(0x1b7)](_0x46b697,_0x3b6ea8);(!_0xd9249d||(_0x5a3805(0x205)in _0xd9249d?!_0x46b697[_0x5a3805(0x1f3)]:_0xd9249d['writable']||_0xd9249d[_0x5a3805(0x1cb)]))&&(_0xd9249d={'enumerable':!![],'get':function(){return _0x46b697[_0x3b6ea8];}}),Object[_0x5a3805(0x1af)](_0x2a835f,_0x1ab5f9,_0xd9249d);}:function(_0x55eca5,_0x955022,_0x596c72,_0x150b0){if(_0x150b0===undefined)_0x150b0=_0x596c72;_0x55eca5[_0x150b0]=_0x955022[_0x596c72];}),__setModuleDefault=this&&this[a698_0x41e60e(0x175)]||(Object[a698_0x41e60e(0x189)]?function(_0x3a73b5,_0x4e8ee9){const _0x5253fe=a698_0x41e60e;Object['defineProperty'](_0x3a73b5,_0x5253fe(0x182),{'enumerable':!![],'value':_0x4e8ee9});}:function(_0x2559bd,_0x471bfd){_0x2559bd['default']=_0x471bfd;}),__importStar=this&&this[a698_0x41e60e(0x1cf)]||(function(){const _0x321bfb=(function(){let _0xae80e1=!![];return function(_0x258bef,_0x262146){const _0x537866=_0xae80e1?function(){if(_0x262146){const _0x17d7df=_0x262146['apply'](_0x258bef,arguments);return _0x262146=null,_0x17d7df;}}:function(){};return _0xae80e1=![],_0x537866;};}()),_0xb08fd7=_0x321bfb(this,function(){const _0x4d4e60=a698_0x5a5e;return _0xb08fd7['toString']()[_0x4d4e60(0x1aa)](_0x4d4e60(0x1c8))[_0x4d4e60(0x16d)]()['constructor'](_0xb08fd7)[_0x4d4e60(0x1aa)](_0x4d4e60(0x1c8));});_0xb08fd7();var _0x300d3=function(_0x25088f){return _0x300d3=Object['getOwnPropertyNames']||function(_0x13267a){const _0x157ee1=a698_0x5a5e;var _0x2fcf44=[];for(var _0xaa72e0 in _0x13267a)if(Object[_0x157ee1(0x1eb)][_0x157ee1(0x1ae)][_0x157ee1(0x200)](_0x13267a,_0xaa72e0))_0x2fcf44[_0x2fcf44['length']]=_0xaa72e0;return _0x2fcf44;},_0x300d3(_0x25088f);};return function(_0xf59453){const _0x3cb686=a698_0x5a5e;if(_0xf59453&&_0xf59453[_0x3cb686(0x1f3)])return _0xf59453;var _0x5617a4={};if(_0xf59453!=null){for(var _0x158f05=_0x300d3(_0xf59453),_0x172762=0x0;_0x172762<_0x158f05[_0x3cb686(0x18f)];_0x172762++)if(_0x158f05[_0x172762]!==_0x3cb686(0x182))__createBinding(_0x5617a4,_0xf59453,_0x158f05[_0x172762]);}return __setModuleDefault(_0x5617a4,_0xf59453),_0x5617a4;};}()),__importDefault=this&&this[a698_0x41e60e(0x1c4)]||function(_0x3feb5d){const _0x16fdde=a698_0x41e60e;return _0x3feb5d&&_0x3feb5d[_0x16fdde(0x1f3)]?_0x3feb5d:{'default':_0x3feb5d};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a698_0x41e60e(0x1dc)]=void 0x0;const Contact_1=__importDefault(require('../../models/Contact')),SendMessage_1=require(a698_0x41e60e(0x1fe)),Ticket_1=__importDefault(require(a698_0x41e60e(0x1b9))),SendWhatsAppMedia_1=__importDefault(require(a698_0x41e60e(0x194))),SendWhatsAppMediaFlow_1=__importStar(require('../WbotServices/SendWhatsAppMediaFlow')),randomizador_1=require(a698_0x41e60e(0x1ba)),Mustache_1=__importDefault(require(a698_0x41e60e(0x19f))),SetTicketMessagesAsRead_1=__importDefault(require(a698_0x41e60e(0x1f8))),SendWhatsAppMessage_1=__importDefault(require(a698_0x41e60e(0x1bb))),ShowTicketService_1=__importDefault(require(a698_0x41e60e(0x1db))),randomCode_1=require(a698_0x41e60e(0x20c)),ShowQueueService_1=__importDefault(require(a698_0x41e60e(0x1fc))),socket_1=require(a698_0x41e60e(0x1e7)),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),FindOrCreateATicketTrakingService_1=__importDefault(require(a698_0x41e60e(0x207))),logger_1=require(a698_0x41e60e(0x1c5)),CreateLogTicketService_1=__importDefault(require(a698_0x41e60e(0x17b))),Setting_1=__importDefault(require(a698_0x41e60e(0x203))),ShowWhatsAppService_1=__importDefault(require(a698_0x41e60e(0x183))),bluebird_1=require(a698_0x41e60e(0x1bd)),typebotListener_1=__importDefault(require(a698_0x41e60e(0x17e))),wbot_1=require(a698_0x41e60e(0x1d9)),ActionsWebhookService=async(_0x57cb44,_0x31deee,_0x29e97d,_0x2d9300,_0x7c1331,_0x2824b0,_0x1a1b80,_0x4b64e7,_0x12fb9d,_0x43e3cf,_0x17ab4e,_0x3e2c94='',_0x1c15d1)=>{const _0x2c788f=a698_0x41e60e;try{const _0x1d72b0=(0x0,socket_1['getIO'])();let _0x19be76=_0x2824b0;console[_0x2c788f(0x18a)](_0x2c788f(0x209),_0x31deee,_0x29e97d,_0x2d9300,_0x7c1331,_0x2824b0,_0x1a1b80,_0x4b64e7,_0x12fb9d,_0x43e3cf,_0x17ab4e,_0x3e2c94);let _0x1455ac='';const _0x2861f5=_0x7c1331;if(_0x3e2c94===''){const _0x404eae=_0x4b64e7[_0x2c788f(0x195)][_0x2c788f(0x19a)](_0x13d9a6=>_0x13d9a6[_0x2c788f(0x1d7)]==='nome');_0x404eae[_0x2c788f(0x1d4)][_0x2c788f(0x192)](',')[_0x2c788f(0x172)](_0x369af0=>{const _0x416bd9=_0x2c788f,_0x1fc5c6=_0x4b64e7[_0x416bd9(0x1ec)][_0x416bd9(0x19a)](_0x346e91=>_0x346e91===_0x369af0);let _0x2efcb0='';!_0x1fc5c6?_0x2efcb0=_0x369af0:_0x2efcb0=constructJsonLine(_0x1fc5c6,_0x1a1b80),_0x1455ac=_0x1455ac+_0x2efcb0;});}else _0x1455ac=_0x3e2c94[_0x2c788f(0x171)];let _0x5d5549='';if(_0x3e2c94===''){const _0x258c46=_0x4b64e7['inputs'][_0x2c788f(0x19a)](_0x132b9e=>_0x132b9e[_0x2c788f(0x1d7)]===_0x2c788f(0x1a2));_0x258c46[_0x2c788f(0x1d4)][_0x2c788f(0x192)](',')[_0x2c788f(0x172)](_0x1f9b85=>{const _0x54f97c=_0x2c788f,_0x35e1a6=_0x4b64e7['keysFull'][_0x54f97c(0x19a)](_0x16de99=>_0x16de99===_0x1f9b85);let _0x325c01='';!_0x35e1a6?_0x325c01=_0x1f9b85:_0x325c01=constructJsonLine(_0x35e1a6,_0x1a1b80),_0x5d5549=_0x5d5549+_0x325c01;});}else _0x5d5549=_0x3e2c94['number'];_0x5d5549=removerNaoLetrasNumeros(_0x5d5549);_0x5d5549[_0x2c788f(0x1e5)](0x0,0x2)==='55'&&(parseInt(_0x5d5549[_0x2c788f(0x1e5)](0x2,0x4))>=0x1f&&(_0x5d5549[_0x2c788f(0x18f)]===0xd&&(_0x5d5549=_0x5d5549[_0x2c788f(0x1e5)](0x0,0x4)+_0x5d5549[_0x2c788f(0x1e5)](0x5,0xd))));let _0x5b8cef='';if(_0x3e2c94===''){const _0x2106cd=_0x4b64e7[_0x2c788f(0x195)][_0x2c788f(0x19a)](_0x3aae7d=>_0x3aae7d[_0x2c788f(0x1d7)]===_0x2c788f(0x1b8));_0x2106cd[_0x2c788f(0x1d4)][_0x2c788f(0x192)](',')[_0x2c788f(0x172)](_0x58808e=>{const _0x3de77f=_0x2c788f,_0x10a672=_0x4b64e7[_0x3de77f(0x1ec)][_0x3de77f(0x19a)](_0x5ac9d6=>_0x5ac9d6['endsWith'](_0x3de77f(0x1b8)));let _0x5ec62e='';!_0x10a672?_0x5ec62e=_0x58808e:_0x5ec62e=constructJsonLine(_0x10a672,_0x1a1b80),_0x5b8cef=_0x5b8cef+_0x5ec62e;});}else _0x5b8cef=_0x3e2c94[_0x2c788f(0x1b8)];const _0x5d7f72=_0x2d9300[_0x2c788f(0x18f)],_0x595d67=await(0x0,ShowWhatsAppService_1[_0x2c788f(0x182)])(_0x57cb44,_0x29e97d);if(_0x595d67[_0x2c788f(0x16f)]!==_0x2c788f(0x20b))return;let _0x3d59d0=0x0,_0x3e4fed='',_0x193425=null,_0xb7b1de=![];_0x17ab4e&&(_0x193425=await Ticket_1[_0x2c788f(0x182)]['findOne']({'where':{'id':_0x17ab4e,'whatsappId':_0x57cb44,'companyId':_0x29e97d},'include':[_0x2c788f(0x1b4),_0x2c788f(0x198)]}));for(var _0x490fad=0x0;_0x490fad<_0x5d7f72;_0x490fad++){let _0x350de8=undefined,_0x40ca8f;if(_0x43e3cf){console[_0x2c788f(0x18a)](_0x2c788f(0x1d8));if(_0x43e3cf===_0x2c788f(0x1e3)){console[_0x2c788f(0x18a)](_0x2c788f(0x186));_0x17ab4e&&(console[_0x2c788f(0x18a)](_0x2c788f(0x17c)),_0x40ca8f=await Ticket_1[_0x2c788f(0x182)]['findOne']({'where':{'id':_0x17ab4e,'whatsappId':_0x57cb44}}),await _0x193425[_0x2c788f(0x179)]({'status':_0x2c788f(0x1c0)}));break;}if(_0x3e4fed===''){console['log']('UPDATE5...');if(_0x193425&&_0x193425[_0x2c788f(0x1d5)]){const _0x3475bc=_0x2d9300['find'](_0x3ea026=>_0x3ea026['id']===_0x193425['lastFlowId']);_0x3475bc?(_0x350de8=_0x3475bc,_0x3e4fed=_0x3475bc['id'],console[_0x2c788f(0x18a)](_0x2c788f(0x202)+_0x3e4fed+_0x2c788f(0x1ea)+_0x3475bc[_0x2c788f(0x1e9)]+')')):_0x350de8={'type':'menu'};}else _0x350de8={'type':_0x2c788f(0x18b)};}else console['log'](_0x2c788f(0x1fd)),_0x350de8=_0x2d9300[_0x2c788f(0x1e8)](_0x134b35=>_0x134b35['id']===_0x3e4fed)[0x0];}else{console['log'](_0x2c788f(0x201));const _0x29feb0=_0x2d9300['filter'](_0x1b1b51=>_0x1b1b51['id']===_0x19be76)[0x0];_0x29feb0&&(_0x350de8=_0x29feb0);}if(!_0x350de8){console[_0x2c788f(0x18a)](_0x2c788f(0x177));break;}if(_0x350de8[_0x2c788f(0x1e9)]===_0x2c788f(0x1a0)){let _0x1c8d03;const _0x5ea654=_0x193425[_0x2c788f(0x1ad)];_0x5ea654&&_0x5ea654['hasOwnProperty'](_0x2c788f(0x190))?_0x1c8d03={'body':replaceMessages(_0x5ea654,_0x350de8[_0x2c788f(0x1d4)][_0x2c788f(0x1f7)])}:_0x1c8d03={'body':_0x350de8['data'][_0x2c788f(0x1f7)]},await(0x0,SendMessage_1['SendMessage'])(_0x595d67,{'number':_0x5d5549,'body':_0x1c8d03[_0x2c788f(0x1f5)]}),await intervalWhats('1');}console[_0x2c788f(0x18a)](_0x2c788f(0x1a7));if(_0x350de8[_0x2c788f(0x1e9)]===_0x2c788f(0x174)){console[_0x2c788f(0x18a)](_0x2c788f(0x1d1));const _0x516460=(0x0,wbot_1['getWbot'])(_0x595d67['id']);await(0x0,typebotListener_1[_0x2c788f(0x182)])({'wbot':_0x516460,'msg':_0x1c15d1,'ticket':_0x193425,'typebot':_0x350de8[_0x2c788f(0x1d4)][_0x2c788f(0x1ce)]});}if(_0x350de8[_0x2c788f(0x1e9)]===_0x2c788f(0x204)){const _0x30ec8e=_0x193425?.['dataWebhook'],_0x21e2b7=_0x193425?.[_0x2c788f(0x1ad)]?.[_0x2c788f(0x190)];if(!_0x21e2b7||_0x21e2b7===undefined||_0x21e2b7===null){const {message:_0x47a7bd}=_0x350de8[_0x2c788f(0x1d4)]['typebotIntegration'],_0x180ae6=await(0x0,ShowTicketService_1[_0x2c788f(0x182)])(_0x193425['id'],_0x29e97d),_0x1dd613=(0x0,Mustache_1['default'])(''+_0x47a7bd,_0x193425);await(0x0,bluebird_1[_0x2c788f(0x1c7)])(0xbb8),await(0x0,SendWhatsAppMediaFlow_1['typeSimulation'])(_0x193425,'composing'),await(0x0,SendWhatsAppMessage_1[_0x2c788f(0x182)])({'body':_0x1dd613,'ticket':_0x180ae6,'quotedMsg':null}),(0x0,SetTicketMessagesAsRead_1[_0x2c788f(0x182)])(_0x180ae6),await _0x180ae6[_0x2c788f(0x179)]({'lastMessage':_0x1dd613}),await _0x193425[_0x2c788f(0x179)]({'userId':null,'companyId':_0x29e97d,'lastFlowId':_0x350de8['id'],'hashFlowId':_0x12fb9d,'flowStopped':_0x31deee[_0x2c788f(0x16d)]()});}break;}if(_0x350de8['type']===_0x2c788f(0x1c3)){const _0x55dd7e=_0x350de8[_0x2c788f(0x1d4)]?.[_0x2c788f(0x1d4)]?.['id']||_0x350de8['data']?.['id'],_0x2e3148=await(0x0,ShowQueueService_1[_0x2c788f(0x182)])(_0x55dd7e,_0x29e97d);await _0x193425[_0x2c788f(0x179)]({'status':_0x2c788f(0x1b6),'queueId':_0x2e3148['id'],'userId':_0x193425[_0x2c788f(0x184)],'companyId':_0x29e97d,'flowWebhook':!![],'lastFlowId':_0x350de8['id'],'hashFlowId':_0x12fb9d,'flowStopped':_0x31deee[_0x2c788f(0x16d)]()}),await(0x0,FindOrCreateATicketTrakingService_1[_0x2c788f(0x182)])({'ticketId':_0x193425['id'],'companyId':_0x29e97d,'whatsappId':_0x193425[_0x2c788f(0x1b2)],'userId':_0x193425['userId']}),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':'pending','queueId':_0x2e3148['id']},'ticketId':_0x193425['id'],'companyId':_0x29e97d}),await(0x0,CreateLogTicketService_1[_0x2c788f(0x182)])({'ticketId':_0x193425['id'],'type':_0x2c788f(0x198),'queueId':_0x2e3148['id']});const _0x262f26=await Setting_1[_0x2c788f(0x182)]['findOne']({'where':{'companyId':_0x29e97d,'key':_0x2c788f(0x1a6)}}),_0x3646d0=_0x262f26?.[_0x2c788f(0x185)]===_0x2c788f(0x1a3);if(_0x3646d0){const _0x171077=await Ticket_1['default']['findAndCountAll']({'where':{'userId':null,'status':'pending','companyId':_0x29e97d,'queueId':_0x2e3148['id'],'whatsappId':_0x595d67['id'],'isGroup':![]}}),_0x14823d=_0x171077['count']===0x0?0x1:_0x171077[_0x2c788f(0x1a9)],_0x19def3=await Setting_1[_0x2c788f(0x182)][_0x2c788f(0x1c9)]({'where':{'companyId':_0x29e97d,'key':_0x2c788f(0x1e6)}}),_0x18bef2=(_0x19def3?.['value']||_0x2c788f(0x1b0))+'\x20*'+_0x14823d+'*',_0x105d86=await(0x0,ShowTicketService_1[_0x2c788f(0x182)])(_0x193425['id'],_0x29e97d),_0x137679=(0x0,Mustache_1[_0x2c788f(0x182)])(''+_0x18bef2,_0x193425);await(0x0,bluebird_1['delay'])(0xbb8),await(0x0,SendWhatsAppMediaFlow_1[_0x2c788f(0x1de)])(_0x193425,_0x2c788f(0x1ac)),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x137679,'ticket':_0x105d86,'quotedMsg':null}),(0x0,SetTicketMessagesAsRead_1[_0x2c788f(0x182)])(_0x105d86),await _0x105d86['update']({'lastMessage':_0x137679});}}if(_0x350de8['type']===_0x2c788f(0x180))for(var _0x316581=0x0;_0x316581<_0x350de8[_0x2c788f(0x1d4)]['seq']['length'];_0x316581++){const _0x444a41=_0x350de8['data'][_0x2c788f(0x1c6)][_0x316581];_0x193425=await Ticket_1[_0x2c788f(0x182)][_0x2c788f(0x1c9)]({'where':{'id':_0x17ab4e,'companyId':_0x29e97d}});if(_0x444a41[_0x2c788f(0x1a5)](_0x2c788f(0x1a0))){const _0x1a6073=_0x350de8[_0x2c788f(0x1d4)]['elements'][_0x2c788f(0x1e8)](_0xdf7592=>_0xdf7592[_0x2c788f(0x17d)]===_0x444a41)[0x0]['value'],_0x5dfe76=await(0x0,ShowTicketService_1[_0x2c788f(0x182)])(_0x17ab4e,_0x29e97d);let _0x3ef821;const _0x570ebc=_0x193425['dataWebhook'];_0x570ebc&&_0x570ebc[_0x2c788f(0x1ae)](_0x2c788f(0x190))?_0x3ef821=replaceMessages(_0x570ebc[_0x2c788f(0x190)],_0x1a6073):_0x3ef821=_0x1a6073,await(0x0,bluebird_1[_0x2c788f(0x1c7)])(0xbb8),await(0x0,SendWhatsAppMediaFlow_1[_0x2c788f(0x1de)])(_0x193425,_0x2c788f(0x1ac)),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x3ef821,'ticket':_0x5dfe76,'quotedMsg':null}),(0x0,SetTicketMessagesAsRead_1[_0x2c788f(0x182)])(_0x5dfe76),await _0x5dfe76['update']({'lastMessage':(0x0,Mustache_1[_0x2c788f(0x182)])(_0x1a6073,_0x193425)}),await intervalWhats('1');}_0x444a41[_0x2c788f(0x1a5)](_0x2c788f(0x1c2))&&await intervalWhats(_0x350de8[_0x2c788f(0x1d4)][_0x2c788f(0x18e)][_0x2c788f(0x1e8)](_0x1ed317=>_0x1ed317[_0x2c788f(0x17d)]===_0x444a41)[0x0][_0x2c788f(0x185)]);if(_0x444a41[_0x2c788f(0x1a5)](_0x2c788f(0x17a))){await(0x0,SendWhatsAppMediaFlow_1['typeSimulation'])(_0x193425,_0x2c788f(0x1ac));const _0x2be756=_0x350de8[_0x2c788f(0x1d4)][_0x2c788f(0x18e)]['find'](_0x4865c4=>_0x4865c4[_0x2c788f(0x17d)]===_0x444a41);if(!_0x2be756||!_0x2be756[_0x2c788f(0x185)]){console[_0x2c788f(0x19d)](_0x2c788f(0x170)+_0x444a41);return;}let _0x48e8a5=_0x2be756['value'];if(!_0x48e8a5[_0x2c788f(0x1b5)](_0x2c788f(0x1e0))&&!_0x48e8a5[_0x2c788f(0x1b5)]('https://')){const _0x590d75=process[_0x2c788f(0x16e)]['BACKEND_URL']===_0x2c788f(0x191)?''+__dirname['split'](_0x2c788f(0x1d2))[0x0][_0x2c788f(0x192)]('\x5c')['join']('/'):''+__dirname[_0x2c788f(0x192)](_0x2c788f(0x17f))[0x0][_0x2c788f(0x192)]('\x5c')['join']('/');_0x48e8a5=_0x590d75+_0x2c788f(0x1ef)+_0x2be756[_0x2c788f(0x185)];const _0x1939d7=require('fs');if(!_0x1939d7[_0x2c788f(0x1f1)](_0x48e8a5)){console[_0x2c788f(0x19d)]('Arquivo\x20de\x20mídia\x20não\x20encontrado:\x20'+_0x48e8a5);return;}}const _0x15ed9b=await Ticket_1[_0x2c788f(0x182)][_0x2c788f(0x1c9)]({'where':{'id':_0x193425['id']},'include':[Contact_1[_0x2c788f(0x182)]]});if(!_0x15ed9b){console[_0x2c788f(0x19d)](_0x2c788f(0x1bc)+_0x193425['id']+_0x2c788f(0x1f2));return;}await(0x0,SendWhatsAppMedia_1[_0x2c788f(0x182)])({'media':_0x48e8a5,'ticket':_0x15ed9b}),await intervalWhats('1');}if(_0x444a41[_0x2c788f(0x1a5)](_0x2c788f(0x1a4))){const _0x3d03f4=_0x350de8[_0x2c788f(0x1d4)][_0x2c788f(0x18e)]['find'](_0x405fa1=>_0x405fa1[_0x2c788f(0x17d)]===_0x444a41);if(!_0x3d03f4||!_0x3d03f4[_0x2c788f(0x185)]){console[_0x2c788f(0x19d)]('Elemento\x20de\x20áudio\x20não\x20encontrado:\x20'+_0x444a41);return;}let _0x231529=_0x3d03f4['value'];if(!_0x231529[_0x2c788f(0x1b5)]('http://')&&!_0x231529[_0x2c788f(0x1b5)]('https://')){const _0x319795=process['env']['BACKEND_URL']===_0x2c788f(0x191)?''+__dirname[_0x2c788f(0x192)](_0x2c788f(0x1d2))[0x0][_0x2c788f(0x192)]('\x5c')[_0x2c788f(0x1f0)]('/'):''+__dirname[_0x2c788f(0x192)](_0x2c788f(0x17f))[0x0][_0x2c788f(0x192)]('\x5c')['join']('/');_0x231529=_0x319795+_0x2c788f(0x1ef)+_0x3d03f4[_0x2c788f(0x185)];const _0x15e662=require('fs');if(!_0x15e662[_0x2c788f(0x1f1)](_0x231529)){console['error'](_0x2c788f(0x19e)+_0x231529);return;}}const _0x11175a=await Ticket_1[_0x2c788f(0x182)][_0x2c788f(0x1c9)]({'where':{'id':_0x193425['id']},'include':[Contact_1[_0x2c788f(0x182)]]});if(!_0x11175a){console['error'](_0x2c788f(0x1bc)+_0x193425['id']+_0x2c788f(0x1f2));return;}await(0x0,SendWhatsAppMediaFlow_1['typeSimulation'])(_0x193425,_0x2c788f(0x1fb)),await(0x0,SendWhatsAppMediaFlow_1['default'])({'media':_0x231529,'ticket':_0x11175a,'isRecord':_0x3d03f4[_0x2c788f(0x1e4)]||![]}),await intervalWhats('1');}if(_0x444a41[_0x2c788f(0x1a5)](_0x2c788f(0x1be))){const _0x4d326d=_0x350de8[_0x2c788f(0x1d4)][_0x2c788f(0x18e)][_0x2c788f(0x19a)](_0x277894=>_0x277894[_0x2c788f(0x17d)]===_0x444a41);if(!_0x4d326d||!_0x4d326d['value']){console[_0x2c788f(0x19d)](_0x2c788f(0x1da)+_0x444a41);return;}let _0x34d856=_0x4d326d[_0x2c788f(0x185)];if(!_0x34d856[_0x2c788f(0x1b5)]('http://')&&!_0x34d856['startsWith'](_0x2c788f(0x1d3))){const _0xd4c566=process[_0x2c788f(0x16e)]['BACKEND_URL']==='https://localhost:8090'?''+__dirname[_0x2c788f(0x192)](_0x2c788f(0x1d2))[0x0][_0x2c788f(0x192)]('\x5c')['join']('/'):''+__dirname['split']('dist')[0x0][_0x2c788f(0x192)]('\x5c')[_0x2c788f(0x1f0)]('/');_0x34d856=_0xd4c566+'public/'+_0x4d326d['value'];const _0x5ca232=require('fs');if(!_0x5ca232['existsSync'](_0x34d856)){console['error'](_0x2c788f(0x1bf)+_0x34d856);return;}}const _0x48fe11=await Ticket_1[_0x2c788f(0x182)][_0x2c788f(0x1c9)]({'where':{'id':_0x193425['id']},'include':[Contact_1[_0x2c788f(0x182)]]});if(!_0x48fe11){console[_0x2c788f(0x19d)](_0x2c788f(0x1bc)+_0x193425['id']+_0x2c788f(0x1f2));return;}await(0x0,SendWhatsAppMediaFlow_1[_0x2c788f(0x1de)])(_0x193425,'composing'),await(0x0,SendWhatsAppMediaFlow_1[_0x2c788f(0x182)])({'media':_0x34d856,'ticket':_0x48fe11}),await intervalWhats('1');}}let _0x412c21;if(_0x350de8[_0x2c788f(0x1e9)]===_0x2c788f(0x1dd)){const _0x4e10bf=(0x0,randomizador_1[_0x2c788f(0x19b)])(_0x350de8[_0x2c788f(0x1d4)][_0x2c788f(0x178)]/0x64),_0x54a9a8=_0x7c1331['filter'](_0x3fa98f=>_0x3fa98f['source']===_0x350de8['id']);_0x4e10bf==='A'?(_0x19be76=_0x54a9a8[_0x2c788f(0x1e8)](_0x1e457e=>_0x1e457e[_0x2c788f(0x1ee)]==='a')[0x0][_0x2c788f(0x19c)],_0xb7b1de=!![]):(_0x19be76=_0x54a9a8[_0x2c788f(0x1e8)](_0x42d2f3=>_0x42d2f3[_0x2c788f(0x1ee)]==='b')[0x0][_0x2c788f(0x19c)],_0xb7b1de=!![]),_0x412c21=!![];}let _0xf308bb;if(_0x350de8[_0x2c788f(0x1e9)]==='menu'){console['log'](0x28a,'menu');if(_0x43e3cf){const _0x591a93=_0x350de8['id'];console[_0x2c788f(0x18a)](_0x2c788f(0x1c1)+_0x43e3cf+_0x2c788f(0x1e1)+_0x591a93);const _0x5b78ba=_0x2861f5[_0x2c788f(0x1e8)](_0x52a7ab=>_0x52a7ab['source']===_0x591a93),_0xa6e546=_0x5b78ba['filter'](_0x89a891=>_0x89a891[_0x2c788f(0x1ee)]==='a'+_0x43e3cf);console[_0x2c788f(0x18a)](_0x2c788f(0x1b1)+_0x5b78ba['length']+_0x2c788f(0x1f4)+_0x43e3cf+':\x20'+_0xa6e546['length']);_0xa6e546[_0x2c788f(0x18f)]>0x0?(_0x3e4fed=_0xa6e546[0x0][_0x2c788f(0x19c)],console[_0x2c788f(0x18a)](_0x2c788f(0x187)+_0x3e4fed)):_0x3e4fed=undefined;if(_0x3e4fed===undefined){console[_0x2c788f(0x18a)](_0x2c788f(0x193)+_0x43e3cf);if(_0x193425){const _0x4ff7a7=_0x350de8;if(_0x4ff7a7&&_0x4ff7a7[_0x2c788f(0x1e9)]===_0x2c788f(0x18b)){let _0x3b6f96='';_0x4ff7a7[_0x2c788f(0x1d4)][_0x2c788f(0x1e2)][_0x2c788f(0x172)](_0x72c5a8=>{const _0x345066=_0x2c788f;_0x3b6f96+='['+_0x72c5a8['number']+']\x20'+_0x72c5a8[_0x345066(0x185)]+'\x0a';});const _0x37b215='❌\x20Opção\x20inválida!\x0a\x0a'+_0x4ff7a7[_0x2c788f(0x1d4)][_0x2c788f(0x1a0)]+'\x0a\x0a'+_0x3b6f96,_0x30f522=await(0x0,ShowTicketService_1[_0x2c788f(0x182)])(_0x193425['id'],_0x29e97d);await(0x0,SendWhatsAppMessage_1[_0x2c788f(0x182)])({'body':_0x37b215,'ticket':_0x30f522,'quotedMsg':null}),(0x0,SetTicketMessagesAsRead_1[_0x2c788f(0x182)])(_0x30f522),await _0x30f522[_0x2c788f(0x179)]({'lastMessage':_0x37b215});}}break;}_0x43e3cf=_0x2c788f(0x181);const _0x2c6dba=_0x2d9300['filter'](_0x344683=>_0x344683['id']===_0x3e4fed);console['log'](0x2a2,'menu'),_0x2c6dba[_0x2c788f(0x18f)]>0x0?_0xf308bb=_0x2c6dba[0x0][_0x2c788f(0x1e9)]===_0x2c788f(0x18b)?!![]:![]:_0xf308bb=![];}else{console['log'](0x2a9,_0x2c788f(0x18b));let _0x24d036='';_0x350de8[_0x2c788f(0x1d4)][_0x2c788f(0x1e2)][_0x2c788f(0x172)](_0x1e3fe3=>{const _0x2111e1=_0x2c788f;_0x24d036+='['+_0x1e3fe3[_0x2111e1(0x17d)]+']\x20'+_0x1e3fe3[_0x2111e1(0x185)]+'\x0a';});const _0x279d94=_0x350de8[_0x2c788f(0x1d4)]['message']+'\x0a\x0a'+_0x24d036,_0x3cd106=_0x193425[_0x2c788f(0x1ad)];let _0x325955;_0x3cd106&&_0x3cd106[_0x2c788f(0x1ae)](_0x2c788f(0x190))?_0x325955={'body':replaceMessages(_0x3cd106,_0x279d94),'number':_0x5d5549,'companyId':_0x29e97d}:_0x325955={'body':_0x279d94,'number':_0x5d5549,'companyId':_0x29e97d};const _0x2794f9=await(0x0,ShowTicketService_1[_0x2c788f(0x182)])(_0x193425['id'],_0x29e97d),_0x8f2a4={'id':(0x0,randomCode_1[_0x2c788f(0x188)])(0x32),'ticketId':_0x193425['id'],'body':_0x325955[_0x2c788f(0x1f5)],'fromMe':!![],'read':!![]};await(0x0,SendWhatsAppMediaFlow_1[_0x2c788f(0x1de)])(_0x193425,'composing'),await(0x0,SendWhatsAppMessage_1[_0x2c788f(0x182)])({'body':_0x325955[_0x2c788f(0x1f5)],'ticket':_0x2794f9,'quotedMsg':null}),(0x0,SetTicketMessagesAsRead_1[_0x2c788f(0x182)])(_0x2794f9),await _0x2794f9[_0x2c788f(0x179)]({'lastMessage':(0x0,Mustache_1[_0x2c788f(0x182)])(_0x325955[_0x2c788f(0x1f5)],_0x193425)}),await intervalWhats('1');_0x193425?_0x193425=await Ticket_1[_0x2c788f(0x182)]['findOne']({'where':{'id':_0x193425['id'],'whatsappId':_0x57cb44,'companyId':_0x29e97d}}):_0x193425=await Ticket_1[_0x2c788f(0x182)]['findOne']({'where':{'id':_0x17ab4e,'whatsappId':_0x57cb44,'companyId':_0x29e97d}});_0x193425&&await _0x193425[_0x2c788f(0x179)]({'queueId':_0x193425[_0x2c788f(0x1ed)]?_0x193425[_0x2c788f(0x1ed)]:null,'userId':null,'companyId':_0x29e97d,'flowWebhook':!![],'lastFlowId':_0x350de8['id'],'dataWebhook':_0x1a1b80,'hashFlowId':_0x12fb9d,'flowStopped':_0x31deee['toString']()});break;}}let _0x30777e=![];if(_0x43e3cf===_0x2c788f(0x181)&&_0x3d59d0>0x0){console[_0x2c788f(0x18a)](0x24b,_0x2c788f(0x196)),_0x43e3cf=undefined;let _0x348416=_0x7c1331['filter'](_0x538761=>_0x538761[_0x2c788f(0x1f9)]===_0x3e4fed)[0x0];typeof _0x348416===_0x2c788f(0x1b3)?_0x19be76='':!_0xb7b1de&&(_0x19be76=_0x348416[_0x2c788f(0x19c)]);}else{let _0x3a1b46;if(_0xf308bb)_0x3a1b46={'target':_0x3e4fed},_0x30777e=!![],_0x43e3cf=undefined;else _0x412c21?(_0x412c21=![],_0x3a1b46=_0x19be76):_0x3a1b46=_0x7c1331[_0x2c788f(0x1e8)](_0x1759d5=>_0x1759d5[_0x2c788f(0x1f9)]===_0x19be76)[0x0];typeof _0x3a1b46==='undefined'?_0x19be76='':!_0xb7b1de&&(_0x19be76=_0x3a1b46[_0x2c788f(0x19c)]),console[_0x2c788f(0x18a)](0x26b,'ActionsWebhookService');}if(!_0x43e3cf&&!_0x30777e){const _0x5be57b=_0x7c1331[_0x2c788f(0x1e8)](_0x26200f=>_0x26200f[_0x2c788f(0x1f9)]===_0x350de8['id'])[_0x2c788f(0x18f)];console[_0x2c788f(0x18a)](0x272,_0x2c788f(0x1dc));if(_0x5be57b===0x0){console[_0x2c788f(0x18a)](0x28e,'ActionsWebhookService'),console[_0x2c788f(0x18a)]('Flow\x20finalizado.\x20Último\x20nó:\x20'+_0x350de8['id']),await Ticket_1[_0x2c788f(0x182)][_0x2c788f(0x1c9)]({'where':{'id':_0x17ab4e,'whatsappId':_0x57cb44,'companyId':_0x29e97d}}),await _0x193425[_0x2c788f(0x179)]({'lastFlowId':null,'hashFlowId':null,'flowWebhook':![],'flowStopped':null,'flowBuilderId':null,'dataWebhook':null,'chatbot':![]}),console[_0x2c788f(0x18a)](_0x2c788f(0x1d0)+_0x193425['id']+_0x2c788f(0x20d));break;}}_0x30777e=![];if(_0x19be76==='')break;console['log'](0x2a6,_0x2c788f(0x1dc)),console['log'](_0x2c788f(0x1d6)),_0x193425=await Ticket_1[_0x2c788f(0x182)][_0x2c788f(0x1c9)]({'where':{'id':_0x17ab4e,'whatsappId':_0x57cb44,'companyId':_0x29e97d}}),_0x193425['status']==='closed'&&_0x1d72b0['of'](String(_0x29e97d))[_0x2c788f(0x18c)](_0x2c788f(0x208)+_0x193425[_0x2c788f(0x1a8)]+'-ticket',{'action':'delete','ticketId':_0x193425['id']}),console[_0x2c788f(0x18a)](_0x2c788f(0x173)),await _0x193425[_0x2c788f(0x179)]({'whatsappId':_0x57cb44,'queueId':_0x193425?.[_0x2c788f(0x1ed)],'userId':null,'companyId':_0x29e97d,'flowWebhook':!![],'lastFlowId':_0x350de8['id'],'hashFlowId':_0x12fb9d,'flowStopped':_0x31deee[_0x2c788f(0x16d)]()}),_0xb7b1de=![],_0x3d59d0++;}return'ds';}catch(_0x58d2cc){logger_1[_0x2c788f(0x1ca)][_0x2c788f(0x19d)](_0x58d2cc);}};exports[a698_0x41e60e(0x1dc)]=ActionsWebhookService;const constructJsonLine=(_0x27db0a,_0x514ca3)=>{const _0x445cec=a698_0x41e60e;let _0x411a67=_0x514ca3;const _0x42b060=_0x27db0a[_0x445cec(0x192)]('.');if(_0x42b060['length']===0x1)return _0x411a67[_0x42b060[0x0]];for(const _0x3fa89e of _0x42b060){_0x411a67=_0x411a67[_0x3fa89e];}return _0x411a67;};function a698_0x5a5e(_0x27154d,_0x3d2ad7){const _0x140071=a698_0x9085();return a698_0x5a5e=function(_0x159605,_0x5aaa90){_0x159605=_0x159605-0x16d;let _0x908561=_0x140071[_0x159605];return _0x908561;},a698_0x5a5e(_0x27154d,_0x3d2ad7);}function removerNaoLetrasNumeros(_0x13c15f){const _0x28e78e=a698_0x41e60e;return _0x13c15f[_0x28e78e(0x197)](/[^a-zA-Z0-9]/g,'');}function a698_0x9085(){const _0x381cf0=['companyId','count','search','nome','composing','dataWebhook','hasOwnProperty','defineProperty','Sua\x20posição\x20na\x20fila:','Conexões\x20do\x20menu:\x20','whatsappId','undefined','contact','startsWith','pending','getOwnPropertyDescriptor','email','../../models/Ticket','../../utils/randomizador','../WbotServices/SendWhatsAppMessage','Ticket\x20','bluebird','video','Arquivo\x20de\x20vídeo\x20não\x20encontrado:\x20','closed','Validando\x20opção\x20','interval','ticket','__importDefault','../../utils/logger','seq','delay','(((.+)+)+)+$','findOne','logger','configurable','1736960ppAXPH','5031292zjHagj','typebotIntegration','__importStar','Ticket\x20#','275','src','https://','data','lastFlowId','UPDATE10...','keyValue','UPDATE2...','../../libs/wbot','Elemento\x20de\x20vídeo\x20não\x20encontrado:\x20','../TicketServices/ShowTicketService','ActionsWebhookService','randomizer','typeSimulation','4163205eaPESZ','http://','\x20no\x20menu\x20','arrayOption','parar','record','substring','sendQueuePositionMessage','../../libs/socket','filter','type','\x20(tipo:\x20','prototype','keysFull','queueId','sourceHandle','public/','join','existsSync','\x20não\x20encontrado','__esModule',',\x20com\x20handle\x20a','body','1785526JYBgzJ','label','../../helpers/SetTicketMessagesAsRead','source','12871752RIOcHH','recording','../QueueService/ShowQueueService','UPDATE6...','../../helpers/SendMessage','72heqkmQ','call','UPDATE7...','Retomando\x20do\x20último\x20nó:\x20','../../models/Setting','question','get','4233330zuAdqT','../TicketServices/FindOrCreateATicketTrakingService','company-','ActionWebhookService\x20|\x2053','55TchkPg','CONNECTED','../../utils/randomCode','\x20saiu\x20do\x20flow.\x20flowWebhook:\x20false','toString','env','status','Elemento\x20de\x20imagem\x20não\x20encontrado:\x20','name','map','UPDATE12...','typebot','__setModuleDefault','match','Nó\x20não\x20encontrado.\x20Encerrando\x20execução\x20do\x20fluxo.','percent','update','img','../TicketServices/CreateLogTicketService','UPDATE4...','number','../TypebotServices/typebotListener','dist','singleBlock','999','default','../WhatsappService/ShowWhatsAppService','userId','value','UPDATE3...','Opção\x20válida!\x20Próximo\x20nó:\x20','randomString','create','log','menu','emit','9rDXPms','elements','length','variables','https://localhost:8090','split','Opção\x20inválida\x20digitada\x20no\x20menu:\x20','../WbotServices/SendWhatsAppMedia','inputs','ActionsWebhookService\x20|\x20587','replace','queue','3fkdhyI','find','randomizarCaminho','target','error','Arquivo\x20de\x20áudio\x20não\x20encontrado:\x20','../../helpers/Mustache','message','70322qHXYOj','celular','enabled','audio','includes','sendQueuePosition','273'];a698_0x9085=function(){return _0x381cf0;};return a698_0x9085();}const intervalWhats=_0x24f880=>{const _0x774323=parseInt(_0x24f880)*0x3e8;return new Promise(_0x4f9b01=>setTimeout(_0x4f9b01,_0x774323));},replaceMessages=(_0x56548d,_0x4f45cf)=>{const _0xf34cf5=a698_0x41e60e;return _0x4f45cf[_0xf34cf5(0x197)](/{{\s*([^{}\s]+)\s*}}/g,(_0x332fc0,_0x46f701)=>_0x56548d[_0x46f701]||'');},replaceMessagesOld=(_0x1a9a4e,_0x258c92,_0x2878d9,_0x2723f3)=>{const _0x2fd34a=a698_0x41e60e,_0x521eb6=_0x1a9a4e[_0x2fd34a(0x176)](/\{([^}]+)\}/g);if(_0x2878d9){let _0x2d5b7b=_0x1a9a4e[_0x2fd34a(0x197)](/{+nome}+/,_0x2723f3[_0x2fd34a(0x1ab)]);return _0x2d5b7b=_0x2d5b7b[_0x2fd34a(0x197)](/{+numero}+/,_0x2723f3['numero']),_0x2d5b7b=_0x2d5b7b[_0x2fd34a(0x197)](/{+email}+/,_0x2723f3[_0x2fd34a(0x1b8)]),_0x2d5b7b;}if(_0x521eb6&&_0x521eb6[_0x2fd34a(0x1a5)](_0x2fd34a(0x195))){const _0x3090e5=_0x521eb6[_0x2fd34a(0x172)](_0x40d9f7=>_0x40d9f7[_0x2fd34a(0x197)](/\{|\}/g,''));let _0x337f62=_0x1a9a4e;return _0x3090e5['map'](_0x3b5eef=>{const _0x105bbb=_0x2fd34a,_0x2d3463=_0x258c92[_0x105bbb(0x195)][_0x105bbb(0x19a)](_0x2c6bde=>_0x2c6bde[_0x105bbb(0x1d7)]===_0x3b5eef),_0x9f6ad6=_0x258c92[_0x105bbb(0x1ec)][_0x105bbb(0x19a)](_0x315b33=>_0x315b33['endsWith']('.'+_0x2d3463[_0x105bbb(0x1d4)])),_0x3020cc=constructJsonLine(_0x9f6ad6,_0x2878d9);_0x337f62=_0x337f62[_0x105bbb(0x197)]('{'+_0x3b5eef+'}',_0x3020cc);}),_0x337f62;}else return _0x1a9a4e;};