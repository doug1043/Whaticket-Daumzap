'use strict';const a699_0x52d04d=a699_0x514f;(function(_0x180b7d,_0x3162bb){const _0x467583=a699_0x514f,_0x47c1f3=_0x180b7d();while(!![]){try{const _0x2aa8ac=-parseInt(_0x467583(0x1be))/0x1+-parseInt(_0x467583(0x18a))/0x2+-parseInt(_0x467583(0x19e))/0x3*(-parseInt(_0x467583(0x149))/0x4)+parseInt(_0x467583(0x180))/0x5*(-parseInt(_0x467583(0x135))/0x6)+-parseInt(_0x467583(0x13b))/0x7*(parseInt(_0x467583(0x171))/0x8)+parseInt(_0x467583(0x1c9))/0x9*(parseInt(_0x467583(0x1c0))/0xa)+-parseInt(_0x467583(0x185))/0xb*(-parseInt(_0x467583(0x17e))/0xc);if(_0x2aa8ac===_0x3162bb)break;else _0x47c1f3['push'](_0x47c1f3['shift']());}catch(_0xf88914){_0x47c1f3['push'](_0x47c1f3['shift']());}}}(a699_0x7dfa,0x83459));var __createBinding=this&&this[a699_0x52d04d(0x14d)]||(Object['create']?function(_0x233011,_0x3f9b3b,_0x19af04,_0x1137d2){const _0x1413ee=a699_0x52d04d;if(_0x1137d2===undefined)_0x1137d2=_0x19af04;var _0x34067f=Object[_0x1413ee(0x1b5)](_0x3f9b3b,_0x19af04);(!_0x34067f||(_0x1413ee(0x1c7)in _0x34067f?!_0x3f9b3b['__esModule']:_0x34067f['writable']||_0x34067f['configurable']))&&(_0x34067f={'enumerable':!![],'get':function(){return _0x3f9b3b[_0x19af04];}}),Object['defineProperty'](_0x233011,_0x1137d2,_0x34067f);}:function(_0x2a0969,_0x309701,_0x333dae,_0x5f4710){if(_0x5f4710===undefined)_0x5f4710=_0x333dae;_0x2a0969[_0x5f4710]=_0x309701[_0x333dae];}),__setModuleDefault=this&&this[a699_0x52d04d(0x17b)]||(Object[a699_0x52d04d(0x131)]?function(_0x5d7517,_0x1b2206){const _0xab7e02=a699_0x52d04d;Object[_0xab7e02(0x1ae)](_0x5d7517,_0xab7e02(0x176),{'enumerable':!![],'value':_0x1b2206});}:function(_0xe61cce,_0xa12693){const _0x1711e1=a699_0x52d04d;_0xe61cce[_0x1711e1(0x176)]=_0xa12693;}),__importStar=this&&this['__importStar']||(function(){const _0x38fc80=(function(){let _0x3ee39c=!![];return function(_0x126ff4,_0x229f94){const _0x2f5ec4=_0x3ee39c?function(){const _0x18d95b=a699_0x514f;if(_0x229f94){const _0x1c2f98=_0x229f94[_0x18d95b(0x165)](_0x126ff4,arguments);return _0x229f94=null,_0x1c2f98;}}:function(){};return _0x3ee39c=![],_0x2f5ec4;};}()),_0x2c2b2f=_0x38fc80(this,function(){const _0xd67851=a699_0x514f;return _0x2c2b2f[_0xd67851(0x14f)]()[_0xd67851(0x16f)]('(((.+)+)+)+$')[_0xd67851(0x14f)]()['constructor'](_0x2c2b2f)[_0xd67851(0x16f)]('(((.+)+)+)+$');});_0x2c2b2f();var _0x31a6bb=function(_0x307db7){return _0x31a6bb=Object['getOwnPropertyNames']||function(_0xc65efd){const _0x3941c5=a699_0x514f;var _0x3956bf=[];for(var _0x56e2f5 in _0xc65efd)if(Object['prototype'][_0x3941c5(0x1c4)][_0x3941c5(0x14a)](_0xc65efd,_0x56e2f5))_0x3956bf[_0x3956bf['length']]=_0x56e2f5;return _0x3956bf;},_0x31a6bb(_0x307db7);};return function(_0x242335){const _0x117c32=a699_0x514f;if(_0x242335&&_0x242335['__esModule'])return _0x242335;var _0x3f88bd={};if(_0x242335!=null){for(var _0x267522=_0x31a6bb(_0x242335),_0x35d6e5=0x0;_0x35d6e5<_0x267522[_0x117c32(0x19c)];_0x35d6e5++)if(_0x267522[_0x35d6e5]!=='default')__createBinding(_0x3f88bd,_0x242335,_0x267522[_0x35d6e5]);}return __setModuleDefault(_0x3f88bd,_0x242335),_0x3f88bd;};}()),__importDefault=this&&this['__importDefault']||function(_0x23c167){const _0x4798a6=a699_0x52d04d;return _0x23c167&&_0x23c167[_0x4798a6(0x133)]?_0x23c167:{'default':_0x23c167};};Object[a699_0x52d04d(0x1ae)](exports,a699_0x52d04d(0x133),{'value':!![]}),exports[a699_0x52d04d(0x1c6)]=void 0x0;const Contact_1=__importDefault(require('../../models/Contact')),SendMessage_1=require(a699_0x52d04d(0x1ab)),Ticket_1=__importDefault(require(a699_0x52d04d(0x1ca))),SendWhatsAppMedia_1=__importDefault(require(a699_0x52d04d(0x1a9))),SendWhatsAppMediaFlow_1=__importStar(require(a699_0x52d04d(0x197))),randomizador_1=require(a699_0x52d04d(0x1b0)),Mustache_1=__importDefault(require(a699_0x52d04d(0x16a))),SetTicketMessagesAsRead_1=__importDefault(require(a699_0x52d04d(0x14c))),SendWhatsAppMessage_1=__importDefault(require(a699_0x52d04d(0x191))),ShowTicketService_1=__importDefault(require(a699_0x52d04d(0x1b7))),randomCode_1=require(a699_0x52d04d(0x14b)),ShowQueueService_1=__importDefault(require(a699_0x52d04d(0x18f))),socket_1=require(a699_0x52d04d(0x1cb)),UpdateTicketService_1=__importDefault(require(a699_0x52d04d(0x161))),FindOrCreateATicketTrakingService_1=__importDefault(require(a699_0x52d04d(0x15e))),logger_1=require(a699_0x52d04d(0x1b3)),CreateLogTicketService_1=__importDefault(require(a699_0x52d04d(0x175))),Setting_1=__importDefault(require(a699_0x52d04d(0x1a8))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),bluebird_1=require(a699_0x52d04d(0x195)),typebotListener_1=__importDefault(require(a699_0x52d04d(0x19d))),wbot_1=require(a699_0x52d04d(0x183)),ActionsWebhookService=async(_0x3c98cc,_0x1db060,_0xe4cf6f,_0x4b6015,_0x2fe232,_0xbac7aa,_0x497adf,_0x14afd4,_0x3223d1,_0x69e76a,_0x191743,_0x3e9960='',_0x500d47)=>{const _0x579262=a699_0x52d04d;try{const _0x46928a=(0x0,socket_1[_0x579262(0x1a3)])();let _0x295f94=_0xbac7aa;console[_0x579262(0x199)](_0x579262(0x146),_0x1db060,_0xe4cf6f,_0x4b6015,_0x2fe232,_0xbac7aa,_0x497adf,_0x14afd4,_0x3223d1,_0x69e76a,_0x191743,_0x3e9960);let _0x50e3e1='';const _0x1951dd=_0x2fe232;if(_0x3e9960===''){const _0xae30cc=_0x14afd4['inputs']['find'](_0x3737fe=>_0x3737fe['keyValue']===_0x579262(0x187));_0xae30cc[_0x579262(0x1b1)][_0x579262(0x17d)](',')[_0x579262(0x1ba)](_0x3e0829=>{const _0x2f02c5=_0x579262,_0x542ca7=_0x14afd4[_0x2f02c5(0x17c)][_0x2f02c5(0x1a4)](_0x53c880=>_0x53c880===_0x3e0829);let _0x715718='';!_0x542ca7?_0x715718=_0x3e0829:_0x715718=constructJsonLine(_0x542ca7,_0x497adf),_0x50e3e1=_0x50e3e1+_0x715718;});}else _0x50e3e1=_0x3e9960[_0x579262(0x13a)];let _0x5adcd9='';if(_0x3e9960===''){const _0x289fcc=_0x14afd4[_0x579262(0x156)]['find'](_0xc4dfaf=>_0xc4dfaf[_0x579262(0x154)]===_0x579262(0x172));_0x289fcc[_0x579262(0x1b1)]['split'](',')[_0x579262(0x1ba)](_0xf24c10=>{const _0x37eabc=_0x579262,_0x48b8e7=_0x14afd4[_0x37eabc(0x17c)][_0x37eabc(0x1a4)](_0x52ab7b=>_0x52ab7b===_0xf24c10);let _0xb8c799='';!_0x48b8e7?_0xb8c799=_0xf24c10:_0xb8c799=constructJsonLine(_0x48b8e7,_0x497adf),_0x5adcd9=_0x5adcd9+_0xb8c799;});}else _0x5adcd9=_0x3e9960['number'];_0x5adcd9=removerNaoLetrasNumeros(_0x5adcd9);_0x5adcd9[_0x579262(0x1b8)](0x0,0x2)==='55'&&(parseInt(_0x5adcd9[_0x579262(0x1b8)](0x2,0x4))>=0x1f&&(_0x5adcd9[_0x579262(0x19c)]===0xd&&(_0x5adcd9=_0x5adcd9[_0x579262(0x1b8)](0x0,0x4)+_0x5adcd9[_0x579262(0x1b8)](0x5,0xd))));let _0x2cfd0f='';if(_0x3e9960===''){const _0xf4c1ba=_0x14afd4[_0x579262(0x156)][_0x579262(0x1a4)](_0x5e540f=>_0x5e540f[_0x579262(0x154)]===_0x579262(0x177));_0xf4c1ba[_0x579262(0x1b1)][_0x579262(0x17d)](',')['map'](_0x4daab0=>{const _0x28f20a=_0x579262,_0x1db7d2=_0x14afd4[_0x28f20a(0x17c)][_0x28f20a(0x1a4)](_0x4f859a=>_0x4f859a[_0x28f20a(0x17a)](_0x28f20a(0x177)));let _0x42b3d2='';!_0x1db7d2?_0x42b3d2=_0x4daab0:_0x42b3d2=constructJsonLine(_0x1db7d2,_0x497adf),_0x2cfd0f=_0x2cfd0f+_0x42b3d2;});}else _0x2cfd0f=_0x3e9960[_0x579262(0x177)];const _0x11ba83=_0x4b6015[_0x579262(0x19c)],_0x254f31=await(0x0,ShowWhatsAppService_1[_0x579262(0x176)])(_0x3c98cc,_0xe4cf6f);if(_0x254f31[_0x579262(0x1b4)]!=='CONNECTED')return;let _0x59da02=0x0,_0x1cb812='',_0x424cd6=null,_0x294944=![];_0x191743&&(_0x424cd6=await Ticket_1[_0x579262(0x176)][_0x579262(0x19f)]({'where':{'id':_0x191743,'whatsappId':_0x3c98cc,'companyId':_0xe4cf6f},'include':[_0x579262(0x14e),_0x579262(0x179)]}));for(var _0x344242=0x0;_0x344242<_0x11ba83;_0x344242++){let _0x20cf7e=undefined,_0x5930f6;if(_0x69e76a){console[_0x579262(0x199)](_0x579262(0x144));if(_0x69e76a==='parar'){console[_0x579262(0x199)]('UPDATE3...');_0x191743&&(console[_0x579262(0x199)](_0x579262(0x151)),_0x5930f6=await Ticket_1[_0x579262(0x176)][_0x579262(0x19f)]({'where':{'id':_0x191743,'whatsappId':_0x3c98cc}}),await _0x424cd6[_0x579262(0x139)]({'status':_0x579262(0x1b6)}));break;}if(_0x1cb812===''){console['log'](_0x579262(0x168));if(_0x424cd6&&_0x424cd6[_0x579262(0x15d)]){const _0x1eb52b=_0x4b6015[_0x579262(0x1a4)](_0x1e9084=>_0x1e9084['id']===_0x424cd6[_0x579262(0x15d)]);_0x1eb52b?(_0x20cf7e=_0x1eb52b,_0x1cb812=_0x1eb52b['id'],console[_0x579262(0x199)]('Retomando\x20do\x20último\x20nó:\x20'+_0x1cb812+'\x20(tipo:\x20'+_0x1eb52b[_0x579262(0x15b)]+')')):_0x20cf7e={'type':'menu'};}else _0x20cf7e={'type':_0x579262(0x1bf)};}else console[_0x579262(0x199)]('UPDATE6...'),_0x20cf7e=_0x4b6015['filter'](_0x3e3c7d=>_0x3e3c7d['id']===_0x1cb812)[0x0];}else{console[_0x579262(0x199)](_0x579262(0x18b));const _0x304b18=_0x4b6015[_0x579262(0x153)](_0x1762d9=>_0x1762d9['id']===_0x295f94)[0x0];_0x304b18&&(_0x20cf7e=_0x304b18);}if(!_0x20cf7e){console[_0x579262(0x199)](_0x579262(0x152));break;}if(_0x20cf7e[_0x579262(0x15b)]==='message'){let _0x5559cb;const _0x2a229f=_0x424cd6[_0x579262(0x189)];_0x2a229f&&_0x2a229f['hasOwnProperty'](_0x579262(0x1a0))?_0x5559cb={'body':replaceMessages(_0x2a229f,_0x20cf7e['data'][_0x579262(0x186)])}:_0x5559cb={'body':_0x20cf7e[_0x579262(0x1b1)][_0x579262(0x186)]},await(0x0,SendMessage_1[_0x579262(0x1ce)])(_0x254f31,{'number':_0x5adcd9,'body':_0x5559cb['body']}),await intervalWhats('1');}console['log'](_0x579262(0x140));if(_0x20cf7e[_0x579262(0x15b)]===_0x579262(0x174)){console[_0x579262(0x199)](_0x579262(0x193));const _0x5532d0=(0x0,wbot_1[_0x579262(0x1a1)])(_0x254f31['id']);await(0x0,typebotListener_1[_0x579262(0x176)])({'wbot':_0x5532d0,'msg':_0x500d47,'ticket':_0x424cd6,'typebot':_0x20cf7e[_0x579262(0x1b1)]['typebotIntegration']});}if(_0x20cf7e[_0x579262(0x15b)]===_0x579262(0x16b)){const _0x4022ad=_0x424cd6?.[_0x579262(0x189)],_0x3a37bc=_0x424cd6?.[_0x579262(0x189)]?.[_0x579262(0x1a0)];if(!_0x3a37bc||_0x3a37bc===undefined||_0x3a37bc===null){const {message:_0x428779}=_0x20cf7e['data'][_0x579262(0x17f)],_0x50b655=await(0x0,ShowTicketService_1[_0x579262(0x176)])(_0x424cd6['id'],_0xe4cf6f),_0x1bd6be=(0x0,Mustache_1[_0x579262(0x176)])(''+_0x428779,_0x424cd6);await(0x0,bluebird_1[_0x579262(0x138)])(0xbb8),await(0x0,SendWhatsAppMediaFlow_1[_0x579262(0x166)])(_0x424cd6,_0x579262(0x1bb)),await(0x0,SendWhatsAppMessage_1[_0x579262(0x176)])({'body':_0x1bd6be,'ticket':_0x50b655,'quotedMsg':null}),(0x0,SetTicketMessagesAsRead_1['default'])(_0x50b655),await _0x50b655[_0x579262(0x139)]({'lastMessage':_0x1bd6be}),await _0x424cd6[_0x579262(0x139)]({'userId':null,'companyId':_0xe4cf6f,'lastFlowId':_0x20cf7e['id'],'hashFlowId':_0x3223d1,'flowStopped':_0x1db060['toString']()});}break;}if(_0x20cf7e[_0x579262(0x15b)]===_0x579262(0x194)){const _0x8857c6=_0x20cf7e[_0x579262(0x1b1)]?.[_0x579262(0x1b1)]?.['id']||_0x20cf7e[_0x579262(0x1b1)]?.['id'],_0x2faf99=await(0x0,ShowQueueService_1[_0x579262(0x176)])(_0x8857c6,_0xe4cf6f);await _0x424cd6[_0x579262(0x139)]({'status':_0x579262(0x148),'queueId':_0x2faf99['id'],'userId':_0x424cd6[_0x579262(0x158)],'companyId':_0xe4cf6f,'flowWebhook':!![],'lastFlowId':_0x20cf7e['id'],'hashFlowId':_0x3223d1,'flowStopped':_0x1db060[_0x579262(0x14f)]()}),await(0x0,FindOrCreateATicketTrakingService_1[_0x579262(0x176)])({'ticketId':_0x424cd6['id'],'companyId':_0xe4cf6f,'whatsappId':_0x424cd6['whatsappId'],'userId':_0x424cd6['userId']}),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x579262(0x148),'queueId':_0x2faf99['id']},'ticketId':_0x424cd6['id'],'companyId':_0xe4cf6f}),await(0x0,CreateLogTicketService_1[_0x579262(0x176)])({'ticketId':_0x424cd6['id'],'type':_0x579262(0x179),'queueId':_0x2faf99['id']});const _0x3d4dda=await Setting_1[_0x579262(0x176)][_0x579262(0x19f)]({'where':{'companyId':_0xe4cf6f,'key':_0x579262(0x1a6)}}),_0x15bc4e=_0x3d4dda?.[_0x579262(0x198)]===_0x579262(0x136);if(_0x15bc4e){const _0x44ab9c=await Ticket_1[_0x579262(0x176)][_0x579262(0x134)]({'where':{'userId':null,'status':'pending','companyId':_0xe4cf6f,'queueId':_0x2faf99['id'],'whatsappId':_0x254f31['id'],'isGroup':![]}}),_0x5e6483=_0x44ab9c[_0x579262(0x147)]===0x0?0x1:_0x44ab9c['count'],_0x268b9d=await Setting_1[_0x579262(0x176)][_0x579262(0x19f)]({'where':{'companyId':_0xe4cf6f,'key':_0x579262(0x18d)}}),_0xc28b2e=(_0x268b9d?.[_0x579262(0x198)]||_0x579262(0x1ac))+'\x20*'+_0x5e6483+'*',_0x56d100=await(0x0,ShowTicketService_1['default'])(_0x424cd6['id'],_0xe4cf6f),_0x5cc47c=(0x0,Mustache_1[_0x579262(0x176)])(''+_0xc28b2e,_0x424cd6);await(0x0,bluebird_1[_0x579262(0x138)])(0xbb8),await(0x0,SendWhatsAppMediaFlow_1[_0x579262(0x166)])(_0x424cd6,_0x579262(0x1bb)),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x5cc47c,'ticket':_0x56d100,'quotedMsg':null}),(0x0,SetTicketMessagesAsRead_1['default'])(_0x56d100),await _0x56d100[_0x579262(0x139)]({'lastMessage':_0x5cc47c});}}if(_0x20cf7e[_0x579262(0x15b)]===_0x579262(0x150))for(var _0x42e355=0x0;_0x42e355<_0x20cf7e[_0x579262(0x1b1)][_0x579262(0x142)]['length'];_0x42e355++){const _0x3245d2=_0x20cf7e[_0x579262(0x1b1)][_0x579262(0x142)][_0x42e355];_0x424cd6=await Ticket_1['default'][_0x579262(0x19f)]({'where':{'id':_0x191743,'companyId':_0xe4cf6f}});if(_0x3245d2[_0x579262(0x137)](_0x579262(0x15a))){const _0x3bdbcf=_0x20cf7e[_0x579262(0x1b1)][_0x579262(0x192)][_0x579262(0x153)](_0x457bd9=>_0x457bd9[_0x579262(0x1c2)]===_0x3245d2)[0x0][_0x579262(0x198)],_0x41ae43=await(0x0,ShowTicketService_1[_0x579262(0x176)])(_0x191743,_0xe4cf6f);let _0xcaf194;const _0x3cd1e2=_0x424cd6['dataWebhook'];_0x3cd1e2&&_0x3cd1e2[_0x579262(0x1c4)]('variables')?_0xcaf194=replaceMessages(_0x3cd1e2[_0x579262(0x1a0)],_0x3bdbcf):_0xcaf194=_0x3bdbcf,await(0x0,bluebird_1['delay'])(0xbb8),await(0x0,SendWhatsAppMediaFlow_1[_0x579262(0x166)])(_0x424cd6,'composing'),await(0x0,SendWhatsAppMessage_1[_0x579262(0x176)])({'body':_0xcaf194,'ticket':_0x41ae43,'quotedMsg':null}),(0x0,SetTicketMessagesAsRead_1[_0x579262(0x176)])(_0x41ae43),await _0x41ae43[_0x579262(0x139)]({'lastMessage':(0x0,Mustache_1[_0x579262(0x176)])(_0x3bdbcf,_0x424cd6)}),await intervalWhats('1');}_0x3245d2[_0x579262(0x137)](_0x579262(0x1a7))&&await intervalWhats(_0x20cf7e['data'][_0x579262(0x192)]['filter'](_0x2b7b11=>_0x2b7b11[_0x579262(0x1c2)]===_0x3245d2)[0x0][_0x579262(0x198)]);if(_0x3245d2[_0x579262(0x137)](_0x579262(0x19a))){await(0x0,SendWhatsAppMediaFlow_1[_0x579262(0x166)])(_0x424cd6,_0x579262(0x1bb));const _0x43d752=_0x20cf7e[_0x579262(0x1b1)][_0x579262(0x192)][_0x579262(0x1a4)](_0x3321af=>_0x3321af[_0x579262(0x1c2)]===_0x3245d2);if(!_0x43d752||!_0x43d752[_0x579262(0x198)]){console[_0x579262(0x18e)](_0x579262(0x15f)+_0x3245d2);return;}let _0x58409a=_0x43d752['value'];if(!_0x58409a['startsWith']('http://')&&!_0x58409a['startsWith'](_0x579262(0x1c8))){const _0x2b1a40=process[_0x579262(0x13d)][_0x579262(0x1b2)]===_0x579262(0x182)?''+__dirname[_0x579262(0x17d)]('src')[0x0][_0x579262(0x17d)]('\x5c')[_0x579262(0x160)]('/'):''+__dirname[_0x579262(0x17d)](_0x579262(0x196))[0x0][_0x579262(0x17d)]('\x5c')[_0x579262(0x160)]('/');_0x58409a=_0x2b1a40+_0x579262(0x188)+_0x43d752['value'];const _0x5da273=require('fs');if(!_0x5da273[_0x579262(0x145)](_0x58409a)){console['error']('Arquivo\x20de\x20mídia\x20não\x20encontrado:\x20'+_0x58409a);return;}}const _0xf3d9d9=await Ticket_1[_0x579262(0x176)]['findOne']({'where':{'id':_0x424cd6['id']},'include':[Contact_1['default']]});if(!_0xf3d9d9){console[_0x579262(0x18e)](_0x579262(0x1bc)+_0x424cd6['id']+_0x579262(0x184));return;}await(0x0,SendWhatsAppMedia_1[_0x579262(0x176)])({'media':_0x58409a,'ticket':_0xf3d9d9}),await intervalWhats('1');}if(_0x3245d2[_0x579262(0x137)](_0x579262(0x159))){const _0x35630f=_0x20cf7e[_0x579262(0x1b1)][_0x579262(0x192)][_0x579262(0x1a4)](_0x3e2c07=>_0x3e2c07[_0x579262(0x1c2)]===_0x3245d2);if(!_0x35630f||!_0x35630f['value']){console[_0x579262(0x18e)](_0x579262(0x1bd)+_0x3245d2);return;}let _0x595b55=_0x35630f[_0x579262(0x198)];if(!_0x595b55[_0x579262(0x1a2)](_0x579262(0x141))&&!_0x595b55[_0x579262(0x1a2)](_0x579262(0x1c8))){const _0x335e99=process[_0x579262(0x13d)]['BACKEND_URL']==='https://localhost:8090'?''+__dirname[_0x579262(0x17d)](_0x579262(0x1b9))[0x0][_0x579262(0x17d)]('\x5c')[_0x579262(0x160)]('/'):''+__dirname[_0x579262(0x17d)]('dist')[0x0][_0x579262(0x17d)]('\x5c')[_0x579262(0x160)]('/');_0x595b55=_0x335e99+_0x579262(0x188)+_0x35630f[_0x579262(0x198)];const _0x5400c7=require('fs');if(!_0x5400c7['existsSync'](_0x595b55)){console[_0x579262(0x18e)](_0x579262(0x178)+_0x595b55);return;}}const _0x29eba8=await Ticket_1[_0x579262(0x176)][_0x579262(0x19f)]({'where':{'id':_0x424cd6['id']},'include':[Contact_1[_0x579262(0x176)]]});if(!_0x29eba8){console[_0x579262(0x18e)](_0x579262(0x1bc)+_0x424cd6['id']+'\x20não\x20encontrado');return;}await(0x0,SendWhatsAppMediaFlow_1[_0x579262(0x166)])(_0x424cd6,_0x579262(0x1af)),await(0x0,SendWhatsAppMediaFlow_1[_0x579262(0x176)])({'media':_0x595b55,'ticket':_0x29eba8,'isRecord':_0x35630f[_0x579262(0x155)]||![]}),await intervalWhats('1');}if(_0x3245d2['includes'](_0x579262(0x173))){const _0x2bd3aa=_0x20cf7e['data'][_0x579262(0x192)]['find'](_0x5c396b=>_0x5c396b[_0x579262(0x1c2)]===_0x3245d2);if(!_0x2bd3aa||!_0x2bd3aa[_0x579262(0x198)]){console[_0x579262(0x18e)]('Elemento\x20de\x20vídeo\x20não\x20encontrado:\x20'+_0x3245d2);return;}let _0xfd9534=_0x2bd3aa['value'];if(!_0xfd9534[_0x579262(0x1a2)]('http://')&&!_0xfd9534['startsWith'](_0x579262(0x1c8))){const _0x1150a5=process['env'][_0x579262(0x1b2)]===_0x579262(0x182)?''+__dirname[_0x579262(0x17d)]('src')[0x0]['split']('\x5c')['join']('/'):''+__dirname[_0x579262(0x17d)](_0x579262(0x196))[0x0][_0x579262(0x17d)]('\x5c')[_0x579262(0x160)]('/');_0xfd9534=_0x1150a5+_0x579262(0x188)+_0x2bd3aa[_0x579262(0x198)];const _0x1ba875=require('fs');if(!_0x1ba875[_0x579262(0x145)](_0xfd9534)){console[_0x579262(0x18e)]('Arquivo\x20de\x20vídeo\x20não\x20encontrado:\x20'+_0xfd9534);return;}}const _0x157d50=await Ticket_1[_0x579262(0x176)][_0x579262(0x19f)]({'where':{'id':_0x424cd6['id']},'include':[Contact_1[_0x579262(0x176)]]});if(!_0x157d50){console[_0x579262(0x18e)]('Ticket\x20'+_0x424cd6['id']+_0x579262(0x184));return;}await(0x0,SendWhatsAppMediaFlow_1[_0x579262(0x166)])(_0x424cd6,_0x579262(0x1bb)),await(0x0,SendWhatsAppMediaFlow_1[_0x579262(0x176)])({'media':_0xfd9534,'ticket':_0x157d50}),await intervalWhats('1');}}let _0x4f02b3;if(_0x20cf7e['type']==='randomizer'){const _0x5f45ad=(0x0,randomizador_1[_0x579262(0x13e)])(_0x20cf7e['data'][_0x579262(0x16e)]/0x64),_0x3f4e70=_0x2fe232[_0x579262(0x153)](_0x29a6c6=>_0x29a6c6[_0x579262(0x13f)]===_0x20cf7e['id']);_0x5f45ad==='A'?(_0x295f94=_0x3f4e70[_0x579262(0x153)](_0x403e9f=>_0x403e9f[_0x579262(0x169)]==='a')[0x0]['target'],_0x294944=!![]):(_0x295f94=_0x3f4e70[_0x579262(0x153)](_0x25fb7e=>_0x25fb7e[_0x579262(0x169)]==='b')[0x0][_0x579262(0x1ad)],_0x294944=!![]),_0x4f02b3=!![];}let _0x2815e2;if(_0x20cf7e[_0x579262(0x15b)]===_0x579262(0x1bf)){console[_0x579262(0x199)](0x28a,_0x579262(0x1bf));if(_0x69e76a){const _0x26862a=_0x20cf7e['id'];console[_0x579262(0x199)](_0x579262(0x143)+_0x69e76a+_0x579262(0x181)+_0x26862a);const _0x16b343=_0x1951dd['filter'](_0xb96846=>_0xb96846[_0x579262(0x13f)]===_0x26862a),_0x2cd878=_0x16b343[_0x579262(0x153)](_0xb6965e=>_0xb6965e[_0x579262(0x169)]==='a'+_0x69e76a);console[_0x579262(0x199)](_0x579262(0x1c5)+_0x16b343['length']+',\x20com\x20handle\x20a'+_0x69e76a+':\x20'+_0x2cd878[_0x579262(0x19c)]);_0x2cd878['length']>0x0?(_0x1cb812=_0x2cd878[0x0]['target'],console[_0x579262(0x199)](_0x579262(0x1aa)+_0x1cb812)):_0x1cb812=undefined;if(_0x1cb812===undefined){console[_0x579262(0x199)](_0x579262(0x164)+_0x69e76a);if(_0x424cd6){const _0x5432d3=_0x20cf7e;if(_0x5432d3&&_0x5432d3[_0x579262(0x15b)]===_0x579262(0x1bf)){let _0x13ab21='';_0x5432d3[_0x579262(0x1b1)]['arrayOption'][_0x579262(0x1ba)](_0x55b6ab=>{const _0xed5b6d=_0x579262;_0x13ab21+=_0x55b6ab[_0xed5b6d(0x1c2)]+'\x20-\x20'+_0x55b6ab[_0xed5b6d(0x198)]+'\x0a';});const _0x2fe2c7=_0x579262(0x167)+_0x5432d3['data'][_0x579262(0x15a)]+'\x0a\x0a'+_0x13ab21,_0x4b29d5=await(0x0,ShowTicketService_1['default'])(_0x424cd6['id'],_0xe4cf6f);await(0x0,SendWhatsAppMessage_1[_0x579262(0x176)])({'body':_0x2fe2c7,'ticket':_0x4b29d5,'quotedMsg':null}),(0x0,SetTicketMessagesAsRead_1[_0x579262(0x176)])(_0x4b29d5),await _0x4b29d5[_0x579262(0x139)]({'lastMessage':_0x2fe2c7});}}break;}_0x69e76a='999';const _0x32349a=_0x4b6015[_0x579262(0x153)](_0x37628b=>_0x37628b['id']===_0x1cb812);console['log'](0x2a2,_0x579262(0x1bf)),_0x32349a[_0x579262(0x19c)]>0x0?_0x2815e2=_0x32349a[0x0][_0x579262(0x15b)]==='menu'?!![]:![]:_0x2815e2=![];}else{console[_0x579262(0x199)](0x2a9,_0x579262(0x1bf));let _0x4e4727='';_0x20cf7e[_0x579262(0x1b1)][_0x579262(0x162)]['map'](_0x14c421=>{const _0x5175ca=_0x579262;_0x4e4727+=_0x14c421['number']+_0x5175ca(0x132)+_0x14c421[_0x5175ca(0x198)]+'\x0a';});const _0x407f4a=_0x20cf7e[_0x579262(0x1b1)]['message']+'\x0a\x0a'+_0x4e4727,_0x4d19a8=_0x424cd6[_0x579262(0x189)];let _0x4aeed0;_0x4d19a8&&_0x4d19a8[_0x579262(0x1c4)](_0x579262(0x1a0))?_0x4aeed0={'body':replaceMessages(_0x4d19a8,_0x407f4a),'number':_0x5adcd9,'companyId':_0xe4cf6f}:_0x4aeed0={'body':_0x407f4a,'number':_0x5adcd9,'companyId':_0xe4cf6f};const _0x1ea349=await(0x0,ShowTicketService_1['default'])(_0x424cd6['id'],_0xe4cf6f),_0x50051c={'id':(0x0,randomCode_1[_0x579262(0x1c3)])(0x32),'ticketId':_0x424cd6['id'],'body':_0x4aeed0[_0x579262(0x190)],'fromMe':!![],'read':!![]};await(0x0,SendWhatsAppMediaFlow_1[_0x579262(0x166)])(_0x424cd6,_0x579262(0x1bb)),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x4aeed0[_0x579262(0x190)],'ticket':_0x1ea349,'quotedMsg':null}),(0x0,SetTicketMessagesAsRead_1[_0x579262(0x176)])(_0x1ea349),await _0x1ea349['update']({'lastMessage':(0x0,Mustache_1[_0x579262(0x176)])(_0x4aeed0['body'],_0x424cd6)}),await intervalWhats('1');_0x424cd6?_0x424cd6=await Ticket_1[_0x579262(0x176)]['findOne']({'where':{'id':_0x424cd6['id'],'whatsappId':_0x3c98cc,'companyId':_0xe4cf6f}}):_0x424cd6=await Ticket_1['default']['findOne']({'where':{'id':_0x191743,'whatsappId':_0x3c98cc,'companyId':_0xe4cf6f}});_0x424cd6&&await _0x424cd6[_0x579262(0x139)]({'queueId':_0x424cd6[_0x579262(0x170)]?_0x424cd6['queueId']:null,'userId':null,'companyId':_0xe4cf6f,'flowWebhook':!![],'lastFlowId':_0x20cf7e['id'],'dataWebhook':_0x497adf,'hashFlowId':_0x3223d1,'flowStopped':_0x1db060[_0x579262(0x14f)]()});break;}}let _0x49c286=![];if(_0x69e76a===_0x579262(0x1a5)&&_0x59da02>0x0){console[_0x579262(0x199)](0x24b,_0x579262(0x13c)),_0x69e76a=undefined;let _0x4c0d4f=_0x2fe232[_0x579262(0x153)](_0x3e9d2d=>_0x3e9d2d[_0x579262(0x13f)]===_0x1cb812)[0x0];typeof _0x4c0d4f==='undefined'?_0x295f94='':!_0x294944&&(_0x295f94=_0x4c0d4f[_0x579262(0x1ad)]);}else{let _0xc64b4;if(_0x2815e2)_0xc64b4={'target':_0x1cb812},_0x49c286=!![],_0x69e76a=undefined;else _0x4f02b3?(_0x4f02b3=![],_0xc64b4=_0x295f94):_0xc64b4=_0x2fe232[_0x579262(0x153)](_0x4cf290=>_0x4cf290[_0x579262(0x13f)]===_0x295f94)[0x0];typeof _0xc64b4==='undefined'?_0x295f94='':!_0x294944&&(_0x295f94=_0xc64b4[_0x579262(0x1ad)]),console[_0x579262(0x199)](0x26b,_0x579262(0x1c6));}if(!_0x69e76a&&!_0x49c286){const _0x3b4c9f=_0x2fe232[_0x579262(0x153)](_0x45d21c=>_0x45d21c[_0x579262(0x13f)]===_0x20cf7e['id'])[_0x579262(0x19c)];console[_0x579262(0x199)](0x272,_0x579262(0x1c6));if(_0x3b4c9f===0x0){console[_0x579262(0x199)](0x28e,_0x579262(0x1c6)),console[_0x579262(0x199)]('Flow\x20finalizado.\x20Último\x20nó:\x20'+_0x20cf7e['id']),await Ticket_1[_0x579262(0x176)]['findOne']({'where':{'id':_0x191743,'whatsappId':_0x3c98cc,'companyId':_0xe4cf6f}}),await _0x424cd6['update']({'lastFlowId':null,'hashFlowId':null,'flowWebhook':![],'flowStopped':null,'flowBuilderId':null,'dataWebhook':null,'chatbot':![]}),console[_0x579262(0x199)](_0x579262(0x16d)+_0x424cd6['id']+_0x579262(0x163));break;}}_0x49c286=![];if(_0x295f94==='')break;console[_0x579262(0x199)](0x2a6,'ActionsWebhookService'),console['log'](_0x579262(0x16c)),_0x424cd6=await Ticket_1['default'][_0x579262(0x19f)]({'where':{'id':_0x191743,'whatsappId':_0x3c98cc,'companyId':_0xe4cf6f}}),_0x424cd6['status']==='closed'&&_0x46928a['of'](String(_0xe4cf6f))[_0x579262(0x15c)]('company-'+_0x424cd6[_0x579262(0x19b)]+'-ticket',{'action':_0x579262(0x1cc),'ticketId':_0x424cd6['id']}),console[_0x579262(0x199)](_0x579262(0x157)),await _0x424cd6[_0x579262(0x139)]({'whatsappId':_0x3c98cc,'queueId':_0x424cd6?.[_0x579262(0x170)],'userId':null,'companyId':_0xe4cf6f,'flowWebhook':!![],'lastFlowId':_0x20cf7e['id'],'hashFlowId':_0x3223d1,'flowStopped':_0x1db060[_0x579262(0x14f)]()}),_0x294944=![],_0x59da02++;}return'ds';}catch(_0x1cd112){logger_1['logger'][_0x579262(0x18e)](_0x1cd112);}};exports[a699_0x52d04d(0x1c6)]=ActionsWebhookService;const constructJsonLine=(_0x807a71,_0x2970c9)=>{const _0x2c3401=a699_0x52d04d;let _0x319bd6=_0x2970c9;const _0x12f933=_0x807a71[_0x2c3401(0x17d)]('.');if(_0x12f933[_0x2c3401(0x19c)]===0x1)return _0x319bd6[_0x12f933[0x0]];for(const _0x39eec8 of _0x12f933){_0x319bd6=_0x319bd6[_0x39eec8];}return _0x319bd6;};function a699_0x514f(_0x156300,_0x5a2c13){const _0x5c6c54=a699_0x7dfa();return a699_0x514f=function(_0x4116c9,_0x2cbd4e){_0x4116c9=_0x4116c9-0x131;let _0x7dfa79=_0x5c6c54[_0x4116c9];return _0x7dfa79;},a699_0x514f(_0x156300,_0x5a2c13);}function a699_0x7dfa(){const _0x313d2f=['split','9761544MrHdgE','typebotIntegration','255685mPFpaZ','\x20no\x20menu\x20','https://localhost:8090','../../libs/wbot','\x20não\x20encontrado','22XiBJEz','label','nome','public/','dataWebhook','1374884YhtHBB','UPDATE7...','numero','sendQueuePositionMessage','error','../QueueService/ShowQueueService','body','../WbotServices/SendWhatsAppMessage','elements','275','ticket','bluebird','dist','../WbotServices/SendWhatsAppMediaFlow','value','log','img','companyId','length','../TypebotServices/typebotListener','306vWtRum','findOne','variables','getWbot','startsWith','getIO','find','999','sendQueuePosition','interval','../../models/Setting','../WbotServices/SendWhatsAppMedia','Opção\x20válida!\x20Próximo\x20nó:\x20','../../helpers/SendMessage','Sua\x20posição\x20na\x20fila:','target','defineProperty','recording','../../utils/randomizador','data','BACKEND_URL','../../utils/logger','status','getOwnPropertyDescriptor','closed','../TicketServices/ShowTicketService','substring','src','map','composing','Ticket\x20','Elemento\x20de\x20áudio\x20não\x20encontrado:\x20','632850rURUfY','menu','76830AiLWIO','replace','number','randomString','hasOwnProperty','Conexões\x20do\x20menu:\x20','ActionsWebhookService','get','https://','351uTdxeJ','../../models/Ticket','../../libs/socket','delete','match','SendMessage','create','\x20-\x20','__esModule','findAndCountAll','6cIUtph','enabled','includes','delay','update','name','7nOTYmw','ActionsWebhookService\x20|\x20587','env','randomizarCaminho','source','273','http://','seq','Validando\x20opção\x20','UPDATE2...','existsSync','ActionWebhookService\x20|\x2053','count','pending','33128fXxXXn','call','../../utils/randomCode','../../helpers/SetTicketMessagesAsRead','__createBinding','contact','toString','singleBlock','UPDATE4...','Nó\x20não\x20encontrado.\x20Encerrando\x20execução\x20do\x20fluxo.','filter','keyValue','record','inputs','UPDATE12...','userId','audio','message','type','emit','lastFlowId','../TicketServices/FindOrCreateATicketTrakingService','Elemento\x20de\x20imagem\x20não\x20encontrado:\x20','join','../TicketServices/UpdateTicketService','arrayOption','\x20saiu\x20do\x20flow.\x20flowWebhook:\x20false','Opção\x20inválida\x20digitada\x20no\x20menu:\x20','apply','typeSimulation','❌\x20Opção\x20inválida!\x0a\x0a','UPDATE5...','sourceHandle','../../helpers/Mustache','question','UPDATE10...','Ticket\x20#','percent','search','queueId','6897656zVbQlv','celular','video','typebot','../TicketServices/CreateLogTicketService','default','email','Arquivo\x20de\x20áudio\x20não\x20encontrado:\x20','queue','endsWith','__setModuleDefault','keysFull'];a699_0x7dfa=function(){return _0x313d2f;};return a699_0x7dfa();}function removerNaoLetrasNumeros(_0x22abf7){const _0x4f5b5f=a699_0x52d04d;return _0x22abf7[_0x4f5b5f(0x1c1)](/[^a-zA-Z0-9]/g,'');}const intervalWhats=_0x2b2fa6=>{const _0x7b5ad6=parseInt(_0x2b2fa6)*0x3e8;return new Promise(_0x4941ff=>setTimeout(_0x4941ff,_0x7b5ad6));},replaceMessages=(_0x58b38e,_0x29d850)=>{const _0x50e5d4=a699_0x52d04d;return _0x29d850[_0x50e5d4(0x1c1)](/{{\s*([^{}\s]+)\s*}}/g,(_0x4ceac2,_0x4f1403)=>_0x58b38e[_0x4f1403]||'');},replaceMessagesOld=(_0x2d3d48,_0x172d39,_0x33178f,_0xf02376)=>{const _0x153908=a699_0x52d04d,_0x448b01=_0x2d3d48[_0x153908(0x1cd)](/\{([^}]+)\}/g);if(_0x33178f){let _0x536c19=_0x2d3d48[_0x153908(0x1c1)](/{+nome}+/,_0xf02376[_0x153908(0x187)]);return _0x536c19=_0x536c19['replace'](/{+numero}+/,_0xf02376[_0x153908(0x18c)]),_0x536c19=_0x536c19[_0x153908(0x1c1)](/{+email}+/,_0xf02376[_0x153908(0x177)]),_0x536c19;}if(_0x448b01&&_0x448b01['includes'](_0x153908(0x156))){const _0x4019db=_0x448b01[_0x153908(0x1ba)](_0x3d1e72=>_0x3d1e72[_0x153908(0x1c1)](/\{|\}/g,''));let _0x27b5da=_0x2d3d48;return _0x4019db['map'](_0x3885a9=>{const _0x2bade8=_0x153908,_0x369dac=_0x172d39[_0x2bade8(0x156)][_0x2bade8(0x1a4)](_0x31ce62=>_0x31ce62['keyValue']===_0x3885a9),_0x596043=_0x172d39[_0x2bade8(0x17c)][_0x2bade8(0x1a4)](_0x41db6e=>_0x41db6e[_0x2bade8(0x17a)]('.'+_0x369dac['data'])),_0xe40533=constructJsonLine(_0x596043,_0x33178f);_0x27b5da=_0x27b5da['replace']('{'+_0x3885a9+'}',_0xe40533);}),_0x27b5da;}else return _0x2d3d48;};