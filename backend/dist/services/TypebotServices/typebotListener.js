'use strict';const a563_0x31be70=a563_0x40ff;(function(_0x3aa266,_0x418a51){const _0x205559=a563_0x40ff,_0x2c4951=_0x3aa266();while(!![]){try{const _0x2f58ae=parseInt(_0x205559(0xab))/0x1+parseInt(_0x205559(0x9e))/0x2+-parseInt(_0x205559(0xec))/0x3+-parseInt(_0x205559(0xa1))/0x4*(-parseInt(_0x205559(0xda))/0x5)+parseInt(_0x205559(0xb0))/0x6+-parseInt(_0x205559(0xd3))/0x7*(parseInt(_0x205559(0xdb))/0x8)+parseInt(_0x205559(0xde))/0x9;if(_0x2f58ae===_0x418a51)break;else _0x2c4951['push'](_0x2c4951['shift']());}catch(_0x2341e3){_0x2c4951['push'](_0x2c4951['shift']());}}}(a563_0x12fa,0x5208f));function a563_0x40ff(_0x34915e,_0x328fcd){const _0x14f637=a563_0x12fa();return a563_0x40ff=function(_0x432938,_0x31b23d){_0x432938=_0x432938-0x70;let _0x12fa64=_0x14f637[_0x432938];return _0x12fa64;},a563_0x40ff(_0x34915e,_0x328fcd);}var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x4ff020,_0x2d6afe,_0x416673,_0xf48a82){const _0x3567f8=a563_0x40ff;if(_0xf48a82===undefined)_0xf48a82=_0x416673;var _0x48f810=Object[_0x3567f8(0xb3)](_0x2d6afe,_0x416673);(!_0x48f810||('get'in _0x48f810?!_0x2d6afe[_0x3567f8(0xf3)]:_0x48f810[_0x3567f8(0x90)]||_0x48f810[_0x3567f8(0x97)]))&&(_0x48f810={'enumerable':!![],'get':function(){return _0x2d6afe[_0x416673];}}),Object[_0x3567f8(0xe7)](_0x4ff020,_0xf48a82,_0x48f810);}:function(_0x45a9b8,_0x56f4ac,_0xbfb5a,_0x4d79e3){if(_0x4d79e3===undefined)_0x4d79e3=_0xbfb5a;_0x45a9b8[_0x4d79e3]=_0x56f4ac[_0xbfb5a];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a563_0x31be70(0xa5)]?function(_0x61ef2b,_0x1cf3cb){const _0x363897=a563_0x31be70;Object[_0x363897(0xe7)](_0x61ef2b,_0x363897(0xbf),{'enumerable':!![],'value':_0x1cf3cb});}:function(_0x5623be,_0x99ff7){const _0x1c3e2b=a563_0x31be70;_0x5623be[_0x1c3e2b(0xbf)]=_0x99ff7;}),__importStar=this&&this['__importStar']||(function(){const _0x5ac70b=(function(){let _0x5e77f0=!![];return function(_0x4a0821,_0x1dc327){const _0x237f60=_0x5e77f0?function(){const _0xf8722d=a563_0x40ff;if(_0x1dc327){const _0xefca85=_0x1dc327[_0xf8722d(0x9d)](_0x4a0821,arguments);return _0x1dc327=null,_0xefca85;}}:function(){};return _0x5e77f0=![],_0x237f60;};}()),_0x56ef82=_0x5ac70b(this,function(){const _0x261575=a563_0x40ff;return _0x56ef82[_0x261575(0xef)]()['search'](_0x261575(0xcd))[_0x261575(0xef)]()[_0x261575(0xbd)](_0x56ef82)['search'](_0x261575(0xcd));});_0x56ef82();var _0x1d4384=function(_0x280a2a){const _0x56a103=a563_0x40ff;return _0x1d4384=Object[_0x56a103(0x80)]||function(_0x5c6ac5){const _0x1af6c6=_0x56a103;var _0x312c08=[];for(var _0x5cd5b1 in _0x5c6ac5)if(Object['prototype'][_0x1af6c6(0x7b)][_0x1af6c6(0xd8)](_0x5c6ac5,_0x5cd5b1))_0x312c08[_0x312c08[_0x1af6c6(0xcf)]]=_0x5cd5b1;return _0x312c08;},_0x1d4384(_0x280a2a);};return function(_0x2a7432){const _0x528a6c=a563_0x40ff;if(_0x2a7432&&_0x2a7432['__esModule'])return _0x2a7432;var _0x4cff96={};if(_0x2a7432!=null){for(var _0x44ed3c=_0x1d4384(_0x2a7432),_0x31a26a=0x0;_0x31a26a<_0x44ed3c['length'];_0x31a26a++)if(_0x44ed3c[_0x31a26a]!==_0x528a6c(0xbf))__createBinding(_0x4cff96,_0x2a7432,_0x44ed3c[_0x31a26a]);}return __setModuleDefault(_0x4cff96,_0x2a7432),_0x4cff96;};}()),__importDefault=this&&this[a563_0x31be70(0xe4)]||function(_0x3c38ad){const _0x2c1a9c=a563_0x31be70;return _0x3c38ad&&_0x3c38ad[_0x2c1a9c(0xf3)]?_0x3c38ad:{'default':_0x3c38ad};};Object[a563_0x31be70(0xe7)](exports,'__esModule',{'value':!![]});function a563_0x12fa(){const _0x2ca6f4=['../WbotServices/SendWhatsAppMessage','__importDefault','stringify','remoteJid','defineProperty','[typebotListener]\x20Nova\x20sessão\x20criada:\x20','[typebotListener]\x20Enviando\x20mensagem\x20formatada:\x20\x22','image','Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','1085415aFiAgw','isNil','input','toString','stopBot','link','SendPresenceStatus','__esModule','companyId','[typebotListener]\x20Ticket\x20sem\x20sessão\x20ativa.\x20Criando\x20nova\x20sessão.','log','../../helpers/ExtractPhoneNumber','[typebotListener]\x20Processando\x20','[typebotListener]\x20Redirecionando\x20para\x20fila\x20','[typebotListener]\x20Executando\x20comando\x20stopBot','startsWith','../../helpers/SendPresenceStatus','queueId','../WbotServices/SendWhatsAppMedia','hasOwnProperty','request','[typebotListener]\x20Resposta\x20de\x20erro:\x20','updatedAt','messages','getOwnPropertyNames','document','url','Resposta\x20vazia\x20do\x20Typebot','[typebotListener]\x20Erro\x20ao\x20enviar\x20imagem:','[typebotListener]\x20Sessão\x20expirada\x20por\x20tempo\x20limite.\x20Resetando\x20sessão.','children','[typebotListener]\x20Erro\x20ao\x20continuar\x20chat:','richText','typebotSessionId','captureException','/api/v1/sessions/','[typebotListener]\x20Erro\x20ao\x20processar\x20gatilho\x20JSON:','logger','Erro\x20ao\x20criar\x20sessão\x20do\x20typebot','[typebotListener]\x20Processando\x20mensagem\x20de\x20texto:\x20','writable','fromMe','../../utils/logger','info','[typebotListener]\x20Nenhuma\x20mensagem\x20recebida.\x20Verificando\x20status\x20do\x20fluxo.','content','userId','configurable','[typebotListener]\x20Status\x20de\x20erro:\x20','[typebotListener]\x20Resposta\x20vazia\x20do\x20Typebot','[typebotListener]\x20Documento\x20enviado\x20com\x20sucesso.','[typebotListener]\x20Redirecionando\x20para\x20fila:\x20','data','apply','485658BrFlOJ','Sim','/continueChat','152kfuirD','@sentry/node','[typebotListener]\x20Erro\x20ao\x20enviar\x20áudio:','[typebotListener]\x20Verificando\x20expiração\x20da\x20sessão.\x20typebotExpires:\x20','create','[typebotListener]\x20Processando\x20mensagem\x20de\x20imagem:\x20','[typebotListener]\x20Continuando\x20conversa\x20com\x20a\x20mensagem:\x20\x22','status','[typebotListener]\x20Erro\x20geral:','pushName','157922LCNUKE','Mensagem\x20vazia','underline','/api/v1/typebots/','update','3085884PoympF','[typebotListener]\x20URL\x20da\x20requisição:\x20','atualizando\x20typebotStatus...','getOwnPropertyDescriptor','[typebotListener]\x20Imagem\x20enviada\x20com\x20sucesso.','[typebotListener]\x20Processando\x20comando\x20de\x20reinício','[typebotListener]\x20Fim\x20natural\x20do\x20fluxo\x20detectado.\x20Finalizando\x20sem\x20erro.','[typebotListener]\x20Mensagem\x20vazia\x20detectada,\x20usando\x20texto\x20padrão:\x20\x22','getBodyMessage','text','[typebotListener]\x20Processando\x20mensagem\x20de\x20documento:\x20','application/json','[typebotListener]\x20Mensagem\x20recebida:\x20\x22','constructor','Error\x20on\x20typebotListener','default','[typebotListener]\x20Sessão\x20criada\x20com\x20sucesso.\x20SessionID:\x20','status@broadcast','bold','type','response','Invalid\x20message.\x20Please,\x20try\x20again.','audio','error','getMinutes','[typebotListener]\x20Enviando\x20requisição\x20para\x20continuar\x20chat.\x20URL:\x20','italic','axios','reload','(((.+)+)+)+$','lodash','length','key','[typebotListener]\x20Criando\x20nova\x20sessão\x20para\x20o\x20número:\x20',',\x20updatedAt:\x20','892304PXoIyD','[typebotListener]\x20Mensagem\x20enviada\x20pelo\x20sistema.\x20Ignorando.','string','trim','[typebotListener]\x20Dados\x20da\x20requisição\x20para\x20criar\x20sessão:\x20','call',',\x20Dados:\x20','3215EZVvSr','24HPWFgH','[typebotListener]\x20Mensagens\x20recebidas:\x20','replace','1266633EKgVJF','../WbotServices/GetHandlers','Não','[typebotListener]\x20Processando\x20comando\x20de\x20finalização','[typebotListener]\x20Áudio\x20enviado\x20com\x20sucesso.'];a563_0x12fa=function(){return _0x2ca6f4;};return a563_0x12fa();}const axios_1=__importDefault(require(a563_0x31be70(0xcb))),GetHandlers_1=require(a563_0x31be70(0xdf)),logger_1=require(a563_0x31be70(0x92)),lodash_1=require(a563_0x31be70(0xce)),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),SendPresenceStatus_1=require(a563_0x31be70(0x78)),SendWhatsAppMedia_1=__importDefault(require(a563_0x31be70(0x7a))),Sentry=__importStar(require(a563_0x31be70(0xa2))),SendWhatsAppMessage_1=__importDefault(require(a563_0x31be70(0xe3))),ExtractPhoneNumber_1=require(a563_0x31be70(0x73)),typebotListener=async({wbot:_0x560824,msg:_0x1f1f98,ticket:_0x55e814,typebot:_0x3e9264})=>{const _0x49696f=a563_0x31be70;if(_0x1f1f98[_0x49696f(0xd0)][_0x49696f(0xe6)]===_0x49696f(0xc1))return;const {urlN8N:_0x2ae584,typebotExpires:_0x3271c6,typebotKeywordFinish:_0x435a1a,typebotKeywordRestart:_0x4dc5a2,typebotUnknownMessage:_0xef429b,typebotSlug:_0x54e856,typebotDelayMessage:_0x23611c,typebotRestartMessage:_0x13a182}=_0x3e9264;if(_0x1f1f98[_0x49696f(0xd0)][_0x49696f(0x91)]){console[_0x49696f(0x72)](_0x49696f(0xd4));return;}const _0x47e53e=(0x0,ExtractPhoneNumber_1['getPhoneNumberFromMessage'])(_0x1f1f98,_0x560824);let _0x396483=(0x0,GetHandlers_1[_0x49696f(0xb8)])(_0x1f1f98);console[_0x49696f(0x72)](_0x49696f(0xbc)+_0x396483+'\x22');async function _0x4348e6(_0x1917e9,_0x2e708f,_0x2b5c5f){const _0x5e09cd=_0x49696f;try{console[_0x5e09cd(0x72)](_0x5e09cd(0xd1)+_0x2b5c5f);const _0x409539=JSON[_0x5e09cd(0xe5)]({'isStreamEnabled':!![],'message':'string','resultId':_0x5e09cd(0xd5),'isOnlyRegistering':![],'prefilledVariables':{'number':_0x2b5c5f,'pushName':_0x1917e9[_0x5e09cd(0xaa)]||'','remoteJid':_0x55e814?.['contact']?.[_0x5e09cd(0xe6)]}});console[_0x5e09cd(0x72)](_0x5e09cd(0xd7)+_0x409539);const _0x3b900f={'method':'post','maxBodyLength':Infinity,'url':_0x2ae584+_0x5e09cd(0xae)+_0x54e856+'/startChat','headers':{'Content-Type':_0x5e09cd(0xbb),'Accept':_0x5e09cd(0xbb)},'data':_0x409539};console[_0x5e09cd(0x72)](_0x5e09cd(0xb1)+_0x3b900f[_0x5e09cd(0x82)]);const _0x6702f5=await axios_1[_0x5e09cd(0xbf)][_0x5e09cd(0x7c)](_0x3b900f);return console[_0x5e09cd(0x72)](_0x5e09cd(0xc0)+_0x6702f5[_0x5e09cd(0x9c)]?.['sessionId']),_0x6702f5[_0x5e09cd(0x9c)];}catch(_0x2041b4){console[_0x5e09cd(0xc7)]('[typebotListener]\x20Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:',_0x2041b4);_0x2041b4['response']&&(console[_0x5e09cd(0xc7)](_0x5e09cd(0x7d)+JSON[_0x5e09cd(0xe5)](_0x2041b4['response'][_0x5e09cd(0x9c)])),console[_0x5e09cd(0xc7)](_0x5e09cd(0x98)+_0x2041b4['response'][_0x5e09cd(0xa8)]));logger_1['logger'][_0x5e09cd(0x93)]({'error':_0x2041b4},_0x5e09cd(0x8e));throw _0x2041b4;}}let _0x2d532c,_0x5afdfb;try{const _0x588a09=new Date();_0x588a09['setMinutes'](_0x588a09[_0x49696f(0xc8)]()-Number(_0x3271c6)),console['log'](_0x49696f(0xa4)+_0x3271c6+_0x49696f(0xd2)+_0x55e814[_0x49696f(0x7e)]);_0x3271c6>0x0&&_0x55e814[_0x49696f(0x7e)]<_0x588a09&&(console[_0x49696f(0x72)](_0x49696f(0x85)),await _0x55e814[_0x49696f(0xaf)]({'typebotSessionId':null,'chatbot':!![]}),await _0x55e814[_0x49696f(0xcc)]());!_0x55e814[_0x49696f(0x89)]?(console[_0x49696f(0x72)](_0x49696f(0x71)),_0x5afdfb=await _0x4348e6(_0x1f1f98,_0x3e9264,_0x47e53e),_0x2d532c=_0x5afdfb['sessionId'],console[_0x49696f(0x72)](_0x49696f(0xe8)+_0x2d532c),await _0x55e814[_0x49696f(0xaf)]({'typebotSessionId':_0x2d532c,'useIntegration':!![],'integrationId':_0x3e9264['id'],'chatbot':!![]}),await _0x55e814[_0x49696f(0xcc)]()):(console['log']('[typebotListener]\x20Usando\x20sessão\x20existente:\x20'+_0x55e814[_0x49696f(0x89)]),_0x2d532c=_0x55e814[_0x49696f(0x89)],_0x5afdfb=undefined);if(_0x396483!==_0x435a1a&&_0x396483!==_0x4dc5a2){let _0x3eada7,_0xeabe87,_0x3257c4;if(_0x5afdfb?.[_0x49696f(0x7f)]?.['length']===0x0||_0x5afdfb===undefined){console[_0x49696f(0x72)](_0x49696f(0xa7)+_0x396483+'\x22');(!_0x396483||_0x396483[_0x49696f(0xd6)]()==='')&&(_0x396483=_0x49696f(0xac),console[_0x49696f(0x72)](_0x49696f(0xb7)+_0x396483+'\x22'));const _0x31d95b=JSON['stringify']({'message':_0x396483});let _0x535cb7={'method':'post','maxBodyLength':Infinity,'url':_0x2ae584+_0x49696f(0x8b)+_0x2d532c+_0x49696f(0xa0),'headers':{'Content-Type':'application/json','Accept':_0x49696f(0xbb)},'data':_0x31d95b};console['log'](_0x49696f(0xc9)+_0x535cb7[_0x49696f(0x82)]+_0x49696f(0xd9)+_0x31d95b);try{_0x3eada7=await axios_1[_0x49696f(0xbf)][_0x49696f(0x7c)](_0x535cb7),console[_0x49696f(0x72)]('[typebotListener]\x20Resposta\x20recebida\x20do\x20Typebot:\x20'+JSON['stringify'](_0x3eada7[_0x49696f(0x9c)]));if(!_0x3eada7[_0x49696f(0x9c)]){console['error'](_0x49696f(0x99));throw new Error(_0x49696f(0x83));}_0xeabe87=_0x3eada7[_0x49696f(0x9c)]?.['messages'],_0x3257c4=_0x3eada7[_0x49696f(0x9c)]?.[_0x49696f(0xee)],console[_0x49696f(0x72)](_0x49696f(0xdc)+(_0xeabe87?.[_0x49696f(0xcf)]||0x0)+',\x20Input\x20recebido:\x20'+(_0x3257c4?_0x49696f(0x9f):_0x49696f(0xe0))),!_0x3257c4&&(console[_0x49696f(0x72)](_0x49696f(0xb2)),await _0x55e814['update']({'typebotStatus':!![]}));}catch(_0x357980){console[_0x49696f(0xc7)](_0x49696f(0x87),_0x357980);_0x357980[_0x49696f(0xc4)]&&(console['error'](_0x49696f(0x7d)+JSON['stringify'](_0x357980['response'][_0x49696f(0x9c)])),console[_0x49696f(0xc7)](_0x49696f(0x98)+_0x357980[_0x49696f(0xc4)]['status']));await _0x55e814['update']({'typebotSessionId':null}),await(0x0,SendWhatsAppMessage_1[_0x49696f(0xbf)])({'body':'Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','ticket':_0x55e814});return;}}else console[_0x49696f(0x72)]('[typebotListener]\x20Usando\x20dados\x20da\x20sessão\x20recém-criada'),_0xeabe87=_0x5afdfb?.[_0x49696f(0x7f)],_0x3257c4=_0x5afdfb?.['input'];if(!_0xeabe87||_0xeabe87?.[_0x49696f(0xcf)]===0x0){console[_0x49696f(0x72)](_0x49696f(0x94));if(_0x3eada7&&_0x3eada7[_0x49696f(0x9c)]&&_0x3257c4===null){console[_0x49696f(0x72)](_0x49696f(0xb6)),await _0x55e814[_0x49696f(0xaf)]({'chatbot':![],'useIntegration':![]});return;}await(0x0,SendWhatsAppMessage_1[_0x49696f(0xbf)])({'body':_0xef429b,'ticket':_0x55e814});}else{console[_0x49696f(0x72)](_0x49696f(0x74)+_0xeabe87[_0x49696f(0xcf)]+'\x20mensagens');for(const _0xcb05d4 of _0xeabe87){if(_0xcb05d4['type']===_0x49696f(0xb9)){let _0x2e7565='',_0x4c1e59=![];console['log'](_0x49696f(0x8f)+JSON[_0x49696f(0xe5)](_0xcb05d4[_0x49696f(0x95)]));for(const _0x2be98b of _0xcb05d4[_0x49696f(0x95)][_0x49696f(0x88)]){for(const _0x4693a9 of _0x2be98b['children']){let _0x264b9b='';_0x4693a9[_0x49696f(0xb9)]&&(_0x264b9b=_0x4693a9[_0x49696f(0xb9)]);if(_0x4693a9[_0x49696f(0xc3)]&&_0x4693a9[_0x49696f(0x86)])for(const _0x146e56 of _0x4693a9[_0x49696f(0x86)]){let _0x3015ee='';_0x146e56['text']&&(_0x3015ee=_0x146e56['text']);if(_0x146e56[_0x49696f(0xc3)]&&_0x146e56['children'])for(const _0x4d8e10 of _0x146e56[_0x49696f(0x86)]){let _0x2d8c99='';_0x4d8e10['text']&&(_0x2d8c99=_0x4d8e10[_0x49696f(0xb9)]);_0x4d8e10[_0x49696f(0xc2)]&&(_0x2d8c99='*'+_0x2d8c99+'*');_0x4d8e10[_0x49696f(0xca)]&&(_0x2d8c99='_'+_0x2d8c99+'_');_0x4d8e10[_0x49696f(0xad)]&&(_0x2d8c99='~'+_0x2d8c99+'~');if(_0x4d8e10[_0x49696f(0x82)]){const _0x3e28fc=_0x4d8e10[_0x49696f(0x86)][0x0]?.[_0x49696f(0xb9)]||_0x49696f(0xf1);_0x2d8c99='['+_0x3e28fc+']('+_0x4d8e10['url']+')',_0x4c1e59=!![];}_0x2e7565+=_0x2d8c99;}_0x146e56[_0x49696f(0xc2)]&&(_0x3015ee='*'+_0x3015ee+'*');_0x146e56[_0x49696f(0xca)]&&(_0x3015ee='_'+_0x3015ee+'_');_0x146e56[_0x49696f(0xad)]&&(_0x3015ee='~'+_0x3015ee+'~');if(_0x146e56['url']){const _0x7e8ad8=_0x146e56[_0x49696f(0x86)][0x0]?.['text']||_0x49696f(0xf1);_0x3015ee='['+_0x7e8ad8+']('+_0x146e56[_0x49696f(0x82)]+')',_0x4c1e59=!![];}_0x2e7565+=_0x3015ee;}_0x4693a9[_0x49696f(0xc2)]&&(_0x264b9b='*'+_0x264b9b+'*');_0x4693a9['italic']&&(_0x264b9b='_'+_0x264b9b+'_');_0x4693a9[_0x49696f(0xad)]&&(_0x264b9b='~'+_0x264b9b+'~');if(_0x4693a9['url']){const _0x2dcd97=_0x4693a9['children'][0x0]?.[_0x49696f(0xb9)]||_0x49696f(0xf1);_0x264b9b='['+_0x2dcd97+']('+_0x4693a9[_0x49696f(0x82)]+')',_0x4c1e59=!![];}_0x2e7565+=_0x264b9b;}_0x2e7565+='\x0a';}_0x2e7565=_0x2e7565[_0x49696f(0xdd)]('**','')[_0x49696f(0xdd)](/\n$/,'');_0x2e7565===_0x49696f(0xc5)&&(_0x2e7565=_0xef429b);if(_0x2e7565[_0x49696f(0x77)]('#')){let _0x1055b2=_0x2e7565['replace']('#','');try{console[_0x49696f(0x72)]('[typebotListener]\x20Processando\x20gatilho\x20JSON:\x20'+_0x1055b2);let _0x30d2f8=JSON['parse'](_0x1055b2);if(_0x30d2f8[_0x49696f(0xf0)]&&(0x0,lodash_1[_0x49696f(0xed)])(_0x30d2f8[_0x49696f(0x96)])&&(0x0,lodash_1['isNil'])(_0x30d2f8['queueId'])){console['log'](_0x49696f(0x76)),await _0x55e814['update']({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1[_0x49696f(0xed)])(_0x30d2f8[_0x49696f(0x79)])&&_0x30d2f8[_0x49696f(0x79)]>0x0&&(0x0,lodash_1['isNil'])(_0x30d2f8[_0x49696f(0x96)])){console[_0x49696f(0x72)](_0x49696f(0x9b)+_0x30d2f8[_0x49696f(0x79)]),await(0x0,UpdateTicketService_1[_0x49696f(0xbf)])({'ticketData':{'queueId':_0x30d2f8['queueId'],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x55e814['id'],'companyId':_0x55e814[_0x49696f(0x70)]});return;}if(!(0x0,lodash_1[_0x49696f(0xed)])(_0x30d2f8[_0x49696f(0x79)])&&_0x30d2f8[_0x49696f(0x79)]>0x0&&!(0x0,lodash_1[_0x49696f(0xed)])(_0x30d2f8['userId'])&&_0x30d2f8[_0x49696f(0x96)]>0x0){console[_0x49696f(0x72)](_0x49696f(0x75)+_0x30d2f8['queueId']+'\x20e\x20usuário\x20'+_0x30d2f8[_0x49696f(0x96)]),await(0x0,UpdateTicketService_1[_0x49696f(0xbf)])({'ticketData':{'queueId':_0x30d2f8[_0x49696f(0x79)],'userId':_0x30d2f8[_0x49696f(0x96)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x55e814['id'],'companyId':_0x55e814[_0x49696f(0x70)]});return;}}catch(_0x47340f){console[_0x49696f(0xc7)](_0x49696f(0x8c),_0x47340f);throw _0x47340f;}}console[_0x49696f(0x72)](_0x49696f(0xe9)+_0x2e7565['substring'](0x0,0x32)+(_0x2e7565[_0x49696f(0xcf)]>0x32?'...':'')+'\x22'),await(0x0,SendPresenceStatus_1[_0x49696f(0xf2)])(_0x560824,_0x1f1f98[_0x49696f(0xd0)][_0x49696f(0xe6)],_0x23611c),await(0x0,SendWhatsAppMessage_1[_0x49696f(0xbf)])({'body':_0x2e7565,'ticket':_0x55e814});}if(_0xcb05d4['type']===_0x49696f(0xc6)){console['log']('[typebotListener]\x20Processando\x20mensagem\x20de\x20áudio:\x20'+_0xcb05d4[_0x49696f(0x95)][_0x49696f(0x82)]),await(0x0,SendPresenceStatus_1[_0x49696f(0xf2)])(_0x560824,_0x1f1f98[_0x49696f(0xd0)][_0x49696f(0xe6)],_0x23611c);try{await(0x0,SendWhatsAppMedia_1[_0x49696f(0xbf)])({'media':_0xcb05d4[_0x49696f(0x95)]['url'],'ticket':_0x55e814}),console[_0x49696f(0x72)](_0x49696f(0xe2));}catch(_0x1116b4){console[_0x49696f(0xc7)](_0x49696f(0xa3),_0x1116b4),Sentry['captureException'](_0x1116b4);throw _0x1116b4;}}if(_0xcb05d4[_0x49696f(0xc3)]===_0x49696f(0xea)){console[_0x49696f(0x72)](_0x49696f(0xa6)+_0xcb05d4[_0x49696f(0x95)][_0x49696f(0x82)]),await(0x0,SendPresenceStatus_1[_0x49696f(0xf2)])(_0x560824,_0x1f1f98['key'][_0x49696f(0xe6)],_0x23611c);try{await(0x0,SendWhatsAppMedia_1['default'])({'media':_0xcb05d4[_0x49696f(0x95)][_0x49696f(0x82)],'ticket':_0x55e814}),console[_0x49696f(0x72)](_0x49696f(0xb4));}catch(_0x9c55d7){console[_0x49696f(0xc7)](_0x49696f(0x84),_0x9c55d7),Sentry[_0x49696f(0x8a)](_0x9c55d7);throw _0x9c55d7;}}if(_0xcb05d4['type']===_0x49696f(0x81)){console[_0x49696f(0x72)](_0x49696f(0xba)+_0xcb05d4['content'][_0x49696f(0x82)]),await(0x0,SendPresenceStatus_1[_0x49696f(0xf2)])(_0x560824,_0x1f1f98['key'][_0x49696f(0xe6)],_0x23611c);try{await(0x0,SendWhatsAppMedia_1[_0x49696f(0xbf)])({'media':_0xcb05d4[_0x49696f(0x95)][_0x49696f(0x82)],'ticket':_0x55e814}),console[_0x49696f(0x72)](_0x49696f(0x9a));}catch(_0x2fc21a){console['error']('[typebotListener]\x20Erro\x20ao\x20enviar\x20documento:',_0x2fc21a),Sentry['captureException'](_0x2fc21a);throw _0x2fc21a;}}}}}_0x396483===_0x4dc5a2&&(console[_0x49696f(0x72)](_0x49696f(0xb5)),await _0x55e814['update']({'chatbot':!![],'typebotSessionId':null}),await _0x55e814[_0x49696f(0xcc)](),await(0x0,SendWhatsAppMessage_1[_0x49696f(0xbf)])({'body':_0x13a182,'ticket':_0x55e814}));if(_0x396483===_0x435a1a){console['log'](_0x49696f(0xe1)),await(0x0,UpdateTicketService_1[_0x49696f(0xbf)])({'ticketData':{'status':'closed','useIntegration':![],'integrationId':null},'ticketId':_0x55e814['id'],'companyId':_0x55e814[_0x49696f(0x70)]});return;}}catch(_0x2d329c){console[_0x49696f(0xc7)](_0x49696f(0xa9),_0x2d329c);_0x2d329c['response']&&(console['error'](_0x49696f(0x7d)+JSON[_0x49696f(0xe5)](_0x2d329c['response'][_0x49696f(0x9c)])),console[_0x49696f(0xc7)](_0x49696f(0x98)+_0x2d329c[_0x49696f(0xc4)][_0x49696f(0xa8)]));logger_1[_0x49696f(0x8d)][_0x49696f(0x93)]({'error':_0x2d329c},_0x49696f(0xbe)),await _0x55e814[_0x49696f(0xaf)]({'typebotSessionId':null});try{await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x49696f(0xeb),'ticket':_0x55e814});}catch(_0x4ff176){console['error']('[typebotListener]\x20Erro\x20ao\x20enviar\x20mensagem\x20de\x20erro:',_0x4ff176);}}};exports[a563_0x31be70(0xbf)]=typebotListener;