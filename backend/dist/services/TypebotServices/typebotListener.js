'use strict';const a673_0x169e90=a673_0x2f72;(function(_0x530ce3,_0x4cbcb3){const _0x4f39c4=a673_0x2f72,_0x4d902d=_0x530ce3();while(!![]){try{const _0x1b6c68=parseInt(_0x4f39c4(0x1af))/0x1+parseInt(_0x4f39c4(0x1a7))/0x2*(parseInt(_0x4f39c4(0x1c8))/0x3)+parseInt(_0x4f39c4(0x1d7))/0x4+parseInt(_0x4f39c4(0x1ba))/0x5*(-parseInt(_0x4f39c4(0x1be))/0x6)+parseInt(_0x4f39c4(0x1a1))/0x7*(-parseInt(_0x4f39c4(0x188))/0x8)+parseInt(_0x4f39c4(0x1c2))/0x9*(parseInt(_0x4f39c4(0x1ce))/0xa)+-parseInt(_0x4f39c4(0x18f))/0xb;if(_0x1b6c68===_0x4cbcb3)break;else _0x4d902d['push'](_0x4d902d['shift']());}catch(_0x36f5eb){_0x4d902d['push'](_0x4d902d['shift']());}}}(a673_0x2714,0x7f254));function a673_0x2714(){const _0x544c13=['prototype','status@broadcast','[typebotListener]\x20Erro\x20ao\x20enviar\x20mensagem\x20de\x20erro:','data','post','replace','getOwnPropertyNames','...','error','[typebotListener]\x20Executando\x20comando\x20stopBot','isNil','update','queueId','[typebotListener]\x20Dados\x20da\x20requisição\x20para\x20criar\x20sessão:\x20','Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','[typebotListener]\x20Processando\x20mensagem\x20de\x20documento:\x20','Não','[typebotListener]\x20Mensagem\x20recebida:\x20\x22','48GqrefM','[typebotListener]\x20Mensagem\x20vazia\x20detectada,\x20usando\x20texto\x20padrão:\x20\x22','Error\x20on\x20typebotListener',',\x20updatedAt:\x20','logger','link','[typebotListener]\x20Processando\x20mensagem\x20de\x20áudio:\x20','2638141VIDWdp','getPhoneNumberFromMessage','[typebotListener]\x20URL\x20da\x20requisição:\x20','toString','url','stringify','children','create','[typebotListener]\x20Erro\x20ao\x20enviar\x20imagem:','Mensagem\x20vazia','\x20e\x20usuário\x20','[typebotListener]\x20Redirecionando\x20para\x20fila\x20','log','updatedAt','[typebotListener]\x20Enviando\x20requisição\x20para\x20continuar\x20chat.\x20URL:\x20','../WbotServices/GetHandlers','audio',',\x20Dados:\x20','896518tuNRgN','[typebotListener]\x20Enviando\x20mensagem\x20formatada:\x20\x22','[typebotListener]\x20Processando\x20comando\x20de\x20finalização','response','reload','../WbotServices/SendWhatsAppMessage','5674SqFueI','trim','bold','../../helpers/ExtractPhoneNumber','[typebotListener]\x20Verificando\x20expiração\x20da\x20sessão.\x20typebotExpires:\x20','[typebotListener]\x20Fim\x20natural\x20do\x20fluxo\x20detectado.\x20Finalizando\x20sem\x20erro.','content','[typebotListener]\x20Resposta\x20vazia\x20do\x20Typebot','41894MXuHxx','underline','__importDefault','messages','call','remoteJid','apply','image','status','[typebotListener]\x20Erro\x20ao\x20continuar\x20chat:','document','4392680nywHJc','/api/v1/sessions/','axios','configurable','6xZAlXz','[typebotListener]\x20Mensagens\x20recebidas:\x20','../../utils/logger','get','10197jrosSc','[typebotListener]\x20Continuando\x20conversa\x20com\x20a\x20mensagem:\x20\x22','Invalid\x20message.\x20Please,\x20try\x20again.','info','[typebotListener]\x20Sessão\x20expirada\x20por\x20tempo\x20limite.\x20Resetando\x20sessão.','[typebotListener]\x20Usando\x20dados\x20da\x20sessão\x20recém-criada','873grDwhw','lodash','writable','[typebotListener]\x20Documento\x20enviado\x20com\x20sucesso.','companyId',',\x20Input\x20recebido:\x20','6190HEfbvA','key','captureException','@sentry/node','[typebotListener]\x20Erro\x20ao\x20enviar\x20documento:','[typebotListener]\x20Usando\x20sessão\x20existente:\x20','[typebotListener]\x20Processando\x20gatilho\x20JSON:\x20','defineProperty','Resposta\x20vazia\x20do\x20Typebot','3355244Ldyxyk','startsWith','userId','type','(((.+)+)+)+$','text','[typebotListener]\x20Nova\x20sessão\x20criada:\x20','/api/v1/typebots/','atualizando\x20typebotStatus...','[typebotListener]\x20Processando\x20mensagem\x20de\x20texto:\x20','stopBot','getMinutes','typebotSessionId','search','[typebotListener]\x20Resposta\x20recebida\x20do\x20Typebot:\x20','[typebotListener]\x20Nenhuma\x20mensagem\x20recebida.\x20Verificando\x20status\x20do\x20fluxo.','setMinutes','constructor','__esModule','[typebotListener]\x20Áudio\x20enviado\x20com\x20sucesso.','italic','__importStar','hasOwnProperty','default','input','length','[typebotListener]\x20Erro\x20ao\x20enviar\x20áudio:','[typebotListener]\x20Processando\x20mensagem\x20de\x20imagem:\x20','SendPresenceStatus','request','\x20mensagens','[typebotListener]\x20Erro\x20geral:','[typebotListener]\x20Processando\x20','[typebotListener]\x20Resposta\x20de\x20erro:\x20','[typebotListener]\x20Status\x20de\x20erro:\x20','__setModuleDefault','fromMe','application/json','__createBinding','[typebotListener]\x20Redirecionando\x20para\x20fila:\x20'];a673_0x2714=function(){return _0x544c13;};return a673_0x2714();}var __createBinding=this&&this[a673_0x169e90(0x174)]||(Object[a673_0x169e90(0x196)]?function(_0x3f6107,_0x553abd,_0x349de2,_0x1d724a){const _0x29c2b5=a673_0x169e90;if(_0x1d724a===undefined)_0x1d724a=_0x349de2;var _0x315a88=Object['getOwnPropertyDescriptor'](_0x553abd,_0x349de2);(!_0x315a88||(_0x29c2b5(0x1c1)in _0x315a88?!_0x553abd[_0x29c2b5(0x1e9)]:_0x315a88[_0x29c2b5(0x1ca)]||_0x315a88[_0x29c2b5(0x1bd)]))&&(_0x315a88={'enumerable':!![],'get':function(){return _0x553abd[_0x349de2];}}),Object[_0x29c2b5(0x1d5)](_0x3f6107,_0x1d724a,_0x315a88);}:function(_0x24a826,_0x350a46,_0x596461,_0x364642){if(_0x364642===undefined)_0x364642=_0x596461;_0x24a826[_0x364642]=_0x350a46[_0x596461];}),__setModuleDefault=this&&this[a673_0x169e90(0x171)]||(Object['create']?function(_0x51af72,_0x4f1e28){const _0x2d7c46=a673_0x169e90;Object[_0x2d7c46(0x1d5)](_0x51af72,_0x2d7c46(0x1ee),{'enumerable':!![],'value':_0x4f1e28});}:function(_0x5e1f94,_0xfdfa9f){const _0x4aa007=a673_0x169e90;_0x5e1f94[_0x4aa007(0x1ee)]=_0xfdfa9f;}),__importStar=this&&this[a673_0x169e90(0x1ec)]||(function(){const _0x43b35a=(function(){let _0x3e8a11=!![];return function(_0x3f1152,_0x128a61){const _0x6516b=_0x3e8a11?function(){const _0x5e6188=a673_0x2f72;if(_0x128a61){const _0x17f9c1=_0x128a61[_0x5e6188(0x1b5)](_0x3f1152,arguments);return _0x128a61=null,_0x17f9c1;}}:function(){};return _0x3e8a11=![],_0x6516b;};}()),_0x5f54a9=_0x43b35a(this,function(){const _0x2056b0=a673_0x2f72;return _0x5f54a9[_0x2056b0(0x192)]()[_0x2056b0(0x1e4)](_0x2056b0(0x1db))[_0x2056b0(0x192)]()[_0x2056b0(0x1e8)](_0x5f54a9)[_0x2056b0(0x1e4)](_0x2056b0(0x1db));});_0x5f54a9();var _0x5af5cf=function(_0x27b860){const _0x4f15d1=a673_0x2f72;return _0x5af5cf=Object[_0x4f15d1(0x17c)]||function(_0x47f50c){const _0x574711=_0x4f15d1;var _0x23e48e=[];for(var _0x259c3f in _0x47f50c)if(Object[_0x574711(0x176)][_0x574711(0x1ed)][_0x574711(0x1b3)](_0x47f50c,_0x259c3f))_0x23e48e[_0x23e48e[_0x574711(0x1f0)]]=_0x259c3f;return _0x23e48e;},_0x5af5cf(_0x27b860);};return function(_0x28cbf8){const _0x43af9c=a673_0x2f72;if(_0x28cbf8&&_0x28cbf8[_0x43af9c(0x1e9)])return _0x28cbf8;var _0x74f3f3={};if(_0x28cbf8!=null){for(var _0x3879d8=_0x5af5cf(_0x28cbf8),_0x1ac345=0x0;_0x1ac345<_0x3879d8[_0x43af9c(0x1f0)];_0x1ac345++)if(_0x3879d8[_0x1ac345]!==_0x43af9c(0x1ee))__createBinding(_0x74f3f3,_0x28cbf8,_0x3879d8[_0x1ac345]);}return __setModuleDefault(_0x74f3f3,_0x28cbf8),_0x74f3f3;};}()),__importDefault=this&&this[a673_0x169e90(0x1b1)]||function(_0x1011a8){const _0x45aaeb=a673_0x169e90;return _0x1011a8&&_0x1011a8[_0x45aaeb(0x1e9)]?_0x1011a8:{'default':_0x1011a8};};Object[a673_0x169e90(0x1d5)](exports,a673_0x169e90(0x1e9),{'value':!![]});const axios_1=__importDefault(require(a673_0x169e90(0x1bc))),GetHandlers_1=require(a673_0x169e90(0x19e)),logger_1=require(a673_0x169e90(0x1c0)),lodash_1=require(a673_0x169e90(0x1c9)),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus'),SendWhatsAppMedia_1=__importDefault(require('../WbotServices/SendWhatsAppMedia')),Sentry=__importStar(require(a673_0x169e90(0x1d1))),SendWhatsAppMessage_1=__importDefault(require(a673_0x169e90(0x1a6))),ExtractPhoneNumber_1=require(a673_0x169e90(0x1aa)),typebotListener=async({wbot:_0x358869,msg:_0x3ec87d,ticket:_0x2b22d6,typebot:_0x5dc45a})=>{const _0x206121=a673_0x169e90;if(_0x3ec87d[_0x206121(0x1cf)][_0x206121(0x1b4)]===_0x206121(0x177))return;const {urlN8N:_0x1db157,typebotExpires:_0x4126f3,typebotKeywordFinish:_0x6b40f0,typebotKeywordRestart:_0x2c28fa,typebotUnknownMessage:_0x483274,typebotSlug:_0x8fe41c,typebotDelayMessage:_0x3ff662,typebotRestartMessage:_0x3260a1}=_0x5dc45a;if(_0x3ec87d[_0x206121(0x1cf)][_0x206121(0x172)]){console[_0x206121(0x19b)]('[typebotListener]\x20Mensagem\x20enviada\x20pelo\x20sistema.\x20Ignorando.');return;}const _0x1237ea=(0x0,ExtractPhoneNumber_1[_0x206121(0x190)])(_0x3ec87d,_0x358869);let _0x35943d=(0x0,GetHandlers_1['getBodyMessage'])(_0x3ec87d);console[_0x206121(0x19b)](_0x206121(0x187)+_0x35943d+'\x22');async function _0x3ef21c(_0x2d6b9d,_0x3400b2,_0x3cecd6){const _0x2fd2c6=_0x206121;try{console[_0x2fd2c6(0x19b)]('[typebotListener]\x20Criando\x20nova\x20sessão\x20para\x20o\x20número:\x20'+_0x3cecd6);const _0x2e8aa1=JSON[_0x2fd2c6(0x194)]({'isStreamEnabled':!![],'message':'string','resultId':'string','isOnlyRegistering':![],'prefilledVariables':{'number':_0x3cecd6,'pushName':_0x2d6b9d['pushName']||'','remoteJid':_0x2b22d6?.['contact']?.['remoteJid']}});console[_0x2fd2c6(0x19b)](_0x2fd2c6(0x183)+_0x2e8aa1);const _0x3edb8c={'method':_0x2fd2c6(0x17a),'maxBodyLength':Infinity,'url':_0x1db157+_0x2fd2c6(0x1de)+_0x8fe41c+'/startChat','headers':{'Content-Type':_0x2fd2c6(0x173),'Accept':_0x2fd2c6(0x173)},'data':_0x2e8aa1};console[_0x2fd2c6(0x19b)](_0x2fd2c6(0x191)+_0x3edb8c['url']);const _0x4c942e=await axios_1[_0x2fd2c6(0x1ee)][_0x2fd2c6(0x1f4)](_0x3edb8c);return console['log']('[typebotListener]\x20Sessão\x20criada\x20com\x20sucesso.\x20SessionID:\x20'+_0x4c942e[_0x2fd2c6(0x179)]?.['sessionId']),_0x4c942e[_0x2fd2c6(0x179)];}catch(_0xab3dcb){console[_0x2fd2c6(0x17e)]('[typebotListener]\x20Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:',_0xab3dcb);_0xab3dcb[_0x2fd2c6(0x1a4)]&&(console['error']('[typebotListener]\x20Resposta\x20de\x20erro:\x20'+JSON[_0x2fd2c6(0x194)](_0xab3dcb[_0x2fd2c6(0x1a4)][_0x2fd2c6(0x179)])),console[_0x2fd2c6(0x17e)]('[typebotListener]\x20Status\x20de\x20erro:\x20'+_0xab3dcb['response'][_0x2fd2c6(0x1b7)]));logger_1[_0x2fd2c6(0x18c)][_0x2fd2c6(0x1c5)]({'error':_0xab3dcb},'Erro\x20ao\x20criar\x20sessão\x20do\x20typebot');throw _0xab3dcb;}}let _0xfc8b98,_0x3aa572;try{const _0x248f23=new Date();_0x248f23[_0x206121(0x1e7)](_0x248f23[_0x206121(0x1e2)]()-Number(_0x4126f3)),console[_0x206121(0x19b)](_0x206121(0x1ab)+_0x4126f3+_0x206121(0x18b)+_0x2b22d6[_0x206121(0x19c)]);_0x4126f3>0x0&&_0x2b22d6['updatedAt']<_0x248f23&&(console[_0x206121(0x19b)](_0x206121(0x1c6)),await _0x2b22d6[_0x206121(0x181)]({'typebotSessionId':null,'chatbot':!![]}),await _0x2b22d6[_0x206121(0x1a5)]());!_0x2b22d6['typebotSessionId']?(console['log']('[typebotListener]\x20Ticket\x20sem\x20sessão\x20ativa.\x20Criando\x20nova\x20sessão.'),_0x3aa572=await _0x3ef21c(_0x3ec87d,_0x5dc45a,_0x1237ea),_0xfc8b98=_0x3aa572['sessionId'],console[_0x206121(0x19b)](_0x206121(0x1dd)+_0xfc8b98),await _0x2b22d6['update']({'typebotSessionId':_0xfc8b98,'useIntegration':!![],'integrationId':_0x5dc45a['id'],'chatbot':!![]}),await _0x2b22d6[_0x206121(0x1a5)]()):(console[_0x206121(0x19b)](_0x206121(0x1d3)+_0x2b22d6[_0x206121(0x1e3)]),_0xfc8b98=_0x2b22d6[_0x206121(0x1e3)],_0x3aa572=undefined);if(_0x35943d!==_0x6b40f0&&_0x35943d!==_0x2c28fa){let _0x5384d7,_0x460c24,_0x1352f4;if(_0x3aa572?.['messages']?.[_0x206121(0x1f0)]===0x0||_0x3aa572===undefined){console[_0x206121(0x19b)](_0x206121(0x1c3)+_0x35943d+'\x22');(!_0x35943d||_0x35943d[_0x206121(0x1a8)]()==='')&&(_0x35943d=_0x206121(0x198),console[_0x206121(0x19b)](_0x206121(0x189)+_0x35943d+'\x22'));const _0x27029b=JSON[_0x206121(0x194)]({'message':_0x35943d});let _0x321dfa={'method':_0x206121(0x17a),'maxBodyLength':Infinity,'url':_0x1db157+_0x206121(0x1bb)+_0xfc8b98+'/continueChat','headers':{'Content-Type':_0x206121(0x173),'Accept':_0x206121(0x173)},'data':_0x27029b};console[_0x206121(0x19b)](_0x206121(0x19d)+_0x321dfa[_0x206121(0x193)]+_0x206121(0x1a0)+_0x27029b);try{_0x5384d7=await axios_1[_0x206121(0x1ee)][_0x206121(0x1f4)](_0x321dfa),console[_0x206121(0x19b)](_0x206121(0x1e5)+JSON['stringify'](_0x5384d7['data']));if(!_0x5384d7[_0x206121(0x179)]){console[_0x206121(0x17e)](_0x206121(0x1ae));throw new Error(_0x206121(0x1d6));}_0x460c24=_0x5384d7[_0x206121(0x179)]?.[_0x206121(0x1b2)],_0x1352f4=_0x5384d7[_0x206121(0x179)]?.[_0x206121(0x1ef)],console[_0x206121(0x19b)](_0x206121(0x1bf)+(_0x460c24?.[_0x206121(0x1f0)]||0x0)+_0x206121(0x1cd)+(_0x1352f4?'Sim':_0x206121(0x186))),!_0x1352f4&&(console['log'](_0x206121(0x1df)),await _0x2b22d6[_0x206121(0x181)]({'typebotStatus':!![]}));}catch(_0x2d6b4b){console[_0x206121(0x17e)](_0x206121(0x1b8),_0x2d6b4b);_0x2d6b4b[_0x206121(0x1a4)]&&(console[_0x206121(0x17e)](_0x206121(0x16f)+JSON['stringify'](_0x2d6b4b['response']['data'])),console[_0x206121(0x17e)]('[typebotListener]\x20Status\x20de\x20erro:\x20'+_0x2d6b4b[_0x206121(0x1a4)][_0x206121(0x1b7)]));await _0x2b22d6[_0x206121(0x181)]({'typebotSessionId':null}),await(0x0,SendWhatsAppMessage_1[_0x206121(0x1ee)])({'body':_0x206121(0x184),'ticket':_0x2b22d6});return;}}else console[_0x206121(0x19b)](_0x206121(0x1c7)),_0x460c24=_0x3aa572?.['messages'],_0x1352f4=_0x3aa572?.[_0x206121(0x1ef)];if(!_0x460c24||_0x460c24?.[_0x206121(0x1f0)]===0x0){console[_0x206121(0x19b)](_0x206121(0x1e6));if(_0x5384d7&&_0x5384d7[_0x206121(0x179)]&&_0x1352f4===null){console['log'](_0x206121(0x1ac)),await _0x2b22d6[_0x206121(0x181)]({'chatbot':![],'useIntegration':![]});return;}await(0x0,SendWhatsAppMessage_1[_0x206121(0x1ee)])({'body':_0x483274,'ticket':_0x2b22d6});}else{console[_0x206121(0x19b)](_0x206121(0x16e)+_0x460c24['length']+_0x206121(0x16c));for(const _0x282c64 of _0x460c24){if(_0x282c64['type']==='text'){let _0x52d6c9='',_0x2c695e=![];console[_0x206121(0x19b)](_0x206121(0x1e0)+JSON[_0x206121(0x194)](_0x282c64[_0x206121(0x1ad)]));for(const _0x62513e of _0x282c64[_0x206121(0x1ad)]['richText']){for(const _0x37e99d of _0x62513e['children']){let _0xc080c7='';_0x37e99d[_0x206121(0x1dc)]&&(_0xc080c7=_0x37e99d['text']);if(_0x37e99d[_0x206121(0x1da)]&&_0x37e99d[_0x206121(0x195)])for(const _0x4ad044 of _0x37e99d[_0x206121(0x195)]){let _0x53bdeb='';_0x4ad044[_0x206121(0x1dc)]&&(_0x53bdeb=_0x4ad044[_0x206121(0x1dc)]);if(_0x4ad044['type']&&_0x4ad044['children'])for(const _0x394319 of _0x4ad044[_0x206121(0x195)]){let _0x53796a='';_0x394319[_0x206121(0x1dc)]&&(_0x53796a=_0x394319[_0x206121(0x1dc)]);_0x394319[_0x206121(0x1a9)]&&(_0x53796a='*'+_0x53796a+'*');_0x394319['italic']&&(_0x53796a='_'+_0x53796a+'_');_0x394319[_0x206121(0x1b0)]&&(_0x53796a='~'+_0x53796a+'~');if(_0x394319[_0x206121(0x193)]){const _0x59091a=_0x394319[_0x206121(0x195)][0x0]?.['text']||_0x206121(0x18d);_0x53796a='['+_0x59091a+']('+_0x394319[_0x206121(0x193)]+')',_0x2c695e=!![];}_0x52d6c9+=_0x53796a;}_0x4ad044[_0x206121(0x1a9)]&&(_0x53bdeb='*'+_0x53bdeb+'*');_0x4ad044[_0x206121(0x1eb)]&&(_0x53bdeb='_'+_0x53bdeb+'_');_0x4ad044[_0x206121(0x1b0)]&&(_0x53bdeb='~'+_0x53bdeb+'~');if(_0x4ad044[_0x206121(0x193)]){const _0x1ad676=_0x4ad044[_0x206121(0x195)][0x0]?.[_0x206121(0x1dc)]||_0x206121(0x18d);_0x53bdeb='['+_0x1ad676+']('+_0x4ad044[_0x206121(0x193)]+')',_0x2c695e=!![];}_0x52d6c9+=_0x53bdeb;}_0x37e99d[_0x206121(0x1a9)]&&(_0xc080c7='*'+_0xc080c7+'*');_0x37e99d[_0x206121(0x1eb)]&&(_0xc080c7='_'+_0xc080c7+'_');_0x37e99d[_0x206121(0x1b0)]&&(_0xc080c7='~'+_0xc080c7+'~');if(_0x37e99d[_0x206121(0x193)]){const _0x21105e=_0x37e99d[_0x206121(0x195)][0x0]?.[_0x206121(0x1dc)]||'link';_0xc080c7='['+_0x21105e+']('+_0x37e99d[_0x206121(0x193)]+')',_0x2c695e=!![];}_0x52d6c9+=_0xc080c7;}_0x52d6c9+='\x0a';}_0x52d6c9=_0x52d6c9[_0x206121(0x17b)]('**','')['replace'](/\n$/,'');_0x52d6c9===_0x206121(0x1c4)&&(_0x52d6c9=_0x483274);if(_0x52d6c9[_0x206121(0x1d8)]('#')){let _0x34b7ce=_0x52d6c9[_0x206121(0x17b)]('#','');try{console['log'](_0x206121(0x1d4)+_0x34b7ce);let _0x3a00fe=JSON['parse'](_0x34b7ce);if(_0x3a00fe[_0x206121(0x1e1)]&&(0x0,lodash_1[_0x206121(0x180)])(_0x3a00fe[_0x206121(0x1d9)])&&(0x0,lodash_1[_0x206121(0x180)])(_0x3a00fe[_0x206121(0x182)])){console[_0x206121(0x19b)](_0x206121(0x17f)),await _0x2b22d6[_0x206121(0x181)]({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1[_0x206121(0x180)])(_0x3a00fe[_0x206121(0x182)])&&_0x3a00fe[_0x206121(0x182)]>0x0&&(0x0,lodash_1[_0x206121(0x180)])(_0x3a00fe[_0x206121(0x1d9)])){console[_0x206121(0x19b)](_0x206121(0x175)+_0x3a00fe[_0x206121(0x182)]),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x3a00fe[_0x206121(0x182)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x2b22d6['id'],'companyId':_0x2b22d6[_0x206121(0x1cc)]});return;}if(!(0x0,lodash_1[_0x206121(0x180)])(_0x3a00fe[_0x206121(0x182)])&&_0x3a00fe['queueId']>0x0&&!(0x0,lodash_1[_0x206121(0x180)])(_0x3a00fe[_0x206121(0x1d9)])&&_0x3a00fe[_0x206121(0x1d9)]>0x0){console['log'](_0x206121(0x19a)+_0x3a00fe[_0x206121(0x182)]+_0x206121(0x199)+_0x3a00fe[_0x206121(0x1d9)]),await(0x0,UpdateTicketService_1[_0x206121(0x1ee)])({'ticketData':{'queueId':_0x3a00fe['queueId'],'userId':_0x3a00fe[_0x206121(0x1d9)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x2b22d6['id'],'companyId':_0x2b22d6[_0x206121(0x1cc)]});return;}}catch(_0x37d0c9){console[_0x206121(0x17e)]('[typebotListener]\x20Erro\x20ao\x20processar\x20gatilho\x20JSON:',_0x37d0c9);throw _0x37d0c9;}}console[_0x206121(0x19b)](_0x206121(0x1a2)+_0x52d6c9['substring'](0x0,0x32)+(_0x52d6c9[_0x206121(0x1f0)]>0x32?_0x206121(0x17d):'')+'\x22'),await(0x0,SendPresenceStatus_1[_0x206121(0x1f3)])(_0x358869,_0x3ec87d[_0x206121(0x1cf)][_0x206121(0x1b4)],_0x3ff662),await(0x0,SendWhatsAppMessage_1[_0x206121(0x1ee)])({'body':_0x52d6c9,'ticket':_0x2b22d6});}if(_0x282c64[_0x206121(0x1da)]===_0x206121(0x19f)){console[_0x206121(0x19b)](_0x206121(0x18e)+_0x282c64[_0x206121(0x1ad)]['url']),await(0x0,SendPresenceStatus_1[_0x206121(0x1f3)])(_0x358869,_0x3ec87d[_0x206121(0x1cf)]['remoteJid'],_0x3ff662);try{await(0x0,SendWhatsAppMedia_1[_0x206121(0x1ee)])({'media':_0x282c64[_0x206121(0x1ad)][_0x206121(0x193)],'ticket':_0x2b22d6}),console['log'](_0x206121(0x1ea));}catch(_0x375cd8){console[_0x206121(0x17e)](_0x206121(0x1f1),_0x375cd8),Sentry[_0x206121(0x1d0)](_0x375cd8);throw _0x375cd8;}}if(_0x282c64['type']===_0x206121(0x1b6)){console['log'](_0x206121(0x1f2)+_0x282c64[_0x206121(0x1ad)][_0x206121(0x193)]),await(0x0,SendPresenceStatus_1[_0x206121(0x1f3)])(_0x358869,_0x3ec87d[_0x206121(0x1cf)]['remoteJid'],_0x3ff662);try{await(0x0,SendWhatsAppMedia_1[_0x206121(0x1ee)])({'media':_0x282c64[_0x206121(0x1ad)][_0x206121(0x193)],'ticket':_0x2b22d6}),console[_0x206121(0x19b)]('[typebotListener]\x20Imagem\x20enviada\x20com\x20sucesso.');}catch(_0x2941e5){console[_0x206121(0x17e)](_0x206121(0x197),_0x2941e5),Sentry[_0x206121(0x1d0)](_0x2941e5);throw _0x2941e5;}}if(_0x282c64[_0x206121(0x1da)]===_0x206121(0x1b9)){console[_0x206121(0x19b)](_0x206121(0x185)+_0x282c64[_0x206121(0x1ad)]['url']),await(0x0,SendPresenceStatus_1[_0x206121(0x1f3)])(_0x358869,_0x3ec87d[_0x206121(0x1cf)]['remoteJid'],_0x3ff662);try{await(0x0,SendWhatsAppMedia_1[_0x206121(0x1ee)])({'media':_0x282c64[_0x206121(0x1ad)][_0x206121(0x193)],'ticket':_0x2b22d6}),console[_0x206121(0x19b)](_0x206121(0x1cb));}catch(_0x84abf8){console['error'](_0x206121(0x1d2),_0x84abf8),Sentry[_0x206121(0x1d0)](_0x84abf8);throw _0x84abf8;}}}}}_0x35943d===_0x2c28fa&&(console['log']('[typebotListener]\x20Processando\x20comando\x20de\x20reinício'),await _0x2b22d6['update']({'chatbot':!![],'typebotSessionId':null}),await _0x2b22d6[_0x206121(0x1a5)](),await(0x0,SendWhatsAppMessage_1[_0x206121(0x1ee)])({'body':_0x3260a1,'ticket':_0x2b22d6}));if(_0x35943d===_0x6b40f0){console[_0x206121(0x19b)](_0x206121(0x1a3)),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':'closed','useIntegration':![],'integrationId':null},'ticketId':_0x2b22d6['id'],'companyId':_0x2b22d6[_0x206121(0x1cc)]});return;}}catch(_0xcc4905){console[_0x206121(0x17e)](_0x206121(0x16d),_0xcc4905);_0xcc4905[_0x206121(0x1a4)]&&(console['error'](_0x206121(0x16f)+JSON[_0x206121(0x194)](_0xcc4905[_0x206121(0x1a4)][_0x206121(0x179)])),console['error'](_0x206121(0x170)+_0xcc4905[_0x206121(0x1a4)][_0x206121(0x1b7)]));logger_1['logger']['info']({'error':_0xcc4905},_0x206121(0x18a)),await _0x2b22d6[_0x206121(0x181)]({'typebotSessionId':null});try{await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x206121(0x184),'ticket':_0x2b22d6});}catch(_0x41b868){console[_0x206121(0x17e)](_0x206121(0x178),_0x41b868);}}};function a673_0x2f72(_0xbe6b10,_0x33c74d){const _0x113543=a673_0x2714();return a673_0x2f72=function(_0x6b54,_0x4e3bf6){_0x6b54=_0x6b54-0x16c;let _0x271479=_0x113543[_0x6b54];return _0x271479;},a673_0x2f72(_0xbe6b10,_0x33c74d);}exports['default']=typebotListener;