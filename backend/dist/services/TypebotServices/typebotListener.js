'use strict';const a560_0x1a134d=a560_0x4ac1;(function(_0x319dba,_0x1c12d6){const _0x3ac082=a560_0x4ac1,_0x24221d=_0x319dba();while(!![]){try{const _0x1d725d=parseInt(_0x3ac082(0x251))/0x1*(parseInt(_0x3ac082(0x202))/0x2)+-parseInt(_0x3ac082(0x242))/0x3+parseInt(_0x3ac082(0x1d9))/0x4*(parseInt(_0x3ac082(0x1df))/0x5)+-parseInt(_0x3ac082(0x1dc))/0x6+parseInt(_0x3ac082(0x20c))/0x7*(-parseInt(_0x3ac082(0x23e))/0x8)+-parseInt(_0x3ac082(0x23a))/0x9+parseInt(_0x3ac082(0x236))/0xa;if(_0x1d725d===_0x1c12d6)break;else _0x24221d['push'](_0x24221d['shift']());}catch(_0x4c5c9b){_0x24221d['push'](_0x24221d['shift']());}}}(a560_0x4797,0x1df32));var __createBinding=this&&this[a560_0x1a134d(0x23f)]||(Object['create']?function(_0x2e1595,_0x51b5c8,_0x4333a8,_0x5f2c4c){const _0x10aed5=a560_0x1a134d;if(_0x5f2c4c===undefined)_0x5f2c4c=_0x4333a8;var _0x50fe2d=Object['getOwnPropertyDescriptor'](_0x51b5c8,_0x4333a8);(!_0x50fe2d||(_0x10aed5(0x1ed)in _0x50fe2d?!_0x51b5c8[_0x10aed5(0x1dd)]:_0x50fe2d[_0x10aed5(0x214)]||_0x50fe2d[_0x10aed5(0x1ee)]))&&(_0x50fe2d={'enumerable':!![],'get':function(){return _0x51b5c8[_0x4333a8];}}),Object[_0x10aed5(0x1fa)](_0x2e1595,_0x5f2c4c,_0x50fe2d);}:function(_0x56499c,_0x1eb50f,_0x1c2c3f,_0x390b34){if(_0x390b34===undefined)_0x390b34=_0x1c2c3f;_0x56499c[_0x390b34]=_0x1eb50f[_0x1c2c3f];}),__setModuleDefault=this&&this[a560_0x1a134d(0x22c)]||(Object[a560_0x1a134d(0x20f)]?function(_0x510038,_0x5c78cd){const _0x1dba25=a560_0x1a134d;Object[_0x1dba25(0x1fa)](_0x510038,_0x1dba25(0x226),{'enumerable':!![],'value':_0x5c78cd});}:function(_0x259537,_0x4dc964){const _0x25b81c=a560_0x1a134d;_0x259537[_0x25b81c(0x226)]=_0x4dc964;}),__importStar=this&&this[a560_0x1a134d(0x20e)]||(function(){const _0x3b6913=(function(){let _0x3b706e=!![];return function(_0x36abc9,_0x589384){const _0x115bb9=_0x3b706e?function(){const _0x5cce3e=a560_0x4ac1;if(_0x589384){const _0x5ce1d1=_0x589384[_0x5cce3e(0x208)](_0x36abc9,arguments);return _0x589384=null,_0x5ce1d1;}}:function(){};return _0x3b706e=![],_0x115bb9;};}()),_0x4bdd7e=_0x3b6913(this,function(){const _0x19c353=a560_0x4ac1;return _0x4bdd7e['toString']()[_0x19c353(0x1e5)](_0x19c353(0x200))[_0x19c353(0x1f4)]()[_0x19c353(0x22e)](_0x4bdd7e)[_0x19c353(0x1e5)](_0x19c353(0x200));});_0x4bdd7e();var _0x2e8ced=function(_0x50e273){const _0x170111=a560_0x4ac1;return _0x2e8ced=Object[_0x170111(0x1d7)]||function(_0x2a8f36){const _0x59f1ff=_0x170111;var _0x345c85=[];for(var _0x432ac0 in _0x2a8f36)if(Object[_0x59f1ff(0x1f6)][_0x59f1ff(0x209)][_0x59f1ff(0x215)](_0x2a8f36,_0x432ac0))_0x345c85[_0x345c85['length']]=_0x432ac0;return _0x345c85;},_0x2e8ced(_0x50e273);};return function(_0xa5157){const _0x1a6ec5=a560_0x4ac1;if(_0xa5157&&_0xa5157[_0x1a6ec5(0x1dd)])return _0xa5157;var _0x4fffba={};if(_0xa5157!=null){for(var _0x380be3=_0x2e8ced(_0xa5157),_0x37e41a=0x0;_0x37e41a<_0x380be3['length'];_0x37e41a++)if(_0x380be3[_0x37e41a]!==_0x1a6ec5(0x226))__createBinding(_0x4fffba,_0xa5157,_0x380be3[_0x37e41a]);}return __setModuleDefault(_0x4fffba,_0xa5157),_0x4fffba;};}()),__importDefault=this&&this['__importDefault']||function(_0x20dfa3){const _0x112f60=a560_0x1a134d;return _0x20dfa3&&_0x20dfa3[_0x112f60(0x1dd)]?_0x20dfa3:{'default':_0x20dfa3};};Object[a560_0x1a134d(0x1fa)](exports,a560_0x1a134d(0x1dd),{'value':!![]});function a560_0x4ac1(_0x56bccc,_0x4c0992){const _0x3efba0=a560_0x4797();return a560_0x4ac1=function(_0x2719e0,_0x1f08b6){_0x2719e0=_0x2719e0-0x1d3;let _0x4797fe=_0x3efba0[_0x2719e0];return _0x4797fe;},a560_0x4ac1(_0x56bccc,_0x4c0992);}function a560_0x4797(){const _0x409ff6=['[typebotListener]\x20Áudio\x20enviado\x20com\x20sucesso.','[typebotListener]\x20Documento\x20enviado\x20com\x20sucesso.','getOwnPropertyNames','length','16088BnEpHT','typebotSessionId','/api/v1/typebots/','1132944HjGzRP','__esModule','[typebotListener]\x20Erro\x20ao\x20continuar\x20chat:','270TvpDte',',\x20Input\x20recebido:\x20','string','text','../../helpers/SendPresenceStatus','[typebotListener]\x20Fim\x20natural\x20do\x20fluxo\x20detectado.\x20Finalizando\x20sem\x20erro.','search','[typebotListener]\x20Processando\x20comando\x20de\x20reinício','status@broadcast','[typebotListener]\x20Processando\x20gatilho\x20JSON:\x20','Sim','replace','info','queueId','get','configurable','userId','[typebotListener]\x20Redirecionando\x20para\x20fila\x20','companyId','lodash','[typebotListener]\x20Mensagem\x20enviada\x20pelo\x20sistema.\x20Ignorando.','toString',',\x20Dados:\x20','prototype','[typebotListener]\x20Usando\x20dados\x20da\x20sessão\x20recém-criada','Erro\x20ao\x20criar\x20sessão\x20do\x20typebot','substring','defineProperty','[typebotListener]\x20Erro\x20geral:','sessionId','Invalid\x20message.\x20Please,\x20try\x20again.','trim','[typebotListener]\x20Ticket\x20sem\x20sessão\x20ativa.\x20Criando\x20nova\x20sessão.','(((.+)+)+)+$','Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','31718ZoyfHB','application/json','[typebotListener]\x20Continuando\x20conversa\x20com\x20a\x20mensagem:\x20\x22','bold','[typebotListener]\x20Erro\x20ao\x20enviar\x20mensagem\x20de\x20erro:','key','apply','hasOwnProperty','link','messages','35AomeBF','Não','__importStar','create','data','closed','[typebotListener]\x20Resposta\x20recebida\x20do\x20Typebot:\x20','[typebotListener]\x20Erro\x20ao\x20processar\x20gatilho\x20JSON:','writable','call','[typebotListener]\x20Processando\x20mensagem\x20de\x20imagem:\x20','[typebotListener]\x20Processando\x20mensagem\x20de\x20áudio:\x20','updatedAt','[typebotListener]\x20Processando\x20','update','pushName','contact','captureException','type','[typebotListener]\x20Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:','content','Error\x20on\x20typebotListener','document','../WbotServices/GetHandlers','setMinutes','[typebotListener]\x20Resposta\x20de\x20erro:\x20','default','[typebotListener]\x20Nenhuma\x20mensagem\x20recebida.\x20Verificando\x20status\x20do\x20fluxo.','[typebotListener]\x20Resposta\x20vazia\x20do\x20Typebot','SendPresenceStatus','log','[typebotListener]\x20Usando\x20sessão\x20existente:\x20','__setModuleDefault','[typebotListener]\x20Verificando\x20expiração\x20da\x20sessão.\x20typebotExpires:\x20','constructor','reload','[typebotListener]\x20Nova\x20sessão\x20criada:\x20','[typebotListener]\x20Processando\x20mensagem\x20de\x20texto:\x20','[typebotListener]\x20Sessão\x20criada\x20com\x20sucesso.\x20SessionID:\x20','stringify','status','../../utils/logger','572330qggGHN','getMinutes','italic','post','504333BNoXOu','error','underline','audio','15768YuvJCn','__createBinding','isNil','Resposta\x20vazia\x20do\x20Typebot','24132WESzIO','[typebotListener]\x20Processando\x20comando\x20de\x20finalização','remoteJid','[typebotListener]\x20Erro\x20ao\x20enviar\x20imagem:','../WbotServices/SendWhatsAppMedia','[typebotListener]\x20Criando\x20nova\x20sessão\x20para\x20o\x20número:\x20','[typebotListener]\x20Dados\x20da\x20requisição\x20para\x20criar\x20sessão:\x20','[typebotListener]\x20Processando\x20mensagem\x20de\x20documento:\x20','[typebotListener]\x20Status\x20de\x20erro:\x20','url','logger','[typebotListener]\x20Mensagem\x20vazia\x20detectada,\x20usando\x20texto\x20padrão:\x20\x22','parse','axios','children','7oDCEnE','../WbotServices/SendWhatsAppMessage','[typebotListener]\x20Mensagem\x20recebida:\x20\x22','stopBot','input','response'];a560_0x4797=function(){return _0x409ff6;};return a560_0x4797();}const axios_1=__importDefault(require(a560_0x1a134d(0x24f))),GetHandlers_1=require(a560_0x1a134d(0x223)),logger_1=require(a560_0x1a134d(0x235)),lodash_1=require(a560_0x1a134d(0x1f2)),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),SendPresenceStatus_1=require(a560_0x1a134d(0x1e3)),SendWhatsAppMedia_1=__importDefault(require(a560_0x1a134d(0x246))),Sentry=__importStar(require('@sentry/node')),SendWhatsAppMessage_1=__importDefault(require(a560_0x1a134d(0x252))),typebotListener=async({wbot:_0x1e9355,msg:_0x3b7bea,ticket:_0x5e5c40,typebot:_0x456f32})=>{const _0x4c20ec=a560_0x1a134d;if(_0x3b7bea['key']['remoteJid']===_0x4c20ec(0x1e7))return;const {urlN8N:_0x2ef2df,typebotExpires:_0xf815b4,typebotKeywordFinish:_0xf1c090,typebotKeywordRestart:_0x57f2d1,typebotUnknownMessage:_0x5463ae,typebotSlug:_0xc2b8e8,typebotDelayMessage:_0xc16961,typebotRestartMessage:_0x477ec7}=_0x456f32;if(_0x3b7bea[_0x4c20ec(0x207)]['fromMe']){console[_0x4c20ec(0x22a)](_0x4c20ec(0x1f3));return;}const _0x3fb879=_0x3b7bea[_0x4c20ec(0x207)]['remoteJid'][_0x4c20ec(0x1ea)](/\D/g,'');let _0x592e77=(0x0,GetHandlers_1['getBodyMessage'])(_0x3b7bea);console[_0x4c20ec(0x22a)](_0x4c20ec(0x253)+_0x592e77+'\x22');async function _0x328510(_0xda5acc,_0x19bce9,_0x5ddf4e){const _0x1f3ead=_0x4c20ec;try{console[_0x1f3ead(0x22a)](_0x1f3ead(0x247)+_0x5ddf4e);const _0x1b258d=JSON['stringify']({'isStreamEnabled':!![],'message':_0x1f3ead(0x1e1),'resultId':_0x1f3ead(0x1e1),'isOnlyRegistering':![],'prefilledVariables':{'number':_0x5ddf4e,'pushName':_0xda5acc[_0x1f3ead(0x21b)]||'','remoteJid':_0x5e5c40?.[_0x1f3ead(0x21c)]?.[_0x1f3ead(0x244)]}});console[_0x1f3ead(0x22a)](_0x1f3ead(0x248)+_0x1b258d);const _0x17add1={'method':_0x1f3ead(0x239),'maxBodyLength':Infinity,'url':_0x2ef2df+_0x1f3ead(0x1db)+_0xc2b8e8+'/startChat','headers':{'Content-Type':_0x1f3ead(0x203),'Accept':_0x1f3ead(0x203)},'data':_0x1b258d};console[_0x1f3ead(0x22a)]('[typebotListener]\x20URL\x20da\x20requisição:\x20'+_0x17add1['url']);const _0x4156c0=await axios_1[_0x1f3ead(0x226)]['request'](_0x17add1);return console['log'](_0x1f3ead(0x232)+_0x4156c0['data']?.['sessionId']),_0x4156c0[_0x1f3ead(0x210)];}catch(_0xfa9d04){console['error'](_0x1f3ead(0x21f),_0xfa9d04);_0xfa9d04[_0x1f3ead(0x1d4)]&&(console[_0x1f3ead(0x23b)](_0x1f3ead(0x225)+JSON[_0x1f3ead(0x233)](_0xfa9d04['response']['data'])),console['error'](_0x1f3ead(0x24a)+_0xfa9d04['response'][_0x1f3ead(0x234)]));logger_1[_0x1f3ead(0x24c)][_0x1f3ead(0x1eb)]({'error':_0xfa9d04},_0x1f3ead(0x1f8));throw _0xfa9d04;}}let _0x104610,_0x4b0b65;try{const _0x41040f=new Date();_0x41040f[_0x4c20ec(0x224)](_0x41040f[_0x4c20ec(0x237)]()-Number(_0xf815b4)),console[_0x4c20ec(0x22a)](_0x4c20ec(0x22d)+_0xf815b4+',\x20updatedAt:\x20'+_0x5e5c40['updatedAt']);_0xf815b4>0x0&&_0x5e5c40[_0x4c20ec(0x218)]<_0x41040f&&(console[_0x4c20ec(0x22a)]('[typebotListener]\x20Sessão\x20expirada\x20por\x20tempo\x20limite.\x20Resetando\x20sessão.'),await _0x5e5c40[_0x4c20ec(0x21a)]({'typebotSessionId':null,'chatbot':!![]}),await _0x5e5c40[_0x4c20ec(0x22f)]());!_0x5e5c40['typebotSessionId']?(console[_0x4c20ec(0x22a)](_0x4c20ec(0x1ff)),_0x4b0b65=await _0x328510(_0x3b7bea,_0x456f32,_0x3fb879),_0x104610=_0x4b0b65[_0x4c20ec(0x1fc)],console['log'](_0x4c20ec(0x230)+_0x104610),await _0x5e5c40[_0x4c20ec(0x21a)]({'typebotSessionId':_0x104610,'useIntegration':!![],'integrationId':_0x456f32['id'],'chatbot':!![]}),await _0x5e5c40[_0x4c20ec(0x22f)]()):(console[_0x4c20ec(0x22a)](_0x4c20ec(0x22b)+_0x5e5c40['typebotSessionId']),_0x104610=_0x5e5c40[_0x4c20ec(0x1da)],_0x4b0b65=undefined);if(_0x592e77!==_0xf1c090&&_0x592e77!==_0x57f2d1){let _0x1d611d,_0x74c8d4,_0x241111;if(_0x4b0b65?.[_0x4c20ec(0x20b)]?.['length']===0x0||_0x4b0b65===undefined){console[_0x4c20ec(0x22a)](_0x4c20ec(0x204)+_0x592e77+'\x22');(!_0x592e77||_0x592e77[_0x4c20ec(0x1fe)]()==='')&&(_0x592e77='Mensagem\x20vazia',console[_0x4c20ec(0x22a)](_0x4c20ec(0x24d)+_0x592e77+'\x22'));const _0x177812=JSON[_0x4c20ec(0x233)]({'message':_0x592e77});let _0x5c8ec5={'method':_0x4c20ec(0x239),'maxBodyLength':Infinity,'url':_0x2ef2df+'/api/v1/sessions/'+_0x104610+'/continueChat','headers':{'Content-Type':_0x4c20ec(0x203),'Accept':_0x4c20ec(0x203)},'data':_0x177812};console[_0x4c20ec(0x22a)]('[typebotListener]\x20Enviando\x20requisição\x20para\x20continuar\x20chat.\x20URL:\x20'+_0x5c8ec5[_0x4c20ec(0x24b)]+_0x4c20ec(0x1f5)+_0x177812);try{_0x1d611d=await axios_1[_0x4c20ec(0x226)]['request'](_0x5c8ec5),console[_0x4c20ec(0x22a)](_0x4c20ec(0x212)+JSON['stringify'](_0x1d611d[_0x4c20ec(0x210)]));if(!_0x1d611d['data']){console[_0x4c20ec(0x23b)](_0x4c20ec(0x228));throw new Error(_0x4c20ec(0x241));}_0x74c8d4=_0x1d611d[_0x4c20ec(0x210)]?.['messages'],_0x241111=_0x1d611d[_0x4c20ec(0x210)]?.['input'],console['log']('[typebotListener]\x20Mensagens\x20recebidas:\x20'+(_0x74c8d4?.[_0x4c20ec(0x1d8)]||0x0)+_0x4c20ec(0x1e0)+(_0x241111?_0x4c20ec(0x1e9):_0x4c20ec(0x20d))),!_0x241111&&(console['log']('atualizando\x20typebotStatus...'),await _0x5e5c40['update']({'typebotStatus':!![]}));}catch(_0x366edf){console['error'](_0x4c20ec(0x1de),_0x366edf);_0x366edf[_0x4c20ec(0x1d4)]&&(console[_0x4c20ec(0x23b)]('[typebotListener]\x20Resposta\x20de\x20erro:\x20'+JSON[_0x4c20ec(0x233)](_0x366edf[_0x4c20ec(0x1d4)][_0x4c20ec(0x210)])),console[_0x4c20ec(0x23b)](_0x4c20ec(0x24a)+_0x366edf[_0x4c20ec(0x1d4)][_0x4c20ec(0x234)]));await _0x5e5c40[_0x4c20ec(0x21a)]({'typebotSessionId':null}),await(0x0,SendWhatsAppMessage_1[_0x4c20ec(0x226)])({'body':_0x4c20ec(0x201),'ticket':_0x5e5c40});return;}}else console[_0x4c20ec(0x22a)](_0x4c20ec(0x1f7)),_0x74c8d4=_0x4b0b65?.[_0x4c20ec(0x20b)],_0x241111=_0x4b0b65?.[_0x4c20ec(0x1d3)];if(!_0x74c8d4||_0x74c8d4?.[_0x4c20ec(0x1d8)]===0x0){console[_0x4c20ec(0x22a)](_0x4c20ec(0x227));if(_0x1d611d&&_0x1d611d['data']&&_0x241111===null){console['log'](_0x4c20ec(0x1e4)),await _0x5e5c40[_0x4c20ec(0x21a)]({'chatbot':![],'useIntegration':![]});return;}await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x5463ae,'ticket':_0x5e5c40});}else{console[_0x4c20ec(0x22a)](_0x4c20ec(0x219)+_0x74c8d4[_0x4c20ec(0x1d8)]+'\x20mensagens');for(const _0x51f1c1 of _0x74c8d4){if(_0x51f1c1[_0x4c20ec(0x21e)]==='text'){let _0x498a5a='',_0x5712e2=![];console[_0x4c20ec(0x22a)](_0x4c20ec(0x231)+JSON[_0x4c20ec(0x233)](_0x51f1c1['content']));for(const _0x522fd2 of _0x51f1c1[_0x4c20ec(0x220)]['richText']){for(const _0x45bbc7 of _0x522fd2[_0x4c20ec(0x250)]){let _0x203a20='';_0x45bbc7['text']&&(_0x203a20=_0x45bbc7[_0x4c20ec(0x1e2)]);if(_0x45bbc7['type']&&_0x45bbc7[_0x4c20ec(0x250)])for(const _0x242a50 of _0x45bbc7[_0x4c20ec(0x250)]){let _0x44979c='';_0x242a50[_0x4c20ec(0x1e2)]&&(_0x44979c=_0x242a50[_0x4c20ec(0x1e2)]);if(_0x242a50[_0x4c20ec(0x21e)]&&_0x242a50[_0x4c20ec(0x250)])for(const _0x3c9f5f of _0x242a50[_0x4c20ec(0x250)]){let _0x1f011d='';_0x3c9f5f[_0x4c20ec(0x1e2)]&&(_0x1f011d=_0x3c9f5f[_0x4c20ec(0x1e2)]);_0x3c9f5f[_0x4c20ec(0x205)]&&(_0x1f011d='*'+_0x1f011d+'*');_0x3c9f5f[_0x4c20ec(0x238)]&&(_0x1f011d='_'+_0x1f011d+'_');_0x3c9f5f[_0x4c20ec(0x23c)]&&(_0x1f011d='~'+_0x1f011d+'~');if(_0x3c9f5f['url']){const _0x30236d=_0x3c9f5f[_0x4c20ec(0x250)][0x0]?.[_0x4c20ec(0x1e2)]||'link';_0x1f011d='['+_0x30236d+']('+_0x3c9f5f[_0x4c20ec(0x24b)]+')',_0x5712e2=!![];}_0x498a5a+=_0x1f011d;}_0x242a50[_0x4c20ec(0x205)]&&(_0x44979c='*'+_0x44979c+'*');_0x242a50['italic']&&(_0x44979c='_'+_0x44979c+'_');_0x242a50[_0x4c20ec(0x23c)]&&(_0x44979c='~'+_0x44979c+'~');if(_0x242a50['url']){const _0x40da89=_0x242a50[_0x4c20ec(0x250)][0x0]?.[_0x4c20ec(0x1e2)]||_0x4c20ec(0x20a);_0x44979c='['+_0x40da89+']('+_0x242a50[_0x4c20ec(0x24b)]+')',_0x5712e2=!![];}_0x498a5a+=_0x44979c;}_0x45bbc7[_0x4c20ec(0x205)]&&(_0x203a20='*'+_0x203a20+'*');_0x45bbc7[_0x4c20ec(0x238)]&&(_0x203a20='_'+_0x203a20+'_');_0x45bbc7['underline']&&(_0x203a20='~'+_0x203a20+'~');if(_0x45bbc7['url']){const _0x16ca4c=_0x45bbc7[_0x4c20ec(0x250)][0x0]?.[_0x4c20ec(0x1e2)]||_0x4c20ec(0x20a);_0x203a20='['+_0x16ca4c+']('+_0x45bbc7[_0x4c20ec(0x24b)]+')',_0x5712e2=!![];}_0x498a5a+=_0x203a20;}_0x498a5a+='\x0a';}_0x498a5a=_0x498a5a[_0x4c20ec(0x1ea)]('**','')[_0x4c20ec(0x1ea)](/\n$/,'');_0x498a5a===_0x4c20ec(0x1fd)&&(_0x498a5a=_0x5463ae);if(_0x498a5a['startsWith']('#')){let _0x281521=_0x498a5a[_0x4c20ec(0x1ea)]('#','');try{console['log'](_0x4c20ec(0x1e8)+_0x281521);let _0x23b5e2=JSON[_0x4c20ec(0x24e)](_0x281521);if(_0x23b5e2[_0x4c20ec(0x254)]&&(0x0,lodash_1[_0x4c20ec(0x240)])(_0x23b5e2[_0x4c20ec(0x1ef)])&&(0x0,lodash_1[_0x4c20ec(0x240)])(_0x23b5e2[_0x4c20ec(0x1ec)])){console['log']('[typebotListener]\x20Executando\x20comando\x20stopBot'),await _0x5e5c40['update']({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1[_0x4c20ec(0x240)])(_0x23b5e2['queueId'])&&_0x23b5e2[_0x4c20ec(0x1ec)]>0x0&&(0x0,lodash_1[_0x4c20ec(0x240)])(_0x23b5e2['userId'])){console[_0x4c20ec(0x22a)]('[typebotListener]\x20Redirecionando\x20para\x20fila:\x20'+_0x23b5e2[_0x4c20ec(0x1ec)]),await(0x0,UpdateTicketService_1[_0x4c20ec(0x226)])({'ticketData':{'queueId':_0x23b5e2[_0x4c20ec(0x1ec)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x5e5c40['id'],'companyId':_0x5e5c40[_0x4c20ec(0x1f1)]});return;}if(!(0x0,lodash_1[_0x4c20ec(0x240)])(_0x23b5e2[_0x4c20ec(0x1ec)])&&_0x23b5e2[_0x4c20ec(0x1ec)]>0x0&&!(0x0,lodash_1['isNil'])(_0x23b5e2[_0x4c20ec(0x1ef)])&&_0x23b5e2['userId']>0x0){console[_0x4c20ec(0x22a)](_0x4c20ec(0x1f0)+_0x23b5e2[_0x4c20ec(0x1ec)]+'\x20e\x20usuário\x20'+_0x23b5e2[_0x4c20ec(0x1ef)]),await(0x0,UpdateTicketService_1[_0x4c20ec(0x226)])({'ticketData':{'queueId':_0x23b5e2[_0x4c20ec(0x1ec)],'userId':_0x23b5e2[_0x4c20ec(0x1ef)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x5e5c40['id'],'companyId':_0x5e5c40['companyId']});return;}}catch(_0xecec3b){console['error'](_0x4c20ec(0x213),_0xecec3b);throw _0xecec3b;}}console[_0x4c20ec(0x22a)]('[typebotListener]\x20Enviando\x20mensagem\x20formatada:\x20\x22'+_0x498a5a[_0x4c20ec(0x1f9)](0x0,0x32)+(_0x498a5a[_0x4c20ec(0x1d8)]>0x32?'...':'')+'\x22'),await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x1e9355,_0x3b7bea[_0x4c20ec(0x207)][_0x4c20ec(0x244)],_0xc16961),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x498a5a,'ticket':_0x5e5c40});}if(_0x51f1c1[_0x4c20ec(0x21e)]===_0x4c20ec(0x23d)){console[_0x4c20ec(0x22a)](_0x4c20ec(0x217)+_0x51f1c1['content']['url']),await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x1e9355,_0x3b7bea[_0x4c20ec(0x207)][_0x4c20ec(0x244)],_0xc16961);try{await(0x0,SendWhatsAppMedia_1[_0x4c20ec(0x226)])({'media':_0x51f1c1[_0x4c20ec(0x220)]['url'],'ticket':_0x5e5c40}),console[_0x4c20ec(0x22a)](_0x4c20ec(0x1d5));}catch(_0x39dde8){console['error']('[typebotListener]\x20Erro\x20ao\x20enviar\x20áudio:',_0x39dde8),Sentry['captureException'](_0x39dde8);throw _0x39dde8;}}if(_0x51f1c1[_0x4c20ec(0x21e)]==='image'){console[_0x4c20ec(0x22a)](_0x4c20ec(0x216)+_0x51f1c1['content'][_0x4c20ec(0x24b)]),await(0x0,SendPresenceStatus_1[_0x4c20ec(0x229)])(_0x1e9355,_0x3b7bea[_0x4c20ec(0x207)][_0x4c20ec(0x244)],_0xc16961);try{await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x51f1c1[_0x4c20ec(0x220)]['url'],'ticket':_0x5e5c40}),console[_0x4c20ec(0x22a)]('[typebotListener]\x20Imagem\x20enviada\x20com\x20sucesso.');}catch(_0x4ae31a){console[_0x4c20ec(0x23b)](_0x4c20ec(0x245),_0x4ae31a),Sentry[_0x4c20ec(0x21d)](_0x4ae31a);throw _0x4ae31a;}}if(_0x51f1c1[_0x4c20ec(0x21e)]===_0x4c20ec(0x222)){console[_0x4c20ec(0x22a)](_0x4c20ec(0x249)+_0x51f1c1[_0x4c20ec(0x220)][_0x4c20ec(0x24b)]),await(0x0,SendPresenceStatus_1[_0x4c20ec(0x229)])(_0x1e9355,_0x3b7bea['key'][_0x4c20ec(0x244)],_0xc16961);try{await(0x0,SendWhatsAppMedia_1[_0x4c20ec(0x226)])({'media':_0x51f1c1[_0x4c20ec(0x220)][_0x4c20ec(0x24b)],'ticket':_0x5e5c40}),console[_0x4c20ec(0x22a)](_0x4c20ec(0x1d6));}catch(_0x565e68){console[_0x4c20ec(0x23b)]('[typebotListener]\x20Erro\x20ao\x20enviar\x20documento:',_0x565e68),Sentry[_0x4c20ec(0x21d)](_0x565e68);throw _0x565e68;}}}}}_0x592e77===_0x57f2d1&&(console['log'](_0x4c20ec(0x1e6)),await _0x5e5c40[_0x4c20ec(0x21a)]({'chatbot':!![],'typebotSessionId':null}),await _0x5e5c40['reload'](),await(0x0,SendWhatsAppMessage_1[_0x4c20ec(0x226)])({'body':_0x477ec7,'ticket':_0x5e5c40}));if(_0x592e77===_0xf1c090){console[_0x4c20ec(0x22a)](_0x4c20ec(0x243)),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x4c20ec(0x211),'useIntegration':![],'integrationId':null},'ticketId':_0x5e5c40['id'],'companyId':_0x5e5c40[_0x4c20ec(0x1f1)]});return;}}catch(_0x35afa7){console['error'](_0x4c20ec(0x1fb),_0x35afa7);_0x35afa7[_0x4c20ec(0x1d4)]&&(console[_0x4c20ec(0x23b)]('[typebotListener]\x20Resposta\x20de\x20erro:\x20'+JSON[_0x4c20ec(0x233)](_0x35afa7[_0x4c20ec(0x1d4)]['data'])),console[_0x4c20ec(0x23b)](_0x4c20ec(0x24a)+_0x35afa7[_0x4c20ec(0x1d4)]['status']));logger_1[_0x4c20ec(0x24c)][_0x4c20ec(0x1eb)]({'error':_0x35afa7},_0x4c20ec(0x221)),await _0x5e5c40['update']({'typebotSessionId':null});try{await(0x0,SendWhatsAppMessage_1[_0x4c20ec(0x226)])({'body':_0x4c20ec(0x201),'ticket':_0x5e5c40});}catch(_0x23ec30){console[_0x4c20ec(0x23b)](_0x4c20ec(0x206),_0x23ec30);}}};exports[a560_0x1a134d(0x226)]=typebotListener;