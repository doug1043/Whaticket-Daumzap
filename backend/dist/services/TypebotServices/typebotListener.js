'use strict';const a560_0x57b071=a560_0x35f8;(function(_0x25c768,_0x54cdfa){const _0x56f46d=a560_0x35f8,_0x4d583a=_0x25c768();while(!![]){try{const _0x119a51=parseInt(_0x56f46d(0x1df))/0x1+parseInt(_0x56f46d(0x21f))/0x2*(parseInt(_0x56f46d(0x23d))/0x3)+parseInt(_0x56f46d(0x21e))/0x4*(parseInt(_0x56f46d(0x1dc))/0x5)+-parseInt(_0x56f46d(0x211))/0x6*(-parseInt(_0x56f46d(0x22a))/0x7)+-parseInt(_0x56f46d(0x219))/0x8+parseInt(_0x56f46d(0x1d9))/0x9+-parseInt(_0x56f46d(0x200))/0xa;if(_0x119a51===_0x54cdfa)break;else _0x4d583a['push'](_0x4d583a['shift']());}catch(_0x348da0){_0x4d583a['push'](_0x4d583a['shift']());}}}(a560_0x2d80,0xeb335));var __createBinding=this&&this[a560_0x57b071(0x1e1)]||(Object[a560_0x57b071(0x250)]?function(_0x3ed327,_0xad6032,_0x1237be,_0x54e7dc){const _0x4c7b0d=a560_0x57b071;if(_0x54e7dc===undefined)_0x54e7dc=_0x1237be;var _0x235928=Object[_0x4c7b0d(0x1de)](_0xad6032,_0x1237be);(!_0x235928||(_0x4c7b0d(0x1cb)in _0x235928?!_0xad6032[_0x4c7b0d(0x21a)]:_0x235928[_0x4c7b0d(0x1e4)]||_0x235928[_0x4c7b0d(0x241)]))&&(_0x235928={'enumerable':!![],'get':function(){return _0xad6032[_0x1237be];}}),Object['defineProperty'](_0x3ed327,_0x54e7dc,_0x235928);}:function(_0x23f279,_0x2ff6d1,_0x64fb8e,_0x1f0946){if(_0x1f0946===undefined)_0x1f0946=_0x64fb8e;_0x23f279[_0x1f0946]=_0x2ff6d1[_0x64fb8e];}),__setModuleDefault=this&&this[a560_0x57b071(0x240)]||(Object[a560_0x57b071(0x250)]?function(_0x54a659,_0x41a94f){const _0x5282dd=a560_0x57b071;Object[_0x5282dd(0x1f2)](_0x54a659,_0x5282dd(0x1e0),{'enumerable':!![],'value':_0x41a94f});}:function(_0x176860,_0x5a21c2){const _0x13769b=a560_0x57b071;_0x176860[_0x13769b(0x1e0)]=_0x5a21c2;}),__importStar=this&&this['__importStar']||(function(){const _0x3f8784=(function(){let _0x3c2767=!![];return function(_0x35d207,_0x3564b9){const _0x1f830a=_0x3c2767?function(){const _0x4f37b0=a560_0x35f8;if(_0x3564b9){const _0x39826e=_0x3564b9[_0x4f37b0(0x201)](_0x35d207,arguments);return _0x3564b9=null,_0x39826e;}}:function(){};return _0x3c2767=![],_0x1f830a;};}()),_0x58c463=_0x3f8784(this,function(){const _0x3e28b8=a560_0x35f8;return _0x58c463['toString']()[_0x3e28b8(0x239)](_0x3e28b8(0x20f))[_0x3e28b8(0x1ee)]()[_0x3e28b8(0x1eb)](_0x58c463)['search']('(((.+)+)+)+$');});_0x58c463();var _0x21b02e=function(_0xff5d39){return _0x21b02e=Object['getOwnPropertyNames']||function(_0x46c53d){const _0x2df333=a560_0x35f8;var _0x584900=[];for(var _0x5a1bf3 in _0x46c53d)if(Object[_0x2df333(0x209)][_0x2df333(0x1ef)][_0x2df333(0x23f)](_0x46c53d,_0x5a1bf3))_0x584900[_0x584900[_0x2df333(0x22b)]]=_0x5a1bf3;return _0x584900;},_0x21b02e(_0xff5d39);};return function(_0x498093){const _0x32ed57=a560_0x35f8;if(_0x498093&&_0x498093[_0x32ed57(0x21a)])return _0x498093;var _0x20d178={};if(_0x498093!=null){for(var _0x2df217=_0x21b02e(_0x498093),_0x3d18b1=0x0;_0x3d18b1<_0x2df217[_0x32ed57(0x22b)];_0x3d18b1++)if(_0x2df217[_0x3d18b1]!==_0x32ed57(0x1e0))__createBinding(_0x20d178,_0x498093,_0x2df217[_0x3d18b1]);}return __setModuleDefault(_0x20d178,_0x498093),_0x20d178;};}()),__importDefault=this&&this[a560_0x57b071(0x216)]||function(_0x4f8b08){const _0x4d9ea2=a560_0x57b071;return _0x4f8b08&&_0x4f8b08[_0x4d9ea2(0x21a)]?_0x4f8b08:{'default':_0x4f8b08};};function a560_0x2d80(){const _0x1e3380=['[typebotListener]\x20URL\x20da\x20requisição:\x20','replace','toString','hasOwnProperty','setMinutes','update','defineProperty','application/json','lodash',',\x20updatedAt:\x20','queueId','../WbotServices/SendWhatsAppMedia','../WbotServices/SendWhatsAppMessage','getBodyMessage','logger','contact','content','Sim','Não','[typebotListener]\x20Ticket\x20sem\x20sessão\x20ativa.\x20Criando\x20nova\x20sessão.','36273530tkuzNJ','apply','messages','/api/v1/sessions/','[typebotListener]\x20Imagem\x20enviada\x20com\x20sucesso.','[typebotListener]\x20Erro\x20geral:','richText','key','captureException','prototype','Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','[typebotListener]\x20Verificando\x20expiração\x20da\x20sessão.\x20typebotExpires:\x20','response','getMinutes','text','(((.+)+)+)+$','reload','2964JCrcmF','axios','[typebotListener]\x20Processando\x20','../../helpers/SendPresenceStatus','[typebotListener]\x20Sessão\x20expirada\x20por\x20tempo\x20limite.\x20Resetando\x20sessão.','__importDefault','companyId',',\x20Input\x20recebido:\x20','15115800XYmJrm','__esModule','link','remoteJid','[typebotListener]\x20Redirecionando\x20para\x20fila\x20','8FONcNr','178CbbRxw','url','SendPresenceStatus','[typebotListener]\x20Nova\x20sessão\x20criada:\x20','data','status','...','[typebotListener]\x20Processando\x20comando\x20de\x20finalização','[typebotListener]\x20Processando\x20mensagem\x20de\x20imagem:\x20','input','children','15211kvhzeH','length','[typebotListener]\x20Erro\x20ao\x20enviar\x20imagem:','[typebotListener]\x20Criando\x20nova\x20sessão\x20para\x20o\x20número:\x20','[typebotListener]\x20Executando\x20comando\x20stopBot','Mensagem\x20vazia','image','parse','post','[typebotListener]\x20Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:','[typebotListener]\x20Mensagem\x20enviada\x20pelo\x20sistema.\x20Ignorando.','[typebotListener]\x20Usando\x20sessão\x20existente:\x20','updatedAt','error','[typebotListener]\x20Erro\x20ao\x20processar\x20gatilho\x20JSON:','search','[typebotListener]\x20Continuando\x20conversa\x20com\x20a\x20mensagem:\x20\x22','../TicketServices/UpdateTicketService','underline','58950MMcedx','[typebotListener]\x20Sessão\x20criada\x20com\x20sucesso.\x20SessionID:\x20','call','__setModuleDefault','configurable','[typebotListener]\x20Processando\x20comando\x20de\x20reinício','document','[typebotListener]\x20Erro\x20ao\x20enviar\x20documento:','[typebotListener]\x20Processando\x20mensagem\x20de\x20documento:\x20','stringify','typebotSessionId','type','../../utils/logger','[typebotListener]\x20Processando\x20mensagem\x20de\x20texto:\x20','substring','[typebotListener]\x20Fim\x20natural\x20do\x20fluxo\x20detectado.\x20Finalizando\x20sem\x20erro.','italic','[typebotListener]\x20Resposta\x20recebida\x20do\x20Typebot:\x20','[typebotListener]\x20Áudio\x20enviado\x20com\x20sucesso.','create','bold','string','\x20e\x20usuário\x20','get','[typebotListener]\x20Documento\x20enviado\x20com\x20sucesso.','[typebotListener]\x20Erro\x20ao\x20enviar\x20áudio:','trim','[typebotListener]\x20Mensagem\x20recebida:\x20\x22','closed','[typebotListener]\x20Dados\x20da\x20requisição\x20para\x20criar\x20sessão:\x20','[typebotListener]\x20Processando\x20mensagem\x20de\x20áudio:\x20','userId','[typebotListener]\x20Redirecionando\x20para\x20fila:\x20',',\x20Dados:\x20','/api/v1/typebots/','[typebotListener]\x20Mensagens\x20recebidas:\x20','[typebotListener]\x20Usando\x20dados\x20da\x20sessão\x20recém-criada','9625680xCNTUz','Resposta\x20vazia\x20do\x20Typebot','[typebotListener]\x20Erro\x20ao\x20continuar\x20chat:','2350605bafdKa','log','getOwnPropertyDescriptor','1648135yYMzGZ','default','__createBinding','isNil','[typebotListener]\x20Status\x20de\x20erro:\x20','writable','request','audio','info','/continueChat','sessionId','[typebotListener]\x20Resposta\x20de\x20erro:\x20','constructor'];a560_0x2d80=function(){return _0x1e3380;};return a560_0x2d80();}function a560_0x35f8(_0x5357f0,_0x5821be){const _0x4ba222=a560_0x2d80();return a560_0x35f8=function(_0x514763,_0x447886){_0x514763=_0x514763-0x1c8;let _0x2d800b=_0x4ba222[_0x514763];return _0x2d800b;},a560_0x35f8(_0x5357f0,_0x5821be);}Object[a560_0x57b071(0x1f2)](exports,a560_0x57b071(0x21a),{'value':!![]});const axios_1=__importDefault(require(a560_0x57b071(0x212))),GetHandlers_1=require('../WbotServices/GetHandlers'),logger_1=require(a560_0x57b071(0x249)),lodash_1=require(a560_0x57b071(0x1f4)),UpdateTicketService_1=__importDefault(require(a560_0x57b071(0x23b))),SendPresenceStatus_1=require(a560_0x57b071(0x214)),SendWhatsAppMedia_1=__importDefault(require(a560_0x57b071(0x1f7))),Sentry=__importStar(require('@sentry/node')),SendWhatsAppMessage_1=__importDefault(require(a560_0x57b071(0x1f8))),typebotListener=async({wbot:_0x626c78,msg:_0x1e9b00,ticket:_0x141210,typebot:_0x37fdac})=>{const _0x3adfbc=a560_0x57b071;if(_0x1e9b00[_0x3adfbc(0x207)][_0x3adfbc(0x21c)]==='status@broadcast')return;const {urlN8N:_0x30ea02,typebotExpires:_0x3a4c4c,typebotKeywordFinish:_0x167bb2,typebotKeywordRestart:_0x506026,typebotUnknownMessage:_0x3017fe,typebotSlug:_0xe565d5,typebotDelayMessage:_0x309ab0,typebotRestartMessage:_0x39df92}=_0x37fdac;if(_0x1e9b00[_0x3adfbc(0x207)]['fromMe']){console[_0x3adfbc(0x1dd)](_0x3adfbc(0x234));return;}const _0x189a22=_0x1e9b00[_0x3adfbc(0x207)][_0x3adfbc(0x21c)][_0x3adfbc(0x1ed)](/\D/g,'');let _0x26536e=(0x0,GetHandlers_1[_0x3adfbc(0x1f9)])(_0x1e9b00);console['log'](_0x3adfbc(0x1cf)+_0x26536e+'\x22');async function _0x2d855e(_0x2f1443,_0x1c9bd5,_0x5a0834){const _0x7e4930=_0x3adfbc;try{console['log'](_0x7e4930(0x22d)+_0x5a0834);const _0x241a23=JSON[_0x7e4930(0x246)]({'isStreamEnabled':!![],'message':_0x7e4930(0x1c9),'resultId':_0x7e4930(0x1c9),'isOnlyRegistering':![],'prefilledVariables':{'number':_0x5a0834,'pushName':_0x2f1443['pushName']||'','remoteJid':_0x141210?.[_0x7e4930(0x1fb)]?.['remoteJid']}});console[_0x7e4930(0x1dd)](_0x7e4930(0x1d1)+_0x241a23);const _0x3ae480={'method':_0x7e4930(0x232),'maxBodyLength':Infinity,'url':_0x30ea02+_0x7e4930(0x1d6)+_0xe565d5+'/startChat','headers':{'Content-Type':_0x7e4930(0x1f3),'Accept':'application/json'},'data':_0x241a23};console[_0x7e4930(0x1dd)](_0x7e4930(0x1ec)+_0x3ae480['url']);const _0x101778=await axios_1['default']['request'](_0x3ae480);return console['log'](_0x7e4930(0x23e)+_0x101778['data']?.[_0x7e4930(0x1e9)]),_0x101778[_0x7e4930(0x223)];}catch(_0x2c4896){console['error'](_0x7e4930(0x233),_0x2c4896);_0x2c4896['response']&&(console['error']('[typebotListener]\x20Resposta\x20de\x20erro:\x20'+JSON[_0x7e4930(0x246)](_0x2c4896['response'][_0x7e4930(0x223)])),console[_0x7e4930(0x237)](_0x7e4930(0x1e3)+_0x2c4896[_0x7e4930(0x20c)][_0x7e4930(0x224)]));logger_1[_0x7e4930(0x1fa)][_0x7e4930(0x1e7)]('Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:\x20',_0x2c4896);throw _0x2c4896;}}let _0x59d007,_0x39b0bb;try{const _0x2183cf=new Date();_0x2183cf[_0x3adfbc(0x1f0)](_0x2183cf[_0x3adfbc(0x20d)]()-Number(_0x3a4c4c)),console['log'](_0x3adfbc(0x20b)+_0x3a4c4c+_0x3adfbc(0x1f5)+_0x141210[_0x3adfbc(0x236)]);_0x3a4c4c>0x0&&_0x141210[_0x3adfbc(0x236)]<_0x2183cf&&(console[_0x3adfbc(0x1dd)](_0x3adfbc(0x215)),await _0x141210[_0x3adfbc(0x1f1)]({'typebotSessionId':null,'chatbot':!![]}),await _0x141210['reload']());!_0x141210[_0x3adfbc(0x247)]?(console[_0x3adfbc(0x1dd)](_0x3adfbc(0x1ff)),_0x39b0bb=await _0x2d855e(_0x1e9b00,_0x37fdac,_0x189a22),_0x59d007=_0x39b0bb[_0x3adfbc(0x1e9)],console['log'](_0x3adfbc(0x222)+_0x59d007),await _0x141210[_0x3adfbc(0x1f1)]({'typebotSessionId':_0x59d007,'useIntegration':!![],'integrationId':_0x37fdac['id'],'chatbot':!![]}),await _0x141210[_0x3adfbc(0x210)]()):(console[_0x3adfbc(0x1dd)](_0x3adfbc(0x235)+_0x141210[_0x3adfbc(0x247)]),_0x59d007=_0x141210['typebotSessionId'],_0x39b0bb=undefined);if(_0x26536e!==_0x167bb2&&_0x26536e!==_0x506026){let _0x47c68c,_0x15cf0c,_0x30a72a;if(_0x39b0bb?.['messages']?.['length']===0x0||_0x39b0bb===undefined){console[_0x3adfbc(0x1dd)](_0x3adfbc(0x23a)+_0x26536e+'\x22');(!_0x26536e||_0x26536e[_0x3adfbc(0x1ce)]()==='')&&(_0x26536e=_0x3adfbc(0x22f),console[_0x3adfbc(0x1dd)]('[typebotListener]\x20Mensagem\x20vazia\x20detectada,\x20usando\x20texto\x20padrão:\x20\x22'+_0x26536e+'\x22'));const _0x3cc3c0=JSON[_0x3adfbc(0x246)]({'message':_0x26536e});let _0x31b638={'method':_0x3adfbc(0x232),'maxBodyLength':Infinity,'url':_0x30ea02+_0x3adfbc(0x203)+_0x59d007+_0x3adfbc(0x1e8),'headers':{'Content-Type':_0x3adfbc(0x1f3),'Accept':'application/json'},'data':_0x3cc3c0};console[_0x3adfbc(0x1dd)]('[typebotListener]\x20Enviando\x20requisição\x20para\x20continuar\x20chat.\x20URL:\x20'+_0x31b638['url']+_0x3adfbc(0x1d5)+_0x3cc3c0);try{_0x47c68c=await axios_1[_0x3adfbc(0x1e0)][_0x3adfbc(0x1e5)](_0x31b638),console['log'](_0x3adfbc(0x24e)+JSON[_0x3adfbc(0x246)](_0x47c68c['data']));if(!_0x47c68c[_0x3adfbc(0x223)]){console[_0x3adfbc(0x237)]('[typebotListener]\x20Resposta\x20vazia\x20do\x20Typebot');throw new Error(_0x3adfbc(0x1da));}_0x15cf0c=_0x47c68c[_0x3adfbc(0x223)]?.['messages'],_0x30a72a=_0x47c68c[_0x3adfbc(0x223)]?.[_0x3adfbc(0x228)],console[_0x3adfbc(0x1dd)](_0x3adfbc(0x1d7)+(_0x15cf0c?.[_0x3adfbc(0x22b)]||0x0)+_0x3adfbc(0x218)+(_0x30a72a?_0x3adfbc(0x1fd):_0x3adfbc(0x1fe))),!_0x30a72a&&(console[_0x3adfbc(0x1dd)]('atualizando\x20typebotStatus...'),await _0x141210['update']({'typebotStatus':!![]}));}catch(_0xa025bd){console[_0x3adfbc(0x237)](_0x3adfbc(0x1db),_0xa025bd);_0xa025bd[_0x3adfbc(0x20c)]&&(console['error'](_0x3adfbc(0x1ea)+JSON[_0x3adfbc(0x246)](_0xa025bd[_0x3adfbc(0x20c)][_0x3adfbc(0x223)])),console[_0x3adfbc(0x237)](_0x3adfbc(0x1e3)+_0xa025bd[_0x3adfbc(0x20c)][_0x3adfbc(0x224)]));await _0x141210['update']({'typebotSessionId':null}),await(0x0,SendWhatsAppMessage_1[_0x3adfbc(0x1e0)])({'body':_0x3adfbc(0x20a),'ticket':_0x141210});return;}}else console[_0x3adfbc(0x1dd)](_0x3adfbc(0x1d8)),_0x15cf0c=_0x39b0bb?.[_0x3adfbc(0x202)],_0x30a72a=_0x39b0bb?.[_0x3adfbc(0x228)];if(!_0x15cf0c||_0x15cf0c?.[_0x3adfbc(0x22b)]===0x0){console[_0x3adfbc(0x1dd)]('[typebotListener]\x20Nenhuma\x20mensagem\x20recebida.\x20Verificando\x20status\x20do\x20fluxo.');if(_0x47c68c&&_0x47c68c[_0x3adfbc(0x223)]&&_0x30a72a===null){console['log'](_0x3adfbc(0x24c)),await _0x141210['update']({'chatbot':![],'useIntegration':![]});return;}await(0x0,SendWhatsAppMessage_1[_0x3adfbc(0x1e0)])({'body':_0x3017fe,'ticket':_0x141210});}else{console[_0x3adfbc(0x1dd)](_0x3adfbc(0x213)+_0x15cf0c[_0x3adfbc(0x22b)]+'\x20mensagens');for(const _0x4c5d50 of _0x15cf0c){if(_0x4c5d50[_0x3adfbc(0x248)]==='text'){let _0x52d351='',_0x45cdc1=![];console[_0x3adfbc(0x1dd)](_0x3adfbc(0x24a)+JSON[_0x3adfbc(0x246)](_0x4c5d50[_0x3adfbc(0x1fc)]));for(const _0x55927b of _0x4c5d50[_0x3adfbc(0x1fc)][_0x3adfbc(0x206)]){for(const _0x854f75 of _0x55927b[_0x3adfbc(0x229)]){let _0x4664eb='';_0x854f75[_0x3adfbc(0x20e)]&&(_0x4664eb=_0x854f75[_0x3adfbc(0x20e)]);if(_0x854f75[_0x3adfbc(0x248)]&&_0x854f75[_0x3adfbc(0x229)])for(const _0x4ffe6f of _0x854f75[_0x3adfbc(0x229)]){let _0x1c4a55='';_0x4ffe6f[_0x3adfbc(0x20e)]&&(_0x1c4a55=_0x4ffe6f[_0x3adfbc(0x20e)]);if(_0x4ffe6f[_0x3adfbc(0x248)]&&_0x4ffe6f[_0x3adfbc(0x229)])for(const _0x5ab822 of _0x4ffe6f[_0x3adfbc(0x229)]){let _0x46557b='';_0x5ab822[_0x3adfbc(0x20e)]&&(_0x46557b=_0x5ab822[_0x3adfbc(0x20e)]);_0x5ab822[_0x3adfbc(0x1c8)]&&(_0x46557b='*'+_0x46557b+'*');_0x5ab822[_0x3adfbc(0x24d)]&&(_0x46557b='_'+_0x46557b+'_');_0x5ab822[_0x3adfbc(0x23c)]&&(_0x46557b='~'+_0x46557b+'~');if(_0x5ab822['url']){const _0x4da620=_0x5ab822['children'][0x0]?.[_0x3adfbc(0x20e)]||_0x3adfbc(0x21b);_0x46557b='['+_0x4da620+']('+_0x5ab822[_0x3adfbc(0x220)]+')',_0x45cdc1=!![];}_0x52d351+=_0x46557b;}_0x4ffe6f['bold']&&(_0x1c4a55='*'+_0x1c4a55+'*');_0x4ffe6f[_0x3adfbc(0x24d)]&&(_0x1c4a55='_'+_0x1c4a55+'_');_0x4ffe6f[_0x3adfbc(0x23c)]&&(_0x1c4a55='~'+_0x1c4a55+'~');if(_0x4ffe6f[_0x3adfbc(0x220)]){const _0x944ea8=_0x4ffe6f[_0x3adfbc(0x229)][0x0]?.['text']||_0x3adfbc(0x21b);_0x1c4a55='['+_0x944ea8+']('+_0x4ffe6f['url']+')',_0x45cdc1=!![];}_0x52d351+=_0x1c4a55;}_0x854f75['bold']&&(_0x4664eb='*'+_0x4664eb+'*');_0x854f75[_0x3adfbc(0x24d)]&&(_0x4664eb='_'+_0x4664eb+'_');_0x854f75[_0x3adfbc(0x23c)]&&(_0x4664eb='~'+_0x4664eb+'~');if(_0x854f75[_0x3adfbc(0x220)]){const _0x4a59f1=_0x854f75[_0x3adfbc(0x229)][0x0]?.[_0x3adfbc(0x20e)]||_0x3adfbc(0x21b);_0x4664eb='['+_0x4a59f1+']('+_0x854f75['url']+')',_0x45cdc1=!![];}_0x52d351+=_0x4664eb;}_0x52d351+='\x0a';}_0x52d351=_0x52d351[_0x3adfbc(0x1ed)]('**','')[_0x3adfbc(0x1ed)](/\n$/,'');_0x52d351==='Invalid\x20message.\x20Please,\x20try\x20again.'&&(_0x52d351=_0x3017fe);if(_0x52d351['startsWith']('#')){let _0x284370=_0x52d351['replace']('#','');try{console[_0x3adfbc(0x1dd)]('[typebotListener]\x20Processando\x20gatilho\x20JSON:\x20'+_0x284370);let _0x387336=JSON[_0x3adfbc(0x231)](_0x284370);if(_0x387336['stopBot']&&(0x0,lodash_1[_0x3adfbc(0x1e2)])(_0x387336[_0x3adfbc(0x1d3)])&&(0x0,lodash_1[_0x3adfbc(0x1e2)])(_0x387336[_0x3adfbc(0x1f6)])){console[_0x3adfbc(0x1dd)](_0x3adfbc(0x22e)),await _0x141210['update']({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1['isNil'])(_0x387336[_0x3adfbc(0x1f6)])&&_0x387336[_0x3adfbc(0x1f6)]>0x0&&(0x0,lodash_1[_0x3adfbc(0x1e2)])(_0x387336[_0x3adfbc(0x1d3)])){console[_0x3adfbc(0x1dd)](_0x3adfbc(0x1d4)+_0x387336['queueId']),await(0x0,UpdateTicketService_1[_0x3adfbc(0x1e0)])({'ticketData':{'queueId':_0x387336[_0x3adfbc(0x1f6)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x141210['id'],'companyId':_0x141210[_0x3adfbc(0x217)]});return;}if(!(0x0,lodash_1['isNil'])(_0x387336[_0x3adfbc(0x1f6)])&&_0x387336[_0x3adfbc(0x1f6)]>0x0&&!(0x0,lodash_1['isNil'])(_0x387336['userId'])&&_0x387336['userId']>0x0){console[_0x3adfbc(0x1dd)](_0x3adfbc(0x21d)+_0x387336[_0x3adfbc(0x1f6)]+_0x3adfbc(0x1ca)+_0x387336[_0x3adfbc(0x1d3)]),await(0x0,UpdateTicketService_1[_0x3adfbc(0x1e0)])({'ticketData':{'queueId':_0x387336['queueId'],'userId':_0x387336[_0x3adfbc(0x1d3)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x141210['id'],'companyId':_0x141210[_0x3adfbc(0x217)]});return;}}catch(_0x110d47){console['error'](_0x3adfbc(0x238),_0x110d47);throw _0x110d47;}}console[_0x3adfbc(0x1dd)]('[typebotListener]\x20Enviando\x20mensagem\x20formatada:\x20\x22'+_0x52d351[_0x3adfbc(0x24b)](0x0,0x32)+(_0x52d351['length']>0x32?_0x3adfbc(0x225):'')+'\x22'),await(0x0,SendPresenceStatus_1[_0x3adfbc(0x221)])(_0x626c78,_0x1e9b00['key'][_0x3adfbc(0x21c)],_0x309ab0),await(0x0,SendWhatsAppMessage_1[_0x3adfbc(0x1e0)])({'body':_0x52d351,'ticket':_0x141210});}if(_0x4c5d50[_0x3adfbc(0x248)]===_0x3adfbc(0x1e6)){console[_0x3adfbc(0x1dd)](_0x3adfbc(0x1d2)+_0x4c5d50['content'][_0x3adfbc(0x220)]),await(0x0,SendPresenceStatus_1[_0x3adfbc(0x221)])(_0x626c78,_0x1e9b00[_0x3adfbc(0x207)][_0x3adfbc(0x21c)],_0x309ab0);try{await(0x0,SendWhatsAppMedia_1[_0x3adfbc(0x1e0)])({'media':_0x4c5d50[_0x3adfbc(0x1fc)][_0x3adfbc(0x220)],'ticket':_0x141210}),console[_0x3adfbc(0x1dd)](_0x3adfbc(0x24f));}catch(_0x5d549c){console[_0x3adfbc(0x237)](_0x3adfbc(0x1cd),_0x5d549c),Sentry[_0x3adfbc(0x208)](_0x5d549c);throw _0x5d549c;}}if(_0x4c5d50[_0x3adfbc(0x248)]===_0x3adfbc(0x230)){console[_0x3adfbc(0x1dd)](_0x3adfbc(0x227)+_0x4c5d50[_0x3adfbc(0x1fc)][_0x3adfbc(0x220)]),await(0x0,SendPresenceStatus_1[_0x3adfbc(0x221)])(_0x626c78,_0x1e9b00['key'][_0x3adfbc(0x21c)],_0x309ab0);try{await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x4c5d50[_0x3adfbc(0x1fc)][_0x3adfbc(0x220)],'ticket':_0x141210}),console[_0x3adfbc(0x1dd)](_0x3adfbc(0x204));}catch(_0x351355){console[_0x3adfbc(0x237)](_0x3adfbc(0x22c),_0x351355),Sentry['captureException'](_0x351355);throw _0x351355;}}if(_0x4c5d50[_0x3adfbc(0x248)]===_0x3adfbc(0x243)){console[_0x3adfbc(0x1dd)](_0x3adfbc(0x245)+_0x4c5d50['content'][_0x3adfbc(0x220)]),await(0x0,SendPresenceStatus_1[_0x3adfbc(0x221)])(_0x626c78,_0x1e9b00[_0x3adfbc(0x207)]['remoteJid'],_0x309ab0);try{await(0x0,SendWhatsAppMedia_1[_0x3adfbc(0x1e0)])({'media':_0x4c5d50['content']['url'],'ticket':_0x141210}),console[_0x3adfbc(0x1dd)](_0x3adfbc(0x1cc));}catch(_0x121c4d){console[_0x3adfbc(0x237)](_0x3adfbc(0x244),_0x121c4d),Sentry[_0x3adfbc(0x208)](_0x121c4d);throw _0x121c4d;}}}}}_0x26536e===_0x506026&&(console['log'](_0x3adfbc(0x242)),await _0x141210[_0x3adfbc(0x1f1)]({'chatbot':!![],'typebotSessionId':null}),await _0x141210[_0x3adfbc(0x210)](),await(0x0,SendWhatsAppMessage_1[_0x3adfbc(0x1e0)])({'body':_0x39df92,'ticket':_0x141210}));if(_0x26536e===_0x167bb2){console[_0x3adfbc(0x1dd)](_0x3adfbc(0x226)),await(0x0,UpdateTicketService_1[_0x3adfbc(0x1e0)])({'ticketData':{'status':_0x3adfbc(0x1d0),'useIntegration':![],'integrationId':null},'ticketId':_0x141210['id'],'companyId':_0x141210[_0x3adfbc(0x217)]});return;}}catch(_0x18b02b){console['error'](_0x3adfbc(0x205),_0x18b02b);_0x18b02b[_0x3adfbc(0x20c)]&&(console['error'](_0x3adfbc(0x1ea)+JSON[_0x3adfbc(0x246)](_0x18b02b[_0x3adfbc(0x20c)][_0x3adfbc(0x223)])),console[_0x3adfbc(0x237)]('[typebotListener]\x20Status\x20de\x20erro:\x20'+_0x18b02b[_0x3adfbc(0x20c)][_0x3adfbc(0x224)]));logger_1[_0x3adfbc(0x1fa)][_0x3adfbc(0x1e7)]('Error\x20on\x20typebotListener:\x20',_0x18b02b),await _0x141210[_0x3adfbc(0x1f1)]({'typebotSessionId':null});try{await(0x0,SendWhatsAppMessage_1[_0x3adfbc(0x1e0)])({'body':_0x3adfbc(0x20a),'ticket':_0x141210});}catch(_0x4838ce){console[_0x3adfbc(0x237)]('[typebotListener]\x20Erro\x20ao\x20enviar\x20mensagem\x20de\x20erro:',_0x4838ce);}}};exports[a560_0x57b071(0x1e0)]=typebotListener;