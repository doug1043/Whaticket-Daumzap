'use strict';const a554_0x4c1ba6=a554_0x21bd;(function(_0x252a21,_0x32f979){const _0x4989ec=a554_0x21bd,_0x55c1a7=_0x252a21();while(!![]){try{const _0x14d41c=parseInt(_0x4989ec(0x226))/0x1*(parseInt(_0x4989ec(0x229))/0x2)+parseInt(_0x4989ec(0x271))/0x3+-parseInt(_0x4989ec(0x22c))/0x4+-parseInt(_0x4989ec(0x220))/0x5+-parseInt(_0x4989ec(0x255))/0x6+-parseInt(_0x4989ec(0x22f))/0x7*(parseInt(_0x4989ec(0x20f))/0x8)+parseInt(_0x4989ec(0x210))/0x9*(parseInt(_0x4989ec(0x20d))/0xa);if(_0x14d41c===_0x32f979)break;else _0x55c1a7['push'](_0x55c1a7['shift']());}catch(_0x5dbe5c){_0x55c1a7['push'](_0x55c1a7['shift']());}}}(a554_0x51a2,0x9b7db));var __createBinding=this&&this[a554_0x4c1ba6(0x1f2)]||(Object['create']?function(_0x40299b,_0x2326dc,_0x4fbd36,_0x48c222){const _0x2d890a=a554_0x4c1ba6;if(_0x48c222===undefined)_0x48c222=_0x4fbd36;var _0x3e04f5=Object[_0x2d890a(0x216)](_0x2326dc,_0x4fbd36);(!_0x3e04f5||(_0x2d890a(0x237)in _0x3e04f5?!_0x2326dc[_0x2d890a(0x20e)]:_0x3e04f5['writable']||_0x3e04f5[_0x2d890a(0x225)]))&&(_0x3e04f5={'enumerable':!![],'get':function(){return _0x2326dc[_0x4fbd36];}}),Object['defineProperty'](_0x40299b,_0x48c222,_0x3e04f5);}:function(_0x711ab9,_0x1ff345,_0x2d9fe4,_0x48dd6b){if(_0x48dd6b===undefined)_0x48dd6b=_0x2d9fe4;_0x711ab9[_0x48dd6b]=_0x1ff345[_0x2d9fe4];}),__setModuleDefault=this&&this[a554_0x4c1ba6(0x221)]||(Object['create']?function(_0x5013cb,_0x5150f4){const _0x2f99cd=a554_0x4c1ba6;Object[_0x2f99cd(0x26d)](_0x5013cb,_0x2f99cd(0x227),{'enumerable':!![],'value':_0x5150f4});}:function(_0x296905,_0x33629f){const _0xdcbdc9=a554_0x4c1ba6;_0x296905[_0xdcbdc9(0x227)]=_0x33629f;}),__importStar=this&&this[a554_0x4c1ba6(0x1fa)]||(function(){const _0x53c948=(function(){let _0x3a7115=!![];return function(_0xcbb8b7,_0x36fead){const _0x78b4cb=_0x3a7115?function(){const _0x4173d8=a554_0x21bd;if(_0x36fead){const _0x5804f2=_0x36fead[_0x4173d8(0x213)](_0xcbb8b7,arguments);return _0x36fead=null,_0x5804f2;}}:function(){};return _0x3a7115=![],_0x78b4cb;};}()),_0x328489=_0x53c948(this,function(){const _0x5ca016=a554_0x21bd;return _0x328489[_0x5ca016(0x1f1)]()[_0x5ca016(0x224)](_0x5ca016(0x247))[_0x5ca016(0x1f1)]()['constructor'](_0x328489)[_0x5ca016(0x224)](_0x5ca016(0x247));});_0x328489();var _0x1e495f=function(_0xcd5488){const _0x243ccb=a554_0x21bd;return _0x1e495f=Object[_0x243ccb(0x22a)]||function(_0x5d145e){const _0x19bc16=_0x243ccb;var _0x39c0ce=[];for(var _0x5a1fac in _0x5d145e)if(Object[_0x19bc16(0x24c)][_0x19bc16(0x243)]['call'](_0x5d145e,_0x5a1fac))_0x39c0ce[_0x39c0ce[_0x19bc16(0x1f5)]]=_0x5a1fac;return _0x39c0ce;},_0x1e495f(_0xcd5488);};return function(_0x21221e){const _0x1e04c6=a554_0x21bd;if(_0x21221e&&_0x21221e['__esModule'])return _0x21221e;var _0x5191c6={};if(_0x21221e!=null){for(var _0xb026c=_0x1e495f(_0x21221e),_0xdbba7=0x0;_0xdbba7<_0xb026c[_0x1e04c6(0x1f5)];_0xdbba7++)if(_0xb026c[_0xdbba7]!=='default')__createBinding(_0x5191c6,_0x21221e,_0xb026c[_0xdbba7]);}return __setModuleDefault(_0x5191c6,_0x21221e),_0x5191c6;};}()),__importDefault=this&&this['__importDefault']||function(_0x4eb4ba){const _0x15a9be=a554_0x4c1ba6;return _0x4eb4ba&&_0x4eb4ba[_0x15a9be(0x20e)]?_0x4eb4ba:{'default':_0x4eb4ba};};function a554_0x51a2(){const _0x309858=['captureException','setMinutes','[typebotListener]\x20Verificando\x20expiração\x20da\x20sessão.\x20typebotExpires:\x20','richText','hasOwnProperty','\x20mensagens','[typebotListener]\x20Executando\x20comando\x20stopBot','Mensagem\x20vazia','(((.+)+)+)+$','[typebotListener]\x20Resposta\x20recebida\x20do\x20Typebot:\x20','SendPresenceStatus','/api/v1/typebots/','...','prototype','Invalid\x20message.\x20Please,\x20try\x20again.','[typebotListener]\x20Erro\x20ao\x20processar\x20gatilho\x20JSON:','[typebotListener]\x20Redirecionando\x20para\x20fila:\x20','[typebotListener]\x20Resposta\x20vazia\x20do\x20Typebot','startsWith','reload','/continueChat','[typebotListener]\x20Processando\x20mensagem\x20de\x20imagem:\x20','5826030bhZXpN','content','Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:\x20','[typebotListener]\x20Status\x20de\x20erro:\x20','[typebotListener]\x20Mensagem\x20enviada\x20pelo\x20sistema.\x20Ignorando.','companyId','[typebotListener]\x20Processando\x20','stopBot','getMinutes','[typebotListener]\x20Enviando\x20requisição\x20para\x20continuar\x20chat.\x20URL:\x20','input','[typebotListener]\x20Erro\x20ao\x20continuar\x20chat:','response','../../utils/logger','[typebotListener]\x20Usando\x20dados\x20da\x20sessão\x20recém-criada','[typebotListener]\x20Mensagem\x20recebida:\x20\x22','../WbotServices/GetHandlers','../TicketServices/UpdateTicketService','text','[typebotListener]\x20Erro\x20ao\x20enviar\x20mensagem\x20de\x20erro:','[typebotListener]\x20Processando\x20comando\x20de\x20reinício',',\x20Dados:\x20','underline','[typebotListener]\x20Criando\x20nova\x20sessão\x20para\x20o\x20número:\x20','defineProperty','[typebotListener]\x20Resposta\x20de\x20erro:\x20','update','[typebotListener]\x20Nova\x20sessão\x20criada:\x20','1278495uTkfRl','type','Error\x20on\x20typebotListener:\x20',',\x20updatedAt:\x20','parse','../../helpers/SendPresenceStatus','[typebotListener]\x20Sessão\x20criada\x20com\x20sucesso.\x20SessionID:\x20','status','toString','__createBinding','[typebotListener]\x20Ticket\x20sem\x20sessão\x20ativa.\x20Criando\x20nova\x20sessão.','[typebotListener]\x20URL\x20da\x20requisição:\x20','length','typebotSessionId','error','bold','\x20e\x20usuário\x20','__importStar','closed','[typebotListener]\x20Imagem\x20enviada\x20com\x20sucesso.','children','[typebotListener]\x20Mensagens\x20recebidas:\x20','string','isNil','/api/v1/sessions/','userId','Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','updatedAt','getBodyMessage','url','[typebotListener]\x20Erro\x20ao\x20enviar\x20documento:','[typebotListener]\x20Nenhuma\x20mensagem\x20recebida.\x20Verificando\x20status\x20do\x20fluxo.','[typebotListener]\x20Erro\x20ao\x20enviar\x20áudio:','[typebotListener]\x20Processando\x20mensagem\x20de\x20texto:\x20','[typebotListener]\x20Enviando\x20mensagem\x20formatada:\x20\x22','[typebotListener]\x20Documento\x20enviado\x20com\x20sucesso.','17993500sGmbZK','__esModule','60776XnrxHg','18owzLKD','replace','[typebotListener]\x20Dados\x20da\x20requisição\x20para\x20criar\x20sessão:\x20','apply','logger','info','getOwnPropertyDescriptor','messages','@sentry/node','substring','link','[typebotListener]\x20Erro\x20ao\x20enviar\x20imagem:','remoteJid','[typebotListener]\x20Processando\x20mensagem\x20de\x20áudio:\x20','[typebotListener]\x20Áudio\x20enviado\x20com\x20sucesso.','[typebotListener]\x20Processando\x20comando\x20de\x20finalização','3820610hoHfcl','__setModuleDefault','application/json','axios','search','configurable','1wHpQPW','default','[typebotListener]\x20Continuando\x20conversa\x20com\x20a\x20mensagem:\x20\x22','82126aFpipX','getOwnPropertyNames','Resposta\x20vazia\x20do\x20Typebot','3979944DQSEXf','[typebotListener]\x20Usando\x20sessão\x20existente:\x20','key','644kgXDSg','status@broadcast','../WbotServices/SendWhatsAppMedia','request','[typebotListener]\x20Erro\x20geral:','[typebotListener]\x20Mensagem\x20vazia\x20detectada,\x20usando\x20texto\x20padrão:\x20\x22','Não','[typebotListener]\x20Processando\x20mensagem\x20de\x20documento:\x20','get','log','document','stringify','italic','post','data','queueId'];a554_0x51a2=function(){return _0x309858;};return a554_0x51a2();}function a554_0x21bd(_0x39e63b,_0xb38fcb){const _0xb8ee4=a554_0x51a2();return a554_0x21bd=function(_0x547294,_0x561218){_0x547294=_0x547294-0x1f1;let _0x51a291=_0xb8ee4[_0x547294];return _0x51a291;},a554_0x21bd(_0x39e63b,_0xb38fcb);}Object[a554_0x4c1ba6(0x26d)](exports,a554_0x4c1ba6(0x20e),{'value':!![]});const axios_1=__importDefault(require(a554_0x4c1ba6(0x223))),GetHandlers_1=require(a554_0x4c1ba6(0x265)),logger_1=require(a554_0x4c1ba6(0x262)),lodash_1=require('lodash'),UpdateTicketService_1=__importDefault(require(a554_0x4c1ba6(0x266))),SendPresenceStatus_1=require(a554_0x4c1ba6(0x276)),SendWhatsAppMedia_1=__importDefault(require(a554_0x4c1ba6(0x231))),Sentry=__importStar(require(a554_0x4c1ba6(0x218))),SendWhatsAppMessage_1=__importDefault(require('../WbotServices/SendWhatsAppMessage')),typebotListener=async({wbot:_0x44c949,msg:_0x59cfa2,ticket:_0x19b196,typebot:_0x44f790})=>{const _0x5b9c90=a554_0x4c1ba6;if(_0x59cfa2[_0x5b9c90(0x22e)]['remoteJid']===_0x5b9c90(0x230))return;const {urlN8N:_0x38a98b,typebotExpires:_0x401bf7,typebotKeywordFinish:_0x1f11b4,typebotKeywordRestart:_0x209cbe,typebotUnknownMessage:_0x164f5c,typebotSlug:_0x102da0,typebotDelayMessage:_0x166443,typebotRestartMessage:_0x46f9ec}=_0x44f790;if(_0x59cfa2[_0x5b9c90(0x22e)]['fromMe']){console[_0x5b9c90(0x238)](_0x5b9c90(0x259));return;}const _0x2fcf53=_0x59cfa2[_0x5b9c90(0x22e)][_0x5b9c90(0x21c)][_0x5b9c90(0x211)](/\D/g,'');let _0x4f42f3=(0x0,GetHandlers_1[_0x5b9c90(0x205)])(_0x59cfa2);console[_0x5b9c90(0x238)](_0x5b9c90(0x264)+_0x4f42f3+'\x22');async function _0x5e9e55(_0x2d35f8,_0x4c11c8,_0x320726){const _0x4a3056=_0x5b9c90;try{console[_0x4a3056(0x238)](_0x4a3056(0x26c)+_0x320726);const _0x2d70d6=JSON[_0x4a3056(0x23a)]({'isStreamEnabled':!![],'message':_0x4a3056(0x1ff),'resultId':_0x4a3056(0x1ff),'isOnlyRegistering':![],'prefilledVariables':{'number':_0x320726,'pushName':_0x2d35f8['pushName']||'','remoteJid':_0x19b196?.['contact']?.[_0x4a3056(0x21c)]}});console[_0x4a3056(0x238)](_0x4a3056(0x212)+_0x2d70d6);const _0x338564={'method':_0x4a3056(0x23c),'maxBodyLength':Infinity,'url':_0x38a98b+_0x4a3056(0x24a)+_0x102da0+'/startChat','headers':{'Content-Type':_0x4a3056(0x222),'Accept':_0x4a3056(0x222)},'data':_0x2d70d6};console['log'](_0x4a3056(0x1f4)+_0x338564[_0x4a3056(0x206)]);const _0x4a114b=await axios_1['default'][_0x4a3056(0x232)](_0x338564);return console[_0x4a3056(0x238)](_0x4a3056(0x277)+_0x4a114b[_0x4a3056(0x23d)]?.['sessionId']),_0x4a114b[_0x4a3056(0x23d)];}catch(_0x50e3de){console['error']('[typebotListener]\x20Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:',_0x50e3de);_0x50e3de['response']&&(console[_0x4a3056(0x1f7)]('[typebotListener]\x20Resposta\x20de\x20erro:\x20'+JSON['stringify'](_0x50e3de[_0x4a3056(0x261)]['data'])),console[_0x4a3056(0x1f7)](_0x4a3056(0x258)+_0x50e3de[_0x4a3056(0x261)][_0x4a3056(0x278)]));logger_1[_0x4a3056(0x214)][_0x4a3056(0x215)](_0x4a3056(0x257),_0x50e3de);throw _0x50e3de;}}let _0x5dd812,_0x5cd9fe;try{const _0x132ad7=new Date();_0x132ad7[_0x5b9c90(0x240)](_0x132ad7[_0x5b9c90(0x25d)]()-Number(_0x401bf7)),console['log'](_0x5b9c90(0x241)+_0x401bf7+_0x5b9c90(0x274)+_0x19b196[_0x5b9c90(0x204)]);_0x401bf7>0x0&&_0x19b196[_0x5b9c90(0x204)]<_0x132ad7&&(console[_0x5b9c90(0x238)]('[typebotListener]\x20Sessão\x20expirada\x20por\x20tempo\x20limite.\x20Resetando\x20sessão.'),await _0x19b196[_0x5b9c90(0x26f)]({'typebotSessionId':null,'chatbot':!![]}),await _0x19b196['reload']());!_0x19b196[_0x5b9c90(0x1f6)]?(console[_0x5b9c90(0x238)](_0x5b9c90(0x1f3)),_0x5cd9fe=await _0x5e9e55(_0x59cfa2,_0x44f790,_0x2fcf53),_0x5dd812=_0x5cd9fe['sessionId'],console[_0x5b9c90(0x238)](_0x5b9c90(0x270)+_0x5dd812),await _0x19b196[_0x5b9c90(0x26f)]({'typebotSessionId':_0x5dd812,'useIntegration':!![],'integrationId':_0x44f790['id'],'chatbot':!![]}),await _0x19b196[_0x5b9c90(0x252)]()):(console[_0x5b9c90(0x238)](_0x5b9c90(0x22d)+_0x19b196[_0x5b9c90(0x1f6)]),_0x5dd812=_0x19b196['typebotSessionId'],_0x5cd9fe=undefined);if(_0x4f42f3!==_0x1f11b4&&_0x4f42f3!==_0x209cbe){let _0x23b6a5,_0x4eee1f,_0x1566b7;if(_0x5cd9fe?.[_0x5b9c90(0x217)]?.[_0x5b9c90(0x1f5)]===0x0||_0x5cd9fe===undefined){console[_0x5b9c90(0x238)](_0x5b9c90(0x228)+_0x4f42f3+'\x22');(!_0x4f42f3||_0x4f42f3['trim']()==='')&&(_0x4f42f3=_0x5b9c90(0x246),console[_0x5b9c90(0x238)](_0x5b9c90(0x234)+_0x4f42f3+'\x22'));const _0x3c46a8=JSON['stringify']({'message':_0x4f42f3});let _0xbbde33={'method':_0x5b9c90(0x23c),'maxBodyLength':Infinity,'url':_0x38a98b+_0x5b9c90(0x201)+_0x5dd812+_0x5b9c90(0x253),'headers':{'Content-Type':_0x5b9c90(0x222),'Accept':_0x5b9c90(0x222)},'data':_0x3c46a8};console[_0x5b9c90(0x238)](_0x5b9c90(0x25e)+_0xbbde33[_0x5b9c90(0x206)]+_0x5b9c90(0x26a)+_0x3c46a8);try{_0x23b6a5=await axios_1[_0x5b9c90(0x227)]['request'](_0xbbde33),console['log'](_0x5b9c90(0x248)+JSON[_0x5b9c90(0x23a)](_0x23b6a5[_0x5b9c90(0x23d)]));if(!_0x23b6a5[_0x5b9c90(0x23d)]){console['error'](_0x5b9c90(0x250));throw new Error(_0x5b9c90(0x22b));}_0x4eee1f=_0x23b6a5['data']?.[_0x5b9c90(0x217)],_0x1566b7=_0x23b6a5[_0x5b9c90(0x23d)]?.[_0x5b9c90(0x25f)],console['log'](_0x5b9c90(0x1fe)+(_0x4eee1f?.[_0x5b9c90(0x1f5)]||0x0)+',\x20Input\x20recebido:\x20'+(_0x1566b7?'Sim':_0x5b9c90(0x235))),!_0x1566b7&&(console[_0x5b9c90(0x238)]('atualizando\x20typebotStatus...'),await _0x19b196[_0x5b9c90(0x26f)]({'typebotStatus':!![]}));}catch(_0x40b048){console[_0x5b9c90(0x1f7)](_0x5b9c90(0x260),_0x40b048);_0x40b048['response']&&(console['error'](_0x5b9c90(0x26e)+JSON[_0x5b9c90(0x23a)](_0x40b048[_0x5b9c90(0x261)][_0x5b9c90(0x23d)])),console[_0x5b9c90(0x1f7)](_0x5b9c90(0x258)+_0x40b048[_0x5b9c90(0x261)][_0x5b9c90(0x278)]));await _0x19b196[_0x5b9c90(0x26f)]({'typebotSessionId':null}),await(0x0,SendWhatsAppMessage_1[_0x5b9c90(0x227)])({'body':'Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','ticket':_0x19b196});return;}}else console[_0x5b9c90(0x238)](_0x5b9c90(0x263)),_0x4eee1f=_0x5cd9fe?.['messages'],_0x1566b7=_0x5cd9fe?.['input'];if(!_0x4eee1f||_0x4eee1f?.[_0x5b9c90(0x1f5)]===0x0){console[_0x5b9c90(0x238)](_0x5b9c90(0x208));if(_0x23b6a5&&_0x23b6a5[_0x5b9c90(0x23d)]&&_0x1566b7===null){console[_0x5b9c90(0x238)]('[typebotListener]\x20Fim\x20natural\x20do\x20fluxo\x20detectado.\x20Finalizando\x20sem\x20erro.'),await _0x19b196[_0x5b9c90(0x26f)]({'chatbot':![],'useIntegration':![]});return;}await(0x0,SendWhatsAppMessage_1[_0x5b9c90(0x227)])({'body':_0x164f5c,'ticket':_0x19b196});}else{console[_0x5b9c90(0x238)](_0x5b9c90(0x25b)+_0x4eee1f[_0x5b9c90(0x1f5)]+_0x5b9c90(0x244));for(const _0x466007 of _0x4eee1f){if(_0x466007[_0x5b9c90(0x272)]===_0x5b9c90(0x267)){let _0x4de05c='',_0x3f112e=![];console['log'](_0x5b9c90(0x20a)+JSON['stringify'](_0x466007['content']));for(const _0x178e28 of _0x466007[_0x5b9c90(0x256)][_0x5b9c90(0x242)]){for(const _0x540bc5 of _0x178e28[_0x5b9c90(0x1fd)]){let _0xb8c475='';_0x540bc5[_0x5b9c90(0x267)]&&(_0xb8c475=_0x540bc5[_0x5b9c90(0x267)]);if(_0x540bc5['type']&&_0x540bc5[_0x5b9c90(0x1fd)])for(const _0x2d3e09 of _0x540bc5['children']){let _0x6f7e47='';_0x2d3e09[_0x5b9c90(0x267)]&&(_0x6f7e47=_0x2d3e09['text']);if(_0x2d3e09[_0x5b9c90(0x272)]&&_0x2d3e09[_0x5b9c90(0x1fd)])for(const _0x380efa of _0x2d3e09[_0x5b9c90(0x1fd)]){let _0x420db5='';_0x380efa[_0x5b9c90(0x267)]&&(_0x420db5=_0x380efa[_0x5b9c90(0x267)]);_0x380efa[_0x5b9c90(0x1f8)]&&(_0x420db5='*'+_0x420db5+'*');_0x380efa[_0x5b9c90(0x23b)]&&(_0x420db5='_'+_0x420db5+'_');_0x380efa[_0x5b9c90(0x26b)]&&(_0x420db5='~'+_0x420db5+'~');if(_0x380efa['url']){const _0x189e10=_0x380efa[_0x5b9c90(0x1fd)][0x0]?.[_0x5b9c90(0x267)]||_0x5b9c90(0x21a);_0x420db5='['+_0x189e10+']('+_0x380efa['url']+')',_0x3f112e=!![];}_0x4de05c+=_0x420db5;}_0x2d3e09[_0x5b9c90(0x1f8)]&&(_0x6f7e47='*'+_0x6f7e47+'*');_0x2d3e09[_0x5b9c90(0x23b)]&&(_0x6f7e47='_'+_0x6f7e47+'_');_0x2d3e09[_0x5b9c90(0x26b)]&&(_0x6f7e47='~'+_0x6f7e47+'~');if(_0x2d3e09['url']){const _0x182afd=_0x2d3e09[_0x5b9c90(0x1fd)][0x0]?.[_0x5b9c90(0x267)]||_0x5b9c90(0x21a);_0x6f7e47='['+_0x182afd+']('+_0x2d3e09[_0x5b9c90(0x206)]+')',_0x3f112e=!![];}_0x4de05c+=_0x6f7e47;}_0x540bc5[_0x5b9c90(0x1f8)]&&(_0xb8c475='*'+_0xb8c475+'*');_0x540bc5[_0x5b9c90(0x23b)]&&(_0xb8c475='_'+_0xb8c475+'_');_0x540bc5[_0x5b9c90(0x26b)]&&(_0xb8c475='~'+_0xb8c475+'~');if(_0x540bc5[_0x5b9c90(0x206)]){const _0xc598c8=_0x540bc5[_0x5b9c90(0x1fd)][0x0]?.[_0x5b9c90(0x267)]||_0x5b9c90(0x21a);_0xb8c475='['+_0xc598c8+']('+_0x540bc5[_0x5b9c90(0x206)]+')',_0x3f112e=!![];}_0x4de05c+=_0xb8c475;}_0x4de05c+='\x0a';}_0x4de05c=_0x4de05c['replace']('**','')['replace'](/\n$/,'');_0x4de05c===_0x5b9c90(0x24d)&&(_0x4de05c=_0x164f5c);if(_0x4de05c[_0x5b9c90(0x251)]('#')){let _0x2f580d=_0x4de05c['replace']('#','');try{console['log']('[typebotListener]\x20Processando\x20gatilho\x20JSON:\x20'+_0x2f580d);let _0x5f468f=JSON[_0x5b9c90(0x275)](_0x2f580d);if(_0x5f468f[_0x5b9c90(0x25c)]&&(0x0,lodash_1[_0x5b9c90(0x200)])(_0x5f468f[_0x5b9c90(0x202)])&&(0x0,lodash_1[_0x5b9c90(0x200)])(_0x5f468f[_0x5b9c90(0x23e)])){console[_0x5b9c90(0x238)](_0x5b9c90(0x245)),await _0x19b196[_0x5b9c90(0x26f)]({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1[_0x5b9c90(0x200)])(_0x5f468f['queueId'])&&_0x5f468f[_0x5b9c90(0x23e)]>0x0&&(0x0,lodash_1['isNil'])(_0x5f468f[_0x5b9c90(0x202)])){console['log'](_0x5b9c90(0x24f)+_0x5f468f[_0x5b9c90(0x23e)]),await(0x0,UpdateTicketService_1[_0x5b9c90(0x227)])({'ticketData':{'queueId':_0x5f468f['queueId'],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x19b196['id'],'companyId':_0x19b196[_0x5b9c90(0x25a)]});return;}if(!(0x0,lodash_1[_0x5b9c90(0x200)])(_0x5f468f[_0x5b9c90(0x23e)])&&_0x5f468f['queueId']>0x0&&!(0x0,lodash_1[_0x5b9c90(0x200)])(_0x5f468f['userId'])&&_0x5f468f[_0x5b9c90(0x202)]>0x0){console['log']('[typebotListener]\x20Redirecionando\x20para\x20fila\x20'+_0x5f468f[_0x5b9c90(0x23e)]+_0x5b9c90(0x1f9)+_0x5f468f[_0x5b9c90(0x202)]),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x5f468f['queueId'],'userId':_0x5f468f[_0x5b9c90(0x202)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x19b196['id'],'companyId':_0x19b196[_0x5b9c90(0x25a)]});return;}}catch(_0x15ac95){console['error'](_0x5b9c90(0x24e),_0x15ac95);throw _0x15ac95;}}console[_0x5b9c90(0x238)](_0x5b9c90(0x20b)+_0x4de05c[_0x5b9c90(0x219)](0x0,0x32)+(_0x4de05c[_0x5b9c90(0x1f5)]>0x32?_0x5b9c90(0x24b):'')+'\x22'),await(0x0,SendPresenceStatus_1[_0x5b9c90(0x249)])(_0x44c949,_0x59cfa2[_0x5b9c90(0x22e)]['remoteJid'],_0x166443),await(0x0,SendWhatsAppMessage_1[_0x5b9c90(0x227)])({'body':_0x4de05c,'ticket':_0x19b196});}if(_0x466007['type']==='audio'){console[_0x5b9c90(0x238)](_0x5b9c90(0x21d)+_0x466007['content']['url']),await(0x0,SendPresenceStatus_1[_0x5b9c90(0x249)])(_0x44c949,_0x59cfa2[_0x5b9c90(0x22e)]['remoteJid'],_0x166443);try{await(0x0,SendWhatsAppMedia_1[_0x5b9c90(0x227)])({'media':_0x466007[_0x5b9c90(0x256)][_0x5b9c90(0x206)],'ticket':_0x19b196}),console['log'](_0x5b9c90(0x21e));}catch(_0x3c6594){console[_0x5b9c90(0x1f7)](_0x5b9c90(0x209),_0x3c6594),Sentry[_0x5b9c90(0x23f)](_0x3c6594);throw _0x3c6594;}}if(_0x466007[_0x5b9c90(0x272)]==='image'){console[_0x5b9c90(0x238)](_0x5b9c90(0x254)+_0x466007[_0x5b9c90(0x256)][_0x5b9c90(0x206)]),await(0x0,SendPresenceStatus_1[_0x5b9c90(0x249)])(_0x44c949,_0x59cfa2[_0x5b9c90(0x22e)]['remoteJid'],_0x166443);try{await(0x0,SendWhatsAppMedia_1[_0x5b9c90(0x227)])({'media':_0x466007['content'][_0x5b9c90(0x206)],'ticket':_0x19b196}),console[_0x5b9c90(0x238)](_0x5b9c90(0x1fc));}catch(_0x1e96a0){console[_0x5b9c90(0x1f7)](_0x5b9c90(0x21b),_0x1e96a0),Sentry[_0x5b9c90(0x23f)](_0x1e96a0);throw _0x1e96a0;}}if(_0x466007[_0x5b9c90(0x272)]===_0x5b9c90(0x239)){console[_0x5b9c90(0x238)](_0x5b9c90(0x236)+_0x466007['content'][_0x5b9c90(0x206)]),await(0x0,SendPresenceStatus_1[_0x5b9c90(0x249)])(_0x44c949,_0x59cfa2['key'][_0x5b9c90(0x21c)],_0x166443);try{await(0x0,SendWhatsAppMedia_1[_0x5b9c90(0x227)])({'media':_0x466007[_0x5b9c90(0x256)][_0x5b9c90(0x206)],'ticket':_0x19b196}),console['log'](_0x5b9c90(0x20c));}catch(_0xa23026){console[_0x5b9c90(0x1f7)](_0x5b9c90(0x207),_0xa23026),Sentry['captureException'](_0xa23026);throw _0xa23026;}}}}}_0x4f42f3===_0x209cbe&&(console['log'](_0x5b9c90(0x269)),await _0x19b196[_0x5b9c90(0x26f)]({'chatbot':!![],'typebotSessionId':null}),await _0x19b196[_0x5b9c90(0x252)](),await(0x0,SendWhatsAppMessage_1[_0x5b9c90(0x227)])({'body':_0x46f9ec,'ticket':_0x19b196}));if(_0x4f42f3===_0x1f11b4){console[_0x5b9c90(0x238)](_0x5b9c90(0x21f)),await(0x0,UpdateTicketService_1[_0x5b9c90(0x227)])({'ticketData':{'status':_0x5b9c90(0x1fb),'useIntegration':![],'integrationId':null},'ticketId':_0x19b196['id'],'companyId':_0x19b196[_0x5b9c90(0x25a)]});return;}}catch(_0xc51c7a){console['error'](_0x5b9c90(0x233),_0xc51c7a);_0xc51c7a['response']&&(console['error'](_0x5b9c90(0x26e)+JSON[_0x5b9c90(0x23a)](_0xc51c7a[_0x5b9c90(0x261)][_0x5b9c90(0x23d)])),console[_0x5b9c90(0x1f7)](_0x5b9c90(0x258)+_0xc51c7a[_0x5b9c90(0x261)][_0x5b9c90(0x278)]));logger_1[_0x5b9c90(0x214)][_0x5b9c90(0x215)](_0x5b9c90(0x273),_0xc51c7a),await _0x19b196['update']({'typebotSessionId':null});try{await(0x0,SendWhatsAppMessage_1[_0x5b9c90(0x227)])({'body':_0x5b9c90(0x203),'ticket':_0x19b196});}catch(_0x55d8ed){console[_0x5b9c90(0x1f7)](_0x5b9c90(0x268),_0x55d8ed);}}};exports[a554_0x4c1ba6(0x227)]=typebotListener;