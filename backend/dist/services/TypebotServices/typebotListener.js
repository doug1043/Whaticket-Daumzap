'use strict';const a564_0x430853=a564_0x573d;(function(_0x386d07,_0x40bcb0){const _0x19504c=a564_0x573d,_0x11395f=_0x386d07();while(!![]){try{const _0x222742=-parseInt(_0x19504c(0x234))/0x1+parseInt(_0x19504c(0x20e))/0x2+parseInt(_0x19504c(0x223))/0x3+-parseInt(_0x19504c(0x1ed))/0x4+-parseInt(_0x19504c(0x1ff))/0x5+-parseInt(_0x19504c(0x233))/0x6+-parseInt(_0x19504c(0x212))/0x7*(-parseInt(_0x19504c(0x202))/0x8);if(_0x222742===_0x40bcb0)break;else _0x11395f['push'](_0x11395f['shift']());}catch(_0xce3f41){_0x11395f['push'](_0x11395f['shift']());}}}(a564_0x4f1d,0x82a8a));function a564_0x4f1d(){const _0x33b492=['replace','\x20mensagens','url','Não','[typebotListener]\x20Processando\x20comando\x20de\x20reinício','info','writable','1354446gZhIXF','522020CydCQR','defineProperty','[typebotListener]\x20Erro\x20ao\x20enviar\x20documento:','__importStar','richText','reload','updatedAt','post','__importDefault','configurable','substring','__setModuleDefault','../TicketServices/UpdateTicketService','userId','[typebotListener]\x20Sessão\x20criada\x20com\x20sucesso.\x20SessionID:\x20','SendPresenceStatus','children','closed','__esModule','[typebotListener]\x20Ticket\x20sem\x20sessão\x20ativa.\x20Criando\x20nova\x20sessão.','setMinutes','(((.+)+)+)+$','Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','type','fromMe','getBodyMessage','string','[typebotListener]\x20Enviando\x20requisição\x20para\x20continuar\x20chat.\x20URL:\x20','status@broadcast','/startChat','pushName','image','[typebotListener]\x20Processando\x20mensagem\x20de\x20documento:\x20','remoteJid','text','logger','italic','[typebotListener]\x20Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:','../WbotServices/SendWhatsAppMessage','status','data','[typebotListener]\x20Dados\x20da\x20requisição\x20para\x20criar\x20sessão:\x20','contact','messages','sessionId','[typebotListener]\x20Erro\x20ao\x20enviar\x20mensagem\x20de\x20erro:','[typebotListener]\x20Erro\x20geral:','[typebotListener]\x20Processando\x20comando\x20de\x20finalização','create','[typebotListener]\x20Verificando\x20expiração\x20da\x20sessão.\x20typebotExpires:\x20','isNil','key','[typebotListener]\x20Erro\x20ao\x20continuar\x20chat:','atualizando\x20typebotStatus...','companyId','error','document','[typebotListener]\x20Mensagem\x20recebida:\x20\x22','[typebotListener]\x20Mensagem\x20enviada\x20pelo\x20sistema.\x20Ignorando.','[typebotListener]\x20Processando\x20mensagem\x20de\x20imagem:\x20','underline','3451648XvDUPT','[typebotListener]\x20Nova\x20sessão\x20criada:\x20','[typebotListener]\x20Áudio\x20enviado\x20com\x20sucesso.','/api/v1/typebots/','parse','...','captureException','getOwnPropertyNames',',\x20updatedAt:\x20','link','Mensagem\x20vazia','[typebotListener]\x20Resposta\x20vazia\x20do\x20Typebot','content','/api/v1/sessions/','[typebotListener]\x20Status\x20de\x20erro:\x20','[typebotListener]\x20Erro\x20ao\x20enviar\x20áudio:','trim','typebotSessionId','629400VbiuCR','[typebotListener]\x20Nenhuma\x20mensagem\x20recebida.\x20Verificando\x20status\x20do\x20fluxo.','../WbotServices/SendWhatsAppMedia','8qatGyQ',',\x20Dados:\x20','[typebotListener]\x20Mensagens\x20recebidas:\x20','lodash','[typebotListener]\x20Resposta\x20de\x20erro:\x20','queueId','input','[typebotListener]\x20Mensagem\x20vazia\x20detectada,\x20usando\x20texto\x20padrão:\x20\x22','getOwnPropertyDescriptor','[typebotListener]\x20Processando\x20mensagem\x20de\x20áudio:\x20','response','log','81020WYkcGu','[typebotListener]\x20Usando\x20sessão\x20existente:\x20','[typebotListener]\x20Criando\x20nova\x20sessão\x20para\x20o\x20número:\x20','default','13619872iLXljE','call','search','toString','[typebotListener]\x20Processando\x20','bold','Error\x20on\x20typebotListener','stringify','[typebotListener]\x20Continuando\x20conversa\x20com\x20a\x20mensagem:\x20\x22','[typebotListener]\x20Usando\x20dados\x20da\x20sessão\x20recém-criada','length','[typebotListener]\x20Sessão\x20expirada\x20por\x20tempo\x20limite.\x20Resetando\x20sessão.','getPhoneNumberFromMessage','[typebotListener]\x20Redirecionando\x20para\x20fila:\x20','@sentry/node','getMinutes','request','856575CdKlWm','stopBot','__createBinding','Erro\x20ao\x20criar\x20sessão\x20do\x20typebot','prototype','update','[typebotListener]\x20Processando\x20gatilho\x20JSON:\x20','application/json','startsWith'];a564_0x4f1d=function(){return _0x33b492;};return a564_0x4f1d();}function a564_0x573d(_0x2ca3e3,_0x72fafd){const _0x3ba92f=a564_0x4f1d();return a564_0x573d=function(_0x4abbda,_0x21285f){_0x4abbda=_0x4abbda-0x1b2;let _0x4f1df3=_0x3ba92f[_0x4abbda];return _0x4f1df3;},a564_0x573d(_0x2ca3e3,_0x72fafd);}var __createBinding=this&&this[a564_0x430853(0x225)]||(Object[a564_0x430853(0x1e0)]?function(_0x608739,_0x404032,_0x2ba82e,_0x2246d2){const _0xc4231f=a564_0x430853;if(_0x2246d2===undefined)_0x2246d2=_0x2ba82e;var _0x579757=Object[_0xc4231f(0x20a)](_0x404032,_0x2ba82e);(!_0x579757||('get'in _0x579757?!_0x404032[_0xc4231f(0x1c2)]:_0x579757[_0xc4231f(0x232)]||_0x579757[_0xc4231f(0x1b9)]))&&(_0x579757={'enumerable':!![],'get':function(){return _0x404032[_0x2ba82e];}}),Object[_0xc4231f(0x235)](_0x608739,_0x2246d2,_0x579757);}:function(_0x2361dc,_0x437aa4,_0x11a369,_0x44da85){if(_0x44da85===undefined)_0x44da85=_0x11a369;_0x2361dc[_0x44da85]=_0x437aa4[_0x11a369];}),__setModuleDefault=this&&this[a564_0x430853(0x1bb)]||(Object[a564_0x430853(0x1e0)]?function(_0x33e9d7,_0x41c26b){const _0x2e79cd=a564_0x430853;Object[_0x2e79cd(0x235)](_0x33e9d7,_0x2e79cd(0x211),{'enumerable':!![],'value':_0x41c26b});}:function(_0x4cf3af,_0x4ede8b){_0x4cf3af['default']=_0x4ede8b;}),__importStar=this&&this[a564_0x430853(0x1b3)]||(function(){const _0x403a43=(function(){let _0x4a60eb=!![];return function(_0x44e004,_0x170f07){const _0x5824f8=_0x4a60eb?function(){if(_0x170f07){const _0x5d603c=_0x170f07['apply'](_0x44e004,arguments);return _0x170f07=null,_0x5d603c;}}:function(){};return _0x4a60eb=![],_0x5824f8;};}()),_0x453c6d=_0x403a43(this,function(){const _0x592951=a564_0x573d;return _0x453c6d['toString']()['search'](_0x592951(0x1c5))[_0x592951(0x215)]()['constructor'](_0x453c6d)[_0x592951(0x214)](_0x592951(0x1c5));});_0x453c6d();var _0x5e94f4=function(_0x5c38a0){const _0xd9af37=a564_0x573d;return _0x5e94f4=Object[_0xd9af37(0x1f4)]||function(_0x54b940){const _0x29d64b=_0xd9af37;var _0x35b312=[];for(var _0x27f888 in _0x54b940)if(Object[_0x29d64b(0x227)]['hasOwnProperty'][_0x29d64b(0x213)](_0x54b940,_0x27f888))_0x35b312[_0x35b312[_0x29d64b(0x21c)]]=_0x27f888;return _0x35b312;},_0x5e94f4(_0x5c38a0);};return function(_0x431f6c){const _0x45c231=a564_0x573d;if(_0x431f6c&&_0x431f6c['__esModule'])return _0x431f6c;var _0x585c25={};if(_0x431f6c!=null){for(var _0x25265c=_0x5e94f4(_0x431f6c),_0x59fdb2=0x0;_0x59fdb2<_0x25265c[_0x45c231(0x21c)];_0x59fdb2++)if(_0x25265c[_0x59fdb2]!==_0x45c231(0x211))__createBinding(_0x585c25,_0x431f6c,_0x25265c[_0x59fdb2]);}return __setModuleDefault(_0x585c25,_0x431f6c),_0x585c25;};}()),__importDefault=this&&this[a564_0x430853(0x1b8)]||function(_0xd43783){const _0x3f6e1c=a564_0x430853;return _0xd43783&&_0xd43783[_0x3f6e1c(0x1c2)]?_0xd43783:{'default':_0xd43783};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const axios_1=__importDefault(require('axios')),GetHandlers_1=require('../WbotServices/GetHandlers'),logger_1=require('../../utils/logger'),lodash_1=require(a564_0x430853(0x205)),UpdateTicketService_1=__importDefault(require(a564_0x430853(0x1bc))),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus'),SendWhatsAppMedia_1=__importDefault(require(a564_0x430853(0x201))),Sentry=__importStar(require(a564_0x430853(0x220))),SendWhatsAppMessage_1=__importDefault(require(a564_0x430853(0x1d6))),ExtractPhoneNumber_1=require('../../helpers/ExtractPhoneNumber'),typebotListener=async({wbot:_0x1d830b,msg:_0x4c2e67,ticket:_0x3c81b0,typebot:_0x57f844})=>{const _0x2bdf0f=a564_0x430853;if(_0x4c2e67[_0x2bdf0f(0x1e3)]['remoteJid']===_0x2bdf0f(0x1cc))return;const {urlN8N:_0x50555f,typebotExpires:_0x364922,typebotKeywordFinish:_0x1e0438,typebotKeywordRestart:_0x532132,typebotUnknownMessage:_0x332a29,typebotSlug:_0x43f1e9,typebotDelayMessage:_0x580f45,typebotRestartMessage:_0x5e10ff}=_0x57f844;if(_0x4c2e67[_0x2bdf0f(0x1e3)][_0x2bdf0f(0x1c8)]){console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x1ea));return;}const _0x4f0d1e=(0x0,ExtractPhoneNumber_1[_0x2bdf0f(0x21e)])(_0x4c2e67,_0x1d830b);let _0x3b285b=(0x0,GetHandlers_1[_0x2bdf0f(0x1c9)])(_0x4c2e67);console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x1e9)+_0x3b285b+'\x22');async function _0x16b912(_0x2a73ca,_0x1abc21,_0x589461){const _0x4da52a=_0x2bdf0f;try{console[_0x4da52a(0x20d)](_0x4da52a(0x210)+_0x589461);const _0x58391b=JSON['stringify']({'isStreamEnabled':!![],'message':'string','resultId':_0x4da52a(0x1ca),'isOnlyRegistering':![],'prefilledVariables':{'number':_0x589461,'pushName':_0x2a73ca[_0x4da52a(0x1ce)]||'','remoteJid':_0x3c81b0?.[_0x4da52a(0x1da)]?.['remoteJid']}});console['log'](_0x4da52a(0x1d9)+_0x58391b);const _0x42c890={'method':_0x4da52a(0x1b7),'maxBodyLength':Infinity,'url':_0x50555f+_0x4da52a(0x1f0)+_0x43f1e9+_0x4da52a(0x1cd),'headers':{'Content-Type':_0x4da52a(0x22a),'Accept':_0x4da52a(0x22a)},'data':_0x58391b};console[_0x4da52a(0x20d)]('[typebotListener]\x20URL\x20da\x20requisição:\x20'+_0x42c890['url']);const _0x4956b3=await axios_1[_0x4da52a(0x211)][_0x4da52a(0x222)](_0x42c890);return console['log'](_0x4da52a(0x1be)+_0x4956b3[_0x4da52a(0x1d8)]?.[_0x4da52a(0x1dc)]),_0x4956b3[_0x4da52a(0x1d8)];}catch(_0x4c34db){console[_0x4da52a(0x1e7)](_0x4da52a(0x1d5),_0x4c34db);_0x4c34db[_0x4da52a(0x20c)]&&(console['error'](_0x4da52a(0x206)+JSON['stringify'](_0x4c34db['response'][_0x4da52a(0x1d8)])),console[_0x4da52a(0x1e7)](_0x4da52a(0x1fb)+_0x4c34db[_0x4da52a(0x20c)]['status']));logger_1['logger']['info']({'error':_0x4c34db},_0x4da52a(0x226));throw _0x4c34db;}}let _0x1bebe8,_0x460e14;try{const _0x3a0459=new Date();_0x3a0459[_0x2bdf0f(0x1c4)](_0x3a0459[_0x2bdf0f(0x221)]()-Number(_0x364922)),console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x1e1)+_0x364922+_0x2bdf0f(0x1f5)+_0x3c81b0[_0x2bdf0f(0x1b6)]);_0x364922>0x0&&_0x3c81b0['updatedAt']<_0x3a0459&&(console['log'](_0x2bdf0f(0x21d)),await _0x3c81b0[_0x2bdf0f(0x228)]({'typebotSessionId':null,'chatbot':!![]}),await _0x3c81b0[_0x2bdf0f(0x1b5)]());!_0x3c81b0[_0x2bdf0f(0x1fe)]?(console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x1c3)),_0x460e14=await _0x16b912(_0x4c2e67,_0x57f844,_0x4f0d1e),_0x1bebe8=_0x460e14[_0x2bdf0f(0x1dc)],console['log'](_0x2bdf0f(0x1ee)+_0x1bebe8),await _0x3c81b0[_0x2bdf0f(0x228)]({'typebotSessionId':_0x1bebe8,'useIntegration':!![],'integrationId':_0x57f844['id'],'chatbot':!![]}),await _0x3c81b0[_0x2bdf0f(0x1b5)]()):(console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x20f)+_0x3c81b0[_0x2bdf0f(0x1fe)]),_0x1bebe8=_0x3c81b0['typebotSessionId'],_0x460e14=undefined);if(_0x3b285b!==_0x1e0438&&_0x3b285b!==_0x532132){let _0x1937fa,_0x546f42,_0x5a4bfd;if(_0x460e14?.['messages']?.[_0x2bdf0f(0x21c)]===0x0||_0x460e14===undefined){console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x21a)+_0x3b285b+'\x22');(!_0x3b285b||_0x3b285b[_0x2bdf0f(0x1fd)]()==='')&&(_0x3b285b=_0x2bdf0f(0x1f7),console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x209)+_0x3b285b+'\x22'));const _0x118f3c=JSON[_0x2bdf0f(0x219)]({'message':_0x3b285b});let _0x26a331={'method':_0x2bdf0f(0x1b7),'maxBodyLength':Infinity,'url':_0x50555f+_0x2bdf0f(0x1fa)+_0x1bebe8+'/continueChat','headers':{'Content-Type':_0x2bdf0f(0x22a),'Accept':'application/json'},'data':_0x118f3c};console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x1cb)+_0x26a331['url']+_0x2bdf0f(0x203)+_0x118f3c);try{_0x1937fa=await axios_1[_0x2bdf0f(0x211)][_0x2bdf0f(0x222)](_0x26a331),console['log']('[typebotListener]\x20Resposta\x20recebida\x20do\x20Typebot:\x20'+JSON[_0x2bdf0f(0x219)](_0x1937fa['data']));if(!_0x1937fa[_0x2bdf0f(0x1d8)]){console[_0x2bdf0f(0x1e7)](_0x2bdf0f(0x1f8));throw new Error('Resposta\x20vazia\x20do\x20Typebot');}_0x546f42=_0x1937fa[_0x2bdf0f(0x1d8)]?.[_0x2bdf0f(0x1db)],_0x5a4bfd=_0x1937fa[_0x2bdf0f(0x1d8)]?.[_0x2bdf0f(0x208)],console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x204)+(_0x546f42?.['length']||0x0)+',\x20Input\x20recebido:\x20'+(_0x5a4bfd?'Sim':_0x2bdf0f(0x22f))),!_0x5a4bfd&&(console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x1e5)),await _0x3c81b0[_0x2bdf0f(0x228)]({'typebotStatus':!![]}));}catch(_0x2dd56c){console['error'](_0x2bdf0f(0x1e4),_0x2dd56c);_0x2dd56c[_0x2bdf0f(0x20c)]&&(console[_0x2bdf0f(0x1e7)](_0x2bdf0f(0x206)+JSON[_0x2bdf0f(0x219)](_0x2dd56c['response'][_0x2bdf0f(0x1d8)])),console[_0x2bdf0f(0x1e7)](_0x2bdf0f(0x1fb)+_0x2dd56c[_0x2bdf0f(0x20c)][_0x2bdf0f(0x1d7)]));await _0x3c81b0[_0x2bdf0f(0x228)]({'typebotSessionId':null}),await(0x0,SendWhatsAppMessage_1[_0x2bdf0f(0x211)])({'body':_0x2bdf0f(0x1c6),'ticket':_0x3c81b0});return;}}else console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x21b)),_0x546f42=_0x460e14?.[_0x2bdf0f(0x1db)],_0x5a4bfd=_0x460e14?.[_0x2bdf0f(0x208)];if(!_0x546f42||_0x546f42?.[_0x2bdf0f(0x21c)]===0x0){console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x200));if(_0x1937fa&&_0x1937fa[_0x2bdf0f(0x1d8)]&&_0x5a4bfd===null){console['log']('[typebotListener]\x20Fim\x20natural\x20do\x20fluxo\x20detectado.\x20Finalizando\x20sem\x20erro.'),await _0x3c81b0[_0x2bdf0f(0x228)]({'chatbot':![],'useIntegration':![]});return;}await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x332a29,'ticket':_0x3c81b0});}else{console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x216)+_0x546f42['length']+_0x2bdf0f(0x22d));for(const _0x4c7bbf of _0x546f42){if(_0x4c7bbf[_0x2bdf0f(0x1c7)]===_0x2bdf0f(0x1d2)){let _0x892a5c='',_0x509344=![];console[_0x2bdf0f(0x20d)]('[typebotListener]\x20Processando\x20mensagem\x20de\x20texto:\x20'+JSON['stringify'](_0x4c7bbf[_0x2bdf0f(0x1f9)]));for(const _0x2e69fd of _0x4c7bbf['content'][_0x2bdf0f(0x1b4)]){for(const _0x2b920c of _0x2e69fd[_0x2bdf0f(0x1c0)]){let _0x5ab882='';_0x2b920c[_0x2bdf0f(0x1d2)]&&(_0x5ab882=_0x2b920c[_0x2bdf0f(0x1d2)]);if(_0x2b920c['type']&&_0x2b920c[_0x2bdf0f(0x1c0)])for(const _0x2c50f4 of _0x2b920c[_0x2bdf0f(0x1c0)]){let _0x4c3639='';_0x2c50f4[_0x2bdf0f(0x1d2)]&&(_0x4c3639=_0x2c50f4[_0x2bdf0f(0x1d2)]);if(_0x2c50f4['type']&&_0x2c50f4[_0x2bdf0f(0x1c0)])for(const _0x53b293 of _0x2c50f4['children']){let _0x372630='';_0x53b293[_0x2bdf0f(0x1d2)]&&(_0x372630=_0x53b293[_0x2bdf0f(0x1d2)]);_0x53b293['bold']&&(_0x372630='*'+_0x372630+'*');_0x53b293['italic']&&(_0x372630='_'+_0x372630+'_');_0x53b293[_0x2bdf0f(0x1ec)]&&(_0x372630='~'+_0x372630+'~');if(_0x53b293['url']){const _0x6e4860=_0x53b293[_0x2bdf0f(0x1c0)][0x0]?.[_0x2bdf0f(0x1d2)]||_0x2bdf0f(0x1f6);_0x372630='['+_0x6e4860+']('+_0x53b293[_0x2bdf0f(0x22e)]+')',_0x509344=!![];}_0x892a5c+=_0x372630;}_0x2c50f4[_0x2bdf0f(0x217)]&&(_0x4c3639='*'+_0x4c3639+'*');_0x2c50f4[_0x2bdf0f(0x1d4)]&&(_0x4c3639='_'+_0x4c3639+'_');_0x2c50f4['underline']&&(_0x4c3639='~'+_0x4c3639+'~');if(_0x2c50f4['url']){const _0x54e77f=_0x2c50f4[_0x2bdf0f(0x1c0)][0x0]?.[_0x2bdf0f(0x1d2)]||'link';_0x4c3639='['+_0x54e77f+']('+_0x2c50f4['url']+')',_0x509344=!![];}_0x892a5c+=_0x4c3639;}_0x2b920c[_0x2bdf0f(0x217)]&&(_0x5ab882='*'+_0x5ab882+'*');_0x2b920c[_0x2bdf0f(0x1d4)]&&(_0x5ab882='_'+_0x5ab882+'_');_0x2b920c[_0x2bdf0f(0x1ec)]&&(_0x5ab882='~'+_0x5ab882+'~');if(_0x2b920c[_0x2bdf0f(0x22e)]){const _0x3cec47=_0x2b920c[_0x2bdf0f(0x1c0)][0x0]?.[_0x2bdf0f(0x1d2)]||'link';_0x5ab882='['+_0x3cec47+']('+_0x2b920c[_0x2bdf0f(0x22e)]+')',_0x509344=!![];}_0x892a5c+=_0x5ab882;}_0x892a5c+='\x0a';}_0x892a5c=_0x892a5c[_0x2bdf0f(0x22c)]('**','')[_0x2bdf0f(0x22c)](/\n$/,'');_0x892a5c==='Invalid\x20message.\x20Please,\x20try\x20again.'&&(_0x892a5c=_0x332a29);if(_0x892a5c[_0x2bdf0f(0x22b)]('#')){let _0x22423e=_0x892a5c[_0x2bdf0f(0x22c)]('#','');try{console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x229)+_0x22423e);let _0x932675=JSON[_0x2bdf0f(0x1f1)](_0x22423e);if(_0x932675[_0x2bdf0f(0x224)]&&(0x0,lodash_1[_0x2bdf0f(0x1e2)])(_0x932675[_0x2bdf0f(0x1bd)])&&(0x0,lodash_1[_0x2bdf0f(0x1e2)])(_0x932675['queueId'])){console[_0x2bdf0f(0x20d)]('[typebotListener]\x20Executando\x20comando\x20stopBot'),await _0x3c81b0[_0x2bdf0f(0x228)]({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1['isNil'])(_0x932675[_0x2bdf0f(0x207)])&&_0x932675[_0x2bdf0f(0x207)]>0x0&&(0x0,lodash_1[_0x2bdf0f(0x1e2)])(_0x932675[_0x2bdf0f(0x1bd)])){console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x21f)+_0x932675[_0x2bdf0f(0x207)]),await(0x0,UpdateTicketService_1[_0x2bdf0f(0x211)])({'ticketData':{'queueId':_0x932675[_0x2bdf0f(0x207)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x3c81b0['id'],'companyId':_0x3c81b0[_0x2bdf0f(0x1e6)]});return;}if(!(0x0,lodash_1[_0x2bdf0f(0x1e2)])(_0x932675['queueId'])&&_0x932675[_0x2bdf0f(0x207)]>0x0&&!(0x0,lodash_1[_0x2bdf0f(0x1e2)])(_0x932675[_0x2bdf0f(0x1bd)])&&_0x932675[_0x2bdf0f(0x1bd)]>0x0){console[_0x2bdf0f(0x20d)]('[typebotListener]\x20Redirecionando\x20para\x20fila\x20'+_0x932675['queueId']+'\x20e\x20usuário\x20'+_0x932675['userId']),await(0x0,UpdateTicketService_1[_0x2bdf0f(0x211)])({'ticketData':{'queueId':_0x932675[_0x2bdf0f(0x207)],'userId':_0x932675[_0x2bdf0f(0x1bd)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x3c81b0['id'],'companyId':_0x3c81b0[_0x2bdf0f(0x1e6)]});return;}}catch(_0x56556c){console['error']('[typebotListener]\x20Erro\x20ao\x20processar\x20gatilho\x20JSON:',_0x56556c);throw _0x56556c;}}console[_0x2bdf0f(0x20d)]('[typebotListener]\x20Enviando\x20mensagem\x20formatada:\x20\x22'+_0x892a5c[_0x2bdf0f(0x1ba)](0x0,0x32)+(_0x892a5c[_0x2bdf0f(0x21c)]>0x32?_0x2bdf0f(0x1f2):'')+'\x22'),await(0x0,SendPresenceStatus_1[_0x2bdf0f(0x1bf)])(_0x1d830b,_0x4c2e67[_0x2bdf0f(0x1e3)][_0x2bdf0f(0x1d1)],_0x580f45),await(0x0,SendWhatsAppMessage_1[_0x2bdf0f(0x211)])({'body':_0x892a5c,'ticket':_0x3c81b0});}if(_0x4c7bbf[_0x2bdf0f(0x1c7)]==='audio'){console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x20b)+_0x4c7bbf['content'][_0x2bdf0f(0x22e)]),await(0x0,SendPresenceStatus_1[_0x2bdf0f(0x1bf)])(_0x1d830b,_0x4c2e67['key']['remoteJid'],_0x580f45);try{await(0x0,SendWhatsAppMedia_1[_0x2bdf0f(0x211)])({'media':_0x4c7bbf[_0x2bdf0f(0x1f9)]['url'],'ticket':_0x3c81b0}),console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x1ef));}catch(_0x652dc){console[_0x2bdf0f(0x1e7)](_0x2bdf0f(0x1fc),_0x652dc),Sentry[_0x2bdf0f(0x1f3)](_0x652dc);throw _0x652dc;}}if(_0x4c7bbf[_0x2bdf0f(0x1c7)]===_0x2bdf0f(0x1cf)){console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x1eb)+_0x4c7bbf[_0x2bdf0f(0x1f9)]['url']),await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x1d830b,_0x4c2e67[_0x2bdf0f(0x1e3)][_0x2bdf0f(0x1d1)],_0x580f45);try{await(0x0,SendWhatsAppMedia_1[_0x2bdf0f(0x211)])({'media':_0x4c7bbf[_0x2bdf0f(0x1f9)]['url'],'ticket':_0x3c81b0}),console[_0x2bdf0f(0x20d)]('[typebotListener]\x20Imagem\x20enviada\x20com\x20sucesso.');}catch(_0x2bc433){console[_0x2bdf0f(0x1e7)]('[typebotListener]\x20Erro\x20ao\x20enviar\x20imagem:',_0x2bc433),Sentry[_0x2bdf0f(0x1f3)](_0x2bc433);throw _0x2bc433;}}if(_0x4c7bbf['type']===_0x2bdf0f(0x1e8)){console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x1d0)+_0x4c7bbf[_0x2bdf0f(0x1f9)][_0x2bdf0f(0x22e)]),await(0x0,SendPresenceStatus_1[_0x2bdf0f(0x1bf)])(_0x1d830b,_0x4c2e67['key'][_0x2bdf0f(0x1d1)],_0x580f45);try{await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x4c7bbf['content'][_0x2bdf0f(0x22e)],'ticket':_0x3c81b0}),console[_0x2bdf0f(0x20d)]('[typebotListener]\x20Documento\x20enviado\x20com\x20sucesso.');}catch(_0xd2b06b){console[_0x2bdf0f(0x1e7)](_0x2bdf0f(0x1b2),_0xd2b06b),Sentry[_0x2bdf0f(0x1f3)](_0xd2b06b);throw _0xd2b06b;}}}}}_0x3b285b===_0x532132&&(console[_0x2bdf0f(0x20d)](_0x2bdf0f(0x230)),await _0x3c81b0[_0x2bdf0f(0x228)]({'chatbot':!![],'typebotSessionId':null}),await _0x3c81b0[_0x2bdf0f(0x1b5)](),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x5e10ff,'ticket':_0x3c81b0}));if(_0x3b285b===_0x1e0438){console['log'](_0x2bdf0f(0x1df)),await(0x0,UpdateTicketService_1[_0x2bdf0f(0x211)])({'ticketData':{'status':_0x2bdf0f(0x1c1),'useIntegration':![],'integrationId':null},'ticketId':_0x3c81b0['id'],'companyId':_0x3c81b0[_0x2bdf0f(0x1e6)]});return;}}catch(_0x18d68e){console[_0x2bdf0f(0x1e7)](_0x2bdf0f(0x1de),_0x18d68e);_0x18d68e[_0x2bdf0f(0x20c)]&&(console[_0x2bdf0f(0x1e7)](_0x2bdf0f(0x206)+JSON[_0x2bdf0f(0x219)](_0x18d68e[_0x2bdf0f(0x20c)]['data'])),console[_0x2bdf0f(0x1e7)](_0x2bdf0f(0x1fb)+_0x18d68e[_0x2bdf0f(0x20c)][_0x2bdf0f(0x1d7)]));logger_1[_0x2bdf0f(0x1d3)][_0x2bdf0f(0x231)]({'error':_0x18d68e},_0x2bdf0f(0x218)),await _0x3c81b0['update']({'typebotSessionId':null});try{await(0x0,SendWhatsAppMessage_1[_0x2bdf0f(0x211)])({'body':_0x2bdf0f(0x1c6),'ticket':_0x3c81b0});}catch(_0x306450){console['error'](_0x2bdf0f(0x1dd),_0x306450);}}};exports[a564_0x430853(0x211)]=typebotListener;