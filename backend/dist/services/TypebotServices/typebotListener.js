'use strict';const a671_0x311392=a671_0x5483;function a671_0x5597(){const _0x254062=['update','italic','\x20mensagens','create','lodash','5290IBeRFm','Resposta\x20vazia\x20do\x20Typebot','userId','__createBinding','axios','request','../../helpers/SendPresenceStatus','type','info','[typebotListener]\x20Enviando\x20mensagem\x20formatada:\x20\x22','error','getOwnPropertyDescriptor','constructor','__setModuleDefault','captureException','toString','getOwnPropertyNames','key','text','[typebotListener]\x20Redirecionando\x20para\x20fila:\x20','startsWith','log','[typebotListener]\x20Nova\x20sessão\x20criada:\x20','logger','3100027KsMVLX','writable','[typebotListener]\x20Verificando\x20expiração\x20da\x20sessão.\x20typebotExpires:\x20','[typebotListener]\x20Resposta\x20vazia\x20do\x20Typebot','[typebotListener]\x20Resposta\x20recebida\x20do\x20Typebot:\x20','[typebotListener]\x20Processando\x20mensagem\x20de\x20documento:\x20','[typebotListener]\x20Mensagem\x20enviada\x20pelo\x20sistema.\x20Ignorando.','__esModule','pushName','status',',\x20Dados:\x20','/continueChat','[typebotListener]\x20Nenhuma\x20mensagem\x20recebida.\x20Verificando\x20status\x20do\x20fluxo.','[typebotListener]\x20Redirecionando\x20para\x20fila\x20','../WbotServices/SendWhatsAppMedia','search','/api/v1/typebots/','replace','length','status@broadcast','8322867ETvYgj','[typebotListener]\x20Usando\x20sessão\x20existente:\x20','364qFSAMc','default','[typebotListener]\x20Criando\x20nova\x20sessão\x20para\x20o\x20número:\x20','[typebotListener]\x20Resposta\x20de\x20erro:\x20','prototype','richText','@sentry/node','[typebotListener]\x20Erro\x20ao\x20enviar\x20áudio:','/startChat','response','Mensagem\x20vazia','call','queueId','[typebotListener]\x20Executando\x20comando\x20stopBot','../WbotServices/GetHandlers','getMinutes','[typebotListener]\x20Processando\x20mensagem\x20de\x20texto:\x20','substring','[typebotListener]\x20Enviando\x20requisição\x20para\x20continuar\x20chat.\x20URL:\x20','../../utils/logger','[typebotListener]\x20Processando\x20mensagem\x20de\x20áudio:\x20','content','[typebotListener]\x20Processando\x20comando\x20de\x20finalização','Erro\x20ao\x20criar\x20sessão\x20do\x20typebot','data','reload','[typebotListener]\x20Dados\x20da\x20requisição\x20para\x20criar\x20sessão:\x20','[typebotListener]\x20Processando\x20mensagem\x20de\x20imagem:\x20','atualizando\x20typebotStatus...','__importStar','[typebotListener]\x20Processando\x20','[typebotListener]\x20Erro\x20geral:','...','children','bold','SendPresenceStatus','1594134kBoida','Error\x20on\x20typebotListener','url','45825aLWyzn','[typebotListener]\x20Imagem\x20enviada\x20com\x20sucesso.','stopBot','10838377jQgbzK','[typebotListener]\x20Continuando\x20conversa\x20com\x20a\x20mensagem:\x20\x22','sessionId','[typebotListener]\x20Fim\x20natural\x20do\x20fluxo\x20detectado.\x20Finalizando\x20sem\x20erro.','[typebotListener]\x20Áudio\x20enviado\x20com\x20sucesso.',',\x20updatedAt:\x20','[typebotListener]\x20Ticket\x20sem\x20sessão\x20ativa.\x20Criando\x20nova\x20sessão.','contact','[typebotListener]\x20Processando\x20gatilho\x20JSON:\x20','stringify','isNil','messages','[typebotListener]\x20Mensagens\x20recebidas:\x20','Invalid\x20message.\x20Please,\x20try\x20again.','defineProperty','[typebotListener]\x20Processando\x20comando\x20de\x20reinício','../WbotServices/SendWhatsAppMessage','input','354EClqBK','Não','10bhOjzj','[typebotListener]\x20Sessão\x20criada\x20com\x20sucesso.\x20SessionID:\x20','underline','getPhoneNumberFromMessage','companyId','[typebotListener]\x20Usando\x20dados\x20da\x20sessão\x20recém-criada',',\x20Input\x20recebido:\x20','Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','6IozdnR','(((.+)+)+)+$','application/json','[typebotListener]\x20Erro\x20ao\x20continuar\x20chat:','link','[typebotListener]\x20Erro\x20ao\x20enviar\x20imagem:','string','typebotSessionId','[typebotListener]\x20Erro\x20ao\x20processar\x20gatilho\x20JSON:','updatedAt','2842904FTpCNg','fromMe','remoteJid','apply','[typebotListener]\x20Mensagem\x20vazia\x20detectada,\x20usando\x20texto\x20padrão:\x20\x22','post','../../helpers/ExtractPhoneNumber'];a671_0x5597=function(){return _0x254062;};return a671_0x5597();}(function(_0x22012d,_0x23a347){const _0x30fcee=a671_0x5483,_0x547311=_0x22012d();while(!![]){try{const _0x569275=-parseInt(_0x30fcee(0x1ad))/0x1*(parseInt(_0x30fcee(0x1cd))/0x2)+-parseInt(_0x30fcee(0x21f))/0x3+-parseInt(_0x30fcee(0x1fb))/0x4*(-parseInt(_0x30fcee(0x222))/0x5)+parseInt(_0x30fcee(0x1b7))/0x6*(-parseInt(_0x30fcee(0x1e5))/0x7)+-parseInt(_0x30fcee(0x1c1))/0x8+parseInt(_0x30fcee(0x1f9))/0x9+-parseInt(_0x30fcee(0x1af))/0xa*(-parseInt(_0x30fcee(0x225))/0xb);if(_0x569275===_0x23a347)break;else _0x547311['push'](_0x547311['shift']());}catch(_0x148288){_0x547311['push'](_0x547311['shift']());}}}(a671_0x5597,0x74bc9));var __createBinding=this&&this[a671_0x311392(0x1d0)]||(Object[a671_0x311392(0x1cb)]?function(_0x2fc082,_0x11d315,_0x19dde4,_0x462d8b){const _0x36d670=a671_0x311392;if(_0x462d8b===undefined)_0x462d8b=_0x19dde4;var _0x543a6b=Object[_0x36d670(0x1d8)](_0x11d315,_0x19dde4);(!_0x543a6b||('get'in _0x543a6b?!_0x11d315[_0x36d670(0x1ec)]:_0x543a6b[_0x36d670(0x1e6)]||_0x543a6b['configurable']))&&(_0x543a6b={'enumerable':!![],'get':function(){return _0x11d315[_0x19dde4];}}),Object[_0x36d670(0x233)](_0x2fc082,_0x462d8b,_0x543a6b);}:function(_0x3c89c7,_0x3c67e4,_0x1dd6fb,_0x3730e6){if(_0x3730e6===undefined)_0x3730e6=_0x1dd6fb;_0x3c89c7[_0x3730e6]=_0x3c67e4[_0x1dd6fb];}),__setModuleDefault=this&&this[a671_0x311392(0x1da)]||(Object['create']?function(_0x542a59,_0x47d68a){const _0x281f22=a671_0x311392;Object[_0x281f22(0x233)](_0x542a59,_0x281f22(0x1fc),{'enumerable':!![],'value':_0x47d68a});}:function(_0x3e3731,_0x5a39d9){_0x3e3731['default']=_0x5a39d9;}),__importStar=this&&this[a671_0x311392(0x218)]||(function(){const _0x5552a4=(function(){let _0x222563=!![];return function(_0x467af9,_0x2eeff1){const _0x920e6f=_0x222563?function(){const _0x58ce9b=a671_0x5483;if(_0x2eeff1){const _0x2e0851=_0x2eeff1[_0x58ce9b(0x1c4)](_0x467af9,arguments);return _0x2eeff1=null,_0x2e0851;}}:function(){};return _0x222563=![],_0x920e6f;};}()),_0x352c0f=_0x5552a4(this,function(){const _0x25ed54=a671_0x5483;return _0x352c0f[_0x25ed54(0x1dc)]()[_0x25ed54(0x1f4)](_0x25ed54(0x1b8))['toString']()[_0x25ed54(0x1d9)](_0x352c0f)[_0x25ed54(0x1f4)]('(((.+)+)+)+$');});_0x352c0f();var _0x175f1d=function(_0x589833){const _0x2bc4e3=a671_0x5483;return _0x175f1d=Object[_0x2bc4e3(0x1dd)]||function(_0x204885){const _0x37cb90=_0x2bc4e3;var _0x4c3dbf=[];for(var _0x45c6be in _0x204885)if(Object[_0x37cb90(0x1ff)]['hasOwnProperty'][_0x37cb90(0x206)](_0x204885,_0x45c6be))_0x4c3dbf[_0x4c3dbf[_0x37cb90(0x1f7)]]=_0x45c6be;return _0x4c3dbf;},_0x175f1d(_0x589833);};return function(_0x36aa75){const _0x54a23e=a671_0x5483;if(_0x36aa75&&_0x36aa75['__esModule'])return _0x36aa75;var _0x1607dc={};if(_0x36aa75!=null){for(var _0x5e410b=_0x175f1d(_0x36aa75),_0x3f4514=0x0;_0x3f4514<_0x5e410b['length'];_0x3f4514++)if(_0x5e410b[_0x3f4514]!==_0x54a23e(0x1fc))__createBinding(_0x1607dc,_0x36aa75,_0x5e410b[_0x3f4514]);}return __setModuleDefault(_0x1607dc,_0x36aa75),_0x1607dc;};}()),__importDefault=this&&this['__importDefault']||function(_0x10d16f){const _0x145012=a671_0x311392;return _0x10d16f&&_0x10d16f[_0x145012(0x1ec)]?_0x10d16f:{'default':_0x10d16f};};Object[a671_0x311392(0x233)](exports,a671_0x311392(0x1ec),{'value':!![]});function a671_0x5483(_0x5ccd6a,_0x2f1c76){const _0x3797e8=a671_0x5597();return a671_0x5483=function(_0x145874,_0x48d8ec){_0x145874=_0x145874-0x1ac;let _0x5597ea=_0x3797e8[_0x145874];return _0x5597ea;},a671_0x5483(_0x5ccd6a,_0x2f1c76);}const axios_1=__importDefault(require(a671_0x311392(0x1d1))),GetHandlers_1=require(a671_0x311392(0x209)),logger_1=require(a671_0x311392(0x20e)),lodash_1=require(a671_0x311392(0x1cc)),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),SendPresenceStatus_1=require(a671_0x311392(0x1d3)),SendWhatsAppMedia_1=__importDefault(require(a671_0x311392(0x1f3))),Sentry=__importStar(require(a671_0x311392(0x201))),SendWhatsAppMessage_1=__importDefault(require(a671_0x311392(0x235))),ExtractPhoneNumber_1=require(a671_0x311392(0x1c7)),typebotListener=async({wbot:_0x2a3b6d,msg:_0x4ad81c,ticket:_0x184db6,typebot:_0x12d09e})=>{const _0x5233f1=a671_0x311392;if(_0x4ad81c['key'][_0x5233f1(0x1c3)]===_0x5233f1(0x1f8))return;const {urlN8N:_0x17034f,typebotExpires:_0x6f67fe,typebotKeywordFinish:_0x272240,typebotKeywordRestart:_0x58eea5,typebotUnknownMessage:_0x216780,typebotSlug:_0x1932b5,typebotDelayMessage:_0x5ebe0b,typebotRestartMessage:_0xa345ab}=_0x12d09e;if(_0x4ad81c[_0x5233f1(0x1de)][_0x5233f1(0x1c2)]){console['log'](_0x5233f1(0x1eb));return;}const _0x2f1023=(0x0,ExtractPhoneNumber_1[_0x5233f1(0x1b2)])(_0x4ad81c,_0x2a3b6d);let _0x56e928=(0x0,GetHandlers_1['getBodyMessage'])(_0x4ad81c);console[_0x5233f1(0x1e2)]('[typebotListener]\x20Mensagem\x20recebida:\x20\x22'+_0x56e928+'\x22');async function _0xba3b1c(_0x606577,_0x1f4c3b,_0x1209f0){const _0xdee6e8=_0x5233f1;try{console[_0xdee6e8(0x1e2)](_0xdee6e8(0x1fd)+_0x1209f0);const _0x43d148=JSON[_0xdee6e8(0x22e)]({'isStreamEnabled':!![],'message':_0xdee6e8(0x1bd),'resultId':_0xdee6e8(0x1bd),'isOnlyRegistering':![],'prefilledVariables':{'number':_0x1209f0,'pushName':_0x606577[_0xdee6e8(0x1ed)]||'','remoteJid':_0x184db6?.[_0xdee6e8(0x22c)]?.['remoteJid']}});console[_0xdee6e8(0x1e2)](_0xdee6e8(0x215)+_0x43d148);const _0x3bb966={'method':_0xdee6e8(0x1c6),'maxBodyLength':Infinity,'url':_0x17034f+_0xdee6e8(0x1f5)+_0x1932b5+_0xdee6e8(0x203),'headers':{'Content-Type':_0xdee6e8(0x1b9),'Accept':_0xdee6e8(0x1b9)},'data':_0x43d148};console['log']('[typebotListener]\x20URL\x20da\x20requisição:\x20'+_0x3bb966[_0xdee6e8(0x221)]);const _0xd3eac3=await axios_1['default']['request'](_0x3bb966);return console[_0xdee6e8(0x1e2)](_0xdee6e8(0x1b0)+_0xd3eac3[_0xdee6e8(0x213)]?.[_0xdee6e8(0x227)]),_0xd3eac3[_0xdee6e8(0x213)];}catch(_0x543e85){console[_0xdee6e8(0x1d7)]('[typebotListener]\x20Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:',_0x543e85);_0x543e85[_0xdee6e8(0x204)]&&(console[_0xdee6e8(0x1d7)](_0xdee6e8(0x1fe)+JSON[_0xdee6e8(0x22e)](_0x543e85[_0xdee6e8(0x204)][_0xdee6e8(0x213)])),console[_0xdee6e8(0x1d7)]('[typebotListener]\x20Status\x20de\x20erro:\x20'+_0x543e85[_0xdee6e8(0x204)][_0xdee6e8(0x1ee)]));logger_1[_0xdee6e8(0x1e4)][_0xdee6e8(0x1d5)]({'error':_0x543e85},_0xdee6e8(0x212));throw _0x543e85;}}let _0x4621b6,_0x15c665;try{const _0x4cf481=new Date();_0x4cf481['setMinutes'](_0x4cf481[_0x5233f1(0x20a)]()-Number(_0x6f67fe)),console[_0x5233f1(0x1e2)](_0x5233f1(0x1e7)+_0x6f67fe+_0x5233f1(0x22a)+_0x184db6[_0x5233f1(0x1c0)]);_0x6f67fe>0x0&&_0x184db6['updatedAt']<_0x4cf481&&(console['log']('[typebotListener]\x20Sessão\x20expirada\x20por\x20tempo\x20limite.\x20Resetando\x20sessão.'),await _0x184db6[_0x5233f1(0x1c8)]({'typebotSessionId':null,'chatbot':!![]}),await _0x184db6[_0x5233f1(0x214)]());!_0x184db6['typebotSessionId']?(console['log'](_0x5233f1(0x22b)),_0x15c665=await _0xba3b1c(_0x4ad81c,_0x12d09e,_0x2f1023),_0x4621b6=_0x15c665['sessionId'],console[_0x5233f1(0x1e2)](_0x5233f1(0x1e3)+_0x4621b6),await _0x184db6['update']({'typebotSessionId':_0x4621b6,'useIntegration':!![],'integrationId':_0x12d09e['id'],'chatbot':!![]}),await _0x184db6[_0x5233f1(0x214)]()):(console[_0x5233f1(0x1e2)](_0x5233f1(0x1fa)+_0x184db6[_0x5233f1(0x1be)]),_0x4621b6=_0x184db6[_0x5233f1(0x1be)],_0x15c665=undefined);if(_0x56e928!==_0x272240&&_0x56e928!==_0x58eea5){let _0xd67651,_0x2899e7,_0x1b9652;if(_0x15c665?.[_0x5233f1(0x230)]?.['length']===0x0||_0x15c665===undefined){console[_0x5233f1(0x1e2)](_0x5233f1(0x226)+_0x56e928+'\x22');(!_0x56e928||_0x56e928['trim']()==='')&&(_0x56e928=_0x5233f1(0x205),console[_0x5233f1(0x1e2)](_0x5233f1(0x1c5)+_0x56e928+'\x22'));const _0x6ae7d7=JSON['stringify']({'message':_0x56e928});let _0x5a2594={'method':_0x5233f1(0x1c6),'maxBodyLength':Infinity,'url':_0x17034f+'/api/v1/sessions/'+_0x4621b6+_0x5233f1(0x1f0),'headers':{'Content-Type':_0x5233f1(0x1b9),'Accept':_0x5233f1(0x1b9)},'data':_0x6ae7d7};console['log'](_0x5233f1(0x20d)+_0x5a2594[_0x5233f1(0x221)]+_0x5233f1(0x1ef)+_0x6ae7d7);try{_0xd67651=await axios_1[_0x5233f1(0x1fc)][_0x5233f1(0x1d2)](_0x5a2594),console[_0x5233f1(0x1e2)](_0x5233f1(0x1e9)+JSON[_0x5233f1(0x22e)](_0xd67651[_0x5233f1(0x213)]));if(!_0xd67651[_0x5233f1(0x213)]){console['error'](_0x5233f1(0x1e8));throw new Error(_0x5233f1(0x1ce));}_0x2899e7=_0xd67651['data']?.[_0x5233f1(0x230)],_0x1b9652=_0xd67651[_0x5233f1(0x213)]?.[_0x5233f1(0x1ac)],console['log'](_0x5233f1(0x231)+(_0x2899e7?.['length']||0x0)+_0x5233f1(0x1b5)+(_0x1b9652?'Sim':_0x5233f1(0x1ae))),!_0x1b9652&&(console[_0x5233f1(0x1e2)](_0x5233f1(0x217)),await _0x184db6[_0x5233f1(0x1c8)]({'typebotStatus':!![]}));}catch(_0xdfffba){console[_0x5233f1(0x1d7)](_0x5233f1(0x1ba),_0xdfffba);_0xdfffba[_0x5233f1(0x204)]&&(console[_0x5233f1(0x1d7)]('[typebotListener]\x20Resposta\x20de\x20erro:\x20'+JSON[_0x5233f1(0x22e)](_0xdfffba[_0x5233f1(0x204)][_0x5233f1(0x213)])),console[_0x5233f1(0x1d7)]('[typebotListener]\x20Status\x20de\x20erro:\x20'+_0xdfffba[_0x5233f1(0x204)][_0x5233f1(0x1ee)]));await _0x184db6[_0x5233f1(0x1c8)]({'typebotSessionId':null}),await(0x0,SendWhatsAppMessage_1[_0x5233f1(0x1fc)])({'body':_0x5233f1(0x1b6),'ticket':_0x184db6});return;}}else console[_0x5233f1(0x1e2)](_0x5233f1(0x1b4)),_0x2899e7=_0x15c665?.[_0x5233f1(0x230)],_0x1b9652=_0x15c665?.[_0x5233f1(0x1ac)];if(!_0x2899e7||_0x2899e7?.[_0x5233f1(0x1f7)]===0x0){console[_0x5233f1(0x1e2)](_0x5233f1(0x1f1));if(_0xd67651&&_0xd67651[_0x5233f1(0x213)]&&_0x1b9652===null){console['log'](_0x5233f1(0x228)),await _0x184db6['update']({'chatbot':![],'useIntegration':![]});return;}await(0x0,SendWhatsAppMessage_1[_0x5233f1(0x1fc)])({'body':_0x216780,'ticket':_0x184db6});}else{console[_0x5233f1(0x1e2)](_0x5233f1(0x219)+_0x2899e7[_0x5233f1(0x1f7)]+_0x5233f1(0x1ca));for(const _0x29439f of _0x2899e7){if(_0x29439f[_0x5233f1(0x1d4)]===_0x5233f1(0x1df)){let _0x2e3692='',_0x5afa99=![];console[_0x5233f1(0x1e2)](_0x5233f1(0x20b)+JSON[_0x5233f1(0x22e)](_0x29439f['content']));for(const _0x426722 of _0x29439f['content'][_0x5233f1(0x200)]){for(const _0x14020d of _0x426722[_0x5233f1(0x21c)]){let _0x1a5fcf='';_0x14020d[_0x5233f1(0x1df)]&&(_0x1a5fcf=_0x14020d[_0x5233f1(0x1df)]);if(_0x14020d[_0x5233f1(0x1d4)]&&_0x14020d[_0x5233f1(0x21c)])for(const _0x272bc4 of _0x14020d[_0x5233f1(0x21c)]){let _0x4698a2='';_0x272bc4[_0x5233f1(0x1df)]&&(_0x4698a2=_0x272bc4[_0x5233f1(0x1df)]);if(_0x272bc4[_0x5233f1(0x1d4)]&&_0x272bc4['children'])for(const _0x44abd1 of _0x272bc4['children']){let _0x198584='';_0x44abd1[_0x5233f1(0x1df)]&&(_0x198584=_0x44abd1[_0x5233f1(0x1df)]);_0x44abd1[_0x5233f1(0x21d)]&&(_0x198584='*'+_0x198584+'*');_0x44abd1[_0x5233f1(0x1c9)]&&(_0x198584='_'+_0x198584+'_');_0x44abd1['underline']&&(_0x198584='~'+_0x198584+'~');if(_0x44abd1[_0x5233f1(0x221)]){const _0x65a4c0=_0x44abd1['children'][0x0]?.[_0x5233f1(0x1df)]||_0x5233f1(0x1bb);_0x198584='['+_0x65a4c0+']('+_0x44abd1[_0x5233f1(0x221)]+')',_0x5afa99=!![];}_0x2e3692+=_0x198584;}_0x272bc4[_0x5233f1(0x21d)]&&(_0x4698a2='*'+_0x4698a2+'*');_0x272bc4[_0x5233f1(0x1c9)]&&(_0x4698a2='_'+_0x4698a2+'_');_0x272bc4['underline']&&(_0x4698a2='~'+_0x4698a2+'~');if(_0x272bc4['url']){const _0x447911=_0x272bc4['children'][0x0]?.['text']||_0x5233f1(0x1bb);_0x4698a2='['+_0x447911+']('+_0x272bc4[_0x5233f1(0x221)]+')',_0x5afa99=!![];}_0x2e3692+=_0x4698a2;}_0x14020d[_0x5233f1(0x21d)]&&(_0x1a5fcf='*'+_0x1a5fcf+'*');_0x14020d[_0x5233f1(0x1c9)]&&(_0x1a5fcf='_'+_0x1a5fcf+'_');_0x14020d[_0x5233f1(0x1b1)]&&(_0x1a5fcf='~'+_0x1a5fcf+'~');if(_0x14020d[_0x5233f1(0x221)]){const _0x3a395e=_0x14020d['children'][0x0]?.[_0x5233f1(0x1df)]||'link';_0x1a5fcf='['+_0x3a395e+']('+_0x14020d[_0x5233f1(0x221)]+')',_0x5afa99=!![];}_0x2e3692+=_0x1a5fcf;}_0x2e3692+='\x0a';}_0x2e3692=_0x2e3692[_0x5233f1(0x1f6)]('**','')[_0x5233f1(0x1f6)](/\n$/,'');_0x2e3692===_0x5233f1(0x232)&&(_0x2e3692=_0x216780);if(_0x2e3692[_0x5233f1(0x1e1)]('#')){let _0x2b5e73=_0x2e3692[_0x5233f1(0x1f6)]('#','');try{console['log'](_0x5233f1(0x22d)+_0x2b5e73);let _0x50915a=JSON['parse'](_0x2b5e73);if(_0x50915a[_0x5233f1(0x224)]&&(0x0,lodash_1[_0x5233f1(0x22f)])(_0x50915a[_0x5233f1(0x1cf)])&&(0x0,lodash_1[_0x5233f1(0x22f)])(_0x50915a[_0x5233f1(0x207)])){console[_0x5233f1(0x1e2)](_0x5233f1(0x208)),await _0x184db6[_0x5233f1(0x1c8)]({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1['isNil'])(_0x50915a[_0x5233f1(0x207)])&&_0x50915a[_0x5233f1(0x207)]>0x0&&(0x0,lodash_1['isNil'])(_0x50915a['userId'])){console[_0x5233f1(0x1e2)](_0x5233f1(0x1e0)+_0x50915a['queueId']),await(0x0,UpdateTicketService_1[_0x5233f1(0x1fc)])({'ticketData':{'queueId':_0x50915a[_0x5233f1(0x207)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x184db6['id'],'companyId':_0x184db6[_0x5233f1(0x1b3)]});return;}if(!(0x0,lodash_1[_0x5233f1(0x22f)])(_0x50915a[_0x5233f1(0x207)])&&_0x50915a[_0x5233f1(0x207)]>0x0&&!(0x0,lodash_1[_0x5233f1(0x22f)])(_0x50915a[_0x5233f1(0x1cf)])&&_0x50915a[_0x5233f1(0x1cf)]>0x0){console['log'](_0x5233f1(0x1f2)+_0x50915a[_0x5233f1(0x207)]+'\x20e\x20usuário\x20'+_0x50915a[_0x5233f1(0x1cf)]),await(0x0,UpdateTicketService_1[_0x5233f1(0x1fc)])({'ticketData':{'queueId':_0x50915a[_0x5233f1(0x207)],'userId':_0x50915a['userId'],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x184db6['id'],'companyId':_0x184db6[_0x5233f1(0x1b3)]});return;}}catch(_0x162591){console[_0x5233f1(0x1d7)](_0x5233f1(0x1bf),_0x162591);throw _0x162591;}}console[_0x5233f1(0x1e2)](_0x5233f1(0x1d6)+_0x2e3692[_0x5233f1(0x20c)](0x0,0x32)+(_0x2e3692['length']>0x32?_0x5233f1(0x21b):'')+'\x22'),await(0x0,SendPresenceStatus_1[_0x5233f1(0x21e)])(_0x2a3b6d,_0x4ad81c[_0x5233f1(0x1de)]['remoteJid'],_0x5ebe0b),await(0x0,SendWhatsAppMessage_1[_0x5233f1(0x1fc)])({'body':_0x2e3692,'ticket':_0x184db6});}if(_0x29439f[_0x5233f1(0x1d4)]==='audio'){console['log'](_0x5233f1(0x20f)+_0x29439f['content'][_0x5233f1(0x221)]),await(0x0,SendPresenceStatus_1[_0x5233f1(0x21e)])(_0x2a3b6d,_0x4ad81c[_0x5233f1(0x1de)][_0x5233f1(0x1c3)],_0x5ebe0b);try{await(0x0,SendWhatsAppMedia_1[_0x5233f1(0x1fc)])({'media':_0x29439f[_0x5233f1(0x210)][_0x5233f1(0x221)],'ticket':_0x184db6}),console[_0x5233f1(0x1e2)](_0x5233f1(0x229));}catch(_0x2bd24d){console[_0x5233f1(0x1d7)](_0x5233f1(0x202),_0x2bd24d),Sentry[_0x5233f1(0x1db)](_0x2bd24d);throw _0x2bd24d;}}if(_0x29439f[_0x5233f1(0x1d4)]==='image'){console['log'](_0x5233f1(0x216)+_0x29439f[_0x5233f1(0x210)][_0x5233f1(0x221)]),await(0x0,SendPresenceStatus_1[_0x5233f1(0x21e)])(_0x2a3b6d,_0x4ad81c[_0x5233f1(0x1de)][_0x5233f1(0x1c3)],_0x5ebe0b);try{await(0x0,SendWhatsAppMedia_1[_0x5233f1(0x1fc)])({'media':_0x29439f[_0x5233f1(0x210)][_0x5233f1(0x221)],'ticket':_0x184db6}),console[_0x5233f1(0x1e2)](_0x5233f1(0x223));}catch(_0xb9de20){console['error'](_0x5233f1(0x1bc),_0xb9de20),Sentry[_0x5233f1(0x1db)](_0xb9de20);throw _0xb9de20;}}if(_0x29439f[_0x5233f1(0x1d4)]==='document'){console[_0x5233f1(0x1e2)](_0x5233f1(0x1ea)+_0x29439f['content']['url']),await(0x0,SendPresenceStatus_1[_0x5233f1(0x21e)])(_0x2a3b6d,_0x4ad81c[_0x5233f1(0x1de)]['remoteJid'],_0x5ebe0b);try{await(0x0,SendWhatsAppMedia_1[_0x5233f1(0x1fc)])({'media':_0x29439f[_0x5233f1(0x210)][_0x5233f1(0x221)],'ticket':_0x184db6}),console['log']('[typebotListener]\x20Documento\x20enviado\x20com\x20sucesso.');}catch(_0x4d5bc9){console['error']('[typebotListener]\x20Erro\x20ao\x20enviar\x20documento:',_0x4d5bc9),Sentry[_0x5233f1(0x1db)](_0x4d5bc9);throw _0x4d5bc9;}}}}}_0x56e928===_0x58eea5&&(console[_0x5233f1(0x1e2)](_0x5233f1(0x234)),await _0x184db6[_0x5233f1(0x1c8)]({'chatbot':!![],'typebotSessionId':null}),await _0x184db6[_0x5233f1(0x214)](),await(0x0,SendWhatsAppMessage_1[_0x5233f1(0x1fc)])({'body':_0xa345ab,'ticket':_0x184db6}));if(_0x56e928===_0x272240){console[_0x5233f1(0x1e2)](_0x5233f1(0x211)),await(0x0,UpdateTicketService_1[_0x5233f1(0x1fc)])({'ticketData':{'status':'closed','useIntegration':![],'integrationId':null},'ticketId':_0x184db6['id'],'companyId':_0x184db6[_0x5233f1(0x1b3)]});return;}}catch(_0x5484f8){console[_0x5233f1(0x1d7)](_0x5233f1(0x21a),_0x5484f8);_0x5484f8[_0x5233f1(0x204)]&&(console['error']('[typebotListener]\x20Resposta\x20de\x20erro:\x20'+JSON[_0x5233f1(0x22e)](_0x5484f8[_0x5233f1(0x204)][_0x5233f1(0x213)])),console[_0x5233f1(0x1d7)]('[typebotListener]\x20Status\x20de\x20erro:\x20'+_0x5484f8['response'][_0x5233f1(0x1ee)]));logger_1['logger'][_0x5233f1(0x1d5)]({'error':_0x5484f8},_0x5233f1(0x220)),await _0x184db6[_0x5233f1(0x1c8)]({'typebotSessionId':null});try{await(0x0,SendWhatsAppMessage_1[_0x5233f1(0x1fc)])({'body':'Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','ticket':_0x184db6});}catch(_0xa03f6e){console[_0x5233f1(0x1d7)]('[typebotListener]\x20Erro\x20ao\x20enviar\x20mensagem\x20de\x20erro:',_0xa03f6e);}}};exports[a671_0x311392(0x1fc)]=typebotListener;