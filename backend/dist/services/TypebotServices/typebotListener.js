'use strict';const a563_0x1d9c6d=a563_0x4f03;function a563_0xd989(){const _0x4a6132=['getPhoneNumberFromMessage','__createBinding','trim','underline','Sim','prototype','[typebotListener]\x20Imagem\x20enviada\x20com\x20sucesso.','[typebotListener]\x20Documento\x20enviado\x20com\x20sucesso.','getOwnPropertyNames','[typebotListener]\x20Mensagem\x20enviada\x20pelo\x20sistema.\x20Ignorando.','8013rSiLoX','captureException','input','3962262EODmAb','updatedAt','/api/v1/sessions/','audio','[typebotListener]\x20Status\x20de\x20erro:\x20','/startChat','[typebotListener]\x20Sessão\x20criada\x20com\x20sucesso.\x20SessionID:\x20','log','@sentry/node','[typebotListener]\x20Processando\x20comando\x20de\x20finalização','Invalid\x20message.\x20Please,\x20try\x20again.','getBodyMessage','status','stringify','apply','SendPresenceStatus','companyId','/continueChat','configurable','axios','__importStar','url','[typebotListener]\x20Enviando\x20requisição\x20para\x20continuar\x20chat.\x20URL:\x20','[typebotListener]\x20Nova\x20sessão\x20criada:\x20','[typebotListener]\x20Mensagem\x20recebida:\x20\x22','typebotSessionId','../../utils/logger','[typebotListener]\x20Áudio\x20enviado\x20com\x20sucesso.','fromMe','info','string','../WbotServices/SendWhatsAppMedia','[typebotListener]\x20Mensagens\x20recebidas:\x20','4551723KZXoIG','logger','data','/api/v1/typebots/','[typebotListener]\x20Erro\x20ao\x20enviar\x20documento:','search','richText','create','../TicketServices/UpdateTicketService','userId','response','[typebotListener]\x20Redirecionando\x20para\x20fila\x20','../WbotServices/GetHandlers','[typebotListener]\x20Redirecionando\x20para\x20fila:\x20','substring','(((.+)+)+)+$',',\x20Dados:\x20','closed','pushName','[typebotListener]\x20Resposta\x20vazia\x20do\x20Typebot','2700145NgVvtX','[typebotListener]\x20Processando\x20comando\x20de\x20reinício','post','image','type','isNil','[typebotListener]\x20Erro\x20ao\x20enviar\x20áudio:','[typebotListener]\x20Resposta\x20de\x20erro:\x20','../WbotServices/SendWhatsAppMessage','Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','[typebotListener]\x20Processando\x20mensagem\x20de\x20imagem:\x20','messages','1188530WnnFER','[typebotListener]\x20Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:','[typebotListener]\x20Erro\x20ao\x20enviar\x20mensagem\x20de\x20erro:','Error\x20on\x20typebotListener','665947RhUQKh','[typebotListener]\x20Erro\x20ao\x20processar\x20gatilho\x20JSON:',',\x20updatedAt:\x20','status@broadcast','length','writable','...','[typebotListener]\x20Processando\x20gatilho\x20JSON:\x20','[typebotListener]\x20Verificando\x20expiração\x20da\x20sessão.\x20typebotExpires:\x20','reload','request','bold','1796068nQIrol','[typebotListener]\x20Sessão\x20expirada\x20por\x20tempo\x20limite.\x20Resetando\x20sessão.','[typebotListener]\x20Enviando\x20mensagem\x20formatada:\x20\x22','[typebotListener]\x20Usando\x20sessão\x20existente:\x20','call','__importDefault','children','content','contact','\x20e\x20usuário\x20','__setModuleDefault','italic','update','application/json','[typebotListener]\x20Processando\x20mensagem\x20de\x20áudio:\x20','atualizando\x20typebotStatus...','default','../../helpers/ExtractPhoneNumber','remoteJid','[typebotListener]\x20Resposta\x20recebida\x20do\x20Typebot:\x20','8bzfzCz','__esModule','[typebotListener]\x20Processando\x20mensagem\x20de\x20documento:\x20','[typebotListener]\x20Erro\x20ao\x20enviar\x20imagem:','error','key','link','toString','Erro\x20ao\x20criar\x20sessão\x20do\x20typebot','716OcLvZB','text','[typebotListener]\x20URL\x20da\x20requisição:\x20','hasOwnProperty','sessionId','queueId','replace','getMinutes'];a563_0xd989=function(){return _0x4a6132;};return a563_0xd989();}(function(_0x498801,_0x1b503f){const _0x1982a5=a563_0x4f03,_0x5d13eb=_0x498801();while(!![]){try{const _0x7306ee=-parseInt(_0x1982a5(0xea))/0x1+parseInt(_0x1982a5(0x113))/0x2*(parseInt(_0x1982a5(0x125))/0x3)+-parseInt(_0x1982a5(0xf6))/0x4+-parseInt(_0x1982a5(0xda))/0x5+parseInt(_0x1982a5(0x128))/0x6+parseInt(_0x1982a5(0xe6))/0x7*(parseInt(_0x1982a5(0x10a))/0x8)+parseInt(_0x1982a5(0xc6))/0x9;if(_0x7306ee===_0x1b503f)break;else _0x5d13eb['push'](_0x5d13eb['shift']());}catch(_0x249c11){_0x5d13eb['push'](_0x5d13eb['shift']());}}}(a563_0xd989,0x9b8d3));var __createBinding=this&&this[a563_0x1d9c6d(0x11c)]||(Object['create']?function(_0x2161db,_0x22f7ed,_0x573177,_0x178bb1){const _0x511d78=a563_0x1d9c6d;if(_0x178bb1===undefined)_0x178bb1=_0x573177;var _0x2494e2=Object['getOwnPropertyDescriptor'](_0x22f7ed,_0x573177);(!_0x2494e2||('get'in _0x2494e2?!_0x22f7ed[_0x511d78(0x10b)]:_0x2494e2[_0x511d78(0xef)]||_0x2494e2[_0x511d78(0xb7)]))&&(_0x2494e2={'enumerable':!![],'get':function(){return _0x22f7ed[_0x573177];}}),Object['defineProperty'](_0x2161db,_0x178bb1,_0x2494e2);}:function(_0x24a77e,_0x4e7cd4,_0x2dd18a,_0x5577a4){if(_0x5577a4===undefined)_0x5577a4=_0x2dd18a;_0x24a77e[_0x5577a4]=_0x4e7cd4[_0x2dd18a];}),__setModuleDefault=this&&this[a563_0x1d9c6d(0x100)]||(Object[a563_0x1d9c6d(0xcd)]?function(_0x4eb511,_0x5d8ed1){const _0x8ad28e=a563_0x1d9c6d;Object['defineProperty'](_0x4eb511,_0x8ad28e(0x106),{'enumerable':!![],'value':_0x5d8ed1});}:function(_0x467156,_0x2f1c1c){const _0x1cb2d4=a563_0x1d9c6d;_0x467156[_0x1cb2d4(0x106)]=_0x2f1c1c;}),__importStar=this&&this[a563_0x1d9c6d(0xb9)]||(function(){const _0x3681b1=(function(){let _0x340ab6=!![];return function(_0x255994,_0x43fa05){const _0x56845c=_0x340ab6?function(){const _0x5c4964=a563_0x4f03;if(_0x43fa05){const _0x414318=_0x43fa05[_0x5c4964(0xb3)](_0x255994,arguments);return _0x43fa05=null,_0x414318;}}:function(){};return _0x340ab6=![],_0x56845c;};}()),_0x1aaf86=_0x3681b1(this,function(){const _0x3db70e=a563_0x4f03;return _0x1aaf86[_0x3db70e(0x111)]()[_0x3db70e(0xcb)](_0x3db70e(0xd5))['toString']()['constructor'](_0x1aaf86)[_0x3db70e(0xcb)](_0x3db70e(0xd5));});_0x1aaf86();var _0x37295b=function(_0x44f063){const _0x908dc4=a563_0x4f03;return _0x37295b=Object[_0x908dc4(0x123)]||function(_0x3a96b0){const _0x2cdf84=_0x908dc4;var _0x530638=[];for(var _0x344b32 in _0x3a96b0)if(Object[_0x2cdf84(0x120)][_0x2cdf84(0x116)][_0x2cdf84(0xfa)](_0x3a96b0,_0x344b32))_0x530638[_0x530638[_0x2cdf84(0xee)]]=_0x344b32;return _0x530638;},_0x37295b(_0x44f063);};return function(_0x1ab852){const _0xca00f7=a563_0x4f03;if(_0x1ab852&&_0x1ab852[_0xca00f7(0x10b)])return _0x1ab852;var _0x2fcfca={};if(_0x1ab852!=null){for(var _0x485606=_0x37295b(_0x1ab852),_0x18eabc=0x0;_0x18eabc<_0x485606['length'];_0x18eabc++)if(_0x485606[_0x18eabc]!==_0xca00f7(0x106))__createBinding(_0x2fcfca,_0x1ab852,_0x485606[_0x18eabc]);}return __setModuleDefault(_0x2fcfca,_0x1ab852),_0x2fcfca;};}()),__importDefault=this&&this[a563_0x1d9c6d(0xfb)]||function(_0x56b2f1){const _0x4b6128=a563_0x1d9c6d;return _0x56b2f1&&_0x56b2f1[_0x4b6128(0x10b)]?_0x56b2f1:{'default':_0x56b2f1};};Object['defineProperty'](exports,a563_0x1d9c6d(0x10b),{'value':!![]});const axios_1=__importDefault(require(a563_0x1d9c6d(0xb8))),GetHandlers_1=require(a563_0x1d9c6d(0xd2)),logger_1=require(a563_0x1d9c6d(0xbf)),lodash_1=require('lodash'),UpdateTicketService_1=__importDefault(require(a563_0x1d9c6d(0xce))),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus'),SendWhatsAppMedia_1=__importDefault(require(a563_0x1d9c6d(0xc4))),Sentry=__importStar(require(a563_0x1d9c6d(0xad))),SendWhatsAppMessage_1=__importDefault(require(a563_0x1d9c6d(0xe2))),ExtractPhoneNumber_1=require(a563_0x1d9c6d(0x107)),typebotListener=async({wbot:_0x4e1df4,msg:_0x5a5a35,ticket:_0x12e4d6,typebot:_0x28c232})=>{const _0x10b103=a563_0x1d9c6d;if(_0x5a5a35[_0x10b103(0x10f)][_0x10b103(0x108)]===_0x10b103(0xed))return;const {urlN8N:_0x124425,typebotExpires:_0x2d803a,typebotKeywordFinish:_0x487f67,typebotKeywordRestart:_0x4fffc8,typebotUnknownMessage:_0x5436c2,typebotSlug:_0x59e366,typebotDelayMessage:_0x222495,typebotRestartMessage:_0x30eefe}=_0x28c232;if(_0x5a5a35[_0x10b103(0x10f)][_0x10b103(0xc1)]){console[_0x10b103(0xac)](_0x10b103(0x124));return;}const _0x1a4a52=(0x0,ExtractPhoneNumber_1[_0x10b103(0x11b)])(_0x5a5a35,_0x4e1df4);let _0x2b858a=(0x0,GetHandlers_1[_0x10b103(0xb0)])(_0x5a5a35);console[_0x10b103(0xac)](_0x10b103(0xbd)+_0x2b858a+'\x22');async function _0x471c79(_0x43116a,_0x1a220f,_0x402553){const _0x3c15fd=_0x10b103;try{console[_0x3c15fd(0xac)]('[typebotListener]\x20Criando\x20nova\x20sessão\x20para\x20o\x20número:\x20'+_0x402553);const _0x5d9c7a=JSON['stringify']({'isStreamEnabled':!![],'message':_0x3c15fd(0xc3),'resultId':'string','isOnlyRegistering':![],'prefilledVariables':{'number':_0x402553,'pushName':_0x43116a[_0x3c15fd(0xd8)]||'','remoteJid':_0x12e4d6?.[_0x3c15fd(0xfe)]?.['remoteJid']}});console[_0x3c15fd(0xac)]('[typebotListener]\x20Dados\x20da\x20requisição\x20para\x20criar\x20sessão:\x20'+_0x5d9c7a);const _0x4303e3={'method':_0x3c15fd(0xdc),'maxBodyLength':Infinity,'url':_0x124425+_0x3c15fd(0xc9)+_0x59e366+_0x3c15fd(0xaa),'headers':{'Content-Type':_0x3c15fd(0x103),'Accept':_0x3c15fd(0x103)},'data':_0x5d9c7a};console[_0x3c15fd(0xac)](_0x3c15fd(0x115)+_0x4303e3[_0x3c15fd(0xba)]);const _0x45fd60=await axios_1[_0x3c15fd(0x106)][_0x3c15fd(0xf4)](_0x4303e3);return console[_0x3c15fd(0xac)](_0x3c15fd(0xab)+_0x45fd60[_0x3c15fd(0xc8)]?.[_0x3c15fd(0x117)]),_0x45fd60[_0x3c15fd(0xc8)];}catch(_0x3062c8){console['error'](_0x3c15fd(0xe7),_0x3062c8);_0x3062c8[_0x3c15fd(0xd0)]&&(console[_0x3c15fd(0x10e)](_0x3c15fd(0xe1)+JSON[_0x3c15fd(0xb2)](_0x3062c8[_0x3c15fd(0xd0)][_0x3c15fd(0xc8)])),console[_0x3c15fd(0x10e)]('[typebotListener]\x20Status\x20de\x20erro:\x20'+_0x3062c8[_0x3c15fd(0xd0)][_0x3c15fd(0xb1)]));logger_1[_0x3c15fd(0xc7)]['info']({'error':_0x3062c8},_0x3c15fd(0x112));throw _0x3062c8;}}let _0x31d8fe,_0x345bd8;try{const _0x3b0044=new Date();_0x3b0044['setMinutes'](_0x3b0044[_0x10b103(0x11a)]()-Number(_0x2d803a)),console['log'](_0x10b103(0xf2)+_0x2d803a+_0x10b103(0xec)+_0x12e4d6[_0x10b103(0x129)]);_0x2d803a>0x0&&_0x12e4d6[_0x10b103(0x129)]<_0x3b0044&&(console[_0x10b103(0xac)](_0x10b103(0xf7)),await _0x12e4d6[_0x10b103(0x102)]({'typebotSessionId':null,'chatbot':!![]}),await _0x12e4d6[_0x10b103(0xf3)]());!_0x12e4d6[_0x10b103(0xbe)]?(console[_0x10b103(0xac)]('[typebotListener]\x20Ticket\x20sem\x20sessão\x20ativa.\x20Criando\x20nova\x20sessão.'),_0x345bd8=await _0x471c79(_0x5a5a35,_0x28c232,_0x1a4a52),_0x31d8fe=_0x345bd8[_0x10b103(0x117)],console[_0x10b103(0xac)](_0x10b103(0xbc)+_0x31d8fe),await _0x12e4d6['update']({'typebotSessionId':_0x31d8fe,'useIntegration':!![],'integrationId':_0x28c232['id'],'chatbot':!![]}),await _0x12e4d6['reload']()):(console['log'](_0x10b103(0xf9)+_0x12e4d6['typebotSessionId']),_0x31d8fe=_0x12e4d6[_0x10b103(0xbe)],_0x345bd8=undefined);if(_0x2b858a!==_0x487f67&&_0x2b858a!==_0x4fffc8){let _0x30abe6,_0xa7be59,_0xb52a2c;if(_0x345bd8?.['messages']?.[_0x10b103(0xee)]===0x0||_0x345bd8===undefined){console[_0x10b103(0xac)]('[typebotListener]\x20Continuando\x20conversa\x20com\x20a\x20mensagem:\x20\x22'+_0x2b858a+'\x22');(!_0x2b858a||_0x2b858a[_0x10b103(0x11d)]()==='')&&(_0x2b858a='Mensagem\x20vazia',console['log']('[typebotListener]\x20Mensagem\x20vazia\x20detectada,\x20usando\x20texto\x20padrão:\x20\x22'+_0x2b858a+'\x22'));const _0x2c0283=JSON[_0x10b103(0xb2)]({'message':_0x2b858a});let _0x5ba909={'method':_0x10b103(0xdc),'maxBodyLength':Infinity,'url':_0x124425+_0x10b103(0x12a)+_0x31d8fe+_0x10b103(0xb6),'headers':{'Content-Type':_0x10b103(0x103),'Accept':'application/json'},'data':_0x2c0283};console[_0x10b103(0xac)](_0x10b103(0xbb)+_0x5ba909[_0x10b103(0xba)]+_0x10b103(0xd6)+_0x2c0283);try{_0x30abe6=await axios_1[_0x10b103(0x106)][_0x10b103(0xf4)](_0x5ba909),console[_0x10b103(0xac)](_0x10b103(0x109)+JSON[_0x10b103(0xb2)](_0x30abe6[_0x10b103(0xc8)]));if(!_0x30abe6[_0x10b103(0xc8)]){console[_0x10b103(0x10e)](_0x10b103(0xd9));throw new Error('Resposta\x20vazia\x20do\x20Typebot');}_0xa7be59=_0x30abe6['data']?.[_0x10b103(0xe5)],_0xb52a2c=_0x30abe6[_0x10b103(0xc8)]?.[_0x10b103(0x127)],console[_0x10b103(0xac)](_0x10b103(0xc5)+(_0xa7be59?.[_0x10b103(0xee)]||0x0)+',\x20Input\x20recebido:\x20'+(_0xb52a2c?_0x10b103(0x11f):'Não')),!_0xb52a2c&&(console['log'](_0x10b103(0x105)),await _0x12e4d6[_0x10b103(0x102)]({'typebotStatus':!![]}));}catch(_0x5840f2){console[_0x10b103(0x10e)]('[typebotListener]\x20Erro\x20ao\x20continuar\x20chat:',_0x5840f2);_0x5840f2[_0x10b103(0xd0)]&&(console[_0x10b103(0x10e)]('[typebotListener]\x20Resposta\x20de\x20erro:\x20'+JSON[_0x10b103(0xb2)](_0x5840f2[_0x10b103(0xd0)][_0x10b103(0xc8)])),console[_0x10b103(0x10e)]('[typebotListener]\x20Status\x20de\x20erro:\x20'+_0x5840f2[_0x10b103(0xd0)][_0x10b103(0xb1)]));await _0x12e4d6[_0x10b103(0x102)]({'typebotSessionId':null}),await(0x0,SendWhatsAppMessage_1[_0x10b103(0x106)])({'body':'Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','ticket':_0x12e4d6});return;}}else console[_0x10b103(0xac)]('[typebotListener]\x20Usando\x20dados\x20da\x20sessão\x20recém-criada'),_0xa7be59=_0x345bd8?.[_0x10b103(0xe5)],_0xb52a2c=_0x345bd8?.[_0x10b103(0x127)];if(!_0xa7be59||_0xa7be59?.[_0x10b103(0xee)]===0x0){console[_0x10b103(0xac)]('[typebotListener]\x20Nenhuma\x20mensagem\x20recebida.\x20Verificando\x20status\x20do\x20fluxo.');if(_0x30abe6&&_0x30abe6[_0x10b103(0xc8)]&&_0xb52a2c===null){console[_0x10b103(0xac)]('[typebotListener]\x20Fim\x20natural\x20do\x20fluxo\x20detectado.\x20Finalizando\x20sem\x20erro.'),await _0x12e4d6[_0x10b103(0x102)]({'chatbot':![],'useIntegration':![]});return;}await(0x0,SendWhatsAppMessage_1[_0x10b103(0x106)])({'body':_0x5436c2,'ticket':_0x12e4d6});}else{console['log']('[typebotListener]\x20Processando\x20'+_0xa7be59[_0x10b103(0xee)]+'\x20mensagens');for(const _0x24edb5 of _0xa7be59){if(_0x24edb5[_0x10b103(0xde)]===_0x10b103(0x114)){let _0x5a673c='',_0x11dbb7=![];console['log']('[typebotListener]\x20Processando\x20mensagem\x20de\x20texto:\x20'+JSON[_0x10b103(0xb2)](_0x24edb5[_0x10b103(0xfd)]));for(const _0x2ed898 of _0x24edb5['content'][_0x10b103(0xcc)]){for(const _0x53922f of _0x2ed898[_0x10b103(0xfc)]){let _0x3ce1bc='';_0x53922f[_0x10b103(0x114)]&&(_0x3ce1bc=_0x53922f[_0x10b103(0x114)]);if(_0x53922f['type']&&_0x53922f[_0x10b103(0xfc)])for(const _0x812cda of _0x53922f[_0x10b103(0xfc)]){let _0x25a5be='';_0x812cda['text']&&(_0x25a5be=_0x812cda[_0x10b103(0x114)]);if(_0x812cda[_0x10b103(0xde)]&&_0x812cda[_0x10b103(0xfc)])for(const _0x5903c6 of _0x812cda['children']){let _0x330f03='';_0x5903c6[_0x10b103(0x114)]&&(_0x330f03=_0x5903c6['text']);_0x5903c6[_0x10b103(0xf5)]&&(_0x330f03='*'+_0x330f03+'*');_0x5903c6[_0x10b103(0x101)]&&(_0x330f03='_'+_0x330f03+'_');_0x5903c6[_0x10b103(0x11e)]&&(_0x330f03='~'+_0x330f03+'~');if(_0x5903c6['url']){const _0x153949=_0x5903c6[_0x10b103(0xfc)][0x0]?.[_0x10b103(0x114)]||_0x10b103(0x110);_0x330f03='['+_0x153949+']('+_0x5903c6[_0x10b103(0xba)]+')',_0x11dbb7=!![];}_0x5a673c+=_0x330f03;}_0x812cda[_0x10b103(0xf5)]&&(_0x25a5be='*'+_0x25a5be+'*');_0x812cda[_0x10b103(0x101)]&&(_0x25a5be='_'+_0x25a5be+'_');_0x812cda[_0x10b103(0x11e)]&&(_0x25a5be='~'+_0x25a5be+'~');if(_0x812cda[_0x10b103(0xba)]){const _0x388dee=_0x812cda['children'][0x0]?.[_0x10b103(0x114)]||_0x10b103(0x110);_0x25a5be='['+_0x388dee+']('+_0x812cda[_0x10b103(0xba)]+')',_0x11dbb7=!![];}_0x5a673c+=_0x25a5be;}_0x53922f[_0x10b103(0xf5)]&&(_0x3ce1bc='*'+_0x3ce1bc+'*');_0x53922f[_0x10b103(0x101)]&&(_0x3ce1bc='_'+_0x3ce1bc+'_');_0x53922f[_0x10b103(0x11e)]&&(_0x3ce1bc='~'+_0x3ce1bc+'~');if(_0x53922f[_0x10b103(0xba)]){const _0x337dfd=_0x53922f[_0x10b103(0xfc)][0x0]?.[_0x10b103(0x114)]||_0x10b103(0x110);_0x3ce1bc='['+_0x337dfd+']('+_0x53922f[_0x10b103(0xba)]+')',_0x11dbb7=!![];}_0x5a673c+=_0x3ce1bc;}_0x5a673c+='\x0a';}_0x5a673c=_0x5a673c['replace']('**','')[_0x10b103(0x119)](/\n$/,'');_0x5a673c===_0x10b103(0xaf)&&(_0x5a673c=_0x5436c2);if(_0x5a673c['startsWith']('#')){let _0xaa4ee0=_0x5a673c[_0x10b103(0x119)]('#','');try{console['log'](_0x10b103(0xf1)+_0xaa4ee0);let _0x482584=JSON['parse'](_0xaa4ee0);if(_0x482584['stopBot']&&(0x0,lodash_1['isNil'])(_0x482584[_0x10b103(0xcf)])&&(0x0,lodash_1[_0x10b103(0xdf)])(_0x482584[_0x10b103(0x118)])){console[_0x10b103(0xac)]('[typebotListener]\x20Executando\x20comando\x20stopBot'),await _0x12e4d6[_0x10b103(0x102)]({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1[_0x10b103(0xdf)])(_0x482584[_0x10b103(0x118)])&&_0x482584[_0x10b103(0x118)]>0x0&&(0x0,lodash_1[_0x10b103(0xdf)])(_0x482584[_0x10b103(0xcf)])){console[_0x10b103(0xac)](_0x10b103(0xd3)+_0x482584[_0x10b103(0x118)]),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x482584['queueId'],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x12e4d6['id'],'companyId':_0x12e4d6[_0x10b103(0xb5)]});return;}if(!(0x0,lodash_1[_0x10b103(0xdf)])(_0x482584[_0x10b103(0x118)])&&_0x482584[_0x10b103(0x118)]>0x0&&!(0x0,lodash_1[_0x10b103(0xdf)])(_0x482584[_0x10b103(0xcf)])&&_0x482584[_0x10b103(0xcf)]>0x0){console['log'](_0x10b103(0xd1)+_0x482584['queueId']+_0x10b103(0xff)+_0x482584[_0x10b103(0xcf)]),await(0x0,UpdateTicketService_1[_0x10b103(0x106)])({'ticketData':{'queueId':_0x482584['queueId'],'userId':_0x482584[_0x10b103(0xcf)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x12e4d6['id'],'companyId':_0x12e4d6[_0x10b103(0xb5)]});return;}}catch(_0x41df06){console[_0x10b103(0x10e)](_0x10b103(0xeb),_0x41df06);throw _0x41df06;}}console[_0x10b103(0xac)](_0x10b103(0xf8)+_0x5a673c[_0x10b103(0xd4)](0x0,0x32)+(_0x5a673c['length']>0x32?_0x10b103(0xf0):'')+'\x22'),await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x4e1df4,_0x5a5a35[_0x10b103(0x10f)]['remoteJid'],_0x222495),await(0x0,SendWhatsAppMessage_1[_0x10b103(0x106)])({'body':_0x5a673c,'ticket':_0x12e4d6});}if(_0x24edb5[_0x10b103(0xde)]===_0x10b103(0x12b)){console[_0x10b103(0xac)](_0x10b103(0x104)+_0x24edb5['content'][_0x10b103(0xba)]),await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x4e1df4,_0x5a5a35[_0x10b103(0x10f)][_0x10b103(0x108)],_0x222495);try{await(0x0,SendWhatsAppMedia_1[_0x10b103(0x106)])({'media':_0x24edb5['content'][_0x10b103(0xba)],'ticket':_0x12e4d6}),console[_0x10b103(0xac)](_0x10b103(0xc0));}catch(_0x32b665){console[_0x10b103(0x10e)](_0x10b103(0xe0),_0x32b665),Sentry[_0x10b103(0x126)](_0x32b665);throw _0x32b665;}}if(_0x24edb5[_0x10b103(0xde)]===_0x10b103(0xdd)){console[_0x10b103(0xac)](_0x10b103(0xe4)+_0x24edb5['content'][_0x10b103(0xba)]),await(0x0,SendPresenceStatus_1[_0x10b103(0xb4)])(_0x4e1df4,_0x5a5a35['key']['remoteJid'],_0x222495);try{await(0x0,SendWhatsAppMedia_1[_0x10b103(0x106)])({'media':_0x24edb5['content'][_0x10b103(0xba)],'ticket':_0x12e4d6}),console['log'](_0x10b103(0x121));}catch(_0x8184ed){console[_0x10b103(0x10e)](_0x10b103(0x10d),_0x8184ed),Sentry['captureException'](_0x8184ed);throw _0x8184ed;}}if(_0x24edb5[_0x10b103(0xde)]==='document'){console[_0x10b103(0xac)](_0x10b103(0x10c)+_0x24edb5[_0x10b103(0xfd)][_0x10b103(0xba)]),await(0x0,SendPresenceStatus_1[_0x10b103(0xb4)])(_0x4e1df4,_0x5a5a35[_0x10b103(0x10f)][_0x10b103(0x108)],_0x222495);try{await(0x0,SendWhatsAppMedia_1[_0x10b103(0x106)])({'media':_0x24edb5['content'][_0x10b103(0xba)],'ticket':_0x12e4d6}),console['log'](_0x10b103(0x122));}catch(_0x405980){console[_0x10b103(0x10e)](_0x10b103(0xca),_0x405980),Sentry[_0x10b103(0x126)](_0x405980);throw _0x405980;}}}}}_0x2b858a===_0x4fffc8&&(console[_0x10b103(0xac)](_0x10b103(0xdb)),await _0x12e4d6[_0x10b103(0x102)]({'chatbot':!![],'typebotSessionId':null}),await _0x12e4d6[_0x10b103(0xf3)](),await(0x0,SendWhatsAppMessage_1[_0x10b103(0x106)])({'body':_0x30eefe,'ticket':_0x12e4d6}));if(_0x2b858a===_0x487f67){console[_0x10b103(0xac)](_0x10b103(0xae)),await(0x0,UpdateTicketService_1[_0x10b103(0x106)])({'ticketData':{'status':_0x10b103(0xd7),'useIntegration':![],'integrationId':null},'ticketId':_0x12e4d6['id'],'companyId':_0x12e4d6['companyId']});return;}}catch(_0x277620){console[_0x10b103(0x10e)]('[typebotListener]\x20Erro\x20geral:',_0x277620);_0x277620[_0x10b103(0xd0)]&&(console[_0x10b103(0x10e)](_0x10b103(0xe1)+JSON[_0x10b103(0xb2)](_0x277620[_0x10b103(0xd0)]['data'])),console[_0x10b103(0x10e)](_0x10b103(0x12c)+_0x277620[_0x10b103(0xd0)][_0x10b103(0xb1)]));logger_1['logger'][_0x10b103(0xc2)]({'error':_0x277620},_0x10b103(0xe9)),await _0x12e4d6[_0x10b103(0x102)]({'typebotSessionId':null});try{await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x10b103(0xe3),'ticket':_0x12e4d6});}catch(_0x3533b7){console[_0x10b103(0x10e)](_0x10b103(0xe8),_0x3533b7);}}};function a563_0x4f03(_0x1db1b7,_0x4160bf){const _0x294b68=a563_0xd989();return a563_0x4f03=function(_0x5a8925,_0x323656){_0x5a8925=_0x5a8925-0xaa;let _0xd98952=_0x294b68[_0x5a8925];return _0xd98952;},a563_0x4f03(_0x1db1b7,_0x4160bf);}exports[a563_0x1d9c6d(0x106)]=typebotListener;