'use strict';const a672_0x3e2290=a672_0x3f46;function a672_0x3f46(_0x2be284,_0x53c340){const _0x28e52c=a672_0x3cb8();return a672_0x3f46=function(_0x21327f,_0x41bc1a){_0x21327f=_0x21327f-0x1c0;let _0x3cb831=_0x28e52c[_0x21327f];return _0x3cb831;},a672_0x3f46(_0x2be284,_0x53c340);}(function(_0x489a5f,_0x3e5f2b){const _0x23f479=a672_0x3f46,_0x46cfd6=_0x489a5f();while(!![]){try{const _0x277dfc=-parseInt(_0x23f479(0x1d2))/0x1+parseInt(_0x23f479(0x1f8))/0x2*(parseInt(_0x23f479(0x22d))/0x3)+-parseInt(_0x23f479(0x218))/0x4*(-parseInt(_0x23f479(0x1c7))/0x5)+-parseInt(_0x23f479(0x1cf))/0x6+-parseInt(_0x23f479(0x208))/0x7+parseInt(_0x23f479(0x214))/0x8*(-parseInt(_0x23f479(0x217))/0x9)+parseInt(_0x23f479(0x221))/0xa;if(_0x277dfc===_0x3e5f2b)break;else _0x46cfd6['push'](_0x46cfd6['shift']());}catch(_0x400a12){_0x46cfd6['push'](_0x46cfd6['shift']());}}}(a672_0x3cb8,0x4ec9a));var __createBinding=this&&this[a672_0x3e2290(0x1c1)]||(Object[a672_0x3e2290(0x23e)]?function(_0xa7b61e,_0x50ee92,_0x4adaa9,_0x30b155){const _0x107cbc=a672_0x3e2290;if(_0x30b155===undefined)_0x30b155=_0x4adaa9;var _0x358b7e=Object[_0x107cbc(0x1ec)](_0x50ee92,_0x4adaa9);(!_0x358b7e||(_0x107cbc(0x1c6)in _0x358b7e?!_0x50ee92['__esModule']:_0x358b7e[_0x107cbc(0x1f2)]||_0x358b7e[_0x107cbc(0x1c3)]))&&(_0x358b7e={'enumerable':!![],'get':function(){return _0x50ee92[_0x4adaa9];}}),Object[_0x107cbc(0x1f1)](_0xa7b61e,_0x30b155,_0x358b7e);}:function(_0x13335d,_0x42560f,_0x2d9680,_0xec3c1c){if(_0xec3c1c===undefined)_0xec3c1c=_0x2d9680;_0x13335d[_0xec3c1c]=_0x42560f[_0x2d9680];}),__setModuleDefault=this&&this[a672_0x3e2290(0x1fa)]||(Object[a672_0x3e2290(0x23e)]?function(_0x5877a2,_0x5d889e){const _0x15514b=a672_0x3e2290;Object[_0x15514b(0x1f1)](_0x5877a2,_0x15514b(0x226),{'enumerable':!![],'value':_0x5d889e});}:function(_0x3989de,_0x48a342){const _0x5b1e00=a672_0x3e2290;_0x3989de[_0x5b1e00(0x226)]=_0x48a342;}),__importStar=this&&this[a672_0x3e2290(0x1de)]||(function(){const _0x6092f1=(function(){let _0x5886bd=!![];return function(_0x2f42f0,_0x4449ec){const _0xa8387d=_0x5886bd?function(){const _0x4389dd=a672_0x3f46;if(_0x4449ec){const _0x397dde=_0x4449ec[_0x4389dd(0x20d)](_0x2f42f0,arguments);return _0x4449ec=null,_0x397dde;}}:function(){};return _0x5886bd=![],_0xa8387d;};}()),_0x4177a2=_0x6092f1(this,function(){const _0x11bad3=a672_0x3f46;return _0x4177a2[_0x11bad3(0x1e9)]()[_0x11bad3(0x1fd)]('(((.+)+)+)+$')['toString']()['constructor'](_0x4177a2)['search']('(((.+)+)+)+$');});_0x4177a2();var _0x58769c=function(_0x278a83){const _0x493aaa=a672_0x3f46;return _0x58769c=Object[_0x493aaa(0x204)]||function(_0xcb3db6){const _0x2ef709=_0x493aaa;var _0x4cdc5e=[];for(var _0xc1351 in _0xcb3db6)if(Object[_0x2ef709(0x200)][_0x2ef709(0x1e2)][_0x2ef709(0x202)](_0xcb3db6,_0xc1351))_0x4cdc5e[_0x4cdc5e[_0x2ef709(0x20c)]]=_0xc1351;return _0x4cdc5e;},_0x58769c(_0x278a83);};return function(_0x310418){const _0x4ae0d6=a672_0x3f46;if(_0x310418&&_0x310418[_0x4ae0d6(0x219)])return _0x310418;var _0x182fe2={};if(_0x310418!=null){for(var _0x553dd2=_0x58769c(_0x310418),_0x242af5=0x0;_0x242af5<_0x553dd2['length'];_0x242af5++)if(_0x553dd2[_0x242af5]!==_0x4ae0d6(0x226))__createBinding(_0x182fe2,_0x310418,_0x553dd2[_0x242af5]);}return __setModuleDefault(_0x182fe2,_0x310418),_0x182fe2;};}()),__importDefault=this&&this[a672_0x3e2290(0x1ca)]||function(_0x35dc2e){const _0x48a8ca=a672_0x3e2290;return _0x35dc2e&&_0x35dc2e[_0x48a8ca(0x219)]?_0x35dc2e:{'default':_0x35dc2e};};function a672_0x3cb8(){const _0x1aef33=['[typebotListener]\x20Status\x20de\x20erro:\x20','defineProperty','writable','Error\x20on\x20typebotListener','[typebotListener]\x20Criando\x20nova\x20sessão\x20para\x20o\x20número:\x20','[typebotListener]\x20Continuando\x20conversa\x20com\x20a\x20mensagem:\x20\x22','[typebotListener]\x20Ticket\x20sem\x20sessão\x20ativa.\x20Criando\x20nova\x20sessão.','status@broadcast','20166haFKia','/api/v1/sessions/','__setModuleDefault','Resposta\x20vazia\x20do\x20Typebot','log','search','[typebotListener]\x20URL\x20da\x20requisição:\x20','messages','prototype','[typebotListener]\x20Áudio\x20enviado\x20com\x20sucesso.','call','info','getOwnPropertyNames','image','[typebotListener]\x20Resposta\x20recebida\x20do\x20Typebot:\x20','../../utils/logger','1107505Edaslj','getMinutes','replace',',\x20updatedAt:\x20','length','apply','[typebotListener]\x20Verificando\x20expiração\x20da\x20sessão.\x20typebotExpires:\x20','userId','../../helpers/SendPresenceStatus','[typebotListener]\x20Redirecionando\x20para\x20fila\x20','lodash','[typebotListener]\x20Erro\x20ao\x20enviar\x20imagem:','3704qladgz','[typebotListener]\x20Dados\x20da\x20requisição\x20para\x20criar\x20sessão:\x20','italic','864WPEqog','116FNeOzK','__esModule','queueId','stopBot','audio',',\x20Dados:\x20','type','Mensagem\x20vazia','[typebotListener]\x20Resposta\x20de\x20erro:\x20','3499570wuOjRy','\x20e\x20usuário\x20','document','bold','[typebotListener]\x20Erro\x20ao\x20enviar\x20documento:','default','[typebotListener]\x20Usando\x20dados\x20da\x20sessão\x20recém-criada','Não','startsWith','children','remoteJid','[typebotListener]\x20Erro\x20ao\x20processar\x20gatilho\x20JSON:','117AYgStm','setMinutes','Sim','substring','sessionId','SendPresenceStatus','[typebotListener]\x20Processando\x20gatilho\x20JSON:\x20','[typebotListener]\x20Redirecionando\x20para\x20fila:\x20','companyId','reload','key','update','application/json','logger','[typebotListener]\x20Executando\x20comando\x20stopBot','/api/v1/typebots/','[typebotListener]\x20Mensagem\x20recebida:\x20\x22','create','[typebotListener]\x20Processando\x20mensagem\x20de\x20documento:\x20','link','contact','closed','Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','__createBinding','getPhoneNumberFromMessage','configurable','captureException','[typebotListener]\x20Processando\x20comando\x20de\x20finalização','get','67700xdicuv','[typebotListener]\x20Documento\x20enviado\x20com\x20sucesso.','[typebotListener]\x20Processando\x20','__importDefault','[typebotListener]\x20Erro\x20ao\x20enviar\x20áudio:','error','text','atualizando\x20typebotStatus...','206142CeWWBP','/continueChat','...','576120WErmja','../WbotServices/SendWhatsAppMessage','trim','../TicketServices/UpdateTicketService','post','string','underline','[typebotListener]\x20Nenhuma\x20mensagem\x20recebida.\x20Verificando\x20status\x20do\x20fluxo.','typebotSessionId','[typebotListener]\x20Sessão\x20expirada\x20por\x20tempo\x20limite.\x20Resetando\x20sessão.','richText','parse','__importStar','[typebotListener]\x20Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:','response','url','hasOwnProperty','data','[typebotListener]\x20Erro\x20ao\x20enviar\x20mensagem\x20de\x20erro:','../WbotServices/GetHandlers','[typebotListener]\x20Enviando\x20mensagem\x20formatada:\x20\x22','[typebotListener]\x20Nova\x20sessão\x20criada:\x20','[typebotListener]\x20Erro\x20geral:','toString','stringify','[typebotListener]\x20Sessão\x20criada\x20com\x20sucesso.\x20SessionID:\x20','getOwnPropertyDescriptor','isNil','content','fromMe'];a672_0x3cb8=function(){return _0x1aef33;};return a672_0x3cb8();}Object[a672_0x3e2290(0x1f1)](exports,a672_0x3e2290(0x219),{'value':!![]});const axios_1=__importDefault(require('axios')),GetHandlers_1=require(a672_0x3e2290(0x1e5)),logger_1=require(a672_0x3e2290(0x207)),lodash_1=require(a672_0x3e2290(0x212)),UpdateTicketService_1=__importDefault(require(a672_0x3e2290(0x1d5))),SendPresenceStatus_1=require(a672_0x3e2290(0x210)),SendWhatsAppMedia_1=__importDefault(require('../WbotServices/SendWhatsAppMedia')),Sentry=__importStar(require('@sentry/node')),SendWhatsAppMessage_1=__importDefault(require(a672_0x3e2290(0x1d3))),ExtractPhoneNumber_1=require('../../helpers/ExtractPhoneNumber'),typebotListener=async({wbot:_0x3ed356,msg:_0x90c1e3,ticket:_0x40a92c,typebot:_0x575ee2})=>{const _0x48ac56=a672_0x3e2290;if(_0x90c1e3[_0x48ac56(0x237)]['remoteJid']===_0x48ac56(0x1f7))return;const {urlN8N:_0x2acff0,typebotExpires:_0xee3eb2,typebotKeywordFinish:_0x4f4773,typebotKeywordRestart:_0x32cafa,typebotUnknownMessage:_0x3df0dd,typebotSlug:_0x46eaba,typebotDelayMessage:_0x359944,typebotRestartMessage:_0x18e514}=_0x575ee2;if(_0x90c1e3[_0x48ac56(0x237)][_0x48ac56(0x1ef)]){console[_0x48ac56(0x1fc)]('[typebotListener]\x20Mensagem\x20enviada\x20pelo\x20sistema.\x20Ignorando.');return;}const _0x12d762=(0x0,ExtractPhoneNumber_1[_0x48ac56(0x1c2)])(_0x90c1e3,_0x3ed356);let _0xbd7f89=(0x0,GetHandlers_1['getBodyMessage'])(_0x90c1e3);console[_0x48ac56(0x1fc)](_0x48ac56(0x23d)+_0xbd7f89+'\x22');async function _0x43cb26(_0x2d967b,_0x129097,_0x453908){const _0x2e90ee=_0x48ac56;try{console['log'](_0x2e90ee(0x1f4)+_0x453908);const _0x476c75=JSON[_0x2e90ee(0x1ea)]({'isStreamEnabled':!![],'message':_0x2e90ee(0x1d7),'resultId':'string','isOnlyRegistering':![],'prefilledVariables':{'number':_0x453908,'pushName':_0x2d967b['pushName']||'','remoteJid':_0x40a92c?.[_0x2e90ee(0x241)]?.[_0x2e90ee(0x22b)]}});console['log'](_0x2e90ee(0x215)+_0x476c75);const _0x2ac3fc={'method':_0x2e90ee(0x1d6),'maxBodyLength':Infinity,'url':_0x2acff0+_0x2e90ee(0x23c)+_0x46eaba+'/startChat','headers':{'Content-Type':_0x2e90ee(0x239),'Accept':'application/json'},'data':_0x476c75};console[_0x2e90ee(0x1fc)](_0x2e90ee(0x1fe)+_0x2ac3fc[_0x2e90ee(0x1e1)]);const _0x369fe4=await axios_1[_0x2e90ee(0x226)]['request'](_0x2ac3fc);return console[_0x2e90ee(0x1fc)](_0x2e90ee(0x1eb)+_0x369fe4['data']?.[_0x2e90ee(0x231)]),_0x369fe4[_0x2e90ee(0x1e3)];}catch(_0x13b128){console[_0x2e90ee(0x1cc)](_0x2e90ee(0x1df),_0x13b128);_0x13b128[_0x2e90ee(0x1e0)]&&(console['error']('[typebotListener]\x20Resposta\x20de\x20erro:\x20'+JSON[_0x2e90ee(0x1ea)](_0x13b128[_0x2e90ee(0x1e0)][_0x2e90ee(0x1e3)])),console[_0x2e90ee(0x1cc)](_0x2e90ee(0x1f0)+_0x13b128[_0x2e90ee(0x1e0)]['status']));logger_1['logger'][_0x2e90ee(0x203)]({'error':_0x13b128},'Erro\x20ao\x20criar\x20sessão\x20do\x20typebot');throw _0x13b128;}}let _0x12617d,_0x2faf57;try{const _0x32f2b3=new Date();_0x32f2b3[_0x48ac56(0x22e)](_0x32f2b3[_0x48ac56(0x209)]()-Number(_0xee3eb2)),console[_0x48ac56(0x1fc)](_0x48ac56(0x20e)+_0xee3eb2+_0x48ac56(0x20b)+_0x40a92c['updatedAt']);_0xee3eb2>0x0&&_0x40a92c['updatedAt']<_0x32f2b3&&(console[_0x48ac56(0x1fc)](_0x48ac56(0x1db)),await _0x40a92c[_0x48ac56(0x238)]({'typebotSessionId':null,'chatbot':!![]}),await _0x40a92c['reload']());!_0x40a92c['typebotSessionId']?(console[_0x48ac56(0x1fc)](_0x48ac56(0x1f6)),_0x2faf57=await _0x43cb26(_0x90c1e3,_0x575ee2,_0x12d762),_0x12617d=_0x2faf57[_0x48ac56(0x231)],console[_0x48ac56(0x1fc)](_0x48ac56(0x1e7)+_0x12617d),await _0x40a92c[_0x48ac56(0x238)]({'typebotSessionId':_0x12617d,'useIntegration':!![],'integrationId':_0x575ee2['id'],'chatbot':!![]}),await _0x40a92c[_0x48ac56(0x236)]()):(console[_0x48ac56(0x1fc)]('[typebotListener]\x20Usando\x20sessão\x20existente:\x20'+_0x40a92c[_0x48ac56(0x1da)]),_0x12617d=_0x40a92c[_0x48ac56(0x1da)],_0x2faf57=undefined);if(_0xbd7f89!==_0x4f4773&&_0xbd7f89!==_0x32cafa){let _0x36ca5f,_0x1c0f33,_0x3860bf;if(_0x2faf57?.[_0x48ac56(0x1ff)]?.['length']===0x0||_0x2faf57===undefined){console[_0x48ac56(0x1fc)](_0x48ac56(0x1f5)+_0xbd7f89+'\x22');(!_0xbd7f89||_0xbd7f89[_0x48ac56(0x1d4)]()==='')&&(_0xbd7f89=_0x48ac56(0x21f),console[_0x48ac56(0x1fc)]('[typebotListener]\x20Mensagem\x20vazia\x20detectada,\x20usando\x20texto\x20padrão:\x20\x22'+_0xbd7f89+'\x22'));const _0x3cdb86=JSON[_0x48ac56(0x1ea)]({'message':_0xbd7f89});let _0x1b7d6c={'method':_0x48ac56(0x1d6),'maxBodyLength':Infinity,'url':_0x2acff0+_0x48ac56(0x1f9)+_0x12617d+_0x48ac56(0x1d0),'headers':{'Content-Type':'application/json','Accept':_0x48ac56(0x239)},'data':_0x3cdb86};console[_0x48ac56(0x1fc)]('[typebotListener]\x20Enviando\x20requisição\x20para\x20continuar\x20chat.\x20URL:\x20'+_0x1b7d6c[_0x48ac56(0x1e1)]+_0x48ac56(0x21d)+_0x3cdb86);try{_0x36ca5f=await axios_1[_0x48ac56(0x226)]['request'](_0x1b7d6c),console['log'](_0x48ac56(0x206)+JSON[_0x48ac56(0x1ea)](_0x36ca5f[_0x48ac56(0x1e3)]));if(!_0x36ca5f[_0x48ac56(0x1e3)]){console[_0x48ac56(0x1cc)]('[typebotListener]\x20Resposta\x20vazia\x20do\x20Typebot');throw new Error(_0x48ac56(0x1fb));}_0x1c0f33=_0x36ca5f[_0x48ac56(0x1e3)]?.[_0x48ac56(0x1ff)],_0x3860bf=_0x36ca5f[_0x48ac56(0x1e3)]?.['input'],console[_0x48ac56(0x1fc)]('[typebotListener]\x20Mensagens\x20recebidas:\x20'+(_0x1c0f33?.[_0x48ac56(0x20c)]||0x0)+',\x20Input\x20recebido:\x20'+(_0x3860bf?_0x48ac56(0x22f):_0x48ac56(0x228))),!_0x3860bf&&(console[_0x48ac56(0x1fc)](_0x48ac56(0x1ce)),await _0x40a92c[_0x48ac56(0x238)]({'typebotStatus':!![]}));}catch(_0x5b9e2f){console[_0x48ac56(0x1cc)]('[typebotListener]\x20Erro\x20ao\x20continuar\x20chat:',_0x5b9e2f);_0x5b9e2f['response']&&(console[_0x48ac56(0x1cc)](_0x48ac56(0x220)+JSON[_0x48ac56(0x1ea)](_0x5b9e2f['response'][_0x48ac56(0x1e3)])),console[_0x48ac56(0x1cc)](_0x48ac56(0x1f0)+_0x5b9e2f[_0x48ac56(0x1e0)]['status']));await _0x40a92c[_0x48ac56(0x238)]({'typebotSessionId':null}),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x48ac56(0x1c0),'ticket':_0x40a92c});return;}}else console[_0x48ac56(0x1fc)](_0x48ac56(0x227)),_0x1c0f33=_0x2faf57?.[_0x48ac56(0x1ff)],_0x3860bf=_0x2faf57?.['input'];if(!_0x1c0f33||_0x1c0f33?.[_0x48ac56(0x20c)]===0x0){console['log'](_0x48ac56(0x1d9));if(_0x36ca5f&&_0x36ca5f['data']&&_0x3860bf===null){console[_0x48ac56(0x1fc)]('[typebotListener]\x20Fim\x20natural\x20do\x20fluxo\x20detectado.\x20Finalizando\x20sem\x20erro.'),await _0x40a92c[_0x48ac56(0x238)]({'chatbot':![],'useIntegration':![]});return;}await(0x0,SendWhatsAppMessage_1[_0x48ac56(0x226)])({'body':_0x3df0dd,'ticket':_0x40a92c});}else{console[_0x48ac56(0x1fc)](_0x48ac56(0x1c9)+_0x1c0f33[_0x48ac56(0x20c)]+'\x20mensagens');for(const _0x512582 of _0x1c0f33){if(_0x512582[_0x48ac56(0x21e)]==='text'){let _0x527190='',_0x5a0c52=![];console[_0x48ac56(0x1fc)]('[typebotListener]\x20Processando\x20mensagem\x20de\x20texto:\x20'+JSON[_0x48ac56(0x1ea)](_0x512582[_0x48ac56(0x1ee)]));for(const _0x10c814 of _0x512582[_0x48ac56(0x1ee)][_0x48ac56(0x1dc)]){for(const _0x49a3d3 of _0x10c814[_0x48ac56(0x22a)]){let _0x4d6c6b='';_0x49a3d3[_0x48ac56(0x1cd)]&&(_0x4d6c6b=_0x49a3d3[_0x48ac56(0x1cd)]);if(_0x49a3d3[_0x48ac56(0x21e)]&&_0x49a3d3[_0x48ac56(0x22a)])for(const _0x684df6 of _0x49a3d3['children']){let _0x4e2de6='';_0x684df6[_0x48ac56(0x1cd)]&&(_0x4e2de6=_0x684df6[_0x48ac56(0x1cd)]);if(_0x684df6['type']&&_0x684df6[_0x48ac56(0x22a)])for(const _0xfd1ce4 of _0x684df6['children']){let _0x1d9a94='';_0xfd1ce4['text']&&(_0x1d9a94=_0xfd1ce4[_0x48ac56(0x1cd)]);_0xfd1ce4['bold']&&(_0x1d9a94='*'+_0x1d9a94+'*');_0xfd1ce4['italic']&&(_0x1d9a94='_'+_0x1d9a94+'_');_0xfd1ce4[_0x48ac56(0x1d8)]&&(_0x1d9a94='~'+_0x1d9a94+'~');if(_0xfd1ce4[_0x48ac56(0x1e1)]){const _0x4bf33a=_0xfd1ce4[_0x48ac56(0x22a)][0x0]?.[_0x48ac56(0x1cd)]||_0x48ac56(0x240);_0x1d9a94='['+_0x4bf33a+']('+_0xfd1ce4[_0x48ac56(0x1e1)]+')',_0x5a0c52=!![];}_0x527190+=_0x1d9a94;}_0x684df6['bold']&&(_0x4e2de6='*'+_0x4e2de6+'*');_0x684df6['italic']&&(_0x4e2de6='_'+_0x4e2de6+'_');_0x684df6[_0x48ac56(0x1d8)]&&(_0x4e2de6='~'+_0x4e2de6+'~');if(_0x684df6['url']){const _0x59649e=_0x684df6[_0x48ac56(0x22a)][0x0]?.[_0x48ac56(0x1cd)]||'link';_0x4e2de6='['+_0x59649e+']('+_0x684df6[_0x48ac56(0x1e1)]+')',_0x5a0c52=!![];}_0x527190+=_0x4e2de6;}_0x49a3d3[_0x48ac56(0x224)]&&(_0x4d6c6b='*'+_0x4d6c6b+'*');_0x49a3d3[_0x48ac56(0x216)]&&(_0x4d6c6b='_'+_0x4d6c6b+'_');_0x49a3d3[_0x48ac56(0x1d8)]&&(_0x4d6c6b='~'+_0x4d6c6b+'~');if(_0x49a3d3[_0x48ac56(0x1e1)]){const _0x4aad99=_0x49a3d3[_0x48ac56(0x22a)][0x0]?.[_0x48ac56(0x1cd)]||_0x48ac56(0x240);_0x4d6c6b='['+_0x4aad99+']('+_0x49a3d3[_0x48ac56(0x1e1)]+')',_0x5a0c52=!![];}_0x527190+=_0x4d6c6b;}_0x527190+='\x0a';}_0x527190=_0x527190[_0x48ac56(0x20a)]('**','')[_0x48ac56(0x20a)](/\n$/,'');_0x527190==='Invalid\x20message.\x20Please,\x20try\x20again.'&&(_0x527190=_0x3df0dd);if(_0x527190[_0x48ac56(0x229)]('#')){let _0x308fbb=_0x527190[_0x48ac56(0x20a)]('#','');try{console['log'](_0x48ac56(0x233)+_0x308fbb);let _0x7c842d=JSON[_0x48ac56(0x1dd)](_0x308fbb);if(_0x7c842d[_0x48ac56(0x21b)]&&(0x0,lodash_1[_0x48ac56(0x1ed)])(_0x7c842d[_0x48ac56(0x20f)])&&(0x0,lodash_1[_0x48ac56(0x1ed)])(_0x7c842d[_0x48ac56(0x21a)])){console[_0x48ac56(0x1fc)](_0x48ac56(0x23b)),await _0x40a92c[_0x48ac56(0x238)]({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1[_0x48ac56(0x1ed)])(_0x7c842d[_0x48ac56(0x21a)])&&_0x7c842d[_0x48ac56(0x21a)]>0x0&&(0x0,lodash_1['isNil'])(_0x7c842d['userId'])){console[_0x48ac56(0x1fc)](_0x48ac56(0x234)+_0x7c842d['queueId']),await(0x0,UpdateTicketService_1[_0x48ac56(0x226)])({'ticketData':{'queueId':_0x7c842d[_0x48ac56(0x21a)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x40a92c['id'],'companyId':_0x40a92c[_0x48ac56(0x235)]});return;}if(!(0x0,lodash_1[_0x48ac56(0x1ed)])(_0x7c842d['queueId'])&&_0x7c842d['queueId']>0x0&&!(0x0,lodash_1[_0x48ac56(0x1ed)])(_0x7c842d[_0x48ac56(0x20f)])&&_0x7c842d[_0x48ac56(0x20f)]>0x0){console[_0x48ac56(0x1fc)](_0x48ac56(0x211)+_0x7c842d[_0x48ac56(0x21a)]+_0x48ac56(0x222)+_0x7c842d[_0x48ac56(0x20f)]),await(0x0,UpdateTicketService_1[_0x48ac56(0x226)])({'ticketData':{'queueId':_0x7c842d[_0x48ac56(0x21a)],'userId':_0x7c842d['userId'],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x40a92c['id'],'companyId':_0x40a92c[_0x48ac56(0x235)]});return;}}catch(_0x5b336c){console[_0x48ac56(0x1cc)](_0x48ac56(0x22c),_0x5b336c);throw _0x5b336c;}}console[_0x48ac56(0x1fc)](_0x48ac56(0x1e6)+_0x527190[_0x48ac56(0x230)](0x0,0x32)+(_0x527190[_0x48ac56(0x20c)]>0x32?_0x48ac56(0x1d1):'')+'\x22'),await(0x0,SendPresenceStatus_1[_0x48ac56(0x232)])(_0x3ed356,_0x90c1e3[_0x48ac56(0x237)]['remoteJid'],_0x359944),await(0x0,SendWhatsAppMessage_1[_0x48ac56(0x226)])({'body':_0x527190,'ticket':_0x40a92c});}if(_0x512582[_0x48ac56(0x21e)]===_0x48ac56(0x21c)){console[_0x48ac56(0x1fc)]('[typebotListener]\x20Processando\x20mensagem\x20de\x20áudio:\x20'+_0x512582[_0x48ac56(0x1ee)][_0x48ac56(0x1e1)]),await(0x0,SendPresenceStatus_1[_0x48ac56(0x232)])(_0x3ed356,_0x90c1e3['key'][_0x48ac56(0x22b)],_0x359944);try{await(0x0,SendWhatsAppMedia_1[_0x48ac56(0x226)])({'media':_0x512582[_0x48ac56(0x1ee)][_0x48ac56(0x1e1)],'ticket':_0x40a92c}),console[_0x48ac56(0x1fc)](_0x48ac56(0x201));}catch(_0x415862){console[_0x48ac56(0x1cc)](_0x48ac56(0x1cb),_0x415862),Sentry[_0x48ac56(0x1c4)](_0x415862);throw _0x415862;}}if(_0x512582[_0x48ac56(0x21e)]===_0x48ac56(0x205)){console[_0x48ac56(0x1fc)]('[typebotListener]\x20Processando\x20mensagem\x20de\x20imagem:\x20'+_0x512582[_0x48ac56(0x1ee)][_0x48ac56(0x1e1)]),await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x3ed356,_0x90c1e3[_0x48ac56(0x237)][_0x48ac56(0x22b)],_0x359944);try{await(0x0,SendWhatsAppMedia_1[_0x48ac56(0x226)])({'media':_0x512582[_0x48ac56(0x1ee)][_0x48ac56(0x1e1)],'ticket':_0x40a92c}),console[_0x48ac56(0x1fc)]('[typebotListener]\x20Imagem\x20enviada\x20com\x20sucesso.');}catch(_0x5179a7){console[_0x48ac56(0x1cc)](_0x48ac56(0x213),_0x5179a7),Sentry[_0x48ac56(0x1c4)](_0x5179a7);throw _0x5179a7;}}if(_0x512582[_0x48ac56(0x21e)]===_0x48ac56(0x223)){console[_0x48ac56(0x1fc)](_0x48ac56(0x23f)+_0x512582[_0x48ac56(0x1ee)][_0x48ac56(0x1e1)]),await(0x0,SendPresenceStatus_1[_0x48ac56(0x232)])(_0x3ed356,_0x90c1e3['key']['remoteJid'],_0x359944);try{await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x512582['content'][_0x48ac56(0x1e1)],'ticket':_0x40a92c}),console['log'](_0x48ac56(0x1c8));}catch(_0x3e7543){console[_0x48ac56(0x1cc)](_0x48ac56(0x225),_0x3e7543),Sentry[_0x48ac56(0x1c4)](_0x3e7543);throw _0x3e7543;}}}}}_0xbd7f89===_0x32cafa&&(console[_0x48ac56(0x1fc)]('[typebotListener]\x20Processando\x20comando\x20de\x20reinício'),await _0x40a92c[_0x48ac56(0x238)]({'chatbot':!![],'typebotSessionId':null}),await _0x40a92c[_0x48ac56(0x236)](),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x18e514,'ticket':_0x40a92c}));if(_0xbd7f89===_0x4f4773){console['log'](_0x48ac56(0x1c5)),await(0x0,UpdateTicketService_1[_0x48ac56(0x226)])({'ticketData':{'status':_0x48ac56(0x242),'useIntegration':![],'integrationId':null},'ticketId':_0x40a92c['id'],'companyId':_0x40a92c[_0x48ac56(0x235)]});return;}}catch(_0x37df64){console['error'](_0x48ac56(0x1e8),_0x37df64);_0x37df64[_0x48ac56(0x1e0)]&&(console[_0x48ac56(0x1cc)](_0x48ac56(0x220)+JSON[_0x48ac56(0x1ea)](_0x37df64['response'][_0x48ac56(0x1e3)])),console[_0x48ac56(0x1cc)](_0x48ac56(0x1f0)+_0x37df64[_0x48ac56(0x1e0)]['status']));logger_1[_0x48ac56(0x23a)]['info']({'error':_0x37df64},_0x48ac56(0x1f3)),await _0x40a92c[_0x48ac56(0x238)]({'typebotSessionId':null});try{await(0x0,SendWhatsAppMessage_1[_0x48ac56(0x226)])({'body':_0x48ac56(0x1c0),'ticket':_0x40a92c});}catch(_0x561df9){console['error'](_0x48ac56(0x1e4),_0x561df9);}}};exports[a672_0x3e2290(0x226)]=typebotListener;