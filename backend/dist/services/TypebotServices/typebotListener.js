const a530_0x16672e=a530_0x26c0;(function(_0x37235d,_0x420f43){const _0x48b291=a530_0x26c0,_0x4489bc=_0x37235d();while(!![]){try{const _0x5dba78=parseInt(_0x48b291(0x89))/0x1+-parseInt(_0x48b291(0xa5))/0x2*(-parseInt(_0x48b291(0x99))/0x3)+parseInt(_0x48b291(0x7e))/0x4+parseInt(_0x48b291(0x74))/0x5+-parseInt(_0x48b291(0xa9))/0x6+parseInt(_0x48b291(0xac))/0x7*(parseInt(_0x48b291(0x9f))/0x8)+parseInt(_0x48b291(0x75))/0x9*(-parseInt(_0x48b291(0x8c))/0xa);if(_0x5dba78===_0x420f43)break;else _0x4489bc['push'](_0x4489bc['shift']());}catch(_0x58dd6c){_0x4489bc['push'](_0x4489bc['shift']());}}}(a530_0x53ac,0xe0017));function a530_0x26c0(_0x4a8646,_0x2ac283){const _0x2af0d5=a530_0x53ac();return a530_0x26c0=function(_0x322383,_0x6a827e){_0x322383=_0x322383-0x6a;let _0x53acba=_0x2af0d5[_0x322383];return _0x53acba;},a530_0x26c0(_0x4a8646,_0x2ac283);}const a530_0x6a827e=(function(){let _0x4c6c5a=!![];return function(_0x1e4a7c,_0x3f3031){const _0x1463c8=_0x4c6c5a?function(){const _0x150c37=a530_0x26c0;if(_0x3f3031){const _0x388346=_0x3f3031[_0x150c37(0x84)](_0x1e4a7c,arguments);return _0x3f3031=null,_0x388346;}}:function(){};return _0x4c6c5a=![],_0x1463c8;};}()),a530_0x322383=a530_0x6a827e(this,function(){const _0x53cdbb=a530_0x26c0;return a530_0x322383[_0x53cdbb(0x9e)]()[_0x53cdbb(0xab)](_0x53cdbb(0xae))[_0x53cdbb(0x9e)]()[_0x53cdbb(0x81)](a530_0x322383)['search'](_0x53cdbb(0xae));});a530_0x322383();'use strict';var __importDefault=this&&this[a530_0x16672e(0x9d)]||function(_0xa1b50f){const _0x292351=a530_0x16672e;return _0xa1b50f&&_0xa1b50f[_0x292351(0x93)]?_0xa1b50f:{'default':_0xa1b50f};};Object[a530_0x16672e(0x6f)](exports,a530_0x16672e(0x93),{'value':!![]});function a530_0x53ac(){const _0x4c136e=['../TicketServices/UpdateTicketService','richText','axios','type','info','audio/mp4','status@broadcast','/startChat','pushName','▶️\x20','length','italic','defineProperty','queueId','SendPresenceStatus','startsWith','post','6506345cacVdb','103203BgTYZR','Error\x20on\x20typebotListener:\x20','input','choice\x20input','messages','userId','application/json','../WbotServices/wbotMessageListener','contact','1479868pJSqVY','request','underline','constructor','content','getBodyMessage','apply','../../helpers/SendPresenceStatus','update','@c.us','replace','449435hOoXdg','children','key','1370HIeCbs','updatedAt','remoteJid','string','data','setMinutes','lodash','__esModule','logger','default','reload','typebotStatus','Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:\x20','3378HTIrZy','bold','Invalid\x20message.\x20Please,\x20try\x20again.','stringify','__importDefault','toString','2560NqujxI','/api/v1/typebots/','companyId','sessionId','url','text','2402yJdlxd','sendMessage','isNil','../../utils/logger','8141826ZppnLV','typebotSessionId','search','8148cFQAyJ','parse','(((.+)+)+)+$'];a530_0x53ac=function(){return _0x4c136e;};return a530_0x53ac();}const axios_1=__importDefault(require(a530_0x16672e(0xb1))),wbotMessageListener_1=require(a530_0x16672e(0x7c)),logger_1=require(a530_0x16672e(0xa8)),lodash_1=require(a530_0x16672e(0x92)),UpdateTicketService_1=__importDefault(require(a530_0x16672e(0xaf))),SendPresenceStatus_1=require(a530_0x16672e(0x85)),typebotListener=async({wbot:_0x44a4fb,msg:_0x54b0fb,ticket:_0x3e03bc,typebot:_0x5d2003})=>{const _0x143816=a530_0x16672e;if(_0x54b0fb[_0x143816(0x8b)]['remoteJid']===_0x143816(0xb5))return;const {urlN8N:_0x30a481,typebotExpires:_0x459a1e,typebotKeywordFinish:_0x424766,typebotKeywordRestart:_0x105407,typebotUnknownMessage:_0x5a59b7,typebotSlug:_0x1cf61d,typebotDelayMessage:_0x4de94a,typebotRestartMessage:_0x37bce2}=_0x5d2003,_0x16a062=_0x54b0fb['key'][_0x143816(0x8e)][_0x143816(0x88)](/\D/g,'');let _0x463272=(0x0,wbotMessageListener_1[_0x143816(0x83)])(_0x54b0fb);async function _0x195609(_0x210930,_0x20a601,_0x38a874){const _0x3a90a5=_0x143816;try{const _0x43a7b0=JSON[_0x3a90a5(0x9c)]({'isStreamEnabled':!![],'message':_0x3a90a5(0x8f),'resultId':_0x3a90a5(0x8f),'isOnlyRegistering':![],'prefilledVariables':{'number':_0x38a874,'pushName':_0x210930[_0x3a90a5(0x6b)]||'','remoteJid':_0x3e03bc?.[_0x3a90a5(0x7d)]?.[_0x3a90a5(0x8e)]}}),_0x23838b={'method':_0x3a90a5(0x73),'maxBodyLength':Infinity,'url':_0x30a481+_0x3a90a5(0xa0)+_0x1cf61d+_0x3a90a5(0x6a),'headers':{'Content-Type':_0x3a90a5(0x7b),'Accept':_0x3a90a5(0x7b)},'data':_0x43a7b0},_0x24ee7b=await axios_1[_0x3a90a5(0x95)][_0x3a90a5(0x7f)](_0x23838b);return _0x24ee7b['data'];}catch(_0x2ca3ec){logger_1['logger'][_0x3a90a5(0xb3)](_0x3a90a5(0x98),_0x2ca3ec);throw _0x2ca3ec;}}let _0x2463cb,_0x3717ad,_0x2c3908=![];try{const _0x3bac6f=new Date();_0x3bac6f[_0x143816(0x91)](_0x3bac6f['getMinutes']()-Number(_0x459a1e));_0x459a1e>0x0&&_0x3e03bc[_0x143816(0x8d)]<_0x3bac6f&&(await _0x3e03bc[_0x143816(0x86)]({'typebotSessionId':null,'chatbot':!![]}),await _0x3e03bc['reload']());!_0x3e03bc[_0x143816(0xaa)]?(_0x3717ad=await _0x195609(_0x54b0fb,_0x5d2003,_0x16a062),_0x2463cb=_0x3717ad[_0x143816(0xa2)],_0x2c3908=!![],await _0x3e03bc[_0x143816(0x86)]({'typebotSessionId':_0x2463cb,'typebotStatus':!![],'useIntegration':!![],'integrationId':_0x5d2003['id']}),await _0x3e03bc[_0x143816(0x96)]()):(_0x2463cb=_0x3e03bc[_0x143816(0xaa)],_0x2c3908=_0x3e03bc[_0x143816(0x97)]);if(!_0x2c3908)return;;if(_0x463272!==_0x424766&&_0x463272!==_0x105407){let _0x4c70c8,_0x4e02c5,_0x55a2c0;if(_0x3717ad?.[_0x143816(0x79)]['length']===0x0||_0x3717ad===undefined){const _0x119511=JSON[_0x143816(0x9c)]({'message':_0x463272});let _0x232928={'method':_0x143816(0x73),'maxBodyLength':Infinity,'url':_0x30a481+'/api/v1/sessions/'+_0x2463cb+'/continueChat','headers':{'Content-Type':_0x143816(0x7b),'Accept':_0x143816(0x7b)},'data':_0x119511};_0x4c70c8=await axios_1[_0x143816(0x95)][_0x143816(0x7f)](_0x232928),_0x4e02c5=_0x4c70c8[_0x143816(0x90)]?.[_0x143816(0x79)],_0x55a2c0=_0x4c70c8[_0x143816(0x90)]?.['input'];}else _0x4e02c5=_0x3717ad?.[_0x143816(0x79)],_0x55a2c0=_0x3717ad?.[_0x143816(0x77)];if(_0x4e02c5?.[_0x143816(0x6d)]===0x0)await _0x44a4fb[_0x143816(0xa6)](_0x16a062+'@c.us',{'text':_0x5a59b7});else{for(const _0x27af6b of _0x4e02c5){if(_0x27af6b[_0x143816(0xb2)]===_0x143816(0xa4)){let _0x17897d='',_0x163343=![];for(const _0x3eca7c of _0x27af6b[_0x143816(0x82)][_0x143816(0xb0)]){for(const _0x267975 of _0x3eca7c[_0x143816(0x8a)]){let _0x1a574d='';_0x267975[_0x143816(0xa4)]&&(_0x1a574d=_0x267975[_0x143816(0xa4)]);if(_0x267975[_0x143816(0xb2)]&&_0x267975[_0x143816(0x8a)])for(const _0x20d37a of _0x267975['children']){let _0x2fb093='';_0x20d37a['text']&&(_0x2fb093=_0x20d37a[_0x143816(0xa4)]);if(_0x20d37a[_0x143816(0xb2)]&&_0x20d37a[_0x143816(0x8a)])for(const _0x4a1aeb of _0x20d37a['children']){let _0x589528='';_0x4a1aeb[_0x143816(0xa4)]&&(_0x589528=_0x4a1aeb[_0x143816(0xa4)]);_0x4a1aeb['bold']&&(_0x589528='*'+_0x589528+'*');_0x4a1aeb[_0x143816(0x6e)]&&(_0x589528='_'+_0x589528+'_');_0x4a1aeb[_0x143816(0x80)]&&(_0x589528='~'+_0x589528+'~');if(_0x4a1aeb['url']){const _0x4f1d2b=_0x4a1aeb[_0x143816(0x8a)][0x0][_0x143816(0xa4)];_0x589528='['+_0x4f1d2b+']('+_0x4a1aeb[_0x143816(0xa3)]+')',_0x163343=!![];}_0x17897d+=_0x589528;}_0x20d37a[_0x143816(0x9a)]&&(_0x2fb093='*'+_0x2fb093+'*');_0x20d37a[_0x143816(0x6e)]&&(_0x2fb093='_'+_0x2fb093+'_');_0x20d37a['underline']&&(_0x2fb093='~'+_0x2fb093+'~');if(_0x20d37a[_0x143816(0xa3)]){const _0x47c6fd=_0x20d37a[_0x143816(0x8a)][0x0][_0x143816(0xa4)];_0x2fb093='['+_0x47c6fd+']('+_0x20d37a[_0x143816(0xa3)]+')',_0x163343=!![];}_0x17897d+=_0x2fb093;}_0x267975[_0x143816(0x9a)]&&(_0x1a574d='*'+_0x1a574d+'*');_0x267975['italic']&&(_0x1a574d='_'+_0x1a574d+'_');_0x267975[_0x143816(0x80)]&&(_0x1a574d='~'+_0x1a574d+'~');if(_0x267975[_0x143816(0xa3)]){const _0x4d4147=_0x267975['children'][0x0][_0x143816(0xa4)];_0x1a574d='['+_0x4d4147+']('+_0x267975[_0x143816(0xa3)]+')',_0x163343=!![];}_0x17897d+=_0x1a574d;}_0x17897d+='\x0a';}_0x17897d=_0x17897d[_0x143816(0x88)]('**','')[_0x143816(0x88)](/\n$/,'');_0x17897d===_0x143816(0x9b)&&(_0x17897d=_0x5a59b7);if(_0x17897d[_0x143816(0x72)]('#')){let _0x5795ba=_0x17897d['replace']('#','');try{let _0x3777bf=JSON[_0x143816(0xad)](_0x5795ba);if(_0x3777bf['stopBot']&&(0x0,lodash_1[_0x143816(0xa7)])(_0x3777bf[_0x143816(0x7a)])&&(0x0,lodash_1[_0x143816(0xa7)])(_0x3777bf['queueId'])){await _0x3e03bc[_0x143816(0x86)]({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1[_0x143816(0xa7)])(_0x3777bf[_0x143816(0x70)])&&_0x3777bf[_0x143816(0x70)]>0x0&&(0x0,lodash_1[_0x143816(0xa7)])(_0x3777bf['userId'])){await(0x0,UpdateTicketService_1[_0x143816(0x95)])({'ticketData':{'queueId':_0x3777bf[_0x143816(0x70)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x3e03bc['id'],'companyId':_0x3e03bc[_0x143816(0xa1)]});return;}if(!(0x0,lodash_1['isNil'])(_0x3777bf[_0x143816(0x70)])&&_0x3777bf[_0x143816(0x70)]>0x0&&!(0x0,lodash_1['isNil'])(_0x3777bf[_0x143816(0x7a)])&&_0x3777bf['userId']>0x0){await(0x0,UpdateTicketService_1[_0x143816(0x95)])({'ticketData':{'queueId':_0x3777bf[_0x143816(0x70)],'userId':_0x3777bf[_0x143816(0x7a)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x3e03bc['id'],'companyId':_0x3e03bc[_0x143816(0xa1)]});return;}}catch(_0xee72ed){throw _0xee72ed;}}await(0x0,SendPresenceStatus_1[_0x143816(0x71)])(_0x44a4fb,_0x54b0fb[_0x143816(0x8b)]['remoteJid'],_0x4de94a),await _0x44a4fb['sendMessage'](_0x54b0fb['key']['remoteJid'],{'text':_0x17897d});}if(_0x27af6b[_0x143816(0xb2)]==='audio'){await(0x0,SendPresenceStatus_1[_0x143816(0x71)])(_0x44a4fb,_0x54b0fb['key']['remoteJid'],_0x4de94a);const _0x5a231e={'audio':{'url':_0x27af6b[_0x143816(0x82)][_0x143816(0xa3)],'mimetype':_0x143816(0xb4),'ptt':!![]}};await _0x44a4fb[_0x143816(0xa6)](_0x54b0fb['key']['remoteJid'],_0x5a231e);}if(_0x27af6b['type']==='image'){await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x44a4fb,_0x54b0fb[_0x143816(0x8b)][_0x143816(0x8e)],_0x4de94a);const _0x12bdf5={'image':{'url':_0x27af6b['content']['url']}};await _0x44a4fb[_0x143816(0xa6)](_0x54b0fb['key']['remoteJid'],_0x12bdf5);}}if(_0x55a2c0){if(_0x55a2c0[_0x143816(0xb2)]===_0x143816(0x78)){let _0x415979='';const _0x40d69a=_0x55a2c0['items'];for(const _0x8e3d6a of _0x40d69a){_0x415979+=_0x143816(0x6c)+_0x8e3d6a[_0x143816(0x82)]+'\x0a';}_0x415979=_0x415979[_0x143816(0x88)](/\n$/,''),await(0x0,SendPresenceStatus_1[_0x143816(0x71)])(_0x44a4fb,_0x54b0fb[_0x143816(0x8b)][_0x143816(0x8e)],_0x4de94a),await _0x44a4fb[_0x143816(0xa6)](_0x54b0fb[_0x143816(0x8b)]['remoteJid'],{'text':_0x415979});}}}}_0x463272===_0x105407&&(await _0x3e03bc['update']({'chatbot':!![],'typebotSessionId':null}),await _0x3e03bc[_0x143816(0x96)](),await _0x44a4fb[_0x143816(0xa6)](_0x16a062+_0x143816(0x87),{'text':_0x37bce2}));if(_0x463272===_0x424766){await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':'closed','useIntegration':![],'integrationId':null},'ticketId':_0x3e03bc['id'],'companyId':_0x3e03bc['companyId']});return;}}catch(_0x400e22){logger_1[_0x143816(0x94)][_0x143816(0xb3)](_0x143816(0x76),_0x400e22),await _0x3e03bc['update']({'typebotSessionId':null});}};exports[a530_0x16672e(0x95)]=typebotListener;