'use strict';function a558_0x4ded(){const _0x5aaa67=['270148gVguKD','2291216XALFJf','string','[typebotListener]\x20Usando\x20sessão\x20existente:\x20','stringify','../TicketServices/UpdateTicketService','[typebotListener]\x20Erro\x20ao\x20processar\x20gatilho\x20JSON:','info',',\x20updatedAt:\x20','prototype','Resposta\x20vazia\x20do\x20Typebot','\x20mensagens','[typebotListener]\x20Fim\x20natural\x20do\x20fluxo\x20detectado.\x20Finalizando\x20sem\x20erro.','captureException','type','[typebotListener]\x20Verificando\x20expiração\x20da\x20sessão.\x20typebotExpires:\x20','/continueChat','closed','Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','typebotSessionId','9UcBSwX','[typebotListener]\x20Enviando\x20mensagem\x20formatada:\x20\x22','isNil','key','4656839TAAYJU','[typebotListener]\x20Ticket\x20sem\x20sessão\x20ativa.\x20Criando\x20nova\x20sessão.','__importDefault','get','[typebotListener]\x20Sessão\x20criada\x20com\x20sucesso.\x20SessionID:\x20','[typebotListener]\x20Processando\x20mensagem\x20de\x20texto:\x20','__esModule','url','__createBinding','richText','Sim','logger','[typebotListener]\x20Processando\x20comando\x20de\x20reinício','6UedaVP','90753mRYJbe','[typebotListener]\x20Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:','378910yqOEUx','audio','children','../../helpers/SendPresenceStatus','content','[typebotListener]\x20Processando\x20comando\x20de\x20finalização','[typebotListener]\x20Processando\x20mensagem\x20de\x20documento:\x20','atualizando\x20typebotStatus...','request','search','length','[typebotListener]\x20Processando\x20gatilho\x20JSON:\x20','370774linLbu','[typebotListener]\x20Redirecionando\x20para\x20fila:\x20','[typebotListener]\x20Usando\x20dados\x20da\x20sessão\x20recém-criada','[typebotListener]\x20Mensagem\x20enviada\x20pelo\x20sistema.\x20Ignorando.','[typebotListener]\x20Imagem\x20enviada\x20com\x20sucesso.','post','[typebotListener]\x20Executando\x20comando\x20stopBot','error','../WbotServices/SendWhatsAppMessage','startsWith','response','sessionId','getMinutes','data','../WbotServices/GetHandlers','update','document','867546QuoMxQ','[typebotListener]\x20Continuando\x20conversa\x20com\x20a\x20mensagem:\x20\x22','underline','[typebotListener]\x20Documento\x20enviado\x20com\x20sucesso.','Mensagem\x20vazia','[typebotListener]\x20Mensagem\x20vazia\x20detectada,\x20usando\x20texto\x20padrão:\x20\x22','[typebotListener]\x20Erro\x20ao\x20enviar\x20documento:','__importStar','[typebotListener]\x20Resposta\x20recebida\x20do\x20Typebot:\x20','[typebotListener]\x20Enviando\x20requisição\x20para\x20continuar\x20chat.\x20URL:\x20','[typebotListener]\x20Mensagem\x20recebida:\x20\x22','Error\x20on\x20typebotListener:\x20','toString','@sentry/node','apply','/startChat','(((.+)+)+)+$',',\x20Dados:\x20','SendPresenceStatus','\x20e\x20usuário\x20','trim','30kdSxsj','replace','text','userId','link','[typebotListener]\x20Sessão\x20expirada\x20por\x20tempo\x20limite.\x20Resetando\x20sessão.','hasOwnProperty','[typebotListener]\x20Status\x20de\x20erro:\x20',',\x20Input\x20recebido:\x20','companyId','setMinutes','[typebotListener]\x20Redirecionando\x20para\x20fila\x20','/api/v1/typebots/','[typebotListener]\x20Resposta\x20vazia\x20do\x20Typebot','status@broadcast','7AfrAnb','application/json','/api/v1/sessions/','[typebotListener]\x20Nova\x20sessão\x20criada:\x20','stopBot','log','Invalid\x20message.\x20Please,\x20try\x20again.','fromMe','status','reload','bold','[typebotListener]\x20URL\x20da\x20requisição:\x20','italic','create','parse','../../utils/logger','[typebotListener]\x20Resposta\x20de\x20erro:\x20','contact','updatedAt','constructor','defineProperty','messages','[typebotListener]\x20Processando\x20','default','Não','remoteJid','queueId','substring','input','[typebotListener]\x20Erro\x20ao\x20enviar\x20imagem:'];a558_0x4ded=function(){return _0x5aaa67;};return a558_0x4ded();}const a558_0x2b141f=a558_0x988b;(function(_0x5b9e5f,_0xfc8f84){const _0x43c192=a558_0x988b,_0x502370=_0x5b9e5f();while(!![]){try{const _0x435f27=-parseInt(_0x43c192(0x181))/0x1+parseInt(_0x43c192(0x18f))/0x2+parseInt(_0x43c192(0x16f))/0x3*(parseInt(_0x43c192(0x15b))/0x4)+-parseInt(_0x43c192(0x183))/0x5*(-parseInt(_0x43c192(0x180))/0x6)+-parseInt(_0x43c192(0x13d))/0x7*(parseInt(_0x43c192(0x15c))/0x8)+-parseInt(_0x43c192(0x1a0))/0x9*(parseInt(_0x43c192(0x12e))/0xa)+parseInt(_0x43c192(0x173))/0xb;if(_0x435f27===_0xfc8f84)break;else _0x502370['push'](_0x502370['shift']());}catch(_0x3f8494){_0x502370['push'](_0x502370['shift']());}}}(a558_0x4ded,0x35e78));var __createBinding=this&&this[a558_0x2b141f(0x17b)]||(Object[a558_0x2b141f(0x14a)]?function(_0xd6672f,_0x23225f,_0x1645d1,_0x126ca2){const _0x40da99=a558_0x2b141f;if(_0x126ca2===undefined)_0x126ca2=_0x1645d1;var _0x48624d=Object['getOwnPropertyDescriptor'](_0x23225f,_0x1645d1);(!_0x48624d||(_0x40da99(0x176)in _0x48624d?!_0x23225f[_0x40da99(0x179)]:_0x48624d['writable']||_0x48624d['configurable']))&&(_0x48624d={'enumerable':!![],'get':function(){return _0x23225f[_0x1645d1];}}),Object[_0x40da99(0x151)](_0xd6672f,_0x126ca2,_0x48624d);}:function(_0x313017,_0x4e12fd,_0x4dd908,_0xa9d424){if(_0xa9d424===undefined)_0xa9d424=_0x4dd908;_0x313017[_0xa9d424]=_0x4e12fd[_0x4dd908];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a558_0x2b141f(0x14a)]?function(_0x1c1a6d,_0x43ed08){const _0x7d7cae=a558_0x2b141f;Object[_0x7d7cae(0x151)](_0x1c1a6d,_0x7d7cae(0x154),{'enumerable':!![],'value':_0x43ed08});}:function(_0x1d9336,_0x276dab){const _0x6b5484=a558_0x2b141f;_0x1d9336[_0x6b5484(0x154)]=_0x276dab;}),__importStar=this&&this[a558_0x2b141f(0x1a7)]||(function(){const _0x50f412=(function(){let _0x2cdae0=!![];return function(_0x120760,_0x286eca){const _0x1f0c15=_0x2cdae0?function(){const _0x10fa08=a558_0x988b;if(_0x286eca){const _0x272c1c=_0x286eca[_0x10fa08(0x127)](_0x120760,arguments);return _0x286eca=null,_0x272c1c;}}:function(){};return _0x2cdae0=![],_0x1f0c15;};}()),_0x4ba8f5=_0x50f412(this,function(){const _0x5607ed=a558_0x988b;return _0x4ba8f5[_0x5607ed(0x125)]()[_0x5607ed(0x18c)](_0x5607ed(0x129))['toString']()[_0x5607ed(0x150)](_0x4ba8f5)['search']('(((.+)+)+)+$');});_0x4ba8f5();var _0x3e0819=function(_0x20c3f2){return _0x3e0819=Object['getOwnPropertyNames']||function(_0x2fb69e){const _0x2c6b9f=a558_0x988b;var _0x1d1305=[];for(var _0x78a2be in _0x2fb69e)if(Object[_0x2c6b9f(0x164)][_0x2c6b9f(0x134)]['call'](_0x2fb69e,_0x78a2be))_0x1d1305[_0x1d1305[_0x2c6b9f(0x18d)]]=_0x78a2be;return _0x1d1305;},_0x3e0819(_0x20c3f2);};return function(_0x2aa66f){const _0x28a951=a558_0x988b;if(_0x2aa66f&&_0x2aa66f[_0x28a951(0x179)])return _0x2aa66f;var _0x2ec002={};if(_0x2aa66f!=null){for(var _0x59b97d=_0x3e0819(_0x2aa66f),_0xde17fa=0x0;_0xde17fa<_0x59b97d[_0x28a951(0x18d)];_0xde17fa++)if(_0x59b97d[_0xde17fa]!==_0x28a951(0x154))__createBinding(_0x2ec002,_0x2aa66f,_0x59b97d[_0xde17fa]);}return __setModuleDefault(_0x2ec002,_0x2aa66f),_0x2ec002;};}()),__importDefault=this&&this[a558_0x2b141f(0x175)]||function(_0x1f5854){const _0x4d258b=a558_0x2b141f;return _0x1f5854&&_0x1f5854[_0x4d258b(0x179)]?_0x1f5854:{'default':_0x1f5854};};Object['defineProperty'](exports,a558_0x2b141f(0x179),{'value':!![]});const axios_1=__importDefault(require('axios')),GetHandlers_1=require(a558_0x2b141f(0x19d)),logger_1=require(a558_0x2b141f(0x14c)),lodash_1=require('lodash'),UpdateTicketService_1=__importDefault(require(a558_0x2b141f(0x160))),SendPresenceStatus_1=require(a558_0x2b141f(0x186)),SendWhatsAppMedia_1=__importDefault(require('../WbotServices/SendWhatsAppMedia')),Sentry=__importStar(require(a558_0x2b141f(0x126))),SendWhatsAppMessage_1=__importDefault(require(a558_0x2b141f(0x197))),typebotListener=async({wbot:_0x19053d,msg:_0x4c17d2,ticket:_0x4a2e9a,typebot:_0x5e3f04})=>{const _0x19fbee=a558_0x2b141f;if(_0x4c17d2[_0x19fbee(0x172)]['remoteJid']===_0x19fbee(0x13c))return;const {urlN8N:_0x5a36ef,typebotExpires:_0x28690f,typebotKeywordFinish:_0x442c3b,typebotKeywordRestart:_0x38e1cf,typebotUnknownMessage:_0x3ea7f1,typebotSlug:_0x217dd8,typebotDelayMessage:_0x3ca271,typebotRestartMessage:_0x3b1717}=_0x5e3f04;if(_0x4c17d2[_0x19fbee(0x172)][_0x19fbee(0x144)]){console[_0x19fbee(0x142)](_0x19fbee(0x192));return;}const _0x288c42=_0x4c17d2[_0x19fbee(0x172)][_0x19fbee(0x156)][_0x19fbee(0x12f)](/\D/g,'');let _0x5f00f7=(0x0,GetHandlers_1['getBodyMessage'])(_0x4c17d2);console['log'](_0x19fbee(0x1aa)+_0x5f00f7+'\x22');async function _0x2c03e6(_0x11b59e,_0x255a9d,_0x59afac){const _0x18dea3=_0x19fbee;try{console[_0x18dea3(0x142)]('[typebotListener]\x20Criando\x20nova\x20sessão\x20para\x20o\x20número:\x20'+_0x59afac);const _0x10a32f=JSON[_0x18dea3(0x15f)]({'isStreamEnabled':!![],'message':'string','resultId':_0x18dea3(0x15d),'isOnlyRegistering':![],'prefilledVariables':{'number':_0x59afac,'pushName':_0x11b59e['pushName']||'','remoteJid':_0x4a2e9a?.[_0x18dea3(0x14e)]?.[_0x18dea3(0x156)]}});console[_0x18dea3(0x142)]('[typebotListener]\x20Dados\x20da\x20requisição\x20para\x20criar\x20sessão:\x20'+_0x10a32f);const _0x1d0d9e={'method':_0x18dea3(0x194),'maxBodyLength':Infinity,'url':_0x5a36ef+_0x18dea3(0x13a)+_0x217dd8+_0x18dea3(0x128),'headers':{'Content-Type':_0x18dea3(0x13e),'Accept':_0x18dea3(0x13e)},'data':_0x10a32f};console['log'](_0x18dea3(0x148)+_0x1d0d9e['url']);const _0x39f819=await axios_1[_0x18dea3(0x154)][_0x18dea3(0x18b)](_0x1d0d9e);return console[_0x18dea3(0x142)](_0x18dea3(0x177)+_0x39f819[_0x18dea3(0x19c)]?.[_0x18dea3(0x19a)]),_0x39f819[_0x18dea3(0x19c)];}catch(_0x1039fe){console[_0x18dea3(0x196)](_0x18dea3(0x182),_0x1039fe);_0x1039fe[_0x18dea3(0x199)]&&(console[_0x18dea3(0x196)](_0x18dea3(0x14d)+JSON[_0x18dea3(0x15f)](_0x1039fe[_0x18dea3(0x199)][_0x18dea3(0x19c)])),console[_0x18dea3(0x196)]('[typebotListener]\x20Status\x20de\x20erro:\x20'+_0x1039fe['response']['status']));logger_1[_0x18dea3(0x17e)][_0x18dea3(0x162)]('Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:\x20',_0x1039fe);throw _0x1039fe;}}let _0x5aa1c4,_0x21eb54;try{const _0x5410f2=new Date();_0x5410f2[_0x19fbee(0x138)](_0x5410f2[_0x19fbee(0x19b)]()-Number(_0x28690f)),console[_0x19fbee(0x142)](_0x19fbee(0x16a)+_0x28690f+_0x19fbee(0x163)+_0x4a2e9a[_0x19fbee(0x14f)]);_0x28690f>0x0&&_0x4a2e9a[_0x19fbee(0x14f)]<_0x5410f2&&(console[_0x19fbee(0x142)](_0x19fbee(0x133)),await _0x4a2e9a['update']({'typebotSessionId':null,'chatbot':!![]}),await _0x4a2e9a[_0x19fbee(0x146)]());!_0x4a2e9a[_0x19fbee(0x16e)]?(console['log'](_0x19fbee(0x174)),_0x21eb54=await _0x2c03e6(_0x4c17d2,_0x5e3f04,_0x288c42),_0x5aa1c4=_0x21eb54[_0x19fbee(0x19a)],console['log'](_0x19fbee(0x140)+_0x5aa1c4),await _0x4a2e9a[_0x19fbee(0x19e)]({'typebotSessionId':_0x5aa1c4,'useIntegration':!![],'integrationId':_0x5e3f04['id'],'chatbot':!![]}),await _0x4a2e9a[_0x19fbee(0x146)]()):(console[_0x19fbee(0x142)](_0x19fbee(0x15e)+_0x4a2e9a['typebotSessionId']),_0x5aa1c4=_0x4a2e9a[_0x19fbee(0x16e)],_0x21eb54=undefined);if(_0x5f00f7!==_0x442c3b&&_0x5f00f7!==_0x38e1cf){let _0x3b4eea,_0x58d442,_0x22d253;if(_0x21eb54?.[_0x19fbee(0x152)]?.['length']===0x0||_0x21eb54===undefined){console[_0x19fbee(0x142)](_0x19fbee(0x1a1)+_0x5f00f7+'\x22');(!_0x5f00f7||_0x5f00f7[_0x19fbee(0x12d)]()==='')&&(_0x5f00f7=_0x19fbee(0x1a4),console['log'](_0x19fbee(0x1a5)+_0x5f00f7+'\x22'));const _0x3fde37=JSON['stringify']({'message':_0x5f00f7});let _0xf1be6={'method':_0x19fbee(0x194),'maxBodyLength':Infinity,'url':_0x5a36ef+_0x19fbee(0x13f)+_0x5aa1c4+_0x19fbee(0x16b),'headers':{'Content-Type':_0x19fbee(0x13e),'Accept':_0x19fbee(0x13e)},'data':_0x3fde37};console[_0x19fbee(0x142)](_0x19fbee(0x1a9)+_0xf1be6[_0x19fbee(0x17a)]+_0x19fbee(0x12a)+_0x3fde37);try{_0x3b4eea=await axios_1[_0x19fbee(0x154)][_0x19fbee(0x18b)](_0xf1be6),console[_0x19fbee(0x142)](_0x19fbee(0x1a8)+JSON['stringify'](_0x3b4eea['data']));if(!_0x3b4eea[_0x19fbee(0x19c)]){console[_0x19fbee(0x196)](_0x19fbee(0x13b));throw new Error(_0x19fbee(0x165));}_0x58d442=_0x3b4eea[_0x19fbee(0x19c)]?.[_0x19fbee(0x152)],_0x22d253=_0x3b4eea[_0x19fbee(0x19c)]?.['input'],console[_0x19fbee(0x142)]('[typebotListener]\x20Mensagens\x20recebidas:\x20'+(_0x58d442?.[_0x19fbee(0x18d)]||0x0)+_0x19fbee(0x136)+(_0x22d253?_0x19fbee(0x17d):_0x19fbee(0x155))),!_0x22d253&&(console[_0x19fbee(0x142)](_0x19fbee(0x18a)),await _0x4a2e9a['update']({'typebotStatus':!![]}));}catch(_0x212046){console[_0x19fbee(0x196)]('[typebotListener]\x20Erro\x20ao\x20continuar\x20chat:',_0x212046);_0x212046['response']&&(console[_0x19fbee(0x196)](_0x19fbee(0x14d)+JSON[_0x19fbee(0x15f)](_0x212046[_0x19fbee(0x199)][_0x19fbee(0x19c)])),console['error'](_0x19fbee(0x135)+_0x212046['response']['status']));await _0x4a2e9a[_0x19fbee(0x19e)]({'typebotSessionId':null}),await(0x0,SendWhatsAppMessage_1[_0x19fbee(0x154)])({'body':_0x19fbee(0x16d),'ticket':_0x4a2e9a});return;}}else console['log'](_0x19fbee(0x191)),_0x58d442=_0x21eb54?.['messages'],_0x22d253=_0x21eb54?.[_0x19fbee(0x159)];if(!_0x58d442||_0x58d442?.[_0x19fbee(0x18d)]===0x0){console[_0x19fbee(0x142)]('[typebotListener]\x20Nenhuma\x20mensagem\x20recebida.\x20Verificando\x20status\x20do\x20fluxo.');if(_0x3b4eea&&_0x3b4eea['data']&&_0x22d253===null){console[_0x19fbee(0x142)](_0x19fbee(0x167)),await _0x4a2e9a[_0x19fbee(0x19e)]({'chatbot':![],'useIntegration':![]});return;}await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x3ea7f1,'ticket':_0x4a2e9a});}else{console[_0x19fbee(0x142)](_0x19fbee(0x153)+_0x58d442['length']+_0x19fbee(0x166));for(const _0x3b9f7d of _0x58d442){if(_0x3b9f7d[_0x19fbee(0x169)]===_0x19fbee(0x130)){let _0x8f3f0d='',_0x581906=![];console['log'](_0x19fbee(0x178)+JSON['stringify'](_0x3b9f7d[_0x19fbee(0x187)]));for(const _0x501a2b of _0x3b9f7d[_0x19fbee(0x187)][_0x19fbee(0x17c)]){for(const _0x1ed5d1 of _0x501a2b[_0x19fbee(0x185)]){let _0xcbdd56='';_0x1ed5d1[_0x19fbee(0x130)]&&(_0xcbdd56=_0x1ed5d1['text']);if(_0x1ed5d1[_0x19fbee(0x169)]&&_0x1ed5d1[_0x19fbee(0x185)])for(const _0x4eca5c of _0x1ed5d1['children']){let _0x3b946f='';_0x4eca5c[_0x19fbee(0x130)]&&(_0x3b946f=_0x4eca5c[_0x19fbee(0x130)]);if(_0x4eca5c[_0x19fbee(0x169)]&&_0x4eca5c[_0x19fbee(0x185)])for(const _0x3f573f of _0x4eca5c['children']){let _0x443de8='';_0x3f573f[_0x19fbee(0x130)]&&(_0x443de8=_0x3f573f[_0x19fbee(0x130)]);_0x3f573f[_0x19fbee(0x147)]&&(_0x443de8='*'+_0x443de8+'*');_0x3f573f['italic']&&(_0x443de8='_'+_0x443de8+'_');_0x3f573f['underline']&&(_0x443de8='~'+_0x443de8+'~');if(_0x3f573f[_0x19fbee(0x17a)]){const _0x236947=_0x3f573f[_0x19fbee(0x185)][0x0]?.['text']||_0x19fbee(0x132);_0x443de8='['+_0x236947+']('+_0x3f573f['url']+')',_0x581906=!![];}_0x8f3f0d+=_0x443de8;}_0x4eca5c[_0x19fbee(0x147)]&&(_0x3b946f='*'+_0x3b946f+'*');_0x4eca5c[_0x19fbee(0x149)]&&(_0x3b946f='_'+_0x3b946f+'_');_0x4eca5c['underline']&&(_0x3b946f='~'+_0x3b946f+'~');if(_0x4eca5c[_0x19fbee(0x17a)]){const _0x8ab5ce=_0x4eca5c['children'][0x0]?.[_0x19fbee(0x130)]||_0x19fbee(0x132);_0x3b946f='['+_0x8ab5ce+']('+_0x4eca5c['url']+')',_0x581906=!![];}_0x8f3f0d+=_0x3b946f;}_0x1ed5d1[_0x19fbee(0x147)]&&(_0xcbdd56='*'+_0xcbdd56+'*');_0x1ed5d1[_0x19fbee(0x149)]&&(_0xcbdd56='_'+_0xcbdd56+'_');_0x1ed5d1[_0x19fbee(0x1a2)]&&(_0xcbdd56='~'+_0xcbdd56+'~');if(_0x1ed5d1[_0x19fbee(0x17a)]){const _0x51f230=_0x1ed5d1[_0x19fbee(0x185)][0x0]?.[_0x19fbee(0x130)]||_0x19fbee(0x132);_0xcbdd56='['+_0x51f230+']('+_0x1ed5d1[_0x19fbee(0x17a)]+')',_0x581906=!![];}_0x8f3f0d+=_0xcbdd56;}_0x8f3f0d+='\x0a';}_0x8f3f0d=_0x8f3f0d[_0x19fbee(0x12f)]('**','')[_0x19fbee(0x12f)](/\n$/,'');_0x8f3f0d===_0x19fbee(0x143)&&(_0x8f3f0d=_0x3ea7f1);if(_0x8f3f0d[_0x19fbee(0x198)]('#')){let _0x213544=_0x8f3f0d[_0x19fbee(0x12f)]('#','');try{console[_0x19fbee(0x142)](_0x19fbee(0x18e)+_0x213544);let _0x5696b4=JSON[_0x19fbee(0x14b)](_0x213544);if(_0x5696b4[_0x19fbee(0x141)]&&(0x0,lodash_1[_0x19fbee(0x171)])(_0x5696b4['userId'])&&(0x0,lodash_1[_0x19fbee(0x171)])(_0x5696b4[_0x19fbee(0x157)])){console[_0x19fbee(0x142)](_0x19fbee(0x195)),await _0x4a2e9a[_0x19fbee(0x19e)]({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1[_0x19fbee(0x171)])(_0x5696b4[_0x19fbee(0x157)])&&_0x5696b4['queueId']>0x0&&(0x0,lodash_1[_0x19fbee(0x171)])(_0x5696b4[_0x19fbee(0x131)])){console[_0x19fbee(0x142)](_0x19fbee(0x190)+_0x5696b4[_0x19fbee(0x157)]),await(0x0,UpdateTicketService_1[_0x19fbee(0x154)])({'ticketData':{'queueId':_0x5696b4['queueId'],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x4a2e9a['id'],'companyId':_0x4a2e9a['companyId']});return;}if(!(0x0,lodash_1[_0x19fbee(0x171)])(_0x5696b4['queueId'])&&_0x5696b4[_0x19fbee(0x157)]>0x0&&!(0x0,lodash_1[_0x19fbee(0x171)])(_0x5696b4['userId'])&&_0x5696b4[_0x19fbee(0x131)]>0x0){console[_0x19fbee(0x142)](_0x19fbee(0x139)+_0x5696b4[_0x19fbee(0x157)]+_0x19fbee(0x12c)+_0x5696b4[_0x19fbee(0x131)]),await(0x0,UpdateTicketService_1[_0x19fbee(0x154)])({'ticketData':{'queueId':_0x5696b4['queueId'],'userId':_0x5696b4[_0x19fbee(0x131)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x4a2e9a['id'],'companyId':_0x4a2e9a[_0x19fbee(0x137)]});return;}}catch(_0x26f122){console[_0x19fbee(0x196)](_0x19fbee(0x161),_0x26f122);throw _0x26f122;}}console[_0x19fbee(0x142)](_0x19fbee(0x170)+_0x8f3f0d[_0x19fbee(0x158)](0x0,0x32)+(_0x8f3f0d['length']>0x32?'...':'')+'\x22'),await(0x0,SendPresenceStatus_1[_0x19fbee(0x12b)])(_0x19053d,_0x4c17d2[_0x19fbee(0x172)][_0x19fbee(0x156)],_0x3ca271),await(0x0,SendWhatsAppMessage_1[_0x19fbee(0x154)])({'body':_0x8f3f0d,'ticket':_0x4a2e9a});}if(_0x3b9f7d[_0x19fbee(0x169)]===_0x19fbee(0x184)){console[_0x19fbee(0x142)]('[typebotListener]\x20Processando\x20mensagem\x20de\x20áudio:\x20'+_0x3b9f7d[_0x19fbee(0x187)]['url']),await(0x0,SendPresenceStatus_1[_0x19fbee(0x12b)])(_0x19053d,_0x4c17d2[_0x19fbee(0x172)][_0x19fbee(0x156)],_0x3ca271);try{await(0x0,SendWhatsAppMedia_1[_0x19fbee(0x154)])({'media':_0x3b9f7d[_0x19fbee(0x187)]['url'],'ticket':_0x4a2e9a}),console[_0x19fbee(0x142)]('[typebotListener]\x20Áudio\x20enviado\x20com\x20sucesso.');}catch(_0x26fb63){console[_0x19fbee(0x196)]('[typebotListener]\x20Erro\x20ao\x20enviar\x20áudio:',_0x26fb63),Sentry[_0x19fbee(0x168)](_0x26fb63);throw _0x26fb63;}}if(_0x3b9f7d[_0x19fbee(0x169)]==='image'){console[_0x19fbee(0x142)]('[typebotListener]\x20Processando\x20mensagem\x20de\x20imagem:\x20'+_0x3b9f7d['content']['url']),await(0x0,SendPresenceStatus_1[_0x19fbee(0x12b)])(_0x19053d,_0x4c17d2[_0x19fbee(0x172)][_0x19fbee(0x156)],_0x3ca271);try{await(0x0,SendWhatsAppMedia_1[_0x19fbee(0x154)])({'media':_0x3b9f7d['content'][_0x19fbee(0x17a)],'ticket':_0x4a2e9a}),console[_0x19fbee(0x142)](_0x19fbee(0x193));}catch(_0x33de1a){console[_0x19fbee(0x196)](_0x19fbee(0x15a),_0x33de1a),Sentry['captureException'](_0x33de1a);throw _0x33de1a;}}if(_0x3b9f7d[_0x19fbee(0x169)]===_0x19fbee(0x19f)){console['log'](_0x19fbee(0x189)+_0x3b9f7d[_0x19fbee(0x187)]['url']),await(0x0,SendPresenceStatus_1[_0x19fbee(0x12b)])(_0x19053d,_0x4c17d2['key'][_0x19fbee(0x156)],_0x3ca271);try{await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x3b9f7d[_0x19fbee(0x187)]['url'],'ticket':_0x4a2e9a}),console[_0x19fbee(0x142)](_0x19fbee(0x1a3));}catch(_0x5b358f){console['error'](_0x19fbee(0x1a6),_0x5b358f),Sentry[_0x19fbee(0x168)](_0x5b358f);throw _0x5b358f;}}}}}_0x5f00f7===_0x38e1cf&&(console[_0x19fbee(0x142)](_0x19fbee(0x17f)),await _0x4a2e9a[_0x19fbee(0x19e)]({'chatbot':!![],'typebotSessionId':null}),await _0x4a2e9a['reload'](),await(0x0,SendWhatsAppMessage_1[_0x19fbee(0x154)])({'body':_0x3b1717,'ticket':_0x4a2e9a}));if(_0x5f00f7===_0x442c3b){console[_0x19fbee(0x142)](_0x19fbee(0x188)),await(0x0,UpdateTicketService_1[_0x19fbee(0x154)])({'ticketData':{'status':_0x19fbee(0x16c),'useIntegration':![],'integrationId':null},'ticketId':_0x4a2e9a['id'],'companyId':_0x4a2e9a['companyId']});return;}}catch(_0x1a5824){console[_0x19fbee(0x196)]('[typebotListener]\x20Erro\x20geral:',_0x1a5824);_0x1a5824[_0x19fbee(0x199)]&&(console[_0x19fbee(0x196)](_0x19fbee(0x14d)+JSON[_0x19fbee(0x15f)](_0x1a5824[_0x19fbee(0x199)][_0x19fbee(0x19c)])),console[_0x19fbee(0x196)](_0x19fbee(0x135)+_0x1a5824['response'][_0x19fbee(0x145)]));logger_1[_0x19fbee(0x17e)]['info'](_0x19fbee(0x124),_0x1a5824),await _0x4a2e9a[_0x19fbee(0x19e)]({'typebotSessionId':null});try{await(0x0,SendWhatsAppMessage_1[_0x19fbee(0x154)])({'body':'Desculpe,\x20ocorreu\x20um\x20erro\x20na\x20nossa\x20comunicação.\x20Por\x20favor,\x20envie\x20uma\x20nova\x20mensagem\x20para\x20recomeçar.','ticket':_0x4a2e9a});}catch(_0x298f3){console[_0x19fbee(0x196)]('[typebotListener]\x20Erro\x20ao\x20enviar\x20mensagem\x20de\x20erro:',_0x298f3);}}};function a558_0x988b(_0x34ee9a,_0x343501){const _0x2b8311=a558_0x4ded();return a558_0x988b=function(_0x121bbc,_0x28e39a){_0x121bbc=_0x121bbc-0x124;let _0x4ded30=_0x2b8311[_0x121bbc];return _0x4ded30;},a558_0x988b(_0x34ee9a,_0x343501);}exports[a558_0x2b141f(0x154)]=typebotListener;