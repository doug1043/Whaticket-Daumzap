const a674_0x48ce3b=a674_0x1e84;function a674_0x13e2(){const _0x546b94=['8236250ITAqoo','__esModule','queues','defineProperty','2455JgmjHH','16EhjGZG','startWork','findOne','66WILByi','getIO','9012BtVBAt','../../errors/AppError','3110925aAloRm','padStart','2959182MmKvMe','where','ERR_DAY_NOT_ALLOWED','toString','email','allTicket','status','1761700KsToXm','allowedWeekDays','33SMtgLV','defaultMenu','default','toLowerCase','Sequelize','constructor','LOWER','emit','../../models/Setting','../../models/User','isTricked','createRefreshToken','ERR_INVALID_CREDENTIALS','endWork','profile','includes','267370RwJTda','596120VAlATN','__importDefault','whatsappId','getDay','../../helpers/SerializeUser','update','company','getMinutes','admin','spy','col'];a674_0x13e2=function(){return _0x546b94;};return a674_0x13e2();}(function(_0x15afc6,_0x55d8de){const _0x5e8997=a674_0x1e84,_0x22048c=_0x15afc6();while(!![]){try{const _0x2d38e0=-parseInt(_0x5e8997(0xfc))/0x1+parseInt(_0x5e8997(0x11d))/0x2+-parseInt(_0x5e8997(0x114))/0x3+parseInt(_0x5e8997(0x112))/0x4*(-parseInt(_0x5e8997(0x10c))/0x5)+-parseInt(_0x5e8997(0x110))/0x6*(parseInt(_0x5e8997(0xfd))/0x7)+parseInt(_0x5e8997(0x10d))/0x8*(parseInt(_0x5e8997(0x116))/0x9)+-parseInt(_0x5e8997(0x108))/0xa*(-parseInt(_0x5e8997(0x11f))/0xb);if(_0x2d38e0===_0x55d8de)break;else _0x22048c['push'](_0x22048c['shift']());}catch(_0x20d367){_0x22048c['push'](_0x22048c['shift']());}}}(a674_0x13e2,0xa19e9));const a674_0xea3e7c=(function(){let _0x56cd1d=!![];return function(_0x1ad893,_0x106c69){const _0x40545b=_0x56cd1d?function(){if(_0x106c69){const _0x1ed380=_0x106c69['apply'](_0x1ad893,arguments);return _0x106c69=null,_0x1ed380;}}:function(){};return _0x56cd1d=![],_0x40545b;};}()),a674_0x2e1864=a674_0xea3e7c(this,function(){const _0x39105f=a674_0x1e84;return a674_0x2e1864['toString']()['search']('(((.+)+)+)+$')[_0x39105f(0x119)]()[_0x39105f(0x124)](a674_0x2e1864)['search']('(((.+)+)+)+$');});a674_0x2e1864();'use strict';var __importDefault=this&&this[a674_0x48ce3b(0xfe)]||function(_0xfe0c3f){const _0xda1b49=a674_0x48ce3b;return _0xfe0c3f&&_0xfe0c3f[_0xda1b49(0x109)]?_0xfe0c3f:{'default':_0xfe0c3f};};Object[a674_0x48ce3b(0x10b)](exports,a674_0x48ce3b(0x109),{'value':!![]});function a674_0x1e84(_0x4fc9d6,_0x536e15){const _0x44a434=a674_0x13e2();return a674_0x1e84=function(_0x2e1864,_0xea3e7c){_0x2e1864=_0x2e1864-0xfa;let _0x13e2c3=_0x44a434[_0x2e1864];return _0x13e2c3;},a674_0x1e84(_0x4fc9d6,_0x536e15);}const sequelize_1=require('sequelize'),User_1=__importDefault(require(a674_0x48ce3b(0x128))),AppError_1=__importDefault(require(a674_0x48ce3b(0x113))),CreateTokens_1=require('../../helpers/CreateTokens'),SerializeUser_1=require(a674_0x48ce3b(0x101)),Company_1=__importDefault(require('../../models/Company')),Setting_1=__importDefault(require(a674_0x48ce3b(0x127))),socket_1=require('../../libs/socket'),AuthUserService=async({email:_0x322180,password:_0x15a438})=>{const _0x2d91ea=a674_0x48ce3b,_0x241d55=await User_1[_0x2d91ea(0x121)][_0x2d91ea(0x10f)]({'where':sequelize_1[_0x2d91ea(0x123)][_0x2d91ea(0x117)](sequelize_1[_0x2d91ea(0x123)]['fn'](_0x2d91ea(0x125),sequelize_1[_0x2d91ea(0x123)][_0x2d91ea(0x107)](_0x2d91ea(0x11a))),_0x322180[_0x2d91ea(0x122)]()),'include':[_0x2d91ea(0x10a),{'model':Company_1['default'],'include':[{'model':Setting_1[_0x2d91ea(0x121)]}]}]});if(!_0x241d55)throw new AppError_1[(_0x2d91ea(0x121))](_0x2d91ea(0x12b),0x191);if(!await _0x241d55['checkPassword'](_0x15a438))throw new AppError_1[(_0x2d91ea(0x121))]('ERR_INVALID_CREDENTIALS',0x191);if(_0x241d55[_0x2d91ea(0x103)]&&_0x241d55[_0x2d91ea(0x103)][_0x2d91ea(0x11c)]===![])throw new AppError_1[(_0x2d91ea(0x121))]('ERR_COMPANY_BLOCKED',0x191);if(_0x241d55[_0x2d91ea(0xfa)]!==_0x2d91ea(0x105)&&_0x241d55[_0x2d91ea(0x11e)]){const _0x4d62b3=new Date(),_0x28e420=String(_0x4d62b3[_0x2d91ea(0x100)]()),_0x5d0ec8=_0x241d55['allowedWeekDays']['split'](',');if(!_0x5d0ec8[_0x2d91ea(0xfb)](_0x28e420))throw new AppError_1[(_0x2d91ea(0x121))](_0x2d91ea(0x118),0x191);}if(_0x241d55[_0x2d91ea(0xfa)]!=='admin'&&_0x241d55[_0x2d91ea(0x10e)]&&_0x241d55[_0x2d91ea(0x12c)]){const _0x40f5e9=new Date(),_0x3ea2bd=String(_0x40f5e9['getHours']())['padStart'](0x2,'0')+':'+String(_0x40f5e9[_0x2d91ea(0x104)]())[_0x2d91ea(0x115)](0x2,'0');if(_0x3ea2bd<_0x241d55[_0x2d91ea(0x10e)]||_0x3ea2bd>_0x241d55['endWork'])throw new AppError_1[(_0x2d91ea(0x121))]('ERR_OUT_OF_WORK_HOURS',0x191);}await _0x241d55[_0x2d91ea(0x102)]({'online':!![]});const _0x1e4867=(0x0,socket_1[_0x2d91ea(0x111)])();_0x1e4867[_0x2d91ea(0x126)]('company-'+_0x241d55['companyId']+'-user',{'action':'update','user':{'id':_0x241d55['id'],'name':_0x241d55['name'],'email':_0x241d55[_0x2d91ea(0x11a)],'profile':_0x241d55['profile'],'online':!![],'isTricked':_0x241d55[_0x2d91ea(0x129)],'spy':_0x241d55[_0x2d91ea(0x106)],'allTicket':_0x241d55[_0x2d91ea(0x11b)],'whatsappId':_0x241d55[_0x2d91ea(0xff)],'startWork':_0x241d55['startWork'],'endWork':_0x241d55['endWork'],'defaultMenu':_0x241d55[_0x2d91ea(0x120)]}});const _0x4de4a0=(0x0,CreateTokens_1['createAccessToken'])(_0x241d55),_0x1e4c26=(0x0,CreateTokens_1[_0x2d91ea(0x12a)])(_0x241d55),_0x41d44f=await(0x0,SerializeUser_1['SerializeUser'])(_0x241d55);return{'serializedUser':_0x41d44f,'token':_0x4de4a0,'refreshToken':_0x1e4c26};};exports[a674_0x48ce3b(0x121)]=AuthUserService;