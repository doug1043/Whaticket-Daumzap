const a576_0x533fe7=a576_0x2e70;(function(_0x1c8996,_0x3e421a){const _0x11fcbb=a576_0x2e70,_0x4eda37=_0x1c8996();while(!![]){try{const _0xe8f2a=parseInt(_0x11fcbb(0x14f))/0x1+parseInt(_0x11fcbb(0x136))/0x2+-parseInt(_0x11fcbb(0x13c))/0x3+-parseInt(_0x11fcbb(0x158))/0x4*(parseInt(_0x11fcbb(0x141))/0x5)+-parseInt(_0x11fcbb(0x156))/0x6+parseInt(_0x11fcbb(0x144))/0x7*(-parseInt(_0x11fcbb(0x13d))/0x8)+parseInt(_0x11fcbb(0x145))/0x9;if(_0xe8f2a===_0x3e421a)break;else _0x4eda37['push'](_0x4eda37['shift']());}catch(_0x8c58c9){_0x4eda37['push'](_0x4eda37['shift']());}}}(a576_0x5961,0x5d81f));function a576_0x2e70(_0x3e0078,_0x4083e1){const _0x149d86=a576_0x5961();return a576_0x2e70=function(_0x7e54b,_0x38baee){_0x7e54b=_0x7e54b-0x136;let _0x5961ba=_0x149d86[_0x7e54b];return _0x5961ba;},a576_0x2e70(_0x3e0078,_0x4083e1);}const a576_0x38baee=(function(){let _0x35ddb2=!![];return function(_0x3adac8,_0x342427){const _0x21db70=_0x35ddb2?function(){const _0x4a695b=a576_0x2e70;if(_0x342427){const _0x3fe951=_0x342427[_0x4a695b(0x14b)](_0x3adac8,arguments);return _0x342427=null,_0x3fe951;}}:function(){};return _0x35ddb2=![],_0x21db70;};}()),a576_0x7e54b=a576_0x38baee(this,function(){const _0x21dc32=a576_0x2e70;return a576_0x7e54b[_0x21dc32(0x15e)]()[_0x21dc32(0x143)]('(((.+)+)+)+$')[_0x21dc32(0x15e)]()['constructor'](a576_0x7e54b)[_0x21dc32(0x143)]('(((.+)+)+)+$');});a576_0x7e54b();function a576_0x5961(){const _0x2f39d2=['oldMessages','759305UwgiJQ','company-','status','-notification','findByPk','ticketId','emit','4496916ozwqkh','../../models/User','68nbRATH','queue','companyId','update','../../helpers/GetTicketWbot','parse','toString','key','../../models/OldMessage','../../models/Message','contact','1125378NriFZF','ERR_EDITING_WAPP_MSG','default','body','user','queueId','377448rtNEzG','292184OnchbP','No\x20message\x20found\x20with\x20this\x20ID.','getIO','upsert','200245vVyTDr','../../models/Ticket','search','91FuGNYn','9827523jPOafV','findOne','__esModule','queue-','quotedMsg','../../helpers/Mustache','apply','ticket','remoteJid'];a576_0x5961=function(){return _0x2f39d2;};return a576_0x5961();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x35885b){return _0x35885b&&_0x35885b['__esModule']?_0x35885b:{'default':_0x35885b};};Object['defineProperty'](exports,a576_0x533fe7(0x147),{'value':!![]});const AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require(a576_0x533fe7(0x15c))),Message_1=__importDefault(require(a576_0x533fe7(0x161))),OldMessage_1=__importDefault(require(a576_0x533fe7(0x160))),Ticket_1=__importDefault(require(a576_0x533fe7(0x142))),Mustache_1=__importDefault(require(a576_0x533fe7(0x14a))),User_1=__importDefault(require(a576_0x533fe7(0x157))),socket_1=require('../../libs/socket'),EditWhatsAppMessage=async({messageId:_0x82183a,companyId:_0x398c08,userId:_0x34355a,body:_0x23e5ce})=>{const _0x30a3f6=a576_0x533fe7,_0x2f06a6=await Message_1[_0x30a3f6(0x138)]['findOne']({'where':{'id':_0x82183a,'companyId':_0x398c08},'include':[{'model':Ticket_1[_0x30a3f6(0x138)],'as':'ticket','include':[_0x30a3f6(0x162),_0x30a3f6(0x159),_0x30a3f6(0x13a)]}]}),_0x3e6abc=_0x34355a&&await User_1[_0x30a3f6(0x138)][_0x30a3f6(0x153)](_0x34355a);if(!_0x2f06a6)throw new AppError_1[(_0x30a3f6(0x138))](_0x30a3f6(0x13e));const {ticket:_0x3c80a1}=_0x2f06a6,_0x53335a=await(0x0,GetTicketWbot_1[_0x30a3f6(0x138)])(_0x3c80a1),_0x5a4cc8=JSON[_0x30a3f6(0x15d)](_0x2f06a6['dataJson']),_0x451d94=(0x0,Mustache_1[_0x30a3f6(0x138)])(_0x23e5ce,_0x3c80a1,_0x3e6abc);try{await _0x53335a['sendMessage'](_0x2f06a6[_0x30a3f6(0x14d)],{'text':_0x451d94,'edit':_0x5a4cc8[_0x30a3f6(0x15f)]},{});const _0x53287d={'messageId':_0x82183a,'body':_0x2f06a6[_0x30a3f6(0x139)],'ticketId':_0x2f06a6[_0x30a3f6(0x154)]};await OldMessage_1[_0x30a3f6(0x138)][_0x30a3f6(0x140)](_0x53287d),await _0x2f06a6[_0x30a3f6(0x15b)]({'body':_0x451d94,'isEdited':!![]}),await _0x3c80a1[_0x30a3f6(0x15b)]({'lastMessage':_0x451d94});const _0x3cfd42=(0x0,socket_1[_0x30a3f6(0x13f)])();_0x3cfd42['to'](_0x3c80a1['id'][_0x30a3f6(0x15e)]())['to'](_0x30a3f6(0x150)+_0x398c08+'-'+_0x3c80a1['status'])['to'](_0x30a3f6(0x150)+_0x398c08+_0x30a3f6(0x152))['to'](_0x30a3f6(0x148)+_0x3c80a1[_0x30a3f6(0x13b)]+'-'+_0x3c80a1[_0x30a3f6(0x151)])['to']('queue-'+_0x3c80a1[_0x30a3f6(0x13b)]+_0x30a3f6(0x152))[_0x30a3f6(0x155)](_0x30a3f6(0x150)+_0x3c80a1[_0x30a3f6(0x15a)]+'-ticket',{'action':_0x30a3f6(0x15b),'ticket':_0x3c80a1,'ticketId':_0x3c80a1['id']});const _0x4db6f8=await Message_1['default'][_0x30a3f6(0x146)]({'where':{'id':_0x82183a,'companyId':_0x398c08},'include':[{'model':Ticket_1[_0x30a3f6(0x138)],'as':_0x30a3f6(0x14c),'include':[_0x30a3f6(0x162)]},{'model':Message_1[_0x30a3f6(0x138)],'as':_0x30a3f6(0x149),'include':['contact'],'where':{'companyId':_0x398c08},'required':![]},{'model':OldMessage_1['default'],'as':_0x30a3f6(0x14e),'where':{'ticketId':_0x2f06a6[_0x30a3f6(0x154)]},'required':![]}]});return{'ticketId':_0x4db6f8['ticketId'],'message':_0x4db6f8};}catch(_0x487ca2){console['log'](_0x487ca2);throw new AppError_1[(_0x30a3f6(0x138))](_0x30a3f6(0x137));}};exports[a576_0x533fe7(0x138)]=EditWhatsAppMessage;