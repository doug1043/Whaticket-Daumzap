const a566_0x2bc366=a566_0x543c;(function(_0x2eafd5,_0xd2d2cb){const _0x1a5144=a566_0x543c,_0x4fb53f=_0x2eafd5();while(!![]){try{const _0xbf72fb=-parseInt(_0x1a5144(0x191))/0x1*(parseInt(_0x1a5144(0x18e))/0x2)+-parseInt(_0x1a5144(0x188))/0x3+-parseInt(_0x1a5144(0x1a4))/0x4*(parseInt(_0x1a5144(0x1ad))/0x5)+parseInt(_0x1a5144(0x1ac))/0x6+-parseInt(_0x1a5144(0x1ab))/0x7*(-parseInt(_0x1a5144(0x194))/0x8)+-parseInt(_0x1a5144(0x1a0))/0x9+parseInt(_0x1a5144(0x18c))/0xa;if(_0xbf72fb===_0xd2d2cb)break;else _0x4fb53f['push'](_0x4fb53f['shift']());}catch(_0x31a2fa){_0x4fb53f['push'](_0x4fb53f['shift']());}}}(a566_0x3e6d,0xd869d));const a566_0x16a730=(function(){let _0x1419d7=!![];return function(_0x53e6f1,_0x3c7c7a){const _0x138ce3=_0x1419d7?function(){if(_0x3c7c7a){const _0x5b00a9=_0x3c7c7a['apply'](_0x53e6f1,arguments);return _0x3c7c7a=null,_0x5b00a9;}}:function(){};return _0x1419d7=![],_0x138ce3;};}()),a566_0x5141c9=a566_0x16a730(this,function(){const _0x458f90=a566_0x543c;return a566_0x5141c9[_0x458f90(0x18b)]()[_0x458f90(0x1b3)](_0x458f90(0x19b))[_0x458f90(0x18b)]()[_0x458f90(0x19a)](a566_0x5141c9)[_0x458f90(0x1b3)](_0x458f90(0x19b));});a566_0x5141c9();'use strict';var __importDefault=this&&this[a566_0x2bc366(0x186)]||function(_0x57f580){return _0x57f580&&_0x57f580['__esModule']?_0x57f580:{'default':_0x57f580};};Object[a566_0x2bc366(0x19f)](exports,'__esModule',{'value':!![]});function a566_0x3e6d(){const _0x46da51=['search','update','user','__importDefault','default','3437910fUErAE','findByPk','../../helpers/GetTicketWbot','toString','14449930KIMcqJ','../../models/Message','26MFWyWv','companyId','ticket','42870eONPab','No\x20message\x20found\x20with\x20this\x20ID.','queue-','320QEotGn','../../helpers/Mustache','ERR_EDITING_WAPP_MSG','ticketId','quotedMsg','log','constructor','(((.+)+)+)+$','queueId','remoteJid','contact','defineProperty','1065915csBCZT','-notification','parse','dataJson','1572Xiezxr','../../errors/AppError','company-','key','findOne','status','upsert','149338gGlBUX','3236886vPyGHl','1650qPkaFE','body','oldMessages','emit','getIO','sendMessage'];a566_0x3e6d=function(){return _0x46da51;};return a566_0x3e6d();}const AppError_1=__importDefault(require(a566_0x2bc366(0x1a5))),GetTicketWbot_1=__importDefault(require(a566_0x2bc366(0x18a))),Message_1=__importDefault(require(a566_0x2bc366(0x18d))),OldMessage_1=__importDefault(require('../../models/OldMessage')),Ticket_1=__importDefault(require('../../models/Ticket')),Mustache_1=__importDefault(require(a566_0x2bc366(0x195))),User_1=__importDefault(require('../../models/User')),socket_1=require('../../libs/socket'),EditWhatsAppMessage=async({messageId:_0x25ce3a,companyId:_0x1bea49,userId:_0x522c51,body:_0x5e5c2c})=>{const _0x4f28af=a566_0x2bc366,_0x510e8c=await Message_1[_0x4f28af(0x187)][_0x4f28af(0x1a8)]({'where':{'id':_0x25ce3a,'companyId':_0x1bea49},'include':[{'model':Ticket_1[_0x4f28af(0x187)],'as':_0x4f28af(0x190),'include':[_0x4f28af(0x19e),'queue',_0x4f28af(0x185)]}]}),_0xd78d4b=_0x522c51&&await User_1[_0x4f28af(0x187)][_0x4f28af(0x189)](_0x522c51);if(!_0x510e8c)throw new AppError_1[(_0x4f28af(0x187))](_0x4f28af(0x192));const {ticket:_0x5a83ed}=_0x510e8c,_0x1ed285=await(0x0,GetTicketWbot_1['default'])(_0x5a83ed),_0x1fa31a=JSON[_0x4f28af(0x1a2)](_0x510e8c[_0x4f28af(0x1a3)]),_0x17c351=(0x0,Mustache_1[_0x4f28af(0x187)])(_0x5e5c2c,_0x5a83ed,_0xd78d4b);try{await _0x1ed285[_0x4f28af(0x1b2)](_0x510e8c[_0x4f28af(0x19d)],{'text':_0x17c351,'edit':_0x1fa31a[_0x4f28af(0x1a7)]},{});const _0x7340ef={'messageId':_0x25ce3a,'body':_0x510e8c[_0x4f28af(0x1ae)],'ticketId':_0x510e8c[_0x4f28af(0x197)]};await OldMessage_1['default'][_0x4f28af(0x1aa)](_0x7340ef),await _0x510e8c[_0x4f28af(0x1b4)]({'body':_0x17c351,'isEdited':!![]}),await _0x5a83ed[_0x4f28af(0x1b4)]({'lastMessage':_0x17c351});const _0x19a13c=(0x0,socket_1[_0x4f28af(0x1b1)])();_0x19a13c['to'](_0x5a83ed['id'][_0x4f28af(0x18b)]())['to'](_0x4f28af(0x1a6)+_0x1bea49+'-'+_0x5a83ed[_0x4f28af(0x1a9)])['to'](_0x4f28af(0x1a6)+_0x1bea49+_0x4f28af(0x1a1))['to'](_0x4f28af(0x193)+_0x5a83ed[_0x4f28af(0x19c)]+'-'+_0x5a83ed[_0x4f28af(0x1a9)])['to']('queue-'+_0x5a83ed[_0x4f28af(0x19c)]+'-notification')[_0x4f28af(0x1b0)](_0x4f28af(0x1a6)+_0x5a83ed[_0x4f28af(0x18f)]+'-ticket',{'action':_0x4f28af(0x1b4),'ticket':_0x5a83ed,'ticketId':_0x5a83ed['id']});const _0xab978d=await Message_1[_0x4f28af(0x187)][_0x4f28af(0x1a8)]({'where':{'id':_0x25ce3a,'companyId':_0x1bea49},'include':[{'model':Ticket_1['default'],'as':'ticket','include':[_0x4f28af(0x19e)]},{'model':Message_1[_0x4f28af(0x187)],'as':_0x4f28af(0x198),'include':[_0x4f28af(0x19e)],'where':{'companyId':_0x1bea49},'required':![]},{'model':OldMessage_1['default'],'as':_0x4f28af(0x1af),'where':{'ticketId':_0x510e8c['ticketId']},'required':![]}]});return{'ticketId':_0xab978d[_0x4f28af(0x197)],'message':_0xab978d};}catch(_0xca32b1){console[_0x4f28af(0x199)](_0xca32b1);throw new AppError_1[(_0x4f28af(0x187))](_0x4f28af(0x196));}};function a566_0x543c(_0x4a4fe5,_0x303c40){const _0x3d3450=a566_0x3e6d();return a566_0x543c=function(_0x5141c9,_0x16a730){_0x5141c9=_0x5141c9-0x185;let _0x3e6dff=_0x3d3450[_0x5141c9];return _0x3e6dff;},a566_0x543c(_0x4a4fe5,_0x303c40);}exports[a566_0x2bc366(0x187)]=EditWhatsAppMessage;