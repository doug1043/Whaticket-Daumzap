const a572_0x5cf02b=a572_0x4642;(function(_0x54dd81,_0x2c7577){const _0x14d44b=a572_0x4642,_0x3a6dff=_0x54dd81();while(!![]){try{const _0x422e52=parseInt(_0x14d44b(0x111))/0x1+-parseInt(_0x14d44b(0x113))/0x2*(-parseInt(_0x14d44b(0x104))/0x3)+parseInt(_0x14d44b(0x105))/0x4+-parseInt(_0x14d44b(0x109))/0x5+-parseInt(_0x14d44b(0x102))/0x6+-parseInt(_0x14d44b(0x11d))/0x7+parseInt(_0x14d44b(0x10c))/0x8*(-parseInt(_0x14d44b(0x11c))/0x9);if(_0x422e52===_0x2c7577)break;else _0x3a6dff['push'](_0x3a6dff['shift']());}catch(_0x374009){_0x3a6dff['push'](_0x3a6dff['shift']());}}}(a572_0x4d62,0xe192f));const a572_0x4d1a3b=(function(){let _0x2debc8=!![];return function(_0x5d3bef,_0x407466){const _0x2d4471=_0x2debc8?function(){const _0xedf5fd=a572_0x4642;if(_0x407466){const _0x14eb65=_0x407466[_0xedf5fd(0x122)](_0x5d3bef,arguments);return _0x407466=null,_0x14eb65;}}:function(){};return _0x2debc8=![],_0x2d4471;};}()),a572_0x92e325=a572_0x4d1a3b(this,function(){const _0x52d75e=a572_0x4642;return a572_0x92e325['toString']()[_0x52d75e(0xfc)](_0x52d75e(0x11f))[_0x52d75e(0x10b)]()[_0x52d75e(0x117)](a572_0x92e325)[_0x52d75e(0xfc)](_0x52d75e(0x11f));});a572_0x92e325();'use strict';var __importDefault=this&&this[a572_0x5cf02b(0x11e)]||function(_0x5868e1){return _0x5868e1&&_0x5868e1['__esModule']?_0x5868e1:{'default':_0x5868e1};};function a572_0x4d62(){const _0x32d0e3=['search','../../errors/AppError','dataJson','log','contact','findOne','4830450MibwAp','ERR_EDITING_WAPP_MSG','786246cShllk','7242068blKaDN','remoteJid','-notification','parse','653930cPZHVn','emit','toString','584qkWCRR','sendMessage','queueId','No\x20message\x20found\x20with\x20this\x20ID.','default','1384929pBWAhL','../../models/Ticket','4aWhaQK','../../models/User','-ticket','update','constructor','ticketId','queue','ticket','__esModule','159615PIGXJH','3956001FQkluJ','__importDefault','(((.+)+)+)+$','quotedMsg','../../helpers/GetTicketWbot','apply','defineProperty','../../helpers/Mustache','body','queue-','../../models/Message','key','upsert','company-','companyId','../../libs/socket','status','user'];a572_0x4d62=function(){return _0x32d0e3;};return a572_0x4d62();}function a572_0x4642(_0x6675b7,_0xbf1d74){const _0x5cc651=a572_0x4d62();return a572_0x4642=function(_0x92e325,_0x4d1a3b){_0x92e325=_0x92e325-0xfb;let _0x4d625b=_0x5cc651[_0x92e325];return _0x4d625b;},a572_0x4642(_0x6675b7,_0xbf1d74);}Object[a572_0x5cf02b(0x123)](exports,a572_0x5cf02b(0x11b),{'value':!![]});const AppError_1=__importDefault(require(a572_0x5cf02b(0xfd))),GetTicketWbot_1=__importDefault(require(a572_0x5cf02b(0x121))),Message_1=__importDefault(require(a572_0x5cf02b(0x127))),OldMessage_1=__importDefault(require('../../models/OldMessage')),Ticket_1=__importDefault(require(a572_0x5cf02b(0x112))),Mustache_1=__importDefault(require(a572_0x5cf02b(0x124))),User_1=__importDefault(require(a572_0x5cf02b(0x114))),socket_1=require(a572_0x5cf02b(0x12c)),EditWhatsAppMessage=async({messageId:_0x26d9fb,companyId:_0x42df6a,userId:_0x2e11d2,body:_0xa9a845})=>{const _0x4f0a30=a572_0x5cf02b,_0x18569a=await Message_1[_0x4f0a30(0x110)]['findOne']({'where':{'id':_0x26d9fb,'companyId':_0x42df6a},'include':[{'model':Ticket_1['default'],'as':'ticket','include':[_0x4f0a30(0x100),_0x4f0a30(0x119),_0x4f0a30(0xfb)]}]}),_0xe7e5c3=_0x2e11d2&&await User_1['default']['findByPk'](_0x2e11d2);if(!_0x18569a)throw new AppError_1[(_0x4f0a30(0x110))](_0x4f0a30(0x10f));const {ticket:_0xb3e3bb}=_0x18569a,_0x10c8bb=await(0x0,GetTicketWbot_1[_0x4f0a30(0x110)])(_0xb3e3bb),_0x21906f=JSON[_0x4f0a30(0x108)](_0x18569a[_0x4f0a30(0xfe)]),_0x288de8=(0x0,Mustache_1[_0x4f0a30(0x110)])(_0xa9a845,_0xb3e3bb,_0xe7e5c3);try{await _0x10c8bb[_0x4f0a30(0x10d)](_0x18569a[_0x4f0a30(0x106)],{'text':_0x288de8,'edit':_0x21906f[_0x4f0a30(0x128)]},{});const _0x177f08={'messageId':_0x26d9fb,'body':_0x18569a[_0x4f0a30(0x125)],'ticketId':_0x18569a[_0x4f0a30(0x118)]};await OldMessage_1[_0x4f0a30(0x110)][_0x4f0a30(0x129)](_0x177f08),await _0x18569a[_0x4f0a30(0x116)]({'body':_0x288de8,'isEdited':!![]}),await _0xb3e3bb[_0x4f0a30(0x116)]({'lastMessage':_0x288de8});const _0x36c127=(0x0,socket_1['getIO'])();_0x36c127['to'](_0xb3e3bb['id'][_0x4f0a30(0x10b)]())['to'](_0x4f0a30(0x12a)+_0x42df6a+'-'+_0xb3e3bb[_0x4f0a30(0x12d)])['to'](_0x4f0a30(0x12a)+_0x42df6a+_0x4f0a30(0x107))['to'](_0x4f0a30(0x126)+_0xb3e3bb[_0x4f0a30(0x10e)]+'-'+_0xb3e3bb[_0x4f0a30(0x12d)])['to'](_0x4f0a30(0x126)+_0xb3e3bb[_0x4f0a30(0x10e)]+_0x4f0a30(0x107))[_0x4f0a30(0x10a)]('company-'+_0xb3e3bb[_0x4f0a30(0x12b)]+_0x4f0a30(0x115),{'action':_0x4f0a30(0x116),'ticket':_0xb3e3bb,'ticketId':_0xb3e3bb['id']});const _0x524186=await Message_1['default'][_0x4f0a30(0x101)]({'where':{'id':_0x26d9fb,'companyId':_0x42df6a},'include':[{'model':Ticket_1[_0x4f0a30(0x110)],'as':_0x4f0a30(0x11a),'include':[_0x4f0a30(0x100)]},{'model':Message_1[_0x4f0a30(0x110)],'as':_0x4f0a30(0x120),'include':[_0x4f0a30(0x100)],'where':{'companyId':_0x42df6a},'required':![]},{'model':OldMessage_1[_0x4f0a30(0x110)],'as':'oldMessages','where':{'ticketId':_0x18569a[_0x4f0a30(0x118)]},'required':![]}]});return{'ticketId':_0x524186[_0x4f0a30(0x118)],'message':_0x524186};}catch(_0x567633){console[_0x4f0a30(0xff)](_0x567633);throw new AppError_1[(_0x4f0a30(0x110))](_0x4f0a30(0x103));}};exports['default']=EditWhatsAppMessage;