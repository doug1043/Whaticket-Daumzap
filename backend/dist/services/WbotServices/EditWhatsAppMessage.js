const a575_0x3117ab=a575_0x539e;(function(_0xc77d20,_0x3ba10f){const _0x1a0088=a575_0x539e,_0x276750=_0xc77d20();while(!![]){try{const _0x4ef634=-parseInt(_0x1a0088(0x177))/0x1*(parseInt(_0x1a0088(0x176))/0x2)+-parseInt(_0x1a0088(0x155))/0x3+-parseInt(_0x1a0088(0x165))/0x4*(parseInt(_0x1a0088(0x170))/0x5)+parseInt(_0x1a0088(0x17c))/0x6+-parseInt(_0x1a0088(0x15a))/0x7*(-parseInt(_0x1a0088(0x158))/0x8)+-parseInt(_0x1a0088(0x157))/0x9+parseInt(_0x1a0088(0x15d))/0xa*(parseInt(_0x1a0088(0x17d))/0xb);if(_0x4ef634===_0x3ba10f)break;else _0x276750['push'](_0x276750['shift']());}catch(_0x1eda14){_0x276750['push'](_0x276750['shift']());}}}(a575_0xa471,0x472fc));function a575_0xa471(){const _0x28a115=['quotedMsg','queue','-ticket','5bOoYYR','companyId','company-','dataJson','parse','remoteJid','139218ATBJcf','5ppmHbX','contact','ticketId','defineProperty','constructor','2001270qCRTlm','77ZIcSjC','__importDefault','update','findOne','upsert','../../helpers/Mustache','default','1102872EfIYDp','body','2973429cBmawV','280696NFGedG','key','49jpHfTC','status','search','1455010NYlUug','user','../../models/OldMessage','(((.+)+)+)+$','toString','ERR_EDITING_WAPP_MSG','queueId','emit','1040124ERrXvS','-notification','ticket','../../errors/AppError','__esModule','findByPk','queue-','../../models/Ticket'];a575_0xa471=function(){return _0x28a115;};return a575_0xa471();}const a575_0x4407d4=(function(){let _0x46fe30=!![];return function(_0x5ba3bf,_0xb79252){const _0x4c96de=_0x46fe30?function(){if(_0xb79252){const _0x3e9587=_0xb79252['apply'](_0x5ba3bf,arguments);return _0xb79252=null,_0x3e9587;}}:function(){};return _0x46fe30=![],_0x4c96de;};}()),a575_0x6b7bec=a575_0x4407d4(this,function(){const _0x273c31=a575_0x539e;return a575_0x6b7bec[_0x273c31(0x161)]()[_0x273c31(0x15c)](_0x273c31(0x160))['toString']()[_0x273c31(0x17b)](a575_0x6b7bec)['search'](_0x273c31(0x160));});a575_0x6b7bec();function a575_0x539e(_0x3245e1,_0x2c4426){const _0x5c5455=a575_0xa471();return a575_0x539e=function(_0x6b7bec,_0x4407d4){_0x6b7bec=_0x6b7bec-0x14f;let _0xa471e0=_0x5c5455[_0x6b7bec];return _0xa471e0;},a575_0x539e(_0x3245e1,_0x2c4426);}'use strict';var __importDefault=this&&this[a575_0x3117ab(0x14f)]||function(_0x11cc15){const _0x5028d7=a575_0x3117ab;return _0x11cc15&&_0x11cc15[_0x5028d7(0x169)]?_0x11cc15:{'default':_0x11cc15};};Object[a575_0x3117ab(0x17a)](exports,a575_0x3117ab(0x169),{'value':!![]});const AppError_1=__importDefault(require(a575_0x3117ab(0x168))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),Message_1=__importDefault(require('../../models/Message')),OldMessage_1=__importDefault(require(a575_0x3117ab(0x15f))),Ticket_1=__importDefault(require(a575_0x3117ab(0x16c))),Mustache_1=__importDefault(require(a575_0x3117ab(0x153))),User_1=__importDefault(require('../../models/User')),socket_1=require('../../libs/socket'),EditWhatsAppMessage=async({messageId:_0x52f6fa,companyId:_0xb0f135,userId:_0x3f4a20,body:_0x484571})=>{const _0x1b3d7d=a575_0x3117ab,_0x5b7644=await Message_1[_0x1b3d7d(0x154)]['findOne']({'where':{'id':_0x52f6fa,'companyId':_0xb0f135},'include':[{'model':Ticket_1[_0x1b3d7d(0x154)],'as':_0x1b3d7d(0x167),'include':[_0x1b3d7d(0x178),_0x1b3d7d(0x16e),_0x1b3d7d(0x15e)]}]}),_0x207dd9=_0x3f4a20&&await User_1[_0x1b3d7d(0x154)][_0x1b3d7d(0x16a)](_0x3f4a20);if(!_0x5b7644)throw new AppError_1[(_0x1b3d7d(0x154))]('No\x20message\x20found\x20with\x20this\x20ID.');const {ticket:_0x30415d}=_0x5b7644,_0x265dd4=await(0x0,GetTicketWbot_1[_0x1b3d7d(0x154)])(_0x30415d),_0x420082=JSON[_0x1b3d7d(0x174)](_0x5b7644[_0x1b3d7d(0x173)]),_0x324b32=(0x0,Mustache_1[_0x1b3d7d(0x154)])(_0x484571,_0x30415d,_0x207dd9);try{await _0x265dd4['sendMessage'](_0x5b7644[_0x1b3d7d(0x175)],{'text':_0x324b32,'edit':_0x420082[_0x1b3d7d(0x159)]},{});const _0x416e90={'messageId':_0x52f6fa,'body':_0x5b7644[_0x1b3d7d(0x156)],'ticketId':_0x5b7644['ticketId']};await OldMessage_1[_0x1b3d7d(0x154)][_0x1b3d7d(0x152)](_0x416e90),await _0x5b7644[_0x1b3d7d(0x150)]({'body':_0x324b32,'isEdited':!![]}),await _0x30415d[_0x1b3d7d(0x150)]({'lastMessage':_0x324b32});const _0x40074e=(0x0,socket_1['getIO'])();_0x40074e['to'](_0x30415d['id'][_0x1b3d7d(0x161)]())['to'](_0x1b3d7d(0x172)+_0xb0f135+'-'+_0x30415d[_0x1b3d7d(0x15b)])['to'](_0x1b3d7d(0x172)+_0xb0f135+_0x1b3d7d(0x166))['to'](_0x1b3d7d(0x16b)+_0x30415d[_0x1b3d7d(0x163)]+'-'+_0x30415d[_0x1b3d7d(0x15b)])['to'](_0x1b3d7d(0x16b)+_0x30415d[_0x1b3d7d(0x163)]+_0x1b3d7d(0x166))[_0x1b3d7d(0x164)](_0x1b3d7d(0x172)+_0x30415d[_0x1b3d7d(0x171)]+_0x1b3d7d(0x16f),{'action':'update','ticket':_0x30415d,'ticketId':_0x30415d['id']});const _0x164a9e=await Message_1[_0x1b3d7d(0x154)][_0x1b3d7d(0x151)]({'where':{'id':_0x52f6fa,'companyId':_0xb0f135},'include':[{'model':Ticket_1[_0x1b3d7d(0x154)],'as':_0x1b3d7d(0x167),'include':[_0x1b3d7d(0x178)]},{'model':Message_1['default'],'as':_0x1b3d7d(0x16d),'include':['contact'],'where':{'companyId':_0xb0f135},'required':![]},{'model':OldMessage_1['default'],'as':'oldMessages','where':{'ticketId':_0x5b7644[_0x1b3d7d(0x179)]},'required':![]}]});return{'ticketId':_0x164a9e[_0x1b3d7d(0x179)],'message':_0x164a9e};}catch(_0x199b2c){console['log'](_0x199b2c);throw new AppError_1[(_0x1b3d7d(0x154))](_0x1b3d7d(0x162));}};exports['default']=EditWhatsAppMessage;