const a685_0x28d62f=a685_0x5802;(function(_0x5a2e74,_0x1d9cbb){const _0x5be072=a685_0x5802,_0x1c6c9f=_0x5a2e74();while(!![]){try{const _0x1ab2a8=parseInt(_0x5be072(0x157))/0x1*(parseInt(_0x5be072(0x17a))/0x2)+parseInt(_0x5be072(0x159))/0x3*(-parseInt(_0x5be072(0x173))/0x4)+parseInt(_0x5be072(0x180))/0x5*(parseInt(_0x5be072(0x179))/0x6)+-parseInt(_0x5be072(0x16c))/0x7*(parseInt(_0x5be072(0x160))/0x8)+-parseInt(_0x5be072(0x15a))/0x9+-parseInt(_0x5be072(0x158))/0xa*(parseInt(_0x5be072(0x176))/0xb)+parseInt(_0x5be072(0x154))/0xc;if(_0x1ab2a8===_0x1d9cbb)break;else _0x1c6c9f['push'](_0x1c6c9f['shift']());}catch(_0x1dc2a4){_0x1c6c9f['push'](_0x1c6c9f['shift']());}}}(a685_0x3f54,0x94c68));const a685_0x228b0a=(function(){let _0xd52b64=!![];return function(_0x776ef1,_0x408bef){const _0x5d4721=_0xd52b64?function(){const _0x32c8e9=a685_0x5802;if(_0x408bef){const _0x552c46=_0x408bef[_0x32c8e9(0x165)](_0x776ef1,arguments);return _0x408bef=null,_0x552c46;}}:function(){};return _0xd52b64=![],_0x5d4721;};}()),a685_0x160b25=a685_0x228b0a(this,function(){const _0x45d51f=a685_0x5802;return a685_0x160b25[_0x45d51f(0x175)]()[_0x45d51f(0x181)](_0x45d51f(0x166))['toString']()['constructor'](a685_0x160b25)[_0x45d51f(0x181)](_0x45d51f(0x166));});a685_0x160b25();'use strict';var __importDefault=this&&this[a685_0x28d62f(0x161)]||function(_0x3e7521){const _0x54c16a=a685_0x28d62f;return _0x3e7521&&_0x3e7521[_0x54c16a(0x15d)]?_0x3e7521:{'default':_0x3e7521};};Object[a685_0x28d62f(0x171)](exports,'__esModule',{'value':!![]});const AppError_1=__importDefault(require(a685_0x28d62f(0x16f))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),Message_1=__importDefault(require('../../models/Message')),OldMessage_1=__importDefault(require(a685_0x28d62f(0x15e))),Ticket_1=__importDefault(require(a685_0x28d62f(0x16e))),Mustache_1=__importDefault(require(a685_0x28d62f(0x16a))),User_1=__importDefault(require('../../models/User')),socket_1=require(a685_0x28d62f(0x170)),EditWhatsAppMessage=async({messageId:_0x385c6c,companyId:_0x3a0fe3,userId:_0x364b6a,body:_0x42cbe3})=>{const _0x14399d=a685_0x28d62f,_0x430acd=await Message_1[_0x14399d(0x172)]['findOne']({'where':{'id':_0x385c6c,'companyId':_0x3a0fe3},'include':[{'model':Ticket_1['default'],'as':_0x14399d(0x162),'include':['contact','queue','user']}]}),_0x448ec3=_0x364b6a&&await User_1[_0x14399d(0x172)][_0x14399d(0x152)](_0x364b6a);if(!_0x430acd)throw new AppError_1['default']('No\x20message\x20found\x20with\x20this\x20ID.');const {ticket:_0x1e5512}=_0x430acd,_0x268c66=await(0x0,GetTicketWbot_1[_0x14399d(0x172)])(_0x1e5512),_0x24beda=JSON[_0x14399d(0x169)](_0x430acd[_0x14399d(0x163)]),_0x14ace8=(0x0,Mustache_1['default'])(_0x42cbe3,_0x1e5512,_0x448ec3);try{await _0x268c66[_0x14399d(0x155)](_0x430acd[_0x14399d(0x151)],{'text':_0x14ace8,'edit':_0x24beda[_0x14399d(0x16d)]},{});const _0x535e70={'messageId':_0x385c6c,'body':_0x430acd['body'],'ticketId':_0x430acd[_0x14399d(0x167)]};await OldMessage_1['default'][_0x14399d(0x153)](_0x535e70),await _0x430acd[_0x14399d(0x17b)]({'body':_0x14ace8,'isEdited':!![]}),await _0x1e5512[_0x14399d(0x17b)]({'lastMessage':_0x14ace8});const _0xc6f9bd=(0x0,socket_1['getIO'])();_0xc6f9bd['to'](_0x1e5512['id'][_0x14399d(0x175)]())['to']('company-'+_0x3a0fe3+'-'+_0x1e5512['status'])['to'](_0x14399d(0x16b)+_0x3a0fe3+'-notification')['to'](_0x14399d(0x164)+_0x1e5512[_0x14399d(0x15f)]+'-'+_0x1e5512[_0x14399d(0x168)])['to'](_0x14399d(0x164)+_0x1e5512['queueId']+_0x14399d(0x17c))[_0x14399d(0x156)](_0x14399d(0x16b)+_0x1e5512[_0x14399d(0x177)]+_0x14399d(0x178),{'action':_0x14399d(0x17b),'ticket':_0x1e5512,'ticketId':_0x1e5512['id']});const _0x1cc0e5=await Message_1[_0x14399d(0x172)][_0x14399d(0x15c)]({'where':{'id':_0x385c6c,'companyId':_0x3a0fe3},'include':[{'model':Ticket_1[_0x14399d(0x172)],'as':_0x14399d(0x162),'include':[_0x14399d(0x17f)]},{'model':Message_1['default'],'as':_0x14399d(0x17e),'include':[_0x14399d(0x17f)],'where':{'companyId':_0x3a0fe3},'required':![]},{'model':OldMessage_1[_0x14399d(0x172)],'as':_0x14399d(0x174),'where':{'ticketId':_0x430acd['ticketId']},'required':![]}]});return{'ticketId':_0x1cc0e5[_0x14399d(0x167)],'message':_0x1cc0e5};}catch(_0x5e566d){console[_0x14399d(0x17d)](_0x5e566d);throw new AppError_1[(_0x14399d(0x172))](_0x14399d(0x15b));}};exports[a685_0x28d62f(0x172)]=EditWhatsAppMessage;function a685_0x5802(_0x5bd9a1,_0x66204){const _0x43e81f=a685_0x3f54();return a685_0x5802=function(_0x160b25,_0x228b0a){_0x160b25=_0x160b25-0x151;let _0x3f54b8=_0x43e81f[_0x160b25];return _0x3f54b8;},a685_0x5802(_0x5bd9a1,_0x66204);}function a685_0x3f54(){const _0x3102ef=['queue-','apply','(((.+)+)+)+$','ticketId','status','parse','../../helpers/Mustache','company-','2282lbISqa','key','../../models/Ticket','../../errors/AppError','../../libs/socket','defineProperty','default','20mAXhwb','oldMessages','toString','165913ofmBOG','companyId','-ticket','6Uybhqw','1048974EZIVKA','update','-notification','log','quotedMsg','contact','3398345BXMABg','search','remoteJid','findByPk','upsert','13288224YVsECq','sendMessage','emit','2skGbAt','550fNnJDu','235023ACBKSH','6697935rVuPwk','ERR_EDITING_WAPP_MSG','findOne','__esModule','../../models/OldMessage','queueId','6408knStVb','__importDefault','ticket','dataJson'];a685_0x3f54=function(){return _0x3102ef;};return a685_0x3f54();}