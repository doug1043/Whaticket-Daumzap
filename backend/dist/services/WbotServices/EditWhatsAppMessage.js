const a570_0x2e3b07=a570_0x4812;function a570_0x4812(_0x152fa3,_0x49c0a7){const _0xc6f58f=a570_0x33f9();return a570_0x4812=function(_0x592030,_0x1fd3ee){_0x592030=_0x592030-0x88;let _0x33f98f=_0xc6f58f[_0x592030];return _0x33f98f;},a570_0x4812(_0x152fa3,_0x49c0a7);}(function(_0xdc20e3,_0x4b211b){const _0x4b92d8=a570_0x4812,_0x54324b=_0xdc20e3();while(!![]){try{const _0x92a310=-parseInt(_0x4b92d8(0xab))/0x1+parseInt(_0x4b92d8(0xa5))/0x2*(parseInt(_0x4b92d8(0x8a))/0x3)+parseInt(_0x4b92d8(0x90))/0x4*(-parseInt(_0x4b92d8(0x8c))/0x5)+-parseInt(_0x4b92d8(0xb1))/0x6*(parseInt(_0x4b92d8(0x9a))/0x7)+parseInt(_0x4b92d8(0x89))/0x8*(parseInt(_0x4b92d8(0x8f))/0x9)+-parseInt(_0x4b92d8(0x94))/0xa*(-parseInt(_0x4b92d8(0xaa))/0xb)+parseInt(_0x4b92d8(0x99))/0xc;if(_0x92a310===_0x4b211b)break;else _0x54324b['push'](_0x54324b['shift']());}catch(_0x1c8dfc){_0x54324b['push'](_0x54324b['shift']());}}}(a570_0x33f9,0x3123b));const a570_0x1fd3ee=(function(){let _0x89e58f=!![];return function(_0x37aff7,_0xae8361){const _0xe4e80e=_0x89e58f?function(){const _0x4ef933=a570_0x4812;if(_0xae8361){const _0x30cc25=_0xae8361[_0x4ef933(0xae)](_0x37aff7,arguments);return _0xae8361=null,_0x30cc25;}}:function(){};return _0x89e58f=![],_0xe4e80e;};}()),a570_0x592030=a570_0x1fd3ee(this,function(){const _0x5b22fd=a570_0x4812;return a570_0x592030['toString']()[_0x5b22fd(0x8d)](_0x5b22fd(0xa0))[_0x5b22fd(0xac)]()['constructor'](a570_0x592030)[_0x5b22fd(0x8d)](_0x5b22fd(0xa0));});a570_0x592030();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x49a6b5){const _0x1b2913=a570_0x4812;return _0x49a6b5&&_0x49a6b5[_0x1b2913(0xa2)]?_0x49a6b5:{'default':_0x49a6b5};};Object[a570_0x2e3b07(0xa4)](exports,a570_0x2e3b07(0xa2),{'value':!![]});function a570_0x33f9(){const _0x11f100=['33438hvUGDU','update','status','upsert','company-','1716XBwBeE','325359wkUKqE','toString','queueId','apply','queue','ERR_EDITING_WAPP_MSG','6AmsFMR','default','../../models/Ticket','findByPk','../../errors/AppError','oldMessages','sendMessage','log','8HMNcXP','6vpGjln','quotedMsg','585ZQAzBS','search','getIO','2388609rNtlTI','5176wWTRxv','../../models/OldMessage','ticketId','companyId','21490ybghiT','contact','ticket','queue-','dataJson','4901916FCykao','2551808mlTjNg','findOne','../../helpers/GetTicketWbot','user','parse','key','(((.+)+)+)+$','-notification','__esModule','emit','defineProperty'];a570_0x33f9=function(){return _0x11f100;};return a570_0x33f9();}const AppError_1=__importDefault(require(a570_0x2e3b07(0xb5))),GetTicketWbot_1=__importDefault(require(a570_0x2e3b07(0x9c))),Message_1=__importDefault(require('../../models/Message')),OldMessage_1=__importDefault(require(a570_0x2e3b07(0x91))),Ticket_1=__importDefault(require(a570_0x2e3b07(0xb3))),Mustache_1=__importDefault(require('../../helpers/Mustache')),User_1=__importDefault(require('../../models/User')),socket_1=require('../../libs/socket'),EditWhatsAppMessage=async({messageId:_0x27740d,companyId:_0x129117,userId:_0x5ca45c,body:_0x4e3665})=>{const _0x5c2eeb=a570_0x2e3b07,_0x28320c=await Message_1[_0x5c2eeb(0xb2)]['findOne']({'where':{'id':_0x27740d,'companyId':_0x129117},'include':[{'model':Ticket_1['default'],'as':_0x5c2eeb(0x96),'include':[_0x5c2eeb(0x95),_0x5c2eeb(0xaf),_0x5c2eeb(0x9d)]}]}),_0x17021f=_0x5ca45c&&await User_1[_0x5c2eeb(0xb2)][_0x5c2eeb(0xb4)](_0x5ca45c);if(!_0x28320c)throw new AppError_1['default']('No\x20message\x20found\x20with\x20this\x20ID.');const {ticket:_0x47cd84}=_0x28320c,_0x59cbcb=await(0x0,GetTicketWbot_1[_0x5c2eeb(0xb2)])(_0x47cd84),_0x268793=JSON[_0x5c2eeb(0x9e)](_0x28320c[_0x5c2eeb(0x98)]),_0x41ea80=(0x0,Mustache_1[_0x5c2eeb(0xb2)])(_0x4e3665,_0x47cd84,_0x17021f);try{await _0x59cbcb[_0x5c2eeb(0xb7)](_0x28320c['remoteJid'],{'text':_0x41ea80,'edit':_0x268793[_0x5c2eeb(0x9f)]},{});const _0x16d1fb={'messageId':_0x27740d,'body':_0x28320c['body'],'ticketId':_0x28320c['ticketId']};await OldMessage_1[_0x5c2eeb(0xb2)][_0x5c2eeb(0xa8)](_0x16d1fb),await _0x28320c['update']({'body':_0x41ea80,'isEdited':!![]}),await _0x47cd84[_0x5c2eeb(0xa6)]({'lastMessage':_0x41ea80});const _0x2d18d7=(0x0,socket_1[_0x5c2eeb(0x8e)])();_0x2d18d7['to'](_0x47cd84['id'][_0x5c2eeb(0xac)]())['to'](_0x5c2eeb(0xa9)+_0x129117+'-'+_0x47cd84['status'])['to'](_0x5c2eeb(0xa9)+_0x129117+_0x5c2eeb(0xa1))['to'](_0x5c2eeb(0x97)+_0x47cd84[_0x5c2eeb(0xad)]+'-'+_0x47cd84[_0x5c2eeb(0xa7)])['to'](_0x5c2eeb(0x97)+_0x47cd84[_0x5c2eeb(0xad)]+_0x5c2eeb(0xa1))[_0x5c2eeb(0xa3)]('company-'+_0x47cd84[_0x5c2eeb(0x93)]+'-ticket',{'action':_0x5c2eeb(0xa6),'ticket':_0x47cd84,'ticketId':_0x47cd84['id']});const _0xa642ca=await Message_1[_0x5c2eeb(0xb2)][_0x5c2eeb(0x9b)]({'where':{'id':_0x27740d,'companyId':_0x129117},'include':[{'model':Ticket_1['default'],'as':_0x5c2eeb(0x96),'include':[_0x5c2eeb(0x95)]},{'model':Message_1[_0x5c2eeb(0xb2)],'as':_0x5c2eeb(0x8b),'include':[_0x5c2eeb(0x95)],'where':{'companyId':_0x129117},'required':![]},{'model':OldMessage_1['default'],'as':_0x5c2eeb(0xb6),'where':{'ticketId':_0x28320c[_0x5c2eeb(0x92)]},'required':![]}]});return{'ticketId':_0xa642ca[_0x5c2eeb(0x92)],'message':_0xa642ca};}catch(_0x7d1a28){console[_0x5c2eeb(0x88)](_0x7d1a28);throw new AppError_1[(_0x5c2eeb(0xb2))](_0x5c2eeb(0xb0));}};exports[a570_0x2e3b07(0xb2)]=EditWhatsAppMessage;