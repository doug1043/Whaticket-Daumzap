const a683_0x390006=a683_0x41f7;(function(_0x458910,_0x24aefe){const _0x1d340b=a683_0x41f7,_0x24d765=_0x458910();while(!![]){try{const _0x14cef7=-parseInt(_0x1d340b(0xbb))/0x1+parseInt(_0x1d340b(0xb6))/0x2*(parseInt(_0x1d340b(0xb4))/0x3)+parseInt(_0x1d340b(0xb1))/0x4+parseInt(_0x1d340b(0xcd))/0x5*(-parseInt(_0x1d340b(0xc1))/0x6)+parseInt(_0x1d340b(0xb8))/0x7+parseInt(_0x1d340b(0xc3))/0x8*(-parseInt(_0x1d340b(0xb9))/0x9)+parseInt(_0x1d340b(0xcb))/0xa;if(_0x14cef7===_0x24aefe)break;else _0x24d765['push'](_0x24d765['shift']());}catch(_0x40db1c){_0x24d765['push'](_0x24d765['shift']());}}}(a683_0x2c7a,0xef84c));const a683_0x5e5b94=(function(){let _0x11073b=!![];return function(_0x58d03f,_0x3924db){const _0x4ab4d8=_0x11073b?function(){const _0x306366=a683_0x41f7;if(_0x3924db){const _0xc86ac1=_0x3924db[_0x306366(0xd0)](_0x58d03f,arguments);return _0x3924db=null,_0xc86ac1;}}:function(){};return _0x11073b=![],_0x4ab4d8;};}()),a683_0x2a3bb6=a683_0x5e5b94(this,function(){const _0x42c32e=a683_0x41f7;return a683_0x2a3bb6[_0x42c32e(0xd8)]()[_0x42c32e(0xc5)](_0x42c32e(0xbf))[_0x42c32e(0xd8)]()['constructor'](a683_0x2a3bb6)['search'](_0x42c32e(0xbf));});a683_0x2a3bb6();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5db141){return _0x5db141&&_0x5db141['__esModule']?_0x5db141:{'default':_0x5db141};};function a683_0x41f7(_0x37ae81,_0x2f3929){const _0x441a83=a683_0x2c7a();return a683_0x41f7=function(_0x2a3bb6,_0x5e5b94){_0x2a3bb6=_0x2a3bb6-0xae;let _0x2c7a4e=_0x441a83[_0x2a3bb6];return _0x2c7a4e;},a683_0x41f7(_0x37ae81,_0x2f3929);}Object[a683_0x390006(0xb0)](exports,a683_0x390006(0xaf),{'value':!![]});function a683_0x2c7a(){const _0x43dd0e=['-notification','../../models/OldMessage','../../models/Ticket','contact','findOne','ticketId','toString','queue','__esModule','defineProperty','4816140oSXtWE','update','sendMessage','6KEdayG','getIO','51656yGLaCt','../../models/User','8449105TqPfAG','45tDCbxv','../../helpers/Mustache','617721lEHKYK','../../models/Message','company-','ticket','(((.+)+)+)+$','../../errors/AppError','6TZTVxW','upsert','2218896rWIQrS','default','search','../../helpers/GetTicketWbot','oldMessages','findByPk','ERR_EDITING_WAPP_MSG','status','8058160MtWiTc','queueId','1414615iUQJON','queue-','-ticket','apply','quotedMsg'];a683_0x2c7a=function(){return _0x43dd0e;};return a683_0x2c7a();}const AppError_1=__importDefault(require(a683_0x390006(0xc0))),GetTicketWbot_1=__importDefault(require(a683_0x390006(0xc6))),Message_1=__importDefault(require(a683_0x390006(0xbc))),OldMessage_1=__importDefault(require(a683_0x390006(0xd3))),Ticket_1=__importDefault(require(a683_0x390006(0xd4))),Mustache_1=__importDefault(require(a683_0x390006(0xba))),User_1=__importDefault(require(a683_0x390006(0xb7))),socket_1=require('../../libs/socket'),EditWhatsAppMessage=async({messageId:_0x4a73a3,companyId:_0xdbddc8,userId:_0x3af34b,body:_0x5b2307})=>{const _0x4b27e8=a683_0x390006,_0x10594f=await Message_1[_0x4b27e8(0xc4)][_0x4b27e8(0xd6)]({'where':{'id':_0x4a73a3,'companyId':_0xdbddc8},'include':[{'model':Ticket_1[_0x4b27e8(0xc4)],'as':_0x4b27e8(0xbe),'include':['contact',_0x4b27e8(0xae),'user']}]}),_0x46d89a=_0x3af34b&&await User_1[_0x4b27e8(0xc4)][_0x4b27e8(0xc8)](_0x3af34b);if(!_0x10594f)throw new AppError_1[(_0x4b27e8(0xc4))]('No\x20message\x20found\x20with\x20this\x20ID.');const {ticket:_0x482a63}=_0x10594f,_0x5ed429=await(0x0,GetTicketWbot_1[_0x4b27e8(0xc4)])(_0x482a63),_0x13a48c=JSON['parse'](_0x10594f['dataJson']),_0x565331=(0x0,Mustache_1[_0x4b27e8(0xc4)])(_0x5b2307,_0x482a63,_0x46d89a);try{await _0x5ed429[_0x4b27e8(0xb3)](_0x10594f['remoteJid'],{'text':_0x565331,'edit':_0x13a48c['key']},{});const _0x1ea409={'messageId':_0x4a73a3,'body':_0x10594f['body'],'ticketId':_0x10594f[_0x4b27e8(0xd7)]};await OldMessage_1[_0x4b27e8(0xc4)][_0x4b27e8(0xc2)](_0x1ea409),await _0x10594f[_0x4b27e8(0xb2)]({'body':_0x565331,'isEdited':!![]}),await _0x482a63['update']({'lastMessage':_0x565331});const _0x4cbe95=(0x0,socket_1[_0x4b27e8(0xb5)])();_0x4cbe95['to'](_0x482a63['id'][_0x4b27e8(0xd8)]())['to'](_0x4b27e8(0xbd)+_0xdbddc8+'-'+_0x482a63[_0x4b27e8(0xca)])['to'](_0x4b27e8(0xbd)+_0xdbddc8+'-notification')['to'](_0x4b27e8(0xce)+_0x482a63[_0x4b27e8(0xcc)]+'-'+_0x482a63['status'])['to'](_0x4b27e8(0xce)+_0x482a63[_0x4b27e8(0xcc)]+_0x4b27e8(0xd2))['emit']('company-'+_0x482a63['companyId']+_0x4b27e8(0xcf),{'action':_0x4b27e8(0xb2),'ticket':_0x482a63,'ticketId':_0x482a63['id']});const _0x403fe7=await Message_1[_0x4b27e8(0xc4)]['findOne']({'where':{'id':_0x4a73a3,'companyId':_0xdbddc8},'include':[{'model':Ticket_1[_0x4b27e8(0xc4)],'as':'ticket','include':[_0x4b27e8(0xd5)]},{'model':Message_1[_0x4b27e8(0xc4)],'as':_0x4b27e8(0xd1),'include':[_0x4b27e8(0xd5)],'where':{'companyId':_0xdbddc8},'required':![]},{'model':OldMessage_1[_0x4b27e8(0xc4)],'as':_0x4b27e8(0xc7),'where':{'ticketId':_0x10594f['ticketId']},'required':![]}]});return{'ticketId':_0x403fe7[_0x4b27e8(0xd7)],'message':_0x403fe7};}catch(_0x44417c){console['log'](_0x44417c);throw new AppError_1['default'](_0x4b27e8(0xc9));}};exports['default']=EditWhatsAppMessage;