const a572_0xd2ef08=a572_0x277c;(function(_0x47a1dc,_0x1ba04){const _0x334502=a572_0x277c,_0x7e0225=_0x47a1dc();while(!![]){try{const _0x302a61=parseInt(_0x334502(0x206))/0x1+-parseInt(_0x334502(0x1e2))/0x2+parseInt(_0x334502(0x1f1))/0x3*(-parseInt(_0x334502(0x209))/0x4)+-parseInt(_0x334502(0x1e6))/0x5*(-parseInt(_0x334502(0x1fd))/0x6)+parseInt(_0x334502(0x1ed))/0x7+-parseInt(_0x334502(0x20f))/0x8*(-parseInt(_0x334502(0x1f6))/0x9)+-parseInt(_0x334502(0x1f8))/0xa;if(_0x302a61===_0x1ba04)break;else _0x7e0225['push'](_0x7e0225['shift']());}catch(_0x36a375){_0x7e0225['push'](_0x7e0225['shift']());}}}(a572_0x39b4,0xd165e));function a572_0x277c(_0x43aef1,_0x571d48){const _0x342952=a572_0x39b4();return a572_0x277c=function(_0x56b749,_0x57e1e2){_0x56b749=_0x56b749-0x1e0;let _0x39b462=_0x342952[_0x56b749];return _0x39b462;},a572_0x277c(_0x43aef1,_0x571d48);}const a572_0x57e1e2=(function(){let _0xf160c3=!![];return function(_0x73002a,_0x41de5b){const _0x32a9ae=_0xf160c3?function(){const _0x4bd7bd=a572_0x277c;if(_0x41de5b){const _0x4ba412=_0x41de5b[_0x4bd7bd(0x204)](_0x73002a,arguments);return _0x41de5b=null,_0x4ba412;}}:function(){};return _0xf160c3=![],_0x32a9ae;};}()),a572_0x56b749=a572_0x57e1e2(this,function(){const _0x28a22c=a572_0x277c;return a572_0x56b749[_0x28a22c(0x1e3)]()['search'](_0x28a22c(0x1f7))[_0x28a22c(0x1e3)]()[_0x28a22c(0x1f5)](a572_0x56b749)[_0x28a22c(0x20e)](_0x28a22c(0x1f7));});function a572_0x39b4(){const _0x4dbef8=['emit','ticketId','search','7672imuWYK','findOne','parse','2864866LGYulb','toString','queue','../../models/OldMessage','5893700vmDiPW','oldMessages','ERR_EDITING_WAPP_MSG','sendMessage','queue-','-ticket','../../models/User','5888869qzQIQt','update','quotedMsg','No\x20message\x20found\x20with\x20this\x20ID.','711999iiGZDN','default','ticket','../../helpers/GetTicketWbot','constructor','14121GrkGeS','(((.+)+)+)+$','13505760rVELXA','company-','log','../../errors/AppError','status','6SRflob','key','upsert','queueId','remoteJid','contact','dataJson','apply','__esModule','828024rJKjEa','user','body','12sRuSPq','defineProperty','findByPk'];a572_0x39b4=function(){return _0x4dbef8;};return a572_0x39b4();}a572_0x56b749();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x511cba){const _0x5e9de6=a572_0x277c;return _0x511cba&&_0x511cba[_0x5e9de6(0x205)]?_0x511cba:{'default':_0x511cba};};Object[a572_0xd2ef08(0x20a)](exports,'__esModule',{'value':!![]});const AppError_1=__importDefault(require(a572_0xd2ef08(0x1fb))),GetTicketWbot_1=__importDefault(require(a572_0xd2ef08(0x1f4))),Message_1=__importDefault(require('../../models/Message')),OldMessage_1=__importDefault(require(a572_0xd2ef08(0x1e5))),Ticket_1=__importDefault(require('../../models/Ticket')),Mustache_1=__importDefault(require('../../helpers/Mustache')),User_1=__importDefault(require(a572_0xd2ef08(0x1ec))),socket_1=require('../../libs/socket'),EditWhatsAppMessage=async({messageId:_0x595f28,companyId:_0x4a0bae,userId:_0x12cbc8,body:_0xdba1de})=>{const _0x25a3e0=a572_0xd2ef08,_0x487386=await Message_1[_0x25a3e0(0x1f2)][_0x25a3e0(0x1e0)]({'where':{'id':_0x595f28,'companyId':_0x4a0bae},'include':[{'model':Ticket_1['default'],'as':'ticket','include':[_0x25a3e0(0x202),_0x25a3e0(0x1e4),_0x25a3e0(0x207)]}]}),_0x5c35d6=_0x12cbc8&&await User_1['default'][_0x25a3e0(0x20b)](_0x12cbc8);if(!_0x487386)throw new AppError_1[(_0x25a3e0(0x1f2))](_0x25a3e0(0x1f0));const {ticket:_0x861b5a}=_0x487386,_0x326660=await(0x0,GetTicketWbot_1[_0x25a3e0(0x1f2)])(_0x861b5a),_0x4ab719=JSON[_0x25a3e0(0x1e1)](_0x487386[_0x25a3e0(0x203)]),_0xc2a982=(0x0,Mustache_1[_0x25a3e0(0x1f2)])(_0xdba1de,_0x861b5a,_0x5c35d6);try{await _0x326660[_0x25a3e0(0x1e9)](_0x487386[_0x25a3e0(0x201)],{'text':_0xc2a982,'edit':_0x4ab719[_0x25a3e0(0x1fe)]},{});const _0x556fe0={'messageId':_0x595f28,'body':_0x487386[_0x25a3e0(0x208)],'ticketId':_0x487386[_0x25a3e0(0x20d)]};await OldMessage_1['default'][_0x25a3e0(0x1ff)](_0x556fe0),await _0x487386[_0x25a3e0(0x1ee)]({'body':_0xc2a982,'isEdited':!![]}),await _0x861b5a['update']({'lastMessage':_0xc2a982});const _0x158c72=(0x0,socket_1['getIO'])();_0x158c72['to'](_0x861b5a['id'][_0x25a3e0(0x1e3)]())['to'](_0x25a3e0(0x1f9)+_0x4a0bae+'-'+_0x861b5a[_0x25a3e0(0x1fc)])['to'](_0x25a3e0(0x1f9)+_0x4a0bae+'-notification')['to'](_0x25a3e0(0x1ea)+_0x861b5a[_0x25a3e0(0x200)]+'-'+_0x861b5a[_0x25a3e0(0x1fc)])['to'](_0x25a3e0(0x1ea)+_0x861b5a[_0x25a3e0(0x200)]+'-notification')[_0x25a3e0(0x20c)]('company-'+_0x861b5a['companyId']+_0x25a3e0(0x1eb),{'action':'update','ticket':_0x861b5a,'ticketId':_0x861b5a['id']});const _0x53bbf8=await Message_1[_0x25a3e0(0x1f2)][_0x25a3e0(0x1e0)]({'where':{'id':_0x595f28,'companyId':_0x4a0bae},'include':[{'model':Ticket_1[_0x25a3e0(0x1f2)],'as':_0x25a3e0(0x1f3),'include':['contact']},{'model':Message_1['default'],'as':_0x25a3e0(0x1ef),'include':[_0x25a3e0(0x202)],'where':{'companyId':_0x4a0bae},'required':![]},{'model':OldMessage_1['default'],'as':_0x25a3e0(0x1e7),'where':{'ticketId':_0x487386[_0x25a3e0(0x20d)]},'required':![]}]});return{'ticketId':_0x53bbf8[_0x25a3e0(0x20d)],'message':_0x53bbf8};}catch(_0x1c1656){console[_0x25a3e0(0x1fa)](_0x1c1656);throw new AppError_1['default'](_0x25a3e0(0x1e8));}};exports[a572_0xd2ef08(0x1f2)]=EditWhatsAppMessage;