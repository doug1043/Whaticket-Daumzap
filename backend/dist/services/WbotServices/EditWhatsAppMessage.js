const a684_0x181814=a684_0x1972;function a684_0x1972(_0x240e63,_0x1a18e4){const _0x515d6a=a684_0x1d07();return a684_0x1972=function(_0x3e0ca3,_0x494d9b){_0x3e0ca3=_0x3e0ca3-0xe8;let _0x1d07bf=_0x515d6a[_0x3e0ca3];return _0x1d07bf;},a684_0x1972(_0x240e63,_0x1a18e4);}(function(_0xafc0b7,_0x5dca40){const _0x1ee163=a684_0x1972,_0x5d684e=_0xafc0b7();while(!![]){try{const _0x43d2f6=parseInt(_0x1ee163(0x10a))/0x1*(-parseInt(_0x1ee163(0xe8))/0x2)+parseInt(_0x1ee163(0x104))/0x3+parseInt(_0x1ee163(0xf1))/0x4*(-parseInt(_0x1ee163(0xf3))/0x5)+-parseInt(_0x1ee163(0xef))/0x6*(parseInt(_0x1ee163(0xff))/0x7)+parseInt(_0x1ee163(0xeb))/0x8*(-parseInt(_0x1ee163(0x105))/0x9)+-parseInt(_0x1ee163(0x10d))/0xa*(-parseInt(_0x1ee163(0xfa))/0xb)+parseInt(_0x1ee163(0xec))/0xc;if(_0x43d2f6===_0x5dca40)break;else _0x5d684e['push'](_0x5d684e['shift']());}catch(_0x2a5051){_0x5d684e['push'](_0x5d684e['shift']());}}}(a684_0x1d07,0x2e7bd));const a684_0x494d9b=(function(){let _0x32ac63=!![];return function(_0x58986f,_0x50be34){const _0x4b1abd=_0x32ac63?function(){if(_0x50be34){const _0x2e85ff=_0x50be34['apply'](_0x58986f,arguments);return _0x50be34=null,_0x2e85ff;}}:function(){};return _0x32ac63=![],_0x4b1abd;};}()),a684_0x3e0ca3=a684_0x494d9b(this,function(){const _0x360db4=a684_0x1972;return a684_0x3e0ca3['toString']()[_0x360db4(0x111)]('(((.+)+)+)+$')[_0x360db4(0x109)]()[_0x360db4(0x10e)](a684_0x3e0ca3)[_0x360db4(0x111)]('(((.+)+)+)+$');});a684_0x3e0ca3();'use strict';var __importDefault=this&&this[a684_0x181814(0x10f)]||function(_0x526822){const _0x187463=a684_0x181814;return _0x526822&&_0x526822[_0x187463(0xfc)]?_0x526822:{'default':_0x526822};};Object[a684_0x181814(0x115)](exports,a684_0x181814(0xfc),{'value':!![]});const AppError_1=__importDefault(require(a684_0x181814(0x101))),GetTicketWbot_1=__importDefault(require(a684_0x181814(0x10b))),Message_1=__importDefault(require('../../models/Message')),OldMessage_1=__importDefault(require(a684_0x181814(0xea))),Ticket_1=__importDefault(require('../../models/Ticket')),Mustache_1=__importDefault(require(a684_0x181814(0x112))),User_1=__importDefault(require('../../models/User')),socket_1=require(a684_0x181814(0xfe)),EditWhatsAppMessage=async({messageId:_0x599ffb,companyId:_0x533cf3,userId:_0x45a0e7,body:_0x195aef})=>{const _0x3937eb=a684_0x181814,_0x548bdf=await Message_1[_0x3937eb(0x100)][_0x3937eb(0xf5)]({'where':{'id':_0x599ffb,'companyId':_0x533cf3},'include':[{'model':Ticket_1['default'],'as':_0x3937eb(0x106),'include':['contact',_0x3937eb(0x10c),_0x3937eb(0xf9)]}]}),_0xfb7047=_0x45a0e7&&await User_1[_0x3937eb(0x100)]['findByPk'](_0x45a0e7);if(!_0x548bdf)throw new AppError_1[(_0x3937eb(0x100))](_0x3937eb(0x108));const {ticket:_0x45d2fa}=_0x548bdf,_0x5a67a7=await(0x0,GetTicketWbot_1[_0x3937eb(0x100)])(_0x45d2fa),_0x32c3d3=JSON[_0x3937eb(0x102)](_0x548bdf['dataJson']),_0x49011e=(0x0,Mustache_1['default'])(_0x195aef,_0x45d2fa,_0xfb7047);try{await _0x5a67a7[_0x3937eb(0xf2)](_0x548bdf[_0x3937eb(0xf4)],{'text':_0x49011e,'edit':_0x32c3d3[_0x3937eb(0xf8)]},{});const _0x1f0152={'messageId':_0x599ffb,'body':_0x548bdf[_0x3937eb(0xfd)],'ticketId':_0x548bdf[_0x3937eb(0xf6)]};await OldMessage_1['default'][_0x3937eb(0xe9)](_0x1f0152),await _0x548bdf[_0x3937eb(0xee)]({'body':_0x49011e,'isEdited':!![]}),await _0x45d2fa[_0x3937eb(0xee)]({'lastMessage':_0x49011e});const _0xe259ac=(0x0,socket_1['getIO'])();_0xe259ac['to'](_0x45d2fa['id'][_0x3937eb(0x109)]())['to'](_0x3937eb(0x103)+_0x533cf3+'-'+_0x45d2fa['status'])['to'](_0x3937eb(0x103)+_0x533cf3+_0x3937eb(0x110))['to']('queue-'+_0x45d2fa[_0x3937eb(0xf7)]+'-'+_0x45d2fa['status'])['to'](_0x3937eb(0xed)+_0x45d2fa[_0x3937eb(0xf7)]+'-notification')['emit'](_0x3937eb(0x103)+_0x45d2fa[_0x3937eb(0x107)]+'-ticket',{'action':_0x3937eb(0xee),'ticket':_0x45d2fa,'ticketId':_0x45d2fa['id']});const _0x12b86b=await Message_1[_0x3937eb(0x100)]['findOne']({'where':{'id':_0x599ffb,'companyId':_0x533cf3},'include':[{'model':Ticket_1[_0x3937eb(0x100)],'as':_0x3937eb(0x106),'include':['contact']},{'model':Message_1[_0x3937eb(0x100)],'as':'quotedMsg','include':[_0x3937eb(0x113)],'where':{'companyId':_0x533cf3},'required':![]},{'model':OldMessage_1[_0x3937eb(0x100)],'as':_0x3937eb(0xf0),'where':{'ticketId':_0x548bdf[_0x3937eb(0xf6)]},'required':![]}]});return{'ticketId':_0x12b86b[_0x3937eb(0xf6)],'message':_0x12b86b};}catch(_0x13a4b0){console[_0x3937eb(0xfb)](_0x13a4b0);throw new AppError_1[(_0x3937eb(0x100))](_0x3937eb(0x114));}};exports[a684_0x181814(0x100)]=EditWhatsAppMessage;function a684_0x1d07(){const _0x149e26=['remoteJid','findOne','ticketId','queueId','key','user','97999olZDMr','log','__esModule','body','../../libs/socket','2681JNNJNl','default','../../errors/AppError','parse','company-','1049862Noaiac','9wnoPnk','ticket','companyId','No\x20message\x20found\x20with\x20this\x20ID.','toString','173840diMzDM','../../helpers/GetTicketWbot','queue','70JqtSAC','constructor','__importDefault','-notification','search','../../helpers/Mustache','contact','ERR_EDITING_WAPP_MSG','defineProperty','4dOTayl','upsert','../../models/OldMessage','97544vhUJCw','7803912bkpZXk','queue-','update','2874bcMbzV','oldMessages','112jEacTn','sendMessage','58735zaQnad'];a684_0x1d07=function(){return _0x149e26;};return a684_0x1d07();}