const a575_0xb17bae=a575_0x5e91;(function(_0x12e299,_0x357132){const _0x1ae11d=a575_0x5e91,_0x42f076=_0x12e299();while(!![]){try{const _0x5869b2=parseInt(_0x1ae11d(0x18a))/0x1+-parseInt(_0x1ae11d(0x183))/0x2+parseInt(_0x1ae11d(0x192))/0x3+-parseInt(_0x1ae11d(0x175))/0x4+-parseInt(_0x1ae11d(0x18b))/0x5+-parseInt(_0x1ae11d(0x198))/0x6+-parseInt(_0x1ae11d(0x176))/0x7*(-parseInt(_0x1ae11d(0x188))/0x8);if(_0x5869b2===_0x357132)break;else _0x42f076['push'](_0x42f076['shift']());}catch(_0x5a38cd){_0x42f076['push'](_0x42f076['shift']());}}}(a575_0x3b41,0x573c8));function a575_0x5e91(_0x30915a,_0x4cf9e3){const _0x55bb45=a575_0x3b41();return a575_0x5e91=function(_0x1ad0c4,_0x5cd494){_0x1ad0c4=_0x1ad0c4-0x170;let _0x3b413d=_0x55bb45[_0x1ad0c4];return _0x3b413d;},a575_0x5e91(_0x30915a,_0x4cf9e3);}const a575_0x5cd494=(function(){let _0xe8c7d=!![];return function(_0x2e849a,_0x235c5b){const _0xd50960=_0xe8c7d?function(){const _0x199f2c=a575_0x5e91;if(_0x235c5b){const _0x331c4f=_0x235c5b[_0x199f2c(0x191)](_0x2e849a,arguments);return _0x235c5b=null,_0x331c4f;}}:function(){};return _0xe8c7d=![],_0xd50960;};}()),a575_0x1ad0c4=a575_0x5cd494(this,function(){const _0x2b1126=a575_0x5e91;return a575_0x1ad0c4[_0x2b1126(0x196)]()[_0x2b1126(0x174)]('(((.+)+)+)+$')[_0x2b1126(0x196)]()['constructor'](a575_0x1ad0c4)['search'](_0x2b1126(0x181));});a575_0x1ad0c4();'use strict';function a575_0x3b41(){const _0x3bdc6b=['queue-','company-','sendMessage','findByPk','../../errors/AppError','search','565048jIjrIh','119QIByeZ','companyId','default','-notification','../../models/Message','ticket','ERR_EDITING_WAPP_MSG','ticketId','../../helpers/Mustache','queueId','user','(((.+)+)+)+$','key','1378138LXYudD','update','../../models/Ticket','No\x20message\x20found\x20with\x20this\x20ID.','dataJson','745632eTZSuX','getIO','113706hznNVO','2423160RLfJka','parse','__esModule','findOne','emit','__importDefault','apply','26829QEApdO','../../libs/socket','log','contact','toString','quotedMsg','209004PVDgIu','status','defineProperty','../../helpers/GetTicketWbot'];a575_0x3b41=function(){return _0x3bdc6b;};return a575_0x3b41();}var __importDefault=this&&this[a575_0xb17bae(0x190)]||function(_0x45ccb4){const _0x40e38c=a575_0xb17bae;return _0x45ccb4&&_0x45ccb4[_0x40e38c(0x18d)]?_0x45ccb4:{'default':_0x45ccb4};};Object[a575_0xb17bae(0x19a)](exports,'__esModule',{'value':!![]});const AppError_1=__importDefault(require(a575_0xb17bae(0x173))),GetTicketWbot_1=__importDefault(require(a575_0xb17bae(0x19b))),Message_1=__importDefault(require(a575_0xb17bae(0x17a))),OldMessage_1=__importDefault(require('../../models/OldMessage')),Ticket_1=__importDefault(require(a575_0xb17bae(0x185))),Mustache_1=__importDefault(require(a575_0xb17bae(0x17e))),User_1=__importDefault(require('../../models/User')),socket_1=require(a575_0xb17bae(0x193)),EditWhatsAppMessage=async({messageId:_0x39265b,companyId:_0x3d1af2,userId:_0x21c5c2,body:_0x56e255})=>{const _0x2e4bf9=a575_0xb17bae,_0x334892=await Message_1[_0x2e4bf9(0x178)][_0x2e4bf9(0x18e)]({'where':{'id':_0x39265b,'companyId':_0x3d1af2},'include':[{'model':Ticket_1[_0x2e4bf9(0x178)],'as':_0x2e4bf9(0x17b),'include':[_0x2e4bf9(0x195),'queue',_0x2e4bf9(0x180)]}]}),_0x4a8b73=_0x21c5c2&&await User_1[_0x2e4bf9(0x178)][_0x2e4bf9(0x172)](_0x21c5c2);if(!_0x334892)throw new AppError_1['default'](_0x2e4bf9(0x186));const {ticket:_0x1eccfa}=_0x334892,_0x5c4ae8=await(0x0,GetTicketWbot_1[_0x2e4bf9(0x178)])(_0x1eccfa),_0x1c8ac1=JSON[_0x2e4bf9(0x18c)](_0x334892[_0x2e4bf9(0x187)]),_0x5251e4=(0x0,Mustache_1[_0x2e4bf9(0x178)])(_0x56e255,_0x1eccfa,_0x4a8b73);try{await _0x5c4ae8[_0x2e4bf9(0x171)](_0x334892['remoteJid'],{'text':_0x5251e4,'edit':_0x1c8ac1[_0x2e4bf9(0x182)]},{});const _0x2d7eef={'messageId':_0x39265b,'body':_0x334892['body'],'ticketId':_0x334892[_0x2e4bf9(0x17d)]};await OldMessage_1[_0x2e4bf9(0x178)]['upsert'](_0x2d7eef),await _0x334892[_0x2e4bf9(0x184)]({'body':_0x5251e4,'isEdited':!![]}),await _0x1eccfa[_0x2e4bf9(0x184)]({'lastMessage':_0x5251e4});const _0x290951=(0x0,socket_1[_0x2e4bf9(0x189)])();_0x290951['to'](_0x1eccfa['id'][_0x2e4bf9(0x196)]())['to'](_0x2e4bf9(0x170)+_0x3d1af2+'-'+_0x1eccfa[_0x2e4bf9(0x199)])['to'](_0x2e4bf9(0x170)+_0x3d1af2+_0x2e4bf9(0x179))['to'](_0x2e4bf9(0x19c)+_0x1eccfa['queueId']+'-'+_0x1eccfa[_0x2e4bf9(0x199)])['to'](_0x2e4bf9(0x19c)+_0x1eccfa[_0x2e4bf9(0x17f)]+'-notification')[_0x2e4bf9(0x18f)](_0x2e4bf9(0x170)+_0x1eccfa[_0x2e4bf9(0x177)]+'-ticket',{'action':_0x2e4bf9(0x184),'ticket':_0x1eccfa,'ticketId':_0x1eccfa['id']});const _0x1bbd2b=await Message_1[_0x2e4bf9(0x178)][_0x2e4bf9(0x18e)]({'where':{'id':_0x39265b,'companyId':_0x3d1af2},'include':[{'model':Ticket_1['default'],'as':_0x2e4bf9(0x17b),'include':[_0x2e4bf9(0x195)]},{'model':Message_1[_0x2e4bf9(0x178)],'as':_0x2e4bf9(0x197),'include':[_0x2e4bf9(0x195)],'where':{'companyId':_0x3d1af2},'required':![]},{'model':OldMessage_1[_0x2e4bf9(0x178)],'as':'oldMessages','where':{'ticketId':_0x334892['ticketId']},'required':![]}]});return{'ticketId':_0x1bbd2b[_0x2e4bf9(0x17d)],'message':_0x1bbd2b};}catch(_0x2daf06){console[_0x2e4bf9(0x194)](_0x2daf06);throw new AppError_1[(_0x2e4bf9(0x178))](_0x2e4bf9(0x17c));}};exports['default']=EditWhatsAppMessage;