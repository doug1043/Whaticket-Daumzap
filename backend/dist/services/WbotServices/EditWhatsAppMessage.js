const a571_0x5ae155=a571_0x9df7;function a571_0x9df7(_0x41b745,_0x4cd26c){const _0x22cf50=a571_0x54e9();return a571_0x9df7=function(_0x33ae26,_0xe3f661){_0x33ae26=_0x33ae26-0x18f;let _0x54e983=_0x22cf50[_0x33ae26];return _0x54e983;},a571_0x9df7(_0x41b745,_0x4cd26c);}(function(_0x4843e9,_0x3c479f){const _0x37e740=a571_0x9df7,_0x355b5a=_0x4843e9();while(!![]){try{const _0x3fe85f=-parseInt(_0x37e740(0x1c2))/0x1*(-parseInt(_0x37e740(0x1ac))/0x2)+parseInt(_0x37e740(0x1ba))/0x3*(-parseInt(_0x37e740(0x19a))/0x4)+parseInt(_0x37e740(0x1a5))/0x5*(-parseInt(_0x37e740(0x1b7))/0x6)+-parseInt(_0x37e740(0x1b2))/0x7+parseInt(_0x37e740(0x199))/0x8*(-parseInt(_0x37e740(0x1a3))/0x9)+parseInt(_0x37e740(0x1bd))/0xa+parseInt(_0x37e740(0x1a7))/0xb;if(_0x3fe85f===_0x3c479f)break;else _0x355b5a['push'](_0x355b5a['shift']());}catch(_0x2c0e14){_0x355b5a['push'](_0x355b5a['shift']());}}}(a571_0x54e9,0x2d060));const a571_0xe3f661=(function(){let _0x5b6f1d=!![];return function(_0x5a5ed3,_0x27aa43){const _0x3f5928=_0x5b6f1d?function(){const _0x4332ce=a571_0x9df7;if(_0x27aa43){const _0x392756=_0x27aa43[_0x4332ce(0x1b4)](_0x5a5ed3,arguments);return _0x27aa43=null,_0x392756;}}:function(){};return _0x5b6f1d=![],_0x3f5928;};}()),a571_0x33ae26=a571_0xe3f661(this,function(){const _0x4f3ad7=a571_0x9df7;return a571_0x33ae26[_0x4f3ad7(0x198)]()['search']('(((.+)+)+)+$')[_0x4f3ad7(0x198)]()['constructor'](a571_0x33ae26)[_0x4f3ad7(0x190)](_0x4f3ad7(0x1a6));});a571_0x33ae26();'use strict';var __importDefault=this&&this[a571_0x5ae155(0x1a9)]||function(_0x17e237){const _0x1aa49b=a571_0x5ae155;return _0x17e237&&_0x17e237[_0x1aa49b(0x1a2)]?_0x17e237:{'default':_0x17e237};};Object[a571_0x5ae155(0x1b6)](exports,a571_0x5ae155(0x1a2),{'value':!![]});function a571_0x54e9(){const _0x3b3e7c=['../../models/Ticket','body','136jtFvYx','-ticket','../../errors/AppError','../../models/Message','ERR_EDITING_WAPP_MSG','findByPk','1081437RWjzHy','../../models/OldMessage','apply','queue-','defineProperty','548292YclhzO','-notification','companyId','11217zpOHxQ','ticket','contact','2513540ILtKLk','../../models/User','queueId','sendMessage','emit','2035FhlRsF','dataJson','key','search','ticketId','../../helpers/Mustache','company-','status','quotedMsg','remoteJid','default','toString','345544MMinjT','276YCUJnT','oldMessages','No\x20message\x20found\x20with\x20this\x20ID.','queue','parse','getIO','../../helpers/GetTicketWbot','log','__esModule','36ACccVq','update','20gKcOye','(((.+)+)+)+$','8200104OLkhtk','findOne','__importDefault'];a571_0x54e9=function(){return _0x3b3e7c;};return a571_0x54e9();}const AppError_1=__importDefault(require(a571_0x5ae155(0x1ae))),GetTicketWbot_1=__importDefault(require(a571_0x5ae155(0x1a0))),Message_1=__importDefault(require(a571_0x5ae155(0x1af))),OldMessage_1=__importDefault(require(a571_0x5ae155(0x1b3))),Ticket_1=__importDefault(require(a571_0x5ae155(0x1aa))),Mustache_1=__importDefault(require(a571_0x5ae155(0x192))),User_1=__importDefault(require(a571_0x5ae155(0x1be))),socket_1=require('../../libs/socket'),EditWhatsAppMessage=async({messageId:_0xf48d7d,companyId:_0x465097,userId:_0x1e1e66,body:_0x5711d9})=>{const _0x1a42dc=a571_0x5ae155,_0x3183db=await Message_1[_0x1a42dc(0x197)][_0x1a42dc(0x1a8)]({'where':{'id':_0xf48d7d,'companyId':_0x465097},'include':[{'model':Ticket_1[_0x1a42dc(0x197)],'as':_0x1a42dc(0x1bb),'include':[_0x1a42dc(0x1bc),_0x1a42dc(0x19d),'user']}]}),_0x478945=_0x1e1e66&&await User_1[_0x1a42dc(0x197)][_0x1a42dc(0x1b1)](_0x1e1e66);if(!_0x3183db)throw new AppError_1[(_0x1a42dc(0x197))](_0x1a42dc(0x19c));const {ticket:_0x334b04}=_0x3183db,_0x69aaaa=await(0x0,GetTicketWbot_1[_0x1a42dc(0x197)])(_0x334b04),_0x599df0=JSON[_0x1a42dc(0x19e)](_0x3183db[_0x1a42dc(0x1c3)]),_0x489a39=(0x0,Mustache_1[_0x1a42dc(0x197)])(_0x5711d9,_0x334b04,_0x478945);try{await _0x69aaaa[_0x1a42dc(0x1c0)](_0x3183db[_0x1a42dc(0x196)],{'text':_0x489a39,'edit':_0x599df0[_0x1a42dc(0x18f)]},{});const _0x59c922={'messageId':_0xf48d7d,'body':_0x3183db[_0x1a42dc(0x1ab)],'ticketId':_0x3183db[_0x1a42dc(0x191)]};await OldMessage_1['default']['upsert'](_0x59c922),await _0x3183db[_0x1a42dc(0x1a4)]({'body':_0x489a39,'isEdited':!![]}),await _0x334b04[_0x1a42dc(0x1a4)]({'lastMessage':_0x489a39});const _0x1d486b=(0x0,socket_1[_0x1a42dc(0x19f)])();_0x1d486b['to'](_0x334b04['id'][_0x1a42dc(0x198)]())['to'](_0x1a42dc(0x193)+_0x465097+'-'+_0x334b04['status'])['to'](_0x1a42dc(0x193)+_0x465097+_0x1a42dc(0x1b8))['to'](_0x1a42dc(0x1b5)+_0x334b04[_0x1a42dc(0x1bf)]+'-'+_0x334b04[_0x1a42dc(0x194)])['to'](_0x1a42dc(0x1b5)+_0x334b04['queueId']+_0x1a42dc(0x1b8))[_0x1a42dc(0x1c1)]('company-'+_0x334b04[_0x1a42dc(0x1b9)]+_0x1a42dc(0x1ad),{'action':_0x1a42dc(0x1a4),'ticket':_0x334b04,'ticketId':_0x334b04['id']});const _0x4d24ca=await Message_1[_0x1a42dc(0x197)][_0x1a42dc(0x1a8)]({'where':{'id':_0xf48d7d,'companyId':_0x465097},'include':[{'model':Ticket_1[_0x1a42dc(0x197)],'as':'ticket','include':[_0x1a42dc(0x1bc)]},{'model':Message_1[_0x1a42dc(0x197)],'as':_0x1a42dc(0x195),'include':[_0x1a42dc(0x1bc)],'where':{'companyId':_0x465097},'required':![]},{'model':OldMessage_1[_0x1a42dc(0x197)],'as':_0x1a42dc(0x19b),'where':{'ticketId':_0x3183db[_0x1a42dc(0x191)]},'required':![]}]});return{'ticketId':_0x4d24ca[_0x1a42dc(0x191)],'message':_0x4d24ca};}catch(_0x4eb1fc){console[_0x1a42dc(0x1a1)](_0x4eb1fc);throw new AppError_1['default'](_0x1a42dc(0x1b0));}};exports[a571_0x5ae155(0x197)]=EditWhatsAppMessage;