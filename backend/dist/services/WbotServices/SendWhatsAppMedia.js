const a548_0x10b0e9=a548_0xfc8d;function a548_0x4b7b(){const _0x1a7ad0=['resolve','g.us','participant','@sentry/node','remoteJid','ffmpeg-static','__importStar','includes','application/x-7z-compressed','105356mGWVxD','stringify','__setModuleDefault','./public','readFileSync','__esModule','setFfmpegPath','application/msword','183912clSbTp','mimetype','9482424ovMwSA','lookup','Invalid\x20mimetype','application/x-rar-compressed','getMessageOptions','36mlQBth','(((.+)+)+)+$','video/mp4','exec','video','call','configurable','default','../../errors/AppError','startsWith','13hvDrmQ','__createBinding','2141877mvcnlf','mime-types','body\x20is\x20not\x20a\x20string','create','filename','document','audio/mp4','fluent-ffmpeg','s.whatsapp.net','body','get','companyId','hasOwnProperty','key','application/pdf','audio','getBodyMessage','unlinkSync','contact','sendMessage','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','.mp3','/public','length','__importDefault','text/plain','image/png','number','originalname','application/vnd.ms-powerpoint','ERR_SENDING_WAPP_MSG','apply','writable','isGroup','text','update','audio-record-site','video/3gpp2','child_process','1503490qyFPyG','constructor','fromMe','video/3gpp','\x20-i\x20','path','getTime','public','../../helpers/GetTicketWbot','application','68fIwGZx','audio/ogg','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','\x20-y','split','application/vnd.openxmlformats-officedocument.presentationml.presentation','324505LEHOSQ','text/csv','captureException','getOwnPropertyDescriptor','defineProperty','57444COpoJY','toString','trace','image/jpeg','search','text/html'];a548_0x4b7b=function(){return _0x1a7ad0;};return a548_0x4b7b();}function a548_0xfc8d(_0xdb81e,_0x4704ef){const _0x508a94=a548_0x4b7b();return a548_0xfc8d=function(_0xa3f7c3,_0xfd4c3e){_0xa3f7c3=_0xa3f7c3-0x6a;let _0x4b7b64=_0x508a94[_0xa3f7c3];return _0x4b7b64;},a548_0xfc8d(_0xdb81e,_0x4704ef);}(function(_0x56679d,_0x1780f4){const _0x70266d=a548_0xfc8d,_0x5cc328=_0x56679d();while(!![]){try{const _0x304e96=parseInt(_0x70266d(0xc1))/0x1*(-parseInt(_0x70266d(0xa8))/0x2)+-parseInt(_0x70266d(0xc3))/0x3+parseInt(_0x70266d(0x8e))/0x4*(parseInt(_0x70266d(0x94))/0x5)+-parseInt(_0x70266d(0x99))/0x6+parseInt(_0x70266d(0xb2))/0x7+-parseInt(_0x70266d(0xb0))/0x8*(parseInt(_0x70266d(0xb7))/0x9)+-parseInt(_0x70266d(0x84))/0xa;if(_0x304e96===_0x1780f4)break;else _0x5cc328['push'](_0x5cc328['shift']());}catch(_0xfc6e7d){_0x5cc328['push'](_0x5cc328['shift']());}}}(a548_0x4b7b,0xc5181));const a548_0xfd4c3e=(function(){let _0x4dbf00=!![];return function(_0x3e2274,_0x538f0b){const _0x5788f9=_0x4dbf00?function(){const _0x5d153e=a548_0xfc8d;if(_0x538f0b){const _0x4c5260=_0x538f0b[_0x5d153e(0x7c)](_0x3e2274,arguments);return _0x538f0b=null,_0x4c5260;}}:function(){};return _0x4dbf00=![],_0x5788f9;};}()),a548_0xa3f7c3=a548_0xfd4c3e(this,function(){const _0x298246=a548_0xfc8d;return a548_0xa3f7c3[_0x298246(0x9a)]()[_0x298246(0x9d)](_0x298246(0xb8))[_0x298246(0x9a)]()[_0x298246(0x85)](a548_0xa3f7c3)[_0x298246(0x9d)](_0x298246(0xb8));});a548_0xa3f7c3();'use strict';var __createBinding=this&&this[a548_0x10b0e9(0xc2)]||(Object[a548_0x10b0e9(0xc6)]?function(_0x21a7ba,_0x5c694f,_0x5e31a6,_0x535ee4){const _0xb6ec87=a548_0x10b0e9;if(_0x535ee4===undefined)_0x535ee4=_0x5e31a6;var _0x575bc=Object[_0xb6ec87(0x97)](_0x5c694f,_0x5e31a6);(!_0x575bc||(_0xb6ec87(0xcd)in _0x575bc?!_0x5c694f['__esModule']:_0x575bc[_0xb6ec87(0x7d)]||_0x575bc[_0xb6ec87(0xbd)]))&&(_0x575bc={'enumerable':!![],'get':function(){return _0x5c694f[_0x5e31a6];}}),Object['defineProperty'](_0x21a7ba,_0x535ee4,_0x575bc);}:function(_0x4aea3b,_0x4fbaf8,_0x3f2214,_0x1a426f){if(_0x1a426f===undefined)_0x1a426f=_0x3f2214;_0x4aea3b[_0x1a426f]=_0x4fbaf8[_0x3f2214];}),__setModuleDefault=this&&this[a548_0x10b0e9(0xaa)]||(Object[a548_0x10b0e9(0xc6)]?function(_0x31036f,_0x32874c){const _0x48a476=a548_0x10b0e9;Object[_0x48a476(0x98)](_0x31036f,'default',{'enumerable':!![],'value':_0x32874c});}:function(_0x20e915,_0x46645f){_0x20e915['default']=_0x46645f;}),__importStar=this&&this[a548_0x10b0e9(0xa5)]||function(_0x2e8568){const _0x2d0dd9=a548_0x10b0e9;if(_0x2e8568&&_0x2e8568[_0x2d0dd9(0xad)])return _0x2e8568;var _0x5489ea={};if(_0x2e8568!=null){for(var _0x1c8549 in _0x2e8568)if(_0x1c8549!=='default'&&Object['prototype'][_0x2d0dd9(0xcf)][_0x2d0dd9(0xbc)](_0x2e8568,_0x1c8549))__createBinding(_0x5489ea,_0x2e8568,_0x1c8549);}return __setModuleDefault(_0x5489ea,_0x2e8568),_0x5489ea;},__importDefault=this&&this[a548_0x10b0e9(0x75)]||function(_0x1df1a1){const _0x50ffe1=a548_0x10b0e9;return _0x1df1a1&&_0x1df1a1[_0x50ffe1(0xad)]?_0x1df1a1:{'default':_0x1df1a1};};Object[a548_0x10b0e9(0x98)](exports,a548_0x10b0e9(0xad),{'value':!![]}),exports['SendWhatsAppMediaFileAddress']=exports[a548_0x10b0e9(0xb6)]=void 0x0;const Sentry=__importStar(require(a548_0x10b0e9(0xa2))),fs_1=__importDefault(require('fs')),child_process_1=require(a548_0x10b0e9(0x83)),path_1=__importDefault(require('path')),fluent_ffmpeg_1=__importDefault(require(a548_0x10b0e9(0xca))),AppError_1=__importDefault(require(a548_0x10b0e9(0xbf))),GetTicketWbot_1=__importDefault(require(a548_0x10b0e9(0x8c))),mime_types_1=__importDefault(require(a548_0x10b0e9(0xc4))),Mustache_1=__importDefault(require('../../helpers/Mustache')),ffmpeg_static_1=__importDefault(require(a548_0x10b0e9(0xa4))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),wbotMessageListener_1=require('./wbotMessageListener');fluent_ffmpeg_1[a548_0x10b0e9(0xbe)][a548_0x10b0e9(0xae)](ffmpeg_static_1[a548_0x10b0e9(0xbe)]);const publicFolder=path_1['default'][a548_0x10b0e9(0x9f)](__dirname,'..','..','..',a548_0x10b0e9(0x8b)),processAudio=async(_0x535331,_0x5d2d83)=>{const _0x24623f=a548_0x10b0e9,_0xf3a800=publicFolder+'/company'+_0x5d2d83+'/'+new Date()[_0x24623f(0x8a)]()+_0x24623f(0x72);return new Promise((_0x438368,_0xe1e70a)=>{const _0x3ce9d6=_0x24623f;(0x0,child_process_1[_0x3ce9d6(0xba)])(ffmpeg_static_1[_0x3ce9d6(0xbe)]+_0x3ce9d6(0x88)+_0x535331+_0x3ce9d6(0x71)+_0xf3a800+_0x3ce9d6(0x91),(_0x24f220,_0x4d2b65,_0xdf4212)=>{const _0x1b4821=_0x3ce9d6;if(_0x24f220)_0xe1e70a(_0x24f220);fs_1[_0x1b4821(0xbe)][_0x1b4821(0x6e)](_0x535331),_0x438368(_0xf3a800);});});},processAudioFile=async _0x522d6e=>{const _0x48674d=a548_0x10b0e9,_0x2be28b=publicFolder+'/'+new Date()[_0x48674d(0x8a)]()+_0x48674d(0x72);return new Promise((_0x4a57cf,_0x2ce4e4)=>{const _0x301b1e=_0x48674d;(0x0,child_process_1[_0x301b1e(0xba)])(ffmpeg_static_1[_0x301b1e(0xbe)]+_0x301b1e(0x88)+_0x522d6e+_0x301b1e(0x90)+_0x2be28b,(_0x5e3d5a,_0x4fa7bd,_0x29e70f)=>{const _0x4908f4=_0x301b1e;if(_0x5e3d5a)_0x2ce4e4(_0x5e3d5a);fs_1['default'][_0x4908f4(0x6e)](_0x522d6e),_0x4a57cf(_0x2be28b);});});},getMessageOptions=async(_0x2c38fd,_0x4798f8,_0x268a30,_0x2a8c30)=>{const _0x292321=a548_0x10b0e9,_0x4e66f2=mime_types_1[_0x292321(0xbe)][_0x292321(0xb3)](_0x4798f8),_0x24987a=_0x4e66f2[_0x292321(0x92)]('/')[0x0];try{if(!_0x4e66f2)throw new Error(_0x292321(0xb4));let _0x439822;if(_0x24987a==='video')_0x439822={'video':fs_1[_0x292321(0xbe)][_0x292321(0xac)](_0x4798f8),'caption':_0x268a30?_0x268a30:'','fileName':_0x2c38fd};else{if(_0x24987a===_0x292321(0x6c)){const _0x261fd0=!![],_0x375854=await processAudio(_0x4798f8,_0x2a8c30);_0x261fd0?_0x439822={'audio':fs_1[_0x292321(0xbe)][_0x292321(0xac)](_0x375854),'mimetype':_0x261fd0?_0x292321(0xc9):_0x4e66f2,'caption':_0x268a30?_0x268a30:null,'ptt':!![]}:_0x439822={'audio':fs_1['default'][_0x292321(0xac)](_0x375854),'mimetype':_0x261fd0?_0x292321(0xc9):_0x4e66f2,'caption':_0x268a30?_0x268a30:null,'ptt':!![]};}else{if(_0x24987a===_0x292321(0xc8))_0x439822={'document':fs_1[_0x292321(0xbe)]['readFileSync'](_0x4798f8),'caption':_0x268a30?_0x268a30:null,'fileName':_0x2c38fd,'mimetype':_0x4e66f2};else _0x24987a===_0x292321(0x8d)?_0x439822={'document':fs_1[_0x292321(0xbe)][_0x292321(0xac)](_0x4798f8),'caption':_0x268a30?_0x268a30:null,'fileName':_0x2c38fd,'mimetype':_0x4e66f2}:_0x439822={'image':fs_1[_0x292321(0xbe)][_0x292321(0xac)](_0x4798f8),'caption':_0x268a30?_0x268a30:null};}}return _0x439822;}catch(_0x58379d){return Sentry[_0x292321(0x96)](_0x58379d),console['log'](_0x58379d),null;}};exports[a548_0x10b0e9(0xb6)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x44cc6d,ticket:_0x557f72,body:_0x540bc1})=>{const _0x17a3d5=a548_0x10b0e9;try{const _0x223d8d=await(0x0,GetTicketWbot_1['default'])(_0x557f72),_0x183cea=_0x44cc6d['path'],_0x3b3c8b=_0x44cc6d[_0x17a3d5(0xb1)][_0x17a3d5(0x92)]('/')[0x0];let _0x523c5e;const _0x1ff4fc=(0x0,Mustache_1[_0x17a3d5(0xbe)])(_0x540bc1,_0x557f72);var _0xb94181=_0x44cc6d[_0x17a3d5(0xc7)];if(_0x3b3c8b===_0x17a3d5(0xbb))_0x523c5e={'video':fs_1[_0x17a3d5(0xbe)]['readFileSync'](_0x183cea),'caption':_0x1ff4fc,'fileName':_0x44cc6d[_0x17a3d5(0x79)]};else{if(_0x3b3c8b===_0x17a3d5(0x6c)){const _0x402fc6=_0x44cc6d[_0x17a3d5(0x79)][_0x17a3d5(0xa6)]('audio-record-site');if(_0x402fc6){const _0x5a47f3=await processAudio(_0x44cc6d[_0x17a3d5(0x89)],_0x557f72[_0x17a3d5(0xce)]);_0x523c5e={'audio':fs_1[_0x17a3d5(0xbe)][_0x17a3d5(0xac)](_0x5a47f3),'mimetype':_0x402fc6?'audio/mp4':_0x44cc6d[_0x17a3d5(0xb1)],'ptt':!![]},_0xb94181=_0x5a47f3[_0x17a3d5(0x92)]('/')[_0x5a47f3['split']('/')[_0x17a3d5(0x74)]-0x1];}else{const _0x250ea2=await processAudioFile(_0x44cc6d[_0x17a3d5(0x89)]);_0x523c5e={'audio':fs_1[_0x17a3d5(0xbe)]['readFileSync'](_0x250ea2),'mimetype':_0x402fc6?'audio/mp4':_0x44cc6d[_0x17a3d5(0xb1)]},_0xb94181=_0x250ea2[_0x17a3d5(0x92)]('/')[_0x250ea2['split']('/')['length']-0x1];}}else{if(_0x3b3c8b===_0x17a3d5(0xc8)||_0x3b3c8b===_0x17a3d5(0x7f))_0x523c5e={'document':fs_1[_0x17a3d5(0xbe)][_0x17a3d5(0xac)](_0x183cea),'caption':_0x1ff4fc,'fileName':_0x44cc6d['originalname'],'mimetype':_0x44cc6d['mimetype']};else _0x3b3c8b===_0x17a3d5(0x8d)?_0x523c5e={'document':fs_1['default']['readFileSync'](_0x183cea),'caption':_0x1ff4fc,'fileName':_0x44cc6d[_0x17a3d5(0x79)],'mimetype':_0x44cc6d['mimetype']}:_0x523c5e={'image':fs_1[_0x17a3d5(0xbe)]['readFileSync'](_0x183cea),'caption':_0x1ff4fc};}}var _0x24d612=await _0x223d8d[_0x17a3d5(0x70)](_0x557f72[_0x17a3d5(0x6f)]['number']+'@'+(_0x557f72[_0x17a3d5(0x7e)]?_0x17a3d5(0xa0):_0x17a3d5(0xcb)),{..._0x523c5e});const _0x41e0d7=await(0x0,wbotMessageListener_1['verifyQuotedMessage'])(_0x24d612),_0x50d43e={'id':_0x24d612[_0x17a3d5(0x6a)]['id'],'ticketId':_0x557f72['id'],'contactId':undefined,'body':_0x540bc1?(0x0,Mustache_1[_0x17a3d5(0xbe)])(_0x540bc1,_0x557f72):(0x0,wbotMessageListener_1[_0x17a3d5(0x6d)])(_0x24d612),'fromMe':_0x24d612['key']['fromMe'],'read':_0x24d612[_0x17a3d5(0x6a)][_0x17a3d5(0x86)],'mediaUrl':_0xb94181,'mediaType':_0x3b3c8b,'quotedMsgId':_0x41e0d7?.['id'],'ack':0x0,'remoteJid':_0x24d612[_0x17a3d5(0x6a)][_0x17a3d5(0xa3)],'participant':_0x24d612['key'][_0x17a3d5(0xa1)],'dataJson':JSON[_0x17a3d5(0xa9)](_0x24d612)};return typeof _0x50d43e[_0x17a3d5(0xcc)]!='string'&&console['trace'](_0x17a3d5(0xc5),_0x50d43e[_0x17a3d5(0xcc)]),await _0x557f72[_0x17a3d5(0x80)]({'lastMessage':_0x50d43e[_0x17a3d5(0xcc)]}),await(0x0,CreateMessageService_1[_0x17a3d5(0xbe)])({'messageData':_0x50d43e,'ticket':_0x557f72,'companyId':_0x557f72[_0x17a3d5(0xce)]}),_0x24d612;}catch(_0x604d3e){Sentry[_0x17a3d5(0x96)](_0x604d3e),console[_0x17a3d5(0x9b)](_0x604d3e);throw new AppError_1['default'](_0x17a3d5(0x7b));}};exports[a548_0x10b0e9(0xbe)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x4bbd85,_0x363f96,_0x2bc1d5)=>{const _0x543969=a548_0x10b0e9;try{const _0x2aee8b=await(0x0,GetTicketWbot_1[_0x543969(0xbe)])(_0x363f96);_0x4bbd85[_0x543969(0xc0)]('http')&&(_0x4bbd85=_0x543969(0xab)+_0x4bbd85[_0x543969(0x92)](_0x543969(0x73))[0x1]);const _0x26480a=_0x4bbd85,_0x5f2853=getMimeType(_0x4bbd85)[_0x543969(0x92)]('/')[0x0];let _0x392a28;if(_0x5f2853==='video')_0x392a28={'video':fs_1[_0x543969(0xbe)][_0x543969(0xac)](_0x26480a),'caption':_0x2bc1d5,'fileName':extractFileName(_0x4bbd85)};else{if(_0x5f2853==='audio'){const _0x1a7ef2=_0x4bbd85['includes'](_0x543969(0x81));if(_0x1a7ef2){const _0x1920fa=await processAudio(_0x4bbd85,_0x363f96['companyId']);_0x392a28={'audio':fs_1[_0x543969(0xbe)][_0x543969(0xac)](_0x1920fa),'mimetype':_0x1a7ef2?_0x543969(0xc9):getMimeType(_0x4bbd85),'ptt':!![]};}else{const _0x2a737e=await processAudioFile(_0x4bbd85);_0x392a28={'audio':fs_1[_0x543969(0xbe)][_0x543969(0xac)](_0x2a737e),'mimetype':_0x1a7ef2?'audio/mp4':getMimeType(_0x4bbd85)};}}else{if(_0x5f2853===_0x543969(0xc8)||_0x5f2853==='text')_0x392a28={'document':fs_1[_0x543969(0xbe)][_0x543969(0xac)](_0x26480a),'caption':_0x2bc1d5,'fileName':extractFileName(_0x4bbd85),'mimetype':getMimeType(_0x4bbd85)};else _0x5f2853===_0x543969(0x8d)?_0x392a28={'document':fs_1[_0x543969(0xbe)]['readFileSync'](_0x26480a),'caption':_0x2bc1d5,'fileName':extractFileName(_0x4bbd85),'mimetype':getMimeType(_0x4bbd85)}:_0x392a28={'image':fs_1[_0x543969(0xbe)][_0x543969(0xac)](_0x26480a),'caption':_0x2bc1d5};}}const _0x21d0de=await _0x2aee8b['sendMessage'](_0x363f96[_0x543969(0x6f)][_0x543969(0x78)]+'@'+(_0x363f96[_0x543969(0x7e)]?_0x543969(0xa0):_0x543969(0xcb)),{..._0x392a28});return _0x21d0de;}catch(_0x3f0f09){Sentry[_0x543969(0x96)](_0x3f0f09),console['log'](_0x3f0f09);throw new AppError_1[(_0x543969(0xbe))](_0x543969(0x7b));}};exports['SendWhatsAppMediaFileAddress']=SendWhatsAppMediaFileAddress;const extractFileName=_0x35baac=>{const _0x229a3c=_0x35baac['split']('/');return _0x229a3c[_0x229a3c['length']-0x1];},extractFilePath=_0x38438a=>{const _0x5ebc55=a548_0x10b0e9,_0x2936f3=_0x38438a[_0x5ebc55(0x92)]('/');return _0x2936f3['pop'](),_0x2936f3['join']('/');},getMimeType=_0x14ff23=>{const _0x25736c=a548_0x10b0e9,_0x3e3ee=_0x14ff23['split']('.'),_0x466fc2=_0x3e3ee[_0x3e3ee[_0x25736c(0x74)]-0x1],_0xad9e56={'jpg':'image/jpeg','jpeg':_0x25736c(0x9c),'png':_0x25736c(0x77),'gif':'image/gif','mp4':_0x25736c(0xb9),'mp3':'audio/mp3','m4a':_0x25736c(0xc9),'ogg':_0x25736c(0x8f),'pdf':_0x25736c(0x6b),'doc':_0x25736c(0xaf),'docx':'application/vnd.openxmlformats-officedocument.wordprocessingml.document','xls':'application/vnd.ms-excel','xlsx':'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','ppt':_0x25736c(0x7a),'pptx':_0x25736c(0x93),'txt':_0x25736c(0x76),'rtf':'application/rtf','csv':_0x25736c(0x95),'html':_0x25736c(0x9e),'zip':'application/zip','rar':_0x25736c(0xb5),'7z':_0x25736c(0xa7),'3gp':_0x25736c(0x87),'3g2':'video/3gpp2','3ga':_0x25736c(0x87),'7gp':'video/3gpp2','7ga':'video/3gpp','3gpp':_0x25736c(0x87),'3gpp2':_0x25736c(0x82),'7gpp':_0x25736c(0x87),'7gpp2':'video/3gpp2','3gpp-tt':_0x25736c(0x87),'3gpp2-tt':_0x25736c(0x82),'7gpp-tt':_0x25736c(0x87),'7gpp2-tt':_0x25736c(0x82),'3gpp-rtt':_0x25736c(0x87),'3gpp2-rtt':_0x25736c(0x82),'7gpp-rtt':'video/3gpp','7gpp2-rtt':_0x25736c(0x82),'3gpp-sms':_0x25736c(0x87),'3gpp2-sms':_0x25736c(0x82),'7gpp-sms':_0x25736c(0x87),'7gpp2-sms':_0x25736c(0x82),'pdfa':_0x25736c(0x6b),'x-pdf':'application/pdf'};if(_0xad9e56[_0x466fc2])return _0xad9e56[_0x466fc2];return'application/octet-stream';};