'use strict';const a690_0x56adb1=a690_0x23fa;function a690_0xf1c4(){const _0x562d04=['audio/ogg;\x20codecs=opus','number','./VerifyHandlers','audio/','4341AsNUcY','path','verifyMediaMessage','ERR_SENDING_WAPP_MSG:\x20Failed\x20to\x20get\x20message\x20options','video/','axios','ERR_SENDING_WAPP_MSG','remoteJid','3195328RfUvLS','utf8','lid','child_process','arraybuffer','@ffmpeg-installer/ffmpeg','__esModule','getOwnPropertyDescriptor','738037SohXHP','log','hasOwnProperty','GET','decode','../../models/User','captureException','1533324DMnNYG','writeFileSync','configurable','3002040yptVXI','includes','audio-record-site','search','SendWhatsAppMedia\x20-\x20Local\x20file:','create','../../errors/AppError','dist','mimetype','string','8352070TwYsyO','length','message','originalname','getOwnPropertyNames','existsSync','4022392RTcbwe','defineProperty','lookup','from','join','1214BpOnHG','content-type','image/webp','.ogg','7IIKyJZ','__createBinding','contact','createReadStream','../../helpers/GetTicketWbot','toString','\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20','public','constructor','sendMessage','isGroup','@lid','(((.+)+)+)+$','default','resolve','error','parse','http://','getMessageOptions','binary','apply','iconv-lite','dataJson','@g.us','@s.whatsapp.net','__importStar','image/jpeg','startsWith','call','findByPk','9SMNinY'];a690_0xf1c4=function(){return _0x562d04;};return a690_0xf1c4();}(function(_0x3d0a04,_0x5afd81){const _0x2ef7f3=a690_0x23fa,_0x4e51b8=_0x3d0a04();while(!![]){try{const _0x3cf192=parseInt(_0x2ef7f3(0x15e))/0x1+-parseInt(_0x2ef7f3(0x127))/0x2*(-parseInt(_0x2ef7f3(0x14e))/0x3)+parseInt(_0x2ef7f3(0x122))/0x4+-parseInt(_0x2ef7f3(0x168))/0x5+parseInt(_0x2ef7f3(0x165))/0x6*(-parseInt(_0x2ef7f3(0x12b))/0x7)+-parseInt(_0x2ef7f3(0x156))/0x8+-parseInt(_0x2ef7f3(0x149))/0x9*(parseInt(_0x2ef7f3(0x11c))/0xa);if(_0x3cf192===_0x5afd81)break;else _0x4e51b8['push'](_0x4e51b8['shift']());}catch(_0x2d53b1){_0x4e51b8['push'](_0x4e51b8['shift']());}}}(a690_0xf1c4,0x81bb3));function a690_0x23fa(_0x1ee805,_0x144d2f){const _0x45ceb6=a690_0xf1c4();return a690_0x23fa=function(_0x357de5,_0x506dbb){_0x357de5=_0x357de5-0x11a;let _0xf1c41=_0x45ceb6[_0x357de5];return _0xf1c41;},a690_0x23fa(_0x1ee805,_0x144d2f);}var __createBinding=this&&this[a690_0x56adb1(0x12c)]||(Object[a690_0x56adb1(0x16d)]?function(_0x14814f,_0x483fff,_0xf48d87,_0x582f0c){const _0x34035c=a690_0x56adb1;if(_0x582f0c===undefined)_0x582f0c=_0xf48d87;var _0x35d07f=Object[_0x34035c(0x15d)](_0x483fff,_0xf48d87);(!_0x35d07f||('get'in _0x35d07f?!_0x483fff[_0x34035c(0x15c)]:_0x35d07f['writable']||_0x35d07f[_0x34035c(0x167)]))&&(_0x35d07f={'enumerable':!![],'get':function(){return _0x483fff[_0xf48d87];}}),Object[_0x34035c(0x123)](_0x14814f,_0x582f0c,_0x35d07f);}:function(_0x5cbbd7,_0x5cdae6,_0x377309,_0xca5d9f){if(_0xca5d9f===undefined)_0xca5d9f=_0x377309;_0x5cbbd7[_0xca5d9f]=_0x5cdae6[_0x377309];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a690_0x56adb1(0x16d)]?function(_0x379733,_0x3e96e6){const _0x78ef46=a690_0x56adb1;Object[_0x78ef46(0x123)](_0x379733,_0x78ef46(0x138),{'enumerable':!![],'value':_0x3e96e6});}:function(_0xe1f825,_0x5af524){const _0x3f8ef0=a690_0x56adb1;_0xe1f825[_0x3f8ef0(0x138)]=_0x5af524;}),__importStar=this&&this[a690_0x56adb1(0x144)]||(function(){const _0x4247d8=(function(){let _0x28e697=!![];return function(_0x331728,_0x4ec844){const _0x16e680=_0x28e697?function(){const _0x141911=a690_0x23fa;if(_0x4ec844){const _0x6f80b3=_0x4ec844[_0x141911(0x13f)](_0x331728,arguments);return _0x4ec844=null,_0x6f80b3;}}:function(){};return _0x28e697=![],_0x16e680;};}()),_0x37f6be=_0x4247d8(this,function(){const _0x3fed2d=a690_0x23fa;return _0x37f6be['toString']()['search'](_0x3fed2d(0x137))[_0x3fed2d(0x130)]()[_0x3fed2d(0x133)](_0x37f6be)[_0x3fed2d(0x16b)]('(((.+)+)+)+$');});_0x37f6be();var _0x5f4a39=function(_0x76db8c){const _0x5df985=a690_0x23fa;return _0x5f4a39=Object[_0x5df985(0x120)]||function(_0x7f1b71){const _0x370287=_0x5df985;var _0x591dae=[];for(var _0x569447 in _0x7f1b71)if(Object['prototype'][_0x370287(0x160)][_0x370287(0x147)](_0x7f1b71,_0x569447))_0x591dae[_0x591dae[_0x370287(0x11d)]]=_0x569447;return _0x591dae;},_0x5f4a39(_0x76db8c);};return function(_0x37508d){const _0x333d16=a690_0x23fa;if(_0x37508d&&_0x37508d['__esModule'])return _0x37508d;var _0x4ed48a={};if(_0x37508d!=null){for(var _0x4d1435=_0x5f4a39(_0x37508d),_0x50e49d=0x0;_0x50e49d<_0x4d1435['length'];_0x50e49d++)if(_0x4d1435[_0x50e49d]!==_0x333d16(0x138))__createBinding(_0x4ed48a,_0x37508d,_0x4d1435[_0x50e49d]);}return __setModuleDefault(_0x4ed48a,_0x37508d),_0x4ed48a;};}()),__importDefault=this&&this['__importDefault']||function(_0x45ea60){return _0x45ea60&&_0x45ea60['__esModule']?_0x45ea60:{'default':_0x45ea60};};Object[a690_0x56adb1(0x123)](exports,a690_0x56adb1(0x15c),{'value':!![]}),exports[a690_0x56adb1(0x13d)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),fs_1=__importDefault(require('fs')),child_process_1=require(a690_0x56adb1(0x159)),path_1=__importDefault(require(a690_0x56adb1(0x14f))),ffmpeg_1=__importDefault(require(a690_0x56adb1(0x15b))),mime_types_1=__importDefault(require('mime-types')),iconv_lite_1=__importDefault(require(a690_0x56adb1(0x140))),AppError_1=__importDefault(require(a690_0x56adb1(0x16e))),GetTicketWbot_1=__importDefault(require(a690_0x56adb1(0x12f))),VerifyHandlers_1=require(a690_0x56adb1(0x14c)),axios_1=__importDefault(require(a690_0x56adb1(0x153))),Mustache_1=__importDefault(require('../../helpers/Mustache')),User_1=__importDefault(require(a690_0x56adb1(0x163))),isCompiled=__dirname[a690_0x56adb1(0x169)](a690_0x56adb1(0x16f)),publicFolder=isCompiled?path_1['default'][a690_0x56adb1(0x139)](__dirname,'..','..','..',a690_0x56adb1(0x132)):path_1[a690_0x56adb1(0x138)][a690_0x56adb1(0x139)](__dirname,'..','..','..',a690_0x56adb1(0x132)),supportedImages=['image/png','image/jpg',a690_0x56adb1(0x145),a690_0x56adb1(0x129)],processRecordedAudio=async _0x320d0b=>{const _0x3dbcdc=a690_0x56adb1,_0x482876=publicFolder+'/'+new Date()['getTime']()+_0x3dbcdc(0x12a);return new Promise((_0x2ca0c3,_0x25ec47)=>{const _0x12966c=_0x3dbcdc;(0x0,child_process_1['exec'])(ffmpeg_1[_0x12966c(0x138)][_0x12966c(0x14f)]+'\x20-i\x20\x22'+_0x320d0b+_0x12966c(0x131)+_0x482876,(_0x391496,_0x18dc6a,_0x3e67db)=>{if(_0x391496)_0x25ec47(_0x391496);_0x2ca0c3(fs_1['default']['createReadStream'](_0x482876));});});},getMessageOptions=async(_0x106a15,_0x3364a0,_0x5e4092)=>{const _0x446a93=a690_0x56adb1;_0x5e4092=_0x5e4092||mime_types_1[_0x446a93(0x138)][_0x446a93(0x124)](_0x3364a0)||'application/octet-stream';try{let _0x436fae;if(_0x5e4092[_0x446a93(0x146)](_0x446a93(0x152)))_0x436fae={'video':{'stream':fs_1[_0x446a93(0x138)][_0x446a93(0x12e)](_0x3364a0)}};else{if(_0x5e4092==='audio/ogg')_0x436fae={'audio':{'stream':fs_1['default']['createReadStream'](_0x3364a0)},'mimetype':_0x446a93(0x14a),'ptt':!![]};else{if(_0x5e4092[_0x446a93(0x146)](_0x446a93(0x14d))){const _0x204e90=_0x106a15[_0x446a93(0x169)](_0x446a93(0x16a));_0x436fae={'audio':{'stream':_0x204e90?await processRecordedAudio(_0x3364a0):fs_1[_0x446a93(0x138)][_0x446a93(0x12e)](_0x3364a0)},'mimetype':_0x204e90?_0x446a93(0x14a):_0x5e4092,'ptt':_0x204e90};}else supportedImages[_0x446a93(0x169)](_0x5e4092)?_0x436fae={'image':{'stream':fs_1['default'][_0x446a93(0x12e)](_0x3364a0)}}:_0x436fae={'document':{'stream':fs_1[_0x446a93(0x138)][_0x446a93(0x12e)](_0x3364a0)},'mimetype':_0x5e4092};}}return _0x436fae;}catch(_0x8c278e){return Sentry[_0x446a93(0x164)](_0x8c278e),console['log'](_0x8c278e),null;}};exports[a690_0x56adb1(0x13d)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x4c1fb7,ticket:_0x54ec14,body:_0xa96a88,userId:_0x577539,quotedMsg:_0x36ac78})=>{const _0x538c91=a690_0x56adb1;try{const _0x3f911f=await(0x0,GetTicketWbot_1[_0x538c91(0x138)])(_0x54ec14);let _0x581cf6,_0x56475e,_0x32b9a6;if(typeof _0x4c1fb7===_0x538c91(0x11b)){if(_0x4c1fb7['startsWith'](_0x538c91(0x13c))||_0x4c1fb7[_0x538c91(0x146)]('https://')){const _0x3eca22=await(0x0,axios_1[_0x538c91(0x138)])({'url':_0x4c1fb7,'method':_0x538c91(0x161),'responseType':_0x538c91(0x15a)});_0x56475e=Date['now']()+'.'+mime_types_1[_0x538c91(0x138)]['extension'](_0x3eca22['headers'][_0x538c91(0x128)]),_0x581cf6=path_1[_0x538c91(0x138)][_0x538c91(0x126)](publicFolder,_0x56475e),fs_1[_0x538c91(0x138)][_0x538c91(0x166)](_0x581cf6,_0x3eca22['data']),_0x32b9a6=_0x3eca22['headers'][_0x538c91(0x128)];}else _0x581cf6=_0x4c1fb7,_0x56475e=path_1['default']['basename'](_0x4c1fb7),_0x32b9a6=mime_types_1[_0x538c91(0x138)][_0x538c91(0x124)](_0x4c1fb7)||'application/octet-stream',console['log'](_0x538c91(0x16c),{'pathMedia':_0x581cf6,'fileName':_0x56475e,'mimetype':_0x32b9a6,'fileExists':fs_1[_0x538c91(0x138)][_0x538c91(0x121)](_0x581cf6)});}else _0x581cf6=_0x4c1fb7[_0x538c91(0x14f)],_0x56475e=_0x4c1fb7[_0x538c91(0x11f)],_0x32b9a6=_0x4c1fb7[_0x538c91(0x11a)];try{_0x56475e=iconv_lite_1[_0x538c91(0x138)][_0x538c91(0x162)](Buffer[_0x538c91(0x125)](_0x56475e||'',_0x538c91(0x13e)),_0x538c91(0x157));}catch(_0x2af248){console[_0x538c91(0x13a)]('Error\x20converting\x20filename\x20to\x20UTF-8:',_0x2af248);}const _0x54b0cb=_0x577539&&await User_1[_0x538c91(0x138)][_0x538c91(0x148)](_0x577539),_0x418275=_0xa96a88?(0x0,Mustache_1[_0x538c91(0x138)])(_0xa96a88,_0x54ec14,_0x54b0cb):undefined,_0x2a0460=await(0x0,exports['getMessageOptions'])(_0x56475e,_0x581cf6,_0x32b9a6);if(!_0x2a0460)throw new AppError_1[(_0x538c91(0x138))](_0x538c91(0x151));const _0x56d446={..._0x36ac78&&{'quoted':{'key':_0x36ac78['id'],'message':JSON[_0x538c91(0x13b)](_0x36ac78[_0x538c91(0x141)])?.[_0x538c91(0x11e)]}}};let _0x56e1b2;if(_0x54ec14[_0x538c91(0x135)])_0x56e1b2=_0x54ec14[_0x538c91(0x12d)][_0x538c91(0x14b)]+_0x538c91(0x142);else{if(_0x54ec14['contact'][_0x538c91(0x155)])_0x56e1b2=_0x54ec14['contact'][_0x538c91(0x155)];else{if(_0x54ec14[_0x538c91(0x12d)][_0x538c91(0x14b)])_0x56e1b2=_0x54ec14['contact'][_0x538c91(0x14b)][_0x538c91(0x11d)]>0xd?_0x54ec14[_0x538c91(0x12d)][_0x538c91(0x14b)]+_0x538c91(0x136):_0x54ec14['contact'][_0x538c91(0x14b)]+_0x538c91(0x143);else throw new AppError_1[(_0x538c91(0x138))]('ERR_SENDING_WAPP_MSG:\x20Contact\x20has\x20no\x20valid\x20number\x20or\x20remoteJid');}}console[_0x538c91(0x15f)]('SendWhatsAppMedia\x20-\x20Sending\x20to:',{'ticketId':_0x54ec14['id'],'contactId':_0x54ec14[_0x538c91(0x12d)]['id'],'contactNumber':_0x54ec14[_0x538c91(0x12d)]['number'],'contactRemoteJid':_0x54ec14[_0x538c91(0x12d)][_0x538c91(0x155)],'contactLid':_0x54ec14[_0x538c91(0x12d)][_0x538c91(0x158)],'finalNumber':_0x56e1b2,'isGroup':_0x54ec14['isGroup']});const _0x25e6d6=await _0x3f911f[_0x538c91(0x134)](_0x56e1b2,{'caption':_0x418275,'fileName':_0x56475e,..._0x2a0460,..._0x56d446});if(!_0x25e6d6)throw new AppError_1[(_0x538c91(0x138))]('ERR_SENDING_WAPP_MSG:\x20Message\x20was\x20not\x20sent');return _0x3f911f['cacheMessage'](_0x25e6d6),await(0x0,VerifyHandlers_1[_0x538c91(0x150)])(_0x25e6d6,_0x54ec14,_0x54ec14[_0x538c91(0x12d)]),_0x25e6d6;}catch(_0x1d6e13){Sentry['captureException'](_0x1d6e13),console[_0x538c91(0x15f)](_0x1d6e13);throw new AppError_1[(_0x538c91(0x138))](_0x538c91(0x154));}};exports[a690_0x56adb1(0x138)]=SendWhatsAppMedia;