function a540_0x4cdc(){const _0x465dd8=['\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','create','log','128bGTRrr','fluent-ffmpeg','application/zip','configurable','mimetype','175506mwSjoT','update','resolve','prototype','audio/mp3','../../helpers/Mustache','__createBinding','__importDefault','originalname','search','lookup','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','video/3gpp','application/vnd.ms-powerpoint','text/csv','pop','@sentry/node','56709xvhZdE','audio-record-site','111202TihQpz','writable','defineProperty','416296gxervt','6cTnLDM','exec','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','./wbotMessageListener','get','audio','path','(((.+)+)+)+$','video/3gpp2','getMessageOptions','constructor','application/pdf','video','./public','number','156maPInL','s.whatsapp.net','unlinkSync','sendMessage','string','509973TAhEPY','trace','__esModule','application/x-rar-compressed','contact','audio/mp4','startsWith','audio/ogg','\x20-y','captureException','filename','application/vnd.openxmlformats-officedocument.wordprocessingml.document','readFileSync','split','SendWhatsAppMediaFileAddress','.mp3','ffmpeg-static','380zkkivc','key','participant','application/vnd.ms-excel','ERR_SENDING_WAPP_MSG','getTime','../../errors/AppError','getBodyMessage','image/jpeg','hasOwnProperty','toString','includes','remoteJid','fromMe','call','45ihIXYF','companyId','application/rtf','document','120778UyWWWE','__setModuleDefault','video/mp4','body','stringify','838739WSVDAM','default','verifyQuotedMessage','getOwnPropertyDescriptor','text','__importStar','application','http','g.us','text/html','\x20-i\x20','length'];a540_0x4cdc=function(){return _0x465dd8;};return a540_0x4cdc();}const a540_0x564b95=a540_0x96f8;(function(_0x25e58f,_0x1ef8c8){const _0x1af9b9=a540_0x96f8,_0x20614c=_0x25e58f();while(!![]){try{const _0x1da003=-parseInt(_0x1af9b9(0xc5))/0x1*(parseInt(_0x1af9b9(0xc9))/0x2)+-parseInt(_0x1af9b9(0x75))/0x3+parseInt(_0x1af9b9(0xc8))/0x4+parseInt(_0x1af9b9(0x95))/0x5*(parseInt(_0x1af9b9(0xb2))/0x6)+-parseInt(_0x1af9b9(0x99))/0x7*(parseInt(_0x1af9b9(0xad))/0x8)+parseInt(_0x1af9b9(0xc3))/0x9*(-parseInt(_0x1af9b9(0x86))/0xa)+-parseInt(_0x1af9b9(0x9e))/0xb*(-parseInt(_0x1af9b9(0x70))/0xc);if(_0x1da003===_0x1ef8c8)break;else _0x20614c['push'](_0x20614c['shift']());}catch(_0x39ccb8){_0x20614c['push'](_0x20614c['shift']());}}}(a540_0x4cdc,0x52e0f));const a540_0x380312=(function(){let _0x23884c=!![];return function(_0x3fa435,_0x3eff85){const _0x2efe53=_0x23884c?function(){if(_0x3eff85){const _0x31084f=_0x3eff85['apply'](_0x3fa435,arguments);return _0x3eff85=null,_0x31084f;}}:function(){};return _0x23884c=![],_0x2efe53;};}()),a540_0x1b76e9=a540_0x380312(this,function(){const _0x31c58c=a540_0x96f8;return a540_0x1b76e9[_0x31c58c(0x90)]()[_0x31c58c(0xbb)]('(((.+)+)+)+$')[_0x31c58c(0x90)]()[_0x31c58c(0xd3)](a540_0x1b76e9)[_0x31c58c(0xbb)](_0x31c58c(0xd0));});a540_0x1b76e9();'use strict';var __createBinding=this&&this[a540_0x564b95(0xb8)]||(Object[a540_0x564b95(0xab)]?function(_0x1560d6,_0x961e6a,_0x626e1d,_0x10392a){const _0xe250fc=a540_0x564b95;if(_0x10392a===undefined)_0x10392a=_0x626e1d;var _0x39c239=Object[_0xe250fc(0xa1)](_0x961e6a,_0x626e1d);(!_0x39c239||(_0xe250fc(0xcd)in _0x39c239?!_0x961e6a[_0xe250fc(0x77)]:_0x39c239[_0xe250fc(0xc6)]||_0x39c239[_0xe250fc(0xb0)]))&&(_0x39c239={'enumerable':!![],'get':function(){return _0x961e6a[_0x626e1d];}}),Object[_0xe250fc(0xc7)](_0x1560d6,_0x10392a,_0x39c239);}:function(_0xc9f7e4,_0x2077c2,_0x28393c,_0x8d7ed4){if(_0x8d7ed4===undefined)_0x8d7ed4=_0x28393c;_0xc9f7e4[_0x8d7ed4]=_0x2077c2[_0x28393c];}),__setModuleDefault=this&&this[a540_0x564b95(0x9a)]||(Object['create']?function(_0x525630,_0x3c6800){const _0x3aafe4=a540_0x564b95;Object['defineProperty'](_0x525630,_0x3aafe4(0x9f),{'enumerable':!![],'value':_0x3c6800});}:function(_0x4e2af9,_0x24bce4){const _0x3feda5=a540_0x564b95;_0x4e2af9[_0x3feda5(0x9f)]=_0x24bce4;}),__importStar=this&&this[a540_0x564b95(0xa3)]||function(_0x4ad896){const _0x3d7464=a540_0x564b95;if(_0x4ad896&&_0x4ad896[_0x3d7464(0x77)])return _0x4ad896;var _0x5dd00d={};if(_0x4ad896!=null){for(var _0x13678f in _0x4ad896)if(_0x13678f!==_0x3d7464(0x9f)&&Object[_0x3d7464(0xb5)][_0x3d7464(0x8f)][_0x3d7464(0x94)](_0x4ad896,_0x13678f))__createBinding(_0x5dd00d,_0x4ad896,_0x13678f);}return __setModuleDefault(_0x5dd00d,_0x4ad896),_0x5dd00d;},__importDefault=this&&this[a540_0x564b95(0xb9)]||function(_0x57c5d7){const _0xf4e5e6=a540_0x564b95;return _0x57c5d7&&_0x57c5d7[_0xf4e5e6(0x77)]?_0x57c5d7:{'default':_0x57c5d7};};Object[a540_0x564b95(0xc7)](exports,a540_0x564b95(0x77),{'value':!![]}),exports[a540_0x564b95(0x83)]=exports[a540_0x564b95(0xd2)]=void 0x0;const Sentry=__importStar(require(a540_0x564b95(0xc2))),fs_1=__importDefault(require('fs')),child_process_1=require('child_process'),path_1=__importDefault(require(a540_0x564b95(0xcf))),fluent_ffmpeg_1=__importDefault(require(a540_0x564b95(0xae))),AppError_1=__importDefault(require(a540_0x564b95(0x8c))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),mime_types_1=__importDefault(require('mime-types')),Mustache_1=__importDefault(require(a540_0x564b95(0xb7))),ffmpeg_static_1=__importDefault(require(a540_0x564b95(0x85))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),wbotMessageListener_1=require(a540_0x564b95(0xcc));fluent_ffmpeg_1[a540_0x564b95(0x9f)]['setFfmpegPath'](ffmpeg_static_1[a540_0x564b95(0x9f)]);const publicFolder=path_1[a540_0x564b95(0x9f)][a540_0x564b95(0xb4)](__dirname,'..','..','..','public'),processAudio=async(_0x942b8a,_0x507dc3)=>{const _0x26fd51=a540_0x564b95,_0x202985=publicFolder+'/company'+_0x507dc3+'/'+new Date()['getTime']()+_0x26fd51(0x84);return new Promise((_0x4fd28a,_0x1965b5)=>{const _0x1f9054=_0x26fd51;(0x0,child_process_1[_0x1f9054(0xca)])(ffmpeg_static_1[_0x1f9054(0x9f)]+_0x1f9054(0xa8)+_0x942b8a+_0x1f9054(0xbd)+_0x202985+_0x1f9054(0x7d),(_0x2868bd,_0x15d7ce,_0x28afaf)=>{const _0x2a0727=_0x1f9054;if(_0x2868bd)_0x1965b5(_0x2868bd);fs_1[_0x2a0727(0x9f)][_0x2a0727(0x72)](_0x942b8a),_0x4fd28a(_0x202985);});});},processAudioFile=async _0x893473=>{const _0x1196f9=a540_0x564b95,_0x56d190=publicFolder+'/'+new Date()[_0x1196f9(0x8b)]()+_0x1196f9(0x84);return new Promise((_0xb62f5f,_0x1bdc96)=>{const _0x51aad8=_0x1196f9;(0x0,child_process_1[_0x51aad8(0xca)])(ffmpeg_static_1[_0x51aad8(0x9f)]+_0x51aad8(0xa8)+_0x893473+_0x51aad8(0xaa)+_0x56d190,(_0x1af0d9,_0x4e66b8,_0x11da76)=>{const _0x31d62b=_0x51aad8;if(_0x1af0d9)_0x1bdc96(_0x1af0d9);fs_1[_0x31d62b(0x9f)][_0x31d62b(0x72)](_0x893473),_0xb62f5f(_0x56d190);});});},getMessageOptions=async(_0xfa78d,_0x22226e,_0x335940,_0x1c6e5f)=>{const _0x58ce34=a540_0x564b95,_0x4003d1=mime_types_1[_0x58ce34(0x9f)][_0x58ce34(0xbc)](_0x22226e),_0x47b548=_0x4003d1[_0x58ce34(0x82)]('/')[0x0];try{if(!_0x4003d1)throw new Error('Invalid\x20mimetype');let _0x5328d8;if(_0x47b548===_0x58ce34(0xd5))_0x5328d8={'video':fs_1[_0x58ce34(0x9f)][_0x58ce34(0x81)](_0x22226e),'caption':_0x335940?_0x335940:'','fileName':_0xfa78d};else{if(_0x47b548===_0x58ce34(0xce)){const _0x248922=!![],_0x138d87=await processAudio(_0x22226e,_0x1c6e5f);_0x248922?_0x5328d8={'audio':fs_1[_0x58ce34(0x9f)][_0x58ce34(0x81)](_0x138d87),'mimetype':_0x248922?_0x58ce34(0x7a):_0x4003d1,'caption':_0x335940?_0x335940:null,'ptt':!![]}:_0x5328d8={'audio':fs_1[_0x58ce34(0x9f)][_0x58ce34(0x81)](_0x138d87),'mimetype':_0x248922?_0x58ce34(0x7a):_0x4003d1,'caption':_0x335940?_0x335940:null,'ptt':!![]};}else{if(_0x47b548===_0x58ce34(0x98))_0x5328d8={'document':fs_1[_0x58ce34(0x9f)][_0x58ce34(0x81)](_0x22226e),'caption':_0x335940?_0x335940:null,'fileName':_0xfa78d,'mimetype':_0x4003d1};else _0x47b548===_0x58ce34(0xa4)?_0x5328d8={'document':fs_1[_0x58ce34(0x9f)][_0x58ce34(0x81)](_0x22226e),'caption':_0x335940?_0x335940:null,'fileName':_0xfa78d,'mimetype':_0x4003d1}:_0x5328d8={'image':fs_1[_0x58ce34(0x9f)][_0x58ce34(0x81)](_0x22226e),'caption':_0x335940?_0x335940:null};}}return _0x5328d8;}catch(_0x39af97){return Sentry['captureException'](_0x39af97),console[_0x58ce34(0xac)](_0x39af97),null;}};exports[a540_0x564b95(0xd2)]=getMessageOptions;function a540_0x96f8(_0x3a5597,_0x4226d9){const _0x398f65=a540_0x4cdc();return a540_0x96f8=function(_0x1b76e9,_0x380312){_0x1b76e9=_0x1b76e9-0x70;let _0x4cdcfb=_0x398f65[_0x1b76e9];return _0x4cdcfb;},a540_0x96f8(_0x3a5597,_0x4226d9);}const SendWhatsAppMedia=async({media:_0xd2fd91,ticket:_0x44a7d1,body:_0x2304ac})=>{const _0x1cf659=a540_0x564b95;try{const _0xb02f42=await(0x0,GetTicketWbot_1[_0x1cf659(0x9f)])(_0x44a7d1),_0x12206e=_0xd2fd91[_0x1cf659(0xcf)],_0x53f333=_0xd2fd91[_0x1cf659(0xb1)][_0x1cf659(0x82)]('/')[0x0];let _0x3aa8b1;const _0x4aca13=(0x0,Mustache_1[_0x1cf659(0x9f)])(_0x2304ac,_0x44a7d1);var _0x385e08=_0xd2fd91[_0x1cf659(0x7f)];if(_0x53f333===_0x1cf659(0xd5))_0x3aa8b1={'video':fs_1[_0x1cf659(0x9f)][_0x1cf659(0x81)](_0x12206e),'caption':_0x4aca13,'fileName':_0xd2fd91['originalname']};else{if(_0x53f333===_0x1cf659(0xce)){const _0x3f8dc2=_0xd2fd91[_0x1cf659(0xba)][_0x1cf659(0x91)](_0x1cf659(0xc4));if(_0x3f8dc2){const _0x2b6c2b=await processAudio(_0xd2fd91[_0x1cf659(0xcf)],_0x44a7d1[_0x1cf659(0x96)]);_0x3aa8b1={'audio':fs_1[_0x1cf659(0x9f)]['readFileSync'](_0x2b6c2b),'mimetype':_0x3f8dc2?_0x1cf659(0x7a):_0xd2fd91[_0x1cf659(0xb1)],'ptt':!![]},_0x385e08=_0x2b6c2b[_0x1cf659(0x82)]('/')[_0x2b6c2b[_0x1cf659(0x82)]('/')[_0x1cf659(0xa9)]-0x1];}else{const _0x23c631=await processAudioFile(_0xd2fd91['path']);_0x3aa8b1={'audio':fs_1[_0x1cf659(0x9f)]['readFileSync'](_0x23c631),'mimetype':_0x3f8dc2?_0x1cf659(0x7a):_0xd2fd91['mimetype']},_0x385e08=_0x23c631[_0x1cf659(0x82)]('/')[_0x23c631[_0x1cf659(0x82)]('/')[_0x1cf659(0xa9)]-0x1];}}else{if(_0x53f333===_0x1cf659(0x98)||_0x53f333==='text')_0x3aa8b1={'document':fs_1[_0x1cf659(0x9f)][_0x1cf659(0x81)](_0x12206e),'caption':_0x4aca13,'fileName':_0xd2fd91[_0x1cf659(0xba)],'mimetype':_0xd2fd91[_0x1cf659(0xb1)]};else _0x53f333==='application'?_0x3aa8b1={'document':fs_1[_0x1cf659(0x9f)][_0x1cf659(0x81)](_0x12206e),'caption':_0x4aca13,'fileName':_0xd2fd91[_0x1cf659(0xba)],'mimetype':_0xd2fd91[_0x1cf659(0xb1)]}:_0x3aa8b1={'image':fs_1[_0x1cf659(0x9f)][_0x1cf659(0x81)](_0x12206e),'caption':_0x4aca13};}}var _0x1f9e9e=await _0xb02f42[_0x1cf659(0x73)](_0x44a7d1[_0x1cf659(0x79)][_0x1cf659(0xd7)]+'@'+(_0x44a7d1['isGroup']?_0x1cf659(0xa6):'s.whatsapp.net'),{..._0x3aa8b1});const _0x139889=await(0x0,wbotMessageListener_1[_0x1cf659(0xa0)])(_0x1f9e9e),_0x38cd6a={'id':_0x1f9e9e['key']['id'],'ticketId':_0x44a7d1['id'],'contactId':undefined,'body':_0x2304ac?(0x0,Mustache_1['default'])(_0x2304ac,_0x44a7d1):(0x0,wbotMessageListener_1[_0x1cf659(0x8d)])(_0x1f9e9e),'fromMe':_0x1f9e9e[_0x1cf659(0x87)]['fromMe'],'read':_0x1f9e9e[_0x1cf659(0x87)][_0x1cf659(0x93)],'mediaUrl':_0x385e08,'mediaType':_0x53f333,'quotedMsgId':_0x139889?.['id'],'ack':0x0,'remoteJid':_0x1f9e9e[_0x1cf659(0x87)][_0x1cf659(0x92)],'participant':_0x1f9e9e[_0x1cf659(0x87)][_0x1cf659(0x88)],'dataJson':JSON[_0x1cf659(0x9d)](_0x1f9e9e)};return typeof _0x38cd6a[_0x1cf659(0x9c)]!=_0x1cf659(0x74)&&console[_0x1cf659(0x76)]('body\x20is\x20not\x20a\x20string',_0x38cd6a[_0x1cf659(0x9c)]),await _0x44a7d1[_0x1cf659(0xb3)]({'lastMessage':_0x38cd6a[_0x1cf659(0x9c)]}),await(0x0,CreateMessageService_1[_0x1cf659(0x9f)])({'messageData':_0x38cd6a,'ticket':_0x44a7d1,'companyId':_0x44a7d1['companyId']}),_0x1f9e9e;}catch(_0xb550c5){Sentry['captureException'](_0xb550c5),console['trace'](_0xb550c5);throw new AppError_1[(_0x1cf659(0x9f))](_0x1cf659(0x8a));}};exports[a540_0x564b95(0x9f)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x42c63e,_0x11f610,_0x535cd2)=>{const _0x3d2de5=a540_0x564b95;try{const _0x48fe5d=await(0x0,GetTicketWbot_1[_0x3d2de5(0x9f)])(_0x11f610);_0x42c63e[_0x3d2de5(0x7b)](_0x3d2de5(0xa5))&&(_0x42c63e=_0x3d2de5(0xd6)+_0x42c63e[_0x3d2de5(0x82)]('/public')[0x1]);const _0x4260e1=_0x42c63e,_0x360923=getMimeType(_0x42c63e)[_0x3d2de5(0x82)]('/')[0x0];let _0xe8b7;if(_0x360923===_0x3d2de5(0xd5))_0xe8b7={'video':fs_1[_0x3d2de5(0x9f)][_0x3d2de5(0x81)](_0x4260e1),'caption':_0x535cd2,'fileName':extractFileName(_0x42c63e)};else{if(_0x360923===_0x3d2de5(0xce)){const _0x5201c1=_0x42c63e[_0x3d2de5(0x91)](_0x3d2de5(0xc4));if(_0x5201c1){const _0x56ac54=await processAudio(_0x42c63e,_0x11f610[_0x3d2de5(0x96)]);_0xe8b7={'audio':fs_1[_0x3d2de5(0x9f)][_0x3d2de5(0x81)](_0x56ac54),'mimetype':_0x5201c1?_0x3d2de5(0x7a):getMimeType(_0x42c63e),'ptt':!![]};}else{const _0x3ff5a2=await processAudioFile(_0x42c63e);_0xe8b7={'audio':fs_1[_0x3d2de5(0x9f)][_0x3d2de5(0x81)](_0x3ff5a2),'mimetype':_0x5201c1?_0x3d2de5(0x7a):getMimeType(_0x42c63e)};}}else{if(_0x360923===_0x3d2de5(0x98)||_0x360923===_0x3d2de5(0xa2))_0xe8b7={'document':fs_1[_0x3d2de5(0x9f)][_0x3d2de5(0x81)](_0x4260e1),'caption':_0x535cd2,'fileName':extractFileName(_0x42c63e),'mimetype':getMimeType(_0x42c63e)};else _0x360923===_0x3d2de5(0xa4)?_0xe8b7={'document':fs_1['default']['readFileSync'](_0x4260e1),'caption':_0x535cd2,'fileName':extractFileName(_0x42c63e),'mimetype':getMimeType(_0x42c63e)}:_0xe8b7={'image':fs_1[_0x3d2de5(0x9f)][_0x3d2de5(0x81)](_0x4260e1),'caption':_0x535cd2};}}const _0x34a956=await _0x48fe5d[_0x3d2de5(0x73)](_0x11f610[_0x3d2de5(0x79)][_0x3d2de5(0xd7)]+'@'+(_0x11f610['isGroup']?'g.us':_0x3d2de5(0x71)),{..._0xe8b7});return _0x34a956;}catch(_0x560f62){Sentry[_0x3d2de5(0x7e)](_0x560f62),console['log'](_0x560f62);throw new AppError_1[(_0x3d2de5(0x9f))]('ERR_SENDING_WAPP_MSG');}};exports[a540_0x564b95(0x83)]=SendWhatsAppMediaFileAddress;const extractFileName=_0xfacfe5=>{const _0x2a543a=a540_0x564b95,_0x21daed=_0xfacfe5[_0x2a543a(0x82)]('/');return _0x21daed[_0x21daed['length']-0x1];},extractFilePath=_0x284446=>{const _0x26aa78=a540_0x564b95,_0x350c27=_0x284446[_0x26aa78(0x82)]('/');return _0x350c27[_0x26aa78(0xc1)](),_0x350c27['join']('/');},getMimeType=_0x53c86a=>{const _0x539213=a540_0x564b95,_0x10fb8f=_0x53c86a[_0x539213(0x82)]('.'),_0x1d6e46=_0x10fb8f[_0x10fb8f[_0x539213(0xa9)]-0x1],_0x5b940e={'jpg':_0x539213(0x8e),'jpeg':_0x539213(0x8e),'png':'image/png','gif':'image/gif','mp4':_0x539213(0x9b),'mp3':_0x539213(0xb6),'m4a':_0x539213(0x7a),'ogg':_0x539213(0x7c),'pdf':_0x539213(0xd4),'doc':'application/msword','docx':_0x539213(0x80),'xls':_0x539213(0x89),'xlsx':_0x539213(0xcb),'ppt':_0x539213(0xbf),'pptx':'application/vnd.openxmlformats-officedocument.presentationml.presentation','txt':'text/plain','rtf':_0x539213(0x97),'csv':_0x539213(0xc0),'html':_0x539213(0xa7),'zip':_0x539213(0xaf),'rar':_0x539213(0x78),'7z':'application/x-7z-compressed','3gp':_0x539213(0xbe),'3g2':_0x539213(0xd1),'3ga':_0x539213(0xbe),'7gp':_0x539213(0xd1),'7ga':_0x539213(0xbe),'3gpp':_0x539213(0xbe),'3gpp2':_0x539213(0xd1),'7gpp':_0x539213(0xbe),'7gpp2':_0x539213(0xd1),'3gpp-tt':_0x539213(0xbe),'3gpp2-tt':'video/3gpp2','7gpp-tt':_0x539213(0xbe),'7gpp2-tt':'video/3gpp2','3gpp-rtt':_0x539213(0xbe),'3gpp2-rtt':_0x539213(0xd1),'7gpp-rtt':_0x539213(0xbe),'7gpp2-rtt':_0x539213(0xd1),'3gpp-sms':_0x539213(0xbe),'3gpp2-sms':_0x539213(0xd1),'7gpp-sms':_0x539213(0xbe),'7gpp2-sms':_0x539213(0xd1),'pdfa':_0x539213(0xd4),'x-pdf':'application/pdf'};if(_0x5b940e[_0x1d6e46])return _0x5b940e[_0x1d6e46];return'application/octet-stream';};