'use strict';const a575_0x9efd1a=a575_0x4739;(function(_0x4125e2,_0x4667fa){const _0x4ca4c5=a575_0x4739,_0x56907e=_0x4125e2();while(!![]){try{const _0x4abf9f=parseInt(_0x4ca4c5(0x1d4))/0x1+parseInt(_0x4ca4c5(0x1aa))/0x2*(-parseInt(_0x4ca4c5(0x1c0))/0x3)+-parseInt(_0x4ca4c5(0x1a8))/0x4+-parseInt(_0x4ca4c5(0x1a6))/0x5*(-parseInt(_0x4ca4c5(0x1e7))/0x6)+-parseInt(_0x4ca4c5(0x1ac))/0x7+-parseInt(_0x4ca4c5(0x1bb))/0x8+parseInt(_0x4ca4c5(0x1ad))/0x9*(parseInt(_0x4ca4c5(0x1d2))/0xa);if(_0x4abf9f===_0x4667fa)break;else _0x56907e['push'](_0x56907e['shift']());}catch(_0x568109){_0x56907e['push'](_0x56907e['shift']());}}}(a575_0x3bb6,0x9f878));var __createBinding=this&&this[a575_0x9efd1a(0x1c9)]||(Object[a575_0x9efd1a(0x1c3)]?function(_0x4f8cb2,_0x102cc5,_0x4be240,_0x28149e){const _0x44a680=a575_0x9efd1a;if(_0x28149e===undefined)_0x28149e=_0x4be240;var _0x4f0d7a=Object[_0x44a680(0x1c1)](_0x102cc5,_0x4be240);(!_0x4f0d7a||(_0x44a680(0x1e1)in _0x4f0d7a?!_0x102cc5[_0x44a680(0x1b8)]:_0x4f0d7a[_0x44a680(0x1d8)]||_0x4f0d7a[_0x44a680(0x1e4)]))&&(_0x4f0d7a={'enumerable':!![],'get':function(){return _0x102cc5[_0x4be240];}}),Object[_0x44a680(0x1ef)](_0x4f8cb2,_0x28149e,_0x4f0d7a);}:function(_0x1f1a8f,_0x50576c,_0x533311,_0x36b1de){if(_0x36b1de===undefined)_0x36b1de=_0x533311;_0x1f1a8f[_0x36b1de]=_0x50576c[_0x533311];}),__setModuleDefault=this&&this[a575_0x9efd1a(0x1df)]||(Object[a575_0x9efd1a(0x1c3)]?function(_0x363cd7,_0x3a7ac8){const _0xfc9998=a575_0x9efd1a;Object[_0xfc9998(0x1ef)](_0x363cd7,_0xfc9998(0x1e6),{'enumerable':!![],'value':_0x3a7ac8});}:function(_0xb3ad05,_0x560466){const _0x19f168=a575_0x9efd1a;_0xb3ad05[_0x19f168(0x1e6)]=_0x560466;}),__importStar=this&&this[a575_0x9efd1a(0x1dd)]||(function(){const _0x118213=(function(){let _0x2ab8e7=!![];return function(_0xcad8f2,_0x318b6a){const _0x7c51f4=_0x2ab8e7?function(){if(_0x318b6a){const _0x54f2a1=_0x318b6a['apply'](_0xcad8f2,arguments);return _0x318b6a=null,_0x54f2a1;}}:function(){};return _0x2ab8e7=![],_0x7c51f4;};}()),_0x517ee7=_0x118213(this,function(){const _0x338e74=a575_0x4739;return _0x517ee7[_0x338e74(0x1b7)]()['search'](_0x338e74(0x1ba))['toString']()['constructor'](_0x517ee7)[_0x338e74(0x1a9)](_0x338e74(0x1ba));});_0x517ee7();var _0x3d1b5e=function(_0x2b706e){const _0x10fca3=a575_0x4739;return _0x3d1b5e=Object[_0x10fca3(0x1dc)]||function(_0x431fcf){const _0x4e7471=_0x10fca3;var _0x14e140=[];for(var _0x870600 in _0x431fcf)if(Object[_0x4e7471(0x1ce)][_0x4e7471(0x1bd)][_0x4e7471(0x1e8)](_0x431fcf,_0x870600))_0x14e140[_0x14e140[_0x4e7471(0x1e3)]]=_0x870600;return _0x14e140;},_0x3d1b5e(_0x2b706e);};return function(_0x21c61c){const _0x3e1da6=a575_0x4739;if(_0x21c61c&&_0x21c61c[_0x3e1da6(0x1b8)])return _0x21c61c;var _0x1e1590={};if(_0x21c61c!=null){for(var _0x3333f1=_0x3d1b5e(_0x21c61c),_0x43bc0d=0x0;_0x43bc0d<_0x3333f1[_0x3e1da6(0x1e3)];_0x43bc0d++)if(_0x3333f1[_0x43bc0d]!=='default')__createBinding(_0x1e1590,_0x21c61c,_0x3333f1[_0x43bc0d]);}return __setModuleDefault(_0x1e1590,_0x21c61c),_0x1e1590;};}()),__importDefault=this&&this[a575_0x9efd1a(0x1ec)]||function(_0x1d69e9){const _0x5ce21d=a575_0x9efd1a;return _0x1d69e9&&_0x1d69e9[_0x5ce21d(0x1b8)]?_0x1d69e9:{'default':_0x1d69e9};};Object[a575_0x9efd1a(0x1ef)](exports,a575_0x9efd1a(0x1b8),{'value':!![]}),exports[a575_0x9efd1a(0x1c6)]=void 0x0;const Sentry=__importStar(require(a575_0x9efd1a(0x1a5))),fs_1=__importDefault(require('fs')),child_process_1=require(a575_0x9efd1a(0x1a7)),path_1=__importDefault(require(a575_0x9efd1a(0x1b6))),ffmpeg_1=__importDefault(require(a575_0x9efd1a(0x1b4))),mime_types_1=__importDefault(require(a575_0x9efd1a(0x1b3))),iconv_lite_1=__importDefault(require('iconv-lite')),AppError_1=__importDefault(require(a575_0x9efd1a(0x1cc))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),VerifyHandlers_1=require(a575_0x9efd1a(0x1e0)),axios_1=__importDefault(require(a575_0x9efd1a(0x1e2))),Mustache_1=__importDefault(require(a575_0x9efd1a(0x1e9))),User_1=__importDefault(require(a575_0x9efd1a(0x1c7))),publicFolder=__dirname[a575_0x9efd1a(0x1cf)]('/dist')?path_1['default'][a575_0x9efd1a(0x1f3)](__dirname,'..','public'):path_1[a575_0x9efd1a(0x1e6)][a575_0x9efd1a(0x1f3)](__dirname,'..','..','..',a575_0x9efd1a(0x1f0)),supportedImages=[a575_0x9efd1a(0x1de),a575_0x9efd1a(0x1c2),a575_0x9efd1a(0x1d7),a575_0x9efd1a(0x1ae)],processRecordedAudio=async _0x54ad11=>{const _0x4c6db3=a575_0x9efd1a,_0x586a61=publicFolder+'/'+new Date()[_0x4c6db3(0x1ab)]()+_0x4c6db3(0x1b9);return new Promise((_0x8e95a3,_0x4ee77f)=>{const _0x64a166=_0x4c6db3;(0x0,child_process_1[_0x64a166(0x1e5)])(ffmpeg_1[_0x64a166(0x1e6)][_0x64a166(0x1b6)]+_0x64a166(0x1bf)+_0x54ad11+_0x64a166(0x1f4)+_0x586a61,(_0x394356,_0x1b4069,_0x583384)=>{const _0x1e08ce=_0x64a166;if(_0x394356)_0x4ee77f(_0x394356);_0x8e95a3(fs_1[_0x1e08ce(0x1e6)]['createReadStream'](_0x586a61));});});},getMessageOptions=async(_0x1be5a4,_0x39cc81,_0x4e4efd)=>{const _0x12cfc7=a575_0x9efd1a;_0x4e4efd=_0x4e4efd||mime_types_1[_0x12cfc7(0x1e6)]['lookup'](_0x39cc81)||_0x12cfc7(0x1d5);try{let _0x4271e0;if(_0x4e4efd[_0x12cfc7(0x1d9)](_0x12cfc7(0x1ea)))_0x4271e0={'video':{'stream':fs_1[_0x12cfc7(0x1e6)][_0x12cfc7(0x1be)](_0x39cc81)}};else{if(_0x4e4efd===_0x12cfc7(0x1b0))_0x4271e0={'audio':{'stream':fs_1['default'][_0x12cfc7(0x1be)](_0x39cc81)},'mimetype':'audio/ogg;\x20codecs=opus','ptt':!![]};else{if(_0x4e4efd[_0x12cfc7(0x1d9)](_0x12cfc7(0x1cb))){const _0xceba26=_0x1be5a4['includes'](_0x12cfc7(0x1cd));_0x4271e0={'audio':{'stream':_0xceba26?await processRecordedAudio(_0x39cc81):fs_1['default']['createReadStream'](_0x39cc81)},'mimetype':_0xceba26?'audio/ogg;\x20codecs=opus':_0x4e4efd,'ptt':_0xceba26};}else supportedImages['includes'](_0x4e4efd)?_0x4271e0={'image':{'stream':fs_1[_0x12cfc7(0x1e6)]['createReadStream'](_0x39cc81)}}:_0x4271e0={'document':{'stream':fs_1[_0x12cfc7(0x1e6)][_0x12cfc7(0x1be)](_0x39cc81)},'mimetype':_0x4e4efd};}}return _0x4271e0;}catch(_0x2b9a8f){return Sentry['captureException'](_0x2b9a8f),console[_0x12cfc7(0x1ee)](_0x2b9a8f),null;}};function a575_0x4739(_0x4e4e2d,_0xd6c81){const _0x3a821b=a575_0x3bb6();return a575_0x4739=function(_0x40a8cb,_0x277271){_0x40a8cb=_0x40a8cb-0x1a4;let _0x3bb645=_0x3a821b[_0x40a8cb];return _0x3bb645;},a575_0x4739(_0x4e4e2d,_0xd6c81);}exports[a575_0x9efd1a(0x1c6)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x2d43e4,ticket:_0x31a3f5,body:_0x249254,userId:_0x536a48,quotedMsg:_0x34c6e9})=>{const _0x2d79b9=a575_0x9efd1a;try{const _0x245190=await(0x0,GetTicketWbot_1[_0x2d79b9(0x1e6)])(_0x31a3f5);let _0x3455b5,_0x409fd6,_0x3a04f1;if(typeof _0x2d43e4===_0x2d79b9(0x1c4)){const _0x469943=await(0x0,axios_1['default'])({'url':_0x2d43e4,'method':'GET','responseType':_0x2d79b9(0x1a4)});_0x409fd6=Date[_0x2d79b9(0x1bc)]()+'.'+mime_types_1[_0x2d79b9(0x1e6)][_0x2d79b9(0x1d0)](_0x469943[_0x2d79b9(0x1ed)]['content-type']),_0x3455b5=path_1['default'][_0x2d79b9(0x1f2)](publicFolder,_0x409fd6),fs_1[_0x2d79b9(0x1e6)][_0x2d79b9(0x1d1)](_0x3455b5,_0x469943[_0x2d79b9(0x1f1)]),_0x3a04f1=_0x469943[_0x2d79b9(0x1ed)][_0x2d79b9(0x1d6)];}else _0x3455b5=_0x2d43e4[_0x2d79b9(0x1b6)],_0x409fd6=_0x2d43e4[_0x2d79b9(0x1c8)],_0x3a04f1=_0x2d43e4[_0x2d79b9(0x1da)];try{_0x409fd6=iconv_lite_1['default'][_0x2d79b9(0x1af)](Buffer[_0x2d79b9(0x1b5)](_0x409fd6||'',_0x2d79b9(0x1ca)),'utf8');}catch(_0x4120c9){console[_0x2d79b9(0x1d3)]('Error\x20converting\x20filename\x20to\x20UTF-8:',_0x4120c9);}const _0x68e277=_0x536a48&&await User_1['default']['findByPk'](_0x536a48),_0x558096=_0x249254?(0x0,Mustache_1[_0x2d79b9(0x1e6)])(_0x249254,_0x31a3f5,_0x68e277):undefined,_0xe6d0d9=await(0x0,exports[_0x2d79b9(0x1c6)])(_0x409fd6,_0x3455b5,_0x3a04f1),_0x272130={..._0x34c6e9&&{'quoted':{'key':_0x34c6e9['id'],'message':JSON['parse'](_0x34c6e9[_0x2d79b9(0x1db)])?.[_0x2d79b9(0x1eb)]}}},_0xabd58a=await _0x245190['sendMessage'](_0x31a3f5['contact']['number']+'@'+(_0x31a3f5['isGroup']?_0x2d79b9(0x1b1):_0x2d79b9(0x1b2)),{'caption':_0x558096,'fileName':_0x409fd6,..._0xe6d0d9,..._0x272130});return _0x245190[_0x2d79b9(0x1c5)](_0xabd58a),await(0x0,VerifyHandlers_1['verifyMediaMessage'])(_0xabd58a,_0x31a3f5,_0x31a3f5['contact']),_0xabd58a;}catch(_0xe9d363){Sentry['captureException'](_0xe9d363),console['log'](_0xe9d363);throw new AppError_1[(_0x2d79b9(0x1e6))]('ERR_SENDING_WAPP_MSG');}};exports[a575_0x9efd1a(0x1e6)]=SendWhatsAppMedia;function a575_0x3bb6(){const _0xf8f34b=['string','cacheMessage','getMessageOptions','../../models/User','originalname','__createBinding','binary','audio/','../../errors/AppError','audio-record-site','prototype','endsWith','extension','writeFileSync','30bczlAI','error','608760bkaSVj','application/octet-stream','content-type','image/jpeg','writable','startsWith','mimetype','dataJson','getOwnPropertyNames','__importStar','image/png','__setModuleDefault','./VerifyHandlers','get','axios','length','configurable','exec','default','2910znATnY','call','../../helpers/Mustache','video/','message','__importDefault','headers','log','defineProperty','public','data','join','resolve','\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20','arraybuffer','@sentry/node','5520mOpJDC','child_process','2998320omZLQW','search','499368HfJFVo','getTime','5539534SvbqOa','10014507srTdiE','image/webp','decode','audio/ogg','g.us','s.whatsapp.net','mime-types','@ffmpeg-installer/ffmpeg','from','path','toString','__esModule','.ogg','(((.+)+)+)+$','8316600wMIRuH','now','hasOwnProperty','createReadStream','\x20-i\x20\x22','15kjccrc','getOwnPropertyDescriptor','image/jpg','create'];a575_0x3bb6=function(){return _0xf8f34b;};return a575_0x3bb6();}