const a550_0x77ba1=a550_0xf56a;(function(_0x5e4782,_0x430a32){const _0xfaab49=a550_0xf56a,_0x2ae100=_0x5e4782();while(!![]){try{const _0x185592=-parseInt(_0xfaab49(0x220))/0x1+parseInt(_0xfaab49(0x238))/0x2+parseInt(_0xfaab49(0x224))/0x3*(parseInt(_0xfaab49(0x22b))/0x4)+-parseInt(_0xfaab49(0x223))/0x5*(parseInt(_0xfaab49(0x212))/0x6)+-parseInt(_0xfaab49(0x1f5))/0x7+parseInt(_0xfaab49(0x206))/0x8*(parseInt(_0xfaab49(0x1fc))/0x9)+parseInt(_0xfaab49(0x1e1))/0xa;if(_0x185592===_0x430a32)break;else _0x2ae100['push'](_0x2ae100['shift']());}catch(_0x446b71){_0x2ae100['push'](_0x2ae100['shift']());}}}(a550_0x3942,0xf0d4f));const a550_0x1f631e=(function(){let _0x3a5d66=!![];return function(_0x4fc548,_0x4619da){const _0x228ed4=_0x3a5d66?function(){const _0x51f095=a550_0xf56a;if(_0x4619da){const _0x35ffa0=_0x4619da[_0x51f095(0x20f)](_0x4fc548,arguments);return _0x4619da=null,_0x35ffa0;}}:function(){};return _0x3a5d66=![],_0x228ed4;};}()),a550_0x397e4e=a550_0x1f631e(this,function(){const _0x33e815=a550_0xf56a;return a550_0x397e4e[_0x33e815(0x1e6)]()['search'](_0x33e815(0x230))[_0x33e815(0x1e6)]()[_0x33e815(0x211)](a550_0x397e4e)[_0x33e815(0x20a)]('(((.+)+)+)+$');});a550_0x397e4e();'use strict';var __createBinding=this&&this[a550_0x77ba1(0x216)]||(Object['create']?function(_0x1126b0,_0x35e27e,_0x30c751,_0x4b0e15){const _0x262a1c=a550_0x77ba1;if(_0x4b0e15===undefined)_0x4b0e15=_0x30c751;var _0x1e392f=Object[_0x262a1c(0x1fe)](_0x35e27e,_0x30c751);(!_0x1e392f||('get'in _0x1e392f?!_0x35e27e[_0x262a1c(0x222)]:_0x1e392f[_0x262a1c(0x21a)]||_0x1e392f['configurable']))&&(_0x1e392f={'enumerable':!![],'get':function(){return _0x35e27e[_0x30c751];}}),Object[_0x262a1c(0x1fd)](_0x1126b0,_0x4b0e15,_0x1e392f);}:function(_0x30177d,_0x571fee,_0x3bcc2f,_0x5f0759){if(_0x5f0759===undefined)_0x5f0759=_0x3bcc2f;_0x30177d[_0x5f0759]=_0x571fee[_0x3bcc2f];}),__setModuleDefault=this&&this[a550_0x77ba1(0x1d7)]||(Object[a550_0x77ba1(0x236)]?function(_0x379383,_0x3f57c4){const _0x3858a0=a550_0x77ba1;Object[_0x3858a0(0x1fd)](_0x379383,'default',{'enumerable':!![],'value':_0x3f57c4});}:function(_0x382547,_0x4148c6){const _0x470b1b=a550_0x77ba1;_0x382547[_0x470b1b(0x201)]=_0x4148c6;}),__importStar=this&&this[a550_0x77ba1(0x214)]||function(_0x5dd1c0){const _0x4b317c=a550_0x77ba1;if(_0x5dd1c0&&_0x5dd1c0[_0x4b317c(0x222)])return _0x5dd1c0;var _0xe9d94a={};if(_0x5dd1c0!=null){for(var _0x565f64 in _0x5dd1c0)if(_0x565f64!=='default'&&Object['prototype'][_0x4b317c(0x22c)]['call'](_0x5dd1c0,_0x565f64))__createBinding(_0xe9d94a,_0x5dd1c0,_0x565f64);}return __setModuleDefault(_0xe9d94a,_0x5dd1c0),_0xe9d94a;},__importDefault=this&&this[a550_0x77ba1(0x1ea)]||function(_0x5d406f){return _0x5d406f&&_0x5d406f['__esModule']?_0x5d406f:{'default':_0x5d406f};};Object['defineProperty'](exports,a550_0x77ba1(0x222),{'value':!![]}),exports[a550_0x77ba1(0x21e)]=exports[a550_0x77ba1(0x204)]=void 0x0;function a550_0x3942(){const _0x531fc1=['audio','__importDefault','verifyQuotedMessage','remoteJid','ffmpeg-static','filename','application/rtf','includes','video/3gpp','body','\x20-i\x20','originalname','6049323keIkzJ','http','document','application/octet-stream','video/3gpp2','application','mime-types','23499IIjxnd','defineProperty','getOwnPropertyDescriptor','./wbotMessageListener','./public','default','child_process','getTime','getMessageOptions','companyId','1592AGFlVQ','../../helpers/Mustache','string','length','search','number','getBodyMessage','application/vnd.openxmlformats-officedocument.wordprocessingml.document','exec','apply','fluent-ffmpeg','constructor','27846HgfGDm','/company','__importStar','key','__createBinding','application/vnd.ms-powerpoint','image/gif','g.us','writable','log','pop','video','SendWhatsAppMediaFileAddress','text/plain','1753279KuJkop','ERR_SENDING_WAPP_MSG','__esModule','2080iRFzyg','423264ItOYWn','application/vnd.openxmlformats-officedocument.presentationml.presentation','audio/mp3','.mp3','application/msword','update','image/jpeg','8LhzbUE','hasOwnProperty','unlinkSync','isGroup','text','(((.+)+)+)+$','public','lookup','audio-record-site','audio/mp4','body\x20is\x20not\x20a\x20string','create','image/png','2142276pSWiUc','split','sendMessage','contact','__setModuleDefault','trace','path','../../errors/AppError','application/x-7z-compressed','../MessageServices/CreateMessageService','fromMe','stringify','participant','startsWith','36616680HwxcPY','mimetype','join','application/pdf','readFileSync','toString','captureException','application/x-rar-compressed'];a550_0x3942=function(){return _0x531fc1;};return a550_0x3942();}const Sentry=__importStar(require('@sentry/node')),fs_1=__importDefault(require('fs')),child_process_1=require(a550_0x77ba1(0x202)),path_1=__importDefault(require('path')),fluent_ffmpeg_1=__importDefault(require(a550_0x77ba1(0x210))),AppError_1=__importDefault(require(a550_0x77ba1(0x1da))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),mime_types_1=__importDefault(require(a550_0x77ba1(0x1fb))),Mustache_1=__importDefault(require(a550_0x77ba1(0x207))),ffmpeg_static_1=__importDefault(require(a550_0x77ba1(0x1ed))),CreateMessageService_1=__importDefault(require(a550_0x77ba1(0x1dc))),wbotMessageListener_1=require(a550_0x77ba1(0x1ff));fluent_ffmpeg_1[a550_0x77ba1(0x201)]['setFfmpegPath'](ffmpeg_static_1[a550_0x77ba1(0x201)]);const publicFolder=path_1[a550_0x77ba1(0x201)]['resolve'](__dirname,'..','..','..',a550_0x77ba1(0x231)),processAudio=async(_0x198703,_0x196b8e)=>{const _0x3eeec7=a550_0x77ba1,_0x1da6e4=publicFolder+_0x3eeec7(0x213)+_0x196b8e+'/'+new Date()[_0x3eeec7(0x203)]()+_0x3eeec7(0x227);return new Promise((_0x405419,_0x35bae8)=>{const _0x1887bb=_0x3eeec7;(0x0,child_process_1[_0x1887bb(0x20e)])(ffmpeg_static_1[_0x1887bb(0x201)]+'\x20-i\x20'+_0x198703+'\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20'+_0x1da6e4+'\x20-y',(_0x247cf7,_0x40f50e,_0x5d72f3)=>{const _0xf7c187=_0x1887bb;if(_0x247cf7)_0x35bae8(_0x247cf7);fs_1[_0xf7c187(0x201)][_0xf7c187(0x22d)](_0x198703),_0x405419(_0x1da6e4);});});},processAudioFile=async _0x2ac7e0=>{const _0xd320ef=a550_0x77ba1,_0x3a95e7=publicFolder+'/'+new Date()[_0xd320ef(0x203)]()+_0xd320ef(0x227);return new Promise((_0x13fc0e,_0x3c3daa)=>{const _0x28c931=_0xd320ef;(0x0,child_process_1[_0x28c931(0x20e)])(ffmpeg_static_1[_0x28c931(0x201)]+_0x28c931(0x1f3)+_0x2ac7e0+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x3a95e7,(_0x212776,_0x190612,_0x2f362a)=>{const _0x5dd549=_0x28c931;if(_0x212776)_0x3c3daa(_0x212776);fs_1[_0x5dd549(0x201)]['unlinkSync'](_0x2ac7e0),_0x13fc0e(_0x3a95e7);});});},getMessageOptions=async(_0x215f31,_0x507ef8,_0x592945,_0x10d5e0)=>{const _0x23494b=a550_0x77ba1,_0x59bc07=mime_types_1['default'][_0x23494b(0x232)](_0x507ef8),_0x2a8911=_0x59bc07['split']('/')[0x0];try{if(!_0x59bc07)throw new Error('Invalid\x20mimetype');let _0x476d64;if(_0x2a8911===_0x23494b(0x21d))_0x476d64={'video':fs_1[_0x23494b(0x201)][_0x23494b(0x1e5)](_0x507ef8),'caption':_0x592945?_0x592945:'','fileName':_0x215f31};else{if(_0x2a8911===_0x23494b(0x1e9)){const _0x2c1189=!![],_0x4f72ab=await processAudio(_0x507ef8,_0x10d5e0);_0x2c1189?_0x476d64={'audio':fs_1[_0x23494b(0x201)][_0x23494b(0x1e5)](_0x4f72ab),'mimetype':_0x2c1189?_0x23494b(0x234):_0x59bc07,'caption':_0x592945?_0x592945:null,'ptt':!![]}:_0x476d64={'audio':fs_1[_0x23494b(0x201)]['readFileSync'](_0x4f72ab),'mimetype':_0x2c1189?_0x23494b(0x234):_0x59bc07,'caption':_0x592945?_0x592945:null,'ptt':!![]};}else{if(_0x2a8911===_0x23494b(0x1f7))_0x476d64={'document':fs_1['default']['readFileSync'](_0x507ef8),'caption':_0x592945?_0x592945:null,'fileName':_0x215f31,'mimetype':_0x59bc07};else _0x2a8911===_0x23494b(0x1fa)?_0x476d64={'document':fs_1[_0x23494b(0x201)][_0x23494b(0x1e5)](_0x507ef8),'caption':_0x592945?_0x592945:null,'fileName':_0x215f31,'mimetype':_0x59bc07}:_0x476d64={'image':fs_1[_0x23494b(0x201)][_0x23494b(0x1e5)](_0x507ef8),'caption':_0x592945?_0x592945:null};}}return _0x476d64;}catch(_0xff4e1d){return Sentry[_0x23494b(0x1e7)](_0xff4e1d),console[_0x23494b(0x21b)](_0xff4e1d),null;}};exports[a550_0x77ba1(0x204)]=getMessageOptions;function a550_0xf56a(_0x25cbe4,_0x469c17){const _0xbc8496=a550_0x3942();return a550_0xf56a=function(_0x397e4e,_0x1f631e){_0x397e4e=_0x397e4e-0x1d5;let _0x39422f=_0xbc8496[_0x397e4e];return _0x39422f;},a550_0xf56a(_0x25cbe4,_0x469c17);}const SendWhatsAppMedia=async({media:_0x3bdcb0,ticket:_0x55a948,body:_0x3cfde6})=>{const _0x5117e3=a550_0x77ba1;try{const _0xec17a4=await(0x0,GetTicketWbot_1[_0x5117e3(0x201)])(_0x55a948),_0x2f10b5=_0x3bdcb0[_0x5117e3(0x1d9)],_0x5bd17a=_0x3bdcb0[_0x5117e3(0x1e2)][_0x5117e3(0x239)]('/')[0x0];let _0x4047ca;const _0x9c1a43=(0x0,Mustache_1[_0x5117e3(0x201)])(_0x3cfde6,_0x55a948);var _0x1c37e9=_0x3bdcb0[_0x5117e3(0x1ee)];if(_0x5bd17a===_0x5117e3(0x21d))_0x4047ca={'video':fs_1[_0x5117e3(0x201)]['readFileSync'](_0x2f10b5),'caption':_0x9c1a43,'fileName':_0x3bdcb0[_0x5117e3(0x1f4)]};else{if(_0x5bd17a===_0x5117e3(0x1e9)){const _0x5ded2e=_0x3bdcb0['originalname']['includes'](_0x5117e3(0x233));if(_0x5ded2e){const _0x5f5081=await processAudio(_0x3bdcb0['path'],_0x55a948[_0x5117e3(0x205)]);_0x4047ca={'audio':fs_1[_0x5117e3(0x201)][_0x5117e3(0x1e5)](_0x5f5081),'mimetype':_0x5ded2e?_0x5117e3(0x234):_0x3bdcb0['mimetype'],'ptt':!![]},_0x1c37e9=_0x5f5081['split']('/')[_0x5f5081['split']('/')[_0x5117e3(0x209)]-0x1];}else{const _0x5d5891=await processAudioFile(_0x3bdcb0[_0x5117e3(0x1d9)]);_0x4047ca={'audio':fs_1[_0x5117e3(0x201)][_0x5117e3(0x1e5)](_0x5d5891),'mimetype':_0x5ded2e?_0x5117e3(0x234):_0x3bdcb0[_0x5117e3(0x1e2)]},_0x1c37e9=_0x5d5891[_0x5117e3(0x239)]('/')[_0x5d5891[_0x5117e3(0x239)]('/')[_0x5117e3(0x209)]-0x1];}}else{if(_0x5bd17a===_0x5117e3(0x1f7)||_0x5bd17a===_0x5117e3(0x22f))_0x4047ca={'document':fs_1[_0x5117e3(0x201)]['readFileSync'](_0x2f10b5),'caption':_0x9c1a43,'fileName':_0x3bdcb0[_0x5117e3(0x1f4)],'mimetype':_0x3bdcb0['mimetype']};else _0x5bd17a===_0x5117e3(0x1fa)?_0x4047ca={'document':fs_1[_0x5117e3(0x201)]['readFileSync'](_0x2f10b5),'caption':_0x9c1a43,'fileName':_0x3bdcb0[_0x5117e3(0x1f4)],'mimetype':_0x3bdcb0[_0x5117e3(0x1e2)]}:_0x4047ca={'image':fs_1[_0x5117e3(0x201)][_0x5117e3(0x1e5)](_0x2f10b5),'caption':_0x9c1a43};}}var _0x1c28b6=await _0xec17a4[_0x5117e3(0x1d5)](_0x55a948[_0x5117e3(0x1d6)][_0x5117e3(0x20b)]+'@'+(_0x55a948[_0x5117e3(0x22e)]?'g.us':'s.whatsapp.net'),{..._0x4047ca});const _0x36d398=await(0x0,wbotMessageListener_1[_0x5117e3(0x1eb)])(_0x1c28b6),_0xdf0ad2={'id':_0x1c28b6['key']['id'],'ticketId':_0x55a948['id'],'contactId':undefined,'body':_0x3cfde6?(0x0,Mustache_1[_0x5117e3(0x201)])(_0x3cfde6,_0x55a948):(0x0,wbotMessageListener_1[_0x5117e3(0x20c)])(_0x1c28b6),'fromMe':_0x1c28b6[_0x5117e3(0x215)][_0x5117e3(0x1dd)],'read':_0x1c28b6['key'][_0x5117e3(0x1dd)],'mediaUrl':_0x1c37e9,'mediaType':_0x5bd17a,'quotedMsgId':_0x36d398?.['id'],'ack':0x0,'remoteJid':_0x1c28b6[_0x5117e3(0x215)][_0x5117e3(0x1ec)],'participant':_0x1c28b6['key'][_0x5117e3(0x1df)],'dataJson':JSON[_0x5117e3(0x1de)](_0x1c28b6)};return typeof _0xdf0ad2[_0x5117e3(0x1f2)]!=_0x5117e3(0x208)&&console[_0x5117e3(0x1d8)](_0x5117e3(0x235),_0xdf0ad2[_0x5117e3(0x1f2)]),await _0x55a948[_0x5117e3(0x229)]({'lastMessage':_0xdf0ad2[_0x5117e3(0x1f2)]}),await(0x0,CreateMessageService_1['default'])({'messageData':_0xdf0ad2,'ticket':_0x55a948,'companyId':_0x55a948[_0x5117e3(0x205)]}),_0x1c28b6;}catch(_0x1e743c){Sentry[_0x5117e3(0x1e7)](_0x1e743c),console[_0x5117e3(0x1d8)](_0x1e743c);throw new AppError_1['default'](_0x5117e3(0x221));}};exports[a550_0x77ba1(0x201)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x286ec4,_0x2fce95,_0x35cb06)=>{const _0x395340=a550_0x77ba1;try{const _0x52b02a=await(0x0,GetTicketWbot_1[_0x395340(0x201)])(_0x2fce95);_0x286ec4[_0x395340(0x1e0)](_0x395340(0x1f6))&&(_0x286ec4=_0x395340(0x200)+_0x286ec4[_0x395340(0x239)]('/public')[0x1]);const _0x41e7ec=_0x286ec4,_0x37cd9e=getMimeType(_0x286ec4)[_0x395340(0x239)]('/')[0x0];let _0x442258;if(_0x37cd9e==='video')_0x442258={'video':fs_1[_0x395340(0x201)][_0x395340(0x1e5)](_0x41e7ec),'caption':_0x35cb06,'fileName':extractFileName(_0x286ec4)};else{if(_0x37cd9e===_0x395340(0x1e9)){const _0x4850b9=_0x286ec4[_0x395340(0x1f0)](_0x395340(0x233));if(_0x4850b9){const _0x11217a=await processAudio(_0x286ec4,_0x2fce95['companyId']);_0x442258={'audio':fs_1[_0x395340(0x201)][_0x395340(0x1e5)](_0x11217a),'mimetype':_0x4850b9?_0x395340(0x234):getMimeType(_0x286ec4),'ptt':!![]};}else{const _0x219bbb=await processAudioFile(_0x286ec4);_0x442258={'audio':fs_1[_0x395340(0x201)][_0x395340(0x1e5)](_0x219bbb),'mimetype':_0x4850b9?'audio/mp4':getMimeType(_0x286ec4)};}}else{if(_0x37cd9e==='document'||_0x37cd9e===_0x395340(0x22f))_0x442258={'document':fs_1[_0x395340(0x201)][_0x395340(0x1e5)](_0x41e7ec),'caption':_0x35cb06,'fileName':extractFileName(_0x286ec4),'mimetype':getMimeType(_0x286ec4)};else _0x37cd9e===_0x395340(0x1fa)?_0x442258={'document':fs_1[_0x395340(0x201)]['readFileSync'](_0x41e7ec),'caption':_0x35cb06,'fileName':extractFileName(_0x286ec4),'mimetype':getMimeType(_0x286ec4)}:_0x442258={'image':fs_1[_0x395340(0x201)][_0x395340(0x1e5)](_0x41e7ec),'caption':_0x35cb06};}}const _0x3464b3=await _0x52b02a[_0x395340(0x1d5)](_0x2fce95[_0x395340(0x1d6)][_0x395340(0x20b)]+'@'+(_0x2fce95[_0x395340(0x22e)]?_0x395340(0x219):'s.whatsapp.net'),{..._0x442258});return _0x3464b3;}catch(_0x5c7c15){Sentry['captureException'](_0x5c7c15),console[_0x395340(0x21b)](_0x5c7c15);throw new AppError_1[(_0x395340(0x201))]('ERR_SENDING_WAPP_MSG');}};exports[a550_0x77ba1(0x21e)]=SendWhatsAppMediaFileAddress;const extractFileName=_0x5d5f49=>{const _0x30270b=a550_0x77ba1,_0xa4bc0b=_0x5d5f49[_0x30270b(0x239)]('/');return _0xa4bc0b[_0xa4bc0b[_0x30270b(0x209)]-0x1];},extractFilePath=_0x269737=>{const _0x3c4a0e=a550_0x77ba1,_0x58c0ee=_0x269737[_0x3c4a0e(0x239)]('/');return _0x58c0ee[_0x3c4a0e(0x21c)](),_0x58c0ee[_0x3c4a0e(0x1e3)]('/');},getMimeType=_0x19ea60=>{const _0xd2d8bc=a550_0x77ba1,_0xf3ae72=_0x19ea60[_0xd2d8bc(0x239)]('.'),_0x2ec6d4=_0xf3ae72[_0xf3ae72[_0xd2d8bc(0x209)]-0x1],_0x233b87={'jpg':_0xd2d8bc(0x22a),'jpeg':_0xd2d8bc(0x22a),'png':_0xd2d8bc(0x237),'gif':_0xd2d8bc(0x218),'mp4':'video/mp4','mp3':_0xd2d8bc(0x226),'m4a':_0xd2d8bc(0x234),'ogg':'audio/ogg','pdf':_0xd2d8bc(0x1e4),'doc':_0xd2d8bc(0x228),'docx':_0xd2d8bc(0x20d),'xls':'application/vnd.ms-excel','xlsx':'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','ppt':_0xd2d8bc(0x217),'pptx':_0xd2d8bc(0x225),'txt':_0xd2d8bc(0x21f),'rtf':_0xd2d8bc(0x1ef),'csv':'text/csv','html':'text/html','zip':'application/zip','rar':_0xd2d8bc(0x1e8),'7z':_0xd2d8bc(0x1db),'3gp':_0xd2d8bc(0x1f1),'3g2':_0xd2d8bc(0x1f9),'3ga':_0xd2d8bc(0x1f1),'7gp':_0xd2d8bc(0x1f9),'7ga':'video/3gpp','3gpp':'video/3gpp','3gpp2':_0xd2d8bc(0x1f9),'7gpp':_0xd2d8bc(0x1f1),'7gpp2':_0xd2d8bc(0x1f9),'3gpp-tt':_0xd2d8bc(0x1f1),'3gpp2-tt':_0xd2d8bc(0x1f9),'7gpp-tt':_0xd2d8bc(0x1f1),'7gpp2-tt':_0xd2d8bc(0x1f9),'3gpp-rtt':'video/3gpp','3gpp2-rtt':_0xd2d8bc(0x1f9),'7gpp-rtt':_0xd2d8bc(0x1f1),'7gpp2-rtt':_0xd2d8bc(0x1f9),'3gpp-sms':'video/3gpp','3gpp2-sms':_0xd2d8bc(0x1f9),'7gpp-sms':'video/3gpp','7gpp2-sms':'video/3gpp2','pdfa':_0xd2d8bc(0x1e4),'x-pdf':_0xd2d8bc(0x1e4)};if(_0x233b87[_0x2ec6d4])return _0x233b87[_0x2ec6d4];return _0xd2d8bc(0x1f8);};