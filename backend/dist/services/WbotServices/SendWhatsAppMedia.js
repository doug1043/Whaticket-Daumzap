'use strict';const a577_0x7438ce=a577_0x3f1a;function a577_0x497a(){const _0x4c5b97=['startsWith','create','endsWith','hasOwnProperty','9780176mPplLq','number','getMessageOptions','length','writable','parse','21dTFGJK','public','constructor','audio-record-site','captureException','cacheMessage','video/','isGroup','179820hbWuWK','ERR_SENDING_WAPP_MSG','decode','mime-types','/dist','1mmprzj','./VerifyHandlers','2840486UYGADi','9483198EzBVyd','contact','error','getTime','513NZAIkU','verifyMediaMessage','search','__importStar','headers','call','originalname','configurable','8454975RexGfY','log','lookup','resolve','from','190860UTkedD','findByPk','content-type','toString','dataJson','path','writeFileSync','7aNRUgm','utf8','image/webp','__importDefault','image/jpeg','includes','getOwnPropertyDescriptor','g.us','binary','audio/ogg;\x20codecs=opus','child_process','__createBinding','exec','image/jpg','default','iconv-lite','string','image/png','__esModule','audio/','defineProperty','58673747jltUAm','@sentry/node','GET','createReadStream','Error\x20converting\x20filename\x20to\x20UTF-8:','(((.+)+)+)+$','now'];a577_0x497a=function(){return _0x4c5b97;};return a577_0x497a();}(function(_0x3728f5,_0x27b7ff){const _0x1e1eea=a577_0x3f1a,_0x2ea767=_0x3728f5();while(!![]){try{const _0x3b903b=-parseInt(_0x1e1eea(0x17c))/0x1*(-parseInt(_0x1e1eea(0x17e))/0x2)+-parseInt(_0x1e1eea(0x16f))/0x3*(parseInt(_0x1e1eea(0x177))/0x4)+-parseInt(_0x1e1eea(0x18b))/0x5+parseInt(_0x1e1eea(0x17f))/0x6*(-parseInt(_0x1e1eea(0x149))/0x7)+-parseInt(_0x1e1eea(0x169))/0x8+parseInt(_0x1e1eea(0x183))/0x9*(-parseInt(_0x1e1eea(0x190))/0xa)+parseInt(_0x1e1eea(0x15e))/0xb;if(_0x3b903b===_0x27b7ff)break;else _0x2ea767['push'](_0x2ea767['shift']());}catch(_0x2af6d8){_0x2ea767['push'](_0x2ea767['shift']());}}}(a577_0x497a,0xd15ef));var __createBinding=this&&this[a577_0x7438ce(0x154)]||(Object['create']?function(_0x1a5b08,_0x46b973,_0x3472e7,_0x31b830){const _0x265e94=a577_0x7438ce;if(_0x31b830===undefined)_0x31b830=_0x3472e7;var _0x197cb6=Object[_0x265e94(0x14f)](_0x46b973,_0x3472e7);(!_0x197cb6||('get'in _0x197cb6?!_0x46b973[_0x265e94(0x15b)]:_0x197cb6[_0x265e94(0x16d)]||_0x197cb6[_0x265e94(0x18a)]))&&(_0x197cb6={'enumerable':!![],'get':function(){return _0x46b973[_0x3472e7];}}),Object[_0x265e94(0x15d)](_0x1a5b08,_0x31b830,_0x197cb6);}:function(_0x23e818,_0x2dc824,_0x5dc8c4,_0x2d5573){if(_0x2d5573===undefined)_0x2d5573=_0x5dc8c4;_0x23e818[_0x2d5573]=_0x2dc824[_0x5dc8c4];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a577_0x7438ce(0x166)]?function(_0x270f3a,_0x4eccb4){const _0x587b06=a577_0x7438ce;Object['defineProperty'](_0x270f3a,_0x587b06(0x157),{'enumerable':!![],'value':_0x4eccb4});}:function(_0x58ef4a,_0x17e47c){_0x58ef4a['default']=_0x17e47c;}),__importStar=this&&this[a577_0x7438ce(0x186)]||(function(){const _0x3514a8=(function(){let _0x404791=!![];return function(_0x4b1b58,_0x208a56){const _0x2eb130=_0x404791?function(){if(_0x208a56){const _0x4de7f6=_0x208a56['apply'](_0x4b1b58,arguments);return _0x208a56=null,_0x4de7f6;}}:function(){};return _0x404791=![],_0x2eb130;};}()),_0x1de5c2=_0x3514a8(this,function(){const _0x26cf4f=a577_0x3f1a;return _0x1de5c2['toString']()[_0x26cf4f(0x185)](_0x26cf4f(0x163))[_0x26cf4f(0x193)]()[_0x26cf4f(0x171)](_0x1de5c2)[_0x26cf4f(0x185)](_0x26cf4f(0x163));});_0x1de5c2();var _0x10c5b0=function(_0x43b38b){return _0x10c5b0=Object['getOwnPropertyNames']||function(_0x7c94b7){const _0x5d23bd=a577_0x3f1a;var _0x4716c3=[];for(var _0x413ced in _0x7c94b7)if(Object['prototype'][_0x5d23bd(0x168)][_0x5d23bd(0x188)](_0x7c94b7,_0x413ced))_0x4716c3[_0x4716c3[_0x5d23bd(0x16c)]]=_0x413ced;return _0x4716c3;},_0x10c5b0(_0x43b38b);};return function(_0x1c18dd){const _0x339485=a577_0x3f1a;if(_0x1c18dd&&_0x1c18dd['__esModule'])return _0x1c18dd;var _0x5cdbdd={};if(_0x1c18dd!=null){for(var _0x5a37f4=_0x10c5b0(_0x1c18dd),_0x22cfc4=0x0;_0x22cfc4<_0x5a37f4[_0x339485(0x16c)];_0x22cfc4++)if(_0x5a37f4[_0x22cfc4]!==_0x339485(0x157))__createBinding(_0x5cdbdd,_0x1c18dd,_0x5a37f4[_0x22cfc4]);}return __setModuleDefault(_0x5cdbdd,_0x1c18dd),_0x5cdbdd;};}()),__importDefault=this&&this[a577_0x7438ce(0x14c)]||function(_0x3cf1c8){const _0x5b594d=a577_0x7438ce;return _0x3cf1c8&&_0x3cf1c8[_0x5b594d(0x15b)]?_0x3cf1c8:{'default':_0x3cf1c8};};function a577_0x3f1a(_0x11cecc,_0x5e7811){const _0x3d45b3=a577_0x497a();return a577_0x3f1a=function(_0x28af78,_0x52cb08){_0x28af78=_0x28af78-0x149;let _0x497a55=_0x3d45b3[_0x28af78];return _0x497a55;},a577_0x3f1a(_0x11cecc,_0x5e7811);}Object[a577_0x7438ce(0x15d)](exports,a577_0x7438ce(0x15b),{'value':!![]}),exports[a577_0x7438ce(0x16b)]=void 0x0;const Sentry=__importStar(require(a577_0x7438ce(0x15f))),fs_1=__importDefault(require('fs')),child_process_1=require(a577_0x7438ce(0x153)),path_1=__importDefault(require(a577_0x7438ce(0x195))),ffmpeg_1=__importDefault(require('@ffmpeg-installer/ffmpeg')),mime_types_1=__importDefault(require(a577_0x7438ce(0x17a))),iconv_lite_1=__importDefault(require(a577_0x7438ce(0x158))),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),VerifyHandlers_1=require(a577_0x7438ce(0x17d)),axios_1=__importDefault(require('axios')),Mustache_1=__importDefault(require('../../helpers/Mustache')),User_1=__importDefault(require('../../models/User')),publicFolder=__dirname[a577_0x7438ce(0x167)](a577_0x7438ce(0x17b))?path_1[a577_0x7438ce(0x157)][a577_0x7438ce(0x18e)](__dirname,'..',a577_0x7438ce(0x170)):path_1[a577_0x7438ce(0x157)][a577_0x7438ce(0x18e)](__dirname,'..','..','..',a577_0x7438ce(0x170)),supportedImages=[a577_0x7438ce(0x15a),a577_0x7438ce(0x156),a577_0x7438ce(0x14d),a577_0x7438ce(0x14b)],processRecordedAudio=async _0x12b3b5=>{const _0x5a9a7a=a577_0x7438ce,_0x5e4ff3=publicFolder+'/'+new Date()[_0x5a9a7a(0x182)]()+'.ogg';return new Promise((_0x364f91,_0x145f94)=>{const _0x1ccbf4=_0x5a9a7a;(0x0,child_process_1[_0x1ccbf4(0x155)])(ffmpeg_1['default'][_0x1ccbf4(0x195)]+'\x20-i\x20\x22'+_0x12b3b5+'\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20'+_0x5e4ff3,(_0x48aeb7,_0x1ca1b1,_0x1d0c86)=>{const _0x58693d=_0x1ccbf4;if(_0x48aeb7)_0x145f94(_0x48aeb7);_0x364f91(fs_1[_0x58693d(0x157)][_0x58693d(0x161)](_0x5e4ff3));});});},getMessageOptions=async(_0x5cf40b,_0x1748bf,_0x47c34d)=>{const _0x52b15e=a577_0x7438ce;_0x47c34d=_0x47c34d||mime_types_1['default'][_0x52b15e(0x18d)](_0x1748bf)||'application/octet-stream';try{let _0x27364c;if(_0x47c34d[_0x52b15e(0x165)](_0x52b15e(0x175)))_0x27364c={'video':{'stream':fs_1[_0x52b15e(0x157)][_0x52b15e(0x161)](_0x1748bf)}};else{if(_0x47c34d==='audio/ogg')_0x27364c={'audio':{'stream':fs_1[_0x52b15e(0x157)][_0x52b15e(0x161)](_0x1748bf)},'mimetype':_0x52b15e(0x152),'ptt':!![]};else{if(_0x47c34d[_0x52b15e(0x165)](_0x52b15e(0x15c))){const _0x4ef944=_0x5cf40b[_0x52b15e(0x14e)](_0x52b15e(0x172));_0x27364c={'audio':{'stream':_0x4ef944?await processRecordedAudio(_0x1748bf):fs_1['default'][_0x52b15e(0x161)](_0x1748bf)},'mimetype':_0x4ef944?_0x52b15e(0x152):_0x47c34d,'ptt':_0x4ef944};}else supportedImages[_0x52b15e(0x14e)](_0x47c34d)?_0x27364c={'image':{'stream':fs_1[_0x52b15e(0x157)][_0x52b15e(0x161)](_0x1748bf)}}:_0x27364c={'document':{'stream':fs_1['default']['createReadStream'](_0x1748bf)},'mimetype':_0x47c34d};}}return _0x27364c;}catch(_0x5d8a41){return Sentry[_0x52b15e(0x173)](_0x5d8a41),console[_0x52b15e(0x18c)](_0x5d8a41),null;}};exports[a577_0x7438ce(0x16b)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x41b410,ticket:_0x3ee56a,body:_0x33da01,userId:_0x538f7f,quotedMsg:_0x6458e9})=>{const _0x23350a=a577_0x7438ce;try{const _0x4429f4=await(0x0,GetTicketWbot_1['default'])(_0x3ee56a);let _0x1ef81b,_0x2d91f5,_0xbc6a72;if(typeof _0x41b410===_0x23350a(0x159)){const _0xfdd46d=await(0x0,axios_1[_0x23350a(0x157)])({'url':_0x41b410,'method':_0x23350a(0x160),'responseType':'arraybuffer'});_0x2d91f5=Date[_0x23350a(0x164)]()+'.'+mime_types_1[_0x23350a(0x157)]['extension'](_0xfdd46d[_0x23350a(0x187)][_0x23350a(0x192)]),_0x1ef81b=path_1['default']['join'](publicFolder,_0x2d91f5),fs_1[_0x23350a(0x157)][_0x23350a(0x196)](_0x1ef81b,_0xfdd46d['data']),_0xbc6a72=_0xfdd46d[_0x23350a(0x187)][_0x23350a(0x192)];}else _0x1ef81b=_0x41b410[_0x23350a(0x195)],_0x2d91f5=_0x41b410[_0x23350a(0x189)],_0xbc6a72=_0x41b410['mimetype'];try{_0x2d91f5=iconv_lite_1[_0x23350a(0x157)][_0x23350a(0x179)](Buffer[_0x23350a(0x18f)](_0x2d91f5||'',_0x23350a(0x151)),_0x23350a(0x14a));}catch(_0x28ffa5){console[_0x23350a(0x181)](_0x23350a(0x162),_0x28ffa5);}const _0x4d32d8=_0x538f7f&&await User_1['default'][_0x23350a(0x191)](_0x538f7f),_0x247c5e=_0x33da01?(0x0,Mustache_1['default'])(_0x33da01,_0x3ee56a,_0x4d32d8):undefined,_0x3c4248=await(0x0,exports['getMessageOptions'])(_0x2d91f5,_0x1ef81b,_0xbc6a72),_0xe727b6={..._0x6458e9&&{'quoted':{'key':_0x6458e9['id'],'message':JSON[_0x23350a(0x16e)](_0x6458e9[_0x23350a(0x194)])?.['message']}}},_0x5c8d70=await _0x4429f4['sendMessage'](_0x3ee56a[_0x23350a(0x180)][_0x23350a(0x16a)]+'@'+(_0x3ee56a[_0x23350a(0x176)]?_0x23350a(0x150):'s.whatsapp.net'),{'caption':_0x247c5e,'fileName':_0x2d91f5,..._0x3c4248,..._0xe727b6});return _0x4429f4[_0x23350a(0x174)](_0x5c8d70),await(0x0,VerifyHandlers_1[_0x23350a(0x184)])(_0x5c8d70,_0x3ee56a,_0x3ee56a[_0x23350a(0x180)]),_0x5c8d70;}catch(_0x32016a){Sentry['captureException'](_0x32016a),console[_0x23350a(0x18c)](_0x32016a);throw new AppError_1[(_0x23350a(0x157))](_0x23350a(0x178));}};exports[a577_0x7438ce(0x157)]=SendWhatsAppMedia;