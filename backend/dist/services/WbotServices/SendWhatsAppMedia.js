const a548_0x40b80a=a548_0x347f;(function(_0x59f0f1,_0x30103a){const _0x350618=a548_0x347f,_0x1824c3=_0x59f0f1();while(!![]){try{const _0x24fd4a=parseInt(_0x350618(0x184))/0x1+parseInt(_0x350618(0x1d3))/0x2*(-parseInt(_0x350618(0x17c))/0x3)+parseInt(_0x350618(0x17e))/0x4+-parseInt(_0x350618(0x19a))/0x5*(-parseInt(_0x350618(0x18b))/0x6)+parseInt(_0x350618(0x1af))/0x7*(-parseInt(_0x350618(0x195))/0x8)+parseInt(_0x350618(0x1a6))/0x9+-parseInt(_0x350618(0x19d))/0xa;if(_0x24fd4a===_0x30103a)break;else _0x1824c3['push'](_0x1824c3['shift']());}catch(_0x419d92){_0x1824c3['push'](_0x1824c3['shift']());}}}(a548_0x33a2,0x821a6));function a548_0x347f(_0x537a87,_0x6d5922){const _0x1cde24=a548_0x33a2();return a548_0x347f=function(_0x30aed4,_0x38787a){_0x30aed4=_0x30aed4-0x170;let _0x33a23b=_0x1cde24[_0x30aed4];return _0x33a23b;},a548_0x347f(_0x537a87,_0x6d5922);}const a548_0x38787a=(function(){let _0x51f989=!![];return function(_0x59b418,_0x3d2c85){const _0x2fcd67=_0x51f989?function(){const _0x43a15c=a548_0x347f;if(_0x3d2c85){const _0x10ee2d=_0x3d2c85[_0x43a15c(0x18e)](_0x59b418,arguments);return _0x3d2c85=null,_0x10ee2d;}}:function(){};return _0x51f989=![],_0x2fcd67;};}()),a548_0x30aed4=a548_0x38787a(this,function(){const _0x5161d1=a548_0x347f;return a548_0x30aed4[_0x5161d1(0x181)]()[_0x5161d1(0x1cd)](_0x5161d1(0x1cf))[_0x5161d1(0x181)]()[_0x5161d1(0x1bf)](a548_0x30aed4)[_0x5161d1(0x1cd)]('(((.+)+)+)+$');});a548_0x30aed4();'use strict';var __createBinding=this&&this[a548_0x40b80a(0x18c)]||(Object['create']?function(_0x2900c4,_0x16b74c,_0x133cfc,_0x20945a){const _0x3b71a6=a548_0x40b80a;if(_0x20945a===undefined)_0x20945a=_0x133cfc;var _0x5bc755=Object[_0x3b71a6(0x182)](_0x16b74c,_0x133cfc);(!_0x5bc755||(_0x3b71a6(0x177)in _0x5bc755?!_0x16b74c[_0x3b71a6(0x1bb)]:_0x5bc755['writable']||_0x5bc755[_0x3b71a6(0x1d1)]))&&(_0x5bc755={'enumerable':!![],'get':function(){return _0x16b74c[_0x133cfc];}}),Object[_0x3b71a6(0x1a7)](_0x2900c4,_0x20945a,_0x5bc755);}:function(_0x315930,_0x55d414,_0x3d772a,_0xba2a34){if(_0xba2a34===undefined)_0xba2a34=_0x3d772a;_0x315930[_0xba2a34]=_0x55d414[_0x3d772a];}),__setModuleDefault=this&&this[a548_0x40b80a(0x192)]||(Object[a548_0x40b80a(0x1a2)]?function(_0x9dfc83,_0x39f413){const _0x10d2ad=a548_0x40b80a;Object[_0x10d2ad(0x1a7)](_0x9dfc83,_0x10d2ad(0x1b1),{'enumerable':!![],'value':_0x39f413});}:function(_0x5d8b92,_0x19b8e4){const _0x52a139=a548_0x40b80a;_0x5d8b92[_0x52a139(0x1b1)]=_0x19b8e4;}),__importStar=this&&this[a548_0x40b80a(0x1c1)]||function(_0x3f4f4b){const _0x2ebbc9=a548_0x40b80a;if(_0x3f4f4b&&_0x3f4f4b[_0x2ebbc9(0x1bb)])return _0x3f4f4b;var _0x432666={};if(_0x3f4f4b!=null){for(var _0x5df3ce in _0x3f4f4b)if(_0x5df3ce!=='default'&&Object[_0x2ebbc9(0x180)][_0x2ebbc9(0x186)][_0x2ebbc9(0x198)](_0x3f4f4b,_0x5df3ce))__createBinding(_0x432666,_0x3f4f4b,_0x5df3ce);}return __setModuleDefault(_0x432666,_0x3f4f4b),_0x432666;},__importDefault=this&&this[a548_0x40b80a(0x1d2)]||function(_0x4bcf23){const _0x34286b=a548_0x40b80a;return _0x4bcf23&&_0x4bcf23[_0x34286b(0x1bb)]?_0x4bcf23:{'default':_0x4bcf23};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a548_0x40b80a(0x18f)]=exports[a548_0x40b80a(0x1ce)]=void 0x0;const Sentry=__importStar(require(a548_0x40b80a(0x171))),fs_1=__importDefault(require('fs')),child_process_1=require('child_process'),path_1=__importDefault(require(a548_0x40b80a(0x1c0))),fluent_ffmpeg_1=__importDefault(require(a548_0x40b80a(0x1ca))),AppError_1=__importDefault(require(a548_0x40b80a(0x185))),GetTicketWbot_1=__importDefault(require(a548_0x40b80a(0x1b4))),mime_types_1=__importDefault(require('mime-types')),Mustache_1=__importDefault(require('../../helpers/Mustache')),ffmpeg_static_1=__importDefault(require('ffmpeg-static')),CreateMessageService_1=__importDefault(require(a548_0x40b80a(0x1b8))),wbotMessageListener_1=require(a548_0x40b80a(0x188));fluent_ffmpeg_1[a548_0x40b80a(0x1b1)][a548_0x40b80a(0x1a5)](ffmpeg_static_1[a548_0x40b80a(0x1b1)]);const publicFolder=path_1[a548_0x40b80a(0x1b1)][a548_0x40b80a(0x1bd)](__dirname,'..','..','..',a548_0x40b80a(0x17f)),processAudio=async(_0x21ae1a,_0x2b8932)=>{const _0x1fe8c1=a548_0x40b80a,_0x43bef9=publicFolder+_0x1fe8c1(0x1d4)+_0x2b8932+'/'+new Date()[_0x1fe8c1(0x189)]()+_0x1fe8c1(0x17d);return new Promise((_0x520fd0,_0x3e6330)=>{const _0x4dd564=_0x1fe8c1;(0x0,child_process_1[_0x4dd564(0x172)])(ffmpeg_static_1[_0x4dd564(0x1b1)]+_0x4dd564(0x1a0)+_0x21ae1a+'\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20'+_0x43bef9+_0x4dd564(0x1b7),(_0x409929,_0x46f1b7,_0xdc1866)=>{const _0x5889c3=_0x4dd564;if(_0x409929)_0x3e6330(_0x409929);fs_1[_0x5889c3(0x1b1)][_0x5889c3(0x1b3)](_0x21ae1a),_0x520fd0(_0x43bef9);});});},processAudioFile=async _0x2f4135=>{const _0x1e59b5=a548_0x40b80a,_0x22016f=publicFolder+'/'+new Date()[_0x1e59b5(0x189)]()+_0x1e59b5(0x17d);return new Promise((_0x510a26,_0x7ab932)=>{const _0x581fac=_0x1e59b5;(0x0,child_process_1[_0x581fac(0x172)])(ffmpeg_static_1[_0x581fac(0x1b1)]+_0x581fac(0x1a0)+_0x2f4135+_0x581fac(0x1c9)+_0x22016f,(_0x5d0a03,_0x30275e,_0x908311)=>{if(_0x5d0a03)_0x7ab932(_0x5d0a03);fs_1['default']['unlinkSync'](_0x2f4135),_0x510a26(_0x22016f);});});},getMessageOptions=async(_0x1ce2fa,_0x5a4406,_0x448a96,_0x376d66)=>{const _0x921937=a548_0x40b80a,_0x242015=mime_types_1[_0x921937(0x1b1)][_0x921937(0x1ba)](_0x5a4406),_0x42bd39=_0x242015['split']('/')[0x0];try{if(!_0x242015)throw new Error(_0x921937(0x1bc));let _0xbe3fd5;if(_0x42bd39===_0x921937(0x19e))_0xbe3fd5={'video':fs_1[_0x921937(0x1b1)][_0x921937(0x1a1)](_0x5a4406),'caption':_0x448a96?_0x448a96:'','fileName':_0x1ce2fa};else{if(_0x42bd39==='audio'){const _0x4b18c7=!![],_0x7e4ebf=await processAudio(_0x5a4406,_0x376d66);_0x4b18c7?_0xbe3fd5={'audio':fs_1[_0x921937(0x1b1)][_0x921937(0x1a1)](_0x7e4ebf),'mimetype':_0x4b18c7?_0x921937(0x1b0):_0x242015,'caption':_0x448a96?_0x448a96:null,'ptt':!![]}:_0xbe3fd5={'audio':fs_1['default'][_0x921937(0x1a1)](_0x7e4ebf),'mimetype':_0x4b18c7?_0x921937(0x1b0):_0x242015,'caption':_0x448a96?_0x448a96:null,'ptt':!![]};}else{if(_0x42bd39===_0x921937(0x194))_0xbe3fd5={'document':fs_1[_0x921937(0x1b1)]['readFileSync'](_0x5a4406),'caption':_0x448a96?_0x448a96:null,'fileName':_0x1ce2fa,'mimetype':_0x242015};else _0x42bd39===_0x921937(0x1a9)?_0xbe3fd5={'document':fs_1[_0x921937(0x1b1)][_0x921937(0x1a1)](_0x5a4406),'caption':_0x448a96?_0x448a96:null,'fileName':_0x1ce2fa,'mimetype':_0x242015}:_0xbe3fd5={'image':fs_1[_0x921937(0x1b1)][_0x921937(0x1a1)](_0x5a4406),'caption':_0x448a96?_0x448a96:null};}}return _0xbe3fd5;}catch(_0x27ebbc){return Sentry[_0x921937(0x19c)](_0x27ebbc),console[_0x921937(0x191)](_0x27ebbc),null;}};exports[a548_0x40b80a(0x1ce)]=getMessageOptions;function a548_0x33a2(){const _0x2ca089=['\x20-i\x20','readFileSync','create','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','filename','setFfmpegPath','6296499mITOaQ','defineProperty','application/x-7z-compressed','application','update','application/zip','application/rtf','video/3gpp','sendMessage','595GOMCdp','audio/mp4','default','audio/mp3','unlinkSync','../../helpers/GetTicketWbot','body','application/octet-stream','\x20-y','../MessageServices/CreateMessageService','originalname','lookup','__esModule','Invalid\x20mimetype','resolve','contact','constructor','path','__importStar','audio-record-site','video/mp4','ERR_SENDING_WAPP_MSG','video/3gpp2','text/csv','length','/public','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','fluent-ffmpeg','text/html','image/png','search','getMessageOptions','(((.+)+)+)+$','mimetype','configurable','__importDefault','156148pLmEhM','/company','application/x-rar-compressed','pop','@sentry/node','exec','body\x20is\x20not\x20a\x20string','text','application/vnd.ms-powerpoint','number','get','participant','audio','image/gif','trace','15BHIVFL','.mp3','4052988zGEbRk','public','prototype','toString','getOwnPropertyDescriptor','application/vnd.openxmlformats-officedocument.wordprocessingml.document','478072YzyOux','../../errors/AppError','hasOwnProperty','image/jpeg','./wbotMessageListener','getTime','split','159468KpDESC','__createBinding','application/pdf','apply','SendWhatsAppMediaFileAddress','text/plain','log','__setModuleDefault','application/vnd.openxmlformats-officedocument.presentationml.presentation','document','79328LDIlCY','startsWith','key','call','companyId','155ZtBPeY','getBodyMessage','captureException','12487160xdwYCM','video','./public'];a548_0x33a2=function(){return _0x2ca089;};return a548_0x33a2();}const SendWhatsAppMedia=async({media:_0x4cdfcc,ticket:_0x55b0e1,body:_0x535aed})=>{const _0x5d2670=a548_0x40b80a;try{const _0x98a3c1=await(0x0,GetTicketWbot_1[_0x5d2670(0x1b1)])(_0x55b0e1),_0x53f4a9=_0x4cdfcc[_0x5d2670(0x1c0)],_0x15149d=_0x4cdfcc[_0x5d2670(0x1d0)][_0x5d2670(0x18a)]('/')[0x0];let _0x1bf2fb;const _0xb52453=(0x0,Mustache_1[_0x5d2670(0x1b1)])(_0x535aed,_0x55b0e1);var _0x268ce0=_0x4cdfcc[_0x5d2670(0x1a4)];if(_0x15149d===_0x5d2670(0x19e))_0x1bf2fb={'video':fs_1[_0x5d2670(0x1b1)]['readFileSync'](_0x53f4a9),'caption':_0xb52453,'fileName':_0x4cdfcc[_0x5d2670(0x1b9)]};else{if(_0x15149d===_0x5d2670(0x179)){const _0x2bcbf3=_0x4cdfcc[_0x5d2670(0x1b9)]['includes']('audio-record-site');if(_0x2bcbf3){const _0x2618ac=await processAudio(_0x4cdfcc[_0x5d2670(0x1c0)],_0x55b0e1['companyId']);_0x1bf2fb={'audio':fs_1[_0x5d2670(0x1b1)][_0x5d2670(0x1a1)](_0x2618ac),'mimetype':_0x2bcbf3?'audio/mp4':_0x4cdfcc[_0x5d2670(0x1d0)],'ptt':!![]},_0x268ce0=_0x2618ac[_0x5d2670(0x18a)]('/')[_0x2618ac[_0x5d2670(0x18a)]('/')[_0x5d2670(0x1c7)]-0x1];}else{const _0x25b88d=await processAudioFile(_0x4cdfcc[_0x5d2670(0x1c0)]);_0x1bf2fb={'audio':fs_1[_0x5d2670(0x1b1)][_0x5d2670(0x1a1)](_0x25b88d),'mimetype':_0x2bcbf3?_0x5d2670(0x1b0):_0x4cdfcc[_0x5d2670(0x1d0)]},_0x268ce0=_0x25b88d[_0x5d2670(0x18a)]('/')[_0x25b88d[_0x5d2670(0x18a)]('/')[_0x5d2670(0x1c7)]-0x1];}}else{if(_0x15149d===_0x5d2670(0x194)||_0x15149d==='text')_0x1bf2fb={'document':fs_1[_0x5d2670(0x1b1)][_0x5d2670(0x1a1)](_0x53f4a9),'caption':_0xb52453,'fileName':_0x4cdfcc[_0x5d2670(0x1b9)],'mimetype':_0x4cdfcc[_0x5d2670(0x1d0)]};else _0x15149d===_0x5d2670(0x1a9)?_0x1bf2fb={'document':fs_1[_0x5d2670(0x1b1)]['readFileSync'](_0x53f4a9),'caption':_0xb52453,'fileName':_0x4cdfcc[_0x5d2670(0x1b9)],'mimetype':_0x4cdfcc[_0x5d2670(0x1d0)]}:_0x1bf2fb={'image':fs_1[_0x5d2670(0x1b1)][_0x5d2670(0x1a1)](_0x53f4a9),'caption':_0xb52453};}}var _0x156fca=await _0x98a3c1[_0x5d2670(0x1ae)](_0x55b0e1[_0x5d2670(0x1be)][_0x5d2670(0x176)]+'@'+(_0x55b0e1['isGroup']?'g.us':'s.whatsapp.net'),{..._0x1bf2fb});const _0x2cd10f=await(0x0,wbotMessageListener_1['verifyQuotedMessage'])(_0x156fca),_0x4687af={'id':_0x156fca[_0x5d2670(0x197)]['id'],'ticketId':_0x55b0e1['id'],'contactId':undefined,'body':_0x535aed?(0x0,Mustache_1[_0x5d2670(0x1b1)])(_0x535aed,_0x55b0e1):(0x0,wbotMessageListener_1[_0x5d2670(0x19b)])(_0x156fca),'fromMe':_0x156fca['key']['fromMe'],'read':_0x156fca[_0x5d2670(0x197)]['fromMe'],'mediaUrl':_0x268ce0,'mediaType':_0x15149d,'quotedMsgId':_0x2cd10f?.['id'],'ack':0x0,'remoteJid':_0x156fca[_0x5d2670(0x197)]['remoteJid'],'participant':_0x156fca[_0x5d2670(0x197)][_0x5d2670(0x178)],'dataJson':JSON['stringify'](_0x156fca)};return typeof _0x4687af[_0x5d2670(0x1b5)]!='string'&&console[_0x5d2670(0x17b)](_0x5d2670(0x173),_0x4687af['body']),await _0x55b0e1[_0x5d2670(0x1aa)]({'lastMessage':_0x4687af[_0x5d2670(0x1b5)]}),await(0x0,CreateMessageService_1[_0x5d2670(0x1b1)])({'messageData':_0x4687af,'ticket':_0x55b0e1,'companyId':_0x55b0e1[_0x5d2670(0x199)]}),_0x156fca;}catch(_0x23520a){Sentry[_0x5d2670(0x19c)](_0x23520a),console[_0x5d2670(0x17b)](_0x23520a);throw new AppError_1[(_0x5d2670(0x1b1))](_0x5d2670(0x1c4));}};exports['default']=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x5adc85,_0x3c59f1,_0x181690)=>{const _0x52d602=a548_0x40b80a;try{const _0x4d723c=await(0x0,GetTicketWbot_1['default'])(_0x3c59f1);_0x5adc85[_0x52d602(0x196)]('http')&&(_0x5adc85=_0x52d602(0x19f)+_0x5adc85[_0x52d602(0x18a)](_0x52d602(0x1c8))[0x1]);const _0x385928=_0x5adc85,_0x170680=getMimeType(_0x5adc85)[_0x52d602(0x18a)]('/')[0x0];let _0x5d9d5c;if(_0x170680===_0x52d602(0x19e))_0x5d9d5c={'video':fs_1[_0x52d602(0x1b1)]['readFileSync'](_0x385928),'caption':_0x181690,'fileName':extractFileName(_0x5adc85)};else{if(_0x170680==='audio'){const _0x20cd0c=_0x5adc85['includes'](_0x52d602(0x1c2));if(_0x20cd0c){const _0x105a0f=await processAudio(_0x5adc85,_0x3c59f1[_0x52d602(0x199)]);_0x5d9d5c={'audio':fs_1[_0x52d602(0x1b1)]['readFileSync'](_0x105a0f),'mimetype':_0x20cd0c?_0x52d602(0x1b0):getMimeType(_0x5adc85),'ptt':!![]};}else{const _0x46163d=await processAudioFile(_0x5adc85);_0x5d9d5c={'audio':fs_1['default'][_0x52d602(0x1a1)](_0x46163d),'mimetype':_0x20cd0c?_0x52d602(0x1b0):getMimeType(_0x5adc85)};}}else{if(_0x170680===_0x52d602(0x194)||_0x170680===_0x52d602(0x174))_0x5d9d5c={'document':fs_1[_0x52d602(0x1b1)][_0x52d602(0x1a1)](_0x385928),'caption':_0x181690,'fileName':extractFileName(_0x5adc85),'mimetype':getMimeType(_0x5adc85)};else _0x170680==='application'?_0x5d9d5c={'document':fs_1[_0x52d602(0x1b1)]['readFileSync'](_0x385928),'caption':_0x181690,'fileName':extractFileName(_0x5adc85),'mimetype':getMimeType(_0x5adc85)}:_0x5d9d5c={'image':fs_1[_0x52d602(0x1b1)][_0x52d602(0x1a1)](_0x385928),'caption':_0x181690};}}const _0x1521cd=await _0x4d723c[_0x52d602(0x1ae)](_0x3c59f1['contact']['number']+'@'+(_0x3c59f1['isGroup']?'g.us':'s.whatsapp.net'),{..._0x5d9d5c});return _0x1521cd;}catch(_0x51f8e4){Sentry[_0x52d602(0x19c)](_0x51f8e4),console[_0x52d602(0x191)](_0x51f8e4);throw new AppError_1[(_0x52d602(0x1b1))]('ERR_SENDING_WAPP_MSG');}};exports['SendWhatsAppMediaFileAddress']=SendWhatsAppMediaFileAddress;const extractFileName=_0x51ade=>{const _0x247827=a548_0x40b80a,_0x3291c0=_0x51ade[_0x247827(0x18a)]('/');return _0x3291c0[_0x3291c0[_0x247827(0x1c7)]-0x1];},extractFilePath=_0x7eee90=>{const _0x5961f5=a548_0x40b80a,_0x57bde4=_0x7eee90[_0x5961f5(0x18a)]('/');return _0x57bde4[_0x5961f5(0x170)](),_0x57bde4['join']('/');},getMimeType=_0x1850f7=>{const _0xfe56e7=a548_0x40b80a,_0x543b02=_0x1850f7['split']('.'),_0xcaa04f=_0x543b02[_0x543b02[_0xfe56e7(0x1c7)]-0x1],_0x4a6763={'jpg':_0xfe56e7(0x187),'jpeg':'image/jpeg','png':_0xfe56e7(0x1cc),'gif':_0xfe56e7(0x17a),'mp4':_0xfe56e7(0x1c3),'mp3':_0xfe56e7(0x1b2),'m4a':_0xfe56e7(0x1b0),'ogg':'audio/ogg','pdf':_0xfe56e7(0x18d),'doc':'application/msword','docx':_0xfe56e7(0x183),'xls':'application/vnd.ms-excel','xlsx':_0xfe56e7(0x1a3),'ppt':_0xfe56e7(0x175),'pptx':_0xfe56e7(0x193),'txt':_0xfe56e7(0x190),'rtf':_0xfe56e7(0x1ac),'csv':_0xfe56e7(0x1c6),'html':_0xfe56e7(0x1cb),'zip':_0xfe56e7(0x1ab),'rar':_0xfe56e7(0x1d5),'7z':_0xfe56e7(0x1a8),'3gp':'video/3gpp','3g2':_0xfe56e7(0x1c5),'3ga':_0xfe56e7(0x1ad),'7gp':_0xfe56e7(0x1c5),'7ga':_0xfe56e7(0x1ad),'3gpp':_0xfe56e7(0x1ad),'3gpp2':_0xfe56e7(0x1c5),'7gpp':_0xfe56e7(0x1ad),'7gpp2':_0xfe56e7(0x1c5),'3gpp-tt':_0xfe56e7(0x1ad),'3gpp2-tt':_0xfe56e7(0x1c5),'7gpp-tt':_0xfe56e7(0x1ad),'7gpp2-tt':'video/3gpp2','3gpp-rtt':_0xfe56e7(0x1ad),'3gpp2-rtt':_0xfe56e7(0x1c5),'7gpp-rtt':_0xfe56e7(0x1ad),'7gpp2-rtt':_0xfe56e7(0x1c5),'3gpp-sms':_0xfe56e7(0x1ad),'3gpp2-sms':_0xfe56e7(0x1c5),'7gpp-sms':'video/3gpp','7gpp2-sms':'video/3gpp2','pdfa':_0xfe56e7(0x18d),'x-pdf':_0xfe56e7(0x18d)};if(_0x4a6763[_0xcaa04f])return _0x4a6763[_0xcaa04f];return _0xfe56e7(0x1b6);};