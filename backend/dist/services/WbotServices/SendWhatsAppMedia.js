const a549_0x5044ab=a549_0x5c68;(function(_0x4b14e3,_0x2fe250){const _0x263fbf=a549_0x5c68,_0x5a84cd=_0x4b14e3();while(!![]){try{const _0x10e02e=-parseInt(_0x263fbf(0x154))/0x1+parseInt(_0x263fbf(0x189))/0x2*(parseInt(_0x263fbf(0x12b))/0x3)+parseInt(_0x263fbf(0x181))/0x4+-parseInt(_0x263fbf(0x161))/0x5*(-parseInt(_0x263fbf(0x185))/0x6)+-parseInt(_0x263fbf(0x150))/0x7*(-parseInt(_0x263fbf(0x182))/0x8)+-parseInt(_0x263fbf(0x149))/0x9+parseInt(_0x263fbf(0x136))/0xa;if(_0x10e02e===_0x2fe250)break;else _0x5a84cd['push'](_0x5a84cd['shift']());}catch(_0x3a3265){_0x5a84cd['push'](_0x5a84cd['shift']());}}}(a549_0x1641,0x3963a));const a549_0x7b4796=(function(){let _0x30ac78=!![];return function(_0x37f0ca,_0x23aa71){const _0x294efe=_0x30ac78?function(){const _0x56c25f=a549_0x5c68;if(_0x23aa71){const _0x517e99=_0x23aa71[_0x56c25f(0x16c)](_0x37f0ca,arguments);return _0x23aa71=null,_0x517e99;}}:function(){};return _0x30ac78=![],_0x294efe;};}()),a549_0x2eafae=a549_0x7b4796(this,function(){const _0x14ff4d=a549_0x5c68;return a549_0x2eafae['toString']()[_0x14ff4d(0x13c)](_0x14ff4d(0x14a))['toString']()[_0x14ff4d(0x172)](a549_0x2eafae)[_0x14ff4d(0x13c)](_0x14ff4d(0x14a));});a549_0x2eafae();'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x3e242a,_0x56297c,_0x1d1cbc,_0x5438e4){const _0x55053a=a549_0x5c68;if(_0x5438e4===undefined)_0x5438e4=_0x1d1cbc;var _0x581e52=Object['getOwnPropertyDescriptor'](_0x56297c,_0x1d1cbc);(!_0x581e52||(_0x55053a(0x173)in _0x581e52?!_0x56297c['__esModule']:_0x581e52['writable']||_0x581e52['configurable']))&&(_0x581e52={'enumerable':!![],'get':function(){return _0x56297c[_0x1d1cbc];}}),Object[_0x55053a(0x145)](_0x3e242a,_0x5438e4,_0x581e52);}:function(_0x5a95e2,_0x16dc0b,_0x3f68bf,_0x276967){if(_0x276967===undefined)_0x276967=_0x3f68bf;_0x5a95e2[_0x276967]=_0x16dc0b[_0x3f68bf];}),__setModuleDefault=this&&this[a549_0x5044ab(0x157)]||(Object[a549_0x5044ab(0x143)]?function(_0xec24f,_0x108820){const _0x16eed8=a549_0x5044ab;Object[_0x16eed8(0x145)](_0xec24f,'default',{'enumerable':!![],'value':_0x108820});}:function(_0x535410,_0x810775){const _0x1c03ae=a549_0x5044ab;_0x535410[_0x1c03ae(0x151)]=_0x810775;}),__importStar=this&&this[a549_0x5044ab(0x167)]||function(_0x4cdcac){const _0x3a9967=a549_0x5044ab;if(_0x4cdcac&&_0x4cdcac[_0x3a9967(0x169)])return _0x4cdcac;var _0x98469e={};if(_0x4cdcac!=null){for(var _0x276391 in _0x4cdcac)if(_0x276391!==_0x3a9967(0x151)&&Object['prototype'][_0x3a9967(0x14f)]['call'](_0x4cdcac,_0x276391))__createBinding(_0x98469e,_0x4cdcac,_0x276391);}return __setModuleDefault(_0x98469e,_0x4cdcac),_0x98469e;},__importDefault=this&&this['__importDefault']||function(_0x245ca5){const _0x3af856=a549_0x5044ab;return _0x245ca5&&_0x245ca5[_0x3af856(0x169)]?_0x245ca5:{'default':_0x245ca5};};Object[a549_0x5044ab(0x145)](exports,a549_0x5044ab(0x169),{'value':!![]}),exports['SendWhatsAppMediaFileAddress']=exports[a549_0x5044ab(0x139)]=void 0x0;const Sentry=__importStar(require(a549_0x5044ab(0x187))),fs_1=__importDefault(require('fs')),child_process_1=require(a549_0x5044ab(0x16a)),path_1=__importDefault(require('path')),fluent_ffmpeg_1=__importDefault(require('fluent-ffmpeg')),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require(a549_0x5044ab(0x164))),mime_types_1=__importDefault(require('mime-types')),Mustache_1=__importDefault(require(a549_0x5044ab(0x13a))),ffmpeg_static_1=__importDefault(require('ffmpeg-static')),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),wbotMessageListener_1=require(a549_0x5044ab(0x140));fluent_ffmpeg_1['default']['setFfmpegPath'](ffmpeg_static_1['default']);const publicFolder=path_1[a549_0x5044ab(0x151)][a549_0x5044ab(0x16e)](__dirname,'..','..','..',a549_0x5044ab(0x17d)),processAudio=async(_0x1ab691,_0x588acd)=>{const _0x579091=a549_0x5044ab,_0x26506e=publicFolder+_0x579091(0x12c)+_0x588acd+'/'+new Date()[_0x579091(0x180)]()+_0x579091(0x144);return new Promise((_0x35e5ab,_0x97c366)=>{const _0x3d55f0=_0x579091;(0x0,child_process_1[_0x3d55f0(0x153)])(ffmpeg_static_1['default']+_0x3d55f0(0x16f)+_0x1ab691+_0x3d55f0(0x137)+_0x26506e+_0x3d55f0(0x156),(_0xb83997,_0x2fce6d,_0x3b3c10)=>{const _0x56eec6=_0x3d55f0;if(_0xb83997)_0x97c366(_0xb83997);fs_1[_0x56eec6(0x151)][_0x56eec6(0x13f)](_0x1ab691),_0x35e5ab(_0x26506e);});});},processAudioFile=async _0x2f4a56=>{const _0x48cf2d=a549_0x5044ab,_0x55fd00=publicFolder+'/'+new Date()[_0x48cf2d(0x180)]()+'.mp3';return new Promise((_0x10e7a0,_0x25e11f)=>{const _0x517eb2=_0x48cf2d;(0x0,child_process_1[_0x517eb2(0x153)])(ffmpeg_static_1[_0x517eb2(0x151)]+_0x517eb2(0x16f)+_0x2f4a56+_0x517eb2(0x177)+_0x55fd00,(_0x46c6b7,_0xb0227a,_0x9005dc)=>{const _0x1a1a90=_0x517eb2;if(_0x46c6b7)_0x25e11f(_0x46c6b7);fs_1[_0x1a1a90(0x151)]['unlinkSync'](_0x2f4a56),_0x10e7a0(_0x55fd00);});});},getMessageOptions=async(_0x14f438,_0x49e7ad,_0x2673b8,_0x22d510)=>{const _0x2ff525=a549_0x5044ab,_0x4a8225=mime_types_1[_0x2ff525(0x151)][_0x2ff525(0x12d)](_0x49e7ad),_0xe32298=_0x4a8225['split']('/')[0x0];try{if(!_0x4a8225)throw new Error(_0x2ff525(0x17c));let _0x27d41c;if(_0xe32298===_0x2ff525(0x147))_0x27d41c={'video':fs_1[_0x2ff525(0x151)][_0x2ff525(0x131)](_0x49e7ad),'caption':_0x2673b8?_0x2673b8:'','fileName':_0x14f438};else{if(_0xe32298===_0x2ff525(0x17e)){const _0x15058c=!![],_0x102a32=await processAudio(_0x49e7ad,_0x22d510);_0x15058c?_0x27d41c={'audio':fs_1[_0x2ff525(0x151)][_0x2ff525(0x131)](_0x102a32),'mimetype':_0x15058c?_0x2ff525(0x134):_0x4a8225,'caption':_0x2673b8?_0x2673b8:null,'ptt':!![]}:_0x27d41c={'audio':fs_1['default']['readFileSync'](_0x102a32),'mimetype':_0x15058c?'audio/mp4':_0x4a8225,'caption':_0x2673b8?_0x2673b8:null,'ptt':!![]};}else{if(_0xe32298==='document')_0x27d41c={'document':fs_1[_0x2ff525(0x151)]['readFileSync'](_0x49e7ad),'caption':_0x2673b8?_0x2673b8:null,'fileName':_0x14f438,'mimetype':_0x4a8225};else _0xe32298===_0x2ff525(0x14e)?_0x27d41c={'document':fs_1[_0x2ff525(0x151)][_0x2ff525(0x131)](_0x49e7ad),'caption':_0x2673b8?_0x2673b8:null,'fileName':_0x14f438,'mimetype':_0x4a8225}:_0x27d41c={'image':fs_1[_0x2ff525(0x151)][_0x2ff525(0x131)](_0x49e7ad),'caption':_0x2673b8?_0x2673b8:null};}}return _0x27d41c;}catch(_0x1c0192){return Sentry[_0x2ff525(0x148)](_0x1c0192),console[_0x2ff525(0x127)](_0x1c0192),null;}};exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x3f7d05,ticket:_0x4c92ad,body:_0x269c8a})=>{const _0x26502c=a549_0x5044ab;try{const _0x59b080=await(0x0,GetTicketWbot_1[_0x26502c(0x151)])(_0x4c92ad),_0x4c3601=_0x3f7d05[_0x26502c(0x12e)],_0x4f8e62=_0x3f7d05['mimetype'][_0x26502c(0x160)]('/')[0x0];let _0x40fbf0;const _0x3a5fb5=(0x0,Mustache_1[_0x26502c(0x151)])(_0x269c8a,_0x4c92ad);var _0x234bde=_0x3f7d05[_0x26502c(0x165)];if(_0x4f8e62===_0x26502c(0x147))_0x40fbf0={'video':fs_1[_0x26502c(0x151)]['readFileSync'](_0x4c3601),'caption':_0x3a5fb5,'fileName':_0x3f7d05['originalname']};else{if(_0x4f8e62===_0x26502c(0x17e)){const _0x251f11=_0x3f7d05['originalname']['includes'](_0x26502c(0x15e));if(_0x251f11){const _0x54c645=await processAudio(_0x3f7d05[_0x26502c(0x12e)],_0x4c92ad['companyId']);_0x40fbf0={'audio':fs_1[_0x26502c(0x151)][_0x26502c(0x131)](_0x54c645),'mimetype':_0x251f11?_0x26502c(0x134):_0x3f7d05[_0x26502c(0x14b)],'ptt':!![]},_0x234bde=_0x54c645[_0x26502c(0x160)]('/')[_0x54c645['split']('/')['length']-0x1];}else{const _0x372329=await processAudioFile(_0x3f7d05[_0x26502c(0x12e)]);_0x40fbf0={'audio':fs_1['default'][_0x26502c(0x131)](_0x372329),'mimetype':_0x251f11?_0x26502c(0x134):_0x3f7d05['mimetype']},_0x234bde=_0x372329['split']('/')[_0x372329[_0x26502c(0x160)]('/')['length']-0x1];}}else{if(_0x4f8e62===_0x26502c(0x168)||_0x4f8e62===_0x26502c(0x15b))_0x40fbf0={'document':fs_1[_0x26502c(0x151)][_0x26502c(0x131)](_0x4c3601),'caption':_0x3a5fb5,'fileName':_0x3f7d05[_0x26502c(0x188)],'mimetype':_0x3f7d05[_0x26502c(0x14b)]};else _0x4f8e62===_0x26502c(0x14e)?_0x40fbf0={'document':fs_1[_0x26502c(0x151)]['readFileSync'](_0x4c3601),'caption':_0x3a5fb5,'fileName':_0x3f7d05[_0x26502c(0x188)],'mimetype':_0x3f7d05[_0x26502c(0x14b)]}:_0x40fbf0={'image':fs_1[_0x26502c(0x151)][_0x26502c(0x131)](_0x4c3601),'caption':_0x3a5fb5};}}var _0x287495=await _0x59b080[_0x26502c(0x129)](_0x4c92ad[_0x26502c(0x128)][_0x26502c(0x15a)]+'@'+(_0x4c92ad[_0x26502c(0x141)]?_0x26502c(0x179):_0x26502c(0x14d)),{..._0x40fbf0});const _0x52c7a8=await(0x0,wbotMessageListener_1[_0x26502c(0x163)])(_0x287495),_0x5add17={'id':_0x287495[_0x26502c(0x16d)]['id'],'ticketId':_0x4c92ad['id'],'contactId':undefined,'body':_0x269c8a?(0x0,Mustache_1[_0x26502c(0x151)])(_0x269c8a,_0x4c92ad):(0x0,wbotMessageListener_1[_0x26502c(0x12a)])(_0x287495),'fromMe':_0x287495[_0x26502c(0x16d)]['fromMe'],'read':_0x287495[_0x26502c(0x16d)][_0x26502c(0x158)],'mediaUrl':_0x234bde,'mediaType':_0x4f8e62,'quotedMsgId':_0x52c7a8?.['id'],'ack':0x0,'remoteJid':_0x287495[_0x26502c(0x16d)][_0x26502c(0x166)],'participant':_0x287495['key'][_0x26502c(0x130)],'dataJson':JSON[_0x26502c(0x16b)](_0x287495)};return typeof _0x5add17[_0x26502c(0x175)]!='string'&&console[_0x26502c(0x184)](_0x26502c(0x132),_0x5add17[_0x26502c(0x175)]),await _0x4c92ad[_0x26502c(0x133)]({'lastMessage':_0x5add17[_0x26502c(0x175)]}),await(0x0,CreateMessageService_1[_0x26502c(0x151)])({'messageData':_0x5add17,'ticket':_0x4c92ad,'companyId':_0x4c92ad[_0x26502c(0x13e)]}),_0x287495;}catch(_0x361f01){Sentry['captureException'](_0x361f01),console[_0x26502c(0x184)](_0x361f01);throw new AppError_1['default']('ERR_SENDING_WAPP_MSG');}};exports[a549_0x5044ab(0x151)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x25a518,_0x9a7c2,_0x5ce659)=>{const _0x500c2f=a549_0x5044ab;try{const _0x1bf166=await(0x0,GetTicketWbot_1[_0x500c2f(0x151)])(_0x9a7c2);_0x25a518[_0x500c2f(0x146)](_0x500c2f(0x12f))&&(_0x25a518='./public'+_0x25a518['split']('/public')[0x1]);const _0x51fe04=_0x25a518,_0x28aca9=getMimeType(_0x25a518)['split']('/')[0x0];let _0x402a80;if(_0x28aca9===_0x500c2f(0x147))_0x402a80={'video':fs_1[_0x500c2f(0x151)][_0x500c2f(0x131)](_0x51fe04),'caption':_0x5ce659,'fileName':extractFileName(_0x25a518)};else{if(_0x28aca9===_0x500c2f(0x17e)){const _0x43d2c0=_0x25a518[_0x500c2f(0x138)](_0x500c2f(0x15e));if(_0x43d2c0){const _0x4224e3=await processAudio(_0x25a518,_0x9a7c2[_0x500c2f(0x13e)]);_0x402a80={'audio':fs_1[_0x500c2f(0x151)][_0x500c2f(0x131)](_0x4224e3),'mimetype':_0x43d2c0?_0x500c2f(0x134):getMimeType(_0x25a518),'ptt':!![]};}else{const _0x7f8012=await processAudioFile(_0x25a518);_0x402a80={'audio':fs_1[_0x500c2f(0x151)][_0x500c2f(0x131)](_0x7f8012),'mimetype':_0x43d2c0?_0x500c2f(0x134):getMimeType(_0x25a518)};}}else{if(_0x28aca9===_0x500c2f(0x168)||_0x28aca9==='text')_0x402a80={'document':fs_1['default'][_0x500c2f(0x131)](_0x51fe04),'caption':_0x5ce659,'fileName':extractFileName(_0x25a518),'mimetype':getMimeType(_0x25a518)};else _0x28aca9==='application'?_0x402a80={'document':fs_1[_0x500c2f(0x151)][_0x500c2f(0x131)](_0x51fe04),'caption':_0x5ce659,'fileName':extractFileName(_0x25a518),'mimetype':getMimeType(_0x25a518)}:_0x402a80={'image':fs_1[_0x500c2f(0x151)]['readFileSync'](_0x51fe04),'caption':_0x5ce659};}}const _0x34667c=await _0x1bf166[_0x500c2f(0x129)](_0x9a7c2[_0x500c2f(0x128)][_0x500c2f(0x15a)]+'@'+(_0x9a7c2[_0x500c2f(0x141)]?_0x500c2f(0x179):_0x500c2f(0x14d)),{..._0x402a80});return _0x34667c;}catch(_0x395186){Sentry[_0x500c2f(0x148)](_0x395186),console[_0x500c2f(0x127)](_0x395186);throw new AppError_1[(_0x500c2f(0x151))](_0x500c2f(0x159));}};function a549_0x1641(){const _0x16e2e8=['captureException','1113318YmJrXk','(((.+)+)+)+$','mimetype','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','s.whatsapp.net','application','hasOwnProperty','203mEchlV','default','application/zip','exec','404413awaSfz','application/pdf','\x20-y','__setModuleDefault','fromMe','ERR_SENDING_WAPP_MSG','number','text','video/3gpp','pop','audio-record-site','image/png','split','115NXWmOy','video/3gpp2','verifyQuotedMessage','../../helpers/GetTicketWbot','filename','remoteJid','__importStar','document','__esModule','child_process','stringify','apply','key','resolve','\x20-i\x20','join','text/csv','constructor','get','audio/mp3','body','text/plain','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','application/rtf','g.us','image/gif','application/vnd.openxmlformats-officedocument.presentationml.presentation','Invalid\x20mimetype','public','audio','video/mp4','getTime','998812jzQCsI','42752SThXki','text/html','trace','12606VbSFah','length','@sentry/node','originalname','28agAHgw','application/x-rar-compressed','log','contact','sendMessage','getBodyMessage','11883KpyWoS','/company','lookup','path','http','participant','readFileSync','body\x20is\x20not\x20a\x20string','update','audio/mp4','application/octet-stream','2547250yzzXqb','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','includes','getMessageOptions','../../helpers/Mustache','application/vnd.openxmlformats-officedocument.wordprocessingml.document','search','application/vnd.ms-powerpoint','companyId','unlinkSync','./wbotMessageListener','isGroup','image/jpeg','create','.mp3','defineProperty','startsWith','video'];a549_0x1641=function(){return _0x16e2e8;};return a549_0x1641();}exports['SendWhatsAppMediaFileAddress']=SendWhatsAppMediaFileAddress;function a549_0x5c68(_0x27fd2e,_0x154980){const _0x1745f5=a549_0x1641();return a549_0x5c68=function(_0x2eafae,_0x7b4796){_0x2eafae=_0x2eafae-0x127;let _0x164189=_0x1745f5[_0x2eafae];return _0x164189;},a549_0x5c68(_0x27fd2e,_0x154980);}const extractFileName=_0x260d51=>{const _0x482c73=a549_0x5044ab,_0x529626=_0x260d51[_0x482c73(0x160)]('/');return _0x529626[_0x529626[_0x482c73(0x186)]-0x1];},extractFilePath=_0xc1fd33=>{const _0x3c421d=a549_0x5044ab,_0x5a7276=_0xc1fd33['split']('/');return _0x5a7276[_0x3c421d(0x15d)](),_0x5a7276[_0x3c421d(0x170)]('/');},getMimeType=_0x2ca288=>{const _0x3f1baf=a549_0x5044ab,_0x4a649e=_0x2ca288[_0x3f1baf(0x160)]('.'),_0x141e04=_0x4a649e[_0x4a649e[_0x3f1baf(0x186)]-0x1],_0x1f517d={'jpg':_0x3f1baf(0x142),'jpeg':'image/jpeg','png':_0x3f1baf(0x15f),'gif':_0x3f1baf(0x17a),'mp4':_0x3f1baf(0x17f),'mp3':_0x3f1baf(0x174),'m4a':'audio/mp4','ogg':'audio/ogg','pdf':_0x3f1baf(0x155),'doc':'application/msword','docx':_0x3f1baf(0x13b),'xls':'application/vnd.ms-excel','xlsx':_0x3f1baf(0x14c),'ppt':_0x3f1baf(0x13d),'pptx':_0x3f1baf(0x17b),'txt':_0x3f1baf(0x176),'rtf':_0x3f1baf(0x178),'csv':_0x3f1baf(0x171),'html':_0x3f1baf(0x183),'zip':_0x3f1baf(0x152),'rar':_0x3f1baf(0x18a),'7z':'application/x-7z-compressed','3gp':_0x3f1baf(0x15c),'3g2':_0x3f1baf(0x162),'3ga':_0x3f1baf(0x15c),'7gp':_0x3f1baf(0x162),'7ga':_0x3f1baf(0x15c),'3gpp':_0x3f1baf(0x15c),'3gpp2':'video/3gpp2','7gpp':_0x3f1baf(0x15c),'7gpp2':_0x3f1baf(0x162),'3gpp-tt':_0x3f1baf(0x15c),'3gpp2-tt':'video/3gpp2','7gpp-tt':_0x3f1baf(0x15c),'7gpp2-tt':_0x3f1baf(0x162),'3gpp-rtt':_0x3f1baf(0x15c),'3gpp2-rtt':'video/3gpp2','7gpp-rtt':'video/3gpp','7gpp2-rtt':'video/3gpp2','3gpp-sms':_0x3f1baf(0x15c),'3gpp2-sms':_0x3f1baf(0x162),'7gpp-sms':'video/3gpp','7gpp2-sms':'video/3gpp2','pdfa':_0x3f1baf(0x155),'x-pdf':_0x3f1baf(0x155)};if(_0x1f517d[_0x141e04])return _0x1f517d[_0x141e04];return _0x3f1baf(0x135);};