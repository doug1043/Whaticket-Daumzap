function a548_0x4885(){const _0x282427=['text/plain','../../helpers/GetTicketWbot','audio','public','getMessageOptions','call','/company','ffmpeg-static','326695hXlLTd','__importStar','.mp3','application','606180wmHJfX','audio-record-site','15959702WeDtJb','readFileSync','6288jFmiQX','apply','2020284oDYURp','@sentry/node','\x20-i\x20','isGroup','application/vnd.ms-powerpoint','getTime','number','companyId','log','application/pdf','body\x20is\x20not\x20a\x20string','create','__esModule','captureException','./wbotMessageListener','application/zip','mimetype','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','(((.+)+)+)+$','__createBinding','originalname','video/3gpp2','writable','application/vnd.openxmlformats-officedocument.wordprocessingml.document','audio/ogg','participant','setFfmpegPath','document','application/rtf','s.whatsapp.net','g.us','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','join','remoteJid','prototype','get','video/3gpp','default','text/csv','filename','body','contact','application/x-7z-compressed','../../helpers/Mustache','10116TOZPyg','http','length','child_process','image/gif','split','text/html','stringify','\x20-y','3479DsGIle','application/octet-stream','56Muvrym','getBodyMessage','image/jpeg','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','sendMessage','text','mime-types','exec','SendWhatsAppMediaFileAddress','video','application/x-rar-compressed','fluent-ffmpeg','resolve','7640svlHsd','string','unlinkSync','/public','92eOXzHn','application/msword','audio/mp4','path','19226ubbNhC','toString','../MessageServices/CreateMessageService','includes','key','fromMe','application/vnd.openxmlformats-officedocument.presentationml.presentation','defineProperty'];a548_0x4885=function(){return _0x282427;};return a548_0x4885();}const a548_0x5a2dac=a548_0x18c4;(function(_0x26dfd0,_0x32ace5){const _0x135c14=a548_0x18c4,_0x3d0482=_0x26dfd0();while(!![]){try{const _0x3acc86=parseInt(_0x135c14(0xea))/0x1*(parseInt(_0x135c14(0xee))/0x2)+parseInt(_0x135c14(0x108))/0x3+parseInt(_0x135c14(0xd9))/0x4*(-parseInt(_0x135c14(0xfe))/0x5)+parseInt(_0x135c14(0x106))/0x6*(parseInt(_0x135c14(0xd7))/0x7)+-parseInt(_0x135c14(0xe6))/0x8*(-parseInt(_0x135c14(0xce))/0x9)+parseInt(_0x135c14(0x102))/0xa+-parseInt(_0x135c14(0x104))/0xb;if(_0x3acc86===_0x32ace5)break;else _0x3d0482['push'](_0x3d0482['shift']());}catch(_0x1f10bb){_0x3d0482['push'](_0x3d0482['shift']());}}}(a548_0x4885,0xcecf2));const a548_0xc4a639=(function(){let _0x28a2e2=!![];return function(_0x3766c4,_0x367f0d){const _0x3368ca=_0x28a2e2?function(){const _0x429cb6=a548_0x18c4;if(_0x367f0d){const _0x274c46=_0x367f0d[_0x429cb6(0x107)](_0x3766c4,arguments);return _0x367f0d=null,_0x274c46;}}:function(){};return _0x28a2e2=![],_0x3368ca;};}()),a548_0x3ce720=a548_0xc4a639(this,function(){const _0xb0e08e=a548_0x18c4;return a548_0x3ce720[_0xb0e08e(0xef)]()['search'](_0xb0e08e(0x11a))[_0xb0e08e(0xef)]()['constructor'](a548_0x3ce720)['search'](_0xb0e08e(0x11a));});a548_0x3ce720();'use strict';var __createBinding=this&&this[a548_0x5a2dac(0x11b)]||(Object[a548_0x5a2dac(0x113)]?function(_0x4fe59a,_0x333398,_0x478e2f,_0xff9e65){const _0x208744=a548_0x5a2dac;if(_0xff9e65===undefined)_0xff9e65=_0x478e2f;var _0x291ad3=Object['getOwnPropertyDescriptor'](_0x333398,_0x478e2f);(!_0x291ad3||(_0x208744(0xc5)in _0x291ad3?!_0x333398['__esModule']:_0x291ad3[_0x208744(0x11e)]||_0x291ad3['configurable']))&&(_0x291ad3={'enumerable':!![],'get':function(){return _0x333398[_0x478e2f];}}),Object[_0x208744(0xf5)](_0x4fe59a,_0xff9e65,_0x291ad3);}:function(_0xcdb092,_0x33acdf,_0x5ea834,_0x177288){if(_0x177288===undefined)_0x177288=_0x5ea834;_0xcdb092[_0x177288]=_0x33acdf[_0x5ea834];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0xea2cd7,_0x2cb98b){Object['defineProperty'](_0xea2cd7,'default',{'enumerable':!![],'value':_0x2cb98b});}:function(_0x5004ba,_0x344f4c){const _0x4c78c1=a548_0x5a2dac;_0x5004ba[_0x4c78c1(0xc7)]=_0x344f4c;}),__importStar=this&&this[a548_0x5a2dac(0xff)]||function(_0x482fe8){const _0x37d11f=a548_0x5a2dac;if(_0x482fe8&&_0x482fe8['__esModule'])return _0x482fe8;var _0x59c878={};if(_0x482fe8!=null){for(var _0x2e2927 in _0x482fe8)if(_0x2e2927!==_0x37d11f(0xc7)&&Object[_0x37d11f(0xc4)]['hasOwnProperty'][_0x37d11f(0xfb)](_0x482fe8,_0x2e2927))__createBinding(_0x59c878,_0x482fe8,_0x2e2927);}return __setModuleDefault(_0x59c878,_0x482fe8),_0x59c878;},__importDefault=this&&this['__importDefault']||function(_0x31ba7e){const _0x120887=a548_0x5a2dac;return _0x31ba7e&&_0x31ba7e[_0x120887(0x114)]?_0x31ba7e:{'default':_0x31ba7e};};Object[a548_0x5a2dac(0xf5)](exports,'__esModule',{'value':!![]}),exports[a548_0x5a2dac(0xe1)]=exports[a548_0x5a2dac(0xfa)]=void 0x0;const Sentry=__importStar(require(a548_0x5a2dac(0x109))),fs_1=__importDefault(require('fs')),child_process_1=require(a548_0x5a2dac(0xd1)),path_1=__importDefault(require('path')),fluent_ffmpeg_1=__importDefault(require(a548_0x5a2dac(0xe4))),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require(a548_0x5a2dac(0xf7))),mime_types_1=__importDefault(require(a548_0x5a2dac(0xdf))),Mustache_1=__importDefault(require(a548_0x5a2dac(0xcd))),ffmpeg_static_1=__importDefault(require(a548_0x5a2dac(0xfd))),CreateMessageService_1=__importDefault(require(a548_0x5a2dac(0xf0))),wbotMessageListener_1=require(a548_0x5a2dac(0x116));function a548_0x18c4(_0x4b6807,_0x1b9872){const _0x314e15=a548_0x4885();return a548_0x18c4=function(_0x3ce720,_0xc4a639){_0x3ce720=_0x3ce720-0xbf;let _0x4885b6=_0x314e15[_0x3ce720];return _0x4885b6;},a548_0x18c4(_0x4b6807,_0x1b9872);}fluent_ffmpeg_1[a548_0x5a2dac(0xc7)][a548_0x5a2dac(0x122)](ffmpeg_static_1[a548_0x5a2dac(0xc7)]);const publicFolder=path_1[a548_0x5a2dac(0xc7)][a548_0x5a2dac(0xe5)](__dirname,'..','..','..',a548_0x5a2dac(0xf9)),processAudio=async(_0x44b860,_0x30d3f9)=>{const _0x667ae1=a548_0x5a2dac,_0x5bfedc=publicFolder+_0x667ae1(0xfc)+_0x30d3f9+'/'+new Date()[_0x667ae1(0x10d)]()+'.mp3';return new Promise((_0xc57db8,_0x50b23a)=>{const _0x9d6428=_0x667ae1;(0x0,child_process_1[_0x9d6428(0xe0)])(ffmpeg_static_1[_0x9d6428(0xc7)]+'\x20-i\x20'+_0x44b860+_0x9d6428(0xdc)+_0x5bfedc+_0x9d6428(0xd6),(_0x5335f0,_0x31893c,_0xf03f6e)=>{const _0x3cb1b2=_0x9d6428;if(_0x5335f0)_0x50b23a(_0x5335f0);fs_1[_0x3cb1b2(0xc7)][_0x3cb1b2(0xe8)](_0x44b860),_0xc57db8(_0x5bfedc);});});},processAudioFile=async _0x21a79f=>{const _0x52b851=a548_0x5a2dac,_0x511109=publicFolder+'/'+new Date()[_0x52b851(0x10d)]()+_0x52b851(0x100);return new Promise((_0x36a8be,_0x1d3817)=>{const _0x162614=_0x52b851;(0x0,child_process_1[_0x162614(0xe0)])(ffmpeg_static_1[_0x162614(0xc7)]+_0x162614(0x10a)+_0x21a79f+_0x162614(0xc1)+_0x511109,(_0x5cc649,_0x2a2d1e,_0x576983)=>{const _0x5de1a6=_0x162614;if(_0x5cc649)_0x1d3817(_0x5cc649);fs_1['default'][_0x5de1a6(0xe8)](_0x21a79f),_0x36a8be(_0x511109);});});},getMessageOptions=async(_0x252883,_0xbeb86,_0x187481,_0x2eaf2e)=>{const _0x21a928=a548_0x5a2dac,_0x56b993=mime_types_1[_0x21a928(0xc7)]['lookup'](_0xbeb86),_0x4d6d1e=_0x56b993[_0x21a928(0xd3)]('/')[0x0];try{if(!_0x56b993)throw new Error('Invalid\x20mimetype');let _0x324ee3;if(_0x4d6d1e==='video')_0x324ee3={'video':fs_1[_0x21a928(0xc7)]['readFileSync'](_0xbeb86),'caption':_0x187481?_0x187481:'','fileName':_0x252883};else{if(_0x4d6d1e===_0x21a928(0xf8)){const _0xf818d4=!![],_0x224bb8=await processAudio(_0xbeb86,_0x2eaf2e);_0xf818d4?_0x324ee3={'audio':fs_1[_0x21a928(0xc7)][_0x21a928(0x105)](_0x224bb8),'mimetype':_0xf818d4?_0x21a928(0xec):_0x56b993,'caption':_0x187481?_0x187481:null,'ptt':!![]}:_0x324ee3={'audio':fs_1['default'][_0x21a928(0x105)](_0x224bb8),'mimetype':_0xf818d4?'audio/mp4':_0x56b993,'caption':_0x187481?_0x187481:null,'ptt':!![]};}else{if(_0x4d6d1e===_0x21a928(0x123))_0x324ee3={'document':fs_1[_0x21a928(0xc7)]['readFileSync'](_0xbeb86),'caption':_0x187481?_0x187481:null,'fileName':_0x252883,'mimetype':_0x56b993};else _0x4d6d1e==='application'?_0x324ee3={'document':fs_1[_0x21a928(0xc7)]['readFileSync'](_0xbeb86),'caption':_0x187481?_0x187481:null,'fileName':_0x252883,'mimetype':_0x56b993}:_0x324ee3={'image':fs_1['default'][_0x21a928(0x105)](_0xbeb86),'caption':_0x187481?_0x187481:null};}}return _0x324ee3;}catch(_0x3c01c0){return Sentry[_0x21a928(0x115)](_0x3c01c0),console[_0x21a928(0x110)](_0x3c01c0),null;}};exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x5d5f02,ticket:_0x5cb3e6,body:_0x15c5df})=>{const _0x8e637b=a548_0x5a2dac;try{const _0x5bd38a=await(0x0,GetTicketWbot_1['default'])(_0x5cb3e6),_0x976381=_0x5d5f02[_0x8e637b(0xed)],_0x4a61bb=_0x5d5f02[_0x8e637b(0x118)][_0x8e637b(0xd3)]('/')[0x0];let _0x3acb23;const _0x2cf3ae=(0x0,Mustache_1[_0x8e637b(0xc7)])(_0x15c5df,_0x5cb3e6);var _0x4a5665=_0x5d5f02[_0x8e637b(0xc9)];if(_0x4a61bb===_0x8e637b(0xe2))_0x3acb23={'video':fs_1['default']['readFileSync'](_0x976381),'caption':_0x2cf3ae,'fileName':_0x5d5f02[_0x8e637b(0x11c)]};else{if(_0x4a61bb===_0x8e637b(0xf8)){const _0x3f00ca=_0x5d5f02[_0x8e637b(0x11c)][_0x8e637b(0xf1)]('audio-record-site');if(_0x3f00ca){const _0xd63024=await processAudio(_0x5d5f02[_0x8e637b(0xed)],_0x5cb3e6[_0x8e637b(0x10f)]);_0x3acb23={'audio':fs_1[_0x8e637b(0xc7)][_0x8e637b(0x105)](_0xd63024),'mimetype':_0x3f00ca?'audio/mp4':_0x5d5f02['mimetype'],'ptt':!![]},_0x4a5665=_0xd63024[_0x8e637b(0xd3)]('/')[_0xd63024[_0x8e637b(0xd3)]('/')['length']-0x1];}else{const _0x4f7466=await processAudioFile(_0x5d5f02['path']);_0x3acb23={'audio':fs_1['default']['readFileSync'](_0x4f7466),'mimetype':_0x3f00ca?'audio/mp4':_0x5d5f02[_0x8e637b(0x118)]},_0x4a5665=_0x4f7466[_0x8e637b(0xd3)]('/')[_0x4f7466[_0x8e637b(0xd3)]('/')['length']-0x1];}}else{if(_0x4a61bb===_0x8e637b(0x123)||_0x4a61bb===_0x8e637b(0xde))_0x3acb23={'document':fs_1[_0x8e637b(0xc7)][_0x8e637b(0x105)](_0x976381),'caption':_0x2cf3ae,'fileName':_0x5d5f02[_0x8e637b(0x11c)],'mimetype':_0x5d5f02[_0x8e637b(0x118)]};else _0x4a61bb===_0x8e637b(0x101)?_0x3acb23={'document':fs_1[_0x8e637b(0xc7)]['readFileSync'](_0x976381),'caption':_0x2cf3ae,'fileName':_0x5d5f02[_0x8e637b(0x11c)],'mimetype':_0x5d5f02['mimetype']}:_0x3acb23={'image':fs_1['default'][_0x8e637b(0x105)](_0x976381),'caption':_0x2cf3ae};}}var _0x411fdc=await _0x5bd38a[_0x8e637b(0xdd)](_0x5cb3e6[_0x8e637b(0xcb)][_0x8e637b(0x10e)]+'@'+(_0x5cb3e6[_0x8e637b(0x10b)]?_0x8e637b(0xc0):_0x8e637b(0xbf)),{..._0x3acb23});const _0x2b522c=await(0x0,wbotMessageListener_1['verifyQuotedMessage'])(_0x411fdc),_0x3966fe={'id':_0x411fdc[_0x8e637b(0xf2)]['id'],'ticketId':_0x5cb3e6['id'],'contactId':undefined,'body':_0x15c5df?(0x0,Mustache_1[_0x8e637b(0xc7)])(_0x15c5df,_0x5cb3e6):(0x0,wbotMessageListener_1[_0x8e637b(0xda)])(_0x411fdc),'fromMe':_0x411fdc[_0x8e637b(0xf2)][_0x8e637b(0xf3)],'read':_0x411fdc[_0x8e637b(0xf2)][_0x8e637b(0xf3)],'mediaUrl':_0x4a5665,'mediaType':_0x4a61bb,'quotedMsgId':_0x2b522c?.['id'],'ack':0x0,'remoteJid':_0x411fdc['key'][_0x8e637b(0xc3)],'participant':_0x411fdc['key'][_0x8e637b(0x121)],'dataJson':JSON[_0x8e637b(0xd5)](_0x411fdc)};return typeof _0x3966fe[_0x8e637b(0xca)]!=_0x8e637b(0xe7)&&console['trace'](_0x8e637b(0x112),_0x3966fe[_0x8e637b(0xca)]),await _0x5cb3e6['update']({'lastMessage':_0x3966fe[_0x8e637b(0xca)]}),await(0x0,CreateMessageService_1[_0x8e637b(0xc7)])({'messageData':_0x3966fe,'ticket':_0x5cb3e6,'companyId':_0x5cb3e6[_0x8e637b(0x10f)]}),_0x411fdc;}catch(_0x92a27b){Sentry[_0x8e637b(0x115)](_0x92a27b),console['trace'](_0x92a27b);throw new AppError_1[(_0x8e637b(0xc7))]('ERR_SENDING_WAPP_MSG');}};exports['default']=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x595b6d,_0x296b0b,_0x47459f)=>{const _0x1faaab=a548_0x5a2dac;try{const _0x3224ee=await(0x0,GetTicketWbot_1[_0x1faaab(0xc7)])(_0x296b0b);_0x595b6d['startsWith'](_0x1faaab(0xcf))&&(_0x595b6d='./public'+_0x595b6d[_0x1faaab(0xd3)](_0x1faaab(0xe9))[0x1]);const _0x1f5dd9=_0x595b6d,_0x5baea6=getMimeType(_0x595b6d)[_0x1faaab(0xd3)]('/')[0x0];let _0x1c7f5d;if(_0x5baea6===_0x1faaab(0xe2))_0x1c7f5d={'video':fs_1[_0x1faaab(0xc7)][_0x1faaab(0x105)](_0x1f5dd9),'caption':_0x47459f,'fileName':extractFileName(_0x595b6d)};else{if(_0x5baea6===_0x1faaab(0xf8)){const _0xdc48ff=_0x595b6d['includes'](_0x1faaab(0x103));if(_0xdc48ff){const _0x807fac=await processAudio(_0x595b6d,_0x296b0b[_0x1faaab(0x10f)]);_0x1c7f5d={'audio':fs_1[_0x1faaab(0xc7)]['readFileSync'](_0x807fac),'mimetype':_0xdc48ff?'audio/mp4':getMimeType(_0x595b6d),'ptt':!![]};}else{const _0xcdc714=await processAudioFile(_0x595b6d);_0x1c7f5d={'audio':fs_1['default'][_0x1faaab(0x105)](_0xcdc714),'mimetype':_0xdc48ff?_0x1faaab(0xec):getMimeType(_0x595b6d)};}}else{if(_0x5baea6===_0x1faaab(0x123)||_0x5baea6===_0x1faaab(0xde))_0x1c7f5d={'document':fs_1[_0x1faaab(0xc7)][_0x1faaab(0x105)](_0x1f5dd9),'caption':_0x47459f,'fileName':extractFileName(_0x595b6d),'mimetype':getMimeType(_0x595b6d)};else _0x5baea6===_0x1faaab(0x101)?_0x1c7f5d={'document':fs_1[_0x1faaab(0xc7)]['readFileSync'](_0x1f5dd9),'caption':_0x47459f,'fileName':extractFileName(_0x595b6d),'mimetype':getMimeType(_0x595b6d)}:_0x1c7f5d={'image':fs_1[_0x1faaab(0xc7)][_0x1faaab(0x105)](_0x1f5dd9),'caption':_0x47459f};}}const _0xbb3a61=await _0x3224ee[_0x1faaab(0xdd)](_0x296b0b[_0x1faaab(0xcb)][_0x1faaab(0x10e)]+'@'+(_0x296b0b['isGroup']?'g.us':_0x1faaab(0xbf)),{..._0x1c7f5d});return _0xbb3a61;}catch(_0x52461c){Sentry[_0x1faaab(0x115)](_0x52461c),console[_0x1faaab(0x110)](_0x52461c);throw new AppError_1[(_0x1faaab(0xc7))]('ERR_SENDING_WAPP_MSG');}};exports[a548_0x5a2dac(0xe1)]=SendWhatsAppMediaFileAddress;const extractFileName=_0x25654d=>{const _0x14e646=a548_0x5a2dac,_0x2d8297=_0x25654d[_0x14e646(0xd3)]('/');return _0x2d8297[_0x2d8297['length']-0x1];},extractFilePath=_0x35ca6a=>{const _0x422723=a548_0x5a2dac,_0x5e0505=_0x35ca6a[_0x422723(0xd3)]('/');return _0x5e0505['pop'](),_0x5e0505[_0x422723(0xc2)]('/');},getMimeType=_0x13e1bc=>{const _0x5d82c3=a548_0x5a2dac,_0x215a1a=_0x13e1bc['split']('.'),_0xaa288=_0x215a1a[_0x215a1a[_0x5d82c3(0xd0)]-0x1],_0x5db391={'jpg':_0x5d82c3(0xdb),'jpeg':_0x5d82c3(0xdb),'png':'image/png','gif':_0x5d82c3(0xd2),'mp4':'video/mp4','mp3':'audio/mp3','m4a':'audio/mp4','ogg':_0x5d82c3(0x120),'pdf':_0x5d82c3(0x111),'doc':_0x5d82c3(0xeb),'docx':_0x5d82c3(0x11f),'xls':'application/vnd.ms-excel','xlsx':_0x5d82c3(0x119),'ppt':_0x5d82c3(0x10c),'pptx':_0x5d82c3(0xf4),'txt':_0x5d82c3(0xf6),'rtf':_0x5d82c3(0x124),'csv':_0x5d82c3(0xc8),'html':_0x5d82c3(0xd4),'zip':_0x5d82c3(0x117),'rar':_0x5d82c3(0xe3),'7z':_0x5d82c3(0xcc),'3gp':_0x5d82c3(0xc6),'3g2':_0x5d82c3(0x11d),'3ga':_0x5d82c3(0xc6),'7gp':'video/3gpp2','7ga':_0x5d82c3(0xc6),'3gpp':_0x5d82c3(0xc6),'3gpp2':_0x5d82c3(0x11d),'7gpp':_0x5d82c3(0xc6),'7gpp2':_0x5d82c3(0x11d),'3gpp-tt':_0x5d82c3(0xc6),'3gpp2-tt':_0x5d82c3(0x11d),'7gpp-tt':_0x5d82c3(0xc6),'7gpp2-tt':_0x5d82c3(0x11d),'3gpp-rtt':_0x5d82c3(0xc6),'3gpp2-rtt':_0x5d82c3(0x11d),'7gpp-rtt':_0x5d82c3(0xc6),'7gpp2-rtt':'video/3gpp2','3gpp-sms':_0x5d82c3(0xc6),'3gpp2-sms':_0x5d82c3(0x11d),'7gpp-sms':_0x5d82c3(0xc6),'7gpp2-sms':'video/3gpp2','pdfa':'application/pdf','x-pdf':_0x5d82c3(0x111)};if(_0x5db391[_0xaa288])return _0x5db391[_0xaa288];return _0x5d82c3(0xd8);};