const a550_0x52265a=a550_0x37f6;function a550_0x37f6(_0x41d239,_0xa678c7){const _0x42399b=a550_0x2d0a();return a550_0x37f6=function(_0x13e98c,_0x2141fb){_0x13e98c=_0x13e98c-0x1e1;let _0x2d0ab9=_0x42399b[_0x13e98c];return _0x2d0ab9;},a550_0x37f6(_0x41d239,_0xa678c7);}function a550_0x2d0a(){const _0x2b5c98=['trace','path','image/png','video/3gpp','16BBjPsM','SendWhatsAppMediaFileAddress','search','startsWith','application/pdf','configurable','log','../../helpers/Mustache','child_process','join','application/rtf','/company','application','384558gVClTW','ffmpeg-static','image/gif','apply','\x20-y','toString','9OVrsdS','captureException','application/zip','../MessageServices/CreateMessageService','text/html','720860FtdySB','get','application/vnd.openxmlformats-officedocument.presentationml.presentation','audio/ogg','defineProperty','audio','pop','contact','audio-record-site','__esModule','audio/mp3','./public','text/plain','3968500oCuEUe','body\x20is\x20not\x20a\x20string','2093224uAEyJW','s.whatsapp.net','application/msword','2010XVFFMK','key','Invalid\x20mimetype','hasOwnProperty','verifyQuotedMessage','(((.+)+)+)+$','text','split','.mp3','getTime','includes','readFileSync','body','video','application/vnd.ms-powerpoint','audio/mp4','864952coYbwK','remoteJid','application/octet-stream','number','resolve','image/jpeg','mime-types','writable','../../helpers/GetTicketWbot','application/vnd.openxmlformats-officedocument.wordprocessingml.document','application/vnd.ms-excel','fromMe','4542zdhBos','__createBinding','create','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','mimetype','isGroup','call','text/csv','stringify','setFfmpegPath','getMessageOptions','default','document','string','companyId','sendMessage','originalname','g.us','\x20-i\x20','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','getOwnPropertyDescriptor','exec','constructor','application/x-rar-compressed','11837eceoyY','http','length','../../errors/AppError','video/3gpp2','__setModuleDefault','ERR_SENDING_WAPP_MSG','participant'];a550_0x2d0a=function(){return _0x2b5c98;};return a550_0x2d0a();}(function(_0x18cba3,_0x2c0ad2){const _0x5eec93=a550_0x37f6,_0x30f9b2=_0x18cba3();while(!![]){try{const _0x27b4d2=-parseInt(_0x5eec93(0x217))/0x1*(-parseInt(_0x5eec93(0x223))/0x2)+parseInt(_0x5eec93(0x230))/0x3+parseInt(_0x5eec93(0x1f3))/0x4+parseInt(_0x5eec93(0x1e3))/0x5*(-parseInt(_0x5eec93(0x1ff))/0x6)+-parseInt(_0x5eec93(0x23b))/0x7+-parseInt(_0x5eec93(0x24a))/0x8+-parseInt(_0x5eec93(0x236))/0x9*(-parseInt(_0x5eec93(0x248))/0xa);if(_0x27b4d2===_0x2c0ad2)break;else _0x30f9b2['push'](_0x30f9b2['shift']());}catch(_0xdc679b){_0x30f9b2['push'](_0x30f9b2['shift']());}}}(a550_0x2d0a,0x28c6f));const a550_0x2141fb=(function(){let _0x3e936a=!![];return function(_0x230af4,_0x2dd168){const _0x137b36=_0x3e936a?function(){const _0x8cd051=a550_0x37f6;if(_0x2dd168){const _0x67710b=_0x2dd168[_0x8cd051(0x233)](_0x230af4,arguments);return _0x2dd168=null,_0x67710b;}}:function(){};return _0x3e936a=![],_0x137b36;};}()),a550_0x13e98c=a550_0x2141fb(this,function(){const _0xe9e014=a550_0x37f6;return a550_0x13e98c[_0xe9e014(0x235)]()[_0xe9e014(0x225)](_0xe9e014(0x1e8))[_0xe9e014(0x235)]()[_0xe9e014(0x215)](a550_0x13e98c)['search'](_0xe9e014(0x1e8));});a550_0x13e98c();'use strict';var __createBinding=this&&this[a550_0x52265a(0x200)]||(Object[a550_0x52265a(0x201)]?function(_0x29d2d7,_0xc542e0,_0x207b0e,_0x221589){const _0x30d199=a550_0x52265a;if(_0x221589===undefined)_0x221589=_0x207b0e;var _0x4f4c92=Object[_0x30d199(0x213)](_0xc542e0,_0x207b0e);(!_0x4f4c92||(_0x30d199(0x23c)in _0x4f4c92?!_0xc542e0[_0x30d199(0x244)]:_0x4f4c92[_0x30d199(0x1fa)]||_0x4f4c92[_0x30d199(0x228)]))&&(_0x4f4c92={'enumerable':!![],'get':function(){return _0xc542e0[_0x207b0e];}}),Object[_0x30d199(0x23f)](_0x29d2d7,_0x221589,_0x4f4c92);}:function(_0x2fb951,_0x1fe26f,_0x40e538,_0x4acf27){if(_0x4acf27===undefined)_0x4acf27=_0x40e538;_0x2fb951[_0x4acf27]=_0x1fe26f[_0x40e538];}),__setModuleDefault=this&&this[a550_0x52265a(0x21c)]||(Object[a550_0x52265a(0x201)]?function(_0x50e798,_0x129f37){const _0x3ba6fe=a550_0x52265a;Object[_0x3ba6fe(0x23f)](_0x50e798,_0x3ba6fe(0x20a),{'enumerable':!![],'value':_0x129f37});}:function(_0x463206,_0x4ac1e1){const _0x134b9a=a550_0x52265a;_0x463206[_0x134b9a(0x20a)]=_0x4ac1e1;}),__importStar=this&&this['__importStar']||function(_0x2b321d){const _0x3e621b=a550_0x52265a;if(_0x2b321d&&_0x2b321d[_0x3e621b(0x244)])return _0x2b321d;var _0x5aae1c={};if(_0x2b321d!=null){for(var _0x13f30a in _0x2b321d)if(_0x13f30a!==_0x3e621b(0x20a)&&Object['prototype'][_0x3e621b(0x1e6)][_0x3e621b(0x205)](_0x2b321d,_0x13f30a))__createBinding(_0x5aae1c,_0x2b321d,_0x13f30a);}return __setModuleDefault(_0x5aae1c,_0x2b321d),_0x5aae1c;},__importDefault=this&&this['__importDefault']||function(_0xa39b9f){const _0x206e38=a550_0x52265a;return _0xa39b9f&&_0xa39b9f[_0x206e38(0x244)]?_0xa39b9f:{'default':_0xa39b9f};};Object[a550_0x52265a(0x23f)](exports,a550_0x52265a(0x244),{'value':!![]}),exports[a550_0x52265a(0x224)]=exports[a550_0x52265a(0x209)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),fs_1=__importDefault(require('fs')),child_process_1=require(a550_0x52265a(0x22b)),path_1=__importDefault(require(a550_0x52265a(0x220))),fluent_ffmpeg_1=__importDefault(require('fluent-ffmpeg')),AppError_1=__importDefault(require(a550_0x52265a(0x21a))),GetTicketWbot_1=__importDefault(require(a550_0x52265a(0x1fb))),mime_types_1=__importDefault(require(a550_0x52265a(0x1f9))),Mustache_1=__importDefault(require(a550_0x52265a(0x22a))),ffmpeg_static_1=__importDefault(require(a550_0x52265a(0x231))),CreateMessageService_1=__importDefault(require(a550_0x52265a(0x239))),wbotMessageListener_1=require('./wbotMessageListener');fluent_ffmpeg_1[a550_0x52265a(0x20a)][a550_0x52265a(0x208)](ffmpeg_static_1[a550_0x52265a(0x20a)]);const publicFolder=path_1[a550_0x52265a(0x20a)][a550_0x52265a(0x1f7)](__dirname,'..','..','..','public'),processAudio=async(_0x1f9921,_0x3226ff)=>{const _0xaabbef=a550_0x52265a,_0x5ce0a4=publicFolder+_0xaabbef(0x22e)+_0x3226ff+'/'+new Date()[_0xaabbef(0x1ec)]()+_0xaabbef(0x1eb);return new Promise((_0x1c8a96,_0x2c9620)=>{const _0x413159=_0xaabbef;(0x0,child_process_1[_0x413159(0x214)])(ffmpeg_static_1[_0x413159(0x20a)]+_0x413159(0x211)+_0x1f9921+_0x413159(0x212)+_0x5ce0a4+_0x413159(0x234),(_0x9499c1,_0x4f573f,_0x5ab07a)=>{const _0x4b9ad1=_0x413159;if(_0x9499c1)_0x2c9620(_0x9499c1);fs_1[_0x4b9ad1(0x20a)]['unlinkSync'](_0x1f9921),_0x1c8a96(_0x5ce0a4);});});},processAudioFile=async _0x83989e=>{const _0x4ddfc4=a550_0x52265a,_0x452fce=publicFolder+'/'+new Date()[_0x4ddfc4(0x1ec)]()+_0x4ddfc4(0x1eb);return new Promise((_0x5efa02,_0x28e3af)=>{const _0x318a1a=_0x4ddfc4;(0x0,child_process_1[_0x318a1a(0x214)])(ffmpeg_static_1[_0x318a1a(0x20a)]+'\x20-i\x20'+_0x83989e+_0x318a1a(0x202)+_0x452fce,(_0x3c5af4,_0x112e7b,_0x11d80d)=>{const _0x2e3550=_0x318a1a;if(_0x3c5af4)_0x28e3af(_0x3c5af4);fs_1[_0x2e3550(0x20a)]['unlinkSync'](_0x83989e),_0x5efa02(_0x452fce);});});},getMessageOptions=async(_0x250deb,_0x20fc56,_0x3a4aa5,_0xef5a64)=>{const _0x3f1ae1=a550_0x52265a,_0x5bf159=mime_types_1[_0x3f1ae1(0x20a)]['lookup'](_0x20fc56),_0x43ea0d=_0x5bf159['split']('/')[0x0];try{if(!_0x5bf159)throw new Error(_0x3f1ae1(0x1e5));let _0x36a021;if(_0x43ea0d===_0x3f1ae1(0x1f0))_0x36a021={'video':fs_1[_0x3f1ae1(0x20a)][_0x3f1ae1(0x1ee)](_0x20fc56),'caption':_0x3a4aa5?_0x3a4aa5:'','fileName':_0x250deb};else{if(_0x43ea0d===_0x3f1ae1(0x240)){const _0x181321=!![],_0x24f1d0=await processAudio(_0x20fc56,_0xef5a64);_0x181321?_0x36a021={'audio':fs_1[_0x3f1ae1(0x20a)][_0x3f1ae1(0x1ee)](_0x24f1d0),'mimetype':_0x181321?_0x3f1ae1(0x1f2):_0x5bf159,'caption':_0x3a4aa5?_0x3a4aa5:null,'ptt':!![]}:_0x36a021={'audio':fs_1[_0x3f1ae1(0x20a)][_0x3f1ae1(0x1ee)](_0x24f1d0),'mimetype':_0x181321?_0x3f1ae1(0x1f2):_0x5bf159,'caption':_0x3a4aa5?_0x3a4aa5:null,'ptt':!![]};}else{if(_0x43ea0d===_0x3f1ae1(0x20b))_0x36a021={'document':fs_1['default'][_0x3f1ae1(0x1ee)](_0x20fc56),'caption':_0x3a4aa5?_0x3a4aa5:null,'fileName':_0x250deb,'mimetype':_0x5bf159};else _0x43ea0d==='application'?_0x36a021={'document':fs_1[_0x3f1ae1(0x20a)][_0x3f1ae1(0x1ee)](_0x20fc56),'caption':_0x3a4aa5?_0x3a4aa5:null,'fileName':_0x250deb,'mimetype':_0x5bf159}:_0x36a021={'image':fs_1['default']['readFileSync'](_0x20fc56),'caption':_0x3a4aa5?_0x3a4aa5:null};}}return _0x36a021;}catch(_0x2a495b){return Sentry[_0x3f1ae1(0x237)](_0x2a495b),console['log'](_0x2a495b),null;}};exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x26dcd1,ticket:_0x121204,body:_0x58bece})=>{const _0x4a7914=a550_0x52265a;try{const _0x1adb83=await(0x0,GetTicketWbot_1[_0x4a7914(0x20a)])(_0x121204),_0x564521=_0x26dcd1['path'],_0x1c9744=_0x26dcd1[_0x4a7914(0x203)]['split']('/')[0x0];let _0x2d7e23;const _0x5b2871=(0x0,Mustache_1['default'])(_0x58bece,_0x121204);var _0x2eb116=_0x26dcd1['filename'];if(_0x1c9744===_0x4a7914(0x1f0))_0x2d7e23={'video':fs_1[_0x4a7914(0x20a)]['readFileSync'](_0x564521),'caption':_0x5b2871,'fileName':_0x26dcd1['originalname']};else{if(_0x1c9744==='audio'){const _0x57445f=_0x26dcd1['originalname']['includes']('audio-record-site');if(_0x57445f){const _0x2dbabe=await processAudio(_0x26dcd1[_0x4a7914(0x220)],_0x121204[_0x4a7914(0x20d)]);_0x2d7e23={'audio':fs_1['default']['readFileSync'](_0x2dbabe),'mimetype':_0x57445f?'audio/mp4':_0x26dcd1[_0x4a7914(0x203)],'ptt':!![]},_0x2eb116=_0x2dbabe['split']('/')[_0x2dbabe['split']('/')['length']-0x1];}else{const _0x3b0b86=await processAudioFile(_0x26dcd1[_0x4a7914(0x220)]);_0x2d7e23={'audio':fs_1[_0x4a7914(0x20a)][_0x4a7914(0x1ee)](_0x3b0b86),'mimetype':_0x57445f?_0x4a7914(0x1f2):_0x26dcd1[_0x4a7914(0x203)]},_0x2eb116=_0x3b0b86[_0x4a7914(0x1ea)]('/')[_0x3b0b86[_0x4a7914(0x1ea)]('/')[_0x4a7914(0x219)]-0x1];}}else{if(_0x1c9744===_0x4a7914(0x20b)||_0x1c9744===_0x4a7914(0x1e9))_0x2d7e23={'document':fs_1[_0x4a7914(0x20a)][_0x4a7914(0x1ee)](_0x564521),'caption':_0x5b2871,'fileName':_0x26dcd1[_0x4a7914(0x20f)],'mimetype':_0x26dcd1[_0x4a7914(0x203)]};else _0x1c9744===_0x4a7914(0x22f)?_0x2d7e23={'document':fs_1[_0x4a7914(0x20a)][_0x4a7914(0x1ee)](_0x564521),'caption':_0x5b2871,'fileName':_0x26dcd1[_0x4a7914(0x20f)],'mimetype':_0x26dcd1['mimetype']}:_0x2d7e23={'image':fs_1[_0x4a7914(0x20a)][_0x4a7914(0x1ee)](_0x564521),'caption':_0x5b2871};}}var _0x1f212a=await _0x1adb83['sendMessage'](_0x121204[_0x4a7914(0x242)]['number']+'@'+(_0x121204[_0x4a7914(0x204)]?_0x4a7914(0x210):_0x4a7914(0x1e1)),{..._0x2d7e23});const _0x27ebae=await(0x0,wbotMessageListener_1[_0x4a7914(0x1e7)])(_0x1f212a),_0x1186cf={'id':_0x1f212a[_0x4a7914(0x1e4)]['id'],'ticketId':_0x121204['id'],'contactId':undefined,'body':_0x58bece?(0x0,Mustache_1['default'])(_0x58bece,_0x121204):(0x0,wbotMessageListener_1['getBodyMessage'])(_0x1f212a),'fromMe':_0x1f212a[_0x4a7914(0x1e4)][_0x4a7914(0x1fe)],'read':_0x1f212a[_0x4a7914(0x1e4)]['fromMe'],'mediaUrl':_0x2eb116,'mediaType':_0x1c9744,'quotedMsgId':_0x27ebae?.['id'],'ack':0x0,'remoteJid':_0x1f212a[_0x4a7914(0x1e4)][_0x4a7914(0x1f4)],'participant':_0x1f212a['key'][_0x4a7914(0x21e)],'dataJson':JSON[_0x4a7914(0x207)](_0x1f212a)};return typeof _0x1186cf[_0x4a7914(0x1ef)]!=_0x4a7914(0x20c)&&console[_0x4a7914(0x21f)](_0x4a7914(0x249),_0x1186cf[_0x4a7914(0x1ef)]),await _0x121204['update']({'lastMessage':_0x1186cf[_0x4a7914(0x1ef)]}),await(0x0,CreateMessageService_1[_0x4a7914(0x20a)])({'messageData':_0x1186cf,'ticket':_0x121204,'companyId':_0x121204['companyId']}),_0x1f212a;}catch(_0x35ec08){Sentry[_0x4a7914(0x237)](_0x35ec08),console[_0x4a7914(0x21f)](_0x35ec08);throw new AppError_1['default'](_0x4a7914(0x21d));}};exports[a550_0x52265a(0x20a)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x2f8b09,_0x33d2a9,_0x509132)=>{const _0x48dbfa=a550_0x52265a;try{const _0xf9171=await(0x0,GetTicketWbot_1[_0x48dbfa(0x20a)])(_0x33d2a9);_0x2f8b09[_0x48dbfa(0x226)](_0x48dbfa(0x218))&&(_0x2f8b09=_0x48dbfa(0x246)+_0x2f8b09[_0x48dbfa(0x1ea)]('/public')[0x1]);const _0x2a9cf4=_0x2f8b09,_0x2a6f79=getMimeType(_0x2f8b09)[_0x48dbfa(0x1ea)]('/')[0x0];let _0xd18cc4;if(_0x2a6f79===_0x48dbfa(0x1f0))_0xd18cc4={'video':fs_1[_0x48dbfa(0x20a)][_0x48dbfa(0x1ee)](_0x2a9cf4),'caption':_0x509132,'fileName':extractFileName(_0x2f8b09)};else{if(_0x2a6f79==='audio'){const _0x271951=_0x2f8b09[_0x48dbfa(0x1ed)](_0x48dbfa(0x243));if(_0x271951){const _0x1edd11=await processAudio(_0x2f8b09,_0x33d2a9[_0x48dbfa(0x20d)]);_0xd18cc4={'audio':fs_1[_0x48dbfa(0x20a)][_0x48dbfa(0x1ee)](_0x1edd11),'mimetype':_0x271951?_0x48dbfa(0x1f2):getMimeType(_0x2f8b09),'ptt':!![]};}else{const _0x147f3e=await processAudioFile(_0x2f8b09);_0xd18cc4={'audio':fs_1['default'][_0x48dbfa(0x1ee)](_0x147f3e),'mimetype':_0x271951?_0x48dbfa(0x1f2):getMimeType(_0x2f8b09)};}}else{if(_0x2a6f79==='document'||_0x2a6f79===_0x48dbfa(0x1e9))_0xd18cc4={'document':fs_1[_0x48dbfa(0x20a)][_0x48dbfa(0x1ee)](_0x2a9cf4),'caption':_0x509132,'fileName':extractFileName(_0x2f8b09),'mimetype':getMimeType(_0x2f8b09)};else _0x2a6f79==='application'?_0xd18cc4={'document':fs_1['default'][_0x48dbfa(0x1ee)](_0x2a9cf4),'caption':_0x509132,'fileName':extractFileName(_0x2f8b09),'mimetype':getMimeType(_0x2f8b09)}:_0xd18cc4={'image':fs_1[_0x48dbfa(0x20a)]['readFileSync'](_0x2a9cf4),'caption':_0x509132};}}const _0x1534b2=await _0xf9171[_0x48dbfa(0x20e)](_0x33d2a9[_0x48dbfa(0x242)][_0x48dbfa(0x1f6)]+'@'+(_0x33d2a9[_0x48dbfa(0x204)]?_0x48dbfa(0x210):'s.whatsapp.net'),{..._0xd18cc4});return _0x1534b2;}catch(_0xbc312e){Sentry[_0x48dbfa(0x237)](_0xbc312e),console[_0x48dbfa(0x229)](_0xbc312e);throw new AppError_1[(_0x48dbfa(0x20a))](_0x48dbfa(0x21d));}};exports[a550_0x52265a(0x224)]=SendWhatsAppMediaFileAddress;const extractFileName=_0x44833a=>{const _0x5aed20=a550_0x52265a,_0x3cd380=_0x44833a['split']('/');return _0x3cd380[_0x3cd380[_0x5aed20(0x219)]-0x1];},extractFilePath=_0x1176a0=>{const _0x5f5a43=a550_0x52265a,_0x284ed5=_0x1176a0[_0x5f5a43(0x1ea)]('/');return _0x284ed5[_0x5f5a43(0x241)](),_0x284ed5[_0x5f5a43(0x22c)]('/');},getMimeType=_0x35fce2=>{const _0x5b2495=a550_0x52265a,_0xe24f8=_0x35fce2[_0x5b2495(0x1ea)]('.'),_0x50474e=_0xe24f8[_0xe24f8['length']-0x1],_0x37ad2a={'jpg':_0x5b2495(0x1f8),'jpeg':_0x5b2495(0x1f8),'png':_0x5b2495(0x221),'gif':_0x5b2495(0x232),'mp4':'video/mp4','mp3':_0x5b2495(0x245),'m4a':_0x5b2495(0x1f2),'ogg':_0x5b2495(0x23e),'pdf':_0x5b2495(0x227),'doc':_0x5b2495(0x1e2),'docx':_0x5b2495(0x1fc),'xls':_0x5b2495(0x1fd),'xlsx':'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','ppt':_0x5b2495(0x1f1),'pptx':_0x5b2495(0x23d),'txt':_0x5b2495(0x247),'rtf':_0x5b2495(0x22d),'csv':_0x5b2495(0x206),'html':_0x5b2495(0x23a),'zip':_0x5b2495(0x238),'rar':_0x5b2495(0x216),'7z':'application/x-7z-compressed','3gp':_0x5b2495(0x222),'3g2':_0x5b2495(0x21b),'3ga':_0x5b2495(0x222),'7gp':_0x5b2495(0x21b),'7ga':_0x5b2495(0x222),'3gpp':_0x5b2495(0x222),'3gpp2':_0x5b2495(0x21b),'7gpp':_0x5b2495(0x222),'7gpp2':_0x5b2495(0x21b),'3gpp-tt':_0x5b2495(0x222),'3gpp2-tt':_0x5b2495(0x21b),'7gpp-tt':_0x5b2495(0x222),'7gpp2-tt':_0x5b2495(0x21b),'3gpp-rtt':_0x5b2495(0x222),'3gpp2-rtt':_0x5b2495(0x21b),'7gpp-rtt':_0x5b2495(0x222),'7gpp2-rtt':_0x5b2495(0x21b),'3gpp-sms':_0x5b2495(0x222),'3gpp2-sms':_0x5b2495(0x21b),'7gpp-sms':_0x5b2495(0x222),'7gpp2-sms':_0x5b2495(0x21b),'pdfa':'application/pdf','x-pdf':'application/pdf'};if(_0x37ad2a[_0x50474e])return _0x37ad2a[_0x50474e];return _0x5b2495(0x1f5);};