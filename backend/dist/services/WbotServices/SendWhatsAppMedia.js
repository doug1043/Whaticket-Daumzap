function a551_0x26cf(_0x3a50ad,_0x2fa2e5){const _0x1c68fa=a551_0x7554();return a551_0x26cf=function(_0x4743d0,_0xb0f766){_0x4743d0=_0x4743d0-0x1d0;let _0x75543e=_0x1c68fa[_0x4743d0];return _0x75543e;},a551_0x26cf(_0x3a50ad,_0x2fa2e5);}const a551_0x101931=a551_0x26cf;function a551_0x7554(){const _0x5248e0=['apply','resolve','23957956ksOXaT','body\x20is\x20not\x20a\x20string','/public','./public','toString','video/mp4','exec','remoteJid','length','video','application/msword','sendMessage','10556kVfqjo','participant','child_process','24MvtcCn','setFfmpegPath','ERR_SENDING_WAPP_MSG','getOwnPropertyDescriptor','update','getMessageOptions','join','./wbotMessageListener','g.us','2JGIRKG','filename','8626152RwHJii','configurable','__importDefault','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','SendWhatsAppMediaFileAddress','audio','path','key','application/rtf','text/plain','verifyQuotedMessage','../../errors/AppError','trace','4008iNNhFb','video/3gpp2','application/octet-stream','audio-record-site','../MessageServices/CreateMessageService','126jxyNru','get','@sentry/node','captureException','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','/company','text/html','readFileSync','ffmpeg-static','originalname','search','prototype','split','application/x-7z-compressed','text','unlinkSync','writable','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','text/csv','includes','number','mimetype','pop','defineProperty','create','../../helpers/GetTicketWbot','application/pdf','(((.+)+)+)+$','audio/mp4','\x20-i\x20','hasOwnProperty','application/vnd.openxmlformats-officedocument.wordprocessingml.document','860032rVggtA','companyId','startsWith','1121301bCfPFb','.mp3','default','12gqkvXg','__createBinding','document','log','__esModule','__setModuleDefault','audio/ogg','isGroup','body','s.whatsapp.net','mime-types','17745FfnVlM','803050MJhTfR','audio/mp3','lookup','video/3gpp','__importStar','contact','image/jpeg','application'];a551_0x7554=function(){return _0x5248e0;};return a551_0x7554();}(function(_0x32a353,_0x3c9b52){const _0x11cd7b=a551_0x26cf,_0x284fe2=_0x32a353();while(!![]){try{const _0x2010e0=-parseInt(_0x11cd7b(0x235))/0x1*(parseInt(_0x11cd7b(0x201))/0x2)+parseInt(_0x11cd7b(0x204))/0x3+parseInt(_0x11cd7b(0x207))/0x4*(parseInt(_0x11cd7b(0x212))/0x5)+parseInt(_0x11cd7b(0x1dc))/0x6*(-parseInt(_0x11cd7b(0x229))/0x7)+-parseInt(_0x11cd7b(0x237))/0x8+-parseInt(_0x11cd7b(0x1e1))/0x9*(parseInt(_0x11cd7b(0x213))/0xa)+-parseInt(_0x11cd7b(0x21d))/0xb*(-parseInt(_0x11cd7b(0x22c))/0xc);if(_0x2010e0===_0x3c9b52)break;else _0x284fe2['push'](_0x284fe2['shift']());}catch(_0x159c0c){_0x284fe2['push'](_0x284fe2['shift']());}}}(a551_0x7554,0xa3b1b));const a551_0xb0f766=(function(){let _0x31cb9c=!![];return function(_0x24152d,_0x5a23f5){const _0x345df7=_0x31cb9c?function(){const _0x7ac655=a551_0x26cf;if(_0x5a23f5){const _0x24ca86=_0x5a23f5[_0x7ac655(0x21b)](_0x24152d,arguments);return _0x5a23f5=null,_0x24ca86;}}:function(){};return _0x31cb9c=![],_0x345df7;};}()),a551_0x4743d0=a551_0xb0f766(this,function(){const _0x189c17=a551_0x26cf;return a551_0x4743d0[_0x189c17(0x221)]()[_0x189c17(0x1eb)](_0x189c17(0x1fc))[_0x189c17(0x221)]()['constructor'](a551_0x4743d0)[_0x189c17(0x1eb)](_0x189c17(0x1fc));});a551_0x4743d0();'use strict';var __createBinding=this&&this[a551_0x101931(0x208)]||(Object[a551_0x101931(0x1f9)]?function(_0x1b9aec,_0x370df9,_0x37737a,_0x2bf283){const _0x486d3b=a551_0x101931;if(_0x2bf283===undefined)_0x2bf283=_0x37737a;var _0x5a8c20=Object[_0x486d3b(0x22f)](_0x370df9,_0x37737a);(!_0x5a8c20||(_0x486d3b(0x1e2)in _0x5a8c20?!_0x370df9[_0x486d3b(0x20b)]:_0x5a8c20[_0x486d3b(0x1f1)]||_0x5a8c20[_0x486d3b(0x1d0)]))&&(_0x5a8c20={'enumerable':!![],'get':function(){return _0x370df9[_0x37737a];}}),Object['defineProperty'](_0x1b9aec,_0x2bf283,_0x5a8c20);}:function(_0x3a1e0c,_0x16fac1,_0x324005,_0x5596d3){if(_0x5596d3===undefined)_0x5596d3=_0x324005;_0x3a1e0c[_0x5596d3]=_0x16fac1[_0x324005];}),__setModuleDefault=this&&this[a551_0x101931(0x20c)]||(Object[a551_0x101931(0x1f9)]?function(_0x213560,_0x22596e){const _0x145957=a551_0x101931;Object['defineProperty'](_0x213560,_0x145957(0x206),{'enumerable':!![],'value':_0x22596e});}:function(_0x1fdc79,_0x4af5d6){const _0x27c7aa=a551_0x101931;_0x1fdc79[_0x27c7aa(0x206)]=_0x4af5d6;}),__importStar=this&&this[a551_0x101931(0x217)]||function(_0x29f7e3){const _0x5bfdb0=a551_0x101931;if(_0x29f7e3&&_0x29f7e3['__esModule'])return _0x29f7e3;var _0x1183ff={};if(_0x29f7e3!=null){for(var _0x3cbfdf in _0x29f7e3)if(_0x3cbfdf!==_0x5bfdb0(0x206)&&Object[_0x5bfdb0(0x1ec)][_0x5bfdb0(0x1ff)]['call'](_0x29f7e3,_0x3cbfdf))__createBinding(_0x1183ff,_0x29f7e3,_0x3cbfdf);}return __setModuleDefault(_0x1183ff,_0x29f7e3),_0x1183ff;},__importDefault=this&&this[a551_0x101931(0x1d1)]||function(_0x4e2089){const _0x45dc97=a551_0x101931;return _0x4e2089&&_0x4e2089[_0x45dc97(0x20b)]?_0x4e2089:{'default':_0x4e2089};};Object[a551_0x101931(0x1f8)](exports,a551_0x101931(0x20b),{'value':!![]}),exports['SendWhatsAppMediaFileAddress']=exports[a551_0x101931(0x231)]=void 0x0;const Sentry=__importStar(require(a551_0x101931(0x1e3))),fs_1=__importDefault(require('fs')),child_process_1=require(a551_0x101931(0x22b)),path_1=__importDefault(require('path')),fluent_ffmpeg_1=__importDefault(require('fluent-ffmpeg')),AppError_1=__importDefault(require(a551_0x101931(0x1da))),GetTicketWbot_1=__importDefault(require(a551_0x101931(0x1fa))),mime_types_1=__importDefault(require(a551_0x101931(0x211))),Mustache_1=__importDefault(require('../../helpers/Mustache')),ffmpeg_static_1=__importDefault(require(a551_0x101931(0x1e9))),CreateMessageService_1=__importDefault(require(a551_0x101931(0x1e0))),wbotMessageListener_1=require(a551_0x101931(0x233));fluent_ffmpeg_1[a551_0x101931(0x206)][a551_0x101931(0x22d)](ffmpeg_static_1[a551_0x101931(0x206)]);const publicFolder=path_1['default'][a551_0x101931(0x21c)](__dirname,'..','..','..','public'),processAudio=async(_0x3aa595,_0x49a70d)=>{const _0x46540f=a551_0x101931,_0xba7b5d=publicFolder+_0x46540f(0x1e6)+_0x49a70d+'/'+new Date()['getTime']()+_0x46540f(0x205);return new Promise((_0x37c2f1,_0x3c7205)=>{const _0xff82bf=_0x46540f;(0x0,child_process_1['exec'])(ffmpeg_static_1[_0xff82bf(0x206)]+'\x20-i\x20'+_0x3aa595+_0xff82bf(0x1f2)+_0xba7b5d+'\x20-y',(_0x51890d,_0x3b7044,_0x12d91d)=>{const _0x11cbfe=_0xff82bf;if(_0x51890d)_0x3c7205(_0x51890d);fs_1[_0x11cbfe(0x206)][_0x11cbfe(0x1f0)](_0x3aa595),_0x37c2f1(_0xba7b5d);});});},processAudioFile=async _0x34ac69=>{const _0x3f5433=a551_0x101931,_0x11daa4=publicFolder+'/'+new Date()['getTime']()+_0x3f5433(0x205);return new Promise((_0x15446b,_0xd34a6)=>{const _0x49d9c9=_0x3f5433;(0x0,child_process_1[_0x49d9c9(0x223)])(ffmpeg_static_1[_0x49d9c9(0x206)]+_0x49d9c9(0x1fe)+_0x34ac69+_0x49d9c9(0x1d2)+_0x11daa4,(_0x348062,_0x951c9e,_0x495ea1)=>{const _0xe76c80=_0x49d9c9;if(_0x348062)_0xd34a6(_0x348062);fs_1[_0xe76c80(0x206)][_0xe76c80(0x1f0)](_0x34ac69),_0x15446b(_0x11daa4);});});},getMessageOptions=async(_0x4af3f3,_0x460074,_0x5d85ed,_0x264d1e)=>{const _0x230ec5=a551_0x101931,_0x515956=mime_types_1[_0x230ec5(0x206)][_0x230ec5(0x215)](_0x460074),_0x42bb34=_0x515956[_0x230ec5(0x1ed)]('/')[0x0];try{if(!_0x515956)throw new Error('Invalid\x20mimetype');let _0x5a3526;if(_0x42bb34===_0x230ec5(0x226))_0x5a3526={'video':fs_1[_0x230ec5(0x206)]['readFileSync'](_0x460074),'caption':_0x5d85ed?_0x5d85ed:'','fileName':_0x4af3f3};else{if(_0x42bb34==='audio'){const _0x45c479=!![],_0x453404=await processAudio(_0x460074,_0x264d1e);_0x45c479?_0x5a3526={'audio':fs_1[_0x230ec5(0x206)]['readFileSync'](_0x453404),'mimetype':_0x45c479?_0x230ec5(0x1fd):_0x515956,'caption':_0x5d85ed?_0x5d85ed:null,'ptt':!![]}:_0x5a3526={'audio':fs_1[_0x230ec5(0x206)][_0x230ec5(0x1e8)](_0x453404),'mimetype':_0x45c479?_0x230ec5(0x1fd):_0x515956,'caption':_0x5d85ed?_0x5d85ed:null,'ptt':!![]};}else{if(_0x42bb34===_0x230ec5(0x209))_0x5a3526={'document':fs_1[_0x230ec5(0x206)]['readFileSync'](_0x460074),'caption':_0x5d85ed?_0x5d85ed:null,'fileName':_0x4af3f3,'mimetype':_0x515956};else _0x42bb34===_0x230ec5(0x21a)?_0x5a3526={'document':fs_1['default'][_0x230ec5(0x1e8)](_0x460074),'caption':_0x5d85ed?_0x5d85ed:null,'fileName':_0x4af3f3,'mimetype':_0x515956}:_0x5a3526={'image':fs_1[_0x230ec5(0x206)][_0x230ec5(0x1e8)](_0x460074),'caption':_0x5d85ed?_0x5d85ed:null};}}return _0x5a3526;}catch(_0x5192e1){return Sentry[_0x230ec5(0x1e4)](_0x5192e1),console['log'](_0x5192e1),null;}};exports[a551_0x101931(0x231)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x1ece6b,ticket:_0x224a30,body:_0x5ed29d})=>{const _0x5b134f=a551_0x101931;try{const _0xf45f1=await(0x0,GetTicketWbot_1['default'])(_0x224a30),_0x4d7469=_0x1ece6b['path'],_0x3f08e3=_0x1ece6b[_0x5b134f(0x1f6)]['split']('/')[0x0];let _0x290620;const _0x148ac0=(0x0,Mustache_1[_0x5b134f(0x206)])(_0x5ed29d,_0x224a30);var _0x28372f=_0x1ece6b[_0x5b134f(0x236)];if(_0x3f08e3===_0x5b134f(0x226))_0x290620={'video':fs_1[_0x5b134f(0x206)]['readFileSync'](_0x4d7469),'caption':_0x148ac0,'fileName':_0x1ece6b[_0x5b134f(0x1ea)]};else{if(_0x3f08e3===_0x5b134f(0x1d4)){const _0x2041b4=_0x1ece6b['originalname'][_0x5b134f(0x1f4)]('audio-record-site');if(_0x2041b4){const _0x370838=await processAudio(_0x1ece6b[_0x5b134f(0x1d5)],_0x224a30[_0x5b134f(0x202)]);_0x290620={'audio':fs_1[_0x5b134f(0x206)][_0x5b134f(0x1e8)](_0x370838),'mimetype':_0x2041b4?_0x5b134f(0x1fd):_0x1ece6b['mimetype'],'ptt':!![]},_0x28372f=_0x370838['split']('/')[_0x370838[_0x5b134f(0x1ed)]('/')['length']-0x1];}else{const _0x266762=await processAudioFile(_0x1ece6b[_0x5b134f(0x1d5)]);_0x290620={'audio':fs_1['default'][_0x5b134f(0x1e8)](_0x266762),'mimetype':_0x2041b4?_0x5b134f(0x1fd):_0x1ece6b[_0x5b134f(0x1f6)]},_0x28372f=_0x266762[_0x5b134f(0x1ed)]('/')[_0x266762['split']('/')['length']-0x1];}}else{if(_0x3f08e3==='document'||_0x3f08e3===_0x5b134f(0x1ef))_0x290620={'document':fs_1[_0x5b134f(0x206)]['readFileSync'](_0x4d7469),'caption':_0x148ac0,'fileName':_0x1ece6b[_0x5b134f(0x1ea)],'mimetype':_0x1ece6b['mimetype']};else _0x3f08e3===_0x5b134f(0x21a)?_0x290620={'document':fs_1[_0x5b134f(0x206)][_0x5b134f(0x1e8)](_0x4d7469),'caption':_0x148ac0,'fileName':_0x1ece6b[_0x5b134f(0x1ea)],'mimetype':_0x1ece6b['mimetype']}:_0x290620={'image':fs_1[_0x5b134f(0x206)][_0x5b134f(0x1e8)](_0x4d7469),'caption':_0x148ac0};}}var _0x55fc41=await _0xf45f1['sendMessage'](_0x224a30[_0x5b134f(0x218)][_0x5b134f(0x1f5)]+'@'+(_0x224a30[_0x5b134f(0x20e)]?_0x5b134f(0x234):_0x5b134f(0x210)),{..._0x290620});const _0x2e5813=await(0x0,wbotMessageListener_1[_0x5b134f(0x1d9)])(_0x55fc41),_0x55b158={'id':_0x55fc41['key']['id'],'ticketId':_0x224a30['id'],'contactId':undefined,'body':_0x5ed29d?(0x0,Mustache_1[_0x5b134f(0x206)])(_0x5ed29d,_0x224a30):(0x0,wbotMessageListener_1['getBodyMessage'])(_0x55fc41),'fromMe':_0x55fc41[_0x5b134f(0x1d6)]['fromMe'],'read':_0x55fc41[_0x5b134f(0x1d6)]['fromMe'],'mediaUrl':_0x28372f,'mediaType':_0x3f08e3,'quotedMsgId':_0x2e5813?.['id'],'ack':0x0,'remoteJid':_0x55fc41['key'][_0x5b134f(0x224)],'participant':_0x55fc41['key'][_0x5b134f(0x22a)],'dataJson':JSON['stringify'](_0x55fc41)};return typeof _0x55b158[_0x5b134f(0x20f)]!='string'&&console[_0x5b134f(0x1db)](_0x5b134f(0x21e),_0x55b158[_0x5b134f(0x20f)]),await _0x224a30[_0x5b134f(0x230)]({'lastMessage':_0x55b158[_0x5b134f(0x20f)]}),await(0x0,CreateMessageService_1[_0x5b134f(0x206)])({'messageData':_0x55b158,'ticket':_0x224a30,'companyId':_0x224a30[_0x5b134f(0x202)]}),_0x55fc41;}catch(_0x3c009f){Sentry[_0x5b134f(0x1e4)](_0x3c009f),console[_0x5b134f(0x1db)](_0x3c009f);throw new AppError_1['default'](_0x5b134f(0x22e));}};exports[a551_0x101931(0x206)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x4bc68b,_0x188e1c,_0x2148c7)=>{const _0x2fe6b3=a551_0x101931;try{const _0x4d5241=await(0x0,GetTicketWbot_1[_0x2fe6b3(0x206)])(_0x188e1c);_0x4bc68b[_0x2fe6b3(0x203)]('http')&&(_0x4bc68b=_0x2fe6b3(0x220)+_0x4bc68b['split'](_0x2fe6b3(0x21f))[0x1]);const _0x5169a3=_0x4bc68b,_0x360d52=getMimeType(_0x4bc68b)['split']('/')[0x0];let _0x264756;if(_0x360d52===_0x2fe6b3(0x226))_0x264756={'video':fs_1[_0x2fe6b3(0x206)][_0x2fe6b3(0x1e8)](_0x5169a3),'caption':_0x2148c7,'fileName':extractFileName(_0x4bc68b)};else{if(_0x360d52===_0x2fe6b3(0x1d4)){const _0x3e9c18=_0x4bc68b[_0x2fe6b3(0x1f4)](_0x2fe6b3(0x1df));if(_0x3e9c18){const _0x1ffd63=await processAudio(_0x4bc68b,_0x188e1c[_0x2fe6b3(0x202)]);_0x264756={'audio':fs_1['default'][_0x2fe6b3(0x1e8)](_0x1ffd63),'mimetype':_0x3e9c18?_0x2fe6b3(0x1fd):getMimeType(_0x4bc68b),'ptt':!![]};}else{const _0x2c2a64=await processAudioFile(_0x4bc68b);_0x264756={'audio':fs_1[_0x2fe6b3(0x206)]['readFileSync'](_0x2c2a64),'mimetype':_0x3e9c18?'audio/mp4':getMimeType(_0x4bc68b)};}}else{if(_0x360d52===_0x2fe6b3(0x209)||_0x360d52==='text')_0x264756={'document':fs_1[_0x2fe6b3(0x206)][_0x2fe6b3(0x1e8)](_0x5169a3),'caption':_0x2148c7,'fileName':extractFileName(_0x4bc68b),'mimetype':getMimeType(_0x4bc68b)};else _0x360d52===_0x2fe6b3(0x21a)?_0x264756={'document':fs_1[_0x2fe6b3(0x206)][_0x2fe6b3(0x1e8)](_0x5169a3),'caption':_0x2148c7,'fileName':extractFileName(_0x4bc68b),'mimetype':getMimeType(_0x4bc68b)}:_0x264756={'image':fs_1['default'][_0x2fe6b3(0x1e8)](_0x5169a3),'caption':_0x2148c7};}}const _0x2917e4=await _0x4d5241[_0x2fe6b3(0x228)](_0x188e1c[_0x2fe6b3(0x218)][_0x2fe6b3(0x1f5)]+'@'+(_0x188e1c[_0x2fe6b3(0x20e)]?_0x2fe6b3(0x234):_0x2fe6b3(0x210)),{..._0x264756});return _0x2917e4;}catch(_0x527c7a){Sentry[_0x2fe6b3(0x1e4)](_0x527c7a),console[_0x2fe6b3(0x20a)](_0x527c7a);throw new AppError_1['default']('ERR_SENDING_WAPP_MSG');}};exports[a551_0x101931(0x1d3)]=SendWhatsAppMediaFileAddress;const extractFileName=_0x18678d=>{const _0x33ef16=a551_0x101931,_0x1050d8=_0x18678d[_0x33ef16(0x1ed)]('/');return _0x1050d8[_0x1050d8[_0x33ef16(0x225)]-0x1];},extractFilePath=_0x19881f=>{const _0x2fd8f3=a551_0x101931,_0x38f2b8=_0x19881f[_0x2fd8f3(0x1ed)]('/');return _0x38f2b8[_0x2fd8f3(0x1f7)](),_0x38f2b8[_0x2fd8f3(0x232)]('/');},getMimeType=_0xcfbb74=>{const _0x3f8837=a551_0x101931,_0x2c1b66=_0xcfbb74[_0x3f8837(0x1ed)]('.'),_0x51f26a=_0x2c1b66[_0x2c1b66[_0x3f8837(0x225)]-0x1],_0x53065b={'jpg':_0x3f8837(0x219),'jpeg':_0x3f8837(0x219),'png':'image/png','gif':'image/gif','mp4':_0x3f8837(0x222),'mp3':_0x3f8837(0x214),'m4a':'audio/mp4','ogg':_0x3f8837(0x20d),'pdf':_0x3f8837(0x1fb),'doc':_0x3f8837(0x227),'docx':_0x3f8837(0x200),'xls':'application/vnd.ms-excel','xlsx':_0x3f8837(0x1e5),'ppt':'application/vnd.ms-powerpoint','pptx':'application/vnd.openxmlformats-officedocument.presentationml.presentation','txt':_0x3f8837(0x1d8),'rtf':_0x3f8837(0x1d7),'csv':_0x3f8837(0x1f3),'html':_0x3f8837(0x1e7),'zip':'application/zip','rar':'application/x-rar-compressed','7z':_0x3f8837(0x1ee),'3gp':_0x3f8837(0x216),'3g2':_0x3f8837(0x1dd),'3ga':_0x3f8837(0x216),'7gp':'video/3gpp2','7ga':_0x3f8837(0x216),'3gpp':_0x3f8837(0x216),'3gpp2':_0x3f8837(0x1dd),'7gpp':_0x3f8837(0x216),'7gpp2':'video/3gpp2','3gpp-tt':'video/3gpp','3gpp2-tt':_0x3f8837(0x1dd),'7gpp-tt':_0x3f8837(0x216),'7gpp2-tt':_0x3f8837(0x1dd),'3gpp-rtt':_0x3f8837(0x216),'3gpp2-rtt':_0x3f8837(0x1dd),'7gpp-rtt':_0x3f8837(0x216),'7gpp2-rtt':_0x3f8837(0x1dd),'3gpp-sms':'video/3gpp','3gpp2-sms':'video/3gpp2','7gpp-sms':_0x3f8837(0x216),'7gpp2-sms':_0x3f8837(0x1dd),'pdfa':_0x3f8837(0x1fb),'x-pdf':_0x3f8837(0x1fb)};if(_0x53065b[_0x51f26a])return _0x53065b[_0x51f26a];return _0x3f8837(0x1de);};