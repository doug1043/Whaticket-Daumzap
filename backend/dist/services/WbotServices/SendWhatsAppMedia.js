'use strict';const a571_0x124fbb=a571_0x444d;(function(_0x441332,_0x505cd7){const _0x180577=a571_0x444d,_0x5311d8=_0x441332();while(!![]){try{const _0x408302=-parseInt(_0x180577(0x16c))/0x1+-parseInt(_0x180577(0x186))/0x2*(-parseInt(_0x180577(0x172))/0x3)+-parseInt(_0x180577(0x16e))/0x4*(parseInt(_0x180577(0x178))/0x5)+-parseInt(_0x180577(0x173))/0x6*(-parseInt(_0x180577(0x1a9))/0x7)+-parseInt(_0x180577(0x19c))/0x8*(-parseInt(_0x180577(0x18f))/0x9)+parseInt(_0x180577(0x1a0))/0xa*(-parseInt(_0x180577(0x18e))/0xb)+-parseInt(_0x180577(0x184))/0xc*(-parseInt(_0x180577(0x17c))/0xd);if(_0x408302===_0x505cd7)break;else _0x5311d8['push'](_0x5311d8['shift']());}catch(_0x591ec7){_0x5311d8['push'](_0x5311d8['shift']());}}}(a571_0x281c,0x85e83));function a571_0x444d(_0x1ff303,_0x3a76d9){const _0x1055f7=a571_0x281c();return a571_0x444d=function(_0x3bcc76,_0x4c2bd5){_0x3bcc76=_0x3bcc76-0x16a;let _0x281c8c=_0x1055f7[_0x3bcc76];return _0x281c8c;},a571_0x444d(_0x1ff303,_0x3a76d9);}function a571_0x281c(){const _0x1f6ff7=['../../models/User','prototype','s.whatsapp.net','.ogg','@sentry/node','data','from','__setModuleDefault','../../helpers/GetTicketWbot','create','ERR_SENDING_WAPP_MSG','Error\x20converting\x20filename\x20to\x20UTF-8:','hasOwnProperty','axios','message','createReadStream','386035lyImfD','log','4TAXxPM','sendMessage','./VerifyHandlers','join','51xUQNiU','957120gDjSsQ','findByPk','startsWith','GET','image/png','620135hcTAcg','mime-types','apply','error','156kmvGYY','image/jpg','getOwnPropertyNames','captureException','writable','length','image/jpeg','path','604080nIUxzZ','number','41374noIxoi','exec','../../helpers/Mustache','audio/','image/webp','\x20-i\x20\x22','__esModule','getOwnPropertyDescriptor','407tICrpU','5823ewKRtZ','call','toString','resolve','isGroup','writeFileSync','endsWith','iconv-lite','audio/ogg;\x20codecs=opus','(((.+)+)+)+$','arraybuffer','__importDefault','verifyMediaMessage','712QvFgoI','contact','decode','string','74010HxgWhW','audio-record-site','cacheMessage','application/octet-stream','originalname','getMessageOptions','search','content-type','extension','14fiiQNE','\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20','audio/ogg','default','includes','parse','@ffmpeg-installer/ffmpeg','getTime','headers','now','defineProperty'];a571_0x281c=function(){return _0x1f6ff7;};return a571_0x281c();}var __createBinding=this&&this['__createBinding']||(Object[a571_0x124fbb(0x1bd)]?function(_0x36fe97,_0x42c69f,_0x1cb9cf,_0xfb548c){const _0x2c3357=a571_0x124fbb;if(_0xfb548c===undefined)_0xfb548c=_0x1cb9cf;var _0x21d925=Object[_0x2c3357(0x18d)](_0x42c69f,_0x1cb9cf);(!_0x21d925||('get'in _0x21d925?!_0x42c69f[_0x2c3357(0x18c)]:_0x21d925[_0x2c3357(0x180)]||_0x21d925['configurable']))&&(_0x21d925={'enumerable':!![],'get':function(){return _0x42c69f[_0x1cb9cf];}}),Object[_0x2c3357(0x1b3)](_0x36fe97,_0xfb548c,_0x21d925);}:function(_0x485965,_0x453df3,_0x528d8c,_0xb5918b){if(_0xb5918b===undefined)_0xb5918b=_0x528d8c;_0x485965[_0xb5918b]=_0x453df3[_0x528d8c];}),__setModuleDefault=this&&this[a571_0x124fbb(0x1bb)]||(Object[a571_0x124fbb(0x1bd)]?function(_0x2ad2cf,_0x3db3ba){const _0x452bd3=a571_0x124fbb;Object[_0x452bd3(0x1b3)](_0x2ad2cf,_0x452bd3(0x1ac),{'enumerable':!![],'value':_0x3db3ba});}:function(_0x45da2c,_0x3f979a){const _0xe8c988=a571_0x124fbb;_0x45da2c[_0xe8c988(0x1ac)]=_0x3f979a;}),__importStar=this&&this['__importStar']||(function(){const _0x324b24=(function(){let _0x5428d2=!![];return function(_0xbd9675,_0x2e989d){const _0x1d5ec4=_0x5428d2?function(){const _0x438455=a571_0x444d;if(_0x2e989d){const _0x4dd38f=_0x2e989d[_0x438455(0x17a)](_0xbd9675,arguments);return _0x2e989d=null,_0x4dd38f;}}:function(){};return _0x5428d2=![],_0x1d5ec4;};}()),_0x124a88=_0x324b24(this,function(){const _0x59dd04=a571_0x444d;return _0x124a88[_0x59dd04(0x191)]()[_0x59dd04(0x1a6)](_0x59dd04(0x198))[_0x59dd04(0x191)]()['constructor'](_0x124a88)[_0x59dd04(0x1a6)](_0x59dd04(0x198));});_0x124a88();var _0x29c912=function(_0x40f5c7){const _0x47ace9=a571_0x444d;return _0x29c912=Object[_0x47ace9(0x17e)]||function(_0x5540f5){const _0x8048b7=_0x47ace9;var _0x1f2783=[];for(var _0x460565 in _0x5540f5)if(Object[_0x8048b7(0x1b5)][_0x8048b7(0x1c0)][_0x8048b7(0x190)](_0x5540f5,_0x460565))_0x1f2783[_0x1f2783[_0x8048b7(0x181)]]=_0x460565;return _0x1f2783;},_0x29c912(_0x40f5c7);};return function(_0x5cc247){const _0x3035ca=a571_0x444d;if(_0x5cc247&&_0x5cc247[_0x3035ca(0x18c)])return _0x5cc247;var _0x336ea2={};if(_0x5cc247!=null){for(var _0x103c93=_0x29c912(_0x5cc247),_0x1fa81e=0x0;_0x1fa81e<_0x103c93['length'];_0x1fa81e++)if(_0x103c93[_0x1fa81e]!==_0x3035ca(0x1ac))__createBinding(_0x336ea2,_0x5cc247,_0x103c93[_0x1fa81e]);}return __setModuleDefault(_0x336ea2,_0x5cc247),_0x336ea2;};}()),__importDefault=this&&this[a571_0x124fbb(0x19a)]||function(_0x51e2b8){const _0x1887ed=a571_0x124fbb;return _0x51e2b8&&_0x51e2b8[_0x1887ed(0x18c)]?_0x51e2b8:{'default':_0x51e2b8};};Object['defineProperty'](exports,a571_0x124fbb(0x18c),{'value':!![]}),exports[a571_0x124fbb(0x1a5)]=void 0x0;const Sentry=__importStar(require(a571_0x124fbb(0x1b8))),fs_1=__importDefault(require('fs')),child_process_1=require('child_process'),path_1=__importDefault(require(a571_0x124fbb(0x183))),ffmpeg_1=__importDefault(require(a571_0x124fbb(0x1af))),mime_types_1=__importDefault(require(a571_0x124fbb(0x179))),iconv_lite_1=__importDefault(require(a571_0x124fbb(0x196))),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require(a571_0x124fbb(0x1bc))),VerifyHandlers_1=require(a571_0x124fbb(0x170)),axios_1=__importDefault(require(a571_0x124fbb(0x1c1))),Mustache_1=__importDefault(require(a571_0x124fbb(0x188))),User_1=__importDefault(require(a571_0x124fbb(0x1b4))),publicFolder=__dirname[a571_0x124fbb(0x195)]('/dist')?path_1['default'][a571_0x124fbb(0x192)](__dirname,'..','public'):path_1[a571_0x124fbb(0x1ac)]['resolve'](__dirname,'..','..','..','public'),supportedImages=[a571_0x124fbb(0x177),a571_0x124fbb(0x17d),a571_0x124fbb(0x182),a571_0x124fbb(0x18a)],processRecordedAudio=async _0xa318b5=>{const _0x20a5ac=a571_0x124fbb,_0x393459=publicFolder+'/'+new Date()[_0x20a5ac(0x1b0)]()+_0x20a5ac(0x1b7);return new Promise((_0x3b2bd9,_0x4b0fc9)=>{const _0xa10ee6=_0x20a5ac;(0x0,child_process_1[_0xa10ee6(0x187)])(ffmpeg_1[_0xa10ee6(0x1ac)][_0xa10ee6(0x183)]+_0xa10ee6(0x18b)+_0xa318b5+_0xa10ee6(0x1aa)+_0x393459,(_0x4f117d,_0x4b1d10,_0x56ab3d)=>{const _0x4419d4=_0xa10ee6;if(_0x4f117d)_0x4b0fc9(_0x4f117d);_0x3b2bd9(fs_1[_0x4419d4(0x1ac)][_0x4419d4(0x16b)](_0x393459));});});},getMessageOptions=async(_0xfc52c0,_0x708efc,_0x554168)=>{const _0x4e38d2=a571_0x124fbb;_0x554168=_0x554168||mime_types_1['default']['lookup'](_0x708efc)||_0x4e38d2(0x1a3);try{let _0x4409dc;if(_0x554168[_0x4e38d2(0x175)]('video/'))_0x4409dc={'video':{'stream':fs_1[_0x4e38d2(0x1ac)][_0x4e38d2(0x16b)](_0x708efc)}};else{if(_0x554168===_0x4e38d2(0x1ab))_0x4409dc={'audio':{'stream':fs_1[_0x4e38d2(0x1ac)][_0x4e38d2(0x16b)](_0x708efc)},'mimetype':_0x4e38d2(0x197),'ptt':!![]};else{if(_0x554168[_0x4e38d2(0x175)](_0x4e38d2(0x189))){const _0x26fed4=_0xfc52c0[_0x4e38d2(0x1ad)](_0x4e38d2(0x1a1));_0x4409dc={'audio':{'stream':_0x26fed4?await processRecordedAudio(_0x708efc):fs_1['default'][_0x4e38d2(0x16b)](_0x708efc)},'mimetype':_0x26fed4?_0x4e38d2(0x197):_0x554168,'ptt':_0x26fed4};}else supportedImages[_0x4e38d2(0x1ad)](_0x554168)?_0x4409dc={'image':{'stream':fs_1[_0x4e38d2(0x1ac)][_0x4e38d2(0x16b)](_0x708efc)}}:_0x4409dc={'document':{'stream':fs_1[_0x4e38d2(0x1ac)][_0x4e38d2(0x16b)](_0x708efc)},'mimetype':_0x554168};}}return _0x4409dc;}catch(_0xb1bf79){return Sentry[_0x4e38d2(0x17f)](_0xb1bf79),console[_0x4e38d2(0x16d)](_0xb1bf79),null;}};exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x210c94,ticket:_0x263f9a,body:_0x1eae67,userId:_0x373afe,quotedMsg:_0x159516})=>{const _0x4fcecf=a571_0x124fbb;try{const _0x1b48ea=await(0x0,GetTicketWbot_1[_0x4fcecf(0x1ac)])(_0x263f9a);let _0x1aa675,_0x527885,_0x2b162b;if(typeof _0x210c94===_0x4fcecf(0x19f)){const _0x40f9e0=await(0x0,axios_1['default'])({'url':_0x210c94,'method':_0x4fcecf(0x176),'responseType':_0x4fcecf(0x199)});_0x527885=Date[_0x4fcecf(0x1b2)]()+'.'+mime_types_1[_0x4fcecf(0x1ac)][_0x4fcecf(0x1a8)](_0x40f9e0[_0x4fcecf(0x1b1)]['content-type']),_0x1aa675=path_1[_0x4fcecf(0x1ac)][_0x4fcecf(0x171)](publicFolder,_0x527885),fs_1[_0x4fcecf(0x1ac)][_0x4fcecf(0x194)](_0x1aa675,_0x40f9e0[_0x4fcecf(0x1b9)]),_0x2b162b=_0x40f9e0[_0x4fcecf(0x1b1)][_0x4fcecf(0x1a7)];}else _0x1aa675=_0x210c94['path'],_0x527885=_0x210c94[_0x4fcecf(0x1a4)],_0x2b162b=_0x210c94['mimetype'];try{_0x527885=iconv_lite_1['default'][_0x4fcecf(0x19e)](Buffer[_0x4fcecf(0x1ba)](_0x527885||'','binary'),'utf8');}catch(_0x1c2e7b){console[_0x4fcecf(0x17b)](_0x4fcecf(0x1bf),_0x1c2e7b);}const _0x58ebaa=_0x373afe&&await User_1[_0x4fcecf(0x1ac)][_0x4fcecf(0x174)](_0x373afe),_0x371a91=_0x1eae67?(0x0,Mustache_1[_0x4fcecf(0x1ac)])(_0x1eae67,_0x263f9a,_0x58ebaa):undefined,_0x395efe=await(0x0,exports[_0x4fcecf(0x1a5)])(_0x527885,_0x1aa675,_0x2b162b),_0x26847f={..._0x159516&&{'quoted':{'key':_0x159516['id'],'message':JSON[_0x4fcecf(0x1ae)](_0x159516['dataJson'])?.[_0x4fcecf(0x16a)]}}},_0x599cb6=await _0x1b48ea[_0x4fcecf(0x16f)](_0x263f9a[_0x4fcecf(0x19d)][_0x4fcecf(0x185)]+'@'+(_0x263f9a[_0x4fcecf(0x193)]?'g.us':_0x4fcecf(0x1b6)),{'caption':_0x371a91,'fileName':_0x527885,..._0x395efe,..._0x26847f});return _0x1b48ea[_0x4fcecf(0x1a2)](_0x599cb6),await(0x0,VerifyHandlers_1[_0x4fcecf(0x19b)])(_0x599cb6,_0x263f9a,_0x263f9a[_0x4fcecf(0x19d)]),_0x599cb6;}catch(_0x21ea9c){Sentry[_0x4fcecf(0x17f)](_0x21ea9c),console[_0x4fcecf(0x16d)](_0x21ea9c);throw new AppError_1[(_0x4fcecf(0x1ac))](_0x4fcecf(0x1be));}};exports[a571_0x124fbb(0x1ac)]=SendWhatsAppMedia;