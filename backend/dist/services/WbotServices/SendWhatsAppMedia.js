'use strict';const a581_0x6667ab=a581_0x3774;(function(_0x12a213,_0x5833f7){const _0x35ea3b=a581_0x3774,_0x3ff656=_0x12a213();while(!![]){try{const _0x5943af=-parseInt(_0x35ea3b(0xa8))/0x1*(parseInt(_0x35ea3b(0x80))/0x2)+-parseInt(_0x35ea3b(0x85))/0x3*(-parseInt(_0x35ea3b(0x91))/0x4)+parseInt(_0x35ea3b(0x8e))/0x5*(parseInt(_0x35ea3b(0xb5))/0x6)+parseInt(_0x35ea3b(0x73))/0x7+-parseInt(_0x35ea3b(0xa0))/0x8*(parseInt(_0x35ea3b(0x8d))/0x9)+parseInt(_0x35ea3b(0xb4))/0xa+-parseInt(_0x35ea3b(0x7d))/0xb;if(_0x5943af===_0x5833f7)break;else _0x3ff656['push'](_0x3ff656['shift']());}catch(_0x4b8df0){_0x3ff656['push'](_0x3ff656['shift']());}}}(a581_0x1ac7,0xab844));var __createBinding=this&&this[a581_0x6667ab(0x88)]||(Object['create']?function(_0x4076d1,_0x20daac,_0x6a78d9,_0x565d11){const _0xcc99a9=a581_0x6667ab;if(_0x565d11===undefined)_0x565d11=_0x6a78d9;var _0x12a7fc=Object[_0xcc99a9(0x77)](_0x20daac,_0x6a78d9);(!_0x12a7fc||(_0xcc99a9(0x8c)in _0x12a7fc?!_0x20daac[_0xcc99a9(0xa3)]:_0x12a7fc['writable']||_0x12a7fc['configurable']))&&(_0x12a7fc={'enumerable':!![],'get':function(){return _0x20daac[_0x6a78d9];}}),Object[_0xcc99a9(0xaa)](_0x4076d1,_0x565d11,_0x12a7fc);}:function(_0x206e11,_0x26de08,_0x2d8570,_0x7455df){if(_0x7455df===undefined)_0x7455df=_0x2d8570;_0x206e11[_0x7455df]=_0x26de08[_0x2d8570];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a581_0x6667ab(0xa2)]?function(_0x16c3fc,_0x42dd3e){const _0x5930da=a581_0x6667ab;Object[_0x5930da(0xaa)](_0x16c3fc,'default',{'enumerable':!![],'value':_0x42dd3e});}:function(_0x4e2766,_0x5318c6){const _0x4258ed=a581_0x6667ab;_0x4e2766[_0x4258ed(0x87)]=_0x5318c6;}),__importStar=this&&this[a581_0x6667ab(0x92)]||(function(){const _0x3de06d=(function(){let _0x1c1e15=!![];return function(_0x1c5939,_0x43f75b){const _0x49cf57=_0x1c1e15?function(){if(_0x43f75b){const _0x309067=_0x43f75b['apply'](_0x1c5939,arguments);return _0x43f75b=null,_0x309067;}}:function(){};return _0x1c1e15=![],_0x49cf57;};}()),_0xd533a1=_0x3de06d(this,function(){const _0x5eed59=a581_0x3774;return _0xd533a1[_0x5eed59(0x81)]()[_0x5eed59(0x82)](_0x5eed59(0x93))[_0x5eed59(0x81)]()['constructor'](_0xd533a1)['search'](_0x5eed59(0x93));});_0xd533a1();var _0x22a07f=function(_0x3ee9cf){const _0x319c60=a581_0x3774;return _0x22a07f=Object[_0x319c60(0xba)]||function(_0x24f181){const _0x294268=_0x319c60;var _0x389e5d=[];for(var _0x19cda6 in _0x24f181)if(Object[_0x294268(0x79)][_0x294268(0xae)][_0x294268(0xa9)](_0x24f181,_0x19cda6))_0x389e5d[_0x389e5d[_0x294268(0xb8)]]=_0x19cda6;return _0x389e5d;},_0x22a07f(_0x3ee9cf);};return function(_0x126712){const _0x1fd0ec=a581_0x3774;if(_0x126712&&_0x126712[_0x1fd0ec(0xa3)])return _0x126712;var _0x4a4344={};if(_0x126712!=null){for(var _0xc45ada=_0x22a07f(_0x126712),_0x18900f=0x0;_0x18900f<_0xc45ada[_0x1fd0ec(0xb8)];_0x18900f++)if(_0xc45ada[_0x18900f]!=='default')__createBinding(_0x4a4344,_0x126712,_0xc45ada[_0x18900f]);}return __setModuleDefault(_0x4a4344,_0x126712),_0x4a4344;};}()),__importDefault=this&&this['__importDefault']||function(_0x37ab5f){return _0x37ab5f&&_0x37ab5f['__esModule']?_0x37ab5f:{'default':_0x37ab5f};};Object[a581_0x6667ab(0xaa)](exports,a581_0x6667ab(0xa3),{'value':!![]}),exports[a581_0x6667ab(0xab)]=void 0x0;function a581_0x1ac7(){const _0x511779=['getOwnPropertyDescriptor','audio/ogg;\x20codecs=opus','prototype','arraybuffer','lookup','public','12389333zShFTE','@g.us','originalname','1272ErTvKT','toString','search','log','../../helpers/GetTicketWbot','65979hlFZbE','image/webp','default','__createBinding','iconv-lite','resolve','sendMessage','get','1680381QlBtxq','200890XgKWTU','data','remoteJid','92UmcKtW','__importStar','(((.+)+)+)+$','parse','.ogg','../../models/User','path','../../helpers/Mustache','from','/dist','error','image/jpg','extension','string','image/jpeg','24gWmdSB','audio-record-site','create','__esModule','\x20-i\x20\x22','dataJson','contact','@ffmpeg-installer/ffmpeg','17Zbtcuc','call','defineProperty','getMessageOptions','@sentry/node','audio/ogg','hasOwnProperty','GET','createReadStream','Error\x20converting\x20filename\x20to\x20UTF-8:','content-type','startsWith','2222260nljUrl','132IXixvE','exec','audio/','length','application/octet-stream','getOwnPropertyNames','isGroup','endsWith','includes','number','5514551UHQjve','decode','captureException','../../errors/AppError'];a581_0x1ac7=function(){return _0x511779;};return a581_0x1ac7();}const Sentry=__importStar(require(a581_0x6667ab(0xac))),fs_1=__importDefault(require('fs')),child_process_1=require('child_process'),path_1=__importDefault(require(a581_0x6667ab(0x97))),ffmpeg_1=__importDefault(require(a581_0x6667ab(0xa7))),mime_types_1=__importDefault(require('mime-types')),iconv_lite_1=__importDefault(require(a581_0x6667ab(0x89))),AppError_1=__importDefault(require(a581_0x6667ab(0x76))),GetTicketWbot_1=__importDefault(require(a581_0x6667ab(0x84))),VerifyHandlers_1=require('./VerifyHandlers'),axios_1=__importDefault(require('axios')),Mustache_1=__importDefault(require(a581_0x6667ab(0x98))),User_1=__importDefault(require(a581_0x6667ab(0x96))),publicFolder=__dirname[a581_0x6667ab(0xbc)](a581_0x6667ab(0x9a))?path_1[a581_0x6667ab(0x87)][a581_0x6667ab(0x8a)](__dirname,'..',a581_0x6667ab(0x7c)):path_1[a581_0x6667ab(0x87)]['resolve'](__dirname,'..','..','..',a581_0x6667ab(0x7c)),supportedImages=['image/png',a581_0x6667ab(0x9c),a581_0x6667ab(0x9f),a581_0x6667ab(0x86)],processRecordedAudio=async _0x29f3f3=>{const _0x284242=a581_0x6667ab,_0x678100=publicFolder+'/'+new Date()['getTime']()+_0x284242(0x95);return new Promise((_0x5f5974,_0x3c8c5f)=>{const _0x28eb0f=_0x284242;(0x0,child_process_1[_0x28eb0f(0xb6)])(ffmpeg_1[_0x28eb0f(0x87)][_0x28eb0f(0x97)]+_0x28eb0f(0xa4)+_0x29f3f3+'\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20'+_0x678100,(_0x3fd0e0,_0x2b3c9d,_0x1e40fc)=>{const _0x43a3d1=_0x28eb0f;if(_0x3fd0e0)_0x3c8c5f(_0x3fd0e0);_0x5f5974(fs_1[_0x43a3d1(0x87)][_0x43a3d1(0xb0)](_0x678100));});});},getMessageOptions=async(_0x416a3d,_0x9ff63f,_0xb6e966)=>{const _0x41838d=a581_0x6667ab;_0xb6e966=_0xb6e966||mime_types_1['default'][_0x41838d(0x7b)](_0x9ff63f)||_0x41838d(0xb9);try{let _0x56f950;if(_0xb6e966[_0x41838d(0xb3)]('video/'))_0x56f950={'video':{'stream':fs_1['default'][_0x41838d(0xb0)](_0x9ff63f)}};else{if(_0xb6e966===_0x41838d(0xad))_0x56f950={'audio':{'stream':fs_1[_0x41838d(0x87)][_0x41838d(0xb0)](_0x9ff63f)},'mimetype':_0x41838d(0x78),'ptt':!![]};else{if(_0xb6e966['startsWith'](_0x41838d(0xb7))){const _0x3365ec=_0x416a3d[_0x41838d(0xbd)](_0x41838d(0xa1));_0x56f950={'audio':{'stream':_0x3365ec?await processRecordedAudio(_0x9ff63f):fs_1['default']['createReadStream'](_0x9ff63f)},'mimetype':_0x3365ec?'audio/ogg;\x20codecs=opus':_0xb6e966,'ptt':_0x3365ec};}else supportedImages['includes'](_0xb6e966)?_0x56f950={'image':{'stream':fs_1[_0x41838d(0x87)][_0x41838d(0xb0)](_0x9ff63f)}}:_0x56f950={'document':{'stream':fs_1['default'][_0x41838d(0xb0)](_0x9ff63f)},'mimetype':_0xb6e966};}}return _0x56f950;}catch(_0xbd4843){return Sentry[_0x41838d(0x75)](_0xbd4843),console[_0x41838d(0x83)](_0xbd4843),null;}};function a581_0x3774(_0x11e651,_0x2673bd){const _0x65bdc3=a581_0x1ac7();return a581_0x3774=function(_0x193f21,_0x560262){_0x193f21=_0x193f21-0x73;let _0x1ac7ea=_0x65bdc3[_0x193f21];return _0x1ac7ea;},a581_0x3774(_0x11e651,_0x2673bd);}exports[a581_0x6667ab(0xab)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x1f9b8e,ticket:_0x2501aa,body:_0x62d209,userId:_0x543afa,quotedMsg:_0x45f5cb})=>{const _0x20aea0=a581_0x6667ab;try{const _0x56c150=await(0x0,GetTicketWbot_1['default'])(_0x2501aa);let _0x4eaad2,_0x345a2a,_0x2069dd;if(typeof _0x1f9b8e===_0x20aea0(0x9e)){const _0x2f8ea6=await(0x0,axios_1['default'])({'url':_0x1f9b8e,'method':_0x20aea0(0xaf),'responseType':_0x20aea0(0x7a)});_0x345a2a=Date['now']()+'.'+mime_types_1[_0x20aea0(0x87)][_0x20aea0(0x9d)](_0x2f8ea6['headers']['content-type']),_0x4eaad2=path_1['default']['join'](publicFolder,_0x345a2a),fs_1[_0x20aea0(0x87)]['writeFileSync'](_0x4eaad2,_0x2f8ea6[_0x20aea0(0x8f)]),_0x2069dd=_0x2f8ea6['headers'][_0x20aea0(0xb2)];}else _0x4eaad2=_0x1f9b8e[_0x20aea0(0x97)],_0x345a2a=_0x1f9b8e[_0x20aea0(0x7f)],_0x2069dd=_0x1f9b8e['mimetype'];try{_0x345a2a=iconv_lite_1[_0x20aea0(0x87)][_0x20aea0(0x74)](Buffer[_0x20aea0(0x99)](_0x345a2a||'','binary'),'utf8');}catch(_0x470f6a){console[_0x20aea0(0x9b)](_0x20aea0(0xb1),_0x470f6a);}const _0x1d3ed4=_0x543afa&&await User_1[_0x20aea0(0x87)]['findByPk'](_0x543afa),_0x8fc845=_0x62d209?(0x0,Mustache_1[_0x20aea0(0x87)])(_0x62d209,_0x2501aa,_0x1d3ed4):undefined,_0x476c1a=await(0x0,exports[_0x20aea0(0xab)])(_0x345a2a,_0x4eaad2,_0x2069dd),_0x3b57b9={..._0x45f5cb&&{'quoted':{'key':_0x45f5cb['id'],'message':JSON[_0x20aea0(0x94)](_0x45f5cb[_0x20aea0(0xa5)])?.['message']}}},_0x5f056e=_0x2501aa[_0x20aea0(0xbb)]?_0x2501aa[_0x20aea0(0xa6)][_0x20aea0(0xbe)]+_0x20aea0(0x7e):_0x2501aa[_0x20aea0(0xa6)][_0x20aea0(0x90)]||_0x2501aa[_0x20aea0(0xa6)][_0x20aea0(0xbe)]+'@s.whatsapp.net',_0x5b94cd=await _0x56c150[_0x20aea0(0x8b)](_0x5f056e,{'caption':_0x8fc845,'fileName':_0x345a2a,..._0x476c1a,..._0x3b57b9});return _0x56c150['cacheMessage'](_0x5b94cd),await(0x0,VerifyHandlers_1['verifyMediaMessage'])(_0x5b94cd,_0x2501aa,_0x2501aa[_0x20aea0(0xa6)]),_0x5b94cd;}catch(_0x48e104){Sentry[_0x20aea0(0x75)](_0x48e104),console[_0x20aea0(0x83)](_0x48e104);throw new AppError_1[(_0x20aea0(0x87))]('ERR_SENDING_WAPP_MSG');}};exports[a581_0x6667ab(0x87)]=SendWhatsAppMedia;