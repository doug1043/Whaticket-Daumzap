'use strict';const a577_0x247bc4=a577_0x4641;(function(_0x5093bc,_0x98dcc0){const _0x138ba8=a577_0x4641,_0xb19386=_0x5093bc();while(!![]){try{const _0x3fe707=parseInt(_0x138ba8(0x1d0))/0x1+parseInt(_0x138ba8(0x1ef))/0x2*(-parseInt(_0x138ba8(0x1f8))/0x3)+-parseInt(_0x138ba8(0x1fc))/0x4+-parseInt(_0x138ba8(0x1c7))/0x5+-parseInt(_0x138ba8(0x1f3))/0x6+parseInt(_0x138ba8(0x1cc))/0x7+parseInt(_0x138ba8(0x1d9))/0x8;if(_0x3fe707===_0x98dcc0)break;else _0xb19386['push'](_0xb19386['shift']());}catch(_0x5d6179){_0xb19386['push'](_0xb19386['shift']());}}}(a577_0x19eb,0x6d49f));var __createBinding=this&&this[a577_0x247bc4(0x1d6)]||(Object[a577_0x247bc4(0x1de)]?function(_0x29cb46,_0x3d8d90,_0x6b13e6,_0xed1ec9){const _0x1121be=a577_0x247bc4;if(_0xed1ec9===undefined)_0xed1ec9=_0x6b13e6;var _0x591e7f=Object[_0x1121be(0x1ca)](_0x3d8d90,_0x6b13e6);(!_0x591e7f||(_0x1121be(0x1f1)in _0x591e7f?!_0x3d8d90[_0x1121be(0x1fe)]:_0x591e7f[_0x1121be(0x1e8)]||_0x591e7f['configurable']))&&(_0x591e7f={'enumerable':!![],'get':function(){return _0x3d8d90[_0x6b13e6];}}),Object['defineProperty'](_0x29cb46,_0xed1ec9,_0x591e7f);}:function(_0x3a260b,_0x295911,_0x3999a6,_0x55d463){if(_0x55d463===undefined)_0x55d463=_0x3999a6;_0x3a260b[_0x55d463]=_0x295911[_0x3999a6];}),__setModuleDefault=this&&this[a577_0x247bc4(0x1d7)]||(Object[a577_0x247bc4(0x1de)]?function(_0x2a6108,_0x1f2ad5){const _0x2bb086=a577_0x247bc4;Object['defineProperty'](_0x2a6108,_0x2bb086(0x208),{'enumerable':!![],'value':_0x1f2ad5});}:function(_0x2178aa,_0x45bd4a){const _0x24ea4f=a577_0x247bc4;_0x2178aa[_0x24ea4f(0x208)]=_0x45bd4a;}),__importStar=this&&this[a577_0x247bc4(0x1d3)]||(function(){const _0x4da458=(function(){let _0x22a7cd=!![];return function(_0x472667,_0x2de9ab){const _0x2b00ec=_0x22a7cd?function(){const _0x324e64=a577_0x4641;if(_0x2de9ab){const _0x3d9154=_0x2de9ab[_0x324e64(0x1fd)](_0x472667,arguments);return _0x2de9ab=null,_0x3d9154;}}:function(){};return _0x22a7cd=![],_0x2b00ec;};}()),_0x29dd4b=_0x4da458(this,function(){const _0x27bde2=a577_0x4641;return _0x29dd4b['toString']()[_0x27bde2(0x20c)]('(((.+)+)+)+$')['toString']()[_0x27bde2(0x1e5)](_0x29dd4b)[_0x27bde2(0x20c)](_0x27bde2(0x1fa));});_0x29dd4b();var _0x3564ee=function(_0x1290e2){return _0x3564ee=Object['getOwnPropertyNames']||function(_0x1c0a84){const _0x32212f=a577_0x4641;var _0x428336=[];for(var _0x15ba30 in _0x1c0a84)if(Object[_0x32212f(0x1d4)][_0x32212f(0x206)]['call'](_0x1c0a84,_0x15ba30))_0x428336[_0x428336[_0x32212f(0x20e)]]=_0x15ba30;return _0x428336;},_0x3564ee(_0x1290e2);};return function(_0x564a38){const _0x4bc80a=a577_0x4641;if(_0x564a38&&_0x564a38['__esModule'])return _0x564a38;var _0x388689={};if(_0x564a38!=null){for(var _0x1653aa=_0x3564ee(_0x564a38),_0x227460=0x0;_0x227460<_0x1653aa[_0x4bc80a(0x20e)];_0x227460++)if(_0x1653aa[_0x227460]!=='default')__createBinding(_0x388689,_0x564a38,_0x1653aa[_0x227460]);}return __setModuleDefault(_0x388689,_0x564a38),_0x388689;};}()),__importDefault=this&&this['__importDefault']||function(_0x2e5f16){const _0x43945f=a577_0x247bc4;return _0x2e5f16&&_0x2e5f16[_0x43945f(0x1fe)]?_0x2e5f16:{'default':_0x2e5f16};};function a577_0x4641(_0xac6aab,_0x1c576a){const _0x476f63=a577_0x19eb();return a577_0x4641=function(_0x4f588a,_0x1a94d8){_0x4f588a=_0x4f588a-0x1c5;let _0x19ebf2=_0x476f63[_0x4f588a];return _0x19ebf2;},a577_0x4641(_0xac6aab,_0x1c576a);}function a577_0x19eb(){const _0x46e89c=['__setModuleDefault','video/','8813128rxxJtY','audio/','includes','mimetype','mime-types','create','lookup','content-type','join','g.us','arraybuffer','sendMessage','constructor','exec','/dist','writable','../../helpers/GetTicketWbot','binary','audio/ogg;\x20codecs=opus','cacheMessage','path','image/jpeg','1396886QbKQsk','utf8','get','iconv-lite','446118zROILE','string','.ogg','getMessageOptions','originalname','3sdhXKn','../../helpers/Mustache','(((.+)+)+)+$','\x20-i\x20\x22','186460jJkUZn','apply','__esModule','endsWith','data','ERR_SENDING_WAPP_MSG','number','getTime','contact','parse','hasOwnProperty','./VerifyHandlers','default','startsWith','public','findByPk','search','log','length','Error\x20converting\x20filename\x20to\x20UTF-8:','resolve','verifyMediaMessage','1803435Mpryak','audio/ogg','child_process','getOwnPropertyDescriptor','@sentry/node','827568iwSdzO','audio-record-site','image/jpg','createReadStream','407880pTytDn','image/webp','\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20','__importStar','prototype','dataJson','__createBinding'];a577_0x19eb=function(){return _0x46e89c;};return a577_0x19eb();}Object['defineProperty'](exports,a577_0x247bc4(0x1fe),{'value':!![]}),exports['getMessageOptions']=void 0x0;const Sentry=__importStar(require(a577_0x247bc4(0x1cb))),fs_1=__importDefault(require('fs')),child_process_1=require(a577_0x247bc4(0x1c9)),path_1=__importDefault(require(a577_0x247bc4(0x1ed))),ffmpeg_1=__importDefault(require('@ffmpeg-installer/ffmpeg')),mime_types_1=__importDefault(require(a577_0x247bc4(0x1dd))),iconv_lite_1=__importDefault(require(a577_0x247bc4(0x1f2))),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require(a577_0x247bc4(0x1e9))),VerifyHandlers_1=require(a577_0x247bc4(0x207)),axios_1=__importDefault(require('axios')),Mustache_1=__importDefault(require(a577_0x247bc4(0x1f9))),User_1=__importDefault(require('../../models/User')),publicFolder=__dirname[a577_0x247bc4(0x1ff)](a577_0x247bc4(0x1e7))?path_1[a577_0x247bc4(0x208)][a577_0x247bc4(0x1c5)](__dirname,'..',a577_0x247bc4(0x20a)):path_1[a577_0x247bc4(0x208)][a577_0x247bc4(0x1c5)](__dirname,'..','..','..',a577_0x247bc4(0x20a)),supportedImages=['image/png',a577_0x247bc4(0x1ce),a577_0x247bc4(0x1ee),a577_0x247bc4(0x1d1)],processRecordedAudio=async _0xe35cd8=>{const _0x22a590=a577_0x247bc4,_0x28bac5=publicFolder+'/'+new Date()[_0x22a590(0x203)]()+_0x22a590(0x1f5);return new Promise((_0xfc6eeb,_0x4bc6b4)=>{const _0x37eacf=_0x22a590;(0x0,child_process_1[_0x37eacf(0x1e6)])(ffmpeg_1[_0x37eacf(0x208)]['path']+_0x37eacf(0x1fb)+_0xe35cd8+_0x37eacf(0x1d2)+_0x28bac5,(_0x301b25,_0x3d03e3,_0x48b969)=>{const _0x26c300=_0x37eacf;if(_0x301b25)_0x4bc6b4(_0x301b25);_0xfc6eeb(fs_1['default'][_0x26c300(0x1cf)](_0x28bac5));});});},getMessageOptions=async(_0x32e5b4,_0x5e3820,_0x36980c)=>{const _0x1242f6=a577_0x247bc4;_0x36980c=_0x36980c||mime_types_1[_0x1242f6(0x208)][_0x1242f6(0x1df)](_0x5e3820)||'application/octet-stream';try{let _0x45e3c;if(_0x36980c[_0x1242f6(0x209)](_0x1242f6(0x1d8)))_0x45e3c={'video':{'stream':fs_1[_0x1242f6(0x208)][_0x1242f6(0x1cf)](_0x5e3820)}};else{if(_0x36980c===_0x1242f6(0x1c8))_0x45e3c={'audio':{'stream':fs_1['default'][_0x1242f6(0x1cf)](_0x5e3820)},'mimetype':'audio/ogg;\x20codecs=opus','ptt':!![]};else{if(_0x36980c[_0x1242f6(0x209)](_0x1242f6(0x1da))){const _0xf1055e=_0x32e5b4['includes'](_0x1242f6(0x1cd));_0x45e3c={'audio':{'stream':_0xf1055e?await processRecordedAudio(_0x5e3820):fs_1[_0x1242f6(0x208)]['createReadStream'](_0x5e3820)},'mimetype':_0xf1055e?_0x1242f6(0x1eb):_0x36980c,'ptt':_0xf1055e};}else supportedImages[_0x1242f6(0x1db)](_0x36980c)?_0x45e3c={'image':{'stream':fs_1['default'][_0x1242f6(0x1cf)](_0x5e3820)}}:_0x45e3c={'document':{'stream':fs_1[_0x1242f6(0x208)][_0x1242f6(0x1cf)](_0x5e3820)},'mimetype':_0x36980c};}}return _0x45e3c;}catch(_0x100c5c){return Sentry['captureException'](_0x100c5c),console['log'](_0x100c5c),null;}};exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x4af3ec,ticket:_0x132f79,body:_0x328228,userId:_0x52aaab,quotedMsg:_0x230cc5})=>{const _0x4dcb6b=a577_0x247bc4;try{const _0x1af9fe=await(0x0,GetTicketWbot_1[_0x4dcb6b(0x208)])(_0x132f79);let _0x5b0f4,_0x4a9a60,_0x3a2586;if(typeof _0x4af3ec===_0x4dcb6b(0x1f4)){const _0x14f436=await(0x0,axios_1[_0x4dcb6b(0x208)])({'url':_0x4af3ec,'method':'GET','responseType':_0x4dcb6b(0x1e3)});_0x4a9a60=Date['now']()+'.'+mime_types_1['default']['extension'](_0x14f436['headers'][_0x4dcb6b(0x1e0)]),_0x5b0f4=path_1[_0x4dcb6b(0x208)][_0x4dcb6b(0x1e1)](publicFolder,_0x4a9a60),fs_1['default']['writeFileSync'](_0x5b0f4,_0x14f436[_0x4dcb6b(0x200)]),_0x3a2586=_0x14f436['headers'][_0x4dcb6b(0x1e0)];}else _0x5b0f4=_0x4af3ec[_0x4dcb6b(0x1ed)],_0x4a9a60=_0x4af3ec[_0x4dcb6b(0x1f7)],_0x3a2586=_0x4af3ec[_0x4dcb6b(0x1dc)];try{_0x4a9a60=iconv_lite_1[_0x4dcb6b(0x208)]['decode'](Buffer['from'](_0x4a9a60||'',_0x4dcb6b(0x1ea)),_0x4dcb6b(0x1f0));}catch(_0x19ad43){console['error'](_0x4dcb6b(0x20f),_0x19ad43);}const _0x34a1f4=_0x52aaab&&await User_1['default'][_0x4dcb6b(0x20b)](_0x52aaab),_0x444ba0=_0x328228?(0x0,Mustache_1[_0x4dcb6b(0x208)])(_0x328228,_0x132f79,_0x34a1f4):undefined,_0x82c2a=await(0x0,exports[_0x4dcb6b(0x1f6)])(_0x4a9a60,_0x5b0f4,_0x3a2586),_0x4473fd={..._0x230cc5&&{'quoted':{'key':_0x230cc5['id'],'message':JSON[_0x4dcb6b(0x205)](_0x230cc5[_0x4dcb6b(0x1d5)])?.['message']}}},_0x3c4ddc=await _0x1af9fe[_0x4dcb6b(0x1e4)](_0x132f79[_0x4dcb6b(0x204)][_0x4dcb6b(0x202)]+'@'+(_0x132f79['isGroup']?_0x4dcb6b(0x1e2):'s.whatsapp.net'),{'caption':_0x444ba0,'fileName':_0x4a9a60,..._0x82c2a,..._0x4473fd});return _0x1af9fe[_0x4dcb6b(0x1ec)](_0x3c4ddc),await(0x0,VerifyHandlers_1[_0x4dcb6b(0x1c6)])(_0x3c4ddc,_0x132f79,_0x132f79['contact']),_0x3c4ddc;}catch(_0x2f49e6){Sentry['captureException'](_0x2f49e6),console[_0x4dcb6b(0x20d)](_0x2f49e6);throw new AppError_1[(_0x4dcb6b(0x208))](_0x4dcb6b(0x201));}};exports['default']=SendWhatsAppMedia;