'use strict';const a580_0x124ac6=a580_0x25ba;(function(_0x3a5be6,_0x5c8341){const _0xcb8dfa=a580_0x25ba,_0x5a0cf9=_0x3a5be6();while(!![]){try{const _0x467709=parseInt(_0xcb8dfa(0x12a))/0x1+parseInt(_0xcb8dfa(0x15b))/0x2+-parseInt(_0xcb8dfa(0x11d))/0x3+parseInt(_0xcb8dfa(0x149))/0x4*(parseInt(_0xcb8dfa(0x164))/0x5)+-parseInt(_0xcb8dfa(0x11f))/0x6*(parseInt(_0xcb8dfa(0x15a))/0x7)+-parseInt(_0xcb8dfa(0x136))/0x8*(-parseInt(_0xcb8dfa(0x157))/0x9)+-parseInt(_0xcb8dfa(0x134))/0xa*(parseInt(_0xcb8dfa(0x153))/0xb);if(_0x467709===_0x5c8341)break;else _0x5a0cf9['push'](_0x5a0cf9['shift']());}catch(_0x4059b4){_0x5a0cf9['push'](_0x5a0cf9['shift']());}}}(a580_0x1409,0xddf56));function a580_0x25ba(_0x436d22,_0x113c02){const _0x46bf0c=a580_0x1409();return a580_0x25ba=function(_0x79fa8e,_0x3a0892){_0x79fa8e=_0x79fa8e-0x114;let _0x1409c7=_0x46bf0c[_0x79fa8e];return _0x1409c7;},a580_0x25ba(_0x436d22,_0x113c02);}var __createBinding=this&&this[a580_0x124ac6(0x123)]||(Object[a580_0x124ac6(0x126)]?function(_0x106ffa,_0x12275b,_0x59c911,_0x4ee024){const _0x3ca244=a580_0x124ac6;if(_0x4ee024===undefined)_0x4ee024=_0x59c911;var _0x63c658=Object[_0x3ca244(0x158)](_0x12275b,_0x59c911);(!_0x63c658||(_0x3ca244(0x146)in _0x63c658?!_0x12275b[_0x3ca244(0x11c)]:_0x63c658[_0x3ca244(0x156)]||_0x63c658['configurable']))&&(_0x63c658={'enumerable':!![],'get':function(){return _0x12275b[_0x59c911];}}),Object[_0x3ca244(0x125)](_0x106ffa,_0x4ee024,_0x63c658);}:function(_0x2fcdf6,_0x522fd8,_0x5877ae,_0x116b14){if(_0x116b14===undefined)_0x116b14=_0x5877ae;_0x2fcdf6[_0x116b14]=_0x522fd8[_0x5877ae];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x6d9e68,_0x54199a){const _0x188432=a580_0x124ac6;Object[_0x188432(0x125)](_0x6d9e68,_0x188432(0x13e),{'enumerable':!![],'value':_0x54199a});}:function(_0x330dcc,_0x5b146c){const _0x13d8b3=a580_0x124ac6;_0x330dcc[_0x13d8b3(0x13e)]=_0x5b146c;}),__importStar=this&&this[a580_0x124ac6(0x14c)]||(function(){const _0x2edc6c=(function(){let _0x359f45=!![];return function(_0x5c99cb,_0x3793e3){const _0x53fe6a=_0x359f45?function(){const _0x457122=a580_0x25ba;if(_0x3793e3){const _0x4bd4dd=_0x3793e3[_0x457122(0x161)](_0x5c99cb,arguments);return _0x3793e3=null,_0x4bd4dd;}}:function(){};return _0x359f45=![],_0x53fe6a;};}()),_0x4d25d1=_0x2edc6c(this,function(){const _0x4a07b2=a580_0x25ba;return _0x4d25d1['toString']()[_0x4a07b2(0x168)](_0x4a07b2(0x122))[_0x4a07b2(0x12b)]()['constructor'](_0x4d25d1)['search'](_0x4a07b2(0x122));});_0x4d25d1();var _0x1a9a77=function(_0x468654){const _0x4e67c1=a580_0x25ba;return _0x1a9a77=Object[_0x4e67c1(0x13b)]||function(_0x2beade){const _0xcb5bbd=_0x4e67c1;var _0x333cdd=[];for(var _0x52ab9b in _0x2beade)if(Object[_0xcb5bbd(0x162)][_0xcb5bbd(0x11e)][_0xcb5bbd(0x13d)](_0x2beade,_0x52ab9b))_0x333cdd[_0x333cdd[_0xcb5bbd(0x143)]]=_0x52ab9b;return _0x333cdd;},_0x1a9a77(_0x468654);};return function(_0x1debcc){const _0x4b6abc=a580_0x25ba;if(_0x1debcc&&_0x1debcc[_0x4b6abc(0x11c)])return _0x1debcc;var _0x378489={};if(_0x1debcc!=null){for(var _0x4d6528=_0x1a9a77(_0x1debcc),_0x39b6d0=0x0;_0x39b6d0<_0x4d6528['length'];_0x39b6d0++)if(_0x4d6528[_0x39b6d0]!=='default')__createBinding(_0x378489,_0x1debcc,_0x4d6528[_0x39b6d0]);}return __setModuleDefault(_0x378489,_0x1debcc),_0x378489;};}()),__importDefault=this&&this[a580_0x124ac6(0x128)]||function(_0xa87336){const _0xbe179e=a580_0x124ac6;return _0xa87336&&_0xa87336[_0xbe179e(0x11c)]?_0xa87336:{'default':_0xa87336};};Object[a580_0x124ac6(0x125)](exports,a580_0x124ac6(0x11c),{'value':!![]}),exports[a580_0x124ac6(0x137)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),fs_1=__importDefault(require('fs')),child_process_1=require(a580_0x124ac6(0x155)),path_1=__importDefault(require('path')),ffmpeg_1=__importDefault(require(a580_0x124ac6(0x12e))),mime_types_1=__importDefault(require('mime-types')),iconv_lite_1=__importDefault(require(a580_0x124ac6(0x131))),AppError_1=__importDefault(require(a580_0x124ac6(0x151))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),VerifyHandlers_1=require(a580_0x124ac6(0x13c)),axios_1=__importDefault(require(a580_0x124ac6(0x152))),Mustache_1=__importDefault(require(a580_0x124ac6(0x13f))),User_1=__importDefault(require('../../models/User')),publicFolder=__dirname[a580_0x124ac6(0x139)](a580_0x124ac6(0x15d))?path_1[a580_0x124ac6(0x13e)]['resolve'](__dirname,'..',a580_0x124ac6(0x129)):path_1['default'][a580_0x124ac6(0x12d)](__dirname,'..','..','..','public'),supportedImages=[a580_0x124ac6(0x144),a580_0x124ac6(0x13a),'image/jpeg',a580_0x124ac6(0x147)],processRecordedAudio=async _0x5237a9=>{const _0x4fdccb=a580_0x124ac6,_0x573ca4=publicFolder+'/'+new Date()[_0x4fdccb(0x115)]()+_0x4fdccb(0x121);return new Promise((_0x3939e6,_0x2ff12d)=>{const _0x2fb739=_0x4fdccb;(0x0,child_process_1[_0x2fb739(0x166)])(ffmpeg_1[_0x2fb739(0x13e)]['path']+_0x2fb739(0x119)+_0x5237a9+_0x2fb739(0x14d)+_0x573ca4,(_0xdc216e,_0x10c970,_0x5e9737)=>{const _0x5af0b2=_0x2fb739;if(_0xdc216e)_0x2ff12d(_0xdc216e);_0x3939e6(fs_1[_0x5af0b2(0x13e)][_0x5af0b2(0x169)](_0x573ca4));});});},getMessageOptions=async(_0x1d4528,_0x3484e4,_0x2a4577)=>{const _0x5d5cb2=a580_0x124ac6;_0x2a4577=_0x2a4577||mime_types_1['default'][_0x5d5cb2(0x15c)](_0x3484e4)||_0x5d5cb2(0x167);try{let _0x59209f;if(_0x2a4577[_0x5d5cb2(0x14a)](_0x5d5cb2(0x14e)))_0x59209f={'video':{'stream':fs_1[_0x5d5cb2(0x13e)][_0x5d5cb2(0x169)](_0x3484e4)}};else{if(_0x2a4577==='audio/ogg')_0x59209f={'audio':{'stream':fs_1[_0x5d5cb2(0x13e)][_0x5d5cb2(0x169)](_0x3484e4)},'mimetype':_0x5d5cb2(0x16a),'ptt':!![]};else{if(_0x2a4577[_0x5d5cb2(0x14a)](_0x5d5cb2(0x117))){const _0x5253c9=_0x1d4528[_0x5d5cb2(0x14f)](_0x5d5cb2(0x120));_0x59209f={'audio':{'stream':_0x5253c9?await processRecordedAudio(_0x3484e4):fs_1[_0x5d5cb2(0x13e)][_0x5d5cb2(0x169)](_0x3484e4)},'mimetype':_0x5253c9?_0x5d5cb2(0x16a):_0x2a4577,'ptt':_0x5253c9};}else supportedImages[_0x5d5cb2(0x14f)](_0x2a4577)?_0x59209f={'image':{'stream':fs_1['default']['createReadStream'](_0x3484e4)}}:_0x59209f={'document':{'stream':fs_1[_0x5d5cb2(0x13e)]['createReadStream'](_0x3484e4)},'mimetype':_0x2a4577};}}return _0x59209f;}catch(_0x2f65a4){return Sentry['captureException'](_0x2f65a4),console['log'](_0x2f65a4),null;}};function a580_0x1409(){const _0x70d7b3=['writeFileSync','iconv-lite','cacheMessage','parse','2390guHQif','originalname','217640SQLPGC','getMessageOptions','headers','endsWith','image/jpg','getOwnPropertyNames','./VerifyHandlers','call','default','../../helpers/Mustache','extension','remoteJid','message','length','image/png','error','get','image/webp','GET','4MtuMNz','startsWith','g.us','__importStar','\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20','video/','includes','ERR_SENDING_WAPP_MSG','../../errors/AppError','axios','126313MaIALz','captureException','child_process','writable','405brwQoN','getOwnPropertyDescriptor','log','111244FDxpKX','519770ahqXMH','lookup','/dist','verifyMediaMessage','arraybuffer','number','apply','prototype','join','8436005MocTjB','utf8','exec','application/octet-stream','search','createReadStream','audio/ogg;\x20codecs=opus','data','getTime','path','audio/','from','\x20-i\x20\x22','sendMessage','isGroup','__esModule','2470689ShgJJL','hasOwnProperty','186dNXuvH','audio-record-site','.ogg','(((.+)+)+)+$','__createBinding','string','defineProperty','create','contact','__importDefault','public','1798483aesyKz','toString','binary','resolve','@ffmpeg-installer/ffmpeg','s.whatsapp.net'];a580_0x1409=function(){return _0x70d7b3;};return a580_0x1409();}exports[a580_0x124ac6(0x137)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x41fd52,ticket:_0xcba0c1,body:_0x21c7d6,userId:_0x50888d,quotedMsg:_0xd704a})=>{const _0x34c7d4=a580_0x124ac6;try{const _0x3d6273=await(0x0,GetTicketWbot_1[_0x34c7d4(0x13e)])(_0xcba0c1);let _0x163dbd,_0x57d6ec,_0x5a44cb;if(typeof _0x41fd52===_0x34c7d4(0x124)){const _0x565f64=await(0x0,axios_1['default'])({'url':_0x41fd52,'method':_0x34c7d4(0x148),'responseType':_0x34c7d4(0x15f)});_0x57d6ec=Date['now']()+'.'+mime_types_1[_0x34c7d4(0x13e)][_0x34c7d4(0x140)](_0x565f64['headers']['content-type']),_0x163dbd=path_1['default'][_0x34c7d4(0x163)](publicFolder,_0x57d6ec),fs_1[_0x34c7d4(0x13e)][_0x34c7d4(0x130)](_0x163dbd,_0x565f64[_0x34c7d4(0x114)]),_0x5a44cb=_0x565f64[_0x34c7d4(0x138)]['content-type'];}else _0x163dbd=_0x41fd52[_0x34c7d4(0x116)],_0x57d6ec=_0x41fd52[_0x34c7d4(0x135)],_0x5a44cb=_0x41fd52['mimetype'];try{_0x57d6ec=iconv_lite_1['default']['decode'](Buffer[_0x34c7d4(0x118)](_0x57d6ec||'',_0x34c7d4(0x12c)),_0x34c7d4(0x165));}catch(_0x5e5a98){console[_0x34c7d4(0x145)]('Error\x20converting\x20filename\x20to\x20UTF-8:',_0x5e5a98);}const _0x745b86=_0x50888d&&await User_1[_0x34c7d4(0x13e)]['findByPk'](_0x50888d),_0x35c54c=_0x21c7d6?(0x0,Mustache_1[_0x34c7d4(0x13e)])(_0x21c7d6,_0xcba0c1,_0x745b86):undefined,_0x39e112=await(0x0,exports[_0x34c7d4(0x137)])(_0x57d6ec,_0x163dbd,_0x5a44cb),_0x4f3685={..._0xd704a&&{'quoted':{'key':_0xd704a['id'],'message':JSON[_0x34c7d4(0x133)](_0xd704a['dataJson'])?.[_0x34c7d4(0x142)]}}},_0x50b441=_0xcba0c1[_0x34c7d4(0x127)][_0x34c7d4(0x141)]||_0xcba0c1['contact'][_0x34c7d4(0x160)]+'@'+(_0xcba0c1[_0x34c7d4(0x11b)]?_0x34c7d4(0x14b):_0xcba0c1[_0x34c7d4(0x127)]['number'][_0x34c7d4(0x143)]>0xd?'lid':_0x34c7d4(0x12f)),_0x13fbfb=await _0x3d6273[_0x34c7d4(0x11a)](_0x50b441,{'caption':_0x35c54c,'fileName':_0x57d6ec,..._0x39e112,..._0x4f3685});return _0x3d6273[_0x34c7d4(0x132)](_0x13fbfb),await(0x0,VerifyHandlers_1[_0x34c7d4(0x15e)])(_0x13fbfb,_0xcba0c1,_0xcba0c1[_0x34c7d4(0x127)]),_0x13fbfb;}catch(_0x5719f5){Sentry[_0x34c7d4(0x154)](_0x5719f5),console[_0x34c7d4(0x159)](_0x5719f5);throw new AppError_1[(_0x34c7d4(0x13e))](_0x34c7d4(0x150));}};exports[a580_0x124ac6(0x13e)]=SendWhatsAppMedia;