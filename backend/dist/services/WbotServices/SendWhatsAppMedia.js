'use strict';const a689_0xc183fe=a689_0x292e;(function(_0x41357a,_0x589165){const _0x57de12=a689_0x292e,_0x54bc50=_0x41357a();while(!![]){try{const _0x51ea34=parseInt(_0x57de12(0x19b))/0x1+-parseInt(_0x57de12(0x1ab))/0x2+-parseInt(_0x57de12(0x197))/0x3+-parseInt(_0x57de12(0x156))/0x4*(parseInt(_0x57de12(0x159))/0x5)+parseInt(_0x57de12(0x17e))/0x6*(-parseInt(_0x57de12(0x1a9))/0x7)+parseInt(_0x57de12(0x193))/0x8*(parseInt(_0x57de12(0x165))/0x9)+parseInt(_0x57de12(0x195))/0xa;if(_0x51ea34===_0x589165)break;else _0x54bc50['push'](_0x54bc50['shift']());}catch(_0x20ae0d){_0x54bc50['push'](_0x54bc50['shift']());}}}(a689_0x228e,0x49e2a));var __createBinding=this&&this[a689_0xc183fe(0x154)]||(Object[a689_0xc183fe(0x169)]?function(_0x366a05,_0x492724,_0x44353b,_0x1d4895){const _0x4050f2=a689_0xc183fe;if(_0x1d4895===undefined)_0x1d4895=_0x44353b;var _0x378bda=Object[_0x4050f2(0x1b0)](_0x492724,_0x44353b);(!_0x378bda||(_0x4050f2(0x153)in _0x378bda?!_0x492724['__esModule']:_0x378bda[_0x4050f2(0x18a)]||_0x378bda[_0x4050f2(0x157)]))&&(_0x378bda={'enumerable':!![],'get':function(){return _0x492724[_0x44353b];}}),Object['defineProperty'](_0x366a05,_0x1d4895,_0x378bda);}:function(_0x412fdf,_0x416c9e,_0xc0007c,_0x41ecda){if(_0x41ecda===undefined)_0x41ecda=_0xc0007c;_0x412fdf[_0x41ecda]=_0x416c9e[_0xc0007c];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x51e1c3,_0x448bfc){const _0x27ca34=a689_0xc183fe;Object[_0x27ca34(0x1a6)](_0x51e1c3,_0x27ca34(0x158),{'enumerable':!![],'value':_0x448bfc});}:function(_0x2af49d,_0x5a39ba){_0x2af49d['default']=_0x5a39ba;}),__importStar=this&&this[a689_0xc183fe(0x1aa)]||(function(){const _0x17724b=(function(){let _0x17531a=!![];return function(_0x2da7ac,_0x1260aa){const _0x1f0d1f=_0x17531a?function(){const _0x39422c=a689_0x292e;if(_0x1260aa){const _0x2ee5e8=_0x1260aa[_0x39422c(0x199)](_0x2da7ac,arguments);return _0x1260aa=null,_0x2ee5e8;}}:function(){};return _0x17531a=![],_0x1f0d1f;};}()),_0x341a36=_0x17724b(this,function(){const _0x46d70b=a689_0x292e;return _0x341a36[_0x46d70b(0x18d)]()[_0x46d70b(0x189)](_0x46d70b(0x18b))['toString']()[_0x46d70b(0x16a)](_0x341a36)[_0x46d70b(0x189)](_0x46d70b(0x18b));});_0x341a36();var _0x17ad25=function(_0x29d25a){const _0xba4233=a689_0x292e;return _0x17ad25=Object[_0xba4233(0x185)]||function(_0x15700a){const _0x4310e8=_0xba4233;var _0x1a7cc6=[];for(var _0x465f51 in _0x15700a)if(Object[_0x4310e8(0x151)][_0x4310e8(0x1a2)][_0x4310e8(0x19e)](_0x15700a,_0x465f51))_0x1a7cc6[_0x1a7cc6[_0x4310e8(0x15f)]]=_0x465f51;return _0x1a7cc6;},_0x17ad25(_0x29d25a);};return function(_0x2e23a8){const _0x1dcbfb=a689_0x292e;if(_0x2e23a8&&_0x2e23a8[_0x1dcbfb(0x1af)])return _0x2e23a8;var _0x45a450={};if(_0x2e23a8!=null){for(var _0x2e2913=_0x17ad25(_0x2e23a8),_0x15cddd=0x0;_0x15cddd<_0x2e2913[_0x1dcbfb(0x15f)];_0x15cddd++)if(_0x2e2913[_0x15cddd]!=='default')__createBinding(_0x45a450,_0x2e23a8,_0x2e2913[_0x15cddd]);}return __setModuleDefault(_0x45a450,_0x2e23a8),_0x45a450;};}()),__importDefault=this&&this[a689_0xc183fe(0x15d)]||function(_0x2ff6f1){return _0x2ff6f1&&_0x2ff6f1['__esModule']?_0x2ff6f1:{'default':_0x2ff6f1};};Object[a689_0xc183fe(0x1a6)](exports,a689_0xc183fe(0x1af),{'value':!![]}),exports[a689_0xc183fe(0x164)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),fs_1=__importDefault(require('fs')),child_process_1=require(a689_0xc183fe(0x179)),path_1=__importDefault(require(a689_0xc183fe(0x17b))),ffmpeg_1=__importDefault(require(a689_0xc183fe(0x188))),mime_types_1=__importDefault(require(a689_0xc183fe(0x183))),iconv_lite_1=__importDefault(require(a689_0xc183fe(0x17d))),AppError_1=__importDefault(require(a689_0xc183fe(0x16d))),GetTicketWbot_1=__importDefault(require(a689_0xc183fe(0x19d))),VerifyHandlers_1=require(a689_0xc183fe(0x18e)),axios_1=__importDefault(require(a689_0xc183fe(0x194))),Mustache_1=__importDefault(require(a689_0xc183fe(0x1ac))),User_1=__importDefault(require('../../models/User')),isCompiled=__dirname[a689_0xc183fe(0x171)]('dist'),publicFolder=isCompiled?path_1[a689_0xc183fe(0x158)][a689_0xc183fe(0x1a5)](__dirname,'..','..','..',a689_0xc183fe(0x152)):path_1['default']['resolve'](__dirname,'..','..','..',a689_0xc183fe(0x152)),supportedImages=[a689_0xc183fe(0x15a),a689_0xc183fe(0x17f),a689_0xc183fe(0x155),a689_0xc183fe(0x177)],processRecordedAudio=async _0x5407b2=>{const _0x35d7a1=a689_0xc183fe,_0xf0bae0=publicFolder+'/'+new Date()[_0x35d7a1(0x166)]()+_0x35d7a1(0x190);return new Promise((_0x5dce45,_0x3e1220)=>{const _0x3cdc07=_0x35d7a1;(0x0,child_process_1[_0x3cdc07(0x172)])(ffmpeg_1['default'][_0x3cdc07(0x17b)]+'\x20-i\x20\x22'+_0x5407b2+_0x3cdc07(0x1a3)+_0xf0bae0,(_0x595c0c,_0x50dc7e,_0x84e2d3)=>{const _0x163915=_0x3cdc07;if(_0x595c0c)_0x3e1220(_0x595c0c);_0x5dce45(fs_1[_0x163915(0x158)][_0x163915(0x1b1)](_0xf0bae0));});});},getMessageOptions=async(_0x3ff786,_0x1b48e6,_0x2807bd)=>{const _0x389be7=a689_0xc183fe;_0x2807bd=_0x2807bd||mime_types_1[_0x389be7(0x158)][_0x389be7(0x19f)](_0x1b48e6)||_0x389be7(0x174);try{let _0x335614;if(_0x2807bd['startsWith'](_0x389be7(0x168)))_0x335614={'video':{'stream':fs_1[_0x389be7(0x158)][_0x389be7(0x1b1)](_0x1b48e6)}};else{if(_0x2807bd===_0x389be7(0x161))_0x335614={'audio':{'stream':fs_1[_0x389be7(0x158)][_0x389be7(0x1b1)](_0x1b48e6)},'mimetype':_0x389be7(0x18f),'ptt':!![]};else{if(_0x2807bd[_0x389be7(0x1a4)](_0x389be7(0x15c))){const _0x45d5dd=_0x3ff786['includes'](_0x389be7(0x1ad));_0x335614={'audio':{'stream':_0x45d5dd?await processRecordedAudio(_0x1b48e6):fs_1['default'][_0x389be7(0x1b1)](_0x1b48e6)},'mimetype':_0x45d5dd?_0x389be7(0x18f):_0x2807bd,'ptt':_0x45d5dd};}else supportedImages[_0x389be7(0x171)](_0x2807bd)?_0x335614={'image':{'stream':fs_1['default'][_0x389be7(0x1b1)](_0x1b48e6)}}:_0x335614={'document':{'stream':fs_1[_0x389be7(0x158)][_0x389be7(0x1b1)](_0x1b48e6)},'mimetype':_0x2807bd};}}return _0x335614;}catch(_0x1b3973){return Sentry['captureException'](_0x1b3973),console[_0x389be7(0x16b)](_0x1b3973),null;}};exports[a689_0xc183fe(0x164)]=getMessageOptions;function a689_0x292e(_0x4a011f,_0x535ffa){const _0x1d2155=a689_0x228e();return a689_0x292e=function(_0x3b0297,_0x37a254){_0x3b0297=_0x3b0297-0x151;let _0x228efd=_0x1d2155[_0x3b0297];return _0x228efd;},a689_0x292e(_0x4a011f,_0x535ffa);}function a689_0x228e(){const _0x342fff=['prototype','public','get','__createBinding','image/jpeg','2108AaRQAg','configurable','default','1955umslUw','image/png','https://','audio/','__importDefault','@g.us','length','@s.whatsapp.net','audio/ogg','number','@lid','getMessageOptions','808335CyaIOy','getTime','basename','video/','create','constructor','log','remoteJid','../../errors/AppError','writeFileSync','SendWhatsAppMedia\x20-\x20Local\x20file:','findByPk','includes','exec','join','application/octet-stream','SendWhatsAppMedia\x20-\x20Sending\x20to:','utf8','image/webp','existsSync','child_process','captureException','path','string','iconv-lite','12JNWXSY','image/jpg','data','http://','Error\x20converting\x20filename\x20to\x20UTF-8:','mime-types','ERR_SENDING_WAPP_MSG:\x20Message\x20was\x20not\x20sent','getOwnPropertyNames','message','error','@ffmpeg-installer/ffmpeg','search','writable','(((.+)+)+)+$','headers','toString','./VerifyHandlers','audio/ogg;\x20codecs=opus','.ogg','ERR_SENDING_WAPP_MSG:\x20Contact\x20has\x20no\x20valid\x20number\x20or\x20remoteJid','cacheMessage','8dYHAXf','axios','12457160WpcSgP','ERR_SENDING_WAPP_MSG','1533321RSmtUr','verifyMediaMessage','apply','lid','86888hbVePp','binary','../../helpers/GetTicketWbot','call','lookup','sendMessage','dataJson','hasOwnProperty','\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20','startsWith','resolve','defineProperty','from','GET','235417SwHgmr','__importStar','670718zUJzvr','../../helpers/Mustache','audio-record-site','isGroup','__esModule','getOwnPropertyDescriptor','createReadStream','content-type','contact'];a689_0x228e=function(){return _0x342fff;};return a689_0x228e();}const SendWhatsAppMedia=async({media:_0x171ebf,ticket:_0x4a711a,body:_0x389b2d,userId:_0x2d98c6,quotedMsg:_0xf1bbce})=>{const _0x5b725c=a689_0xc183fe;try{const _0x218408=await(0x0,GetTicketWbot_1[_0x5b725c(0x158)])(_0x4a711a);let _0x438626,_0x25d278,_0x44de0f;if(typeof _0x171ebf===_0x5b725c(0x17c)){if(_0x171ebf['startsWith'](_0x5b725c(0x181))||_0x171ebf[_0x5b725c(0x1a4)](_0x5b725c(0x15b))){const _0x324673=await(0x0,axios_1[_0x5b725c(0x158)])({'url':_0x171ebf,'method':_0x5b725c(0x1a8),'responseType':'arraybuffer'});_0x25d278=Date['now']()+'.'+mime_types_1['default']['extension'](_0x324673[_0x5b725c(0x18c)][_0x5b725c(0x1b2)]),_0x438626=path_1['default'][_0x5b725c(0x173)](publicFolder,_0x25d278),fs_1[_0x5b725c(0x158)][_0x5b725c(0x16e)](_0x438626,_0x324673[_0x5b725c(0x180)]),_0x44de0f=_0x324673[_0x5b725c(0x18c)]['content-type'];}else _0x438626=_0x171ebf,_0x25d278=path_1[_0x5b725c(0x158)][_0x5b725c(0x167)](_0x171ebf),_0x44de0f=mime_types_1[_0x5b725c(0x158)][_0x5b725c(0x19f)](_0x171ebf)||_0x5b725c(0x174),console['log'](_0x5b725c(0x16f),{'pathMedia':_0x438626,'fileName':_0x25d278,'mimetype':_0x44de0f,'fileExists':fs_1['default'][_0x5b725c(0x178)](_0x438626)});}else _0x438626=_0x171ebf[_0x5b725c(0x17b)],_0x25d278=_0x171ebf['originalname'],_0x44de0f=_0x171ebf['mimetype'];try{_0x25d278=iconv_lite_1['default']['decode'](Buffer[_0x5b725c(0x1a7)](_0x25d278||'',_0x5b725c(0x19c)),_0x5b725c(0x176));}catch(_0x3b9cfa){console[_0x5b725c(0x187)](_0x5b725c(0x182),_0x3b9cfa);}const _0x2f0375=_0x2d98c6&&await User_1[_0x5b725c(0x158)][_0x5b725c(0x170)](_0x2d98c6),_0x4fc9ad=_0x389b2d?(0x0,Mustache_1['default'])(_0x389b2d,_0x4a711a,_0x2f0375):undefined,_0x5721af=await(0x0,exports['getMessageOptions'])(_0x25d278,_0x438626,_0x44de0f);if(!_0x5721af)throw new AppError_1['default']('ERR_SENDING_WAPP_MSG:\x20Failed\x20to\x20get\x20message\x20options');const _0x49a243={..._0xf1bbce&&{'quoted':{'key':_0xf1bbce['id'],'message':JSON['parse'](_0xf1bbce[_0x5b725c(0x1a1)])?.[_0x5b725c(0x186)]}}};let _0x5e166e;if(_0x4a711a[_0x5b725c(0x1ae)])_0x5e166e=_0x4a711a[_0x5b725c(0x1b3)]['number']+_0x5b725c(0x15e);else{if(_0x4a711a['contact']['remoteJid'])_0x5e166e=_0x4a711a['contact']['remoteJid'];else{if(_0x4a711a['contact'][_0x5b725c(0x162)])_0x5e166e=_0x4a711a['contact'][_0x5b725c(0x162)][_0x5b725c(0x15f)]>0xd?_0x4a711a[_0x5b725c(0x1b3)][_0x5b725c(0x162)]+_0x5b725c(0x163):_0x4a711a['contact'][_0x5b725c(0x162)]+_0x5b725c(0x160);else throw new AppError_1[(_0x5b725c(0x158))](_0x5b725c(0x191));}}console[_0x5b725c(0x16b)](_0x5b725c(0x175),{'ticketId':_0x4a711a['id'],'contactId':_0x4a711a[_0x5b725c(0x1b3)]['id'],'contactNumber':_0x4a711a[_0x5b725c(0x1b3)][_0x5b725c(0x162)],'contactRemoteJid':_0x4a711a[_0x5b725c(0x1b3)][_0x5b725c(0x16c)],'contactLid':_0x4a711a[_0x5b725c(0x1b3)][_0x5b725c(0x19a)],'finalNumber':_0x5e166e,'isGroup':_0x4a711a[_0x5b725c(0x1ae)]});const _0x35db19=await _0x218408[_0x5b725c(0x1a0)](_0x5e166e,{'caption':_0x4fc9ad,'fileName':_0x25d278,..._0x5721af,..._0x49a243});if(!_0x35db19)throw new AppError_1['default'](_0x5b725c(0x184));return _0x218408[_0x5b725c(0x192)](_0x35db19),await(0x0,VerifyHandlers_1[_0x5b725c(0x198)])(_0x35db19,_0x4a711a,_0x4a711a['contact']),_0x35db19;}catch(_0x5f2174){Sentry[_0x5b725c(0x17a)](_0x5f2174),console[_0x5b725c(0x16b)](_0x5f2174);throw new AppError_1[(_0x5b725c(0x158))](_0x5b725c(0x196));}};exports[a689_0xc183fe(0x158)]=SendWhatsAppMedia;