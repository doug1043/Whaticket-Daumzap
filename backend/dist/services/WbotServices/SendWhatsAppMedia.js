function a549_0x157c(_0x2ad532,_0x37143a){const _0x185291=a549_0x563d();return a549_0x157c=function(_0x43a3e3,_0x4b4261){_0x43a3e3=_0x43a3e3-0x1e9;let _0x563d56=_0x185291[_0x43a3e3];return _0x563d56;},a549_0x157c(_0x2ad532,_0x37143a);}const a549_0x15f302=a549_0x157c;(function(_0x45a26a,_0x50f57f){const _0x345c64=a549_0x157c,_0xc1f1a0=_0x45a26a();while(!![]){try{const _0x13fd3b=-parseInt(_0x345c64(0x22f))/0x1*(parseInt(_0x345c64(0x217))/0x2)+-parseInt(_0x345c64(0x23a))/0x3*(-parseInt(_0x345c64(0x22d))/0x4)+-parseInt(_0x345c64(0x1f3))/0x5+-parseInt(_0x345c64(0x224))/0x6+parseInt(_0x345c64(0x20a))/0x7*(parseInt(_0x345c64(0x223))/0x8)+parseInt(_0x345c64(0x1ff))/0x9*(-parseInt(_0x345c64(0x20c))/0xa)+parseInt(_0x345c64(0x1f0))/0xb;if(_0x13fd3b===_0x50f57f)break;else _0xc1f1a0['push'](_0xc1f1a0['shift']());}catch(_0x542571){_0xc1f1a0['push'](_0xc1f1a0['shift']());}}}(a549_0x563d,0xa1d0f));const a549_0x4b4261=(function(){let _0x48cfdd=!![];return function(_0x4494e5,_0x29750a){const _0x2eab40=_0x48cfdd?function(){const _0x4ecdd8=a549_0x157c;if(_0x29750a){const _0x3070e4=_0x29750a[_0x4ecdd8(0x1ea)](_0x4494e5,arguments);return _0x29750a=null,_0x3070e4;}}:function(){};return _0x48cfdd=![],_0x2eab40;};}()),a549_0x43a3e3=a549_0x4b4261(this,function(){const _0x571c66=a549_0x157c;return a549_0x43a3e3[_0x571c66(0x1fd)]()[_0x571c66(0x21e)](_0x571c66(0x228))[_0x571c66(0x1fd)]()['constructor'](a549_0x43a3e3)[_0x571c66(0x21e)](_0x571c66(0x228));});a549_0x43a3e3();function a549_0x563d(){const _0x55a1cd=['update','originalname','text/plain','video/mp4','toString','pop','54Dwyagg','__esModule','s.whatsapp.net','mimetype','key','captureException','video/3gpp2','call','audio','__createBinding','setFfmpegPath','7xAimjC','ffmpeg-static','235140ceGpiD','resolve','sendMessage','default','create','log','readFileSync','get','application/msword','Invalid\x20mimetype','startsWith','1661850taRZFP','filename','hasOwnProperty','getOwnPropertyDescriptor','join','isGroup','\x20-i\x20','search','application/x-7z-compressed','trace','__setModuleDefault','participant','4959896uqgRTh','5827026eTBzZp','application/pdf','includes','exec','(((.+)+)+)+$','public','number','video','getMessageOptions','8lAgMKJ','length','1bBoRZz','application/zip','audio/mp4','remoteJid','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','application/vnd.ms-excel','lookup','configurable','document','body','application/rtf','1248600efRaGL','getTime','ERR_SENDING_WAPP_MSG','http','child_process','@sentry/node','/public','getBodyMessage','defineProperty','fromMe','__importDefault','audio-record-site','application','text','string','contact','audio/ogg','split','application/vnd.openxmlformats-officedocument.wordprocessingml.document','audio/mp3','path','image/png','apply','g.us','/company','application/octet-stream','application/x-rar-compressed','application/vnd.openxmlformats-officedocument.presentationml.presentation','22786313sEQJIH','stringify','image/jpeg','4589455ihhyEl','video/3gpp','fluent-ffmpeg','companyId','.mp3','SendWhatsAppMediaFileAddress'];a549_0x563d=function(){return _0x55a1cd;};return a549_0x563d();}'use strict';var __createBinding=this&&this[a549_0x15f302(0x208)]||(Object[a549_0x15f302(0x210)]?function(_0x4521cc,_0x340789,_0x32a452,_0x2c74db){const _0x54a388=a549_0x15f302;if(_0x2c74db===undefined)_0x2c74db=_0x32a452;var _0x12039a=Object[_0x54a388(0x21a)](_0x340789,_0x32a452);(!_0x12039a||(_0x54a388(0x213)in _0x12039a?!_0x340789['__esModule']:_0x12039a['writable']||_0x12039a[_0x54a388(0x236)]))&&(_0x12039a={'enumerable':!![],'get':function(){return _0x340789[_0x32a452];}}),Object['defineProperty'](_0x4521cc,_0x2c74db,_0x12039a);}:function(_0x35e4eb,_0x3c6e97,_0x2efba0,_0x27a0d2){if(_0x27a0d2===undefined)_0x27a0d2=_0x2efba0;_0x35e4eb[_0x27a0d2]=_0x3c6e97[_0x2efba0];}),__setModuleDefault=this&&this[a549_0x15f302(0x221)]||(Object[a549_0x15f302(0x210)]?function(_0x466550,_0x1b49f4){const _0x2f90be=a549_0x15f302;Object[_0x2f90be(0x242)](_0x466550,_0x2f90be(0x20f),{'enumerable':!![],'value':_0x1b49f4});}:function(_0x579d50,_0x28ad11){const _0x2624ae=a549_0x15f302;_0x579d50[_0x2624ae(0x20f)]=_0x28ad11;}),__importStar=this&&this['__importStar']||function(_0x2c7348){const _0x17d74c=a549_0x15f302;if(_0x2c7348&&_0x2c7348[_0x17d74c(0x200)])return _0x2c7348;var _0x3463b={};if(_0x2c7348!=null){for(var _0x492677 in _0x2c7348)if(_0x492677!==_0x17d74c(0x20f)&&Object['prototype'][_0x17d74c(0x219)][_0x17d74c(0x206)](_0x2c7348,_0x492677))__createBinding(_0x3463b,_0x2c7348,_0x492677);}return __setModuleDefault(_0x3463b,_0x2c7348),_0x3463b;},__importDefault=this&&this[a549_0x15f302(0x244)]||function(_0x37a59e){const _0x4490b0=a549_0x15f302;return _0x37a59e&&_0x37a59e[_0x4490b0(0x200)]?_0x37a59e:{'default':_0x37a59e};};Object[a549_0x15f302(0x242)](exports,a549_0x15f302(0x200),{'value':!![]}),exports[a549_0x15f302(0x1f8)]=exports[a549_0x15f302(0x22c)]=void 0x0;const Sentry=__importStar(require(a549_0x15f302(0x23f))),fs_1=__importDefault(require('fs')),child_process_1=require(a549_0x15f302(0x23e)),path_1=__importDefault(require('path')),fluent_ffmpeg_1=__importDefault(require(a549_0x15f302(0x1f5))),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),mime_types_1=__importDefault(require('mime-types')),Mustache_1=__importDefault(require('../../helpers/Mustache')),ffmpeg_static_1=__importDefault(require(a549_0x15f302(0x20b))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),wbotMessageListener_1=require('./wbotMessageListener');fluent_ffmpeg_1[a549_0x15f302(0x20f)][a549_0x15f302(0x209)](ffmpeg_static_1[a549_0x15f302(0x20f)]);const publicFolder=path_1['default'][a549_0x15f302(0x20d)](__dirname,'..','..','..',a549_0x15f302(0x229)),processAudio=async(_0x3e2c6d,_0xd9de7e)=>{const _0xf7534f=a549_0x15f302,_0x5b1440=publicFolder+_0xf7534f(0x1ec)+_0xd9de7e+'/'+new Date()[_0xf7534f(0x23b)]()+_0xf7534f(0x1f7);return new Promise((_0x272dc4,_0x107143)=>{const _0x48b45a=_0xf7534f;(0x0,child_process_1[_0x48b45a(0x227)])(ffmpeg_static_1[_0x48b45a(0x20f)]+_0x48b45a(0x21d)+_0x3e2c6d+'\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20'+_0x5b1440+'\x20-y',(_0x3df226,_0x5d6f80,_0xb602b0)=>{const _0x25ed12=_0x48b45a;if(_0x3df226)_0x107143(_0x3df226);fs_1[_0x25ed12(0x20f)]['unlinkSync'](_0x3e2c6d),_0x272dc4(_0x5b1440);});});},processAudioFile=async _0x1662d4=>{const _0x282f81=a549_0x15f302,_0x4dc3e9=publicFolder+'/'+new Date()[_0x282f81(0x23b)]()+_0x282f81(0x1f7);return new Promise((_0x310527,_0x560981)=>{const _0x26af2c=_0x282f81;(0x0,child_process_1[_0x26af2c(0x227)])(ffmpeg_static_1[_0x26af2c(0x20f)]+'\x20-i\x20'+_0x1662d4+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x4dc3e9,(_0x3333c9,_0x1d5ed0,_0x496d76)=>{const _0x1e6766=_0x26af2c;if(_0x3333c9)_0x560981(_0x3333c9);fs_1[_0x1e6766(0x20f)]['unlinkSync'](_0x1662d4),_0x310527(_0x4dc3e9);});});},getMessageOptions=async(_0x1fd634,_0x42c6ab,_0x27a613,_0xf7309b)=>{const _0x50cf57=a549_0x15f302,_0x34c04c=mime_types_1[_0x50cf57(0x20f)][_0x50cf57(0x235)](_0x42c6ab),_0x5c18e8=_0x34c04c[_0x50cf57(0x24b)]('/')[0x0];try{if(!_0x34c04c)throw new Error(_0x50cf57(0x215));let _0x57b7d8;if(_0x5c18e8===_0x50cf57(0x22b))_0x57b7d8={'video':fs_1[_0x50cf57(0x20f)]['readFileSync'](_0x42c6ab),'caption':_0x27a613?_0x27a613:'','fileName':_0x1fd634};else{if(_0x5c18e8===_0x50cf57(0x207)){const _0x547711=!![],_0x54af06=await processAudio(_0x42c6ab,_0xf7309b);_0x547711?_0x57b7d8={'audio':fs_1['default'][_0x50cf57(0x212)](_0x54af06),'mimetype':_0x547711?_0x50cf57(0x231):_0x34c04c,'caption':_0x27a613?_0x27a613:null,'ptt':!![]}:_0x57b7d8={'audio':fs_1[_0x50cf57(0x20f)]['readFileSync'](_0x54af06),'mimetype':_0x547711?_0x50cf57(0x231):_0x34c04c,'caption':_0x27a613?_0x27a613:null,'ptt':!![]};}else{if(_0x5c18e8===_0x50cf57(0x237))_0x57b7d8={'document':fs_1['default']['readFileSync'](_0x42c6ab),'caption':_0x27a613?_0x27a613:null,'fileName':_0x1fd634,'mimetype':_0x34c04c};else _0x5c18e8===_0x50cf57(0x246)?_0x57b7d8={'document':fs_1[_0x50cf57(0x20f)][_0x50cf57(0x212)](_0x42c6ab),'caption':_0x27a613?_0x27a613:null,'fileName':_0x1fd634,'mimetype':_0x34c04c}:_0x57b7d8={'image':fs_1[_0x50cf57(0x20f)][_0x50cf57(0x212)](_0x42c6ab),'caption':_0x27a613?_0x27a613:null};}}return _0x57b7d8;}catch(_0x522001){return Sentry[_0x50cf57(0x204)](_0x522001),console[_0x50cf57(0x211)](_0x522001),null;}};exports['getMessageOptions']=getMessageOptions;const SendWhatsAppMedia=async({media:_0x512b90,ticket:_0x3e5846,body:_0x51dff5})=>{const _0x1af860=a549_0x15f302;try{const _0x2312f1=await(0x0,GetTicketWbot_1[_0x1af860(0x20f)])(_0x3e5846),_0x4d3155=_0x512b90[_0x1af860(0x24e)],_0x1c8049=_0x512b90['mimetype'][_0x1af860(0x24b)]('/')[0x0];let _0x177997;const _0x4dfb7b=(0x0,Mustache_1[_0x1af860(0x20f)])(_0x51dff5,_0x3e5846);var _0x330510=_0x512b90[_0x1af860(0x218)];if(_0x1c8049===_0x1af860(0x22b))_0x177997={'video':fs_1[_0x1af860(0x20f)]['readFileSync'](_0x4d3155),'caption':_0x4dfb7b,'fileName':_0x512b90[_0x1af860(0x1fa)]};else{if(_0x1c8049===_0x1af860(0x207)){const _0x69c824=_0x512b90[_0x1af860(0x1fa)][_0x1af860(0x226)](_0x1af860(0x245));if(_0x69c824){const _0x42dbce=await processAudio(_0x512b90['path'],_0x3e5846['companyId']);_0x177997={'audio':fs_1[_0x1af860(0x20f)]['readFileSync'](_0x42dbce),'mimetype':_0x69c824?_0x1af860(0x231):_0x512b90[_0x1af860(0x202)],'ptt':!![]},_0x330510=_0x42dbce[_0x1af860(0x24b)]('/')[_0x42dbce['split']('/')[_0x1af860(0x22e)]-0x1];}else{const _0xab3644=await processAudioFile(_0x512b90[_0x1af860(0x24e)]);_0x177997={'audio':fs_1['default'][_0x1af860(0x212)](_0xab3644),'mimetype':_0x69c824?_0x1af860(0x231):_0x512b90[_0x1af860(0x202)]},_0x330510=_0xab3644['split']('/')[_0xab3644[_0x1af860(0x24b)]('/')[_0x1af860(0x22e)]-0x1];}}else{if(_0x1c8049===_0x1af860(0x237)||_0x1c8049===_0x1af860(0x247))_0x177997={'document':fs_1[_0x1af860(0x20f)][_0x1af860(0x212)](_0x4d3155),'caption':_0x4dfb7b,'fileName':_0x512b90[_0x1af860(0x1fa)],'mimetype':_0x512b90[_0x1af860(0x202)]};else _0x1c8049===_0x1af860(0x246)?_0x177997={'document':fs_1[_0x1af860(0x20f)][_0x1af860(0x212)](_0x4d3155),'caption':_0x4dfb7b,'fileName':_0x512b90['originalname'],'mimetype':_0x512b90[_0x1af860(0x202)]}:_0x177997={'image':fs_1[_0x1af860(0x20f)][_0x1af860(0x212)](_0x4d3155),'caption':_0x4dfb7b};}}var _0x332d58=await _0x2312f1['sendMessage'](_0x3e5846[_0x1af860(0x249)][_0x1af860(0x22a)]+'@'+(_0x3e5846[_0x1af860(0x21c)]?_0x1af860(0x1eb):_0x1af860(0x201)),{..._0x177997});const _0x550ae3=await(0x0,wbotMessageListener_1['verifyQuotedMessage'])(_0x332d58),_0x458987={'id':_0x332d58[_0x1af860(0x203)]['id'],'ticketId':_0x3e5846['id'],'contactId':undefined,'body':_0x51dff5?(0x0,Mustache_1[_0x1af860(0x20f)])(_0x51dff5,_0x3e5846):(0x0,wbotMessageListener_1[_0x1af860(0x241)])(_0x332d58),'fromMe':_0x332d58[_0x1af860(0x203)]['fromMe'],'read':_0x332d58[_0x1af860(0x203)][_0x1af860(0x243)],'mediaUrl':_0x330510,'mediaType':_0x1c8049,'quotedMsgId':_0x550ae3?.['id'],'ack':0x0,'remoteJid':_0x332d58[_0x1af860(0x203)][_0x1af860(0x232)],'participant':_0x332d58[_0x1af860(0x203)][_0x1af860(0x222)],'dataJson':JSON[_0x1af860(0x1f1)](_0x332d58)};return typeof _0x458987[_0x1af860(0x238)]!=_0x1af860(0x248)&&console[_0x1af860(0x220)]('body\x20is\x20not\x20a\x20string',_0x458987[_0x1af860(0x238)]),await _0x3e5846[_0x1af860(0x1f9)]({'lastMessage':_0x458987['body']}),await(0x0,CreateMessageService_1[_0x1af860(0x20f)])({'messageData':_0x458987,'ticket':_0x3e5846,'companyId':_0x3e5846['companyId']}),_0x332d58;}catch(_0x43a01e){Sentry[_0x1af860(0x204)](_0x43a01e),console['trace'](_0x43a01e);throw new AppError_1['default']('ERR_SENDING_WAPP_MSG');}};exports[a549_0x15f302(0x20f)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x25fa38,_0x375b88,_0x2656cf)=>{const _0x281116=a549_0x15f302;try{const _0x400368=await(0x0,GetTicketWbot_1[_0x281116(0x20f)])(_0x375b88);_0x25fa38[_0x281116(0x216)](_0x281116(0x23d))&&(_0x25fa38='./public'+_0x25fa38[_0x281116(0x24b)](_0x281116(0x240))[0x1]);const _0x25b5ec=_0x25fa38,_0x4122da=getMimeType(_0x25fa38)[_0x281116(0x24b)]('/')[0x0];let _0x116b53;if(_0x4122da==='video')_0x116b53={'video':fs_1[_0x281116(0x20f)][_0x281116(0x212)](_0x25b5ec),'caption':_0x2656cf,'fileName':extractFileName(_0x25fa38)};else{if(_0x4122da===_0x281116(0x207)){const _0x591e6c=_0x25fa38[_0x281116(0x226)](_0x281116(0x245));if(_0x591e6c){const _0x2aa8e6=await processAudio(_0x25fa38,_0x375b88[_0x281116(0x1f6)]);_0x116b53={'audio':fs_1[_0x281116(0x20f)][_0x281116(0x212)](_0x2aa8e6),'mimetype':_0x591e6c?_0x281116(0x231):getMimeType(_0x25fa38),'ptt':!![]};}else{const _0x597acd=await processAudioFile(_0x25fa38);_0x116b53={'audio':fs_1['default']['readFileSync'](_0x597acd),'mimetype':_0x591e6c?_0x281116(0x231):getMimeType(_0x25fa38)};}}else{if(_0x4122da===_0x281116(0x237)||_0x4122da===_0x281116(0x247))_0x116b53={'document':fs_1[_0x281116(0x20f)][_0x281116(0x212)](_0x25b5ec),'caption':_0x2656cf,'fileName':extractFileName(_0x25fa38),'mimetype':getMimeType(_0x25fa38)};else _0x4122da===_0x281116(0x246)?_0x116b53={'document':fs_1[_0x281116(0x20f)][_0x281116(0x212)](_0x25b5ec),'caption':_0x2656cf,'fileName':extractFileName(_0x25fa38),'mimetype':getMimeType(_0x25fa38)}:_0x116b53={'image':fs_1['default'][_0x281116(0x212)](_0x25b5ec),'caption':_0x2656cf};}}const _0x4f5a0d=await _0x400368[_0x281116(0x20e)](_0x375b88[_0x281116(0x249)][_0x281116(0x22a)]+'@'+(_0x375b88[_0x281116(0x21c)]?'g.us':_0x281116(0x201)),{..._0x116b53});return _0x4f5a0d;}catch(_0x4d6745){Sentry[_0x281116(0x204)](_0x4d6745),console[_0x281116(0x211)](_0x4d6745);throw new AppError_1[(_0x281116(0x20f))](_0x281116(0x23c));}};exports[a549_0x15f302(0x1f8)]=SendWhatsAppMediaFileAddress;const extractFileName=_0x5bb883=>{const _0x2d9990=a549_0x15f302,_0x19b289=_0x5bb883[_0x2d9990(0x24b)]('/');return _0x19b289[_0x19b289[_0x2d9990(0x22e)]-0x1];},extractFilePath=_0x17882f=>{const _0x4a49be=a549_0x15f302,_0x1b84b4=_0x17882f[_0x4a49be(0x24b)]('/');return _0x1b84b4[_0x4a49be(0x1fe)](),_0x1b84b4[_0x4a49be(0x21b)]('/');},getMimeType=_0x5cca3b=>{const _0x1df80c=a549_0x15f302,_0x55d9a2=_0x5cca3b['split']('.'),_0x1f6335=_0x55d9a2[_0x55d9a2[_0x1df80c(0x22e)]-0x1],_0x34b206={'jpg':'image/jpeg','jpeg':_0x1df80c(0x1f2),'png':_0x1df80c(0x1e9),'gif':'image/gif','mp4':_0x1df80c(0x1fc),'mp3':_0x1df80c(0x24d),'m4a':_0x1df80c(0x231),'ogg':_0x1df80c(0x24a),'pdf':_0x1df80c(0x225),'doc':_0x1df80c(0x214),'docx':_0x1df80c(0x24c),'xls':_0x1df80c(0x234),'xlsx':_0x1df80c(0x233),'ppt':'application/vnd.ms-powerpoint','pptx':_0x1df80c(0x1ef),'txt':_0x1df80c(0x1fb),'rtf':_0x1df80c(0x239),'csv':'text/csv','html':'text/html','zip':_0x1df80c(0x230),'rar':_0x1df80c(0x1ee),'7z':_0x1df80c(0x21f),'3gp':_0x1df80c(0x1f4),'3g2':_0x1df80c(0x205),'3ga':_0x1df80c(0x1f4),'7gp':_0x1df80c(0x205),'7ga':_0x1df80c(0x1f4),'3gpp':'video/3gpp','3gpp2':'video/3gpp2','7gpp':'video/3gpp','7gpp2':'video/3gpp2','3gpp-tt':'video/3gpp','3gpp2-tt':_0x1df80c(0x205),'7gpp-tt':_0x1df80c(0x1f4),'7gpp2-tt':_0x1df80c(0x205),'3gpp-rtt':_0x1df80c(0x1f4),'3gpp2-rtt':_0x1df80c(0x205),'7gpp-rtt':_0x1df80c(0x1f4),'7gpp2-rtt':_0x1df80c(0x205),'3gpp-sms':_0x1df80c(0x1f4),'3gpp2-sms':'video/3gpp2','7gpp-sms':_0x1df80c(0x1f4),'7gpp2-sms':_0x1df80c(0x205),'pdfa':'application/pdf','x-pdf':_0x1df80c(0x225)};if(_0x34b206[_0x1f6335])return _0x34b206[_0x1f6335];return _0x1df80c(0x1ed);};