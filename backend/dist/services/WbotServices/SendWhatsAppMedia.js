'use strict';const a576_0x58f4cb=a576_0x4a4a;function a576_0x4a4a(_0x14c09d,_0x5785ca){const _0x2c2896=a576_0xe973();return a576_0x4a4a=function(_0x3df91a,_0x16b417){_0x3df91a=_0x3df91a-0x79;let _0xe973ac=_0x2c2896[_0x3df91a];return _0xe973ac;},a576_0x4a4a(_0x14c09d,_0x5785ca);}(function(_0x21b4ee,_0x4b458b){const _0x2598e3=a576_0x4a4a,_0x200af4=_0x21b4ee();while(!![]){try{const _0x2fe8ce=-parseInt(_0x2598e3(0xb5))/0x1+parseInt(_0x2598e3(0xc7))/0x2+parseInt(_0x2598e3(0x7a))/0x3*(parseInt(_0x2598e3(0x91))/0x4)+parseInt(_0x2598e3(0xac))/0x5*(-parseInt(_0x2598e3(0x9f))/0x6)+parseInt(_0x2598e3(0x98))/0x7*(-parseInt(_0x2598e3(0x92))/0x8)+-parseInt(_0x2598e3(0xc4))/0x9*(-parseInt(_0x2598e3(0xa9))/0xa)+-parseInt(_0x2598e3(0xc0))/0xb;if(_0x2fe8ce===_0x4b458b)break;else _0x200af4['push'](_0x200af4['shift']());}catch(_0x19e7c8){_0x200af4['push'](_0x200af4['shift']());}}}(a576_0xe973,0xe19e6));var __createBinding=this&&this[a576_0x58f4cb(0x86)]||(Object[a576_0x58f4cb(0xc1)]?function(_0x395923,_0x297962,_0x418f9a,_0x3ca8b4){const _0x5c2383=a576_0x58f4cb;if(_0x3ca8b4===undefined)_0x3ca8b4=_0x418f9a;var _0x163840=Object[_0x5c2383(0xa1)](_0x297962,_0x418f9a);(!_0x163840||(_0x5c2383(0x80)in _0x163840?!_0x297962['__esModule']:_0x163840[_0x5c2383(0x9c)]||_0x163840[_0x5c2383(0xb3)]))&&(_0x163840={'enumerable':!![],'get':function(){return _0x297962[_0x418f9a];}}),Object['defineProperty'](_0x395923,_0x3ca8b4,_0x163840);}:function(_0xd6a16b,_0x529cf5,_0x3aa822,_0x40a63a){if(_0x40a63a===undefined)_0x40a63a=_0x3aa822;_0xd6a16b[_0x40a63a]=_0x529cf5[_0x3aa822];}),__setModuleDefault=this&&this[a576_0x58f4cb(0xcd)]||(Object[a576_0x58f4cb(0xc1)]?function(_0x2ec42f,_0x135557){const _0x31dc6d=a576_0x58f4cb;Object[_0x31dc6d(0xbb)](_0x2ec42f,_0x31dc6d(0xa7),{'enumerable':!![],'value':_0x135557});}:function(_0x2d54e8,_0x54980e){_0x2d54e8['default']=_0x54980e;}),__importStar=this&&this['__importStar']||(function(){const _0x30de96=(function(){let _0x52e5f8=!![];return function(_0x571b8c,_0x23b303){const _0x4c60b4=_0x52e5f8?function(){const _0x25970d=a576_0x4a4a;if(_0x23b303){const _0x41eb88=_0x23b303[_0x25970d(0xa5)](_0x571b8c,arguments);return _0x23b303=null,_0x41eb88;}}:function(){};return _0x52e5f8=![],_0x4c60b4;};}()),_0x11efb4=_0x30de96(this,function(){const _0x1a11e5=a576_0x4a4a;return _0x11efb4[_0x1a11e5(0xc8)]()[_0x1a11e5(0xba)](_0x1a11e5(0xb7))[_0x1a11e5(0xc8)]()[_0x1a11e5(0xa0)](_0x11efb4)['search']('(((.+)+)+)+$');});_0x11efb4();var _0x2d81cd=function(_0x86a6c4){const _0x293998=a576_0x4a4a;return _0x2d81cd=Object[_0x293998(0x82)]||function(_0x24b166){const _0x3c29a1=_0x293998;var _0x2a47e0=[];for(var _0xdee743 in _0x24b166)if(Object[_0x3c29a1(0xc9)]['hasOwnProperty']['call'](_0x24b166,_0xdee743))_0x2a47e0[_0x2a47e0[_0x3c29a1(0x90)]]=_0xdee743;return _0x2a47e0;},_0x2d81cd(_0x86a6c4);};return function(_0x482f34){const _0x14eda2=a576_0x4a4a;if(_0x482f34&&_0x482f34['__esModule'])return _0x482f34;var _0x38f63b={};if(_0x482f34!=null){for(var _0x1b1866=_0x2d81cd(_0x482f34),_0x39e80a=0x0;_0x39e80a<_0x1b1866[_0x14eda2(0x90)];_0x39e80a++)if(_0x1b1866[_0x39e80a]!==_0x14eda2(0xa7))__createBinding(_0x38f63b,_0x482f34,_0x1b1866[_0x39e80a]);}return __setModuleDefault(_0x38f63b,_0x482f34),_0x38f63b;};}()),__importDefault=this&&this[a576_0x58f4cb(0x95)]||function(_0x254b55){const _0x2c253f=a576_0x58f4cb;return _0x254b55&&_0x254b55[_0x2c253f(0x8d)]?_0x254b55:{'default':_0x254b55};};Object[a576_0x58f4cb(0xbb)](exports,a576_0x58f4cb(0x8d),{'value':!![]}),exports[a576_0x58f4cb(0x9d)]=void 0x0;function a576_0xe973(){const _0x32d2be=['.ogg','originalname','3935675Jfnyzm','isGroup','../../helpers/Mustache','extension','image/jpeg','content-type','verifyMediaMessage','configurable','audio-record-site','61442eYazFe','decode','(((.+)+)+)+$','ERR_SENDING_WAPP_MSG','createReadStream','search','defineProperty','./VerifyHandlers','path','../../models/User','Error\x20converting\x20filename\x20to\x20UTF-8:','13578125HVUzAZ','create','exec','GET','12242169dPWkYU','binary','string','3187032IjtywD','toString','prototype','iconv-lite','startsWith','writeFileSync','__setModuleDefault','contact','3684UatQTn','cacheMessage','now','number','from','parse','get','join','getOwnPropertyNames','resolve','mimetype','public','__createBinding','message','captureException','../../helpers/GetTicketWbot','log','axios','arraybuffer','__esModule','@ffmpeg-installer/ffmpeg','sendMessage','length','732iXHVwR','274232cHfnvj','g.us','getTime','__importDefault','endsWith','data','35pFOaHj','\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20','video/','headers','writable','getMessageOptions','application/octet-stream','6cTsLAr','constructor','getOwnPropertyDescriptor','child_process','audio/ogg;\x20codecs=opus','mime-types','apply','includes','default','@sentry/node','10LoOKTY'];a576_0xe973=function(){return _0x32d2be;};return a576_0xe973();}const Sentry=__importStar(require(a576_0x58f4cb(0xa8))),fs_1=__importDefault(require('fs')),child_process_1=require(a576_0x58f4cb(0xa2)),path_1=__importDefault(require(a576_0x58f4cb(0xbd))),ffmpeg_1=__importDefault(require(a576_0x58f4cb(0x8e))),mime_types_1=__importDefault(require(a576_0x58f4cb(0xa4))),iconv_lite_1=__importDefault(require(a576_0x58f4cb(0xca))),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require(a576_0x58f4cb(0x89))),VerifyHandlers_1=require(a576_0x58f4cb(0xbc)),axios_1=__importDefault(require(a576_0x58f4cb(0x8b))),Mustache_1=__importDefault(require(a576_0x58f4cb(0xae))),User_1=__importDefault(require(a576_0x58f4cb(0xbe))),publicFolder=__dirname[a576_0x58f4cb(0x96)]('/dist')?path_1[a576_0x58f4cb(0xa7)][a576_0x58f4cb(0x83)](__dirname,'..',a576_0x58f4cb(0x85)):path_1[a576_0x58f4cb(0xa7)][a576_0x58f4cb(0x83)](__dirname,'..','..','..',a576_0x58f4cb(0x85)),supportedImages=['image/png','image/jpg',a576_0x58f4cb(0xb0),'image/webp'],processRecordedAudio=async _0xc68580=>{const _0x24207c=a576_0x58f4cb,_0x1df326=publicFolder+'/'+new Date()[_0x24207c(0x94)]()+_0x24207c(0xaa);return new Promise((_0x66f21e,_0x5d52a4)=>{const _0x121214=_0x24207c;(0x0,child_process_1[_0x121214(0xc2)])(ffmpeg_1[_0x121214(0xa7)][_0x121214(0xbd)]+'\x20-i\x20\x22'+_0xc68580+_0x121214(0x99)+_0x1df326,(_0x597498,_0x4183c7,_0x5d6d95)=>{const _0xdd123e=_0x121214;if(_0x597498)_0x5d52a4(_0x597498);_0x66f21e(fs_1[_0xdd123e(0xa7)][_0xdd123e(0xb9)](_0x1df326));});});},getMessageOptions=async(_0x39443a,_0xd03587,_0x25002f)=>{const _0x417836=a576_0x58f4cb;_0x25002f=_0x25002f||mime_types_1['default']['lookup'](_0xd03587)||_0x417836(0x9e);try{let _0x2eb752;if(_0x25002f[_0x417836(0xcb)](_0x417836(0x9a)))_0x2eb752={'video':{'stream':fs_1[_0x417836(0xa7)][_0x417836(0xb9)](_0xd03587)}};else{if(_0x25002f==='audio/ogg')_0x2eb752={'audio':{'stream':fs_1[_0x417836(0xa7)][_0x417836(0xb9)](_0xd03587)},'mimetype':'audio/ogg;\x20codecs=opus','ptt':!![]};else{if(_0x25002f[_0x417836(0xcb)]('audio/')){const _0xee5eac=_0x39443a[_0x417836(0xa6)](_0x417836(0xb4));_0x2eb752={'audio':{'stream':_0xee5eac?await processRecordedAudio(_0xd03587):fs_1[_0x417836(0xa7)][_0x417836(0xb9)](_0xd03587)},'mimetype':_0xee5eac?_0x417836(0xa3):_0x25002f,'ptt':_0xee5eac};}else supportedImages[_0x417836(0xa6)](_0x25002f)?_0x2eb752={'image':{'stream':fs_1[_0x417836(0xa7)][_0x417836(0xb9)](_0xd03587)}}:_0x2eb752={'document':{'stream':fs_1[_0x417836(0xa7)]['createReadStream'](_0xd03587)},'mimetype':_0x25002f};}}return _0x2eb752;}catch(_0x51afe5){return Sentry[_0x417836(0x88)](_0x51afe5),console[_0x417836(0x8a)](_0x51afe5),null;}};exports[a576_0x58f4cb(0x9d)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x4a3a77,ticket:_0x2f2176,body:_0x137ece,userId:_0x169fa7,quotedMsg:_0x150e65})=>{const _0x26f52e=a576_0x58f4cb;try{const _0x1cb725=await(0x0,GetTicketWbot_1[_0x26f52e(0xa7)])(_0x2f2176);let _0x447381,_0x172a7e,_0x25c23b;if(typeof _0x4a3a77===_0x26f52e(0xc6)){const _0x424929=await(0x0,axios_1[_0x26f52e(0xa7)])({'url':_0x4a3a77,'method':_0x26f52e(0xc3),'responseType':_0x26f52e(0x8c)});_0x172a7e=Date[_0x26f52e(0x7c)]()+'.'+mime_types_1[_0x26f52e(0xa7)][_0x26f52e(0xaf)](_0x424929[_0x26f52e(0x9b)][_0x26f52e(0xb1)]),_0x447381=path_1['default'][_0x26f52e(0x81)](publicFolder,_0x172a7e),fs_1['default'][_0x26f52e(0xcc)](_0x447381,_0x424929[_0x26f52e(0x97)]),_0x25c23b=_0x424929[_0x26f52e(0x9b)][_0x26f52e(0xb1)];}else _0x447381=_0x4a3a77[_0x26f52e(0xbd)],_0x172a7e=_0x4a3a77[_0x26f52e(0xab)],_0x25c23b=_0x4a3a77[_0x26f52e(0x84)];try{_0x172a7e=iconv_lite_1[_0x26f52e(0xa7)][_0x26f52e(0xb6)](Buffer[_0x26f52e(0x7e)](_0x172a7e||'',_0x26f52e(0xc5)),'utf8');}catch(_0x517b6d){console['error'](_0x26f52e(0xbf),_0x517b6d);}const _0x741fd2=_0x169fa7&&await User_1[_0x26f52e(0xa7)]['findByPk'](_0x169fa7),_0x50a7a4=_0x137ece?(0x0,Mustache_1[_0x26f52e(0xa7)])(_0x137ece,_0x2f2176,_0x741fd2):undefined,_0x426ca0=await(0x0,exports[_0x26f52e(0x9d)])(_0x172a7e,_0x447381,_0x25c23b),_0x7b59b5={..._0x150e65&&{'quoted':{'key':_0x150e65['id'],'message':JSON[_0x26f52e(0x7f)](_0x150e65['dataJson'])?.[_0x26f52e(0x87)]}}},_0x1af936=await _0x1cb725[_0x26f52e(0x8f)](_0x2f2176[_0x26f52e(0x79)][_0x26f52e(0x7d)]+'@'+(_0x2f2176[_0x26f52e(0xad)]?_0x26f52e(0x93):'s.whatsapp.net'),{'caption':_0x50a7a4,'fileName':_0x172a7e,..._0x426ca0,..._0x7b59b5});return _0x1cb725[_0x26f52e(0x7b)](_0x1af936),await(0x0,VerifyHandlers_1[_0x26f52e(0xb2)])(_0x1af936,_0x2f2176,_0x2f2176[_0x26f52e(0x79)]),_0x1af936;}catch(_0x5e2228){Sentry[_0x26f52e(0x88)](_0x5e2228),console[_0x26f52e(0x8a)](_0x5e2228);throw new AppError_1[(_0x26f52e(0xa7))](_0x26f52e(0xb8));}};exports['default']=SendWhatsAppMedia;