'use strict';const a580_0x45a452=a580_0x551f;function a580_0x3771(){const _0x254450=['resolve','dataJson','length','getOwnPropertyDescriptor','remoteJid','audio-record-site','default','__setModuleDefault','search','6quyvIQ','Error\x20converting\x20filename\x20to\x20UTF-8:','GET','configurable','../../errors/AppError','number','../../helpers/Mustache','getTime','arraybuffer','lookup','audio/','axios','1282475WztTMi','@ffmpeg-installer/ffmpeg','video/','defineProperty','exec','mime-types','public','utf8','toString','6781341WTMUJQ','content-type','__createBinding','get','../../helpers/GetTicketWbot','headers','captureException','from','getMessageOptions','__importDefault','11005398VWZQqu','mimetype','binary','775002KojVJq','(((.+)+)+)+$','log','../../models/User','1168056ggBakX','hasOwnProperty','data','path','7022088YMeEos','startsWith','includes','verifyMediaMessage','contact','audio/ogg;\x20codecs=opus','10767592TznaBj','createReadStream','@g.us','./VerifyHandlers','create','now','@sentry/node','extension','endsWith','__esModule','writeFileSync','cacheMessage','\x20-i\x20\x22','getOwnPropertyNames','application/octet-stream','findByPk','__importStar','\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20'];a580_0x3771=function(){return _0x254450;};return a580_0x3771();}(function(_0x4c5e44,_0x2e6733){const _0x423268=a580_0x551f,_0x45d964=_0x4c5e44();while(!![]){try{const _0x4ecba1=parseInt(_0x423268(0x97))/0x1+-parseInt(_0x423268(0x93))/0x2*(-parseInt(_0x423268(0xbc))/0x3)+-parseInt(_0x423268(0x9b))/0x4+parseInt(_0x423268(0xc8))/0x5+-parseInt(_0x423268(0x90))/0x6+parseInt(_0x423268(0x86))/0x7+parseInt(_0x423268(0xa1))/0x8;if(_0x4ecba1===_0x2e6733)break;else _0x45d964['push'](_0x45d964['shift']());}catch(_0xc1f8a2){_0x45d964['push'](_0x45d964['shift']());}}}(a580_0x3771,0xe1b5e));var __createBinding=this&&this[a580_0x45a452(0x88)]||(Object[a580_0x45a452(0xa5)]?function(_0x22bff9,_0x17e761,_0x1b6276,_0x5477df){const _0x1f20ad=a580_0x45a452;if(_0x5477df===undefined)_0x5477df=_0x1b6276;var _0x5d926f=Object[_0x1f20ad(0xb6)](_0x17e761,_0x1b6276);(!_0x5d926f||(_0x1f20ad(0x89)in _0x5d926f?!_0x17e761['__esModule']:_0x5d926f['writable']||_0x5d926f[_0x1f20ad(0xbf)]))&&(_0x5d926f={'enumerable':!![],'get':function(){return _0x17e761[_0x1b6276];}}),Object[_0x1f20ad(0xcb)](_0x22bff9,_0x5477df,_0x5d926f);}:function(_0x4023aa,_0x3172df,_0x3b36ad,_0xae6661){if(_0xae6661===undefined)_0xae6661=_0x3b36ad;_0x4023aa[_0xae6661]=_0x3172df[_0x3b36ad];}),__setModuleDefault=this&&this[a580_0x45a452(0xba)]||(Object[a580_0x45a452(0xa5)]?function(_0x402d60,_0x51f718){const _0x2bf1c8=a580_0x45a452;Object[_0x2bf1c8(0xcb)](_0x402d60,_0x2bf1c8(0xb9),{'enumerable':!![],'value':_0x51f718});}:function(_0x3d1051,_0xd8b163){const _0xca649a=a580_0x45a452;_0x3d1051[_0xca649a(0xb9)]=_0xd8b163;}),__importStar=this&&this[a580_0x45a452(0xb1)]||(function(){const _0x5a8290=(function(){let _0x20c343=!![];return function(_0x4b0885,_0x51d377){const _0x596bb3=_0x20c343?function(){if(_0x51d377){const _0xcc589e=_0x51d377['apply'](_0x4b0885,arguments);return _0x51d377=null,_0xcc589e;}}:function(){};return _0x20c343=![],_0x596bb3;};}()),_0xd7f9f8=_0x5a8290(this,function(){const _0x262755=a580_0x551f;return _0xd7f9f8[_0x262755(0x85)]()['search'](_0x262755(0x94))[_0x262755(0x85)]()['constructor'](_0xd7f9f8)[_0x262755(0xbb)](_0x262755(0x94));});_0xd7f9f8();var _0x1ebb7f=function(_0x367f99){const _0x33a9bf=a580_0x551f;return _0x1ebb7f=Object[_0x33a9bf(0xae)]||function(_0x209c4d){const _0x547138=_0x33a9bf;var _0x2b9588=[];for(var _0x3f938d in _0x209c4d)if(Object['prototype'][_0x547138(0x98)]['call'](_0x209c4d,_0x3f938d))_0x2b9588[_0x2b9588[_0x547138(0xb5)]]=_0x3f938d;return _0x2b9588;},_0x1ebb7f(_0x367f99);};return function(_0x1a1718){const _0x310143=a580_0x551f;if(_0x1a1718&&_0x1a1718['__esModule'])return _0x1a1718;var _0x50228e={};if(_0x1a1718!=null){for(var _0x2ed55c=_0x1ebb7f(_0x1a1718),_0x353f9e=0x0;_0x353f9e<_0x2ed55c[_0x310143(0xb5)];_0x353f9e++)if(_0x2ed55c[_0x353f9e]!==_0x310143(0xb9))__createBinding(_0x50228e,_0x1a1718,_0x2ed55c[_0x353f9e]);}return __setModuleDefault(_0x50228e,_0x1a1718),_0x50228e;};}()),__importDefault=this&&this[a580_0x45a452(0x8f)]||function(_0x599a42){const _0x5898e7=a580_0x45a452;return _0x599a42&&_0x599a42[_0x5898e7(0xaa)]?_0x599a42:{'default':_0x599a42};};function a580_0x551f(_0x24cb2b,_0x4b9394){const _0x4ad76d=a580_0x3771();return a580_0x551f=function(_0x484482,_0x494af7){_0x484482=_0x484482-0x85;let _0x37717b=_0x4ad76d[_0x484482];return _0x37717b;},a580_0x551f(_0x24cb2b,_0x4b9394);}Object[a580_0x45a452(0xcb)](exports,a580_0x45a452(0xaa),{'value':!![]}),exports['getMessageOptions']=void 0x0;const Sentry=__importStar(require(a580_0x45a452(0xa7))),fs_1=__importDefault(require('fs')),child_process_1=require('child_process'),path_1=__importDefault(require('path')),ffmpeg_1=__importDefault(require(a580_0x45a452(0xc9))),mime_types_1=__importDefault(require(a580_0x45a452(0xcd))),iconv_lite_1=__importDefault(require('iconv-lite')),AppError_1=__importDefault(require(a580_0x45a452(0xc0))),GetTicketWbot_1=__importDefault(require(a580_0x45a452(0x8a))),VerifyHandlers_1=require(a580_0x45a452(0xa4)),axios_1=__importDefault(require(a580_0x45a452(0xc7))),Mustache_1=__importDefault(require(a580_0x45a452(0xc2))),User_1=__importDefault(require(a580_0x45a452(0x96))),publicFolder=__dirname[a580_0x45a452(0xa9)]('/dist')?path_1[a580_0x45a452(0xb9)][a580_0x45a452(0xb3)](__dirname,'..',a580_0x45a452(0xce)):path_1[a580_0x45a452(0xb9)][a580_0x45a452(0xb3)](__dirname,'..','..','..',a580_0x45a452(0xce)),supportedImages=['image/png','image/jpg','image/jpeg','image/webp'],processRecordedAudio=async _0x599b2b=>{const _0x52ed99=a580_0x45a452,_0x1c27ae=publicFolder+'/'+new Date()[_0x52ed99(0xc3)]()+'.ogg';return new Promise((_0x5d8f23,_0xc8897)=>{const _0x2b78a5=_0x52ed99;(0x0,child_process_1[_0x2b78a5(0xcc)])(ffmpeg_1['default'][_0x2b78a5(0x9a)]+_0x2b78a5(0xad)+_0x599b2b+_0x2b78a5(0xb2)+_0x1c27ae,(_0x481dd3,_0x2f9b52,_0xc2630d)=>{const _0x2f69dc=_0x2b78a5;if(_0x481dd3)_0xc8897(_0x481dd3);_0x5d8f23(fs_1[_0x2f69dc(0xb9)][_0x2f69dc(0xa2)](_0x1c27ae));});});},getMessageOptions=async(_0x186741,_0x1c86f2,_0x26929b)=>{const _0x21303b=a580_0x45a452;_0x26929b=_0x26929b||mime_types_1['default'][_0x21303b(0xc5)](_0x1c86f2)||_0x21303b(0xaf);try{let _0x12817c;if(_0x26929b[_0x21303b(0x9c)](_0x21303b(0xca)))_0x12817c={'video':{'stream':fs_1[_0x21303b(0xb9)][_0x21303b(0xa2)](_0x1c86f2)}};else{if(_0x26929b==='audio/ogg')_0x12817c={'audio':{'stream':fs_1['default']['createReadStream'](_0x1c86f2)},'mimetype':_0x21303b(0xa0),'ptt':!![]};else{if(_0x26929b[_0x21303b(0x9c)](_0x21303b(0xc6))){const _0x5069fb=_0x186741[_0x21303b(0x9d)](_0x21303b(0xb8));_0x12817c={'audio':{'stream':_0x5069fb?await processRecordedAudio(_0x1c86f2):fs_1[_0x21303b(0xb9)][_0x21303b(0xa2)](_0x1c86f2)},'mimetype':_0x5069fb?_0x21303b(0xa0):_0x26929b,'ptt':_0x5069fb};}else supportedImages[_0x21303b(0x9d)](_0x26929b)?_0x12817c={'image':{'stream':fs_1[_0x21303b(0xb9)]['createReadStream'](_0x1c86f2)}}:_0x12817c={'document':{'stream':fs_1[_0x21303b(0xb9)][_0x21303b(0xa2)](_0x1c86f2)},'mimetype':_0x26929b};}}return _0x12817c;}catch(_0x1ee89a){return Sentry[_0x21303b(0x8c)](_0x1ee89a),console[_0x21303b(0x95)](_0x1ee89a),null;}};exports[a580_0x45a452(0x8e)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x4d8cfc,ticket:_0x3ed0d0,body:_0x16e8ec,userId:_0x32b951,quotedMsg:_0x49a119})=>{const _0x51693c=a580_0x45a452;try{const _0x3b19be=await(0x0,GetTicketWbot_1[_0x51693c(0xb9)])(_0x3ed0d0);let _0x442dbe,_0x1eb7e9,_0x3fdae6;if(typeof _0x4d8cfc==='string'){const _0x2ae283=await(0x0,axios_1[_0x51693c(0xb9)])({'url':_0x4d8cfc,'method':_0x51693c(0xbe),'responseType':_0x51693c(0xc4)});_0x1eb7e9=Date[_0x51693c(0xa6)]()+'.'+mime_types_1[_0x51693c(0xb9)][_0x51693c(0xa8)](_0x2ae283[_0x51693c(0x8b)]['content-type']),_0x442dbe=path_1[_0x51693c(0xb9)]['join'](publicFolder,_0x1eb7e9),fs_1[_0x51693c(0xb9)][_0x51693c(0xab)](_0x442dbe,_0x2ae283[_0x51693c(0x99)]),_0x3fdae6=_0x2ae283[_0x51693c(0x8b)][_0x51693c(0x87)];}else _0x442dbe=_0x4d8cfc[_0x51693c(0x9a)],_0x1eb7e9=_0x4d8cfc['originalname'],_0x3fdae6=_0x4d8cfc[_0x51693c(0x91)];try{_0x1eb7e9=iconv_lite_1[_0x51693c(0xb9)]['decode'](Buffer[_0x51693c(0x8d)](_0x1eb7e9||'',_0x51693c(0x92)),_0x51693c(0xcf));}catch(_0x21c6ce){console['error'](_0x51693c(0xbd),_0x21c6ce);}const _0x3cbe11=_0x32b951&&await User_1['default'][_0x51693c(0xb0)](_0x32b951),_0x12313b=_0x16e8ec?(0x0,Mustache_1[_0x51693c(0xb9)])(_0x16e8ec,_0x3ed0d0,_0x3cbe11):undefined,_0xd0b3eb=await(0x0,exports[_0x51693c(0x8e)])(_0x1eb7e9,_0x442dbe,_0x3fdae6),_0x74994b={..._0x49a119&&{'quoted':{'key':_0x49a119['id'],'message':JSON['parse'](_0x49a119[_0x51693c(0xb4)])?.['message']}}},_0x1c8239=_0x3ed0d0['isGroup']?_0x3ed0d0[_0x51693c(0x9f)]['number']+_0x51693c(0xa3):_0x3ed0d0[_0x51693c(0x9f)][_0x51693c(0xb7)]||_0x3ed0d0[_0x51693c(0x9f)][_0x51693c(0xc1)]+'@s.whatsapp.net',_0x2e93a2=await _0x3b19be['sendMessage'](_0x1c8239,{'caption':_0x12313b,'fileName':_0x1eb7e9,..._0xd0b3eb,..._0x74994b});return _0x3b19be[_0x51693c(0xac)](_0x2e93a2),await(0x0,VerifyHandlers_1[_0x51693c(0x9e)])(_0x2e93a2,_0x3ed0d0,_0x3ed0d0['contact']),_0x2e93a2;}catch(_0x1a4bb1){Sentry[_0x51693c(0x8c)](_0x1a4bb1),console['log'](_0x1a4bb1);throw new AppError_1[(_0x51693c(0xb9))]('ERR_SENDING_WAPP_MSG');}};exports['default']=SendWhatsAppMedia;