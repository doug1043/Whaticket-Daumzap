'use strict';const a688_0x5693c2=a688_0x2ef1;(function(_0x1c0db1,_0x49d2b7){const _0xe82d5f=a688_0x2ef1,_0x6fbeb1=_0x1c0db1();while(!![]){try{const _0x4756aa=parseInt(_0xe82d5f(0x1e8))/0x1*(parseInt(_0xe82d5f(0x1f5))/0x2)+parseInt(_0xe82d5f(0x208))/0x3+-parseInt(_0xe82d5f(0x219))/0x4+parseInt(_0xe82d5f(0x1f6))/0x5+parseInt(_0xe82d5f(0x218))/0x6*(-parseInt(_0xe82d5f(0x1ea))/0x7)+parseInt(_0xe82d5f(0x1c7))/0x8*(parseInt(_0xe82d5f(0x1f8))/0x9)+parseInt(_0xe82d5f(0x1cd))/0xa;if(_0x4756aa===_0x49d2b7)break;else _0x6fbeb1['push'](_0x6fbeb1['shift']());}catch(_0x3113f4){_0x6fbeb1['push'](_0x6fbeb1['shift']());}}}(a688_0x4a92,0x5e12d));function a688_0x2ef1(_0x37f358,_0x3a79e4){const _0x4af603=a688_0x4a92();return a688_0x2ef1=function(_0xeffbb7,_0x1cdad5){_0xeffbb7=_0xeffbb7-0x1c2;let _0x4a92f3=_0x4af603[_0xeffbb7];return _0x4a92f3;},a688_0x2ef1(_0x37f358,_0x3a79e4);}function a688_0x4a92(){const _0x1bc036=['1225685ixwkzR','utf8','14706rGuWWN','prototype','image/jpg','get','log','path','public','cacheMessage','image/webp','default','startsWith','captureException','audio-record-site','../../models/User','__importStar','createReadStream','941901VCswyT','number','../../errors/AppError','iconv-lite','ERR_SENDING_WAPP_MSG:\x20Contact\x20has\x20no\x20valid\x20number\x20or\x20remoteJid','content-type','GET','originalname','apply','SendWhatsAppMedia\x20-\x20Local\x20file:','mimetype','lid','@ffmpeg-installer/ffmpeg','__importDefault','application/octet-stream','__esModule','3175068pClWDu','180368BAaOtZ','getMessageOptions','getTime','basename','length','configurable','192rPpHUg','exec','(((.+)+)+)+$','binary','SendWhatsAppMedia\x20-\x20Sending\x20to:','parse','2676860TpAmqM','from','https://','audio/ogg','getOwnPropertyDescriptor','audio/ogg;\x20codecs=opus','http://','ERR_SENDING_WAPP_MSG:\x20Message\x20was\x20not\x20sent','mime-types','\x22\x20-vn\x20-ar\x2016000\x20-ac\x201\x20-c:a\x20libopus\x20-b:a\x200\x20','remoteJid','verifyMediaMessage','data','lookup','axios','toString','create','now','@sentry/node','../../helpers/Mustache','sendMessage','./VerifyHandlers','includes','writeFileSync','\x20-i\x20\x22','isGroup','defineProperty','1cFBnOj','call','7Qynain','headers','constructor','join','contact','findByPk','string','/dist','resolve','search','hasOwnProperty','187178RpzEZZ'];a688_0x4a92=function(){return _0x1bc036;};return a688_0x4a92();}var __createBinding=this&&this['__createBinding']||(Object[a688_0x5693c2(0x1dd)]?function(_0x4967d3,_0x50b4fd,_0x455188,_0x8de28e){const _0xa2fbfa=a688_0x5693c2;if(_0x8de28e===undefined)_0x8de28e=_0x455188;var _0x1470c2=Object[_0xa2fbfa(0x1d1)](_0x50b4fd,_0x455188);(!_0x1470c2||(_0xa2fbfa(0x1fb)in _0x1470c2?!_0x50b4fd[_0xa2fbfa(0x217)]:_0x1470c2['writable']||_0x1470c2[_0xa2fbfa(0x1c6)]))&&(_0x1470c2={'enumerable':!![],'get':function(){return _0x50b4fd[_0x455188];}}),Object[_0xa2fbfa(0x1e7)](_0x4967d3,_0x8de28e,_0x1470c2);}:function(_0x3b6719,_0x50f105,_0x12d70a,_0x331da8){if(_0x331da8===undefined)_0x331da8=_0x12d70a;_0x3b6719[_0x331da8]=_0x50f105[_0x12d70a];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a688_0x5693c2(0x1dd)]?function(_0x45c9d2,_0x2c83af){const _0x591b08=a688_0x5693c2;Object[_0x591b08(0x1e7)](_0x45c9d2,_0x591b08(0x201),{'enumerable':!![],'value':_0x2c83af});}:function(_0x25f2d6,_0x14b1ad){const _0x21b9ee=a688_0x5693c2;_0x25f2d6[_0x21b9ee(0x201)]=_0x14b1ad;}),__importStar=this&&this[a688_0x5693c2(0x206)]||(function(){const _0x65bccd=(function(){let _0x13614b=!![];return function(_0x2a49b8,_0x53d2a3){const _0x430bae=_0x13614b?function(){const _0x474c92=a688_0x2ef1;if(_0x53d2a3){const _0x470bd3=_0x53d2a3[_0x474c92(0x210)](_0x2a49b8,arguments);return _0x53d2a3=null,_0x470bd3;}}:function(){};return _0x13614b=![],_0x430bae;};}()),_0x1445a3=_0x65bccd(this,function(){const _0x557415=a688_0x2ef1;return _0x1445a3['toString']()[_0x557415(0x1f3)](_0x557415(0x1c9))[_0x557415(0x1dc)]()[_0x557415(0x1ec)](_0x1445a3)[_0x557415(0x1f3)]('(((.+)+)+)+$');});_0x1445a3();var _0x1a5013=function(_0x2efb9f){return _0x1a5013=Object['getOwnPropertyNames']||function(_0x29fd29){const _0x581c28=a688_0x2ef1;var _0x127345=[];for(var _0x576bfe in _0x29fd29)if(Object[_0x581c28(0x1f9)][_0x581c28(0x1f4)][_0x581c28(0x1e9)](_0x29fd29,_0x576bfe))_0x127345[_0x127345[_0x581c28(0x1c5)]]=_0x576bfe;return _0x127345;},_0x1a5013(_0x2efb9f);};return function(_0x369356){const _0x1c8615=a688_0x2ef1;if(_0x369356&&_0x369356[_0x1c8615(0x217)])return _0x369356;var _0x46a79d={};if(_0x369356!=null){for(var _0x11398b=_0x1a5013(_0x369356),_0x2d9ba3=0x0;_0x2d9ba3<_0x11398b[_0x1c8615(0x1c5)];_0x2d9ba3++)if(_0x11398b[_0x2d9ba3]!==_0x1c8615(0x201))__createBinding(_0x46a79d,_0x369356,_0x11398b[_0x2d9ba3]);}return __setModuleDefault(_0x46a79d,_0x369356),_0x46a79d;};}()),__importDefault=this&&this[a688_0x5693c2(0x215)]||function(_0x468618){const _0x3208a7=a688_0x5693c2;return _0x468618&&_0x468618[_0x3208a7(0x217)]?_0x468618:{'default':_0x468618};};Object[a688_0x5693c2(0x1e7)](exports,a688_0x5693c2(0x217),{'value':!![]}),exports[a688_0x5693c2(0x1c2)]=void 0x0;const Sentry=__importStar(require(a688_0x5693c2(0x1df))),fs_1=__importDefault(require('fs')),child_process_1=require('child_process'),path_1=__importDefault(require('path')),ffmpeg_1=__importDefault(require(a688_0x5693c2(0x214))),mime_types_1=__importDefault(require(a688_0x5693c2(0x1d5))),iconv_lite_1=__importDefault(require(a688_0x5693c2(0x20b))),AppError_1=__importDefault(require(a688_0x5693c2(0x20a))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),VerifyHandlers_1=require(a688_0x5693c2(0x1e2)),axios_1=__importDefault(require(a688_0x5693c2(0x1db))),Mustache_1=__importDefault(require(a688_0x5693c2(0x1e0))),User_1=__importDefault(require(a688_0x5693c2(0x205))),publicFolder=__dirname['endsWith'](a688_0x5693c2(0x1f1))?path_1[a688_0x5693c2(0x201)]['resolve'](__dirname,'..',a688_0x5693c2(0x1fe)):path_1[a688_0x5693c2(0x201)][a688_0x5693c2(0x1f2)](__dirname,'..','..','..',a688_0x5693c2(0x1fe)),supportedImages=['image/png',a688_0x5693c2(0x1fa),'image/jpeg',a688_0x5693c2(0x200)],processRecordedAudio=async _0x2d751c=>{const _0x4e97e2=a688_0x5693c2,_0x579e5d=publicFolder+'/'+new Date()[_0x4e97e2(0x1c3)]()+'.ogg';return new Promise((_0x526a46,_0x201d36)=>{const _0x106406=_0x4e97e2;(0x0,child_process_1[_0x106406(0x1c8)])(ffmpeg_1[_0x106406(0x201)][_0x106406(0x1fd)]+_0x106406(0x1e5)+_0x2d751c+_0x106406(0x1d6)+_0x579e5d,(_0x2f68,_0x3c135b,_0x6503f1)=>{const _0x52494b=_0x106406;if(_0x2f68)_0x201d36(_0x2f68);_0x526a46(fs_1[_0x52494b(0x201)][_0x52494b(0x207)](_0x579e5d));});});},getMessageOptions=async(_0x3301dc,_0x2a133e,_0x522e92)=>{const _0x1c1b01=a688_0x5693c2;_0x522e92=_0x522e92||mime_types_1[_0x1c1b01(0x201)][_0x1c1b01(0x1da)](_0x2a133e)||'application/octet-stream';try{let _0x314854;if(_0x522e92[_0x1c1b01(0x202)]('video/'))_0x314854={'video':{'stream':fs_1[_0x1c1b01(0x201)][_0x1c1b01(0x207)](_0x2a133e)}};else{if(_0x522e92===_0x1c1b01(0x1d0))_0x314854={'audio':{'stream':fs_1[_0x1c1b01(0x201)][_0x1c1b01(0x207)](_0x2a133e)},'mimetype':'audio/ogg;\x20codecs=opus','ptt':!![]};else{if(_0x522e92[_0x1c1b01(0x202)]('audio/')){const _0x168414=_0x3301dc['includes'](_0x1c1b01(0x204));_0x314854={'audio':{'stream':_0x168414?await processRecordedAudio(_0x2a133e):fs_1[_0x1c1b01(0x201)]['createReadStream'](_0x2a133e)},'mimetype':_0x168414?_0x1c1b01(0x1d2):_0x522e92,'ptt':_0x168414};}else supportedImages[_0x1c1b01(0x1e3)](_0x522e92)?_0x314854={'image':{'stream':fs_1[_0x1c1b01(0x201)][_0x1c1b01(0x207)](_0x2a133e)}}:_0x314854={'document':{'stream':fs_1[_0x1c1b01(0x201)][_0x1c1b01(0x207)](_0x2a133e)},'mimetype':_0x522e92};}}return _0x314854;}catch(_0x3fcce2){return Sentry[_0x1c1b01(0x203)](_0x3fcce2),console[_0x1c1b01(0x1fc)](_0x3fcce2),null;}};exports[a688_0x5693c2(0x1c2)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x58f2a5,ticket:_0x1599c4,body:_0x33eb3a,userId:_0x540d78,quotedMsg:_0x6c99d3})=>{const _0x53a50=a688_0x5693c2;try{const _0x52cd93=await(0x0,GetTicketWbot_1['default'])(_0x1599c4);let _0xfe1c8a,_0x201bb0,_0x4f2e5d;if(typeof _0x58f2a5===_0x53a50(0x1f0)){if(_0x58f2a5[_0x53a50(0x202)](_0x53a50(0x1d3))||_0x58f2a5[_0x53a50(0x202)](_0x53a50(0x1cf))){const _0xda87d2=await(0x0,axios_1[_0x53a50(0x201)])({'url':_0x58f2a5,'method':_0x53a50(0x20e),'responseType':'arraybuffer'});_0x201bb0=Date[_0x53a50(0x1de)]()+'.'+mime_types_1['default']['extension'](_0xda87d2['headers']['content-type']),_0xfe1c8a=path_1['default'][_0x53a50(0x1ed)](publicFolder,_0x201bb0),fs_1[_0x53a50(0x201)][_0x53a50(0x1e4)](_0xfe1c8a,_0xda87d2[_0x53a50(0x1d9)]),_0x4f2e5d=_0xda87d2[_0x53a50(0x1eb)][_0x53a50(0x20d)];}else _0xfe1c8a=_0x58f2a5,_0x201bb0=path_1[_0x53a50(0x201)][_0x53a50(0x1c4)](_0x58f2a5),_0x4f2e5d=mime_types_1['default'][_0x53a50(0x1da)](_0x58f2a5)||_0x53a50(0x216),console[_0x53a50(0x1fc)](_0x53a50(0x211),{'pathMedia':_0xfe1c8a,'fileName':_0x201bb0,'mimetype':_0x4f2e5d,'fileExists':fs_1[_0x53a50(0x201)]['existsSync'](_0xfe1c8a)});}else _0xfe1c8a=_0x58f2a5['path'],_0x201bb0=_0x58f2a5[_0x53a50(0x20f)],_0x4f2e5d=_0x58f2a5[_0x53a50(0x212)];try{_0x201bb0=iconv_lite_1['default']['decode'](Buffer[_0x53a50(0x1ce)](_0x201bb0||'',_0x53a50(0x1ca)),_0x53a50(0x1f7));}catch(_0xc5b298){console['error']('Error\x20converting\x20filename\x20to\x20UTF-8:',_0xc5b298);}const _0x4466c8=_0x540d78&&await User_1[_0x53a50(0x201)][_0x53a50(0x1ef)](_0x540d78),_0xebd0ab=_0x33eb3a?(0x0,Mustache_1['default'])(_0x33eb3a,_0x1599c4,_0x4466c8):undefined,_0xaee4a0=await(0x0,exports[_0x53a50(0x1c2)])(_0x201bb0,_0xfe1c8a,_0x4f2e5d);if(!_0xaee4a0)throw new AppError_1[(_0x53a50(0x201))]('ERR_SENDING_WAPP_MSG:\x20Failed\x20to\x20get\x20message\x20options');const _0x58a3c3={..._0x6c99d3&&{'quoted':{'key':_0x6c99d3['id'],'message':JSON[_0x53a50(0x1cc)](_0x6c99d3['dataJson'])?.['message']}}};let _0x12d710;if(_0x1599c4[_0x53a50(0x1e6)])_0x12d710=_0x1599c4[_0x53a50(0x1ee)]['number']+'@g.us';else{if(_0x1599c4[_0x53a50(0x1ee)][_0x53a50(0x1d7)])_0x12d710=_0x1599c4[_0x53a50(0x1ee)][_0x53a50(0x1d7)];else{if(_0x1599c4[_0x53a50(0x1ee)]['number'])_0x12d710=_0x1599c4[_0x53a50(0x1ee)][_0x53a50(0x209)][_0x53a50(0x1c5)]>0xd?_0x1599c4['contact']['number']+'@lid':_0x1599c4['contact']['number']+'@s.whatsapp.net';else throw new AppError_1[(_0x53a50(0x201))](_0x53a50(0x20c));}}console[_0x53a50(0x1fc)](_0x53a50(0x1cb),{'ticketId':_0x1599c4['id'],'contactId':_0x1599c4['contact']['id'],'contactNumber':_0x1599c4['contact'][_0x53a50(0x209)],'contactRemoteJid':_0x1599c4[_0x53a50(0x1ee)][_0x53a50(0x1d7)],'contactLid':_0x1599c4['contact'][_0x53a50(0x213)],'finalNumber':_0x12d710,'isGroup':_0x1599c4[_0x53a50(0x1e6)]});const _0x20d6fd=await _0x52cd93[_0x53a50(0x1e1)](_0x12d710,{'caption':_0xebd0ab,'fileName':_0x201bb0,..._0xaee4a0,..._0x58a3c3});if(!_0x20d6fd)throw new AppError_1[(_0x53a50(0x201))](_0x53a50(0x1d4));return _0x52cd93[_0x53a50(0x1ff)](_0x20d6fd),await(0x0,VerifyHandlers_1[_0x53a50(0x1d8)])(_0x20d6fd,_0x1599c4,_0x1599c4[_0x53a50(0x1ee)]),_0x20d6fd;}catch(_0x626024){Sentry[_0x53a50(0x203)](_0x626024),console[_0x53a50(0x1fc)](_0x626024);throw new AppError_1['default']('ERR_SENDING_WAPP_MSG');}};exports[a688_0x5693c2(0x201)]=SendWhatsAppMedia;