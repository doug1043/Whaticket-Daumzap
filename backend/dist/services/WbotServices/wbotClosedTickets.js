function a556_0x5644(){const _0x5eadb8=['default','nps','14GyzugH','updatedAt','delete','status','../TicketServices/ShowTicketService','563067NHRCaR','isGroup','setMinutes','verifyMessage','./SendWhatsAppMessage','getIO','contact','trace','155801QwhWac','__esModule','DESC','open','__importDefault','number','321904fzzJFS','string','-ticket','72606qqeXcY','../../models/Ticket','userId','getMinutes','SendPresenceStatus','emit','10LURPiH','toDate','-open','findByPk','4253227ZUjidB','14088vVnysl','../../models/TicketTraking','115PZLBTF','log','499892nLeJSw','defineProperty','../../helpers/Mustache','body\x20is\x20not\x20a\x20string','search','./wbotMessageListener','update','(((.+)+)+)+$','toString','findOne','27RgqQhn','../../libs/socket','whatsappId','companyId','../../helpers/SendPresenceStatus','company-','constructor','ClosedAllOpenTickets'];a556_0x5644=function(){return _0x5eadb8;};return a556_0x5644();}const a556_0x1315b2=a556_0x1f2c;(function(_0x422304,_0x168a03){const _0x2913d1=a556_0x1f2c,_0x4a78ba=_0x422304();while(!![]){try{const _0x3f37bd=parseInt(_0x2913d1(0x124))/0x1+parseInt(_0x2913d1(0x12d))/0x2*(parseInt(_0x2913d1(0x10d))/0x3)+parseInt(_0x2913d1(0x13c))/0x4+parseInt(_0x2913d1(0x13a))/0x5*(parseInt(_0x2913d1(0x138))/0x6)+parseInt(_0x2913d1(0x117))/0x7*(-parseInt(_0x2913d1(0x12a))/0x8)+-parseInt(_0x2913d1(0x11c))/0x9*(-parseInt(_0x2913d1(0x133))/0xa)+-parseInt(_0x2913d1(0x137))/0xb;if(_0x3f37bd===_0x168a03)break;else _0x4a78ba['push'](_0x4a78ba['shift']());}catch(_0x50478c){_0x4a78ba['push'](_0x4a78ba['shift']());}}}(a556_0x5644,0x3eba7));const a556_0x2750fc=(function(){let _0x718a5a=!![];return function(_0x56d225,_0x58aa91){const _0x41219b=_0x718a5a?function(){if(_0x58aa91){const _0x3de889=_0x58aa91['apply'](_0x56d225,arguments);return _0x58aa91=null,_0x3de889;}}:function(){};return _0x718a5a=![],_0x41219b;};}()),a556_0x2a54e3=a556_0x2750fc(this,function(){const _0x5a75bf=a556_0x1f2c;return a556_0x2a54e3[_0x5a75bf(0x10b)]()[_0x5a75bf(0x107)](_0x5a75bf(0x10a))[_0x5a75bf(0x10b)]()[_0x5a75bf(0x113)](a556_0x2a54e3)[_0x5a75bf(0x107)](_0x5a75bf(0x10a));});a556_0x2a54e3();'use strict';function a556_0x1f2c(_0x10c152,_0xc5dfdc){const _0x568e5a=a556_0x5644();return a556_0x1f2c=function(_0x2a54e3,_0x2750fc){_0x2a54e3=_0x2a54e3-0x105;let _0x56442e=_0x568e5a[_0x2a54e3];return _0x56442e;},a556_0x1f2c(_0x10c152,_0xc5dfdc);}var __importDefault=this&&this[a556_0x1315b2(0x128)]||function(_0x357c32){const _0x567538=a556_0x1315b2;return _0x357c32&&_0x357c32[_0x567538(0x125)]?_0x357c32:{'default':_0x357c32};};Object[a556_0x1315b2(0x13d)](exports,a556_0x1315b2(0x125),{'value':!![]}),exports[a556_0x1315b2(0x114)]=void 0x0;const sequelize_1=require('sequelize'),Ticket_1=__importDefault(require(a556_0x1315b2(0x12e))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),socket_1=require(a556_0x1315b2(0x10e)),Mustache_1=__importDefault(require(a556_0x1315b2(0x105))),SendWhatsAppMessage_1=__importDefault(require(a556_0x1315b2(0x120))),moment_1=__importDefault(require('moment')),ShowTicketService_1=__importDefault(require(a556_0x1315b2(0x11b))),wbotMessageListener_1=require(a556_0x1315b2(0x108)),TicketTraking_1=__importDefault(require(a556_0x1315b2(0x139))),SendPresenceStatus_1=require(a556_0x1315b2(0x111)),wbot_1=require('../../libs/wbot'),ClosedAllOpenTickets=async _0x52ad69=>{const _0x3af817=a556_0x1315b2,_0x433f83=async(_0x368a47,_0x5a775a,_0x3adfe5)=>{const _0x521ce9=a556_0x1f2c;if(_0x5a775a===_0x521ce9(0x116))typeof _0x3adfe5!=_0x521ce9(0x12b)&&console[_0x521ce9(0x123)]('body\x20is\x20not\x20a\x20string',_0x3adfe5),await _0x368a47[_0x521ce9(0x109)]({'status':'closed','lastMessage':_0x3adfe5,'unreadMessages':0x0,'amountUseBotQueues':0x0});else _0x5a775a===_0x521ce9(0x127)?(typeof _0x3adfe5!=_0x521ce9(0x12b)&&console[_0x521ce9(0x123)](_0x521ce9(0x106),_0x3adfe5),await _0x368a47['update']({'status':'closed','lastMessage':_0x3adfe5,'unreadMessages':0x0,'amountUseBotQueues':0x0})):await _0x368a47[_0x521ce9(0x109)]({'status':'closed','unreadMessages':0x0});},_0xed99fc=(0x0,socket_1[_0x3af817(0x121)])();try{const {rows:_0x59ba15}=await Ticket_1[_0x3af817(0x115)]['findAndCountAll']({'where':{'status':{[sequelize_1['Op']['in']]:[_0x3af817(0x127)]},'companyId':_0x52ad69},'order':[[_0x3af817(0x118),_0x3af817(0x126)]]});for(const _0x2cb474 of _0x59ba15){const _0x55a16d=await(0x0,ShowTicketService_1[_0x3af817(0x115)])(_0x2cb474['id'],_0x52ad69),_0x41bdb7=await Whatsapp_1[_0x3af817(0x115)][_0x3af817(0x136)](_0x55a16d?.[_0x3af817(0x10f)]);if(!_0x41bdb7)continue;const _0x10da65=await TicketTraking_1[_0x3af817(0x115)][_0x3af817(0x10c)]({'where':{'ticketId':_0x2cb474['id'],'finishedAt':null}});let {expiresInactiveMessage:_0x74581b,expiresTicket:_0x2642a9}=_0x41bdb7;if(_0x2642a9&&_0x2642a9!==''&&_0x2642a9!=='0'&&Number(_0x2642a9)>0x0){const _0x578591=(0x0,Mustache_1[_0x3af817(0x115)])('â€Ž\x20'+_0x74581b,_0x55a16d),_0xa03385=new Date();_0xa03385[_0x3af817(0x11e)](_0xa03385[_0x3af817(0x130)]()-Number(_0x2642a9));if(_0x55a16d[_0x3af817(0x11a)]===_0x3af817(0x127)&&!_0x55a16d[_0x3af817(0x11d)]){const _0x254277=new Date(_0x55a16d[_0x3af817(0x118)]);if(_0x254277<_0xa03385&&_0x55a16d['fromMe']){await _0x433f83(_0x55a16d,_0x55a16d['status'],_0x578591);if(_0x74581b!==''&&_0x74581b!==undefined){await(0x0,SendPresenceStatus_1[_0x3af817(0x131)])((0x0,wbot_1['getWbot'])(_0x2cb474[_0x3af817(0x10f)]),_0x2cb474[_0x3af817(0x122)][_0x3af817(0x129)]+'@'+(_0x2cb474[_0x3af817(0x11d)]?'g.us':'s.whatsapp.net'));const _0x25f1c7=await(0x0,SendWhatsAppMessage_1[_0x3af817(0x115)])({'body':_0x578591,'ticket':_0x55a16d});await(0x0,wbotMessageListener_1[_0x3af817(0x11f)])(_0x25f1c7,_0x55a16d,_0x55a16d[_0x3af817(0x122)]);}await _0x10da65[_0x3af817(0x109)]({'finishedAt':(0x0,moment_1[_0x3af817(0x115)])()[_0x3af817(0x134)](),'closedAt':(0x0,moment_1['default'])()[_0x3af817(0x134)](),'whatsappId':_0x2cb474[_0x3af817(0x10f)],'userId':_0x2cb474[_0x3af817(0x12f)]}),_0xed99fc['to'](_0x3af817(0x112)+_0x2cb474[_0x3af817(0x110)]+_0x3af817(0x135))[_0x3af817(0x132)]('company-'+_0x52ad69+_0x3af817(0x12c),{'action':_0x3af817(0x119),'ticketId':_0x55a16d['id']});}}}}}catch(_0x13f135){console[_0x3af817(0x13b)]('e',_0x13f135);}};exports['ClosedAllOpenTickets']=ClosedAllOpenTickets;