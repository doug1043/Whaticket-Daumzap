const a556_0x5f018f=a556_0x4c49;function a556_0x4c49(_0x1d1414,_0x58b9c1){const _0x2a7f93=a556_0x3856();return a556_0x4c49=function(_0x1bb4f0,_0x208d4b){_0x1bb4f0=_0x1bb4f0-0x87;let _0x3856f4=_0x2a7f93[_0x1bb4f0];return _0x3856f4;},a556_0x4c49(_0x1d1414,_0x58b9c1);}(function(_0x58cfe5,_0x391aa4){const _0x539d1b=a556_0x4c49,_0x4ba8bc=_0x58cfe5();while(!![]){try{const _0x454e90=-parseInt(_0x539d1b(0x90))/0x1+parseInt(_0x539d1b(0x9e))/0x2+parseInt(_0x539d1b(0xae))/0x3+-parseInt(_0x539d1b(0x9c))/0x4*(parseInt(_0x539d1b(0xb5))/0x5)+-parseInt(_0x539d1b(0x88))/0x6+-parseInt(_0x539d1b(0x95))/0x7+parseInt(_0x539d1b(0x87))/0x8;if(_0x454e90===_0x391aa4)break;else _0x4ba8bc['push'](_0x4ba8bc['shift']());}catch(_0x402d8c){_0x4ba8bc['push'](_0x4ba8bc['shift']());}}}(a556_0x3856,0xbd6ff));const a556_0x208d4b=(function(){let _0xd80950=!![];return function(_0x4cf172,_0x4cf393){const _0x523b47=_0xd80950?function(){const _0x36959a=a556_0x4c49;if(_0x4cf393){const _0x34561d=_0x4cf393[_0x36959a(0xa3)](_0x4cf172,arguments);return _0x4cf393=null,_0x34561d;}}:function(){};return _0xd80950=![],_0x523b47;};}()),a556_0x1bb4f0=a556_0x208d4b(this,function(){const _0x4337eb=a556_0x4c49;return a556_0x1bb4f0[_0x4337eb(0xad)]()[_0x4337eb(0xb8)]('(((.+)+)+)+$')[_0x4337eb(0xad)]()['constructor'](a556_0x1bb4f0)[_0x4337eb(0xb8)](_0x4337eb(0x9b));});a556_0x1bb4f0();'use strict';function a556_0x3856(){const _0xc74b1e=['getMinutes','status','__esModule','open','ClosedAllOpenTickets','995DKfJdf','contact','closed','search','../../libs/socket','23228304CjlJFD','5546646CwhRRw','moment','-ticket','../../models/Whatsapp','__importDefault','-open','s.whatsapp.net','./wbotMessageListener','863115SKDXCB','delete','findAndCountAll','isGroup','./SendWhatsAppMessage','5961760jTdgcA','body\x20is\x20not\x20a\x20string','nps','defineProperty','trace','findByPk','(((.+)+)+)+$','6108mOvgdg','number','285502FQsNsp','../../helpers/Mustache','sequelize','../../models/TicketTraking','findOne','apply','companyId','string','../TicketServices/ShowTicketService','toDate','company-','whatsappId','updatedAt','default','update','toString','2018265HCOCyA','fromMe'];a556_0x3856=function(){return _0xc74b1e;};return a556_0x3856();}var __importDefault=this&&this[a556_0x5f018f(0x8c)]||function(_0x333dcc){const _0x325bc6=a556_0x5f018f;return _0x333dcc&&_0x333dcc[_0x325bc6(0xb2)]?_0x333dcc:{'default':_0x333dcc};};Object[a556_0x5f018f(0x98)](exports,a556_0x5f018f(0xb2),{'value':!![]}),exports[a556_0x5f018f(0xb4)]=void 0x0;const sequelize_1=require(a556_0x5f018f(0xa0)),Ticket_1=__importDefault(require('../../models/Ticket')),Whatsapp_1=__importDefault(require(a556_0x5f018f(0x8b))),socket_1=require(a556_0x5f018f(0xb9)),Mustache_1=__importDefault(require(a556_0x5f018f(0x9f))),SendWhatsAppMessage_1=__importDefault(require(a556_0x5f018f(0x94))),moment_1=__importDefault(require(a556_0x5f018f(0x89))),ShowTicketService_1=__importDefault(require(a556_0x5f018f(0xa6))),wbotMessageListener_1=require(a556_0x5f018f(0x8f)),TicketTraking_1=__importDefault(require(a556_0x5f018f(0xa1))),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus'),wbot_1=require('../../libs/wbot'),ClosedAllOpenTickets=async _0x42c060=>{const _0x498707=a556_0x5f018f,_0x2850e8=async(_0x3d5230,_0x1e49e0,_0x46b564)=>{const _0x3dc097=a556_0x4c49;if(_0x1e49e0===_0x3dc097(0x97))typeof _0x46b564!=_0x3dc097(0xa5)&&console['trace'](_0x3dc097(0x96),_0x46b564),await _0x3d5230[_0x3dc097(0xac)]({'status':_0x3dc097(0xb7),'lastMessage':_0x46b564,'unreadMessages':0x0,'amountUseBotQueues':0x0});else _0x1e49e0===_0x3dc097(0xb3)?(typeof _0x46b564!=_0x3dc097(0xa5)&&console[_0x3dc097(0x99)](_0x3dc097(0x96),_0x46b564),await _0x3d5230[_0x3dc097(0xac)]({'status':_0x3dc097(0xb7),'lastMessage':_0x46b564,'unreadMessages':0x0,'amountUseBotQueues':0x0})):await _0x3d5230[_0x3dc097(0xac)]({'status':_0x3dc097(0xb7),'unreadMessages':0x0});},_0x142791=(0x0,socket_1['getIO'])();try{const {rows:_0x297541}=await Ticket_1[_0x498707(0xab)][_0x498707(0x92)]({'where':{'status':{[sequelize_1['Op']['in']]:[_0x498707(0xb3)]},'companyId':_0x42c060},'order':[[_0x498707(0xaa),'DESC']]});for(const _0x2ba35e of _0x297541){const _0x48cced=await(0x0,ShowTicketService_1['default'])(_0x2ba35e['id'],_0x42c060),_0x18cc87=await Whatsapp_1[_0x498707(0xab)][_0x498707(0x9a)](_0x48cced?.['whatsappId']);if(!_0x18cc87)continue;const _0x2ad0db=await TicketTraking_1['default'][_0x498707(0xa2)]({'where':{'ticketId':_0x2ba35e['id'],'finishedAt':null}});let {expiresInactiveMessage:_0x19a642,expiresTicket:_0x4a6506}=_0x18cc87;if(_0x4a6506&&_0x4a6506!==''&&_0x4a6506!=='0'&&Number(_0x4a6506)>0x0){const _0x1e0a73=(0x0,Mustache_1[_0x498707(0xab)])('â€Ž\x20'+_0x19a642,_0x48cced),_0x13be33=new Date();_0x13be33['setMinutes'](_0x13be33[_0x498707(0xb0)]()-Number(_0x4a6506));if(_0x48cced['status']===_0x498707(0xb3)&&!_0x48cced[_0x498707(0x93)]){const _0x1bd0f4=new Date(_0x48cced[_0x498707(0xaa)]);if(_0x1bd0f4<_0x13be33&&_0x48cced[_0x498707(0xaf)]){await _0x2850e8(_0x48cced,_0x48cced[_0x498707(0xb1)],_0x1e0a73);if(_0x19a642!==''&&_0x19a642!==undefined){await(0x0,SendPresenceStatus_1['SendPresenceStatus'])((0x0,wbot_1['getWbot'])(_0x2ba35e[_0x498707(0xa9)]),_0x2ba35e['contact'][_0x498707(0x9d)]+'@'+(_0x2ba35e['isGroup']?'g.us':_0x498707(0x8e)));const _0x4ae42f=await(0x0,SendWhatsAppMessage_1[_0x498707(0xab)])({'body':_0x1e0a73,'ticket':_0x48cced});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x4ae42f,_0x48cced,_0x48cced[_0x498707(0xb6)]);}await _0x2ad0db[_0x498707(0xac)]({'finishedAt':(0x0,moment_1[_0x498707(0xab)])()[_0x498707(0xa7)](),'closedAt':(0x0,moment_1[_0x498707(0xab)])()[_0x498707(0xa7)](),'whatsappId':_0x2ba35e['whatsappId'],'userId':_0x2ba35e['userId']}),_0x142791['to'](_0x498707(0xa8)+_0x2ba35e[_0x498707(0xa4)]+_0x498707(0x8d))['emit']('company-'+_0x42c060+_0x498707(0x8a),{'action':_0x498707(0x91),'ticketId':_0x48cced['id']});}}}}}catch(_0x3b4f31){console['log']('e',_0x3b4f31);}};exports[a556_0x5f018f(0xb4)]=ClosedAllOpenTickets;