const a557_0xba35d=a557_0x2898;(function(_0x602e61,_0x161b24){const _0xdb78f2=a557_0x2898,_0x194442=_0x602e61();while(!![]){try{const _0x24bc48=parseInt(_0xdb78f2(0x18b))/0x1+-parseInt(_0xdb78f2(0x163))/0x2*(-parseInt(_0xdb78f2(0x168))/0x3)+-parseInt(_0xdb78f2(0x15e))/0x4*(-parseInt(_0xdb78f2(0x17e))/0x5)+-parseInt(_0xdb78f2(0x173))/0x6*(-parseInt(_0xdb78f2(0x166))/0x7)+-parseInt(_0xdb78f2(0x16a))/0x8*(-parseInt(_0xdb78f2(0x17a))/0x9)+-parseInt(_0xdb78f2(0x177))/0xa*(-parseInt(_0xdb78f2(0x162))/0xb)+-parseInt(_0xdb78f2(0x16b))/0xc;if(_0x24bc48===_0x161b24)break;else _0x194442['push'](_0x194442['shift']());}catch(_0x5385f0){_0x194442['push'](_0x194442['shift']());}}}(a557_0x3a65,0x6ea57));const a557_0x31bd5a=(function(){let _0x58a5f6=!![];return function(_0x14f400,_0x52caea){const _0x590a31=_0x58a5f6?function(){const _0x46d5ba=a557_0x2898;if(_0x52caea){const _0x4c6d3e=_0x52caea[_0x46d5ba(0x16e)](_0x14f400,arguments);return _0x52caea=null,_0x4c6d3e;}}:function(){};return _0x58a5f6=![],_0x590a31;};}()),a557_0x2aa8e8=a557_0x31bd5a(this,function(){const _0xc3bd33=a557_0x2898;return a557_0x2aa8e8[_0xc3bd33(0x183)]()[_0xc3bd33(0x174)]('(((.+)+)+)+$')['toString']()['constructor'](a557_0x2aa8e8)[_0xc3bd33(0x174)](_0xc3bd33(0x18a));});a557_0x2aa8e8();'use strict';var __importDefault=this&&this[a557_0xba35d(0x17b)]||function(_0x803b25){return _0x803b25&&_0x803b25['__esModule']?_0x803b25:{'default':_0x803b25};};Object[a557_0xba35d(0x176)](exports,a557_0xba35d(0x16c),{'value':!![]}),exports[a557_0xba35d(0x167)]=void 0x0;const sequelize_1=require(a557_0xba35d(0x171)),Ticket_1=__importDefault(require(a557_0xba35d(0x16d))),Whatsapp_1=__importDefault(require(a557_0xba35d(0x164))),socket_1=require(a557_0xba35d(0x188)),Mustache_1=__importDefault(require(a557_0xba35d(0x193))),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),moment_1=__importDefault(require(a557_0xba35d(0x17f))),ShowTicketService_1=__importDefault(require(a557_0xba35d(0x15c))),wbotMessageListener_1=require(a557_0xba35d(0x194)),TicketTraking_1=__importDefault(require(a557_0xba35d(0x169))),SendPresenceStatus_1=require(a557_0xba35d(0x18f)),wbot_1=require(a557_0xba35d(0x165)),ClosedAllOpenTickets=async _0x3047be=>{const _0x555196=a557_0xba35d,_0x3d347e=async(_0x2b4121,_0x2ee73d,_0x413bf1)=>{const _0xc12bdc=a557_0x2898;if(_0x2ee73d===_0xc12bdc(0x15f))typeof _0x413bf1!=_0xc12bdc(0x185)&&console[_0xc12bdc(0x190)]('body\x20is\x20not\x20a\x20string',_0x413bf1),await _0x2b4121['update']({'status':'closed','lastMessage':_0x413bf1,'unreadMessages':0x0,'amountUseBotQueues':0x0});else _0x2ee73d===_0xc12bdc(0x159)?(typeof _0x413bf1!=_0xc12bdc(0x185)&&console[_0xc12bdc(0x190)]('body\x20is\x20not\x20a\x20string',_0x413bf1),await _0x2b4121[_0xc12bdc(0x16f)]({'status':_0xc12bdc(0x187),'lastMessage':_0x413bf1,'unreadMessages':0x0,'amountUseBotQueues':0x0})):await _0x2b4121[_0xc12bdc(0x16f)]({'status':'closed','unreadMessages':0x0});},_0x481579=(0x0,socket_1[_0x555196(0x160)])();try{const {rows:_0x397298}=await Ticket_1[_0x555196(0x184)][_0x555196(0x17d)]({'where':{'status':{[sequelize_1['Op']['in']]:['open']},'companyId':_0x3047be},'order':[[_0x555196(0x180),_0x555196(0x196)]]});for(const _0x1d8bfd of _0x397298){const _0x54b393=await(0x0,ShowTicketService_1[_0x555196(0x184)])(_0x1d8bfd['id'],_0x3047be),_0x4347b2=await Whatsapp_1['default'][_0x555196(0x191)](_0x54b393?.['whatsappId']);if(!_0x4347b2)continue;const _0x41c306=await TicketTraking_1[_0x555196(0x184)]['findOne']({'where':{'ticketId':_0x1d8bfd['id'],'finishedAt':null}});let {expiresInactiveMessage:_0x4cc242,expiresTicket:_0xeb9c1a}=_0x4347b2;if(_0xeb9c1a&&_0xeb9c1a!==''&&_0xeb9c1a!=='0'&&Number(_0xeb9c1a)>0x0){const _0x423c28=(0x0,Mustache_1[_0x555196(0x184)])('â€Ž\x20'+_0x4cc242,_0x54b393),_0x54645f=new Date();_0x54645f['setMinutes'](_0x54645f[_0x555196(0x15d)]()-Number(_0xeb9c1a));if(_0x54b393[_0x555196(0x18d)]===_0x555196(0x159)&&!_0x54b393[_0x555196(0x17c)]){const _0x417a26=new Date(_0x54b393[_0x555196(0x180)]);if(_0x417a26<_0x54645f&&_0x54b393[_0x555196(0x161)]){await _0x3d347e(_0x54b393,_0x54b393[_0x555196(0x18d)],_0x423c28);if(_0x4cc242!==''&&_0x4cc242!==undefined){await(0x0,SendPresenceStatus_1[_0x555196(0x182)])((0x0,wbot_1['getWbot'])(_0x1d8bfd[_0x555196(0x170)]),_0x1d8bfd[_0x555196(0x179)][_0x555196(0x15a)]+'@'+(_0x1d8bfd[_0x555196(0x17c)]?_0x555196(0x172):'s.whatsapp.net'));const _0x55c192=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x423c28,'ticket':_0x54b393});await(0x0,wbotMessageListener_1[_0x555196(0x18c)])(_0x55c192,_0x54b393,_0x54b393[_0x555196(0x179)]);}await _0x41c306[_0x555196(0x16f)]({'finishedAt':(0x0,moment_1['default'])()['toDate'](),'closedAt':(0x0,moment_1[_0x555196(0x184)])()[_0x555196(0x18e)](),'whatsappId':_0x1d8bfd[_0x555196(0x170)],'userId':_0x1d8bfd[_0x555196(0x175)]}),_0x481579['to'](_0x555196(0x15b)+_0x1d8bfd[_0x555196(0x189)]+_0x555196(0x192))[_0x555196(0x186)](_0x555196(0x15b)+_0x3047be+_0x555196(0x195),{'action':_0x555196(0x178),'ticketId':_0x54b393['id']});}}}}}catch(_0x4ed5e3){console[_0x555196(0x181)]('e',_0x4ed5e3);}};function a557_0x3a65(){const _0x39bbf3=['status','toDate','../../helpers/SendPresenceStatus','trace','findByPk','-open','../../helpers/Mustache','./wbotMessageListener','-ticket','DESC','open','number','company-','../TicketServices/ShowTicketService','getMinutes','4BQatyw','nps','getIO','fromMe','1332551iFXBpd','507788NovWoA','../../models/Whatsapp','../../libs/wbot','1959769pTVCGn','ClosedAllOpenTickets','3VsPmuB','../../models/TicketTraking','557912SCyIjn','35074956lXIEFU','__esModule','../../models/Ticket','apply','update','whatsappId','sequelize','g.us','12fQZuDt','search','userId','defineProperty','20MRmitu','delete','contact','99ZcmxqN','__importDefault','isGroup','findAndCountAll','3781135gDRQeN','moment','updatedAt','log','SendPresenceStatus','toString','default','string','emit','closed','../../libs/socket','companyId','(((.+)+)+)+$','796654yFnVqZ','verifyMessage'];a557_0x3a65=function(){return _0x39bbf3;};return a557_0x3a65();}function a557_0x2898(_0x530caf,_0x46da98){const _0x2c1457=a557_0x3a65();return a557_0x2898=function(_0x2aa8e8,_0x31bd5a){_0x2aa8e8=_0x2aa8e8-0x159;let _0x3a65c7=_0x2c1457[_0x2aa8e8];return _0x3a65c7;},a557_0x2898(_0x530caf,_0x46da98);}exports['ClosedAllOpenTickets']=ClosedAllOpenTickets;