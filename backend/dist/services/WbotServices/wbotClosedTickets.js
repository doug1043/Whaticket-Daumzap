const a548_0x353553=a548_0x3306;(function(_0x3902a9,_0x37d495){const _0x549cb7=a548_0x3306,_0x57b993=_0x3902a9();while(!![]){try{const _0x483bb4=-parseInt(_0x549cb7(0x141))/0x1+-parseInt(_0x549cb7(0x160))/0x2+-parseInt(_0x549cb7(0x153))/0x3*(parseInt(_0x549cb7(0x14a))/0x4)+-parseInt(_0x549cb7(0x170))/0x5+parseInt(_0x549cb7(0x14d))/0x6*(-parseInt(_0x549cb7(0x151))/0x7)+-parseInt(_0x549cb7(0x16c))/0x8*(-parseInt(_0x549cb7(0x14f))/0x9)+parseInt(_0x549cb7(0x13f))/0xa;if(_0x483bb4===_0x37d495)break;else _0x57b993['push'](_0x57b993['shift']());}catch(_0x2f9a2e){_0x57b993['push'](_0x57b993['shift']());}}}(a548_0x5444,0xe7684));const a548_0x56a7bd=(function(){let _0x3c6268=!![];return function(_0x3be3ef,_0x4e6d08){const _0x41b505=_0x3c6268?function(){const _0x223d0a=a548_0x3306;if(_0x4e6d08){const _0x12ef0a=_0x4e6d08[_0x223d0a(0x142)](_0x3be3ef,arguments);return _0x4e6d08=null,_0x12ef0a;}}:function(){};return _0x3c6268=![],_0x41b505;};}()),a548_0x31ba91=a548_0x56a7bd(this,function(){const _0x313026=a548_0x3306;return a548_0x31ba91[_0x313026(0x165)]()[_0x313026(0x145)](_0x313026(0x149))[_0x313026(0x165)]()[_0x313026(0x161)](a548_0x31ba91)[_0x313026(0x145)](_0x313026(0x149));});a548_0x31ba91();'use strict';var __importDefault=this&&this[a548_0x353553(0x16b)]||function(_0x11950c){return _0x11950c&&_0x11950c['__esModule']?_0x11950c:{'default':_0x11950c};};function a548_0x3306(_0x50ebc9,_0x2c47ac){const _0x1b7737=a548_0x5444();return a548_0x3306=function(_0x31ba91,_0x56a7bd){_0x31ba91=_0x31ba91-0x13f;let _0x544478=_0x1b7737[_0x31ba91];return _0x544478;},a548_0x3306(_0x50ebc9,_0x2c47ac);}Object[a548_0x353553(0x14c)](exports,'__esModule',{'value':!![]}),exports[a548_0x353553(0x15c)]=void 0x0;const sequelize_1=require(a548_0x353553(0x164)),Ticket_1=__importDefault(require(a548_0x353553(0x157))),Whatsapp_1=__importDefault(require(a548_0x353553(0x14e))),socket_1=require(a548_0x353553(0x168)),Mustache_1=__importDefault(require(a548_0x353553(0x16f))),SendWhatsAppMessage_1=__importDefault(require(a548_0x353553(0x175))),moment_1=__importDefault(require(a548_0x353553(0x16a))),ShowTicketService_1=__importDefault(require(a548_0x353553(0x169))),wbotMessageListener_1=require('./wbotMessageListener'),TicketTraking_1=__importDefault(require('../../models/TicketTraking')),SendPresenceStatus_1=require(a548_0x353553(0x173)),wbot_1=require(a548_0x353553(0x158)),ClosedAllOpenTickets=async _0x3e451e=>{const _0x3def9a=a548_0x353553,_0x5388ca=async(_0x5812a7,_0x4a6e3e,_0xa6b1e1)=>{const _0x54773e=a548_0x3306;if(_0x4a6e3e===_0x54773e(0x15a))typeof _0xa6b1e1!='string'&&console['trace'](_0x54773e(0x172),_0xa6b1e1),await _0x5812a7[_0x54773e(0x147)]({'status':_0x54773e(0x167),'lastMessage':_0xa6b1e1,'unreadMessages':0x0,'amountUseBotQueues':0x0});else _0x4a6e3e===_0x54773e(0x15f)?(typeof _0xa6b1e1!=_0x54773e(0x16d)&&console['trace'](_0x54773e(0x172),_0xa6b1e1),await _0x5812a7[_0x54773e(0x147)]({'status':_0x54773e(0x167),'lastMessage':_0xa6b1e1,'unreadMessages':0x0,'amountUseBotQueues':0x0})):await _0x5812a7[_0x54773e(0x147)]({'status':_0x54773e(0x167),'unreadMessages':0x0});},_0x2d3d5f=(0x0,socket_1[_0x3def9a(0x163)])();try{const {rows:_0x5538bc}=await Ticket_1[_0x3def9a(0x15e)][_0x3def9a(0x155)]({'where':{'status':{[sequelize_1['Op']['in']]:[_0x3def9a(0x15f)]},'companyId':_0x3e451e},'order':[[_0x3def9a(0x144),_0x3def9a(0x176)]]});for(const _0x1a6e80 of _0x5538bc){const _0x46606b=await(0x0,ShowTicketService_1[_0x3def9a(0x15e)])(_0x1a6e80['id'],_0x3e451e),_0x52f0a9=await Whatsapp_1[_0x3def9a(0x15e)][_0x3def9a(0x15b)](_0x46606b?.['whatsappId']);if(!_0x52f0a9)continue;const _0x4a9cd8=await TicketTraking_1[_0x3def9a(0x15e)][_0x3def9a(0x150)]({'where':{'ticketId':_0x1a6e80['id'],'finishedAt':null}});let {expiresInactiveMessage:_0x5d0747,expiresTicket:_0x34f02d}=_0x52f0a9;if(_0x34f02d&&_0x34f02d!==''&&_0x34f02d!=='0'&&Number(_0x34f02d)>0x0){const _0x3fa83f=(0x0,Mustache_1['default'])('‎\x20'+_0x5d0747,_0x46606b),_0x4eec59=new Date();_0x4eec59['setMinutes'](_0x4eec59['getMinutes']()-Number(_0x34f02d));if(_0x46606b[_0x3def9a(0x166)]===_0x3def9a(0x15f)&&!_0x46606b['isGroup']){const _0x3bad59=new Date(_0x46606b[_0x3def9a(0x144)]);if(_0x3bad59<_0x4eec59&&_0x46606b[_0x3def9a(0x152)]){await _0x5388ca(_0x46606b,_0x46606b[_0x3def9a(0x166)],_0x3fa83f);if(_0x5d0747!==''&&_0x5d0747!==undefined){await(0x0,SendPresenceStatus_1[_0x3def9a(0x148)])((0x0,wbot_1[_0x3def9a(0x146)])(_0x1a6e80[_0x3def9a(0x140)]),_0x1a6e80[_0x3def9a(0x143)]['number']+'@'+(_0x1a6e80['isGroup']?'g.us':_0x3def9a(0x171)));const _0x52fdc8=await(0x0,SendWhatsAppMessage_1[_0x3def9a(0x15e)])({'body':_0x3fa83f,'ticket':_0x46606b});await(0x0,wbotMessageListener_1[_0x3def9a(0x154)])(_0x52fdc8,_0x46606b,_0x46606b[_0x3def9a(0x143)]);}await _0x4a9cd8[_0x3def9a(0x147)]({'finishedAt':(0x0,moment_1[_0x3def9a(0x15e)])()['toDate'](),'closedAt':(0x0,moment_1[_0x3def9a(0x15e)])()[_0x3def9a(0x156)](),'whatsappId':_0x1a6e80['whatsappId'],'userId':_0x1a6e80[_0x3def9a(0x174)]}),_0x2d3d5f['to'](_0x3def9a(0x16e)+_0x1a6e80[_0x3def9a(0x15d)]+_0x3def9a(0x162))['emit']('company-'+_0x3e451e+_0x3def9a(0x159),{'action':'delete','ticketId':_0x46606b['id']});}}}}}catch(_0x31b8b1){console[_0x3def9a(0x14b)]('e',_0x31b8b1);}};exports[a548_0x353553(0x15c)]=ClosedAllOpenTickets;function a548_0x5444(){const _0x110199=['(((.+)+)+)+$','4372kFXkXI','log','defineProperty','130914CPyFzc','../../models/Whatsapp','960723lywqFX','findOne','427FhyrVC','fromMe','3516gTbiuF','verifyMessage','findAndCountAll','toDate','../../models/Ticket','../../libs/wbot','-ticket','nps','findByPk','ClosedAllOpenTickets','companyId','default','open','1940306aAcOWh','constructor','-open','getIO','sequelize','toString','status','closed','../../libs/socket','../TicketServices/ShowTicketService','moment','__importDefault','88wSvQWr','string','company-','../../helpers/Mustache','7352370XwMANp','s.whatsapp.net','body\x20is\x20not\x20a\x20string','../../helpers/SendPresenceStatus','userId','./SendWhatsAppMessage','DESC','63194150PjrjOI','whatsappId','1493206RxitYY','apply','contact','updatedAt','search','getWbot','update','SendPresenceStatus'];a548_0x5444=function(){return _0x110199;};return a548_0x5444();}