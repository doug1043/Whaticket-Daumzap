'use strict';const a691_0x3a7c61=a691_0x10b2;(function(_0x5d04d0,_0x575d90){const _0x1d41a2=a691_0x10b2,_0x43c292=_0x5d04d0();while(!![]){try{const _0x5ed4bb=parseInt(_0x1d41a2(0x1fe))/0x1*(-parseInt(_0x1d41a2(0x210))/0x2)+-parseInt(_0x1d41a2(0x20d))/0x3*(-parseInt(_0x1d41a2(0x216))/0x4)+parseInt(_0x1d41a2(0x1f5))/0x5+-parseInt(_0x1d41a2(0x22e))/0x6+parseInt(_0x1d41a2(0x201))/0x7*(-parseInt(_0x1d41a2(0x1f6))/0x8)+parseInt(_0x1d41a2(0x232))/0x9+-parseInt(_0x1d41a2(0x1f7))/0xa;if(_0x5ed4bb===_0x575d90)break;else _0x43c292['push'](_0x43c292['shift']());}catch(_0x3d969f){_0x43c292['push'](_0x43c292['shift']());}}}(a691_0x3d81,0xcbdab));function a691_0x10b2(_0xb57fbc,_0x5cbed4){const _0x29742a=a691_0x3d81();return a691_0x10b2=function(_0xb38b4d,_0x484ce3){_0xb38b4d=_0xb38b4d-0x1f3;let _0x3d811c=_0x29742a[_0xb38b4d];return _0x3d811c;},a691_0x10b2(_0xb57fbc,_0x5cbed4);}function a691_0x3d81(){const _0x4d8260=['paused','child_process','create','s.whatsapp.net','update','captureException','toString','log','1077441rNdGXq','writable','ERR_SENDING_WAPP_MSG','2nPQTtv','split','lookup','video','includes','defineProperty','4UPCtql','number','sendMessage','call','resolve','get','hasOwnProperty','(((.+)+)+)+$','https://','sendPresenceUpdate','.mp3','isGroup','public','bin','http://','mime-types','../../errors/AppError','startsWith','audio','__importDefault','contactId','default','__importStar','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','4157256XsAVgM','path','data','existsSync','13623885SMrjAa','typeSimulation','prototype','record','readFileSync','length','g.us','temp_flow_','exec','../../models/Contact','../../helpers/GetTicketWbot','now','application/octet-stream','join','\x20-i\x20','getTime','search','@ffmpeg-installer/ffmpeg','5304915tvrTFg','104VyzOZb','2229040lxEAJc','getOwnPropertyNames','text','headers','axios','GET','arraybuffer','488239xyUqtV','audio/mp4','findOne','374171ZXwKPU','constructor','__esModule','content-type'];a691_0x3d81=function(){return _0x4d8260;};return a691_0x3d81();}var __createBinding=this&&this['__createBinding']||(Object[a691_0x3a7c61(0x207)]?function(_0x502789,_0x16e0a4,_0x3b34f8,_0x4c78bc){const _0x3ac5be=a691_0x3a7c61;if(_0x4c78bc===undefined)_0x4c78bc=_0x3b34f8;var _0x30cc67=Object['getOwnPropertyDescriptor'](_0x16e0a4,_0x3b34f8);(!_0x30cc67||(_0x3ac5be(0x21b)in _0x30cc67?!_0x16e0a4[_0x3ac5be(0x203)]:_0x30cc67[_0x3ac5be(0x20e)]||_0x30cc67['configurable']))&&(_0x30cc67={'enumerable':!![],'get':function(){return _0x16e0a4[_0x3b34f8];}}),Object[_0x3ac5be(0x215)](_0x502789,_0x4c78bc,_0x30cc67);}:function(_0x268841,_0x27372c,_0x568ab5,_0x14d363){if(_0x14d363===undefined)_0x14d363=_0x568ab5;_0x268841[_0x14d363]=_0x27372c[_0x568ab5];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a691_0x3a7c61(0x207)]?function(_0x24c461,_0x30fc66){const _0x4e4dd9=a691_0x3a7c61;Object[_0x4e4dd9(0x215)](_0x24c461,_0x4e4dd9(0x22b),{'enumerable':!![],'value':_0x30fc66});}:function(_0x52a994,_0x5aed01){const _0x7571f5=a691_0x3a7c61;_0x52a994[_0x7571f5(0x22b)]=_0x5aed01;}),__importStar=this&&this[a691_0x3a7c61(0x22c)]||(function(){const _0x2f7b66=(function(){let _0xf9601e=!![];return function(_0x2d7779,_0x887ee2){const _0x4721f3=_0xf9601e?function(){if(_0x887ee2){const _0x290ded=_0x887ee2['apply'](_0x2d7779,arguments);return _0x887ee2=null,_0x290ded;}}:function(){};return _0xf9601e=![],_0x4721f3;};}()),_0x5629b8=_0x2f7b66(this,function(){const _0x303a44=a691_0x10b2;return _0x5629b8['toString']()['search'](_0x303a44(0x21d))[_0x303a44(0x20b)]()[_0x303a44(0x202)](_0x5629b8)[_0x303a44(0x1f3)](_0x303a44(0x21d));});_0x5629b8();var _0x61a318=function(_0x5b25b2){const _0x449ddc=a691_0x10b2;return _0x61a318=Object[_0x449ddc(0x1f8)]||function(_0x29cb25){const _0xdf0f12=_0x449ddc;var _0x21722d=[];for(var _0x27ccfc in _0x29cb25)if(Object[_0xdf0f12(0x234)][_0xdf0f12(0x21c)][_0xdf0f12(0x219)](_0x29cb25,_0x27ccfc))_0x21722d[_0x21722d['length']]=_0x27ccfc;return _0x21722d;},_0x61a318(_0x5b25b2);};return function(_0x1ac971){const _0x127c99=a691_0x10b2;if(_0x1ac971&&_0x1ac971[_0x127c99(0x203)])return _0x1ac971;var _0x1314d1={};if(_0x1ac971!=null){for(var _0x550a8d=_0x61a318(_0x1ac971),_0x2e115d=0x0;_0x2e115d<_0x550a8d[_0x127c99(0x237)];_0x2e115d++)if(_0x550a8d[_0x2e115d]!==_0x127c99(0x22b))__createBinding(_0x1314d1,_0x1ac971,_0x550a8d[_0x2e115d]);}return __setModuleDefault(_0x1314d1,_0x1ac971),_0x1314d1;};}()),__importDefault=this&&this[a691_0x3a7c61(0x229)]||function(_0x4e0b8f){const _0xe95d84=a691_0x3a7c61;return _0x4e0b8f&&_0x4e0b8f[_0xe95d84(0x203)]?_0x4e0b8f:{'default':_0x4e0b8f};};Object[a691_0x3a7c61(0x215)](exports,a691_0x3a7c61(0x203),{'value':!![]}),exports[a691_0x3a7c61(0x233)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),fs_1=__importDefault(require('fs')),child_process_1=require(a691_0x3a7c61(0x206)),path_1=__importDefault(require('path')),ffmpeg_1=__importDefault(require(a691_0x3a7c61(0x1f4))),AppError_1=__importDefault(require(a691_0x3a7c61(0x226))),GetTicketWbot_1=__importDefault(require(a691_0x3a7c61(0x23c))),mime_types_1=__importDefault(require(a691_0x3a7c61(0x225))),Contact_1=__importDefault(require(a691_0x3a7c61(0x23b))),axios_1=__importDefault(require(a691_0x3a7c61(0x1fb))),isCompiled=__dirname[a691_0x3a7c61(0x214)]('dist'),publicFolder=isCompiled?path_1[a691_0x3a7c61(0x22b)][a691_0x3a7c61(0x21a)](__dirname,'..','..','..',a691_0x3a7c61(0x222)):path_1[a691_0x3a7c61(0x22b)][a691_0x3a7c61(0x21a)](__dirname,'..','..','..',a691_0x3a7c61(0x222)),processAudio=async _0x598b3a=>{const _0x429aef=a691_0x3a7c61,_0x1f599c=publicFolder+'/'+new Date()[_0x429aef(0x241)]()+_0x429aef(0x220);return new Promise((_0x51e4f9,_0x396595)=>{const _0x2bdb62=_0x429aef;(0x0,child_process_1[_0x2bdb62(0x23a)])(ffmpeg_1[_0x2bdb62(0x22b)]['path']+_0x2bdb62(0x240)+_0x598b3a+_0x2bdb62(0x22d)+_0x1f599c+'\x20-y',(_0x2d7c86,_0x445687,_0x536edb)=>{if(_0x2d7c86)_0x396595(_0x2d7c86);_0x51e4f9(_0x1f599c);});});},processAudioFile=async _0x26e380=>{const _0x1b90e9=a691_0x3a7c61,_0x432293=publicFolder+'/'+new Date()[_0x1b90e9(0x241)]()+_0x1b90e9(0x220);return new Promise((_0x19836d,_0x39e67b)=>{const _0x53f217=_0x1b90e9;(0x0,child_process_1[_0x53f217(0x23a)])(ffmpeg_1[_0x53f217(0x22b)][_0x53f217(0x22f)]+_0x53f217(0x240)+_0x26e380+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x432293,(_0x4d1671,_0x4db961,_0x205f59)=>{if(_0x4d1671)_0x39e67b(_0x4d1671);_0x19836d(_0x432293);});});},nameFileDiscovery=_0x34d8d3=>{const _0x3abe50=a691_0x3a7c61,_0xfa4761=_0x34d8d3['split']('/'),_0xcb354f=_0xfa4761[_0xfa4761[_0x3abe50(0x237)]-0x1];return _0xcb354f[_0x3abe50(0x211)]('.')[0x0];},delay=_0x8dc29c=>new Promise(_0x386ce3=>setTimeout(_0x386ce3,_0x8dc29c)),typeSimulation=async(_0x41cea2,_0x3d4f1b)=>{const _0x1a5a90=a691_0x3a7c61,_0x3fbfd0=await(0x0,GetTicketWbot_1[_0x1a5a90(0x22b)])(_0x41cea2);let _0x13f79f=await Contact_1[_0x1a5a90(0x22b)][_0x1a5a90(0x200)]({'where':{'id':_0x41cea2[_0x1a5a90(0x22a)]}});await _0x3fbfd0[_0x1a5a90(0x21f)](_0x3d4f1b,_0x13f79f[_0x1a5a90(0x217)]+'@'+(_0x41cea2['isGroup']?_0x1a5a90(0x238):'s.whatsapp.net')),await delay(0x1388),await _0x3fbfd0['sendPresenceUpdate'](_0x1a5a90(0x205),_0x13f79f[_0x1a5a90(0x217)]+'@'+(_0x41cea2[_0x1a5a90(0x221)]?'g.us':_0x1a5a90(0x208)));};exports[a691_0x3a7c61(0x233)]=typeSimulation;const SendWhatsAppMediaFlow=async({media:_0x2c6b79,ticket:_0x36186c,body:_0x249060,isFlow:isFlow=![],isRecord:isRecord=![]})=>{const _0x4e28aa=a691_0x3a7c61;try{const _0x4ec5a6=await(0x0,GetTicketWbot_1[_0x4e28aa(0x22b)])(_0x36186c);let _0x397f78=_0x2c6b79,_0x349244,_0x3dbfdd=null;if(_0x2c6b79[_0x4e28aa(0x227)](_0x4e28aa(0x224))||_0x2c6b79[_0x4e28aa(0x227)](_0x4e28aa(0x21e))){const _0xffde3f=await(0x0,axios_1[_0x4e28aa(0x22b)])({'url':_0x2c6b79,'method':_0x4e28aa(0x1fc),'responseType':_0x4e28aa(0x1fd)});_0x349244=_0xffde3f[_0x4e28aa(0x1fa)][_0x4e28aa(0x204)]||_0x4e28aa(0x23e);const _0x3826b4=mime_types_1[_0x4e28aa(0x22b)]['extension'](_0x349244)||_0x4e28aa(0x223);_0x3dbfdd=path_1[_0x4e28aa(0x22b)][_0x4e28aa(0x23f)](publicFolder,_0x4e28aa(0x239)+Date[_0x4e28aa(0x23d)]()+'.'+_0x3826b4),fs_1[_0x4e28aa(0x22b)]['writeFileSync'](_0x3dbfdd,_0xffde3f[_0x4e28aa(0x230)]),_0x397f78=_0x3dbfdd;}else _0x349244=mime_types_1[_0x4e28aa(0x22b)][_0x4e28aa(0x212)](_0x2c6b79)||_0x4e28aa(0x23e);const _0x49b0da=_0x349244['split']('/')[0x0],_0x582a64=nameFileDiscovery(_0x2c6b79);let _0x20f7af;if(_0x49b0da===_0x4e28aa(0x213))_0x20f7af={'video':fs_1[_0x4e28aa(0x22b)][_0x4e28aa(0x236)](_0x397f78),'caption':_0x249060,'fileName':_0x582a64};else{if(_0x49b0da===_0x4e28aa(0x228)){console[_0x4e28aa(0x20c)](_0x4e28aa(0x235),isRecord);if(isRecord){const _0x990b8b=await processAudio(_0x397f78);_0x20f7af={'audio':fs_1[_0x4e28aa(0x22b)]['readFileSync'](_0x990b8b),'mimetype':_0x4e28aa(0x1ff),'ptt':!![]};}else{const _0x12c87a=await processAudioFile(_0x397f78);_0x20f7af={'audio':fs_1[_0x4e28aa(0x22b)][_0x4e28aa(0x236)](_0x12c87a),'mimetype':_0x4e28aa(0x1ff),'ptt':![]};}}else{if(_0x49b0da==='document'||_0x49b0da===_0x4e28aa(0x1f9))_0x20f7af={'document':fs_1['default']['readFileSync'](_0x397f78),'caption':_0x249060,'fileName':_0x582a64,'mimetype':_0x349244};else _0x49b0da==='application'?_0x20f7af={'document':fs_1['default'][_0x4e28aa(0x236)](_0x397f78),'caption':_0x249060,'fileName':_0x582a64,'mimetype':_0x349244}:_0x20f7af={'image':fs_1[_0x4e28aa(0x22b)]['readFileSync'](_0x397f78),'caption':_0x249060};}}_0x3dbfdd&&fs_1[_0x4e28aa(0x22b)][_0x4e28aa(0x231)](_0x3dbfdd)&&setTimeout(()=>{const _0x59fe8f=_0x4e28aa;try{fs_1[_0x59fe8f(0x22b)]['unlinkSync'](_0x3dbfdd);}catch(_0x18cda7){}},0x1388);let _0x306db2=await Contact_1['default']['findOne']({'where':{'id':_0x36186c['contactId']}});const _0x4fa87b=await _0x4ec5a6[_0x4e28aa(0x218)](_0x306db2[_0x4e28aa(0x217)]+'@'+(_0x36186c['isGroup']?'g.us':_0x4e28aa(0x208)),{..._0x20f7af});return await _0x36186c[_0x4e28aa(0x209)]({'lastMessage':_0x582a64}),_0x4fa87b;}catch(_0x112a8d){Sentry[_0x4e28aa(0x20a)](_0x112a8d),console['log'](_0x112a8d);throw new AppError_1[(_0x4e28aa(0x22b))](_0x4e28aa(0x20f));}};exports[a691_0x3a7c61(0x22b)]=SendWhatsAppMediaFlow;