'use strict';const a690_0x5841f3=a690_0x11f3;function a690_0x1ca8(){const _0xd012a4=['number','findOne','application','call','\x20-y','__importStar','27diypZc','g.us','8727180yxWjjW','s.whatsapp.net','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','public','text','(((.+)+)+)+$','typeSimulation','2170172IjNuIJ','log','98dOhbds','700168UAMhvn','__setModuleDefault','headers','5oETRrY','sendPresenceUpdate','video','../../helpers/GetTicketWbot','startsWith','data','prototype','writable','readFileSync','path','search','hasOwnProperty','isGroup','toString','\x20-i\x20','bin','content-type','audio','create','__createBinding','GET','axios','__importDefault','@sentry/node','__esModule','split','now','includes','ERR_SENDING_WAPP_MSG','exec','getTime','6986BvsZQO','1115691FykByj','contactId','dist','defineProperty','child_process','length','constructor','default','@ffmpeg-installer/ffmpeg','apply','application/octet-stream','unlinkSync','resolve','audio/mp4','7966098gVeJbC','getOwnPropertyDescriptor','captureException','get','8765796vikaSp','record','sendMessage','writeFileSync','mime-types','.mp3','https://'];a690_0x1ca8=function(){return _0xd012a4;};return a690_0x1ca8();}(function(_0x856f0b,_0x3bddd7){const _0x248e3d=a690_0x11f3,_0x7c3ff9=_0x856f0b();while(!![]){try{const _0x35ff64=-parseInt(_0x248e3d(0xdf))/0x1*(-parseInt(_0x248e3d(0xbc))/0x2)+-parseInt(_0x248e3d(0xe0))/0x3+-parseInt(_0x248e3d(0xba))/0x4*(parseInt(_0x248e3d(0xc0))/0x5)+parseInt(_0x248e3d(0xf2))/0x6+-parseInt(_0x248e3d(0xee))/0x7+-parseInt(_0x248e3d(0xbd))/0x8*(-parseInt(_0x248e3d(0xb1))/0x9)+parseInt(_0x248e3d(0xb3))/0xa;if(_0x35ff64===_0x3bddd7)break;else _0x7c3ff9['push'](_0x7c3ff9['shift']());}catch(_0x511011){_0x7c3ff9['push'](_0x7c3ff9['shift']());}}}(a690_0x1ca8,0xd855b));var __createBinding=this&&this[a690_0x5841f3(0xd3)]||(Object['create']?function(_0x401791,_0x1889ad,_0xb3221b,_0x2c1971){const _0x27cc18=a690_0x5841f3;if(_0x2c1971===undefined)_0x2c1971=_0xb3221b;var _0x5891e7=Object[_0x27cc18(0xef)](_0x1889ad,_0xb3221b);(!_0x5891e7||(_0x27cc18(0xf1)in _0x5891e7?!_0x1889ad['__esModule']:_0x5891e7[_0x27cc18(0xc7)]||_0x5891e7['configurable']))&&(_0x5891e7={'enumerable':!![],'get':function(){return _0x1889ad[_0xb3221b];}}),Object[_0x27cc18(0xe3)](_0x401791,_0x2c1971,_0x5891e7);}:function(_0x53108a,_0x392c39,_0x20c6e9,_0x48c5f7){if(_0x48c5f7===undefined)_0x48c5f7=_0x20c6e9;_0x53108a[_0x48c5f7]=_0x392c39[_0x20c6e9];}),__setModuleDefault=this&&this[a690_0x5841f3(0xbe)]||(Object[a690_0x5841f3(0xd2)]?function(_0x42cbc0,_0x331eae){const _0x56ffe5=a690_0x5841f3;Object[_0x56ffe5(0xe3)](_0x42cbc0,_0x56ffe5(0xe7),{'enumerable':!![],'value':_0x331eae});}:function(_0x4c62a6,_0x3b6488){const _0x5e3fdf=a690_0x5841f3;_0x4c62a6[_0x5e3fdf(0xe7)]=_0x3b6488;}),__importStar=this&&this[a690_0x5841f3(0xb0)]||(function(){const _0x32c8cd=(function(){let _0x41a0a9=!![];return function(_0x2aac8a,_0x387b4e){const _0x320d47=_0x41a0a9?function(){const _0x1deecb=a690_0x11f3;if(_0x387b4e){const _0x17be85=_0x387b4e[_0x1deecb(0xe9)](_0x2aac8a,arguments);return _0x387b4e=null,_0x17be85;}}:function(){};return _0x41a0a9=![],_0x320d47;};}()),_0xb91fcb=_0x32c8cd(this,function(){const _0x4bf2b7=a690_0x11f3;return _0xb91fcb[_0x4bf2b7(0xcd)]()[_0x4bf2b7(0xca)]('(((.+)+)+)+$')[_0x4bf2b7(0xcd)]()[_0x4bf2b7(0xe6)](_0xb91fcb)[_0x4bf2b7(0xca)](_0x4bf2b7(0xb8));});_0xb91fcb();var _0x43ceac=function(_0x2ad012){return _0x43ceac=Object['getOwnPropertyNames']||function(_0x11361c){const _0x34180e=a690_0x11f3;var _0x9a751c=[];for(var _0x58e50d in _0x11361c)if(Object[_0x34180e(0xc6)][_0x34180e(0xcb)][_0x34180e(0xae)](_0x11361c,_0x58e50d))_0x9a751c[_0x9a751c[_0x34180e(0xe5)]]=_0x58e50d;return _0x9a751c;},_0x43ceac(_0x2ad012);};return function(_0x41e650){const _0x36c6d3=a690_0x11f3;if(_0x41e650&&_0x41e650[_0x36c6d3(0xd8)])return _0x41e650;var _0x5b1c9e={};if(_0x41e650!=null){for(var _0x5630f6=_0x43ceac(_0x41e650),_0x5aec87=0x0;_0x5aec87<_0x5630f6[_0x36c6d3(0xe5)];_0x5aec87++)if(_0x5630f6[_0x5aec87]!==_0x36c6d3(0xe7))__createBinding(_0x5b1c9e,_0x41e650,_0x5630f6[_0x5aec87]);}return __setModuleDefault(_0x5b1c9e,_0x41e650),_0x5b1c9e;};}()),__importDefault=this&&this[a690_0x5841f3(0xd6)]||function(_0xe687ff){const _0x2e1495=a690_0x5841f3;return _0xe687ff&&_0xe687ff[_0x2e1495(0xd8)]?_0xe687ff:{'default':_0xe687ff};};Object[a690_0x5841f3(0xe3)](exports,a690_0x5841f3(0xd8),{'value':!![]}),exports[a690_0x5841f3(0xb9)]=void 0x0;function a690_0x11f3(_0x49eb9d,_0x455e8f){const _0x21e0e8=a690_0x1ca8();return a690_0x11f3=function(_0x1594e2,_0x3a17fc){_0x1594e2=_0x1594e2-0xa9;let _0x1ca87e=_0x21e0e8[_0x1594e2];return _0x1ca87e;},a690_0x11f3(_0x49eb9d,_0x455e8f);}const Sentry=__importStar(require(a690_0x5841f3(0xd7))),fs_1=__importDefault(require('fs')),child_process_1=require(a690_0x5841f3(0xe4)),path_1=__importDefault(require(a690_0x5841f3(0xc9))),ffmpeg_1=__importDefault(require(a690_0x5841f3(0xe8))),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require(a690_0x5841f3(0xc3))),mime_types_1=__importDefault(require(a690_0x5841f3(0xf6))),Contact_1=__importDefault(require('../../models/Contact')),axios_1=__importDefault(require(a690_0x5841f3(0xd5))),isCompiled=__dirname[a690_0x5841f3(0xdb)](a690_0x5841f3(0xe2)),publicFolder=isCompiled?path_1[a690_0x5841f3(0xe7)][a690_0x5841f3(0xec)](__dirname,'..','..','..',a690_0x5841f3(0xb6)):path_1[a690_0x5841f3(0xe7)]['resolve'](__dirname,'..','..','..',a690_0x5841f3(0xb6)),processAudio=async _0x12f26b=>{const _0x5dc863=a690_0x5841f3,_0x21b071=publicFolder+'/'+new Date()[_0x5dc863(0xde)]()+_0x5dc863(0xa9);return new Promise((_0x3c9435,_0x730dd2)=>{const _0xeb3770=_0x5dc863;(0x0,child_process_1[_0xeb3770(0xdd)])(ffmpeg_1[_0xeb3770(0xe7)][_0xeb3770(0xc9)]+_0xeb3770(0xce)+_0x12f26b+'\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20'+_0x21b071+_0xeb3770(0xaf),(_0x2c4259,_0x351290,_0x5da829)=>{if(_0x2c4259)_0x730dd2(_0x2c4259);_0x3c9435(_0x21b071);});});},processAudioFile=async _0x59b8f4=>{const _0x45c7c2=a690_0x5841f3,_0x57c08c=publicFolder+'/'+new Date()[_0x45c7c2(0xde)]()+_0x45c7c2(0xa9);return new Promise((_0x2a6e3b,_0x26ebd)=>{const _0x1347ee=_0x45c7c2;(0x0,child_process_1['exec'])(ffmpeg_1[_0x1347ee(0xe7)][_0x1347ee(0xc9)]+'\x20-i\x20'+_0x59b8f4+_0x1347ee(0xb5)+_0x57c08c,(_0x4b1a42,_0x12041a,_0x55675b)=>{if(_0x4b1a42)_0x26ebd(_0x4b1a42);_0x2a6e3b(_0x57c08c);});});},nameFileDiscovery=_0xc2a7=>{const _0x1eefbc=a690_0x5841f3,_0x584154=_0xc2a7[_0x1eefbc(0xd9)]('/'),_0x57f020=_0x584154[_0x584154[_0x1eefbc(0xe5)]-0x1];return _0x57f020[_0x1eefbc(0xd9)]('.')[0x0];},delay=_0x9ecd59=>new Promise(_0xaaa70d=>setTimeout(_0xaaa70d,_0x9ecd59)),typeSimulation=async(_0x468b4e,_0x59d250)=>{const _0x29cb75=a690_0x5841f3,_0x583818=await(0x0,GetTicketWbot_1[_0x29cb75(0xe7)])(_0x468b4e);let _0x17aaeb=await Contact_1[_0x29cb75(0xe7)][_0x29cb75(0xac)]({'where':{'id':_0x468b4e[_0x29cb75(0xe1)]}});await _0x583818[_0x29cb75(0xc1)](_0x59d250,_0x17aaeb['number']+'@'+(_0x468b4e[_0x29cb75(0xcc)]?_0x29cb75(0xb2):_0x29cb75(0xb4))),await delay(0x1388),await _0x583818[_0x29cb75(0xc1)]('paused',_0x17aaeb[_0x29cb75(0xab)]+'@'+(_0x468b4e['isGroup']?'g.us':_0x29cb75(0xb4)));};exports['typeSimulation']=typeSimulation;const SendWhatsAppMediaFlow=async({media:_0x44a748,ticket:_0x25fb1d,body:_0x1ddf47,isFlow:isFlow=![],isRecord:isRecord=![]})=>{const _0x2ffd46=a690_0x5841f3;try{const _0x5b348f=await(0x0,GetTicketWbot_1[_0x2ffd46(0xe7)])(_0x25fb1d);let _0x406a80=_0x44a748,_0xadf438,_0xf76c6e=null;if(_0x44a748[_0x2ffd46(0xc4)]('http://')||_0x44a748[_0x2ffd46(0xc4)](_0x2ffd46(0xaa))){const _0x415e6c=await(0x0,axios_1['default'])({'url':_0x44a748,'method':_0x2ffd46(0xd4),'responseType':'arraybuffer'});_0xadf438=_0x415e6c[_0x2ffd46(0xbf)][_0x2ffd46(0xd0)]||_0x2ffd46(0xea);const _0x195eb1=mime_types_1['default']['extension'](_0xadf438)||_0x2ffd46(0xcf);_0xf76c6e=path_1[_0x2ffd46(0xe7)]['join'](publicFolder,'temp_flow_'+Date[_0x2ffd46(0xda)]()+'.'+_0x195eb1),fs_1['default'][_0x2ffd46(0xf5)](_0xf76c6e,_0x415e6c[_0x2ffd46(0xc5)]),_0x406a80=_0xf76c6e;}else _0xadf438=mime_types_1['default']['lookup'](_0x44a748)||_0x2ffd46(0xea);const _0x210b9d=_0xadf438[_0x2ffd46(0xd9)]('/')[0x0],_0x27579c=nameFileDiscovery(_0x44a748);let _0x420ea4;if(_0x210b9d===_0x2ffd46(0xc2))_0x420ea4={'video':fs_1[_0x2ffd46(0xe7)][_0x2ffd46(0xc8)](_0x406a80),'caption':_0x1ddf47,'fileName':_0x27579c};else{if(_0x210b9d===_0x2ffd46(0xd1)){console[_0x2ffd46(0xbb)](_0x2ffd46(0xf3),isRecord);if(isRecord){const _0xe0358d=await processAudio(_0x406a80);_0x420ea4={'audio':fs_1[_0x2ffd46(0xe7)][_0x2ffd46(0xc8)](_0xe0358d),'mimetype':'audio/mp4','ptt':!![]};}else{const _0x1054df=await processAudioFile(_0x406a80);_0x420ea4={'audio':fs_1['default'][_0x2ffd46(0xc8)](_0x1054df),'mimetype':_0x2ffd46(0xed),'ptt':![]};}}else{if(_0x210b9d==='document'||_0x210b9d===_0x2ffd46(0xb7))_0x420ea4={'document':fs_1[_0x2ffd46(0xe7)][_0x2ffd46(0xc8)](_0x406a80),'caption':_0x1ddf47,'fileName':_0x27579c,'mimetype':_0xadf438};else _0x210b9d===_0x2ffd46(0xad)?_0x420ea4={'document':fs_1['default']['readFileSync'](_0x406a80),'caption':_0x1ddf47,'fileName':_0x27579c,'mimetype':_0xadf438}:_0x420ea4={'image':fs_1[_0x2ffd46(0xe7)][_0x2ffd46(0xc8)](_0x406a80),'caption':_0x1ddf47};}}_0xf76c6e&&fs_1['default']['existsSync'](_0xf76c6e)&&setTimeout(()=>{const _0x5bd29e=_0x2ffd46;try{fs_1['default'][_0x5bd29e(0xeb)](_0xf76c6e);}catch(_0x52a45b){}},0x1388);let _0x369097=await Contact_1[_0x2ffd46(0xe7)][_0x2ffd46(0xac)]({'where':{'id':_0x25fb1d['contactId']}});const _0x19fc64=await _0x5b348f[_0x2ffd46(0xf4)](_0x369097[_0x2ffd46(0xab)]+'@'+(_0x25fb1d[_0x2ffd46(0xcc)]?_0x2ffd46(0xb2):'s.whatsapp.net'),{..._0x420ea4});return await _0x25fb1d['update']({'lastMessage':_0x27579c}),_0x19fc64;}catch(_0x4d6e2f){Sentry[_0x2ffd46(0xf0)](_0x4d6e2f),console[_0x2ffd46(0xbb)](_0x4d6e2f);throw new AppError_1['default'](_0x2ffd46(0xdc));}};exports['default']=SendWhatsAppMediaFlow;