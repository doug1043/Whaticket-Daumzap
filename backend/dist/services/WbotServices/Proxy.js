const a548_0x573fb0=a548_0xdec0;(function(_0x317596,_0x3caa5a){const _0x2bbba1=a548_0xdec0,_0x544ddf=_0x317596();while(!![]){try{const _0x541578=-parseInt(_0x2bbba1(0x11b))/0x1*(parseInt(_0x2bbba1(0x14a))/0x2)+-parseInt(_0x2bbba1(0x119))/0x3+-parseInt(_0x2bbba1(0x146))/0x4+-parseInt(_0x2bbba1(0x151))/0x5+parseInt(_0x2bbba1(0x153))/0x6*(-parseInt(_0x2bbba1(0x118))/0x7)+-parseInt(_0x2bbba1(0x11c))/0x8*(-parseInt(_0x2bbba1(0x120))/0x9)+parseInt(_0x2bbba1(0x130))/0xa*(parseInt(_0x2bbba1(0x114))/0xb);if(_0x541578===_0x3caa5a)break;else _0x544ddf['push'](_0x544ddf['shift']());}catch(_0x763568){_0x544ddf['push'](_0x544ddf['shift']());}}}(a548_0x3ccd,0xd209a));function a548_0x3ccd(){const _0x18560d=['8dLcLGd','set','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','sendMessage','829944eaZShQ','contactId','CheckConnection','../../models/Contact','getBodyMessage','user','createClient','del','apply','Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!','findOne','ticketId','assistant','disconnect','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','toString','22490ihKpkz','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','env','queueId','constructor','__esModule','O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.','userId','@s.whatsapp.net','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','contact','companyId','SendMessageConnectedStaffMember','REDIS_URI','../../models/Queue','Desconectado\x20com\x20sucesso','sair','__importDefault','type','fromMe','queues','../TicketServices/UpdateTicketService','4823232xhVfHZ','../TicketServices/ShowTicketService','connect','includes','1374zbDtwL','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','closed','key','replace','Disconnect','open','3081935VfccwC','search','3024WhAFem','number','remoteJid','toLowerCase','default','get','ResponseProxy','23771EoBpOo','(((.+)+)+)+$','stringify','parse','3605azmozw','3215382BylWrB','audio','1366Skyvjf'];a548_0x3ccd=function(){return _0x18560d;};return a548_0x3ccd();}const a548_0x3feeb1=(function(){let _0x44d010=!![];return function(_0x371e71,_0x16c096){const _0x28b3ce=_0x44d010?function(){const _0x1b7c04=a548_0xdec0;if(_0x16c096){const _0x20b9ad=_0x16c096[_0x1b7c04(0x128)](_0x371e71,arguments);return _0x16c096=null,_0x20b9ad;}}:function(){};return _0x44d010=![],_0x28b3ce;};}()),a548_0x645824=a548_0x3feeb1(this,function(){const _0x1d455f=a548_0xdec0;return a548_0x645824[_0x1d455f(0x12f)]()[_0x1d455f(0x152)](_0x1d455f(0x115))[_0x1d455f(0x12f)]()[_0x1d455f(0x134)](a548_0x645824)[_0x1d455f(0x152)](_0x1d455f(0x115));});a548_0x645824();'use strict';var __importDefault=this&&this[a548_0x573fb0(0x141)]||function(_0x438efb){const _0x3048b8=a548_0x573fb0;return _0x438efb&&_0x438efb[_0x3048b8(0x135)]?_0x438efb:{'default':_0x438efb};};Object['defineProperty'](exports,a548_0x573fb0(0x135),{'value':!![]}),exports[a548_0x573fb0(0x13c)]=exports[a548_0x573fb0(0x113)]=exports[a548_0x573fb0(0x14f)]=exports['CheckConnection']=void 0x0;const Ticket_1=__importDefault(require('../../models/Ticket')),User_1=__importDefault(require('../../models/User')),redis_1=require('redis'),Contact_1=__importDefault(require(a548_0x573fb0(0x123))),UpdateTicketService_1=__importDefault(require(a548_0x573fb0(0x145))),wbotMessageListener_1=require('../WbotServices/wbotMessageListener'),ShowTicketService_1=__importDefault(require(a548_0x573fb0(0x147))),Queue_1=__importDefault(require(a548_0x573fb0(0x13e))),CheckConnection=async({waid:_0xee7694,code:_0x4fe6ca,companyId:_0x110245,wbot:_0x4bfe94})=>{const _0x52dbb3=a548_0x573fb0,_0x462651=await User_1['default'][_0x52dbb3(0x12a)]({'where':{'waid':_0xee7694,'companyId':_0x110245},'include':[{'model':Queue_1[_0x52dbb3(0x111)]}]});if(!_0x462651)return![];const _0x3356ad=await Ticket_1[_0x52dbb3(0x111)][_0x52dbb3(0x12a)]({'where':{'iCode':_0x4fe6ca,'companyId':_0x110245,'status':'pending'},'include':[{'model':Contact_1[_0x52dbb3(0x111)]},{'model':Queue_1[_0x52dbb3(0x111)]}]});if(!_0x3356ad)return await _0x4bfe94[_0x52dbb3(0x11f)](_0xee7694+_0x52dbb3(0x138),{'text':_0x52dbb3(0x129)}),!![];const _0x1a007c=_0x462651[_0x52dbb3(0x144)]['map'](_0x55ebeb=>_0x55ebeb['id']),_0x3a78bd=_0x3356ad?.[_0x52dbb3(0x133)];if(_0x3a78bd){if(!_0x1a007c[_0x52dbb3(0x149)](_0x3a78bd))return console['log'](_0x52dbb3(0x14b)),await _0x4bfe94[_0x52dbb3(0x11f)](_0xee7694+_0x52dbb3(0x138),{'text':_0x52dbb3(0x12e)}),!![];}else{if(_0x3356ad[_0x52dbb3(0x137)]!==_0x462651['id'])return console['log'](_0x52dbb3(0x136)),await _0x4bfe94[_0x52dbb3(0x11f)](_0xee7694+_0x52dbb3(0x138),{'text':_0x52dbb3(0x11e)}),!![];}if(_0x3356ad['contact'][_0x52dbb3(0x154)]===_0xee7694)return await _0x4bfe94[_0x52dbb3(0x11f)](_0xee7694+_0x52dbb3(0x138),{'text':_0x52dbb3(0x139)}),!![];const _0x59560a=(0x0,redis_1[_0x52dbb3(0x126)])({'url':process[_0x52dbb3(0x132)][_0x52dbb3(0x13d)]});await _0x59560a[_0x52dbb3(0x148)]();let _0x43d9ca={'type':_0x52dbb3(0x125),'ticketId':_0x3356ad['id'],'userId':_0x462651['id'],'number':_0xee7694,'companyId':_0x110245};await _0x59560a[_0x52dbb3(0x11d)](_0x3356ad[_0x52dbb3(0x13a)]['number'],JSON[_0x52dbb3(0x116)](_0x43d9ca),{'EX':0x15180}),_0x43d9ca={'type':_0x52dbb3(0x12c),'ticketId':_0x3356ad['id'],'number':_0x3356ad['contact'][_0x52dbb3(0x154)],'userId':_0x462651['id'],'companyId':_0x110245},await _0x59560a[_0x52dbb3(0x11d)](_0xee7694,JSON[_0x52dbb3(0x116)](_0x43d9ca),{'EX':0x15180}),await _0x59560a['disconnect']();const _0x181805=await(0x0,UpdateTicketService_1[_0x52dbb3(0x111)])({'ticketData':{'status':_0x52dbb3(0x150),'userId':_0x462651['id']},'ticketId':_0x3356ad['id'],'companyId':_0x110245});return await _0x4bfe94[_0x52dbb3(0x11f)](_0xee7694+'@s.whatsapp.net',{'text':_0x52dbb3(0x131)}),!![];};exports[a548_0x573fb0(0x122)]=CheckConnection;const Disconnect=async({msg:_0x16eeb1,companyId:_0x5d6204,wbot:_0x2a1a4c})=>{const _0x8afa37=a548_0x573fb0;let _0x2a95e6=![];const _0x52255e=(0x0,redis_1[_0x8afa37(0x126)])({'url':process[_0x8afa37(0x132)][_0x8afa37(0x13d)]});await _0x52255e['connect']();const _0x37d84f=_0x16eeb1[_0x8afa37(0x14d)][_0x8afa37(0x10f)][_0x8afa37(0x14e)](_0x8afa37(0x138),''),_0x3fc711=await _0x52255e[_0x8afa37(0x112)](_0x37d84f);if(_0x3fc711){const _0x49d17c=JSON[_0x8afa37(0x117)](_0x3fc711);if(_0x49d17c[_0x8afa37(0x142)]==_0x8afa37(0x12c)&&_0x49d17c[_0x8afa37(0x13b)]==_0x5d6204){const _0x391487=await(0x0,UpdateTicketService_1[_0x8afa37(0x111)])({'ticketData':{'status':_0x8afa37(0x14c),'userId':_0x49d17c[_0x8afa37(0x137)]},'ticketId':_0x49d17c[_0x8afa37(0x12b)],'companyId':_0x5d6204});await _0x52255e['del'](_0x37d84f),await _0x52255e[_0x8afa37(0x127)](_0x49d17c[_0x8afa37(0x154)]),await _0x2a1a4c['sendMessage'](_0x37d84f+'@s.whatsapp.net',{'text':_0x8afa37(0x13f)}),_0x2a95e6=!![];}}return _0x52255e[_0x8afa37(0x12d)](),_0x2a95e6;};exports['Disconnect']=Disconnect;function a548_0xdec0(_0x3fea08,_0x268bce){const _0x358f62=a548_0x3ccd();return a548_0xdec0=function(_0x645824,_0x3feeb1){_0x645824=_0x645824-0x10f;let _0x3ccd39=_0x358f62[_0x645824];return _0x3ccd39;},a548_0xdec0(_0x3fea08,_0x268bce);}const ResponseProxy=async({msg:_0x30c16d,companyId:_0x44cdb9,wbot:_0x4de519})=>{const _0x480ef2=a548_0x573fb0,_0x420c18=(0x0,wbotMessageListener_1[_0x480ef2(0x124)])(_0x30c16d),_0x2a66b3=_0x30c16d[_0x480ef2(0x14d)][_0x480ef2(0x10f)][_0x480ef2(0x14e)]('@s.whatsapp.net','');if(_0x30c16d['key'][_0x480ef2(0x143)])return![];const _0x18c4b2=(0x0,redis_1['createClient'])({'url':process['env']['REDIS_URI']});await _0x18c4b2['connect']();const _0x40ee5e=await _0x18c4b2['get'](_0x2a66b3);if(!_0x40ee5e)return![];const _0x47309d=JSON[_0x480ef2(0x117)](_0x40ee5e);if(_0x47309d[_0x480ef2(0x142)]!==_0x480ef2(0x12c))return![];if(_0x420c18[_0x480ef2(0x110)]()===_0x480ef2(0x140)){const _0xaf7ea3=await(0x0,exports[_0x480ef2(0x14f)])({'msg':_0x30c16d,'companyId':_0x44cdb9,'wbot':_0x4de519});if(_0xaf7ea3)return;}if(_0x420c18[_0x480ef2(0x110)]()==_0x480ef2(0x11a)){}const _0x441abd=await(0x0,ShowTicketService_1['default'])(_0x47309d[_0x480ef2(0x12b)],_0x44cdb9);let _0x24b95a={'id':_0x30c16d[_0x480ef2(0x14d)]['id'],'ticketId':_0x47309d[_0x480ef2(0x12b)],'body':_0x420c18,'contactId':_0x441abd[_0x480ef2(0x121)],'fromMe':!![],'read':!![]};return await _0x4de519[_0x480ef2(0x11f)](_0x47309d[_0x480ef2(0x154)]+_0x480ef2(0x138),{'forward':_0x30c16d}),!![];};exports[a548_0x573fb0(0x113)]=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x51c0e5,companyId:_0x1cc977,wbot:_0x3170e4,body:_0x46e402})=>{const _0x554de=a548_0x573fb0;if(_0x51c0e5['key']['fromMe'])return![];const _0x205054=_0x51c0e5[_0x554de(0x14d)][_0x554de(0x10f)]['replace']('@s.whatsapp.net',''),_0x1d8b90=(0x0,redis_1['createClient'])({'url':process[_0x554de(0x132)]['REDIS_URI']});await _0x1d8b90[_0x554de(0x148)]();const _0x50d616=await _0x1d8b90[_0x554de(0x112)](_0x205054);if(!_0x50d616)return![];const _0x161615=JSON['parse'](_0x50d616);if(_0x161615[_0x554de(0x142)]!=_0x554de(0x125)||_0x161615[_0x554de(0x13b)]!=_0x1cc977)return![];return await _0x3170e4['sendMessage'](_0x161615['number']+'@s.whatsapp.net',{'forward':_0x51c0e5}),!![];};exports['SendMessageConnectedStaffMember']=SendMessageConnectedStaffMember;