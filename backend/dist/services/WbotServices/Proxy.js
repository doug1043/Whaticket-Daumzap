const a549_0x3377ee=a549_0x4c2f;function a549_0x4e11(){const _0x291e91=['toLowerCase','queues','log','REDIS_URI','key','get','2625995qaFIwA','18KVJnKR','default','1090899pOyJxm','25995580cmrVYu','pending','sendMessage','queueId','__esModule','type','Desconectado\x20com\x20sucesso','replace','../TicketServices/ShowTicketService','(((.+)+)+)+$','../WbotServices/wbotMessageListener','1373548iCStbL','number','ticketId','audio','companyId','fromMe','userId','constructor','redis','SendMessageConnectedStaffMember','disconnect','../../models/Contact','parse','apply','contact','set','findOne','9620912kbjbOn','createClient','10hodoWK','assistant','16OfJGzV','contactId','CheckConnection','../../models/User','Disconnect','defineProperty','remoteJid','del','open','161897LXcVHG','@s.whatsapp.net','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.','../../models/Queue','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','ResponseProxy','../../models/Ticket','search','../TicketServices/UpdateTicketService','includes','__importDefault','1613574NoxvgY','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','env','stringify','connect','getBodyMessage'];a549_0x4e11=function(){return _0x291e91;};return a549_0x4e11();}(function(_0x5a08c7,_0x2c4c0f){const _0x455683=a549_0x4c2f,_0x32d97d=_0x5a08c7();while(!![]){try{const _0x409012=-parseInt(_0x455683(0x97))/0x1*(parseInt(_0x455683(0x8c))/0x2)+-parseInt(_0x455683(0xa3))/0x3+-parseInt(_0x455683(0xbe))/0x4+parseInt(_0x455683(0xaf))/0x5*(parseInt(_0x455683(0xb0))/0x6)+-parseInt(_0x455683(0x8a))/0x7+parseInt(_0x455683(0x8e))/0x8*(-parseInt(_0x455683(0xb2))/0x9)+parseInt(_0x455683(0xb3))/0xa;if(_0x409012===_0x2c4c0f)break;else _0x32d97d['push'](_0x32d97d['shift']());}catch(_0x8c7ffb){_0x32d97d['push'](_0x32d97d['shift']());}}}(a549_0x4e11,0xd3d03));const a549_0x4b5ae8=(function(){let _0xcc3875=!![];return function(_0x3bdddf,_0x150457){const _0x3712a2=_0xcc3875?function(){const _0x2b2f74=a549_0x4c2f;if(_0x150457){const _0x46479a=_0x150457[_0x2b2f74(0x86)](_0x3bdddf,arguments);return _0x150457=null,_0x46479a;}}:function(){};return _0xcc3875=![],_0x3712a2;};}()),a549_0x45150a=a549_0x4b5ae8(this,function(){const _0x1b0402=a549_0x4c2f;return a549_0x45150a['toString']()[_0x1b0402(0x9f)](_0x1b0402(0xbc))['toString']()[_0x1b0402(0xc5)](a549_0x45150a)[_0x1b0402(0x9f)](_0x1b0402(0xbc));});a549_0x45150a();'use strict';var __importDefault=this&&this[a549_0x3377ee(0xa2)]||function(_0x5854de){return _0x5854de&&_0x5854de['__esModule']?_0x5854de:{'default':_0x5854de};};Object[a549_0x3377ee(0x93)](exports,a549_0x3377ee(0xb7),{'value':!![]}),exports[a549_0x3377ee(0x82)]=exports[a549_0x3377ee(0x9d)]=exports[a549_0x3377ee(0x92)]=exports[a549_0x3377ee(0x90)]=void 0x0;const Ticket_1=__importDefault(require(a549_0x3377ee(0x9e))),User_1=__importDefault(require(a549_0x3377ee(0x91))),redis_1=require(a549_0x3377ee(0x81)),Contact_1=__importDefault(require(a549_0x3377ee(0x84))),UpdateTicketService_1=__importDefault(require(a549_0x3377ee(0xa0))),wbotMessageListener_1=require(a549_0x3377ee(0xbd)),ShowTicketService_1=__importDefault(require(a549_0x3377ee(0xbb))),Queue_1=__importDefault(require(a549_0x3377ee(0x9b))),CheckConnection=async({waid:_0x9608f,code:_0x1e5ec7,companyId:_0x47f16b,wbot:_0x2d2060})=>{const _0x1a0840=a549_0x3377ee,_0x4424a3=await User_1[_0x1a0840(0xb1)][_0x1a0840(0x89)]({'where':{'waid':_0x9608f,'companyId':_0x47f16b},'include':[{'model':Queue_1[_0x1a0840(0xb1)]}]});if(!_0x4424a3)return![];const _0x22e430=await Ticket_1['default']['findOne']({'where':{'iCode':_0x1e5ec7,'companyId':_0x47f16b,'status':_0x1a0840(0xb4)},'include':[{'model':Contact_1[_0x1a0840(0xb1)]},{'model':Queue_1[_0x1a0840(0xb1)]}]});if(!_0x22e430)return await _0x2d2060['sendMessage'](_0x9608f+'@s.whatsapp.net',{'text':'Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!'}),!![];const _0x3adce0=_0x4424a3[_0x1a0840(0xaa)]['map'](_0x1b64c8=>_0x1b64c8['id']),_0x1a2305=_0x22e430?.[_0x1a0840(0xb6)];if(_0x1a2305){if(!_0x3adce0[_0x1a0840(0xa1)](_0x1a2305))return console[_0x1a0840(0xab)](_0x1a0840(0x99)),await _0x2d2060[_0x1a0840(0xb5)](_0x9608f+_0x1a0840(0x98),{'text':'Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.'}),!![];}else{if(_0x22e430[_0x1a0840(0xc4)]!==_0x4424a3['id'])return console[_0x1a0840(0xab)](_0x1a0840(0x9a)),await _0x2d2060[_0x1a0840(0xb5)](_0x9608f+_0x1a0840(0x98),{'text':_0x1a0840(0xa4)}),!![];}if(_0x22e430['contact'][_0x1a0840(0xbf)]===_0x9608f)return await _0x2d2060[_0x1a0840(0xb5)](_0x9608f+_0x1a0840(0x98),{'text':'Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!'}),!![];const _0x5f43f0=(0x0,redis_1[_0x1a0840(0x8b)])({'url':process[_0x1a0840(0xa5)][_0x1a0840(0xac)]});await _0x5f43f0['connect']();let _0x11837f={'type':'user','ticketId':_0x22e430['id'],'userId':_0x4424a3['id'],'number':_0x9608f,'companyId':_0x47f16b};await _0x5f43f0[_0x1a0840(0x88)](_0x22e430[_0x1a0840(0x87)][_0x1a0840(0xbf)],JSON['stringify'](_0x11837f),{'EX':0x15180}),_0x11837f={'type':_0x1a0840(0x8d),'ticketId':_0x22e430['id'],'number':_0x22e430[_0x1a0840(0x87)]['number'],'userId':_0x4424a3['id'],'companyId':_0x47f16b},await _0x5f43f0['set'](_0x9608f,JSON[_0x1a0840(0xa6)](_0x11837f),{'EX':0x15180}),await _0x5f43f0[_0x1a0840(0x83)]();const _0x3aced0=await(0x0,UpdateTicketService_1[_0x1a0840(0xb1)])({'ticketData':{'status':_0x1a0840(0x96),'userId':_0x4424a3['id']},'ticketId':_0x22e430['id'],'companyId':_0x47f16b});return await _0x2d2060[_0x1a0840(0xb5)](_0x9608f+'@s.whatsapp.net',{'text':_0x1a0840(0x9c)}),!![];};exports[a549_0x3377ee(0x90)]=CheckConnection;const Disconnect=async({msg:_0xc2f982,companyId:_0x2e28d3,wbot:_0x37cffc})=>{const _0x4ab1d6=a549_0x3377ee;let _0x22b0e6=![];const _0x181b34=(0x0,redis_1[_0x4ab1d6(0x8b)])({'url':process[_0x4ab1d6(0xa5)][_0x4ab1d6(0xac)]});await _0x181b34['connect']();const _0x12d10a=_0xc2f982[_0x4ab1d6(0xad)][_0x4ab1d6(0x94)]['replace']('@s.whatsapp.net',''),_0x3f0cdc=await _0x181b34[_0x4ab1d6(0xae)](_0x12d10a);if(_0x3f0cdc){const _0x209877=JSON[_0x4ab1d6(0x85)](_0x3f0cdc);if(_0x209877[_0x4ab1d6(0xb8)]=='assistant'&&_0x209877[_0x4ab1d6(0xc2)]==_0x2e28d3){const _0xb3e76f=await(0x0,UpdateTicketService_1[_0x4ab1d6(0xb1)])({'ticketData':{'status':'closed','userId':_0x209877[_0x4ab1d6(0xc4)]},'ticketId':_0x209877[_0x4ab1d6(0xc0)],'companyId':_0x2e28d3});await _0x181b34[_0x4ab1d6(0x95)](_0x12d10a),await _0x181b34[_0x4ab1d6(0x95)](_0x209877['number']),await _0x37cffc[_0x4ab1d6(0xb5)](_0x12d10a+'@s.whatsapp.net',{'text':_0x4ab1d6(0xb9)}),_0x22b0e6=!![];}}return _0x181b34[_0x4ab1d6(0x83)](),_0x22b0e6;};exports[a549_0x3377ee(0x92)]=Disconnect;const ResponseProxy=async({msg:_0x24c639,companyId:_0x52483c,wbot:_0x5cadf8})=>{const _0x20f8bb=a549_0x3377ee,_0x567d1c=(0x0,wbotMessageListener_1[_0x20f8bb(0xa8)])(_0x24c639),_0x253087=_0x24c639['key'][_0x20f8bb(0x94)][_0x20f8bb(0xba)](_0x20f8bb(0x98),'');if(_0x24c639[_0x20f8bb(0xad)][_0x20f8bb(0xc3)])return![];const _0x27e1c3=(0x0,redis_1[_0x20f8bb(0x8b)])({'url':process[_0x20f8bb(0xa5)][_0x20f8bb(0xac)]});await _0x27e1c3['connect']();const _0x15cc14=await _0x27e1c3[_0x20f8bb(0xae)](_0x253087);if(!_0x15cc14)return![];const _0xa4dab8=JSON[_0x20f8bb(0x85)](_0x15cc14);if(_0xa4dab8[_0x20f8bb(0xb8)]!==_0x20f8bb(0x8d))return![];if(_0x567d1c[_0x20f8bb(0xa9)]()==='sair'){const _0x371f84=await(0x0,exports[_0x20f8bb(0x92)])({'msg':_0x24c639,'companyId':_0x52483c,'wbot':_0x5cadf8});if(_0x371f84)return;}if(_0x567d1c[_0x20f8bb(0xa9)]()==_0x20f8bb(0xc1)){}const _0x578f34=await(0x0,ShowTicketService_1[_0x20f8bb(0xb1)])(_0xa4dab8[_0x20f8bb(0xc0)],_0x52483c);let _0x26bf6c={'id':_0x24c639[_0x20f8bb(0xad)]['id'],'ticketId':_0xa4dab8[_0x20f8bb(0xc0)],'body':_0x567d1c,'contactId':_0x578f34[_0x20f8bb(0x8f)],'fromMe':!![],'read':!![]};return await _0x5cadf8[_0x20f8bb(0xb5)](_0xa4dab8['number']+'@s.whatsapp.net',{'forward':_0x24c639}),!![];};function a549_0x4c2f(_0x9d3ddb,_0x27a703){const _0x35d9a0=a549_0x4e11();return a549_0x4c2f=function(_0x45150a,_0x4b5ae8){_0x45150a=_0x45150a-0x81;let _0x4e11fe=_0x35d9a0[_0x45150a];return _0x4e11fe;},a549_0x4c2f(_0x9d3ddb,_0x27a703);}exports[a549_0x3377ee(0x9d)]=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x3d1739,companyId:_0x40c77e,wbot:_0x1d5255,body:_0x11bc52})=>{const _0x5ccef4=a549_0x3377ee;if(_0x3d1739['key'][_0x5ccef4(0xc3)])return![];const _0x283173=_0x3d1739['key'][_0x5ccef4(0x94)][_0x5ccef4(0xba)]('@s.whatsapp.net',''),_0x34c707=(0x0,redis_1[_0x5ccef4(0x8b)])({'url':process[_0x5ccef4(0xa5)][_0x5ccef4(0xac)]});await _0x34c707[_0x5ccef4(0xa7)]();const _0x47a56c=await _0x34c707[_0x5ccef4(0xae)](_0x283173);if(!_0x47a56c)return![];const _0x5aeb27=JSON[_0x5ccef4(0x85)](_0x47a56c);if(_0x5aeb27['type']!='user'||_0x5aeb27[_0x5ccef4(0xc2)]!=_0x40c77e)return![];return await _0x1d5255[_0x5ccef4(0xb5)](_0x5aeb27[_0x5ccef4(0xbf)]+_0x5ccef4(0x98),{'forward':_0x3d1739}),!![];};exports[a549_0x3377ee(0x82)]=SendMessageConnectedStaffMember;