const a550_0x5538e1=a550_0x4511;(function(_0xddf28c,_0x504d6f){const _0x1ef6b5=a550_0x4511,_0x1d051c=_0xddf28c();while(!![]){try{const _0x250bc0=parseInt(_0x1ef6b5(0x12e))/0x1*(parseInt(_0x1ef6b5(0x139))/0x2)+parseInt(_0x1ef6b5(0x12a))/0x3+-parseInt(_0x1ef6b5(0x114))/0x4*(-parseInt(_0x1ef6b5(0x120))/0x5)+-parseInt(_0x1ef6b5(0x116))/0x6*(-parseInt(_0x1ef6b5(0x133))/0x7)+-parseInt(_0x1ef6b5(0x129))/0x8+parseInt(_0x1ef6b5(0x110))/0x9+-parseInt(_0x1ef6b5(0x112))/0xa;if(_0x250bc0===_0x504d6f)break;else _0x1d051c['push'](_0x1d051c['shift']());}catch(_0x193b44){_0x1d051c['push'](_0x1d051c['shift']());}}}(a550_0x5a47,0x1ca5e));const a550_0x264bfc=(function(){let _0x33f4bc=!![];return function(_0x290c97,_0x4f3a67){const _0x2bca71=_0x33f4bc?function(){const _0x47b43a=a550_0x4511;if(_0x4f3a67){const _0xea619a=_0x4f3a67[_0x47b43a(0x109)](_0x290c97,arguments);return _0x4f3a67=null,_0xea619a;}}:function(){};return _0x33f4bc=![],_0x2bca71;};}()),a550_0x2c111b=a550_0x264bfc(this,function(){const _0x592207=a550_0x4511;return a550_0x2c111b['toString']()[_0x592207(0x134)]('(((.+)+)+)+$')[_0x592207(0x13b)]()[_0x592207(0x10b)](a550_0x2c111b)[_0x592207(0x134)]('(((.+)+)+)+$');});a550_0x2c111b();'use strict';var __importDefault=this&&this[a550_0x5538e1(0x13d)]||function(_0x2c5fc3){const _0x3b0d20=a550_0x5538e1;return _0x2c5fc3&&_0x2c5fc3[_0x3b0d20(0xfa)]?_0x2c5fc3:{'default':_0x2c5fc3};};function a550_0x4511(_0x350f4d,_0x18d83f){const _0x4556c7=a550_0x5a47();return a550_0x4511=function(_0x2c111b,_0x264bfc){_0x2c111b=_0x2c111b-0xfa;let _0x5a4753=_0x4556c7[_0x2c111b];return _0x5a4753;},a550_0x4511(_0x350f4d,_0x18d83f);}Object[a550_0x5538e1(0x11b)](exports,a550_0x5538e1(0xfa),{'value':!![]}),exports[a550_0x5538e1(0x10e)]=exports[a550_0x5538e1(0x11c)]=exports['Disconnect']=exports['CheckConnection']=void 0x0;const Ticket_1=__importDefault(require(a550_0x5538e1(0x111))),User_1=__importDefault(require('../../models/User')),redis_1=require(a550_0x5538e1(0x13c)),Contact_1=__importDefault(require(a550_0x5538e1(0x117))),UpdateTicketService_1=__importDefault(require(a550_0x5538e1(0x140))),wbotMessageListener_1=require(a550_0x5538e1(0x127)),ShowTicketService_1=__importDefault(require(a550_0x5538e1(0x12d))),Queue_1=__importDefault(require(a550_0x5538e1(0x108))),CheckConnection=async({waid:_0x5bce45,code:_0x918888,companyId:_0x6e19af,wbot:_0x12b510})=>{const _0x346f2c=a550_0x5538e1,_0x40d69c=await User_1[_0x346f2c(0x101)][_0x346f2c(0xfe)]({'where':{'waid':_0x5bce45,'companyId':_0x6e19af},'include':[{'model':Queue_1['default']}]});if(!_0x40d69c)return![];const _0x2518b9=await Ticket_1[_0x346f2c(0x101)][_0x346f2c(0xfe)]({'where':{'iCode':_0x918888,'companyId':_0x6e19af,'status':_0x346f2c(0x13f)},'include':[{'model':Contact_1[_0x346f2c(0x101)]},{'model':Queue_1[_0x346f2c(0x101)]}]});if(!_0x2518b9)return await _0x12b510[_0x346f2c(0x11d)](_0x5bce45+_0x346f2c(0x138),{'text':_0x346f2c(0x100)}),!![];const _0x51f311=_0x40d69c[_0x346f2c(0x136)][_0x346f2c(0xff)](_0xa3b2ca=>_0xa3b2ca['id']),_0x2b2adc=_0x2518b9?.['queueId'];if(_0x2b2adc){if(!_0x51f311['includes'](_0x2b2adc))return console[_0x346f2c(0xfc)](_0x346f2c(0x113)),await _0x12b510[_0x346f2c(0x11d)](_0x5bce45+_0x346f2c(0x138),{'text':_0x346f2c(0x102)}),!![];}else{if(_0x2518b9[_0x346f2c(0x11a)]!==_0x40d69c['id'])return console[_0x346f2c(0xfc)](_0x346f2c(0x128)),await _0x12b510[_0x346f2c(0x11d)](_0x5bce45+_0x346f2c(0x138),{'text':_0x346f2c(0x121)}),!![];}if(_0x2518b9[_0x346f2c(0x104)][_0x346f2c(0x123)]===_0x5bce45)return await _0x12b510[_0x346f2c(0x11d)](_0x5bce45+'@s.whatsapp.net',{'text':'Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!'}),!![];const _0x51633f=(0x0,redis_1[_0x346f2c(0x12c)])({'url':process[_0x346f2c(0x124)]['REDIS_URI']});await _0x51633f[_0x346f2c(0x10a)]();let _0x7b194a={'type':_0x346f2c(0x11e),'ticketId':_0x2518b9['id'],'userId':_0x40d69c['id'],'number':_0x5bce45,'companyId':_0x6e19af};await _0x51633f[_0x346f2c(0x107)](_0x2518b9[_0x346f2c(0x104)][_0x346f2c(0x123)],JSON[_0x346f2c(0x103)](_0x7b194a),{'EX':0x15180}),_0x7b194a={'type':'assistant','ticketId':_0x2518b9['id'],'number':_0x2518b9[_0x346f2c(0x104)]['number'],'userId':_0x40d69c['id'],'companyId':_0x6e19af},await _0x51633f[_0x346f2c(0x107)](_0x5bce45,JSON[_0x346f2c(0x103)](_0x7b194a),{'EX':0x15180}),await _0x51633f[_0x346f2c(0x118)]();const _0x2e07e2=await(0x0,UpdateTicketService_1[_0x346f2c(0x101)])({'ticketData':{'status':_0x346f2c(0x115),'userId':_0x40d69c['id']},'ticketId':_0x2518b9['id'],'companyId':_0x6e19af});return await _0x12b510[_0x346f2c(0x11d)](_0x5bce45+_0x346f2c(0x138),{'text':_0x346f2c(0x125)}),!![];};exports[a550_0x5538e1(0x126)]=CheckConnection;const Disconnect=async({msg:_0x2ce1d0,companyId:_0x4ad275,wbot:_0x46b65c})=>{const _0x13ee0c=a550_0x5538e1;let _0xa283df=![];const _0x26f91a=(0x0,redis_1[_0x13ee0c(0x12c)])({'url':process['env'][_0x13ee0c(0x10f)]});await _0x26f91a[_0x13ee0c(0x10a)]();const _0x44bb50=_0x2ce1d0[_0x13ee0c(0x106)][_0x13ee0c(0x132)][_0x13ee0c(0x10c)](_0x13ee0c(0x138),''),_0x19a6d9=await _0x26f91a[_0x13ee0c(0xfd)](_0x44bb50);if(_0x19a6d9){const _0x33af49=JSON[_0x13ee0c(0x135)](_0x19a6d9);if(_0x33af49[_0x13ee0c(0x13a)]==_0x13ee0c(0x12b)&&_0x33af49[_0x13ee0c(0x131)]==_0x4ad275){const _0x1f2f16=await(0x0,UpdateTicketService_1[_0x13ee0c(0x101)])({'ticketData':{'status':_0x13ee0c(0x137),'userId':_0x33af49[_0x13ee0c(0x11a)]},'ticketId':_0x33af49[_0x13ee0c(0x12f)],'companyId':_0x4ad275});await _0x26f91a['del'](_0x44bb50),await _0x26f91a[_0x13ee0c(0x122)](_0x33af49['number']),await _0x46b65c[_0x13ee0c(0x11d)](_0x44bb50+_0x13ee0c(0x138),{'text':_0x13ee0c(0x10d)}),_0xa283df=!![];}}return _0x26f91a[_0x13ee0c(0x118)](),_0xa283df;};function a550_0x5a47(){const _0x12e02f=['findOne','map','Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!','default','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','stringify','contact','toLowerCase','key','set','../../models/Queue','apply','connect','constructor','replace','Desconectado\x20com\x20sucesso','SendMessageConnectedStaffMember','REDIS_URI','1451691ijONxC','../../models/Ticket','3830350kTRnCg','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','15692ldCiRN','open','6qLeKMg','../../models/Contact','disconnect','contactId','userId','defineProperty','ResponseProxy','sendMessage','user','sair','10hSraCK','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','del','number','env','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','CheckConnection','../WbotServices/wbotMessageListener','O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.','538600RwVenf','687693NmJAvB','assistant','createClient','../TicketServices/ShowTicketService','1fwXjal','ticketId','audio','companyId','remoteJid','948059kFGVmp','search','parse','queues','closed','@s.whatsapp.net','67778UCOWGy','type','toString','redis','__importDefault','Disconnect','pending','../TicketServices/UpdateTicketService','__esModule','fromMe','log','get'];a550_0x5a47=function(){return _0x12e02f;};return a550_0x5a47();}exports['Disconnect']=Disconnect;const ResponseProxy=async({msg:_0xd550dc,companyId:_0x392a16,wbot:_0x1ef585})=>{const _0x3e08ca=a550_0x5538e1,_0x5ee68a=(0x0,wbotMessageListener_1['getBodyMessage'])(_0xd550dc),_0x38efd5=_0xd550dc['key']['remoteJid']['replace'](_0x3e08ca(0x138),'');if(_0xd550dc[_0x3e08ca(0x106)][_0x3e08ca(0xfb)])return![];const _0x58b444=(0x0,redis_1['createClient'])({'url':process[_0x3e08ca(0x124)][_0x3e08ca(0x10f)]});await _0x58b444['connect']();const _0x295695=await _0x58b444['get'](_0x38efd5);if(!_0x295695)return![];const _0x34b1d9=JSON[_0x3e08ca(0x135)](_0x295695);if(_0x34b1d9[_0x3e08ca(0x13a)]!==_0x3e08ca(0x12b))return![];if(_0x5ee68a[_0x3e08ca(0x105)]()===_0x3e08ca(0x11f)){const _0xa618b6=await(0x0,exports[_0x3e08ca(0x13e)])({'msg':_0xd550dc,'companyId':_0x392a16,'wbot':_0x1ef585});if(_0xa618b6)return;}if(_0x5ee68a['toLowerCase']()==_0x3e08ca(0x130)){}const _0xde6714=await(0x0,ShowTicketService_1['default'])(_0x34b1d9[_0x3e08ca(0x12f)],_0x392a16);let _0x50b1a1={'id':_0xd550dc[_0x3e08ca(0x106)]['id'],'ticketId':_0x34b1d9['ticketId'],'body':_0x5ee68a,'contactId':_0xde6714[_0x3e08ca(0x119)],'fromMe':!![],'read':!![]};return await _0x1ef585[_0x3e08ca(0x11d)](_0x34b1d9['number']+_0x3e08ca(0x138),{'forward':_0xd550dc}),!![];};exports[a550_0x5538e1(0x11c)]=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x27a7c8,companyId:_0x369c8a,wbot:_0x4647a9,body:_0xc5a66f})=>{const _0x3aa49c=a550_0x5538e1;if(_0x27a7c8[_0x3aa49c(0x106)][_0x3aa49c(0xfb)])return![];const _0x2b9b40=_0x27a7c8[_0x3aa49c(0x106)][_0x3aa49c(0x132)][_0x3aa49c(0x10c)](_0x3aa49c(0x138),''),_0x48a303=(0x0,redis_1[_0x3aa49c(0x12c)])({'url':process[_0x3aa49c(0x124)]['REDIS_URI']});await _0x48a303[_0x3aa49c(0x10a)]();const _0x3fb034=await _0x48a303['get'](_0x2b9b40);if(!_0x3fb034)return![];const _0x3c7182=JSON[_0x3aa49c(0x135)](_0x3fb034);if(_0x3c7182[_0x3aa49c(0x13a)]!='user'||_0x3c7182[_0x3aa49c(0x131)]!=_0x369c8a)return![];return await _0x4647a9[_0x3aa49c(0x11d)](_0x3c7182['number']+_0x3aa49c(0x138),{'forward':_0x27a7c8}),!![];};exports[a550_0x5538e1(0x10e)]=SendMessageConnectedStaffMember;