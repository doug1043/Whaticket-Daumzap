const a539_0x1932cb=a539_0x221d;(function(_0x21ab54,_0x5515b3){const _0x2e2620=a539_0x221d,_0x4ba70c=_0x21ab54();while(!![]){try{const _0x1e98ad=parseInt(_0x2e2620(0x118))/0x1*(parseInt(_0x2e2620(0x108))/0x2)+-parseInt(_0x2e2620(0xef))/0x3+parseInt(_0x2e2620(0x11d))/0x4+-parseInt(_0x2e2620(0x107))/0x5+parseInt(_0x2e2620(0x121))/0x6*(-parseInt(_0x2e2620(0x120))/0x7)+-parseInt(_0x2e2620(0x113))/0x8*(parseInt(_0x2e2620(0xf0))/0x9)+parseInt(_0x2e2620(0x100))/0xa*(parseInt(_0x2e2620(0xfe))/0xb);if(_0x1e98ad===_0x5515b3)break;else _0x4ba70c['push'](_0x4ba70c['shift']());}catch(_0x10a350){_0x4ba70c['push'](_0x4ba70c['shift']());}}}(a539_0x533a,0x4fd1b));const a539_0x137c3c=(function(){let _0x3c134d=!![];return function(_0x5dbfdd,_0x2c9da6){const _0x5ebd67=_0x3c134d?function(){const _0x1e809c=a539_0x221d;if(_0x2c9da6){const _0x5456c8=_0x2c9da6[_0x1e809c(0x109)](_0x5dbfdd,arguments);return _0x2c9da6=null,_0x5456c8;}}:function(){};return _0x3c134d=![],_0x5ebd67;};}()),a539_0x53e06d=a539_0x137c3c(this,function(){const _0x5e0993=a539_0x221d;return a539_0x53e06d[_0x5e0993(0xe5)]()['search'](_0x5e0993(0x119))[_0x5e0993(0xe5)]()['constructor'](a539_0x53e06d)[_0x5e0993(0xf7)](_0x5e0993(0x119));});a539_0x53e06d();function a539_0x533a(){const _0x277733=['queues','remoteJid','148HDayKN','(((.+)+)+)+$','default','createClient','pending','242848tSacLn','../TicketServices/ShowTicketService','contact','1026998bSHuDZ','24bsKXnL','key','__esModule','includes','CheckConnection','audio','Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!','@s.whatsapp.net','closed','ResponseProxy','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','../TicketServices/UpdateTicketService','toString','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','toLowerCase','log','ticketId','Desconectado\x20com\x20sucesso','__importDefault','../../models/User','fromMe','REDIS_URI','886002obDQfk','39834sfOgQF','defineProperty','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','queueId','set','redis','search','stringify','getBodyMessage','contactId','O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.','Disconnect','sendMessage','88LRKqek','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','1884550SHGmai','../../models/Contact','del','SendMessageConnectedStaffMember','get','../WbotServices/wbotMessageListener','user','1815365VxbyvR','3222RfhoQB','apply','number','type','companyId','connect','env','parse','open','assistant','replace','424wukHGg','sair','disconnect'];a539_0x533a=function(){return _0x277733;};return a539_0x533a();}'use strict';function a539_0x221d(_0x386083,_0x392224){const _0x5073b9=a539_0x533a();return a539_0x221d=function(_0x53e06d,_0x137c3c){_0x53e06d=_0x53e06d-0xe2;let _0x533aeb=_0x5073b9[_0x53e06d];return _0x533aeb;},a539_0x221d(_0x386083,_0x392224);}var __importDefault=this&&this[a539_0x1932cb(0xeb)]||function(_0x40bef9){const _0x302bcc=a539_0x1932cb;return _0x40bef9&&_0x40bef9[_0x302bcc(0x123)]?_0x40bef9:{'default':_0x40bef9};};Object[a539_0x1932cb(0xf1)](exports,'__esModule',{'value':!![]}),exports[a539_0x1932cb(0x103)]=exports[a539_0x1932cb(0xe2)]=exports[a539_0x1932cb(0xfc)]=exports['CheckConnection']=void 0x0;const Ticket_1=__importDefault(require('../../models/Ticket')),User_1=__importDefault(require(a539_0x1932cb(0xec))),redis_1=require(a539_0x1932cb(0xf6)),Contact_1=__importDefault(require(a539_0x1932cb(0x101))),UpdateTicketService_1=__importDefault(require(a539_0x1932cb(0xe4))),wbotMessageListener_1=require(a539_0x1932cb(0x105)),ShowTicketService_1=__importDefault(require(a539_0x1932cb(0x11e))),Queue_1=__importDefault(require('../../models/Queue')),CheckConnection=async({waid:_0x3a592c,code:_0x38f5a1,companyId:_0xa96beb,wbot:_0xd85103})=>{const _0x8c344b=a539_0x1932cb,_0x1e636d=await User_1['default']['findOne']({'where':{'waid':_0x3a592c,'companyId':_0xa96beb},'include':[{'model':Queue_1[_0x8c344b(0x11a)]}]});if(!_0x1e636d)return![];const _0x4f9ea1=await Ticket_1[_0x8c344b(0x11a)]['findOne']({'where':{'iCode':_0x38f5a1,'companyId':_0xa96beb,'status':_0x8c344b(0x11c)},'include':[{'model':Contact_1[_0x8c344b(0x11a)]},{'model':Queue_1[_0x8c344b(0x11a)]}]});if(!_0x4f9ea1)return await _0xd85103[_0x8c344b(0xfd)](_0x3a592c+_0x8c344b(0x128),{'text':_0x8c344b(0x127)}),!![];const _0x462d39=_0x1e636d[_0x8c344b(0x116)]['map'](_0x1a6dc8=>_0x1a6dc8['id']),_0x23d67e=_0x4f9ea1?.[_0x8c344b(0xf4)];if(_0x23d67e){if(!_0x462d39[_0x8c344b(0x124)](_0x23d67e))return console[_0x8c344b(0xe8)](_0x8c344b(0xe3)),await _0xd85103[_0x8c344b(0xfd)](_0x3a592c+'@s.whatsapp.net',{'text':_0x8c344b(0xe6)}),!![];}else{if(_0x4f9ea1['userId']!==_0x1e636d['id'])return console['log'](_0x8c344b(0xfb)),await _0xd85103['sendMessage'](_0x3a592c+_0x8c344b(0x128),{'text':_0x8c344b(0xf2)}),!![];}if(_0x4f9ea1[_0x8c344b(0x11f)]['number']===_0x3a592c)return await _0xd85103[_0x8c344b(0xfd)](_0x3a592c+_0x8c344b(0x128),{'text':_0x8c344b(0xff)}),!![];const _0x430e9f=(0x0,redis_1[_0x8c344b(0x11b)])({'url':process[_0x8c344b(0x10e)][_0x8c344b(0xee)]});await _0x430e9f[_0x8c344b(0x10d)]();let _0x37abe8={'type':_0x8c344b(0x106),'ticketId':_0x4f9ea1['id'],'userId':_0x1e636d['id'],'number':_0x3a592c,'companyId':_0xa96beb};await _0x430e9f[_0x8c344b(0xf5)](_0x4f9ea1[_0x8c344b(0x11f)][_0x8c344b(0x10a)],JSON[_0x8c344b(0xf8)](_0x37abe8),{'EX':0x15180}),_0x37abe8={'type':_0x8c344b(0x111),'ticketId':_0x4f9ea1['id'],'number':_0x4f9ea1[_0x8c344b(0x11f)][_0x8c344b(0x10a)],'userId':_0x1e636d['id'],'companyId':_0xa96beb},await _0x430e9f['set'](_0x3a592c,JSON[_0x8c344b(0xf8)](_0x37abe8),{'EX':0x15180}),await _0x430e9f[_0x8c344b(0x115)]();const _0x5e1ce1=await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x8c344b(0x110),'userId':_0x1e636d['id']},'ticketId':_0x4f9ea1['id'],'companyId':_0xa96beb});return await _0xd85103['sendMessage'](_0x3a592c+'@s.whatsapp.net',{'text':_0x8c344b(0xf3)}),!![];};exports[a539_0x1932cb(0x125)]=CheckConnection;const Disconnect=async({msg:_0x1d228f,companyId:_0x103d3c,wbot:_0xf67394})=>{const _0x341bd5=a539_0x1932cb;let _0x353ff2=![];const _0x529b38=(0x0,redis_1[_0x341bd5(0x11b)])({'url':process[_0x341bd5(0x10e)]['REDIS_URI']});await _0x529b38[_0x341bd5(0x10d)]();const _0x526c12=_0x1d228f[_0x341bd5(0x122)]['remoteJid'][_0x341bd5(0x112)](_0x341bd5(0x128),''),_0x832d71=await _0x529b38[_0x341bd5(0x104)](_0x526c12);if(_0x832d71){const _0x55477c=JSON['parse'](_0x832d71);if(_0x55477c[_0x341bd5(0x10b)]==_0x341bd5(0x111)&&_0x55477c[_0x341bd5(0x10c)]==_0x103d3c){const _0x28c761=await(0x0,UpdateTicketService_1[_0x341bd5(0x11a)])({'ticketData':{'status':_0x341bd5(0x129),'userId':_0x55477c['userId']},'ticketId':_0x55477c[_0x341bd5(0xe9)],'companyId':_0x103d3c});await _0x529b38[_0x341bd5(0x102)](_0x526c12),await _0x529b38[_0x341bd5(0x102)](_0x55477c[_0x341bd5(0x10a)]),await _0xf67394[_0x341bd5(0xfd)](_0x526c12+_0x341bd5(0x128),{'text':_0x341bd5(0xea)}),_0x353ff2=!![];}}return _0x529b38['disconnect'](),_0x353ff2;};exports['Disconnect']=Disconnect;const ResponseProxy=async({msg:_0x4d5f51,companyId:_0x5cb083,wbot:_0xdb2086})=>{const _0x52411e=a539_0x1932cb,_0x3c4f68=(0x0,wbotMessageListener_1[_0x52411e(0xf9)])(_0x4d5f51),_0x7c73f6=_0x4d5f51['key'][_0x52411e(0x117)][_0x52411e(0x112)](_0x52411e(0x128),'');if(_0x4d5f51['key'][_0x52411e(0xed)])return![];const _0x4d6731=(0x0,redis_1[_0x52411e(0x11b)])({'url':process['env'][_0x52411e(0xee)]});await _0x4d6731[_0x52411e(0x10d)]();const _0x371dcc=await _0x4d6731[_0x52411e(0x104)](_0x7c73f6);if(!_0x371dcc)return![];const _0xd58e77=JSON[_0x52411e(0x10f)](_0x371dcc);if(_0xd58e77['type']!==_0x52411e(0x111))return![];if(_0x3c4f68['toLowerCase']()===_0x52411e(0x114)){const _0x327f96=await(0x0,exports[_0x52411e(0xfc)])({'msg':_0x4d5f51,'companyId':_0x5cb083,'wbot':_0xdb2086});if(_0x327f96)return;}if(_0x3c4f68[_0x52411e(0xe7)]()==_0x52411e(0x126)){}const _0x132ac7=await(0x0,ShowTicketService_1[_0x52411e(0x11a)])(_0xd58e77[_0x52411e(0xe9)],_0x5cb083);let _0x433d98={'id':_0x4d5f51['key']['id'],'ticketId':_0xd58e77[_0x52411e(0xe9)],'body':_0x3c4f68,'contactId':_0x132ac7[_0x52411e(0xfa)],'fromMe':!![],'read':!![]};return await _0xdb2086[_0x52411e(0xfd)](_0xd58e77[_0x52411e(0x10a)]+_0x52411e(0x128),{'forward':_0x4d5f51}),!![];};exports[a539_0x1932cb(0xe2)]=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x2e2dc2,companyId:_0x2439cf,wbot:_0x12bb16,body:_0x22b653})=>{const _0x211ec2=a539_0x1932cb;if(_0x2e2dc2[_0x211ec2(0x122)][_0x211ec2(0xed)])return![];const _0x24912c=_0x2e2dc2[_0x211ec2(0x122)]['remoteJid'][_0x211ec2(0x112)]('@s.whatsapp.net',''),_0x3b87f8=(0x0,redis_1[_0x211ec2(0x11b)])({'url':process[_0x211ec2(0x10e)][_0x211ec2(0xee)]});await _0x3b87f8[_0x211ec2(0x10d)]();const _0x450f93=await _0x3b87f8[_0x211ec2(0x104)](_0x24912c);if(!_0x450f93)return![];const _0x4f78e2=JSON['parse'](_0x450f93);if(_0x4f78e2[_0x211ec2(0x10b)]!=_0x211ec2(0x106)||_0x4f78e2['companyId']!=_0x2439cf)return![];return await _0x12bb16['sendMessage'](_0x4f78e2[_0x211ec2(0x10a)]+_0x211ec2(0x128),{'forward':_0x2e2dc2}),!![];};exports[a539_0x1932cb(0x103)]=SendMessageConnectedStaffMember;