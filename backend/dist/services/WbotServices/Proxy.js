const a549_0x2b90ac=a549_0x1b37;(function(_0x49bf0f,_0x49b77d){const _0x1419d3=a549_0x1b37,_0x3d2e42=_0x49bf0f();while(!![]){try{const _0x2785be=parseInt(_0x1419d3(0x1ab))/0x1*(-parseInt(_0x1419d3(0x187))/0x2)+-parseInt(_0x1419d3(0x179))/0x3+-parseInt(_0x1419d3(0x1b3))/0x4*(-parseInt(_0x1419d3(0x18c))/0x5)+parseInt(_0x1419d3(0x180))/0x6*(parseInt(_0x1419d3(0x1af))/0x7)+-parseInt(_0x1419d3(0x186))/0x8+parseInt(_0x1419d3(0x17d))/0x9+parseInt(_0x1419d3(0x190))/0xa;if(_0x2785be===_0x49b77d)break;else _0x3d2e42['push'](_0x3d2e42['shift']());}catch(_0x1eb310){_0x3d2e42['push'](_0x3d2e42['shift']());}}}(a549_0x5b9a,0xb2622));const a549_0x5ea8f0=(function(){let _0x3f34a9=!![];return function(_0x111c5f,_0x496ae9){const _0x3cdb26=_0x3f34a9?function(){const _0x346d22=a549_0x1b37;if(_0x496ae9){const _0x243e27=_0x496ae9[_0x346d22(0x198)](_0x111c5f,arguments);return _0x496ae9=null,_0x243e27;}}:function(){};return _0x3f34a9=![],_0x3cdb26;};}()),a549_0x142b9f=a549_0x5ea8f0(this,function(){const _0x115b92=a549_0x1b37;return a549_0x142b9f[_0x115b92(0x19b)]()[_0x115b92(0x175)](_0x115b92(0x17c))[_0x115b92(0x19b)]()[_0x115b92(0x195)](a549_0x142b9f)[_0x115b92(0x175)]('(((.+)+)+)+$');});a549_0x142b9f();function a549_0x5b9a(){const _0x4b8157=['defineProperty','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','env','O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.','search','replace','get','../../models/Queue','1303428fZoaii','Disconnect','ResponseProxy','(((.+)+)+)+$','3224034IwbgYn','connect','Desconectado\x20com\x20sucesso','6nfQgLL','number','redis','fromMe','closed','CheckConnection','7813096OcOjuI','6AZHhdF','key','parse','map','queueId','211685Bzgnaa','Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!','type','set','7870740QgqmAA','disconnect','toLowerCase','audio','open','constructor','default','../../models/Ticket','apply','../TicketServices/ShowTicketService','stringify','toString','contactId','SendMessageConnectedStaffMember','user','companyId','contact','../../models/Contact','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','ticketId','@s.whatsapp.net','userId','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','includes','findOne','sendMessage','log','300329bkwZiz','remoteJid','REDIS_URI','createClient','4095077JwtTHM','../../models/User','assistant','getBodyMessage','124mqfWaN'];a549_0x5b9a=function(){return _0x4b8157;};return a549_0x5b9a();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x51d955){return _0x51d955&&_0x51d955['__esModule']?_0x51d955:{'default':_0x51d955};};Object[a549_0x2b90ac(0x1b4)](exports,'__esModule',{'value':!![]}),exports[a549_0x2b90ac(0x19d)]=exports['ResponseProxy']=exports[a549_0x2b90ac(0x17a)]=exports[a549_0x2b90ac(0x185)]=void 0x0;const Ticket_1=__importDefault(require(a549_0x2b90ac(0x197))),User_1=__importDefault(require(a549_0x2b90ac(0x1b0))),redis_1=require(a549_0x2b90ac(0x182)),Contact_1=__importDefault(require(a549_0x2b90ac(0x1a1))),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),wbotMessageListener_1=require('../WbotServices/wbotMessageListener'),ShowTicketService_1=__importDefault(require(a549_0x2b90ac(0x199))),Queue_1=__importDefault(require(a549_0x2b90ac(0x178))),CheckConnection=async({waid:_0x45cb38,code:_0xfe11b7,companyId:_0x3a8413,wbot:_0x5adf8e})=>{const _0x109de4=a549_0x2b90ac,_0x2d7e58=await User_1[_0x109de4(0x196)][_0x109de4(0x1a8)]({'where':{'waid':_0x45cb38,'companyId':_0x3a8413},'include':[{'model':Queue_1['default']}]});if(!_0x2d7e58)return![];const _0xe10fbd=await Ticket_1[_0x109de4(0x196)][_0x109de4(0x1a8)]({'where':{'iCode':_0xfe11b7,'companyId':_0x3a8413,'status':'pending'},'include':[{'model':Contact_1['default']},{'model':Queue_1[_0x109de4(0x196)]}]});if(!_0xe10fbd)return await _0x5adf8e[_0x109de4(0x1a9)](_0x45cb38+_0x109de4(0x1a4),{'text':_0x109de4(0x18d)}),!![];const _0x4a6a6f=_0x2d7e58['queues'][_0x109de4(0x18a)](_0xc51c7d=>_0xc51c7d['id']),_0x3c13d4=_0xe10fbd?.[_0x109de4(0x18b)];if(_0x3c13d4){if(!_0x4a6a6f[_0x109de4(0x1a7)](_0x3c13d4))return console[_0x109de4(0x1aa)](_0x109de4(0x1a2)),await _0x5adf8e['sendMessage'](_0x45cb38+'@s.whatsapp.net',{'text':_0x109de4(0x1b5)}),!![];}else{if(_0xe10fbd[_0x109de4(0x1a5)]!==_0x2d7e58['id'])return console['log'](_0x109de4(0x174)),await _0x5adf8e[_0x109de4(0x1a9)](_0x45cb38+_0x109de4(0x1a4),{'text':'Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.'}),!![];}if(_0xe10fbd['contact'][_0x109de4(0x181)]===_0x45cb38)return await _0x5adf8e[_0x109de4(0x1a9)](_0x45cb38+_0x109de4(0x1a4),{'text':_0x109de4(0x1a6)}),!![];const _0x328f8e=(0x0,redis_1[_0x109de4(0x1ae)])({'url':process['env'][_0x109de4(0x1ad)]});await _0x328f8e['connect']();let _0x316389={'type':_0x109de4(0x19e),'ticketId':_0xe10fbd['id'],'userId':_0x2d7e58['id'],'number':_0x45cb38,'companyId':_0x3a8413};await _0x328f8e['set'](_0xe10fbd['contact'][_0x109de4(0x181)],JSON['stringify'](_0x316389),{'EX':0x15180}),_0x316389={'type':_0x109de4(0x1b1),'ticketId':_0xe10fbd['id'],'number':_0xe10fbd[_0x109de4(0x1a0)][_0x109de4(0x181)],'userId':_0x2d7e58['id'],'companyId':_0x3a8413},await _0x328f8e[_0x109de4(0x18f)](_0x45cb38,JSON[_0x109de4(0x19a)](_0x316389),{'EX':0x15180}),await _0x328f8e[_0x109de4(0x191)]();const _0x1ba82c=await(0x0,UpdateTicketService_1[_0x109de4(0x196)])({'ticketData':{'status':_0x109de4(0x194),'userId':_0x2d7e58['id']},'ticketId':_0xe10fbd['id'],'companyId':_0x3a8413});return await _0x5adf8e[_0x109de4(0x1a9)](_0x45cb38+'@s.whatsapp.net',{'text':'Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair'}),!![];};function a549_0x1b37(_0xd25426,_0x4c9651){const _0x513bdb=a549_0x5b9a();return a549_0x1b37=function(_0x142b9f,_0x5ea8f0){_0x142b9f=_0x142b9f-0x173;let _0x5b9ae2=_0x513bdb[_0x142b9f];return _0x5b9ae2;},a549_0x1b37(_0xd25426,_0x4c9651);}exports['CheckConnection']=CheckConnection;const Disconnect=async({msg:_0x448ca9,companyId:_0xa4d300,wbot:_0x34f1d3})=>{const _0x39784d=a549_0x2b90ac;let _0x587d1a=![];const _0x132a7b=(0x0,redis_1[_0x39784d(0x1ae)])({'url':process[_0x39784d(0x173)]['REDIS_URI']});await _0x132a7b[_0x39784d(0x17e)]();const _0x3e2aed=_0x448ca9['key'][_0x39784d(0x1ac)][_0x39784d(0x176)](_0x39784d(0x1a4),''),_0x36e96e=await _0x132a7b[_0x39784d(0x177)](_0x3e2aed);if(_0x36e96e){const _0xf4a6a7=JSON[_0x39784d(0x189)](_0x36e96e);if(_0xf4a6a7[_0x39784d(0x18e)]=='assistant'&&_0xf4a6a7[_0x39784d(0x19f)]==_0xa4d300){const _0x558dfc=await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x39784d(0x184),'userId':_0xf4a6a7[_0x39784d(0x1a5)]},'ticketId':_0xf4a6a7[_0x39784d(0x1a3)],'companyId':_0xa4d300});await _0x132a7b['del'](_0x3e2aed),await _0x132a7b['del'](_0xf4a6a7['number']),await _0x34f1d3[_0x39784d(0x1a9)](_0x3e2aed+_0x39784d(0x1a4),{'text':_0x39784d(0x17f)}),_0x587d1a=!![];}}return _0x132a7b[_0x39784d(0x191)](),_0x587d1a;};exports[a549_0x2b90ac(0x17a)]=Disconnect;const ResponseProxy=async({msg:_0x24c8ff,companyId:_0x4dc03d,wbot:_0x5d57d7})=>{const _0x27d8e6=a549_0x2b90ac,_0x5969d2=(0x0,wbotMessageListener_1[_0x27d8e6(0x1b2)])(_0x24c8ff),_0x48ccba=_0x24c8ff['key'][_0x27d8e6(0x1ac)][_0x27d8e6(0x176)](_0x27d8e6(0x1a4),'');if(_0x24c8ff[_0x27d8e6(0x188)]['fromMe'])return![];const _0x282f5a=(0x0,redis_1[_0x27d8e6(0x1ae)])({'url':process[_0x27d8e6(0x173)][_0x27d8e6(0x1ad)]});await _0x282f5a[_0x27d8e6(0x17e)]();const _0x2d99a1=await _0x282f5a[_0x27d8e6(0x177)](_0x48ccba);if(!_0x2d99a1)return![];const _0x1ff879=JSON[_0x27d8e6(0x189)](_0x2d99a1);if(_0x1ff879[_0x27d8e6(0x18e)]!==_0x27d8e6(0x1b1))return![];if(_0x5969d2['toLowerCase']()==='sair'){const _0x1e1e52=await(0x0,exports['Disconnect'])({'msg':_0x24c8ff,'companyId':_0x4dc03d,'wbot':_0x5d57d7});if(_0x1e1e52)return;}if(_0x5969d2[_0x27d8e6(0x192)]()==_0x27d8e6(0x193)){}const _0xae0ab4=await(0x0,ShowTicketService_1[_0x27d8e6(0x196)])(_0x1ff879['ticketId'],_0x4dc03d);let _0x284ec3={'id':_0x24c8ff[_0x27d8e6(0x188)]['id'],'ticketId':_0x1ff879[_0x27d8e6(0x1a3)],'body':_0x5969d2,'contactId':_0xae0ab4[_0x27d8e6(0x19c)],'fromMe':!![],'read':!![]};return await _0x5d57d7['sendMessage'](_0x1ff879['number']+'@s.whatsapp.net',{'forward':_0x24c8ff}),!![];};exports[a549_0x2b90ac(0x17b)]=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x93f9ca,companyId:_0x5f1555,wbot:_0x59cf29,body:_0x243b13})=>{const _0x57ffe3=a549_0x2b90ac;if(_0x93f9ca[_0x57ffe3(0x188)][_0x57ffe3(0x183)])return![];const _0x27c803=_0x93f9ca[_0x57ffe3(0x188)]['remoteJid']['replace'](_0x57ffe3(0x1a4),''),_0x4a3fdc=(0x0,redis_1['createClient'])({'url':process['env'][_0x57ffe3(0x1ad)]});await _0x4a3fdc[_0x57ffe3(0x17e)]();const _0x56500b=await _0x4a3fdc[_0x57ffe3(0x177)](_0x27c803);if(!_0x56500b)return![];const _0xea5c1d=JSON[_0x57ffe3(0x189)](_0x56500b);if(_0xea5c1d[_0x57ffe3(0x18e)]!='user'||_0xea5c1d['companyId']!=_0x5f1555)return![];return await _0x59cf29[_0x57ffe3(0x1a9)](_0xea5c1d[_0x57ffe3(0x181)]+_0x57ffe3(0x1a4),{'forward':_0x93f9ca}),!![];};exports[a549_0x2b90ac(0x19d)]=SendMessageConnectedStaffMember;