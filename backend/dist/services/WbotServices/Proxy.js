const a547_0x425bc8=a547_0x4d2e;(function(_0x3ec8ad,_0x4a0ecd){const _0x30b457=a547_0x4d2e,_0x4d0aff=_0x3ec8ad();while(!![]){try{const _0x53cbdc=parseInt(_0x30b457(0x1df))/0x1*(-parseInt(_0x30b457(0x205))/0x2)+-parseInt(_0x30b457(0x20c))/0x3*(parseInt(_0x30b457(0x1ed))/0x4)+-parseInt(_0x30b457(0x214))/0x5+parseInt(_0x30b457(0x1e5))/0x6*(parseInt(_0x30b457(0x1dd))/0x7)+-parseInt(_0x30b457(0x1fb))/0x8*(parseInt(_0x30b457(0x1fd))/0x9)+parseInt(_0x30b457(0x1fe))/0xa+parseInt(_0x30b457(0x1de))/0xb*(parseInt(_0x30b457(0x20d))/0xc);if(_0x53cbdc===_0x4a0ecd)break;else _0x4d0aff['push'](_0x4d0aff['shift']());}catch(_0x12b571){_0x4d0aff['push'](_0x4d0aff['shift']());}}}(a547_0x490a,0x864ae));function a547_0x490a(){const _0x46a3a6=['../../models/User','154566cabjLk','2288400iEFtol','number','toLowerCase','(((.+)+)+)+$','__esModule','del','audio','15576sUyrYP','remoteJid','../../models/Contact','redis','user','set','../TicketServices/ShowTicketService','298155EWDWRW','12xsbHTN','parse','Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!','../WbotServices/wbotMessageListener','sendMessage','search','contactId','5148045WQrGZh','assistant','ResponseProxy','__importDefault','apply','constructor','getBodyMessage','REDIS_URI','../../models/Ticket','type','queueId','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','log','companyId','disconnect','sair','../../models/Queue','Desconectado\x20com\x20sucesso','key','7BEIsVz','22465553dAHHdr','97AamUxK','queues','includes','O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.','userId','closed','4770648zzpfUm','createClient','CheckConnection','map','@s.whatsapp.net','connect','defineProperty','replace','8iiXvEq','default','Disconnect','stringify','findOne','pending','ticketId','../TicketServices/UpdateTicketService','contact','env','toString','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','get','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','248LNqwTH'];a547_0x490a=function(){return _0x46a3a6;};return a547_0x490a();}const a547_0x531cfc=(function(){let _0x2dbaaa=!![];return function(_0x314952,_0x3045d7){const _0x179fdf=_0x2dbaaa?function(){const _0x4ccaf8=a547_0x4d2e;if(_0x3045d7){const _0x1ab828=_0x3045d7[_0x4ccaf8(0x218)](_0x314952,arguments);return _0x3045d7=null,_0x1ab828;}}:function(){};return _0x2dbaaa=![],_0x179fdf;};}()),a547_0x4e048f=a547_0x531cfc(this,function(){const _0x3462bc=a547_0x4d2e;return a547_0x4e048f[_0x3462bc(0x1f7)]()[_0x3462bc(0x212)](_0x3462bc(0x201))[_0x3462bc(0x1f7)]()[_0x3462bc(0x219)](a547_0x4e048f)[_0x3462bc(0x212)](_0x3462bc(0x201));});a547_0x4e048f();function a547_0x4d2e(_0x4f2f10,_0x26bc21){const _0xb995e5=a547_0x490a();return a547_0x4d2e=function(_0x4e048f,_0x531cfc){_0x4e048f=_0x4e048f-0x1d0;let _0x490a85=_0xb995e5[_0x4e048f];return _0x490a85;},a547_0x4d2e(_0x4f2f10,_0x26bc21);}'use strict';var __importDefault=this&&this[a547_0x425bc8(0x217)]||function(_0x247cbb){const _0x11b447=a547_0x425bc8;return _0x247cbb&&_0x247cbb[_0x11b447(0x202)]?_0x247cbb:{'default':_0x247cbb};};Object[a547_0x425bc8(0x1eb)](exports,a547_0x425bc8(0x202),{'value':!![]}),exports['SendMessageConnectedStaffMember']=exports[a547_0x425bc8(0x216)]=exports['Disconnect']=exports[a547_0x425bc8(0x1e7)]=void 0x0;const Ticket_1=__importDefault(require(a547_0x425bc8(0x1d2))),User_1=__importDefault(require(a547_0x425bc8(0x1fc))),redis_1=require(a547_0x425bc8(0x208)),Contact_1=__importDefault(require(a547_0x425bc8(0x207))),UpdateTicketService_1=__importDefault(require(a547_0x425bc8(0x1f4))),wbotMessageListener_1=require(a547_0x425bc8(0x210)),ShowTicketService_1=__importDefault(require(a547_0x425bc8(0x20b))),Queue_1=__importDefault(require(a547_0x425bc8(0x1da))),CheckConnection=async({waid:_0x3800de,code:_0x128a7b,companyId:_0x5d303b,wbot:_0x160077})=>{const _0x27eb35=a547_0x425bc8,_0x370600=await User_1[_0x27eb35(0x1ee)][_0x27eb35(0x1f1)]({'where':{'waid':_0x3800de,'companyId':_0x5d303b},'include':[{'model':Queue_1['default']}]});if(!_0x370600)return![];const _0x57ca79=await Ticket_1[_0x27eb35(0x1ee)][_0x27eb35(0x1f1)]({'where':{'iCode':_0x128a7b,'companyId':_0x5d303b,'status':_0x27eb35(0x1f2)},'include':[{'model':Contact_1[_0x27eb35(0x1ee)]},{'model':Queue_1[_0x27eb35(0x1ee)]}]});if(!_0x57ca79)return await _0x160077['sendMessage'](_0x3800de+_0x27eb35(0x1e9),{'text':_0x27eb35(0x20f)}),!![];const _0x1ffe59=_0x370600[_0x27eb35(0x1e0)][_0x27eb35(0x1e8)](_0x3695e1=>_0x3695e1['id']),_0x42bb29=_0x57ca79?.[_0x27eb35(0x1d4)];if(_0x42bb29){if(!_0x1ffe59[_0x27eb35(0x1e1)](_0x42bb29))return console['log'](_0x27eb35(0x1fa)),await _0x160077[_0x27eb35(0x211)](_0x3800de+'@s.whatsapp.net',{'text':_0x27eb35(0x1f8)}),!![];}else{if(_0x57ca79['userId']!==_0x370600['id'])return console[_0x27eb35(0x1d6)](_0x27eb35(0x1e2)),await _0x160077[_0x27eb35(0x211)](_0x3800de+_0x27eb35(0x1e9),{'text':'Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.'}),!![];}if(_0x57ca79[_0x27eb35(0x1f5)]['number']===_0x3800de)return await _0x160077[_0x27eb35(0x211)](_0x3800de+_0x27eb35(0x1e9),{'text':_0x27eb35(0x1d5)}),!![];const _0x5948f1=(0x0,redis_1[_0x27eb35(0x1e6)])({'url':process[_0x27eb35(0x1f6)][_0x27eb35(0x1d1)]});await _0x5948f1['connect']();let _0x57aebf={'type':_0x27eb35(0x209),'ticketId':_0x57ca79['id'],'userId':_0x370600['id'],'number':_0x3800de,'companyId':_0x5d303b};await _0x5948f1['set'](_0x57ca79[_0x27eb35(0x1f5)][_0x27eb35(0x1ff)],JSON[_0x27eb35(0x1f0)](_0x57aebf),{'EX':0x15180}),_0x57aebf={'type':_0x27eb35(0x215),'ticketId':_0x57ca79['id'],'number':_0x57ca79[_0x27eb35(0x1f5)][_0x27eb35(0x1ff)],'userId':_0x370600['id'],'companyId':_0x5d303b},await _0x5948f1[_0x27eb35(0x20a)](_0x3800de,JSON[_0x27eb35(0x1f0)](_0x57aebf),{'EX':0x15180}),await _0x5948f1['disconnect']();const _0x43f21f=await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':'open','userId':_0x370600['id']},'ticketId':_0x57ca79['id'],'companyId':_0x5d303b});return await _0x160077[_0x27eb35(0x211)](_0x3800de+'@s.whatsapp.net',{'text':'Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair'}),!![];};exports['CheckConnection']=CheckConnection;const Disconnect=async({msg:_0x542b4f,companyId:_0x4a469a,wbot:_0x4022c4})=>{const _0x1c9c8c=a547_0x425bc8;let _0x30dddf=![];const _0x184288=(0x0,redis_1[_0x1c9c8c(0x1e6)])({'url':process[_0x1c9c8c(0x1f6)][_0x1c9c8c(0x1d1)]});await _0x184288[_0x1c9c8c(0x1ea)]();const _0x2cd2cc=_0x542b4f[_0x1c9c8c(0x1dc)][_0x1c9c8c(0x206)][_0x1c9c8c(0x1ec)](_0x1c9c8c(0x1e9),''),_0x46f335=await _0x184288[_0x1c9c8c(0x1f9)](_0x2cd2cc);if(_0x46f335){const _0x26e594=JSON[_0x1c9c8c(0x20e)](_0x46f335);if(_0x26e594[_0x1c9c8c(0x1d3)]==_0x1c9c8c(0x215)&&_0x26e594[_0x1c9c8c(0x1d7)]==_0x4a469a){const _0x3ffdf1=await(0x0,UpdateTicketService_1[_0x1c9c8c(0x1ee)])({'ticketData':{'status':_0x1c9c8c(0x1e4),'userId':_0x26e594[_0x1c9c8c(0x1e3)]},'ticketId':_0x26e594[_0x1c9c8c(0x1f3)],'companyId':_0x4a469a});await _0x184288[_0x1c9c8c(0x203)](_0x2cd2cc),await _0x184288[_0x1c9c8c(0x203)](_0x26e594['number']),await _0x4022c4[_0x1c9c8c(0x211)](_0x2cd2cc+_0x1c9c8c(0x1e9),{'text':_0x1c9c8c(0x1db)}),_0x30dddf=!![];}}return _0x184288[_0x1c9c8c(0x1d8)](),_0x30dddf;};exports[a547_0x425bc8(0x1ef)]=Disconnect;const ResponseProxy=async({msg:_0x365b5f,companyId:_0x3a2875,wbot:_0x1d3296})=>{const _0x49306e=a547_0x425bc8,_0x4b430f=(0x0,wbotMessageListener_1[_0x49306e(0x1d0)])(_0x365b5f),_0x425365=_0x365b5f['key'][_0x49306e(0x206)]['replace'](_0x49306e(0x1e9),'');if(_0x365b5f[_0x49306e(0x1dc)]['fromMe'])return![];const _0x97904f=(0x0,redis_1['createClient'])({'url':process['env'][_0x49306e(0x1d1)]});await _0x97904f[_0x49306e(0x1ea)]();const _0x156059=await _0x97904f[_0x49306e(0x1f9)](_0x425365);if(!_0x156059)return![];const _0x525baf=JSON['parse'](_0x156059);if(_0x525baf['type']!==_0x49306e(0x215))return![];if(_0x4b430f['toLowerCase']()===_0x49306e(0x1d9)){const _0x10b34b=await(0x0,exports[_0x49306e(0x1ef)])({'msg':_0x365b5f,'companyId':_0x3a2875,'wbot':_0x1d3296});if(_0x10b34b)return;}if(_0x4b430f[_0x49306e(0x200)]()==_0x49306e(0x204)){}const _0x4d06bc=await(0x0,ShowTicketService_1[_0x49306e(0x1ee)])(_0x525baf['ticketId'],_0x3a2875);let _0x426f2d={'id':_0x365b5f['key']['id'],'ticketId':_0x525baf['ticketId'],'body':_0x4b430f,'contactId':_0x4d06bc[_0x49306e(0x213)],'fromMe':!![],'read':!![]};return await _0x1d3296[_0x49306e(0x211)](_0x525baf['number']+_0x49306e(0x1e9),{'forward':_0x365b5f}),!![];};exports[a547_0x425bc8(0x216)]=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x1ae3cc,companyId:_0x4a062d,wbot:_0x3fcb31,body:_0x93b05b})=>{const _0x17e552=a547_0x425bc8;if(_0x1ae3cc[_0x17e552(0x1dc)]['fromMe'])return![];const _0x379821=_0x1ae3cc[_0x17e552(0x1dc)][_0x17e552(0x206)][_0x17e552(0x1ec)]('@s.whatsapp.net',''),_0x37be1d=(0x0,redis_1['createClient'])({'url':process['env'][_0x17e552(0x1d1)]});await _0x37be1d[_0x17e552(0x1ea)]();const _0x4821c8=await _0x37be1d[_0x17e552(0x1f9)](_0x379821);if(!_0x4821c8)return![];const _0x4bbc9e=JSON[_0x17e552(0x20e)](_0x4821c8);if(_0x4bbc9e[_0x17e552(0x1d3)]!=_0x17e552(0x209)||_0x4bbc9e[_0x17e552(0x1d7)]!=_0x4a062d)return![];return await _0x3fcb31['sendMessage'](_0x4bbc9e[_0x17e552(0x1ff)]+_0x17e552(0x1e9),{'forward':_0x1ae3cc}),!![];};exports['SendMessageConnectedStaffMember']=SendMessageConnectedStaffMember;