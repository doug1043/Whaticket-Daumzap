const a547_0x41852f=a547_0xb243;(function(_0x3aa7fe,_0x4ec326){const _0x480351=a547_0xb243,_0x182755=_0x3aa7fe();while(!![]){try{const _0x16d4d4=parseInt(_0x480351(0x188))/0x1+-parseInt(_0x480351(0x19a))/0x2*(-parseInt(_0x480351(0x17b))/0x3)+-parseInt(_0x480351(0x17c))/0x4+parseInt(_0x480351(0x17e))/0x5*(parseInt(_0x480351(0x189))/0x6)+parseInt(_0x480351(0x178))/0x7*(parseInt(_0x480351(0x161))/0x8)+parseInt(_0x480351(0x16f))/0x9*(-parseInt(_0x480351(0x17a))/0xa)+-parseInt(_0x480351(0x164))/0xb*(parseInt(_0x480351(0x197))/0xc);if(_0x16d4d4===_0x4ec326)break;else _0x182755['push'](_0x182755['shift']());}catch(_0x357370){_0x182755['push'](_0x182755['shift']());}}}(a547_0xa5e9,0xa5050));const a547_0x1fad52=(function(){let _0x41564c=!![];return function(_0x14f1cd,_0x16df3c){const _0x3954d5=_0x41564c?function(){if(_0x16df3c){const _0x3dc133=_0x16df3c['apply'](_0x14f1cd,arguments);return _0x16df3c=null,_0x3dc133;}}:function(){};return _0x41564c=![],_0x3954d5;};}()),a547_0x2d880b=a547_0x1fad52(this,function(){const _0x5daf80=a547_0xb243;return a547_0x2d880b[_0x5daf80(0x191)]()[_0x5daf80(0x169)](_0x5daf80(0x193))[_0x5daf80(0x191)]()[_0x5daf80(0x194)](a547_0x2d880b)[_0x5daf80(0x169)](_0x5daf80(0x193));});a547_0x2d880b();'use strict';function a547_0xa5e9(){const _0x3c415a=['log','userId','ResponseProxy','__importDefault','CheckConnection','Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!','7Qtered','defineProperty','10IIGrPg','6wRIPwp','4629524BLuwpH','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','5MXMGoS','remoteJid','redis','findOne','replace','type','parse','Desconectado\x20com\x20sucesso','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','contactId','658984jtRGiK','1024206uVuWvB','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','../TicketServices/ShowTicketService','queueId','number','@s.whatsapp.net','get','toString','default','(((.+)+)+)+$','constructor','disconnect','SendMessageConnectedStaffMember','732aPmETx','Disconnect','ticketId','892232oqLcAV','contact','../TicketServices/UpdateTicketService','set','REDIS_URI','assistant','companyId','audio','../../models/User','8423672UzwFms','sendMessage','queues','18931sRvbjF','connect','fromMe','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','createClient','search','pending','includes','env','key','../WbotServices/wbotMessageListener','7529346RHkNgg','user','stringify'];a547_0xa5e9=function(){return _0x3c415a;};return a547_0xa5e9();}var __importDefault=this&&this[a547_0x41852f(0x175)]||function(_0x469af0){return _0x469af0&&_0x469af0['__esModule']?_0x469af0:{'default':_0x469af0};};Object[a547_0x41852f(0x179)](exports,'__esModule',{'value':!![]}),exports[a547_0x41852f(0x196)]=exports['ResponseProxy']=exports[a547_0x41852f(0x198)]=exports[a547_0x41852f(0x176)]=void 0x0;const Ticket_1=__importDefault(require('../../models/Ticket')),User_1=__importDefault(require(a547_0x41852f(0x160))),redis_1=require(a547_0x41852f(0x180)),Contact_1=__importDefault(require('../../models/Contact')),UpdateTicketService_1=__importDefault(require(a547_0x41852f(0x19c))),wbotMessageListener_1=require(a547_0x41852f(0x16e)),ShowTicketService_1=__importDefault(require(a547_0x41852f(0x18c))),Queue_1=__importDefault(require('../../models/Queue')),CheckConnection=async({waid:_0x406f95,code:_0x20b1c0,companyId:_0x5ad326,wbot:_0x5c1292})=>{const _0x2b32d9=a547_0x41852f,_0xd84f90=await User_1[_0x2b32d9(0x192)][_0x2b32d9(0x181)]({'where':{'waid':_0x406f95,'companyId':_0x5ad326},'include':[{'model':Queue_1[_0x2b32d9(0x192)]}]});if(!_0xd84f90)return![];const _0x4e9172=await Ticket_1['default']['findOne']({'where':{'iCode':_0x20b1c0,'companyId':_0x5ad326,'status':_0x2b32d9(0x16a)},'include':[{'model':Contact_1[_0x2b32d9(0x192)]},{'model':Queue_1[_0x2b32d9(0x192)]}]});if(!_0x4e9172)return await _0x5c1292[_0x2b32d9(0x162)](_0x406f95+_0x2b32d9(0x18f),{'text':_0x2b32d9(0x177)}),!![];const _0x148970=_0xd84f90[_0x2b32d9(0x163)]['map'](_0x21bc71=>_0x21bc71['id']),_0x52db08=_0x4e9172?.[_0x2b32d9(0x18d)];if(_0x52db08){if(!_0x148970[_0x2b32d9(0x16b)](_0x52db08))return console[_0x2b32d9(0x172)](_0x2b32d9(0x18b)),await _0x5c1292[_0x2b32d9(0x162)](_0x406f95+_0x2b32d9(0x18f),{'text':_0x2b32d9(0x186)}),!![];}else{if(_0x4e9172[_0x2b32d9(0x173)]!==_0xd84f90['id'])return console['log']('O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.'),await _0x5c1292['sendMessage'](_0x406f95+'@s.whatsapp.net',{'text':_0x2b32d9(0x18a)}),!![];}if(_0x4e9172['contact'][_0x2b32d9(0x18e)]===_0x406f95)return await _0x5c1292[_0x2b32d9(0x162)](_0x406f95+'@s.whatsapp.net',{'text':_0x2b32d9(0x167)}),!![];const _0x4fc89b=(0x0,redis_1[_0x2b32d9(0x168)])({'url':process[_0x2b32d9(0x16c)]['REDIS_URI']});await _0x4fc89b[_0x2b32d9(0x165)]();let _0x377ab5={'type':_0x2b32d9(0x170),'ticketId':_0x4e9172['id'],'userId':_0xd84f90['id'],'number':_0x406f95,'companyId':_0x5ad326};await _0x4fc89b[_0x2b32d9(0x19d)](_0x4e9172[_0x2b32d9(0x19b)][_0x2b32d9(0x18e)],JSON['stringify'](_0x377ab5),{'EX':0x15180}),_0x377ab5={'type':_0x2b32d9(0x19f),'ticketId':_0x4e9172['id'],'number':_0x4e9172[_0x2b32d9(0x19b)][_0x2b32d9(0x18e)],'userId':_0xd84f90['id'],'companyId':_0x5ad326},await _0x4fc89b['set'](_0x406f95,JSON[_0x2b32d9(0x171)](_0x377ab5),{'EX':0x15180}),await _0x4fc89b[_0x2b32d9(0x195)]();const _0x5043bd=await(0x0,UpdateTicketService_1[_0x2b32d9(0x192)])({'ticketData':{'status':'open','userId':_0xd84f90['id']},'ticketId':_0x4e9172['id'],'companyId':_0x5ad326});return await _0x5c1292[_0x2b32d9(0x162)](_0x406f95+_0x2b32d9(0x18f),{'text':_0x2b32d9(0x17d)}),!![];};exports[a547_0x41852f(0x176)]=CheckConnection;const Disconnect=async({msg:_0xb2f7a5,companyId:_0x4d8914,wbot:_0x1bcac9})=>{const _0x55d70f=a547_0x41852f;let _0x44e458=![];const _0x1805b3=(0x0,redis_1[_0x55d70f(0x168)])({'url':process[_0x55d70f(0x16c)][_0x55d70f(0x19e)]});await _0x1805b3[_0x55d70f(0x165)]();const _0x3b31d4=_0xb2f7a5[_0x55d70f(0x16d)][_0x55d70f(0x17f)][_0x55d70f(0x182)]('@s.whatsapp.net',''),_0x925268=await _0x1805b3[_0x55d70f(0x190)](_0x3b31d4);if(_0x925268){const _0x1f91e0=JSON['parse'](_0x925268);if(_0x1f91e0['type']==_0x55d70f(0x19f)&&_0x1f91e0[_0x55d70f(0x1a0)]==_0x4d8914){const _0x478879=await(0x0,UpdateTicketService_1[_0x55d70f(0x192)])({'ticketData':{'status':'closed','userId':_0x1f91e0[_0x55d70f(0x173)]},'ticketId':_0x1f91e0[_0x55d70f(0x199)],'companyId':_0x4d8914});await _0x1805b3['del'](_0x3b31d4),await _0x1805b3['del'](_0x1f91e0[_0x55d70f(0x18e)]),await _0x1bcac9[_0x55d70f(0x162)](_0x3b31d4+_0x55d70f(0x18f),{'text':_0x55d70f(0x185)}),_0x44e458=!![];}}return _0x1805b3[_0x55d70f(0x195)](),_0x44e458;};exports[a547_0x41852f(0x198)]=Disconnect;const ResponseProxy=async({msg:_0xe8c0d7,companyId:_0x4de6b7,wbot:_0x7f3904})=>{const _0x5f4017=a547_0x41852f,_0x5c140b=(0x0,wbotMessageListener_1['getBodyMessage'])(_0xe8c0d7),_0x31eeb3=_0xe8c0d7[_0x5f4017(0x16d)][_0x5f4017(0x17f)][_0x5f4017(0x182)](_0x5f4017(0x18f),'');if(_0xe8c0d7['key'][_0x5f4017(0x166)])return![];const _0x306543=(0x0,redis_1[_0x5f4017(0x168)])({'url':process[_0x5f4017(0x16c)]['REDIS_URI']});await _0x306543[_0x5f4017(0x165)]();const _0x77ffce=await _0x306543['get'](_0x31eeb3);if(!_0x77ffce)return![];const _0x67ce38=JSON[_0x5f4017(0x184)](_0x77ffce);if(_0x67ce38[_0x5f4017(0x183)]!=='assistant')return![];if(_0x5c140b['toLowerCase']()==='sair'){const _0x5ef171=await(0x0,exports[_0x5f4017(0x198)])({'msg':_0xe8c0d7,'companyId':_0x4de6b7,'wbot':_0x7f3904});if(_0x5ef171)return;}if(_0x5c140b['toLowerCase']()==_0x5f4017(0x15f)){}const _0x1ccff2=await(0x0,ShowTicketService_1[_0x5f4017(0x192)])(_0x67ce38[_0x5f4017(0x199)],_0x4de6b7);let _0x45efc4={'id':_0xe8c0d7[_0x5f4017(0x16d)]['id'],'ticketId':_0x67ce38[_0x5f4017(0x199)],'body':_0x5c140b,'contactId':_0x1ccff2[_0x5f4017(0x187)],'fromMe':!![],'read':!![]};return await _0x7f3904['sendMessage'](_0x67ce38[_0x5f4017(0x18e)]+_0x5f4017(0x18f),{'forward':_0xe8c0d7}),!![];};exports[a547_0x41852f(0x174)]=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x2e2c2f,companyId:_0x539723,wbot:_0x31edf9,body:_0x39ac05})=>{const _0x4f3556=a547_0x41852f;if(_0x2e2c2f[_0x4f3556(0x16d)][_0x4f3556(0x166)])return![];const _0x2258da=_0x2e2c2f['key'][_0x4f3556(0x17f)]['replace'](_0x4f3556(0x18f),''),_0x5289ef=(0x0,redis_1['createClient'])({'url':process[_0x4f3556(0x16c)]['REDIS_URI']});await _0x5289ef['connect']();const _0x54bf6d=await _0x5289ef['get'](_0x2258da);if(!_0x54bf6d)return![];const _0x2a72c5=JSON[_0x4f3556(0x184)](_0x54bf6d);if(_0x2a72c5[_0x4f3556(0x183)]!=_0x4f3556(0x170)||_0x2a72c5['companyId']!=_0x539723)return![];return await _0x31edf9['sendMessage'](_0x2a72c5['number']+_0x4f3556(0x18f),{'forward':_0x2e2c2f}),!![];};function a547_0xb243(_0x510ba2,_0x49b62e){const _0x2db08f=a547_0xa5e9();return a547_0xb243=function(_0x2d880b,_0x1fad52){_0x2d880b=_0x2d880b-0x15f;let _0xa5e908=_0x2db08f[_0x2d880b];return _0xa5e908;},a547_0xb243(_0x510ba2,_0x49b62e);}exports[a547_0x41852f(0x196)]=SendMessageConnectedStaffMember;