const a547_0x5a4032=a547_0x257a;(function(_0x4399ec,_0x59ec6d){const _0x241aad=a547_0x257a,_0x1d8918=_0x4399ec();while(!![]){try{const _0x1dd086=-parseInt(_0x241aad(0x1df))/0x1*(-parseInt(_0x241aad(0x1c1))/0x2)+-parseInt(_0x241aad(0x1ba))/0x3+-parseInt(_0x241aad(0x1e7))/0x4+-parseInt(_0x241aad(0x1cc))/0x5*(-parseInt(_0x241aad(0x1da))/0x6)+parseInt(_0x241aad(0x1cf))/0x7+parseInt(_0x241aad(0x1c7))/0x8+parseInt(_0x241aad(0x1db))/0x9*(parseInt(_0x241aad(0x1dc))/0xa);if(_0x1dd086===_0x59ec6d)break;else _0x1d8918['push'](_0x1d8918['shift']());}catch(_0x5a293e){_0x1d8918['push'](_0x1d8918['shift']());}}}(a547_0x3f2a,0xac72c));function a547_0x257a(_0x1a4a8d,_0xdf4678){const _0x2422dd=a547_0x3f2a();return a547_0x257a=function(_0x23f3b7,_0x18bcbc){_0x23f3b7=_0x23f3b7-0x1ba;let _0x3f2aa3=_0x2422dd[_0x23f3b7];return _0x3f2aa3;},a547_0x257a(_0x1a4a8d,_0xdf4678);}const a547_0x18bcbc=(function(){let _0x4b3802=!![];return function(_0x23a066,_0x53a528){const _0x205e24=_0x4b3802?function(){const _0x221f92=a547_0x257a;if(_0x53a528){const _0x29cde4=_0x53a528[_0x221f92(0x1fd)](_0x23a066,arguments);return _0x53a528=null,_0x29cde4;}}:function(){};return _0x4b3802=![],_0x205e24;};}()),a547_0x23f3b7=a547_0x18bcbc(this,function(){const _0x1b2273=a547_0x257a;return a547_0x23f3b7[_0x1b2273(0x1c3)]()[_0x1b2273(0x1dd)]('(((.+)+)+)+$')[_0x1b2273(0x1c3)]()[_0x1b2273(0x1bf)](a547_0x23f3b7)[_0x1b2273(0x1dd)](_0x1b2273(0x1d7));});function a547_0x3f2a(){const _0x49e4c4=['parse','toLowerCase','createClient','del','log','map','findOne','../../models/User','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','fromMe','disconnect','closed','apply','4141464AGqSqO','../TicketServices/ShowTicketService','ResponseProxy','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','CheckConnection','constructor','defineProperty','2GHNOxU','../../models/Contact','toString','key','queues','../../models/Ticket','4690544mxHqde','getBodyMessage','stringify','connect','contact','19040dXwfEh','ticketId','@s.whatsapp.net','3994270JedekC','replace','user','includes','env','companyId','__esModule','open','(((.+)+)+)+$','number','queueId','1206aCtkdd','18lyOjyU','3510380QacnJR','search','get','204669lqIxhB','SendMessageConnectedStaffMember','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','__importDefault','../../models/Queue','default','REDIS_URI','Desconectado\x20com\x20sucesso','2968980oJvUXm','Disconnect','set','assistant','remoteJid','userId','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','sendMessage','redis'];a547_0x3f2a=function(){return _0x49e4c4;};return a547_0x3f2a();}a547_0x23f3b7();'use strict';var __importDefault=this&&this[a547_0x5a4032(0x1e2)]||function(_0x3351e3){const _0x4b3a64=a547_0x5a4032;return _0x3351e3&&_0x3351e3[_0x4b3a64(0x1d5)]?_0x3351e3:{'default':_0x3351e3};};Object[a547_0x5a4032(0x1c0)](exports,a547_0x5a4032(0x1d5),{'value':!![]}),exports[a547_0x5a4032(0x1e0)]=exports['ResponseProxy']=exports[a547_0x5a4032(0x1e8)]=exports[a547_0x5a4032(0x1be)]=void 0x0;const Ticket_1=__importDefault(require(a547_0x5a4032(0x1c6))),User_1=__importDefault(require(a547_0x5a4032(0x1f8))),redis_1=require(a547_0x5a4032(0x1f0)),Contact_1=__importDefault(require(a547_0x5a4032(0x1c2))),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),wbotMessageListener_1=require('../WbotServices/wbotMessageListener'),ShowTicketService_1=__importDefault(require(a547_0x5a4032(0x1bb))),Queue_1=__importDefault(require(a547_0x5a4032(0x1e3))),CheckConnection=async({waid:_0x45573b,code:_0x2339ce,companyId:_0xcf2c28,wbot:_0x11e093})=>{const _0x267c1e=a547_0x5a4032,_0x229c94=await User_1['default'][_0x267c1e(0x1f7)]({'where':{'waid':_0x45573b,'companyId':_0xcf2c28},'include':[{'model':Queue_1['default']}]});if(!_0x229c94)return![];const _0x288b8b=await Ticket_1[_0x267c1e(0x1e4)][_0x267c1e(0x1f7)]({'where':{'iCode':_0x2339ce,'companyId':_0xcf2c28,'status':'pending'},'include':[{'model':Contact_1[_0x267c1e(0x1e4)]},{'model':Queue_1[_0x267c1e(0x1e4)]}]});if(!_0x288b8b)return await _0x11e093['sendMessage'](_0x45573b+_0x267c1e(0x1ce),{'text':'Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!'}),!![];const _0x5af252=_0x229c94[_0x267c1e(0x1c5)][_0x267c1e(0x1f6)](_0x6b8476=>_0x6b8476['id']),_0x3efc5f=_0x288b8b?.[_0x267c1e(0x1d9)];if(_0x3efc5f){if(!_0x5af252[_0x267c1e(0x1d2)](_0x3efc5f))return console[_0x267c1e(0x1f5)](_0x267c1e(0x1ed)),await _0x11e093['sendMessage'](_0x45573b+_0x267c1e(0x1ce),{'text':_0x267c1e(0x1f9)}),!![];}else{if(_0x288b8b[_0x267c1e(0x1ec)]!==_0x229c94['id'])return console[_0x267c1e(0x1f5)]('O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.'),await _0x11e093[_0x267c1e(0x1ef)](_0x45573b+_0x267c1e(0x1ce),{'text':_0x267c1e(0x1ee)}),!![];}if(_0x288b8b[_0x267c1e(0x1cb)][_0x267c1e(0x1d8)]===_0x45573b)return await _0x11e093['sendMessage'](_0x45573b+_0x267c1e(0x1ce),{'text':_0x267c1e(0x1bd)}),!![];const _0x358078=(0x0,redis_1[_0x267c1e(0x1f3)])({'url':process[_0x267c1e(0x1d3)]['REDIS_URI']});await _0x358078[_0x267c1e(0x1ca)]();let _0xb5951d={'type':_0x267c1e(0x1d1),'ticketId':_0x288b8b['id'],'userId':_0x229c94['id'],'number':_0x45573b,'companyId':_0xcf2c28};await _0x358078[_0x267c1e(0x1e9)](_0x288b8b[_0x267c1e(0x1cb)][_0x267c1e(0x1d8)],JSON[_0x267c1e(0x1c9)](_0xb5951d),{'EX':0x15180}),_0xb5951d={'type':_0x267c1e(0x1ea),'ticketId':_0x288b8b['id'],'number':_0x288b8b[_0x267c1e(0x1cb)][_0x267c1e(0x1d8)],'userId':_0x229c94['id'],'companyId':_0xcf2c28},await _0x358078[_0x267c1e(0x1e9)](_0x45573b,JSON[_0x267c1e(0x1c9)](_0xb5951d),{'EX':0x15180}),await _0x358078[_0x267c1e(0x1fb)]();const _0x567e7b=await(0x0,UpdateTicketService_1[_0x267c1e(0x1e4)])({'ticketData':{'status':_0x267c1e(0x1d6),'userId':_0x229c94['id']},'ticketId':_0x288b8b['id'],'companyId':_0xcf2c28});return await _0x11e093[_0x267c1e(0x1ef)](_0x45573b+'@s.whatsapp.net',{'text':_0x267c1e(0x1e1)}),!![];};exports[a547_0x5a4032(0x1be)]=CheckConnection;const Disconnect=async({msg:_0x576fd0,companyId:_0x43c337,wbot:_0x149eb5})=>{const _0x301670=a547_0x5a4032;let _0x52c300=![];const _0x431ba3=(0x0,redis_1[_0x301670(0x1f3)])({'url':process[_0x301670(0x1d3)][_0x301670(0x1e5)]});await _0x431ba3[_0x301670(0x1ca)]();const _0x795402=_0x576fd0[_0x301670(0x1c4)][_0x301670(0x1eb)][_0x301670(0x1d0)](_0x301670(0x1ce),''),_0x456f11=await _0x431ba3[_0x301670(0x1de)](_0x795402);if(_0x456f11){const _0x333bc2=JSON[_0x301670(0x1f1)](_0x456f11);if(_0x333bc2['type']==_0x301670(0x1ea)&&_0x333bc2[_0x301670(0x1d4)]==_0x43c337){const _0x43d557=await(0x0,UpdateTicketService_1[_0x301670(0x1e4)])({'ticketData':{'status':_0x301670(0x1fc),'userId':_0x333bc2[_0x301670(0x1ec)]},'ticketId':_0x333bc2[_0x301670(0x1cd)],'companyId':_0x43c337});await _0x431ba3[_0x301670(0x1f4)](_0x795402),await _0x431ba3[_0x301670(0x1f4)](_0x333bc2[_0x301670(0x1d8)]),await _0x149eb5[_0x301670(0x1ef)](_0x795402+_0x301670(0x1ce),{'text':_0x301670(0x1e6)}),_0x52c300=!![];}}return _0x431ba3[_0x301670(0x1fb)](),_0x52c300;};exports[a547_0x5a4032(0x1e8)]=Disconnect;const ResponseProxy=async({msg:_0x3e6a6c,companyId:_0x5305d9,wbot:_0x5c713e})=>{const _0x3cb014=a547_0x5a4032,_0x312a3d=(0x0,wbotMessageListener_1[_0x3cb014(0x1c8)])(_0x3e6a6c),_0x577d98=_0x3e6a6c[_0x3cb014(0x1c4)][_0x3cb014(0x1eb)][_0x3cb014(0x1d0)](_0x3cb014(0x1ce),'');if(_0x3e6a6c['key'][_0x3cb014(0x1fa)])return![];const _0x15ecda=(0x0,redis_1[_0x3cb014(0x1f3)])({'url':process[_0x3cb014(0x1d3)][_0x3cb014(0x1e5)]});await _0x15ecda['connect']();const _0x1863db=await _0x15ecda[_0x3cb014(0x1de)](_0x577d98);if(!_0x1863db)return![];const _0x5d4d77=JSON['parse'](_0x1863db);if(_0x5d4d77['type']!==_0x3cb014(0x1ea))return![];if(_0x312a3d[_0x3cb014(0x1f2)]()==='sair'){const _0x162964=await(0x0,exports['Disconnect'])({'msg':_0x3e6a6c,'companyId':_0x5305d9,'wbot':_0x5c713e});if(_0x162964)return;}if(_0x312a3d[_0x3cb014(0x1f2)]()=='audio'){}const _0x1f137b=await(0x0,ShowTicketService_1[_0x3cb014(0x1e4)])(_0x5d4d77[_0x3cb014(0x1cd)],_0x5305d9);let _0x94572={'id':_0x3e6a6c[_0x3cb014(0x1c4)]['id'],'ticketId':_0x5d4d77[_0x3cb014(0x1cd)],'body':_0x312a3d,'contactId':_0x1f137b['contactId'],'fromMe':!![],'read':!![]};return await _0x5c713e[_0x3cb014(0x1ef)](_0x5d4d77['number']+_0x3cb014(0x1ce),{'forward':_0x3e6a6c}),!![];};exports[a547_0x5a4032(0x1bc)]=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x2e1349,companyId:_0x1b4a81,wbot:_0x29cf0f,body:_0x402ca4})=>{const _0x5c54cf=a547_0x5a4032;if(_0x2e1349[_0x5c54cf(0x1c4)][_0x5c54cf(0x1fa)])return![];const _0x15a493=_0x2e1349[_0x5c54cf(0x1c4)]['remoteJid'][_0x5c54cf(0x1d0)](_0x5c54cf(0x1ce),''),_0x31021f=(0x0,redis_1[_0x5c54cf(0x1f3)])({'url':process[_0x5c54cf(0x1d3)][_0x5c54cf(0x1e5)]});await _0x31021f['connect']();const _0x2d370f=await _0x31021f['get'](_0x15a493);if(!_0x2d370f)return![];const _0x1c37ba=JSON[_0x5c54cf(0x1f1)](_0x2d370f);if(_0x1c37ba['type']!=_0x5c54cf(0x1d1)||_0x1c37ba['companyId']!=_0x1b4a81)return![];return await _0x29cf0f['sendMessage'](_0x1c37ba[_0x5c54cf(0x1d8)]+_0x5c54cf(0x1ce),{'forward':_0x2e1349}),!![];};exports[a547_0x5a4032(0x1e0)]=SendMessageConnectedStaffMember;