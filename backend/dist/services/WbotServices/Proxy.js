function a548_0x20b5(_0x23a41e,_0x5f5de4){const _0x52bfef=a548_0x407a();return a548_0x20b5=function(_0x3779b2,_0xab82d7){_0x3779b2=_0x3779b2-0x188;let _0x407aed=_0x52bfef[_0x3779b2];return _0x407aed;},a548_0x20b5(_0x23a41e,_0x5f5de4);}const a548_0x331500=a548_0x20b5;(function(_0x11d64c,_0x5eb986){const _0x3cabcf=a548_0x20b5,_0x369f1f=_0x11d64c();while(!![]){try{const _0xcfb263=-parseInt(_0x3cabcf(0x1c8))/0x1+parseInt(_0x3cabcf(0x1ba))/0x2+parseInt(_0x3cabcf(0x18d))/0x3*(-parseInt(_0x3cabcf(0x1a3))/0x4)+-parseInt(_0x3cabcf(0x1a8))/0x5*(parseInt(_0x3cabcf(0x1c0))/0x6)+-parseInt(_0x3cabcf(0x19e))/0x7+-parseInt(_0x3cabcf(0x1be))/0x8*(-parseInt(_0x3cabcf(0x18c))/0x9)+parseInt(_0x3cabcf(0x1b8))/0xa*(parseInt(_0x3cabcf(0x1c7))/0xb);if(_0xcfb263===_0x5eb986)break;else _0x369f1f['push'](_0x369f1f['shift']());}catch(_0x2a89b3){_0x369f1f['push'](_0x369f1f['shift']());}}}(a548_0x407a,0x851fe));const a548_0xab82d7=(function(){let _0xe29ecb=!![];return function(_0x489c8d,_0x4fffbf){const _0x5462b3=_0xe29ecb?function(){const _0x33cfb9=a548_0x20b5;if(_0x4fffbf){const _0x4b4685=_0x4fffbf[_0x33cfb9(0x1b3)](_0x489c8d,arguments);return _0x4fffbf=null,_0x4b4685;}}:function(){};return _0xe29ecb=![],_0x5462b3;};}()),a548_0x3779b2=a548_0xab82d7(this,function(){const _0x523408=a548_0x20b5;return a548_0x3779b2[_0x523408(0x188)]()[_0x523408(0x1cf)](_0x523408(0x1cd))[_0x523408(0x188)]()['constructor'](a548_0x3779b2)[_0x523408(0x1cf)](_0x523408(0x1cd));});a548_0x3779b2();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x808503){return _0x808503&&_0x808503['__esModule']?_0x808503:{'default':_0x808503};};Object[a548_0x331500(0x1c2)](exports,a548_0x331500(0x1b9),{'value':!![]}),exports[a548_0x331500(0x1ab)]=exports[a548_0x331500(0x1b2)]=exports['Disconnect']=exports['CheckConnection']=void 0x0;const Ticket_1=__importDefault(require(a548_0x331500(0x191))),User_1=__importDefault(require(a548_0x331500(0x1a5))),redis_1=require(a548_0x331500(0x195)),Contact_1=__importDefault(require(a548_0x331500(0x196))),UpdateTicketService_1=__importDefault(require(a548_0x331500(0x1bf))),wbotMessageListener_1=require(a548_0x331500(0x1a1)),ShowTicketService_1=__importDefault(require(a548_0x331500(0x18a))),Queue_1=__importDefault(require(a548_0x331500(0x1b5))),CheckConnection=async({waid:_0x2a58aa,code:_0x4b2b34,companyId:_0x38791d,wbot:_0x1d874c})=>{const _0x3db26d=a548_0x331500,_0x541e95=await User_1[_0x3db26d(0x1c9)][_0x3db26d(0x1bc)]({'where':{'waid':_0x2a58aa,'companyId':_0x38791d},'include':[{'model':Queue_1[_0x3db26d(0x1c9)]}]});if(!_0x541e95)return![];const _0x24c440=await Ticket_1['default'][_0x3db26d(0x1bc)]({'where':{'iCode':_0x4b2b34,'companyId':_0x38791d,'status':_0x3db26d(0x1cb)},'include':[{'model':Contact_1[_0x3db26d(0x1c9)]},{'model':Queue_1['default']}]});if(!_0x24c440)return await _0x1d874c['sendMessage'](_0x2a58aa+'@s.whatsapp.net',{'text':_0x3db26d(0x1bd)}),!![];const _0x4ea17a=_0x541e95['queues'][_0x3db26d(0x19a)](_0x1dbaf6=>_0x1dbaf6['id']),_0x3389a0=_0x24c440?.[_0x3db26d(0x1ca)];if(_0x3389a0){if(!_0x4ea17a[_0x3db26d(0x1a6)](_0x3389a0))return console[_0x3db26d(0x18e)](_0x3db26d(0x197)),await _0x1d874c[_0x3db26d(0x18b)](_0x2a58aa+_0x3db26d(0x194),{'text':_0x3db26d(0x1bb)}),!![];}else{if(_0x24c440[_0x3db26d(0x1af)]!==_0x541e95['id'])return console[_0x3db26d(0x18e)]('O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.'),await _0x1d874c[_0x3db26d(0x18b)](_0x2a58aa+_0x3db26d(0x194),{'text':_0x3db26d(0x1a7)}),!![];}if(_0x24c440['contact'][_0x3db26d(0x189)]===_0x2a58aa)return await _0x1d874c['sendMessage'](_0x2a58aa+'@s.whatsapp.net',{'text':_0x3db26d(0x1c3)}),!![];const _0x5e9b0b=(0x0,redis_1[_0x3db26d(0x1c6)])({'url':process[_0x3db26d(0x1b4)][_0x3db26d(0x1cc)]});await _0x5e9b0b[_0x3db26d(0x1a2)]();let _0x5b0bc9={'type':_0x3db26d(0x1c1),'ticketId':_0x24c440['id'],'userId':_0x541e95['id'],'number':_0x2a58aa,'companyId':_0x38791d};await _0x5e9b0b['set'](_0x24c440[_0x3db26d(0x1b0)][_0x3db26d(0x189)],JSON['stringify'](_0x5b0bc9),{'EX':0x15180}),_0x5b0bc9={'type':_0x3db26d(0x1b1),'ticketId':_0x24c440['id'],'number':_0x24c440[_0x3db26d(0x1b0)][_0x3db26d(0x189)],'userId':_0x541e95['id'],'companyId':_0x38791d},await _0x5e9b0b[_0x3db26d(0x19b)](_0x2a58aa,JSON[_0x3db26d(0x19f)](_0x5b0bc9),{'EX':0x15180}),await _0x5e9b0b[_0x3db26d(0x19d)]();const _0x8c7e3a=await(0x0,UpdateTicketService_1[_0x3db26d(0x1c9)])({'ticketData':{'status':_0x3db26d(0x1ae),'userId':_0x541e95['id']},'ticketId':_0x24c440['id'],'companyId':_0x38791d});return await _0x1d874c[_0x3db26d(0x18b)](_0x2a58aa+'@s.whatsapp.net',{'text':_0x3db26d(0x1c5)}),!![];};exports[a548_0x331500(0x1b6)]=CheckConnection;const Disconnect=async({msg:_0x50143c,companyId:_0x1c8181,wbot:_0x3db7a6})=>{const _0x273ada=a548_0x331500;let _0x2d76a5=![];const _0x62d32f=(0x0,redis_1[_0x273ada(0x1c6)])({'url':process[_0x273ada(0x1b4)]['REDIS_URI']});await _0x62d32f[_0x273ada(0x1a2)]();const _0x1db282=_0x50143c[_0x273ada(0x199)][_0x273ada(0x190)]['replace'](_0x273ada(0x194),''),_0x2fe74a=await _0x62d32f[_0x273ada(0x1a9)](_0x1db282);if(_0x2fe74a){const _0x5dd4a2=JSON[_0x273ada(0x1b7)](_0x2fe74a);if(_0x5dd4a2[_0x273ada(0x19c)]==_0x273ada(0x1b1)&&_0x5dd4a2[_0x273ada(0x1ac)]==_0x1c8181){const _0x46b4a3=await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x273ada(0x1a4),'userId':_0x5dd4a2[_0x273ada(0x1af)]},'ticketId':_0x5dd4a2[_0x273ada(0x198)],'companyId':_0x1c8181});await _0x62d32f[_0x273ada(0x1ce)](_0x1db282),await _0x62d32f['del'](_0x5dd4a2['number']),await _0x3db7a6[_0x273ada(0x18b)](_0x1db282+_0x273ada(0x194),{'text':'Desconectado\x20com\x20sucesso'}),_0x2d76a5=!![];}}return _0x62d32f[_0x273ada(0x19d)](),_0x2d76a5;};exports[a548_0x331500(0x1c4)]=Disconnect;const ResponseProxy=async({msg:_0x3e2fdf,companyId:_0x58a2cd,wbot:_0x3bf651})=>{const _0x4b64e5=a548_0x331500,_0x38dcf1=(0x0,wbotMessageListener_1[_0x4b64e5(0x18f)])(_0x3e2fdf),_0x396789=_0x3e2fdf[_0x4b64e5(0x199)][_0x4b64e5(0x190)][_0x4b64e5(0x1ad)](_0x4b64e5(0x194),'');if(_0x3e2fdf[_0x4b64e5(0x199)][_0x4b64e5(0x193)])return![];const _0x223afb=(0x0,redis_1['createClient'])({'url':process[_0x4b64e5(0x1b4)][_0x4b64e5(0x1cc)]});await _0x223afb[_0x4b64e5(0x1a2)]();const _0x2bd96e=await _0x223afb[_0x4b64e5(0x1a9)](_0x396789);if(!_0x2bd96e)return![];const _0x4298d7=JSON[_0x4b64e5(0x1b7)](_0x2bd96e);if(_0x4298d7[_0x4b64e5(0x19c)]!=='assistant')return![];if(_0x38dcf1[_0x4b64e5(0x192)]()==='sair'){const _0x4bc126=await(0x0,exports[_0x4b64e5(0x1c4)])({'msg':_0x3e2fdf,'companyId':_0x58a2cd,'wbot':_0x3bf651});if(_0x4bc126)return;}if(_0x38dcf1[_0x4b64e5(0x192)]()==_0x4b64e5(0x1aa)){}const _0x34deb6=await(0x0,ShowTicketService_1[_0x4b64e5(0x1c9)])(_0x4298d7['ticketId'],_0x58a2cd);let _0x4664f1={'id':_0x3e2fdf[_0x4b64e5(0x199)]['id'],'ticketId':_0x4298d7[_0x4b64e5(0x198)],'body':_0x38dcf1,'contactId':_0x34deb6[_0x4b64e5(0x1a0)],'fromMe':!![],'read':!![]};return await _0x3bf651['sendMessage'](_0x4298d7[_0x4b64e5(0x189)]+_0x4b64e5(0x194),{'forward':_0x3e2fdf}),!![];};exports['ResponseProxy']=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x1fa508,companyId:_0x40360a,wbot:_0x2990bf,body:_0x5586f9})=>{const _0x5d18dd=a548_0x331500;if(_0x1fa508[_0x5d18dd(0x199)]['fromMe'])return![];const _0x51fb45=_0x1fa508[_0x5d18dd(0x199)]['remoteJid']['replace']('@s.whatsapp.net',''),_0x205513=(0x0,redis_1['createClient'])({'url':process[_0x5d18dd(0x1b4)][_0x5d18dd(0x1cc)]});await _0x205513[_0x5d18dd(0x1a2)]();const _0x2b83a8=await _0x205513['get'](_0x51fb45);if(!_0x2b83a8)return![];const _0x267e66=JSON[_0x5d18dd(0x1b7)](_0x2b83a8);if(_0x267e66[_0x5d18dd(0x19c)]!=_0x5d18dd(0x1c1)||_0x267e66[_0x5d18dd(0x1ac)]!=_0x40360a)return![];return await _0x2990bf[_0x5d18dd(0x18b)](_0x267e66[_0x5d18dd(0x189)]+_0x5d18dd(0x194),{'forward':_0x1fa508}),!![];};exports[a548_0x331500(0x1ab)]=SendMessageConnectedStaffMember;function a548_0x407a(){const _0x5945c0=['../WbotServices/wbotMessageListener','connect','215056eyKqHw','closed','../../models/User','includes','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','3070MLvJvg','get','audio','SendMessageConnectedStaffMember','companyId','replace','open','userId','contact','assistant','ResponseProxy','apply','env','../../models/Queue','CheckConnection','parse','3409330ABASLc','__esModule','1734680kbnTAD','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','findOne','Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!','872IZaHsJ','../TicketServices/UpdateTicketService','3642JeuZbB','user','defineProperty','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','Disconnect','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','createClient','44xTLcRq','107412dUQXJq','default','queueId','pending','REDIS_URI','(((.+)+)+)+$','del','search','toString','number','../TicketServices/ShowTicketService','sendMessage','18873ymyDJV','24svAGBY','log','getBodyMessage','remoteJid','../../models/Ticket','toLowerCase','fromMe','@s.whatsapp.net','redis','../../models/Contact','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','ticketId','key','map','set','type','disconnect','7029015fpTPKn','stringify','contactId'];a548_0x407a=function(){return _0x5945c0;};return a548_0x407a();}