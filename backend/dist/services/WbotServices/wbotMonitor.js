'use strict';const a583_0x4645b1=a583_0x312c;function a583_0x148f(){const _0x510b25=['apply','getMinutes','search','__setModuleDefault','terminate','3366976YPDsfC','461668xmPyMp','contacts.upsert','4oBErEw','call','value','(((.+)+)+)+$','pending','defineProperty','hasOwnProperty','getHours','status','2735391eSPoBK','update','prototype','getOwnPropertyDescriptor','content','from','sendMessage','../../models/Setting','../../models/Ticket','7HvoWbM','writable','get','logger','default','error','findOne','__esModule','../../utils/logger','attrs','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','length','runExclusive','tag','toString','create','../../models/Contact','126350utfdPa','922128jJlcpq','__createBinding','133372CJnCqY','configurable','847vgYUya','@sentry/node','190vCdQOF','call-id','replace','13422825KwMwIc','async-mutex','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','CB:call','disabled','closed'];a583_0x148f=function(){return _0x510b25;};return a583_0x148f();}(function(_0x3b4e8b,_0x15e0c0){const _0x267337=a583_0x312c,_0x434958=_0x3b4e8b();while(!![]){try{const _0x4e9b7c=-parseInt(_0x267337(0x115))/0x1*(-parseInt(_0x267337(0x113))/0x2)+parseInt(_0x267337(0x11e))/0x3+-parseInt(_0x267337(0x13b))/0x4*(-parseInt(_0x267337(0x13f))/0x5)+parseInt(_0x267337(0x139))/0x6*(-parseInt(_0x267337(0x127))/0x7)+parseInt(_0x267337(0x112))/0x8+-parseInt(_0x267337(0x142))/0x9+-parseInt(_0x267337(0x138))/0xa*(parseInt(_0x267337(0x13d))/0xb);if(_0x4e9b7c===_0x15e0c0)break;else _0x434958['push'](_0x434958['shift']());}catch(_0x5bb46f){_0x434958['push'](_0x434958['shift']());}}}(a583_0x148f,0xdcf47));function a583_0x312c(_0x1a5786,_0xfc44fa){const _0x2435b4=a583_0x148f();return a583_0x312c=function(_0xd03a03,_0x83e9d8){_0xd03a03=_0xd03a03-0x10d;let _0x148fe1=_0x2435b4[_0xd03a03];return _0x148fe1;},a583_0x312c(_0x1a5786,_0xfc44fa);}var __createBinding=this&&this[a583_0x4645b1(0x13a)]||(Object['create']?function(_0x953d50,_0x2cc6c7,_0x12f938,_0x27f34e){const _0x4389e6=a583_0x4645b1;if(_0x27f34e===undefined)_0x27f34e=_0x12f938;var _0x40d5b9=Object[_0x4389e6(0x121)](_0x2cc6c7,_0x12f938);(!_0x40d5b9||(_0x4389e6(0x129)in _0x40d5b9?!_0x2cc6c7[_0x4389e6(0x12e)]:_0x40d5b9[_0x4389e6(0x128)]||_0x40d5b9[_0x4389e6(0x13c)]))&&(_0x40d5b9={'enumerable':!![],'get':function(){return _0x2cc6c7[_0x12f938];}}),Object['defineProperty'](_0x953d50,_0x27f34e,_0x40d5b9);}:function(_0x2a2dc3,_0x1c3987,_0x2da430,_0x57adc9){if(_0x57adc9===undefined)_0x57adc9=_0x2da430;_0x2a2dc3[_0x57adc9]=_0x1c3987[_0x2da430];}),__setModuleDefault=this&&this[a583_0x4645b1(0x110)]||(Object[a583_0x4645b1(0x136)]?function(_0x450668,_0x2d6b9e){const _0x5c0beb=a583_0x4645b1;Object[_0x5c0beb(0x11a)](_0x450668,'default',{'enumerable':!![],'value':_0x2d6b9e});}:function(_0xcf76,_0xd76a55){const _0x449284=a583_0x4645b1;_0xcf76[_0x449284(0x12b)]=_0xd76a55;}),__importStar=this&&this['__importStar']||(function(){const _0x1b2e84=(function(){let _0x12d1c9=!![];return function(_0x1b6f04,_0x47d3f5){const _0x351069=_0x12d1c9?function(){const _0x17478a=a583_0x312c;if(_0x47d3f5){const _0x58cdcd=_0x47d3f5[_0x17478a(0x10d)](_0x1b6f04,arguments);return _0x47d3f5=null,_0x58cdcd;}}:function(){};return _0x12d1c9=![],_0x351069;};}()),_0x164a7e=_0x1b2e84(this,function(){const _0x29a787=a583_0x312c;return _0x164a7e[_0x29a787(0x135)]()['search'](_0x29a787(0x118))[_0x29a787(0x135)]()['constructor'](_0x164a7e)[_0x29a787(0x10f)](_0x29a787(0x118));});_0x164a7e();var _0x9e397c=function(_0x2671ef){return _0x9e397c=Object['getOwnPropertyNames']||function(_0x48b0af){const _0x16cedf=a583_0x312c;var _0xb8461c=[];for(var _0x5246b8 in _0x48b0af)if(Object[_0x16cedf(0x120)][_0x16cedf(0x11b)][_0x16cedf(0x116)](_0x48b0af,_0x5246b8))_0xb8461c[_0xb8461c[_0x16cedf(0x132)]]=_0x5246b8;return _0xb8461c;},_0x9e397c(_0x2671ef);};return function(_0x10b00a){const _0x56ace3=a583_0x312c;if(_0x10b00a&&_0x10b00a[_0x56ace3(0x12e)])return _0x10b00a;var _0x5e4f7a={};if(_0x10b00a!=null){for(var _0x5264ed=_0x9e397c(_0x10b00a),_0x2ad498=0x0;_0x2ad498<_0x5264ed[_0x56ace3(0x132)];_0x2ad498++)if(_0x5264ed[_0x2ad498]!==_0x56ace3(0x12b))__createBinding(_0x5e4f7a,_0x10b00a,_0x5264ed[_0x2ad498]);}return __setModuleDefault(_0x5e4f7a,_0x10b00a),_0x5e4f7a;};}()),__importDefault=this&&this['__importDefault']||function(_0x39f6f9){const _0xd27fe0=a583_0x4645b1;return _0x39f6f9&&_0x39f6f9[_0xd27fe0(0x12e)]?_0x39f6f9:{'default':_0x39f6f9};};Object[a583_0x4645b1(0x11a)](exports,a583_0x4645b1(0x12e),{'value':!![]});const Sentry=__importStar(require(a583_0x4645b1(0x13e))),async_mutex_1=require(a583_0x4645b1(0x143)),Contact_1=__importDefault(require(a583_0x4645b1(0x137))),Setting_1=__importDefault(require(a583_0x4645b1(0x125))),Ticket_1=__importDefault(require(a583_0x4645b1(0x126))),logger_1=require(a583_0x4645b1(0x12f)),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),contactMutex=new async_mutex_1['Mutex'](),wbotMonitor=async(_0x400884,_0x16aeb1,_0x507560)=>{const _0x167705=a583_0x4645b1;try{_0x400884['ws']['on'](_0x167705(0x145),async _0x4f738a=>{const _0x2103b2=_0x167705,_0x27fb41=_0x4f738a[_0x2103b2(0x122)][0x0];if(_0x27fb41[_0x2103b2(0x134)]===_0x2103b2(0x111)){const _0xda0052=await Setting_1['default'][_0x2103b2(0x12d)]({'where':{'key':_0x2103b2(0x116),'companyId':_0x507560}});if(_0xda0052[_0x2103b2(0x117)]===_0x2103b2(0x146)){await _0x400884[_0x2103b2(0x124)](_0x4f738a['attrs'][_0x2103b2(0x123)],{'text':_0x2103b2(0x144)});const _0x429a34=_0x4f738a[_0x2103b2(0x130)]['from'][_0x2103b2(0x141)](/\D/g,''),_0x364871=await Contact_1['default'][_0x2103b2(0x12d)]({'where':{'companyId':_0x507560,'number':_0x429a34}}),_0x503341=await Ticket_1[_0x2103b2(0x12b)][_0x2103b2(0x12d)]({'where':{'contactId':_0x364871['id'],'whatsappId':_0x400884['id'],'status':'open','companyId':_0x507560}});if(!_0x503341)return;const _0x1e9f87=new Date(),_0x92f0ee=_0x1e9f87[_0x2103b2(0x11c)](),_0x4c018c=_0x1e9f87[_0x2103b2(0x10e)](),_0x3c3108=_0x2103b2(0x131)+_0x92f0ee+':'+_0x4c018c,_0xaa674d={'id':_0x27fb41['attrs'][_0x2103b2(0x140)],'ticketId':_0x503341['id'],'contactId':_0x364871['id'],'body':_0x3c3108,'fromMe':![],'mediaType':'call_log','read':!![],'quotedMsgId':null,'ack':0x1};await _0x503341[_0x2103b2(0x11f)]({'lastMessage':_0x3c3108}),_0x503341[_0x2103b2(0x11d)]===_0x2103b2(0x147)&&await _0x503341[_0x2103b2(0x11f)]({'status':_0x2103b2(0x119)}),(0x0,CreateMessageService_1[_0x2103b2(0x12b)])({'messageData':_0xaa674d,'companyId':_0x507560});}}}),_0x400884['ev']['on'](_0x167705(0x114),async _0x44f419=>{const _0x4402cb=_0x167705;logger_1[_0x4402cb(0x12a)]['debug']({'contacts':_0x44f419},_0x4402cb(0x114)),contactMutex[_0x4402cb(0x133)](async()=>{const _0x3d2b7d=_0x4402cb;await(0x0,CreateOrUpdateBaileysService_1[_0x3d2b7d(0x12b)])({'whatsappId':_0x16aeb1['id'],'contacts':_0x44f419});});});}catch(_0x17da5d){Sentry['captureException'](_0x17da5d),logger_1[_0x167705(0x12a)][_0x167705(0x12c)](_0x17da5d);}};exports[a583_0x4645b1(0x12b)]=wbotMonitor;