const a561_0x876caf=a561_0x3e44;function a561_0x3e44(_0x1c4632,_0x4a5c3c){const _0x37245c=a561_0x27c1();return a561_0x3e44=function(_0x426e04,_0x1869f6){_0x426e04=_0x426e04-0xf0;let _0x27c129=_0x37245c[_0x426e04];return _0x27c129;},a561_0x3e44(_0x1c4632,_0x4a5c3c);}(function(_0x44842a,_0x4c3993){const _0x47ed70=a561_0x3e44,_0x50ed05=_0x44842a();while(!![]){try{const _0x3ec6e5=parseInt(_0x47ed70(0xfd))/0x1*(-parseInt(_0x47ed70(0x108))/0x2)+-parseInt(_0x47ed70(0x127))/0x3*(parseInt(_0x47ed70(0x11d))/0x4)+parseInt(_0x47ed70(0xfa))/0x5*(-parseInt(_0x47ed70(0x11e))/0x6)+-parseInt(_0x47ed70(0xfc))/0x7*(-parseInt(_0x47ed70(0xfe))/0x8)+parseInt(_0x47ed70(0xf3))/0x9*(parseInt(_0x47ed70(0x122))/0xa)+-parseInt(_0x47ed70(0xf4))/0xb*(parseInt(_0x47ed70(0x109))/0xc)+parseInt(_0x47ed70(0xf8))/0xd;if(_0x3ec6e5===_0x4c3993)break;else _0x50ed05['push'](_0x50ed05['shift']());}catch(_0x3f4e11){_0x50ed05['push'](_0x50ed05['shift']());}}}(a561_0x27c1,0xa3047));const a561_0x1869f6=(function(){let _0x48a3b2=!![];return function(_0x58bd3d,_0x4d63ba){const _0x246bf9=_0x48a3b2?function(){const _0xa093cc=a561_0x3e44;if(_0x4d63ba){const _0x3147a1=_0x4d63ba[_0xa093cc(0x10f)](_0x58bd3d,arguments);return _0x4d63ba=null,_0x3147a1;}}:function(){};return _0x48a3b2=![],_0x246bf9;};}()),a561_0x426e04=a561_0x1869f6(this,function(){const _0x2e9da4=a561_0x3e44;return a561_0x426e04[_0x2e9da4(0x106)]()[_0x2e9da4(0x11c)]('(((.+)+)+)+$')[_0x2e9da4(0x106)]()['constructor'](a561_0x426e04)[_0x2e9da4(0x11c)]('(((.+)+)+)+$');});function a561_0x27c1(){const _0x38b2d9=['SendPresenceStatus','findOne','captureException','open','from','toString','../../models/Setting','375806inSXFJ','10141956KIcaqf','content','attrs','__createBinding','closed','call','apply','../../models/Ticket','writable','update','error','getOwnPropertyDescriptor','__setModuleDefault','push','status','contacts.upsert','default','call-id','trace','search','12IguLOp','22956uHKNlW','length','../MessageServices/CreateMessageService','__esModule','290gXuOSC','create','CB:call','tag','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','996882iLGGTo','replace','../../models/Contact','prototype','string','hasOwnProperty','getMinutes','find','@sentry/node','defineProperty','221256qhHDcf','11TfZuZv','pending','getHours','disabled','14361698qnTFLj','getTime','170AydeaE','get','13062aEKFnG','2PJWsOb','5136HLRJps','value','../BaileysServices/CreateOrUpdateBaileysService'];a561_0x27c1=function(){return _0x38b2d9;};return a561_0x27c1();}a561_0x426e04();'use strict';var __createBinding=this&&this[a561_0x876caf(0x10c)]||(Object[a561_0x876caf(0x123)]?function(_0x116c37,_0x10c250,_0x278933,_0xd06841){const _0x269bd4=a561_0x876caf;if(_0xd06841===undefined)_0xd06841=_0x278933;var _0x313bdf=Object[_0x269bd4(0x114)](_0x10c250,_0x278933);(!_0x313bdf||(_0x269bd4(0xfb)in _0x313bdf?!_0x10c250[_0x269bd4(0x121)]:_0x313bdf[_0x269bd4(0x111)]||_0x313bdf['configurable']))&&(_0x313bdf={'enumerable':!![],'get':function(){return _0x10c250[_0x278933];}}),Object[_0x269bd4(0xf2)](_0x116c37,_0xd06841,_0x313bdf);}:function(_0x28b915,_0x1d4f95,_0x141eb9,_0x520e0e){if(_0x520e0e===undefined)_0x520e0e=_0x141eb9;_0x28b915[_0x520e0e]=_0x1d4f95[_0x141eb9];}),__setModuleDefault=this&&this[a561_0x876caf(0x115)]||(Object[a561_0x876caf(0x123)]?function(_0x16fe45,_0x1e5b2a){const _0x4678dd=a561_0x876caf;Object[_0x4678dd(0xf2)](_0x16fe45,_0x4678dd(0x119),{'enumerable':!![],'value':_0x1e5b2a});}:function(_0x16eb43,_0x105e03){const _0x4c7926=a561_0x876caf;_0x16eb43[_0x4c7926(0x119)]=_0x105e03;}),__importStar=this&&this['__importStar']||function(_0x3c1aa3){const _0x4a0edc=a561_0x876caf;if(_0x3c1aa3&&_0x3c1aa3[_0x4a0edc(0x121)])return _0x3c1aa3;var _0x4bfae4={};if(_0x3c1aa3!=null){for(var _0x225850 in _0x3c1aa3)if(_0x225850!==_0x4a0edc(0x119)&&Object[_0x4a0edc(0x12a)][_0x4a0edc(0x12c)]['call'](_0x3c1aa3,_0x225850))__createBinding(_0x4bfae4,_0x3c1aa3,_0x225850);}return __setModuleDefault(_0x4bfae4,_0x3c1aa3),_0x4bfae4;},__importDefault=this&&this['__importDefault']||function(_0x4d04da){return _0x4d04da&&_0x4d04da['__esModule']?_0x4d04da:{'default':_0x4d04da};};Object[a561_0x876caf(0xf2)](exports,a561_0x876caf(0x121),{'value':!![]});const Sentry=__importStar(require(a561_0x876caf(0xf1))),Contact_1=__importDefault(require(a561_0x876caf(0x129))),Setting_1=__importDefault(require(a561_0x876caf(0x107))),Ticket_1=__importDefault(require(a561_0x876caf(0x110))),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require(a561_0x876caf(0x100))),CreateMessageService_1=__importDefault(require(a561_0x876caf(0x120))),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus');let messageControl=[];const wbotMonitor=async(_0x461a9c,_0x3cae81,_0x4ed334)=>{const _0x427e98=a561_0x876caf;try{_0x461a9c['ws']['on'](_0x427e98(0x124),async _0x244b0f=>{const _0x1ce7a0=_0x427e98,_0x1eb24f=_0x244b0f[_0x1ce7a0(0x10a)][0x0];if(_0x1eb24f[_0x1ce7a0(0x125)]==='offer'){const {from:_0x40956d,id:_0x4b1e06}=_0x244b0f['attrs'];}if(_0x1eb24f['tag']==='terminate'){const _0x538a50=await Setting_1[_0x1ce7a0(0x119)][_0x1ce7a0(0x102)]({'where':{'key':_0x1ce7a0(0x10e),'companyId':_0x4ed334}});if(!_0x538a50||_0x538a50[_0x1ce7a0(0xff)]===_0x1ce7a0(0xf7)){if(messageControl[_0x1ce7a0(0x11f)]>0x1388)messageControl=[];var _0x1537e5=messageControl[_0x1ce7a0(0xf0)](_0x1ed29b=>_0x1ed29b[_0x1ce7a0(0x105)]===_0x244b0f[_0x1ce7a0(0x10b)]['from']);(!_0x1537e5||new Date()['getTime']()-_0x1537e5['time']>=0x3e8*0x3c*0x5)&&(await(0x0,SendPresenceStatus_1[_0x1ce7a0(0x101)])(_0x461a9c,_0x244b0f['attrs'][_0x1ce7a0(0x105)]),await _0x461a9c['sendMessage'](_0x244b0f[_0x1ce7a0(0x10b)][_0x1ce7a0(0x105)],{'text':_0x1ce7a0(0x126)}),_0x1537e5&&(_0x1537e5=null,messageControl=messageControl['filter'](_0x5e7fcb=>_0x5e7fcb['from']!==_0x244b0f['attrs'][_0x1ce7a0(0x105)])));!_0x1537e5&&messageControl[_0x1ce7a0(0x116)]({'from':_0x244b0f[_0x1ce7a0(0x10b)][_0x1ce7a0(0x105)],'time':new Date()[_0x1ce7a0(0xf9)]()});const _0x5e2f91=_0x244b0f[_0x1ce7a0(0x10b)][_0x1ce7a0(0x105)][_0x1ce7a0(0x128)](/\D/g,''),_0x48ee2c=await Contact_1[_0x1ce7a0(0x119)]['findOne']({'where':{'companyId':_0x4ed334,'number':_0x5e2f91}}),_0x1e51ff=await Ticket_1[_0x1ce7a0(0x119)][_0x1ce7a0(0x102)]({'where':{'contactId':_0x48ee2c['id'],'whatsappId':_0x461a9c['id'],'status':_0x1ce7a0(0x104),'companyId':_0x4ed334}});if(!_0x1e51ff)return;const _0x48dca4=new Date(),_0x3fc5f2=_0x48dca4[_0x1ce7a0(0xf6)](),_0x41bb8f=_0x48dca4[_0x1ce7a0(0x12d)](),_0x5682c9='Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20'+_0x3fc5f2+':'+_0x41bb8f,_0x4b54e1={'id':_0x1eb24f[_0x1ce7a0(0x10b)][_0x1ce7a0(0x11a)],'ticketId':_0x1e51ff['id'],'contactId':_0x48ee2c['id'],'body':_0x5682c9,'fromMe':![],'mediaType':'call_log','read':!![],'quotedMsgId':null,'ack':0x1};return typeof _0x5682c9!==_0x1ce7a0(0x12b)&&console[_0x1ce7a0(0x11b)]('body\x20is\x20not\x20a\x20string',_0x5682c9),await _0x1e51ff[_0x1ce7a0(0x112)]({'lastMessage':_0x5682c9}),_0x1e51ff[_0x1ce7a0(0x117)]===_0x1ce7a0(0x10d)&&await _0x1e51ff[_0x1ce7a0(0x112)]({'status':_0x1ce7a0(0xf5)}),(0x0,CreateMessageService_1['default'])({'messageData':_0x4b54e1,'ticket':_0x1e51ff,'companyId':_0x4ed334});}}}),_0x461a9c['ev']['on'](_0x427e98(0x118),async _0x5213ca=>{await(0x0,CreateOrUpdateBaileysService_1['default'])({'whatsappId':_0x3cae81['id'],'contacts':_0x5213ca});});}catch(_0x56f178){Sentry[_0x427e98(0x103)](_0x56f178),logger_1['logger'][_0x427e98(0x113)](_0x56f178);}};exports[a561_0x876caf(0x119)]=wbotMonitor;