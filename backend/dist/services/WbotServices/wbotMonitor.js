'use strict';const a585_0x191f8f=a585_0x3444;(function(_0x4facd1,_0x3164ee){const _0x31becb=a585_0x3444,_0x3ac024=_0x4facd1();while(!![]){try{const _0x182dd4=-parseInt(_0x31becb(0xf8))/0x1*(parseInt(_0x31becb(0x128))/0x2)+-parseInt(_0x31becb(0xfd))/0x3*(-parseInt(_0x31becb(0x11b))/0x4)+-parseInt(_0x31becb(0x11a))/0x5*(parseInt(_0x31becb(0x11e))/0x6)+parseInt(_0x31becb(0xf5))/0x7*(-parseInt(_0x31becb(0x10c))/0x8)+parseInt(_0x31becb(0x10b))/0x9+parseInt(_0x31becb(0x106))/0xa+-parseInt(_0x31becb(0x112))/0xb*(-parseInt(_0x31becb(0x109))/0xc);if(_0x182dd4===_0x3164ee)break;else _0x3ac024['push'](_0x3ac024['shift']());}catch(_0x55ae03){_0x3ac024['push'](_0x3ac024['shift']());}}}(a585_0x5a8d,0xcc9ed));function a585_0x3444(_0x23c5b7,_0x2f48d9){const _0x47e585=a585_0x5a8d();return a585_0x3444=function(_0x1e57a5,_0x304e21){_0x1e57a5=_0x1e57a5-0xf4;let _0x5a8d12=_0x47e585[_0x1e57a5];return _0x5a8d12;},a585_0x3444(_0x23c5b7,_0x2f48d9);}var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x1bde77,_0x4409af,_0xbc1388,_0x5d177d){const _0x1d7c15=a585_0x3444;if(_0x5d177d===undefined)_0x5d177d=_0xbc1388;var _0xd6463c=Object[_0x1d7c15(0x120)](_0x4409af,_0xbc1388);(!_0xd6463c||(_0x1d7c15(0x11f)in _0xd6463c?!_0x4409af[_0x1d7c15(0x12d)]:_0xd6463c[_0x1d7c15(0x10d)]||_0xd6463c[_0x1d7c15(0x115)]))&&(_0xd6463c={'enumerable':!![],'get':function(){return _0x4409af[_0xbc1388];}}),Object[_0x1d7c15(0xfb)](_0x1bde77,_0x5d177d,_0xd6463c);}:function(_0xa2344d,_0x1ace9b,_0xa7554e,_0x51a86e){if(_0x51a86e===undefined)_0x51a86e=_0xa7554e;_0xa2344d[_0x51a86e]=_0x1ace9b[_0xa7554e];}),__setModuleDefault=this&&this[a585_0x191f8f(0x118)]||(Object[a585_0x191f8f(0x10e)]?function(_0x127aeb,_0x30b93e){const _0x5f3b21=a585_0x191f8f;Object[_0x5f3b21(0xfb)](_0x127aeb,_0x5f3b21(0xf7),{'enumerable':!![],'value':_0x30b93e});}:function(_0x2a0836,_0x6e25b9){_0x2a0836['default']=_0x6e25b9;}),__importStar=this&&this[a585_0x191f8f(0x12c)]||(function(){const _0x5eec4b=(function(){let _0x597b0e=!![];return function(_0x12c8da,_0x5d6d17){const _0x7ae7d7=_0x597b0e?function(){const _0x28c3a7=a585_0x3444;if(_0x5d6d17){const _0x1b83a1=_0x5d6d17[_0x28c3a7(0x124)](_0x12c8da,arguments);return _0x5d6d17=null,_0x1b83a1;}}:function(){};return _0x597b0e=![],_0x7ae7d7;};}()),_0x61f684=_0x5eec4b(this,function(){const _0x228c74=a585_0x3444;return _0x61f684[_0x228c74(0xf9)]()[_0x228c74(0xf6)](_0x228c74(0x104))[_0x228c74(0xf9)]()['constructor'](_0x61f684)[_0x228c74(0xf6)](_0x228c74(0x104));});_0x61f684();var _0x21a7b9=function(_0x4a9f86){const _0x4af69e=a585_0x3444;return _0x21a7b9=Object[_0x4af69e(0x126)]||function(_0x56c2a8){const _0x190379=_0x4af69e;var _0x24df68=[];for(var _0x4028e6 in _0x56c2a8)if(Object[_0x190379(0x12e)][_0x190379(0x117)][_0x190379(0x123)](_0x56c2a8,_0x4028e6))_0x24df68[_0x24df68['length']]=_0x4028e6;return _0x24df68;},_0x21a7b9(_0x4a9f86);};return function(_0x12640a){const _0x1bda63=a585_0x3444;if(_0x12640a&&_0x12640a[_0x1bda63(0x12d)])return _0x12640a;var _0x386e1f={};if(_0x12640a!=null){for(var _0x33d1fe=_0x21a7b9(_0x12640a),_0x431ed8=0x0;_0x431ed8<_0x33d1fe[_0x1bda63(0x102)];_0x431ed8++)if(_0x33d1fe[_0x431ed8]!==_0x1bda63(0xf7))__createBinding(_0x386e1f,_0x12640a,_0x33d1fe[_0x431ed8]);}return __setModuleDefault(_0x386e1f,_0x12640a),_0x386e1f;};}()),__importDefault=this&&this[a585_0x191f8f(0xf4)]||function(_0x4870d1){const _0x156de1=a585_0x191f8f;return _0x4870d1&&_0x4870d1[_0x156de1(0x12d)]?_0x4870d1:{'default':_0x4870d1};};Object['defineProperty'](exports,a585_0x191f8f(0x12d),{'value':!![]});const Sentry=__importStar(require('@sentry/node')),async_mutex_1=require(a585_0x191f8f(0x100)),Contact_1=__importDefault(require('../../models/Contact')),Setting_1=__importDefault(require(a585_0x191f8f(0x12b))),Ticket_1=__importDefault(require(a585_0x191f8f(0xfc))),logger_1=require(a585_0x191f8f(0xfe)),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require(a585_0x191f8f(0x12a))),contactMutex=new async_mutex_1['Mutex'](),wbotMonitor=async(_0x20ad69,_0x14a942,_0x401b32)=>{const _0x3b499e=a585_0x191f8f;try{_0x20ad69['ws']['on'](_0x3b499e(0x127),async _0x41c801=>{const _0x270602=_0x3b499e,_0x25eba1=_0x41c801['content'][0x0];if(_0x25eba1[_0x270602(0x101)]===_0x270602(0x125)){const _0x49a085=await Setting_1['default'][_0x270602(0x105)]({'where':{'key':'call','companyId':_0x401b32}});if(_0x49a085['value']===_0x270602(0x114)){await _0x20ad69['sendMessage'](_0x41c801[_0x270602(0x10a)][_0x270602(0x110)],{'text':_0x270602(0x122)});const _0x1b32eb=_0x41c801[_0x270602(0x10a)][_0x270602(0x110)][_0x270602(0x116)](/\D/g,''),_0x1d2271=await Contact_1[_0x270602(0xf7)][_0x270602(0x105)]({'where':{'companyId':_0x401b32,'number':_0x1b32eb}}),_0x34a801=await Ticket_1['default'][_0x270602(0x105)]({'where':{'contactId':_0x1d2271['id'],'whatsappId':_0x20ad69['id'],'status':_0x270602(0x129),'companyId':_0x401b32}});if(!_0x34a801)return;const _0x451642=new Date(),_0x95be09=_0x451642['getHours'](),_0x1e01ff=_0x451642[_0x270602(0x121)](),_0x588923='Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20'+_0x95be09+':'+_0x1e01ff,_0x463ebe={'id':_0x25eba1[_0x270602(0x10a)][_0x270602(0xff)],'ticketId':_0x34a801['id'],'contactId':_0x1d2271['id'],'body':_0x588923,'fromMe':![],'mediaType':_0x270602(0x10f),'read':!![],'quotedMsgId':null,'ack':0x1};await _0x34a801[_0x270602(0x11c)]({'lastMessage':_0x588923}),_0x34a801[_0x270602(0xfa)]==='closed'&&await _0x34a801[_0x270602(0x11c)]({'status':_0x270602(0x107)}),(0x0,CreateMessageService_1[_0x270602(0xf7)])({'messageData':_0x463ebe,'companyId':_0x401b32});}}}),_0x20ad69['ev']['on'](_0x3b499e(0x103),async _0x3a24e1=>{const _0x454abc=_0x3b499e;logger_1[_0x454abc(0x113)][_0x454abc(0x119)]({'contacts':_0x3a24e1},'contacts.upsert'),contactMutex[_0x454abc(0x11d)](async()=>{await(0x0,CreateOrUpdateBaileysService_1['default'])({'whatsappId':_0x14a942['id'],'contacts':_0x3a24e1});});});}catch(_0x391fce){Sentry[_0x3b499e(0x108)](_0x391fce),logger_1['logger'][_0x3b499e(0x111)](_0x391fce);}};exports[a585_0x191f8f(0xf7)]=wbotMonitor;function a585_0x5a8d(){const _0x334986=['debug','27305GTxxQV','2174880DIKTqJ','update','runExclusive','726CYZhjf','get','getOwnPropertyDescriptor','getMinutes','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','call','apply','terminate','getOwnPropertyNames','CB:call','4HGlEKA','open','../MessageServices/CreateMessageService','../../models/Setting','__importStar','__esModule','prototype','__importDefault','7Ffyqrn','search','default','96281HaXlsk','toString','status','defineProperty','../../models/Ticket','3FtZfVW','../../utils/logger','call-id','async-mutex','tag','length','contacts.upsert','(((.+)+)+)+$','findOne','4778810nJCaoy','pending','captureException','18346128JvjKId','attrs','6562287jklYiR','12704960WKflDp','writable','create','call_log','from','error','11jenxlQ','logger','disabled','configurable','replace','hasOwnProperty','__setModuleDefault'];a585_0x5a8d=function(){return _0x334986;};return a585_0x5a8d();}