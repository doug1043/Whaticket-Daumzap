'use strict';const a697_0x1cdd59=a697_0xa0f2;(function(_0x278546,_0x250fd1){const _0x18f8ed=a697_0xa0f2,_0x52b40d=_0x278546();while(!![]){try{const _0x270ef8=-parseInt(_0x18f8ed(0x78))/0x1+parseInt(_0x18f8ed(0x92))/0x2+parseInt(_0x18f8ed(0xa8))/0x3*(-parseInt(_0x18f8ed(0x93))/0x4)+parseInt(_0x18f8ed(0x87))/0x5+-parseInt(_0x18f8ed(0x94))/0x6+-parseInt(_0x18f8ed(0x75))/0x7*(parseInt(_0x18f8ed(0xac))/0x8)+-parseInt(_0x18f8ed(0xad))/0x9*(-parseInt(_0x18f8ed(0x7f))/0xa);if(_0x270ef8===_0x250fd1)break;else _0x52b40d['push'](_0x52b40d['shift']());}catch(_0x95c8c0){_0x52b40d['push'](_0x52b40d['shift']());}}}(a697_0x47a8,0x2c49c));function a697_0x47a8(){const _0x323dd2=['length','getOwnPropertyNames','captureException','13144xIgcvx','16047wDUsBr','create','413PBrtNN','closed','call-id','208750ZBkCvK','findOne','apply','__importDefault','toString','__importStar','tag','3770RTtuyS','open','default','hasOwnProperty','configurable','constructor','call','contacts.upsert','1326350uLPDjd','../BaileysServices/CreateOrUpdateBaileysService','pending','CB:call','defineProperty','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','Mutex','sendRejectCall','(((.+)+)+)+$','getMinutes','__esModule','101252ChKvQk','5832CXJBdu','1929972xJCgkG','search','from','../../models/Contact','runExclusive','attrs','logger','../MessageServices/CreateMessageService','async-mutex','__createBinding','content','getOwnPropertyDescriptor','debug','rejectCallMessage','allowGroup','update','call_log','trim','prototype','terminate','369FTQczN'];a697_0x47a8=function(){return _0x323dd2;};return a697_0x47a8();}var __createBinding=this&&this[a697_0x1cdd59(0x9d)]||(Object[a697_0x1cdd59(0x74)]?function(_0x1aeded,_0x264a2a,_0x316a36,_0x1e538b){const _0xc8f1dd=a697_0x1cdd59;if(_0x1e538b===undefined)_0x1e538b=_0x316a36;var _0x3a588c=Object[_0xc8f1dd(0x9f)](_0x264a2a,_0x316a36);(!_0x3a588c||('get'in _0x3a588c?!_0x264a2a[_0xc8f1dd(0x91)]:_0x3a588c['writable']||_0x3a588c[_0xc8f1dd(0x83)]))&&(_0x3a588c={'enumerable':!![],'get':function(){return _0x264a2a[_0x316a36];}}),Object[_0xc8f1dd(0x8b)](_0x1aeded,_0x1e538b,_0x3a588c);}:function(_0x4c951d,_0xffda2d,_0x29ecfd,_0x2c25ec){if(_0x2c25ec===undefined)_0x2c25ec=_0x29ecfd;_0x4c951d[_0x2c25ec]=_0xffda2d[_0x29ecfd];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a697_0x1cdd59(0x74)]?function(_0x29d54a,_0x808b27){const _0x20e780=a697_0x1cdd59;Object[_0x20e780(0x8b)](_0x29d54a,_0x20e780(0x81),{'enumerable':!![],'value':_0x808b27});}:function(_0x4bd88b,_0x2d64c4){const _0x5ea8fc=a697_0x1cdd59;_0x4bd88b[_0x5ea8fc(0x81)]=_0x2d64c4;}),__importStar=this&&this[a697_0x1cdd59(0x7d)]||(function(){const _0x57c6ce=(function(){let _0x10cfa6=!![];return function(_0x2bcf82,_0x5a3c1a){const _0x358551=_0x10cfa6?function(){const _0x21ca12=a697_0xa0f2;if(_0x5a3c1a){const _0x489efc=_0x5a3c1a[_0x21ca12(0x7a)](_0x2bcf82,arguments);return _0x5a3c1a=null,_0x489efc;}}:function(){};return _0x10cfa6=![],_0x358551;};}()),_0x5e06ca=_0x57c6ce(this,function(){const _0x30d731=a697_0xa0f2;return _0x5e06ca[_0x30d731(0x7c)]()['search'](_0x30d731(0x8f))[_0x30d731(0x7c)]()[_0x30d731(0x84)](_0x5e06ca)[_0x30d731(0x95)]('(((.+)+)+)+$');});_0x5e06ca();var _0x567416=function(_0x2889dc){const _0x431b44=a697_0xa0f2;return _0x567416=Object[_0x431b44(0xaa)]||function(_0x1d3f09){const _0x5000c0=_0x431b44;var _0x524508=[];for(var _0x19aec9 in _0x1d3f09)if(Object[_0x5000c0(0xa6)][_0x5000c0(0x82)][_0x5000c0(0x85)](_0x1d3f09,_0x19aec9))_0x524508[_0x524508[_0x5000c0(0xa9)]]=_0x19aec9;return _0x524508;},_0x567416(_0x2889dc);};return function(_0x486df3){const _0x37c5cc=a697_0xa0f2;if(_0x486df3&&_0x486df3['__esModule'])return _0x486df3;var _0x384dd3={};if(_0x486df3!=null){for(var _0x21fd53=_0x567416(_0x486df3),_0x2ce6f4=0x0;_0x2ce6f4<_0x21fd53[_0x37c5cc(0xa9)];_0x2ce6f4++)if(_0x21fd53[_0x2ce6f4]!==_0x37c5cc(0x81))__createBinding(_0x384dd3,_0x486df3,_0x21fd53[_0x2ce6f4]);}return __setModuleDefault(_0x384dd3,_0x486df3),_0x384dd3;};}()),__importDefault=this&&this[a697_0x1cdd59(0x7b)]||function(_0x276ce4){const _0x184b88=a697_0x1cdd59;return _0x276ce4&&_0x276ce4[_0x184b88(0x91)]?_0x276ce4:{'default':_0x276ce4};};Object['defineProperty'](exports,a697_0x1cdd59(0x91),{'value':!![]});function a697_0xa0f2(_0x492af7,_0x4f6a99){const _0x5534b6=a697_0x47a8();return a697_0xa0f2=function(_0x25318c,_0x22d823){_0x25318c=_0x25318c-0x74;let _0x47a87e=_0x5534b6[_0x25318c];return _0x47a87e;},a697_0xa0f2(_0x492af7,_0x4f6a99);}const Sentry=__importStar(require('@sentry/node')),async_mutex_1=require(a697_0x1cdd59(0x9c)),Contact_1=__importDefault(require(a697_0x1cdd59(0x97))),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require(a697_0x1cdd59(0x88))),CreateMessageService_1=__importDefault(require(a697_0x1cdd59(0x9b))),contactMutex=new async_mutex_1[(a697_0x1cdd59(0x8d))](),wbotMonitor=async(_0x47c635,_0x14e7e5,_0x235389)=>{const _0x5bf9c4=a697_0x1cdd59;try{_0x47c635['ws']['on'](_0x5bf9c4(0x8a),async _0x6de015=>{const _0x37248e=_0x5bf9c4,_0x408df5=_0x6de015[_0x37248e(0x9e)][0x0];if(_0x408df5[_0x37248e(0x7e)]===_0x37248e(0xa7)){if(_0x14e7e5[_0x37248e(0x8e)]&&!_0x14e7e5[_0x37248e(0xa2)]){const _0x18be54=_0x14e7e5[_0x37248e(0xa1)]?.[_0x37248e(0xa5)]()||'*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitadas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado';await _0x47c635['sendMessage'](_0x6de015['attrs'][_0x37248e(0x96)],{'text':_0x18be54});}const _0x3e7961=_0x6de015[_0x37248e(0x99)][_0x37248e(0x96)]['replace'](/\D/g,''),_0x47c7f0=await Contact_1[_0x37248e(0x81)][_0x37248e(0x79)]({'where':{'companyId':_0x235389,'number':_0x3e7961}});if(!_0x47c7f0)return;const _0x5eab35=await Ticket_1['default'][_0x37248e(0x79)]({'where':{'contactId':_0x47c7f0['id'],'whatsappId':_0x47c635['id'],'status':_0x37248e(0x80),'companyId':_0x235389}});if(!_0x5eab35)return;const _0x2d2be2=new Date(),_0x181b9a=_0x2d2be2['getHours'](),_0x31792f=_0x2d2be2[_0x37248e(0x90)](),_0x50c4f2=_0x37248e(0x8c)+_0x181b9a+':'+_0x31792f,_0x25a97a={'id':_0x408df5[_0x37248e(0x99)][_0x37248e(0x77)],'ticketId':_0x5eab35['id'],'contactId':_0x47c7f0['id'],'body':_0x50c4f2,'fromMe':![],'mediaType':_0x37248e(0xa4),'read':!![],'quotedMsgId':null,'ack':0x1};await _0x5eab35['update']({'lastMessage':_0x50c4f2}),_0x5eab35['status']===_0x37248e(0x76)&&await _0x5eab35[_0x37248e(0xa3)]({'status':_0x37248e(0x89)}),(0x0,CreateMessageService_1[_0x37248e(0x81)])({'messageData':_0x25a97a,'companyId':_0x235389});}}),_0x47c635['ev']['on'](_0x5bf9c4(0x86),async _0x24a361=>{const _0x2f16cb=_0x5bf9c4;logger_1[_0x2f16cb(0x9a)][_0x2f16cb(0xa0)]({'contacts':_0x24a361},_0x2f16cb(0x86)),contactMutex[_0x2f16cb(0x98)](async()=>{const _0x5aab2a=_0x2f16cb;await(0x0,CreateOrUpdateBaileysService_1[_0x5aab2a(0x81)])({'whatsappId':_0x14e7e5['id'],'contacts':_0x24a361});});});}catch(_0x49306a){Sentry[_0x5bf9c4(0xab)](_0x49306a),logger_1[_0x5bf9c4(0x9a)]['error'](_0x49306a);}};exports[a697_0x1cdd59(0x81)]=wbotMonitor;