const a560_0x586644=a560_0x1546;(function(_0x1b07a4,_0x17e179){const _0x2f18a5=a560_0x1546,_0x17a7ff=_0x1b07a4();while(!![]){try{const _0x4f97af=parseInt(_0x2f18a5(0x13a))/0x1+-parseInt(_0x2f18a5(0x156))/0x2*(-parseInt(_0x2f18a5(0x14b))/0x3)+-parseInt(_0x2f18a5(0x150))/0x4*(-parseInt(_0x2f18a5(0x13d))/0x5)+parseInt(_0x2f18a5(0x132))/0x6+-parseInt(_0x2f18a5(0x138))/0x7+parseInt(_0x2f18a5(0x124))/0x8*(-parseInt(_0x2f18a5(0x14c))/0x9)+parseInt(_0x2f18a5(0x12a))/0xa*(-parseInt(_0x2f18a5(0x161))/0xb);if(_0x4f97af===_0x17e179)break;else _0x17a7ff['push'](_0x17a7ff['shift']());}catch(_0x869b32){_0x17a7ff['push'](_0x17a7ff['shift']());}}}(a560_0x49a6,0x46791));function a560_0x1546(_0x1b1f09,_0x3e50a3){const _0x410881=a560_0x49a6();return a560_0x1546=function(_0x42d82f,_0x381b3){_0x42d82f=_0x42d82f-0x122;let _0x49a617=_0x410881[_0x42d82f];return _0x49a617;},a560_0x1546(_0x1b1f09,_0x3e50a3);}const a560_0x381b3=(function(){let _0x32278e=!![];return function(_0xedc35,_0xde34d2){const _0x321f39=_0x32278e?function(){const _0x4e2025=a560_0x1546;if(_0xde34d2){const _0x3fc2a0=_0xde34d2[_0x4e2025(0x127)](_0xedc35,arguments);return _0xde34d2=null,_0x3fc2a0;}}:function(){};return _0x32278e=![],_0x321f39;};}()),a560_0x42d82f=a560_0x381b3(this,function(){const _0x5d0629=a560_0x1546;return a560_0x42d82f[_0x5d0629(0x12e)]()[_0x5d0629(0x129)](_0x5d0629(0x13c))['toString']()['constructor'](a560_0x42d82f)[_0x5d0629(0x129)]('(((.+)+)+)+$');});a560_0x42d82f();'use strict';function a560_0x49a6(){const _0x1be0b3=['call_log','closed','265370Qdqqdy','push','findOne','replace','status','trace','filter','defineProperty','@sentry/node','../../utils/logger','tag','159027qnXNAh','call-id','time','hasOwnProperty','getTime','string','26056djnzfj','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','default','apply','call','search','290tvCUHV','attrs','update','SendPresenceStatus','toString','__setModuleDefault','CB:call','captureException','1618992EGnfVv','offer','get','__esModule','disabled','../../helpers/SendPresenceStatus','187887rKqPgy','__createBinding','274493KCPDwQ','../MessageServices/CreateMessageService','(((.+)+)+)+$','2145asEMNH','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','../../models/Ticket','__importStar','find','configurable','../../models/Contact','from','create','contacts.upsert','getOwnPropertyDescriptor','content','error','open','6dAMMdK','801HTwrRs','getMinutes','getHours','writable','2004CTiWle','body\x20is\x20not\x20a\x20string','prototype','length'];a560_0x49a6=function(){return _0x1be0b3;};return a560_0x49a6();}var __createBinding=this&&this[a560_0x586644(0x139)]||(Object[a560_0x586644(0x145)]?function(_0x49fbca,_0x23ee14,_0x10418f,_0x5e4949){const _0xd8bfc9=a560_0x586644;if(_0x5e4949===undefined)_0x5e4949=_0x10418f;var _0xba4104=Object[_0xd8bfc9(0x147)](_0x23ee14,_0x10418f);(!_0xba4104||(_0xd8bfc9(0x134)in _0xba4104?!_0x23ee14['__esModule']:_0xba4104[_0xd8bfc9(0x14f)]||_0xba4104[_0xd8bfc9(0x142)]))&&(_0xba4104={'enumerable':!![],'get':function(){return _0x23ee14[_0x10418f];}}),Object[_0xd8bfc9(0x15d)](_0x49fbca,_0x5e4949,_0xba4104);}:function(_0x4521a4,_0xc7ce9b,_0x49f34e,_0x5a5f69){if(_0x5a5f69===undefined)_0x5a5f69=_0x49f34e;_0x4521a4[_0x5a5f69]=_0xc7ce9b[_0x49f34e];}),__setModuleDefault=this&&this[a560_0x586644(0x12f)]||(Object[a560_0x586644(0x145)]?function(_0x44db6c,_0x8b97d0){const _0x3faba3=a560_0x586644;Object['defineProperty'](_0x44db6c,_0x3faba3(0x126),{'enumerable':!![],'value':_0x8b97d0});}:function(_0x53e54f,_0x5a0b0f){_0x53e54f['default']=_0x5a0b0f;}),__importStar=this&&this[a560_0x586644(0x140)]||function(_0x4c3192){const _0x58bf4a=a560_0x586644;if(_0x4c3192&&_0x4c3192['__esModule'])return _0x4c3192;var _0x208231={};if(_0x4c3192!=null){for(var _0x4dfc73 in _0x4c3192)if(_0x4dfc73!==_0x58bf4a(0x126)&&Object[_0x58bf4a(0x152)][_0x58bf4a(0x164)]['call'](_0x4c3192,_0x4dfc73))__createBinding(_0x208231,_0x4c3192,_0x4dfc73);}return __setModuleDefault(_0x208231,_0x4c3192),_0x208231;},__importDefault=this&&this['__importDefault']||function(_0xfb363a){return _0xfb363a&&_0xfb363a['__esModule']?_0xfb363a:{'default':_0xfb363a};};Object['defineProperty'](exports,a560_0x586644(0x135),{'value':!![]});const Sentry=__importStar(require(a560_0x586644(0x15e))),Contact_1=__importDefault(require(a560_0x586644(0x143))),Setting_1=__importDefault(require('../../models/Setting')),Ticket_1=__importDefault(require(a560_0x586644(0x13f))),logger_1=require(a560_0x586644(0x15f)),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require(a560_0x586644(0x13b))),SendPresenceStatus_1=require(a560_0x586644(0x137));let messageControl=[];const wbotMonitor=async(_0x2fa1b7,_0x3bf908,_0x39beab)=>{const _0x18030d=a560_0x586644;try{_0x2fa1b7['ws']['on'](_0x18030d(0x130),async _0x185b29=>{const _0x434f18=_0x18030d,_0x3dd457=_0x185b29[_0x434f18(0x148)][0x0];if(_0x3dd457[_0x434f18(0x160)]===_0x434f18(0x133)){const {from:_0x29d3d2,id:_0x2c3177}=_0x185b29['attrs'];}if(_0x3dd457[_0x434f18(0x160)]==='terminate'){const _0x11fe7e=await Setting_1[_0x434f18(0x126)]['findOne']({'where':{'key':_0x434f18(0x128),'companyId':_0x39beab}});if(!_0x11fe7e||_0x11fe7e['value']===_0x434f18(0x136)){if(messageControl[_0x434f18(0x153)]>0x1388)messageControl=[];var _0x35da97=messageControl[_0x434f18(0x141)](_0x154e28=>_0x154e28[_0x434f18(0x144)]===_0x185b29[_0x434f18(0x12b)][_0x434f18(0x144)]);(!_0x35da97||new Date()['getTime']()-_0x35da97[_0x434f18(0x163)]>=0x3e8*0x3c*0x5)&&(await(0x0,SendPresenceStatus_1[_0x434f18(0x12d)])(_0x2fa1b7,_0x185b29[_0x434f18(0x12b)][_0x434f18(0x144)]),await _0x2fa1b7['sendMessage'](_0x185b29[_0x434f18(0x12b)][_0x434f18(0x144)],{'text':_0x434f18(0x125)}),_0x35da97&&(_0x35da97=null,messageControl=messageControl[_0x434f18(0x15c)](_0x328e47=>_0x328e47['from']!==_0x185b29[_0x434f18(0x12b)][_0x434f18(0x144)])));!_0x35da97&&messageControl[_0x434f18(0x157)]({'from':_0x185b29[_0x434f18(0x12b)][_0x434f18(0x144)],'time':new Date()[_0x434f18(0x122)]()});const _0x46136c=_0x185b29[_0x434f18(0x12b)][_0x434f18(0x144)][_0x434f18(0x159)](/\D/g,''),_0x27778d=await Contact_1[_0x434f18(0x126)][_0x434f18(0x158)]({'where':{'companyId':_0x39beab,'number':_0x46136c}}),_0x46df54=await Ticket_1[_0x434f18(0x126)][_0x434f18(0x158)]({'where':{'contactId':_0x27778d['id'],'whatsappId':_0x2fa1b7['id'],'status':_0x434f18(0x14a),'companyId':_0x39beab}});if(!_0x46df54)return;const _0x217297=new Date(),_0x3b50a6=_0x217297[_0x434f18(0x14e)](),_0x2a6f4b=_0x217297[_0x434f18(0x14d)](),_0x4b1c0a=_0x434f18(0x13e)+_0x3b50a6+':'+_0x2a6f4b,_0x248191={'id':_0x3dd457['attrs'][_0x434f18(0x162)],'ticketId':_0x46df54['id'],'contactId':_0x27778d['id'],'body':_0x4b1c0a,'fromMe':![],'mediaType':_0x434f18(0x154),'read':!![],'quotedMsgId':null,'ack':0x1};return typeof _0x4b1c0a!==_0x434f18(0x123)&&console[_0x434f18(0x15b)](_0x434f18(0x151),_0x4b1c0a),await _0x46df54[_0x434f18(0x12c)]({'lastMessage':_0x4b1c0a}),_0x46df54[_0x434f18(0x15a)]===_0x434f18(0x155)&&await _0x46df54[_0x434f18(0x12c)]({'status':'pending'}),(0x0,CreateMessageService_1[_0x434f18(0x126)])({'messageData':_0x248191,'ticket':_0x46df54,'companyId':_0x39beab});}}}),_0x2fa1b7['ev']['on'](_0x18030d(0x146),async _0x198fcb=>{const _0x4d00ef=_0x18030d;await(0x0,CreateOrUpdateBaileysService_1[_0x4d00ef(0x126)])({'whatsappId':_0x3bf908['id'],'contacts':_0x198fcb});});}catch(_0x297f50){Sentry[_0x18030d(0x131)](_0x297f50),logger_1['logger'][_0x18030d(0x149)](_0x297f50);}};exports['default']=wbotMonitor;