function a559_0x4f08(){const _0x557e5b=['prototype','time','default','error','2229160ndUboW','sendMessage','get','../../utils/logger','defineProperty','call','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','body\x20is\x20not\x20a\x20string','4787792GwkRRQ','tag','writable','../../helpers/SendPresenceStatus','offer','contacts.upsert','543102PJmkde','search','disabled','getOwnPropertyDescriptor','56UFjKGd','attrs','getHours','hasOwnProperty','(((.+)+)+)+$','getTime','__esModule','call-id','1056160nYZAMP','from','open','319832TaCAmO','getMinutes','../../models/Contact','@sentry/node','243968pTCxwU','__importDefault','toString','__importStar','update','findOne','create','apply','../../models/Setting','find','replace','string','3305943WePgRI','CB:call','../BaileysServices/CreateOrUpdateBaileysService'];a559_0x4f08=function(){return _0x557e5b;};return a559_0x4f08();}const a559_0x282bf0=a559_0x2579;(function(_0x536eb5,_0x4c5e3b){const _0xedde2c=a559_0x2579,_0x4ff120=_0x536eb5();while(!![]){try{const _0x3be117=-parseInt(_0xedde2c(0x1c7))/0x1+-parseInt(_0xedde2c(0x1cb))/0x2+parseInt(_0xedde2c(0x1a3))/0x3+parseInt(_0xedde2c(0x1c4))/0x4+-parseInt(_0xedde2c(0x1aa))/0x5+-parseInt(_0xedde2c(0x1b8))/0x6*(-parseInt(_0xedde2c(0x1bc))/0x7)+-parseInt(_0xedde2c(0x1b2))/0x8;if(_0x3be117===_0x4c5e3b)break;else _0x4ff120['push'](_0x4ff120['shift']());}catch(_0xd67764){_0x4ff120['push'](_0x4ff120['shift']());}}}(a559_0x4f08,0x93783));const a559_0x3fe7df=(function(){let _0x59624c=!![];return function(_0x460064,_0x55ce2e){const _0x3d2238=_0x59624c?function(){const _0x1c3ded=a559_0x2579;if(_0x55ce2e){const _0x4be545=_0x55ce2e[_0x1c3ded(0x1d2)](_0x460064,arguments);return _0x55ce2e=null,_0x4be545;}}:function(){};return _0x59624c=![],_0x3d2238;};}()),a559_0x28f532=a559_0x3fe7df(this,function(){const _0x16b8fc=a559_0x2579;return a559_0x28f532[_0x16b8fc(0x1cd)]()[_0x16b8fc(0x1b9)](_0x16b8fc(0x1c0))[_0x16b8fc(0x1cd)]()['constructor'](a559_0x28f532)['search'](_0x16b8fc(0x1c0));});a559_0x28f532();function a559_0x2579(_0x16e861,_0xcd239a){const _0x268ac7=a559_0x4f08();return a559_0x2579=function(_0x28f532,_0x3fe7df){_0x28f532=_0x28f532-0x1a1;let _0x4f082a=_0x268ac7[_0x28f532];return _0x4f082a;},a559_0x2579(_0x16e861,_0xcd239a);}'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x25e8c0,_0x3b5edc,_0x32acb9,_0x5ed9f3){const _0x41de34=a559_0x2579;if(_0x5ed9f3===undefined)_0x5ed9f3=_0x32acb9;var _0x3d2324=Object[_0x41de34(0x1bb)](_0x3b5edc,_0x32acb9);(!_0x3d2324||(_0x41de34(0x1ac)in _0x3d2324?!_0x3b5edc[_0x41de34(0x1c2)]:_0x3d2324[_0x41de34(0x1b4)]||_0x3d2324['configurable']))&&(_0x3d2324={'enumerable':!![],'get':function(){return _0x3b5edc[_0x32acb9];}}),Object[_0x41de34(0x1ae)](_0x25e8c0,_0x5ed9f3,_0x3d2324);}:function(_0x25e821,_0x3ebdbd,_0x5ed9fc,_0x1e65cf){if(_0x1e65cf===undefined)_0x1e65cf=_0x5ed9fc;_0x25e821[_0x1e65cf]=_0x3ebdbd[_0x5ed9fc];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a559_0x282bf0(0x1d1)]?function(_0x348082,_0x2c4c0b){const _0x4bb67b=a559_0x282bf0;Object[_0x4bb67b(0x1ae)](_0x348082,_0x4bb67b(0x1a8),{'enumerable':!![],'value':_0x2c4c0b});}:function(_0x2c11d5,_0x457085){const _0x5a663f=a559_0x282bf0;_0x2c11d5[_0x5a663f(0x1a8)]=_0x457085;}),__importStar=this&&this[a559_0x282bf0(0x1ce)]||function(_0x2df51b){const _0x1e5cdd=a559_0x282bf0;if(_0x2df51b&&_0x2df51b[_0x1e5cdd(0x1c2)])return _0x2df51b;var _0x150031={};if(_0x2df51b!=null){for(var _0x2d4b28 in _0x2df51b)if(_0x2d4b28!==_0x1e5cdd(0x1a8)&&Object[_0x1e5cdd(0x1a6)][_0x1e5cdd(0x1bf)][_0x1e5cdd(0x1af)](_0x2df51b,_0x2d4b28))__createBinding(_0x150031,_0x2df51b,_0x2d4b28);}return __setModuleDefault(_0x150031,_0x2df51b),_0x150031;},__importDefault=this&&this[a559_0x282bf0(0x1cc)]||function(_0x444793){const _0x7a2166=a559_0x282bf0;return _0x444793&&_0x444793[_0x7a2166(0x1c2)]?_0x444793:{'default':_0x444793};};Object[a559_0x282bf0(0x1ae)](exports,a559_0x282bf0(0x1c2),{'value':!![]});const Sentry=__importStar(require(a559_0x282bf0(0x1ca))),Contact_1=__importDefault(require(a559_0x282bf0(0x1c9))),Setting_1=__importDefault(require(a559_0x282bf0(0x1d3))),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require(a559_0x282bf0(0x1ad)),CreateOrUpdateBaileysService_1=__importDefault(require(a559_0x282bf0(0x1a5))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),SendPresenceStatus_1=require(a559_0x282bf0(0x1b5));let messageControl=[];const wbotMonitor=async(_0x298c86,_0x1ad13e,_0x58659e)=>{const _0x509f1f=a559_0x282bf0;try{_0x298c86['ws']['on'](_0x509f1f(0x1a4),async _0x536b30=>{const _0x23d47a=_0x509f1f,_0xaa9dbe=_0x536b30['content'][0x0];if(_0xaa9dbe[_0x23d47a(0x1b3)]===_0x23d47a(0x1b6)){const {from:_0x2454d1,id:_0x1864ed}=_0x536b30[_0x23d47a(0x1bd)];}if(_0xaa9dbe[_0x23d47a(0x1b3)]==='terminate'){const _0x1ba0f5=await Setting_1[_0x23d47a(0x1a8)][_0x23d47a(0x1d0)]({'where':{'key':'call','companyId':_0x58659e}});if(!_0x1ba0f5||_0x1ba0f5['value']===_0x23d47a(0x1ba)){if(messageControl['length']>0x1388)messageControl=[];var _0x13009c=messageControl[_0x23d47a(0x1d4)](_0x41ad57=>_0x41ad57[_0x23d47a(0x1c5)]===_0x536b30['attrs'][_0x23d47a(0x1c5)]);(!_0x13009c||new Date()[_0x23d47a(0x1c1)]()-_0x13009c[_0x23d47a(0x1a7)]>=0x3e8*0x3c*0x5)&&(await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x298c86,_0x536b30[_0x23d47a(0x1bd)][_0x23d47a(0x1c5)]),await _0x298c86[_0x23d47a(0x1ab)](_0x536b30[_0x23d47a(0x1bd)][_0x23d47a(0x1c5)],{'text':'*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado'}),_0x13009c&&(_0x13009c=null,messageControl=messageControl['filter'](_0x3da6a5=>_0x3da6a5['from']!==_0x536b30[_0x23d47a(0x1bd)][_0x23d47a(0x1c5)])));!_0x13009c&&messageControl['push']({'from':_0x536b30[_0x23d47a(0x1bd)][_0x23d47a(0x1c5)],'time':new Date()[_0x23d47a(0x1c1)]()});const _0x443503=_0x536b30[_0x23d47a(0x1bd)][_0x23d47a(0x1c5)][_0x23d47a(0x1a1)](/\D/g,''),_0x31eeb5=await Contact_1[_0x23d47a(0x1a8)][_0x23d47a(0x1d0)]({'where':{'companyId':_0x58659e,'number':_0x443503}}),_0x37be7e=await Ticket_1[_0x23d47a(0x1a8)][_0x23d47a(0x1d0)]({'where':{'contactId':_0x31eeb5['id'],'whatsappId':_0x298c86['id'],'status':_0x23d47a(0x1c6),'companyId':_0x58659e}});if(!_0x37be7e)return;const _0x2ca1b6=new Date(),_0x2c1d25=_0x2ca1b6[_0x23d47a(0x1be)](),_0x51d6b2=_0x2ca1b6[_0x23d47a(0x1c8)](),_0x292e7a=_0x23d47a(0x1b0)+_0x2c1d25+':'+_0x51d6b2,_0x435565={'id':_0xaa9dbe[_0x23d47a(0x1bd)][_0x23d47a(0x1c3)],'ticketId':_0x37be7e['id'],'contactId':_0x31eeb5['id'],'body':_0x292e7a,'fromMe':![],'mediaType':'call_log','read':!![],'quotedMsgId':null,'ack':0x1};return typeof _0x292e7a!==_0x23d47a(0x1a2)&&console['trace'](_0x23d47a(0x1b1),_0x292e7a),await _0x37be7e[_0x23d47a(0x1cf)]({'lastMessage':_0x292e7a}),_0x37be7e['status']==='closed'&&await _0x37be7e[_0x23d47a(0x1cf)]({'status':'pending'}),(0x0,CreateMessageService_1['default'])({'messageData':_0x435565,'ticket':_0x37be7e,'companyId':_0x58659e});}}}),_0x298c86['ev']['on'](_0x509f1f(0x1b7),async _0xd6daf1=>{const _0xc09b93=_0x509f1f;await(0x0,CreateOrUpdateBaileysService_1[_0xc09b93(0x1a8)])({'whatsappId':_0x1ad13e['id'],'contacts':_0xd6daf1});});}catch(_0x1f2e06){Sentry['captureException'](_0x1f2e06),logger_1['logger'][_0x509f1f(0x1a9)](_0x1f2e06);}};exports[a559_0x282bf0(0x1a8)]=wbotMonitor;