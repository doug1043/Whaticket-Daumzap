const a560_0x2d6286=a560_0x581a;(function(_0x30f2d8,_0x598c69){const _0x503a29=a560_0x581a,_0x3b61e3=_0x30f2d8();while(!![]){try{const _0x37d0a1=-parseInt(_0x503a29(0x1bf))/0x1*(-parseInt(_0x503a29(0x198))/0x2)+parseInt(_0x503a29(0x19d))/0x3*(-parseInt(_0x503a29(0x1ce))/0x4)+-parseInt(_0x503a29(0x1b1))/0x5*(parseInt(_0x503a29(0x1c0))/0x6)+-parseInt(_0x503a29(0x1a1))/0x7+parseInt(_0x503a29(0x1b2))/0x8+-parseInt(_0x503a29(0x1b3))/0x9+-parseInt(_0x503a29(0x1a6))/0xa*(-parseInt(_0x503a29(0x1ca))/0xb);if(_0x37d0a1===_0x598c69)break;else _0x3b61e3['push'](_0x3b61e3['shift']());}catch(_0x3a8d74){_0x3b61e3['push'](_0x3b61e3['shift']());}}}(a560_0x1aeb,0x53112));const a560_0x3724ac=(function(){let _0x248db6=!![];return function(_0x210925,_0x28eee7){const _0x17b1d3=_0x248db6?function(){const _0x90ade3=a560_0x581a;if(_0x28eee7){const _0x4762d9=_0x28eee7[_0x90ade3(0x195)](_0x210925,arguments);return _0x28eee7=null,_0x4762d9;}}:function(){};return _0x248db6=![],_0x17b1d3;};}()),a560_0x46ae04=a560_0x3724ac(this,function(){const _0x5330f1=a560_0x581a;return a560_0x46ae04[_0x5330f1(0x199)]()[_0x5330f1(0x1b4)](_0x5330f1(0x192))[_0x5330f1(0x199)]()[_0x5330f1(0x1c2)](a560_0x46ae04)[_0x5330f1(0x1b4)]('(((.+)+)+)+$');});a560_0x46ae04();function a560_0x1aeb(){const _0x59d588=['__createBinding','length','4617501FvDpyj','getOwnPropertyDescriptor','../../utils/logger','call-id','pending','330irPKLX','value','getTime','update','getMinutes','__setModuleDefault','SendPresenceStatus','../../models/Setting','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','@sentry/node','from','10WGxIoP','1004056cTIGeD','4641741eEkDVW','search','../../models/Ticket','filter','terminate','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','find','offer','hasOwnProperty','logger','tag','default','1LJhRPB','1844058HPUWoV','create','constructor','string','prototype','defineProperty','configurable','../../helpers/SendPresenceStatus','closed','__esModule','565774XuAaAU','open','findOne','attrs','3208qsXWAB','call','status','(((.+)+)+)+$','body\x20is\x20not\x20a\x20string','../BaileysServices/CreateOrUpdateBaileysService','apply','push','getHours','1224502aoWTBl','toString','writable','CB:call','captureException','1140mPIaEl','sendMessage'];a560_0x1aeb=function(){return _0x59d588;};return a560_0x1aeb();}'use strict';var __createBinding=this&&this[a560_0x2d6286(0x19f)]||(Object[a560_0x2d6286(0x1c1)]?function(_0x582122,_0x3aa5f4,_0x5465b4,_0x11bc58){const _0x6b7fb9=a560_0x2d6286;if(_0x11bc58===undefined)_0x11bc58=_0x5465b4;var _0x4951cf=Object[_0x6b7fb9(0x1a2)](_0x3aa5f4,_0x5465b4);(!_0x4951cf||('get'in _0x4951cf?!_0x3aa5f4[_0x6b7fb9(0x1c9)]:_0x4951cf[_0x6b7fb9(0x19a)]||_0x4951cf[_0x6b7fb9(0x1c6)]))&&(_0x4951cf={'enumerable':!![],'get':function(){return _0x3aa5f4[_0x5465b4];}}),Object[_0x6b7fb9(0x1c5)](_0x582122,_0x11bc58,_0x4951cf);}:function(_0x115db5,_0x29a981,_0x306ec4,_0x17daf2){if(_0x17daf2===undefined)_0x17daf2=_0x306ec4;_0x115db5[_0x17daf2]=_0x29a981[_0x306ec4];}),__setModuleDefault=this&&this[a560_0x2d6286(0x1ab)]||(Object[a560_0x2d6286(0x1c1)]?function(_0x35631d,_0x42c9cc){const _0x272bc4=a560_0x2d6286;Object[_0x272bc4(0x1c5)](_0x35631d,_0x272bc4(0x1be),{'enumerable':!![],'value':_0x42c9cc});}:function(_0x990051,_0x15561f){const _0x4c84bf=a560_0x2d6286;_0x990051[_0x4c84bf(0x1be)]=_0x15561f;}),__importStar=this&&this['__importStar']||function(_0x25939d){const _0x15e464=a560_0x2d6286;if(_0x25939d&&_0x25939d['__esModule'])return _0x25939d;var _0x2822c7={};if(_0x25939d!=null){for(var _0x112479 in _0x25939d)if(_0x112479!==_0x15e464(0x1be)&&Object[_0x15e464(0x1c4)][_0x15e464(0x1bb)][_0x15e464(0x1cf)](_0x25939d,_0x112479))__createBinding(_0x2822c7,_0x25939d,_0x112479);}return __setModuleDefault(_0x2822c7,_0x25939d),_0x2822c7;},__importDefault=this&&this['__importDefault']||function(_0x5c6362){return _0x5c6362&&_0x5c6362['__esModule']?_0x5c6362:{'default':_0x5c6362};};Object[a560_0x2d6286(0x1c5)](exports,'__esModule',{'value':!![]});const Sentry=__importStar(require(a560_0x2d6286(0x1af))),Contact_1=__importDefault(require('../../models/Contact')),Setting_1=__importDefault(require(a560_0x2d6286(0x1ad))),Ticket_1=__importDefault(require(a560_0x2d6286(0x1b5))),logger_1=require(a560_0x2d6286(0x1a3)),CreateOrUpdateBaileysService_1=__importDefault(require(a560_0x2d6286(0x194))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),SendPresenceStatus_1=require(a560_0x2d6286(0x1c7));let messageControl=[];const wbotMonitor=async(_0x44201b,_0x198a20,_0x6e7bed)=>{const _0x29c909=a560_0x2d6286;try{_0x44201b['ws']['on'](_0x29c909(0x19b),async _0x1557c4=>{const _0x1ee8f5=_0x29c909,_0x299d67=_0x1557c4['content'][0x0];if(_0x299d67['tag']===_0x1ee8f5(0x1ba)){const {from:_0xf8a8fc,id:_0x18cf31}=_0x1557c4[_0x1ee8f5(0x1cd)];}if(_0x299d67[_0x1ee8f5(0x1bd)]===_0x1ee8f5(0x1b7)){const _0x3dfcc8=await Setting_1[_0x1ee8f5(0x1be)][_0x1ee8f5(0x1cc)]({'where':{'key':'call','companyId':_0x6e7bed}});if(!_0x3dfcc8||_0x3dfcc8[_0x1ee8f5(0x1a7)]==='disabled'){if(messageControl[_0x1ee8f5(0x1a0)]>0x1388)messageControl=[];var _0x1d6f67=messageControl[_0x1ee8f5(0x1b9)](_0x308299=>_0x308299[_0x1ee8f5(0x1b0)]===_0x1557c4['attrs'][_0x1ee8f5(0x1b0)]);(!_0x1d6f67||new Date()[_0x1ee8f5(0x1a8)]()-_0x1d6f67['time']>=0x3e8*0x3c*0x5)&&(await(0x0,SendPresenceStatus_1[_0x1ee8f5(0x1ac)])(_0x44201b,_0x1557c4[_0x1ee8f5(0x1cd)][_0x1ee8f5(0x1b0)]),await _0x44201b[_0x1ee8f5(0x19e)](_0x1557c4['attrs'][_0x1ee8f5(0x1b0)],{'text':_0x1ee8f5(0x1b8)}),_0x1d6f67&&(_0x1d6f67=null,messageControl=messageControl[_0x1ee8f5(0x1b6)](_0x30fa63=>_0x30fa63['from']!==_0x1557c4[_0x1ee8f5(0x1cd)][_0x1ee8f5(0x1b0)])));!_0x1d6f67&&messageControl[_0x1ee8f5(0x196)]({'from':_0x1557c4[_0x1ee8f5(0x1cd)][_0x1ee8f5(0x1b0)],'time':new Date()['getTime']()});const _0x53c21e=_0x1557c4[_0x1ee8f5(0x1cd)][_0x1ee8f5(0x1b0)]['replace'](/\D/g,''),_0x270fbb=await Contact_1[_0x1ee8f5(0x1be)][_0x1ee8f5(0x1cc)]({'where':{'companyId':_0x6e7bed,'number':_0x53c21e}}),_0x5f631f=await Ticket_1[_0x1ee8f5(0x1be)][_0x1ee8f5(0x1cc)]({'where':{'contactId':_0x270fbb['id'],'whatsappId':_0x44201b['id'],'status':_0x1ee8f5(0x1cb),'companyId':_0x6e7bed}});if(!_0x5f631f)return;const _0x4380eb=new Date(),_0x2a5b4c=_0x4380eb[_0x1ee8f5(0x197)](),_0xc68a2d=_0x4380eb[_0x1ee8f5(0x1aa)](),_0x4930f6=_0x1ee8f5(0x1ae)+_0x2a5b4c+':'+_0xc68a2d,_0x3a0211={'id':_0x299d67[_0x1ee8f5(0x1cd)][_0x1ee8f5(0x1a4)],'ticketId':_0x5f631f['id'],'contactId':_0x270fbb['id'],'body':_0x4930f6,'fromMe':![],'mediaType':'call_log','read':!![],'quotedMsgId':null,'ack':0x1};return typeof _0x4930f6!==_0x1ee8f5(0x1c3)&&console['trace'](_0x1ee8f5(0x193),_0x4930f6),await _0x5f631f[_0x1ee8f5(0x1a9)]({'lastMessage':_0x4930f6}),_0x5f631f[_0x1ee8f5(0x1d0)]===_0x1ee8f5(0x1c8)&&await _0x5f631f[_0x1ee8f5(0x1a9)]({'status':_0x1ee8f5(0x1a5)}),(0x0,CreateMessageService_1[_0x1ee8f5(0x1be)])({'messageData':_0x3a0211,'ticket':_0x5f631f,'companyId':_0x6e7bed});}}}),_0x44201b['ev']['on']('contacts.upsert',async _0x538d48=>{const _0x25e4df=_0x29c909;await(0x0,CreateOrUpdateBaileysService_1[_0x25e4df(0x1be)])({'whatsappId':_0x198a20['id'],'contacts':_0x538d48});});}catch(_0x19a9f4){Sentry[_0x29c909(0x19c)](_0x19a9f4),logger_1[_0x29c909(0x1bc)]['error'](_0x19a9f4);}};function a560_0x581a(_0x34dfb1,_0x7a62fb){const _0xaa6c7=a560_0x1aeb();return a560_0x581a=function(_0x46ae04,_0x3724ac){_0x46ae04=_0x46ae04-0x192;let _0x1aeb21=_0xaa6c7[_0x46ae04];return _0x1aeb21;},a560_0x581a(_0x34dfb1,_0x7a62fb);}exports[a560_0x2d6286(0x1be)]=wbotMonitor;