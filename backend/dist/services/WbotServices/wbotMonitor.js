function a551_0x2597(_0x5b03cb,_0x4e3066){const _0x4697e5=a551_0x38de();return a551_0x2597=function(_0x20b4ad,_0x16537f){_0x20b4ad=_0x20b4ad-0xf5;let _0x38ded8=_0x4697e5[_0x20b4ad];return _0x38ded8;},a551_0x2597(_0x5b03cb,_0x4e3066);}const a551_0x46305c=a551_0x2597;(function(_0x3e2ee5,_0x3233b6){const _0x247dd3=a551_0x2597,_0x222e3c=_0x3e2ee5();while(!![]){try{const _0x3d74da=-parseInt(_0x247dd3(0x12d))/0x1+parseInt(_0x247dd3(0x122))/0x2+-parseInt(_0x247dd3(0x131))/0x3+-parseInt(_0x247dd3(0x112))/0x4*(-parseInt(_0x247dd3(0x129))/0x5)+parseInt(_0x247dd3(0x12b))/0x6*(parseInt(_0x247dd3(0xfd))/0x7)+-parseInt(_0x247dd3(0x10d))/0x8+parseInt(_0x247dd3(0xf8))/0x9*(-parseInt(_0x247dd3(0x12a))/0xa);if(_0x3d74da===_0x3233b6)break;else _0x222e3c['push'](_0x222e3c['shift']());}catch(_0x208e3b){_0x222e3c['push'](_0x222e3c['shift']());}}}(a551_0x38de,0x4871c));const a551_0x16537f=(function(){let _0x16fd12=!![];return function(_0x2b46c0,_0x29f950){const _0x2a3f22=_0x16fd12?function(){const _0xdb34b5=a551_0x2597;if(_0x29f950){const _0x498558=_0x29f950[_0xdb34b5(0x105)](_0x2b46c0,arguments);return _0x29f950=null,_0x498558;}}:function(){};return _0x16fd12=![],_0x2a3f22;};}()),a551_0x20b4ad=a551_0x16537f(this,function(){const _0x4995f4=a551_0x2597;return a551_0x20b4ad[_0x4995f4(0x139)]()['search'](_0x4995f4(0x113))[_0x4995f4(0x139)]()[_0x4995f4(0x11a)](a551_0x20b4ad)['search'](_0x4995f4(0x113));});a551_0x20b4ad();'use strict';var __createBinding=this&&this[a551_0x46305c(0x10b)]||(Object['create']?function(_0x2ce6cf,_0x5f4d81,_0x108ebb,_0xe4e98c){const _0x3569ea=a551_0x46305c;if(_0xe4e98c===undefined)_0xe4e98c=_0x108ebb;var _0x29ac9a=Object[_0x3569ea(0x111)](_0x5f4d81,_0x108ebb);(!_0x29ac9a||(_0x3569ea(0xfc)in _0x29ac9a?!_0x5f4d81[_0x3569ea(0xf5)]:_0x29ac9a[_0x3569ea(0xfe)]||_0x29ac9a[_0x3569ea(0x132)]))&&(_0x29ac9a={'enumerable':!![],'get':function(){return _0x5f4d81[_0x108ebb];}}),Object['defineProperty'](_0x2ce6cf,_0xe4e98c,_0x29ac9a);}:function(_0x6be928,_0x1217f3,_0x318533,_0x79c0a1){if(_0x79c0a1===undefined)_0x79c0a1=_0x318533;_0x6be928[_0x79c0a1]=_0x1217f3[_0x318533];}),__setModuleDefault=this&&this[a551_0x46305c(0x120)]||(Object[a551_0x46305c(0x106)]?function(_0x2f35dd,_0x119050){const _0x344e3d=a551_0x46305c;Object[_0x344e3d(0x12c)](_0x2f35dd,_0x344e3d(0x135),{'enumerable':!![],'value':_0x119050});}:function(_0xee0639,_0x3e0cbc){const _0x1036ec=a551_0x46305c;_0xee0639[_0x1036ec(0x135)]=_0x3e0cbc;}),__importStar=this&&this[a551_0x46305c(0x125)]||function(_0x50d128){const _0x5f3701=a551_0x46305c;if(_0x50d128&&_0x50d128[_0x5f3701(0xf5)])return _0x50d128;var _0x5bc9a0={};if(_0x50d128!=null){for(var _0x5122fd in _0x50d128)if(_0x5122fd!==_0x5f3701(0x135)&&Object['prototype'][_0x5f3701(0x10a)]['call'](_0x50d128,_0x5122fd))__createBinding(_0x5bc9a0,_0x50d128,_0x5122fd);}return __setModuleDefault(_0x5bc9a0,_0x50d128),_0x5bc9a0;},__importDefault=this&&this['__importDefault']||function(_0xaf53fc){const _0x1d122d=a551_0x46305c;return _0xaf53fc&&_0xaf53fc[_0x1d122d(0xf5)]?_0xaf53fc:{'default':_0xaf53fc};};function a551_0x38de(){const _0x418d4b=['1022500gkrkgQ','SendPresenceStatus','set','__importStar','closed','REDIS_PASSWORD','env','9760fspyiw','5540BwyGfk','6SNupih','defineProperty','53348zASVYj','HH:mm','../MessageServices/CreateMessageService','../../models/Contact','952506zPtuPu','configurable','6379','replace','default','tag','ioredis','terminate','toString','disabled','__esModule','REDIS_PORT','../../models/Ticket','2169oFOSdY','findOne','REDIS_HOST','../../utils/logger','get','2530549DagCjS','writable','@sentry/node','update','attrs','call_log','status','logger','apply','create','format','{time}','callLogMsg','hasOwnProperty','__createBinding','call-id','2400360ejtMds','exists','now','error','getOwnPropertyDescriptor','468iVumJC','(((.+)+)+)+$','callMsg','127.0.0.1','sendMessage','open','value','call-control:','constructor','trim','contacts.upsert','CB:call','../../models/Setting','pending','__setModuleDefault','call'];a551_0x38de=function(){return _0x418d4b;};return a551_0x38de();}Object[a551_0x46305c(0x12c)](exports,a551_0x46305c(0xf5),{'value':!![]});const Sentry=__importStar(require(a551_0x46305c(0xff))),ioredis_1=__importDefault(require(a551_0x46305c(0x137))),date_fns_1=require('date-fns'),Contact_1=__importDefault(require(a551_0x46305c(0x130))),Setting_1=__importDefault(require(a551_0x46305c(0x11e))),Ticket_1=__importDefault(require(a551_0x46305c(0xf7))),logger_1=require(a551_0x46305c(0xfb)),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require(a551_0x46305c(0x12f))),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus'),redis=new ioredis_1[(a551_0x46305c(0x135))]({'port':parseInt(process[a551_0x46305c(0x128)][a551_0x46305c(0xf6)]||a551_0x46305c(0x133)),'host':process[a551_0x46305c(0x128)][a551_0x46305c(0xfa)]||a551_0x46305c(0x115),'password':process[a551_0x46305c(0x128)][a551_0x46305c(0x127)]}),REDIS_PREFIX=a551_0x46305c(0x119),COOLDOWN_SECONDS=0x12c,wbotMonitor=async(_0x433891,_0xbcfadb,_0x449a6d)=>{const _0x53037a=a551_0x46305c;try{_0x433891['ws']['on'](_0x53037a(0x11d),async _0xc08d70=>{const _0x7db785=_0x53037a,_0x521dd0=_0xc08d70['content'][0x0],{from:_0x1b3c85}=_0xc08d70[_0x7db785(0x101)];if(_0x521dd0[_0x7db785(0x136)]===_0x7db785(0x138)){const _0x2ce9df=await Setting_1['default'][_0x7db785(0xf9)]({'where':{'key':_0x7db785(0x121),'companyId':_0x449a6d}});if(!_0x2ce9df||_0x2ce9df['value']===_0x7db785(0x13a)){const _0x4a5571=REDIS_PREFIX+_0x1b3c85,_0x4a02d9=await redis[_0x7db785(0x10e)](_0x4a5571);if(!_0x4a02d9){const _0x2a6ada=await Setting_1[_0x7db785(0x135)]['findOne']({'where':{'key':_0x7db785(0x114),'companyId':_0x449a6d}});_0x2a6ada&&_0x2a6ada['value'][_0x7db785(0x11b)]()!==''&&(await(0x0,SendPresenceStatus_1[_0x7db785(0x123)])(_0x433891,_0x1b3c85),await _0x433891[_0x7db785(0x116)](_0x1b3c85,{'text':_0x2a6ada[_0x7db785(0x118)]}),await redis[_0x7db785(0x124)](_0x4a5571,Date[_0x7db785(0x10f)](),'EX',COOLDOWN_SECONDS));}const _0x5d183c=_0x1b3c85[_0x7db785(0x134)](/\D/g,''),_0x3254f9=await Contact_1['default'][_0x7db785(0xf9)]({'where':{'companyId':_0x449a6d,'number':_0x5d183c}});if(!_0x3254f9)return;const _0x4a0e51=await Ticket_1[_0x7db785(0x135)][_0x7db785(0xf9)]({'where':{'contactId':_0x3254f9['id'],'whatsappId':_0x433891['id'],'status':_0x7db785(0x117),'companyId':_0x449a6d}});if(!_0x4a0e51)return;const _0xb308a3=(0x0,date_fns_1[_0x7db785(0x107)])(new Date(),_0x7db785(0x12e)),_0x388dee=await Setting_1[_0x7db785(0x135)][_0x7db785(0xf9)]({'where':{'key':_0x7db785(0x109),'companyId':_0x449a6d}});if(_0x388dee&&_0x388dee[_0x7db785(0x118)][_0x7db785(0x11b)]()!==''){const _0x455b50={'id':_0x521dd0[_0x7db785(0x101)][_0x7db785(0x10c)],'ticketId':_0x4a0e51['id'],'contactId':_0x3254f9['id'],'body':_0x388dee['value'][_0x7db785(0x134)](_0x7db785(0x108),_0xb308a3),'fromMe':![],'mediaType':_0x7db785(0x102),'read':!![],'quotedMsgId':null,'ack':0x1};await _0x4a0e51[_0x7db785(0x100)]({'lastMessage':_0x455b50['body']}),_0x4a0e51[_0x7db785(0x103)]===_0x7db785(0x126)&&await _0x4a0e51[_0x7db785(0x100)]({'status':_0x7db785(0x11f)}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x455b50,'ticket':_0x4a0e51,'companyId':_0x449a6d});}}}}),_0x433891['ev']['on'](_0x53037a(0x11c),async _0x3d330c=>{const _0x255c7a=_0x53037a;await(0x0,CreateOrUpdateBaileysService_1[_0x255c7a(0x135)])({'whatsappId':_0xbcfadb['id'],'contacts':_0x3d330c});});}catch(_0x30432d){Sentry['captureException'](_0x30432d),logger_1[_0x53037a(0x104)][_0x53037a(0x110)](_0x30432d);}};exports[a551_0x46305c(0x135)]=wbotMonitor;