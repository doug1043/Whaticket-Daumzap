const a559_0x51862f=a559_0x1fe4;function a559_0x1fe4(_0x4ac73e,_0x30a293){const _0x564834=a559_0x4601();return a559_0x1fe4=function(_0x333f0,_0x26a90b){_0x333f0=_0x333f0-0x186;let _0x460113=_0x564834[_0x333f0];return _0x460113;},a559_0x1fe4(_0x4ac73e,_0x30a293);}(function(_0x598275,_0x5b896d){const _0x31a505=a559_0x1fe4,_0x444427=_0x598275();while(!![]){try{const _0x19eb1c=-parseInt(_0x31a505(0x18c))/0x1*(parseInt(_0x31a505(0x1c6))/0x2)+-parseInt(_0x31a505(0x1ae))/0x3*(-parseInt(_0x31a505(0x1c3))/0x4)+parseInt(_0x31a505(0x19a))/0x5+-parseInt(_0x31a505(0x1bc))/0x6+-parseInt(_0x31a505(0x1ab))/0x7*(-parseInt(_0x31a505(0x1a8))/0x8)+-parseInt(_0x31a505(0x1b0))/0x9+-parseInt(_0x31a505(0x1ad))/0xa;if(_0x19eb1c===_0x5b896d)break;else _0x444427['push'](_0x444427['shift']());}catch(_0x3841a5){_0x444427['push'](_0x444427['shift']());}}}(a559_0x4601,0xcf791));const a559_0x26a90b=(function(){let _0x252f87=!![];return function(_0x274952,_0x31c546){const _0x5bf08f=_0x252f87?function(){if(_0x31c546){const _0x484940=_0x31c546['apply'](_0x274952,arguments);return _0x31c546=null,_0x484940;}}:function(){};return _0x252f87=![],_0x5bf08f;};}()),a559_0x333f0=a559_0x26a90b(this,function(){const _0x55d534=a559_0x1fe4;return a559_0x333f0[_0x55d534(0x1b7)]()[_0x55d534(0x1be)](_0x55d534(0x190))['toString']()[_0x55d534(0x1c7)](a559_0x333f0)[_0x55d534(0x1be)](_0x55d534(0x190));});a559_0x333f0();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a559_0x51862f(0x189)]?function(_0x5c623d,_0x450448,_0x380756,_0xffa6d2){const _0x32a32e=a559_0x51862f;if(_0xffa6d2===undefined)_0xffa6d2=_0x380756;var _0x23d379=Object[_0x32a32e(0x1a2)](_0x450448,_0x380756);(!_0x23d379||(_0x32a32e(0x197)in _0x23d379?!_0x450448[_0x32a32e(0x1b9)]:_0x23d379[_0x32a32e(0x1b5)]||_0x23d379[_0x32a32e(0x1c1)]))&&(_0x23d379={'enumerable':!![],'get':function(){return _0x450448[_0x380756];}}),Object[_0x32a32e(0x187)](_0x5c623d,_0xffa6d2,_0x23d379);}:function(_0x1fbb36,_0x4f93bc,_0x331f95,_0x10e2ad){if(_0x10e2ad===undefined)_0x10e2ad=_0x331f95;_0x1fbb36[_0x10e2ad]=_0x4f93bc[_0x331f95];}),__setModuleDefault=this&&this[a559_0x51862f(0x18d)]||(Object['create']?function(_0x1c248f,_0x25f245){const _0x1748fb=a559_0x51862f;Object[_0x1748fb(0x187)](_0x1c248f,_0x1748fb(0x1aa),{'enumerable':!![],'value':_0x25f245});}:function(_0x5cd7c0,_0x5d7a13){const _0x2f71c6=a559_0x51862f;_0x5cd7c0[_0x2f71c6(0x1aa)]=_0x5d7a13;}),__importStar=this&&this[a559_0x51862f(0x199)]||function(_0x2c742c){const _0x4c4b72=a559_0x51862f;if(_0x2c742c&&_0x2c742c[_0x4c4b72(0x1b9)])return _0x2c742c;var _0x44732c={};if(_0x2c742c!=null){for(var _0x323e19 in _0x2c742c)if(_0x323e19!==_0x4c4b72(0x1aa)&&Object[_0x4c4b72(0x1c2)][_0x4c4b72(0x1c4)][_0x4c4b72(0x19f)](_0x2c742c,_0x323e19))__createBinding(_0x44732c,_0x2c742c,_0x323e19);}return __setModuleDefault(_0x44732c,_0x2c742c),_0x44732c;},__importDefault=this&&this[a559_0x51862f(0x1c8)]||function(_0x10b9c6){const _0x41ac22=a559_0x51862f;return _0x10b9c6&&_0x10b9c6[_0x41ac22(0x1b9)]?_0x10b9c6:{'default':_0x10b9c6};};Object[a559_0x51862f(0x187)](exports,a559_0x51862f(0x1b9),{'value':!![]});const Sentry=__importStar(require(a559_0x51862f(0x194))),Contact_1=__importDefault(require(a559_0x51862f(0x193))),Setting_1=__importDefault(require('../../models/Setting')),Ticket_1=__importDefault(require(a559_0x51862f(0x18f))),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require(a559_0x51862f(0x1b1))),CreateMessageService_1=__importDefault(require(a559_0x51862f(0x1ba))),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus');function a559_0x4601(){const _0x3f0e9f=['14247650IbpZVA','312243CeGXgd','call-id','2453373bxmnWS','../BaileysServices/CreateOrUpdateBaileysService','findOne','offer','tag','writable','find','toString','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','__esModule','../MessageServices/CreateMessageService','filter','5156682CLQCpK','getTime','search','push','terminate','configurable','prototype','20pyfjZe','hasOwnProperty','content','27802XWdJLd','constructor','__importDefault','SendPresenceStatus','open','defineProperty','string','create','update','error','1RRVIYF','__setModuleDefault','length','../../models/Ticket','(((.+)+)+)+$','getMinutes','call_log','../../models/Contact','@sentry/node','closed','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','get','time','__importStar','6469085ekFwqn','from','replace','trace','logger','call','captureException','CB:call','getOwnPropertyDescriptor','pending','contacts.upsert','attrs','body\x20is\x20not\x20a\x20string','sendMessage','1288tbDgbM','value','default','69839IIItvh','disabled'];a559_0x4601=function(){return _0x3f0e9f;};return a559_0x4601();}let messageControl=[];const wbotMonitor=async(_0x521fe9,_0x31c278,_0x424a11)=>{const _0x2f6077=a559_0x51862f;try{_0x521fe9['ws']['on'](_0x2f6077(0x1a1),async _0x5b8365=>{const _0x18e318=_0x2f6077,_0x51ad46=_0x5b8365[_0x18e318(0x1c5)][0x0];if(_0x51ad46[_0x18e318(0x1b4)]===_0x18e318(0x1b3)){const {from:_0x20250a,id:_0x493111}=_0x5b8365[_0x18e318(0x1a5)];}if(_0x51ad46[_0x18e318(0x1b4)]===_0x18e318(0x1c0)){const _0x23eb42=await Setting_1['default']['findOne']({'where':{'key':_0x18e318(0x19f),'companyId':_0x424a11}});if(!_0x23eb42||_0x23eb42[_0x18e318(0x1a9)]===_0x18e318(0x1ac)){if(messageControl[_0x18e318(0x18e)]>0x1388)messageControl=[];var _0x475c4b=messageControl[_0x18e318(0x1b6)](_0x3e713a=>_0x3e713a['from']===_0x5b8365[_0x18e318(0x1a5)][_0x18e318(0x19b)]);(!_0x475c4b||new Date()['getTime']()-_0x475c4b[_0x18e318(0x198)]>=0x3e8*0x3c*0x5)&&(await(0x0,SendPresenceStatus_1[_0x18e318(0x1c9)])(_0x521fe9,_0x5b8365[_0x18e318(0x1a5)][_0x18e318(0x19b)]),await _0x521fe9[_0x18e318(0x1a7)](_0x5b8365[_0x18e318(0x1a5)][_0x18e318(0x19b)],{'text':_0x18e318(0x196)}),_0x475c4b&&(_0x475c4b=null,messageControl=messageControl[_0x18e318(0x1bb)](_0x424ee5=>_0x424ee5[_0x18e318(0x19b)]!==_0x5b8365[_0x18e318(0x1a5)][_0x18e318(0x19b)])));!_0x475c4b&&messageControl[_0x18e318(0x1bf)]({'from':_0x5b8365[_0x18e318(0x1a5)]['from'],'time':new Date()[_0x18e318(0x1bd)]()});const _0x4b58c3=_0x5b8365[_0x18e318(0x1a5)][_0x18e318(0x19b)][_0x18e318(0x19c)](/\D/g,''),_0x4d379f=await Contact_1[_0x18e318(0x1aa)][_0x18e318(0x1b2)]({'where':{'companyId':_0x424a11,'number':_0x4b58c3}}),_0x5952f9=await Ticket_1[_0x18e318(0x1aa)][_0x18e318(0x1b2)]({'where':{'contactId':_0x4d379f['id'],'whatsappId':_0x521fe9['id'],'status':_0x18e318(0x186),'companyId':_0x424a11}});if(!_0x5952f9)return;const _0x4dce65=new Date(),_0x2f25b5=_0x4dce65['getHours'](),_0x5c5422=_0x4dce65[_0x18e318(0x191)](),_0x5c9879=_0x18e318(0x1b8)+_0x2f25b5+':'+_0x5c5422,_0x3910b5={'id':_0x51ad46['attrs'][_0x18e318(0x1af)],'ticketId':_0x5952f9['id'],'contactId':_0x4d379f['id'],'body':_0x5c9879,'fromMe':![],'mediaType':_0x18e318(0x192),'read':!![],'quotedMsgId':null,'ack':0x1};return typeof _0x5c9879!==_0x18e318(0x188)&&console[_0x18e318(0x19d)](_0x18e318(0x1a6),_0x5c9879),await _0x5952f9['update']({'lastMessage':_0x5c9879}),_0x5952f9['status']===_0x18e318(0x195)&&await _0x5952f9[_0x18e318(0x18a)]({'status':_0x18e318(0x1a3)}),(0x0,CreateMessageService_1[_0x18e318(0x1aa)])({'messageData':_0x3910b5,'ticket':_0x5952f9,'companyId':_0x424a11});}}}),_0x521fe9['ev']['on'](_0x2f6077(0x1a4),async _0x3d1671=>{const _0xcc59e=_0x2f6077;await(0x0,CreateOrUpdateBaileysService_1[_0xcc59e(0x1aa)])({'whatsappId':_0x31c278['id'],'contacts':_0x3d1671});});}catch(_0x1889dd){Sentry[_0x2f6077(0x1a0)](_0x1889dd),logger_1[_0x2f6077(0x19e)][_0x2f6077(0x18b)](_0x1889dd);}};exports['default']=wbotMonitor;