'use strict';const a588_0x1603ac=a588_0x54f5;(function(_0x1c4b18,_0x3404f0){const _0x47fc50=a588_0x54f5,_0x41dd9f=_0x1c4b18();while(!![]){try{const _0x20d233=parseInt(_0x47fc50(0xcc))/0x1+-parseInt(_0x47fc50(0xe0))/0x2+-parseInt(_0x47fc50(0xce))/0x3*(-parseInt(_0x47fc50(0xde))/0x4)+-parseInt(_0x47fc50(0xe5))/0x5*(parseInt(_0x47fc50(0xf3))/0x6)+-parseInt(_0x47fc50(0xdb))/0x7*(parseInt(_0x47fc50(0xf0))/0x8)+-parseInt(_0x47fc50(0xfa))/0x9*(-parseInt(_0x47fc50(0xfe))/0xa)+-parseInt(_0x47fc50(0xc8))/0xb*(-parseInt(_0x47fc50(0xd4))/0xc);if(_0x20d233===_0x3404f0)break;else _0x41dd9f['push'](_0x41dd9f['shift']());}catch(_0x122547){_0x41dd9f['push'](_0x41dd9f['shift']());}}}(a588_0x201b,0x4601b));var __createBinding=this&&this[a588_0x1603ac(0xf1)]||(Object['create']?function(_0x541422,_0x52ae0b,_0x51c397,_0x6a480f){const _0x16a948=a588_0x1603ac;if(_0x6a480f===undefined)_0x6a480f=_0x51c397;var _0x183de8=Object[_0x16a948(0xef)](_0x52ae0b,_0x51c397);(!_0x183de8||(_0x16a948(0xd7)in _0x183de8?!_0x52ae0b['__esModule']:_0x183de8['writable']||_0x183de8[_0x16a948(0xcd)]))&&(_0x183de8={'enumerable':!![],'get':function(){return _0x52ae0b[_0x51c397];}}),Object[_0x16a948(0xd1)](_0x541422,_0x6a480f,_0x183de8);}:function(_0x470473,_0x12e58d,_0x5ad624,_0x5c2243){if(_0x5c2243===undefined)_0x5c2243=_0x5ad624;_0x470473[_0x5c2243]=_0x12e58d[_0x5ad624];}),__setModuleDefault=this&&this[a588_0x1603ac(0x103)]||(Object[a588_0x1603ac(0xfd)]?function(_0x5ca7f0,_0x588be0){const _0x11390b=a588_0x1603ac;Object['defineProperty'](_0x5ca7f0,_0x11390b(0xd3),{'enumerable':!![],'value':_0x588be0});}:function(_0x98d6e1,_0xfd79cc){_0x98d6e1['default']=_0xfd79cc;}),__importStar=this&&this['__importStar']||(function(){const _0x879d55=(function(){let _0x1e1bd8=!![];return function(_0x481562,_0x5b2e76){const _0x4f48d6=_0x1e1bd8?function(){const _0x1be462=a588_0x54f5;if(_0x5b2e76){const _0x2d2759=_0x5b2e76[_0x1be462(0xd2)](_0x481562,arguments);return _0x5b2e76=null,_0x2d2759;}}:function(){};return _0x1e1bd8=![],_0x4f48d6;};}()),_0x33fe0a=_0x879d55(this,function(){const _0x386d63=a588_0x54f5;return _0x33fe0a[_0x386d63(0xf5)]()['search']('(((.+)+)+)+$')[_0x386d63(0xf5)]()[_0x386d63(0xea)](_0x33fe0a)[_0x386d63(0x102)]('(((.+)+)+)+$');});_0x33fe0a();var _0x44d8ab=function(_0x20ba45){const _0xc31434=a588_0x54f5;return _0x44d8ab=Object[_0xc31434(0xdc)]||function(_0x2104dd){const _0x4683c7=_0xc31434;var _0x34beb3=[];for(var _0x520a66 in _0x2104dd)if(Object[_0x4683c7(0xca)][_0x4683c7(0xf7)]['call'](_0x2104dd,_0x520a66))_0x34beb3[_0x34beb3[_0x4683c7(0xe6)]]=_0x520a66;return _0x34beb3;},_0x44d8ab(_0x20ba45);};return function(_0xc2d590){const _0x249125=a588_0x54f5;if(_0xc2d590&&_0xc2d590[_0x249125(0xc9)])return _0xc2d590;var _0x2187fe={};if(_0xc2d590!=null){for(var _0x4b2e9d=_0x44d8ab(_0xc2d590),_0xd77a13=0x0;_0xd77a13<_0x4b2e9d['length'];_0xd77a13++)if(_0x4b2e9d[_0xd77a13]!==_0x249125(0xd3))__createBinding(_0x2187fe,_0xc2d590,_0x4b2e9d[_0xd77a13]);}return __setModuleDefault(_0x2187fe,_0xc2d590),_0x2187fe;};}()),__importDefault=this&&this[a588_0x1603ac(0x104)]||function(_0x1b2d3b){const _0x588af9=a588_0x1603ac;return _0x1b2d3b&&_0x1b2d3b[_0x588af9(0xc9)]?_0x1b2d3b:{'default':_0x1b2d3b};};function a588_0x201b(){const _0x462fd0=['replace','contacts.upsert','5iiYFgh','length','findOne','attrs','call-id','constructor','value','CB:call','tag','../../models/Contact','getOwnPropertyDescriptor','136zRaRKA','__createBinding','../../models/Setting','1204890uUtGII','Mutex','toString','pending','hasOwnProperty','getHours','update','53307WFiIoR','call_log','call','create','20skQhKQ','debug','disabled','open','search','__setModuleDefault','__importDefault','content','terminate','1404942rcqJiM','__esModule','prototype','closed','537621VvPHHT','configurable','1383KVXOrX','async-mutex','runExclusive','defineProperty','apply','default','36OVoSCU','@sentry/node','status','get','sendMessage','from','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','12019vcrirN','getOwnPropertyNames','logger','124PszNzT','captureException','860346RvTjxy','../../models/Ticket','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20'];a588_0x201b=function(){return _0x462fd0;};return a588_0x201b();}Object['defineProperty'](exports,a588_0x1603ac(0xc9),{'value':!![]});const Sentry=__importStar(require(a588_0x1603ac(0xd5))),async_mutex_1=require(a588_0x1603ac(0xcf)),Contact_1=__importDefault(require(a588_0x1603ac(0xee))),Setting_1=__importDefault(require(a588_0x1603ac(0xf2))),Ticket_1=__importDefault(require(a588_0x1603ac(0xe1))),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),contactMutex=new async_mutex_1[(a588_0x1603ac(0xf4))](),wbotMonitor=async(_0x13dc2c,_0x40ebfa,_0xbb7ec4)=>{const _0x3f0c89=a588_0x1603ac;try{_0x13dc2c['ws']['on'](_0x3f0c89(0xec),async _0x59d428=>{const _0x5140f1=_0x3f0c89,_0xfe56ec=_0x59d428[_0x5140f1(0x105)][0x0];if(_0xfe56ec[_0x5140f1(0xed)]===_0x5140f1(0x106)){const _0x1a4f1e=await Setting_1['default']['findOne']({'where':{'key':_0x5140f1(0xfc),'companyId':_0xbb7ec4}});if(_0x1a4f1e[_0x5140f1(0xeb)]===_0x5140f1(0x100)){await _0x13dc2c[_0x5140f1(0xd8)](_0x59d428['attrs'][_0x5140f1(0xd9)],{'text':_0x5140f1(0xda)});const _0x13913f=_0x59d428[_0x5140f1(0xe8)]['from'][_0x5140f1(0xe3)](/\D/g,''),_0x74b559=await Contact_1[_0x5140f1(0xd3)][_0x5140f1(0xe7)]({'where':{'companyId':_0xbb7ec4,'number':_0x13913f}}),_0x282ab1=await Ticket_1['default']['findOne']({'where':{'contactId':_0x74b559['id'],'whatsappId':_0x13dc2c['id'],'status':_0x5140f1(0x101),'companyId':_0xbb7ec4}});if(!_0x282ab1)return;const _0x59418d=new Date(),_0x5aab55=_0x59418d[_0x5140f1(0xf8)](),_0x549b44=_0x59418d['getMinutes'](),_0x3fa805=_0x5140f1(0xe2)+_0x5aab55+':'+_0x549b44,_0x414cf5={'id':_0xfe56ec[_0x5140f1(0xe8)][_0x5140f1(0xe9)],'ticketId':_0x282ab1['id'],'contactId':_0x74b559['id'],'body':_0x3fa805,'fromMe':![],'mediaType':_0x5140f1(0xfb),'read':!![],'quotedMsgId':null,'ack':0x1};await _0x282ab1[_0x5140f1(0xf9)]({'lastMessage':_0x3fa805}),_0x282ab1[_0x5140f1(0xd6)]===_0x5140f1(0xcb)&&await _0x282ab1['update']({'status':_0x5140f1(0xf6)}),(0x0,CreateMessageService_1[_0x5140f1(0xd3)])({'messageData':_0x414cf5,'companyId':_0xbb7ec4});}}}),_0x13dc2c['ev']['on']('contacts.upsert',async _0x1671b7=>{const _0x2d38a3=_0x3f0c89;logger_1[_0x2d38a3(0xdd)][_0x2d38a3(0xff)]({'contacts':_0x1671b7},_0x2d38a3(0xe4)),contactMutex[_0x2d38a3(0xd0)](async()=>{await(0x0,CreateOrUpdateBaileysService_1['default'])({'whatsappId':_0x40ebfa['id'],'contacts':_0x1671b7});});});}catch(_0x5f45c1){Sentry[_0x3f0c89(0xdf)](_0x5f45c1),logger_1[_0x3f0c89(0xdd)]['error'](_0x5f45c1);}};function a588_0x54f5(_0x2c87c4,_0x4a7845){const _0x142b80=a588_0x201b();return a588_0x54f5=function(_0x16fd04,_0x298d3a){_0x16fd04=_0x16fd04-0xc8;let _0x201ba1=_0x142b80[_0x16fd04];return _0x201ba1;},a588_0x54f5(_0x2c87c4,_0x4a7845);}exports[a588_0x1603ac(0xd3)]=wbotMonitor;