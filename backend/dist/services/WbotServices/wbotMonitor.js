'use strict';function a585_0x3c97(){const _0x5d8b45=['from','open','74875NpUMbu','43631900wWrDXH','update','@sentry/node','findOne','../../models/Ticket','7KwGQaV','defineProperty','pending','hasOwnProperty','../MessageServices/CreateMessageService','618zEnIHe','get','(((.+)+)+)+$','call','4129485AMsFFJ','error','call-id','__importStar','async-mutex','content','configurable','disabled','contacts.upsert','prototype','constructor','search','writable','toString','tag','sendMessage','../../models/Setting','5121992LjdHvt','replace','32244BVARxe','terminate','Mutex','closed','attrs','../BaileysServices/CreateOrUpdateBaileysService','status','logger','CB:call','4787416AzTYTI','__importDefault','12506490idJufg','__createBinding','runExclusive','create','default','getOwnPropertyNames','apply','__setModuleDefault','__esModule','captureException','4jfvFuJ','getHours','11tEKBBj','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado'];a585_0x3c97=function(){return _0x5d8b45;};return a585_0x3c97();}const a585_0x33199a=a585_0x284b;function a585_0x284b(_0x3b9ace,_0x24754b){const _0xc81c76=a585_0x3c97();return a585_0x284b=function(_0x1aa30a,_0x4da29d){_0x1aa30a=_0x1aa30a-0x66;let _0x3c971a=_0xc81c76[_0x1aa30a];return _0x3c971a;},a585_0x284b(_0x3b9ace,_0x24754b);}(function(_0x568b50,_0x37b169){const _0xe1f6f4=a585_0x284b,_0x3453df=_0x568b50();while(!![]){try{const _0x376cc6=-parseInt(_0xe1f6f4(0x90))/0x1*(parseInt(_0xe1f6f4(0x7b))/0x2)+parseInt(_0xe1f6f4(0x68))/0x3+-parseInt(_0xe1f6f4(0x79))/0x4+parseInt(_0xe1f6f4(0x96))/0x5*(-parseInt(_0xe1f6f4(0xa1))/0x6)+parseInt(_0xe1f6f4(0x9c))/0x7*(-parseInt(_0xe1f6f4(0x84))/0x8)+-parseInt(_0xe1f6f4(0x86))/0x9+-parseInt(_0xe1f6f4(0x97))/0xa*(-parseInt(_0xe1f6f4(0x92))/0xb);if(_0x376cc6===_0x37b169)break;else _0x3453df['push'](_0x3453df['shift']());}catch(_0x13c78a){_0x3453df['push'](_0x3453df['shift']());}}}(a585_0x3c97,0xd2fed));var __createBinding=this&&this[a585_0x33199a(0x87)]||(Object[a585_0x33199a(0x89)]?function(_0x48b570,_0x1ab853,_0x5781c7,_0x6a1859){const _0x3303b0=a585_0x33199a;if(_0x6a1859===undefined)_0x6a1859=_0x5781c7;var _0x4645ae=Object['getOwnPropertyDescriptor'](_0x1ab853,_0x5781c7);(!_0x4645ae||(_0x3303b0(0xa2)in _0x4645ae?!_0x1ab853[_0x3303b0(0x8e)]:_0x4645ae[_0x3303b0(0x74)]||_0x4645ae[_0x3303b0(0x6e)]))&&(_0x4645ae={'enumerable':!![],'get':function(){return _0x1ab853[_0x5781c7];}}),Object['defineProperty'](_0x48b570,_0x6a1859,_0x4645ae);}:function(_0x9bf323,_0x2eb17f,_0x6f7e4e,_0x5715a4){if(_0x5715a4===undefined)_0x5715a4=_0x6f7e4e;_0x9bf323[_0x5715a4]=_0x2eb17f[_0x6f7e4e];}),__setModuleDefault=this&&this[a585_0x33199a(0x8d)]||(Object[a585_0x33199a(0x89)]?function(_0x2c8047,_0x516768){const _0x3145ba=a585_0x33199a;Object[_0x3145ba(0x9d)](_0x2c8047,'default',{'enumerable':!![],'value':_0x516768});}:function(_0x4c582f,_0x5c9d0f){const _0x314101=a585_0x33199a;_0x4c582f[_0x314101(0x8a)]=_0x5c9d0f;}),__importStar=this&&this[a585_0x33199a(0x6b)]||(function(){const _0xaa996d=(function(){let _0x561b8a=!![];return function(_0x3fe8e6,_0x221a0a){const _0x3a7433=_0x561b8a?function(){const _0x3a4eb2=a585_0x284b;if(_0x221a0a){const _0x2ae9e4=_0x221a0a[_0x3a4eb2(0x8c)](_0x3fe8e6,arguments);return _0x221a0a=null,_0x2ae9e4;}}:function(){};return _0x561b8a=![],_0x3a7433;};}()),_0x58711b=_0xaa996d(this,function(){const _0x48438f=a585_0x284b;return _0x58711b['toString']()['search']('(((.+)+)+)+$')[_0x48438f(0x75)]()[_0x48438f(0x72)](_0x58711b)[_0x48438f(0x73)](_0x48438f(0x66));});_0x58711b();var _0x356777=function(_0xbaafd){const _0x300854=a585_0x284b;return _0x356777=Object[_0x300854(0x8b)]||function(_0x22e75b){const _0x515e17=_0x300854;var _0x5a1c2f=[];for(var _0x3dbe72 in _0x22e75b)if(Object[_0x515e17(0x71)][_0x515e17(0x9f)][_0x515e17(0x67)](_0x22e75b,_0x3dbe72))_0x5a1c2f[_0x5a1c2f['length']]=_0x3dbe72;return _0x5a1c2f;},_0x356777(_0xbaafd);};return function(_0x4e879c){const _0x6138c6=a585_0x284b;if(_0x4e879c&&_0x4e879c[_0x6138c6(0x8e)])return _0x4e879c;var _0x365ef1={};if(_0x4e879c!=null){for(var _0x1141b2=_0x356777(_0x4e879c),_0x33f014=0x0;_0x33f014<_0x1141b2['length'];_0x33f014++)if(_0x1141b2[_0x33f014]!==_0x6138c6(0x8a))__createBinding(_0x365ef1,_0x4e879c,_0x1141b2[_0x33f014]);}return __setModuleDefault(_0x365ef1,_0x4e879c),_0x365ef1;};}()),__importDefault=this&&this[a585_0x33199a(0x85)]||function(_0xbdbe2b){const _0x5e0ad8=a585_0x33199a;return _0xbdbe2b&&_0xbdbe2b[_0x5e0ad8(0x8e)]?_0xbdbe2b:{'default':_0xbdbe2b};};Object[a585_0x33199a(0x9d)](exports,a585_0x33199a(0x8e),{'value':!![]});const Sentry=__importStar(require(a585_0x33199a(0x99))),async_mutex_1=require(a585_0x33199a(0x6c)),Contact_1=__importDefault(require('../../models/Contact')),Setting_1=__importDefault(require(a585_0x33199a(0x78))),Ticket_1=__importDefault(require(a585_0x33199a(0x9b))),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require(a585_0x33199a(0x80))),CreateMessageService_1=__importDefault(require(a585_0x33199a(0xa0))),contactMutex=new async_mutex_1[(a585_0x33199a(0x7d))](),wbotMonitor=async(_0x352015,_0x276aa1,_0x5aa047)=>{const _0x1a4475=a585_0x33199a;try{_0x352015['ws']['on'](_0x1a4475(0x83),async _0x1d6b60=>{const _0xebc481=_0x1a4475,_0x58dd6b=_0x1d6b60[_0xebc481(0x6d)][0x0];if(_0x58dd6b[_0xebc481(0x76)]===_0xebc481(0x7c)){const _0x3011c2=await Setting_1[_0xebc481(0x8a)][_0xebc481(0x9a)]({'where':{'key':_0xebc481(0x67),'companyId':_0x5aa047}});if(_0x3011c2['value']===_0xebc481(0x6f)){await _0x352015[_0xebc481(0x77)](_0x1d6b60[_0xebc481(0x7f)][_0xebc481(0x94)],{'text':_0xebc481(0x93)});const _0x25913e=_0x1d6b60[_0xebc481(0x7f)][_0xebc481(0x94)][_0xebc481(0x7a)](/\D/g,''),_0x32015e=await Contact_1['default']['findOne']({'where':{'companyId':_0x5aa047,'number':_0x25913e}}),_0x203af8=await Ticket_1['default'][_0xebc481(0x9a)]({'where':{'contactId':_0x32015e['id'],'whatsappId':_0x352015['id'],'status':_0xebc481(0x95),'companyId':_0x5aa047}});if(!_0x203af8)return;const _0x570b21=new Date(),_0x2b6c62=_0x570b21[_0xebc481(0x91)](),_0x2ab0e0=_0x570b21['getMinutes'](),_0x59008a='Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20'+_0x2b6c62+':'+_0x2ab0e0,_0x2b1946={'id':_0x58dd6b[_0xebc481(0x7f)][_0xebc481(0x6a)],'ticketId':_0x203af8['id'],'contactId':_0x32015e['id'],'body':_0x59008a,'fromMe':![],'mediaType':'call_log','read':!![],'quotedMsgId':null,'ack':0x1};await _0x203af8[_0xebc481(0x98)]({'lastMessage':_0x59008a}),_0x203af8[_0xebc481(0x81)]===_0xebc481(0x7e)&&await _0x203af8[_0xebc481(0x98)]({'status':_0xebc481(0x9e)}),(0x0,CreateMessageService_1[_0xebc481(0x8a)])({'messageData':_0x2b1946,'companyId':_0x5aa047});}}}),_0x352015['ev']['on'](_0x1a4475(0x70),async _0x14d145=>{const _0xf3d659=_0x1a4475;logger_1[_0xf3d659(0x82)]['debug']({'contacts':_0x14d145},'contacts.upsert'),contactMutex[_0xf3d659(0x88)](async()=>{const _0x4610b1=_0xf3d659;await(0x0,CreateOrUpdateBaileysService_1[_0x4610b1(0x8a)])({'whatsappId':_0x276aa1['id'],'contacts':_0x14d145});});});}catch(_0x5dffc9){Sentry[_0x1a4475(0x8f)](_0x5dffc9),logger_1[_0x1a4475(0x82)][_0x1a4475(0x69)](_0x5dffc9);}};exports[a585_0x33199a(0x8a)]=wbotMonitor;