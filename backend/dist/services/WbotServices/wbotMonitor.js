'use strict';const a589_0x55caed=a589_0x32bf;(function(_0x4b3b00,_0x5e2e1d){const _0x2dd8ba=a589_0x32bf,_0x57580d=_0x4b3b00();while(!![]){try{const _0xa2b9f2=parseInt(_0x2dd8ba(0x126))/0x1*(parseInt(_0x2dd8ba(0x12f))/0x2)+-parseInt(_0x2dd8ba(0x10c))/0x3*(parseInt(_0x2dd8ba(0x11b))/0x4)+-parseInt(_0x2dd8ba(0x125))/0x5+-parseInt(_0x2dd8ba(0x10e))/0x6*(-parseInt(_0x2dd8ba(0x115))/0x7)+-parseInt(_0x2dd8ba(0x117))/0x8+parseInt(_0x2dd8ba(0x131))/0x9*(parseInt(_0x2dd8ba(0x11e))/0xa)+parseInt(_0x2dd8ba(0x135))/0xb*(parseInt(_0x2dd8ba(0x123))/0xc);if(_0xa2b9f2===_0x5e2e1d)break;else _0x57580d['push'](_0x57580d['shift']());}catch(_0xd9eb32){_0x57580d['push'](_0x57580d['shift']());}}}(a589_0x1fc3,0x585e6));var __createBinding=this&&this['__createBinding']||(Object[a589_0x55caed(0x13b)]?function(_0x5a6321,_0x860cf1,_0x541cd3,_0x512426){const _0x77604=a589_0x55caed;if(_0x512426===undefined)_0x512426=_0x541cd3;var _0x1548d=Object['getOwnPropertyDescriptor'](_0x860cf1,_0x541cd3);(!_0x1548d||(_0x77604(0x133)in _0x1548d?!_0x860cf1[_0x77604(0x138)]:_0x1548d[_0x77604(0x136)]||_0x1548d['configurable']))&&(_0x1548d={'enumerable':!![],'get':function(){return _0x860cf1[_0x541cd3];}}),Object[_0x77604(0x12c)](_0x5a6321,_0x512426,_0x1548d);}:function(_0x3e5e13,_0x423949,_0x3a4059,_0x37ed3b){if(_0x37ed3b===undefined)_0x37ed3b=_0x3a4059;_0x3e5e13[_0x37ed3b]=_0x423949[_0x3a4059];}),__setModuleDefault=this&&this[a589_0x55caed(0x12a)]||(Object[a589_0x55caed(0x13b)]?function(_0x4570d1,_0x4013ed){const _0x593696=a589_0x55caed;Object[_0x593696(0x12c)](_0x4570d1,'default',{'enumerable':!![],'value':_0x4013ed});}:function(_0x2b5f33,_0x3796eb){_0x2b5f33['default']=_0x3796eb;}),__importStar=this&&this[a589_0x55caed(0x114)]||(function(){const _0x9d0e38=(function(){let _0x129930=!![];return function(_0xa23bb1,_0x4410fd){const _0x2ad463=_0x129930?function(){const _0x407bf4=a589_0x32bf;if(_0x4410fd){const _0x333038=_0x4410fd[_0x407bf4(0x13d)](_0xa23bb1,arguments);return _0x4410fd=null,_0x333038;}}:function(){};return _0x129930=![],_0x2ad463;};}()),_0x3e68ba=_0x9d0e38(this,function(){const _0x5d4482=a589_0x32bf;return _0x3e68ba[_0x5d4482(0x137)]()['search'](_0x5d4482(0x118))['toString']()[_0x5d4482(0x140)](_0x3e68ba)[_0x5d4482(0x120)](_0x5d4482(0x118));});_0x3e68ba();var _0x5ed8fd=function(_0x18122d){const _0xc53d44=a589_0x32bf;return _0x5ed8fd=Object[_0xc53d44(0x12d)]||function(_0x2a6b9b){const _0xfeb993=_0xc53d44;var _0x397b69=[];for(var _0x5d5d4a in _0x2a6b9b)if(Object[_0xfeb993(0x13a)]['hasOwnProperty'][_0xfeb993(0x134)](_0x2a6b9b,_0x5d5d4a))_0x397b69[_0x397b69['length']]=_0x5d5d4a;return _0x397b69;},_0x5ed8fd(_0x18122d);};return function(_0x36e310){const _0x330365=a589_0x32bf;if(_0x36e310&&_0x36e310[_0x330365(0x138)])return _0x36e310;var _0xfb1aaf={};if(_0x36e310!=null){for(var _0x533343=_0x5ed8fd(_0x36e310),_0x3d4799=0x0;_0x3d4799<_0x533343[_0x330365(0x11d)];_0x3d4799++)if(_0x533343[_0x3d4799]!==_0x330365(0x13e))__createBinding(_0xfb1aaf,_0x36e310,_0x533343[_0x3d4799]);}return __setModuleDefault(_0xfb1aaf,_0x36e310),_0xfb1aaf;};}()),__importDefault=this&&this[a589_0x55caed(0x11f)]||function(_0x5c5fd8){return _0x5c5fd8&&_0x5c5fd8['__esModule']?_0x5c5fd8:{'default':_0x5c5fd8};};function a589_0x32bf(_0x3575f0,_0x1b4cb9){const _0x4720bc=a589_0x1fc3();return a589_0x32bf=function(_0x59faff,_0x3b961f){_0x59faff=_0x59faff-0x10b;let _0x1fc31c=_0x4720bc[_0x59faff];return _0x1fc31c;},a589_0x32bf(_0x3575f0,_0x1b4cb9);}Object[a589_0x55caed(0x12c)](exports,a589_0x55caed(0x138),{'value':!![]});const Sentry=__importStar(require(a589_0x55caed(0x10f))),async_mutex_1=require('async-mutex'),Contact_1=__importDefault(require('../../models/Contact')),Setting_1=__importDefault(require('../../models/Setting')),Ticket_1=__importDefault(require(a589_0x55caed(0x124))),logger_1=require(a589_0x55caed(0x132)),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require(a589_0x55caed(0x119))),contactMutex=new async_mutex_1['Mutex'](),wbotMonitor=async(_0x2f178e,_0x52b82f,_0x52b3ea)=>{const _0x3009f7=a589_0x55caed;try{_0x2f178e['ws']['on']('CB:call',async _0x4e5b0e=>{const _0x873377=a589_0x32bf,_0x439942=_0x4e5b0e[_0x873377(0x121)][0x0];if(_0x439942['tag']==='terminate'){const _0x5f3337=await Setting_1['default'][_0x873377(0x111)]({'where':{'key':_0x873377(0x134),'companyId':_0x52b3ea}});if(_0x5f3337[_0x873377(0x10b)]===_0x873377(0x11c)){await _0x2f178e['sendMessage'](_0x4e5b0e[_0x873377(0x112)][_0x873377(0x129)],{'text':_0x873377(0x13f)});const _0x2cd4a5=_0x4e5b0e[_0x873377(0x112)][_0x873377(0x129)][_0x873377(0x10d)](/\D/g,''),_0x3e0578=await Contact_1['default'][_0x873377(0x111)]({'where':{'companyId':_0x52b3ea,'number':_0x2cd4a5}}),_0x41f783=await Ticket_1['default'][_0x873377(0x111)]({'where':{'contactId':_0x3e0578['id'],'whatsappId':_0x2f178e['id'],'status':'open','companyId':_0x52b3ea}});if(!_0x41f783)return;const _0xcbcc69=new Date(),_0x6be456=_0xcbcc69[_0x873377(0x130)](),_0x30c241=_0xcbcc69['getMinutes'](),_0x40c0cf=_0x873377(0x122)+_0x6be456+':'+_0x30c241,_0x23802a={'id':_0x439942[_0x873377(0x112)][_0x873377(0x128)],'ticketId':_0x41f783['id'],'contactId':_0x3e0578['id'],'body':_0x40c0cf,'fromMe':![],'mediaType':_0x873377(0x141),'read':!![],'quotedMsgId':null,'ack':0x1};await _0x41f783[_0x873377(0x110)]({'lastMessage':_0x40c0cf}),_0x41f783['status']===_0x873377(0x116)&&await _0x41f783[_0x873377(0x110)]({'status':_0x873377(0x139)}),(0x0,CreateMessageService_1[_0x873377(0x13e)])({'messageData':_0x23802a,'companyId':_0x52b3ea});}}}),_0x2f178e['ev']['on'](_0x3009f7(0x127),async _0x2bc85c=>{const _0x46b454=_0x3009f7;logger_1[_0x46b454(0x12b)][_0x46b454(0x13c)]({'contacts':_0x2bc85c},_0x46b454(0x127)),contactMutex[_0x46b454(0x113)](async()=>{const _0x44432c=_0x46b454;await(0x0,CreateOrUpdateBaileysService_1[_0x44432c(0x13e)])({'whatsappId':_0x52b82f['id'],'contacts':_0x2bc85c});});});}catch(_0x195191){Sentry[_0x3009f7(0x11a)](_0x195191),logger_1[_0x3009f7(0x12b)][_0x3009f7(0x12e)](_0x195191);}};function a589_0x1fc3(){const _0x3c15bc=['call_log','value','3dehxbe','replace','3258VfnKpB','@sentry/node','update','findOne','attrs','runExclusive','__importStar','973sMGgKJ','closed','5313768BDQTdP','(((.+)+)+)+$','../MessageServices/CreateMessageService','captureException','2601580FHEPao','disabled','length','170fYsLyY','__importDefault','search','content','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','492KoBbkm','../../models/Ticket','2163870eFImmM','27160XDXfdo','contacts.upsert','call-id','from','__setModuleDefault','logger','defineProperty','getOwnPropertyNames','error','24rOqROc','getHours','299223dhiQCX','../../utils/logger','get','call','306592cMhtEj','writable','toString','__esModule','pending','prototype','create','debug','apply','default','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','constructor'];a589_0x1fc3=function(){return _0x3c15bc;};return a589_0x1fc3();}exports[a589_0x55caed(0x13e)]=wbotMonitor;