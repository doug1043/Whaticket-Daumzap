const a562_0x20eb7f=a562_0x2ec8;(function(_0x3b54f1,_0x4c0e31){const _0x23c2d0=a562_0x2ec8,_0x551b20=_0x3b54f1();while(!![]){try{const _0x380eb5=-parseInt(_0x23c2d0(0x16a))/0x1*(-parseInt(_0x23c2d0(0x159))/0x2)+parseInt(_0x23c2d0(0x179))/0x3*(parseInt(_0x23c2d0(0x171))/0x4)+parseInt(_0x23c2d0(0x152))/0x5*(parseInt(_0x23c2d0(0x17e))/0x6)+-parseInt(_0x23c2d0(0x176))/0x7+-parseInt(_0x23c2d0(0x169))/0x8*(parseInt(_0x23c2d0(0x18b))/0x9)+-parseInt(_0x23c2d0(0x188))/0xa*(-parseInt(_0x23c2d0(0x175))/0xb)+-parseInt(_0x23c2d0(0x180))/0xc;if(_0x380eb5===_0x4c0e31)break;else _0x551b20['push'](_0x551b20['shift']());}catch(_0x5f06f5){_0x551b20['push'](_0x551b20['shift']());}}}(a562_0x2f33,0xb3cd0));function a562_0x2ec8(_0x1a5467,_0x55e2db){const _0x4002a7=a562_0x2f33();return a562_0x2ec8=function(_0x3985ae,_0x3620ea){_0x3985ae=_0x3985ae-0x152;let _0x2f3389=_0x4002a7[_0x3985ae];return _0x2f3389;},a562_0x2ec8(_0x1a5467,_0x55e2db);}const a562_0x3620ea=(function(){let _0x3b28f5=!![];return function(_0x1ce4a3,_0x1e4db8){const _0x4a8684=_0x3b28f5?function(){const _0x388222=a562_0x2ec8;if(_0x1e4db8){const _0x5dd8ee=_0x1e4db8[_0x388222(0x182)](_0x1ce4a3,arguments);return _0x1e4db8=null,_0x5dd8ee;}}:function(){};return _0x3b28f5=![],_0x4a8684;};}()),a562_0x3985ae=a562_0x3620ea(this,function(){const _0x554f67=a562_0x2ec8;return a562_0x3985ae[_0x554f67(0x156)]()['search'](_0x554f67(0x161))[_0x554f67(0x156)]()[_0x554f67(0x162)](a562_0x3985ae)[_0x554f67(0x17d)](_0x554f67(0x161));});a562_0x3985ae();'use strict';var __createBinding=this&&this[a562_0x20eb7f(0x16f)]||(Object[a562_0x20eb7f(0x15f)]?function(_0x1e5d82,_0x3ff5b9,_0x25cebd,_0x372e8c){const _0x513d5f=a562_0x20eb7f;if(_0x372e8c===undefined)_0x372e8c=_0x25cebd;var _0x2f4f92=Object[_0x513d5f(0x178)](_0x3ff5b9,_0x25cebd);(!_0x2f4f92||(_0x513d5f(0x185)in _0x2f4f92?!_0x3ff5b9[_0x513d5f(0x167)]:_0x2f4f92['writable']||_0x2f4f92['configurable']))&&(_0x2f4f92={'enumerable':!![],'get':function(){return _0x3ff5b9[_0x25cebd];}}),Object['defineProperty'](_0x1e5d82,_0x372e8c,_0x2f4f92);}:function(_0x49cf80,_0x2a2e7b,_0x55d1c8,_0xcdd3ac){if(_0xcdd3ac===undefined)_0xcdd3ac=_0x55d1c8;_0x49cf80[_0xcdd3ac]=_0x2a2e7b[_0x55d1c8];}),__setModuleDefault=this&&this[a562_0x20eb7f(0x15d)]||(Object[a562_0x20eb7f(0x15f)]?function(_0x2ae39e,_0x549ffe){const _0x18a74e=a562_0x20eb7f;Object['defineProperty'](_0x2ae39e,_0x18a74e(0x187),{'enumerable':!![],'value':_0x549ffe});}:function(_0x4e83e3,_0x5c6f3b){_0x4e83e3['default']=_0x5c6f3b;}),__importStar=this&&this['__importStar']||function(_0x58f39f){const _0x88656e=a562_0x20eb7f;if(_0x58f39f&&_0x58f39f[_0x88656e(0x167)])return _0x58f39f;var _0x13d02b={};if(_0x58f39f!=null){for(var _0x2e2e01 in _0x58f39f)if(_0x2e2e01!==_0x88656e(0x187)&&Object[_0x88656e(0x155)][_0x88656e(0x183)]['call'](_0x58f39f,_0x2e2e01))__createBinding(_0x13d02b,_0x58f39f,_0x2e2e01);}return __setModuleDefault(_0x13d02b,_0x58f39f),_0x13d02b;},__importDefault=this&&this[a562_0x20eb7f(0x172)]||function(_0x3c2f0f){return _0x3c2f0f&&_0x3c2f0f['__esModule']?_0x3c2f0f:{'default':_0x3c2f0f};};Object[a562_0x20eb7f(0x186)](exports,'__esModule',{'value':!![]});const Sentry=__importStar(require(a562_0x20eb7f(0x174))),Contact_1=__importDefault(require(a562_0x20eb7f(0x16b))),Setting_1=__importDefault(require(a562_0x20eb7f(0x17f))),Ticket_1=__importDefault(require(a562_0x20eb7f(0x16e))),logger_1=require(a562_0x20eb7f(0x17a)),CreateOrUpdateBaileysService_1=__importDefault(require(a562_0x20eb7f(0x168))),CreateMessageService_1=__importDefault(require(a562_0x20eb7f(0x15e))),SendPresenceStatus_1=require(a562_0x20eb7f(0x166));let messageControl=[];const wbotMonitor=async(_0x332eba,_0xb05109,_0x19061e)=>{const _0x1f4467=a562_0x20eb7f;try{_0x332eba['ws']['on'](_0x1f4467(0x18d),async _0x1d6f5b=>{const _0x59dcd3=_0x1f4467,_0x5d4960=_0x1d6f5b['content'][0x0];if(_0x5d4960[_0x59dcd3(0x163)]==='offer'){const {from:_0x5cf408,id:_0x4310f1}=_0x1d6f5b['attrs'];}if(_0x5d4960[_0x59dcd3(0x163)]==='terminate'){const _0x5114ee=await Setting_1['default']['findOne']({'where':{'key':'call','companyId':_0x19061e}});if(!_0x5114ee||_0x5114ee[_0x59dcd3(0x173)]==='disabled'){if(messageControl[_0x59dcd3(0x154)]>0x1388)messageControl=[];var _0x49dfc6=messageControl['find'](_0x56e1fe=>_0x56e1fe[_0x59dcd3(0x15b)]===_0x1d6f5b[_0x59dcd3(0x158)][_0x59dcd3(0x15b)]);(!_0x49dfc6||new Date()[_0x59dcd3(0x160)]()-_0x49dfc6[_0x59dcd3(0x17c)]>=0x3e8*0x3c*0x5)&&(await(0x0,SendPresenceStatus_1[_0x59dcd3(0x16c)])(_0x332eba,_0x1d6f5b[_0x59dcd3(0x158)][_0x59dcd3(0x15b)]),await _0x332eba['sendMessage'](_0x1d6f5b[_0x59dcd3(0x158)][_0x59dcd3(0x15b)],{'text':_0x59dcd3(0x17b)}),_0x49dfc6&&(_0x49dfc6=null,messageControl=messageControl[_0x59dcd3(0x181)](_0x1a37d1=>_0x1a37d1[_0x59dcd3(0x15b)]!==_0x1d6f5b[_0x59dcd3(0x158)][_0x59dcd3(0x15b)])));!_0x49dfc6&&messageControl[_0x59dcd3(0x18c)]({'from':_0x1d6f5b['attrs'][_0x59dcd3(0x15b)],'time':new Date()[_0x59dcd3(0x160)]()});const _0xfcb29d=_0x1d6f5b[_0x59dcd3(0x158)]['from'][_0x59dcd3(0x15c)](/\D/g,''),_0x32ff79=await Contact_1['default'][_0x59dcd3(0x157)]({'where':{'companyId':_0x19061e,'number':_0xfcb29d}}),_0x479b9f=await Ticket_1[_0x59dcd3(0x187)][_0x59dcd3(0x157)]({'where':{'contactId':_0x32ff79['id'],'whatsappId':_0x332eba['id'],'status':_0x59dcd3(0x170),'companyId':_0x19061e}});if(!_0x479b9f)return;const _0x304d96=new Date(),_0x5ddc8d=_0x304d96[_0x59dcd3(0x189)](),_0x15ad6f=_0x304d96[_0x59dcd3(0x153)](),_0x4b4b2f=_0x59dcd3(0x18a)+_0x5ddc8d+':'+_0x15ad6f,_0x11260a={'id':_0x5d4960['attrs'][_0x59dcd3(0x165)],'ticketId':_0x479b9f['id'],'contactId':_0x32ff79['id'],'body':_0x4b4b2f,'fromMe':![],'mediaType':_0x59dcd3(0x177),'read':!![],'quotedMsgId':null,'ack':0x1};return typeof _0x4b4b2f!=='string'&&console['trace'](_0x59dcd3(0x16d),_0x4b4b2f),await _0x479b9f[_0x59dcd3(0x184)]({'lastMessage':_0x4b4b2f}),_0x479b9f[_0x59dcd3(0x18e)]===_0x59dcd3(0x15a)&&await _0x479b9f[_0x59dcd3(0x184)]({'status':'pending'}),(0x0,CreateMessageService_1['default'])({'messageData':_0x11260a,'ticket':_0x479b9f,'companyId':_0x19061e});}}}),_0x332eba['ev']['on'](_0x1f4467(0x164),async _0x1bfa8c=>{const _0x4345da=_0x1f4467;await(0x0,CreateOrUpdateBaileysService_1[_0x4345da(0x187)])({'whatsappId':_0xb05109['id'],'contacts':_0x1bfa8c});});}catch(_0x549022){Sentry['captureException'](_0x549022),logger_1['logger']['error'](_0x549022);}};exports[a562_0x20eb7f(0x187)]=wbotMonitor;function a562_0x2f33(){const _0x28f4d5=['CB:call','status','4405iFetev','getMinutes','length','prototype','toString','findOne','attrs','2KYHRCy','closed','from','replace','__setModuleDefault','../MessageServices/CreateMessageService','create','getTime','(((.+)+)+)+$','constructor','tag','contacts.upsert','call-id','../../helpers/SendPresenceStatus','__esModule','../BaileysServices/CreateOrUpdateBaileysService','80ivpUYX','1384061Snsfjc','../../models/Contact','SendPresenceStatus','body\x20is\x20not\x20a\x20string','../../models/Ticket','__createBinding','open','1888772juQLXS','__importDefault','value','@sentry/node','18062SfcFrb','3771467ZTAdGv','call_log','getOwnPropertyDescriptor','3dFBgqr','../../utils/logger','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','time','search','5754oILfLp','../../models/Setting','4721952AYKiMS','filter','apply','hasOwnProperty','update','get','defineProperty','default','1490HnRTXp','getHours','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','1149345FpTqOs','push'];a562_0x2f33=function(){return _0x28f4d5;};return a562_0x2f33();}