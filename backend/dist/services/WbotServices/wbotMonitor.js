'use strict';const a698_0x5385a3=a698_0x600a;(function(_0x4108ca,_0x1cd4b2){const _0x1f19de=a698_0x600a,_0x390e23=_0x4108ca();while(!![]){try{const _0x31c512=parseInt(_0x1f19de(0x8f))/0x1*(parseInt(_0x1f19de(0xc0))/0x2)+-parseInt(_0x1f19de(0x95))/0x3+parseInt(_0x1f19de(0xbc))/0x4*(-parseInt(_0x1f19de(0xbb))/0x5)+parseInt(_0x1f19de(0x97))/0x6*(-parseInt(_0x1f19de(0x93))/0x7)+-parseInt(_0x1f19de(0xc6))/0x8+parseInt(_0x1f19de(0x90))/0x9+parseInt(_0x1f19de(0xaf))/0xa;if(_0x31c512===_0x1cd4b2)break;else _0x390e23['push'](_0x390e23['shift']());}catch(_0x683d7a){_0x390e23['push'](_0x390e23['shift']());}}}(a698_0xf241,0xc28b0));function a698_0x600a(_0x44c0f5,_0xbc137b){const _0x125419=a698_0xf241();return a698_0x600a=function(_0x224a37,_0x35997e){_0x224a37=_0x224a37-0x8e;let _0xf241aa=_0x125419[_0x224a37];return _0xf241aa;},a698_0x600a(_0x44c0f5,_0xbc137b);}var __createBinding=this&&this[a698_0x5385a3(0xb8)]||(Object[a698_0x5385a3(0x9e)]?function(_0x1faa55,_0x1bb849,_0x4e76c9,_0x46a988){const _0x12e19d=a698_0x5385a3;if(_0x46a988===undefined)_0x46a988=_0x4e76c9;var _0x37b836=Object[_0x12e19d(0xb1)](_0x1bb849,_0x4e76c9);(!_0x37b836||('get'in _0x37b836?!_0x1bb849[_0x12e19d(0x9c)]:_0x37b836[_0x12e19d(0xbf)]||_0x37b836[_0x12e19d(0x94)]))&&(_0x37b836={'enumerable':!![],'get':function(){return _0x1bb849[_0x4e76c9];}}),Object[_0x12e19d(0xa9)](_0x1faa55,_0x46a988,_0x37b836);}:function(_0x19052c,_0x35df81,_0x4d89a2,_0x397608){if(_0x397608===undefined)_0x397608=_0x4d89a2;_0x19052c[_0x397608]=_0x35df81[_0x4d89a2];}),__setModuleDefault=this&&this[a698_0x5385a3(0xc7)]||(Object[a698_0x5385a3(0x9e)]?function(_0x24526f,_0x1b01a1){const _0x2f5732=a698_0x5385a3;Object['defineProperty'](_0x24526f,_0x2f5732(0xba),{'enumerable':!![],'value':_0x1b01a1});}:function(_0x424476,_0x5bdc14){const _0x2f6745=a698_0x5385a3;_0x424476[_0x2f6745(0xba)]=_0x5bdc14;}),__importStar=this&&this[a698_0x5385a3(0xa3)]||(function(){const _0x16a90e=(function(){let _0x43be61=!![];return function(_0x2f7492,_0x422c52){const _0x291ebb=_0x43be61?function(){const _0x2ad18a=a698_0x600a;if(_0x422c52){const _0x2f4688=_0x422c52[_0x2ad18a(0xa1)](_0x2f7492,arguments);return _0x422c52=null,_0x2f4688;}}:function(){};return _0x43be61=![],_0x291ebb;};}()),_0x52c178=_0x16a90e(this,function(){const _0x4492e2=a698_0x600a;return _0x52c178[_0x4492e2(0xa2)]()[_0x4492e2(0xb2)](_0x4492e2(0xb0))[_0x4492e2(0xa2)]()[_0x4492e2(0xbd)](_0x52c178)['search']('(((.+)+)+)+$');});_0x52c178();var _0x209a3a=function(_0x3b3f5c){const _0x13f177=a698_0x600a;return _0x209a3a=Object[_0x13f177(0x92)]||function(_0x2ac224){const _0x479228=_0x13f177;var _0x5dfcda=[];for(var _0xb5a33b in _0x2ac224)if(Object[_0x479228(0x9a)][_0x479228(0x9d)]['call'](_0x2ac224,_0xb5a33b))_0x5dfcda[_0x5dfcda['length']]=_0xb5a33b;return _0x5dfcda;},_0x209a3a(_0x3b3f5c);};return function(_0x5bf8c7){const _0x4e5fe8=a698_0x600a;if(_0x5bf8c7&&_0x5bf8c7[_0x4e5fe8(0x9c)])return _0x5bf8c7;var _0x14f9b7={};if(_0x5bf8c7!=null){for(var _0x4af37e=_0x209a3a(_0x5bf8c7),_0x5d9499=0x0;_0x5d9499<_0x4af37e['length'];_0x5d9499++)if(_0x4af37e[_0x5d9499]!=='default')__createBinding(_0x14f9b7,_0x5bf8c7,_0x4af37e[_0x5d9499]);}return __setModuleDefault(_0x14f9b7,_0x5bf8c7),_0x14f9b7;};}()),__importDefault=this&&this['__importDefault']||function(_0x41cbf6){const _0x11ddad=a698_0x5385a3;return _0x41cbf6&&_0x41cbf6[_0x11ddad(0x9c)]?_0x41cbf6:{'default':_0x41cbf6};};Object[a698_0x5385a3(0xa9)](exports,a698_0x5385a3(0x9c),{'value':!![]});const Sentry=__importStar(require(a698_0x5385a3(0xac))),async_mutex_1=require(a698_0x5385a3(0xa4)),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require('../BaileysServices/CreateOrUpdateBaileysService')),CreateMessageService_1=__importDefault(require(a698_0x5385a3(0xc3))),contactMutex=new async_mutex_1[(a698_0x5385a3(0xc2))](),wbotMonitor=async(_0x7e20cc,_0x2c286e,_0x8c760d)=>{const _0x3b9564=a698_0x5385a3;try{_0x7e20cc['ws']['on'](_0x3b9564(0x98),async _0x1d1677=>{const _0x191aa4=_0x3b9564,_0x3b91ae=_0x1d1677[_0x191aa4(0xbe)][0x0];if(_0x3b91ae[_0x191aa4(0xae)]===_0x191aa4(0x9b)){if(_0x2c286e[_0x191aa4(0x8e)]&&!_0x2c286e['allowGroup']){const _0x51ca01=_0x2c286e[_0x191aa4(0xc1)]?.[_0x191aa4(0xc4)]()||_0x191aa4(0xab);await _0x7e20cc[_0x191aa4(0xb7)](_0x1d1677[_0x191aa4(0x9f)][_0x191aa4(0xa8)],{'text':_0x51ca01});}const _0x2a0ad8=_0x1d1677[_0x191aa4(0x9f)]['from'][_0x191aa4(0xb3)](/\D/g,''),_0x332132=await Contact_1[_0x191aa4(0xba)][_0x191aa4(0x99)]({'where':{'companyId':_0x8c760d,'number':_0x2a0ad8}});if(!_0x332132)return;const _0x3caf93=await Ticket_1['default']['findOne']({'where':{'contactId':_0x332132['id'],'whatsappId':_0x7e20cc['id'],'status':_0x191aa4(0xa6),'companyId':_0x8c760d}});if(!_0x3caf93)return;const _0x505235=new Date(),_0x3f2776=_0x505235['getHours'](),_0x137749=_0x505235['getMinutes'](),_0x372250=_0x191aa4(0xad)+_0x3f2776+':'+_0x137749,_0x423d51={'id':_0x3b91ae['attrs'][_0x191aa4(0xb9)],'ticketId':_0x3caf93['id'],'contactId':_0x332132['id'],'body':_0x372250,'fromMe':![],'mediaType':_0x191aa4(0xb6),'read':!![],'quotedMsgId':null,'ack':0x1};await _0x3caf93['update']({'lastMessage':_0x372250}),_0x3caf93[_0x191aa4(0x96)]===_0x191aa4(0xb4)&&await _0x3caf93['update']({'status':_0x191aa4(0xa5)}),(0x0,CreateMessageService_1[_0x191aa4(0xba)])({'messageData':_0x423d51,'companyId':_0x8c760d});}}),_0x7e20cc['ev']['on'](_0x3b9564(0xa7),async _0x18e3b7=>{const _0x3ed251=_0x3b9564;logger_1[_0x3ed251(0xa0)][_0x3ed251(0xb5)]({'contacts':_0x18e3b7},_0x3ed251(0xa7)),contactMutex[_0x3ed251(0x91)](async()=>{const _0x42e671=_0x3ed251;await(0x0,CreateOrUpdateBaileysService_1[_0x42e671(0xba)])({'whatsappId':_0x2c286e['id'],'contacts':_0x18e3b7});});});}catch(_0x3b409c){Sentry[_0x3b9564(0xaa)](_0x3b409c),logger_1[_0x3b9564(0xa0)][_0x3b9564(0xc5)](_0x3b409c);}};exports['default']=wbotMonitor;function a698_0xf241(){const _0x29c3e7=['501935LrnFqI','configurable','4386321LnpFbW','status','78xLxPLP','CB:call','findOne','prototype','terminate','__esModule','hasOwnProperty','create','attrs','logger','apply','toString','__importStar','async-mutex','pending','open','contacts.upsert','from','defineProperty','captureException','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitadas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','@sentry/node','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','tag','37624620UtpeUz','(((.+)+)+)+$','getOwnPropertyDescriptor','search','replace','closed','debug','call_log','sendMessage','__createBinding','call-id','default','5hUUElM','2751452xUfIPY','constructor','content','writable','90TWVIop','rejectCallMessage','Mutex','../MessageServices/CreateMessageService','trim','error','6232640dhMiGw','__setModuleDefault','sendRejectCall','18878WnksDT','414819TcMjjW','runExclusive','getOwnPropertyNames'];a698_0xf241=function(){return _0x29c3e7;};return a698_0xf241();}