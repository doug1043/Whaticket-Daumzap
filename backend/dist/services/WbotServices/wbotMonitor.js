'use strict';const a584_0x14828e=a584_0xd2b1;(function(_0x5bcf22,_0x1693bd){const _0x3dbfc2=a584_0xd2b1,_0x4680d6=_0x5bcf22();while(!![]){try{const _0x39e180=parseInt(_0x3dbfc2(0x8f))/0x1*(parseInt(_0x3dbfc2(0x89))/0x2)+parseInt(_0x3dbfc2(0xb6))/0x3+-parseInt(_0x3dbfc2(0xa6))/0x4*(-parseInt(_0x3dbfc2(0xaf))/0x5)+-parseInt(_0x3dbfc2(0x9e))/0x6*(-parseInt(_0x3dbfc2(0xa8))/0x7)+parseInt(_0x3dbfc2(0x8d))/0x8+parseInt(_0x3dbfc2(0x8a))/0x9+parseInt(_0x3dbfc2(0x9f))/0xa*(-parseInt(_0x3dbfc2(0x91))/0xb);if(_0x39e180===_0x1693bd)break;else _0x4680d6['push'](_0x4680d6['shift']());}catch(_0x1d1113){_0x4680d6['push'](_0x4680d6['shift']());}}}(a584_0x4349,0xc382b));function a584_0xd2b1(_0x45047e,_0x520f00){const _0xa2840a=a584_0x4349();return a584_0xd2b1=function(_0xebfab0,_0x4f6a58){_0xebfab0=_0xebfab0-0x82;let _0x4349e7=_0xa2840a[_0xebfab0];return _0x4349e7;},a584_0xd2b1(_0x45047e,_0x520f00);}var __createBinding=this&&this['__createBinding']||(Object[a584_0x14828e(0xae)]?function(_0x28c44f,_0x1b0ba0,_0x54aea1,_0x27c6ee){const _0x3d3142=a584_0x14828e;if(_0x27c6ee===undefined)_0x27c6ee=_0x54aea1;var _0x3fc780=Object['getOwnPropertyDescriptor'](_0x1b0ba0,_0x54aea1);(!_0x3fc780||(_0x3d3142(0xaa)in _0x3fc780?!_0x1b0ba0[_0x3d3142(0x86)]:_0x3fc780['writable']||_0x3fc780['configurable']))&&(_0x3fc780={'enumerable':!![],'get':function(){return _0x1b0ba0[_0x54aea1];}}),Object[_0x3d3142(0xa4)](_0x28c44f,_0x27c6ee,_0x3fc780);}:function(_0x9e708,_0x108a54,_0x4efcdb,_0x1cf8f1){if(_0x1cf8f1===undefined)_0x1cf8f1=_0x4efcdb;_0x9e708[_0x1cf8f1]=_0x108a54[_0x4efcdb];}),__setModuleDefault=this&&this[a584_0x14828e(0xb3)]||(Object[a584_0x14828e(0xae)]?function(_0x16f418,_0xf401cf){const _0x44ca69=a584_0x14828e;Object[_0x44ca69(0xa4)](_0x16f418,_0x44ca69(0x82),{'enumerable':!![],'value':_0xf401cf});}:function(_0x3f51bd,_0x89323a){const _0x598c8f=a584_0x14828e;_0x3f51bd[_0x598c8f(0x82)]=_0x89323a;}),__importStar=this&&this[a584_0x14828e(0xab)]||(function(){const _0x55fb79=(function(){let _0x1365e3=!![];return function(_0x17c26b,_0x4934d8){const _0x452e09=_0x1365e3?function(){const _0x172d59=a584_0xd2b1;if(_0x4934d8){const _0x3c765f=_0x4934d8[_0x172d59(0x83)](_0x17c26b,arguments);return _0x4934d8=null,_0x3c765f;}}:function(){};return _0x1365e3=![],_0x452e09;};}()),_0x221beb=_0x55fb79(this,function(){const _0x53b03a=a584_0xd2b1;return _0x221beb[_0x53b03a(0xa9)]()[_0x53b03a(0x9a)]('(((.+)+)+)+$')['toString']()[_0x53b03a(0xb5)](_0x221beb)[_0x53b03a(0x9a)](_0x53b03a(0x99));});_0x221beb();var _0xf476b9=function(_0x4eca4c){const _0x14b5bf=a584_0xd2b1;return _0xf476b9=Object[_0x14b5bf(0x90)]||function(_0x8dd741){const _0x6700c6=_0x14b5bf;var _0x21ac7f=[];for(var _0x14857f in _0x8dd741)if(Object[_0x6700c6(0x97)][_0x6700c6(0x84)]['call'](_0x8dd741,_0x14857f))_0x21ac7f[_0x21ac7f[_0x6700c6(0x9d)]]=_0x14857f;return _0x21ac7f;},_0xf476b9(_0x4eca4c);};return function(_0x2a13d8){const _0x205f64=a584_0xd2b1;if(_0x2a13d8&&_0x2a13d8['__esModule'])return _0x2a13d8;var _0x4dd0d2={};if(_0x2a13d8!=null){for(var _0x21c149=_0xf476b9(_0x2a13d8),_0x41dbf8=0x0;_0x41dbf8<_0x21c149[_0x205f64(0x9d)];_0x41dbf8++)if(_0x21c149[_0x41dbf8]!==_0x205f64(0x82))__createBinding(_0x4dd0d2,_0x2a13d8,_0x21c149[_0x41dbf8]);}return __setModuleDefault(_0x4dd0d2,_0x2a13d8),_0x4dd0d2;};}()),__importDefault=this&&this['__importDefault']||function(_0x34bac6){const _0x21013b=a584_0x14828e;return _0x34bac6&&_0x34bac6[_0x21013b(0x86)]?_0x34bac6:{'default':_0x34bac6};};Object[a584_0x14828e(0xa4)](exports,a584_0x14828e(0x86),{'value':!![]});function a584_0x4349(){const _0x348571=['__importStar','sendMessage','content','create','3468815nSSdTR','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','replace','tag','__setModuleDefault','findOne','constructor','1019751IrkEqC','logger','runExclusive','terminate','default','apply','hasOwnProperty','Mutex','__esModule','../MessageServices/CreateMessageService','call_log','662uHNFBp','1254645LWQWqJ','debug','disabled','3448832ZUkqSt','getHours','11ESDFjn','getOwnPropertyNames','3509nJrMNM','call','contacts.upsert','from','closed','call-id','prototype','update','(((.+)+)+)+$','search','error','captureException','length','239994ALqazi','74200kOkGcP','../BaileysServices/CreateOrUpdateBaileysService','../../models/Ticket','../../utils/logger','attrs','defineProperty','CB:call','4lxpPlo','value','273tbavBN','toString','get'];a584_0x4349=function(){return _0x348571;};return a584_0x4349();}const Sentry=__importStar(require('@sentry/node')),async_mutex_1=require('async-mutex'),Contact_1=__importDefault(require('../../models/Contact')),Setting_1=__importDefault(require('../../models/Setting')),Ticket_1=__importDefault(require(a584_0x14828e(0xa1))),logger_1=require(a584_0x14828e(0xa2)),CreateOrUpdateBaileysService_1=__importDefault(require(a584_0x14828e(0xa0))),CreateMessageService_1=__importDefault(require(a584_0x14828e(0x87))),contactMutex=new async_mutex_1[(a584_0x14828e(0x85))](),wbotMonitor=async(_0x1a634a,_0x5915b7,_0x344805)=>{const _0xd71e90=a584_0x14828e;try{_0x1a634a['ws']['on'](_0xd71e90(0xa5),async _0x4f2b84=>{const _0x1b750a=_0xd71e90,_0x15f55=_0x4f2b84[_0x1b750a(0xad)][0x0];if(_0x15f55[_0x1b750a(0xb2)]===_0x1b750a(0xb9)){const _0x493713=await Setting_1['default'][_0x1b750a(0xb4)]({'where':{'key':_0x1b750a(0x92),'companyId':_0x344805}});if(_0x493713[_0x1b750a(0xa7)]===_0x1b750a(0x8c)){await _0x1a634a[_0x1b750a(0xac)](_0x4f2b84[_0x1b750a(0xa3)]['from'],{'text':_0x1b750a(0xb0)});const _0x373e41=_0x4f2b84[_0x1b750a(0xa3)][_0x1b750a(0x94)][_0x1b750a(0xb1)](/\D/g,''),_0x5c959b=await Contact_1['default']['findOne']({'where':{'companyId':_0x344805,'number':_0x373e41}}),_0x344579=await Ticket_1[_0x1b750a(0x82)]['findOne']({'where':{'contactId':_0x5c959b['id'],'whatsappId':_0x1a634a['id'],'status':'open','companyId':_0x344805}});if(!_0x344579)return;const _0x3f7b8b=new Date(),_0x274892=_0x3f7b8b[_0x1b750a(0x8e)](),_0xba87d8=_0x3f7b8b['getMinutes'](),_0x3a8b2c='Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20'+_0x274892+':'+_0xba87d8,_0x422191={'id':_0x15f55[_0x1b750a(0xa3)][_0x1b750a(0x96)],'ticketId':_0x344579['id'],'contactId':_0x5c959b['id'],'body':_0x3a8b2c,'fromMe':![],'mediaType':_0x1b750a(0x88),'read':!![],'quotedMsgId':null,'ack':0x1};await _0x344579[_0x1b750a(0x98)]({'lastMessage':_0x3a8b2c}),_0x344579['status']===_0x1b750a(0x95)&&await _0x344579[_0x1b750a(0x98)]({'status':'pending'}),(0x0,CreateMessageService_1['default'])({'messageData':_0x422191,'companyId':_0x344805});}}}),_0x1a634a['ev']['on'](_0xd71e90(0x93),async _0x1d2711=>{const _0x3231c2=_0xd71e90;logger_1['logger'][_0x3231c2(0x8b)]({'contacts':_0x1d2711},'contacts.upsert'),contactMutex[_0x3231c2(0xb8)](async()=>{const _0x55bf02=_0x3231c2;await(0x0,CreateOrUpdateBaileysService_1[_0x55bf02(0x82)])({'whatsappId':_0x5915b7['id'],'contacts':_0x1d2711});});});}catch(_0x49084a){Sentry[_0xd71e90(0x9c)](_0x49084a),logger_1[_0xd71e90(0xb7)][_0xd71e90(0x9b)](_0x49084a);}};exports[a584_0x14828e(0x82)]=wbotMonitor;