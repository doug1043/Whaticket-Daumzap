'use strict';const a577_0x31774a=a577_0x59ad;(function(_0x5038e0,_0x4c5880){const _0x204d07=a577_0x59ad,_0x56bc10=_0x5038e0();while(!![]){try{const _0x24ff2c=-parseInt(_0x204d07(0x23b))/0x1+-parseInt(_0x204d07(0x20e))/0x2+parseInt(_0x204d07(0x1c4))/0x3*(-parseInt(_0x204d07(0x210))/0x4)+-parseInt(_0x204d07(0x223))/0x5*(-parseInt(_0x204d07(0x25c))/0x6)+parseInt(_0x204d07(0x272))/0x7*(parseInt(_0x204d07(0x1d7))/0x8)+parseInt(_0x204d07(0x279))/0x9+parseInt(_0x204d07(0x225))/0xa;if(_0x24ff2c===_0x4c5880)break;else _0x56bc10['push'](_0x56bc10['shift']());}catch(_0xa73ba5){_0x56bc10['push'](_0x56bc10['shift']());}}}(a577_0x4fd2,0x64894));var __createBinding=this&&this[a577_0x31774a(0x245)]||(Object[a577_0x31774a(0x1e4)]?function(_0x1636fc,_0x44b71d,_0x132cfa,_0x419b5f){const _0x3b9964=a577_0x31774a;if(_0x419b5f===undefined)_0x419b5f=_0x132cfa;var _0x302a3d=Object[_0x3b9964(0x27f)](_0x44b71d,_0x132cfa);(!_0x302a3d||(_0x3b9964(0x1eb)in _0x302a3d?!_0x44b71d[_0x3b9964(0x221)]:_0x302a3d[_0x3b9964(0x215)]||_0x302a3d[_0x3b9964(0x206)]))&&(_0x302a3d={'enumerable':!![],'get':function(){return _0x44b71d[_0x132cfa];}}),Object[_0x3b9964(0x23a)](_0x1636fc,_0x419b5f,_0x302a3d);}:function(_0x4effac,_0x2321fc,_0x5566b8,_0x1a1a43){if(_0x1a1a43===undefined)_0x1a1a43=_0x5566b8;_0x4effac[_0x1a1a43]=_0x2321fc[_0x5566b8];}),__setModuleDefault=this&&this[a577_0x31774a(0x280)]||(Object[a577_0x31774a(0x1e4)]?function(_0x586486,_0x546ffd){const _0x2beb7b=a577_0x31774a;Object[_0x2beb7b(0x23a)](_0x586486,_0x2beb7b(0x1fe),{'enumerable':!![],'value':_0x546ffd});}:function(_0x3052e1,_0x4d120c){const _0x1d8247=a577_0x31774a;_0x3052e1[_0x1d8247(0x1fe)]=_0x4d120c;}),__importStar=this&&this[a577_0x31774a(0x20d)]||(function(){const _0xea4664=(function(){let _0x20aa20=!![];return function(_0x2c004e,_0x299979){const _0x9aaf92=_0x20aa20?function(){const _0x4b12f0=a577_0x59ad;if(_0x299979){const _0x3b85fe=_0x299979[_0x4b12f0(0x21d)](_0x2c004e,arguments);return _0x299979=null,_0x3b85fe;}}:function(){};return _0x20aa20=![],_0x9aaf92;};}()),_0xc1de58=_0xea4664(this,function(){const _0x59be75=a577_0x59ad;return _0xc1de58[_0x59be75(0x1d9)]()['search'](_0x59be75(0x208))[_0x59be75(0x1d9)]()[_0x59be75(0x1e0)](_0xc1de58)[_0x59be75(0x274)](_0x59be75(0x208));});_0xc1de58();var _0x36fae1=function(_0x4c54eb){const _0xe0d62b=a577_0x59ad;return _0x36fae1=Object[_0xe0d62b(0x200)]||function(_0x47f95f){const _0x5763b2=_0xe0d62b;var _0x3e5a1e=[];for(var _0x3e2aa2 in _0x47f95f)if(Object[_0x5763b2(0x27d)][_0x5763b2(0x269)][_0x5763b2(0x232)](_0x47f95f,_0x3e2aa2))_0x3e5a1e[_0x3e5a1e[_0x5763b2(0x1f1)]]=_0x3e2aa2;return _0x3e5a1e;},_0x36fae1(_0x4c54eb);};return function(_0x2b6840){const _0x3fb6cf=a577_0x59ad;if(_0x2b6840&&_0x2b6840[_0x3fb6cf(0x221)])return _0x2b6840;var _0x1a3456={};if(_0x2b6840!=null){for(var _0x12b1dc=_0x36fae1(_0x2b6840),_0x4eab86=0x0;_0x4eab86<_0x12b1dc[_0x3fb6cf(0x1f1)];_0x4eab86++)if(_0x12b1dc[_0x4eab86]!=='default')__createBinding(_0x1a3456,_0x2b6840,_0x12b1dc[_0x4eab86]);}return __setModuleDefault(_0x1a3456,_0x2b6840),_0x1a3456;};}()),__importDefault=this&&this[a577_0x31774a(0x20b)]||function(_0x13c3f6){const _0x5347de=a577_0x31774a;return _0x13c3f6&&_0x13c3f6[_0x5347de(0x221)]?_0x13c3f6:{'default':_0x13c3f6};};Object[a577_0x31774a(0x23a)](exports,a577_0x31774a(0x221),{'value':!![]}),exports[a577_0x31774a(0x217)]=exports[a577_0x31774a(0x1c7)]=exports[a577_0x31774a(0x250)]=exports[a577_0x31774a(0x258)]=exports[a577_0x31774a(0x203)]=exports[a577_0x31774a(0x265)]=exports[a577_0x31774a(0x1e7)]=exports['verifyMessage']=exports[a577_0x31774a(0x23d)]=exports[a577_0x31774a(0x1cc)]=void 0x0;const Message_1=__importDefault(require(a577_0x31774a(0x1f3))),Ticket_1=__importDefault(require(a577_0x31774a(0x207))),Contact_1=__importDefault(require(a577_0x31774a(0x1da))),socket_1=require('../../libs/socket'),baileys_1=require(a577_0x31774a(0x20a)),CreateMessageService_1=__importDefault(require(a577_0x31774a(0x213))),GetHandlers_1=require(a577_0x31774a(0x20f)),Queue_1=__importDefault(require(a577_0x31774a(0x1be))),User_1=__importDefault(require(a577_0x31774a(0x1c2))),Sentry=__importStar(require(a577_0x31774a(0x1c1))),CreateOrUpdateContactService_1=__importDefault(require(a577_0x31774a(0x1c8))),stream_throttle_1=require(a577_0x31774a(0x254)),MakeRandomId_1=require(a577_0x31774a(0x1d5)),CheckSettings_1=__importDefault(require(a577_0x31774a(0x1d8))),GetHandlers_2=require(a577_0x31774a(0x20f)),GetPublicPath_1=require(a577_0x31774a(0x239)),logger_1=require('../../utils/logger'),util_1=require(a577_0x31774a(0x25e)),fs_1=__importStar(require('fs')),path_1=require(a577_0x31774a(0x240)),OldMessage_1=__importDefault(require('../../models/OldMessage')),ShowWhatsAppService_1=__importDefault(require(a577_0x31774a(0x1d6))),lodash_1=require(a577_0x31774a(0x20c)),ShowQueueIntegrationService_1=__importDefault(require('../QueueIntegrationServices/ShowQueueIntegrationService')),wbotMessageListener_1=require(a577_0x31774a(0x259)),Setting_1=__importDefault(require(a577_0x31774a(0x24b))),Campaign_1=__importDefault(require('../../models/Campaign')),CampaignShipping_1=__importDefault(require(a577_0x31774a(0x276))),moment_1=__importDefault(require(a577_0x31774a(0x21c))),queues_1=require(a577_0x31774a(0x27c)),sequelize_1=require(a577_0x31774a(0x26e)),SendWhatsAppMessage_1=__importDefault(require(a577_0x31774a(0x1ec))),Whatsapp_1=__importDefault(require(a577_0x31774a(0x27b))),writeFileAsync=(0x0,util_1[a577_0x31774a(0x1d3)])(fs_1[a577_0x31774a(0x251)]),saveMediaToFile=async(_0x442ec5,_0x169201)=>{const _0x53d28b=a577_0x31774a;if(!_0x442ec5['filename']){const _0x2fda5b=_0x442ec5[_0x53d28b(0x1e3)][_0x53d28b(0x1f9)]('/')[0x1][_0x53d28b(0x1f9)](';')[0x0];_0x442ec5['filename']=new Date()[_0x53d28b(0x1ef)]()+'.'+_0x2fda5b;}const _0x352f27=(0x0,GetPublicPath_1['getPublicPath'])(),_0x1d46b7=(0x0,MakeRandomId_1['makeRandomId'])(0xa),_0x2b003b='media/'+_0x169201[_0x53d28b(0x1c6)]+'/'+_0x169201['contactId']+'/'+_0x169201['id']+'/'+_0x1d46b7;try{await fs_1[_0x53d28b(0x1fe)]['promises'][_0x53d28b(0x211)]((0x0,path_1[_0x53d28b(0x21a)])(_0x352f27,_0x2b003b),{'recursive':!![]}),await writeFileAsync((0x0,path_1[_0x53d28b(0x21a)])(_0x352f27,_0x2b003b,_0x442ec5[_0x53d28b(0x1e1)]),_0x442ec5[_0x53d28b(0x266)],'base64');}catch(_0x191dc1){Sentry[_0x53d28b(0x22d)](_0x191dc1),logger_1[_0x53d28b(0x228)]['error'](_0x191dc1);}return _0x2b003b+'/'+_0x442ec5['filename'];},normalizeMediaType=_0x27cb85=>{const _0x3ebc36=a577_0x31774a,_0x363c82=[_0x3ebc36(0x26a),_0x3ebc36(0x1e6),_0x3ebc36(0x261),'document'],_0x1482d6=_0x27cb85['split']('/')[0x0];if(!_0x363c82[_0x3ebc36(0x1fc)](_0x1482d6))return _0x3ebc36(0x26d);return _0x1482d6;};exports[a577_0x31774a(0x1cc)]=normalizeMediaType;const normalizeThumbnailMediaType=_0x447357=>{const _0x2f3d2d=a577_0x31774a,_0x417c88=['thumbnail-video',_0x2f3d2d(0x256),_0x2f3d2d(0x247)],_0x366d1b=_0x447357[_0x2f3d2d(0x1f9)]('/')[0x0];if(!_0x417c88[_0x2f3d2d(0x1fc)](_0x2f3d2d(0x264)+_0x366d1b))return _0x2f3d2d(0x247);return _0x366d1b;};exports[a577_0x31774a(0x23d)]=normalizeThumbnailMediaType;const downloadMedia=async(_0x56b5c6,_0x5a8e4f,_0x470c69)=>{const _0x269f6a=a577_0x31774a,_0x26b1cb=(0x0,GetHandlers_2['getUnpackedMessage'])(_0x56b5c6),_0x22a134=(0x0,GetHandlers_2[_0x269f6a(0x1bf)])(_0x26b1cb);if(!_0x22a134)return null;const _0x5e9efc=parseInt(await(0x0,CheckSettings_1[_0x269f6a(0x1fe)])(_0x269f6a(0x271),'15'),0xa);if(_0x5a8e4f&&_0x22a134?.['fileLength']&&+_0x22a134[_0x269f6a(0x25a)]>_0x5e9efc*0x400*0x400){const _0x59c197=_0x269f6a(0x278)+_0x5e9efc+'\x20MiB';if(!_0x470c69['isGroup']){const _0x2a2a2c=await(0x0,SendWhatsAppMessage_1[_0x269f6a(0x1fe)])({'ticket':_0x470c69,'body':_0x59c197});_0x2a2a2c[_0x269f6a(0x234)][_0x269f6a(0x25b)][_0x269f6a(0x27e)]=_0x269f6a(0x24f);}throw new Error(_0x269f6a(0x218));}const _0x8200af=_0x26b1cb?.[_0x269f6a(0x1e5)]?_0x269f6a(0x26d):(0x0,exports[_0x269f6a(0x1cc)])(_0x22a134[_0x269f6a(0x1e3)]);let _0x40f0ed,_0x4d43da=0x0;while(_0x4d43da<0xa&&!_0x40f0ed){try{const _0x501ec2={..._0x22a134};_0x501ec2?.[_0x269f6a(0x262)]&&(_0x501ec2['url']=''),_0x40f0ed=await(0x0,baileys_1[_0x269f6a(0x1fd)])(_0x501ec2,_0x8200af);}catch(_0x5a7f1d){_0x4d43da+=0x1,await new Promise(_0x4e897d=>{setTimeout(_0x4e897d,0x3e8*_0x4d43da*0x2);}),logger_1[_0x269f6a(0x228)][_0x269f6a(0x209)](_0x269f6a(0x230)+_0x4d43da+'\x20de\x20baixar\x20o\x20arquivo\x20'+_0x56b5c6?.['key']?.['id']);}}if(!_0x40f0ed)throw new Error(_0x269f6a(0x236));const _0xcbc61=await downloadStream(_0x40f0ed);if(!_0xcbc61){Sentry[_0x269f6a(0x249)](_0x269f6a(0x1fb),{'msg':_0x56b5c6}),Sentry[_0x269f6a(0x22d)](new Error('ERR_WAPP_DOWNLOAD_MEDIA'));throw new Error(_0x269f6a(0x1fb));}let _0x35b759=_0x26b1cb?.[_0x269f6a(0x1e5)]?.[_0x269f6a(0x1ea)]||'';if(!_0x35b759){const _0xb4344=_0x22a134['mimetype']['split']('/')[0x1]['split'](';')[0x0];_0x35b759=(0x0,MakeRandomId_1[_0x269f6a(0x233)])(0x5)+'-'+new Date()['getTime']()+'.'+_0xb4344;}else _0x35b759=_0x35b759[_0x269f6a(0x1f9)]('.')['slice'](0x0,-0x1)[_0x269f6a(0x21a)]('.')+'.'+(0x0,MakeRandomId_1[_0x269f6a(0x233)])(0x5)+'.'+_0x35b759[_0x269f6a(0x1f9)]('.')['slice'](-0x1);const _0x11fe74={'data':_0xcbc61,'mimetype':_0x22a134[_0x269f6a(0x1e3)],'filename':_0x35b759};return _0x11fe74;},downloadStream=async _0x18f593=>{const _0x50b0e5=a577_0x31774a,_0x3bb9fb=0x5*0x400*0x400/0x8,_0x436f1f=0x400*0x400/0x8,_0x446def=0x400*0x400,_0x1dc0dc=new stream_throttle_1['Throttle']({'rate':_0x3bb9fb});let _0x2fc010=Buffer[_0x50b0e5(0x268)]([]),_0x49dedc=0x0;try{for await(const _0x5693a5 of _0x18f593['pipe'](_0x1dc0dc)){_0x2fc010=Buffer['concat']([_0x2fc010,_0x5693a5]),_0x49dedc+=_0x5693a5[_0x50b0e5(0x1f1)],_0x49dedc>_0x446def&&(_0x1dc0dc[_0x50b0e5(0x1e8)]=_0x436f1f);}}catch(_0xa22f00){Sentry[_0x50b0e5(0x249)](_0x50b0e5(0x1fb),{'error':_0xa22f00}),Sentry[_0x50b0e5(0x22d)](new Error(_0x50b0e5(0x1fb)));throw new Error(_0x50b0e5(0x1fb));}return _0x2fc010;},downloadThumbnail=async({thumbnailDirectPath:_0x26a8da,mediaKey:_0x1ad4c5,mimetype:_0x158091})=>{const _0x59a47f=a577_0x31774a;if(!_0x26a8da||!_0x1ad4c5)return null;const _0x41ddee=await(0x0,baileys_1['downloadContentFromMessage'])({'mediaKey':_0x1ad4c5,'directPath':_0x26a8da},_0x158091?(0x0,exports['normalizeThumbnailMediaType'])(_0x158091):'thumbnail-link');if(!_0x41ddee)throw new Error(_0x59a47f(0x236));const _0x203db8=await downloadStream(_0x41ddee);if(!_0x203db8)throw new Error(_0x59a47f(0x1fb));const _0x5c63d6=_0x59a47f(0x264)+(0x0,MakeRandomId_1[_0x59a47f(0x233)])(0x5)+'-'+new Date()['getTime']()+_0x59a47f(0x220),_0x3ca53d={'data':_0x203db8,'mimetype':_0x59a47f(0x202),'filename':_0x5c63d6};return _0x3ca53d;},verifyMessage=async(_0x4169ef,_0x1f4ef2,_0x159269,_0x3c4a4c=null)=>{const _0x4f2162=a577_0x31774a,_0x5f29a6=(0x0,socket_1[_0x4f2162(0x1ee)])(),_0x3ad054=await verifyQuotedMessage(_0x4169ef),_0x5952c6=(0x0,GetHandlers_1['getBodyMessage'])(_0x4169ef),_0x4b37f1={'id':_0x4169ef[_0x4f2162(0x1c9)]['id'],'ticketId':_0x1f4ef2['id'],'userId':_0x3c4a4c,'contactId':_0x4169ef[_0x4f2162(0x1c9)][_0x4f2162(0x1f2)]?undefined:_0x159269['id'],'body':_0x5952c6,'fromMe':_0x4169ef[_0x4f2162(0x1c9)][_0x4f2162(0x1f2)],'mediaType':_0x4169ef['message'][_0x4f2162(0x1c5)]?_0x4f2162(0x1c5):null,'read':_0x4169ef['key'][_0x4f2162(0x1f2)],'quotedMsgId':_0x3ad054?.['id'],'ack':_0x4169ef[_0x4f2162(0x1d0)],'remoteJid':_0x4169ef[_0x4f2162(0x1c9)][_0x4f2162(0x235)],'participant':_0x4169ef[_0x4f2162(0x1c9)][_0x4f2162(0x1d4)],'dataJson':JSON['stringify'](_0x4169ef),'isEdited':![]};await _0x1f4ef2['update']({'lastMessage':_0x5952c6[_0x4f2162(0x23f)](0x0,0xff)[_0x4f2162(0x201)](/\n/g,'\x20')});const _0x5db378=await(0x0,CreateMessageService_1[_0x4f2162(0x1fe)])({'messageData':_0x4b37f1,'companyId':_0x1f4ef2[_0x4f2162(0x1c6)]});return!_0x4169ef[_0x4f2162(0x1c9)][_0x4f2162(0x1f2)]&&_0x1f4ef2['status']===_0x4f2162(0x1f8)&&(await _0x1f4ef2['update']({'status':_0x4f2162(0x1cd)}),await _0x1f4ef2[_0x4f2162(0x24d)]({'include':[{'model':Queue_1[_0x4f2162(0x1fe)],'as':'queue'},{'model':User_1[_0x4f2162(0x1fe)],'as':_0x4f2162(0x1ce)},{'model':Contact_1[_0x4f2162(0x1fe)],'as':_0x4f2162(0x219)}]}),_0x5f29a6['to'](_0x4f2162(0x253)+_0x1f4ef2[_0x4f2162(0x1c6)]+_0x4f2162(0x24e))['to']('queue-'+_0x1f4ef2['queueId']+'-closed')[_0x4f2162(0x227)](_0x4f2162(0x253)+_0x1f4ef2[_0x4f2162(0x1c6)]+_0x4f2162(0x1ca),{'action':_0x4f2162(0x226),'ticket':_0x1f4ef2,'ticketId':_0x1f4ef2['id']}),_0x5f29a6['to'](_0x4f2162(0x253)+_0x1f4ef2[_0x4f2162(0x1c6)]+'-'+_0x1f4ef2['status'])['to'](_0x4f2162(0x24c)+_0x1f4ef2[_0x4f2162(0x1dd)]+'-'+_0x1f4ef2[_0x4f2162(0x1d0)])['to'](_0x1f4ef2['id'][_0x4f2162(0x1d9)]())[_0x4f2162(0x227)](_0x4f2162(0x253)+_0x1f4ef2[_0x4f2162(0x1c6)]+'-ticket',{'action':'update','ticket':_0x1f4ef2,'ticketId':_0x1f4ef2['id']})),_0x5db378;};function a577_0x4fd2(){const _0x45d794=['amountUsedBotQueues','queue','__createBinding','env','thumbnail-document','ack','setExtra','DispatchConfirmedCampaign','../../models/Setting','queue-','reload','-closed','*Mensagem\x20do\x20sistema*:\x0aArquivo\x20recebido\x20além\x20do\x20limite\x20de\x20tamanho\x20do\x20sistema,\x20se\x20for\x20necessário\x20ele\x20pode\x20ser\x20obtido\x20no\x20aplicativo\x20do\x20whatsapp.','verifyQueue','writeFile','conversation','company-','stream-throttle','notification','thumbnail-image','*\x20-\x20','verifyDeleteMessage','./wbotMessageListener','fileLength','extendedTextMessage','492402CKweoY','finishedAt','util','\x20iniciada\x20para\x20o\x20ticket\x20#','isGroup','image','directPath','greetingMessage','thumbnail-','verifyMediaMessage','data','upsert','from','hasOwnProperty','audio','head','caption','document','sequelize','quotedMsgId','whatsappId','downloadLimit','600152nbpBUj','chatBotType','search','Erro\x20ao\x20processar\x20integração\x20para\x20fila\x20única:','../../models/CampaignShipping','ticketId','*Mensagem\x20Automática*:\x0aNosso\x20sistema\x20aceita\x20apenas\x20arquivos\x20com\x20no\x20máximo\x20','2873313pWqnOZ','dataJson','../../models/Whatsapp','../../queues','prototype','text','getOwnPropertyDescriptor','__setModuleDefault','../../models/Queue','getMessageMedia','📎\x20','@sentry/node','../../models/User','Configurações\x20do\x20WhatsApp\x20não\x20encontradas.','69HCMolX','reactionMessage','companyId','verifyRating','../ContactServices/CreateOrUpdateContactService','key','-ticket','verifyMessage','normalizeMediaType','pending','user','parseToMilliseconds','status','ratingAt','body','promisify','participant','../../helpers/MakeRandomId','../WhatsappService/ShowWhatsAppService','32sFvyNf','../../helpers/CheckSettings','toString','../../models/Contact','.\x20Ignorando\x20em\x20verifyQueue.','Erro\x20ao\x20processar\x20integração\x20para\x20fila\x20escolhida:','queueId','log','ticket','constructor','filename','contactId','mimetype','create','documentMessage','video','verifyContact','rate','g.us','fileName','get','./SendWhatsAppMessage','getBodyMessage','getIO','getTime','update','length','fromMe','../../models/Message','value','displayCurrentMenu','add','Mensagem\x20','closed','split','userId','ERR_WAPP_DOWNLOAD_MEDIA','includes','downloadContentFromMessage','default','handleMessageIntegration','getOwnPropertyNames','replace','image/jpeg','verifyEditedMessage','name','integrationId','configurable','../../models/Ticket','(((.+)+)+)+$','warn','@whiskeysockets/baileys','__importDefault','lodash','__importStar','241742SfwPXM','./GetHandlers','123224AwZipf','mkdir','error','../MessageServices/CreateMessageService','FRONTEND_URL','writable','getQuotedMessageId','verifyRecentCampaign','ERR_FILESIZE_OVER_LIMIT','contact','join','maxUseBotQueues','moment','apply','imageMessage','map','.jpg','__esModule','profilePictureUrl','25ZgNgtP','randomValue','2035500MXgayq','delete','emit','logger','indexOf','campaignQueue','transferMessage','documentWithCaptionMessage','captureException','options','stringify','>>>>\x20erro\x20','useIntegration','call','makeRandomId','message','remoteJid','Failed\x20to\x20get\x20stream','chatbot','getTypeEditedMessage','../../helpers/GetPublicPath','defineProperty','34881vWtXMH','findOne','normalizeThumbnailMediaType','mediaType','substring','path','findByPk','Integração\x20#'];a577_0x4fd2=function(){return _0x45d794;};return a577_0x4fd2();}exports[a577_0x31774a(0x1cb)]=verifyMessage;const verifyQuotedMessage=async _0x16f87b=>{const _0x37f1a7=a577_0x31774a;if(!_0x16f87b)return null;const _0x45291f=(0x0,GetHandlers_1[_0x37f1a7(0x216)])(_0x16f87b);if(!_0x45291f)return null;const _0x58a568=await Message_1[_0x37f1a7(0x1fe)]['findOne']({'where':{'id':_0x45291f}});if(!_0x58a568)return null;return _0x58a568;},verifyContact=async(_0x56e947,_0x149a55,_0x16832e)=>{const _0x1d1e65=a577_0x31774a;let _0x5a8443;try{_0x5a8443=await _0x149a55[_0x1d1e65(0x222)](_0x56e947['id']);}catch(_0x16ae96){Sentry[_0x1d1e65(0x22d)](_0x16ae96),_0x5a8443=process[_0x1d1e65(0x246)][_0x1d1e65(0x214)]+'/nopicture.png';}const _0x1092e6={'name':_0x56e947?.[_0x1d1e65(0x204)]||_0x56e947['id'][_0x1d1e65(0x201)](/\D/g,''),'number':_0x56e947['id'][_0x1d1e65(0x23f)](0x0,_0x56e947['id'][_0x1d1e65(0x229)]('@')),'profilePicUrl':_0x5a8443,'isGroup':_0x56e947['id'][_0x1d1e65(0x1fc)](_0x1d1e65(0x1e9)),'companyId':_0x16832e},_0x54ab79=(0x0,CreateOrUpdateContactService_1['default'])(_0x1092e6);return _0x54ab79;};exports['verifyContact']=verifyContact;const verifyMediaMessage=async(_0x476c00,_0x5460b1,_0x316691,_0x5d195b=null,_0x11bf44=null,_0x1b4dfa=null)=>{const _0x152a00=a577_0x31774a,_0x5e9ae6=(0x0,socket_1['getIO'])(),_0x6fbee6=await verifyQuotedMessage(_0x476c00),_0x105543=_0x11bf44||_0x476c00?.[_0x152a00(0x234)]?.[_0x152a00(0x25b)],_0xc06632=_0x105543&&await downloadThumbnail(_0x105543),_0x1a6f81=await downloadMedia(_0x476c00,_0x5d195b,_0x5460b1);if(!_0x1a6f81&&!_0xc06632)throw new Error(_0x152a00(0x1fb));let _0x1c30d8=null;_0x1a6f81&&(_0x1c30d8=await saveMediaToFile(_0x1a6f81,_0x5460b1));let _0x23b612=null;_0xc06632&&(_0x23b612=await saveMediaToFile(_0xc06632,_0x5460b1));const _0x84a843=(0x0,GetHandlers_1[_0x152a00(0x1ed)])(_0x476c00),_0xf22b59={'id':_0x476c00[_0x152a00(0x1c9)]['id'],'ticketId':_0x5460b1['id'],'userId':_0x1b4dfa,'contactId':_0x476c00[_0x152a00(0x1c9)][_0x152a00(0x1f2)]?undefined:_0x316691['id'],'body':_0x84a843||'','fromMe':_0x476c00[_0x152a00(0x1c9)][_0x152a00(0x1f2)],'read':_0x476c00[_0x152a00(0x1c9)][_0x152a00(0x1f2)],'mediaUrl':_0x1c30d8,'mediaType':_0x1a6f81?.[_0x152a00(0x1e3)][_0x152a00(0x1f9)]('/')[0x0],'thumbnailUrl':_0x23b612,'quotedMsgId':_0x6fbee6?.['id'],'ack':_0x476c00[_0x152a00(0x1d0)],'remoteJid':_0x476c00[_0x152a00(0x1c9)][_0x152a00(0x235)],'participant':_0x476c00[_0x152a00(0x1c9)][_0x152a00(0x1d4)],'dataJson':JSON[_0x152a00(0x22f)](_0x476c00)};await _0x5460b1[_0x152a00(0x1f0)]({'lastMessage':_0x84a843||_0x1a6f81?.[_0x152a00(0x1e1)]?_0x152a00(0x1c0)+_0x1a6f81?.['filename']:''});const _0x41ef56=await(0x0,CreateMessageService_1[_0x152a00(0x1fe)])({'messageData':_0xf22b59,'companyId':_0x5460b1['companyId']});return!_0x476c00[_0x152a00(0x1c9)][_0x152a00(0x1f2)]&&_0x5460b1[_0x152a00(0x1d0)]===_0x152a00(0x1f8)&&(await _0x5460b1[_0x152a00(0x1f0)]({'status':_0x152a00(0x1cd)}),await _0x5460b1[_0x152a00(0x24d)]({'include':[{'model':Queue_1[_0x152a00(0x1fe)],'as':_0x152a00(0x244)},{'model':User_1[_0x152a00(0x1fe)],'as':'user'},{'model':Contact_1[_0x152a00(0x1fe)],'as':'contact'}]}),_0x5e9ae6['to']('company-'+_0x5460b1[_0x152a00(0x1c6)]+_0x152a00(0x24e))['to'](_0x152a00(0x24c)+_0x5460b1[_0x152a00(0x1dd)]+_0x152a00(0x24e))[_0x152a00(0x227)](_0x152a00(0x253)+_0x5460b1[_0x152a00(0x1c6)]+_0x152a00(0x1ca),{'action':_0x152a00(0x226),'ticket':_0x5460b1,'ticketId':_0x5460b1['id']}),_0x5e9ae6['to'](_0x152a00(0x253)+_0x5460b1[_0x152a00(0x1c6)]+'-'+_0x5460b1[_0x152a00(0x1d0)])['to'](_0x152a00(0x24c)+_0x5460b1[_0x152a00(0x1dd)]+'-'+_0x5460b1['status'])['to'](_0x5460b1['id'][_0x152a00(0x1d9)]())[_0x152a00(0x227)](_0x152a00(0x253)+_0x5460b1['companyId']+_0x152a00(0x1ca),{'action':_0x152a00(0x1f0),'ticket':_0x5460b1,'ticketId':_0x5460b1['id']})),_0x41ef56;};exports['verifyMediaMessage']=verifyMediaMessage;const verifyEditedMessage=async(_0x5cd31e,_0x292623,_0x51eb7f)=>{const _0x2770cc=a577_0x31774a,_0x14da25=(0x0,GetHandlers_2[_0x2770cc(0x238)])(_0x5cd31e);let _0x138c27;switch(_0x14da25){case _0x2770cc(0x252):{_0x138c27=_0x5cd31e[_0x2770cc(0x252)];break;}case _0x2770cc(0x25b):{_0x138c27=_0x5cd31e[_0x2770cc(0x25b)]['text'];break;}case _0x2770cc(0x21e):{_0x138c27=_0x5cd31e['imageMessage'][_0x2770cc(0x26c)];break;}case _0x2770cc(0x1e5):{_0x138c27=_0x5cd31e['documentMessage'][_0x2770cc(0x26c)];break;}case _0x2770cc(0x22c):{_0x138c27=_0x5cd31e[_0x2770cc(0x22c)][_0x2770cc(0x234)][_0x2770cc(0x1e5)][_0x2770cc(0x26c)];break;}default:{return;}}const _0x350e3e=await Message_1[_0x2770cc(0x1fe)][_0x2770cc(0x241)](_0x51eb7f),_0x3815e8={'id':_0x350e3e['id'],'ticketId':_0x350e3e['ticketId'],'contactId':_0x350e3e[_0x2770cc(0x1e2)],'body':_0x138c27,'fromMe':_0x350e3e[_0x2770cc(0x1f2)],'mediaType':_0x350e3e[_0x2770cc(0x23e)],'read':_0x350e3e['read'],'quotedMsgId':_0x350e3e[_0x2770cc(0x26f)],'ack':_0x350e3e[_0x2770cc(0x248)],'remoteJid':_0x350e3e[_0x2770cc(0x235)],'participant':_0x350e3e[_0x2770cc(0x1d4)],'dataJson':_0x350e3e[_0x2770cc(0x27a)],'isEdited':!![]},_0x258ef5={'messageId':_0x3815e8['id'],'body':_0x350e3e[_0x2770cc(0x1d2)],'ticketId':_0x350e3e[_0x2770cc(0x277)]};await OldMessage_1[_0x2770cc(0x1fe)][_0x2770cc(0x267)](_0x258ef5),await _0x292623[_0x2770cc(0x1f0)]({'lastMessage':_0x3815e8[_0x2770cc(0x1d2)]}),await(0x0,CreateMessageService_1[_0x2770cc(0x1fe)])({'messageData':_0x3815e8,'companyId':_0x292623[_0x2770cc(0x1c6)]});const _0x1c3690=(0x0,socket_1['getIO'])();_0x1c3690['to'](_0x292623[_0x2770cc(0x1d0)])['to'](_0x292623['id'][_0x2770cc(0x1d9)]())[_0x2770cc(0x227)](_0x2770cc(0x253)+_0x292623[_0x2770cc(0x1c6)]+_0x2770cc(0x1ca),{'action':_0x2770cc(0x1f0),'ticket':_0x292623,'ticketId':_0x292623['id']});};exports[a577_0x31774a(0x203)]=verifyEditedMessage;const verifyDeleteMessage=async(_0x28b2fd,_0x4dfc06)=>{const _0xf563fb=a577_0x31774a,_0x8a0e5b=await Message_1[_0xf563fb(0x1fe)][_0xf563fb(0x241)](_0x28b2fd[_0xf563fb(0x1c9)]['id'],{'include':[_0xf563fb(0x219),{'model':Ticket_1[_0xf563fb(0x1fe)],'include':[{'model':Contact_1['default']}]}]});if(!_0x8a0e5b)return;await _0x8a0e5b['update']({'isDeleted':!![]});const _0x10b662=(0x0,socket_1[_0xf563fb(0x1ee)])();_0x10b662['to'](_0x8a0e5b[_0xf563fb(0x277)][_0xf563fb(0x1d9)]())['to'](_0x8a0e5b[_0xf563fb(0x1df)][_0xf563fb(0x1d0)])['to'](_0xf563fb(0x255))['emit'](_0xf563fb(0x253)+_0x4dfc06[_0xf563fb(0x1c6)]+'-appMessage',{'action':_0xf563fb(0x1e4),'message':_0x8a0e5b,'ticket':_0x8a0e5b[_0xf563fb(0x1df)],'contact':_0x8a0e5b[_0xf563fb(0x1df)][_0xf563fb(0x219)]});};exports['verifyDeleteMessage']=verifyDeleteMessage;function a577_0x59ad(_0x308587,_0x4c8e3c){const _0x5bebc3=a577_0x4fd2();return a577_0x59ad=function(_0x5b66a8,_0x13850f){_0x5b66a8=_0x5b66a8-0x1be;let _0x4fd2db=_0x5bebc3[_0x5b66a8];return _0x4fd2db;},a577_0x59ad(_0x308587,_0x4c8e3c);}const verifyQueue=async(_0x28a6a9,_0x1fec0d,_0x5077d0,_0x5d4bf)=>{const _0x7785d0=a577_0x31774a;if(_0x1fec0d?.['key']['id']&&_0x5077d0['lastProcessedMessageId']===_0x1fec0d[_0x7785d0(0x1c9)]['id']){console[_0x7785d0(0x1de)](_0x7785d0(0x1f7)+_0x1fec0d['key']['id']+'\x20já\x20processada\x20para\x20o\x20ticket\x20'+_0x5077d0['id']+_0x7785d0(0x1db));return;}_0x1fec0d?.[_0x7785d0(0x1c9)]['id']&&await _0x5077d0[_0x7785d0(0x1f0)]({'lastProcessedMessageId':_0x1fec0d[_0x7785d0(0x1c9)]['id']});const _0x58adc5=await(0x0,ShowWhatsAppService_1[_0x7785d0(0x1fe)])(_0x28a6a9['id'],_0x5077d0[_0x7785d0(0x1c6)]),{queues:_0x325027,greetingMessage:_0x46ea61}=_0x58adc5,_0x30f8d4=await Setting_1['default']['findOne']({'where':{'key':_0x7785d0(0x273),'companyId':_0x5077d0[_0x7785d0(0x1c6)]}});if(_0x325027[_0x7785d0(0x1f1)]===0x1){const _0x4df15c=(0x0,lodash_1[_0x7785d0(0x26b)])(_0x325027);if(!_0x4df15c)return;const _0x56e579=_0x4df15c?.[_0x7785d0(0x22e)]?.['length']>0x0;await _0x5077d0[_0x7785d0(0x1f0)]({'amountUsedBotQueues':0x0,'queueOptionId':null});if(!_0x5077d0[_0x7785d0(0x231)]&&_0x4df15c[_0x7785d0(0x205)]&&!_0x1fec0d?.[_0x7785d0(0x1c9)][_0x7785d0(0x1f2)]&&!_0x5077d0[_0x7785d0(0x260)])try{const _0x24fb17=await(0x0,ShowQueueIntegrationService_1[_0x7785d0(0x1fe)])(_0x4df15c[_0x7785d0(0x205)],_0x5077d0[_0x7785d0(0x1c6)]);if(_0x24fb17){await _0x5077d0['update']({'useIntegration':!![],'integrationId':_0x24fb17['id'],'amountUsedBotQueues':0x0});_0x1fec0d&&await(0x0,wbotMessageListener_1['handleMessageIntegration'])(_0x1fec0d,_0x28a6a9,_0x24fb17,_0x5077d0);console['log']('Integração\x20#'+_0x24fb17['id']+_0x7785d0(0x25f)+_0x5077d0['id']);return;}}catch(_0x48b6ca){console[_0x7785d0(0x212)](_0x7785d0(0x275),_0x48b6ca),await _0x5077d0[_0x7785d0(0x1f0)]({'useIntegration':![],'integrationId':null});}await _0x5077d0[_0x7785d0(0x1f0)]({'queueId':_0x4df15c['id'],'chatbot':_0x56e579});_0x4df15c[_0x7785d0(0x263)]&&await(0x0,SendWhatsAppMessage_1[_0x7785d0(0x1fe)])({'ticket':_0x5077d0,'body':_0x4df15c[_0x7785d0(0x263)]});_0x56e579&&await(0x0,wbotMessageListener_1['displayCurrentMenu'])(_0x5077d0,_0x28a6a9);return;}const _0x8e69a1=_0x1fec0d?(0x0,GetHandlers_1['getBodyMessage'])(_0x1fec0d):null,_0x4df6f0=_0x8e69a1?_0x325027[+_0x8e69a1-0x1]:null;if(_0x4df6f0){await _0x5077d0['update']({'amountUsedBotQueues':0x0,'queueOptionId':null});if(!_0x5077d0[_0x7785d0(0x231)]&&_0x4df6f0[_0x7785d0(0x205)]&&!_0x1fec0d?.[_0x7785d0(0x1c9)]['fromMe']&&!_0x5077d0['isGroup'])try{const _0x11d1bd=await(0x0,ShowQueueIntegrationService_1['default'])(_0x4df6f0[_0x7785d0(0x205)],_0x5077d0['companyId']);if(_0x11d1bd){await _0x5077d0[_0x7785d0(0x1f0)]({'useIntegration':!![],'integrationId':_0x11d1bd['id']}),await(0x0,wbotMessageListener_1[_0x7785d0(0x1ff)])(_0x1fec0d,_0x28a6a9,_0x11d1bd,_0x5077d0),console[_0x7785d0(0x1de)](_0x7785d0(0x242)+_0x11d1bd['id']+_0x7785d0(0x25f)+_0x5077d0['id']);return;}}catch(_0x3db75f){console[_0x7785d0(0x212)](_0x7785d0(0x1dc),_0x3db75f),await _0x5077d0['update']({'useIntegration':![],'integrationId':null});}const _0xda66f1=_0x4df6f0?.[_0x7785d0(0x22e)]?.['length']>0x0;await _0x5077d0[_0x7785d0(0x1f0)]({'queueId':_0x4df6f0['id'],'chatbot':_0xda66f1});_0x4df6f0[_0x7785d0(0x263)]&&await(0x0,SendWhatsAppMessage_1[_0x7785d0(0x1fe)])({'ticket':_0x5077d0,'body':_0x4df6f0[_0x7785d0(0x263)]});_0xda66f1&&await(0x0,wbotMessageListener_1[_0x7785d0(0x1f5)])(_0x5077d0,_0x28a6a9);return;}const _0x29decb=await Whatsapp_1[_0x7785d0(0x1fe)][_0x7785d0(0x241)](_0x5077d0[_0x7785d0(0x270)]);if(!_0x29decb){console[_0x7785d0(0x212)](_0x7785d0(0x1c3));return;}if(!_0x5077d0[_0x7785d0(0x237)]&&_0x5077d0[_0x7785d0(0x243)]>=_0x29decb['maxUseBotQueues'])return;if(_0x1fec0d&&_0x8e69a1&&!_0x4df6f0){if(_0x29decb[_0x7785d0(0x21b)]&&_0x29decb['maxUseBotQueues']!==0x0&&_0x5077d0[_0x7785d0(0x243)]>=_0x29decb[_0x7785d0(0x21b)]){await _0x5077d0['update']({'chatbot':![],'queueOptionId':null,'amountUsedBotQueues':_0x29decb[_0x7785d0(0x21b)]});_0x29decb[_0x7785d0(0x22b)]&&await(0x0,SendWhatsAppMessage_1[_0x7785d0(0x1fe)])({'ticket':_0x5077d0,'body':_0x29decb['transferMessage']});return;}await _0x5077d0['update']({'amountUsedBotQueues':_0x5077d0[_0x7785d0(0x243)]+0x1}),await _0x5077d0['reload']();}const _0x210c80=async()=>{const _0x192f33=_0x7785d0;let _0x51104b='';_0x325027['forEach']((_0x38eb83,_0x5dd3fa)=>{const _0xd14567=a577_0x59ad;_0x51104b+='*'+(_0x5dd3fa+0x1)+_0xd14567(0x257)+_0x38eb83['name']+'\x0a';});const _0x394a0a=_0x46ea61+'\x0a\x0a'+_0x51104b;await(0x0,SendWhatsAppMessage_1[_0x192f33(0x1fe)])({'ticket':_0x5077d0,'body':_0x394a0a});};switch(_0x30f8d4?.[_0x7785d0(0x1f4)]){case _0x7785d0(0x27e):default:await _0x210c80();break;}};exports[a577_0x31774a(0x250)]=verifyQueue;const verifyRating=_0x4cb5cc=>{const _0x300aa1=a577_0x31774a;if(_0x4cb5cc&&_0x4cb5cc[_0x300aa1(0x25d)]===null&&_0x4cb5cc[_0x300aa1(0x1fa)]!==null&&_0x4cb5cc[_0x300aa1(0x1d1)]!==null)return!![];return![];};exports[a577_0x31774a(0x1c7)]=verifyRating;const verifyRecentCampaign=async(_0x4a6908,_0x2175b6)=>{const _0x2d03d2=a577_0x31774a;if(!_0x4a6908[_0x2d03d2(0x1c9)][_0x2d03d2(0x1f2)]){const _0x318a4d=_0x4a6908['key'][_0x2d03d2(0x235)][_0x2d03d2(0x201)](/\D/g,''),_0x21b11e=await Campaign_1[_0x2d03d2(0x1fe)]['findAll']({'where':{'companyId':_0x2175b6,'status':'EM_ANDAMENTO','confirmation':!![]}});if(_0x21b11e){const _0x3883ea=_0x21b11e[_0x2d03d2(0x21f)](_0x5a037f=>_0x5a037f['id']),_0x495186=await CampaignShipping_1[_0x2d03d2(0x1fe)][_0x2d03d2(0x23c)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x3883ea},'number':_0x318a4d,'confirmation':null}});if(_0x495186)return await _0x495186['update']({'confirmedAt':(0x0,moment_1[_0x2d03d2(0x1fe)])(),'confirmation':!![]}),await queues_1[_0x2d03d2(0x22a)][_0x2d03d2(0x1f6)](_0x2d03d2(0x24a),{'campaignShippingId':_0x495186['id'],'campaignId':_0x495186['campaignId']},{'delay':(0x0,queues_1[_0x2d03d2(0x1cf)])((0x0,queues_1[_0x2d03d2(0x224)])(0x0,0xa))}),!![];}}return![];};exports['verifyRecentCampaign']=verifyRecentCampaign;