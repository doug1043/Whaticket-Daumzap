'use strict';const a586_0x5e159a=a586_0x234d;(function(_0x26d04b,_0x42b1db){const _0x4bdb85=a586_0x234d,_0x282187=_0x26d04b();while(!![]){try{const _0x4507a3=parseInt(_0x4bdb85(0x214))/0x1+-parseInt(_0x4bdb85(0x21a))/0x2+-parseInt(_0x4bdb85(0x26d))/0x3+-parseInt(_0x4bdb85(0x25a))/0x4*(-parseInt(_0x4bdb85(0x207))/0x5)+-parseInt(_0x4bdb85(0x241))/0x6*(parseInt(_0x4bdb85(0x289))/0x7)+parseInt(_0x4bdb85(0x1bc))/0x8+parseInt(_0x4bdb85(0x255))/0x9;if(_0x4507a3===_0x42b1db)break;else _0x282187['push'](_0x282187['shift']());}catch(_0x1a9de3){_0x282187['push'](_0x282187['shift']());}}}(a586_0x28ad,0x36c8f));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x2b7de0,_0xef0ec1,_0x3a6876,_0x3c43e9){const _0x2955a8=a586_0x234d;if(_0x3c43e9===undefined)_0x3c43e9=_0x3a6876;var _0x37cb2a=Object[_0x2955a8(0x220)](_0xef0ec1,_0x3a6876);(!_0x37cb2a||(_0x2955a8(0x20b)in _0x37cb2a?!_0xef0ec1['__esModule']:_0x37cb2a[_0x2955a8(0x1d6)]||_0x37cb2a['configurable']))&&(_0x37cb2a={'enumerable':!![],'get':function(){return _0xef0ec1[_0x3a6876];}}),Object[_0x2955a8(0x24f)](_0x2b7de0,_0x3c43e9,_0x37cb2a);}:function(_0x2d6a08,_0x29045c,_0x3df6c1,_0x3c5863){if(_0x3c5863===undefined)_0x3c5863=_0x3df6c1;_0x2d6a08[_0x3c5863]=_0x29045c[_0x3df6c1];}),__setModuleDefault=this&&this[a586_0x5e159a(0x26b)]||(Object[a586_0x5e159a(0x27a)]?function(_0x4c85b7,_0x5afd95){const _0x181a87=a586_0x5e159a;Object[_0x181a87(0x24f)](_0x4c85b7,'default',{'enumerable':!![],'value':_0x5afd95});}:function(_0x5b623a,_0x3ab30c){const _0x16a792=a586_0x5e159a;_0x5b623a[_0x16a792(0x1f6)]=_0x3ab30c;}),__importStar=this&&this[a586_0x5e159a(0x205)]||(function(){const _0x5c8a1c=(function(){let _0x58eea3=!![];return function(_0x312cc4,_0x3fe2ef){const _0x3c013e=_0x58eea3?function(){const _0x4fe727=a586_0x234d;if(_0x3fe2ef){const _0xdb3691=_0x3fe2ef[_0x4fe727(0x238)](_0x312cc4,arguments);return _0x3fe2ef=null,_0xdb3691;}}:function(){};return _0x58eea3=![],_0x3c013e;};}()),_0x1986e1=_0x5c8a1c(this,function(){const _0x2d3d84=a586_0x234d;return _0x1986e1[_0x2d3d84(0x28b)]()[_0x2d3d84(0x237)](_0x2d3d84(0x1fe))['toString']()[_0x2d3d84(0x27f)](_0x1986e1)[_0x2d3d84(0x237)](_0x2d3d84(0x1fe));});_0x1986e1();var _0x3d4881=function(_0x159df0){return _0x3d4881=Object['getOwnPropertyNames']||function(_0x72299f){const _0x18149e=a586_0x234d;var _0x440d2c=[];for(var _0x2d42e8 in _0x72299f)if(Object[_0x18149e(0x1ee)][_0x18149e(0x1d8)][_0x18149e(0x268)](_0x72299f,_0x2d42e8))_0x440d2c[_0x440d2c['length']]=_0x2d42e8;return _0x440d2c;},_0x3d4881(_0x159df0);};return function(_0x42ca30){const _0x3864da=a586_0x234d;if(_0x42ca30&&_0x42ca30['__esModule'])return _0x42ca30;var _0x2bcffb={};if(_0x42ca30!=null){for(var _0x40412a=_0x3d4881(_0x42ca30),_0x31055d=0x0;_0x31055d<_0x40412a[_0x3864da(0x212)];_0x31055d++)if(_0x40412a[_0x31055d]!==_0x3864da(0x1f6))__createBinding(_0x2bcffb,_0x42ca30,_0x40412a[_0x31055d]);}return __setModuleDefault(_0x2bcffb,_0x42ca30),_0x2bcffb;};}()),__importDefault=this&&this[a586_0x5e159a(0x23f)]||function(_0x2f61b9){return _0x2f61b9&&_0x2f61b9['__esModule']?_0x2f61b9:{'default':_0x2f61b9};};Object['defineProperty'](exports,a586_0x5e159a(0x1fb),{'value':!![]}),exports['verifyRecentCampaign']=exports['verifyRating']=exports[a586_0x5e159a(0x1de)]=exports[a586_0x5e159a(0x1da)]=exports[a586_0x5e159a(0x1f0)]=exports[a586_0x5e159a(0x247)]=exports[a586_0x5e159a(0x257)]=exports[a586_0x5e159a(0x1d9)]=exports[a586_0x5e159a(0x246)]=exports[a586_0x5e159a(0x258)]=void 0x0;const Message_1=__importDefault(require('../../models/Message')),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a586_0x5e159a(0x210))),socket_1=require(a586_0x5e159a(0x261)),baileys_1=require('@whiskeysockets/baileys'),CreateMessageService_1=__importDefault(require(a586_0x5e159a(0x200))),GetHandlers_1=require(a586_0x5e159a(0x1ec)),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a586_0x5e159a(0x27c))),Sentry=__importStar(require('@sentry/node')),CreateOrUpdateContactService_1=__importDefault(require(a586_0x5e159a(0x1ce))),stream_throttle_1=require(a586_0x5e159a(0x231)),MakeRandomId_1=require(a586_0x5e159a(0x22c)),CheckSettings_1=__importDefault(require(a586_0x5e159a(0x1db))),GetHandlers_2=require(a586_0x5e159a(0x1ec)),GetPublicPath_1=require(a586_0x5e159a(0x278)),logger_1=require(a586_0x5e159a(0x202)),util_1=require(a586_0x5e159a(0x264)),fs_1=__importStar(require('fs')),path_1=require(a586_0x5e159a(0x253)),OldMessage_1=__importDefault(require(a586_0x5e159a(0x240))),ShowWhatsAppService_1=__importDefault(require(a586_0x5e159a(0x208))),lodash_1=require(a586_0x5e159a(0x222)),ShowQueueIntegrationService_1=__importDefault(require('../QueueIntegrationServices/ShowQueueIntegrationService')),wbotMessageListener_1=require(a586_0x5e159a(0x233)),Setting_1=__importDefault(require(a586_0x5e159a(0x1f3))),Campaign_1=__importDefault(require(a586_0x5e159a(0x218))),CampaignShipping_1=__importDefault(require(a586_0x5e159a(0x203))),moment_1=__importDefault(require(a586_0x5e159a(0x1cc))),queues_1=require(a586_0x5e159a(0x201)),sequelize_1=require(a586_0x5e159a(0x25b)),SendWhatsAppMessage_1=__importDefault(require(a586_0x5e159a(0x1cb))),Whatsapp_1=__importDefault(require(a586_0x5e159a(0x279))),ExtractPhoneNumber_1=require(a586_0x5e159a(0x1d5)),writeFileAsync=(0x0,util_1[a586_0x5e159a(0x260)])(fs_1[a586_0x5e159a(0x281)]),saveMediaToFile=async(_0x42bdc9,_0x3cc79a)=>{const _0xbade90=a586_0x5e159a;if(!_0x42bdc9[_0xbade90(0x25d)]){const _0x908d4b=_0x42bdc9[_0xbade90(0x1e5)][_0xbade90(0x1ca)]('/')[0x1][_0xbade90(0x1ca)](';')[0x0];_0x42bdc9[_0xbade90(0x25d)]=new Date()['getTime']()+'.'+_0x908d4b;}const _0x5dac1b=(0x0,GetPublicPath_1[_0xbade90(0x230)])(),_0x435efc=(0x0,MakeRandomId_1['makeRandomId'])(0xa),_0x302f74='media/'+_0x3cc79a['companyId']+'/'+_0x3cc79a[_0xbade90(0x256)]+'/'+_0x3cc79a['id']+'/'+_0x435efc;try{await fs_1[_0xbade90(0x1f6)][_0xbade90(0x250)][_0xbade90(0x1c2)]((0x0,path_1[_0xbade90(0x232)])(_0x5dac1b,_0x302f74),{'recursive':!![]}),await writeFileAsync((0x0,path_1[_0xbade90(0x232)])(_0x5dac1b,_0x302f74,_0x42bdc9['filename']),_0x42bdc9[_0xbade90(0x24b)],_0xbade90(0x1e8));}catch(_0x36b92b){Sentry['captureException'](_0x36b92b),logger_1[_0xbade90(0x1cd)][_0xbade90(0x221)](_0x36b92b);}return _0x302f74+'/'+_0x42bdc9[_0xbade90(0x25d)];},normalizeMediaType=_0x5c358e=>{const _0x2215dc=a586_0x5e159a,_0x11e824=[_0x2215dc(0x226),_0x2215dc(0x252),'image',_0x2215dc(0x234)],_0x2d21db=_0x5c358e[_0x2215dc(0x1ca)]('/')[0x0];if(!_0x11e824[_0x2215dc(0x204)](_0x2d21db))return _0x2215dc(0x234);return _0x2d21db;};exports['normalizeMediaType']=normalizeMediaType;const normalizeThumbnailMediaType=_0x10cfb7=>{const _0x1cab16=a586_0x5e159a,_0x525218=[_0x1cab16(0x1d4),_0x1cab16(0x23e),_0x1cab16(0x1ba)],_0x4b5290=_0x10cfb7[_0x1cab16(0x1ca)]('/')[0x0];if(!_0x525218[_0x1cab16(0x204)](_0x1cab16(0x1bd)+_0x4b5290))return _0x1cab16(0x1ba);return _0x4b5290;};exports[a586_0x5e159a(0x246)]=normalizeThumbnailMediaType;const downloadMedia=async(_0x1f14b5,_0x29a1eb,_0x4f46f5)=>{const _0xd4e5ad=a586_0x5e159a,_0x5ad603=(0x0,GetHandlers_2[_0xd4e5ad(0x1f5)])(_0x1f14b5),_0x5aa4d2=(0x0,GetHandlers_2[_0xd4e5ad(0x1bb)])(_0x5ad603);if(!_0x5aa4d2)return null;const _0x5ebb4b=parseInt(await(0x0,CheckSettings_1[_0xd4e5ad(0x1f6)])(_0xd4e5ad(0x288),'15'),0xa);if(_0x29a1eb&&_0x5aa4d2?.[_0xd4e5ad(0x1d2)]&&+_0x5aa4d2[_0xd4e5ad(0x1d2)]>_0x5ebb4b*0x400*0x400){const _0x52f08b=_0xd4e5ad(0x1ef)+_0x5ebb4b+'\x20MiB';if(!_0x4f46f5[_0xd4e5ad(0x21b)]){const _0xe4c5c4=await(0x0,SendWhatsAppMessage_1[_0xd4e5ad(0x1f6)])({'ticket':_0x4f46f5,'body':_0x52f08b});_0xe4c5c4['message']['extendedTextMessage'][_0xd4e5ad(0x1e4)]=_0xd4e5ad(0x263);}throw new Error(_0xd4e5ad(0x251));}const _0x179781=_0x5ad603?.[_0xd4e5ad(0x1f7)]?_0xd4e5ad(0x234):(0x0,exports['normalizeMediaType'])(_0x5aa4d2[_0xd4e5ad(0x1e5)]);let _0x153f3d,_0x1d6bc3=0x0;while(_0x1d6bc3<0xa&&!_0x153f3d){try{const _0x52b752={..._0x5aa4d2};_0x52b752?.[_0xd4e5ad(0x1c4)]&&(_0x52b752[_0xd4e5ad(0x27b)]=''),_0x153f3d=await(0x0,baileys_1['downloadContentFromMessage'])(_0x52b752,_0x179781);}catch(_0x40f367){_0x1d6bc3+=0x1,await new Promise(_0x4113b6=>{setTimeout(_0x4113b6,0x3e8*_0x1d6bc3*0x2);}),logger_1['logger'][_0xd4e5ad(0x27d)](_0xd4e5ad(0x270)+_0x1d6bc3+_0xd4e5ad(0x1e9)+_0x1f14b5?.[_0xd4e5ad(0x27e)]?.['id']);}}if(!_0x153f3d)throw new Error('Failed\x20to\x20get\x20stream');const _0x82278=await downloadStream(_0x153f3d);if(!_0x82278){Sentry['setExtra'](_0xd4e5ad(0x21c),{'msg':_0x1f14b5}),Sentry['captureException'](new Error(_0xd4e5ad(0x21c)));throw new Error(_0xd4e5ad(0x21c));}let _0x1e6394=_0x5ad603?.[_0xd4e5ad(0x1f7)]?.[_0xd4e5ad(0x26a)]||'';if(!_0x1e6394){const _0x5988f5=_0x5aa4d2[_0xd4e5ad(0x1e5)]['split']('/')[0x1]['split'](';')[0x0];_0x1e6394=(0x0,MakeRandomId_1[_0xd4e5ad(0x23d)])(0x5)+'-'+new Date()[_0xd4e5ad(0x22b)]()+'.'+_0x5988f5;}else _0x1e6394=_0x1e6394['split']('.')['slice'](0x0,-0x1)[_0xd4e5ad(0x232)]('.')+'.'+(0x0,MakeRandomId_1[_0xd4e5ad(0x23d)])(0x5)+'.'+_0x1e6394[_0xd4e5ad(0x1ca)]('.')[_0xd4e5ad(0x28a)](-0x1);const _0x30cd20={'data':_0x82278,'mimetype':_0x5aa4d2[_0xd4e5ad(0x1e5)],'filename':_0x1e6394};return _0x30cd20;},downloadStream=async _0x35b4ae=>{const _0xab81aa=a586_0x5e159a,_0xf3c26b=0x5*0x400*0x400/0x8,_0xb887e0=0x400*0x400/0x8,_0x13d010=0x400*0x400,_0x4e2b72=new stream_throttle_1[(_0xab81aa(0x1dd))]({'rate':_0xf3c26b});let _0xf62db7=Buffer[_0xab81aa(0x217)]([]),_0x13a21b=0x0;try{for await(const _0x57621e of _0x35b4ae['pipe'](_0x4e2b72)){_0xf62db7=Buffer['concat']([_0xf62db7,_0x57621e]),_0x13a21b+=_0x57621e[_0xab81aa(0x212)],_0x13a21b>_0x13d010&&(_0x4e2b72[_0xab81aa(0x23a)]=_0xb887e0);}}catch(_0x3d4428){Sentry[_0xab81aa(0x245)](_0xab81aa(0x21c),{'error':_0x3d4428}),Sentry[_0xab81aa(0x21f)](new Error(_0xab81aa(0x21c)));throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');}return _0xf62db7;},downloadThumbnail=async({thumbnailDirectPath:_0x1db671,mediaKey:_0x2189a4,mimetype:_0x564c53})=>{const _0x528771=a586_0x5e159a;if(!_0x1db671||!_0x2189a4)return null;const _0x1db7d2=await(0x0,baileys_1[_0x528771(0x248)])({'mediaKey':_0x2189a4,'directPath':_0x1db671},_0x564c53?(0x0,exports['normalizeThumbnailMediaType'])(_0x564c53):'thumbnail-link');if(!_0x1db7d2)throw new Error(_0x528771(0x22a));const _0x5dddda=await downloadStream(_0x1db7d2);if(!_0x5dddda)throw new Error(_0x528771(0x21c));const _0xe5aca9=_0x528771(0x1bd)+(0x0,MakeRandomId_1['makeRandomId'])(0x5)+'-'+new Date()['getTime']()+_0x528771(0x25e),_0xa653d8={'data':_0x5dddda,'mimetype':'image/jpeg','filename':_0xe5aca9};return _0xa653d8;},verifyMessage=async(_0x14f75b,_0x554742,_0x314096,_0x3a244b=null,_0x2bb2a5=null)=>{const _0x5e2b55=a586_0x5e159a,_0x582a2d=(0x0,socket_1[_0x5e2b55(0x1e3)])(),_0x537499=await verifyQuotedMessage(_0x14f75b),_0x124b5b=(0x0,GetHandlers_1[_0x5e2b55(0x1be)])(_0x14f75b),_0x4ac4c6={'id':_0x14f75b[_0x5e2b55(0x27e)]['id'],'ticketId':_0x554742['id'],'userId':_0x3a244b,'contactId':_0x14f75b[_0x5e2b55(0x27e)][_0x5e2b55(0x1e2)]?undefined:_0x314096['id'],'body':_0x124b5b,'fromMe':_0x14f75b[_0x5e2b55(0x27e)][_0x5e2b55(0x1e2)],'mediaType':_0x14f75b[_0x5e2b55(0x1d7)][_0x5e2b55(0x225)]?_0x5e2b55(0x225):null,'read':_0x14f75b[_0x5e2b55(0x27e)]['fromMe'],'quotedMsgId':_0x537499?.['id'],'ack':_0x14f75b[_0x5e2b55(0x1c5)]||(_0x14f75b[_0x5e2b55(0x27e)][_0x5e2b55(0x1e2)]?0x1:0x0),'remoteJid':_0x14f75b[_0x5e2b55(0x27e)][_0x5e2b55(0x22d)],'participant':_0x14f75b['key'][_0x5e2b55(0x227)],'dataJson':JSON[_0x5e2b55(0x236)](_0x14f75b),'isEdited':![]};await _0x554742['update']({'lastMessage':_0x124b5b[_0x5e2b55(0x274)](0x0,0xff)['replace'](/\n/g,'\x20')});const _0x45c69d=await(0x0,CreateMessageService_1[_0x5e2b55(0x1f6)])({'messageData':_0x4ac4c6,'companyId':_0x554742[_0x5e2b55(0x21e)]});if(!_0x14f75b[_0x5e2b55(0x27e)][_0x5e2b55(0x1e2)]){const _0x40f629=_0x14f75b[_0x5e2b55(0x27e)],_0x1eada7=_0x14f75b[_0x5e2b55(0x27e)]['remoteJid'],_0x2ebc88=_0x40f629[_0x5e2b55(0x26f)];let _0x149da9=null,_0x10b934=null;if(_0x1eada7?.[_0x5e2b55(0x204)]('@s.whatsapp.net'))_0x149da9=_0x1eada7,_0x10b934=_0x2ebc88;else _0x1eada7?.[_0x5e2b55(0x204)](_0x5e2b55(0x23b))&&(_0x10b934=_0x1eada7,_0x149da9=_0x2ebc88);const _0x255d03=_0x149da9?.['split']('@')[0x0],_0x1fc05b=_0x10b934?.[_0x5e2b55(0x1ca)]('@')[0x0],_0x5b1aca=_0x255d03&&_0x255d03!==_0x314096[_0x5e2b55(0x286)]||_0x1fc05b&&_0x1fc05b!==_0x314096[_0x5e2b55(0x1c9)];if(_0x5b1aca){if(_0x255d03&&_0x255d03!==_0x314096[_0x5e2b55(0x286)]){const _0xf1046b=await Contact_1[_0x5e2b55(0x1f6)]['findOne']({'where':{'number':_0x255d03,'companyId':_0x314096[_0x5e2b55(0x21e)]}});if(_0xf1046b&&_0xf1046b['id']!==_0x314096['id']){await _0x554742[_0x5e2b55(0x277)]({'contactId':_0xf1046b['id']}),await _0x45c69d[_0x5e2b55(0x277)]({'contactId':_0xf1046b['id']});const _0xbddee1={};_0x1fc05b&&!_0xf1046b[_0x5e2b55(0x1c9)]&&(_0xbddee1[_0x5e2b55(0x1c9)]=_0x1fc05b);_0x149da9&&!_0xf1046b['remoteJid']&&(_0xbddee1['remoteJid']=_0x149da9);const _0x2e95c0=!_0xf1046b[_0x5e2b55(0x287)]||_0xf1046b[_0x5e2b55(0x287)]===''||_0xf1046b['profilePicUrl']===process['env'][_0x5e2b55(0x20a)]+'/nopicture.png';if(_0x2e95c0&&_0x2bb2a5)try{const _0x3cc886=_0x10b934||_0x149da9||_0x1eada7,_0xf12880=await _0x2bb2a5['profilePictureUrl'](_0x3cc886);_0xf12880&&_0xf12880!==process[_0x5e2b55(0x262)][_0x5e2b55(0x20a)]+_0x5e2b55(0x20f)&&(_0xbddee1[_0x5e2b55(0x287)]=_0xf12880);}catch(_0x376be5){}Object['keys'](_0xbddee1)['length']>0x0&&await _0xf1046b[_0x5e2b55(0x277)](_0xbddee1);const _0xc73fa2=await Ticket_1['default'][_0x5e2b55(0x1e7)]({'where':{'contactId':_0x314096['id']}});_0xc73fa2===0x0?(await _0x314096[_0x5e2b55(0x1e6)](),console['log'](_0x5e2b55(0x219)+_0x314096['id'])):console['log'](_0x5e2b55(0x1bf)+_0x314096['id']+_0x5e2b55(0x28c)+_0xc73fa2+_0x5e2b55(0x21d));return;}}const _0x3e923c={};_0x255d03&&_0x255d03!==_0x314096['number']&&(_0x3e923c[_0x5e2b55(0x286)]=_0x255d03),_0x1fc05b&&_0x1fc05b!==_0x314096['lid']&&(_0x3e923c[_0x5e2b55(0x1c9)]=_0x1fc05b),_0x149da9&&_0x149da9!==_0x314096[_0x5e2b55(0x22d)]&&(_0x3e923c[_0x5e2b55(0x22d)]=_0x149da9),Object[_0x5e2b55(0x1fd)](_0x3e923c)[_0x5e2b55(0x212)]>0x0&&(console[_0x5e2b55(0x1fc)]('[verifyMessage]\x20Updating\x20contact\x20'+_0x314096['id']+':',_0x3e923c),await _0x314096['update'](_0x3e923c));}else console[_0x5e2b55(0x1fc)](_0x5e2b55(0x211)+_0x314096['id']+_0x5e2b55(0x1e1));}return!_0x14f75b[_0x5e2b55(0x27e)][_0x5e2b55(0x1e2)]&&_0x554742['status']===_0x5e2b55(0x244)&&(await _0x554742[_0x5e2b55(0x277)]({'status':_0x5e2b55(0x1f4)}),await _0x554742[_0x5e2b55(0x280)]({'include':[{'model':Queue_1[_0x5e2b55(0x1f6)],'as':'queue'},{'model':User_1[_0x5e2b55(0x1f6)],'as':_0x5e2b55(0x20d)},{'model':Contact_1[_0x5e2b55(0x1f6)],'as':_0x5e2b55(0x24d)}]}),_0x582a2d['to'](_0x5e2b55(0x26c)+_0x554742['companyId']+_0x5e2b55(0x229))['to'](_0x5e2b55(0x1f9)+_0x554742[_0x5e2b55(0x223)]+'-closed')[_0x5e2b55(0x266)](_0x5e2b55(0x26c)+_0x554742[_0x5e2b55(0x21e)]+_0x5e2b55(0x1c6),{'action':'delete','ticket':_0x554742,'ticketId':_0x554742['id']}),_0x582a2d['to'](_0x5e2b55(0x26c)+_0x554742['companyId']+'-'+_0x554742[_0x5e2b55(0x1c5)])['to'](_0x5e2b55(0x1f9)+_0x554742[_0x5e2b55(0x223)]+'-'+_0x554742[_0x5e2b55(0x1c5)])['to'](_0x554742['id'][_0x5e2b55(0x28b)]())[_0x5e2b55(0x266)](_0x5e2b55(0x26c)+_0x554742[_0x5e2b55(0x21e)]+'-ticket',{'action':_0x5e2b55(0x277),'ticket':_0x554742,'ticketId':_0x554742['id']})),_0x45c69d;};exports[a586_0x5e159a(0x1d9)]=verifyMessage;const verifyQuotedMessage=async _0x3e23b9=>{const _0x3761b7=a586_0x5e159a;if(!_0x3e23b9)return null;const _0x44b2c5=(0x0,GetHandlers_1[_0x3761b7(0x1c3)])(_0x3e23b9);if(!_0x44b2c5)return null;const _0x18215e=await Message_1['default']['findOne']({'where':{'id':_0x44b2c5}});if(!_0x18215e)return null;return _0x18215e;},verifyContact=async(_0x377472,_0x5e4291,_0x4bbf15,_0x21df87)=>{const _0x296f98=a586_0x5e159a;let _0x282e22;try{_0x282e22=await _0x5e4291[_0x296f98(0x1fa)](_0x377472['id']);}catch(_0xf6d981){Sentry[_0x296f98(0x21f)](_0xf6d981),_0x282e22=process[_0x296f98(0x262)][_0x296f98(0x20a)]+_0x296f98(0x20f);}const _0xaa4846=(0x0,ExtractPhoneNumber_1[_0x296f98(0x20c)])(_0x377472['id']),_0x328e09=_0x377472['id']['includes'](_0x296f98(0x23b)),_0x2f023d=_0x328e09?_0x377472['id']['split']('@')[0x0]:null;if(_0x21df87&&_0x328e09){const _0x2998b6=_0x21df87['split']('@')[0x0],_0x3713d0=await Contact_1['default'][_0x296f98(0x283)]({'where':{'number':_0x2998b6,'companyId':_0x4bbf15}});if(_0x3713d0){const _0x45697b={};_0x2f023d&&!_0x3713d0[_0x296f98(0x1c9)]&&(_0x45697b[_0x296f98(0x1c9)]=_0x2f023d);(!_0x3713d0[_0x296f98(0x22d)]||_0x3713d0[_0x296f98(0x22d)]===_0x21df87)&&(_0x45697b[_0x296f98(0x22d)]=_0x377472['id']);const _0x3f5133=!_0x3713d0[_0x296f98(0x287)]||_0x3713d0[_0x296f98(0x287)]===''||_0x3713d0[_0x296f98(0x287)]===process['env'][_0x296f98(0x20a)]+'/nopicture.png';return _0x3f5133&&_0x282e22&&_0x282e22!==process[_0x296f98(0x262)][_0x296f98(0x20a)]+_0x296f98(0x20f)&&(_0x45697b[_0x296f98(0x287)]=_0x282e22),Object[_0x296f98(0x1fd)](_0x45697b)[_0x296f98(0x212)]>0x0&&await _0x3713d0[_0x296f98(0x277)](_0x45697b),_0x3713d0;}const _0x2bb874={'name':_0x377472?.['name']||_0x2998b6||_0x377472['id'][_0x296f98(0x1cf)](/\D/g,''),'number':_0x2998b6,'profilePicUrl':_0x282e22,'isGroup':_0x377472['id'][_0x296f98(0x204)](_0x296f98(0x1ed)),'companyId':_0x4bbf15,'remoteJid':_0x21df87,'lid':_0x2f023d},_0x478c40=(0x0,CreateOrUpdateContactService_1[_0x296f98(0x1f6)])(_0x2bb874);return _0x478c40;}const _0x170b6f={'name':_0x377472?.['name']||_0xaa4846||_0x377472['id'][_0x296f98(0x1cf)](/\D/g,''),'number':_0xaa4846||_0x377472['id']['substring'](0x0,_0x377472['id'][_0x296f98(0x23c)]('@')),'profilePicUrl':_0x282e22,'isGroup':_0x377472['id'][_0x296f98(0x204)](_0x296f98(0x1ed)),'companyId':_0x4bbf15,'remoteJid':_0x377472['id'],'lid':_0x2f023d},_0x205f12=(0x0,CreateOrUpdateContactService_1[_0x296f98(0x1f6)])(_0x170b6f);return _0x205f12;};exports[a586_0x5e159a(0x257)]=verifyContact;const verifyMediaMessage=async(_0x3e7c38,_0x37c1e1,_0x3e8f12,_0x16d013=null,_0x464b4b=null,_0x519945=null)=>{const _0x1e3ca3=a586_0x5e159a,_0x910dba=(0x0,socket_1[_0x1e3ca3(0x1e3)])(),_0x4891d7=await verifyQuotedMessage(_0x3e7c38),_0x91bcad=_0x464b4b||_0x3e7c38?.[_0x1e3ca3(0x1d7)]?.[_0x1e3ca3(0x1d3)],_0x7c232f=_0x91bcad&&await downloadThumbnail(_0x91bcad),_0x9caa61=await downloadMedia(_0x3e7c38,_0x16d013,_0x37c1e1);if(!_0x9caa61&&!_0x7c232f)throw new Error(_0x1e3ca3(0x21c));let _0x3b5783=null;_0x9caa61&&(_0x3b5783=await saveMediaToFile(_0x9caa61,_0x37c1e1));let _0x24f80e=null;_0x7c232f&&(_0x24f80e=await saveMediaToFile(_0x7c232f,_0x37c1e1));const _0x1c2f0c=(0x0,GetHandlers_1[_0x1e3ca3(0x1be)])(_0x3e7c38),_0x5aac1d={'id':_0x3e7c38['key']['id'],'ticketId':_0x37c1e1['id'],'userId':_0x519945,'contactId':_0x3e7c38[_0x1e3ca3(0x27e)]['fromMe']?undefined:_0x3e8f12['id'],'body':_0x1c2f0c||'','fromMe':_0x3e7c38[_0x1e3ca3(0x27e)]['fromMe'],'read':_0x3e7c38[_0x1e3ca3(0x27e)][_0x1e3ca3(0x1e2)],'mediaUrl':_0x3b5783,'mediaType':_0x9caa61?.[_0x1e3ca3(0x1e5)]['split']('/')[0x0],'thumbnailUrl':_0x24f80e,'quotedMsgId':_0x4891d7?.['id'],'ack':_0x3e7c38[_0x1e3ca3(0x1c5)]||(_0x3e7c38['key'][_0x1e3ca3(0x1e2)]?0x1:0x0),'remoteJid':_0x3e7c38[_0x1e3ca3(0x27e)][_0x1e3ca3(0x22d)],'participant':_0x3e7c38['key']['participant'],'dataJson':JSON['stringify'](_0x3e7c38)};await _0x37c1e1[_0x1e3ca3(0x277)]({'lastMessage':_0x1c2f0c||_0x9caa61?.[_0x1e3ca3(0x25d)]?_0x1e3ca3(0x1c7)+_0x9caa61?.[_0x1e3ca3(0x25d)]:''});const _0x52b4ce=await(0x0,CreateMessageService_1[_0x1e3ca3(0x1f6)])({'messageData':_0x5aac1d,'companyId':_0x37c1e1[_0x1e3ca3(0x21e)]});if(!_0x3e7c38[_0x1e3ca3(0x27e)][_0x1e3ca3(0x1e2)]){const _0x3156e6=_0x3e7c38[_0x1e3ca3(0x27e)],_0x29bf2e=_0x3e7c38['key'][_0x1e3ca3(0x22d)],_0x2605e5=_0x3156e6[_0x1e3ca3(0x26f)];let _0x314bcd=null;if(_0x29bf2e?.[_0x1e3ca3(0x204)]('@s.whatsapp.net'))_0x314bcd=_0x29bf2e;else _0x29bf2e?.[_0x1e3ca3(0x204)](_0x1e3ca3(0x23b))&&(_0x314bcd=_0x2605e5);if(_0x314bcd){const _0x369437=_0x314bcd[_0x1e3ca3(0x1ca)]('@')[0x0];if(_0x369437!==_0x3e8f12[_0x1e3ca3(0x286)]){const _0x57e47d={'number':_0x369437,'remoteJid':_0x314bcd};_0x3e8f12[_0x1e3ca3(0x287)]&&_0x3e8f12[_0x1e3ca3(0x287)]!==process[_0x1e3ca3(0x262)][_0x1e3ca3(0x20a)]+_0x1e3ca3(0x20f)&&(_0x57e47d[_0x1e3ca3(0x287)]=_0x3e8f12[_0x1e3ca3(0x287)]),await _0x3e8f12[_0x1e3ca3(0x277)](_0x57e47d);}}}return!_0x3e7c38[_0x1e3ca3(0x27e)][_0x1e3ca3(0x1e2)]&&_0x37c1e1['status']===_0x1e3ca3(0x244)&&(await _0x37c1e1[_0x1e3ca3(0x277)]({'status':_0x1e3ca3(0x1f4)}),await _0x37c1e1[_0x1e3ca3(0x280)]({'include':[{'model':Queue_1[_0x1e3ca3(0x1f6)],'as':_0x1e3ca3(0x254)},{'model':User_1[_0x1e3ca3(0x1f6)],'as':_0x1e3ca3(0x20d)},{'model':Contact_1[_0x1e3ca3(0x1f6)],'as':_0x1e3ca3(0x24d)}]}),_0x910dba['to']('company-'+_0x37c1e1[_0x1e3ca3(0x21e)]+_0x1e3ca3(0x229))['to'](_0x1e3ca3(0x1f9)+_0x37c1e1['queueId']+_0x1e3ca3(0x229))[_0x1e3ca3(0x266)]('company-'+_0x37c1e1[_0x1e3ca3(0x21e)]+_0x1e3ca3(0x1c6),{'action':_0x1e3ca3(0x25c),'ticket':_0x37c1e1,'ticketId':_0x37c1e1['id']}),_0x910dba['to'](_0x1e3ca3(0x26c)+_0x37c1e1[_0x1e3ca3(0x21e)]+'-'+_0x37c1e1[_0x1e3ca3(0x1c5)])['to'](_0x1e3ca3(0x1f9)+_0x37c1e1[_0x1e3ca3(0x223)]+'-'+_0x37c1e1[_0x1e3ca3(0x1c5)])['to'](_0x37c1e1['id']['toString']())[_0x1e3ca3(0x266)]('company-'+_0x37c1e1[_0x1e3ca3(0x21e)]+_0x1e3ca3(0x1c6),{'action':_0x1e3ca3(0x277),'ticket':_0x37c1e1,'ticketId':_0x37c1e1['id']})),_0x52b4ce;};exports[a586_0x5e159a(0x247)]=verifyMediaMessage;function a586_0x234d(_0x3c8bbc,_0x4caeef){const _0x209b41=a586_0x28ad();return a586_0x234d=function(_0x52784e,_0x158919){_0x52784e=_0x52784e-0x1ba;let _0x28ad90=_0x209b41[_0x52784e];return _0x28ad90;},a586_0x234d(_0x3c8bbc,_0x4caeef);}const verifyEditedMessage=async(_0x231deb,_0x2fcf84,_0xe3cd5d)=>{const _0x373803=a586_0x5e159a,_0x45052a=(0x0,GetHandlers_2[_0x373803(0x20e)])(_0x231deb);let _0x27f4db;switch(_0x45052a){case _0x373803(0x1ea):{_0x27f4db=_0x231deb[_0x373803(0x1ea)];break;}case _0x373803(0x1d3):{_0x27f4db=_0x231deb['extendedTextMessage'][_0x373803(0x1e4)];break;}case'imageMessage':{_0x27f4db=_0x231deb[_0x373803(0x267)][_0x373803(0x1c0)];break;}case'documentMessage':{_0x27f4db=_0x231deb[_0x373803(0x1f7)]['caption'];break;}case _0x373803(0x1eb):{_0x27f4db=_0x231deb[_0x373803(0x1eb)][_0x373803(0x1d7)][_0x373803(0x1f7)][_0x373803(0x1c0)];break;}default:{return;}}const _0x18433d=await Message_1[_0x373803(0x1f6)][_0x373803(0x1e0)](_0xe3cd5d),_0x384661={'id':_0x18433d['id'],'ticketId':_0x18433d[_0x373803(0x224)],'contactId':_0x18433d[_0x373803(0x256)],'body':_0x27f4db,'fromMe':_0x18433d[_0x373803(0x1e2)],'mediaType':_0x18433d[_0x373803(0x24a)],'read':_0x18433d[_0x373803(0x269)],'quotedMsgId':_0x18433d['quotedMsgId'],'ack':_0x18433d['ack'],'remoteJid':_0x18433d[_0x373803(0x22d)],'participant':_0x18433d[_0x373803(0x227)],'dataJson':_0x18433d[_0x373803(0x1d0)],'isEdited':!![]},_0x33f9f6={'messageId':_0x384661['id'],'body':_0x18433d['body'],'ticketId':_0x18433d[_0x373803(0x224)]};await OldMessage_1[_0x373803(0x1f6)]['upsert'](_0x33f9f6),await _0x2fcf84[_0x373803(0x277)]({'lastMessage':_0x384661[_0x373803(0x1f1)]}),await(0x0,CreateMessageService_1[_0x373803(0x1f6)])({'messageData':_0x384661,'companyId':_0x2fcf84[_0x373803(0x21e)]});const _0x1a2395=(0x0,socket_1[_0x373803(0x1e3)])();_0x1a2395['to'](_0x2fcf84[_0x373803(0x1c5)])['to'](_0x2fcf84['id'][_0x373803(0x28b)]())[_0x373803(0x266)](_0x373803(0x26c)+_0x2fcf84[_0x373803(0x21e)]+_0x373803(0x1c6),{'action':'update','ticket':_0x2fcf84,'ticketId':_0x2fcf84['id']});};exports[a586_0x5e159a(0x1f0)]=verifyEditedMessage;const verifyDeleteMessage=async(_0x340d47,_0x5a98d2)=>{const _0x9474ca=a586_0x5e159a,_0x1b5b98=await Message_1[_0x9474ca(0x1f6)][_0x9474ca(0x1e0)](_0x340d47[_0x9474ca(0x27e)]['id'],{'include':['contact',{'model':Ticket_1['default'],'include':[{'model':Contact_1[_0x9474ca(0x1f6)]}]}]});if(!_0x1b5b98)return;await _0x1b5b98[_0x9474ca(0x277)]({'isDeleted':!![]});const _0x12f767=(0x0,socket_1[_0x9474ca(0x1e3)])();_0x12f767['to'](_0x1b5b98[_0x9474ca(0x224)][_0x9474ca(0x28b)]())['to'](_0x1b5b98[_0x9474ca(0x1c1)][_0x9474ca(0x1c5)])['to'](_0x9474ca(0x271))[_0x9474ca(0x266)](_0x9474ca(0x26c)+_0x5a98d2[_0x9474ca(0x21e)]+_0x9474ca(0x272),{'action':_0x9474ca(0x27a),'message':_0x1b5b98,'ticket':_0x1b5b98['ticket'],'contact':_0x1b5b98['ticket'][_0x9474ca(0x24d)]});};exports[a586_0x5e159a(0x1da)]=verifyDeleteMessage;const verifyQueue=async(_0x38710a,_0x1cbb8f,_0x2a8602,_0x9f11f2)=>{const _0x1ab5bd=a586_0x5e159a;if(_0x1cbb8f?.[_0x1ab5bd(0x27e)]['id']&&_0x2a8602[_0x1ab5bd(0x273)]===_0x1cbb8f[_0x1ab5bd(0x27e)]['id']){console[_0x1ab5bd(0x1fc)](_0x1ab5bd(0x1d1)+_0x1cbb8f[_0x1ab5bd(0x27e)]['id']+_0x1ab5bd(0x1df)+_0x2a8602['id']+_0x1ab5bd(0x1dc));return;}_0x1cbb8f?.['key']['id']&&await _0x2a8602[_0x1ab5bd(0x277)]({'lastProcessedMessageId':_0x1cbb8f[_0x1ab5bd(0x27e)]['id']});const _0x16aa02=await(0x0,ShowWhatsAppService_1['default'])(_0x38710a['id'],_0x2a8602[_0x1ab5bd(0x21e)]),{queues:_0x34c0d3,greetingMessage:_0x1d261d}=_0x16aa02,_0x2629a1=await Setting_1[_0x1ab5bd(0x1f6)]['findOne']({'where':{'key':_0x1ab5bd(0x1ff),'companyId':_0x2a8602['companyId']}});if(_0x34c0d3[_0x1ab5bd(0x212)]===0x1){const _0x42c030=(0x0,lodash_1[_0x1ab5bd(0x25f)])(_0x34c0d3);if(!_0x42c030)return;const _0x28d447=_0x42c030?.[_0x1ab5bd(0x216)]?.[_0x1ab5bd(0x212)]>0x0;await _0x2a8602['update']({'amountUsedBotQueues':0x0,'queueOptionId':null});if(!_0x2a8602[_0x1ab5bd(0x1c8)]&&_0x42c030[_0x1ab5bd(0x22f)]&&!_0x1cbb8f?.['key'][_0x1ab5bd(0x1e2)]&&!_0x2a8602['isGroup'])try{const _0x5e0219=await(0x0,ShowQueueIntegrationService_1['default'])(_0x42c030[_0x1ab5bd(0x22f)],_0x2a8602[_0x1ab5bd(0x21e)]);if(_0x5e0219){await _0x2a8602[_0x1ab5bd(0x277)]({'useIntegration':!![],'integrationId':_0x5e0219['id'],'amountUsedBotQueues':0x0});_0x1cbb8f&&await(0x0,wbotMessageListener_1[_0x1ab5bd(0x235)])(_0x1cbb8f,_0x38710a,_0x5e0219,_0x2a8602);console[_0x1ab5bd(0x1fc)](_0x1ab5bd(0x242)+_0x5e0219['id']+_0x1ab5bd(0x206)+_0x2a8602['id']);return;}}catch(_0x35aed7){console['error'](_0x1ab5bd(0x285),_0x35aed7),await _0x2a8602[_0x1ab5bd(0x277)]({'useIntegration':![],'integrationId':null});}await _0x2a8602[_0x1ab5bd(0x277)]({'queueId':_0x42c030['id'],'chatbot':_0x28d447});_0x42c030[_0x1ab5bd(0x209)]&&await(0x0,SendWhatsAppMessage_1[_0x1ab5bd(0x1f6)])({'ticket':_0x2a8602,'body':_0x42c030[_0x1ab5bd(0x209)]});_0x28d447&&await(0x0,wbotMessageListener_1[_0x1ab5bd(0x282)])(_0x2a8602,_0x38710a);return;}const _0x59d8c3=_0x1cbb8f?(0x0,GetHandlers_1['getBodyMessage'])(_0x1cbb8f):null,_0x18b842=_0x59d8c3?_0x34c0d3[+_0x59d8c3-0x1]:null;if(_0x18b842){await _0x2a8602[_0x1ab5bd(0x277)]({'amountUsedBotQueues':0x0,'queueOptionId':null});if(!_0x2a8602[_0x1ab5bd(0x1c8)]&&_0x18b842['integrationId']&&!_0x1cbb8f?.[_0x1ab5bd(0x27e)][_0x1ab5bd(0x1e2)]&&!_0x2a8602[_0x1ab5bd(0x21b)])try{const _0x30465a=await(0x0,ShowQueueIntegrationService_1[_0x1ab5bd(0x1f6)])(_0x18b842[_0x1ab5bd(0x22f)],_0x2a8602['companyId']);if(_0x30465a){await _0x2a8602['update']({'useIntegration':!![],'integrationId':_0x30465a['id']}),await(0x0,wbotMessageListener_1['handleMessageIntegration'])(_0x1cbb8f,_0x38710a,_0x30465a,_0x2a8602),console['log'](_0x1ab5bd(0x242)+_0x30465a['id']+'\x20iniciada\x20para\x20o\x20ticket\x20#'+_0x2a8602['id']);return;}}catch(_0x1974cf){console['error'](_0x1ab5bd(0x215),_0x1974cf),await _0x2a8602[_0x1ab5bd(0x277)]({'useIntegration':![],'integrationId':null});}const _0x3b1832=_0x18b842?.[_0x1ab5bd(0x216)]?.[_0x1ab5bd(0x212)]>0x0;await _0x2a8602[_0x1ab5bd(0x277)]({'queueId':_0x18b842['id'],'chatbot':_0x3b1832});_0x18b842[_0x1ab5bd(0x209)]&&await(0x0,SendWhatsAppMessage_1[_0x1ab5bd(0x1f6)])({'ticket':_0x2a8602,'body':_0x18b842[_0x1ab5bd(0x209)]});_0x3b1832&&await(0x0,wbotMessageListener_1['displayCurrentMenu'])(_0x2a8602,_0x38710a);return;}const _0x5a3cde=await Whatsapp_1[_0x1ab5bd(0x1f6)][_0x1ab5bd(0x1e0)](_0x2a8602[_0x1ab5bd(0x1f2)]);if(!_0x5a3cde){console[_0x1ab5bd(0x221)](_0x1ab5bd(0x259));return;}if(!_0x2a8602[_0x1ab5bd(0x275)]&&_0x2a8602[_0x1ab5bd(0x276)]>=_0x5a3cde[_0x1ab5bd(0x24e)])return;if(_0x1cbb8f&&_0x59d8c3&&!_0x18b842){if(_0x5a3cde['maxUseBotQueues']&&_0x5a3cde[_0x1ab5bd(0x24e)]!==0x0&&_0x2a8602[_0x1ab5bd(0x276)]>=_0x5a3cde['maxUseBotQueues']){await _0x2a8602[_0x1ab5bd(0x277)]({'chatbot':![],'queueOptionId':null,'amountUsedBotQueues':_0x5a3cde[_0x1ab5bd(0x24e)]});_0x5a3cde['transferMessage']&&await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x2a8602,'body':_0x5a3cde['transferMessage']});return;}await _0x2a8602[_0x1ab5bd(0x277)]({'amountUsedBotQueues':_0x2a8602[_0x1ab5bd(0x276)]+0x1}),await _0x2a8602[_0x1ab5bd(0x280)]();}const _0x420035=async()=>{const _0x3c01f2=_0x1ab5bd;let _0x1aaa25='';_0x34c0d3[_0x3c01f2(0x228)]((_0x2e15a4,_0x308f82)=>{const _0x2b0f12=_0x3c01f2;_0x1aaa25+='*'+(_0x308f82+0x1)+_0x2b0f12(0x1f8)+_0x2e15a4[_0x2b0f12(0x239)]+'\x0a';});const _0x1b28d4=_0x1d261d+'\x0a\x0a'+_0x1aaa25;await(0x0,SendWhatsAppMessage_1[_0x3c01f2(0x1f6)])({'ticket':_0x2a8602,'body':_0x1b28d4});};switch(_0x2629a1?.[_0x1ab5bd(0x24c)]){case _0x1ab5bd(0x1e4):default:await _0x420035();break;}};function a586_0x28ad(){const _0x3f292c=['@lid','indexOf','makeRandomId','thumbnail-image','__importDefault','../../models/OldMessage','6VIVxLD','IntegraÃ§Ã£o\x20#','findAll','closed','setExtra','normalizeThumbnailMediaType','verifyMediaMessage','downloadContentFromMessage','campaignId','mediaType','data','value','contact','maxUseBotQueues','defineProperty','promises','ERR_FILESIZE_OVER_LIMIT','video','path','queue','2683188MhYmPt','contactId','verifyContact','normalizeMediaType','ConfiguraÃ§Ãµes\x20do\x20WhatsApp\x20nÃ£o\x20encontradas.','1718680PgTvBh','sequelize','delete','filename','.jpg','head','promisify','../../libs/socket','env','*Mensagem\x20do\x20sistema*:\x0aArquivo\x20recebido\x20alÃ©m\x20do\x20limite\x20de\x20tamanho\x20do\x20sistema,\x20se\x20for\x20necessÃ¡rio\x20ele\x20pode\x20ser\x20obtido\x20no\x20aplicativo\x20do\x20whatsapp.','util','verifyRating','emit','imageMessage','call','read','fileName','__setModuleDefault','company-','165825hTQpoa','DispatchConfirmedCampaign','remoteJidAlt','>>>>\x20erro\x20','notification','-appMessage','lastProcessedMessageId','substring','chatbot','amountUsedBotQueues','update','../../helpers/GetPublicPath','../../models/Whatsapp','create','url','../../models/User','warn','key','constructor','reload','writeFile','displayCurrentMenu','findOne','randomValue','Erro\x20ao\x20processar\x20integraÃ§Ã£o\x20para\x20fila\x20Ãºnica:','number','profilePicUrl','downloadLimit','1631049LsOGoO','slice','toString','\x20(has\x20','thumbnail-document','getMessageMedia','522440raBuku','thumbnail-','getBodyMessage','[verifyMessage]\x20Keeping\x20contact\x20','caption','ticket','mkdir','getQuotedMessageId','directPath','status','-ticket','ðŸ“Ž\x20','useIntegration','lid','split','./SendWhatsAppMessage','moment','logger','../ContactServices/CreateOrUpdateContactService','replace','dataJson','Mensagem\x20','fileLength','extendedTextMessage','thumbnail-video','../../helpers/ExtractPhoneNumber','writable','message','hasOwnProperty','verifyMessage','verifyDeleteMessage','../../helpers/CheckSettings','.\x20Ignorando\x20em\x20verifyQueue.','Throttle','verifyQueue','\x20jÃ¡\x20processada\x20para\x20o\x20ticket\x20','findByPk','\x20already\x20up\x20to\x20date','fromMe','getIO','text','mimetype','destroy','count','base64','\x20de\x20baixar\x20o\x20arquivo\x20','conversation','documentWithCaptionMessage','./GetHandlers','g.us','prototype','*Mensagem\x20AutomÃ¡tica*:\x0aNosso\x20sistema\x20aceita\x20apenas\x20arquivos\x20com\x20no\x20mÃ¡ximo\x20','verifyEditedMessage','body','whatsappId','../../models/Setting','pending','getUnpackedMessage','default','documentMessage','*\x20-\x20','queue-','profilePictureUrl','__esModule','log','keys','(((.+)+)+)+$','chatBotType','../MessageServices/CreateMessageService','../../queues','../../utils/logger','../../models/CampaignShipping','includes','__importStar','\x20iniciada\x20para\x20o\x20ticket\x20#','5Nymzis','../WhatsappService/ShowWhatsAppService','greetingMessage','FRONTEND_URL','get','getPhoneNumberFromJid','user','getTypeEditedMessage','/nopicture.png','../../models/Contact','[verifyMessage]\x20Contact\x20','length','add','72987XpoTBD','Erro\x20ao\x20processar\x20integraÃ§Ã£o\x20para\x20fila\x20escolhida:','options','from','../../models/Campaign','[verifyMessage]\x20Deleted\x20duplicate\x20contact\x20','706826okwhDV','isGroup','ERR_WAPP_DOWNLOAD_MEDIA','\x20other\x20tickets)','companyId','captureException','getOwnPropertyDescriptor','error','lodash','queueId','ticketId','reactionMessage','audio','participant','forEach','-closed','Failed\x20to\x20get\x20stream','getTime','../../helpers/MakeRandomId','remoteJid','EM_ANDAMENTO','integrationId','getPublicPath','stream-throttle','join','./wbotMessageListener','document','handleMessageIntegration','stringify','search','apply','name','rate'];a586_0x28ad=function(){return _0x3f292c;};return a586_0x28ad();}exports['verifyQueue']=verifyQueue;const verifyRating=_0x267465=>{if(_0x267465&&_0x267465['finishedAt']===null&&_0x267465['userId']!==null&&_0x267465['ratingAt']!==null)return!![];return![];};exports[a586_0x5e159a(0x265)]=verifyRating;const verifyRecentCampaign=async(_0x520c20,_0xe94e31)=>{const _0x35a046=a586_0x5e159a;if(!_0x520c20[_0x35a046(0x27e)]['fromMe']){const _0x30a809=(0x0,ExtractPhoneNumber_1[_0x35a046(0x20c)])(_0x520c20[_0x35a046(0x27e)]['remoteJid']),_0x3bb0ab=await Campaign_1[_0x35a046(0x1f6)][_0x35a046(0x243)]({'where':{'companyId':_0xe94e31,'status':_0x35a046(0x22e),'confirmation':!![]}});if(_0x3bb0ab){const _0x23e595=_0x3bb0ab['map'](_0x510e3e=>_0x510e3e['id']),_0x422673=await CampaignShipping_1['default'][_0x35a046(0x283)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x23e595},'number':_0x30a809,'confirmation':null}});if(_0x422673)return await _0x422673[_0x35a046(0x277)]({'confirmedAt':(0x0,moment_1[_0x35a046(0x1f6)])(),'confirmation':!![]}),await queues_1['campaignQueue'][_0x35a046(0x213)](_0x35a046(0x26e),{'campaignShippingId':_0x422673['id'],'campaignId':_0x422673[_0x35a046(0x249)]},{'delay':(0x0,queues_1['parseToMilliseconds'])((0x0,queues_1[_0x35a046(0x284)])(0x0,0xa))}),!![];}}return![];};exports['verifyRecentCampaign']=verifyRecentCampaign;