'use strict';const a586_0x11fa63=a586_0x5e9d;(function(_0x27a8db,_0x24fbf0){const _0x4d588e=a586_0x5e9d,_0x2369b7=_0x27a8db();while(!![]){try{const _0x586def=-parseInt(_0x4d588e(0x81))/0x1+-parseInt(_0x4d588e(0xc6))/0x2+-parseInt(_0x4d588e(0x12b))/0x3+-parseInt(_0x4d588e(0xb0))/0x4+-parseInt(_0x4d588e(0x127))/0x5+-parseInt(_0x4d588e(0x146))/0x6+parseInt(_0x4d588e(0xe4))/0x7;if(_0x586def===_0x24fbf0)break;else _0x2369b7['push'](_0x2369b7['shift']());}catch(_0x25ac7b){_0x2369b7['push'](_0x2369b7['shift']());}}}(a586_0x5235,0xc1dfe));var __createBinding=this&&this['__createBinding']||(Object[a586_0x11fa63(0xb4)]?function(_0x567c45,_0xd2a16a,_0x619da6,_0x378a14){const _0x57dade=a586_0x11fa63;if(_0x378a14===undefined)_0x378a14=_0x619da6;var _0x3abd43=Object['getOwnPropertyDescriptor'](_0xd2a16a,_0x619da6);(!_0x3abd43||(_0x57dade(0x9b)in _0x3abd43?!_0xd2a16a[_0x57dade(0x12a)]:_0x3abd43[_0x57dade(0xa4)]||_0x3abd43[_0x57dade(0x93)]))&&(_0x3abd43={'enumerable':!![],'get':function(){return _0xd2a16a[_0x619da6];}}),Object[_0x57dade(0x118)](_0x567c45,_0x378a14,_0x3abd43);}:function(_0x17ecd1,_0x29a960,_0x30a042,_0xb6fa77){if(_0xb6fa77===undefined)_0xb6fa77=_0x30a042;_0x17ecd1[_0xb6fa77]=_0x29a960[_0x30a042];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a586_0x11fa63(0xb4)]?function(_0x1be6a8,_0x2f1f7b){const _0x1f532d=a586_0x11fa63;Object[_0x1f532d(0x118)](_0x1be6a8,_0x1f532d(0x134),{'enumerable':!![],'value':_0x2f1f7b});}:function(_0x5586e2,_0x1717ab){const _0x4f00c1=a586_0x11fa63;_0x5586e2[_0x4f00c1(0x134)]=_0x1717ab;}),__importStar=this&&this[a586_0x11fa63(0x117)]||(function(){const _0x3620b8=(function(){let _0x335b56=!![];return function(_0x518dd5,_0x26844a){const _0x57d71a=_0x335b56?function(){const _0x5045ed=a586_0x5e9d;if(_0x26844a){const _0x284923=_0x26844a[_0x5045ed(0x103)](_0x518dd5,arguments);return _0x26844a=null,_0x284923;}}:function(){};return _0x335b56=![],_0x57d71a;};}()),_0xa5b612=_0x3620b8(this,function(){const _0x3a3e94=a586_0x5e9d;return _0xa5b612['toString']()[_0x3a3e94(0x11a)](_0x3a3e94(0x10b))[_0x3a3e94(0x94)]()[_0x3a3e94(0xd6)](_0xa5b612)[_0x3a3e94(0x11a)](_0x3a3e94(0x10b));});_0xa5b612();var _0x28d19f=function(_0x29eb3e){const _0xf82426=a586_0x5e9d;return _0x28d19f=Object[_0xf82426(0x149)]||function(_0x375e91){const _0x22be62=_0xf82426;var _0x332c58=[];for(var _0x21d936 in _0x375e91)if(Object[_0x22be62(0xf0)][_0x22be62(0xfe)]['call'](_0x375e91,_0x21d936))_0x332c58[_0x332c58['length']]=_0x21d936;return _0x332c58;},_0x28d19f(_0x29eb3e);};return function(_0x585c80){const _0x3bc3eb=a586_0x5e9d;if(_0x585c80&&_0x585c80[_0x3bc3eb(0x12a)])return _0x585c80;var _0x11c96b={};if(_0x585c80!=null){for(var _0x590ee5=_0x28d19f(_0x585c80),_0x5e09cf=0x0;_0x5e09cf<_0x590ee5[_0x3bc3eb(0x91)];_0x5e09cf++)if(_0x590ee5[_0x5e09cf]!=='default')__createBinding(_0x11c96b,_0x585c80,_0x590ee5[_0x5e09cf]);}return __setModuleDefault(_0x11c96b,_0x585c80),_0x11c96b;};}()),__importDefault=this&&this[a586_0x11fa63(0xdc)]||function(_0x28a639){const _0x282023=a586_0x11fa63;return _0x28a639&&_0x28a639[_0x282023(0x12a)]?_0x28a639:{'default':_0x28a639};};Object['defineProperty'](exports,a586_0x11fa63(0x12a),{'value':!![]}),exports[a586_0x11fa63(0x83)]=exports[a586_0x11fa63(0x114)]=exports['verifyQueue']=exports[a586_0x11fa63(0x95)]=exports[a586_0x11fa63(0xeb)]=exports[a586_0x11fa63(0x10d)]=exports[a586_0x11fa63(0xdb)]=exports[a586_0x11fa63(0xe1)]=exports[a586_0x11fa63(0x12f)]=exports[a586_0x11fa63(0x13b)]=void 0x0;const Message_1=__importDefault(require(a586_0x11fa63(0x147))),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a586_0x11fa63(0x106))),socket_1=require(a586_0x11fa63(0xa5)),baileys_1=require(a586_0x11fa63(0xba)),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),GetHandlers_1=require('./GetHandlers'),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a586_0x11fa63(0xd2))),Sentry=__importStar(require(a586_0x11fa63(0xf1))),CreateOrUpdateContactService_1=__importDefault(require(a586_0x11fa63(0xb2))),stream_throttle_1=require(a586_0x11fa63(0xb6)),MakeRandomId_1=require(a586_0x11fa63(0x92)),CheckSettings_1=__importDefault(require(a586_0x11fa63(0x8f))),GetHandlers_2=require(a586_0x11fa63(0xc1)),GetPublicPath_1=require('../../helpers/GetPublicPath'),logger_1=require(a586_0x11fa63(0x105)),util_1=require(a586_0x11fa63(0x138)),fs_1=__importStar(require('fs')),path_1=require(a586_0x11fa63(0x97)),OldMessage_1=__importDefault(require('../../models/OldMessage')),ShowWhatsAppService_1=__importDefault(require(a586_0x11fa63(0xa9))),lodash_1=require(a586_0x11fa63(0xaf)),ShowQueueIntegrationService_1=__importDefault(require(a586_0x11fa63(0xdd))),wbotMessageListener_1=require(a586_0x11fa63(0xe7)),Setting_1=__importDefault(require(a586_0x11fa63(0x130))),Campaign_1=__importDefault(require('../../models/Campaign')),CampaignShipping_1=__importDefault(require(a586_0x11fa63(0xad))),moment_1=__importDefault(require(a586_0x11fa63(0x129))),queues_1=require('../../queues'),sequelize_1=require(a586_0x11fa63(0xe2)),SendWhatsAppMessage_1=__importDefault(require(a586_0x11fa63(0x12d))),Whatsapp_1=__importDefault(require(a586_0x11fa63(0x8a))),ExtractPhoneNumber_1=require('../../helpers/ExtractPhoneNumber'),writeFileAsync=(0x0,util_1[a586_0x11fa63(0x13d)])(fs_1[a586_0x11fa63(0xf9)]),saveMediaToFile=async(_0x1b5e61,_0x29f558)=>{const _0x1fb5d4=a586_0x11fa63;if(!_0x1b5e61['filename']){const _0x28df06=_0x1b5e61['mimetype'][_0x1fb5d4(0x120)]('/')[0x1][_0x1fb5d4(0x120)](';')[0x0];_0x1b5e61[_0x1fb5d4(0xd1)]=new Date()[_0x1fb5d4(0xd5)]()+'.'+_0x28df06;}const _0x4eee51=(0x0,GetPublicPath_1[_0x1fb5d4(0x12e)])(),_0x3e3835=(0x0,MakeRandomId_1[_0x1fb5d4(0x121)])(0xa),_0x5b996a=_0x1fb5d4(0x133)+_0x29f558[_0x1fb5d4(0x119)]+'/'+_0x29f558['contactId']+'/'+_0x29f558['id']+'/'+_0x3e3835;try{await fs_1[_0x1fb5d4(0x134)][_0x1fb5d4(0x8b)][_0x1fb5d4(0x109)]((0x0,path_1[_0x1fb5d4(0xc9)])(_0x4eee51,_0x5b996a),{'recursive':!![]}),await writeFileAsync((0x0,path_1['join'])(_0x4eee51,_0x5b996a,_0x1b5e61[_0x1fb5d4(0xd1)]),_0x1b5e61[_0x1fb5d4(0xe8)],_0x1fb5d4(0x112));}catch(_0x57f875){Sentry[_0x1fb5d4(0x137)](_0x57f875),logger_1[_0x1fb5d4(0xd0)][_0x1fb5d4(0xc7)](_0x57f875);}return _0x5b996a+'/'+_0x1b5e61[_0x1fb5d4(0xd1)];},normalizeMediaType=_0x1f4f5d=>{const _0x254285=a586_0x11fa63,_0x330ead=[_0x254285(0x11e),_0x254285(0xd4),_0x254285(0xcd),_0x254285(0xfb)],_0x4a23e5=_0x1f4f5d[_0x254285(0x120)]('/')[0x0];if(!_0x330ead[_0x254285(0xe5)](_0x4a23e5))return _0x254285(0xfb);return _0x4a23e5;};exports[a586_0x11fa63(0x13b)]=normalizeMediaType;function a586_0x5e9d(_0xe403ba,_0x44596c){const _0x2d509f=a586_0x5235();return a586_0x5e9d=function(_0x1f4dac,_0x150211){_0x1f4dac=_0x1f4dac-0x81;let _0x5235b4=_0x2d509f[_0x1f4dac];return _0x5235b4;},a586_0x5e9d(_0xe403ba,_0x44596c);}const normalizeThumbnailMediaType=_0x1609fa=>{const _0x15ae24=a586_0x11fa63,_0x5da3e5=['thumbnail-video','thumbnail-image','thumbnail-document'],_0x4d42ed=_0x1609fa[_0x15ae24(0x120)]('/')[0x0];if(!_0x5da3e5[_0x15ae24(0xe5)](_0x15ae24(0xea)+_0x4d42ed))return'thumbnail-document';return _0x4d42ed;};exports[a586_0x11fa63(0x12f)]=normalizeThumbnailMediaType;const downloadMedia=async(_0x33925d,_0x185262,_0x297183)=>{const _0x26ae37=a586_0x11fa63,_0x3efa72=(0x0,GetHandlers_2[_0x26ae37(0x11f)])(_0x33925d),_0x4101ab=(0x0,GetHandlers_2[_0x26ae37(0x108)])(_0x3efa72);if(!_0x4101ab)return null;const _0x976720=parseInt(await(0x0,CheckSettings_1[_0x26ae37(0x134)])(_0x26ae37(0x100),'15'),0xa);if(_0x185262&&_0x4101ab?.[_0x26ae37(0x13e)]&&+_0x4101ab[_0x26ae37(0x13e)]>_0x976720*0x400*0x400){const _0x225759=_0x26ae37(0xaa)+_0x976720+_0x26ae37(0xa2);if(!_0x297183[_0x26ae37(0xca)]){const _0x3dc318=await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x297183,'body':_0x225759});_0x3dc318['message'][_0x26ae37(0xd8)][_0x26ae37(0x115)]=_0x26ae37(0xb5);}throw new Error(_0x26ae37(0xd7));}const _0x2ee1d6=_0x3efa72?.[_0x26ae37(0xdf)]?_0x26ae37(0xfb):(0x0,exports['normalizeMediaType'])(_0x4101ab[_0x26ae37(0xfa)]);let _0x3ee8f2,_0x32a286=0x0;while(_0x32a286<0xa&&!_0x3ee8f2){try{const _0x276a34={..._0x4101ab};_0x276a34?.['directPath']&&(_0x276a34[_0x26ae37(0x99)]=''),_0x3ee8f2=await(0x0,baileys_1[_0x26ae37(0x135)])(_0x276a34,_0x2ee1d6);}catch(_0x2f94de){_0x32a286+=0x1,await new Promise(_0x214f07=>{setTimeout(_0x214f07,0x3e8*_0x32a286*0x2);}),logger_1[_0x26ae37(0xd0)][_0x26ae37(0x88)](_0x26ae37(0xac)+_0x32a286+_0x26ae37(0xde)+_0x33925d?.['key']?.['id']);}}if(!_0x3ee8f2)throw new Error(_0x26ae37(0xa8));const _0x27c22b=await downloadStream(_0x3ee8f2);if(!_0x27c22b){Sentry[_0x26ae37(0x8d)]('ERR_WAPP_DOWNLOAD_MEDIA',{'msg':_0x33925d}),Sentry[_0x26ae37(0x137)](new Error('ERR_WAPP_DOWNLOAD_MEDIA'));throw new Error(_0x26ae37(0xbb));}let _0x1bfa09=_0x3efa72?.[_0x26ae37(0xdf)]?.[_0x26ae37(0xcb)]||'';if(!_0x1bfa09){const _0x1ac2dd=_0x4101ab[_0x26ae37(0xfa)][_0x26ae37(0x120)]('/')[0x1][_0x26ae37(0x120)](';')[0x0];_0x1bfa09=(0x0,MakeRandomId_1['makeRandomId'])(0x5)+'-'+new Date()['getTime']()+'.'+_0x1ac2dd;}else _0x1bfa09=_0x1bfa09['split']('.')[_0x26ae37(0x96)](0x0,-0x1)['join']('.')+'.'+(0x0,MakeRandomId_1[_0x26ae37(0x121)])(0x5)+'.'+_0x1bfa09['split']('.')[_0x26ae37(0x96)](-0x1);const _0x1f9f6a={'data':_0x27c22b,'mimetype':_0x4101ab[_0x26ae37(0xfa)],'filename':_0x1bfa09};return _0x1f9f6a;},downloadStream=async _0x39c9a8=>{const _0x7039ee=a586_0x11fa63,_0x4fbcad=0x5*0x400*0x400/0x8,_0x2ccda2=0x400*0x400/0x8,_0x349a01=0x400*0x400,_0x314024=new stream_throttle_1[(_0x7039ee(0x10a))]({'rate':_0x4fbcad});let _0x272f45=Buffer[_0x7039ee(0xa7)]([]),_0x4393ee=0x0;try{for await(const _0x28eba0 of _0x39c9a8[_0x7039ee(0x116)](_0x314024)){_0x272f45=Buffer[_0x7039ee(0xec)]([_0x272f45,_0x28eba0]),_0x4393ee+=_0x28eba0[_0x7039ee(0x91)],_0x4393ee>_0x349a01&&(_0x314024[_0x7039ee(0x140)]=_0x2ccda2);}}catch(_0x1a4c08){Sentry[_0x7039ee(0x8d)](_0x7039ee(0xbb),{'error':_0x1a4c08}),Sentry[_0x7039ee(0x137)](new Error(_0x7039ee(0xbb)));throw new Error(_0x7039ee(0xbb));}return _0x272f45;},downloadThumbnail=async({thumbnailDirectPath:_0x3fa41a,mediaKey:_0x33eb96,mimetype:_0x3d6342})=>{const _0x4c5571=a586_0x11fa63;if(!_0x3fa41a||!_0x33eb96)return null;const _0xd6051=await(0x0,baileys_1[_0x4c5571(0x135)])({'mediaKey':_0x33eb96,'directPath':_0x3fa41a},_0x3d6342?(0x0,exports[_0x4c5571(0x12f)])(_0x3d6342):_0x4c5571(0x14b));if(!_0xd6051)throw new Error(_0x4c5571(0xa8));const _0x31e0ff=await downloadStream(_0xd6051);if(!_0x31e0ff)throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');const _0x3cba62=_0x4c5571(0xea)+(0x0,MakeRandomId_1[_0x4c5571(0x121)])(0x5)+'-'+new Date()[_0x4c5571(0xd5)]()+_0x4c5571(0x90),_0x507f90={'data':_0x31e0ff,'mimetype':_0x4c5571(0xe6),'filename':_0x3cba62};return _0x507f90;},verifyMessage=async(_0x29fbe2,_0x46f069,_0x421444,_0x2cd952=null,_0x235eea=null)=>{const _0x55fb69=a586_0x11fa63,_0x5252b8=(0x0,socket_1[_0x55fb69(0x9c)])(),_0x9a0e95=await verifyQuotedMessage(_0x29fbe2),_0x575719=(0x0,GetHandlers_1[_0x55fb69(0x12c)])(_0x29fbe2),_0xbf42ff={'id':_0x29fbe2[_0x55fb69(0xa3)]['id'],'ticketId':_0x46f069['id'],'userId':_0x2cd952,'contactId':_0x29fbe2[_0x55fb69(0xa3)][_0x55fb69(0x84)]?undefined:_0x421444['id'],'body':_0x575719,'fromMe':_0x29fbe2['key'][_0x55fb69(0x84)],'mediaType':_0x29fbe2[_0x55fb69(0xfc)][_0x55fb69(0xf8)]?_0x55fb69(0xf8):null,'read':_0x29fbe2[_0x55fb69(0xa3)][_0x55fb69(0x84)],'quotedMsgId':_0x9a0e95?.['id'],'ack':_0x29fbe2[_0x55fb69(0xc8)],'remoteJid':_0x29fbe2[_0x55fb69(0xa3)][_0x55fb69(0xc4)],'participant':_0x29fbe2[_0x55fb69(0xa3)][_0x55fb69(0xb3)],'dataJson':JSON[_0x55fb69(0xda)](_0x29fbe2),'isEdited':![]};await _0x46f069[_0x55fb69(0x11d)]({'lastMessage':_0x575719['substring'](0x0,0xff)['replace'](/\n/g,'\x20')});const _0x2fd98c=await(0x0,CreateMessageService_1['default'])({'messageData':_0xbf42ff,'companyId':_0x46f069[_0x55fb69(0x119)]});if(!_0x29fbe2[_0x55fb69(0xa3)][_0x55fb69(0x84)]){const _0x40b03a=_0x29fbe2[_0x55fb69(0xa3)],_0x14f860=_0x29fbe2[_0x55fb69(0xa3)][_0x55fb69(0xc4)],_0x125844=_0x40b03a['remoteJidAlt'];let _0x2cddf5=null,_0x5ece70=null;if(_0x14f860?.[_0x55fb69(0xe5)](_0x55fb69(0x104)))_0x2cddf5=_0x14f860,_0x5ece70=_0x125844;else _0x14f860?.['includes'](_0x55fb69(0x8c))&&(_0x5ece70=_0x14f860,_0x2cddf5=_0x125844);const _0xee5966=_0x2cddf5?.[_0x55fb69(0x120)]('@')[0x0],_0x2dbcfa=_0x5ece70?.[_0x55fb69(0x120)]('@')[0x0],_0xa124a=_0xee5966&&_0xee5966!==_0x421444[_0x55fb69(0x131)]||_0x2dbcfa&&_0x2dbcfa!==_0x421444[_0x55fb69(0x145)];if(_0xa124a){if(_0xee5966&&_0xee5966!==_0x421444[_0x55fb69(0x131)]){const _0x4fea28=await Contact_1[_0x55fb69(0x134)]['findOne']({'where':{'number':_0xee5966,'companyId':_0x421444[_0x55fb69(0x119)]}});if(_0x4fea28&&_0x4fea28['id']!==_0x421444['id']){await _0x46f069[_0x55fb69(0x11d)]({'contactId':_0x4fea28['id']}),await _0x2fd98c[_0x55fb69(0x11d)]({'contactId':_0x4fea28['id']});const _0x783e0e={};_0x2dbcfa&&!_0x4fea28[_0x55fb69(0x145)]&&(_0x783e0e['lid']=_0x2dbcfa);_0x2cddf5&&!_0x4fea28[_0x55fb69(0xc4)]&&(_0x783e0e['remoteJid']=_0x2cddf5);const _0x473950=!_0x4fea28[_0x55fb69(0xe9)]||_0x4fea28[_0x55fb69(0xe9)]===''||_0x4fea28[_0x55fb69(0xe9)]===process[_0x55fb69(0x110)][_0x55fb69(0xed)]+'/nopicture.png';if(_0x473950&&_0x235eea)try{const _0x3859a6=_0x5ece70||_0x2cddf5||_0x14f860,_0x4eebbd=await _0x235eea[_0x55fb69(0xf6)](_0x3859a6);_0x4eebbd&&_0x4eebbd!==process['env'][_0x55fb69(0xed)]+_0x55fb69(0xff)&&(_0x783e0e[_0x55fb69(0xe9)]=_0x4eebbd);}catch(_0x280e8b){}Object[_0x55fb69(0xbe)](_0x783e0e)[_0x55fb69(0x91)]>0x0&&await _0x4fea28['update'](_0x783e0e);const _0x490833=await Ticket_1[_0x55fb69(0x134)][_0x55fb69(0xab)]({'where':{'contactId':_0x421444['id']}});_0x490833===0x0?(await _0x421444[_0x55fb69(0xfd)](),console[_0x55fb69(0xf3)](_0x55fb69(0xd3)+_0x421444['id'])):console[_0x55fb69(0xf3)](_0x55fb69(0x10e)+_0x421444['id']+_0x55fb69(0xae)+_0x490833+_0x55fb69(0xb7));return;}}const _0x28db0e={};_0xee5966&&_0xee5966!==_0x421444[_0x55fb69(0x131)]&&(_0x28db0e['number']=_0xee5966),_0x2dbcfa&&_0x2dbcfa!==_0x421444[_0x55fb69(0x145)]&&(_0x28db0e[_0x55fb69(0x145)]=_0x2dbcfa),_0x2cddf5&&_0x2cddf5!==_0x421444['remoteJid']&&(_0x28db0e[_0x55fb69(0xc4)]=_0x2cddf5),Object[_0x55fb69(0xbe)](_0x28db0e)[_0x55fb69(0x91)]>0x0&&(console[_0x55fb69(0xf3)]('[verifyMessage]\x20Updating\x20contact\x20'+_0x421444['id']+':',_0x28db0e),await _0x421444[_0x55fb69(0x11d)](_0x28db0e));}else console[_0x55fb69(0xf3)](_0x55fb69(0xe3)+_0x421444['id']+_0x55fb69(0x136));}return!_0x29fbe2[_0x55fb69(0xa3)][_0x55fb69(0x84)]&&_0x46f069[_0x55fb69(0xc8)]===_0x55fb69(0x126)&&(await _0x46f069['update']({'status':_0x55fb69(0xcc)}),await _0x46f069['reload']({'include':[{'model':Queue_1['default'],'as':_0x55fb69(0xf7)},{'model':User_1[_0x55fb69(0x134)],'as':_0x55fb69(0xef)},{'model':Contact_1[_0x55fb69(0x134)],'as':'contact'}]}),_0x5252b8['to'](_0x55fb69(0xd9)+_0x46f069[_0x55fb69(0x119)]+_0x55fb69(0xc2))['to'](_0x55fb69(0xcf)+_0x46f069['queueId']+_0x55fb69(0xc2))[_0x55fb69(0x9e)]('company-'+_0x46f069[_0x55fb69(0x119)]+_0x55fb69(0xee),{'action':_0x55fb69(0x9f),'ticket':_0x46f069,'ticketId':_0x46f069['id']}),_0x5252b8['to'](_0x55fb69(0xd9)+_0x46f069[_0x55fb69(0x119)]+'-'+_0x46f069[_0x55fb69(0xc8)])['to'](_0x55fb69(0xcf)+_0x46f069[_0x55fb69(0x13f)]+'-'+_0x46f069['status'])['to'](_0x46f069['id'][_0x55fb69(0x94)]())[_0x55fb69(0x9e)](_0x55fb69(0xd9)+_0x46f069['companyId']+_0x55fb69(0xee),{'action':'update','ticket':_0x46f069,'ticketId':_0x46f069['id']})),_0x2fd98c;};exports[a586_0x11fa63(0xe1)]=verifyMessage;const verifyQuotedMessage=async _0x190621=>{const _0xb04e96=a586_0x11fa63;if(!_0x190621)return null;const _0x1d5bd7=(0x0,GetHandlers_1[_0xb04e96(0xe0)])(_0x190621);if(!_0x1d5bd7)return null;const _0x1b533c=await Message_1[_0xb04e96(0x134)]['findOne']({'where':{'id':_0x1d5bd7}});if(!_0x1b533c)return null;return _0x1b533c;},verifyContact=async(_0x3e32cc,_0x1fe6df,_0x1c3616)=>{const _0x26684e=a586_0x11fa63;let _0x247a31;try{_0x247a31=await _0x1fe6df[_0x26684e(0xf6)](_0x3e32cc['id']);}catch(_0x527c00){Sentry[_0x26684e(0x137)](_0x527c00),_0x247a31=process[_0x26684e(0x110)][_0x26684e(0xed)]+'/nopicture.png';}const _0x315006=(0x0,ExtractPhoneNumber_1[_0x26684e(0x89)])(_0x3e32cc['id']),_0x4e6910=_0x3e32cc['id']['includes']('@lid'),_0x2f41b5=_0x4e6910?_0x3e32cc['id'][_0x26684e(0x120)]('@')[0x0]:null,_0xb9cf10={'name':_0x3e32cc?.[_0x26684e(0xf5)]||_0x315006||_0x3e32cc['id'][_0x26684e(0x10c)](/\D/g,''),'number':_0x315006||_0x3e32cc['id'][_0x26684e(0x11c)](0x0,_0x3e32cc['id'][_0x26684e(0xc3)]('@')),'profilePicUrl':_0x247a31,'isGroup':_0x3e32cc['id'][_0x26684e(0xe5)]('g.us'),'companyId':_0x1c3616,'remoteJid':_0x3e32cc['id'],'lid':_0x2f41b5},_0xed18aa=(0x0,CreateOrUpdateContactService_1[_0x26684e(0x134)])(_0xb9cf10);return _0xed18aa;};exports['verifyContact']=verifyContact;const verifyMediaMessage=async(_0x2b7025,_0x45040f,_0x58e4fa,_0x1e1be7=null,_0x2acf69=null,_0x12fbb7=null)=>{const _0x3d53f5=a586_0x11fa63,_0x4cfb21=(0x0,socket_1[_0x3d53f5(0x9c)])(),_0x2b2e6e=await verifyQuotedMessage(_0x2b7025),_0x3a68e4=_0x2acf69||_0x2b7025?.[_0x3d53f5(0xfc)]?.[_0x3d53f5(0xd8)],_0x1b87cd=_0x3a68e4&&await downloadThumbnail(_0x3a68e4),_0x3d87ab=await downloadMedia(_0x2b7025,_0x1e1be7,_0x45040f);if(!_0x3d87ab&&!_0x1b87cd)throw new Error(_0x3d53f5(0xbb));let _0x59367a=null;_0x3d87ab&&(_0x59367a=await saveMediaToFile(_0x3d87ab,_0x45040f));let _0x31e25f=null;_0x1b87cd&&(_0x31e25f=await saveMediaToFile(_0x1b87cd,_0x45040f));const _0xd2d30c=(0x0,GetHandlers_1['getBodyMessage'])(_0x2b7025),_0x7b832c={'id':_0x2b7025[_0x3d53f5(0xa3)]['id'],'ticketId':_0x45040f['id'],'userId':_0x12fbb7,'contactId':_0x2b7025[_0x3d53f5(0xa3)]['fromMe']?undefined:_0x58e4fa['id'],'body':_0xd2d30c||'','fromMe':_0x2b7025['key'][_0x3d53f5(0x84)],'read':_0x2b7025[_0x3d53f5(0xa3)][_0x3d53f5(0x84)],'mediaUrl':_0x59367a,'mediaType':_0x3d87ab?.[_0x3d53f5(0xfa)][_0x3d53f5(0x120)]('/')[0x0],'thumbnailUrl':_0x31e25f,'quotedMsgId':_0x2b2e6e?.['id'],'ack':_0x2b7025[_0x3d53f5(0xc8)],'remoteJid':_0x2b7025['key'][_0x3d53f5(0xc4)],'participant':_0x2b7025['key'][_0x3d53f5(0xb3)],'dataJson':JSON[_0x3d53f5(0xda)](_0x2b7025)};await _0x45040f['update']({'lastMessage':_0xd2d30c||_0x3d87ab?.['filename']?_0x3d53f5(0x141)+_0x3d87ab?.[_0x3d53f5(0xd1)]:''});const _0x19ef3a=await(0x0,CreateMessageService_1['default'])({'messageData':_0x7b832c,'companyId':_0x45040f[_0x3d53f5(0x119)]});if(!_0x2b7025['key']['fromMe']){const _0x14684f=_0x2b7025[_0x3d53f5(0xa3)],_0x2c3593=_0x2b7025['key'][_0x3d53f5(0xc4)],_0x5cd804=_0x14684f[_0x3d53f5(0xb1)];let _0x42c8fa=null;if(_0x2c3593?.['includes'](_0x3d53f5(0x104)))_0x42c8fa=_0x2c3593;else _0x2c3593?.[_0x3d53f5(0xe5)](_0x3d53f5(0x8c))&&(_0x42c8fa=_0x5cd804);if(_0x42c8fa){const _0x1a36f1=_0x42c8fa['split']('@')[0x0];if(_0x1a36f1!==_0x58e4fa[_0x3d53f5(0x131)]){const _0x4d9078={'number':_0x1a36f1,'remoteJid':_0x42c8fa};_0x58e4fa[_0x3d53f5(0xe9)]&&_0x58e4fa[_0x3d53f5(0xe9)]!==process[_0x3d53f5(0x110)][_0x3d53f5(0xed)]+_0x3d53f5(0xff)&&(_0x4d9078[_0x3d53f5(0xe9)]=_0x58e4fa[_0x3d53f5(0xe9)]),await _0x58e4fa[_0x3d53f5(0x11d)](_0x4d9078);}}}return!_0x2b7025[_0x3d53f5(0xa3)][_0x3d53f5(0x84)]&&_0x45040f[_0x3d53f5(0xc8)]==='closed'&&(await _0x45040f[_0x3d53f5(0x11d)]({'status':_0x3d53f5(0xcc)}),await _0x45040f[_0x3d53f5(0x13c)]({'include':[{'model':Queue_1['default'],'as':_0x3d53f5(0xf7)},{'model':User_1[_0x3d53f5(0x134)],'as':_0x3d53f5(0xef)},{'model':Contact_1[_0x3d53f5(0x134)],'as':_0x3d53f5(0xb8)}]}),_0x4cfb21['to'](_0x3d53f5(0xd9)+_0x45040f[_0x3d53f5(0x119)]+_0x3d53f5(0xc2))['to'](_0x3d53f5(0xcf)+_0x45040f[_0x3d53f5(0x13f)]+'-closed')[_0x3d53f5(0x9e)](_0x3d53f5(0xd9)+_0x45040f[_0x3d53f5(0x119)]+_0x3d53f5(0xee),{'action':'delete','ticket':_0x45040f,'ticketId':_0x45040f['id']}),_0x4cfb21['to'](_0x3d53f5(0xd9)+_0x45040f['companyId']+'-'+_0x45040f['status'])['to'](_0x3d53f5(0xcf)+_0x45040f['queueId']+'-'+_0x45040f[_0x3d53f5(0xc8)])['to'](_0x45040f['id'][_0x3d53f5(0x94)]())['emit'](_0x3d53f5(0xd9)+_0x45040f[_0x3d53f5(0x119)]+_0x3d53f5(0xee),{'action':'update','ticket':_0x45040f,'ticketId':_0x45040f['id']})),_0x19ef3a;};exports['verifyMediaMessage']=verifyMediaMessage;const verifyEditedMessage=async(_0x5dc50c,_0x480017,_0x2ba24d)=>{const _0x216e60=a586_0x11fa63,_0x3911b1=(0x0,GetHandlers_2[_0x216e60(0xa1)])(_0x5dc50c);let _0x109475;switch(_0x3911b1){case _0x216e60(0x101):{_0x109475=_0x5dc50c[_0x216e60(0x101)];break;}case _0x216e60(0xd8):{_0x109475=_0x5dc50c['extendedTextMessage'][_0x216e60(0x115)];break;}case _0x216e60(0xbf):{_0x109475=_0x5dc50c[_0x216e60(0xbf)][_0x216e60(0x111)];break;}case _0x216e60(0xdf):{_0x109475=_0x5dc50c[_0x216e60(0xdf)][_0x216e60(0x111)];break;}case _0x216e60(0x86):{_0x109475=_0x5dc50c[_0x216e60(0x86)][_0x216e60(0xfc)][_0x216e60(0xdf)][_0x216e60(0x111)];break;}default:{return;}}const _0x5bfd45=await Message_1[_0x216e60(0x134)]['findByPk'](_0x2ba24d),_0x3828f0={'id':_0x5bfd45['id'],'ticketId':_0x5bfd45[_0x216e60(0xb9)],'contactId':_0x5bfd45['contactId'],'body':_0x109475,'fromMe':_0x5bfd45[_0x216e60(0x84)],'mediaType':_0x5bfd45[_0x216e60(0x10f)],'read':_0x5bfd45['read'],'quotedMsgId':_0x5bfd45[_0x216e60(0x139)],'ack':_0x5bfd45[_0x216e60(0xbc)],'remoteJid':_0x5bfd45[_0x216e60(0xc4)],'participant':_0x5bfd45[_0x216e60(0xb3)],'dataJson':_0x5bfd45[_0x216e60(0x13a)],'isEdited':!![]},_0x1e425d={'messageId':_0x3828f0['id'],'body':_0x5bfd45['body'],'ticketId':_0x5bfd45[_0x216e60(0xb9)]};await OldMessage_1['default']['upsert'](_0x1e425d),await _0x480017['update']({'lastMessage':_0x3828f0[_0x216e60(0xce)]}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x3828f0,'companyId':_0x480017['companyId']});const _0x359463=(0x0,socket_1[_0x216e60(0x9c)])();_0x359463['to'](_0x480017[_0x216e60(0xc8)])['to'](_0x480017['id'][_0x216e60(0x94)]())[_0x216e60(0x9e)](_0x216e60(0xd9)+_0x480017[_0x216e60(0x119)]+'-ticket',{'action':_0x216e60(0x11d),'ticket':_0x480017,'ticketId':_0x480017['id']});};exports[a586_0x11fa63(0xeb)]=verifyEditedMessage;const verifyDeleteMessage=async(_0x57e07b,_0x491b72)=>{const _0x5b2d9b=a586_0x11fa63,_0x3e35a9=await Message_1[_0x5b2d9b(0x134)]['findByPk'](_0x57e07b[_0x5b2d9b(0xa3)]['id'],{'include':['contact',{'model':Ticket_1['default'],'include':[{'model':Contact_1[_0x5b2d9b(0x134)]}]}]});if(!_0x3e35a9)return;await _0x3e35a9['update']({'isDeleted':!![]});const _0x4217c4=(0x0,socket_1['getIO'])();_0x4217c4['to'](_0x3e35a9['ticketId'][_0x5b2d9b(0x94)]())['to'](_0x3e35a9[_0x5b2d9b(0xa6)][_0x5b2d9b(0xc8)])['to']('notification')['emit']('company-'+_0x491b72[_0x5b2d9b(0x119)]+_0x5b2d9b(0x113),{'action':_0x5b2d9b(0xb4),'message':_0x3e35a9,'ticket':_0x3e35a9['ticket'],'contact':_0x3e35a9[_0x5b2d9b(0xa6)]['contact']});};exports['verifyDeleteMessage']=verifyDeleteMessage;const verifyQueue=async(_0x523801,_0x8bb3d4,_0x3a4144,_0x3f085f)=>{const _0x542848=a586_0x11fa63;if(_0x8bb3d4?.['key']['id']&&_0x3a4144[_0x542848(0x142)]===_0x8bb3d4[_0x542848(0xa3)]['id']){console[_0x542848(0xf3)](_0x542848(0x125)+_0x8bb3d4['key']['id']+_0x542848(0xc5)+_0x3a4144['id']+_0x542848(0x85));return;}_0x8bb3d4?.['key']['id']&&await _0x3a4144['update']({'lastProcessedMessageId':_0x8bb3d4['key']['id']});const _0x33c34e=await(0x0,ShowWhatsAppService_1[_0x542848(0x134)])(_0x523801['id'],_0x3a4144[_0x542848(0x119)]),{queues:_0x1e978b,greetingMessage:_0x2452fd}=_0x33c34e,_0x1d55dc=await Setting_1['default'][_0x542848(0x98)]({'where':{'key':'chatBotType','companyId':_0x3a4144[_0x542848(0x119)]}});if(_0x1e978b[_0x542848(0x91)]===0x1){const _0x1e832d=(0x0,lodash_1['head'])(_0x1e978b);if(!_0x1e832d)return;const _0x7ac3d=_0x1e832d?.['options']?.[_0x542848(0x91)]>0x0;await _0x3a4144[_0x542848(0x11d)]({'amountUsedBotQueues':0x0,'queueOptionId':null});if(!_0x3a4144[_0x542848(0x82)]&&_0x1e832d[_0x542848(0x128)]&&!_0x8bb3d4?.[_0x542848(0xa3)][_0x542848(0x84)]&&!_0x3a4144[_0x542848(0xca)])try{const _0x41076c=await(0x0,ShowQueueIntegrationService_1[_0x542848(0x134)])(_0x1e832d[_0x542848(0x128)],_0x3a4144[_0x542848(0x119)]);if(_0x41076c){await _0x3a4144[_0x542848(0x11d)]({'useIntegration':!![],'integrationId':_0x41076c['id'],'amountUsedBotQueues':0x0});_0x8bb3d4&&await(0x0,wbotMessageListener_1['handleMessageIntegration'])(_0x8bb3d4,_0x523801,_0x41076c,_0x3a4144);console['log']('IntegraÃ§Ã£o\x20#'+_0x41076c['id']+_0x542848(0x9a)+_0x3a4144['id']);return;}}catch(_0x5424b0){console[_0x542848(0xc7)]('Erro\x20ao\x20processar\x20integraÃ§Ã£o\x20para\x20fila\x20Ãºnica:',_0x5424b0),await _0x3a4144[_0x542848(0x11d)]({'useIntegration':![],'integrationId':null});}await _0x3a4144['update']({'queueId':_0x1e832d['id'],'chatbot':_0x7ac3d});_0x1e832d[_0x542848(0x11b)]&&await(0x0,SendWhatsAppMessage_1[_0x542848(0x134)])({'ticket':_0x3a4144,'body':_0x1e832d['greetingMessage']});_0x7ac3d&&await(0x0,wbotMessageListener_1[_0x542848(0x8e)])(_0x3a4144,_0x523801);return;}const _0x5e21b4=_0x8bb3d4?(0x0,GetHandlers_1['getBodyMessage'])(_0x8bb3d4):null,_0x1f43b6=_0x5e21b4?_0x1e978b[+_0x5e21b4-0x1]:null;if(_0x1f43b6){await _0x3a4144[_0x542848(0x11d)]({'amountUsedBotQueues':0x0,'queueOptionId':null});if(!_0x3a4144[_0x542848(0x82)]&&_0x1f43b6[_0x542848(0x128)]&&!_0x8bb3d4?.[_0x542848(0xa3)][_0x542848(0x84)]&&!_0x3a4144[_0x542848(0xca)])try{const _0x228aba=await(0x0,ShowQueueIntegrationService_1[_0x542848(0x134)])(_0x1f43b6[_0x542848(0x128)],_0x3a4144['companyId']);if(_0x228aba){await _0x3a4144[_0x542848(0x11d)]({'useIntegration':!![],'integrationId':_0x228aba['id']}),await(0x0,wbotMessageListener_1[_0x542848(0x14a)])(_0x8bb3d4,_0x523801,_0x228aba,_0x3a4144),console['log'](_0x542848(0x123)+_0x228aba['id']+_0x542848(0x9a)+_0x3a4144['id']);return;}}catch(_0x35dd89){console[_0x542848(0xc7)]('Erro\x20ao\x20processar\x20integraÃ§Ã£o\x20para\x20fila\x20escolhida:',_0x35dd89),await _0x3a4144[_0x542848(0x11d)]({'useIntegration':![],'integrationId':null});}const _0x22e0ce=_0x1f43b6?.[_0x542848(0x132)]?.[_0x542848(0x91)]>0x0;await _0x3a4144[_0x542848(0x11d)]({'queueId':_0x1f43b6['id'],'chatbot':_0x22e0ce});_0x1f43b6['greetingMessage']&&await(0x0,SendWhatsAppMessage_1[_0x542848(0x134)])({'ticket':_0x3a4144,'body':_0x1f43b6[_0x542848(0x11b)]});_0x22e0ce&&await(0x0,wbotMessageListener_1['displayCurrentMenu'])(_0x3a4144,_0x523801);return;}const _0x25e15c=await Whatsapp_1['default'][_0x542848(0x9d)](_0x3a4144['whatsappId']);if(!_0x25e15c){console[_0x542848(0xc7)](_0x542848(0x124));return;}if(!_0x3a4144['chatbot']&&_0x3a4144['amountUsedBotQueues']>=_0x25e15c[_0x542848(0x87)])return;if(_0x8bb3d4&&_0x5e21b4&&!_0x1f43b6){if(_0x25e15c['maxUseBotQueues']&&_0x25e15c['maxUseBotQueues']!==0x0&&_0x3a4144[_0x542848(0xbd)]>=_0x25e15c[_0x542848(0x87)]){await _0x3a4144[_0x542848(0x11d)]({'chatbot':![],'queueOptionId':null,'amountUsedBotQueues':_0x25e15c[_0x542848(0x87)]});_0x25e15c[_0x542848(0x122)]&&await(0x0,SendWhatsAppMessage_1[_0x542848(0x134)])({'ticket':_0x3a4144,'body':_0x25e15c['transferMessage']});return;}await _0x3a4144[_0x542848(0x11d)]({'amountUsedBotQueues':_0x3a4144[_0x542848(0xbd)]+0x1}),await _0x3a4144['reload']();}const _0x45d5b8=async()=>{const _0x2f38a2=_0x542848;let _0x2daae6='';_0x1e978b['forEach']((_0xd4dd66,_0x38b143)=>{const _0x68264f=a586_0x5e9d;_0x2daae6+='*'+(_0x38b143+0x1)+'*\x20-\x20'+_0xd4dd66[_0x68264f(0xf5)]+'\x0a';});const _0xb36aab=_0x2452fd+'\x0a\x0a'+_0x2daae6;await(0x0,SendWhatsAppMessage_1[_0x2f38a2(0x134)])({'ticket':_0x3a4144,'body':_0xb36aab});};switch(_0x1d55dc?.[_0x542848(0x144)]){case _0x542848(0x115):default:await _0x45d5b8();break;}};function a586_0x5235(){const _0x3ace96=['url','\x20iniciada\x20para\x20o\x20ticket\x20#','get','getIO','findByPk','emit','delete','userId','getTypeEditedMessage','\x20MiB','key','writable','../../libs/socket','ticket','from','Failed\x20to\x20get\x20stream','../WhatsappService/ShowWhatsAppService','*Mensagem\x20AutomÃ¡tica*:\x0aNosso\x20sistema\x20aceita\x20apenas\x20arquivos\x20com\x20no\x20mÃ¡ximo\x20','count','>>>>\x20erro\x20','../../models/CampaignShipping','\x20(has\x20','lodash','3900044fXEoYC','remoteJidAlt','../ContactServices/CreateOrUpdateContactService','participant','create','*Mensagem\x20do\x20sistema*:\x0aArquivo\x20recebido\x20alÃ©m\x20do\x20limite\x20de\x20tamanho\x20do\x20sistema,\x20se\x20for\x20necessÃ¡rio\x20ele\x20pode\x20ser\x20obtido\x20no\x20aplicativo\x20do\x20whatsapp.','stream-throttle','\x20other\x20tickets)','contact','ticketId','@whiskeysockets/baileys','ERR_WAPP_DOWNLOAD_MEDIA','ack','amountUsedBotQueues','keys','imageMessage','campaignId','./GetHandlers','-closed','indexOf','remoteJid','\x20jÃ¡\x20processada\x20para\x20o\x20ticket\x20','498458sjJjnR','error','status','join','isGroup','fileName','pending','image','body','queue-','logger','filename','../../models/User','[verifyMessage]\x20Deleted\x20duplicate\x20contact\x20','video','getTime','constructor','ERR_FILESIZE_OVER_LIMIT','extendedTextMessage','company-','stringify','verifyContact','__importDefault','../QueueIntegrationServices/ShowQueueIntegrationService','\x20de\x20baixar\x20o\x20arquivo\x20','documentMessage','getQuotedMessageId','verifyMessage','sequelize','[verifyMessage]\x20Contact\x20','25540032AXsMgA','includes','image/jpeg','./wbotMessageListener','data','profilePicUrl','thumbnail-','verifyEditedMessage','concat','FRONTEND_URL','-ticket','user','prototype','@sentry/node','campaignQueue','log','ratingAt','name','profilePictureUrl','queue','reactionMessage','writeFile','mimetype','document','message','destroy','hasOwnProperty','/nopicture.png','downloadLimit','conversation','parseToMilliseconds','apply','@s.whatsapp.net','../../utils/logger','../../models/Contact','map','getMessageMedia','mkdir','Throttle','(((.+)+)+)+$','replace','verifyMediaMessage','[verifyMessage]\x20Keeping\x20contact\x20','mediaType','env','caption','base64','-appMessage','verifyRating','text','pipe','__importStar','defineProperty','companyId','search','greetingMessage','substring','update','audio','getUnpackedMessage','split','makeRandomId','transferMessage','IntegraÃ§Ã£o\x20#','ConfiguraÃ§Ãµes\x20do\x20WhatsApp\x20nÃ£o\x20encontradas.','Mensagem\x20','closed','941990KtKPhd','integrationId','moment','__esModule','64122KSrknV','getBodyMessage','./SendWhatsAppMessage','getPublicPath','normalizeThumbnailMediaType','../../models/Setting','number','options','media/','default','downloadContentFromMessage','\x20already\x20up\x20to\x20date','captureException','util','quotedMsgId','dataJson','normalizeMediaType','reload','promisify','fileLength','queueId','rate','ðŸ“Ž\x20','lastProcessedMessageId','finishedAt','value','lid','3997464mAJDiZ','../../models/Message','verifyQueue','getOwnPropertyNames','handleMessageIntegration','thumbnail-link','754210NIfXbe','useIntegration','verifyRecentCampaign','fromMe','.\x20Ignorando\x20em\x20verifyQueue.','documentWithCaptionMessage','maxUseBotQueues','warn','getPhoneNumberFromJid','../../models/Whatsapp','promises','@lid','setExtra','displayCurrentMenu','../../helpers/CheckSettings','.jpg','length','../../helpers/MakeRandomId','configurable','toString','verifyDeleteMessage','slice','path','findOne'];a586_0x5235=function(){return _0x3ace96;};return a586_0x5235();}exports[a586_0x11fa63(0x148)]=verifyQueue;const verifyRating=_0xe82a85=>{const _0x2609ba=a586_0x11fa63;if(_0xe82a85&&_0xe82a85[_0x2609ba(0x143)]===null&&_0xe82a85[_0x2609ba(0xa0)]!==null&&_0xe82a85[_0x2609ba(0xf4)]!==null)return!![];return![];};exports[a586_0x11fa63(0x114)]=verifyRating;const verifyRecentCampaign=async(_0x144cf1,_0x55f383)=>{const _0x4e1dfd=a586_0x11fa63;if(!_0x144cf1[_0x4e1dfd(0xa3)]['fromMe']){const _0x52ac18=(0x0,ExtractPhoneNumber_1[_0x4e1dfd(0x89)])(_0x144cf1['key']['remoteJid']),_0x59ad7a=await Campaign_1['default']['findAll']({'where':{'companyId':_0x55f383,'status':'EM_ANDAMENTO','confirmation':!![]}});if(_0x59ad7a){const _0x3ad421=_0x59ad7a[_0x4e1dfd(0x107)](_0x14c0f9=>_0x14c0f9['id']),_0x251451=await CampaignShipping_1[_0x4e1dfd(0x134)][_0x4e1dfd(0x98)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x3ad421},'number':_0x52ac18,'confirmation':null}});if(_0x251451)return await _0x251451['update']({'confirmedAt':(0x0,moment_1['default'])(),'confirmation':!![]}),await queues_1[_0x4e1dfd(0xf2)]['add']('DispatchConfirmedCampaign',{'campaignShippingId':_0x251451['id'],'campaignId':_0x251451[_0x4e1dfd(0xc0)]},{'delay':(0x0,queues_1[_0x4e1dfd(0x102)])((0x0,queues_1['randomValue'])(0x0,0xa))}),!![];}}return![];};exports[a586_0x11fa63(0x83)]=verifyRecentCampaign;