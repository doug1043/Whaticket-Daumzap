'use strict';const a581_0x185621=a581_0x5eaf;(function(_0x171b92,_0x2110af){const _0x45dac9=a581_0x5eaf,_0x26bcd2=_0x171b92();while(!![]){try{const _0x340172=parseInt(_0x45dac9(0xae))/0x1*(-parseInt(_0x45dac9(0xfd))/0x2)+-parseInt(_0x45dac9(0x81))/0x3+parseInt(_0x45dac9(0x108))/0x4+-parseInt(_0x45dac9(0xf6))/0x5*(-parseInt(_0x45dac9(0x104))/0x6)+parseInt(_0x45dac9(0xa0))/0x7+-parseInt(_0x45dac9(0xab))/0x8+parseInt(_0x45dac9(0x97))/0x9*(parseInt(_0x45dac9(0xf9))/0xa);if(_0x340172===_0x2110af)break;else _0x26bcd2['push'](_0x26bcd2['shift']());}catch(_0x2455a2){_0x26bcd2['push'](_0x26bcd2['shift']());}}}(a581_0x2c9a,0xed384));var __createBinding=this&&this[a581_0x185621(0x93)]||(Object[a581_0x185621(0x7e)]?function(_0x32b19d,_0x1e1bea,_0x3fcbe6,_0x402420){const _0x3566c4=a581_0x185621;if(_0x402420===undefined)_0x402420=_0x3fcbe6;var _0x580543=Object[_0x3566c4(0x7b)](_0x1e1bea,_0x3fcbe6);(!_0x580543||(_0x3566c4(0xd5)in _0x580543?!_0x1e1bea['__esModule']:_0x580543[_0x3566c4(0x9a)]||_0x580543[_0x3566c4(0x120)]))&&(_0x580543={'enumerable':!![],'get':function(){return _0x1e1bea[_0x3fcbe6];}}),Object[_0x3566c4(0x103)](_0x32b19d,_0x402420,_0x580543);}:function(_0x2a0bcf,_0x13205c,_0x1e6d0a,_0x3eb727){if(_0x3eb727===undefined)_0x3eb727=_0x1e6d0a;_0x2a0bcf[_0x3eb727]=_0x13205c[_0x1e6d0a];}),__setModuleDefault=this&&this[a581_0x185621(0xf1)]||(Object[a581_0x185621(0x7e)]?function(_0x9f56f3,_0x1037f7){const _0x5a1934=a581_0x185621;Object[_0x5a1934(0x103)](_0x9f56f3,_0x5a1934(0xba),{'enumerable':!![],'value':_0x1037f7});}:function(_0x23ec0d,_0x4e376d){_0x23ec0d['default']=_0x4e376d;}),__importStar=this&&this[a581_0x185621(0xb5)]||(function(){const _0x1cdc6f=(function(){let _0x2b146d=!![];return function(_0x4c64ae,_0x35a467){const _0x5e66ea=_0x2b146d?function(){const _0x40edbc=a581_0x5eaf;if(_0x35a467){const _0x4f5f9a=_0x35a467[_0x40edbc(0xe1)](_0x4c64ae,arguments);return _0x35a467=null,_0x4f5f9a;}}:function(){};return _0x2b146d=![],_0x5e66ea;};}()),_0x43c0ae=_0x1cdc6f(this,function(){const _0x4f7efd=a581_0x5eaf;return _0x43c0ae[_0x4f7efd(0xef)]()[_0x4f7efd(0x102)](_0x4f7efd(0xbf))[_0x4f7efd(0xef)]()[_0x4f7efd(0xd8)](_0x43c0ae)[_0x4f7efd(0x102)]('(((.+)+)+)+$');});_0x43c0ae();var _0x48c11f=function(_0x56547f){const _0xc932db=a581_0x5eaf;return _0x48c11f=Object[_0xc932db(0xde)]||function(_0x1b6209){const _0x1d6bde=_0xc932db;var _0xf4082e=[];for(var _0x47ba37 in _0x1b6209)if(Object[_0x1d6bde(0x78)][_0x1d6bde(0x12a)]['call'](_0x1b6209,_0x47ba37))_0xf4082e[_0xf4082e[_0x1d6bde(0xdd)]]=_0x47ba37;return _0xf4082e;},_0x48c11f(_0x56547f);};return function(_0x5666d5){const _0x417005=a581_0x5eaf;if(_0x5666d5&&_0x5666d5[_0x417005(0x10a)])return _0x5666d5;var _0x272034={};if(_0x5666d5!=null){for(var _0x339a94=_0x48c11f(_0x5666d5),_0x39a44b=0x0;_0x39a44b<_0x339a94[_0x417005(0xdd)];_0x39a44b++)if(_0x339a94[_0x39a44b]!=='default')__createBinding(_0x272034,_0x5666d5,_0x339a94[_0x39a44b]);}return __setModuleDefault(_0x272034,_0x5666d5),_0x272034;};}()),__importDefault=this&&this[a581_0x185621(0x99)]||function(_0x451b35){return _0x451b35&&_0x451b35['__esModule']?_0x451b35:{'default':_0x451b35};};Object[a581_0x185621(0x103)](exports,'__esModule',{'value':!![]}),exports[a581_0x185621(0xbe)]=exports[a581_0x185621(0x6b)]=exports[a581_0x185621(0xe7)]=exports['verifyDeleteMessage']=exports['verifyEditedMessage']=exports['verifyMediaMessage']=exports[a581_0x185621(0xfa)]=exports[a581_0x185621(0x11b)]=exports[a581_0x185621(0xcd)]=exports[a581_0x185621(0x118)]=void 0x0;const Message_1=__importDefault(require(a581_0x185621(0xc1))),Ticket_1=__importDefault(require(a581_0x185621(0xec))),Contact_1=__importDefault(require('../../models/Contact')),socket_1=require(a581_0x185621(0x123)),baileys_1=require(a581_0x185621(0xb1)),CreateMessageService_1=__importDefault(require(a581_0x185621(0x11a))),GetHandlers_1=require(a581_0x185621(0xbc)),Queue_1=__importDefault(require(a581_0x185621(0xce))),User_1=__importDefault(require(a581_0x185621(0x128))),Sentry=__importStar(require(a581_0x185621(0xc6))),CreateOrUpdateContactService_1=__importDefault(require(a581_0x185621(0x82))),stream_throttle_1=require(a581_0x185621(0x7a)),MakeRandomId_1=require(a581_0x185621(0x6c)),CheckSettings_1=__importDefault(require('../../helpers/CheckSettings')),GetHandlers_2=require(a581_0x185621(0xbc)),GetPublicPath_1=require(a581_0x185621(0x116)),logger_1=require(a581_0x185621(0xd2)),util_1=require(a581_0x185621(0xfe)),fs_1=__importStar(require('fs')),path_1=require(a581_0x185621(0xa8)),OldMessage_1=__importDefault(require(a581_0x185621(0xda))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),lodash_1=require(a581_0x185621(0x92)),ShowQueueIntegrationService_1=__importDefault(require(a581_0x185621(0xd9))),wbotMessageListener_1=require(a581_0x185621(0xe9)),Setting_1=__importDefault(require(a581_0x185621(0xcb))),Campaign_1=__importDefault(require(a581_0x185621(0x74))),CampaignShipping_1=__importDefault(require(a581_0x185621(0x129))),moment_1=__importDefault(require('moment')),queues_1=require(a581_0x185621(0x87)),sequelize_1=require(a581_0x185621(0x91)),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),Whatsapp_1=__importDefault(require(a581_0x185621(0x85))),writeFileAsync=(0x0,util_1[a581_0x185621(0x9f)])(fs_1[a581_0x185621(0xea)]),saveMediaToFile=async(_0x5d4fc2,_0x477338)=>{const _0x18b091=a581_0x185621;if(!_0x5d4fc2['filename']){const _0x11229=_0x5d4fc2[_0x18b091(0x80)]['split']('/')[0x1][_0x18b091(0xd3)](';')[0x0];_0x5d4fc2[_0x18b091(0xa1)]=new Date()['getTime']()+'.'+_0x11229;}const _0x3b2e7e=(0x0,GetPublicPath_1['getPublicPath'])(),_0x3eee1=(0x0,MakeRandomId_1[_0x18b091(0x110)])(0xa),_0x568471=_0x18b091(0xb0)+_0x477338['companyId']+'/'+_0x477338[_0x18b091(0xd1)]+'/'+_0x477338['id']+'/'+_0x3eee1;try{await fs_1[_0x18b091(0xba)][_0x18b091(0x88)]['mkdir']((0x0,path_1['join'])(_0x3b2e7e,_0x568471),{'recursive':!![]}),await writeFileAsync((0x0,path_1[_0x18b091(0x117)])(_0x3b2e7e,_0x568471,_0x5d4fc2[_0x18b091(0xa1)]),_0x5d4fc2[_0x18b091(0x10b)],_0x18b091(0x9b));}catch(_0x1ec9b2){Sentry['captureException'](_0x1ec9b2),logger_1[_0x18b091(0x90)][_0x18b091(0xfb)](_0x1ec9b2);}return _0x568471+'/'+_0x5d4fc2['filename'];},normalizeMediaType=_0x694ed=>{const _0x535165=a581_0x185621,_0x54fc4a=['audio','video',_0x535165(0xa5),_0x535165(0x73)],_0x38c9e3=_0x694ed[_0x535165(0xd3)]('/')[0x0];if(!_0x54fc4a['includes'](_0x38c9e3))return'document';return _0x38c9e3;};exports['normalizeMediaType']=normalizeMediaType;function a581_0x2c9a(){const _0x553155=['chatbot','rate','\x20de\x20baixar\x20o\x20arquivo\x20','image','getTime','status','path','whatsappId','participant','15175416BoiHik','log','extendedTextMessage','213133GoeomJ','map','media/','@whiskeysockets/baileys','imageMessage','*Mensagem\x20AutomÃ¡tica*:\x0aNosso\x20sistema\x20aceita\x20apenas\x20arquivos\x20com\x20no\x20mÃ¡ximo\x20','campaignQueue','__importStar','verifyMediaMessage','thumbnail-document','verifyDeleteMessage','finishedAt','default','displayCurrentMenu','./GetHandlers','ticket','verifyRecentCampaign','(((.+)+)+)+$','substring','../../models/Message','*Mensagem\x20do\x20sistema*:\x0aArquivo\x20recebido\x20alÃ©m\x20do\x20limite\x20de\x20tamanho\x20do\x20sistema,\x20se\x20for\x20necessÃ¡rio\x20ele\x20pode\x20ser\x20obtido\x20no\x20aplicativo\x20do\x20whatsapp.','ERR_WAPP_DOWNLOAD_MEDIA','DispatchConfirmedCampaign','update','@sentry/node','name','integrationId','getIO','upsert','../../models/Setting','setExtra','normalizeThumbnailMediaType','../../models/Queue','Mensagem\x20','ratingAt','contactId','../../utils/logger','split','isGroup','get','company-','remoteJid','constructor','../QueueIntegrationServices/ShowQueueIntegrationService','../../models/OldMessage','add','dataJson','length','getOwnPropertyNames','queue','IntegraÃ§Ã£o\x20#','apply','/nopicture.png','captureException','delete','fileLength','queueId','verifyQueue','EM_ANDAMENTO','./wbotMessageListener','writeFile','reload','../../models/Ticket','amountUsedBotQueues','greetingMessage','toString','downloadContentFromMessage','__setModuleDefault','includes','companyId','Failed\x20to\x20get\x20stream','message','5MokKAd','Erro\x20ao\x20processar\x20integraÃ§Ã£o\x20para\x20fila\x20Ãºnica:','concat','12580pjUzbA','verifyContact','error','transferMessage','14vpGpXn','util','value','profilePictureUrl','verifyEditedMessage','search','defineProperty','10703058Zosttc','conversation','fromMe','maxUseBotQueues','2126972SFWYjx','fileName','__esModule','data','thumbnail-link','text','thumbnail-video','userId','makeRandomId','getTypeEditedMessage','ticketId','quotedMsgId','ERR_FILESIZE_OVER_LIMIT','queue-','../../helpers/GetPublicPath','join','normalizeMediaType','closed','../MessageServices/CreateMessageService','verifyMessage','g.us','findOne','user','-closed','configurable','stringify','-ticket','../../libs/socket','slice','contact','FRONTEND_URL','replace','../../models/User','../../models/CampaignShipping','hasOwnProperty','read','verifyRating','../../helpers/MakeRandomId','lastProcessedMessageId','getBodyMessage','>>>>\x20erro\x20','pipe','\x20iniciada\x20para\x20o\x20ticket\x20#','useIntegration','document','../../models/Campaign','ðŸ“Ž\x20','pending','handleMessageIntegration','prototype','*\x20-\x20','stream-throttle','getOwnPropertyDescriptor','chatBotType','reactionMessage','create','thumbnail-','mimetype','1945140tVmGKs','../ContactServices/CreateOrUpdateContactService','documentMessage','emit','../../models/Whatsapp','warn','../../queues','promises','options','\x20jÃ¡\x20processada\x20para\x20o\x20ticket\x20','parseToMilliseconds','caption','getUnpackedMessage','body','forEach','logger','sequelize','lodash','__createBinding','notification','\x20MiB','documentWithCaptionMessage','15021pmTqqy','thumbnail-image','__importDefault','writable','base64','findByPk','key','ConfiguraÃ§Ãµes\x20do\x20WhatsApp\x20nÃ£o\x20encontradas.','promisify','4155914oZmRBo','filename'];a581_0x2c9a=function(){return _0x553155;};return a581_0x2c9a();}function a581_0x5eaf(_0x35f998,_0x3358f9){const _0x111343=a581_0x2c9a();return a581_0x5eaf=function(_0x16d6ec,_0x31eb9c){_0x16d6ec=_0x16d6ec-0x6b;let _0x2c9aa4=_0x111343[_0x16d6ec];return _0x2c9aa4;},a581_0x5eaf(_0x35f998,_0x3358f9);}const normalizeThumbnailMediaType=_0x3bcb10=>{const _0x11f405=a581_0x185621,_0x5179c5=[_0x11f405(0x10e),_0x11f405(0x98),'thumbnail-document'],_0x34fa2b=_0x3bcb10[_0x11f405(0xd3)]('/')[0x0];if(!_0x5179c5['includes'](_0x11f405(0x7f)+_0x34fa2b))return _0x11f405(0xb7);return _0x34fa2b;};exports[a581_0x185621(0xcd)]=normalizeThumbnailMediaType;const downloadMedia=async(_0x257e52,_0x5c4ab7,_0xf69a51)=>{const _0x227fb8=a581_0x185621,_0x301afe=(0x0,GetHandlers_2[_0x227fb8(0x8d)])(_0x257e52),_0xc4e3b4=(0x0,GetHandlers_2['getMessageMedia'])(_0x301afe);if(!_0xc4e3b4)return null;const _0x2d05dd=parseInt(await(0x0,CheckSettings_1[_0x227fb8(0xba)])('downloadLimit','15'),0xa);if(_0x5c4ab7&&_0xc4e3b4?.[_0x227fb8(0xe5)]&&+_0xc4e3b4[_0x227fb8(0xe5)]>_0x2d05dd*0x400*0x400){const _0x3ef22f=_0x227fb8(0xb3)+_0x2d05dd+_0x227fb8(0x95);if(!_0xf69a51[_0x227fb8(0xd4)]){const _0x1c193f=await(0x0,SendWhatsAppMessage_1[_0x227fb8(0xba)])({'ticket':_0xf69a51,'body':_0x3ef22f});_0x1c193f[_0x227fb8(0xf5)][_0x227fb8(0xad)]['text']=_0x227fb8(0xc2);}throw new Error(_0x227fb8(0x114));}const _0x458165=_0x301afe?.['documentMessage']?_0x227fb8(0x73):(0x0,exports[_0x227fb8(0x118)])(_0xc4e3b4[_0x227fb8(0x80)]);let _0x29fecf,_0x5400d7=0x0;while(_0x5400d7<0xa&&!_0x29fecf){try{const _0x4e02af={..._0xc4e3b4};_0x4e02af?.['directPath']&&(_0x4e02af['url']=''),_0x29fecf=await(0x0,baileys_1[_0x227fb8(0xf0)])(_0x4e02af,_0x458165);}catch(_0x3d8ef9){_0x5400d7+=0x1,await new Promise(_0xf09c5f=>{setTimeout(_0xf09c5f,0x3e8*_0x5400d7*0x2);}),logger_1[_0x227fb8(0x90)][_0x227fb8(0x86)](_0x227fb8(0x6f)+_0x5400d7+_0x227fb8(0xa4)+_0x257e52?.['key']?.['id']);}}if(!_0x29fecf)throw new Error('Failed\x20to\x20get\x20stream');const _0x5e862e=await downloadStream(_0x29fecf);if(!_0x5e862e){Sentry[_0x227fb8(0xcc)](_0x227fb8(0xc3),{'msg':_0x257e52}),Sentry[_0x227fb8(0xe3)](new Error('ERR_WAPP_DOWNLOAD_MEDIA'));throw new Error(_0x227fb8(0xc3));}let _0x2bec19=_0x301afe?.[_0x227fb8(0x83)]?.[_0x227fb8(0x109)]||'';if(!_0x2bec19){const _0x3b2024=_0xc4e3b4['mimetype'][_0x227fb8(0xd3)]('/')[0x1][_0x227fb8(0xd3)](';')[0x0];_0x2bec19=(0x0,MakeRandomId_1[_0x227fb8(0x110)])(0x5)+'-'+new Date()[_0x227fb8(0xa6)]()+'.'+_0x3b2024;}else _0x2bec19=_0x2bec19[_0x227fb8(0xd3)]('.')[_0x227fb8(0x124)](0x0,-0x1)[_0x227fb8(0x117)]('.')+'.'+(0x0,MakeRandomId_1[_0x227fb8(0x110)])(0x5)+'.'+_0x2bec19[_0x227fb8(0xd3)]('.')[_0x227fb8(0x124)](-0x1);const _0x40d02f={'data':_0x5e862e,'mimetype':_0xc4e3b4[_0x227fb8(0x80)],'filename':_0x2bec19};return _0x40d02f;},downloadStream=async _0x35b662=>{const _0x4521b3=a581_0x185621,_0x2b9b9e=0x5*0x400*0x400/0x8,_0x183b26=0x400*0x400/0x8,_0x5dd42e=0x400*0x400,_0x1448ff=new stream_throttle_1['Throttle']({'rate':_0x2b9b9e});let _0x10d313=Buffer['from']([]),_0x442e14=0x0;try{for await(const _0x5b7f1b of _0x35b662[_0x4521b3(0x70)](_0x1448ff)){_0x10d313=Buffer[_0x4521b3(0xf8)]([_0x10d313,_0x5b7f1b]),_0x442e14+=_0x5b7f1b[_0x4521b3(0xdd)],_0x442e14>_0x5dd42e&&(_0x1448ff[_0x4521b3(0xa3)]=_0x183b26);}}catch(_0x52dd9e){Sentry[_0x4521b3(0xcc)](_0x4521b3(0xc3),{'error':_0x52dd9e}),Sentry[_0x4521b3(0xe3)](new Error(_0x4521b3(0xc3)));throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');}return _0x10d313;},downloadThumbnail=async({thumbnailDirectPath:_0x3dcd95,mediaKey:_0x4ef82d,mimetype:_0x1ffd13})=>{const _0x4a15a3=a581_0x185621;if(!_0x3dcd95||!_0x4ef82d)return null;const _0x1950f4=await(0x0,baileys_1[_0x4a15a3(0xf0)])({'mediaKey':_0x4ef82d,'directPath':_0x3dcd95},_0x1ffd13?(0x0,exports[_0x4a15a3(0xcd)])(_0x1ffd13):_0x4a15a3(0x10c));if(!_0x1950f4)throw new Error(_0x4a15a3(0xf4));const _0x34c712=await downloadStream(_0x1950f4);if(!_0x34c712)throw new Error(_0x4a15a3(0xc3));const _0xe7da0e=_0x4a15a3(0x7f)+(0x0,MakeRandomId_1[_0x4a15a3(0x110)])(0x5)+'-'+new Date()['getTime']()+'.jpg',_0x5e8457={'data':_0x34c712,'mimetype':'image/jpeg','filename':_0xe7da0e};return _0x5e8457;},verifyMessage=async(_0x35b49c,_0x110a79,_0x36b4a5,_0x2637f8=null)=>{const _0x25809f=a581_0x185621,_0x5686cb=(0x0,socket_1[_0x25809f(0xc9)])(),_0x3496cb=await verifyQuotedMessage(_0x35b49c),_0x15552a=(0x0,GetHandlers_1[_0x25809f(0x6e)])(_0x35b49c),_0x5d67d5={'id':_0x35b49c[_0x25809f(0x9d)]['id'],'ticketId':_0x110a79['id'],'userId':_0x2637f8,'contactId':_0x35b49c[_0x25809f(0x9d)][_0x25809f(0x106)]?undefined:_0x36b4a5['id'],'body':_0x15552a,'fromMe':_0x35b49c[_0x25809f(0x9d)][_0x25809f(0x106)],'mediaType':_0x35b49c[_0x25809f(0xf5)]['reactionMessage']?_0x25809f(0x7d):null,'read':_0x35b49c['key'][_0x25809f(0x106)],'quotedMsgId':_0x3496cb?.['id'],'ack':_0x35b49c['status'],'remoteJid':_0x35b49c[_0x25809f(0x9d)][_0x25809f(0xd7)],'participant':_0x35b49c['key'][_0x25809f(0xaa)],'dataJson':JSON['stringify'](_0x35b49c),'isEdited':![]};await _0x110a79[_0x25809f(0xc5)]({'lastMessage':_0x15552a[_0x25809f(0xc0)](0x0,0xff)[_0x25809f(0x127)](/\n/g,'\x20')});const _0x457324=await(0x0,CreateMessageService_1[_0x25809f(0xba)])({'messageData':_0x5d67d5,'companyId':_0x110a79[_0x25809f(0xf3)]});return!_0x35b49c[_0x25809f(0x9d)][_0x25809f(0x106)]&&_0x110a79[_0x25809f(0xa7)]===_0x25809f(0x119)&&(await _0x110a79[_0x25809f(0xc5)]({'status':_0x25809f(0x76)}),await _0x110a79['reload']({'include':[{'model':Queue_1[_0x25809f(0xba)],'as':_0x25809f(0xdf)},{'model':User_1[_0x25809f(0xba)],'as':_0x25809f(0x11e)},{'model':Contact_1['default'],'as':_0x25809f(0x125)}]}),_0x5686cb['to'](_0x25809f(0xd6)+_0x110a79[_0x25809f(0xf3)]+_0x25809f(0x11f))['to'](_0x25809f(0x115)+_0x110a79[_0x25809f(0xe6)]+_0x25809f(0x11f))[_0x25809f(0x84)]('company-'+_0x110a79[_0x25809f(0xf3)]+'-ticket',{'action':_0x25809f(0xe4),'ticket':_0x110a79,'ticketId':_0x110a79['id']}),_0x5686cb['to'](_0x25809f(0xd6)+_0x110a79[_0x25809f(0xf3)]+'-'+_0x110a79['status'])['to']('queue-'+_0x110a79[_0x25809f(0xe6)]+'-'+_0x110a79[_0x25809f(0xa7)])['to'](_0x110a79['id']['toString']())[_0x25809f(0x84)](_0x25809f(0xd6)+_0x110a79[_0x25809f(0xf3)]+_0x25809f(0x122),{'action':_0x25809f(0xc5),'ticket':_0x110a79,'ticketId':_0x110a79['id']})),_0x457324;};exports[a581_0x185621(0x11b)]=verifyMessage;const verifyQuotedMessage=async _0x326273=>{const _0x59bc0e=a581_0x185621;if(!_0x326273)return null;const _0x5cd6f5=(0x0,GetHandlers_1['getQuotedMessageId'])(_0x326273);if(!_0x5cd6f5)return null;const _0xec8489=await Message_1['default'][_0x59bc0e(0x11d)]({'where':{'id':_0x5cd6f5}});if(!_0xec8489)return null;return _0xec8489;},verifyContact=async(_0x496775,_0x242fe1,_0x471d8c)=>{const _0x1cd036=a581_0x185621;let _0x1cfbaa;try{_0x1cfbaa=await _0x242fe1[_0x1cd036(0x100)](_0x496775['id']);}catch(_0x1e7140){Sentry['captureException'](_0x1e7140),_0x1cfbaa=process['env'][_0x1cd036(0x126)]+_0x1cd036(0xe2);}const _0x49fed3={'name':_0x496775?.[_0x1cd036(0xc7)]||_0x496775['id'][_0x1cd036(0x127)](/\D/g,''),'number':_0x496775['id']['substring'](0x0,_0x496775['id']['indexOf']('@')),'profilePicUrl':_0x1cfbaa,'isGroup':_0x496775['id'][_0x1cd036(0xf2)](_0x1cd036(0x11c)),'companyId':_0x471d8c},_0x1d6e26=(0x0,CreateOrUpdateContactService_1[_0x1cd036(0xba)])(_0x49fed3);return _0x1d6e26;};exports[a581_0x185621(0xfa)]=verifyContact;const verifyMediaMessage=async(_0x43f350,_0x553411,_0xdf5daf,_0x587899=null,_0x34747f=null,_0x2ec9d4=null)=>{const _0x3b73ed=a581_0x185621,_0x202570=(0x0,socket_1[_0x3b73ed(0xc9)])(),_0x22bbe4=await verifyQuotedMessage(_0x43f350),_0x46a2b6=_0x34747f||_0x43f350?.[_0x3b73ed(0xf5)]?.[_0x3b73ed(0xad)],_0xe1a603=_0x46a2b6&&await downloadThumbnail(_0x46a2b6),_0x48c0b3=await downloadMedia(_0x43f350,_0x587899,_0x553411);if(!_0x48c0b3&&!_0xe1a603)throw new Error(_0x3b73ed(0xc3));let _0x57681e=null;_0x48c0b3&&(_0x57681e=await saveMediaToFile(_0x48c0b3,_0x553411));let _0xf69134=null;_0xe1a603&&(_0xf69134=await saveMediaToFile(_0xe1a603,_0x553411));const _0x722615=(0x0,GetHandlers_1[_0x3b73ed(0x6e)])(_0x43f350),_0x26624f={'id':_0x43f350['key']['id'],'ticketId':_0x553411['id'],'userId':_0x2ec9d4,'contactId':_0x43f350[_0x3b73ed(0x9d)][_0x3b73ed(0x106)]?undefined:_0xdf5daf['id'],'body':_0x722615||'','fromMe':_0x43f350['key'][_0x3b73ed(0x106)],'read':_0x43f350[_0x3b73ed(0x9d)][_0x3b73ed(0x106)],'mediaUrl':_0x57681e,'mediaType':_0x48c0b3?.['mimetype'][_0x3b73ed(0xd3)]('/')[0x0],'thumbnailUrl':_0xf69134,'quotedMsgId':_0x22bbe4?.['id'],'ack':_0x43f350[_0x3b73ed(0xa7)],'remoteJid':_0x43f350[_0x3b73ed(0x9d)][_0x3b73ed(0xd7)],'participant':_0x43f350[_0x3b73ed(0x9d)][_0x3b73ed(0xaa)],'dataJson':JSON[_0x3b73ed(0x121)](_0x43f350)};await _0x553411[_0x3b73ed(0xc5)]({'lastMessage':_0x722615||_0x48c0b3?.[_0x3b73ed(0xa1)]?_0x3b73ed(0x75)+_0x48c0b3?.[_0x3b73ed(0xa1)]:''});const _0x5be4fb=await(0x0,CreateMessageService_1[_0x3b73ed(0xba)])({'messageData':_0x26624f,'companyId':_0x553411[_0x3b73ed(0xf3)]});return!_0x43f350[_0x3b73ed(0x9d)][_0x3b73ed(0x106)]&&_0x553411[_0x3b73ed(0xa7)]===_0x3b73ed(0x119)&&(await _0x553411[_0x3b73ed(0xc5)]({'status':_0x3b73ed(0x76)}),await _0x553411[_0x3b73ed(0xeb)]({'include':[{'model':Queue_1['default'],'as':_0x3b73ed(0xdf)},{'model':User_1[_0x3b73ed(0xba)],'as':'user'},{'model':Contact_1['default'],'as':_0x3b73ed(0x125)}]}),_0x202570['to'](_0x3b73ed(0xd6)+_0x553411[_0x3b73ed(0xf3)]+'-closed')['to']('queue-'+_0x553411[_0x3b73ed(0xe6)]+_0x3b73ed(0x11f))[_0x3b73ed(0x84)](_0x3b73ed(0xd6)+_0x553411[_0x3b73ed(0xf3)]+_0x3b73ed(0x122),{'action':'delete','ticket':_0x553411,'ticketId':_0x553411['id']}),_0x202570['to'](_0x3b73ed(0xd6)+_0x553411[_0x3b73ed(0xf3)]+'-'+_0x553411[_0x3b73ed(0xa7)])['to'](_0x3b73ed(0x115)+_0x553411[_0x3b73ed(0xe6)]+'-'+_0x553411[_0x3b73ed(0xa7)])['to'](_0x553411['id']['toString']())[_0x3b73ed(0x84)]('company-'+_0x553411[_0x3b73ed(0xf3)]+_0x3b73ed(0x122),{'action':_0x3b73ed(0xc5),'ticket':_0x553411,'ticketId':_0x553411['id']})),_0x5be4fb;};exports[a581_0x185621(0xb6)]=verifyMediaMessage;const verifyEditedMessage=async(_0x42f61f,_0xaa2244,_0x43e37a)=>{const _0x57ba1c=a581_0x185621,_0x32663e=(0x0,GetHandlers_2[_0x57ba1c(0x111)])(_0x42f61f);let _0x29f76d;switch(_0x32663e){case _0x57ba1c(0x105):{_0x29f76d=_0x42f61f[_0x57ba1c(0x105)];break;}case _0x57ba1c(0xad):{_0x29f76d=_0x42f61f['extendedTextMessage'][_0x57ba1c(0x10d)];break;}case'imageMessage':{_0x29f76d=_0x42f61f[_0x57ba1c(0xb2)][_0x57ba1c(0x8c)];break;}case _0x57ba1c(0x83):{_0x29f76d=_0x42f61f[_0x57ba1c(0x83)][_0x57ba1c(0x8c)];break;}case _0x57ba1c(0x96):{_0x29f76d=_0x42f61f[_0x57ba1c(0x96)][_0x57ba1c(0xf5)][_0x57ba1c(0x83)][_0x57ba1c(0x8c)];break;}default:{return;}}const _0x4f8279=await Message_1[_0x57ba1c(0xba)][_0x57ba1c(0x9c)](_0x43e37a),_0x3b7160={'id':_0x4f8279['id'],'ticketId':_0x4f8279[_0x57ba1c(0x112)],'contactId':_0x4f8279[_0x57ba1c(0xd1)],'body':_0x29f76d,'fromMe':_0x4f8279['fromMe'],'mediaType':_0x4f8279['mediaType'],'read':_0x4f8279[_0x57ba1c(0x12b)],'quotedMsgId':_0x4f8279[_0x57ba1c(0x113)],'ack':_0x4f8279['ack'],'remoteJid':_0x4f8279[_0x57ba1c(0xd7)],'participant':_0x4f8279['participant'],'dataJson':_0x4f8279[_0x57ba1c(0xdc)],'isEdited':!![]},_0x2c2bc7={'messageId':_0x3b7160['id'],'body':_0x4f8279[_0x57ba1c(0x8e)],'ticketId':_0x4f8279[_0x57ba1c(0x112)]};await OldMessage_1['default'][_0x57ba1c(0xca)](_0x2c2bc7),await _0xaa2244[_0x57ba1c(0xc5)]({'lastMessage':_0x3b7160['body']}),await(0x0,CreateMessageService_1[_0x57ba1c(0xba)])({'messageData':_0x3b7160,'companyId':_0xaa2244[_0x57ba1c(0xf3)]});const _0x4ab8ef=(0x0,socket_1[_0x57ba1c(0xc9)])();_0x4ab8ef['to'](_0xaa2244[_0x57ba1c(0xa7)])['to'](_0xaa2244['id'][_0x57ba1c(0xef)]())[_0x57ba1c(0x84)](_0x57ba1c(0xd6)+_0xaa2244['companyId']+_0x57ba1c(0x122),{'action':_0x57ba1c(0xc5),'ticket':_0xaa2244,'ticketId':_0xaa2244['id']});};exports[a581_0x185621(0x101)]=verifyEditedMessage;const verifyDeleteMessage=async(_0x130db4,_0x393d72)=>{const _0x1045cb=a581_0x185621,_0x1c9233=await Message_1[_0x1045cb(0xba)][_0x1045cb(0x9c)](_0x130db4[_0x1045cb(0x9d)]['id'],{'include':[_0x1045cb(0x125),{'model':Ticket_1[_0x1045cb(0xba)],'include':[{'model':Contact_1[_0x1045cb(0xba)]}]}]});if(!_0x1c9233)return;await _0x1c9233[_0x1045cb(0xc5)]({'isDeleted':!![]});const _0x4a4d0b=(0x0,socket_1['getIO'])();_0x4a4d0b['to'](_0x1c9233[_0x1045cb(0x112)]['toString']())['to'](_0x1c9233[_0x1045cb(0xbd)][_0x1045cb(0xa7)])['to'](_0x1045cb(0x94))['emit']('company-'+_0x393d72['companyId']+'-appMessage',{'action':'create','message':_0x1c9233,'ticket':_0x1c9233['ticket'],'contact':_0x1c9233[_0x1045cb(0xbd)][_0x1045cb(0x125)]});};exports[a581_0x185621(0xb8)]=verifyDeleteMessage;const verifyQueue=async(_0x225d8a,_0x199fa0,_0x2a1c37,_0x1d9455)=>{const _0x3b3fc9=a581_0x185621;if(_0x199fa0?.[_0x3b3fc9(0x9d)]['id']&&_0x2a1c37[_0x3b3fc9(0x6d)]===_0x199fa0[_0x3b3fc9(0x9d)]['id']){console[_0x3b3fc9(0xac)](_0x3b3fc9(0xcf)+_0x199fa0[_0x3b3fc9(0x9d)]['id']+_0x3b3fc9(0x8a)+_0x2a1c37['id']+'.\x20Ignorando\x20em\x20verifyQueue.');return;}_0x199fa0?.[_0x3b3fc9(0x9d)]['id']&&await _0x2a1c37[_0x3b3fc9(0xc5)]({'lastProcessedMessageId':_0x199fa0[_0x3b3fc9(0x9d)]['id']});const _0x1c7257=await(0x0,ShowWhatsAppService_1['default'])(_0x225d8a['id'],_0x2a1c37['companyId']),{queues:_0x244345,greetingMessage:_0x5bad29}=_0x1c7257,_0x173d0b=await Setting_1[_0x3b3fc9(0xba)]['findOne']({'where':{'key':_0x3b3fc9(0x7c),'companyId':_0x2a1c37[_0x3b3fc9(0xf3)]}});if(_0x244345[_0x3b3fc9(0xdd)]===0x1){const _0x172441=(0x0,lodash_1['head'])(_0x244345);if(!_0x172441)return;const _0x4e9240=_0x172441?.['options']?.['length']>0x0;await _0x2a1c37[_0x3b3fc9(0xc5)]({'amountUsedBotQueues':0x0,'queueOptionId':null});if(!_0x2a1c37[_0x3b3fc9(0x72)]&&_0x172441[_0x3b3fc9(0xc8)]&&!_0x199fa0?.['key']['fromMe']&&!_0x2a1c37[_0x3b3fc9(0xd4)])try{const _0x48399a=await(0x0,ShowQueueIntegrationService_1[_0x3b3fc9(0xba)])(_0x172441[_0x3b3fc9(0xc8)],_0x2a1c37[_0x3b3fc9(0xf3)]);if(_0x48399a){await _0x2a1c37[_0x3b3fc9(0xc5)]({'useIntegration':!![],'integrationId':_0x48399a['id'],'amountUsedBotQueues':0x0});_0x199fa0&&await(0x0,wbotMessageListener_1['handleMessageIntegration'])(_0x199fa0,_0x225d8a,_0x48399a,_0x2a1c37);console[_0x3b3fc9(0xac)]('IntegraÃ§Ã£o\x20#'+_0x48399a['id']+_0x3b3fc9(0x71)+_0x2a1c37['id']);return;}}catch(_0x2faa5f){console[_0x3b3fc9(0xfb)](_0x3b3fc9(0xf7),_0x2faa5f),await _0x2a1c37[_0x3b3fc9(0xc5)]({'useIntegration':![],'integrationId':null});}await _0x2a1c37[_0x3b3fc9(0xc5)]({'queueId':_0x172441['id'],'chatbot':_0x4e9240});_0x172441['greetingMessage']&&await(0x0,SendWhatsAppMessage_1[_0x3b3fc9(0xba)])({'ticket':_0x2a1c37,'body':_0x172441[_0x3b3fc9(0xee)]});_0x4e9240&&await(0x0,wbotMessageListener_1[_0x3b3fc9(0xbb)])(_0x2a1c37,_0x225d8a);return;}const _0x4f4c71=_0x199fa0?(0x0,GetHandlers_1['getBodyMessage'])(_0x199fa0):null,_0x524589=_0x4f4c71?_0x244345[+_0x4f4c71-0x1]:null;if(_0x524589){await _0x2a1c37[_0x3b3fc9(0xc5)]({'amountUsedBotQueues':0x0,'queueOptionId':null});if(!_0x2a1c37[_0x3b3fc9(0x72)]&&_0x524589[_0x3b3fc9(0xc8)]&&!_0x199fa0?.[_0x3b3fc9(0x9d)][_0x3b3fc9(0x106)]&&!_0x2a1c37[_0x3b3fc9(0xd4)])try{const _0x50df18=await(0x0,ShowQueueIntegrationService_1['default'])(_0x524589[_0x3b3fc9(0xc8)],_0x2a1c37['companyId']);if(_0x50df18){await _0x2a1c37[_0x3b3fc9(0xc5)]({'useIntegration':!![],'integrationId':_0x50df18['id']}),await(0x0,wbotMessageListener_1[_0x3b3fc9(0x77)])(_0x199fa0,_0x225d8a,_0x50df18,_0x2a1c37),console[_0x3b3fc9(0xac)](_0x3b3fc9(0xe0)+_0x50df18['id']+_0x3b3fc9(0x71)+_0x2a1c37['id']);return;}}catch(_0x2bf1cc){console[_0x3b3fc9(0xfb)]('Erro\x20ao\x20processar\x20integraÃ§Ã£o\x20para\x20fila\x20escolhida:',_0x2bf1cc),await _0x2a1c37[_0x3b3fc9(0xc5)]({'useIntegration':![],'integrationId':null});}const _0x3f6bdd=_0x524589?.[_0x3b3fc9(0x89)]?.['length']>0x0;await _0x2a1c37['update']({'queueId':_0x524589['id'],'chatbot':_0x3f6bdd});_0x524589['greetingMessage']&&await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x2a1c37,'body':_0x524589[_0x3b3fc9(0xee)]});_0x3f6bdd&&await(0x0,wbotMessageListener_1[_0x3b3fc9(0xbb)])(_0x2a1c37,_0x225d8a);return;}const _0x2a7a44=await Whatsapp_1['default'][_0x3b3fc9(0x9c)](_0x2a1c37[_0x3b3fc9(0xa9)]);if(!_0x2a7a44){console[_0x3b3fc9(0xfb)](_0x3b3fc9(0x9e));return;}if(!_0x2a1c37[_0x3b3fc9(0xa2)]&&_0x2a1c37[_0x3b3fc9(0xed)]>=_0x2a7a44[_0x3b3fc9(0x107)])return;if(_0x199fa0&&_0x4f4c71&&!_0x524589){if(_0x2a7a44[_0x3b3fc9(0x107)]&&_0x2a7a44[_0x3b3fc9(0x107)]!==0x0&&_0x2a1c37['amountUsedBotQueues']>=_0x2a7a44['maxUseBotQueues']){await _0x2a1c37[_0x3b3fc9(0xc5)]({'chatbot':![],'queueOptionId':null,'amountUsedBotQueues':_0x2a7a44['maxUseBotQueues']});_0x2a7a44[_0x3b3fc9(0xfc)]&&await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x2a1c37,'body':_0x2a7a44[_0x3b3fc9(0xfc)]});return;}await _0x2a1c37[_0x3b3fc9(0xc5)]({'amountUsedBotQueues':_0x2a1c37[_0x3b3fc9(0xed)]+0x1}),await _0x2a1c37[_0x3b3fc9(0xeb)]();}const _0x15f28f=async()=>{const _0x25d80a=_0x3b3fc9;let _0x21c913='';_0x244345[_0x25d80a(0x8f)]((_0x139539,_0x1077ed)=>{const _0x18e625=_0x25d80a;_0x21c913+='*'+(_0x1077ed+0x1)+_0x18e625(0x79)+_0x139539[_0x18e625(0xc7)]+'\x0a';});const _0x3b9974=_0x5bad29+'\x0a\x0a'+_0x21c913;await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x2a1c37,'body':_0x3b9974});};switch(_0x173d0b?.[_0x3b3fc9(0xff)]){case _0x3b3fc9(0x10d):default:await _0x15f28f();break;}};exports[a581_0x185621(0xe7)]=verifyQueue;const verifyRating=_0x11b28b=>{const _0xef36cc=a581_0x185621;if(_0x11b28b&&_0x11b28b[_0xef36cc(0xb9)]===null&&_0x11b28b[_0xef36cc(0x10f)]!==null&&_0x11b28b[_0xef36cc(0xd0)]!==null)return!![];return![];};exports['verifyRating']=verifyRating;const verifyRecentCampaign=async(_0x391dbc,_0x2d9461)=>{const _0x56118f=a581_0x185621;if(!_0x391dbc[_0x56118f(0x9d)]['fromMe']){const _0x477556=_0x391dbc[_0x56118f(0x9d)][_0x56118f(0xd7)]['replace'](/\D/g,''),_0x103238=await Campaign_1[_0x56118f(0xba)]['findAll']({'where':{'companyId':_0x2d9461,'status':_0x56118f(0xe8),'confirmation':!![]}});if(_0x103238){const _0x1fc9d5=_0x103238[_0x56118f(0xaf)](_0x2988cb=>_0x2988cb['id']),_0x4eae8a=await CampaignShipping_1[_0x56118f(0xba)][_0x56118f(0x11d)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x1fc9d5},'number':_0x477556,'confirmation':null}});if(_0x4eae8a)return await _0x4eae8a[_0x56118f(0xc5)]({'confirmedAt':(0x0,moment_1[_0x56118f(0xba)])(),'confirmation':!![]}),await queues_1[_0x56118f(0xb4)][_0x56118f(0xdb)](_0x56118f(0xc4),{'campaignShippingId':_0x4eae8a['id'],'campaignId':_0x4eae8a['campaignId']},{'delay':(0x0,queues_1[_0x56118f(0x8b)])((0x0,queues_1['randomValue'])(0x0,0xa))}),!![];}}return![];};exports['verifyRecentCampaign']=verifyRecentCampaign;