'use strict';const a696_0x248bfb=a696_0x3401;(function(_0x344887,_0xb0661){const _0x194cac=a696_0x3401,_0x4a43e4=_0x344887();while(!![]){try{const _0x5a53c7=parseInt(_0x194cac(0x1f3))/0x1*(-parseInt(_0x194cac(0x264))/0x2)+parseInt(_0x194cac(0x1ab))/0x3*(parseInt(_0x194cac(0x21c))/0x4)+parseInt(_0x194cac(0x205))/0x5*(-parseInt(_0x194cac(0x184))/0x6)+parseInt(_0x194cac(0x22f))/0x7*(parseInt(_0x194cac(0x1be))/0x8)+-parseInt(_0x194cac(0x1d5))/0x9+-parseInt(_0x194cac(0x1a9))/0xa+parseInt(_0x194cac(0x255))/0xb*(parseInt(_0x194cac(0x246))/0xc);if(_0x5a53c7===_0xb0661)break;else _0x4a43e4['push'](_0x4a43e4['shift']());}catch(_0x484d52){_0x4a43e4['push'](_0x4a43e4['shift']());}}}(a696_0x2138,0x3330a));function a696_0x2138(){const _0x3b869b=['__setModuleDefault','closed','companyId','ticketId','toString','../../models/Message','literal','Fila\x20#','verifyQueue','image/jpeg','\x20vinculado','../QueueIntegrationServices/ShowQueueIntegrationService','default','whatsappId','mediaPath','lodash','public','text','Integra√ß√£o\x20#','\x20-\x20Verificando\x20upload\x20de\x20','queue','-appMessage','Contato\x20de\x20canal/newsletter\x20ignorado:\x20','captureException','stream-throttle','869930NMBoJV','Erro\x20ao\x20processar\x20integra√ß√£o\x20para\x20fila\x20√∫nica:','519qAWvvr','__createBinding','number','https://','[verifyMessage]\x20Updating\x20contact\x20','create','[saveMediaToFile]\x20Quota\x20do\x20bucket\x20MinIO\x20excedida\x20para\x20empresa\x20','makeRandomId','reactionMessage','contactId','*\x20-\x20','company-','handleMessageIntegration','code','replace','finishedAt','.\x20M√≠dia\x20n√£o\x20ser√°\x20salva.','@lid','\x20iniciada\x20para\x20o\x20ticket\x20#','1697488rtYahb','lastProcessedMessageId','getTypeEditedMessage','\x20other\x20tickets)','string','directPath','error','includes','./SendWhatsAppMedia','sequelize','indexOf','delete','lid','XMinioAdminBucketQuotaExceeded','@whiskeysockets/baileys','fromMe','defineProperty','normalizeThumbnailMediaType','-ticket','../../models/Setting','resolve','documentWithCaptionMessage','\x20-\x20canUpload:\x20','1199124xsqqJT','[saveMediaToFile]\x20Empresa\x20','name','hasOwnProperty','[saveMediaToFile]\x20Limite\x20de\x20armazenamento\x20atingido\x20para\x20empresa\x20','caption','../../helpers/CheckSettings','@sentry/node','userId','startsWith','pipe','path','prototype','getQuotedMessageId','../StorageService/StorageService','../../models/User','isGroup','verifyContact','CASE\x20WHEN\x20number\x20=\x20\x27','contact','../../queues','STORAGE_LIMIT_EXCEEDED','configurable','constructor','transferMessage','amountUsedBotQueues','\x20already\x20up\x20to\x20date','verifyRecentCampaign','profilePicUrl','queueId','1XZsZEL','../../models/OldMessage','verifyMediaMessage','conversation','keys','STORAGE_ERROR','g.us','concat','setExtra','\x27\x20THEN\x200\x20ELSE\x201\x20END','profilePictureUrl','extendedTextMessage','thumbnail-image','info','then','forEach','document','log','1975955QdEuSx','writeFile','[verifyMessage]\x20Contact\x20','queue-','writable','image','search','quotedMsgId','../../helpers/MakeRandomId','@s.whatsapp.net','[verifyMessage]\x20Deleted\x20duplicate\x20contact\x20','getTime','__importStar',')\x20tem\x20FlowBuilder\x20#','thumbnail-document','randomValue','../../models/Contact','canUpload','filename','findByPk','update','__importDefault','DispatchConfirmedCampaign','4148BYhpfQ','Configura√ß√µes\x20do\x20WhatsApp\x20n√£o\x20encontradas.','from','getMessageMedia','slice','>>>>\x20erro\x20','../WhatsappService/ShowWhatsAppService','\x20MiB','http://','\x20bytes','getOwnPropertyDescriptor','thumbnail-','FRONTEND_URL','imageMessage','verifyRating','util','data','dataJson','read','7ioTFfJ','../../helpers/ExtractPhoneNumber','../../utils/logger','body','join','env','reload','emit','url','chatbot','downloadLimit','Throttle','../../libs/socket','fileLength','Bucket\x20quota','./SendWhatsAppMessage','documentMessage','getUnpackedMessage','.jpg','__esModule','remoteJidAlt','(((.+)+)+)+$','split','828BkkPAH','findOne','downloadContentFromMessage','./GetHandlers','Fila\x20escolhida\x20#','substring','warn','-closed','remoteJid','length','getBodyMessage','rate','verifyDeleteMessage','*Mensagem\x20do\x20sistema*:\x0aArquivo\x20recebido\x20al√©m\x20do\x20limite\x20de\x20tamanho\x20do\x20sistema,\x20se\x20for\x20necess√°rio\x20ele\x20pode\x20ser\x20obtido\x20no\x20aplicativo\x20do\x20whatsapp.','../../models/Campaign','130306ZxfOwx','greetingMessage','count','verifyMessage','quota\x20exceeded','.\x20Ignorando\x20em\x20verifyQueue.','getPhoneNumberFromJid','map','destroy','key','pending','participant','useIntegration','stringify','./wbotMessageListener','767734kbzREy','../../models/CampaignShipping','Failed\x20to\x20get\x20stream','ASC','ratingAt','logger','existsSync','getIO','mimetype','ack','campaignQueue','maxUseBotQueues','/nopicture.png','message','campaignId','verifyEditedMessage','EM_ANDAMENTO','../MessageServices/CreateMessageService','6SEKfCn','ERR_WAPP_DOWNLOAD_MEDIA','integrationId','moment','user','thumbnail-video','ticket','apply','value','parseToMilliseconds','status','flowBuilderId'];a696_0x2138=function(){return _0x3b869b;};return a696_0x2138();}var __createBinding=this&&this[a696_0x248bfb(0x1ac)]||(Object[a696_0x248bfb(0x1b0)]?function(_0x4649b4,_0x4a6d04,_0x2b4443,_0x3cfbb8){const _0xd565d9=a696_0x248bfb;if(_0x3cfbb8===undefined)_0x3cfbb8=_0x2b4443;var _0x461994=Object[_0xd565d9(0x226)](_0x4a6d04,_0x2b4443);(!_0x461994||('get'in _0x461994?!_0x4a6d04['__esModule']:_0x461994[_0xd565d9(0x209)]||_0x461994[_0xd565d9(0x1eb)]))&&(_0x461994={'enumerable':!![],'get':function(){return _0x4a6d04[_0x2b4443];}}),Object[_0xd565d9(0x1ce)](_0x4649b4,_0x3cfbb8,_0x461994);}:function(_0x291d58,_0xbaada1,_0x536445,_0x497221){if(_0x497221===undefined)_0x497221=_0x536445;_0x291d58[_0x497221]=_0xbaada1[_0x536445];}),__setModuleDefault=this&&this[a696_0x248bfb(0x190)]||(Object[a696_0x248bfb(0x1b0)]?function(_0xd79a5,_0x59ff98){const _0x20bda3=a696_0x248bfb;Object[_0x20bda3(0x1ce)](_0xd79a5,'default',{'enumerable':!![],'value':_0x59ff98});}:function(_0x51930d,_0x154ec7){const _0x197ec7=a696_0x248bfb;_0x51930d[_0x197ec7(0x19c)]=_0x154ec7;}),__importStar=this&&this[a696_0x248bfb(0x211)]||(function(){const _0x44d9bb=(function(){let _0x607b33=!![];return function(_0x40b571,_0x1333b1){const _0x57f1e7=_0x607b33?function(){const _0x2f1f27=a696_0x3401;if(_0x1333b1){const _0x48efd2=_0x1333b1[_0x2f1f27(0x18b)](_0x40b571,arguments);return _0x1333b1=null,_0x48efd2;}}:function(){};return _0x607b33=![],_0x57f1e7;};}()),_0x49f844=_0x44d9bb(this,function(){const _0x447c10=a696_0x3401;return _0x49f844[_0x447c10(0x194)]()['search']('(((.+)+)+)+$')['toString']()[_0x447c10(0x1ec)](_0x49f844)[_0x447c10(0x20b)](_0x447c10(0x244));});_0x49f844();var _0x3de6f3=function(_0x2ef966){return _0x3de6f3=Object['getOwnPropertyNames']||function(_0x4a11e7){const _0x35c24f=a696_0x3401;var _0x179108=[];for(var _0x585a67 in _0x4a11e7)if(Object[_0x35c24f(0x1e1)][_0x35c24f(0x1d8)]['call'](_0x4a11e7,_0x585a67))_0x179108[_0x179108['length']]=_0x585a67;return _0x179108;},_0x3de6f3(_0x2ef966);};return function(_0x534204){const _0x53b677=a696_0x3401;if(_0x534204&&_0x534204[_0x53b677(0x242)])return _0x534204;var _0x5bc309={};if(_0x534204!=null){for(var _0xce89bc=_0x3de6f3(_0x534204),_0x102e17=0x0;_0x102e17<_0xce89bc[_0x53b677(0x24f)];_0x102e17++)if(_0xce89bc[_0x102e17]!==_0x53b677(0x19c))__createBinding(_0x5bc309,_0x534204,_0xce89bc[_0x102e17]);}return __setModuleDefault(_0x5bc309,_0x534204),_0x5bc309;};}()),__importDefault=this&&this[a696_0x248bfb(0x21a)]||function(_0xf44b4b){return _0xf44b4b&&_0xf44b4b['__esModule']?_0xf44b4b:{'default':_0xf44b4b};};Object[a696_0x248bfb(0x1ce)](exports,a696_0x248bfb(0x242),{'value':!![]}),exports[a696_0x248bfb(0x1f0)]=exports[a696_0x248bfb(0x22a)]=exports[a696_0x248bfb(0x198)]=exports[a696_0x248bfb(0x252)]=exports['verifyEditedMessage']=exports[a696_0x248bfb(0x1f5)]=exports[a696_0x248bfb(0x1e6)]=exports[a696_0x248bfb(0x258)]=exports[a696_0x248bfb(0x1cf)]=exports['normalizeMediaType']=void 0x0;const Message_1=__importDefault(require(a696_0x248bfb(0x195))),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a696_0x248bfb(0x215))),socket_1=require(a696_0x248bfb(0x23b)),baileys_1=require(a696_0x248bfb(0x1cc)),CreateMessageService_1=__importDefault(require(a696_0x248bfb(0x183))),GetHandlers_1=require(a696_0x248bfb(0x249)),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a696_0x248bfb(0x1e4))),Sentry=__importStar(require(a696_0x248bfb(0x1dc))),CreateOrUpdateContactService_1=__importDefault(require('../ContactServices/CreateOrUpdateContactService')),stream_throttle_1=require(a696_0x248bfb(0x1a8)),MakeRandomId_1=require(a696_0x248bfb(0x20d)),CheckSettings_1=__importDefault(require(a696_0x248bfb(0x1db))),GetHandlers_2=require(a696_0x248bfb(0x249)),logger_1=require(a696_0x248bfb(0x231)),util_1=require(a696_0x248bfb(0x22b)),fs_1=__importStar(require('fs')),path_1=__importDefault(require(a696_0x248bfb(0x1e0))),OldMessage_1=__importDefault(require(a696_0x248bfb(0x1f4))),ShowWhatsAppService_1=__importDefault(require(a696_0x248bfb(0x222))),lodash_1=require(a696_0x248bfb(0x19f)),ShowQueueIntegrationService_1=__importDefault(require(a696_0x248bfb(0x19b))),wbotMessageListener_1=require('./wbotMessageListener'),Setting_1=__importDefault(require(a696_0x248bfb(0x1d1))),Campaign_1=__importDefault(require(a696_0x248bfb(0x254))),CampaignShipping_1=__importDefault(require(a696_0x248bfb(0x265))),moment_1=__importDefault(require(a696_0x248bfb(0x187))),queues_1=require(a696_0x248bfb(0x1e9)),sequelize_1=require(a696_0x248bfb(0x1c7)),SendWhatsAppMessage_1=__importDefault(require(a696_0x248bfb(0x23e))),SendWhatsAppMedia_1=__importDefault(require(a696_0x248bfb(0x1c6))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ExtractPhoneNumber_1=require(a696_0x248bfb(0x230)),StorageService_1=__importDefault(require(a696_0x248bfb(0x1e3))),writeFileAsync=(0x0,util_1['promisify'])(fs_1[a696_0x248bfb(0x206)]),saveMediaToFile=async(_0x37334c,_0x228a69)=>{const _0x1ab47e=a696_0x248bfb;if(!_0x37334c['filename']){const _0x44944a=_0x37334c[_0x1ab47e(0x17a)][_0x1ab47e(0x245)]('/')[0x1][_0x1ab47e(0x245)](';')[0x0];_0x37334c[_0x1ab47e(0x217)]=new Date()[_0x1ab47e(0x210)]()+'.'+_0x44944a;}const _0x37299b=(0x0,MakeRandomId_1[_0x1ab47e(0x1b2)])(0xa),_0x50d158=_0x228a69[_0x1ab47e(0x1b4)]+'/'+_0x228a69['id']+'/'+_0x37299b,_0x3bd981=_0x37334c[_0x1ab47e(0x22c)]?typeof _0x37334c[_0x1ab47e(0x22c)]===_0x1ab47e(0x1c2)?Buffer[_0x1ab47e(0x21e)](_0x37334c[_0x1ab47e(0x22c)],'base64')[_0x1ab47e(0x24f)]:_0x37334c[_0x1ab47e(0x22c)][_0x1ab47e(0x24f)]:0x0;logger_1[_0x1ab47e(0x177)][_0x1ab47e(0x200)](_0x1ab47e(0x1d6)+_0x228a69['companyId']+_0x1ab47e(0x1a3)+_0x3bd981+_0x1ab47e(0x225));const _0x24da81=await StorageService_1[_0x1ab47e(0x19c)][_0x1ab47e(0x216)](_0x228a69[_0x1ab47e(0x192)],_0x3bd981);logger_1['logger'][_0x1ab47e(0x200)](_0x1ab47e(0x1d6)+_0x228a69[_0x1ab47e(0x192)]+_0x1ab47e(0x1d4)+_0x24da81);if(!_0x24da81)return logger_1[_0x1ab47e(0x177)]['warn'](_0x1ab47e(0x1d9)+_0x228a69[_0x1ab47e(0x192)]+_0x1ab47e(0x1bb)),_0x1ab47e(0x1ea);try{const _0x3935b5=await StorageService_1[_0x1ab47e(0x19c)]['uploadTicketMedia'](_0x228a69[_0x1ab47e(0x192)],_0x50d158,_0x37334c['filename'],_0x37334c[_0x1ab47e(0x22c)],_0x37334c[_0x1ab47e(0x17a)]);return _0x3935b5[_0x1ab47e(0x237)];}catch(_0x48184f){Sentry['captureException'](_0x48184f),logger_1[_0x1ab47e(0x177)][_0x1ab47e(0x1c4)]('Erro\x20ao\x20salvar\x20m√≠dia:\x20'+_0x48184f[_0x1ab47e(0x17f)]);if(_0x48184f[_0x1ab47e(0x1b8)]===_0x1ab47e(0x1cb)||_0x48184f[_0x1ab47e(0x17f)]?.[_0x1ab47e(0x1c5)](_0x1ab47e(0x259))||_0x48184f[_0x1ab47e(0x17f)]?.['includes'](_0x1ab47e(0x23d)))return logger_1[_0x1ab47e(0x177)][_0x1ab47e(0x24c)](_0x1ab47e(0x1b1)+_0x228a69[_0x1ab47e(0x192)]),_0x1ab47e(0x1ea);return _0x1ab47e(0x1f8);}},normalizeMediaType=_0x328988=>{const _0x170886=a696_0x248bfb,_0x56d775=['audio','video',_0x170886(0x20a),_0x170886(0x203)],_0x5dac10=_0x328988['split']('/')[0x0];if(!_0x56d775[_0x170886(0x1c5)](_0x5dac10))return _0x170886(0x203);return _0x5dac10;};exports['normalizeMediaType']=normalizeMediaType;const normalizeThumbnailMediaType=_0x2b1164=>{const _0x4f0434=a696_0x248bfb,_0x97d366=[_0x4f0434(0x189),_0x4f0434(0x1ff),_0x4f0434(0x213)],_0x411ada=_0x2b1164['split']('/')[0x0];if(!_0x97d366[_0x4f0434(0x1c5)](_0x4f0434(0x227)+_0x411ada))return _0x4f0434(0x213);return _0x411ada;};exports[a696_0x248bfb(0x1cf)]=normalizeThumbnailMediaType;const downloadMedia=async(_0xa48d6e,_0x3c322b,_0x5347c3)=>{const _0x20152a=a696_0x248bfb,_0x574b4c=(0x0,GetHandlers_2[_0x20152a(0x240)])(_0xa48d6e),_0x403540=(0x0,GetHandlers_2[_0x20152a(0x21f)])(_0x574b4c);if(!_0x403540)return null;const _0x1a9e65=parseInt(await(0x0,CheckSettings_1[_0x20152a(0x19c)])(_0x20152a(0x239),'15'),0xa);if(_0x3c322b&&_0x403540?.['fileLength']&&+_0x403540[_0x20152a(0x23c)]>_0x1a9e65*0x400*0x400){const _0x552c7e='*Mensagem\x20Autom√°tica*:\x0aNosso\x20sistema\x20aceita\x20apenas\x20arquivos\x20com\x20no\x20m√°ximo\x20'+_0x1a9e65+_0x20152a(0x223);if(!_0x5347c3[_0x20152a(0x1e5)]){const _0x24f5bc=await(0x0,SendWhatsAppMessage_1[_0x20152a(0x19c)])({'ticket':_0x5347c3,'body':_0x552c7e});_0x24f5bc[_0x20152a(0x17f)][_0x20152a(0x1fe)][_0x20152a(0x1a1)]=_0x20152a(0x253);}throw new Error('ERR_FILESIZE_OVER_LIMIT');}const _0x119d84=_0x574b4c?.['documentMessage']?_0x20152a(0x203):(0x0,exports['normalizeMediaType'])(_0x403540[_0x20152a(0x17a)]);let _0x5040a8,_0xdfa830=0x0;while(_0xdfa830<0xa&&!_0x5040a8){try{const _0x35ec4b={..._0x403540};_0x35ec4b?.[_0x20152a(0x1c3)]&&(_0x35ec4b[_0x20152a(0x237)]=''),_0x5040a8=await(0x0,baileys_1[_0x20152a(0x248)])(_0x35ec4b,_0x119d84);}catch(_0x26983b){_0xdfa830+=0x1,await new Promise(_0x3ac24c=>{setTimeout(_0x3ac24c,0x3e8*_0xdfa830*0x2);}),logger_1[_0x20152a(0x177)][_0x20152a(0x24c)](_0x20152a(0x221)+_0xdfa830+'\x20de\x20baixar\x20o\x20arquivo\x20'+_0xa48d6e?.[_0x20152a(0x25e)]?.['id']);}}if(!_0x5040a8)throw new Error('Failed\x20to\x20get\x20stream');const _0x457917=await downloadStream(_0x5040a8);if(!_0x457917){Sentry[_0x20152a(0x1fb)](_0x20152a(0x185),{'msg':_0xa48d6e}),Sentry[_0x20152a(0x1a7)](new Error(_0x20152a(0x185)));throw new Error(_0x20152a(0x185));}let _0x36d48a=_0x574b4c?.[_0x20152a(0x23f)]?.['fileName']||'';if(!_0x36d48a){const _0x3e037f=_0x403540[_0x20152a(0x17a)][_0x20152a(0x245)]('/')[0x1][_0x20152a(0x245)](';')[0x0];_0x36d48a=(0x0,MakeRandomId_1['makeRandomId'])(0x5)+'-'+new Date()[_0x20152a(0x210)]()+'.'+_0x3e037f;}else _0x36d48a=_0x36d48a['split']('.')[_0x20152a(0x220)](0x0,-0x1)[_0x20152a(0x233)]('.')+'.'+(0x0,MakeRandomId_1['makeRandomId'])(0x5)+'.'+_0x36d48a['split']('.')[_0x20152a(0x220)](-0x1);const _0x1a7c97={'data':_0x457917,'mimetype':_0x403540['mimetype'],'filename':_0x36d48a};return _0x1a7c97;},downloadStream=async _0x3be3be=>{const _0x33cb13=a696_0x248bfb,_0xa3909a=0x5*0x400*0x400/0x8,_0xf4f683=0x400*0x400/0x8,_0x533f60=0x400*0x400,_0x242921=new stream_throttle_1[(_0x33cb13(0x23a))]({'rate':_0xa3909a});let _0x43b782=Buffer['from']([]),_0x28c01e=0x0;try{for await(const _0x4e89a7 of _0x3be3be[_0x33cb13(0x1df)](_0x242921)){_0x43b782=Buffer[_0x33cb13(0x1fa)]([_0x43b782,_0x4e89a7]),_0x28c01e+=_0x4e89a7[_0x33cb13(0x24f)],_0x28c01e>_0x533f60&&(_0x242921[_0x33cb13(0x251)]=_0xf4f683);}}catch(_0x4f1dac){Sentry['setExtra'](_0x33cb13(0x185),{'error':_0x4f1dac}),Sentry['captureException'](new Error(_0x33cb13(0x185)));throw new Error(_0x33cb13(0x185));}return _0x43b782;},downloadThumbnail=async({thumbnailDirectPath:_0x39667a,mediaKey:_0x549492,mimetype:_0x368765})=>{const _0x4eefe8=a696_0x248bfb;if(!_0x39667a||!_0x549492)return null;const _0x37b400=await(0x0,baileys_1[_0x4eefe8(0x248)])({'mediaKey':_0x549492,'directPath':_0x39667a},_0x368765?(0x0,exports['normalizeThumbnailMediaType'])(_0x368765):'thumbnail-link');if(!_0x37b400)throw new Error(_0x4eefe8(0x266));const _0x3d21c0=await downloadStream(_0x37b400);if(!_0x3d21c0)throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');const _0x527364=_0x4eefe8(0x227)+(0x0,MakeRandomId_1['makeRandomId'])(0x5)+'-'+new Date()['getTime']()+_0x4eefe8(0x241),_0x16494a={'data':_0x3d21c0,'mimetype':_0x4eefe8(0x199),'filename':_0x527364};return _0x16494a;},verifyMessage=async(_0x1cdcf0,_0x4d8d29,_0xf14cff,_0x508b76=null,_0x4ed59c=null)=>{const _0x5bc3b3=a696_0x248bfb,_0x5b416d=(0x0,socket_1[_0x5bc3b3(0x179)])(),_0x37699f=await verifyQuotedMessage(_0x1cdcf0),_0x471a10=(0x0,GetHandlers_1[_0x5bc3b3(0x250)])(_0x1cdcf0),_0xe26395={'id':_0x1cdcf0[_0x5bc3b3(0x25e)]['id'],'ticketId':_0x4d8d29['id'],'userId':_0x508b76,'contactId':_0x1cdcf0[_0x5bc3b3(0x25e)][_0x5bc3b3(0x1cd)]?undefined:_0xf14cff['id'],'body':_0x471a10,'fromMe':_0x1cdcf0['key'][_0x5bc3b3(0x1cd)],'mediaType':_0x1cdcf0[_0x5bc3b3(0x17f)]['reactionMessage']?_0x5bc3b3(0x1b3):null,'read':_0x1cdcf0[_0x5bc3b3(0x25e)][_0x5bc3b3(0x1cd)],'quotedMsgId':_0x37699f?.['id'],'ack':_0x1cdcf0['status']||(_0x1cdcf0[_0x5bc3b3(0x25e)][_0x5bc3b3(0x1cd)]?0x1:0x0),'remoteJid':_0x1cdcf0[_0x5bc3b3(0x25e)][_0x5bc3b3(0x24e)],'participant':_0x1cdcf0[_0x5bc3b3(0x25e)]['participant'],'dataJson':JSON[_0x5bc3b3(0x262)](_0x1cdcf0),'isEdited':![]};await _0x4d8d29[_0x5bc3b3(0x219)]({'lastMessage':_0x471a10[_0x5bc3b3(0x24b)](0x0,0xff)['replace'](/\n/g,'\x20')});const _0x21ed7f=await(0x0,CreateMessageService_1[_0x5bc3b3(0x19c)])({'messageData':_0xe26395,'companyId':_0x4d8d29[_0x5bc3b3(0x192)]});if(!_0x1cdcf0['key'][_0x5bc3b3(0x1cd)]){const _0x15b867=_0x1cdcf0[_0x5bc3b3(0x25e)],_0x5dcafb=_0x1cdcf0[_0x5bc3b3(0x25e)]['remoteJid'],_0x582cd8=_0x15b867[_0x5bc3b3(0x243)];let _0x310c97=null,_0x3aa651=null;if(_0x5dcafb?.[_0x5bc3b3(0x1c5)](_0x5bc3b3(0x20e)))_0x310c97=_0x5dcafb,_0x3aa651=_0x582cd8;else _0x5dcafb?.[_0x5bc3b3(0x1c5)](_0x5bc3b3(0x1bc))&&(_0x3aa651=_0x5dcafb,_0x310c97=_0x582cd8);const _0x4fcd79=_0x310c97?.[_0x5bc3b3(0x245)]('@')[0x0],_0x37ddad=_0x3aa651?.[_0x5bc3b3(0x245)]('@')[0x0],_0x3da867=_0x4fcd79&&_0x4fcd79!==_0xf14cff['number']||_0x37ddad&&_0x37ddad!==_0xf14cff[_0x5bc3b3(0x1ca)];if(_0x3da867){if(_0x4fcd79&&_0x4fcd79!==_0xf14cff[_0x5bc3b3(0x1ad)]){const _0xee1efd=await Contact_1[_0x5bc3b3(0x19c)][_0x5bc3b3(0x247)]({'where':{'number':_0x4fcd79,'companyId':_0xf14cff[_0x5bc3b3(0x192)]}});if(_0xee1efd&&_0xee1efd['id']!==_0xf14cff['id']){await _0x4d8d29[_0x5bc3b3(0x219)]({'contactId':_0xee1efd['id']}),await _0x21ed7f[_0x5bc3b3(0x219)]({'contactId':_0xee1efd['id']});const _0x2b4c92={};_0x37ddad&&!_0xee1efd[_0x5bc3b3(0x1ca)]&&(_0x2b4c92[_0x5bc3b3(0x1ca)]=_0x37ddad);_0x310c97&&!_0xee1efd['remoteJid']&&(_0x2b4c92[_0x5bc3b3(0x24e)]=_0x310c97);const _0x1bc0c4=!_0xee1efd[_0x5bc3b3(0x1f1)]||_0xee1efd[_0x5bc3b3(0x1f1)]===''||_0xee1efd['profilePicUrl']===process['env'][_0x5bc3b3(0x228)]+_0x5bc3b3(0x17e);if(_0x1bc0c4&&_0x4ed59c)try{const _0x1e03d0=_0x3aa651||_0x310c97||_0x5dcafb,_0x25695a=await _0x4ed59c[_0x5bc3b3(0x1fd)](_0x1e03d0);_0x25695a&&_0x25695a!==process[_0x5bc3b3(0x234)][_0x5bc3b3(0x228)]+_0x5bc3b3(0x17e)&&(_0x2b4c92[_0x5bc3b3(0x1f1)]=_0x25695a);}catch(_0xdda7d4){}Object[_0x5bc3b3(0x1f7)](_0x2b4c92)['length']>0x0&&await _0xee1efd[_0x5bc3b3(0x219)](_0x2b4c92);const _0x18f833=await Ticket_1[_0x5bc3b3(0x19c)][_0x5bc3b3(0x257)]({'where':{'contactId':_0xf14cff['id']}});_0x18f833===0x0?(await _0xf14cff[_0x5bc3b3(0x25d)](),console[_0x5bc3b3(0x204)](_0x5bc3b3(0x20f)+_0xf14cff['id'])):console['log']('[verifyMessage]\x20Keeping\x20contact\x20'+_0xf14cff['id']+'\x20(has\x20'+_0x18f833+_0x5bc3b3(0x1c1));return;}}const _0x4c18e3={};_0x4fcd79&&_0x4fcd79!==_0xf14cff['number']&&(_0x4c18e3['number']=_0x4fcd79),_0x37ddad&&_0x37ddad!==_0xf14cff[_0x5bc3b3(0x1ca)]&&(_0x4c18e3[_0x5bc3b3(0x1ca)]=_0x37ddad),_0x310c97&&_0x310c97!==_0xf14cff[_0x5bc3b3(0x24e)]&&(_0x4c18e3[_0x5bc3b3(0x24e)]=_0x310c97),Object[_0x5bc3b3(0x1f7)](_0x4c18e3)[_0x5bc3b3(0x24f)]>0x0&&(console['log'](_0x5bc3b3(0x1af)+_0xf14cff['id']+':',_0x4c18e3),await _0xf14cff['update'](_0x4c18e3));}else console[_0x5bc3b3(0x204)](_0x5bc3b3(0x207)+_0xf14cff['id']+_0x5bc3b3(0x1ef));}return!_0x1cdcf0[_0x5bc3b3(0x25e)][_0x5bc3b3(0x1cd)]&&_0x4d8d29[_0x5bc3b3(0x18e)]===_0x5bc3b3(0x191)&&(await _0x4d8d29[_0x5bc3b3(0x219)]({'status':'pending'}),await _0x4d8d29['reload']({'include':[{'model':Queue_1[_0x5bc3b3(0x19c)],'as':_0x5bc3b3(0x1a4)},{'model':User_1[_0x5bc3b3(0x19c)],'as':_0x5bc3b3(0x188)},{'model':Contact_1[_0x5bc3b3(0x19c)],'as':_0x5bc3b3(0x1e8)}]}),_0x5b416d['to'](_0x5bc3b3(0x1b6)+_0x4d8d29['companyId']+_0x5bc3b3(0x24d))['to']('queue-'+_0x4d8d29[_0x5bc3b3(0x1f2)]+_0x5bc3b3(0x24d))['emit'](_0x5bc3b3(0x1b6)+_0x4d8d29[_0x5bc3b3(0x192)]+'-ticket',{'action':_0x5bc3b3(0x1c9),'ticket':_0x4d8d29,'ticketId':_0x4d8d29['id']}),_0x5b416d['to'](_0x5bc3b3(0x1b6)+_0x4d8d29[_0x5bc3b3(0x192)]+'-'+_0x4d8d29[_0x5bc3b3(0x18e)])['to'](_0x5bc3b3(0x208)+_0x4d8d29[_0x5bc3b3(0x1f2)]+'-'+_0x4d8d29[_0x5bc3b3(0x18e)])['to'](_0x4d8d29['id'][_0x5bc3b3(0x194)]())[_0x5bc3b3(0x236)](_0x5bc3b3(0x1b6)+_0x4d8d29[_0x5bc3b3(0x192)]+_0x5bc3b3(0x1d0),{'action':_0x5bc3b3(0x219),'ticket':_0x4d8d29,'ticketId':_0x4d8d29['id']})),_0x21ed7f;};exports[a696_0x248bfb(0x258)]=verifyMessage;const verifyQuotedMessage=async _0x29716e=>{const _0x15bce9=a696_0x248bfb;if(!_0x29716e)return null;const _0x1e490e=(0x0,GetHandlers_1[_0x15bce9(0x1e2)])(_0x29716e);if(!_0x1e490e)return null;const _0x30b389=await Message_1[_0x15bce9(0x19c)][_0x15bce9(0x247)]({'where':{'id':_0x1e490e}});if(!_0x30b389)return null;return _0x30b389;},verifyContact=async(_0x3d596d,_0xf97a54,_0x2d7ca5,_0x277ae9)=>{const _0x177fca=a696_0x248bfb;if(_0x3d596d['id']?.['endsWith']('@newsletter'))return logger_1[_0x177fca(0x177)]['info'](_0x177fca(0x1a6)+_0x3d596d['id']),null;let _0x3a7a2f;try{_0x3a7a2f=await _0xf97a54['profilePictureUrl'](_0x3d596d['id']);}catch(_0x5ed0ba){Sentry['captureException'](_0x5ed0ba),_0x3a7a2f=process[_0x177fca(0x234)][_0x177fca(0x228)]+_0x177fca(0x17e);}const _0x45a0f4=(0x0,ExtractPhoneNumber_1[_0x177fca(0x25b)])(_0x3d596d['id']),_0x22583e=_0x3d596d['id'][_0x177fca(0x1c5)](_0x177fca(0x1bc)),_0x5e2a25=_0x22583e?_0x3d596d['id']['split']('@')[0x0]:null;if(_0x277ae9&&_0x22583e){const _0x583055=_0x277ae9[_0x177fca(0x245)]('@')[0x0],_0x4d3f56=await Contact_1['default'][_0x177fca(0x247)]({'where':{'companyId':_0x2d7ca5,[sequelize_1['Op']['or']]:[{'number':_0x583055},{'number':_0x5e2a25},{'lid':_0x5e2a25}]},'order':[[(0x0,sequelize_1[_0x177fca(0x196)])(_0x177fca(0x1e7)+_0x583055+_0x177fca(0x1fc)),_0x177fca(0x175)]]});if(_0x4d3f56){const _0x581779={};_0x4d3f56[_0x177fca(0x1ad)]===_0x5e2a25&&(_0x581779['number']=_0x583055);_0x5e2a25&&!_0x4d3f56[_0x177fca(0x1ca)]&&(_0x581779[_0x177fca(0x1ca)]=_0x5e2a25);(!_0x4d3f56[_0x177fca(0x24e)]||_0x4d3f56['remoteJid']['includes']('@lid'))&&(_0x581779['remoteJid']=_0x277ae9);const _0x16977b=!_0x4d3f56[_0x177fca(0x1f1)]||_0x4d3f56[_0x177fca(0x1f1)]===''||_0x4d3f56['profilePicUrl']===process['env'][_0x177fca(0x228)]+_0x177fca(0x17e);return _0x16977b&&_0x3a7a2f&&_0x3a7a2f!==process['env']['FRONTEND_URL']+_0x177fca(0x17e)&&(_0x581779['profilePicUrl']=_0x3a7a2f),Object[_0x177fca(0x1f7)](_0x581779)[_0x177fca(0x24f)]>0x0&&await _0x4d3f56[_0x177fca(0x219)](_0x581779),_0x4d3f56;}const _0x143881={'name':_0x3d596d?.[_0x177fca(0x1d7)]||_0x583055||_0x3d596d['id'][_0x177fca(0x1b9)](/\D/g,''),'number':_0x583055,'profilePicUrl':_0x3a7a2f,'isGroup':_0x3d596d['id']['includes'](_0x177fca(0x1f9)),'companyId':_0x2d7ca5,'remoteJid':_0x277ae9,'lid':_0x5e2a25},_0x5d75ea=(0x0,CreateOrUpdateContactService_1[_0x177fca(0x19c)])(_0x143881);return _0x5d75ea;}const _0x499439={'name':_0x3d596d?.['name']||_0x45a0f4||_0x3d596d['id']['replace'](/\D/g,''),'number':_0x45a0f4||_0x3d596d['id']['substring'](0x0,_0x3d596d['id'][_0x177fca(0x1c8)]('@')),'profilePicUrl':_0x3a7a2f,'isGroup':_0x3d596d['id'][_0x177fca(0x1c5)]('g.us'),'companyId':_0x2d7ca5,'remoteJid':_0x3d596d['id'],'lid':_0x5e2a25},_0x511e66=(0x0,CreateOrUpdateContactService_1[_0x177fca(0x19c)])(_0x499439);return _0x511e66;};function a696_0x3401(_0x56b56,_0x575f95){const _0x22797e=a696_0x2138();return a696_0x3401=function(_0xb0b584,_0x5c30f3){_0xb0b584=_0xb0b584-0x175;let _0x21389a=_0x22797e[_0xb0b584];return _0x21389a;},a696_0x3401(_0x56b56,_0x575f95);}exports['verifyContact']=verifyContact;const verifyMediaMessage=async(_0x4518a8,_0x7a3ac0,_0x280c17,_0x50d9b9=null,_0x5d7f87=null,_0x1e4270=null)=>{const _0x4f0195=a696_0x248bfb,_0x23aeb5=(0x0,socket_1['getIO'])(),_0xeb7499=await verifyQuotedMessage(_0x4518a8),_0x363647=_0x5d7f87||_0x4518a8?.[_0x4f0195(0x17f)]?.['extendedTextMessage'],_0xa8248c=_0x363647&&await downloadThumbnail(_0x363647),_0x3ddd30=await downloadMedia(_0x4518a8,_0x50d9b9,_0x7a3ac0);if(!_0x3ddd30&&!_0xa8248c)throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');let _0x3870f3=null;_0x3ddd30&&(_0x3870f3=await saveMediaToFile(_0x3ddd30,_0x7a3ac0));let _0x20fc67=null;_0xa8248c&&(_0x20fc67=await saveMediaToFile(_0xa8248c,_0x7a3ac0));const _0x5c1539=(0x0,GetHandlers_1[_0x4f0195(0x250)])(_0x4518a8),_0x353372={'id':_0x4518a8[_0x4f0195(0x25e)]['id'],'ticketId':_0x7a3ac0['id'],'userId':_0x1e4270,'contactId':_0x4518a8['key'][_0x4f0195(0x1cd)]?undefined:_0x280c17['id'],'body':_0x5c1539||'','fromMe':_0x4518a8[_0x4f0195(0x25e)][_0x4f0195(0x1cd)],'read':_0x4518a8['key']['fromMe'],'mediaUrl':_0x3870f3,'mediaType':_0x3ddd30?.[_0x4f0195(0x17a)][_0x4f0195(0x245)]('/')[0x0],'thumbnailUrl':_0x20fc67,'quotedMsgId':_0xeb7499?.['id'],'ack':_0x4518a8[_0x4f0195(0x18e)]||(_0x4518a8[_0x4f0195(0x25e)]['fromMe']?0x1:0x0),'remoteJid':_0x4518a8[_0x4f0195(0x25e)][_0x4f0195(0x24e)],'participant':_0x4518a8[_0x4f0195(0x25e)][_0x4f0195(0x260)],'dataJson':JSON[_0x4f0195(0x262)](_0x4518a8)};await _0x7a3ac0[_0x4f0195(0x219)]({'lastMessage':_0x5c1539||_0x3ddd30?.[_0x4f0195(0x217)]?'üìé\x20'+_0x3ddd30?.[_0x4f0195(0x217)]:''});const _0x5e317e=await(0x0,CreateMessageService_1[_0x4f0195(0x19c)])({'messageData':_0x353372,'companyId':_0x7a3ac0[_0x4f0195(0x192)]});if(!_0x4518a8[_0x4f0195(0x25e)]['fromMe']){const _0xe9ed63=_0x4518a8[_0x4f0195(0x25e)],_0x3df2ef=_0x4518a8[_0x4f0195(0x25e)][_0x4f0195(0x24e)],_0xf5877=_0xe9ed63['remoteJidAlt'];let _0x2666f0=null;if(_0x3df2ef?.['includes'](_0x4f0195(0x20e)))_0x2666f0=_0x3df2ef;else _0x3df2ef?.[_0x4f0195(0x1c5)](_0x4f0195(0x1bc))&&(_0x2666f0=_0xf5877);if(_0x2666f0){const _0x138e1a=_0x2666f0[_0x4f0195(0x245)]('@')[0x0];if(_0x138e1a!==_0x280c17['number']){const _0x5a6c6c={'number':_0x138e1a,'remoteJid':_0x2666f0};_0x280c17[_0x4f0195(0x1f1)]&&_0x280c17[_0x4f0195(0x1f1)]!==process[_0x4f0195(0x234)][_0x4f0195(0x228)]+_0x4f0195(0x17e)&&(_0x5a6c6c[_0x4f0195(0x1f1)]=_0x280c17[_0x4f0195(0x1f1)]),await _0x280c17[_0x4f0195(0x219)](_0x5a6c6c);}}}return!_0x4518a8[_0x4f0195(0x25e)][_0x4f0195(0x1cd)]&&_0x7a3ac0['status']===_0x4f0195(0x191)&&(await _0x7a3ac0['update']({'status':_0x4f0195(0x25f)}),await _0x7a3ac0[_0x4f0195(0x235)]({'include':[{'model':Queue_1['default'],'as':_0x4f0195(0x1a4)},{'model':User_1[_0x4f0195(0x19c)],'as':_0x4f0195(0x188)},{'model':Contact_1[_0x4f0195(0x19c)],'as':'contact'}]}),_0x23aeb5['to'](_0x4f0195(0x1b6)+_0x7a3ac0[_0x4f0195(0x192)]+'-closed')['to'](_0x4f0195(0x208)+_0x7a3ac0[_0x4f0195(0x1f2)]+_0x4f0195(0x24d))['emit'](_0x4f0195(0x1b6)+_0x7a3ac0[_0x4f0195(0x192)]+'-ticket',{'action':_0x4f0195(0x1c9),'ticket':_0x7a3ac0,'ticketId':_0x7a3ac0['id']}),_0x23aeb5['to'](_0x4f0195(0x1b6)+_0x7a3ac0[_0x4f0195(0x192)]+'-'+_0x7a3ac0[_0x4f0195(0x18e)])['to'](_0x4f0195(0x208)+_0x7a3ac0[_0x4f0195(0x1f2)]+'-'+_0x7a3ac0[_0x4f0195(0x18e)])['to'](_0x7a3ac0['id'][_0x4f0195(0x194)]())[_0x4f0195(0x236)](_0x4f0195(0x1b6)+_0x7a3ac0[_0x4f0195(0x192)]+_0x4f0195(0x1d0),{'action':'update','ticket':_0x7a3ac0,'ticketId':_0x7a3ac0['id']})),_0x5e317e;};exports[a696_0x248bfb(0x1f5)]=verifyMediaMessage;const verifyEditedMessage=async(_0x10e5a2,_0x3b2080,_0x7062cf)=>{const _0xec53c7=a696_0x248bfb,_0x23472=(0x0,GetHandlers_2[_0xec53c7(0x1c0)])(_0x10e5a2);let _0x22e19d;switch(_0x23472){case _0xec53c7(0x1f6):{_0x22e19d=_0x10e5a2[_0xec53c7(0x1f6)];break;}case _0xec53c7(0x1fe):{_0x22e19d=_0x10e5a2[_0xec53c7(0x1fe)][_0xec53c7(0x1a1)];break;}case _0xec53c7(0x229):{_0x22e19d=_0x10e5a2[_0xec53c7(0x229)]['caption'];break;}case'documentMessage':{_0x22e19d=_0x10e5a2[_0xec53c7(0x23f)][_0xec53c7(0x1da)];break;}case _0xec53c7(0x1d3):{_0x22e19d=_0x10e5a2[_0xec53c7(0x1d3)][_0xec53c7(0x17f)]['documentMessage'][_0xec53c7(0x1da)];break;}default:{return;}}const _0x552b97=await Message_1[_0xec53c7(0x19c)]['findByPk'](_0x7062cf),_0x12b703={'id':_0x552b97['id'],'ticketId':_0x552b97['ticketId'],'contactId':_0x552b97['contactId'],'body':_0x22e19d,'fromMe':_0x552b97[_0xec53c7(0x1cd)],'mediaType':_0x552b97['mediaType'],'read':_0x552b97[_0xec53c7(0x22e)],'quotedMsgId':_0x552b97[_0xec53c7(0x20c)],'ack':_0x552b97[_0xec53c7(0x17b)],'remoteJid':_0x552b97[_0xec53c7(0x24e)],'participant':_0x552b97['participant'],'dataJson':_0x552b97[_0xec53c7(0x22d)],'isEdited':!![]},_0x1984ab={'messageId':_0x12b703['id'],'body':_0x552b97['body'],'ticketId':_0x552b97[_0xec53c7(0x193)]};await OldMessage_1[_0xec53c7(0x19c)]['upsert'](_0x1984ab),await _0x3b2080[_0xec53c7(0x219)]({'lastMessage':_0x12b703[_0xec53c7(0x232)]}),await(0x0,CreateMessageService_1[_0xec53c7(0x19c)])({'messageData':_0x12b703,'companyId':_0x3b2080[_0xec53c7(0x192)]});const _0xed5a91=(0x0,socket_1['getIO'])();_0xed5a91['to'](_0x3b2080['status'])['to'](_0x3b2080['id']['toString']())[_0xec53c7(0x236)](_0xec53c7(0x1b6)+_0x3b2080[_0xec53c7(0x192)]+'-ticket',{'action':_0xec53c7(0x219),'ticket':_0x3b2080,'ticketId':_0x3b2080['id']});};exports[a696_0x248bfb(0x181)]=verifyEditedMessage;const verifyDeleteMessage=async(_0x9cc255,_0x13fb25)=>{const _0x71c02d=a696_0x248bfb,_0x990339=await Message_1[_0x71c02d(0x19c)][_0x71c02d(0x218)](_0x9cc255[_0x71c02d(0x25e)]['id'],{'include':['contact',{'model':Ticket_1['default'],'include':[{'model':Contact_1[_0x71c02d(0x19c)]}]}]});if(!_0x990339)return;await _0x990339['update']({'isDeleted':!![]});const _0x32b5c1=(0x0,socket_1[_0x71c02d(0x179)])();_0x32b5c1['to'](_0x990339[_0x71c02d(0x193)][_0x71c02d(0x194)]())['to'](_0x990339[_0x71c02d(0x18a)][_0x71c02d(0x18e)])['to']('notification')[_0x71c02d(0x236)](_0x71c02d(0x1b6)+_0x13fb25[_0x71c02d(0x192)]+_0x71c02d(0x1a5),{'action':'create','message':_0x990339,'ticket':_0x990339['ticket'],'contact':_0x990339[_0x71c02d(0x18a)][_0x71c02d(0x1e8)]});};exports['verifyDeleteMessage']=verifyDeleteMessage;const verifyQueue=async(_0x4d140c,_0x42f1cc,_0xc8b6ee,_0x1bea1a)=>{const _0x7bcbb1=a696_0x248bfb;if(_0x42f1cc?.[_0x7bcbb1(0x25e)]['id']&&_0xc8b6ee[_0x7bcbb1(0x1bf)]===_0x42f1cc[_0x7bcbb1(0x25e)]['id']){console[_0x7bcbb1(0x204)]('Mensagem\x20'+_0x42f1cc[_0x7bcbb1(0x25e)]['id']+'\x20j√°\x20processada\x20para\x20o\x20ticket\x20'+_0xc8b6ee['id']+_0x7bcbb1(0x25a));return;}_0x42f1cc?.[_0x7bcbb1(0x25e)]['id']&&await _0xc8b6ee[_0x7bcbb1(0x219)]({'lastProcessedMessageId':_0x42f1cc[_0x7bcbb1(0x25e)]['id']});const _0x5b0090=await(0x0,ShowWhatsAppService_1[_0x7bcbb1(0x19c)])(_0x4d140c['id'],_0xc8b6ee[_0x7bcbb1(0x192)]),{queues:_0x23fbcb,greetingMessage:_0x3c6f0b}=_0x5b0090,_0x12859e=await Setting_1[_0x7bcbb1(0x19c)][_0x7bcbb1(0x247)]({'where':{'key':'chatBotType','companyId':_0xc8b6ee[_0x7bcbb1(0x192)]}});if(_0x23fbcb['length']===0x1){const _0x2db1de=(0x0,lodash_1['head'])(_0x23fbcb);if(!_0x2db1de)return;await _0xc8b6ee['update']({'amountUsedBotQueues':0x0});if(_0x2db1de['flowBuilderId']){console[_0x7bcbb1(0x204)](_0x7bcbb1(0x197)+_0x2db1de['id']+'\x20('+_0x2db1de[_0x7bcbb1(0x1d7)]+_0x7bcbb1(0x212)+_0x2db1de[_0x7bcbb1(0x18f)]+_0x7bcbb1(0x19a)),await _0xc8b6ee[_0x7bcbb1(0x219)]({'queueId':_0x2db1de['id'],'flowBuilderId':_0x2db1de[_0x7bcbb1(0x18f)],'chatbot':!![],'flowWebhook':![],'amountUsedBotQueues':0x0});const {handleFlowBuilderExecution:_0x5288e1}=await Promise[_0x7bcbb1(0x1d2)]()[_0x7bcbb1(0x201)](()=>__importStar(require(_0x7bcbb1(0x263))));await _0x5288e1(_0xc8b6ee,_0x4d140c);return;}if(!_0xc8b6ee[_0x7bcbb1(0x261)]&&_0x2db1de[_0x7bcbb1(0x186)]&&!_0x42f1cc?.[_0x7bcbb1(0x25e)]['fromMe']&&!_0xc8b6ee[_0x7bcbb1(0x1e5)])try{const _0x27eac1=await(0x0,ShowQueueIntegrationService_1[_0x7bcbb1(0x19c)])(_0x2db1de[_0x7bcbb1(0x186)],_0xc8b6ee[_0x7bcbb1(0x192)]);if(_0x27eac1){await _0xc8b6ee['update']({'useIntegration':!![],'integrationId':_0x27eac1['id'],'amountUsedBotQueues':0x0});_0x42f1cc&&await(0x0,wbotMessageListener_1[_0x7bcbb1(0x1b7)])(_0x42f1cc,_0x4d140c,_0x27eac1,_0xc8b6ee);console[_0x7bcbb1(0x204)](_0x7bcbb1(0x1a2)+_0x27eac1['id']+_0x7bcbb1(0x1bd)+_0xc8b6ee['id']);return;}}catch(_0x1a2128){console['error'](_0x7bcbb1(0x1aa),_0x1a2128),await _0xc8b6ee[_0x7bcbb1(0x219)]({'useIntegration':![],'integrationId':null});}await _0xc8b6ee[_0x7bcbb1(0x219)]({'queueId':_0x2db1de['id'],'chatbot':![]});if(!_0x2db1de[_0x7bcbb1(0x186)]&&!_0x2db1de[_0x7bcbb1(0x18f)]){_0x2db1de[_0x7bcbb1(0x256)]&&await(0x0,SendWhatsAppMessage_1[_0x7bcbb1(0x19c)])({'ticket':_0xc8b6ee,'body':_0x2db1de[_0x7bcbb1(0x256)]});if(_0x2db1de[_0x7bcbb1(0x19e)]){const _0x369e60=_0x2db1de[_0x7bcbb1(0x19e)];if(_0x369e60[_0x7bcbb1(0x1de)](_0x7bcbb1(0x224))||_0x369e60[_0x7bcbb1(0x1de)](_0x7bcbb1(0x1ae)))await(0x0,SendWhatsAppMedia_1[_0x7bcbb1(0x19c)])({'media':_0x369e60,'ticket':_0xc8b6ee,'body':''});else{const _0x581918=path_1['default'][_0x7bcbb1(0x1d2)](_0x7bcbb1(0x1a0),_0x369e60);fs_1['default'][_0x7bcbb1(0x178)](_0x581918)&&await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x581918,'ticket':_0xc8b6ee,'body':''});}}}return;}const _0x473600=_0x42f1cc?(0x0,GetHandlers_1[_0x7bcbb1(0x250)])(_0x42f1cc):null,_0x508e2f=_0x473600?_0x23fbcb[+_0x473600-0x1]:null;if(_0x473600==='0'){await _0xc8b6ee[_0x7bcbb1(0x219)]({'queueId':null,'chatbot':![],'flowBuilderId':null,'flowWebhook':![],'lastFlowId':null,'flowStopped':null,'hashFlowId':null,'dataWebhook':null,'amountUsedBotQueues':0x0});const _0x5baed7='Voc√™\x20saiu\x20do\x20menu.\x20Digite\x20*#*\x20para\x20voltar\x20ao\x20menu\x20principal.';await(0x0,SendWhatsAppMessage_1[_0x7bcbb1(0x19c)])({'ticket':_0xc8b6ee,'body':_0x5baed7});return;}if(_0x508e2f){await _0xc8b6ee[_0x7bcbb1(0x219)]({'amountUsedBotQueues':0x0});if(_0x508e2f['flowBuilderId']){console[_0x7bcbb1(0x204)](_0x7bcbb1(0x24a)+_0x508e2f['id']+'\x20('+_0x508e2f[_0x7bcbb1(0x1d7)]+_0x7bcbb1(0x212)+_0x508e2f['flowBuilderId']+'\x20vinculado'),await _0xc8b6ee[_0x7bcbb1(0x219)]({'queueId':_0x508e2f['id'],'flowBuilderId':_0x508e2f['flowBuilderId'],'chatbot':!![],'flowWebhook':![],'amountUsedBotQueues':0x0});const {handleFlowBuilderExecution:_0x3f84d8}=await Promise[_0x7bcbb1(0x1d2)]()[_0x7bcbb1(0x201)](()=>__importStar(require('./wbotMessageListener')));await _0x3f84d8(_0xc8b6ee,_0x4d140c);return;}if(!_0xc8b6ee[_0x7bcbb1(0x261)]&&_0x508e2f['integrationId']&&!_0x42f1cc?.['key'][_0x7bcbb1(0x1cd)]&&!_0xc8b6ee[_0x7bcbb1(0x1e5)])try{const _0x2e60ea=await(0x0,ShowQueueIntegrationService_1[_0x7bcbb1(0x19c)])(_0x508e2f['integrationId'],_0xc8b6ee['companyId']);if(_0x2e60ea){await _0xc8b6ee[_0x7bcbb1(0x219)]({'useIntegration':!![],'integrationId':_0x2e60ea['id']}),await(0x0,wbotMessageListener_1[_0x7bcbb1(0x1b7)])(_0x42f1cc,_0x4d140c,_0x2e60ea,_0xc8b6ee),console[_0x7bcbb1(0x204)](_0x7bcbb1(0x1a2)+_0x2e60ea['id']+_0x7bcbb1(0x1bd)+_0xc8b6ee['id']);return;}}catch(_0x43b370){console[_0x7bcbb1(0x1c4)]('Erro\x20ao\x20processar\x20integra√ß√£o\x20para\x20fila\x20escolhida:',_0x43b370),await _0xc8b6ee[_0x7bcbb1(0x219)]({'useIntegration':![],'integrationId':null});}await _0xc8b6ee[_0x7bcbb1(0x219)]({'queueId':_0x508e2f['id'],'chatbot':![]});if(!_0x508e2f[_0x7bcbb1(0x186)]&&!_0x508e2f[_0x7bcbb1(0x18f)]){_0x508e2f[_0x7bcbb1(0x256)]&&await(0x0,SendWhatsAppMessage_1[_0x7bcbb1(0x19c)])({'ticket':_0xc8b6ee,'body':_0x508e2f[_0x7bcbb1(0x256)]});if(_0x508e2f[_0x7bcbb1(0x19e)]){const _0x17e76e=_0x508e2f[_0x7bcbb1(0x19e)];if(_0x17e76e['startsWith'](_0x7bcbb1(0x224))||_0x17e76e[_0x7bcbb1(0x1de)](_0x7bcbb1(0x1ae)))await(0x0,SendWhatsAppMedia_1[_0x7bcbb1(0x19c)])({'media':_0x17e76e,'ticket':_0xc8b6ee,'body':''});else{const _0x519095=path_1[_0x7bcbb1(0x19c)][_0x7bcbb1(0x1d2)](_0x7bcbb1(0x1a0),_0x17e76e);fs_1['default'][_0x7bcbb1(0x178)](_0x519095)&&await(0x0,SendWhatsAppMedia_1[_0x7bcbb1(0x19c)])({'media':_0x519095,'ticket':_0xc8b6ee,'body':''});}}}return;}const _0x5158e4=await Whatsapp_1['default'][_0x7bcbb1(0x218)](_0xc8b6ee[_0x7bcbb1(0x19d)]);if(!_0x5158e4){console[_0x7bcbb1(0x1c4)](_0x7bcbb1(0x21d));return;}if(!_0xc8b6ee[_0x7bcbb1(0x238)]&&_0xc8b6ee['amountUsedBotQueues']>=_0x5158e4[_0x7bcbb1(0x17d)])return;if(_0x42f1cc&&_0x473600&&!_0x508e2f){if(_0x5158e4[_0x7bcbb1(0x17d)]&&_0x5158e4[_0x7bcbb1(0x17d)]!==0x0&&_0xc8b6ee[_0x7bcbb1(0x1ee)]>=_0x5158e4[_0x7bcbb1(0x17d)]){await _0xc8b6ee[_0x7bcbb1(0x219)]({'chatbot':![],'amountUsedBotQueues':_0x5158e4['maxUseBotQueues']});_0x5158e4['transferMessage']&&await(0x0,SendWhatsAppMessage_1[_0x7bcbb1(0x19c)])({'ticket':_0xc8b6ee,'body':_0x5158e4[_0x7bcbb1(0x1ed)]});return;}await _0xc8b6ee['update']({'amountUsedBotQueues':_0xc8b6ee[_0x7bcbb1(0x1ee)]+0x1}),await _0xc8b6ee[_0x7bcbb1(0x235)]();}const _0x25f265=async()=>{const _0x5e7ff1=_0x7bcbb1;let _0x3636c1='';_0x23fbcb[_0x5e7ff1(0x202)]((_0x25a410,_0x3e8a4c)=>{const _0x3e1236=_0x5e7ff1;_0x3636c1+='*'+(_0x3e8a4c+0x1)+_0x3e1236(0x1b5)+_0x25a410[_0x3e1236(0x1d7)]+'\x0a';}),_0x3636c1+='*0*\x20-\x20Sair';const _0x5d03ff=_0x3c6f0b+'\x0a\x0a'+_0x3636c1;await(0x0,SendWhatsAppMessage_1[_0x5e7ff1(0x19c)])({'ticket':_0xc8b6ee,'body':_0x5d03ff});};switch(_0x12859e?.[_0x7bcbb1(0x18c)]){case'text':default:await _0x25f265();break;}};exports[a696_0x248bfb(0x198)]=verifyQueue;const verifyRating=_0x4f02fb=>{const _0x2b6af3=a696_0x248bfb;if(_0x4f02fb&&_0x4f02fb[_0x2b6af3(0x1ba)]===null&&_0x4f02fb[_0x2b6af3(0x1dd)]!==null&&_0x4f02fb[_0x2b6af3(0x176)]!==null)return!![];return![];};exports[a696_0x248bfb(0x22a)]=verifyRating;const verifyRecentCampaign=async(_0x55a25c,_0x70aa94)=>{const _0x17ecbd=a696_0x248bfb;if(!_0x55a25c['key'][_0x17ecbd(0x1cd)]){const _0x46acb5=(0x0,ExtractPhoneNumber_1[_0x17ecbd(0x25b)])(_0x55a25c['key']['remoteJid']),_0x5bb25e=await Campaign_1[_0x17ecbd(0x19c)]['findAll']({'where':{'companyId':_0x70aa94,'status':_0x17ecbd(0x182),'confirmation':!![]}});if(_0x5bb25e){const _0xac8287=_0x5bb25e[_0x17ecbd(0x25c)](_0x5ee162=>_0x5ee162['id']),_0x1c088b=await CampaignShipping_1[_0x17ecbd(0x19c)]['findOne']({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0xac8287},'number':_0x46acb5,'confirmation':null}});if(_0x1c088b)return await _0x1c088b[_0x17ecbd(0x219)]({'confirmedAt':(0x0,moment_1[_0x17ecbd(0x19c)])(),'confirmation':!![]}),await queues_1[_0x17ecbd(0x17c)]['add'](_0x17ecbd(0x21b),{'campaignShippingId':_0x1c088b['id'],'campaignId':_0x1c088b[_0x17ecbd(0x180)]},{'delay':(0x0,queues_1[_0x17ecbd(0x18d)])((0x0,queues_1[_0x17ecbd(0x214)])(0x0,0xa))}),!![];}}return![];};exports[a696_0x248bfb(0x1f0)]=verifyRecentCampaign;