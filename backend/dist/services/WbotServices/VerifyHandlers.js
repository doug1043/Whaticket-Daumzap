'use strict';function a695_0x7d4d(){const _0x598299=['\x20already\x20up\x20to\x20date','length','util','status','@lid','Bucket\x20quota','env','apply','g.us','filename','verifyQueue','pipe','extendedTextMessage','video','campaignId','thumbnail-','*Mensagem\x20do\x20sistema*:\x0aArquivo\x20recebido\x20alÃ©m\x20do\x20limite\x20de\x20tamanho\x20do\x20sistema,\x20se\x20for\x20necessÃ¡rio\x20ele\x20pode\x20ser\x20obtido\x20no\x20aplicativo\x20do\x20whatsapp.','endsWith','./GetHandlers','makeRandomId','create','transferMessage','./SendWhatsAppMessage','(((.+)+)+)+$','\x20iniciada\x20para\x20o\x20ticket\x20#','key','../../models/Campaign','Failed\x20to\x20get\x20stream','5HVdgOQ','info','log','../../models/CampaignShipping','defineProperty','\x20-\x20Verificando\x20upload\x20de\x20','delete','chatbot','profilePictureUrl','[verifyMessage]\x20Contact\x20','rate','ASC','queue-','name','pending','number','getOwnPropertyNames','startsWith','lastProcessedMessageId','randomValue','ticket','2861688LfYPxk','ConfiguraÃ§Ãµes\x20do\x20WhatsApp\x20nÃ£o\x20encontradas.','verifyMessage','-closed','from','normalizeThumbnailMediaType','FRONTEND_URL','user','__importDefault','DispatchConfirmedCampaign','-appMessage','greetingMessage','[saveMediaToFile]\x20Quota\x20do\x20bucket\x20MinIO\x20excedida\x20para\x20empresa\x20','finishedAt','data','Fila\x20escolhida\x20#','\x20jÃ¡\x20processada\x20para\x20o\x20ticket\x20','uploadTicketMedia','../../models/Setting','mediaPath','slice','quota\x20exceeded','__setModuleDefault','warn','handleMessageIntegration','\x20other\x20tickets)','mediaType','caption','getIO','keys','5754370FtKzWh','../ContactServices/CreateOrUpdateContactService','verifyRating','default','parseToMilliseconds','@s.whatsapp.net','[verifyMessage]\x20Keeping\x20contact\x20','__createBinding','http://','*0*\x20-\x20Sair','STORAGE_ERROR','../../queues','emit','search','../../models/User','downloadLimit','verifyContact','audio','.\x20Ignorando\x20em\x20verifyQueue.',')\x20tem\x20FlowBuilder\x20#','logger','../../models/OldMessage','./wbotMessageListener','Mensagem\x20','profilePicUrl','EM_ANDAMENTO','string','Contato\x20de\x20canal/newsletter\x20ignorado:\x20','reactionMessage','40jrKimI','./SendWhatsAppMedia','/nopicture.png','concat','fileLength','4664wCfJtT','../../helpers/MakeRandomId','[verifyMessage]\x20Deleted\x20duplicate\x20contact\x20','XMinioAdminBucketQuotaExceeded','ERR_WAPP_DOWNLOAD_MEDIA','\x20de\x20baixar\x20o\x20arquivo\x20','Erro\x20ao\x20salvar\x20mÃ­dia:\x20','getBodyMessage','captureException','../../models/Whatsapp','remoteJid','getQuotedMessageId','ack','verifyRecentCampaign','image','*Mensagem\x20AutomÃ¡tica*:\x0aNosso\x20sistema\x20aceita\x20apenas\x20arquivos\x20com\x20no\x20mÃ¡ximo\x20','ðŸ“Ž\x20','../../models/Ticket','lodash','then','\x20bytes','isGroup','-ticket','contact','count','getUnpackedMessage','substring','split','writable','replace','value','Erro\x20ao\x20processar\x20integraÃ§Ã£o\x20para\x20fila\x20escolhida:','\x27\x20THEN\x200\x20ELSE\x201\x20END','code','literal','participant','includes','verifyMediaMessage','campaignQueue','companyId','\x20MiB','canUpload','dataJson','1376928iRCJBg','update','findByPk','../WhatsappService/ShowWhatsAppService','text','message','useIntegration','imageMessage','getTypeEditedMessage','downloadContentFromMessage','upsert','promisify','743805ZVyjGO','[saveMediaToFile]\x20Empresa\x20','ratingAt','thumbnail-document','\x20vinculado','contactId','../StorageService/StorageService','fromMe','public','reload','quotedMsgId','../../helpers/ExtractPhoneNumber','existsSync','../../utils/logger','toString','getOwnPropertyDescriptor','documentMessage','queueId','@sentry/node','integrationId','../MessageServices/CreateMessageService','error','userId','2721162vsIUqX','https://','Throttle','indexOf','remoteJidAlt','mimetype','../../helpers/CheckSettings','map','../../models/Contact','findAll','Fila\x20#','122304ZsvmXz','.\x20MÃ­dia\x20nÃ£o\x20serÃ¡\x20salva.','../../models/Message','queue','IntegraÃ§Ã£o\x20#','normalizeMediaType','findOne','sequelize','467hrzoFC','forEach','../../libs/socket','call','@newsletter','verifyEditedMessage','closed','maxUseBotQueues','CASE\x20WHEN\x20number\x20=\x20\x27','getMessageMedia','\x20-\x20canUpload:\x20','Erro\x20ao\x20processar\x20integraÃ§Ã£o\x20para\x20fila\x20Ãºnica:','getTime','setExtra','ticketId','url','__esModule','document','lid','resolve','company-','verifyDeleteMessage','>>>>\x20erro\x20','add','documentWithCaptionMessage','amountUsedBotQueues','STORAGE_LIMIT_EXCEEDED','stringify','flowBuilderId','moment'];a695_0x7d4d=function(){return _0x598299;};return a695_0x7d4d();}const a695_0xc3f8e8=a695_0x26a0;(function(_0x91fcc1,_0x4339d7){const _0x4d4319=a695_0x26a0,_0x2a3d50=_0x91fcc1();while(!![]){try{const _0x36a9e4=-parseInt(_0x4d4319(0x241))/0x1*(-parseInt(_0x4d4319(0x1e0))/0x2)+-parseInt(_0x4d4319(0x20b))/0x3+parseInt(_0x4d4319(0x1a0))/0x4+-parseInt(_0x4d4319(0x18b))/0x5*(parseInt(_0x4d4319(0x22e))/0x6)+parseInt(_0x4d4319(0x239))/0x7+parseInt(_0x4d4319(0x1db))/0x8*(parseInt(_0x4d4319(0x217))/0x9)+-parseInt(_0x4d4319(0x1be))/0xa;if(_0x36a9e4===_0x4339d7)break;else _0x2a3d50['push'](_0x2a3d50['shift']());}catch(_0x519085){_0x2a3d50['push'](_0x2a3d50['shift']());}}}(a695_0x7d4d,0xb66d7));var __createBinding=this&&this[a695_0xc3f8e8(0x1c5)]||(Object[a695_0xc3f8e8(0x183)]?function(_0x357672,_0x48c85a,_0x3ea2c6,_0x415ad1){const _0x5cdfad=a695_0xc3f8e8;if(_0x415ad1===undefined)_0x415ad1=_0x3ea2c6;var _0x48b047=Object[_0x5cdfad(0x226)](_0x48c85a,_0x3ea2c6);(!_0x48b047||('get'in _0x48b047?!_0x48c85a['__esModule']:_0x48b047[_0x5cdfad(0x1fc)]||_0x48b047['configurable']))&&(_0x48b047={'enumerable':!![],'get':function(){return _0x48c85a[_0x3ea2c6];}}),Object['defineProperty'](_0x357672,_0x415ad1,_0x48b047);}:function(_0x2b36a1,_0x58fec4,_0x563920,_0x1b6149){if(_0x1b6149===undefined)_0x1b6149=_0x563920;_0x2b36a1[_0x1b6149]=_0x58fec4[_0x563920];}),__setModuleDefault=this&&this[a695_0xc3f8e8(0x1b6)]||(Object[a695_0xc3f8e8(0x183)]?function(_0x374895,_0x2383c9){Object['defineProperty'](_0x374895,'default',{'enumerable':!![],'value':_0x2383c9});}:function(_0x35b757,_0x59fe63){_0x35b757['default']=_0x59fe63;}),__importStar=this&&this['__importStar']||(function(){const _0x153923=(function(){let _0x4579f2=!![];return function(_0x187bec,_0x4ccd89){const _0x5f5da4=_0x4579f2?function(){const _0x375150=a695_0x26a0;if(_0x4ccd89){const _0x5d0cfd=_0x4ccd89[_0x375150(0x176)](_0x187bec,arguments);return _0x4ccd89=null,_0x5d0cfd;}}:function(){};return _0x4579f2=![],_0x5f5da4;};}()),_0x34143a=_0x153923(this,function(){const _0xf082f3=a695_0x26a0;return _0x34143a['toString']()[_0xf082f3(0x1cb)]('(((.+)+)+)+$')[_0xf082f3(0x225)]()['constructor'](_0x34143a)['search'](_0xf082f3(0x186));});_0x34143a();var _0x33a719=function(_0x22e1a2){const _0x94b70a=a695_0x26a0;return _0x33a719=Object[_0x94b70a(0x19b)]||function(_0x4e5415){const _0xe67d3f=_0x94b70a;var _0x30556b=[];for(var _0x2cbfec in _0x4e5415)if(Object['prototype']['hasOwnProperty'][_0xe67d3f(0x244)](_0x4e5415,_0x2cbfec))_0x30556b[_0x30556b[_0xe67d3f(0x170)]]=_0x2cbfec;return _0x30556b;},_0x33a719(_0x22e1a2);};return function(_0x4ea38c){const _0xa63c82=a695_0x26a0;if(_0x4ea38c&&_0x4ea38c['__esModule'])return _0x4ea38c;var _0x461d4b={};if(_0x4ea38c!=null){for(var _0x4d7ec7=_0x33a719(_0x4ea38c),_0x418268=0x0;_0x418268<_0x4d7ec7['length'];_0x418268++)if(_0x4d7ec7[_0x418268]!==_0xa63c82(0x1c1))__createBinding(_0x461d4b,_0x4ea38c,_0x4d7ec7[_0x418268]);}return __setModuleDefault(_0x461d4b,_0x4ea38c),_0x461d4b;};}()),__importDefault=this&&this[a695_0xc3f8e8(0x1a8)]||function(_0x20fda6){const _0x457cb6=a695_0xc3f8e8;return _0x20fda6&&_0x20fda6[_0x457cb6(0x161)]?_0x20fda6:{'default':_0x20fda6};};Object[a695_0xc3f8e8(0x18f)](exports,a695_0xc3f8e8(0x161),{'value':!![]}),exports['verifyRecentCampaign']=exports[a695_0xc3f8e8(0x1c0)]=exports['verifyQueue']=exports[a695_0xc3f8e8(0x166)]=exports[a695_0xc3f8e8(0x246)]=exports[a695_0xc3f8e8(0x205)]=exports[a695_0xc3f8e8(0x1ce)]=exports[a695_0xc3f8e8(0x1a2)]=exports['normalizeThumbnailMediaType']=exports[a695_0xc3f8e8(0x23e)]=void 0x0;const Message_1=__importDefault(require(a695_0xc3f8e8(0x23b))),Ticket_1=__importDefault(require(a695_0xc3f8e8(0x1f1))),Contact_1=__importDefault(require(a695_0xc3f8e8(0x236))),socket_1=require(a695_0xc3f8e8(0x243)),baileys_1=require('@whiskeysockets/baileys'),CreateMessageService_1=__importDefault(require(a695_0xc3f8e8(0x22b))),GetHandlers_1=require(a695_0xc3f8e8(0x181)),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a695_0xc3f8e8(0x1cc))),Sentry=__importStar(require(a695_0xc3f8e8(0x229))),CreateOrUpdateContactService_1=__importDefault(require(a695_0xc3f8e8(0x1bf))),stream_throttle_1=require('stream-throttle'),MakeRandomId_1=require(a695_0xc3f8e8(0x1e1)),CheckSettings_1=__importDefault(require(a695_0xc3f8e8(0x234))),GetHandlers_2=require('./GetHandlers'),logger_1=require(a695_0xc3f8e8(0x224)),util_1=require(a695_0xc3f8e8(0x171)),fs_1=__importStar(require('fs')),path_1=__importDefault(require('path')),OldMessage_1=__importDefault(require(a695_0xc3f8e8(0x1d3))),ShowWhatsAppService_1=__importDefault(require(a695_0xc3f8e8(0x20e))),lodash_1=require(a695_0xc3f8e8(0x1f2)),ShowQueueIntegrationService_1=__importDefault(require('../QueueIntegrationServices/ShowQueueIntegrationService')),wbotMessageListener_1=require('./wbotMessageListener'),Setting_1=__importDefault(require(a695_0xc3f8e8(0x1b2))),Campaign_1=__importDefault(require(a695_0xc3f8e8(0x189))),CampaignShipping_1=__importDefault(require(a695_0xc3f8e8(0x18e))),moment_1=__importDefault(require(a695_0xc3f8e8(0x16e))),queues_1=require(a695_0xc3f8e8(0x1c9)),sequelize_1=require(a695_0xc3f8e8(0x240)),SendWhatsAppMessage_1=__importDefault(require(a695_0xc3f8e8(0x185))),SendWhatsAppMedia_1=__importDefault(require(a695_0xc3f8e8(0x1dc))),Whatsapp_1=__importDefault(require(a695_0xc3f8e8(0x1e9))),ExtractPhoneNumber_1=require(a695_0xc3f8e8(0x222)),StorageService_1=__importDefault(require(a695_0xc3f8e8(0x21d))),writeFileAsync=(0x0,util_1[a695_0xc3f8e8(0x216)])(fs_1['writeFile']),saveMediaToFile=async(_0x41270c,_0x1f2639)=>{const _0x37d58f=a695_0xc3f8e8;if(!_0x41270c[_0x37d58f(0x178)]){const _0x3e648f=_0x41270c['mimetype'][_0x37d58f(0x1fb)]('/')[0x1]['split'](';')[0x0];_0x41270c[_0x37d58f(0x178)]=new Date()[_0x37d58f(0x15d)]()+'.'+_0x3e648f;}const _0x46a361=(0x0,MakeRandomId_1[_0x37d58f(0x182)])(0xa),_0x253ded=_0x1f2639['contactId']+'/'+_0x1f2639['id']+'/'+_0x46a361,_0x1770d1=_0x41270c['data']?typeof _0x41270c[_0x37d58f(0x1ae)]===_0x37d58f(0x1d8)?Buffer[_0x37d58f(0x1a4)](_0x41270c[_0x37d58f(0x1ae)],'base64')['length']:_0x41270c[_0x37d58f(0x1ae)]['length']:0x0;logger_1[_0x37d58f(0x1d2)]['info'](_0x37d58f(0x218)+_0x1f2639[_0x37d58f(0x207)]+_0x37d58f(0x190)+_0x1770d1+_0x37d58f(0x1f4));const _0x33d1a9=await StorageService_1['default'][_0x37d58f(0x209)](_0x1f2639[_0x37d58f(0x207)],_0x1770d1);logger_1['logger'][_0x37d58f(0x18c)](_0x37d58f(0x218)+_0x1f2639[_0x37d58f(0x207)]+_0x37d58f(0x15b)+_0x33d1a9);if(!_0x33d1a9)return logger_1[_0x37d58f(0x1d2)][_0x37d58f(0x1b7)]('[saveMediaToFile]\x20Limite\x20de\x20armazenamento\x20atingido\x20para\x20empresa\x20'+_0x1f2639[_0x37d58f(0x207)]+_0x37d58f(0x23a)),_0x37d58f(0x16b);try{const _0x2b0749=await StorageService_1[_0x37d58f(0x1c1)][_0x37d58f(0x1b1)](_0x1f2639[_0x37d58f(0x207)],_0x253ded,_0x41270c[_0x37d58f(0x178)],_0x41270c[_0x37d58f(0x1ae)],_0x41270c['mimetype']);return _0x2b0749[_0x37d58f(0x160)];}catch(_0x3898b4){Sentry['captureException'](_0x3898b4),logger_1[_0x37d58f(0x1d2)]['error'](_0x37d58f(0x1e6)+_0x3898b4[_0x37d58f(0x210)]);if(_0x3898b4[_0x37d58f(0x201)]===_0x37d58f(0x1e3)||_0x3898b4[_0x37d58f(0x210)]?.['includes'](_0x37d58f(0x1b5))||_0x3898b4[_0x37d58f(0x210)]?.[_0x37d58f(0x204)](_0x37d58f(0x174)))return logger_1['logger'][_0x37d58f(0x1b7)](_0x37d58f(0x1ac)+_0x1f2639[_0x37d58f(0x207)]),_0x37d58f(0x16b);return _0x37d58f(0x1c8);}},normalizeMediaType=_0x15eb98=>{const _0x2c717a=a695_0xc3f8e8,_0x1b6e35=[_0x2c717a(0x1cf),_0x2c717a(0x17c),_0x2c717a(0x1ee),_0x2c717a(0x162)],_0x4711f2=_0x15eb98[_0x2c717a(0x1fb)]('/')[0x0];if(!_0x1b6e35['includes'](_0x4711f2))return'document';return _0x4711f2;};exports[a695_0xc3f8e8(0x23e)]=normalizeMediaType;const normalizeThumbnailMediaType=_0x3deb6e=>{const _0xafce7f=a695_0xc3f8e8,_0x207dd4=['thumbnail-video','thumbnail-image',_0xafce7f(0x21a)],_0x179057=_0x3deb6e['split']('/')[0x0];if(!_0x207dd4[_0xafce7f(0x204)](_0xafce7f(0x17e)+_0x179057))return _0xafce7f(0x21a);return _0x179057;};exports[a695_0xc3f8e8(0x1a5)]=normalizeThumbnailMediaType;const downloadMedia=async(_0x312b69,_0x134ba8,_0x6c496d)=>{const _0x3e61a0=a695_0xc3f8e8,_0x236a2e=(0x0,GetHandlers_2[_0x3e61a0(0x1f9)])(_0x312b69),_0x293859=(0x0,GetHandlers_2[_0x3e61a0(0x15a)])(_0x236a2e);if(!_0x293859)return null;const _0x21d2fe=parseInt(await(0x0,CheckSettings_1['default'])(_0x3e61a0(0x1cd),'15'),0xa);if(_0x134ba8&&_0x293859?.['fileLength']&&+_0x293859[_0x3e61a0(0x1df)]>_0x21d2fe*0x400*0x400){const _0x28f3a8=_0x3e61a0(0x1ef)+_0x21d2fe+_0x3e61a0(0x208);if(!_0x6c496d[_0x3e61a0(0x1f5)]){const _0x19ec59=await(0x0,SendWhatsAppMessage_1[_0x3e61a0(0x1c1)])({'ticket':_0x6c496d,'body':_0x28f3a8});_0x19ec59['message'][_0x3e61a0(0x17b)]['text']=_0x3e61a0(0x17f);}throw new Error('ERR_FILESIZE_OVER_LIMIT');}const _0x580029=_0x236a2e?.['documentMessage']?'document':(0x0,exports['normalizeMediaType'])(_0x293859[_0x3e61a0(0x233)]);let _0x5efafc,_0x20e042=0x0;while(_0x20e042<0xa&&!_0x5efafc){try{const _0x377c35={..._0x293859};_0x377c35?.['directPath']&&(_0x377c35[_0x3e61a0(0x160)]=''),_0x5efafc=await(0x0,baileys_1[_0x3e61a0(0x214)])(_0x377c35,_0x580029);}catch(_0x14816c){_0x20e042+=0x1,await new Promise(_0x4b8e7b=>{setTimeout(_0x4b8e7b,0x3e8*_0x20e042*0x2);}),logger_1['logger']['warn'](_0x3e61a0(0x167)+_0x20e042+_0x3e61a0(0x1e5)+_0x312b69?.['key']?.['id']);}}if(!_0x5efafc)throw new Error(_0x3e61a0(0x18a));const _0x412425=await downloadStream(_0x5efafc);if(!_0x412425){Sentry[_0x3e61a0(0x15e)]('ERR_WAPP_DOWNLOAD_MEDIA',{'msg':_0x312b69}),Sentry[_0x3e61a0(0x1e8)](new Error('ERR_WAPP_DOWNLOAD_MEDIA'));throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');}let _0x5cabec=_0x236a2e?.[_0x3e61a0(0x227)]?.['fileName']||'';if(!_0x5cabec){const _0x34493e=_0x293859[_0x3e61a0(0x233)][_0x3e61a0(0x1fb)]('/')[0x1][_0x3e61a0(0x1fb)](';')[0x0];_0x5cabec=(0x0,MakeRandomId_1[_0x3e61a0(0x182)])(0x5)+'-'+new Date()[_0x3e61a0(0x15d)]()+'.'+_0x34493e;}else _0x5cabec=_0x5cabec['split']('.')[_0x3e61a0(0x1b4)](0x0,-0x1)['join']('.')+'.'+(0x0,MakeRandomId_1[_0x3e61a0(0x182)])(0x5)+'.'+_0x5cabec['split']('.')['slice'](-0x1);const _0x9e3c87={'data':_0x412425,'mimetype':_0x293859['mimetype'],'filename':_0x5cabec};return _0x9e3c87;},downloadStream=async _0x222c2f=>{const _0x3422d0=a695_0xc3f8e8,_0x42fed9=0x5*0x400*0x400/0x8,_0x16c799=0x400*0x400/0x8,_0x484124=0x400*0x400,_0x1bec97=new stream_throttle_1[(_0x3422d0(0x230))]({'rate':_0x42fed9});let _0x157d70=Buffer[_0x3422d0(0x1a4)]([]),_0x3b640a=0x0;try{for await(const _0x37e4bb of _0x222c2f[_0x3422d0(0x17a)](_0x1bec97)){_0x157d70=Buffer[_0x3422d0(0x1de)]([_0x157d70,_0x37e4bb]),_0x3b640a+=_0x37e4bb[_0x3422d0(0x170)],_0x3b640a>_0x484124&&(_0x1bec97[_0x3422d0(0x195)]=_0x16c799);}}catch(_0x15f909){Sentry[_0x3422d0(0x15e)]('ERR_WAPP_DOWNLOAD_MEDIA',{'error':_0x15f909}),Sentry[_0x3422d0(0x1e8)](new Error(_0x3422d0(0x1e4)));throw new Error(_0x3422d0(0x1e4));}return _0x157d70;},downloadThumbnail=async({thumbnailDirectPath:_0x131d79,mediaKey:_0x38b788,mimetype:_0x24ca5})=>{const _0x247f1e=a695_0xc3f8e8;if(!_0x131d79||!_0x38b788)return null;const _0x3bd791=await(0x0,baileys_1[_0x247f1e(0x214)])({'mediaKey':_0x38b788,'directPath':_0x131d79},_0x24ca5?(0x0,exports[_0x247f1e(0x1a5)])(_0x24ca5):'thumbnail-link');if(!_0x3bd791)throw new Error(_0x247f1e(0x18a));const _0x2907a8=await downloadStream(_0x3bd791);if(!_0x2907a8)throw new Error(_0x247f1e(0x1e4));const _0x4cf870='thumbnail-'+(0x0,MakeRandomId_1[_0x247f1e(0x182)])(0x5)+'-'+new Date()['getTime']()+'.jpg',_0x138c7f={'data':_0x2907a8,'mimetype':'image/jpeg','filename':_0x4cf870};return _0x138c7f;},verifyMessage=async(_0x319fe1,_0x3cac60,_0x10fde2,_0x3be9a8=null,_0x22b756=null)=>{const _0x5a9ba6=a695_0xc3f8e8,_0x3cf151=(0x0,socket_1[_0x5a9ba6(0x1bc)])(),_0x401693=await verifyQuotedMessage(_0x319fe1),_0x9d6ecd=(0x0,GetHandlers_1[_0x5a9ba6(0x1e7)])(_0x319fe1),_0x14feba={'id':_0x319fe1['key']['id'],'ticketId':_0x3cac60['id'],'userId':_0x3be9a8,'contactId':_0x319fe1[_0x5a9ba6(0x188)][_0x5a9ba6(0x21e)]?undefined:_0x10fde2['id'],'body':_0x9d6ecd,'fromMe':_0x319fe1[_0x5a9ba6(0x188)]['fromMe'],'mediaType':_0x319fe1['message'][_0x5a9ba6(0x1da)]?_0x5a9ba6(0x1da):null,'read':_0x319fe1[_0x5a9ba6(0x188)]['fromMe'],'quotedMsgId':_0x401693?.['id'],'ack':_0x319fe1[_0x5a9ba6(0x172)]||(_0x319fe1[_0x5a9ba6(0x188)][_0x5a9ba6(0x21e)]?0x1:0x0),'remoteJid':_0x319fe1[_0x5a9ba6(0x188)]['remoteJid'],'participant':_0x319fe1[_0x5a9ba6(0x188)][_0x5a9ba6(0x203)],'dataJson':JSON[_0x5a9ba6(0x16c)](_0x319fe1),'isEdited':![]};await _0x3cac60[_0x5a9ba6(0x20c)]({'lastMessage':_0x9d6ecd[_0x5a9ba6(0x1fa)](0x0,0xff)[_0x5a9ba6(0x1fd)](/\n/g,'\x20')});const _0x431527=await(0x0,CreateMessageService_1[_0x5a9ba6(0x1c1)])({'messageData':_0x14feba,'companyId':_0x3cac60[_0x5a9ba6(0x207)]});if(!_0x319fe1[_0x5a9ba6(0x188)]['fromMe']){const _0x3066cd=_0x319fe1[_0x5a9ba6(0x188)],_0x3a2fcd=_0x319fe1['key'][_0x5a9ba6(0x1ea)],_0x205c22=_0x3066cd[_0x5a9ba6(0x232)];let _0x44b4d9=null,_0x431f53=null;if(_0x3a2fcd?.[_0x5a9ba6(0x204)](_0x5a9ba6(0x1c3)))_0x44b4d9=_0x3a2fcd,_0x431f53=_0x205c22;else _0x3a2fcd?.['includes']('@lid')&&(_0x431f53=_0x3a2fcd,_0x44b4d9=_0x205c22);const _0x41aa0b=_0x44b4d9?.[_0x5a9ba6(0x1fb)]('@')[0x0],_0x567725=_0x431f53?.[_0x5a9ba6(0x1fb)]('@')[0x0],_0x2da99e=_0x41aa0b&&_0x41aa0b!==_0x10fde2[_0x5a9ba6(0x19a)]||_0x567725&&_0x567725!==_0x10fde2['lid'];if(_0x2da99e){if(_0x41aa0b&&_0x41aa0b!==_0x10fde2[_0x5a9ba6(0x19a)]){const _0x1b5e12=await Contact_1['default'][_0x5a9ba6(0x23f)]({'where':{'number':_0x41aa0b,'companyId':_0x10fde2[_0x5a9ba6(0x207)]}});if(_0x1b5e12&&_0x1b5e12['id']!==_0x10fde2['id']){await _0x3cac60[_0x5a9ba6(0x20c)]({'contactId':_0x1b5e12['id']}),await _0x431527[_0x5a9ba6(0x20c)]({'contactId':_0x1b5e12['id']});const _0x3f92ed={};_0x567725&&!_0x1b5e12[_0x5a9ba6(0x163)]&&(_0x3f92ed['lid']=_0x567725);_0x44b4d9&&!_0x1b5e12[_0x5a9ba6(0x1ea)]&&(_0x3f92ed[_0x5a9ba6(0x1ea)]=_0x44b4d9);const _0x50b28d=!_0x1b5e12[_0x5a9ba6(0x1d6)]||_0x1b5e12[_0x5a9ba6(0x1d6)]===''||_0x1b5e12['profilePicUrl']===process[_0x5a9ba6(0x175)][_0x5a9ba6(0x1a6)]+'/nopicture.png';if(_0x50b28d&&_0x22b756)try{const _0x3bb350=_0x431f53||_0x44b4d9||_0x3a2fcd,_0x3d9963=await _0x22b756['profilePictureUrl'](_0x3bb350);_0x3d9963&&_0x3d9963!==process[_0x5a9ba6(0x175)][_0x5a9ba6(0x1a6)]+_0x5a9ba6(0x1dd)&&(_0x3f92ed['profilePicUrl']=_0x3d9963);}catch(_0x3de742){}Object[_0x5a9ba6(0x1bd)](_0x3f92ed)['length']>0x0&&await _0x1b5e12[_0x5a9ba6(0x20c)](_0x3f92ed);const _0x17b468=await Ticket_1[_0x5a9ba6(0x1c1)][_0x5a9ba6(0x1f8)]({'where':{'contactId':_0x10fde2['id']}});_0x17b468===0x0?(await _0x10fde2['destroy'](),console['log'](_0x5a9ba6(0x1e2)+_0x10fde2['id'])):console[_0x5a9ba6(0x18d)](_0x5a9ba6(0x1c4)+_0x10fde2['id']+'\x20(has\x20'+_0x17b468+_0x5a9ba6(0x1b9));return;}}const _0x2ff3a4={};_0x41aa0b&&_0x41aa0b!==_0x10fde2[_0x5a9ba6(0x19a)]&&(_0x2ff3a4[_0x5a9ba6(0x19a)]=_0x41aa0b),_0x567725&&_0x567725!==_0x10fde2[_0x5a9ba6(0x163)]&&(_0x2ff3a4[_0x5a9ba6(0x163)]=_0x567725),_0x44b4d9&&_0x44b4d9!==_0x10fde2[_0x5a9ba6(0x1ea)]&&(_0x2ff3a4[_0x5a9ba6(0x1ea)]=_0x44b4d9),Object[_0x5a9ba6(0x1bd)](_0x2ff3a4)[_0x5a9ba6(0x170)]>0x0&&(console[_0x5a9ba6(0x18d)]('[verifyMessage]\x20Updating\x20contact\x20'+_0x10fde2['id']+':',_0x2ff3a4),await _0x10fde2['update'](_0x2ff3a4));}else console[_0x5a9ba6(0x18d)](_0x5a9ba6(0x194)+_0x10fde2['id']+_0x5a9ba6(0x16f));}return!_0x319fe1[_0x5a9ba6(0x188)]['fromMe']&&_0x3cac60[_0x5a9ba6(0x172)]===_0x5a9ba6(0x247)&&(await _0x3cac60[_0x5a9ba6(0x20c)]({'status':_0x5a9ba6(0x199)}),await _0x3cac60['reload']({'include':[{'model':Queue_1[_0x5a9ba6(0x1c1)],'as':_0x5a9ba6(0x23c)},{'model':User_1['default'],'as':_0x5a9ba6(0x1a7)},{'model':Contact_1[_0x5a9ba6(0x1c1)],'as':'contact'}]}),_0x3cf151['to']('company-'+_0x3cac60[_0x5a9ba6(0x207)]+'-closed')['to'](_0x5a9ba6(0x197)+_0x3cac60['queueId']+'-closed')[_0x5a9ba6(0x1ca)](_0x5a9ba6(0x165)+_0x3cac60[_0x5a9ba6(0x207)]+_0x5a9ba6(0x1f6),{'action':_0x5a9ba6(0x191),'ticket':_0x3cac60,'ticketId':_0x3cac60['id']}),_0x3cf151['to'](_0x5a9ba6(0x165)+_0x3cac60[_0x5a9ba6(0x207)]+'-'+_0x3cac60[_0x5a9ba6(0x172)])['to'](_0x5a9ba6(0x197)+_0x3cac60[_0x5a9ba6(0x228)]+'-'+_0x3cac60[_0x5a9ba6(0x172)])['to'](_0x3cac60['id'][_0x5a9ba6(0x225)]())['emit'](_0x5a9ba6(0x165)+_0x3cac60['companyId']+'-ticket',{'action':_0x5a9ba6(0x20c),'ticket':_0x3cac60,'ticketId':_0x3cac60['id']})),_0x431527;};exports[a695_0xc3f8e8(0x1a2)]=verifyMessage;const verifyQuotedMessage=async _0x3c5582=>{const _0x2dee8d=a695_0xc3f8e8;if(!_0x3c5582)return null;const _0x444b48=(0x0,GetHandlers_1[_0x2dee8d(0x1eb)])(_0x3c5582);if(!_0x444b48)return null;const _0x57ae5d=await Message_1['default'][_0x2dee8d(0x23f)]({'where':{'id':_0x444b48}});if(!_0x57ae5d)return null;return _0x57ae5d;},verifyContact=async(_0xd7b74a,_0x218604,_0x2b57e5,_0x123d6c)=>{const _0x48fd95=a695_0xc3f8e8;if(_0xd7b74a['id']?.[_0x48fd95(0x180)](_0x48fd95(0x245)))return logger_1['logger'][_0x48fd95(0x18c)](_0x48fd95(0x1d9)+_0xd7b74a['id']),null;let _0x1d99f8;try{_0x1d99f8=await _0x218604[_0x48fd95(0x193)](_0xd7b74a['id']);}catch(_0x35f24d){Sentry[_0x48fd95(0x1e8)](_0x35f24d),_0x1d99f8=process[_0x48fd95(0x175)][_0x48fd95(0x1a6)]+_0x48fd95(0x1dd);}const _0x1d808e=(0x0,ExtractPhoneNumber_1['getPhoneNumberFromJid'])(_0xd7b74a['id']),_0x3900fc=_0xd7b74a['id'][_0x48fd95(0x204)]('@lid'),_0x205a90=_0x3900fc?_0xd7b74a['id'][_0x48fd95(0x1fb)]('@')[0x0]:null;if(_0x123d6c&&_0x3900fc){const _0x205fa9=_0x123d6c[_0x48fd95(0x1fb)]('@')[0x0],_0x6b488=await Contact_1[_0x48fd95(0x1c1)]['findOne']({'where':{'companyId':_0x2b57e5,[sequelize_1['Op']['or']]:[{'number':_0x205fa9},{'number':_0x205a90},{'lid':_0x205a90}]},'order':[[(0x0,sequelize_1[_0x48fd95(0x202)])(_0x48fd95(0x159)+_0x205fa9+_0x48fd95(0x200)),_0x48fd95(0x196)]]});if(_0x6b488){const _0x108c22={};_0x6b488[_0x48fd95(0x19a)]===_0x205a90&&(_0x108c22['number']=_0x205fa9);_0x205a90&&!_0x6b488[_0x48fd95(0x163)]&&(_0x108c22[_0x48fd95(0x163)]=_0x205a90);(!_0x6b488[_0x48fd95(0x1ea)]||_0x6b488['remoteJid'][_0x48fd95(0x204)](_0x48fd95(0x173)))&&(_0x108c22['remoteJid']=_0x123d6c);const _0x6dfefd=!_0x6b488[_0x48fd95(0x1d6)]||_0x6b488['profilePicUrl']===''||_0x6b488['profilePicUrl']===process['env'][_0x48fd95(0x1a6)]+'/nopicture.png';return _0x6dfefd&&_0x1d99f8&&_0x1d99f8!==process['env']['FRONTEND_URL']+_0x48fd95(0x1dd)&&(_0x108c22[_0x48fd95(0x1d6)]=_0x1d99f8),Object[_0x48fd95(0x1bd)](_0x108c22)[_0x48fd95(0x170)]>0x0&&await _0x6b488[_0x48fd95(0x20c)](_0x108c22),_0x6b488;}const _0x5c1c1b={'name':_0xd7b74a?.[_0x48fd95(0x198)]||_0x205fa9||_0xd7b74a['id'][_0x48fd95(0x1fd)](/\D/g,''),'number':_0x205fa9,'profilePicUrl':_0x1d99f8,'isGroup':_0xd7b74a['id'][_0x48fd95(0x204)]('g.us'),'companyId':_0x2b57e5,'remoteJid':_0x123d6c,'lid':_0x205a90},_0x5835a6=(0x0,CreateOrUpdateContactService_1[_0x48fd95(0x1c1)])(_0x5c1c1b);return _0x5835a6;}const _0x2ff619={'name':_0xd7b74a?.[_0x48fd95(0x198)]||_0x1d808e||_0xd7b74a['id'][_0x48fd95(0x1fd)](/\D/g,''),'number':_0x1d808e||_0xd7b74a['id'][_0x48fd95(0x1fa)](0x0,_0xd7b74a['id'][_0x48fd95(0x231)]('@')),'profilePicUrl':_0x1d99f8,'isGroup':_0xd7b74a['id'][_0x48fd95(0x204)](_0x48fd95(0x177)),'companyId':_0x2b57e5,'remoteJid':_0xd7b74a['id'],'lid':_0x205a90},_0x422c51=(0x0,CreateOrUpdateContactService_1[_0x48fd95(0x1c1)])(_0x2ff619);return _0x422c51;};exports[a695_0xc3f8e8(0x1ce)]=verifyContact;const verifyMediaMessage=async(_0x3191f3,_0x5e095c,_0x54437a,_0x53e188=null,_0x4574cc=null,_0x4458c7=null)=>{const _0x5ab66e=a695_0xc3f8e8,_0x4b29ac=(0x0,socket_1[_0x5ab66e(0x1bc)])(),_0x1a3ab7=await verifyQuotedMessage(_0x3191f3),_0x4c31bd=_0x4574cc||_0x3191f3?.[_0x5ab66e(0x210)]?.['extendedTextMessage'],_0xb57bc0=_0x4c31bd&&await downloadThumbnail(_0x4c31bd),_0x9ba647=await downloadMedia(_0x3191f3,_0x53e188,_0x5e095c);if(!_0x9ba647&&!_0xb57bc0)throw new Error(_0x5ab66e(0x1e4));let _0x37f13e=null;_0x9ba647&&(_0x37f13e=await saveMediaToFile(_0x9ba647,_0x5e095c));let _0x4c1505=null;_0xb57bc0&&(_0x4c1505=await saveMediaToFile(_0xb57bc0,_0x5e095c));const _0x4b33f9=(0x0,GetHandlers_1['getBodyMessage'])(_0x3191f3),_0x410f12={'id':_0x3191f3[_0x5ab66e(0x188)]['id'],'ticketId':_0x5e095c['id'],'userId':_0x4458c7,'contactId':_0x3191f3[_0x5ab66e(0x188)][_0x5ab66e(0x21e)]?undefined:_0x54437a['id'],'body':_0x4b33f9||'','fromMe':_0x3191f3[_0x5ab66e(0x188)]['fromMe'],'read':_0x3191f3[_0x5ab66e(0x188)]['fromMe'],'mediaUrl':_0x37f13e,'mediaType':_0x9ba647?.[_0x5ab66e(0x233)][_0x5ab66e(0x1fb)]('/')[0x0],'thumbnailUrl':_0x4c1505,'quotedMsgId':_0x1a3ab7?.['id'],'ack':_0x3191f3['status']||(_0x3191f3[_0x5ab66e(0x188)][_0x5ab66e(0x21e)]?0x1:0x0),'remoteJid':_0x3191f3['key'][_0x5ab66e(0x1ea)],'participant':_0x3191f3[_0x5ab66e(0x188)][_0x5ab66e(0x203)],'dataJson':JSON[_0x5ab66e(0x16c)](_0x3191f3)};await _0x5e095c[_0x5ab66e(0x20c)]({'lastMessage':_0x4b33f9||_0x9ba647?.[_0x5ab66e(0x178)]?_0x5ab66e(0x1f0)+_0x9ba647?.[_0x5ab66e(0x178)]:''});const _0x7cc4b9=await(0x0,CreateMessageService_1[_0x5ab66e(0x1c1)])({'messageData':_0x410f12,'companyId':_0x5e095c['companyId']});if(!_0x3191f3[_0x5ab66e(0x188)]['fromMe']){const _0x371567=_0x3191f3[_0x5ab66e(0x188)],_0x4d97f3=_0x3191f3['key'][_0x5ab66e(0x1ea)],_0x29719a=_0x371567[_0x5ab66e(0x232)];let _0x16ad07=null;if(_0x4d97f3?.[_0x5ab66e(0x204)](_0x5ab66e(0x1c3)))_0x16ad07=_0x4d97f3;else _0x4d97f3?.[_0x5ab66e(0x204)](_0x5ab66e(0x173))&&(_0x16ad07=_0x29719a);if(_0x16ad07){const _0x281b27=_0x16ad07[_0x5ab66e(0x1fb)]('@')[0x0];if(_0x281b27!==_0x54437a[_0x5ab66e(0x19a)]){const _0xafcc22={'number':_0x281b27,'remoteJid':_0x16ad07};_0x54437a['profilePicUrl']&&_0x54437a[_0x5ab66e(0x1d6)]!==process[_0x5ab66e(0x175)][_0x5ab66e(0x1a6)]+_0x5ab66e(0x1dd)&&(_0xafcc22['profilePicUrl']=_0x54437a[_0x5ab66e(0x1d6)]),await _0x54437a[_0x5ab66e(0x20c)](_0xafcc22);}}}return!_0x3191f3[_0x5ab66e(0x188)][_0x5ab66e(0x21e)]&&_0x5e095c[_0x5ab66e(0x172)]===_0x5ab66e(0x247)&&(await _0x5e095c['update']({'status':_0x5ab66e(0x199)}),await _0x5e095c[_0x5ab66e(0x220)]({'include':[{'model':Queue_1[_0x5ab66e(0x1c1)],'as':'queue'},{'model':User_1['default'],'as':_0x5ab66e(0x1a7)},{'model':Contact_1['default'],'as':_0x5ab66e(0x1f7)}]}),_0x4b29ac['to'](_0x5ab66e(0x165)+_0x5e095c[_0x5ab66e(0x207)]+_0x5ab66e(0x1a3))['to']('queue-'+_0x5e095c[_0x5ab66e(0x228)]+_0x5ab66e(0x1a3))['emit'](_0x5ab66e(0x165)+_0x5e095c[_0x5ab66e(0x207)]+_0x5ab66e(0x1f6),{'action':_0x5ab66e(0x191),'ticket':_0x5e095c,'ticketId':_0x5e095c['id']}),_0x4b29ac['to'](_0x5ab66e(0x165)+_0x5e095c[_0x5ab66e(0x207)]+'-'+_0x5e095c[_0x5ab66e(0x172)])['to'](_0x5ab66e(0x197)+_0x5e095c[_0x5ab66e(0x228)]+'-'+_0x5e095c[_0x5ab66e(0x172)])['to'](_0x5e095c['id'][_0x5ab66e(0x225)]())[_0x5ab66e(0x1ca)](_0x5ab66e(0x165)+_0x5e095c[_0x5ab66e(0x207)]+'-ticket',{'action':_0x5ab66e(0x20c),'ticket':_0x5e095c,'ticketId':_0x5e095c['id']})),_0x7cc4b9;};exports['verifyMediaMessage']=verifyMediaMessage;const verifyEditedMessage=async(_0x3daf07,_0x4dc5b3,_0x3fdbe5)=>{const _0x4cc48a=a695_0xc3f8e8,_0x17946b=(0x0,GetHandlers_2[_0x4cc48a(0x213)])(_0x3daf07);let _0x2785e7;switch(_0x17946b){case'conversation':{_0x2785e7=_0x3daf07['conversation'];break;}case'extendedTextMessage':{_0x2785e7=_0x3daf07[_0x4cc48a(0x17b)][_0x4cc48a(0x20f)];break;}case _0x4cc48a(0x212):{_0x2785e7=_0x3daf07[_0x4cc48a(0x212)]['caption'];break;}case _0x4cc48a(0x227):{_0x2785e7=_0x3daf07[_0x4cc48a(0x227)]['caption'];break;}case _0x4cc48a(0x169):{_0x2785e7=_0x3daf07[_0x4cc48a(0x169)][_0x4cc48a(0x210)][_0x4cc48a(0x227)][_0x4cc48a(0x1bb)];break;}default:{return;}}const _0x4e096d=await Message_1[_0x4cc48a(0x1c1)][_0x4cc48a(0x20d)](_0x3fdbe5),_0x1a864b={'id':_0x4e096d['id'],'ticketId':_0x4e096d[_0x4cc48a(0x15f)],'contactId':_0x4e096d[_0x4cc48a(0x21c)],'body':_0x2785e7,'fromMe':_0x4e096d[_0x4cc48a(0x21e)],'mediaType':_0x4e096d[_0x4cc48a(0x1ba)],'read':_0x4e096d['read'],'quotedMsgId':_0x4e096d[_0x4cc48a(0x221)],'ack':_0x4e096d[_0x4cc48a(0x1ec)],'remoteJid':_0x4e096d[_0x4cc48a(0x1ea)],'participant':_0x4e096d[_0x4cc48a(0x203)],'dataJson':_0x4e096d[_0x4cc48a(0x20a)],'isEdited':!![]},_0x7916f3={'messageId':_0x1a864b['id'],'body':_0x4e096d['body'],'ticketId':_0x4e096d['ticketId']};await OldMessage_1['default'][_0x4cc48a(0x215)](_0x7916f3),await _0x4dc5b3[_0x4cc48a(0x20c)]({'lastMessage':_0x1a864b['body']}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x1a864b,'companyId':_0x4dc5b3['companyId']});const _0x4451c7=(0x0,socket_1['getIO'])();_0x4451c7['to'](_0x4dc5b3[_0x4cc48a(0x172)])['to'](_0x4dc5b3['id']['toString']())[_0x4cc48a(0x1ca)]('company-'+_0x4dc5b3[_0x4cc48a(0x207)]+'-ticket',{'action':'update','ticket':_0x4dc5b3,'ticketId':_0x4dc5b3['id']});};exports['verifyEditedMessage']=verifyEditedMessage;const verifyDeleteMessage=async(_0x2bdeef,_0x506e4e)=>{const _0xa20d85=a695_0xc3f8e8,_0x5a886d=await Message_1['default'][_0xa20d85(0x20d)](_0x2bdeef['key']['id'],{'include':[_0xa20d85(0x1f7),{'model':Ticket_1[_0xa20d85(0x1c1)],'include':[{'model':Contact_1['default']}]}]});if(!_0x5a886d)return;await _0x5a886d[_0xa20d85(0x20c)]({'isDeleted':!![]});const _0x1893f0=(0x0,socket_1[_0xa20d85(0x1bc)])();_0x1893f0['to'](_0x5a886d[_0xa20d85(0x15f)][_0xa20d85(0x225)]())['to'](_0x5a886d['ticket'][_0xa20d85(0x172)])['to']('notification')['emit'](_0xa20d85(0x165)+_0x506e4e[_0xa20d85(0x207)]+_0xa20d85(0x1aa),{'action':'create','message':_0x5a886d,'ticket':_0x5a886d[_0xa20d85(0x19f)],'contact':_0x5a886d[_0xa20d85(0x19f)]['contact']});};exports[a695_0xc3f8e8(0x166)]=verifyDeleteMessage;const verifyQueue=async(_0x3b47d4,_0x263ea3,_0x497f81,_0x31211b)=>{const _0x193722=a695_0xc3f8e8;if(_0x263ea3?.[_0x193722(0x188)]['id']&&_0x497f81[_0x193722(0x19d)]===_0x263ea3[_0x193722(0x188)]['id']){console['log'](_0x193722(0x1d5)+_0x263ea3[_0x193722(0x188)]['id']+_0x193722(0x1b0)+_0x497f81['id']+_0x193722(0x1d0));return;}_0x263ea3?.[_0x193722(0x188)]['id']&&await _0x497f81[_0x193722(0x20c)]({'lastProcessedMessageId':_0x263ea3[_0x193722(0x188)]['id']});const _0xd65c0=await(0x0,ShowWhatsAppService_1[_0x193722(0x1c1)])(_0x3b47d4['id'],_0x497f81['companyId']),{queues:_0x5a8275,greetingMessage:_0x3adc72}=_0xd65c0,_0x3968e3=await Setting_1['default'][_0x193722(0x23f)]({'where':{'key':'chatBotType','companyId':_0x497f81['companyId']}});if(_0x5a8275[_0x193722(0x170)]===0x1){const _0x466b13=(0x0,lodash_1['head'])(_0x5a8275);if(!_0x466b13)return;await _0x497f81[_0x193722(0x20c)]({'amountUsedBotQueues':0x0});if(_0x466b13[_0x193722(0x16d)]){console[_0x193722(0x18d)](_0x193722(0x238)+_0x466b13['id']+'\x20('+_0x466b13['name']+_0x193722(0x1d1)+_0x466b13['flowBuilderId']+_0x193722(0x21b)),await _0x497f81['update']({'queueId':_0x466b13['id'],'flowBuilderId':_0x466b13[_0x193722(0x16d)],'chatbot':!![],'flowWebhook':![],'amountUsedBotQueues':0x0});const {handleFlowBuilderExecution:_0x4316ae}=await Promise[_0x193722(0x164)]()[_0x193722(0x1f3)](()=>__importStar(require('./wbotMessageListener')));await _0x4316ae(_0x497f81,_0x3b47d4);return;}if(!_0x497f81[_0x193722(0x211)]&&_0x466b13[_0x193722(0x22a)]&&!_0x263ea3?.[_0x193722(0x188)][_0x193722(0x21e)]&&!_0x497f81[_0x193722(0x1f5)])try{const _0x408089=await(0x0,ShowQueueIntegrationService_1[_0x193722(0x1c1)])(_0x466b13[_0x193722(0x22a)],_0x497f81[_0x193722(0x207)]);if(_0x408089){await _0x497f81['update']({'useIntegration':!![],'integrationId':_0x408089['id'],'amountUsedBotQueues':0x0});_0x263ea3&&await(0x0,wbotMessageListener_1[_0x193722(0x1b8)])(_0x263ea3,_0x3b47d4,_0x408089,_0x497f81);console[_0x193722(0x18d)](_0x193722(0x23d)+_0x408089['id']+'\x20iniciada\x20para\x20o\x20ticket\x20#'+_0x497f81['id']);return;}}catch(_0x145c1e){console['error'](_0x193722(0x15c),_0x145c1e),await _0x497f81[_0x193722(0x20c)]({'useIntegration':![],'integrationId':null});}await _0x497f81[_0x193722(0x20c)]({'queueId':_0x466b13['id'],'chatbot':![]});if(!_0x466b13[_0x193722(0x22a)]&&!_0x466b13[_0x193722(0x16d)]){_0x466b13[_0x193722(0x1ab)]&&await(0x0,SendWhatsAppMessage_1[_0x193722(0x1c1)])({'ticket':_0x497f81,'body':_0x466b13['greetingMessage']});if(_0x466b13[_0x193722(0x1b3)]){const _0x2669aa=_0x466b13[_0x193722(0x1b3)];if(_0x2669aa[_0x193722(0x19c)](_0x193722(0x1c6))||_0x2669aa[_0x193722(0x19c)](_0x193722(0x22f)))await(0x0,SendWhatsAppMedia_1[_0x193722(0x1c1)])({'media':_0x2669aa,'ticket':_0x497f81,'body':''});else{const _0x24297a=path_1[_0x193722(0x1c1)][_0x193722(0x164)](_0x193722(0x21f),_0x2669aa);fs_1['default'][_0x193722(0x223)](_0x24297a)&&await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x24297a,'ticket':_0x497f81,'body':''});}}}return;}const _0x39c216=_0x263ea3?(0x0,GetHandlers_1[_0x193722(0x1e7)])(_0x263ea3):null,_0x158fe5=_0x39c216?_0x5a8275[+_0x39c216-0x1]:null;if(_0x39c216==='0'){await _0x497f81['update']({'queueId':null,'chatbot':![],'flowBuilderId':null,'flowWebhook':![],'lastFlowId':null,'flowStopped':null,'hashFlowId':null,'dataWebhook':null,'amountUsedBotQueues':0x0});const _0x359297='VocÃª\x20saiu\x20do\x20menu.\x20Digite\x20*#*\x20para\x20voltar\x20ao\x20menu\x20principal.';await(0x0,SendWhatsAppMessage_1[_0x193722(0x1c1)])({'ticket':_0x497f81,'body':_0x359297});return;}if(_0x158fe5){await _0x497f81[_0x193722(0x20c)]({'amountUsedBotQueues':0x0});if(_0x158fe5['flowBuilderId']){console[_0x193722(0x18d)](_0x193722(0x1af)+_0x158fe5['id']+'\x20('+_0x158fe5['name']+_0x193722(0x1d1)+_0x158fe5[_0x193722(0x16d)]+_0x193722(0x21b)),await _0x497f81[_0x193722(0x20c)]({'queueId':_0x158fe5['id'],'flowBuilderId':_0x158fe5[_0x193722(0x16d)],'chatbot':!![],'flowWebhook':![],'amountUsedBotQueues':0x0});const {handleFlowBuilderExecution:_0x43c255}=await Promise['resolve']()[_0x193722(0x1f3)](()=>__importStar(require(_0x193722(0x1d4))));await _0x43c255(_0x497f81,_0x3b47d4);return;}if(!_0x497f81[_0x193722(0x211)]&&_0x158fe5['integrationId']&&!_0x263ea3?.['key'][_0x193722(0x21e)]&&!_0x497f81['isGroup'])try{const _0x2eebbf=await(0x0,ShowQueueIntegrationService_1['default'])(_0x158fe5[_0x193722(0x22a)],_0x497f81['companyId']);if(_0x2eebbf){await _0x497f81['update']({'useIntegration':!![],'integrationId':_0x2eebbf['id']}),await(0x0,wbotMessageListener_1['handleMessageIntegration'])(_0x263ea3,_0x3b47d4,_0x2eebbf,_0x497f81),console[_0x193722(0x18d)](_0x193722(0x23d)+_0x2eebbf['id']+_0x193722(0x187)+_0x497f81['id']);return;}}catch(_0x540d15){console[_0x193722(0x22c)](_0x193722(0x1ff),_0x540d15),await _0x497f81[_0x193722(0x20c)]({'useIntegration':![],'integrationId':null});}await _0x497f81[_0x193722(0x20c)]({'queueId':_0x158fe5['id'],'chatbot':![]});if(!_0x158fe5[_0x193722(0x22a)]&&!_0x158fe5[_0x193722(0x16d)]){_0x158fe5[_0x193722(0x1ab)]&&await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x497f81,'body':_0x158fe5[_0x193722(0x1ab)]});if(_0x158fe5[_0x193722(0x1b3)]){const _0x311151=_0x158fe5[_0x193722(0x1b3)];if(_0x311151[_0x193722(0x19c)]('http://')||_0x311151[_0x193722(0x19c)](_0x193722(0x22f)))await(0x0,SendWhatsAppMedia_1[_0x193722(0x1c1)])({'media':_0x311151,'ticket':_0x497f81,'body':''});else{const _0xa8850a=path_1['default']['resolve'](_0x193722(0x21f),_0x311151);fs_1[_0x193722(0x1c1)][_0x193722(0x223)](_0xa8850a)&&await(0x0,SendWhatsAppMedia_1[_0x193722(0x1c1)])({'media':_0xa8850a,'ticket':_0x497f81,'body':''});}}}return;}const _0x4ad557=await Whatsapp_1[_0x193722(0x1c1)][_0x193722(0x20d)](_0x497f81['whatsappId']);if(!_0x4ad557){console[_0x193722(0x22c)](_0x193722(0x1a1));return;}if(!_0x497f81[_0x193722(0x192)]&&_0x497f81[_0x193722(0x16a)]>=_0x4ad557['maxUseBotQueues'])return;if(_0x263ea3&&_0x39c216&&!_0x158fe5){if(_0x4ad557['maxUseBotQueues']&&_0x4ad557[_0x193722(0x158)]!==0x0&&_0x497f81[_0x193722(0x16a)]>=_0x4ad557['maxUseBotQueues']){await _0x497f81['update']({'chatbot':![],'amountUsedBotQueues':_0x4ad557[_0x193722(0x158)]});_0x4ad557['transferMessage']&&await(0x0,SendWhatsAppMessage_1[_0x193722(0x1c1)])({'ticket':_0x497f81,'body':_0x4ad557[_0x193722(0x184)]});return;}await _0x497f81[_0x193722(0x20c)]({'amountUsedBotQueues':_0x497f81[_0x193722(0x16a)]+0x1}),await _0x497f81[_0x193722(0x220)]();}const _0x306c7=async()=>{const _0x4ba663=_0x193722;let _0xbe28b3='';_0x5a8275[_0x4ba663(0x242)]((_0x38f433,_0xdc60b9)=>{const _0x34a72e=_0x4ba663;_0xbe28b3+='*'+(_0xdc60b9+0x1)+'*\x20-\x20'+_0x38f433[_0x34a72e(0x198)]+'\x0a';}),_0xbe28b3+=_0x4ba663(0x1c7);const _0xb29a9d=_0x3adc72+'\x0a\x0a'+_0xbe28b3;await(0x0,SendWhatsAppMessage_1[_0x4ba663(0x1c1)])({'ticket':_0x497f81,'body':_0xb29a9d});};switch(_0x3968e3?.[_0x193722(0x1fe)]){case'text':default:await _0x306c7();break;}};exports[a695_0xc3f8e8(0x179)]=verifyQueue;const verifyRating=_0x236fb5=>{const _0x1bcefd=a695_0xc3f8e8;if(_0x236fb5&&_0x236fb5[_0x1bcefd(0x1ad)]===null&&_0x236fb5[_0x1bcefd(0x22d)]!==null&&_0x236fb5[_0x1bcefd(0x219)]!==null)return!![];return![];};function a695_0x26a0(_0x28c29d,_0x94b882){const _0x556edc=a695_0x7d4d();return a695_0x26a0=function(_0x10a228,_0x51ad38){_0x10a228=_0x10a228-0x158;let _0x7d4d55=_0x556edc[_0x10a228];return _0x7d4d55;},a695_0x26a0(_0x28c29d,_0x94b882);}exports[a695_0xc3f8e8(0x1c0)]=verifyRating;const verifyRecentCampaign=async(_0x3b0857,_0x229beb)=>{const _0x20e730=a695_0xc3f8e8;if(!_0x3b0857[_0x20e730(0x188)][_0x20e730(0x21e)]){const _0x3f2e2d=(0x0,ExtractPhoneNumber_1['getPhoneNumberFromJid'])(_0x3b0857[_0x20e730(0x188)][_0x20e730(0x1ea)]),_0x8c9ee8=await Campaign_1[_0x20e730(0x1c1)][_0x20e730(0x237)]({'where':{'companyId':_0x229beb,'status':_0x20e730(0x1d7),'confirmation':!![]}});if(_0x8c9ee8){const _0x10ed73=_0x8c9ee8[_0x20e730(0x235)](_0x3bfc12=>_0x3bfc12['id']),_0x5801f5=await CampaignShipping_1['default'][_0x20e730(0x23f)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x10ed73},'number':_0x3f2e2d,'confirmation':null}});if(_0x5801f5)return await _0x5801f5[_0x20e730(0x20c)]({'confirmedAt':(0x0,moment_1[_0x20e730(0x1c1)])(),'confirmation':!![]}),await queues_1[_0x20e730(0x206)][_0x20e730(0x168)](_0x20e730(0x1a9),{'campaignShippingId':_0x5801f5['id'],'campaignId':_0x5801f5[_0x20e730(0x17d)]},{'delay':(0x0,queues_1[_0x20e730(0x1c2)])((0x0,queues_1[_0x20e730(0x19e)])(0x0,0xa))}),!![];}}return![];};exports[a695_0xc3f8e8(0x1ed)]=verifyRecentCampaign;