'use strict';const a697_0x18de7a=a697_0xfc12;(function(_0x17f5c7,_0x255289){const _0xb3c70d=a697_0xfc12,_0x188e78=_0x17f5c7();while(!![]){try{const _0x52ddaf=-parseInt(_0xb3c70d(0x115))/0x1*(parseInt(_0xb3c70d(0x19f))/0x2)+parseInt(_0xb3c70d(0x1a1))/0x3+parseInt(_0xb3c70d(0x13a))/0x4*(-parseInt(_0xb3c70d(0x127))/0x5)+-parseInt(_0xb3c70d(0x172))/0x6+parseInt(_0xb3c70d(0x14b))/0x7*(-parseInt(_0xb3c70d(0x1ee))/0x8)+-parseInt(_0xb3c70d(0x1ab))/0x9*(-parseInt(_0xb3c70d(0x197))/0xa)+parseInt(_0xb3c70d(0x133))/0xb;if(_0x52ddaf===_0x255289)break;else _0x188e78['push'](_0x188e78['shift']());}catch(_0x1a5132){_0x188e78['push'](_0x188e78['shift']());}}}(a697_0x1990,0xd76b2));var __createBinding=this&&this[a697_0x18de7a(0x1e9)]||(Object[a697_0x18de7a(0x16c)]?function(_0x336ecf,_0x113737,_0x283064,_0x4661d3){const _0x1b783c=a697_0x18de7a;if(_0x4661d3===undefined)_0x4661d3=_0x283064;var _0x3a1990=Object[_0x1b783c(0x164)](_0x113737,_0x283064);(!_0x3a1990||('get'in _0x3a1990?!_0x113737[_0x1b783c(0x1db)]:_0x3a1990['writable']||_0x3a1990[_0x1b783c(0x166)]))&&(_0x3a1990={'enumerable':!![],'get':function(){return _0x113737[_0x283064];}}),Object[_0x1b783c(0x12e)](_0x336ecf,_0x4661d3,_0x3a1990);}:function(_0x504ee5,_0x5258cf,_0x49a269,_0x2af8fd){if(_0x2af8fd===undefined)_0x2af8fd=_0x49a269;_0x504ee5[_0x2af8fd]=_0x5258cf[_0x49a269];}),__setModuleDefault=this&&this[a697_0x18de7a(0x1f6)]||(Object[a697_0x18de7a(0x16c)]?function(_0x552a91,_0x54ad1e){const _0x3e3804=a697_0x18de7a;Object['defineProperty'](_0x552a91,_0x3e3804(0x141),{'enumerable':!![],'value':_0x54ad1e});}:function(_0x39d95c,_0xce762d){const _0xb0f5d5=a697_0x18de7a;_0x39d95c[_0xb0f5d5(0x141)]=_0xce762d;}),__importStar=this&&this[a697_0x18de7a(0x1bf)]||(function(){const _0x1bc2f5=(function(){let _0x4b7885=!![];return function(_0x4889fe,_0x12955b){const _0x4fad80=_0x4b7885?function(){if(_0x12955b){const _0x585b53=_0x12955b['apply'](_0x4889fe,arguments);return _0x12955b=null,_0x585b53;}}:function(){};return _0x4b7885=![],_0x4fad80;};}()),_0x218c76=_0x1bc2f5(this,function(){const _0xd1e123=a697_0xfc12;return _0x218c76[_0xd1e123(0x155)]()[_0xd1e123(0x1ef)]('(((.+)+)+)+$')[_0xd1e123(0x155)]()[_0xd1e123(0x1f8)](_0x218c76)[_0xd1e123(0x1ef)](_0xd1e123(0x129));});_0x218c76();var _0x27d409=function(_0x1c1242){return _0x27d409=Object['getOwnPropertyNames']||function(_0x3768e){const _0x10cd17=a697_0xfc12;var _0x200218=[];for(var _0x2afa83 in _0x3768e)if(Object[_0x10cd17(0x16b)][_0x10cd17(0x11e)][_0x10cd17(0x122)](_0x3768e,_0x2afa83))_0x200218[_0x200218[_0x10cd17(0x1f0)]]=_0x2afa83;return _0x200218;},_0x27d409(_0x1c1242);};return function(_0x14ad2f){const _0x2c6607=a697_0xfc12;if(_0x14ad2f&&_0x14ad2f['__esModule'])return _0x14ad2f;var _0x54e52e={};if(_0x14ad2f!=null){for(var _0xad8030=_0x27d409(_0x14ad2f),_0x1d7f0b=0x0;_0x1d7f0b<_0xad8030[_0x2c6607(0x1f0)];_0x1d7f0b++)if(_0xad8030[_0x1d7f0b]!==_0x2c6607(0x141))__createBinding(_0x54e52e,_0x14ad2f,_0xad8030[_0x1d7f0b]);}return __setModuleDefault(_0x54e52e,_0x14ad2f),_0x54e52e;};}()),__importDefault=this&&this['__importDefault']||function(_0x15357d){const _0x2ef6ab=a697_0x18de7a;return _0x15357d&&_0x15357d[_0x2ef6ab(0x1db)]?_0x15357d:{'default':_0x15357d};};Object[a697_0x18de7a(0x12e)](exports,'__esModule',{'value':!![]}),exports[a697_0x18de7a(0x1ae)]=exports[a697_0x18de7a(0x1a4)]=exports[a697_0x18de7a(0x136)]=exports['verifyDeleteMessage']=exports[a697_0x18de7a(0x1b7)]=exports[a697_0x18de7a(0x1fd)]=exports[a697_0x18de7a(0x162)]=exports[a697_0x18de7a(0x1eb)]=exports[a697_0x18de7a(0x175)]=exports['normalizeMediaType']=void 0x0;const Message_1=__importDefault(require(a697_0x18de7a(0x17b))),Ticket_1=__importDefault(require(a697_0x18de7a(0x134))),Contact_1=__importDefault(require(a697_0x18de7a(0x148))),socket_1=require(a697_0x18de7a(0x15a)),baileys_1=require(a697_0x18de7a(0x180)),CreateMessageService_1=__importDefault(require(a697_0x18de7a(0x1fe))),GetHandlers_1=require('./GetHandlers'),Queue_1=__importDefault(require(a697_0x18de7a(0x1e2))),User_1=__importDefault(require('../../models/User')),Sentry=__importStar(require(a697_0x18de7a(0x151))),CreateOrUpdateContactService_1=__importDefault(require('../ContactServices/CreateOrUpdateContactService')),stream_throttle_1=require('stream-throttle'),MakeRandomId_1=require('../../helpers/MakeRandomId'),CheckSettings_1=__importDefault(require(a697_0x18de7a(0x126))),GetHandlers_2=require('./GetHandlers'),logger_1=require(a697_0x18de7a(0x149)),util_1=require(a697_0x18de7a(0x1a6)),fs_1=__importStar(require('fs')),path_1=__importDefault(require('path')),OldMessage_1=__importDefault(require('../../models/OldMessage')),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),lodash_1=require(a697_0x18de7a(0x170)),randomDelay=()=>{const _0x909516=a697_0x18de7a,_0x3e6c27=Math[_0x909516(0x1de)](Math['random']()*0x3de)+0xa;return new Promise(_0x1d8df6=>setTimeout(_0x1d8df6,_0x3e6c27));},ShowQueueIntegrationService_1=__importDefault(require('../QueueIntegrationServices/ShowQueueIntegrationService')),wbotMessageListener_1=require(a697_0x18de7a(0x118)),Setting_1=__importDefault(require(a697_0x18de7a(0x1af))),Campaign_1=__importDefault(require(a697_0x18de7a(0x1e4))),CampaignShipping_1=__importDefault(require(a697_0x18de7a(0x1ca))),moment_1=__importDefault(require(a697_0x18de7a(0x1df))),queues_1=require(a697_0x18de7a(0x18e)),sequelize_1=require('sequelize'),SendWhatsAppMessage_1=__importDefault(require(a697_0x18de7a(0x1c1))),SendWhatsAppMedia_1=__importDefault(require(a697_0x18de7a(0x1a7))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ExtractPhoneNumber_1=require(a697_0x18de7a(0x19b)),StorageService_1=__importDefault(require(a697_0x18de7a(0x1c9))),writeFileAsync=(0x0,util_1[a697_0x18de7a(0x186)])(fs_1[a697_0x18de7a(0x1a5)]),saveMediaToFile=async(_0xff5180,_0x4696ac)=>{const _0x4a0d8d=a697_0x18de7a;if(!_0xff5180['filename']){const _0x32cd80=_0xff5180[_0x4a0d8d(0x1d8)][_0x4a0d8d(0x11c)]('/')[0x1][_0x4a0d8d(0x11c)](';')[0x0];_0xff5180[_0x4a0d8d(0x19a)]=new Date()[_0x4a0d8d(0x1c6)]()+'.'+_0x32cd80;}const _0x2e38eb=(0x0,MakeRandomId_1['makeRandomId'])(0xa),_0x148717=_0x4696ac[_0x4a0d8d(0x194)]+'/'+_0x4696ac['id']+'/'+_0x2e38eb,_0xfef0d1=_0xff5180[_0x4a0d8d(0x185)]?typeof _0xff5180[_0x4a0d8d(0x185)]===_0x4a0d8d(0x130)?Buffer['from'](_0xff5180['data'],_0x4a0d8d(0x189))['length']:_0xff5180[_0x4a0d8d(0x185)][_0x4a0d8d(0x1f0)]:0x0;logger_1[_0x4a0d8d(0x131)]['info'](_0x4a0d8d(0x169)+_0x4696ac[_0x4a0d8d(0x1ea)]+_0x4a0d8d(0x1c0)+_0xfef0d1+'\x20bytes');const _0x21f38e=await StorageService_1['default']['canUpload'](_0x4696ac[_0x4a0d8d(0x1ea)],_0xfef0d1);logger_1[_0x4a0d8d(0x131)]['info'](_0x4a0d8d(0x169)+_0x4696ac['companyId']+_0x4a0d8d(0x1c4)+_0x21f38e);if(!_0x21f38e)return logger_1['logger'][_0x4a0d8d(0x1ec)](_0x4a0d8d(0x190)+_0x4696ac['companyId']+_0x4a0d8d(0x1bd)),_0x4a0d8d(0x1cf);try{const _0x4c2f13=await StorageService_1[_0x4a0d8d(0x141)][_0x4a0d8d(0x13b)](_0x4696ac[_0x4a0d8d(0x1ea)],_0x148717,_0xff5180[_0x4a0d8d(0x19a)],_0xff5180[_0x4a0d8d(0x185)],_0xff5180['mimetype']);return _0x4c2f13['url'];}catch(_0x444c2b){Sentry['captureException'](_0x444c2b),logger_1[_0x4a0d8d(0x131)][_0x4a0d8d(0x16e)](_0x4a0d8d(0x128)+_0x444c2b[_0x4a0d8d(0x1fc)]);if(_0x444c2b['code']===_0x4a0d8d(0x1d0)||_0x444c2b[_0x4a0d8d(0x1fc)]?.[_0x4a0d8d(0x18f)]('quota\x20exceeded')||_0x444c2b[_0x4a0d8d(0x1fc)]?.['includes'](_0x4a0d8d(0x179)))return logger_1['logger'][_0x4a0d8d(0x1ec)]('[saveMediaToFile]\x20Quota\x20do\x20bucket\x20MinIO\x20excedida\x20para\x20empresa\x20'+_0x4696ac['companyId']),_0x4a0d8d(0x1cf);return _0x4a0d8d(0x123);}},normalizeMediaType=_0x1cb015=>{const _0x50f7b2=a697_0x18de7a,_0x3eeb9c=[_0x50f7b2(0x181),_0x50f7b2(0x142),'image',_0x50f7b2(0x1ce)],_0x5afc41=_0x1cb015[_0x50f7b2(0x11c)]('/')[0x0];if(!_0x3eeb9c[_0x50f7b2(0x18f)](_0x5afc41))return _0x50f7b2(0x1ce);return _0x5afc41;};exports[a697_0x18de7a(0x184)]=normalizeMediaType;const normalizeThumbnailMediaType=_0x2fe804=>{const _0x4a639b=a697_0x18de7a,_0x175c76=[_0x4a639b(0x159),'thumbnail-image',_0x4a639b(0x15e)],_0x37e954=_0x2fe804[_0x4a639b(0x11c)]('/')[0x0];if(!_0x175c76['includes'](_0x4a639b(0x12b)+_0x37e954))return _0x4a639b(0x15e);return _0x37e954;};exports['normalizeThumbnailMediaType']=normalizeThumbnailMediaType;const downloadMedia=async(_0x522c18,_0x2c7aac,_0x11ea72)=>{const _0x55a032=a697_0x18de7a,_0xbce4a2=(0x0,GetHandlers_2['getUnpackedMessage'])(_0x522c18),_0x17a2bc=(0x0,GetHandlers_2['getMessageMedia'])(_0xbce4a2);if(!_0x17a2bc)return null;const _0x525308=parseInt(await(0x0,CheckSettings_1['default'])(_0x55a032(0x14e),'15'),0xa);if(_0x2c7aac&&_0x17a2bc?.['fileLength']&&+_0x17a2bc[_0x55a032(0x165)]>_0x525308*0x400*0x400){const _0x43aff3='*Mensagem\x20Autom√°tica*:\x0aNosso\x20sistema\x20aceita\x20apenas\x20arquivos\x20com\x20no\x20m√°ximo\x20'+_0x525308+_0x55a032(0x152);if(!_0x11ea72[_0x55a032(0x17c)]){const _0x54a9e7=await(0x0,SendWhatsAppMessage_1[_0x55a032(0x141)])({'ticket':_0x11ea72,'body':_0x43aff3});_0x54a9e7[_0x55a032(0x1fc)][_0x55a032(0x1cd)][_0x55a032(0x160)]=_0x55a032(0x1d1);}throw new Error(_0x55a032(0x1bb));}const _0x2d0696=_0xbce4a2?.[_0x55a032(0x137)]?_0x55a032(0x1ce):(0x0,exports[_0x55a032(0x184)])(_0x17a2bc['mimetype']);let _0x161922,_0x25c7f1=0x0;while(_0x25c7f1<0xa&&!_0x161922){try{const _0x31f562={..._0x17a2bc};_0x31f562?.['directPath']&&(_0x31f562[_0x55a032(0x1b3)]=''),_0x161922=await(0x0,baileys_1[_0x55a032(0x1ff)])(_0x31f562,_0x2d0696);}catch(_0x360a28){_0x25c7f1+=0x1,await new Promise(_0x469341=>{setTimeout(_0x469341,0x3e8*_0x25c7f1*0x2);}),logger_1[_0x55a032(0x131)]['warn'](_0x55a032(0x154)+_0x25c7f1+'\x20de\x20baixar\x20o\x20arquivo\x20'+_0x522c18?.['key']?.['id']);}}if(!_0x161922)throw new Error('Failed\x20to\x20get\x20stream');const _0x2d3598=await downloadStream(_0x161922);if(!_0x2d3598){Sentry[_0x55a032(0x14f)]('ERR_WAPP_DOWNLOAD_MEDIA',{'msg':_0x522c18}),Sentry['captureException'](new Error(_0x55a032(0x1e7)));throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');}let _0x50ece1=_0xbce4a2?.['documentMessage']?.['fileName']||'';if(!_0x50ece1){const _0x5a1a0b=_0x17a2bc[_0x55a032(0x1d8)][_0x55a032(0x11c)]('/')[0x1][_0x55a032(0x11c)](';')[0x0];_0x50ece1=(0x0,MakeRandomId_1[_0x55a032(0x157)])(0x5)+'-'+new Date()[_0x55a032(0x1c6)]()+'.'+_0x5a1a0b;}else _0x50ece1=_0x50ece1[_0x55a032(0x11c)]('.')[_0x55a032(0x14a)](0x0,-0x1)['join']('.')+'.'+(0x0,MakeRandomId_1[_0x55a032(0x157)])(0x5)+'.'+_0x50ece1[_0x55a032(0x11c)]('.')[_0x55a032(0x14a)](-0x1);const _0x8cb2ff={'data':_0x2d3598,'mimetype':_0x17a2bc[_0x55a032(0x1d8)],'filename':_0x50ece1};return _0x8cb2ff;},downloadStream=async _0x4d96a9=>{const _0x47b32b=a697_0x18de7a,_0x3f0ee6=0x5*0x400*0x400/0x8,_0x547927=0x400*0x400/0x8,_0x3ca995=0x400*0x400,_0x32db10=new stream_throttle_1[(_0x47b32b(0x14c))]({'rate':_0x3f0ee6});let _0x290acf=Buffer[_0x47b32b(0x140)]([]),_0x287e7c=0x0;try{for await(const _0x5de8af of _0x4d96a9[_0x47b32b(0x1c2)](_0x32db10)){_0x290acf=Buffer[_0x47b32b(0x1dc)]([_0x290acf,_0x5de8af]),_0x287e7c+=_0x5de8af['length'],_0x287e7c>_0x3ca995&&(_0x32db10[_0x47b32b(0x13f)]=_0x547927);}}catch(_0x57d978){Sentry[_0x47b32b(0x14f)]('ERR_WAPP_DOWNLOAD_MEDIA',{'error':_0x57d978}),Sentry['captureException'](new Error(_0x47b32b(0x1e7)));throw new Error(_0x47b32b(0x1e7));}return _0x290acf;},downloadThumbnail=async({thumbnailDirectPath:_0x3d187f,mediaKey:_0x28e8ba,mimetype:_0x509923})=>{const _0x103298=a697_0x18de7a;if(!_0x3d187f||!_0x28e8ba)return null;const _0x2e6968=await(0x0,baileys_1['downloadContentFromMessage'])({'mediaKey':_0x28e8ba,'directPath':_0x3d187f},_0x509923?(0x0,exports['normalizeThumbnailMediaType'])(_0x509923):'thumbnail-link');if(!_0x2e6968)throw new Error(_0x103298(0x1b2));const _0x5ea5eb=await downloadStream(_0x2e6968);if(!_0x5ea5eb)throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');const _0xfb8900=_0x103298(0x12b)+(0x0,MakeRandomId_1[_0x103298(0x157)])(0x5)+'-'+new Date()[_0x103298(0x1c6)]()+_0x103298(0x171),_0x27d33a={'data':_0x5ea5eb,'mimetype':'image/jpeg','filename':_0xfb8900};return _0x27d33a;},verifyMessage=async(_0x2df128,_0x2c70c8,_0x44f511,_0x2f997c=null,_0x185c37=null)=>{const _0x40042b=a697_0x18de7a,_0xe42726=(0x0,socket_1[_0x40042b(0x188)])(),_0x285335=await verifyQuotedMessage(_0x2df128),_0x2f9a9b=(0x0,GetHandlers_1[_0x40042b(0x19d)])(_0x2df128),_0x1e05b7={'id':_0x2df128[_0x40042b(0x1f2)]['id'],'ticketId':_0x2c70c8['id'],'userId':_0x2f997c,'contactId':_0x2df128[_0x40042b(0x1f2)][_0x40042b(0x1e8)]?undefined:_0x44f511['id'],'body':_0x2f9a9b,'fromMe':_0x2df128['key'][_0x40042b(0x1e8)],'mediaType':_0x2df128['message']['reactionMessage']?_0x40042b(0x173):null,'read':_0x2df128[_0x40042b(0x1f2)][_0x40042b(0x1e8)],'quotedMsgId':_0x285335?.['id'],'ack':_0x2df128[_0x40042b(0x17a)]||(_0x2df128[_0x40042b(0x1f2)][_0x40042b(0x1e8)]?0x1:0x0),'remoteJid':_0x2df128['key']['remoteJid'],'participant':_0x2df128[_0x40042b(0x1f2)][_0x40042b(0x1d2)],'dataJson':JSON[_0x40042b(0x18a)](_0x2df128),'isEdited':![]};await _0x2c70c8[_0x40042b(0x1da)]({'lastMessage':_0x2f9a9b[_0x40042b(0x199)](0x0,0xff)[_0x40042b(0x11b)](/\n/g,'\x20')});const _0x15e914=await(0x0,CreateMessageService_1[_0x40042b(0x141)])({'messageData':_0x1e05b7,'companyId':_0x2c70c8[_0x40042b(0x1ea)]});if(!_0x2df128[_0x40042b(0x1f2)][_0x40042b(0x1e8)]){const _0x1798a2=_0x2df128['key'],_0x369b16=_0x2df128[_0x40042b(0x1f2)][_0x40042b(0x177)],_0x546f6a=_0x1798a2[_0x40042b(0x1d5)];let _0x1c27a5=null,_0x143608=null;if(_0x369b16?.['includes'](_0x40042b(0x19c)))_0x1c27a5=_0x369b16,_0x143608=_0x546f6a;else _0x369b16?.[_0x40042b(0x18f)](_0x40042b(0x1e3))&&(_0x143608=_0x369b16,_0x1c27a5=_0x546f6a);const _0x5092aa=_0x1c27a5?.[_0x40042b(0x11c)]('@')[0x0],_0x4da618=_0x143608?.[_0x40042b(0x11c)]('@')[0x0],_0x47c5e2=_0x5092aa&&_0x5092aa!==_0x44f511[_0x40042b(0x114)]||_0x4da618&&_0x4da618!==_0x44f511[_0x40042b(0x15f)];if(_0x47c5e2){if(_0x5092aa&&_0x5092aa!==_0x44f511[_0x40042b(0x114)]){const _0x2bb234=await Contact_1['default'][_0x40042b(0x153)]({'where':{'number':_0x5092aa,'companyId':_0x44f511[_0x40042b(0x1ea)]}});if(_0x2bb234&&_0x2bb234['id']!==_0x44f511['id']){await _0x2c70c8[_0x40042b(0x1da)]({'contactId':_0x2bb234['id']}),await _0x15e914[_0x40042b(0x1da)]({'contactId':_0x2bb234['id']});const _0x4b9b40={};_0x4da618&&!_0x2bb234[_0x40042b(0x15f)]&&(_0x4b9b40[_0x40042b(0x15f)]=_0x4da618);_0x1c27a5&&!_0x2bb234['remoteJid']&&(_0x4b9b40['remoteJid']=_0x1c27a5);const _0x1ec623=!_0x2bb234[_0x40042b(0x18b)]||_0x2bb234[_0x40042b(0x18b)]===''||_0x2bb234[_0x40042b(0x18b)]===process[_0x40042b(0x195)][_0x40042b(0x12d)]+'/nopicture.png';if(_0x1ec623&&_0x185c37)try{const _0x802b47=_0x143608||_0x1c27a5||_0x369b16,_0x59a059=await _0x185c37[_0x40042b(0x1ed)](_0x802b47);_0x59a059&&_0x59a059!==process[_0x40042b(0x195)]['FRONTEND_URL']+_0x40042b(0x13c)&&(_0x4b9b40[_0x40042b(0x18b)]=_0x59a059);}catch(_0x14ca3f){}Object[_0x40042b(0x1a9)](_0x4b9b40)[_0x40042b(0x1f0)]>0x0&&await _0x2bb234[_0x40042b(0x1da)](_0x4b9b40);const _0x394759=await Ticket_1[_0x40042b(0x141)][_0x40042b(0x15d)]({'where':{'contactId':_0x44f511['id']}});_0x394759===0x0?(await _0x44f511[_0x40042b(0x1cb)](),console[_0x40042b(0x1f4)]('[verifyMessage]\x20Deleted\x20duplicate\x20contact\x20'+_0x44f511['id'])):console[_0x40042b(0x1f4)]('[verifyMessage]\x20Keeping\x20contact\x20'+_0x44f511['id']+_0x40042b(0x1cc)+_0x394759+_0x40042b(0x18d));return;}}const _0x2300b7={};_0x5092aa&&_0x5092aa!==_0x44f511[_0x40042b(0x114)]&&(_0x2300b7[_0x40042b(0x114)]=_0x5092aa),_0x4da618&&_0x4da618!==_0x44f511[_0x40042b(0x15f)]&&(_0x2300b7[_0x40042b(0x15f)]=_0x4da618),_0x1c27a5&&_0x1c27a5!==_0x44f511[_0x40042b(0x177)]&&(_0x2300b7['remoteJid']=_0x1c27a5),Object[_0x40042b(0x1a9)](_0x2300b7)[_0x40042b(0x1f0)]>0x0&&(console[_0x40042b(0x1f4)](_0x40042b(0x1c3)+_0x44f511['id']+':',_0x2300b7),await _0x44f511[_0x40042b(0x1da)](_0x2300b7));}else console[_0x40042b(0x1f4)]('[verifyMessage]\x20Contact\x20'+_0x44f511['id']+_0x40042b(0x10f));}return!_0x2df128[_0x40042b(0x1f2)][_0x40042b(0x1e8)]&&_0x2c70c8[_0x40042b(0x17a)]==='closed'&&(await _0x2c70c8['update']({'status':_0x40042b(0x1e5)}),await _0x2c70c8[_0x40042b(0x1fa)]({'include':[{'model':Queue_1[_0x40042b(0x141)],'as':'queue'},{'model':User_1[_0x40042b(0x141)],'as':'user'},{'model':Contact_1['default'],'as':_0x40042b(0x1b4)}]}),_0xe42726['to'](_0x40042b(0x1a8)+_0x2c70c8[_0x40042b(0x1ea)]+_0x40042b(0x176))['to'](_0x40042b(0x1dd)+_0x2c70c8[_0x40042b(0x16f)]+_0x40042b(0x176))['emit'](_0x40042b(0x1a8)+_0x2c70c8[_0x40042b(0x1ea)]+_0x40042b(0x196),{'action':_0x40042b(0x1d9),'ticket':_0x2c70c8,'ticketId':_0x2c70c8['id']}),_0xe42726['to']('company-'+_0x2c70c8[_0x40042b(0x1ea)]+'-'+_0x2c70c8[_0x40042b(0x17a)])['to'](_0x40042b(0x1dd)+_0x2c70c8[_0x40042b(0x16f)]+'-'+_0x2c70c8[_0x40042b(0x17a)])['to'](_0x2c70c8['id'][_0x40042b(0x155)]())[_0x40042b(0x1f7)](_0x40042b(0x1a8)+_0x2c70c8[_0x40042b(0x1ea)]+'-ticket',{'action':_0x40042b(0x1da),'ticket':_0x2c70c8,'ticketId':_0x2c70c8['id']})),_0x15e914;};exports[a697_0x18de7a(0x1eb)]=verifyMessage;const verifyQuotedMessage=async _0x3e58a3=>{const _0x9bfff3=a697_0x18de7a;if(!_0x3e58a3)return null;const _0x5ecc06=(0x0,GetHandlers_1[_0x9bfff3(0x1aa)])(_0x3e58a3);if(!_0x5ecc06)return null;const _0x5bc55=await Message_1[_0x9bfff3(0x141)][_0x9bfff3(0x153)]({'where':{'id':_0x5ecc06}});if(!_0x5bc55)return null;return _0x5bc55;},verifyContact=async(_0x3d579b,_0x9c1e56,_0x4ce4e1,_0x4ee400)=>{const _0x79eb3a=a697_0x18de7a;if(_0x3d579b['id']?.[_0x79eb3a(0x1c5)](_0x79eb3a(0x19e)))return logger_1[_0x79eb3a(0x131)][_0x79eb3a(0x11f)](_0x79eb3a(0x112)+_0x3d579b['id']),null;let _0x446fdd;try{_0x446fdd=await _0x9c1e56[_0x79eb3a(0x1ed)](_0x3d579b['id']);}catch(_0x2eca67){Sentry[_0x79eb3a(0x13e)](_0x2eca67),_0x446fdd=process[_0x79eb3a(0x195)][_0x79eb3a(0x12d)]+_0x79eb3a(0x13c);}const _0x438b13=_0x3d579b['id'][_0x79eb3a(0x18f)](_0x79eb3a(0x1e3)),_0x89b0e6=_0x438b13?_0x3d579b['id'][_0x79eb3a(0x11c)]('@')[0x0]:null,_0x3047d3=(0x0,ExtractPhoneNumber_1[_0x79eb3a(0x161)])(_0x3d579b['id']);let _0x435059=null;if(_0x4ee400&&_0x4ee400[_0x79eb3a(0x18f)](_0x79eb3a(0x19c)))_0x435059=_0x4ee400[_0x79eb3a(0x11c)]('@')[0x0];else _0x3047d3&&!_0x438b13&&(_0x435059=_0x3047d3);console['log'](_0x79eb3a(0x135)+_0x3d579b['id']+_0x79eb3a(0x1a3)+_0x438b13+_0x79eb3a(0x113)+_0x89b0e6+_0x79eb3a(0x150)+_0x435059+_0x79eb3a(0x143)+_0x4ee400);const _0x263e44=[];_0x435059&&_0x263e44['push']({'number':_0x435059,'companyId':_0x4ce4e1});_0x89b0e6&&_0x263e44['push']({'lid':_0x89b0e6,'companyId':_0x4ce4e1});if(_0x263e44[_0x79eb3a(0x1f0)]>0x0){const _0x130ace=await Contact_1[_0x79eb3a(0x141)][_0x79eb3a(0x153)]({'where':{'companyId':_0x4ce4e1,[sequelize_1['Op']['or']]:_0x263e44},'order':[[(0x0,sequelize_1[_0x79eb3a(0x1d3)])(_0x79eb3a(0x117)),_0x79eb3a(0x110)],[_0x79eb3a(0x132),_0x79eb3a(0x110)]]});if(_0x130ace){console[_0x79eb3a(0x1f4)](_0x79eb3a(0x1b9)+_0x130ace['id']+_0x79eb3a(0x1c8)+_0x130ace[_0x79eb3a(0x114)]+_0x79eb3a(0x1f3)+_0x130ace[_0x79eb3a(0x15f)]);const _0x1e27ba={};_0x435059&&(!_0x130ace['number']||_0x130ace[_0x79eb3a(0x114)]==='')&&(_0x1e27ba[_0x79eb3a(0x114)]=_0x435059,console['log'](_0x79eb3a(0x1e0)+_0x435059));_0x89b0e6&&!_0x130ace[_0x79eb3a(0x15f)]&&(_0x1e27ba[_0x79eb3a(0x15f)]=_0x89b0e6,console[_0x79eb3a(0x1f4)]('[verifyContact]\x20Adicionando\x20LID:\x20'+_0x89b0e6));if(_0x4ee400&&_0x4ee400[_0x79eb3a(0x18f)](_0x79eb3a(0x19c)))(!_0x130ace[_0x79eb3a(0x177)]||_0x130ace[_0x79eb3a(0x177)][_0x79eb3a(0x18f)](_0x79eb3a(0x1e3)))&&(_0x1e27ba[_0x79eb3a(0x177)]=_0x4ee400);else!_0x130ace[_0x79eb3a(0x177)]&&(_0x1e27ba[_0x79eb3a(0x177)]=_0x3d579b['id']);const _0x4d7490=!_0x130ace[_0x79eb3a(0x18b)]||_0x130ace[_0x79eb3a(0x18b)]===''||_0x130ace[_0x79eb3a(0x18b)]===process['env'][_0x79eb3a(0x12d)]+'/nopicture.png';_0x4d7490&&_0x446fdd&&_0x446fdd!==process['env'][_0x79eb3a(0x12d)]+_0x79eb3a(0x13c)&&(_0x1e27ba[_0x79eb3a(0x18b)]=_0x446fdd);const _0x32831b=!_0x130ace[_0x79eb3a(0x145)]||_0x130ace[_0x79eb3a(0x145)]['startsWith'](_0x79eb3a(0x167))||_0x130ace[_0x79eb3a(0x145)]===_0x130ace['lid'];return _0x32831b&&_0x3d579b[_0x79eb3a(0x145)]&&_0x3d579b[_0x79eb3a(0x145)]!==_0x89b0e6&&(_0x1e27ba[_0x79eb3a(0x145)]=_0x3d579b[_0x79eb3a(0x145)]),Object[_0x79eb3a(0x1a9)](_0x1e27ba)[_0x79eb3a(0x1f0)]>0x0&&(await _0x130ace[_0x79eb3a(0x1da)](_0x1e27ba),console[_0x79eb3a(0x1f4)](_0x79eb3a(0x1b8)+_0x130ace['id']+_0x79eb3a(0x119),_0x1e27ba)),_0x130ace;}}const _0x46fbe8={'name':_0x3d579b?.['name']||(_0x435059?_0x435059:_0x79eb3a(0x167)+(_0x89b0e6?.[_0x79eb3a(0x199)](0x0,0x8)||_0x79eb3a(0x121))+_0x79eb3a(0x192)),'number':_0x435059||_0x89b0e6||_0x79eb3a(0x146)+Date['now'](),'profilePicUrl':_0x446fdd,'isGroup':_0x3d579b['id'][_0x79eb3a(0x18f)](_0x79eb3a(0x193)),'companyId':_0x4ce4e1,'remoteJid':_0x4ee400||_0x3d579b['id'],'lid':_0x89b0e6};console['log'](_0x79eb3a(0x16a),_0x46fbe8);const _0xf49919=await(0x0,CreateOrUpdateContactService_1['default'])(_0x46fbe8);return _0xf49919;};exports[a697_0x18de7a(0x162)]=verifyContact;const verifyMediaMessage=async(_0x5a93e5,_0x3e2cb4,_0x4468e,_0x5f4d65=null,_0x6028e0=null,_0x452030=null)=>{const _0x261e8b=a697_0x18de7a,_0x883625=(0x0,socket_1[_0x261e8b(0x188)])(),_0x5deef2=await verifyQuotedMessage(_0x5a93e5),_0x785aac=_0x6028e0||_0x5a93e5?.[_0x261e8b(0x1fc)]?.[_0x261e8b(0x1cd)],_0x4b0e61=_0x785aac&&await downloadThumbnail(_0x785aac),_0x3c8cd2=await downloadMedia(_0x5a93e5,_0x5f4d65,_0x3e2cb4);if(!_0x3c8cd2&&!_0x4b0e61)throw new Error(_0x261e8b(0x1e7));let _0x5e04df=null;_0x3c8cd2&&(_0x5e04df=await saveMediaToFile(_0x3c8cd2,_0x3e2cb4));let _0x1677b1=null;_0x4b0e61&&(_0x1677b1=await saveMediaToFile(_0x4b0e61,_0x3e2cb4));const _0x4724e0=(0x0,GetHandlers_1[_0x261e8b(0x19d)])(_0x5a93e5),_0x5266ec={'id':_0x5a93e5['key']['id'],'ticketId':_0x3e2cb4['id'],'userId':_0x452030,'contactId':_0x5a93e5['key']['fromMe']?undefined:_0x4468e['id'],'body':_0x4724e0||'','fromMe':_0x5a93e5[_0x261e8b(0x1f2)][_0x261e8b(0x1e8)],'read':_0x5a93e5[_0x261e8b(0x1f2)][_0x261e8b(0x1e8)],'mediaUrl':_0x5e04df,'mediaType':_0x3c8cd2?.[_0x261e8b(0x1d8)][_0x261e8b(0x11c)]('/')[0x0],'thumbnailUrl':_0x1677b1,'quotedMsgId':_0x5deef2?.['id'],'ack':_0x5a93e5[_0x261e8b(0x17a)]||(_0x5a93e5['key']['fromMe']?0x1:0x0),'remoteJid':_0x5a93e5[_0x261e8b(0x1f2)][_0x261e8b(0x177)],'participant':_0x5a93e5[_0x261e8b(0x1f2)]['participant'],'dataJson':JSON[_0x261e8b(0x18a)](_0x5a93e5)};await _0x3e2cb4[_0x261e8b(0x1da)]({'lastMessage':_0x4724e0||_0x3c8cd2?.['filename']?'üìé\x20'+_0x3c8cd2?.['filename']:''});const _0x5ceefe=await(0x0,CreateMessageService_1[_0x261e8b(0x141)])({'messageData':_0x5266ec,'companyId':_0x3e2cb4[_0x261e8b(0x1ea)]});if(!_0x5a93e5[_0x261e8b(0x1f2)][_0x261e8b(0x1e8)]){const _0x57da3f=_0x5a93e5['key'],_0x207739=_0x5a93e5[_0x261e8b(0x1f2)][_0x261e8b(0x177)],_0x4bf4c4=_0x57da3f[_0x261e8b(0x1d5)];let _0x173236=null;if(_0x207739?.[_0x261e8b(0x18f)](_0x261e8b(0x19c)))_0x173236=_0x207739;else _0x207739?.[_0x261e8b(0x18f)](_0x261e8b(0x1e3))&&(_0x173236=_0x4bf4c4);if(_0x173236){const _0x1e7df9=_0x173236[_0x261e8b(0x11c)]('@')[0x0];if(_0x1e7df9!==_0x4468e['number']){const _0x3b0fe4={'number':_0x1e7df9,'remoteJid':_0x173236};_0x4468e[_0x261e8b(0x18b)]&&_0x4468e[_0x261e8b(0x18b)]!==process['env']['FRONTEND_URL']+_0x261e8b(0x13c)&&(_0x3b0fe4['profilePicUrl']=_0x4468e[_0x261e8b(0x18b)]),await _0x4468e[_0x261e8b(0x1da)](_0x3b0fe4);}}}return!_0x5a93e5[_0x261e8b(0x1f2)][_0x261e8b(0x1e8)]&&_0x3e2cb4[_0x261e8b(0x17a)]===_0x261e8b(0x191)&&(await _0x3e2cb4[_0x261e8b(0x1da)]({'status':'pending'}),await _0x3e2cb4[_0x261e8b(0x1fa)]({'include':[{'model':Queue_1[_0x261e8b(0x141)],'as':'queue'},{'model':User_1[_0x261e8b(0x141)],'as':_0x261e8b(0x12c)},{'model':Contact_1[_0x261e8b(0x141)],'as':_0x261e8b(0x1b4)}]}),_0x883625['to'](_0x261e8b(0x1a8)+_0x3e2cb4['companyId']+_0x261e8b(0x176))['to'](_0x261e8b(0x1dd)+_0x3e2cb4[_0x261e8b(0x16f)]+_0x261e8b(0x176))[_0x261e8b(0x1f7)]('company-'+_0x3e2cb4['companyId']+_0x261e8b(0x196),{'action':_0x261e8b(0x1d9),'ticket':_0x3e2cb4,'ticketId':_0x3e2cb4['id']}),_0x883625['to']('company-'+_0x3e2cb4[_0x261e8b(0x1ea)]+'-'+_0x3e2cb4[_0x261e8b(0x17a)])['to'](_0x261e8b(0x1dd)+_0x3e2cb4['queueId']+'-'+_0x3e2cb4[_0x261e8b(0x17a)])['to'](_0x3e2cb4['id'][_0x261e8b(0x155)]())[_0x261e8b(0x1f7)](_0x261e8b(0x1a8)+_0x3e2cb4[_0x261e8b(0x1ea)]+_0x261e8b(0x196),{'action':'update','ticket':_0x3e2cb4,'ticketId':_0x3e2cb4['id']})),_0x5ceefe;};exports[a697_0x18de7a(0x1fd)]=verifyMediaMessage;function a697_0xfc12(_0x6a2231,_0x370e58){const _0x263c78=a697_0x1990();return a697_0xfc12=function(_0x2f2434,_0x7af155){_0x2f2434=_0x2f2434-0x10f;let _0x199040=_0x263c78[_0x2f2434];return _0x199040;},a697_0xfc12(_0x6a2231,_0x370e58);}function a697_0x1990(){const _0x49b2e2=['includes','[saveMediaToFile]\x20Limite\x20de\x20armazenamento\x20atingido\x20para\x20empresa\x20','closed','...','g.us','contactId','env','-ticket','130qbdajH','Mensagem\x20','substring','filename','../../helpers/ExtractPhoneNumber','@s.whatsapp.net','getBodyMessage','@newsletter','252FDyghI','amountUsedBotQueues','3910908IdLNfE','lastProcessedMessageId',',\x20isLID:\x20','verifyRating','writeFile','util','./SendWhatsAppMedia','company-','keys','getQuotedMessageId','29745eqyvxP','value','startsWith','verifyRecentCampaign','../../models/Setting','Erro\x20ao\x20processar\x20integra√ß√£o\x20para\x20fila\x20escolhida:','flowBuilderId','Failed\x20to\x20get\x20stream','url','contact','documentWithCaptionMessage','head','verifyEditedMessage','[verifyContact]\x20Contact\x20','[verifyContact]\x20Found\x20existing\x20contact\x20','\x20vinculado','ERR_FILESIZE_OVER_LIMIT','Configura√ß√µes\x20do\x20WhatsApp\x20n√£o\x20encontradas.','.\x20M√≠dia\x20n√£o\x20ser√°\x20salva.','map','__importStar','\x20-\x20Verificando\x20upload\x20de\x20','./SendWhatsAppMessage','pipe','[verifyMessage]\x20Updating\x20contact\x20','\x20-\x20canUpload:\x20','endsWith','getTime','ack','\x20-\x20number:\x20','../StorageService/StorageService','../../models/CampaignShipping','destroy','\x20(has\x20','extendedTextMessage','document','STORAGE_LIMIT_EXCEEDED','XMinioAdminBucketQuotaExceeded','*Mensagem\x20do\x20sistema*:\x0aArquivo\x20recebido\x20al√©m\x20do\x20limite\x20de\x20tamanho\x20do\x20sistema,\x20se\x20for\x20necess√°rio\x20ele\x20pode\x20ser\x20obtido\x20no\x20aplicativo\x20do\x20whatsapp.','participant','literal','quotedMsgId','remoteJidAlt','Fila\x20#','findByPk','mimetype','delete','update','__esModule','concat','queue-','floor','moment','[verifyContact]\x20Atualizando\x20number\x20vazio\x20para\x20PN:\x20','EM_ANDAMENTO','../../models/Queue','@lid','../../models/Campaign','pending','randomValue','ERR_WAPP_DOWNLOAD_MEDIA','fromMe','__createBinding','companyId','verifyMessage','warn','profilePictureUrl','50632ZGlAce','search','length','greetingMessage','key',',\x20lid:\x20','log','transferMessage','__setModuleDefault','emit','constructor','getTypeEditedMessage','reload','mediaPath','message','verifyMediaMessage','../MessageServices/CreateMessageService','downloadContentFromMessage','\x20already\x20up\x20to\x20date','ASC','existsSync','Contato\x20de\x20canal/newsletter\x20ignorado:\x20',',\x20LID:\x20','number','8185rOwzeP','handleMessageIntegration','CASE\x20WHEN\x20number\x20!=\x20\x27\x27\x20AND\x20LENGTH(number)\x20<=\x2015\x20THEN\x200\x20ELSE\x201\x20END','./wbotMessageListener','\x20updated:','ticket','replace','split','.\x20Ignorando\x20em\x20verifyQueue.','hasOwnProperty','info','forEach','Desconhecido','call','STORAGE_ERROR','verifyDeleteMessage','notification','../../helpers/CheckSettings','50hlHwHb','Erro\x20ao\x20salvar\x20m√≠dia:\x20','(((.+)+)+)+$','Erro\x20ao\x20processar\x20integra√ß√£o\x20para\x20fila\x20√∫nica:','thumbnail-','user','FRONTEND_URL','defineProperty','https://','string','logger','createdAt','36529009OXRcbk','../../models/Ticket','[verifyContact]\x20JID:\x20','verifyQueue','documentMessage','body','caption','623584RxXpeg','uploadTicketMedia','/nopicture.png','DispatchConfirmedCampaign','captureException','rate','from','default','video',',\x20pnFromMessage:\x20','upsert','name','temp_','\x20j√°\x20processada\x20para\x20o\x20ticket\x20','../../models/Contact','../../utils/logger','slice','91jiURds','Throttle','public','downloadLimit','setExtra',',\x20PN:\x20','@sentry/node','\x20MiB','findOne','>>>>\x20erro\x20','toString','Fila\x20escolhida\x20#','makeRandomId','ticketId','thumbnail-video','../../libs/socket','parseToMilliseconds','conversation','count','thumbnail-document','lid','text','getPhoneNumberFromJid','verifyContact',')\x20tem\x20FlowBuilder\x20#','getOwnPropertyDescriptor','fileLength','configurable','Contato\x20','finishedAt','[saveMediaToFile]\x20Empresa\x20','[verifyContact]\x20Creating\x20new\x20contact:','prototype','create','chatbot','error','queueId','lodash','.jpg','6675114HyKOAV','reactionMessage','useIntegration','normalizeThumbnailMediaType','-closed','remoteJid','findAll','Bucket\x20quota','status','../../models/Message','isGroup','add','\x20iniciada\x20para\x20o\x20ticket\x20#','read','@whiskeysockets/baileys','audio','imageMessage','resolve','normalizeMediaType','data','promisify','maxUseBotQueues','getIO','base64','stringify','profilePicUrl','integrationId','\x20other\x20tickets)','../../queues'];a697_0x1990=function(){return _0x49b2e2;};return a697_0x1990();}const verifyEditedMessage=async(_0x583243,_0x45812d,_0xae10d6)=>{const _0x5dc2be=a697_0x18de7a,_0x11aa1=(0x0,GetHandlers_2[_0x5dc2be(0x1f9)])(_0x583243);let _0x5ed07f;switch(_0x11aa1){case'conversation':{_0x5ed07f=_0x583243[_0x5dc2be(0x15c)];break;}case _0x5dc2be(0x1cd):{_0x5ed07f=_0x583243['extendedTextMessage'][_0x5dc2be(0x160)];break;}case _0x5dc2be(0x182):{_0x5ed07f=_0x583243[_0x5dc2be(0x182)][_0x5dc2be(0x139)];break;}case _0x5dc2be(0x137):{_0x5ed07f=_0x583243[_0x5dc2be(0x137)][_0x5dc2be(0x139)];break;}case _0x5dc2be(0x1b5):{_0x5ed07f=_0x583243['documentWithCaptionMessage'][_0x5dc2be(0x1fc)][_0x5dc2be(0x137)]['caption'];break;}default:{return;}}const _0x5f4a5f=await Message_1['default'][_0x5dc2be(0x1d7)](_0xae10d6),_0x51456d={'id':_0x5f4a5f['id'],'ticketId':_0x5f4a5f[_0x5dc2be(0x158)],'contactId':_0x5f4a5f[_0x5dc2be(0x194)],'body':_0x5ed07f,'fromMe':_0x5f4a5f[_0x5dc2be(0x1e8)],'mediaType':_0x5f4a5f['mediaType'],'read':_0x5f4a5f[_0x5dc2be(0x17f)],'quotedMsgId':_0x5f4a5f[_0x5dc2be(0x1d4)],'ack':_0x5f4a5f[_0x5dc2be(0x1c7)],'remoteJid':_0x5f4a5f['remoteJid'],'participant':_0x5f4a5f[_0x5dc2be(0x1d2)],'dataJson':_0x5f4a5f['dataJson'],'isEdited':!![]},_0x3726e5={'messageId':_0x51456d['id'],'body':_0x5f4a5f[_0x5dc2be(0x138)],'ticketId':_0x5f4a5f[_0x5dc2be(0x158)]};await OldMessage_1[_0x5dc2be(0x141)][_0x5dc2be(0x144)](_0x3726e5),await _0x45812d['update']({'lastMessage':_0x51456d[_0x5dc2be(0x138)]}),await(0x0,CreateMessageService_1[_0x5dc2be(0x141)])({'messageData':_0x51456d,'companyId':_0x45812d[_0x5dc2be(0x1ea)]});const _0x2ebe4d=(0x0,socket_1['getIO'])();_0x2ebe4d['to'](_0x45812d[_0x5dc2be(0x17a)])['to'](_0x45812d['id'][_0x5dc2be(0x155)]())[_0x5dc2be(0x1f7)](_0x5dc2be(0x1a8)+_0x45812d[_0x5dc2be(0x1ea)]+_0x5dc2be(0x196),{'action':_0x5dc2be(0x1da),'ticket':_0x45812d,'ticketId':_0x45812d['id']});};exports[a697_0x18de7a(0x1b7)]=verifyEditedMessage;const verifyDeleteMessage=async(_0x44b462,_0x1db6a4)=>{const _0x3abc1b=a697_0x18de7a,_0x447ff3=await Message_1[_0x3abc1b(0x141)]['findByPk'](_0x44b462[_0x3abc1b(0x1f2)]['id'],{'include':[_0x3abc1b(0x1b4),{'model':Ticket_1[_0x3abc1b(0x141)],'include':[{'model':Contact_1['default']}]}]});if(!_0x447ff3)return;await _0x447ff3[_0x3abc1b(0x1da)]({'isDeleted':!![]});const _0x2787d2=(0x0,socket_1[_0x3abc1b(0x188)])();_0x2787d2['to'](_0x447ff3[_0x3abc1b(0x158)][_0x3abc1b(0x155)]())['to'](_0x447ff3[_0x3abc1b(0x11a)]['status'])['to'](_0x3abc1b(0x125))[_0x3abc1b(0x1f7)](_0x3abc1b(0x1a8)+_0x1db6a4[_0x3abc1b(0x1ea)]+'-appMessage',{'action':_0x3abc1b(0x16c),'message':_0x447ff3,'ticket':_0x447ff3[_0x3abc1b(0x11a)],'contact':_0x447ff3[_0x3abc1b(0x11a)][_0x3abc1b(0x1b4)]});};exports[a697_0x18de7a(0x124)]=verifyDeleteMessage;const verifyQueue=async(_0x1c9c74,_0x1d7c8c,_0xc6e0c5,_0x443e9e)=>{const _0x1086f=a697_0x18de7a;if(_0x1d7c8c?.['key']['id']&&_0xc6e0c5[_0x1086f(0x1a2)]===_0x1d7c8c[_0x1086f(0x1f2)]['id']){console[_0x1086f(0x1f4)](_0x1086f(0x198)+_0x1d7c8c[_0x1086f(0x1f2)]['id']+_0x1086f(0x147)+_0xc6e0c5['id']+_0x1086f(0x11d));return;}_0x1d7c8c?.[_0x1086f(0x1f2)]['id']&&await _0xc6e0c5[_0x1086f(0x1da)]({'lastProcessedMessageId':_0x1d7c8c[_0x1086f(0x1f2)]['id']});const _0x364a2c=await(0x0,ShowWhatsAppService_1[_0x1086f(0x141)])(_0x1c9c74['id'],_0xc6e0c5[_0x1086f(0x1ea)]),{queues:_0x3674eb,greetingMessage:_0x3d48bb}=_0x364a2c,_0x21a577=await Setting_1[_0x1086f(0x141)][_0x1086f(0x153)]({'where':{'key':'chatBotType','companyId':_0xc6e0c5[_0x1086f(0x1ea)]}});if(_0x3674eb[_0x1086f(0x1f0)]===0x1){const _0x266be8=(0x0,lodash_1[_0x1086f(0x1b6)])(_0x3674eb);if(!_0x266be8)return;await _0xc6e0c5[_0x1086f(0x1da)]({'amountUsedBotQueues':0x0});if(_0x266be8[_0x1086f(0x1b1)]){console[_0x1086f(0x1f4)](_0x1086f(0x1d6)+_0x266be8['id']+'\x20('+_0x266be8[_0x1086f(0x145)]+_0x1086f(0x163)+_0x266be8['flowBuilderId']+'\x20vinculado'),await _0xc6e0c5[_0x1086f(0x1da)]({'queueId':_0x266be8['id'],'flowBuilderId':_0x266be8[_0x1086f(0x1b1)],'chatbot':!![],'flowWebhook':![],'amountUsedBotQueues':0x0});const {handleFlowBuilderExecution:_0x3527e5}=await Promise[_0x1086f(0x183)]()['then'](()=>__importStar(require(_0x1086f(0x118))));await _0x3527e5(_0xc6e0c5,_0x1c9c74);return;}if(!_0xc6e0c5[_0x1086f(0x174)]&&_0x266be8[_0x1086f(0x18c)]&&!_0x1d7c8c?.[_0x1086f(0x1f2)][_0x1086f(0x1e8)]&&!_0xc6e0c5[_0x1086f(0x17c)])try{const _0x3c66d5=await(0x0,ShowQueueIntegrationService_1[_0x1086f(0x141)])(_0x266be8[_0x1086f(0x18c)],_0xc6e0c5[_0x1086f(0x1ea)]);if(_0x3c66d5){await _0xc6e0c5[_0x1086f(0x1da)]({'useIntegration':!![],'integrationId':_0x3c66d5['id'],'amountUsedBotQueues':0x0});_0x1d7c8c&&await(0x0,wbotMessageListener_1['handleMessageIntegration'])(_0x1d7c8c,_0x1c9c74,_0x3c66d5,_0xc6e0c5);console[_0x1086f(0x1f4)]('Integra√ß√£o\x20#'+_0x3c66d5['id']+_0x1086f(0x17e)+_0xc6e0c5['id']);return;}}catch(_0x40ff46){console[_0x1086f(0x16e)](_0x1086f(0x12a),_0x40ff46),await _0xc6e0c5['update']({'useIntegration':![],'integrationId':null});}await _0xc6e0c5[_0x1086f(0x1da)]({'queueId':_0x266be8['id'],'chatbot':![]});if(!_0x266be8[_0x1086f(0x18c)]&&!_0x266be8[_0x1086f(0x1b1)]){_0x266be8[_0x1086f(0x1f1)]&&(await randomDelay(),await(0x0,SendWhatsAppMessage_1[_0x1086f(0x141)])({'ticket':_0xc6e0c5,'body':_0x266be8[_0x1086f(0x1f1)]}));if(_0x266be8['mediaPath']){const _0x58fe6b=_0x266be8['mediaPath'];if(_0x58fe6b[_0x1086f(0x1ad)]('http://')||_0x58fe6b[_0x1086f(0x1ad)](_0x1086f(0x12f)))await(0x0,SendWhatsAppMedia_1[_0x1086f(0x141)])({'media':_0x58fe6b,'ticket':_0xc6e0c5,'body':''});else{const _0x2479b7=path_1['default']['resolve'](_0x1086f(0x14d),_0x58fe6b);fs_1[_0x1086f(0x141)][_0x1086f(0x111)](_0x2479b7)&&await(0x0,SendWhatsAppMedia_1[_0x1086f(0x141)])({'media':_0x2479b7,'ticket':_0xc6e0c5,'body':''});}}}return;}const _0xbde5c6=_0x1d7c8c?(0x0,GetHandlers_1['getBodyMessage'])(_0x1d7c8c):null,_0x489a8f=_0xbde5c6?_0x3674eb[+_0xbde5c6-0x1]:null;if(_0xbde5c6==='0'){await _0xc6e0c5[_0x1086f(0x1da)]({'queueId':null,'chatbot':![],'flowBuilderId':null,'flowWebhook':![],'lastFlowId':null,'flowStopped':null,'hashFlowId':null,'dataWebhook':null,'amountUsedBotQueues':0x0});const _0x559b54='Voc√™\x20saiu\x20do\x20menu.\x20Digite\x20*#*\x20para\x20voltar\x20ao\x20menu\x20principal.';await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0xc6e0c5,'body':_0x559b54});return;}if(_0x489a8f){await _0xc6e0c5[_0x1086f(0x1da)]({'amountUsedBotQueues':0x0});if(_0x489a8f['flowBuilderId']){console[_0x1086f(0x1f4)](_0x1086f(0x156)+_0x489a8f['id']+'\x20('+_0x489a8f[_0x1086f(0x145)]+')\x20tem\x20FlowBuilder\x20#'+_0x489a8f[_0x1086f(0x1b1)]+_0x1086f(0x1ba)),await _0xc6e0c5[_0x1086f(0x1da)]({'queueId':_0x489a8f['id'],'flowBuilderId':_0x489a8f['flowBuilderId'],'chatbot':!![],'flowWebhook':![],'amountUsedBotQueues':0x0});const {handleFlowBuilderExecution:_0x393536}=await Promise[_0x1086f(0x183)]()['then'](()=>__importStar(require(_0x1086f(0x118))));await _0x393536(_0xc6e0c5,_0x1c9c74);return;}if(!_0xc6e0c5[_0x1086f(0x174)]&&_0x489a8f[_0x1086f(0x18c)]&&!_0x1d7c8c?.[_0x1086f(0x1f2)]['fromMe']&&!_0xc6e0c5[_0x1086f(0x17c)])try{const _0x37973b=await(0x0,ShowQueueIntegrationService_1['default'])(_0x489a8f[_0x1086f(0x18c)],_0xc6e0c5[_0x1086f(0x1ea)]);if(_0x37973b){await _0xc6e0c5[_0x1086f(0x1da)]({'useIntegration':!![],'integrationId':_0x37973b['id']}),await(0x0,wbotMessageListener_1[_0x1086f(0x116)])(_0x1d7c8c,_0x1c9c74,_0x37973b,_0xc6e0c5),console[_0x1086f(0x1f4)]('Integra√ß√£o\x20#'+_0x37973b['id']+'\x20iniciada\x20para\x20o\x20ticket\x20#'+_0xc6e0c5['id']);return;}}catch(_0x39bbf1){console[_0x1086f(0x16e)](_0x1086f(0x1b0),_0x39bbf1),await _0xc6e0c5[_0x1086f(0x1da)]({'useIntegration':![],'integrationId':null});}await _0xc6e0c5[_0x1086f(0x1da)]({'queueId':_0x489a8f['id'],'chatbot':![]});if(!_0x489a8f[_0x1086f(0x18c)]&&!_0x489a8f[_0x1086f(0x1b1)]){_0x489a8f[_0x1086f(0x1f1)]&&(await randomDelay(),await(0x0,SendWhatsAppMessage_1[_0x1086f(0x141)])({'ticket':_0xc6e0c5,'body':_0x489a8f[_0x1086f(0x1f1)]}));if(_0x489a8f['mediaPath']){const _0x40960f=_0x489a8f[_0x1086f(0x1fb)];if(_0x40960f['startsWith']('http://')||_0x40960f[_0x1086f(0x1ad)](_0x1086f(0x12f)))await(0x0,SendWhatsAppMedia_1['default'])({'media':_0x40960f,'ticket':_0xc6e0c5,'body':''});else{const _0x24a7aa=path_1[_0x1086f(0x141)][_0x1086f(0x183)](_0x1086f(0x14d),_0x40960f);fs_1[_0x1086f(0x141)][_0x1086f(0x111)](_0x24a7aa)&&await(0x0,SendWhatsAppMedia_1[_0x1086f(0x141)])({'media':_0x24a7aa,'ticket':_0xc6e0c5,'body':''});}}}return;}const _0x3857be=await Whatsapp_1[_0x1086f(0x141)][_0x1086f(0x1d7)](_0xc6e0c5['whatsappId']);if(!_0x3857be){console[_0x1086f(0x16e)](_0x1086f(0x1bc));return;}if(!_0xc6e0c5[_0x1086f(0x16d)]&&_0xc6e0c5[_0x1086f(0x1a0)]>=_0x3857be[_0x1086f(0x187)])return;if(_0x1d7c8c&&_0xbde5c6&&!_0x489a8f){if(_0x3857be[_0x1086f(0x187)]&&_0x3857be[_0x1086f(0x187)]!==0x0&&_0xc6e0c5[_0x1086f(0x1a0)]>=_0x3857be[_0x1086f(0x187)]){await _0xc6e0c5[_0x1086f(0x1da)]({'chatbot':![],'amountUsedBotQueues':_0x3857be[_0x1086f(0x187)]});_0x3857be[_0x1086f(0x1f5)]&&await(0x0,SendWhatsAppMessage_1[_0x1086f(0x141)])({'ticket':_0xc6e0c5,'body':_0x3857be[_0x1086f(0x1f5)]});return;}await _0xc6e0c5['update']({'amountUsedBotQueues':_0xc6e0c5[_0x1086f(0x1a0)]+0x1}),await _0xc6e0c5[_0x1086f(0x1fa)]();}const _0x377fdf=async()=>{const _0x1b2bab=_0x1086f;let _0xe43e85='';_0x3674eb[_0x1b2bab(0x120)]((_0x35b3b6,_0x3a6eb1)=>{_0xe43e85+='*'+(_0x3a6eb1+0x1)+'*\x20-\x20'+_0x35b3b6['name']+'\x0a';}),_0xe43e85+='*0*\x20-\x20Sair';const _0x3d676e=_0x3d48bb+'\x0a\x0a'+_0xe43e85;await randomDelay(),await(0x0,SendWhatsAppMessage_1[_0x1b2bab(0x141)])({'ticket':_0xc6e0c5,'body':_0x3d676e});};switch(_0x21a577?.[_0x1086f(0x1ac)]){case _0x1086f(0x160):default:await _0x377fdf();break;}};exports[a697_0x18de7a(0x136)]=verifyQueue;const verifyRating=_0x5db8d8=>{const _0xb84126=a697_0x18de7a;if(_0x5db8d8&&_0x5db8d8[_0xb84126(0x168)]===null&&_0x5db8d8['userId']!==null&&_0x5db8d8['ratingAt']!==null)return!![];return![];};exports[a697_0x18de7a(0x1a4)]=verifyRating;const verifyRecentCampaign=async(_0x2d9708,_0x1046a4)=>{const _0x3aa133=a697_0x18de7a;if(!_0x2d9708['key'][_0x3aa133(0x1e8)]){const _0x370cb6=(0x0,ExtractPhoneNumber_1[_0x3aa133(0x161)])(_0x2d9708[_0x3aa133(0x1f2)][_0x3aa133(0x177)]),_0x4803af=await Campaign_1[_0x3aa133(0x141)][_0x3aa133(0x178)]({'where':{'companyId':_0x1046a4,'status':_0x3aa133(0x1e1),'confirmation':!![]}});if(_0x4803af){const _0x3b6d2a=_0x4803af[_0x3aa133(0x1be)](_0x4ee4bb=>_0x4ee4bb['id']),_0x4938ae=await CampaignShipping_1[_0x3aa133(0x141)][_0x3aa133(0x153)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x3b6d2a},'number':_0x370cb6,'confirmation':null}});if(_0x4938ae)return await _0x4938ae['update']({'confirmedAt':(0x0,moment_1[_0x3aa133(0x141)])(),'confirmation':!![]}),await queues_1['campaignQueue'][_0x3aa133(0x17d)](_0x3aa133(0x13d),{'campaignShippingId':_0x4938ae['id'],'campaignId':_0x4938ae['campaignId']},{'delay':(0x0,queues_1[_0x3aa133(0x15b)])((0x0,queues_1[_0x3aa133(0x1e6)])(0x0,0xa))}),!![];}}return![];};exports[a697_0x18de7a(0x1ae)]=verifyRecentCampaign;