'use strict';const a587_0x817c28=a587_0x1f7f;(function(_0x396efb,_0x26a3b7){const _0x4fe0a2=a587_0x1f7f,_0x1d06c2=_0x396efb();while(!![]){try{const _0xd32993=-parseInt(_0x4fe0a2(0x268))/0x1*(parseInt(_0x4fe0a2(0x213))/0x2)+-parseInt(_0x4fe0a2(0x20c))/0x3*(-parseInt(_0x4fe0a2(0x247))/0x4)+parseInt(_0x4fe0a2(0x223))/0x5+parseInt(_0x4fe0a2(0x254))/0x6+-parseInt(_0x4fe0a2(0x255))/0x7*(-parseInt(_0x4fe0a2(0x1e4))/0x8)+-parseInt(_0x4fe0a2(0x238))/0x9+-parseInt(_0x4fe0a2(0x205))/0xa;if(_0xd32993===_0x26a3b7)break;else _0x1d06c2['push'](_0x1d06c2['shift']());}catch(_0x13b917){_0x1d06c2['push'](_0x1d06c2['shift']());}}}(a587_0xcff4,0xba12f));var __createBinding=this&&this[a587_0x817c28(0x226)]||(Object[a587_0x817c28(0x234)]?function(_0x171799,_0x52dd87,_0x18c92a,_0x55927a){const _0x1ca1f1=a587_0x817c28;if(_0x55927a===undefined)_0x55927a=_0x18c92a;var _0x59993c=Object[_0x1ca1f1(0x1bd)](_0x52dd87,_0x18c92a);(!_0x59993c||(_0x1ca1f1(0x1a8)in _0x59993c?!_0x52dd87[_0x1ca1f1(0x1f7)]:_0x59993c['writable']||_0x59993c[_0x1ca1f1(0x1d5)]))&&(_0x59993c={'enumerable':!![],'get':function(){return _0x52dd87[_0x18c92a];}}),Object[_0x1ca1f1(0x1bc)](_0x171799,_0x55927a,_0x59993c);}:function(_0x4e18fa,_0x3c90f7,_0x36ae26,_0x2eb482){if(_0x2eb482===undefined)_0x2eb482=_0x36ae26;_0x4e18fa[_0x2eb482]=_0x3c90f7[_0x36ae26];}),__setModuleDefault=this&&this[a587_0x817c28(0x20d)]||(Object[a587_0x817c28(0x234)]?function(_0x5e95de,_0x545dbc){const _0x3bd5f1=a587_0x817c28;Object['defineProperty'](_0x5e95de,_0x3bd5f1(0x244),{'enumerable':!![],'value':_0x545dbc});}:function(_0x4475a7,_0x40af48){_0x4475a7['default']=_0x40af48;}),__importStar=this&&this['__importStar']||(function(){const _0x3fbd40=(function(){let _0xe704fc=!![];return function(_0x3b0796,_0x50c919){const _0x504fc5=_0xe704fc?function(){if(_0x50c919){const _0x2aef8b=_0x50c919['apply'](_0x3b0796,arguments);return _0x50c919=null,_0x2aef8b;}}:function(){};return _0xe704fc=![],_0x504fc5;};}()),_0x25a614=_0x3fbd40(this,function(){const _0x2e1d53=a587_0x1f7f;return _0x25a614[_0x2e1d53(0x24d)]()['search'](_0x2e1d53(0x1b3))[_0x2e1d53(0x24d)]()['constructor'](_0x25a614)[_0x2e1d53(0x212)](_0x2e1d53(0x1b3));});_0x25a614();var _0x142fe4=function(_0x3d9689){const _0xc09498=a587_0x1f7f;return _0x142fe4=Object[_0xc09498(0x1c5)]||function(_0x5e1327){const _0x3d5393=_0xc09498;var _0x197f6d=[];for(var _0x4a85dc in _0x5e1327)if(Object[_0x3d5393(0x1c8)][_0x3d5393(0x237)][_0x3d5393(0x26e)](_0x5e1327,_0x4a85dc))_0x197f6d[_0x197f6d[_0x3d5393(0x1e7)]]=_0x4a85dc;return _0x197f6d;},_0x142fe4(_0x3d9689);};return function(_0x497956){const _0x3935ac=a587_0x1f7f;if(_0x497956&&_0x497956[_0x3935ac(0x1f7)])return _0x497956;var _0x19a452={};if(_0x497956!=null){for(var _0x234f87=_0x142fe4(_0x497956),_0x3f25f8=0x0;_0x3f25f8<_0x234f87[_0x3935ac(0x1e7)];_0x3f25f8++)if(_0x234f87[_0x3f25f8]!=='default')__createBinding(_0x19a452,_0x497956,_0x234f87[_0x3f25f8]);}return __setModuleDefault(_0x19a452,_0x497956),_0x19a452;};}()),__importDefault=this&&this['__importDefault']||function(_0x2ce7db){const _0x18c3da=a587_0x817c28;return _0x2ce7db&&_0x2ce7db[_0x18c3da(0x1f7)]?_0x2ce7db:{'default':_0x2ce7db};};Object[a587_0x817c28(0x1bc)](exports,a587_0x817c28(0x1f7),{'value':!![]}),exports[a587_0x817c28(0x1ea)]=exports[a587_0x817c28(0x1c6)]=exports['verifyQueue']=exports['verifyDeleteMessage']=exports['verifyEditedMessage']=exports[a587_0x817c28(0x269)]=exports['verifyContact']=exports[a587_0x817c28(0x1e0)]=exports[a587_0x817c28(0x24e)]=exports[a587_0x817c28(0x231)]=void 0x0;const Message_1=__importDefault(require('../../models/Message')),Ticket_1=__importDefault(require(a587_0x817c28(0x1e9))),Contact_1=__importDefault(require(a587_0x817c28(0x253))),socket_1=require(a587_0x817c28(0x257)),baileys_1=require('@whiskeysockets/baileys'),CreateMessageService_1=__importDefault(require(a587_0x817c28(0x242))),GetHandlers_1=require(a587_0x817c28(0x1ad)),Queue_1=__importDefault(require(a587_0x817c28(0x1ae))),User_1=__importDefault(require(a587_0x817c28(0x23c))),Sentry=__importStar(require('@sentry/node')),CreateOrUpdateContactService_1=__importDefault(require(a587_0x817c28(0x241))),stream_throttle_1=require(a587_0x817c28(0x227)),MakeRandomId_1=require(a587_0x817c28(0x246)),CheckSettings_1=__importDefault(require(a587_0x817c28(0x263))),GetHandlers_2=require(a587_0x817c28(0x1ad)),GetPublicPath_1=require(a587_0x817c28(0x24f)),logger_1=require('../../utils/logger'),util_1=require(a587_0x817c28(0x264)),fs_1=__importStar(require('fs')),path_1=require('path'),OldMessage_1=__importDefault(require('../../models/OldMessage')),ShowWhatsAppService_1=__importDefault(require(a587_0x817c28(0x1e8))),lodash_1=require(a587_0x817c28(0x217)),ShowQueueIntegrationService_1=__importDefault(require('../QueueIntegrationServices/ShowQueueIntegrationService')),wbotMessageListener_1=require(a587_0x817c28(0x256)),Setting_1=__importDefault(require('../../models/Setting')),Campaign_1=__importDefault(require(a587_0x817c28(0x1ee))),CampaignShipping_1=__importDefault(require(a587_0x817c28(0x1b9))),moment_1=__importDefault(require(a587_0x817c28(0x1d6))),queues_1=require(a587_0x817c28(0x25a)),sequelize_1=require(a587_0x817c28(0x230)),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),Whatsapp_1=__importDefault(require(a587_0x817c28(0x233))),ExtractPhoneNumber_1=require(a587_0x817c28(0x21f)),writeFileAsync=(0x0,util_1[a587_0x817c28(0x1ef)])(fs_1['writeFile']),saveMediaToFile=async(_0x5509d6,_0x33647a)=>{const _0x14503b=a587_0x817c28;if(!_0x5509d6[_0x14503b(0x1c7)]){const _0x2e6259=_0x5509d6[_0x14503b(0x239)][_0x14503b(0x236)]('/')[0x1]['split'](';')[0x0];_0x5509d6['filename']=new Date()['getTime']()+'.'+_0x2e6259;}const _0x40bc51=(0x0,GetPublicPath_1['getPublicPath'])(),_0x32ee9b=(0x0,MakeRandomId_1[_0x14503b(0x20f)])(0xa),_0xeea508='media/'+_0x33647a['companyId']+'/'+_0x33647a[_0x14503b(0x224)]+'/'+_0x33647a['id']+'/'+_0x32ee9b;try{await fs_1[_0x14503b(0x244)][_0x14503b(0x1ab)][_0x14503b(0x22b)]((0x0,path_1[_0x14503b(0x1b1)])(_0x40bc51,_0xeea508),{'recursive':!![]}),await writeFileAsync((0x0,path_1[_0x14503b(0x1b1)])(_0x40bc51,_0xeea508,_0x5509d6[_0x14503b(0x1c7)]),_0x5509d6[_0x14503b(0x26f)],_0x14503b(0x207));}catch(_0x2b1184){Sentry[_0x14503b(0x1f1)](_0x2b1184),logger_1[_0x14503b(0x251)][_0x14503b(0x1db)](_0x2b1184);}return _0xeea508+'/'+_0x5509d6['filename'];},normalizeMediaType=_0x4c81ab=>{const _0x4c10ec=a587_0x817c28,_0x366af4=[_0x4c10ec(0x1e2),'video',_0x4c10ec(0x1cd),_0x4c10ec(0x1f4)],_0x5d0dc5=_0x4c81ab[_0x4c10ec(0x236)]('/')[0x0];if(!_0x366af4['includes'](_0x5d0dc5))return _0x4c10ec(0x1f4);return _0x5d0dc5;};exports['normalizeMediaType']=normalizeMediaType;const normalizeThumbnailMediaType=_0x2d4afc=>{const _0x179ad7=a587_0x817c28,_0x56dae0=[_0x179ad7(0x20a),_0x179ad7(0x1ec),_0x179ad7(0x1d3)],_0x13fd6a=_0x2d4afc['split']('/')[0x0];if(!_0x56dae0['includes'](_0x179ad7(0x1e6)+_0x13fd6a))return _0x179ad7(0x1d3);return _0x13fd6a;};exports[a587_0x817c28(0x24e)]=normalizeThumbnailMediaType;const downloadMedia=async(_0x21fb1f,_0xb8fed,_0x187911)=>{const _0x3bdac9=a587_0x817c28,_0x3aca64=(0x0,GetHandlers_2[_0x3bdac9(0x1f5)])(_0x21fb1f),_0x6607fe=(0x0,GetHandlers_2[_0x3bdac9(0x1d4)])(_0x3aca64);if(!_0x6607fe)return null;const _0x420335=parseInt(await(0x0,CheckSettings_1[_0x3bdac9(0x244)])(_0x3bdac9(0x262),'15'),0xa);if(_0xb8fed&&_0x6607fe?.['fileLength']&&+_0x6607fe[_0x3bdac9(0x218)]>_0x420335*0x400*0x400){const _0x37575c='*Mensagem\x20Autom√°tica*:\x0aNosso\x20sistema\x20aceita\x20apenas\x20arquivos\x20com\x20no\x20m√°ximo\x20'+_0x420335+_0x3bdac9(0x1f9);if(!_0x187911[_0x3bdac9(0x22e)]){const _0x303a75=await(0x0,SendWhatsAppMessage_1[_0x3bdac9(0x244)])({'ticket':_0x187911,'body':_0x37575c});_0x303a75[_0x3bdac9(0x202)]['extendedTextMessage'][_0x3bdac9(0x270)]=_0x3bdac9(0x214);}throw new Error('ERR_FILESIZE_OVER_LIMIT');}const _0x375571=_0x3aca64?.[_0x3bdac9(0x1ac)]?'document':(0x0,exports['normalizeMediaType'])(_0x6607fe['mimetype']);let _0x4a138d,_0x29c262=0x0;while(_0x29c262<0xa&&!_0x4a138d){try{const _0x4e9cf2={..._0x6607fe};_0x4e9cf2?.[_0x3bdac9(0x25f)]&&(_0x4e9cf2[_0x3bdac9(0x1aa)]=''),_0x4a138d=await(0x0,baileys_1[_0x3bdac9(0x22a)])(_0x4e9cf2,_0x375571);}catch(_0x477cc0){_0x29c262+=0x1,await new Promise(_0x26e969=>{setTimeout(_0x26e969,0x3e8*_0x29c262*0x2);}),logger_1[_0x3bdac9(0x251)][_0x3bdac9(0x240)](_0x3bdac9(0x219)+_0x29c262+_0x3bdac9(0x1e5)+_0x21fb1f?.[_0x3bdac9(0x266)]?.['id']);}}if(!_0x4a138d)throw new Error(_0x3bdac9(0x1fb));const _0x324ded=await downloadStream(_0x4a138d);if(!_0x324ded){Sentry['setExtra'](_0x3bdac9(0x1f6),{'msg':_0x21fb1f}),Sentry['captureException'](new Error(_0x3bdac9(0x1f6)));throw new Error(_0x3bdac9(0x1f6));}let _0x45381c=_0x3aca64?.[_0x3bdac9(0x1ac)]?.['fileName']||'';if(!_0x45381c){const _0x2298eb=_0x6607fe[_0x3bdac9(0x239)][_0x3bdac9(0x236)]('/')[0x1][_0x3bdac9(0x236)](';')[0x0];_0x45381c=(0x0,MakeRandomId_1[_0x3bdac9(0x20f)])(0x5)+'-'+new Date()[_0x3bdac9(0x200)]()+'.'+_0x2298eb;}else _0x45381c=_0x45381c[_0x3bdac9(0x236)]('.')[_0x3bdac9(0x208)](0x0,-0x1)['join']('.')+'.'+(0x0,MakeRandomId_1[_0x3bdac9(0x20f)])(0x5)+'.'+_0x45381c[_0x3bdac9(0x236)]('.')['slice'](-0x1);const _0x4c0799={'data':_0x324ded,'mimetype':_0x6607fe['mimetype'],'filename':_0x45381c};return _0x4c0799;},downloadStream=async _0x42ee95=>{const _0x149bee=a587_0x817c28,_0x40cb91=0x5*0x400*0x400/0x8,_0x4fe159=0x400*0x400/0x8,_0x1b16c5=0x400*0x400,_0x48ac72=new stream_throttle_1[(_0x149bee(0x1b0))]({'rate':_0x40cb91});let _0x745f55=Buffer['from']([]),_0x3e12d3=0x0;try{for await(const _0x4d3723 of _0x42ee95[_0x149bee(0x26c)](_0x48ac72)){_0x745f55=Buffer[_0x149bee(0x1eb)]([_0x745f55,_0x4d3723]),_0x3e12d3+=_0x4d3723[_0x149bee(0x1e7)],_0x3e12d3>_0x1b16c5&&(_0x48ac72[_0x149bee(0x215)]=_0x4fe159);}}catch(_0x2c6c10){Sentry[_0x149bee(0x1fd)](_0x149bee(0x1f6),{'error':_0x2c6c10}),Sentry[_0x149bee(0x1f1)](new Error('ERR_WAPP_DOWNLOAD_MEDIA'));throw new Error(_0x149bee(0x1f6));}return _0x745f55;},downloadThumbnail=async({thumbnailDirectPath:_0x2aa833,mediaKey:_0x45ffdd,mimetype:_0x160d7b})=>{const _0x361d85=a587_0x817c28;if(!_0x2aa833||!_0x45ffdd)return null;const _0x2a5cd3=await(0x0,baileys_1[_0x361d85(0x22a)])({'mediaKey':_0x45ffdd,'directPath':_0x2aa833},_0x160d7b?(0x0,exports['normalizeThumbnailMediaType'])(_0x160d7b):_0x361d85(0x225));if(!_0x2a5cd3)throw new Error(_0x361d85(0x1fb));const _0x5fa846=await downloadStream(_0x2a5cd3);if(!_0x5fa846)throw new Error(_0x361d85(0x1f6));const _0x389cf1=_0x361d85(0x1e6)+(0x0,MakeRandomId_1[_0x361d85(0x20f)])(0x5)+'-'+new Date()[_0x361d85(0x200)]()+_0x361d85(0x1be),_0x4dbd34={'data':_0x5fa846,'mimetype':_0x361d85(0x265),'filename':_0x389cf1};return _0x4dbd34;},verifyMessage=async(_0x7bcef5,_0x471038,_0x2b77b4,_0x30bb33=null,_0x10c82b=null)=>{const _0x81802=a587_0x817c28,_0x47f04a=(0x0,socket_1[_0x81802(0x22d)])(),_0x43e48b=await verifyQuotedMessage(_0x7bcef5),_0x1b041f=(0x0,GetHandlers_1[_0x81802(0x1b8)])(_0x7bcef5),_0x331839={'id':_0x7bcef5[_0x81802(0x266)]['id'],'ticketId':_0x471038['id'],'userId':_0x30bb33,'contactId':_0x7bcef5[_0x81802(0x266)][_0x81802(0x21e)]?undefined:_0x2b77b4['id'],'body':_0x1b041f,'fromMe':_0x7bcef5['key']['fromMe'],'mediaType':_0x7bcef5[_0x81802(0x202)]['reactionMessage']?'reactionMessage':null,'read':_0x7bcef5[_0x81802(0x266)][_0x81802(0x21e)],'quotedMsgId':_0x43e48b?.['id'],'ack':_0x7bcef5[_0x81802(0x20e)]||(_0x7bcef5[_0x81802(0x266)][_0x81802(0x21e)]?0x1:0x0),'remoteJid':_0x7bcef5['key'][_0x81802(0x1df)],'participant':_0x7bcef5[_0x81802(0x266)]['participant'],'dataJson':JSON[_0x81802(0x25e)](_0x7bcef5),'isEdited':![]};await _0x471038['update']({'lastMessage':_0x1b041f[_0x81802(0x26a)](0x0,0xff)[_0x81802(0x1a9)](/\n/g,'\x20')});const _0x4c8531=await(0x0,CreateMessageService_1[_0x81802(0x244)])({'messageData':_0x331839,'companyId':_0x471038[_0x81802(0x1af)]});if(!_0x7bcef5[_0x81802(0x266)][_0x81802(0x21e)]){const _0x34762c=_0x7bcef5[_0x81802(0x266)],_0x522b5c=_0x7bcef5[_0x81802(0x266)]['remoteJid'],_0x498482=_0x34762c[_0x81802(0x1b4)];let _0x39b69f=null,_0x57e448=null;if(_0x522b5c?.[_0x81802(0x1d9)](_0x81802(0x1c4)))_0x39b69f=_0x522b5c,_0x57e448=_0x498482;else _0x522b5c?.[_0x81802(0x1d9)](_0x81802(0x26d))&&(_0x57e448=_0x522b5c,_0x39b69f=_0x498482);const _0x1d13d7=_0x39b69f?.['split']('@')[0x0],_0x49e224=_0x57e448?.[_0x81802(0x236)]('@')[0x0],_0x48b8e9=_0x1d13d7&&_0x1d13d7!==_0x2b77b4[_0x81802(0x203)]||_0x49e224&&_0x49e224!==_0x2b77b4['lid'];if(_0x48b8e9){if(_0x1d13d7&&_0x1d13d7!==_0x2b77b4[_0x81802(0x203)]){const _0x55d80f=await Contact_1[_0x81802(0x244)][_0x81802(0x1cb)]({'where':{'number':_0x1d13d7,'companyId':_0x2b77b4[_0x81802(0x1af)]}});if(_0x55d80f&&_0x55d80f['id']!==_0x2b77b4['id']){await _0x471038[_0x81802(0x201)]({'contactId':_0x55d80f['id']}),await _0x4c8531[_0x81802(0x201)]({'contactId':_0x55d80f['id']});const _0x3ced29={};_0x49e224&&!_0x55d80f[_0x81802(0x24b)]&&(_0x3ced29[_0x81802(0x24b)]=_0x49e224);_0x39b69f&&!_0x55d80f[_0x81802(0x1df)]&&(_0x3ced29[_0x81802(0x1df)]=_0x39b69f);const _0x5c8c25=!_0x55d80f[_0x81802(0x260)]||_0x55d80f[_0x81802(0x260)]===''||_0x55d80f[_0x81802(0x260)]===process[_0x81802(0x250)][_0x81802(0x21b)]+'/nopicture.png';if(_0x5c8c25&&_0x10c82b)try{const _0x3f5fbf=_0x57e448||_0x39b69f||_0x522b5c,_0x24639e=await _0x10c82b[_0x81802(0x26b)](_0x3f5fbf);_0x24639e&&_0x24639e!==process[_0x81802(0x250)]['FRONTEND_URL']+'/nopicture.png'&&(_0x3ced29[_0x81802(0x260)]=_0x24639e);}catch(_0x57f896){}Object['keys'](_0x3ced29)[_0x81802(0x1e7)]>0x0&&await _0x55d80f[_0x81802(0x201)](_0x3ced29);const _0x29d8ad=await Ticket_1[_0x81802(0x244)]['count']({'where':{'contactId':_0x2b77b4['id']}});_0x29d8ad===0x0?(await _0x2b77b4['destroy'](),console[_0x81802(0x1f8)](_0x81802(0x1cf)+_0x2b77b4['id'])):console[_0x81802(0x1f8)](_0x81802(0x1a7)+_0x2b77b4['id']+'\x20(has\x20'+_0x29d8ad+'\x20other\x20tickets)');return;}}const _0x5ed98a={};_0x1d13d7&&_0x1d13d7!==_0x2b77b4[_0x81802(0x203)]&&(_0x5ed98a['number']=_0x1d13d7),_0x49e224&&_0x49e224!==_0x2b77b4[_0x81802(0x24b)]&&(_0x5ed98a[_0x81802(0x24b)]=_0x49e224),_0x39b69f&&_0x39b69f!==_0x2b77b4['remoteJid']&&(_0x5ed98a[_0x81802(0x1df)]=_0x39b69f),Object['keys'](_0x5ed98a)['length']>0x0&&(console[_0x81802(0x1f8)]('[verifyMessage]\x20Updating\x20contact\x20'+_0x2b77b4['id']+':',_0x5ed98a),await _0x2b77b4['update'](_0x5ed98a));}else console[_0x81802(0x1f8)]('[verifyMessage]\x20Contact\x20'+_0x2b77b4['id']+_0x81802(0x1ba));}return!_0x7bcef5[_0x81802(0x266)][_0x81802(0x21e)]&&_0x471038[_0x81802(0x20e)]===_0x81802(0x1ff)&&(await _0x471038[_0x81802(0x201)]({'status':_0x81802(0x235)}),await _0x471038['reload']({'include':[{'model':Queue_1['default'],'as':_0x81802(0x1c9)},{'model':User_1[_0x81802(0x244)],'as':_0x81802(0x1f0)},{'model':Contact_1['default'],'as':_0x81802(0x209)}]}),_0x47f04a['to'](_0x81802(0x228)+_0x471038[_0x81802(0x1af)]+_0x81802(0x1ed))['to'](_0x81802(0x1ca)+_0x471038[_0x81802(0x23d)]+_0x81802(0x1ed))[_0x81802(0x23b)](_0x81802(0x228)+_0x471038[_0x81802(0x1af)]+_0x81802(0x1f3),{'action':'delete','ticket':_0x471038,'ticketId':_0x471038['id']}),_0x47f04a['to'](_0x81802(0x228)+_0x471038[_0x81802(0x1af)]+'-'+_0x471038[_0x81802(0x20e)])['to'](_0x81802(0x1ca)+_0x471038[_0x81802(0x23d)]+'-'+_0x471038[_0x81802(0x20e)])['to'](_0x471038['id'][_0x81802(0x24d)]())[_0x81802(0x23b)](_0x81802(0x228)+_0x471038[_0x81802(0x1af)]+'-ticket',{'action':'update','ticket':_0x471038,'ticketId':_0x471038['id']})),_0x4c8531;};exports[a587_0x817c28(0x1e0)]=verifyMessage;const verifyQuotedMessage=async _0x545e23=>{const _0x57c71c=a587_0x817c28;if(!_0x545e23)return null;const _0x487297=(0x0,GetHandlers_1[_0x57c71c(0x21d)])(_0x545e23);if(!_0x487297)return null;const _0x26ca47=await Message_1[_0x57c71c(0x244)][_0x57c71c(0x1cb)]({'where':{'id':_0x487297}});if(!_0x26ca47)return null;return _0x26ca47;},verifyContact=async(_0x3727a0,_0x254674,_0x66e9ac,_0x1aa568)=>{const _0x2ae38f=a587_0x817c28;if(_0x3727a0['id']?.['endsWith'](_0x2ae38f(0x1c1)))return logger_1[_0x2ae38f(0x251)][_0x2ae38f(0x1b7)](_0x2ae38f(0x1c3)+_0x3727a0['id']),null;let _0x4f7645;try{_0x4f7645=await _0x254674[_0x2ae38f(0x26b)](_0x3727a0['id']);}catch(_0x2a74a9){Sentry['captureException'](_0x2a74a9),_0x4f7645=process['env'][_0x2ae38f(0x21b)]+_0x2ae38f(0x23a);}const _0x59d372=(0x0,ExtractPhoneNumber_1[_0x2ae38f(0x1d8)])(_0x3727a0['id']),_0x558bce=_0x3727a0['id']['includes'](_0x2ae38f(0x26d)),_0x346e9e=_0x558bce?_0x3727a0['id']['split']('@')[0x0]:null;if(_0x1aa568&&_0x558bce){const _0x13232f=_0x1aa568[_0x2ae38f(0x236)]('@')[0x0],_0x4f88a3=await Contact_1[_0x2ae38f(0x244)][_0x2ae38f(0x1cb)]({'where':{'companyId':_0x66e9ac,[sequelize_1['Op']['or']]:[{'number':_0x13232f},{'number':_0x346e9e},{'lid':_0x346e9e}]},'order':[[(0x0,sequelize_1[_0x2ae38f(0x267)])(_0x2ae38f(0x1d2)+_0x13232f+_0x2ae38f(0x259)),_0x2ae38f(0x252)]]});if(_0x4f88a3){const _0x2feec4={};_0x4f88a3[_0x2ae38f(0x203)]===_0x346e9e&&(_0x2feec4[_0x2ae38f(0x203)]=_0x13232f);_0x346e9e&&!_0x4f88a3['lid']&&(_0x2feec4[_0x2ae38f(0x24b)]=_0x346e9e);(!_0x4f88a3[_0x2ae38f(0x1df)]||_0x4f88a3['remoteJid']['includes'](_0x2ae38f(0x26d)))&&(_0x2feec4['remoteJid']=_0x1aa568);const _0x45a4f4=!_0x4f88a3['profilePicUrl']||_0x4f88a3['profilePicUrl']===''||_0x4f88a3[_0x2ae38f(0x260)]===process['env'][_0x2ae38f(0x21b)]+_0x2ae38f(0x23a);return _0x45a4f4&&_0x4f7645&&_0x4f7645!==process[_0x2ae38f(0x250)][_0x2ae38f(0x21b)]+_0x2ae38f(0x23a)&&(_0x2feec4['profilePicUrl']=_0x4f7645),Object[_0x2ae38f(0x1c0)](_0x2feec4)[_0x2ae38f(0x1e7)]>0x0&&await _0x4f88a3['update'](_0x2feec4),_0x4f88a3;}const _0x5e5303={'name':_0x3727a0?.['name']||_0x13232f||_0x3727a0['id'][_0x2ae38f(0x1a9)](/\D/g,''),'number':_0x13232f,'profilePicUrl':_0x4f7645,'isGroup':_0x3727a0['id'][_0x2ae38f(0x1d9)](_0x2ae38f(0x1fe)),'companyId':_0x66e9ac,'remoteJid':_0x1aa568,'lid':_0x346e9e},_0x5c2737=(0x0,CreateOrUpdateContactService_1[_0x2ae38f(0x244)])(_0x5e5303);return _0x5c2737;}const _0x1e6ab5={'name':_0x3727a0?.[_0x2ae38f(0x1b2)]||_0x59d372||_0x3727a0['id'][_0x2ae38f(0x1a9)](/\D/g,''),'number':_0x59d372||_0x3727a0['id']['substring'](0x0,_0x3727a0['id'][_0x2ae38f(0x216)]('@')),'profilePicUrl':_0x4f7645,'isGroup':_0x3727a0['id'][_0x2ae38f(0x1d9)]('g.us'),'companyId':_0x66e9ac,'remoteJid':_0x3727a0['id'],'lid':_0x346e9e},_0x290729=(0x0,CreateOrUpdateContactService_1['default'])(_0x1e6ab5);return _0x290729;};exports[a587_0x817c28(0x1cc)]=verifyContact;const verifyMediaMessage=async(_0x3b9f79,_0xe793b0,_0x383516,_0x57e9f0=null,_0x2d374b=null,_0x37cc5c=null)=>{const _0x2a8715=a587_0x817c28,_0x5c384e=(0x0,socket_1[_0x2a8715(0x22d)])(),_0x1ba22e=await verifyQuotedMessage(_0x3b9f79),_0x464aaa=_0x2d374b||_0x3b9f79?.[_0x2a8715(0x202)]?.[_0x2a8715(0x249)],_0x263af5=_0x464aaa&&await downloadThumbnail(_0x464aaa),_0x5bd704=await downloadMedia(_0x3b9f79,_0x57e9f0,_0xe793b0);if(!_0x5bd704&&!_0x263af5)throw new Error(_0x2a8715(0x1f6));let _0x28ff59=null;_0x5bd704&&(_0x28ff59=await saveMediaToFile(_0x5bd704,_0xe793b0));let _0x7c8d4d=null;_0x263af5&&(_0x7c8d4d=await saveMediaToFile(_0x263af5,_0xe793b0));const _0x3ce2a3=(0x0,GetHandlers_1['getBodyMessage'])(_0x3b9f79),_0x22b645={'id':_0x3b9f79['key']['id'],'ticketId':_0xe793b0['id'],'userId':_0x37cc5c,'contactId':_0x3b9f79[_0x2a8715(0x266)][_0x2a8715(0x21e)]?undefined:_0x383516['id'],'body':_0x3ce2a3||'','fromMe':_0x3b9f79['key'][_0x2a8715(0x21e)],'read':_0x3b9f79[_0x2a8715(0x266)][_0x2a8715(0x21e)],'mediaUrl':_0x28ff59,'mediaType':_0x5bd704?.[_0x2a8715(0x239)][_0x2a8715(0x236)]('/')[0x0],'thumbnailUrl':_0x7c8d4d,'quotedMsgId':_0x1ba22e?.['id'],'ack':_0x3b9f79[_0x2a8715(0x20e)]||(_0x3b9f79[_0x2a8715(0x266)]['fromMe']?0x1:0x0),'remoteJid':_0x3b9f79[_0x2a8715(0x266)][_0x2a8715(0x1df)],'participant':_0x3b9f79[_0x2a8715(0x266)]['participant'],'dataJson':JSON[_0x2a8715(0x25e)](_0x3b9f79)};await _0xe793b0['update']({'lastMessage':_0x3ce2a3||_0x5bd704?.[_0x2a8715(0x1c7)]?_0x2a8715(0x1de)+_0x5bd704?.['filename']:''});const _0x56f422=await(0x0,CreateMessageService_1['default'])({'messageData':_0x22b645,'companyId':_0xe793b0[_0x2a8715(0x1af)]});if(!_0x3b9f79[_0x2a8715(0x266)][_0x2a8715(0x21e)]){const _0x359261=_0x3b9f79['key'],_0x437a5c=_0x3b9f79[_0x2a8715(0x266)][_0x2a8715(0x1df)],_0x32c24a=_0x359261[_0x2a8715(0x1b4)];let _0x195a53=null;if(_0x437a5c?.['includes'](_0x2a8715(0x1c4)))_0x195a53=_0x437a5c;else _0x437a5c?.[_0x2a8715(0x1d9)](_0x2a8715(0x26d))&&(_0x195a53=_0x32c24a);if(_0x195a53){const _0x529bbb=_0x195a53[_0x2a8715(0x236)]('@')[0x0];if(_0x529bbb!==_0x383516[_0x2a8715(0x203)]){const _0x1a42b9={'number':_0x529bbb,'remoteJid':_0x195a53};_0x383516['profilePicUrl']&&_0x383516['profilePicUrl']!==process[_0x2a8715(0x250)][_0x2a8715(0x21b)]+_0x2a8715(0x23a)&&(_0x1a42b9[_0x2a8715(0x260)]=_0x383516['profilePicUrl']),await _0x383516[_0x2a8715(0x201)](_0x1a42b9);}}}return!_0x3b9f79[_0x2a8715(0x266)]['fromMe']&&_0xe793b0[_0x2a8715(0x20e)]===_0x2a8715(0x1ff)&&(await _0xe793b0['update']({'status':'pending'}),await _0xe793b0['reload']({'include':[{'model':Queue_1['default'],'as':_0x2a8715(0x1c9)},{'model':User_1['default'],'as':_0x2a8715(0x1f0)},{'model':Contact_1[_0x2a8715(0x244)],'as':_0x2a8715(0x209)}]}),_0x5c384e['to'](_0x2a8715(0x228)+_0xe793b0[_0x2a8715(0x1af)]+_0x2a8715(0x1ed))['to']('queue-'+_0xe793b0[_0x2a8715(0x23d)]+_0x2a8715(0x1ed))['emit']('company-'+_0xe793b0[_0x2a8715(0x1af)]+_0x2a8715(0x1f3),{'action':'delete','ticket':_0xe793b0,'ticketId':_0xe793b0['id']}),_0x5c384e['to'](_0x2a8715(0x228)+_0xe793b0[_0x2a8715(0x1af)]+'-'+_0xe793b0[_0x2a8715(0x20e)])['to'](_0x2a8715(0x1ca)+_0xe793b0[_0x2a8715(0x23d)]+'-'+_0xe793b0[_0x2a8715(0x20e)])['to'](_0xe793b0['id'][_0x2a8715(0x24d)]())[_0x2a8715(0x23b)](_0x2a8715(0x228)+_0xe793b0[_0x2a8715(0x1af)]+_0x2a8715(0x1f3),{'action':'update','ticket':_0xe793b0,'ticketId':_0xe793b0['id']})),_0x56f422;};exports[a587_0x817c28(0x269)]=verifyMediaMessage;const verifyEditedMessage=async(_0x278148,_0x353656,_0x3f6083)=>{const _0x42f99f=a587_0x817c28,_0xbb5e11=(0x0,GetHandlers_2[_0x42f99f(0x261)])(_0x278148);let _0x280da6;switch(_0xbb5e11){case _0x42f99f(0x1c2):{_0x280da6=_0x278148['conversation'];break;}case _0x42f99f(0x249):{_0x280da6=_0x278148[_0x42f99f(0x249)][_0x42f99f(0x270)];break;}case'imageMessage':{_0x280da6=_0x278148[_0x42f99f(0x24a)][_0x42f99f(0x1b5)];break;}case _0x42f99f(0x1ac):{_0x280da6=_0x278148[_0x42f99f(0x1ac)][_0x42f99f(0x1b5)];break;}case _0x42f99f(0x1f2):{_0x280da6=_0x278148[_0x42f99f(0x1f2)]['message'][_0x42f99f(0x1ac)][_0x42f99f(0x1b5)];break;}default:{return;}}const _0x3e1156=await Message_1[_0x42f99f(0x244)][_0x42f99f(0x1d7)](_0x3f6083),_0x862b00={'id':_0x3e1156['id'],'ticketId':_0x3e1156[_0x42f99f(0x1bb)],'contactId':_0x3e1156['contactId'],'body':_0x280da6,'fromMe':_0x3e1156[_0x42f99f(0x21e)],'mediaType':_0x3e1156[_0x42f99f(0x21c)],'read':_0x3e1156[_0x42f99f(0x1fa)],'quotedMsgId':_0x3e1156[_0x42f99f(0x1ce)],'ack':_0x3e1156[_0x42f99f(0x1e3)],'remoteJid':_0x3e1156[_0x42f99f(0x1df)],'participant':_0x3e1156['participant'],'dataJson':_0x3e1156[_0x42f99f(0x22c)],'isEdited':!![]},_0x158eb4={'messageId':_0x862b00['id'],'body':_0x3e1156['body'],'ticketId':_0x3e1156[_0x42f99f(0x1bb)]};await OldMessage_1['default']['upsert'](_0x158eb4),await _0x353656[_0x42f99f(0x201)]({'lastMessage':_0x862b00[_0x42f99f(0x1da)]}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x862b00,'companyId':_0x353656[_0x42f99f(0x1af)]});const _0x46b9b1=(0x0,socket_1['getIO'])();_0x46b9b1['to'](_0x353656['status'])['to'](_0x353656['id'][_0x42f99f(0x24d)]())[_0x42f99f(0x23b)](_0x42f99f(0x228)+_0x353656[_0x42f99f(0x1af)]+_0x42f99f(0x1f3),{'action':_0x42f99f(0x201),'ticket':_0x353656,'ticketId':_0x353656['id']});};exports[a587_0x817c28(0x211)]=verifyEditedMessage;const verifyDeleteMessage=async(_0x566959,_0x2446fd)=>{const _0x5d1860=a587_0x817c28,_0x269d4e=await Message_1['default'][_0x5d1860(0x1d7)](_0x566959[_0x5d1860(0x266)]['id'],{'include':['contact',{'model':Ticket_1['default'],'include':[{'model':Contact_1[_0x5d1860(0x244)]}]}]});if(!_0x269d4e)return;await _0x269d4e[_0x5d1860(0x201)]({'isDeleted':!![]});const _0x55fde8=(0x0,socket_1[_0x5d1860(0x22d)])();_0x55fde8['to'](_0x269d4e[_0x5d1860(0x1bb)][_0x5d1860(0x24d)]())['to'](_0x269d4e[_0x5d1860(0x210)]['status'])['to']('notification')[_0x5d1860(0x23b)](_0x5d1860(0x228)+_0x2446fd[_0x5d1860(0x1af)]+'-appMessage',{'action':_0x5d1860(0x234),'message':_0x269d4e,'ticket':_0x269d4e[_0x5d1860(0x210)],'contact':_0x269d4e[_0x5d1860(0x210)][_0x5d1860(0x209)]});};exports['verifyDeleteMessage']=verifyDeleteMessage;const verifyQueue=async(_0x1820d,_0x3de129,_0x3f5866,_0x1cd310)=>{const _0x10053c=a587_0x817c28;if(_0x3de129?.['key']['id']&&_0x3f5866[_0x10053c(0x1a6)]===_0x3de129['key']['id']){console['log'](_0x10053c(0x23f)+_0x3de129[_0x10053c(0x266)]['id']+_0x10053c(0x1d0)+_0x3f5866['id']+_0x10053c(0x1dc));return;}_0x3de129?.['key']['id']&&await _0x3f5866[_0x10053c(0x201)]({'lastProcessedMessageId':_0x3de129[_0x10053c(0x266)]['id']});const _0x264b52=await(0x0,ShowWhatsAppService_1['default'])(_0x1820d['id'],_0x3f5866[_0x10053c(0x1af)]),{queues:_0x13ac36,greetingMessage:_0x1b335d}=_0x264b52,_0x5b2b8a=await Setting_1['default'][_0x10053c(0x1cb)]({'where':{'key':'chatBotType','companyId':_0x3f5866['companyId']}});if(_0x13ac36[_0x10053c(0x1e7)]===0x1){const _0x541853=(0x0,lodash_1[_0x10053c(0x1d1)])(_0x13ac36);if(!_0x541853)return;const _0x26a361=_0x541853?.[_0x10053c(0x229)]?.[_0x10053c(0x1e7)]>0x0;await _0x3f5866['update']({'amountUsedBotQueues':0x0,'queueOptionId':null});if(!_0x3f5866[_0x10053c(0x220)]&&_0x541853[_0x10053c(0x24c)]&&!_0x3de129?.['key'][_0x10053c(0x21e)]&&!_0x3f5866[_0x10053c(0x22e)])try{const _0x382ae7=await(0x0,ShowQueueIntegrationService_1[_0x10053c(0x244)])(_0x541853[_0x10053c(0x24c)],_0x3f5866[_0x10053c(0x1af)]);if(_0x382ae7){await _0x3f5866[_0x10053c(0x201)]({'useIntegration':!![],'integrationId':_0x382ae7['id'],'amountUsedBotQueues':0x0});_0x3de129&&await(0x0,wbotMessageListener_1[_0x10053c(0x1b6)])(_0x3de129,_0x1820d,_0x382ae7,_0x3f5866);console['log'](_0x10053c(0x22f)+_0x382ae7['id']+_0x10053c(0x232)+_0x3f5866['id']);return;}}catch(_0x3b5585){console[_0x10053c(0x1db)]('Erro\x20ao\x20processar\x20integra√ß√£o\x20para\x20fila\x20√∫nica:',_0x3b5585),await _0x3f5866['update']({'useIntegration':![],'integrationId':null});}await _0x3f5866[_0x10053c(0x201)]({'queueId':_0x541853['id'],'chatbot':_0x26a361});_0x541853[_0x10053c(0x206)]&&await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x3f5866,'body':_0x541853[_0x10053c(0x206)]});_0x26a361&&await(0x0,wbotMessageListener_1[_0x10053c(0x25d)])(_0x3f5866,_0x1820d);return;}const _0x10e80f=_0x3de129?(0x0,GetHandlers_1[_0x10053c(0x1b8)])(_0x3de129):null,_0x13045e=_0x10e80f?_0x13ac36[+_0x10e80f-0x1]:null;if(_0x13045e){await _0x3f5866[_0x10053c(0x201)]({'amountUsedBotQueues':0x0,'queueOptionId':null});if(!_0x3f5866[_0x10053c(0x220)]&&_0x13045e['integrationId']&&!_0x3de129?.[_0x10053c(0x266)]['fromMe']&&!_0x3f5866[_0x10053c(0x22e)])try{const _0x1d2cbd=await(0x0,ShowQueueIntegrationService_1[_0x10053c(0x244)])(_0x13045e['integrationId'],_0x3f5866['companyId']);if(_0x1d2cbd){await _0x3f5866[_0x10053c(0x201)]({'useIntegration':!![],'integrationId':_0x1d2cbd['id']}),await(0x0,wbotMessageListener_1[_0x10053c(0x1b6)])(_0x3de129,_0x1820d,_0x1d2cbd,_0x3f5866),console[_0x10053c(0x1f8)](_0x10053c(0x22f)+_0x1d2cbd['id']+_0x10053c(0x232)+_0x3f5866['id']);return;}}catch(_0x5e55db){console[_0x10053c(0x1db)]('Erro\x20ao\x20processar\x20integra√ß√£o\x20para\x20fila\x20escolhida:',_0x5e55db),await _0x3f5866[_0x10053c(0x201)]({'useIntegration':![],'integrationId':null});}const _0x44c111=_0x13045e?.[_0x10053c(0x229)]?.[_0x10053c(0x1e7)]>0x0;await _0x3f5866[_0x10053c(0x201)]({'queueId':_0x13045e['id'],'chatbot':_0x44c111});_0x13045e[_0x10053c(0x206)]&&await(0x0,SendWhatsAppMessage_1[_0x10053c(0x244)])({'ticket':_0x3f5866,'body':_0x13045e[_0x10053c(0x206)]});_0x44c111&&await(0x0,wbotMessageListener_1[_0x10053c(0x25d)])(_0x3f5866,_0x1820d);return;}const _0x251cf0=await Whatsapp_1[_0x10053c(0x244)][_0x10053c(0x1d7)](_0x3f5866[_0x10053c(0x222)]);if(!_0x251cf0){console['error'](_0x10053c(0x23e));return;}if(!_0x3f5866['chatbot']&&_0x3f5866[_0x10053c(0x221)]>=_0x251cf0[_0x10053c(0x243)])return;if(_0x3de129&&_0x10e80f&&!_0x13045e){if(_0x251cf0[_0x10053c(0x243)]&&_0x251cf0[_0x10053c(0x243)]!==0x0&&_0x3f5866['amountUsedBotQueues']>=_0x251cf0[_0x10053c(0x243)]){await _0x3f5866['update']({'chatbot':![],'queueOptionId':null,'amountUsedBotQueues':_0x251cf0[_0x10053c(0x243)]});_0x251cf0['transferMessage']&&await(0x0,SendWhatsAppMessage_1[_0x10053c(0x244)])({'ticket':_0x3f5866,'body':_0x251cf0['transferMessage']});return;}await _0x3f5866[_0x10053c(0x201)]({'amountUsedBotQueues':_0x3f5866[_0x10053c(0x221)]+0x1}),await _0x3f5866[_0x10053c(0x1e1)]();}const _0x423eac=async()=>{const _0x11ed2b=_0x10053c;let _0x1e9f76='';_0x13ac36[_0x11ed2b(0x1dd)]((_0x2138b6,_0xf2f59)=>{const _0x22acc5=_0x11ed2b;_0x1e9f76+='*'+(_0xf2f59+0x1)+_0x22acc5(0x25b)+_0x2138b6[_0x22acc5(0x1b2)]+'\x0a';});const _0x1eb481=_0x1b335d+'\x0a\x0a'+_0x1e9f76;await(0x0,SendWhatsAppMessage_1[_0x11ed2b(0x244)])({'ticket':_0x3f5866,'body':_0x1eb481});};switch(_0x5b2b8a?.[_0x10053c(0x1fc)]){case _0x10053c(0x270):default:await _0x423eac();break;}};exports[a587_0x817c28(0x25c)]=verifyQueue;const verifyRating=_0x524e62=>{const _0x32d89f=a587_0x817c28;if(_0x524e62&&_0x524e62['finishedAt']===null&&_0x524e62[_0x32d89f(0x204)]!==null&&_0x524e62[_0x32d89f(0x248)]!==null)return!![];return![];};function a587_0x1f7f(_0x2dd787,_0x1ce0e9){const _0x3e8231=a587_0xcff4();return a587_0x1f7f=function(_0x3ade51,_0x142c6c){_0x3ade51=_0x3ade51-0x1a6;let _0xcff4ac=_0x3e8231[_0x3ade51];return _0xcff4ac;},a587_0x1f7f(_0x2dd787,_0x1ce0e9);}function a587_0xcff4(){const _0x508393=['thumbnail-','length','../WhatsappService/ShowWhatsAppService','../../models/Ticket','verifyRecentCampaign','concat','thumbnail-image','-closed','../../models/Campaign','promisify','user','captureException','documentWithCaptionMessage','-ticket','document','getUnpackedMessage','ERR_WAPP_DOWNLOAD_MEDIA','__esModule','log','\x20MiB','read','Failed\x20to\x20get\x20stream','value','setExtra','g.us','closed','getTime','update','message','number','userId','16848890GNJVpa','greetingMessage','base64','slice','contact','thumbnail-video','randomValue','27kRXMur','__setModuleDefault','status','makeRandomId','ticket','verifyEditedMessage','search','2NQbZOZ','*Mensagem\x20do\x20sistema*:\x0aArquivo\x20recebido\x20al√©m\x20do\x20limite\x20de\x20tamanho\x20do\x20sistema,\x20se\x20for\x20necess√°rio\x20ele\x20pode\x20ser\x20obtido\x20no\x20aplicativo\x20do\x20whatsapp.','rate','indexOf','lodash','fileLength','>>>>\x20erro\x20','campaignId','FRONTEND_URL','mediaType','getQuotedMessageId','fromMe','../../helpers/ExtractPhoneNumber','useIntegration','amountUsedBotQueues','whatsappId','6182730kGqhJR','contactId','thumbnail-link','__createBinding','stream-throttle','company-','options','downloadContentFromMessage','mkdir','dataJson','getIO','isGroup','Integra√ß√£o\x20#','sequelize','normalizeMediaType','\x20iniciada\x20para\x20o\x20ticket\x20#','../../models/Whatsapp','create','pending','split','hasOwnProperty','9657864AzWYjN','mimetype','/nopicture.png','emit','../../models/User','queueId','Configura√ß√µes\x20do\x20WhatsApp\x20n√£o\x20encontradas.','Mensagem\x20','warn','../ContactServices/CreateOrUpdateContactService','../MessageServices/CreateMessageService','maxUseBotQueues','default','parseToMilliseconds','../../helpers/MakeRandomId','631748uSOQYh','ratingAt','extendedTextMessage','imageMessage','lid','integrationId','toString','normalizeThumbnailMediaType','../../helpers/GetPublicPath','env','logger','ASC','../../models/Contact','6485130GcsjrX','30499tsGiRH','./wbotMessageListener','../../libs/socket','campaignQueue','\x27\x20THEN\x200\x20ELSE\x201\x20END','../../queues','*\x20-\x20','verifyQueue','displayCurrentMenu','stringify','directPath','profilePicUrl','getTypeEditedMessage','downloadLimit','../../helpers/CheckSettings','util','image/jpeg','key','literal','1138017sqJKss','verifyMediaMessage','substring','profilePictureUrl','pipe','@lid','call','data','text','lastProcessedMessageId','[verifyMessage]\x20Keeping\x20contact\x20','get','replace','url','promises','documentMessage','./GetHandlers','../../models/Queue','companyId','Throttle','join','name','(((.+)+)+)+$','remoteJidAlt','caption','handleMessageIntegration','info','getBodyMessage','../../models/CampaignShipping','\x20already\x20up\x20to\x20date','ticketId','defineProperty','getOwnPropertyDescriptor','.jpg','findAll','keys','@newsletter','conversation','Contato\x20de\x20canal/newsletter\x20ignorado:\x20','@s.whatsapp.net','getOwnPropertyNames','verifyRating','filename','prototype','queue','queue-','findOne','verifyContact','image','quotedMsgId','[verifyMessage]\x20Deleted\x20duplicate\x20contact\x20','\x20j√°\x20processada\x20para\x20o\x20ticket\x20','head','CASE\x20WHEN\x20number\x20=\x20\x27','thumbnail-document','getMessageMedia','configurable','moment','findByPk','getPhoneNumberFromJid','includes','body','error','.\x20Ignorando\x20em\x20verifyQueue.','forEach','üìé\x20','remoteJid','verifyMessage','reload','audio','ack','1688IhOLNW','\x20de\x20baixar\x20o\x20arquivo\x20'];a587_0xcff4=function(){return _0x508393;};return a587_0xcff4();}exports[a587_0x817c28(0x1c6)]=verifyRating;const verifyRecentCampaign=async(_0x5e384e,_0x5e1292)=>{const _0x54fee7=a587_0x817c28;if(!_0x5e384e['key']['fromMe']){const _0x5086f8=(0x0,ExtractPhoneNumber_1[_0x54fee7(0x1d8)])(_0x5e384e[_0x54fee7(0x266)][_0x54fee7(0x1df)]),_0x3a721c=await Campaign_1[_0x54fee7(0x244)][_0x54fee7(0x1bf)]({'where':{'companyId':_0x5e1292,'status':'EM_ANDAMENTO','confirmation':!![]}});if(_0x3a721c){const _0x1f7c54=_0x3a721c['map'](_0x3c3871=>_0x3c3871['id']),_0x3bd351=await CampaignShipping_1['default'][_0x54fee7(0x1cb)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x1f7c54},'number':_0x5086f8,'confirmation':null}});if(_0x3bd351)return await _0x3bd351[_0x54fee7(0x201)]({'confirmedAt':(0x0,moment_1[_0x54fee7(0x244)])(),'confirmation':!![]}),await queues_1[_0x54fee7(0x258)]['add']('DispatchConfirmedCampaign',{'campaignShippingId':_0x3bd351['id'],'campaignId':_0x3bd351[_0x54fee7(0x21a)]},{'delay':(0x0,queues_1[_0x54fee7(0x245)])((0x0,queues_1[_0x54fee7(0x20b)])(0x0,0xa))}),!![];}}return![];};exports[a587_0x817c28(0x1ea)]=verifyRecentCampaign;