const a560_0x395b41=a560_0x5704;(function(_0x5cac8b,_0x5bd328){const _0x41cd4d=a560_0x5704,_0x36673d=_0x5cac8b();while(!![]){try{const _0x4e862c=parseInt(_0x41cd4d(0x273))/0x1*(parseInt(_0x41cd4d(0x212))/0x2)+parseInt(_0x41cd4d(0x136))/0x3*(parseInt(_0x41cd4d(0x1d7))/0x4)+-parseInt(_0x41cd4d(0x232))/0x5+-parseInt(_0x41cd4d(0x201))/0x6+parseInt(_0x41cd4d(0x1db))/0x7*(-parseInt(_0x41cd4d(0x2b5))/0x8)+parseInt(_0x41cd4d(0x235))/0x9*(parseInt(_0x41cd4d(0x25f))/0xa)+-parseInt(_0x41cd4d(0x1c4))/0xb*(-parseInt(_0x41cd4d(0x185))/0xc);if(_0x4e862c===_0x5bd328)break;else _0x36673d['push'](_0x36673d['shift']());}catch(_0x28d009){_0x36673d['push'](_0x36673d['shift']());}}}(a560_0x14d9,0xed017));const a560_0x33dbfe=(function(){let _0x1076f4=!![];return function(_0x10ba79,_0x100d09){const _0x27c9b9=_0x1076f4?function(){const _0x3082f4=a560_0x5704;if(_0x100d09){const _0x5a2956=_0x100d09[_0x3082f4(0x2ab)](_0x10ba79,arguments);return _0x100d09=null,_0x5a2956;}}:function(){};return _0x1076f4=![],_0x27c9b9;};}()),a560_0x39c428=a560_0x33dbfe(this,function(){const _0x20989e=a560_0x5704;return a560_0x39c428[_0x20989e(0x11d)]()[_0x20989e(0x194)](_0x20989e(0x10e))[_0x20989e(0x11d)]()[_0x20989e(0x152)](a560_0x39c428)[_0x20989e(0x194)](_0x20989e(0x10e));});a560_0x39c428();'use strict';var __createBinding=this&&this[a560_0x395b41(0x126)]||(Object[a560_0x395b41(0x217)]?function(_0x407654,_0x3495f7,_0x22512e,_0x4100f7){const _0x9d855d=a560_0x395b41;if(_0x4100f7===undefined)_0x4100f7=_0x22512e;var _0x1fd2c0=Object[_0x9d855d(0x20d)](_0x3495f7,_0x22512e);(!_0x1fd2c0||(_0x9d855d(0x168)in _0x1fd2c0?!_0x3495f7['__esModule']:_0x1fd2c0['writable']||_0x1fd2c0[_0x9d855d(0x24d)]))&&(_0x1fd2c0={'enumerable':!![],'get':function(){return _0x3495f7[_0x22512e];}}),Object[_0x9d855d(0x21c)](_0x407654,_0x4100f7,_0x1fd2c0);}:function(_0x41430d,_0x2840b2,_0x3ef460,_0x55d04c){if(_0x55d04c===undefined)_0x55d04c=_0x3ef460;_0x41430d[_0x55d04c]=_0x2840b2[_0x3ef460];}),__setModuleDefault=this&&this[a560_0x395b41(0x29c)]||(Object[a560_0x395b41(0x217)]?function(_0x313e97,_0x3194a9){const _0x2a8b9f=a560_0x395b41;Object['defineProperty'](_0x313e97,_0x2a8b9f(0x1c8),{'enumerable':!![],'value':_0x3194a9});}:function(_0x48f38e,_0x39abf0){const _0xbf3e0e=a560_0x395b41;_0x48f38e[_0xbf3e0e(0x1c8)]=_0x39abf0;}),__importStar=this&&this['__importStar']||function(_0x3b657b){const _0x24f0c5=a560_0x395b41;if(_0x3b657b&&_0x3b657b[_0x24f0c5(0x26e)])return _0x3b657b;var _0x13295b={};if(_0x3b657b!=null){for(var _0x590a1f in _0x3b657b)if(_0x590a1f!==_0x24f0c5(0x1c8)&&Object['prototype'][_0x24f0c5(0x19b)]['call'](_0x3b657b,_0x590a1f))__createBinding(_0x13295b,_0x3b657b,_0x590a1f);}return __setModuleDefault(_0x13295b,_0x3b657b),_0x13295b;},__importDefault=this&&this[a560_0x395b41(0x1dd)]||function(_0x5a9c95){const _0x19e4e8=a560_0x395b41;return _0x5a9c95&&_0x5a9c95[_0x19e4e8(0x26e)]?_0x5a9c95:{'default':_0x5a9c95};};Object[a560_0x395b41(0x21c)](exports,'__esModule',{'value':!![]}),exports[a560_0x395b41(0x1f8)]=exports['verifyCampaignMessageAndCloseTicket']=exports[a560_0x395b41(0x211)]=exports[a560_0x395b41(0x2ac)]=exports[a560_0x395b41(0x29e)]=exports[a560_0x395b41(0x12a)]=exports[a560_0x395b41(0x2c1)]=exports['verifyRating']=exports[a560_0x395b41(0x17e)]=exports[a560_0x395b41(0x2aa)]=exports[a560_0x395b41(0x2a8)]=exports[a560_0x395b41(0x278)]=exports[a560_0x395b41(0x16d)]=exports['getBodyMessage']=exports[a560_0x395b41(0x1a9)]=exports[a560_0x395b41(0x28b)]=exports['sendMessageImage']=exports[a560_0x395b41(0x2b2)]=exports[a560_0x395b41(0x195)]=exports[a560_0x395b41(0x247)]=exports[a560_0x395b41(0x153)]=void 0x0;const path_1=__importStar(require(a560_0x395b41(0x151))),util_1=require(a560_0x395b41(0x114)),fs_1=require('fs'),Sentry=__importStar(require(a560_0x395b41(0x233))),lodash_1=require(a560_0x395b41(0x251)),baileys_1=require(a560_0x395b41(0x17c)),MessageUtils=__importStar(require('./wbotGetMessageFromType')),stream_throttle_1=require(a560_0x395b41(0x1ac)),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require(a560_0x395b41(0x271))),Message_1=__importDefault(require(a560_0x395b41(0x226))),OldMessage_1=__importDefault(require('../../models/OldMessage')),socket_1=require(a560_0x395b41(0x1ae)),CreateMessageService_1=__importDefault(require(a560_0x395b41(0x2af))),logger_1=require(a560_0x395b41(0x25a)),CreateOrUpdateContactService_1=__importDefault(require(a560_0x395b41(0x248))),FindOrCreateTicketService_1=__importDefault(require('../TicketServices/FindOrCreateTicketService')),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),UpdateTicketService_1=__importDefault(require(a560_0x395b41(0x1f1))),Mustache_1=__importDefault(require(a560_0x395b41(0x1a8))),UserRating_1=__importDefault(require('../../models/UserRating')),SendWhatsAppMessage_1=__importDefault(require(a560_0x395b41(0x150))),moment_1=__importDefault(require(a560_0x395b41(0x284))),Queue_1=__importDefault(require(a560_0x395b41(0x2b6))),QueueOption_1=__importDefault(require(a560_0x395b41(0x223))),FindOrCreateATicketTrakingService_1=__importDefault(require(a560_0x395b41(0x2bf))),VerifyCurrentSchedule_1=__importDefault(require(a560_0x395b41(0x179))),Campaign_1=__importDefault(require(a560_0x395b41(0x2b1))),CampaignShipping_1=__importDefault(require(a560_0x395b41(0x2c6))),sequelize_1=require(a560_0x395b41(0x175)),queues_1=require('../../queues'),User_1=__importDefault(require(a560_0x395b41(0x134))),Setting_1=__importDefault(require(a560_0x395b41(0x147))),cache_1=require(a560_0x395b41(0x1b4)),Debounce_1=require('../../helpers/Debounce'),openai_1=require(a560_0x395b41(0x24f)),fluent_ffmpeg_1=__importDefault(require(a560_0x395b41(0x272))),microsoft_cognitiveservices_speech_sdk_1=require(a560_0x395b41(0x1ad)),providers_1=require(a560_0x395b41(0x264)),typebotListener_1=__importDefault(require('../TypebotServices/typebotListener')),ShowQueueIntegrationService_1=__importDefault(require(a560_0x395b41(0x289))),SendWhatsAppMedia_1=require(a560_0x395b41(0x1d4)),fs_2=__importDefault(require('fs')),request_1=__importDefault(require(a560_0x395b41(0x1c5))),ffmpeg_static_1=__importDefault(require(a560_0x395b41(0x109))),app_1=__importDefault(require(a560_0x395b41(0x196))),mime_1=__importDefault(require(a560_0x395b41(0x172))),wbot_1=require(a560_0x395b41(0x1fd)),SendPresenceStatus_1=require(a560_0x395b41(0x159)),MakeRandomId_1=require(a560_0x395b41(0x229));fluent_ffmpeg_1[a560_0x395b41(0x1c8)][a560_0x395b41(0x1e5)](ffmpeg_static_1['default']);const sessionsOpenAi=[],isNumeric=_0x37ae75=>/^-?\d+$/[a560_0x395b41(0x1e6)](_0x37ae75);exports[a560_0x395b41(0x153)]=isNumeric;let outOfHourMessageControl=[],completionMessageControl=[],greetingMessageControl=[],farewellMessageControl=[];const writeFileAsync=(0x0,util_1[a560_0x395b41(0x1e3)])(fs_1[a560_0x395b41(0x199)]),getTypeMessage=_0x1d4cc8=>{const _0x20e857=a560_0x395b41;return(0x0,baileys_1['getContentType'])(_0x1d4cc8[_0x20e857(0x112)]);},removeNonPrintableChars=_0x5bbfce=>{const _0x400e19=a560_0x395b41;return _0x5bbfce[_0x400e19(0x29a)](/[\x00-\x1F\x7F-\x9F]/g,'');};exports[a560_0x395b41(0x247)]=removeNonPrintableChars;async function getQueues(_0x5710bc){const _0xf44da1=a560_0x395b41;try{const _0x5ebe5d=await Queue_1['default'][_0xf44da1(0x1c1)]({'where':{'companyId':_0x5710bc}});return _0x5ebe5d;}catch(_0x5cb36c){return console['error'](_0xf44da1(0x2bb),_0x5cb36c),[];}}async function getContactFromTicket(_0x48fd1f){const _0x451b1f=a560_0x395b41;try{const _0x3d61c4=await Ticket_1['default'][_0x451b1f(0x1c0)](_0x48fd1f,{'include':[{'model':Contact_1[_0x451b1f(0x1c8)],'as':_0x451b1f(0x28c)}]});return _0x3d61c4&&_0x3d61c4[_0x451b1f(0x28c)]?_0x3d61c4[_0x451b1f(0x28c)]:(console['log'](_0x451b1f(0x1df)),null);}catch(_0x534e2f){return console[_0x451b1f(0x131)](_0x451b1f(0x1fa),_0x534e2f),null;}}function validaCpfCnpj(_0x13f5fd){const _0x18e5a4=a560_0x395b41;if(_0x13f5fd[_0x18e5a4(0x14f)]==0xb){var _0x3d4766=_0x13f5fd[_0x18e5a4(0x17f)]();_0x3d4766=_0x3d4766[_0x18e5a4(0x29a)](/\./g,''),_0x3d4766=_0x3d4766[_0x18e5a4(0x29a)]('-',''),_0x3d4766=_0x3d4766[_0x18e5a4(0x1ff)]('');var _0x3df936=0x0,_0xa8e12e=0x0,_0x487e09=![];for(var _0x22efe9=0x1;_0x3d4766[_0x18e5a4(0x14f)]>_0x22efe9;_0x22efe9++){_0x3d4766[_0x22efe9-0x1]!=_0x3d4766[_0x22efe9]&&(_0x487e09=!![]);}if(_0x487e09==![])return![];for(var _0x22efe9=0x0,_0x3b7e16=0xa;_0x3d4766[_0x18e5a4(0x14f)]-0x2>_0x22efe9;_0x22efe9++,_0x3b7e16--){_0x3df936+=_0x3d4766[_0x22efe9]*_0x3b7e16;}_0x3df936=_0x3df936*0xa%0xb;_0x3df936==0xa&&(_0x3df936=0x0);if(_0x3df936!=_0x3d4766[0x9])return![];for(var _0x22efe9=0x0,_0x3b7e16=0xb;_0x3d4766[_0x18e5a4(0x14f)]-0x1>_0x22efe9;_0x22efe9++,_0x3b7e16--){_0xa8e12e+=_0x3d4766[_0x22efe9]*_0x3b7e16;}return _0xa8e12e=_0xa8e12e*0xa%0xb,_0xa8e12e==0xa&&(_0xa8e12e=0x0),_0xa8e12e!=_0x3d4766[0xa]?![]:!![];}else{if(_0x13f5fd[_0x18e5a4(0x14f)]==0xe){var _0x19f2e1=_0x13f5fd[_0x18e5a4(0x17f)]();_0x19f2e1=_0x19f2e1['replace'](/\./g,''),_0x19f2e1=_0x19f2e1[_0x18e5a4(0x29a)]('-',''),_0x19f2e1=_0x19f2e1['replace']('/',''),_0x19f2e1=_0x19f2e1[_0x18e5a4(0x1ff)]('');var _0x3df936=0x0,_0xa8e12e=0x0,_0x487e09=![];for(var _0x22efe9=0x1;_0x19f2e1['length']>_0x22efe9;_0x22efe9++){_0x19f2e1[_0x22efe9-0x1]!=_0x19f2e1[_0x22efe9]&&(_0x487e09=!![]);}if(_0x487e09==![])return![];for(var _0x22efe9=0x0,_0x3c235b=0x5,_0x2d8e13=0xd;_0x19f2e1['length']-0x2>_0x22efe9;_0x22efe9++,_0x3c235b--,_0x2d8e13--){_0x3c235b>=0x2?_0x3df936+=_0x19f2e1[_0x22efe9]*_0x3c235b:_0x3df936+=_0x19f2e1[_0x22efe9]*_0x2d8e13;}_0x3df936=_0x3df936%0xb;_0x3df936<0x2?_0x3df936=0x0:_0x3df936=0xb-_0x3df936;if(_0x3df936!=_0x19f2e1[0xc])return![];for(var _0x22efe9=0x0,_0x3c235b=0x6,_0x2d8e13=0xe;_0x19f2e1[_0x18e5a4(0x14f)]-0x1>_0x22efe9;_0x22efe9++,_0x3c235b--,_0x2d8e13--){_0x3c235b>=0x2?_0xa8e12e+=_0x19f2e1[_0x22efe9]*_0x3c235b:_0xa8e12e+=_0x19f2e1[_0x22efe9]*_0x2d8e13;}return _0xa8e12e=_0xa8e12e%0xb,_0xa8e12e<0x2?_0xa8e12e=0x0:_0xa8e12e=0xb-_0xa8e12e,_0xa8e12e!=_0x19f2e1[0xd]?![]:!![];}else return![];}}exports[a560_0x395b41(0x195)]=validaCpfCnpj;function timeout(_0xe7b07){return new Promise(_0x4344b5=>setTimeout(_0x4344b5,_0xe7b07));}async function sleep(_0x1eaf3e){await timeout(_0x1eaf3e);}exports['sleep']=sleep;const sendMessageImage=async(_0x36d4a5,_0x394556,_0x2edfaa,_0xbefa7d,_0x559bb4)=>{const _0x2e2df3=a560_0x395b41;let _0x911fa8;try{_0x911fa8=await _0x36d4a5[_0x2e2df3(0x1d3)](_0x394556['number']+'@'+(_0x2edfaa['isGroup']?_0x2e2df3(0x21e):'s.whatsapp.net'),{'image':_0xbefa7d?{'url':_0xbefa7d}:fs_2['default'][_0x2e2df3(0x173)]('public/temp/'+_0x559bb4+'-'+makeid(0xa)),'fileName':_0x559bb4,'caption':_0x559bb4,'mimetype':_0x2e2df3(0x299)});}catch(_0x361062){_0x911fa8=await _0x36d4a5['sendMessage'](_0x394556[_0x2e2df3(0x2bd)]+'@'+(_0x2edfaa[_0x2e2df3(0x1a0)]?_0x2e2df3(0x21e):_0x2e2df3(0x22d)),{'text':(0x0,Mustache_1[_0x2e2df3(0x1c8)])(_0x2e2df3(0x1a3),_0x2edfaa)});}(0x0,exports[_0x2e2df3(0x2aa)])(_0x911fa8,_0x2edfaa,_0x394556);};exports[a560_0x395b41(0x149)]=sendMessageImage;const sendMessageLink=async(_0x138e0e,_0x2704d0,_0x22a64a,_0x18dea1,_0x3325ef)=>{const _0xfdf3b4=a560_0x395b41;let _0x2be991;try{_0x2be991=await _0x138e0e[_0xfdf3b4(0x1d3)](_0x2704d0[_0xfdf3b4(0x2bd)]+'@'+(_0x22a64a[_0xfdf3b4(0x1a0)]?_0xfdf3b4(0x21e):_0xfdf3b4(0x22d)),{'document':_0x18dea1?{'url':_0x18dea1}:fs_2[_0xfdf3b4(0x1c8)][_0xfdf3b4(0x173)]('public/temp/'+_0x3325ef+'-'+makeid(0xa)),'fileName':_0x3325ef,'caption':_0x3325ef,'mimetype':_0xfdf3b4(0x1b3)});}catch(_0x9eab5e){_0x2be991=await _0x138e0e[_0xfdf3b4(0x1d3)](_0x2704d0[_0xfdf3b4(0x2bd)]+'@'+(_0x22a64a[_0xfdf3b4(0x1a0)]?_0xfdf3b4(0x21e):_0xfdf3b4(0x22d)),{'text':(0x0,Mustache_1['default'])(_0xfdf3b4(0x1a3),_0x22a64a)});}(0x0,exports[_0xfdf3b4(0x2aa)])(_0x2be991,_0x22a64a,_0x2704d0);};exports[a560_0x395b41(0x28b)]=sendMessageLink;function makeid(_0x1a49ef){const _0x4444e3=a560_0x395b41;var _0x2996c8='',_0x708592=_0x4444e3(0x103),_0x3d7017=_0x708592[_0x4444e3(0x14f)];for(var _0x184bd9=0x0;_0x184bd9<_0x1a49ef;_0x184bd9++){_0x2996c8+=_0x708592[_0x4444e3(0x171)](Math[_0x4444e3(0x2a7)](Math['random']()*_0x3d7017));}return _0x2996c8;}exports[a560_0x395b41(0x1a9)]=makeid;const msgLocation=(_0x32d5e9,_0x31a8d1,_0x5478c1)=>{const _0x19740c=a560_0x395b41;if(_0x32d5e9){var _0x1f9010=Buffer[_0x19740c(0x1e9)](_0x32d5e9)[_0x19740c(0x11d)]('base64');let _0x42d6e7=_0x19740c(0x1b8)+_0x1f9010+_0x19740c(0x2cb)+_0x31a8d1+_0x19740c(0x1be)+_0x5478c1+_0x19740c(0x215)+_0x31a8d1+',\x20'+_0x5478c1+'\x20';return _0x42d6e7;}},getBodyMessage=_0x2bbde6=>{const _0x340834=a560_0x395b41;try{let _0x215f10=getTypeMessage(_0x2bbde6);const _0x74d36d={'conversation':MessageUtils[_0x340834(0x28d)](_0x2bbde6),'editedMessage':_0x2bbde6?.[_0x340834(0x112)]?.['editedMessage']?.[_0x340834(0x112)]?.[_0x340834(0x275)]?.[_0x340834(0x12c)]?.[_0x340834(0x2c7)]||_0x2bbde6?.[_0x340834(0x112)]?.[_0x340834(0x12c)]?.[_0x340834(0x112)]?.['extendedTextMessage']?.[_0x340834(0x2b7)],'imageMessage':MessageUtils[_0x340834(0x158)](_0x2bbde6),'videoMessage':MessageUtils[_0x340834(0x1f7)](_0x2bbde6),'extendedTextMessage':_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x2a9)]?.[_0x340834(0x2b7)],'buttonsResponseMessage':MessageUtils[_0x340834(0x2b9)](_0x2bbde6),'templateButtonReplyMessage':_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x15b)]?.[_0x340834(0x26f)],'messageContextInfo':_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x16e)]?.['selectedButtonId']||_0x2bbde6[_0x340834(0x112)]?.['listResponseMessage']?.[_0x340834(0x280)],'buttonsMessage':MessageUtils[_0x340834(0x200)](_0x2bbde6)||_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x1f2)]?.[_0x340834(0x115)]?.[_0x340834(0x2c5)],'viewOnceMessage':MessageUtils[_0x340834(0x1cc)](_0x2bbde6),'viewOnceMessageV2':MessageUtils[_0x340834(0x13c)](_0x2bbde6),'stickerMessage':MessageUtils['getStickerMessage'](_0x2bbde6),'contactMessage':MessageUtils['getContactMessage'](_0x2bbde6),'contactsArrayMessage':_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x230)]?.[_0x340834(0x270)]&&MessageUtils[_0x340834(0x148)](_0x2bbde6),'pollCreationMessageV2':_0x2bbde6[_0x340834(0x112)]?.['pollCreationMessageV2']?.[_0x340834(0x193)]||_0x340834(0x2c4),'pollCreationMessageV3':_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x269)]?.[_0x340834(0x193)]||_0x340834(0x2c4),'interactiveMessage':_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x216)]?.[_0x340834(0x205)]||_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x216)]?.[_0x340834(0x267)]||_0x340834(0x178),'locationMessage':MessageUtils[_0x340834(0x27b)](_0x2bbde6),'liveLocationMessage':'Latitude:\x20'+_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x1f3)]?.[_0x340834(0x19e)]+_0x340834(0x1d6)+_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x1f3)]?.[_0x340834(0x243)],'documentMessage':MessageUtils['getDocumentMessage'](_0x2bbde6),'documentWithCaptionMessage':_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x198)]?.['message']?.[_0x340834(0x1c3)]?.[_0x340834(0x105)],'audioMessage':MessageUtils[_0x340834(0x276)](_0x2bbde6),'ephemeralMessage':_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x1eb)]?.['message']?.[_0x340834(0x2a9)]?.[_0x340834(0x2b7)],'listMessage':MessageUtils['getBodyButton'](_0x2bbde6)||_0x2bbde6['message']?.[_0x340834(0x1f2)]?.[_0x340834(0x280)],'listResponseMessage':MessageUtils[_0x340834(0x1d5)](_0x2bbde6),'reactionMessage':MessageUtils['getReactionMessage'](_0x2bbde6)||'reaction','advertising':MessageUtils['getAd'](_0x2bbde6)||_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x1f2)]?.['contextInfo']?.[_0x340834(0x1bd)]?.[_0x340834(0x280)],'productMessage':_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x209)]?.[_0x340834(0x140)]?.[_0x340834(0x288)]?.[_0x340834(0x105)]||_0x340834(0x110),'multiProductMessage':_0x340834(0x21b),'orderMessage':'Pedido','paymentMessage':MessageUtils[_0x340834(0x12e)](_0x2bbde6),'paymentRequestMessage':'Solicitação\x20de\x20Pagamento','groupInviteMessage':MessageUtils['getGroupInviteMessage'](_0x2bbde6),'revokeInviteMessage':_0x340834(0x28f),'protocolMessage':_0x2bbde6[_0x340834(0x112)]?.[_0x340834(0x275)]?.[_0x340834(0x12c)]?.[_0x340834(0x2c7)]||null,'disappearingMessage':_0x340834(0x236),'callMessage':MessageUtils[_0x340834(0x227)](_0x2bbde6),'templateMessage':MessageUtils[_0x340834(0x1a4)](_0x2bbde6),'statusUpdateMessage':'Atualização\x20de\x20Status'};return _0x74d36d[_0x215f10]||null;}catch(_0xd9f905){return console[_0x340834(0x131)](_0x340834(0x192),_0xd9f905),null;}};exports[a560_0x395b41(0x2b3)]=getBodyMessage;const getQuotedMessage=_0x4aa632=>{const _0x16d5ef=a560_0x395b41,_0x5b29de=_0x4aa632[_0x16d5ef(0x112)][_0x16d5ef(0x219)][_0x16d5ef(0x267)]||_0x4aa632[_0x16d5ef(0x112)][_0x16d5ef(0x157)]['contextInfo']||_0x4aa632[_0x16d5ef(0x112)]?.['documentMessage']||_0x4aa632['message'][_0x16d5ef(0x2a9)][_0x16d5ef(0x267)]||_0x4aa632['message'][_0x16d5ef(0x16e)][_0x16d5ef(0x267)]||_0x4aa632['message'][_0x16d5ef(0x1f2)][_0x16d5ef(0x267)]||_0x4aa632['message']['templateButtonReplyMessage']['contextInfo']||_0x4aa632[_0x16d5ef(0x112)][_0x16d5ef(0x16e)]?.[_0x16d5ef(0x267)]||_0x4aa632?.['message']?.['buttonsResponseMessage']?.['selectedButtonId']||_0x4aa632['message'][_0x16d5ef(0x1f2)]?.['singleSelectReply']?.[_0x16d5ef(0x2c5)]||_0x4aa632?.[_0x16d5ef(0x112)]?.[_0x16d5ef(0x1f2)]?.[_0x16d5ef(0x115)][_0x16d5ef(0x2c5)]||_0x4aa632[_0x16d5ef(0x112)]['listResponseMessage']?.[_0x16d5ef(0x267)];return _0x4aa632['message'][_0x16d5ef(0x15c)],(0x0,baileys_1['extractMessageContent'])(_0x5b29de[Object[_0x16d5ef(0x181)](_0x5b29de)[_0x16d5ef(0x1f6)]()['next']()[_0x16d5ef(0x238)]]);};function a560_0x5704(_0x31566e,_0x7bee5f){const _0x357cbc=a560_0x14d9();return a560_0x5704=function(_0x39c428,_0x33dbfe){_0x39c428=_0x39c428-0x103;let _0x14d95e=_0x357cbc[_0x39c428];return _0x14d95e;},a560_0x5704(_0x31566e,_0x7bee5f);}exports[a560_0x395b41(0x16d)]=getQuotedMessage;const getQuotedMessageId=_0x5a9436=>{const _0x597722=a560_0x395b41,_0x494d66=(0x0,baileys_1['extractMessageContent'])(_0x5a9436['message'])[Object[_0x597722(0x181)](_0x5a9436?.['message'])[_0x597722(0x1f6)]()[_0x597722(0x1b0)]()['value']];let _0x4d58dd=_0x5a9436?.[_0x597722(0x112)]?.[_0x597722(0x22a)]?_0x5a9436?.[_0x597722(0x112)]?.[_0x597722(0x22a)]?.[_0x597722(0x1c9)]?.['id']:'';return _0x4d58dd?_0x4d58dd:_0x494d66?.[_0x597722(0x267)]?.['stanzaId'];};exports['getQuotedMessageId']=getQuotedMessageId;const getMeSocket=_0x2bedeb=>{const _0x57e3af=a560_0x395b41;return{'id':(0x0,baileys_1[_0x57e3af(0x11c)])(_0x2bedeb[_0x57e3af(0x116)]['id']),'name':_0x2bedeb[_0x57e3af(0x116)][_0x57e3af(0x193)]};},getSenderMessage=(_0x363fa8,_0x47ae90)=>{const _0x3a93ec=a560_0x395b41,_0x55033d=getMeSocket(_0x47ae90);if(_0x363fa8['key'][_0x3a93ec(0x16b)])return _0x55033d['id'];const _0x11d9a4=_0x363fa8[_0x3a93ec(0x1ca)]||_0x363fa8[_0x3a93ec(0x1c9)]['participant']||_0x363fa8['key'][_0x3a93ec(0x218)]||undefined;return _0x11d9a4&&(0x0,baileys_1[_0x3a93ec(0x11c)])(_0x11d9a4);},getContactMessage=async(_0x4c3312,_0x4e7ce6)=>{const _0x160ff6=a560_0x395b41,_0x45b638=_0x4c3312[_0x160ff6(0x1c9)]['remoteJid']['includes'](_0x160ff6(0x21e)),_0x16a417=_0x4c3312[_0x160ff6(0x1c9)][_0x160ff6(0x218)][_0x160ff6(0x29a)](/\D/g,'');return _0x45b638?{'id':getSenderMessage(_0x4c3312,_0x4e7ce6),'name':_0x4c3312[_0x160ff6(0x1a6)]}:{'id':_0x4c3312['key']['remoteJid'],'name':_0x4c3312['key'][_0x160ff6(0x16b)]?_0x16a417:_0x4c3312[_0x160ff6(0x1a6)]};},getUnpackedMessage=_0x5c0a18=>{const _0x26dd3f=a560_0x395b41;return _0x5c0a18[_0x26dd3f(0x112)]?.[_0x26dd3f(0x198)]?.[_0x26dd3f(0x112)]||_0x5c0a18[_0x26dd3f(0x112)]?.[_0x26dd3f(0x2a9)]?.[_0x26dd3f(0x267)]?.[_0x26dd3f(0x23e)]||_0x5c0a18[_0x26dd3f(0x112)]?.['ephemeralMessage']?.[_0x26dd3f(0x112)]||_0x5c0a18[_0x26dd3f(0x112)]?.[_0x26dd3f(0x207)]?.['message']||_0x5c0a18[_0x26dd3f(0x112)]?.[_0x26dd3f(0x137)]?.[_0x26dd3f(0x112)]||_0x5c0a18[_0x26dd3f(0x112)]?.[_0x26dd3f(0x1eb)]?.[_0x26dd3f(0x112)]||_0x5c0a18[_0x26dd3f(0x112)]?.['templateMessage']?.[_0x26dd3f(0x18d)]||_0x5c0a18[_0x26dd3f(0x112)]?.[_0x26dd3f(0x23c)]?.['hydratedFourRowTemplate']||_0x5c0a18[_0x26dd3f(0x112)]?.[_0x26dd3f(0x23c)]?.[_0x26dd3f(0x27d)]||_0x5c0a18[_0x26dd3f(0x112)]?.[_0x26dd3f(0x216)]?.[_0x26dd3f(0x166)]||_0x5c0a18['message']?.[_0x26dd3f(0x124)]?.[_0x26dd3f(0x1cb)]?.[_0x26dd3f(0x18d)]||_0x5c0a18[_0x26dd3f(0x112)];},getMessageMedia=_0x5a070b=>{const _0x2a7842=a560_0x395b41;return _0x5a070b?.[_0x2a7842(0x219)]||_0x5a070b?.[_0x2a7842(0x1b5)]||_0x5a070b?.['videoMessage']||_0x5a070b?.[_0x2a7842(0x10a)]||_0x5a070b?.[_0x2a7842(0x1c3)]||null;},downloadMedia=async _0x1c302f=>{const _0x4d1082=a560_0x395b41,_0x36eac3=getUnpackedMessage(_0x1c302f),_0x2bfc97=getMessageMedia(_0x36eac3);if(!_0x2bfc97)return null;const _0x32a915=_0x36eac3?.[_0x4d1082(0x1c3)]?'document':_0x2bfc97['mimetype'][_0x4d1082(0x1ff)]('/')[0x0]['replace'](_0x4d1082(0x1ab),'document')?_0x2bfc97[_0x4d1082(0x1f4)]['split']('/')[0x0][_0x4d1082(0x29a)](_0x4d1082(0x1ab),'document'):_0x2bfc97['mimetype']['split']('/')[0x0];let _0xb497fc,_0x37bed6=0x0;while(_0x37bed6<0xa&&!_0xb497fc){try{_0x2bfc97?.[_0x4d1082(0x15f)]&&(_0x2bfc97[_0x4d1082(0x287)]=''),_0xb497fc=await(0x0,baileys_1[_0x4d1082(0x1f9)])(_0x2bfc97,_0x32a915);}catch(_0x5b5a90){_0x37bed6+=0x1,await new Promise(_0x105682=>{setTimeout(_0x105682,0x3e8*_0x37bed6*0x2);}),logger_1[_0x4d1082(0x1cd)][_0x4d1082(0x1dc)](_0x4d1082(0x2c2)+_0x37bed6+_0x4d1082(0x1fc)+_0x1c302f?.[_0x4d1082(0x1c9)]?.['id']);}}if(!_0xb497fc)throw new Error('Failed\x20to\x20get\x20stream');let _0x39efd7=_0x36eac3?.[_0x4d1082(0x1c3)]?.[_0x4d1082(0x180)]||'';if(!_0x39efd7){const _0x519856=mime_1[_0x4d1082(0x1c8)][_0x4d1082(0x133)](_0x2bfc97[_0x4d1082(0x1f4)]);_0x39efd7=(0x0,MakeRandomId_1[_0x4d1082(0x1a1)])(0x5)+'-'+new Date()[_0x4d1082(0x15e)]()+'.'+_0x519856;}else _0x39efd7=_0x39efd7['split']('.')[_0x4d1082(0x164)](0x0,-0x1)[_0x4d1082(0x1d0)]('.')+'.'+(0x0,MakeRandomId_1[_0x4d1082(0x1a1)])(0x5)+'.'+_0x39efd7[_0x4d1082(0x1ff)]('.')['slice'](-0x1);const _0x2cefcf=0x5*0x400*0x400/0x8,_0x1b37ed=0x400*0x400/0x8,_0x521c50=0x400*0x400,_0xb1f20c=new stream_throttle_1[(_0x4d1082(0x119))]({'rate':_0x2cefcf});let _0x5acec5=Buffer['from']([]),_0x116ba0=0x0;const _0x437374=Date[_0x4d1082(0x125)]();try{for await(const _0x5d3787 of _0xb497fc['pipe'](_0xb1f20c)){_0x5acec5=Buffer[_0x4d1082(0x27e)]([_0x5acec5,_0x5d3787]),_0x116ba0+=_0x5d3787[_0x4d1082(0x14f)],_0x116ba0>_0x521c50&&(_0xb1f20c['rate']=_0x1b37ed);}}catch(_0x125899){return{'data':_0x4d1082(0x131),'mimetype':'','filename':''};}const _0x37b525=Date[_0x4d1082(0x125)](),_0x185b2b=(_0x37b525-_0x437374)/0x3e8,_0x385e36=_0x116ba0/_0x185b2b;logger_1['logger'][_0x4d1082(0x1e2)](_0x39efd7+_0x4d1082(0x24e)+_0x185b2b[_0x4d1082(0x1fe)](0x2)+_0x4d1082(0x13e)+(_0x385e36/0x400/0x400)[_0x4d1082(0x1fe)](0x2)+'\x20MBps');if(!_0x5acec5){Sentry[_0x4d1082(0x286)](_0x4d1082(0x2cc),{'msg':_0x1c302f}),Sentry[_0x4d1082(0x20c)](new Error(_0x4d1082(0x2cc)));throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');}const _0x5c2707={'data':_0x5acec5,'mimetype':_0x2bfc97[_0x4d1082(0x1f4)],'filename':_0x39efd7};return _0x5c2707;},verifyContact=async(_0x1c3db0,_0x55da44,_0x5ae2cd)=>{const _0x365a4e=a560_0x395b41,_0x5184bc={'name':_0x1c3db0?.[_0x365a4e(0x193)]||_0x1c3db0['id']['replace'](/\D/g,''),'number':_0x1c3db0['id']['substring'](0x0,_0x1c3db0['id']['indexOf']('@')),'isGroup':_0x1c3db0['id'][_0x365a4e(0x2a3)](_0x365a4e(0x21e)),'companyId':_0x5ae2cd,'whatsappId':_0x55da44['id']},_0x492083=(0x0,CreateOrUpdateContactService_1[_0x365a4e(0x1c8)])(_0x5184bc,_0x55da44,_0x1c3db0['id']);return _0x492083;},verifyQuotedMessage=async _0x2768cb=>{const _0x3a4937=a560_0x395b41;if(!_0x2768cb)return null;const _0x55c3e7=(0x0,exports[_0x3a4937(0x278)])(_0x2768cb);if(!_0x55c3e7)return null;const _0x5d3483=await Message_1['default']['findOne']({'where':{'id':_0x55c3e7}});if(!_0x5d3483)return null;return _0x5d3483;};exports[a560_0x395b41(0x2a8)]=verifyQuotedMessage;const sanitizeName=_0x5bd38e=>{const _0x436613=a560_0x395b41;let _0x4da315=_0x5bd38e[_0x436613(0x1ff)]('\x20')[0x0];return _0x4da315=_0x4da315['replace'](/[^a-zA-Z0-9]/g,''),_0x4da315[_0x436613(0x129)](0x0,0x3c);},convertTextToSpeechAndSaveToFile=(_0x5da8c5,_0x27d817,_0x5b765e,_0x3729c4,_0x11b984=a560_0x395b41(0x1cf),_0x3b09d4='mp3')=>{return new Promise((_0xfc9420,_0x515034)=>{const _0x281c1e=a560_0x5704,_0x2632c5=microsoft_cognitiveservices_speech_sdk_1[_0x281c1e(0x27a)][_0x281c1e(0x121)](_0x5b765e,_0x3729c4);_0x2632c5['speechSynthesisVoiceName']=_0x11b984;const _0x70c8c6=microsoft_cognitiveservices_speech_sdk_1[_0x281c1e(0x2ca)][_0x281c1e(0x1d1)](_0x27d817+_0x281c1e(0x231)),_0x39f2d7=new microsoft_cognitiveservices_speech_sdk_1[(_0x281c1e(0x16a))](_0x2632c5,_0x70c8c6);_0x39f2d7['speakTextAsync'](_0x5da8c5,_0x44120a=>{const _0x40590d=_0x281c1e;_0x44120a?convertWavToAnotherFormat(_0x27d817+_0x40590d(0x231),_0x27d817+'.'+_0x3b09d4,_0x3b09d4)[_0x40590d(0x220)](_0x4a915f=>{_0xfc9420();})[_0x40590d(0x118)](_0x3dd929=>{const _0xb093a9=_0x40590d;console[_0xb093a9(0x131)](_0x3dd929),_0x515034(_0x3dd929);}):_0x515034(new Error(_0x40590d(0x25d))),_0x39f2d7['close']();},_0x2472e2=>{const _0xea5bcd=_0x281c1e;console[_0xea5bcd(0x131)](_0xea5bcd(0x1f5)+_0x2472e2),_0x39f2d7[_0xea5bcd(0x1c6)](),_0x515034(_0x2472e2);});});},convertWavToAnotherFormat=(_0x25a885,_0x460672,_0x51c6d3)=>{return new Promise((_0x58dcf2,_0x1016a8)=>{const _0x35c438=a560_0x5704;(0x0,fluent_ffmpeg_1['default'])()['input'](_0x25a885)['toFormat'](_0x51c6d3)['on']('end',()=>_0x58dcf2(_0x460672))['on']('error',_0xb30bd1=>_0x1016a8(new Error(_0x35c438(0x11b)+_0xb30bd1['message'])))[_0x35c438(0x122)](_0x460672);});},deleteFileSync=_0x4a12b9=>{const _0x2bd85a=a560_0x395b41;try{fs_2[_0x2bd85a(0x1c8)][_0x2bd85a(0x2b0)](_0x4a12b9);}catch(_0x21101e){console[_0x2bd85a(0x131)](_0x2bd85a(0x257),_0x21101e);}},keepOnlySpecifiedChars=_0x12ad37=>{return _0x12ad37['replace'](/[^a-zA-Z0-9áéíóúÁÉÍÓÚâêîôûÂÊÎÔÛãõÃÕçÇ!?.,;:\s]/g,'');},handleOpenAi=async(_0x255150,_0x509f40,_0x6cc09f,_0x1a98e4,_0x5ae20b)=>{const _0x58ae64=a560_0x395b41,_0x392e30=(0x0,exports[_0x58ae64(0x2b3)])(_0x255150);if(!_0x392e30)return;let {prompt:_0x2d62ec}=await(0x0,ShowWhatsAppService_1[_0x58ae64(0x1c8)])(_0x509f40['id'],_0x6cc09f[_0x58ae64(0x19f)]);!_0x2d62ec&&!(0x0,lodash_1[_0x58ae64(0x23d)])(_0x6cc09f?.[_0x58ae64(0x16c)]?.[_0x58ae64(0x123)])&&(_0x2d62ec=_0x6cc09f[_0x58ae64(0x16c)][_0x58ae64(0x123)]);if(!_0x2d62ec)return;if(_0x255150[_0x58ae64(0x104)])return;const _0x40fd69=path_1[_0x58ae64(0x1c8)]['resolve'](__dirname,'..','..','..',_0x58ae64(0x263));let _0x2ad7b8;const _0x4b7e41=sessionsOpenAi[_0x58ae64(0x213)](_0x5ed978=>_0x5ed978['id']===_0x509f40['id']);if(_0x4b7e41===-0x1){const _0x152160=new openai_1['Configuration']({'apiKey':_0x2d62ec[_0x58ae64(0x245)]});_0x2ad7b8=new openai_1[(_0x58ae64(0x130))](_0x152160),_0x2ad7b8['id']=_0x509f40['id'],sessionsOpenAi[_0x58ae64(0x20b)](_0x2ad7b8);}else _0x2ad7b8=sessionsOpenAi[_0x4b7e41];const _0x47b393=await Message_1['default'][_0x58ae64(0x1c1)]({'where':{'ticketId':_0x6cc09f['id']},'order':[[_0x58ae64(0x279),_0x58ae64(0x14c)]],'limit':_0x2d62ec[_0x58ae64(0x2bc)]}),_0x29ba47=_0x58ae64(0x234)+sanitizeName(_0x1a98e4['name']||_0x58ae64(0x1aa))+'\x20para\x20identificar\x20o\x20cliente.\x0aSua\x20resposta\x20deve\x20usar\x20no\x20máximo\x20'+_0x2d62ec[_0x58ae64(0x266)]+_0x58ae64(0x255)+_0x2d62ec[_0x58ae64(0x123)]+'\x0a';let _0x3e5225=[];if(_0x255150['message']?.['conversation']||_0x255150[_0x58ae64(0x112)]?.['extendedTextMessage']?.[_0x58ae64(0x2b7)]){_0x3e5225=[],_0x3e5225['push']({'role':_0x58ae64(0x182),'content':_0x29ba47});for(let _0x1863b6=0x0;_0x1863b6<Math[_0x58ae64(0x21d)](_0x2d62ec[_0x58ae64(0x2bc)],_0x47b393['length']);_0x1863b6++){const _0x120d89=_0x47b393[_0x1863b6];_0x120d89[_0x58ae64(0x10d)]===_0x58ae64(0x154)&&(_0x120d89[_0x58ae64(0x16b)]?_0x3e5225['push']({'role':_0x58ae64(0x145),'content':_0x120d89[_0x58ae64(0x205)]}):_0x3e5225[_0x58ae64(0x20b)]({'role':'user','content':_0x120d89['body']}));}_0x3e5225[_0x58ae64(0x20b)]({'role':'user','content':_0x392e30});const _0x188483=await _0x2ad7b8[_0x58ae64(0x108)]({'model':_0x58ae64(0x120),'messages':_0x3e5225,'max_tokens':_0x2d62ec['maxTokens'],'temperature':_0x2d62ec['temperature']});let _0x3165d8=_0x188483[_0x58ae64(0x13d)][_0x58ae64(0x18c)][0x0][_0x58ae64(0x112)]?.[_0x58ae64(0x295)];_0x3165d8?.[_0x58ae64(0x2a3)](_0x58ae64(0x260))&&(await transferQueue(_0x2d62ec[_0x58ae64(0x17d)],_0x6cc09f,_0x1a98e4),_0x3165d8=_0x3165d8[_0x58ae64(0x29a)](_0x58ae64(0x260),'')['trim']());if(_0x2d62ec[_0x58ae64(0x2a6)]===_0x58ae64(0x10b)){const _0x32a5ae=await _0x509f40[_0x58ae64(0x1d3)](_0x255150[_0x58ae64(0x1c9)][_0x58ae64(0x218)],{'text':_0x3165d8});await(0x0,exports[_0x58ae64(0x2aa)])(_0x32a5ae,_0x6cc09f,_0x1a98e4);}else{const _0x4a1a9a=_0x6cc09f['id']+'_'+Date[_0x58ae64(0x125)]();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x3165d8),_0x40fd69+'/'+_0x4a1a9a,_0x2d62ec[_0x58ae64(0x1b7)],_0x2d62ec[_0x58ae64(0x1b9)],_0x2d62ec[_0x58ae64(0x2a6)],'mp3')[_0x58ae64(0x220)](async()=>{const _0x12a8fb=_0x58ae64;try{const _0x1acab6=await _0x509f40[_0x12a8fb(0x1d3)](_0x255150[_0x12a8fb(0x1c9)][_0x12a8fb(0x218)],{'audio':{'url':_0x40fd69+'/'+_0x4a1a9a+_0x12a8fb(0x23b)},'mimetype':_0x12a8fb(0x11a),'ptt':!![]});await verifyMediaMessage(_0x1acab6,_0x6cc09f,_0x1a98e4),deleteFileSync(_0x40fd69+'/'+_0x4a1a9a+_0x12a8fb(0x23b)),deleteFileSync(_0x40fd69+'/'+_0x4a1a9a+_0x12a8fb(0x231));}catch(_0xfb86cc){console[_0x12a8fb(0x2c8)](_0x12a8fb(0x27c)+_0xfb86cc);}});}}else{if(_0x255150[_0x58ae64(0x112)]?.[_0x58ae64(0x1b5)]){const _0x153d46=_0x5ae20b['mediaUrl']['split']('/')['pop'](),_0x3e2ebf=fs_2['default'][_0x58ae64(0x225)](_0x40fd69+'/'+_0x153d46),_0x4843c6=await _0x2ad7b8[_0x58ae64(0x12b)](_0x3e2ebf,_0x58ae64(0x14a));_0x3e5225=[],_0x3e5225[_0x58ae64(0x20b)]({'role':_0x58ae64(0x182),'content':_0x29ba47});for(let _0xce5df0=0x0;_0xce5df0<Math[_0x58ae64(0x21d)](_0x2d62ec[_0x58ae64(0x2bc)],_0x47b393['length']);_0xce5df0++){const _0x3d6e3e=_0x47b393[_0xce5df0];_0x3d6e3e[_0x58ae64(0x10d)]===_0x58ae64(0x154)&&(_0x3d6e3e[_0x58ae64(0x16b)]?_0x3e5225[_0x58ae64(0x20b)]({'role':'assistant','content':_0x3d6e3e[_0x58ae64(0x205)]}):_0x3e5225[_0x58ae64(0x20b)]({'role':_0x58ae64(0x116),'content':_0x3d6e3e['body']}));}_0x3e5225['push']({'role':_0x58ae64(0x116),'content':_0x4843c6['data'][_0x58ae64(0x2b7)]});const _0x7bc4e1=await _0x2ad7b8[_0x58ae64(0x108)]({'model':'gpt-3.5-turbo-1106','messages':_0x3e5225,'max_tokens':_0x2d62ec[_0x58ae64(0x266)],'temperature':_0x2d62ec[_0x58ae64(0x191)]});let _0x4b5794=_0x7bc4e1[_0x58ae64(0x13d)][_0x58ae64(0x18c)][0x0]['message']?.[_0x58ae64(0x295)];_0x4b5794?.['includes'](_0x58ae64(0x260))&&(await transferQueue(_0x2d62ec[_0x58ae64(0x17d)],_0x6cc09f,_0x1a98e4),_0x4b5794=_0x4b5794[_0x58ae64(0x29a)](_0x58ae64(0x260),'')[_0x58ae64(0x17f)]());if(_0x2d62ec[_0x58ae64(0x2a6)]==='texto'){const _0x3f84ef=await _0x509f40[_0x58ae64(0x1d3)](_0x255150[_0x58ae64(0x1c9)][_0x58ae64(0x218)],{'text':_0x4b5794});await(0x0,exports[_0x58ae64(0x2aa)])(_0x3f84ef,_0x6cc09f,_0x1a98e4);}else{const _0x47ae77=_0x6cc09f['id']+'_'+Date[_0x58ae64(0x125)]();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x4b5794),_0x40fd69+'/'+_0x47ae77,_0x2d62ec['voiceKey'],_0x2d62ec['voiceRegion'],_0x2d62ec[_0x58ae64(0x2a6)],_0x58ae64(0x2c0))[_0x58ae64(0x220)](async()=>{const _0xd3b6d3=_0x58ae64;try{const _0x16643f=await _0x509f40[_0xd3b6d3(0x1d3)](_0x255150[_0xd3b6d3(0x1c9)][_0xd3b6d3(0x218)],{'audio':{'url':_0x40fd69+'/'+_0x47ae77+_0xd3b6d3(0x23b)},'mimetype':_0xd3b6d3(0x11a),'ptt':!![]});await verifyMediaMessage(_0x16643f,_0x6cc09f,_0x1a98e4),deleteFileSync(_0x40fd69+'/'+_0x47ae77+_0xd3b6d3(0x23b)),deleteFileSync(_0x40fd69+'/'+_0x47ae77+_0xd3b6d3(0x231));}catch(_0x590f2c){console[_0xd3b6d3(0x2c8)]('Erro\x20para\x20responder\x20com\x20audio:\x20'+_0x590f2c);}});}}}_0x3e5225=[];},transferQueue=async(_0x2dd1a5,_0x4a5ed4,_0x5d43c1)=>{const _0x137ca7=a560_0x395b41;console[_0x137ca7(0x2c9)]('update!'),await(0x0,UpdateTicketService_1[_0x137ca7(0x1c8)])({'ticketData':{'queueId':_0x2dd1a5,'useIntegration':![],'promptId':null},'ticketId':_0x4a5ed4['id'],'companyId':_0x4a5ed4['companyId']});},verifyMediaMessage=async(_0x708cd3,_0x328f8b,_0x4176f7)=>{const _0x3925f0=a560_0x395b41,_0x415b76=(0x0,socket_1[_0x3925f0(0x1b6)])();let _0x3c59e1=await Message_1['default']['findOne']({'where':{'id':_0x708cd3[_0x3925f0(0x1c9)]['id']}});if(!_0x3c59e1){const _0x5ea1d8=await(0x0,exports['verifyQuotedMessage'])(_0x708cd3),_0x456378=(0x0,wbot_1[_0x3925f0(0x169)])(_0x328f8b[_0x3925f0(0x221)]),_0x4c5d95=await downloadMedia(_0x708cd3);if(!_0x4c5d95)throw new Error(_0x3925f0(0x2cc));if(!_0x4c5d95[_0x3925f0(0x143)]){const _0x1cb9f0=typeof _0x4c5d95[_0x3925f0(0x1f4)]===_0x3925f0(0x2be)&&_0x4c5d95[_0x3925f0(0x1f4)][_0x3925f0(0x2a3)]('/')&&_0x4c5d95[_0x3925f0(0x1f4)][_0x3925f0(0x2a3)](';')?mime_1[_0x3925f0(0x1c8)][_0x3925f0(0x133)](_0x4c5d95[_0x3925f0(0x1f4)]):_0x3925f0(0x15a);_0x4c5d95['filename']=new Date()[_0x3925f0(0x15e)]()+'.'+_0x1cb9f0;}else{let _0x396af2=_0x4c5d95[_0x3925f0(0x143)]?'-'+_0x4c5d95['filename']:'';_0x4c5d95['filename']=''+new Date()['getTime']()+_0x396af2;}try{const _0x145c82='public/company'+_0x328f8b['companyId'];!fs_2[_0x3925f0(0x1c8)][_0x3925f0(0x28a)](_0x145c82)&&(fs_2['default'][_0x3925f0(0x268)](_0x145c82),fs_2[_0x3925f0(0x1c8)][_0x3925f0(0x2a4)](_0x145c82,0x1ff)),await writeFileAsync((0x0,path_1[_0x3925f0(0x1d0)])(__dirname,'..','..','..',_0x145c82,_0x4c5d95[_0x3925f0(0x143)]),_0x4c5d95[_0x3925f0(0x13d)],'base64');}catch(_0x3711d0){Sentry[_0x3925f0(0x20c)](_0x3711d0),logger_1[_0x3925f0(0x1cd)][_0x3925f0(0x131)](_0x3711d0);}const _0x563301=(0x0,exports[_0x3925f0(0x2b3)])(_0x708cd3);var _0x151cd3=getTypeMessage(_0x708cd3);const _0x5afdb7={'id':_0x708cd3[_0x3925f0(0x1c9)]['id'],'ticketId':_0x328f8b['id'],'contactId':_0x708cd3[_0x3925f0(0x1c9)][_0x3925f0(0x16b)]?undefined:_0x4176f7['id'],'body':_0x563301?(0x0,Mustache_1[_0x3925f0(0x1c8)])(_0x563301,_0x328f8b):_0x4c5d95['filename'],'fromMe':_0x708cd3[_0x3925f0(0x1c9)][_0x3925f0(0x16b)],'read':_0x708cd3[_0x3925f0(0x1c9)][_0x3925f0(0x16b)],'mediaUrl':_0x4c5d95['filename'],'mediaType':typeof _0x4c5d95[_0x3925f0(0x1f4)]==='string'?_0x4c5d95['mimetype'][_0x3925f0(0x1ff)]('/')[0x0]:_0x3925f0(0x15a),'quotedMsgId':_0x5ea1d8?.['id'],'ack':getStatus(_0x708cd3,_0x3925f0(0x290)),'remoteJid':_0x708cd3['key']['remoteJid'],'participant':_0x708cd3[_0x3925f0(0x1c9)][_0x3925f0(0x1ca)],'dataJson':JSON['stringify'](_0x708cd3)};var _0x4572b0=_0x563301||_0x4c5d95['filename'];typeof _0x4572b0!=_0x3925f0(0x2be)&&console['trace'](_0x3925f0(0x142),_0x4572b0),await _0x328f8b[_0x3925f0(0x187)]({'lastMessage':_0x4572b0}),_0x3c59e1=await(0x0,CreateMessageService_1[_0x3925f0(0x1c8)])({'messageData':_0x5afdb7,'ticket':_0x328f8b,'companyId':_0x328f8b[_0x3925f0(0x19f)]});}else typeof _0x3c59e1[_0x3925f0(0x205)]!='string'&&console[_0x3925f0(0x2c9)](_0x3925f0(0x142),_0x3c59e1[_0x3925f0(0x205)]),await _0x328f8b[_0x3925f0(0x187)]({'lastMessage':_0x3c59e1['body']}),_0x3c59e1[_0x3925f0(0x285)]=getStatus(_0x708cd3,_0x3925f0(0x290)),_0x3c59e1[_0x3925f0(0x1ca)]=_0x708cd3['key'][_0x3925f0(0x1ca)],_0x3c59e1[_0x3925f0(0x170)]=JSON['stringify'](_0x708cd3),await _0x3c59e1[_0x3925f0(0x122)]();return!_0x708cd3[_0x3925f0(0x1c9)][_0x3925f0(0x16b)]&&_0x328f8b[_0x3925f0(0x203)]===_0x3925f0(0x26a)&&(await _0x328f8b['update']({'status':'pending'}),await _0x328f8b[_0x3925f0(0x11e)]({'include':[{'model':Queue_1[_0x3925f0(0x1c8)],'as':'queue'},{'model':User_1[_0x3925f0(0x1c8)],'as':_0x3925f0(0x116)},{'model':Contact_1['default'],'as':'contact'}]}),_0x415b76['to'](_0x3925f0(0x258)+_0x328f8b['companyId']+_0x3925f0(0x1d9))[_0x3925f0(0x1c7)]('company-'+_0x328f8b[_0x3925f0(0x19f)]+_0x3925f0(0x282),{'action':'delete','ticket':_0x328f8b,'ticketId':_0x328f8b['id']}),_0x415b76['to'](_0x3925f0(0x258)+_0x328f8b[_0x3925f0(0x19f)]+'-'+_0x328f8b[_0x3925f0(0x203)])['to'](_0x328f8b['id']['toString']())['emit']('company-'+_0x328f8b[_0x3925f0(0x19f)]+'-ticket',{'action':'update','ticket':_0x328f8b,'ticketId':_0x328f8b['id']})),_0x3c59e1;};function getStatus(_0x2f81dc,_0x35a28b){const _0x11daa9=a560_0x395b41;if(_0x2f81dc[_0x11daa9(0x203)]==baileys_1[_0x11daa9(0x165)][_0x11daa9(0x2b8)][_0x11daa9(0x183)][_0x11daa9(0x27f)]){if(_0x2f81dc[_0x11daa9(0x1c9)]['fromMe']&&_0x35a28b==_0x11daa9(0x22a))return 0x3;return 0x1;}else{if(_0x2f81dc['status']==baileys_1['proto']['WebMessageInfo']['Status'][_0x11daa9(0x189)])return 0x1;else{if(_0x2f81dc[_0x11daa9(0x203)]==baileys_1['proto'][_0x11daa9(0x2b8)][_0x11daa9(0x183)][_0x11daa9(0x1bf)])return 0x2;else{if(_0x2f81dc['status']==baileys_1[_0x11daa9(0x165)][_0x11daa9(0x2b8)]['Status']['READ']||_0x2f81dc[_0x11daa9(0x203)]==baileys_1[_0x11daa9(0x165)][_0x11daa9(0x2b8)][_0x11daa9(0x183)]['PLAYED'])return 0x3;}}}return 0x0;}const verifyMessage=async(_0x45f879,_0x43d876,_0xf2b89e)=>{const _0x3d1c50=a560_0x395b41,_0x408b51=(0x0,socket_1[_0x3d1c50(0x1b6)])(),_0x566269=await(0x0,exports['verifyQuotedMessage'])(_0x45f879),_0x401574=(0x0,exports[_0x3d1c50(0x2b3)])(_0x45f879);if(!_0x401574)return;let _0x580470=getTypeMessage(_0x45f879);const _0x41bfb9=_0x580470==_0x3d1c50(0x12c)||_0x45f879?.[_0x3d1c50(0x112)]?.[_0x3d1c50(0x275)]?.[_0x3d1c50(0x253)]==baileys_1[_0x3d1c50(0x165)][_0x3d1c50(0x127)][_0x3d1c50(0x197)][_0x3d1c50(0x254)][_0x3d1c50(0x1af)]||_0x45f879?.[_0x3d1c50(0x112)]?.[_0x3d1c50(0x275)]?.[_0x3d1c50(0x12c)]?.['conversation']?.['length']>0x0;let _0x29dcee=_0x45f879[_0x3d1c50(0x1c9)]['id'];if(_0x580470=='protocolMessage')_0x29dcee=_0x45f879?.[_0x3d1c50(0x112)]?.[_0x3d1c50(0x275)]?.['key']?.['id']||_0x45f879[_0x3d1c50(0x1c9)]['id'];else _0x580470=='editedMessage'&&(_0x29dcee=_0x45f879?.['message']?.['editedMessage']?.[_0x3d1c50(0x112)]?.['protocolMessage']?.['key']?.['id']||_0x45f879[_0x3d1c50(0x1c9)]['id']);const _0x457958={'id':_0x29dcee,'ticketId':_0x43d876['id'],'contactId':_0x45f879[_0x3d1c50(0x1c9)][_0x3d1c50(0x16b)]?undefined:_0xf2b89e['id'],'body':_0x401574,'fromMe':_0x45f879[_0x3d1c50(0x1c9)][_0x3d1c50(0x16b)],'mediaType':_0x580470,'read':_0x45f879[_0x3d1c50(0x1c9)]['fromMe'],'quotedMsgId':_0x566269?.['id'],'ack':getStatus(_0x45f879,_0x580470),'remoteJid':_0x45f879[_0x3d1c50(0x1c9)][_0x3d1c50(0x218)],'participant':_0x45f879[_0x3d1c50(0x1c9)]['participant'],'dataJson':JSON[_0x3d1c50(0x1ed)](_0x45f879),'isEdited':_0x41bfb9};typeof _0x401574!=_0x3d1c50(0x2be)&&console[_0x3d1c50(0x2c9)](_0x3d1c50(0x142),_0x401574);await _0x43d876[_0x3d1c50(0x187)]({'lastMessage':_0x401574});if(_0x41bfb9){let _0x147d78=await Message_1[_0x3d1c50(0x1c8)]['findByPk'](_0x457958['id']);if(_0x147d78){const _0x9924b8={'messageId':_0x457958['id'],'body':_0x147d78[_0x3d1c50(0x205)]};await OldMessage_1['default']['upsert'](_0x9924b8);}else console[_0x3d1c50(0x2c8)](_0x3d1c50(0x190)+_0x457958['id']);}await(0x0,CreateMessageService_1[_0x3d1c50(0x1c8)])({'messageData':_0x457958,'ticket':_0x43d876,'companyId':_0x43d876['companyId']}),!_0x45f879[_0x3d1c50(0x1c9)]['fromMe']&&_0x43d876['status']===_0x3d1c50(0x26a)&&(await _0x43d876[_0x3d1c50(0x187)]({'status':'pending'}),await _0x43d876[_0x3d1c50(0x11e)]({'include':[{'model':Queue_1['default'],'as':_0x3d1c50(0x16c)},{'model':User_1[_0x3d1c50(0x1c8)],'as':'user'},{'model':Contact_1['default'],'as':_0x3d1c50(0x28c)}]}),_0x408b51['to'](_0x3d1c50(0x258)+_0x43d876[_0x3d1c50(0x19f)]+_0x3d1c50(0x1d9))[_0x3d1c50(0x1c7)](_0x3d1c50(0x258)+_0x43d876[_0x3d1c50(0x19f)]+_0x3d1c50(0x282),{'action':'delete','ticket':_0x43d876,'ticketId':_0x43d876['id']}),_0x408b51['to']('company-'+_0x43d876[_0x3d1c50(0x19f)]+'-'+_0x43d876[_0x3d1c50(0x203)])['to'](_0x43d876['id']['toString']())['emit'](_0x3d1c50(0x258)+_0x43d876['companyId']+'-ticket',{'action':_0x3d1c50(0x187),'ticket':_0x43d876,'ticketId':_0x43d876['id']}));};exports[a560_0x395b41(0x2aa)]=verifyMessage;const isValidMsg=_0x354aa5=>{const _0x2254d9=a560_0x395b41;if(_0x354aa5['key'][_0x2254d9(0x218)]===_0x2254d9(0x241))return![];try{const _0x173cc7=getTypeMessage(_0x354aa5);if(!_0x173cc7)return![];const _0x4c9c8f=_0x173cc7===_0x2254d9(0x2c7)||_0x173cc7===_0x2254d9(0x12c)||_0x173cc7==='extendedTextMessage'||_0x173cc7===_0x2254d9(0x1b5)||_0x173cc7==='videoMessage'||_0x173cc7===_0x2254d9(0x184)||_0x173cc7===_0x2254d9(0x23c)||_0x173cc7===_0x2254d9(0x269)||_0x173cc7===_0x2254d9(0x216)||_0x173cc7===_0x2254d9(0x219)||_0x173cc7==='documentMessage'||_0x173cc7===_0x2254d9(0x198)||_0x173cc7==='stickerMessage'||_0x173cc7===_0x2254d9(0x16e)||_0x173cc7==='buttonsMessage'||_0x173cc7===_0x2254d9(0x1fb)||_0x173cc7==='locationMessage'||_0x173cc7===_0x2254d9(0x1f3)||_0x173cc7===_0x2254d9(0x1ea)||_0x173cc7==='voiceMessage'||_0x173cc7==='mediaMessage'||_0x173cc7===_0x2254d9(0x230)||_0x173cc7===_0x2254d9(0x22a)||_0x173cc7===_0x2254d9(0x1eb)||_0x173cc7===_0x2254d9(0x275)||_0x173cc7===_0x2254d9(0x1f2)||_0x173cc7===_0x2254d9(0x22b)||_0x173cc7===_0x2254d9(0x207)||_0x173cc7==='viewOnceMessageV2'||_0x173cc7===_0x2254d9(0x162)||_0x173cc7==='highlyStructuredMessage';return!_0x4c9c8f&&(logger_1[_0x2254d9(0x1cd)]['warn'](_0x2254d9(0x261)+_0x173cc7+'\x0a'+JSON[_0x2254d9(0x1ed)](_0x354aa5?.[_0x2254d9(0x112)])),Sentry[_0x2254d9(0x286)]('Mensagem',{'BodyMsg':_0x354aa5[_0x2254d9(0x112)],'msg':_0x354aa5,'msgType':_0x173cc7}),Sentry[_0x2254d9(0x20c)](new Error(_0x2254d9(0x156)))),!!_0x4c9c8f;}catch(_0x388fb7){Sentry[_0x2254d9(0x286)](_0x2254d9(0x141),{'msg':_0x354aa5}),Sentry[_0x2254d9(0x20c)](_0x388fb7);}return![];};exports[a560_0x395b41(0x17e)]=isValidMsg;const Push=_0x4586c7=>{const _0x4417cb=a560_0x395b41;return _0x4586c7[_0x4417cb(0x1a6)];},verifyQueue=async(_0x284231,_0x5b2b73,_0x5855a1,_0x23b157,_0x38ecd5)=>{const _0x2e3bda=a560_0x395b41,_0x3dad7b=_0x5855a1[_0x2e3bda(0x19f)],{queues:_0x21f2db,greetingMessage:_0x3f20f4,maxUseBotQueues:_0x267624,timeUseBotQueues:_0x41cf0e}=await(0x0,ShowWhatsAppService_1[_0x2e3bda(0x1c8)])(_0x284231['id'],_0x5855a1[_0x2e3bda(0x19f)]);if(_0x21f2db[_0x2e3bda(0x14f)]===0x1){const _0x4126ae=(0x0,lodash_1['head'])(_0x21f2db);let _0x715864=![];_0x4126ae?.[_0x2e3bda(0x265)]&&(_0x715864=_0x4126ae['options'][_0x2e3bda(0x14f)]>0x0);const _0x58ac4f=await Setting_1[_0x2e3bda(0x1c8)][_0x2e3bda(0x15d)]({'where':{'key':_0x2e3bda(0x135),'companyId':_0x5855a1['companyId']}});greetingMessageControl[_0x2e3bda(0x20b)]({'ticketId':_0x5855a1['id'],'greetingMessage':_0x3f20f4,'companyId':_0x3dad7b});if(_0x3f20f4[_0x2e3bda(0x14f)]>0x1&&_0x58ac4f?.['value']==='enabled'){const _0x17a9a1=await Message_1['default'][_0x2e3bda(0x15d)]({'where':{'ticketId':_0x5855a1['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x2e3bda(0x283)]]:(0x0,moment_1[_0x2e3bda(0x1c8)])()[_0x2e3bda(0x22e)](0x5,_0x2e3bda(0x2b4))['toDate']()}}});if(_0x17a9a1)return;const _0x57e785=(0x0,Mustache_1[_0x2e3bda(0x1c8)])(''+_0x3f20f4,_0x5855a1);await _0x284231['sendMessage'](_0x23b157[_0x2e3bda(0x2bd)]+'@'+(_0x5855a1[_0x2e3bda(0x1a0)]?_0x2e3bda(0x21e):_0x2e3bda(0x22d)),{'text':_0x57e785});}const _0x4ad9e2=await(0x0,ShowWhatsAppService_1[_0x2e3bda(0x1c8)])(_0x284231['id'],_0x3dad7b),_0x363172=_0x21f2db[0x0]?.[_0x2e3bda(0x228)]||_0x4ad9e2[_0x2e3bda(0x228)];if(!_0x5b2b73[_0x2e3bda(0x1c9)][_0x2e3bda(0x16b)]&&!_0x5855a1['isGroup']&&!(0x0,lodash_1[_0x2e3bda(0x23d)])(_0x363172)){const _0xb407e=await(0x0,ShowQueueIntegrationService_1['default'])(_0x363172,_0x3dad7b);await(0x0,exports['handleMessageIntegration'])(_0x5b2b73,_0x284231,_0xb407e,_0x5855a1),await _0x5855a1[_0x2e3bda(0x187)]({'useIntegration':!![],'integrationId':_0xb407e['id']});}const _0x547118=_0x21f2db[0x0]?.['promptId']||_0x4ad9e2['promptId'];!_0x5b2b73['key'][_0x2e3bda(0x16b)]&&!_0x5855a1[_0x2e3bda(0x1a0)]&&!(0x0,lodash_1['isNil'])(_0x547118)&&(console[_0x2e3bda(0x2c8)](_0x2e3bda(0x14e)),await handleOpenAi(_0x5b2b73,_0x284231,_0x5855a1,_0x23b157,_0x38ecd5),await _0x5855a1[_0x2e3bda(0x187)]({'useIntegration':!![],'promptId':_0x547118}));await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x4126ae?.['id'],'chatbot':_0x715864,'status':_0x2e3bda(0x20e)},'ticketId':_0x5855a1['id'],'companyId':_0x5855a1['companyId']});return;}const _0x18ae10=_0x5b2b73?.[_0x2e3bda(0x112)]?.[_0x2e3bda(0x16e)]?.['selectedButtonId']||_0x5b2b73?.[_0x2e3bda(0x112)]?.[_0x2e3bda(0x1f2)]?.[_0x2e3bda(0x115)]?.['selectedRowId']||_0x5b2b73?.[_0x2e3bda(0x112)]?.[_0x2e3bda(0x2a9)]?.[_0x2e3bda(0x2b7)]||_0x5b2b73?.[_0x2e3bda(0x112)]?.[_0x2e3bda(0x2c7)];let _0x49e0e0=null;if(_0x18ae10&&!(0x0,exports[_0x2e3bda(0x153)])(_0x18ae10)||+_0x18ae10>_0x21f2db[_0x2e3bda(0x14f)]){const _0xcae3fe=_0x18ae10[_0x2e3bda(0x111)]();for(let _0x419685 of _0x21f2db){if(_0x419685[_0x2e3bda(0x193)]['toLowerCase']()===_0xcae3fe){_0x49e0e0=_0x419685;break;}if(_0x419685[_0x2e3bda(0x281)]&&_0x419685[_0x2e3bda(0x281)]['length']>0x0){let _0x429017=_0x419685[_0x2e3bda(0x281)][_0x2e3bda(0x1ff)](',\x20');for(let _0x305304 of _0x429017){if(_0x305304[_0x2e3bda(0x111)]()==_0xcae3fe){_0x49e0e0=_0x419685;break;}}}}}else _0x49e0e0=_0x21f2db[+_0x18ae10-0x1];const _0x225a9a=await Setting_1['default'][_0x2e3bda(0x15d)]({'where':{'key':'chatBotType','companyId':_0x3dad7b}}),_0x3e3621=async()=>{const _0x340cfc=_0x2e3bda;let _0x25c832='';if(outOfHourMessageControl['length']>0x1388)outOfHourMessageControl=[];_0x21f2db[_0x340cfc(0x1d2)]((_0x592ca7,_0x160e26)=>{const _0xc5a39=_0x340cfc;_0x25c832+='*[\x20'+(_0x160e26+0x1)+_0xc5a39(0x177)+_0x592ca7[_0xc5a39(0x193)]+'\x0a';});if(process['env'][_0x340cfc(0x242)]?.['length']>=0x8){if(_0x5855a1[_0x340cfc(0x28c)][_0x340cfc(0x2bd)]!=process[_0x340cfc(0x17b)]['CHATBOT_RESTRICT_NUMBER']){console[_0x340cfc(0x2c9)](_0x340cfc(0x2ad));return;}}const _0xafc318={'text':(0x0,Mustache_1['default'])('‎'+_0x3f20f4+'\x0a\x0a'+_0x25c832,_0x5855a1)};await(0x0,UpdateTicketService_1[_0x340cfc(0x1c8)])({'ticketData':{'amountUsedBotQueues':_0x5855a1[_0x340cfc(0x1e7)]+0x1},'ticketId':_0x5855a1['id'],'companyId':_0x5855a1['companyId']});const _0x2f9aeb=await _0x284231['sendMessage'](_0x23b157[_0x340cfc(0x2bd)]+'@'+(_0x5855a1[_0x340cfc(0x1a0)]?'g.us':_0x340cfc(0x22d)),_0xafc318);await(0x0,exports['verifyMessage'])(_0x2f9aeb,_0x5855a1,_0x5855a1[_0x340cfc(0x28c)]);};if(_0x49e0e0){let _0x2f45dc=![];_0x49e0e0?.[_0x2e3bda(0x265)]&&(_0x2f45dc=_0x49e0e0[_0x2e3bda(0x265)][_0x2e3bda(0x14f)]>0x0);await(0x0,UpdateTicketService_1[_0x2e3bda(0x1c8)])({'ticketData':{'queueId':_0x49e0e0['id'],'chatbot':_0x2f45dc,'status':_0x2e3bda(0x20e),'amountUsedBotQueues':0x0},'ticketId':_0x5855a1['id'],'companyId':_0x5855a1['companyId']}),console[_0x2e3bda(0x2c9)](_0x49e0e0[_0x2e3bda(0x265)]);if(_0x49e0e0[_0x2e3bda(0x265)][_0x2e3bda(0x14f)]===0x0){const _0x572cdf=await Queue_1[_0x2e3bda(0x1c8)][_0x2e3bda(0x1c0)](_0x49e0e0['id']),{schedules:_0x367feb}=_0x572cdf,_0x92b153=(0x0,moment_1[_0x2e3bda(0x1c8)])(),_0x522974=_0x92b153[_0x2e3bda(0x20a)]('dddd')[_0x2e3bda(0x111)]();let _0x5773a8;Array['isArray'](_0x367feb)&&_0x367feb['length']>0x0&&(_0x5773a8=_0x367feb[_0x2e3bda(0x13b)](_0x17e458=>_0x17e458[_0x2e3bda(0x250)]===_0x522974&&_0x17e458['startTime']!==''&&_0x17e458['startTime']!==null&&_0x17e458[_0x2e3bda(0x2ae)]!==''&&_0x17e458[_0x2e3bda(0x2ae)]!==null));if(_0x572cdf[_0x2e3bda(0x2c3)]!==null&&_0x572cdf[_0x2e3bda(0x2c3)]!==''&&!(0x0,lodash_1[_0x2e3bda(0x23d)])(_0x5773a8)){var _0x4de651=outOfHourMessageControl[_0x2e3bda(0x13b)](_0x32ed07=>_0x32ed07[_0x2e3bda(0x19c)]===_0x5855a1['id']||_0x32ed07['dest']===_0x23b157[_0x2e3bda(0x2bd)]);if(!_0x4de651||_0x4de651&&_0x4de651[_0x2e3bda(0x128)]+0x3e8*0x3c*0x5<new Date()['getTime']()){_0x4de651&&(outOfHourMessageControl=outOfHourMessageControl[_0x2e3bda(0x14d)](_0x399d75=>_0x399d75[_0x2e3bda(0x19c)]!==_0x5855a1['id']),_0x4de651=null);const _0x2865b1=(0x0,moment_1[_0x2e3bda(0x1c8)])(_0x5773a8['startTime'],_0x2e3bda(0x139)),_0x3dc1aa=(0x0,moment_1[_0x2e3bda(0x1c8)])(_0x5773a8[_0x2e3bda(0x2ae)],_0x2e3bda(0x139));outOfHourMessageControl[_0x2e3bda(0x20b)]({'ticketId':_0x5855a1['id'],'time':new Date()[_0x2e3bda(0x15e)]()});if(_0x92b153['isBefore'](_0x2865b1)||_0x92b153['isAfter'](_0x3dc1aa)){const _0x5459d0=(0x0,Mustache_1[_0x2e3bda(0x1c8)])('‎\x20'+_0x572cdf[_0x2e3bda(0x2c3)]+_0x2e3bda(0x1ee),_0x5855a1),_0x24d621=await _0x284231['sendMessage'](_0x23b157[_0x2e3bda(0x2bd)]+'@'+(_0x5855a1['isGroup']?'g.us':'s.whatsapp.net'),{'text':_0x5459d0});await(0x0,exports['verifyMessage'])(_0x24d621,_0x5855a1,_0x23b157),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null,'chatbot':_0x2f45dc},'ticketId':_0x5855a1['id'],'companyId':_0x5855a1[_0x2e3bda(0x19f)]}),console[_0x2e3bda(0x2c8)](_0x2e3bda(0x1e8));return;}}!_0x4de651&&outOfHourMessageControl[_0x2e3bda(0x20b)]({'ticketId':_0x5855a1['id'],'dest':_0x23b157[_0x2e3bda(0x2bd)],'time':new Date()[_0x2e3bda(0x15e)]()});}console[_0x2e3bda(0x2c9)](_0x49e0e0['integrationId']);if(!_0x5b2b73['key'][_0x2e3bda(0x16b)]&&!_0x5855a1[_0x2e3bda(0x1a0)]&&_0x49e0e0['integrationId']){const _0x7b9303=await(0x0,ShowQueueIntegrationService_1[_0x2e3bda(0x1c8)])(_0x49e0e0[_0x2e3bda(0x228)],_0x3dad7b);await(0x0,exports[_0x2e3bda(0x12a)])(_0x5b2b73,_0x284231,_0x7b9303,_0x5855a1),await _0x5855a1['update']({'useIntegration':!![],'integrationId':_0x7b9303['id']});}!_0x5b2b73['key'][_0x2e3bda(0x16b)]&&!_0x5855a1[_0x2e3bda(0x1a0)]&&!(0x0,lodash_1[_0x2e3bda(0x23d)])(_0x49e0e0?.[_0x2e3bda(0x2ba)])&&(await handleOpenAi(_0x5b2b73,_0x284231,_0x5855a1,_0x23b157,_0x38ecd5),await _0x5855a1[_0x2e3bda(0x187)]({'useIntegration':!![],'promptId':_0x49e0e0?.[_0x2e3bda(0x2ba)]}));const _0x14ff2f=(0x0,Mustache_1[_0x2e3bda(0x1c8)])('‎'+_0x49e0e0['greetingMessage'],_0x5855a1);if(_0x49e0e0['greetingMessage']){const _0x34972f=await _0x284231[_0x2e3bda(0x1d3)](_0x23b157['number']+'@'+(_0x5855a1[_0x2e3bda(0x1a0)]?_0x2e3bda(0x21e):_0x2e3bda(0x22d)),{'text':_0x14ff2f});await(0x0,exports[_0x2e3bda(0x2aa)])(_0x34972f,_0x5855a1,_0x23b157);if(_0x49e0e0[_0x2e3bda(0x26c)]!==null&&_0x49e0e0[_0x2e3bda(0x26c)]!==''){const _0x216bbf=path_1[_0x2e3bda(0x1c8)][_0x2e3bda(0x202)](_0x2e3bda(0x263),_0x2e3bda(0x13f)+_0x49e0e0[_0x2e3bda(0x19f)],_0x49e0e0[_0x2e3bda(0x26c)]),_0x4147ef=await(0x0,SendWhatsAppMedia_1[_0x2e3bda(0x26d)])(_0x49e0e0[_0x2e3bda(0x1ec)],_0x216bbf,null,_0x5855a1[_0x2e3bda(0x19f)]);let _0x4f371b=await _0x284231[_0x2e3bda(0x1d3)](_0x5855a1[_0x2e3bda(0x28c)][_0x2e3bda(0x2bd)]+'@'+(_0x5855a1[_0x2e3bda(0x1a0)]?_0x2e3bda(0x21e):_0x2e3bda(0x22d)),{..._0x4147ef});await verifyMediaMessage(_0x4f371b,_0x5855a1,_0x23b157);}}}}else{if(_0x267624&&_0x267624!==0x0&&_0x5855a1['amountUsedBotQueues']>=_0x267624)return;const _0x42a09b=await(0x0,FindOrCreateATicketTrakingService_1[_0x2e3bda(0x1c8)])({'ticketId':_0x5855a1['id'],'companyId':_0x3dad7b});let _0x25f5f7=new Date(),_0x536dfe=new Date();if(_0x42a09b[_0x2e3bda(0x19a)]!==null){_0x25f5f7['setMinutes'](_0x42a09b[_0x2e3bda(0x19a)][_0x2e3bda(0x107)]()+Number(_0x41cf0e));if(_0x42a09b[_0x2e3bda(0x19a)]!==null&&_0x536dfe<_0x25f5f7&&_0x41cf0e!=='0'&&_0x5855a1['amountUsedBotQueues']!==0x0)return;}await _0x42a09b[_0x2e3bda(0x187)]({'updatedAt':new Date()});if(_0x225a9a[_0x2e3bda(0x238)]==='text')return console[_0x2e3bda(0x2c9)](_0x2e3bda(0x240)),_0x3e3621();}},verifyRating=_0xad9ee2=>{const _0x535379=a560_0x395b41;return _0xad9ee2&&_0xad9ee2[_0x535379(0x21f)]===null&&_0xad9ee2[_0x535379(0x244)]!==null&&_0xad9ee2[_0x535379(0x296)]!==null;};exports[a560_0x395b41(0x13a)]=verifyRating;const handleRating=async(_0x23f517,_0x1aa84d,_0x245740)=>{const _0x205851=a560_0x395b41,_0x5265c2=(0x0,socket_1[_0x205851(0x1b6)])();let _0x1cef4f=null;(_0x23f517?.['message']?.[_0x205851(0x2c7)]||_0x23f517?.[_0x205851(0x112)]?.[_0x205851(0x2a9)])&&(_0x1cef4f=parseInt(_0x23f517['message'][_0x205851(0x2c7)]||_0x23f517[_0x205851(0x112)][_0x205851(0x2a9)][_0x205851(0x2b7)],0xa)||null);if(!Number[_0x205851(0x25b)](_0x1cef4f)&&Number[_0x205851(0x249)](_0x1cef4f)&&!(0x0,lodash_1['isNull'])(_0x1cef4f)){const {complationMessage:_0xfd5675}=await(0x0,ShowWhatsAppService_1[_0x205851(0x1c8)])(_0x1aa84d[_0x205851(0x221)],_0x1aa84d[_0x205851(0x19f)]);let _0x1c78a0=_0x1cef4f;_0x1cef4f<0x1&&(_0x1c78a0=0x1);_0x1cef4f>0x5&&(_0x1c78a0=0x5);await UserRating_1[_0x205851(0x1c8)][_0x205851(0x217)]({'ticketId':_0x245740[_0x205851(0x19c)],'companyId':_0x245740[_0x205851(0x19f)],'userId':_0x245740['userId'],'rate':_0x1c78a0});if(_0xfd5675){if(completionMessageControl[_0x205851(0x14f)]>=0x9c4)completionMessageControl=[];var _0x29a277=completionMessageControl[_0x205851(0x13b)](_0x14165a=>_0x14165a[_0x205851(0x19c)]===_0x1aa84d['id']||_0x14165a[_0x205851(0x160)]===_0x1aa84d[_0x205851(0x28c)][_0x205851(0x2bd)]);if(!_0x29a277||_0x29a277&&_0x29a277[_0x205851(0x128)]+0x3e8*0x3c*0x1e<new Date()[_0x205851(0x15e)]()){_0x29a277&&(completionMessageControl=completionMessageControl[_0x205851(0x14d)](_0x6ad1a3=>_0x6ad1a3[_0x205851(0x19c)]!==_0x1aa84d['id']),_0x29a277=null);const _0x5c7ecf=(0x0,Mustache_1[_0x205851(0x1c8)])('‎'+_0xfd5675,_0x1aa84d);await(0x0,SendPresenceStatus_1[_0x205851(0x144)])((0x0,wbot_1['getWbot'])(_0x1aa84d[_0x205851(0x221)]),_0x1aa84d[_0x205851(0x28c)][_0x205851(0x2bd)]+'@'+(_0x1aa84d[_0x205851(0x1a0)]?_0x205851(0x21e):_0x205851(0x22d))),await(0x0,SendWhatsAppMessage_1[_0x205851(0x1c8)])({'body':_0x5c7ecf,'ticket':_0x1aa84d});}!_0x29a277&&completionMessageControl[_0x205851(0x20b)]({'ticketId':_0x1aa84d['id'],'dest':_0x1aa84d[_0x205851(0x28c)][_0x205851(0x2bd)],'time':new Date()[_0x205851(0x15e)]()});}await _0x245740['update']({'finishedAt':(0x0,moment_1[_0x205851(0x1c8)])()[_0x205851(0x1e0)](),'ratedAt':(0x0,moment_1['default'])()[_0x205851(0x1e0)](),'rated':!![]}),await _0x1aa84d['update']({'queueId':null,'chatbot':null,'queueOptionId':null,'userId':null,'status':_0x205851(0x26a)}),_0x5265c2['to']('company-'+_0x1aa84d[_0x205851(0x19f)]+_0x205851(0x204))[_0x205851(0x1c7)](_0x205851(0x258)+_0x1aa84d[_0x205851(0x19f)]+'-ticket',{'action':_0x205851(0x132),'ticket':_0x1aa84d,'ticketId':_0x1aa84d['id']}),_0x5265c2['to'](_0x205851(0x258)+_0x1aa84d[_0x205851(0x19f)]+'-'+_0x1aa84d[_0x205851(0x203)])['to'](_0x1aa84d['id'][_0x205851(0x11d)]())[_0x205851(0x1c7)]('company-'+_0x1aa84d[_0x205851(0x19f)]+'-ticket',{'action':'update','ticket':_0x1aa84d,'ticketId':_0x1aa84d['id']});}};exports[a560_0x395b41(0x2c1)]=handleRating;const handleChartbot=async(_0x139894,_0x3ef2c6,_0x2fa7b0,_0x4a6a64,_0x3db56c=![])=>{const _0x2d744f=a560_0x395b41;if(!_0x139894['contact'][_0x2d744f(0x24a)]){const _0x74c9bf=await Queue_1[_0x2d744f(0x1c8)][_0x2d744f(0x1c0)](_0x139894[_0x2d744f(0x17d)],{'include':[{'model':QueueOption_1[_0x2d744f(0x1c8)],'as':_0x2d744f(0x265),'where':{'parentId':null},'order':[[_0x2d744f(0x246),_0x2d744f(0x14c)],[_0x2d744f(0x279),_0x2d744f(0x14c)]]}]}),_0x5eda67=_0x3ef2c6?.[_0x2d744f(0x112)]?.[_0x2d744f(0x16e)]?.[_0x2d744f(0x161)]||_0x3ef2c6?.['message']?.[_0x2d744f(0x1f2)]?.[_0x2d744f(0x115)]?.[_0x2d744f(0x2c5)]||_0x3ef2c6?.[_0x2d744f(0x112)]?.[_0x2d744f(0x2a9)]?.[_0x2d744f(0x2b7)]||_0x3ef2c6?.[_0x2d744f(0x112)]?.[_0x2d744f(0x2c7)];if(_0x5eda67=='#'&&(!_0x139894[_0x2d744f(0x244)]||_0x139894[_0x2d744f(0x203)]==_0x2d744f(0x20e))){console[_0x2d744f(0x2c9)](_0x2d744f(0x19d)),await _0x139894[_0x2d744f(0x187)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x2fa7b0,_0x3ef2c6,_0x139894,_0x139894[_0x2d744f(0x28c)]);return;}if(!(0x0,lodash_1[_0x2d744f(0x23d)])(_0x74c9bf)&&!(0x0,lodash_1[_0x2d744f(0x23d)])(_0x139894[_0x2d744f(0x186)])&&_0x5eda67=='0'){console[_0x2d744f(0x2c9)](_0x2d744f(0x210));const _0x1c16ef=await QueueOption_1[_0x2d744f(0x1c8)][_0x2d744f(0x1c0)](_0x139894[_0x2d744f(0x186)]);await _0x139894[_0x2d744f(0x187)]({'queueOptionId':_0x1c16ef?.[_0x2d744f(0x1e1)],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1['isNil'])(_0x74c9bf)&&!(0x0,lodash_1[_0x2d744f(0x23d)])(_0x139894['queueOptionId'])){console[_0x2d744f(0x2c9)](_0x2d744f(0x25c));const _0x1ff311=await QueueOption_1[_0x2d744f(0x1c8)][_0x2d744f(0x297)]({'where':{'parentId':_0x139894[_0x2d744f(0x186)]}});let _0x10f9b9={};_0x1ff311==0x1?_0x10f9b9=await QueueOption_1['default']['findOne']({'where':{'parentId':_0x139894[_0x2d744f(0x186)]}}):(console['trace'](_0x2d744f(0x1a5)),_0x10f9b9=await QueueOption_1[_0x2d744f(0x1c8)]['findOne']({'where':{[sequelize_1['Op']['or']]:[{'option':_0x5eda67||''},{'title':_0x5eda67||''}],'parentId':_0x139894['queueOptionId']}})),_0x10f9b9&&await _0x139894['update']({'queueOptionId':_0x10f9b9?.['id'],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1[_0x2d744f(0x23d)])(_0x74c9bf)&&(0x0,lodash_1['isNil'])(_0x139894[_0x2d744f(0x186)])&&!_0x3db56c){console[_0x2d744f(0x2c9)](_0x2d744f(0x106));const _0x3ab945=_0x74c9bf?.[_0x2d744f(0x265)][_0x2d744f(0x13b)](_0x4c31ba=>_0x4c31ba[_0x2d744f(0x246)]==_0x5eda67||_0x4c31ba[_0x2d744f(0x280)][_0x2d744f(0x111)]()==_0x5eda67['toLowerCase']());if(_0x3ab945)await _0x139894[_0x2d744f(0x187)]({'queueOptionId':_0x3ab945?.['id'],'amountUsedBotQueues':0x0});else{if(_0x4a6a64[_0x2d744f(0x256)]&&_0x4a6a64[_0x2d744f(0x256)]!==0x0&&_0x139894[_0x2d744f(0x1e7)]>=_0x4a6a64[_0x2d744f(0x256)])return;await _0x139894['update']({'amountUsedBotQueues':_0x139894[_0x2d744f(0x1e7)]+0x1});}}else{if(_0x4a6a64[_0x2d744f(0x256)]&&_0x4a6a64[_0x2d744f(0x256)]!==0x0&&_0x139894[_0x2d744f(0x1e7)]>=_0x4a6a64[_0x2d744f(0x256)])return;await _0x139894['update']({'amountUsedBotQueues':_0x139894['amountUsedBotQueues']+0x1});}}}await _0x139894[_0x2d744f(0x11e)]();if(!(0x0,lodash_1[_0x2d744f(0x23d)])(_0x74c9bf)&&(0x0,lodash_1[_0x2d744f(0x23d)])(_0x139894[_0x2d744f(0x186)])){const _0x53e7dc=await QueueOption_1['default'][_0x2d744f(0x1c1)]({'where':{'queueId':_0x139894[_0x2d744f(0x17d)],'parentId':null},'order':[[_0x2d744f(0x246),_0x2d744f(0x14c)],[_0x2d744f(0x279),_0x2d744f(0x14c)]]}),_0x1bacb8=_0x139894['companyId'],_0x28e7fc=await Setting_1['default']['findOne']({'where':{'key':_0x2d744f(0x2a2),'companyId':_0x1bacb8}}),_0x456de0=async()=>{const _0x327ccc=_0x2d744f,_0x136ee5=[];_0x53e7dc['forEach']((_0x3e3e91,_0x3e85d6)=>{const _0x5cb21a=a560_0x5704;_0x136ee5[_0x5cb21a(0x20b)]({'buttonId':''+_0x3e3e91[_0x5cb21a(0x246)],'buttonText':{'displayText':_0x3e3e91[_0x5cb21a(0x280)]},'type':0x4});}),_0x136ee5['push']({'buttonId':'#','buttonText':{'displayText':_0x327ccc(0x293)},'type':0x4});const _0x2c8cad={'text':(0x0,Mustache_1[_0x327ccc(0x1c8)])('‎'+_0x74c9bf[_0x327ccc(0x2a0)],_0x139894),'buttons':_0x136ee5,'footer':_0x327ccc(0x222),'headerType':0x1},_0x1d3751=await _0x2fa7b0['sendMessage'](_0x139894[_0x327ccc(0x28c)][_0x327ccc(0x2bd)]+'@'+(_0x139894['isGroup']?_0x327ccc(0x21e):_0x327ccc(0x22d)),_0x2c8cad);await(0x0,exports[_0x327ccc(0x2aa)])(_0x1d3751,_0x139894,_0x139894[_0x327ccc(0x28c)]);},_0x4b5524=async()=>{const _0x3f28c3=_0x2d744f;let _0x20f7ea='';console[_0x3f28c3(0x2c9)](_0x3f28c3(0x240)),console[_0x3f28c3(0x2c8)](_0x74c9bf[_0x3f28c3(0x26c)]),_0x53e7dc['forEach']((_0x475981,_0x596c7b)=>{const _0xdd8567=_0x3f28c3;_0x20f7ea+='*[\x20'+_0x475981['option']+_0xdd8567(0x177)+_0x475981['title']+'\x0a';}),_0x20f7ea+=_0x3f28c3(0x206);const _0x3f21ef={'text':(0x0,Mustache_1[_0x3f28c3(0x1c8)])('‎'+_0x74c9bf[_0x3f28c3(0x2a0)]+'\x0a\x0a'+_0x20f7ea,_0x139894)};let _0x5914b3;if(!_0x74c9bf['mediaPath'])_0x5914b3=await _0x2fa7b0[_0x3f28c3(0x1d3)](_0x139894['contact']['number']+'@'+(_0x139894[_0x3f28c3(0x1a0)]?'g.us':_0x3f28c3(0x22d)),_0x3f21ef),await(0x0,exports[_0x3f28c3(0x2aa)])(_0x5914b3,_0x139894,_0x139894[_0x3f28c3(0x28c)]);else{const _0x74dcce=path_1[_0x3f28c3(0x1c8)][_0x3f28c3(0x202)](_0x3f28c3(0x263),_0x3f28c3(0x13f)+_0x139894[_0x3f28c3(0x19f)],_0x74c9bf[_0x3f28c3(0x26c)]),_0x5cef2f=await(0x0,SendWhatsAppMedia_1[_0x3f28c3(0x26d)])(_0x3f21ef['text'],_0x74dcce,_0x3f21ef[_0x3f28c3(0x2b7)],_0x139894['companyId']);_0x5914b3=await _0x2fa7b0[_0x3f28c3(0x1d3)](_0x139894[_0x3f28c3(0x28c)][_0x3f28c3(0x2bd)]+'@'+(_0x139894[_0x3f28c3(0x1a0)]?_0x3f28c3(0x21e):_0x3f28c3(0x22d)),{..._0x5cef2f}),await verifyMediaMessage(_0x5914b3,_0x139894,_0x139894[_0x3f28c3(0x28c)]);}};if(_0x28e7fc[_0x2d744f(0x238)]===_0x2d744f(0x214)&&QueueOption_1[_0x2d744f(0x1c8)]['length']<=0x4)return _0x456de0();if(_0x28e7fc[_0x2d744f(0x238)]===_0x2d744f(0x2b7))return console['trace']('botText'),_0x4b5524();if(_0x28e7fc['value']===_0x2d744f(0x214)&&QueueOption_1['default'][_0x2d744f(0x14f)]>0x4)return console[_0x2d744f(0x2c9)](_0x2d744f(0x240)),_0x4b5524();}else{if(!(0x0,lodash_1['isNil'])(_0x74c9bf)&&!(0x0,lodash_1[_0x2d744f(0x23d)])(_0x139894[_0x2d744f(0x186)])){const _0x2c7dd7=await QueueOption_1[_0x2d744f(0x1c8)][_0x2d744f(0x1c0)](_0x139894[_0x2d744f(0x186)]),_0x11fa4a=await QueueOption_1[_0x2d744f(0x1c8)][_0x2d744f(0x1c1)]({'where':{'parentId':_0x139894[_0x2d744f(0x186)]},'order':[[_0x2d744f(0x246),'ASC'],['createdAt',_0x2d744f(0x14c)]]});if(_0x11fa4a[_0x2d744f(0x14f)]===0x0){const _0x1d41bd={'text':(0x0,Mustache_1['default'])('‎'+_0x2c7dd7[_0x2d744f(0x112)],_0x139894)},_0x429c89=await _0x2fa7b0[_0x2d744f(0x1d3)](_0x139894[_0x2d744f(0x28c)][_0x2d744f(0x2bd)]+'@'+(_0x139894[_0x2d744f(0x1a0)]?_0x2d744f(0x21e):_0x2d744f(0x22d)),_0x1d41bd);await(0x0,exports[_0x2d744f(0x2aa)])(_0x429c89,_0x139894,_0x139894[_0x2d744f(0x28c)]),await _0x139894[_0x2d744f(0x187)]({'queueOptionId':null,'chatbot':![]});return;}if(_0x11fa4a['length']>-0x1){const _0x5b40ef=_0x139894[_0x2d744f(0x19f)],_0x554740=await Setting_1['default']['findOne']({'where':{'key':_0x2d744f(0x2a2),'companyId':_0x5b40ef}}),_0x57741c=async()=>{const _0x3e424a=_0x2d744f,_0x18b9ca=[],_0x5070c1=_0x139894[_0x3e424a(0x19f)],_0x41587f=await getQueues(_0x5070c1),_0x15126d=await getContactFromTicket(_0x139894['id']);_0x41587f[_0x3e424a(0x1d2)]((_0x5c424f,_0x37a6eb)=>{const _0x56bb04=_0x3e424a;_0x18b9ca[_0x56bb04(0x20b)]({'title':'['+(_0x37a6eb+0x1)+']\x20-\x20'+_0x5c424f[_0x56bb04(0x193)],'rowId':''+(_0x37a6eb+0x1)});});const _0x2aead6=[{'rows':_0x18b9ca}],_0x352b2d={'text':(0x0,Mustache_1[_0x3e424a(0x1c8)])('‎'+_0x2c7dd7[_0x3e424a(0x112)],_0x139894),'title':'Lista','buttonText':'Escolha\x20uma\x20opção','sections':_0x2aead6};await sleep(0x3e8);const _0x256bc9=await _0x2fa7b0[_0x3e424a(0x1d3)](_0x3e424a(0x1ba)+_0x15126d[_0x3e424a(0x2bd)]+'@'+(_0x139894['isGroup']?_0x3e424a(0x21e):_0x3e424a(0x22d)),_0x352b2d);await(0x0,exports[_0x3e424a(0x2aa)])(_0x256bc9,_0x139894,_0x139894[_0x3e424a(0x28c)]);},_0x1e20a3=async()=>{const _0x2c72b1=_0x2d744f,_0x2cf4ee=[];_0x11fa4a[_0x2c72b1(0x1d2)]((_0x53f65f,_0x211d19)=>{const _0x42ceb1=_0x2c72b1;_0x2cf4ee[_0x42ceb1(0x20b)]({'buttonId':''+_0x53f65f[_0x42ceb1(0x246)],'buttonText':{'displayText':_0x53f65f[_0x42ceb1(0x280)]},'type':0x4});}),_0x2cf4ee[_0x2c72b1(0x20b)]({'buttonId':'#','buttonText':{'displayText':_0x2c72b1(0x293)},'type':0x4});const _0x632418={'text':(0x0,Mustache_1[_0x2c72b1(0x1c8)])('‎'+_0x2c7dd7['message'],_0x139894),'buttons':_0x2cf4ee,'headerType':0x4};if(process['env'][_0x2c72b1(0x242)]?.[_0x2c72b1(0x14f)]>=0x8){if(_0x139894[_0x2c72b1(0x28c)][_0x2c72b1(0x2bd)]!=process[_0x2c72b1(0x17b)][_0x2c72b1(0x242)]){console[_0x2c72b1(0x2c9)](_0x2c72b1(0x2ad));return;}}if(!_0x2c7dd7[_0x2c72b1(0x26c)]){const _0x11bdb7=await _0x2fa7b0[_0x2c72b1(0x1d3)](_0x139894['contact'][_0x2c72b1(0x2bd)]+'@'+(_0x139894['isGroup']?_0x2c72b1(0x21e):_0x2c72b1(0x22d)),_0x632418);await(0x0,exports[_0x2c72b1(0x2aa)])(_0x11bdb7,_0x139894,_0x139894['contact']);}else{const _0x15bf20=path_1[_0x2c72b1(0x1c8)][_0x2c72b1(0x202)](_0x2c72b1(0x263),_0x2c72b1(0x13f)+_0x139894[_0x2c72b1(0x19f)],_0x2c7dd7['mediaPath']),_0xaadec4=await(0x0,SendWhatsAppMedia_1[_0x2c72b1(0x26d)])(_0x2c7dd7['mediaName'],_0x15bf20,_0x632418[_0x2c72b1(0x2b7)],_0x139894[_0x2c72b1(0x19f)]);let _0x150419=await _0x2fa7b0['sendMessage'](_0x139894[_0x2c72b1(0x28c)][_0x2c72b1(0x2bd)]+'@'+(_0x139894[_0x2c72b1(0x1a0)]?'g.us':_0x2c72b1(0x22d)),{..._0xaadec4});await verifyMediaMessage(_0x150419,_0x139894,_0x139894[_0x2c72b1(0x28c)]);}const _0x3296d0=await _0x2fa7b0[_0x2c72b1(0x1d3)](_0x139894[_0x2c72b1(0x28c)][_0x2c72b1(0x2bd)]+'@'+(_0x139894[_0x2c72b1(0x1a0)]?'g.us':_0x2c72b1(0x22d)),_0x632418);await(0x0,exports['verifyMessage'])(_0x3296d0,_0x139894,_0x139894[_0x2c72b1(0x28c)]);},_0x5e74f3=async()=>{const _0x5e828b=_0x2d744f;let _0xd8a7bd='';_0x11fa4a[_0x5e828b(0x1d2)]((_0x10606f,_0xf93a1b)=>{const _0x89dd78=_0x5e828b;_0xd8a7bd+='*[\x20'+_0x10606f[_0x89dd78(0x246)]+_0x89dd78(0x177)+_0x10606f[_0x89dd78(0x280)]+'\x0a';}),_0xd8a7bd+=_0x5e828b(0x1d8),_0xd8a7bd+='\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial';const _0x52263f={'text':(0x0,Mustache_1[_0x5e828b(0x1c8)])('‎'+_0x2c7dd7[_0x5e828b(0x112)]+'\x0a\x0a'+_0xd8a7bd,_0x139894)};if(process[_0x5e828b(0x17b)]['CHATBOT_RESTRICT_NUMBER']?.[_0x5e828b(0x14f)]>=0x8){if(_0x139894[_0x5e828b(0x28c)][_0x5e828b(0x2bd)]!=process[_0x5e828b(0x17b)]['CHATBOT_RESTRICT_NUMBER']){console[_0x5e828b(0x2c9)]('chatbot\x20desativado!');return;}}if(!_0x2c7dd7['mediaPath']){const _0x1d7234=await _0x2fa7b0[_0x5e828b(0x1d3)](_0x139894[_0x5e828b(0x28c)][_0x5e828b(0x2bd)]+'@'+(_0x139894['isGroup']?_0x5e828b(0x21e):_0x5e828b(0x22d)),_0x52263f);await(0x0,exports[_0x5e828b(0x2aa)])(_0x1d7234,_0x139894,_0x139894['contact']);}else{const _0x2ae45d=path_1[_0x5e828b(0x1c8)][_0x5e828b(0x202)](_0x5e828b(0x263),_0x5e828b(0x13f)+_0x139894[_0x5e828b(0x19f)],_0x2c7dd7['mediaPath']),_0x4d02b7=await(0x0,SendWhatsAppMedia_1[_0x5e828b(0x26d)])(_0x2c7dd7[_0x5e828b(0x1ec)],_0x2ae45d,_0x52263f[_0x5e828b(0x2b7)],_0x139894[_0x5e828b(0x19f)]);let _0x71dad8=await _0x2fa7b0[_0x5e828b(0x1d3)](_0x139894[_0x5e828b(0x28c)]['number']+'@'+(_0x139894[_0x5e828b(0x1a0)]?_0x5e828b(0x21e):_0x5e828b(0x22d)),{..._0x4d02b7});await verifyMediaMessage(_0x71dad8,_0x139894,_0x139894[_0x5e828b(0x28c)]);}};if(_0x554740[_0x2d744f(0x238)]===_0x2d744f(0x17a))return _0x57741c();if(_0x554740['value']===_0x2d744f(0x214)&&QueueOption_1[_0x2d744f(0x1c8)][_0x2d744f(0x14f)]<=0x4)return _0x1e20a3();if(_0x554740[_0x2d744f(0x238)]===_0x2d744f(0x2b7))return console[_0x2d744f(0x2c9)](_0x2d744f(0x188)),_0x5e74f3();if(_0x554740[_0x2d744f(0x238)]===_0x2d744f(0x214)&&QueueOption_1[_0x2d744f(0x1c8)][_0x2d744f(0x14f)]>0x4)return console[_0x2d744f(0x2c9)]('botText\x202'),_0x5e74f3();}}}}},handleMessageIntegration=async(_0x4c8556,_0x57ab63,_0x36da26,_0x59f5cf)=>{const _0x1411fa=a560_0x395b41;if(process[_0x1411fa(0x17b)][_0x1411fa(0x242)]){if(_0x59f5cf[_0x1411fa(0x28c)][_0x1411fa(0x2bd)]!=process[_0x1411fa(0x17b)][_0x1411fa(0x242)]){console[_0x1411fa(0x2c8)](_0x1411fa(0x2ad));return;}}const _0x5046e4=getTypeMessage(_0x4c8556);if(_0x36da26['type']===_0x1411fa(0x1a7)||_0x36da26[_0x1411fa(0x253)]===_0x1411fa(0x10c)){if(_0x36da26?.[_0x1411fa(0x2a5)]){const _0x67f8be={'method':_0x1411fa(0x21a),'url':_0x36da26?.[_0x1411fa(0x2a5)],'headers':{'Content-Type':_0x1411fa(0x16f)},'json':_0x4c8556};try{(0x0,request_1[_0x1411fa(0x1c8)])(_0x67f8be,function(_0x51e859,_0x3d52ab){if(_0x51e859)throw new Error(_0x51e859);else console['log'](_0x3d52ab['body']);});}catch(_0x297029){throw new Error(_0x297029);}}}else _0x36da26[_0x1411fa(0x253)]===_0x1411fa(0x1bc)&&await(0x0,typebotListener_1[_0x1411fa(0x1c8)])({'ticket':_0x59f5cf,'msg':_0x4c8556,'wbot':_0x57ab63,'typebot':_0x36da26});};exports[a560_0x395b41(0x12a)]=handleMessageIntegration;const messageContainsMedia=_0x2eeef3=>{const _0x472479=a560_0x395b41;return _0x2eeef3[_0x472479(0x112)]?.['imageMessage']||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x1b5)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x157)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x10a)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x1c3)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x198)]?.[_0x472479(0x112)]?.[_0x472479(0x1c3)]||_0x2eeef3[_0x472479(0x112)]?.['ephemeralMessage']?.[_0x472479(0x112)]?.[_0x472479(0x1b5)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x1eb)]?.[_0x472479(0x112)]?.[_0x472479(0x1c3)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x1eb)]?.['message']?.[_0x472479(0x157)]||_0x2eeef3[_0x472479(0x112)]?.['ephemeralMessage']?.[_0x472479(0x112)]?.[_0x472479(0x10a)]||_0x2eeef3[_0x472479(0x112)]?.['ephemeralMessage']?.[_0x472479(0x112)]?.[_0x472479(0x219)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x207)]?.['message']?.['imageMessage']||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x207)]?.['message']?.[_0x472479(0x157)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x1eb)]?.[_0x472479(0x112)]?.[_0x472479(0x207)]?.[_0x472479(0x112)]?.[_0x472479(0x219)]||_0x2eeef3['message']?.[_0x472479(0x1eb)]?.['message']?.['viewOnceMessage']?.['message']?.[_0x472479(0x157)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x1eb)]?.['message']?.[_0x472479(0x207)]?.['message']?.[_0x472479(0x1b5)]||_0x2eeef3['message']?.['ephemeralMessage']?.[_0x472479(0x112)]?.['viewOnceMessage']?.[_0x472479(0x112)]?.[_0x472479(0x1c3)]||_0x2eeef3['message']?.[_0x472479(0x198)]?.['message']?.['documentMessage']||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x23c)]?.['hydratedTemplate']?.['imageMessage']||_0x2eeef3[_0x472479(0x112)]?.['templateMessage']?.['hydratedTemplate']?.[_0x472479(0x1c3)]||_0x2eeef3['message']?.[_0x472479(0x23c)]?.[_0x472479(0x18d)]?.[_0x472479(0x157)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x23c)]?.[_0x472479(0x262)]?.[_0x472479(0x219)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x23c)]?.[_0x472479(0x262)]?.['documentMessage']||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x23c)]?.[_0x472479(0x262)]?.[_0x472479(0x157)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x23c)]?.[_0x472479(0x27d)]?.[_0x472479(0x219)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x23c)]?.[_0x472479(0x27d)]?.[_0x472479(0x1c3)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x23c)]?.[_0x472479(0x27d)]?.[_0x472479(0x157)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x216)]?.[_0x472479(0x166)]?.['imageMessage']||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x216)]?.['header']?.[_0x472479(0x1c3)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x216)]?.[_0x472479(0x166)]?.['videoMessage']||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x124)]?.[_0x472479(0x1cb)]?.[_0x472479(0x18d)]?.[_0x472479(0x1c3)]||_0x2eeef3[_0x472479(0x112)]?.[_0x472479(0x124)]?.[_0x472479(0x1cb)]?.[_0x472479(0x18d)]?.[_0x472479(0x157)]||_0x2eeef3[_0x472479(0x112)]?.['highlyStructuredMessage']?.[_0x472479(0x1cb)]?.[_0x472479(0x18d)]?.[_0x472479(0x219)]||_0x2eeef3['message']?.[_0x472479(0x124)]?.['hydratedHsm']?.[_0x472479(0x18d)]?.[_0x472479(0x274)];},handleMessage=async(_0x6f9291,_0x1bf71a,_0x126f7f,_0x414463=![])=>{const _0x515325=a560_0x395b41;if(_0x414463){console['log']('Importando\x20mensagens!!');let _0x36e707=_0x6f9291[_0x515325(0x1c9)]['id'],_0x34c13e=await Message_1['default']['count']({'where':{'id':_0x36e707}});if(_0x34c13e>0x0){await new Promise(_0x3135db=>setTimeout(_0x3135db,0x96));return;}else await new Promise(_0x1ff449=>setTimeout(_0x1ff449,0x14a));}let _0x5c6847;if(!(0x0,exports[_0x515325(0x17e)])(_0x6f9291)){console[_0x515325(0x2c8)](_0x515325(0x155)),console['log'](_0x6f9291);return;}_0x6f9291['message']?.[_0x515325(0x1eb)]&&(_0x6f9291[_0x515325(0x112)]=_0x6f9291[_0x515325(0x112)][_0x515325(0x1eb)][_0x515325(0x112)]);try{let _0x4f59d6;const _0x437adc=_0x6f9291['key'][_0x515325(0x218)]?.['endsWith'](_0x515325(0x1f0)),_0xb8442d=await Setting_1[_0x515325(0x1c8)][_0x515325(0x15d)]({'where':{'companyId':_0x126f7f,'key':'CheckMsgIsGroup'}});if(_0xb8442d?.[_0x515325(0x238)]==='enabled'&&_0x437adc){console[_0x515325(0x2c8)](_0x515325(0x1e4));return;}let _0x239822=(0x0,exports[_0x515325(0x2b3)])(_0x6f9291);const _0x5190ce=getTypeMessage(_0x6f9291);typeof _0x239822===_0x515325(0x2be)&&(_0x239822=_0x239822['replace'](/\u200c/,''));const _0xeb5966=messageContainsMedia(_0x6f9291);if(_0x6f9291['key'][_0x515325(0x16b)]){if(!_0xeb5966&&_0x5190ce!==_0x515325(0x2c7)&&_0x5190ce!==_0x515325(0x2a9)&&_0x5190ce!=='vcard'&&_0x5190ce!==_0x515325(0x1ea)&&_0x5190ce!=='ephemeralMessage'&&_0x5190ce!==_0x515325(0x275)&&_0x5190ce!==_0x515325(0x22a)&&_0x5190ce!=='viewOnceMessage'&&_0x5190ce!==_0x515325(0x274)&&_0x5190ce!==_0x515325(0x22f)&&_0x5190ce!==_0x515325(0x162)){console[_0x515325(0x2c9)](_0x5190ce);return;}}const _0x117e44=await(0x0,ShowWhatsAppService_1[_0x515325(0x1c8)])(_0x1bf71a['id'],_0x126f7f);let _0x422768,_0x2a680d=await getContactMessage(_0x6f9291,_0x1bf71a);_0x4f59d6=await verifyContact(_0x2a680d,_0x1bf71a,_0x126f7f);if(_0x437adc){if(!_0x117e44[_0x515325(0x1ce)])return;try{const _0x40e51d=await _0x1bf71a[_0x515325(0x29b)](_0x6f9291[_0x515325(0x1c9)][_0x515325(0x218)]),_0x2e2eff={'id':_0x40e51d['id'],'name':_0x40e51d[_0x515325(0x252)]};_0x422768=await verifyContact(_0x2e2eff,_0x1bf71a,_0x126f7f);}catch(_0x5d7b58){console[_0x515325(0x2c8)](_0x515325(0x22c)),console[_0x515325(0x2c8)](_0x5d7b58);return;}}let _0x4bac69=0x0;if(_0x6f9291['key'][_0x515325(0x16b)])await cache_1['cacheLayer'][_0x515325(0x24c)](_0x515325(0x25e)+_0x4f59d6['id']+_0x515325(0x20f),'0');else{const _0x2bc245=await cache_1[_0x515325(0x294)]['get']('contacts:'+_0x4f59d6['id']+':unreads');_0x4bac69=+_0x2bc245+0x1,await cache_1[_0x515325(0x294)][_0x515325(0x24c)](_0x515325(0x25e)+_0x4f59d6['id']+_0x515325(0x20f),''+_0x4bac69);}const _0x41aad9=await(0x0,FindOrCreateTicketService_1[_0x515325(0x1c8)])(_0x4f59d6,_0x1bf71a['id'],_0x4bac69,_0x126f7f,_0x422768,_0x414463),_0x243867=await(0x0,FindOrCreateATicketTrakingService_1[_0x515325(0x1c8)])({'ticketId':_0x41aad9['id'],'companyId':_0x126f7f,'whatsappId':_0x117e44?.['id']});_0x243867[_0x515325(0x18b)](_0x515325(0x11f),!![]),await _0x243867[_0x515325(0x187)]({'updatedAt':new Date()}),await(0x0,providers_1['provider'])(_0x41aad9,_0x6f9291,_0x126f7f,_0x4f59d6,_0x1bf71a);if(_0x117e44[_0x515325(0x174)]&&_0x4bac69===0x0){const _0x3c7bef=await Message_1[_0x515325(0x1c8)][_0x515325(0x15d)]({'where':{'contactId':_0x4f59d6['id'],'companyId':_0x126f7f},'order':[[_0x515325(0x279),_0x515325(0x224)]]});if((0x0,Mustache_1[_0x515325(0x1c8)])(_0x117e44[_0x515325(0x174)],_0x41aad9)[_0x515325(0x17f)]()['toLowerCase']()===_0x3c7bef?.['body'][_0x515325(0x17f)]()[_0x515325(0x111)]())return;}if(_0x239822=='#'&&!_0x414463&&(!_0x41aad9[_0x515325(0x244)]||_0x41aad9['status']==_0x515325(0x20e))){await _0x41aad9[_0x515325(0x187)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x1bf71a,_0x6f9291,_0x41aad9,_0x41aad9[_0x515325(0x28c)]);return;}try{if(!_0x6f9291['key'][_0x515325(0x16b)]&&!_0x414463){if(_0x239822!=null&&typeof _0x239822!=='string'){console[_0x515325(0x2c8)](_0x239822),console['trace'](_0x515325(0x28e),typeof _0x239822);return;}if(_0x239822?.['toUpperCase']()==='SAIR'&&_0x41aad9[_0x515325(0x203)]!='closed'){await(0x0,SendPresenceStatus_1[_0x515325(0x144)])(_0x1bf71a,_0x41aad9[_0x515325(0x28c)][_0x515325(0x2bd)]+'@'+(_0x41aad9[_0x515325(0x1a0)]?_0x515325(0x21e):_0x515325(0x22d)));const _0x3207b4=await _0x1bf71a[_0x515325(0x1d3)](_0x41aad9[_0x515325(0x28c)]['number']+'@'+(_0x41aad9[_0x515325(0x1a0)]?_0x515325(0x21e):_0x515325(0x22d)),{'text':_0x515325(0x1b2)});await(0x0,exports[_0x515325(0x2aa)])(_0x3207b4,_0x41aad9,_0x41aad9[_0x515325(0x28c)]),await(0x0,UpdateTicketService_1[_0x515325(0x1c8)])({'ticketData':{'queueId':null,'status':_0x515325(0x26a)},'ticketId':_0x41aad9['id'],'companyId':_0x41aad9[_0x515325(0x19f)]}),await _0x41aad9['reload']();return;}}}catch(_0x34a605){console['log'](_0x515325(0x146)),console[_0x515325(0x2c8)](_0x34a605),Sentry[_0x515325(0x20c)](_0x34a605);}try{await _0x41aad9['update']({'fromMe':_0x6f9291[_0x515325(0x1c9)][_0x515325(0x16b)]});}catch(_0x4e0d30){console['log'](_0x515325(0x10f)),console[_0x515325(0x2c8)](_0x4e0d30),Sentry[_0x515325(0x20c)](_0x4e0d30);}try{if(!_0x6f9291[_0x515325(0x1c9)]['fromMe']){if((0x0,exports['verifyRating'])(_0x243867)){await(0x0,exports[_0x515325(0x2c1)])(_0x6f9291,_0x41aad9,_0x243867),console[_0x515325(0x2c8)](_0x515325(0x163)+_0x6f9291);return;}}}catch(_0x3dbeef){console[_0x515325(0x2c8)](_0x515325(0x176)),Sentry[_0x515325(0x20c)](_0x3dbeef),console['log'](_0x3dbeef);}_0xeb5966?_0x5c6847=await verifyMediaMessage(_0x6f9291,_0x41aad9,_0x4f59d6):await(0x0,exports['verifyMessage'])(_0x6f9291,_0x41aad9,_0x4f59d6);const _0x18374a=await(0x0,VerifyCurrentSchedule_1[_0x515325(0x1c8)])(_0x126f7f),_0x40bc32=await Setting_1[_0x515325(0x1c8)][_0x515325(0x15d)]({'where':{'companyId':_0x126f7f,'key':_0x515325(0x1c2)}});if(!_0x6f9291['key'][_0x515325(0x16b)]&&_0x40bc32&&!_0x414463)await handleOutOfHour(_0x1bf71a,_0x41aad9,_0x40bc32,_0x4f59d6,_0x18374a,_0x117e44);!_0x41aad9[_0x515325(0x16c)]&&!_0x437adc&&!_0x6f9291['key'][_0x515325(0x16b)]&&!_0x41aad9[_0x515325(0x244)]&&!(0x0,lodash_1[_0x515325(0x23d)])(_0x117e44[_0x515325(0x2ba)])&&!_0x414463&&await handleOpenAi(_0x6f9291,_0x1bf71a,_0x41aad9,_0x4f59d6,_0x5c6847);if(!_0x6f9291[_0x515325(0x1c9)][_0x515325(0x16b)]&&!_0x41aad9[_0x515325(0x1a0)]&&!_0x41aad9[_0x515325(0x16c)]&&!_0x41aad9[_0x515325(0x116)]&&_0x41aad9[_0x515325(0x23a)]&&!(0x0,lodash_1['isNil'])(_0x117e44[_0x515325(0x228)])&&!_0x41aad9['useIntegration']&&!_0x414463){const _0x26eba2=await(0x0,ShowQueueIntegrationService_1['default'])(_0x117e44[_0x515325(0x228)],_0x126f7f);await(0x0,exports[_0x515325(0x12a)])(_0x6f9291,_0x1bf71a,_0x26eba2,_0x41aad9);return;}!_0x437adc&&!_0x6f9291[_0x515325(0x1c9)][_0x515325(0x16b)]&&!_0x41aad9[_0x515325(0x244)]&&!(0x0,lodash_1['isNil'])(_0x41aad9[_0x515325(0x2ba)])&&_0x41aad9[_0x515325(0x239)]&&!_0x414463&&await handleOpenAi(_0x6f9291,_0x1bf71a,_0x41aad9,_0x4f59d6,_0x5c6847);if(!_0x6f9291[_0x515325(0x1c9)][_0x515325(0x16b)]&&!_0x41aad9[_0x515325(0x1a0)]&&!_0x41aad9[_0x515325(0x244)]&&_0x41aad9['integrationId']&&_0x41aad9[_0x515325(0x239)]&&!_0x414463){const _0x3091cd=await(0x0,ShowQueueIntegrationService_1[_0x515325(0x1c8)])(_0x41aad9['integrationId'],_0x126f7f);await(0x0,exports['handleMessageIntegration'])(_0x6f9291,_0x1bf71a,_0x3091cd,_0x41aad9);}!_0x41aad9[_0x515325(0x16c)]&&!_0x41aad9[_0x515325(0x1a0)]&&!_0x6f9291['key'][_0x515325(0x16b)]&&!_0x41aad9[_0x515325(0x244)]&&_0x117e44['queues'][_0x515325(0x14f)]>=0x1&&!_0x41aad9[_0x515325(0x239)]&&!_0x414463&&(await verifyQueue(_0x1bf71a,_0x6f9291,_0x41aad9,_0x4f59d6),_0x243867['changed'](_0x515325(0x19a),!![]),_0x243867['changed'](_0x515325(0x11f),!![]),await _0x243867[_0x515325(0x187)]({'chatbotAt':(0x0,moment_1[_0x515325(0x1c8)])()['toDate'](),'updatedAt':new Date()}));const _0x429ea9=_0x41aad9[_0x515325(0x16c)]===null;await _0x41aad9[_0x515325(0x11e)]();if(!_0x414463&&_0x117e44[_0x515325(0x2a0)])await greetingMessage(_0x1bf71a,_0x41aad9,_0x6f9291,_0x117e44,_0x437adc);_0x117e44[_0x515325(0x1bb)]['length']==0x1&&_0x41aad9['queue']&&!_0x414463&&(_0x41aad9[_0x515325(0x23a)]&&!_0x6f9291['key']['fromMe']&&!_0x41aad9['userId']&&await handleChartbot(_0x41aad9,_0x6f9291,_0x1bf71a,_0x117e44)),_0x117e44[_0x515325(0x1bb)][_0x515325(0x14f)]>0x1&&_0x41aad9[_0x515325(0x16c)]&&!_0x414463&&(_0x41aad9[_0x515325(0x23a)]&&!_0x6f9291[_0x515325(0x1c9)][_0x515325(0x16b)]&&!_0x41aad9[_0x515325(0x244)]&&await handleChartbot(_0x41aad9,_0x6f9291,_0x1bf71a,_0x117e44,_0x429ea9));}catch(_0x289d5f){console[_0x515325(0x2c8)](_0x289d5f),Sentry[_0x515325(0x20c)](_0x289d5f),logger_1['logger'][_0x515325(0x131)](_0x515325(0x138)+_0x289d5f);}};exports[a560_0x395b41(0x29e)]=handleMessage;const handleOutOfHour=async(_0x44a49a,_0x263cfb,_0x40c57d,_0x32d3d1,_0x4c7fba,_0x50e8c9)=>{const _0x5bcd99=a560_0x395b41;try{if(outOfHourMessageControl['length']>0x1388)outOfHourMessageControl=[];let _0x10bb40=outOfHourMessageControl[_0x5bcd99(0x13b)](_0x36f182=>_0x36f182[_0x5bcd99(0x19c)]===_0x263cfb['id']||_0x36f182['dest']===_0x32d3d1[_0x5bcd99(0x2bd)]);if(_0x40c57d[_0x5bcd99(0x238)]==='company'&&!(0x0,lodash_1[_0x5bcd99(0x23d)])(_0x4c7fba)&&_0x50e8c9['outOfHoursMessage']&&(!_0x4c7fba||_0x4c7fba[_0x5bcd99(0x291)]===![])){if(!_0x10bb40||_0x10bb40&&_0x10bb40[_0x5bcd99(0x128)]+0x3e8*0x3c*0x5<new Date()[_0x5bcd99(0x15e)]()){_0x10bb40&&(outOfHourMessageControl=outOfHourMessageControl[_0x5bcd99(0x14d)](_0xbb8f81=>_0xbb8f81[_0x5bcd99(0x19c)]!==_0x263cfb['id']),_0x10bb40=null);if(!_0x10bb40)outOfHourMessageControl['push']({'ticketId':_0x263cfb['id'],'dest':_0x32d3d1[_0x5bcd99(0x2bd)],'time':new Date()[_0x5bcd99(0x15e)]()});const _0x4c3c73='‎\x20'+_0x50e8c9[_0x5bcd99(0x2c3)],_0x14cb45=(0x0,Debounce_1[_0x5bcd99(0x26b)])(async()=>{const _0x45bfd4=_0x5bcd99;await _0x44a49a['sendMessage'](_0x263cfb[_0x45bfd4(0x28c)]['number']+'@'+(_0x263cfb[_0x45bfd4(0x1a0)]?_0x45bfd4(0x21e):_0x45bfd4(0x22d)),{'text':_0x4c3c73});},(0x0,queues_1[_0x5bcd99(0x237)])(0x5dc,0xdac),_0x263cfb['id']);_0x14cb45();return;}}if(_0x40c57d[_0x5bcd99(0x238)]==='queue'&&_0x263cfb[_0x5bcd99(0x17d)]!==null){const _0x383681=await Queue_1['default']['findByPk'](_0x263cfb[_0x5bcd99(0x17d)]),{schedules:_0x2716fc}=_0x383681,_0x3136d6=(0x0,moment_1[_0x5bcd99(0x1c8)])(),_0x11112e=_0x3136d6[_0x5bcd99(0x20a)](_0x5bcd99(0x29d))[_0x5bcd99(0x111)]();let _0xa97f7f=null;Array[_0x5bcd99(0x14b)](_0x2716fc)&&_0x2716fc['length']>0x0&&(_0xa97f7f=_0x2716fc[_0x5bcd99(0x13b)](_0x365f16=>_0x365f16[_0x5bcd99(0x250)]===_0x11112e&&_0x365f16['startTime']!==''&&_0x365f16[_0x5bcd99(0x1a2)]!==null&&_0x365f16[_0x5bcd99(0x2ae)]!==''&&_0x365f16['endTime']!==null));if(_0x40c57d[_0x5bcd99(0x238)]==='queue'&&_0x383681[_0x5bcd99(0x2c3)]!==null&&_0x383681[_0x5bcd99(0x2c3)]!==''&&!(0x0,lodash_1[_0x5bcd99(0x23d)])(_0xa97f7f)){const _0xae347c=(0x0,moment_1[_0x5bcd99(0x1c8)])(_0xa97f7f[_0x5bcd99(0x1a2)],_0x5bcd99(0x139)),_0x500209=(0x0,moment_1[_0x5bcd99(0x1c8)])(_0xa97f7f[_0x5bcd99(0x2ae)],_0x5bcd99(0x139));let _0x2961be=_0x3136d6[_0x5bcd99(0x18f)](_0xae347c)||_0x3136d6[_0x5bcd99(0x12f)](_0x500209);if(!_0x2961be){if(_0xa97f7f['startLunchTime']&&_0xa97f7f[_0x5bcd99(0x29f)]){const _0x48c3d3=(0x0,moment_1[_0x5bcd99(0x1c8)])(_0xa97f7f[_0x5bcd99(0x117)],_0x5bcd99(0x139)),_0x287d19=(0x0,moment_1[_0x5bcd99(0x1c8)])(_0xa97f7f[_0x5bcd99(0x29f)],'HH:mm');_0x2961be=_0x3136d6['isBetween'](_0x48c3d3,_0x287d19);}}if(_0x2961be){if(!_0x10bb40||_0x10bb40&&_0x10bb40[_0x5bcd99(0x128)]+0x3e8*0x3c*0x1e<new Date()[_0x5bcd99(0x15e)]()){const _0x459c0b=_0x383681[_0x5bcd99(0x2c3)],_0x1ca6e3=(0x0,Debounce_1[_0x5bcd99(0x26b)])(async()=>{const _0x57a970=_0x5bcd99;await _0x44a49a['sendMessage'](_0x263cfb['contact']['number']+'@'+(_0x263cfb[_0x57a970(0x1a0)]?_0x57a970(0x21e):_0x57a970(0x22d)),{'text':_0x459c0b});},(0x0,queues_1[_0x5bcd99(0x237)])(0x3e8,0xbb8),_0x263cfb['id']);_0x1ca6e3();return;}if(!_0x10bb40)outOfHourMessageControl['push']({'ticketId':_0x263cfb['id'],'dest':_0x32d3d1[_0x5bcd99(0x2bd)],'time':new Date()['getTime']()});}}}}catch(_0x41c04d){Sentry[_0x5bcd99(0x20c)](_0x41c04d),console[_0x5bcd99(0x2c8)](_0x41c04d);}},greetingMessage=async(_0x291e67,_0x33fc67,_0x34e286,_0x1f53a8,_0x89f120)=>{const _0x53be83=a560_0x395b41;if(!_0x1f53a8?.[_0x53be83(0x1bb)]?.[_0x53be83(0x14f)]&&!_0x33fc67[_0x53be83(0x244)]&&!_0x89f120&&!_0x34e286[_0x53be83(0x1c9)][_0x53be83(0x16b)]){if(process[_0x53be83(0x17b)][_0x53be83(0x242)]?.[_0x53be83(0x14f)]>=0x8){if(_0x33fc67[_0x53be83(0x28c)][_0x53be83(0x2bd)]!=process['env']['CHATBOT_RESTRICT_NUMBER'])return;}if(greetingMessageControl['length']>0x1388)greetingMessageControl=[];var _0x5db516=greetingMessageControl['find'](_0x159df3=>_0x159df3[_0x53be83(0x19c)]===_0x33fc67['id']||_0x159df3[_0x53be83(0x160)]===_0x33fc67[_0x53be83(0x28c)]['number']);if(_0x5db516&&_0x5db516[_0x53be83(0x128)]+0x3e8*0x3c*0x5>=new Date()[_0x53be83(0x15e)]())return;const _0xf1314e=await Message_1[_0x53be83(0x1c8)][_0x53be83(0x15d)]({'where':{'ticketId':_0x33fc67['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x53be83(0x283)]]:(0x0,moment_1[_0x53be83(0x1c8)])()[_0x53be83(0x22e)](0x5,_0x53be83(0x2b4))['toDate']()}}});if(_0xf1314e)return;const _0x176ea2=(0x0,Debounce_1[_0x53be83(0x26b)])(async()=>{const _0x2a5735=_0x53be83;if(!_0x1f53a8[_0x2a5735(0x23f)])await _0x291e67[_0x2a5735(0x1d3)](_0x33fc67[_0x2a5735(0x28c)][_0x2a5735(0x2bd)]+'@'+(_0x33fc67['isGroup']?_0x2a5735(0x21e):_0x2a5735(0x22d)),{'text':(0x0,Mustache_1[_0x2a5735(0x1c8)])(_0x1f53a8[_0x2a5735(0x2a0)],_0x33fc67)});else{const _0x5352f7=path_1[_0x2a5735(0x1c8)][_0x2a5735(0x202)](_0x2a5735(0x263),_0x2a5735(0x13f)+_0x33fc67[_0x2a5735(0x19f)],_0x1f53a8[_0x2a5735(0x23f)]),_0x261853=await(0x0,SendWhatsAppMedia_1[_0x2a5735(0x26d)])(_0x1f53a8['greetingMediaAttachment'],_0x5352f7,_0x1f53a8[_0x2a5735(0x2a0)],_0x33fc67[_0x2a5735(0x19f)]);await _0x291e67['sendMessage'](_0x33fc67[_0x2a5735(0x28c)]['number']+'@'+(_0x33fc67['isGroup']?_0x2a5735(0x21e):'s.whatsapp.net'),{..._0x261853});}},0x3e8,_0x33fc67['id']);_0x176ea2();return;}},handleMsgAck=async(_0x1874ba,_0x458522)=>{const _0x3a149c=a560_0x395b41,_0x4f1a48=(0x0,socket_1[_0x3a149c(0x1b6)])();try{const _0x4703b9=await Message_1[_0x3a149c(0x1c8)]['findByPk'](_0x1874ba[_0x3a149c(0x1c9)]['id'],{'include':['contact',{'model':Message_1[_0x3a149c(0x1c8)],'as':_0x3a149c(0x24b),'include':[_0x3a149c(0x28c)]}]});if(!_0x4703b9){console[_0x3a149c(0x2c8)](_0x1874ba),console[_0x3a149c(0x2c8)](_0x3a149c(0x167));return;}await _0x4703b9['update']({'ack':_0x458522}),_0x4f1a48['to'](_0x4703b9[_0x3a149c(0x19c)][_0x3a149c(0x11d)]())[_0x3a149c(0x1c7)](_0x3a149c(0x258)+_0x4703b9[_0x3a149c(0x19f)]+_0x3a149c(0x277),{'action':_0x3a149c(0x187),'message':_0x4703b9});}catch(_0x46a7d2){Sentry[_0x3a149c(0x20c)](_0x46a7d2),logger_1[_0x3a149c(0x1cd)][_0x3a149c(0x131)](_0x3a149c(0x1da)+_0x46a7d2);}};function a560_0x14d9(){const _0xf271bb=['verifyMessage','apply','handleMsgAck','chatbot\x20desativado!','endTime','../MessageServices/CreateMessageService','unlinkSync','../../models/Campaign','sleep','getBodyMessage','minutes','199112SPebKu','../../models/Queue','text','WebMessageInfo','getButtonsMessage','promptId','Failed\x20to\x20fetch\x20queues:','maxMessages','number','string','../TicketServices/FindOrCreateATicketTrakingService','mp3','handleRating','>>>>\x20erro\x20','outOfHoursMessage','Enquete\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','selectedRowId','../../models/CampaignShipping','conversation','log','trace','AudioConfig','\x20|\x20https://maps.google.com/maps?q=','ERR_WAPP_DOWNLOAD_MEDIA','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','messageStubType','caption','quarto\x20if','getMinutes','createChatCompletion','ffmpeg-static','stickerMessage','texto','webhook','mediaType','(((.+)+)+)+$','Erro\x20ao\x20salvar\x20ticket!','Produto','toLowerCase','message','MessageUpdateJob','util','singleSelectReply','user','startLunchTime','catch','Throttle','audio/mpeg','Error\x20converting\x20file:\x20','jidNormalizedUser','toString','reload','updatedAt','gpt-3.5-turbo-1106','fromSubscription','save','prompt','highlyStructuredMessage','now','__createBinding','Message','time','substring','handleMessageIntegration','createTranscription','editedMessage','campaignId','getPaymentMessage','isAfter','OpenAIApi','error','delete','extension','../../models/User','sendGreetingMessageOneQueues','3yTQrrD','viewOnceMessageV2','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','HH:mm','verifyRating','find','getViewOnceMessageV2','data','\x20seconds\x20with\x20an\x20effective\x20speed\x20of\x20','company','product','Error\x20isValidMsg','body\x20is\x20not\x20a\x20string','filename','SendPresenceStatus','assistant','Erro\x20ao\x20salvar\x20mensagem!','../../models/Setting','getContactsArrayMessage','sendMessageImage','whisper-1','isArray','ASC','filter','\x201286\x20-\x20Entrei\x20na\x20integracao\x20openai.','length','./SendWhatsAppMessage','path','constructor','isNumeric','chat','Mensagem\x20inválida!','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','videoMessage','getImageMessage','../../helpers/SendPresenceStatus','unknown','templateButtonReplyMessage','senderKeyDistributionMessage','findOne','getTime','directPath','dest','selectedButtonId','advertising','Mensagem\x20inválida\x208!\x20','slice','proto','header','Mensagem\x20não\x20encontrada!','get','getWbot','SpeechSynthesizer','fromMe','queue','getQuotedMessage','buttonsResponseMessage','application/json','dataJson','charAt','mime','readFileSync','complationMessage','sequelize','Erro\x20ao\x20salvar\x20avaliação!','\x20]*\x20-\x20','Mensagem\x20interativa\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','../CompanyService/VerifyCurrentSchedule','list','env','@whiskeysockets/baileys','queueId','isValidMsg','trim','fileName','keys','system','Status','pollCreationMessageV2','360hnbsfy','queueOptionId','update','botText\x203','SERVER_ACK','messages.upsert','changed','choices','hydratedTemplate','parseToMilliseconds','isBefore','Mensagem\x20editada\x20não\x20encontrada:\x20','temperature','Error\x20getting\x20message\x20body:','name','search','validaCpfCnpj','../../app','ProtocolMessage','documentWithCaptionMessage','writeFile','chatbotAt','hasOwnProperty','ticketId','##\x20if','degreesLatitude','companyId','isGroup','makeRandomId','startTime','Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','getTemplateMessage','terceiro\x20if','pushName','n8n','../../helpers/Mustache','makeid','Amigo(a)','application','stream-throttle','microsoft-cognitiveservices-speech-sdk','../../libs/socket','MESSAGE_EDIT','next','messages','*Você\x20encerrou\x20este\x20atendimento\x20usando\x20o\x20comando\x20SAIR*.\x0a\x0a\x0aSe\x20você\x20finalizou\x20o\x20atendimento\x20*ANTES*\x20de\x20receber\x20um\x20retorno\x20do\x20operador,\x20ele\x20*NÃO*\x20irá\x20visualizar\x20sua\x20solicitação!\x0a\x0aVocê\x20deve\x20aguardar\x20o\x20retorno\x20do\x20operador\x20e\x20que\x20ele\x20encerre\x20seu\x20atendimento\x20quando\x20necessário.\x0a\x0aUse\x20a\x20opção\x20*SAIR*\x20somente\x20em\x20casos\x20de\x20emergência\x20ou\x20se\x20ficou\x20preso\x20em\x20algum\x20setor.\x0a\x0a\x0aPara\x20iniciar\x20um\x20novo\x20atendimento\x20basta\x20enviar\x20uma\x20nova\x20mensagem!','application/pdf','../../libs/cache','audioMessage','getIO','voiceKey','data:image/png;base64,\x20','voiceRegion','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','queues','typebot','externalAdReply','%2C','DELIVERY_ACK','findByPk','findAll','scheduleType','documentMessage','1005257uKjFxN','request','close','emit','default','key','participant','hydratedHsm','getViewOnceMessage','logger','allowGroup','pt-BR-FabioNeural','join','fromAudioFileOutput','forEach','sendMessage','./SendWhatsAppMedia','getListMessage','\x20-\x20Longitude:\x20','2305228toocSj','\x0a*[\x200\x20]*\x20-\x20Menu\x20anterior','-closed','Error\x20handling\x20message\x20ack.\x20Err:\x20','532AoAmRh','warn','__importDefault','add','No\x20contact\x20found\x20for\x20this\x20ticket.','toDate','parentId','debug','promisify','Mensagem\x20de\x20grupo\x20bloqueada!','setFfmpegPath','test','amountUsedBotQueues','fora\x20do\x20horario','from','contactMessage','ephemeralMessage','mediaName','stringify','\x0a\x0a*[\x20#\x20]*\x20-\x20Voltar\x20ao\x20Menu\x20Principal','REVOKE','@g.us','../TicketServices/UpdateTicketService','listResponseMessage','liveLocationMessage','mimetype','Error:\x20','values','getVideoMessage','wbotMessageListener','downloadContentFromMessage','Failed\x20to\x20fetch\x20contact\x20from\x20ticket:','messageContextInfo','\x20de\x20baixar\x20o\x20arquivo\x20','../../libs/wbot','toFixed','split','getBodyButton','3957096zybbBN','resolve','status','-open','body','\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial','viewOnceMessage','campaignQueue','productMessage','format','push','captureException','getOwnPropertyDescriptor','pending',':unreads','primeiro\x20if','verifyRecentCampaign','2SPOpOv','findIndex','button','&z=17&hl=pt-BR|','interactiveMessage','create','remoteJid','imageMessage','POST','Múltiplos\x20Produtos','defineProperty','min','g.us','finishedAt','then','whatsappId','DAUMZAP','../../models/QueueOption','DESC','createReadStream','../../models/Message','getCallMessage','integrationId','../../helpers/MakeRandomId','reactionMessage','listMessage','Erro\x20ao\x20buscar\x20grupo!','s.whatsapp.net','subtract','hydratedContentText','contactsArrayMessage','.wav','5631575jfAqDJ','@sentry/node','Nas\x20respostas\x20utilize\x20o\x20nome\x20','1357047qbgCGL','Mensagem\x20que\x20Desaparece','randomValue','value','useIntegration','chatbot','.mp3','templateMessage','isNil','quotedMessage','greetingMediaAttachment','botText','status@broadcast','CHATBOT_RESTRICT_NUMBER','degreesLongitude','userId','apiKey','option','removeNonPrintableChars','../ContactServices/CreateOrUpdateContactService','isInteger','disableBot','quotedMsg','set','configurable','\x20Download\x20completed\x20in\x20','openai','weekdayEn','lodash','subject','type','Type','\x20tokens\x20e\x20cuide\x20para\x20não\x20truncar\x20o\x20final.\x0aSempre\x20que\x20possível,\x20mencione\x20o\x20nome\x20dele\x20para\x20ser\x20mais\x20personalizado\x20o\x20atendimento\x20e\x20mais\x20educado.\x20Quando\x20a\x20resposta\x20requer\x20uma\x20transferência\x20para\x20o\x20setor\x20de\x20atendimento,\x20comece\x20sua\x20resposta\x20com\x20\x27Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento\x27.\x0a\x0a\x20\x20','maxUseBotQueues','Erro\x20ao\x20deletar\x20o\x20arquivo:','company-','CIPHERTEXT','../../utils/logger','isNaN','segundo\x20if','No\x20result\x20from\x20synthesizer','contacts:','10jZJedO','Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','hydratedFourRowTemplate','public','./providers','options','maxTokens','contextInfo','mkdirSync','pollCreationMessageV3','closed','debounce','mediaPath','getMessageOptions','__esModule','selectedId','contacts','../../models/Ticket','fluent-ffmpeg','1179470CLGAak','locationMessage','protocolMessage','getAudioMessage','-appMessage','getQuotedMessageId','createdAt','SpeechConfig','getLocationMessage','Erro\x20para\x20responder\x20com\x20audio:\x20','fourRowTemplate','concat','PENDING','title','keywords','-ticket','gte','moment','ack','setExtra','url','productImage','../QueueIntegrationServices/ShowQueueIntegrationService','existsSync','sendMessageLink','contact','getTextMessage','Expected\x20bodyMessage\x20to\x20be\x20a\x20string,\x20got:','Convite\x20Revogado','media','inActivity','DispatchCampaign','Menu\x20inicial\x20*[\x200\x20]*\x20Menu\x20anterior','cacheLayer','content','ratingAt','count','WAMessageStubType','image/jpeg','replace','groupMetadata','__setModuleDefault','dddd','handleMessage','endLunchTime','greetingMessage','E2E_IDENTITY_CHANGED','chatBotType','includes','chmodSync','urlN8N','voice','floor','verifyQuotedMessage','extendedTextMessage'];a560_0x14d9=function(){return _0xf271bb;};return a560_0x14d9();}exports[a560_0x395b41(0x2ac)]=handleMsgAck;const verifyRecentCampaign=async(_0x5c31de,_0x1c6ba6)=>{const _0x47e5d9=a560_0x395b41;if(!_0x5c31de[_0x47e5d9(0x1c9)][_0x47e5d9(0x16b)]){const _0x17801b=_0x5c31de[_0x47e5d9(0x1c9)][_0x47e5d9(0x218)][_0x47e5d9(0x29a)](/\D/g,''),_0x7e4803=await Campaign_1[_0x47e5d9(0x1c8)][_0x47e5d9(0x1c1)]({'where':{'companyId':_0x1c6ba6,'status':'EM_ANDAMENTO','confirmation':!![]}});if(_0x7e4803){const _0xd0f38d=_0x7e4803['map'](_0x216af1=>_0x216af1['id']),_0x15ba55=await CampaignShipping_1[_0x47e5d9(0x1c8)]['findOne']({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0xd0f38d},'number':_0x17801b,'confirmation':null}});_0x15ba55&&(await _0x15ba55['update']({'confirmedAt':(0x0,moment_1['default'])(),'confirmation':!![]}),await queues_1[_0x47e5d9(0x208)][_0x47e5d9(0x1de)](_0x47e5d9(0x292),{'campaignShippingId':_0x15ba55['id'],'campaignId':_0x15ba55[_0x47e5d9(0x12d)]},{'delay':(0x0,queues_1[_0x47e5d9(0x18e)])((0x0,queues_1['randomValue'])(0x0,0xa))}));}}};exports[a560_0x395b41(0x211)]=verifyRecentCampaign;const verifyCampaignMessageAndCloseTicket=async(_0x4824a1,_0x317dee)=>{const _0x193d5c=a560_0x395b41,_0xd9a55a=(0x0,socket_1[_0x193d5c(0x1b6)])(),_0x33a860=(0x0,exports['getBodyMessage'])(_0x4824a1),_0x2d0f42=/\u200c/[_0x193d5c(0x1e6)](_0x33a860);if(_0x4824a1[_0x193d5c(0x1c9)]['fromMe']&&_0x2d0f42){const _0x19f6de=await Message_1[_0x193d5c(0x1c8)][_0x193d5c(0x15d)]({'where':{'id':_0x4824a1[_0x193d5c(0x1c9)]['id'],'companyId':_0x317dee}}),_0x133c0b=await Ticket_1[_0x193d5c(0x1c8)][_0x193d5c(0x1c0)](_0x19f6de[_0x193d5c(0x19c)]);await _0x133c0b[_0x193d5c(0x187)]({'status':_0x193d5c(0x26a)}),_0xd9a55a['to'](_0x193d5c(0x258)+_0x133c0b[_0x193d5c(0x19f)]+_0x193d5c(0x204))[_0x193d5c(0x1c7)](_0x193d5c(0x258)+_0x133c0b[_0x193d5c(0x19f)]+'-ticket',{'action':_0x193d5c(0x132),'ticket':_0x133c0b,'ticketId':_0x133c0b['id']}),_0xd9a55a['to'](_0x193d5c(0x258)+_0x317dee+'-'+_0x133c0b[_0x193d5c(0x203)])['to'](_0x133c0b['id'][_0x193d5c(0x11d)]())[_0x193d5c(0x1c7)](_0x193d5c(0x258)+_0x133c0b['companyId']+_0x193d5c(0x282),{'action':_0x193d5c(0x187),'ticket':_0x133c0b,'ticketId':_0x133c0b['id']});}};exports['verifyCampaignMessageAndCloseTicket']=verifyCampaignMessageAndCloseTicket;const filterMessages=_0x5adf60=>{const _0x33b1f0=a560_0x395b41;if([baileys_1['WAMessageStubType'][_0x33b1f0(0x1ef)],baileys_1[_0x33b1f0(0x298)]['E2E_DEVICE_CHANGED'],baileys_1['WAMessageStubType'][_0x33b1f0(0x2a1)],baileys_1[_0x33b1f0(0x298)][_0x33b1f0(0x259)]][_0x33b1f0(0x2a3)](_0x5adf60[_0x33b1f0(0x104)]))return![];return!![];},wbotMessageListener=async(_0x59ea12,_0x5947d2,_0x49da80)=>{const _0x3f7f66=a560_0x395b41;_0x59ea12['ev']['on'](_0x3f7f66(0x18a),async _0x3dbbb3=>{const _0x4f5f91=_0x3f7f66,_0x4789c4=_0x3dbbb3[_0x4f5f91(0x1b1)]['filter'](filterMessages);if(!_0x4789c4)return;await app_1['default'][_0x4f5f91(0x168)](_0x4f5f91(0x1bb))['messageQueue'][_0x4f5f91(0x1de)]('HandleMessageJob',{'whatsappId':_0x49da80['id'],'messages':_0x4789c4,'companyId':_0x5947d2},{'removeOnComplete':!![],'attempts':0x3});}),_0x59ea12['ev']['on']('messages.update',async _0x15f78b=>{const _0x1f4b0d=_0x3f7f66;if(_0x15f78b[_0x1f4b0d(0x14f)]===0x0)return;await app_1[_0x1f4b0d(0x1c8)][_0x1f4b0d(0x168)](_0x1f4b0d(0x1bb))['messageQueue']['add'](_0x1f4b0d(0x113),{'whatsappId':_0x49da80['id'],'messageUpdate':_0x15f78b,'companyId':_0x5947d2},{'removeOnComplete':!![],'attempts':0x3,'delay':0x64});}),_0x59ea12['ev']['on']('groups.update',async _0x4e5d15=>{const _0x257967=_0x3f7f66;console[_0x257967(0x2c8)](_0x4e5d15);if(_0x4e5d15[_0x257967(0x14f)]===0x0)return;for(const _0x4b3435 of _0x4e5d15){const _0x3b6570=_0x4b3435['id']['split']('@')[0x0],_0x1da271=_0x4b3435['subject']||_0x3b6570,_0x2245b9={'name':_0x1da271,'number':_0x3b6570,'isGroup':!![],'companyId':_0x5947d2,'remoteJid':_0x4b3435['id'],'whatsappId':_0x59ea12['id']};await(0x0,CreateOrUpdateContactService_1[_0x257967(0x1c8)])(_0x2245b9,_0x59ea12,_0x4b3435['id']);}});};exports['wbotMessageListener']=wbotMessageListener;