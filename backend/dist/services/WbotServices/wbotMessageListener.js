const a560_0x4c9181=a560_0x48b7;(function(_0x1a8030,_0x2be413){const _0x3a7554=a560_0x48b7,_0x3613ca=_0x1a8030();while(!![]){try{const _0x61fee4=parseInt(_0x3a7554(0x247))/0x1+-parseInt(_0x3a7554(0x160))/0x2*(-parseInt(_0x3a7554(0x241))/0x3)+-parseInt(_0x3a7554(0x1e9))/0x4*(parseInt(_0x3a7554(0x1c0))/0x5)+-parseInt(_0x3a7554(0x119))/0x6*(parseInt(_0x3a7554(0x116))/0x7)+-parseInt(_0x3a7554(0x173))/0x8*(-parseInt(_0x3a7554(0x23b))/0x9)+-parseInt(_0x3a7554(0x16f))/0xa*(-parseInt(_0x3a7554(0x171))/0xb)+parseInt(_0x3a7554(0x228))/0xc;if(_0x61fee4===_0x2be413)break;else _0x3613ca['push'](_0x3613ca['shift']());}catch(_0x114c13){_0x3613ca['push'](_0x3613ca['shift']());}}}(a560_0x40dd,0xafe58));const a560_0x31e202=(function(){let _0x1df5cd=!![];return function(_0x526622,_0x22d978){const _0x1ba161=_0x1df5cd?function(){const _0x44c6ed=a560_0x48b7;if(_0x22d978){const _0x1a51ba=_0x22d978[_0x44c6ed(0x127)](_0x526622,arguments);return _0x22d978=null,_0x1a51ba;}}:function(){};return _0x1df5cd=![],_0x1ba161;};}()),a560_0x398107=a560_0x31e202(this,function(){const _0x19d31e=a560_0x48b7;return a560_0x398107[_0x19d31e(0x2ac)]()[_0x19d31e(0x200)](_0x19d31e(0x1a2))['toString']()['constructor'](a560_0x398107)[_0x19d31e(0x200)](_0x19d31e(0x1a2));});a560_0x398107();'use strict';var __createBinding=this&&this[a560_0x4c9181(0x108)]||(Object['create']?function(_0x2912b9,_0x431155,_0x211efe,_0x353362){const _0x3c088c=a560_0x4c9181;if(_0x353362===undefined)_0x353362=_0x211efe;var _0x2bc8d5=Object[_0x3c088c(0x2c0)](_0x431155,_0x211efe);(!_0x2bc8d5||(_0x3c088c(0x254)in _0x2bc8d5?!_0x431155[_0x3c088c(0x12a)]:_0x2bc8d5[_0x3c088c(0x197)]||_0x2bc8d5[_0x3c088c(0x186)]))&&(_0x2bc8d5={'enumerable':!![],'get':function(){return _0x431155[_0x211efe];}}),Object['defineProperty'](_0x2912b9,_0x353362,_0x2bc8d5);}:function(_0x3f9ff4,_0x59bd18,_0x458189,_0x2fbf10){if(_0x2fbf10===undefined)_0x2fbf10=_0x458189;_0x3f9ff4[_0x2fbf10]=_0x59bd18[_0x458189];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a560_0x4c9181(0x18b)]?function(_0x5467a6,_0x1d912){const _0x4e4185=a560_0x4c9181;Object[_0x4e4185(0x111)](_0x5467a6,_0x4e4185(0x1a8),{'enumerable':!![],'value':_0x1d912});}:function(_0x271757,_0x253c78){const _0x3cf57e=a560_0x4c9181;_0x271757[_0x3cf57e(0x1a8)]=_0x253c78;}),__importStar=this&&this[a560_0x4c9181(0x271)]||function(_0x425b11){const _0xe7497d=a560_0x4c9181;if(_0x425b11&&_0x425b11[_0xe7497d(0x12a)])return _0x425b11;var _0x7e1bea={};if(_0x425b11!=null){for(var _0x372c06 in _0x425b11)if(_0x372c06!==_0xe7497d(0x1a8)&&Object['prototype']['hasOwnProperty']['call'](_0x425b11,_0x372c06))__createBinding(_0x7e1bea,_0x425b11,_0x372c06);}return __setModuleDefault(_0x7e1bea,_0x425b11),_0x7e1bea;},__importDefault=this&&this[a560_0x4c9181(0x14a)]||function(_0xfb587e){const _0x45ea77=a560_0x4c9181;return _0xfb587e&&_0xfb587e[_0x45ea77(0x12a)]?_0xfb587e:{'default':_0xfb587e};};function a560_0x40dd(){const _0x49165b=['185708diYNdu','groups.update','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','getTime','WebMessageInfo','verifyRecentCampaign','getMessageOptions','messageContextInfo','degreesLongitude','count','min','sendMessage','title','get','createTranscription','Mensagem\x20que\x20Desaparece','prompt','base64','apiKey','substring','endLunchTime','fromMe','greetingMediaAttachment','messageQueue','toUpperCase','readFileSync','keys','upsert','productMessage','ratingAt','listMessage','split','changed','greetingMessage','body','util','data','close','s.whatsapp.net','Atualização\x20de\x20Status','Message','conversation','__importStar','../../models/User','toFixed','queue','stream-throttle','chmodSync','microsoft-cognitiveservices-speech-sdk','../ContactServices/CreateOrUpdateContactService','includes','unlinkSync','highlyStructuredMessage','enabled','isNil','../../models/Message','advertising','segundo\x20if','fourRowTemplate','request','reload','map','isBefore','trace','keywords','../MessageServices/CreateMessageService','handleMessage','contactsArrayMessage','campaignQueue','temperature','texto','videoMessage','outOfHoursMessage','then','filename','Throttle','Status','name','hydratedContentText','captureException','from','mediaPath','getWbot','messages.upsert','update','now','maxTokens','rate','.wav','whatsappId','botText','liveLocationMessage','Erro\x20ao\x20buscar\x20grupo!','text','productImage','\x201286\x20-\x20Entrei\x20na\x20integracao\x20openai.','pushName','debug','imageMessage','Enquete\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','jidNormalizedUser','toString','\x20]*\x20-\x20','../../app','setExtra','sleep','documentWithCaptionMessage','SpeechSynthesizer','inActivity','input','mp3','Pedido','messages.update','head','startTime','ERR_WAPP_DOWNLOAD_MEDIA','verifyQuotedMessage','catch','singleSelectReply','url','selectedButtonId','getOwnPropertyDescriptor','join','\x20seconds\x20with\x20an\x20effective\x20speed\x20of\x20','replace','option','validaCpfCnpj','HandleMessageJob','data:image/png;base64,\x20','voiceMessage','getContactsArrayMessage','fromAudioFileOutput','reaction','makeid','>>>>\x20erro\x20','quotedMessage','WAMessageStubType','fora\x20do\x20horario','voice','\x0a*[\x200\x20]*\x20-\x20Menu\x20anterior','##\x20if','Latitude:\x20','lodash','__createBinding','@whiskeysockets/baileys','quotedMsg','getAudioMessage','moment','getStickerMessage','mkdirSync','audioMessage','promptId','defineProperty','mediaMessage','getPaymentMessage','SAIR','findByPk','5047UUIyzL','ephemeralMessage','viewOnceMessage','9600QTqIVz','unknown','add','chatBotType','company-','test','number','vcard','buttonsMessage','MessageUpdateJob','POST','amountUsedBotQueues','../../models/Campaign','Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','apply','../../libs/socket','voiceRegion','__esModule','hydratedTemplate','indexOf','userId','-appMessage','messageStubType','Type','@g.us','campaignId','\x20Download\x20completed\x20in\x20','save','isArray','length','set','botText\x203','participant','stickerMessage','-open','getAd','removeNonPrintableChars','createChatCompletion','getIO','../../helpers/SendPresenceStatus','integrationId','handleRating','mediaName','isNumeric','fromSubscription','body\x20is\x20not\x20a\x20string','Erro\x20para\x20responder\x20com\x20audio:\x20','contact','choices','__importDefault','remoteJid','push','getBodyMessage','editedMessage','env','SpeechConfig','CIPHERTEXT','getTextMessage','Expected\x20bodyMessage\x20to\x20be\x20a\x20string,\x20got:','pollCreationMessageV2','finishedAt','image/jpeg','getQuotedMessage','Mensagem','protocolMessage','application/json','isValidMsg','caption','status','../../libs/wbot','mimetype','2RESMGp','getGroupInviteMessage','chatbot\x20desativado!','../../models/Queue','DELIVERY_ACK','allowGroup','../../models/UserRating','SendPresenceStatus','verifyRating','queueId','contactMessage','../../helpers/Debounce','debounce','pt-BR-FabioNeural','extractMessageContent','20biFMjg','hydratedHsm','572704ZnrOnm','isNull','3543832iDMnaH','companyId','../../utils/logger','directPath','toLowerCase','Error\x20converting\x20file:\x20','pop','READ','terceiro\x20if','time','listResponseMessage','getVideoMessage','complationMessage','parseToMilliseconds','../../helpers/Mustache','Menu\x20inicial\x20*[\x200\x20]*\x20Menu\x20anterior','subtract','.mp3','parentId','configurable','type','toFormat','assistant','./SendWhatsAppMedia','create','groupMetadata','viewOnceMessageV2','Failed\x20to\x20fetch\x20contact\x20from\x20ticket:','chatbotAt','extension','system','contacts:','Error\x20getting\x20message\x20body:','chatbot','maxUseBotQueues','Error\x20handling\x20message\x20ack.\x20Err:\x20','writable','isBetween','Error:\x20','messages','getQuotedMessageId','speechSynthesisVoiceName','scheduleType','wbotMessageListener','selectedId','options','../../helpers/MakeRandomId','(((.+)+)+)+$','document','getViewOnceMessage','../TicketServices/FindOrCreateATicketTrakingService','dataJson','primeiro\x20if','default','message','delete','CHATBOT_RESTRICT_NUMBER','getCallMessage','random','reactionMessage','filter','emit','\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial','getContactMessage','key','useIntegration','string','randomValue','gpt-3.5-turbo-1106','../../models/Ticket','find','values','Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','disableBot','interactiveMessage','public','Erro\x20ao\x20salvar\x20mensagem!','5869085EKXnuI','company','format','ticketId','../../models/QueueOption','log','SERVER_ACK','-ticket','openai','isGroup','sendMessageImage','REVOKE',':unreads','typebot','Múltiplos\x20Produtos','No\x20contact\x20found\x20for\x20this\x20ticket.','mediaType','forEach','logger','gte','value','../TypebotServices/typebotListener','Error\x20isValidMsg','../../models/Contact','No\x20result\x20from\x20synthesizer','list','application/pdf','mediaUrl','setFfmpegPath','E2E_DEVICE_CHANGED','Erro\x20ao\x20salvar\x20avaliação!','webhook','getBodyButton','chat','startLunchTime','%2C','existsSync','whisper-1','concat','writeFile','warn','4RFUsRG','isAfter','Erro\x20ao\x20deletar\x20o\x20arquivo:','next','\x0a\x0a*[\x20#\x20]*\x20-\x20Voltar\x20ao\x20Menu\x20Principal','setMinutes','Nas\x20respostas\x20utilize\x20o\x20nome\x20','Lista',']\x20-\x20','application','findAll','error','cacheLayer','audio/mpeg','templateMessage','fluent-ffmpeg','voiceKey','ProtocolMessage','getReactionMessage','sequelize','button','\x20MBps','Mensagem\x20interativa\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','search','subject','E2E_IDENTITY_CHANGED','getLocationMessage','sendMessageLink','provider','extendedTextMessage','ASC','updatedAt','content','media','end','handleMessageIntegration','../QueueIntegrationServices/ShowQueueIntegrationService','*[\x20','closed','hydratedFourRowTemplate','*Você\x20encerrou\x20este\x20atendimento\x20usando\x20o\x20comando\x20SAIR*.\x0a\x0a\x0aSe\x20você\x20finalizou\x20o\x20atendimento\x20*ANTES*\x20de\x20receber\x20um\x20retorno\x20do\x20operador,\x20ele\x20*NÃO*\x20irá\x20visualizar\x20sua\x20solicitação!\x0a\x0aVocê\x20deve\x20aguardar\x20o\x20retorno\x20do\x20operador\x20e\x20que\x20ele\x20encerre\x20seu\x20atendimento\x20quando\x20necessário.\x0a\x0aUse\x20a\x20opção\x20*SAIR*\x20somente\x20em\x20casos\x20de\x20emergência\x20ou\x20se\x20ficou\x20preso\x20em\x20algum\x20setor.\x0a\x0a\x0aPara\x20iniciar\x20um\x20novo\x20atendimento\x20basta\x20enviar\x20uma\x20nova\x20mensagem!','./providers','locationMessage','endTime','header','makeRandomId','findOne','weekdayEn','verifyCampaignMessageAndCloseTicket','trim','../TicketServices/UpdateTicketService','slice','user','promisify','urlN8N','resolve','maxMessages','dest','buttonsResponseMessage','getButtonsMessage','sendGreetingMessageOneQueues','proto','Escolha\x20uma\x20opção','11210604JdMJOg','OpenAIApi','pending','pollCreationMessageV3','../TicketServices/FindOrCreateTicketService','\x20-\x20Longitude:\x20','documentMessage','stringify','Failed\x20to\x20get\x20stream','contacts','MESSAGE_EDIT','g.us','EM_ANDAMENTO','../CompanyService/VerifyCurrentSchedule','isNaN','selectedRowId','externalAdReply','toDate','HH:mm','9yybsto','createdAt','minutes','queues','templateButtonReplyMessage','verifyMessage','4142571oqTnvb','../../models/OldMessage','queueOptionId','-closed','contextInfo','PENDING'];a560_0x40dd=function(){return _0x49165b;};return a560_0x40dd();}Object[a560_0x4c9181(0x111)](exports,'__esModule',{'value':!![]}),exports[a560_0x4c9181(0x19e)]=exports[a560_0x4c9181(0x219)]=exports['verifyRecentCampaign']=exports['handleMsgAck']=exports[a560_0x4c9181(0x289)]=exports[a560_0x4c9181(0x20c)]=exports['handleRating']=exports[a560_0x4c9181(0x168)]=exports['isValidMsg']=exports[a560_0x4c9181(0x240)]=exports[a560_0x4c9181(0x2bb)]=exports['getQuotedMessageId']=exports[a560_0x4c9181(0x157)]=exports[a560_0x4c9181(0x14d)]=exports[a560_0x4c9181(0x2cc)]=exports[a560_0x4c9181(0x204)]=exports[a560_0x4c9181(0x1ca)]=exports[a560_0x4c9181(0x2b0)]=exports[a560_0x4c9181(0x2c5)]=exports[a560_0x4c9181(0x13d)]=exports[a560_0x4c9181(0x144)]=void 0x0;const path_1=__importStar(require('path')),util_1=require(a560_0x4c9181(0x26a)),fs_1=require('fs'),Sentry=__importStar(require('@sentry/node')),lodash_1=require(a560_0x4c9181(0x107)),baileys_1=require(a560_0x4c9181(0x109)),MessageUtils=__importStar(require('./wbotGetMessageFromType')),stream_throttle_1=require(a560_0x4c9181(0x275)),Contact_1=__importDefault(require(a560_0x4c9181(0x1d7))),Ticket_1=__importDefault(require(a560_0x4c9181(0x1b8))),Message_1=__importDefault(require(a560_0x4c9181(0x27e))),OldMessage_1=__importDefault(require(a560_0x4c9181(0x242))),socket_1=require(a560_0x4c9181(0x128)),CreateMessageService_1=__importDefault(require(a560_0x4c9181(0x288))),logger_1=require(a560_0x4c9181(0x175)),CreateOrUpdateContactService_1=__importDefault(require(a560_0x4c9181(0x278))),FindOrCreateTicketService_1=__importDefault(require(a560_0x4c9181(0x22c))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),UpdateTicketService_1=__importDefault(require(a560_0x4c9181(0x21b))),Mustache_1=__importDefault(require(a560_0x4c9181(0x181))),UserRating_1=__importDefault(require(a560_0x4c9181(0x166))),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),moment_1=__importDefault(require(a560_0x4c9181(0x10c))),Queue_1=__importDefault(require(a560_0x4c9181(0x163))),QueueOption_1=__importDefault(require(a560_0x4c9181(0x1c4))),FindOrCreateATicketTrakingService_1=__importDefault(require(a560_0x4c9181(0x1a5))),VerifyCurrentSchedule_1=__importDefault(require(a560_0x4c9181(0x235))),Campaign_1=__importDefault(require(a560_0x4c9181(0x125))),CampaignShipping_1=__importDefault(require('../../models/CampaignShipping')),sequelize_1=require(a560_0x4c9181(0x1fc)),queues_1=require('../../queues'),User_1=__importDefault(require(a560_0x4c9181(0x272))),Setting_1=__importDefault(require('../../models/Setting')),cache_1=require('../../libs/cache'),Debounce_1=require(a560_0x4c9181(0x16b)),openai_1=require(a560_0x4c9181(0x1c8)),fluent_ffmpeg_1=__importDefault(require(a560_0x4c9181(0x1f8))),microsoft_cognitiveservices_speech_sdk_1=require(a560_0x4c9181(0x277)),providers_1=require(a560_0x4c9181(0x212)),typebotListener_1=__importDefault(require(a560_0x4c9181(0x1d5))),ShowQueueIntegrationService_1=__importDefault(require(a560_0x4c9181(0x20d))),SendWhatsAppMedia_1=require(a560_0x4c9181(0x18a)),fs_2=__importDefault(require('fs')),request_1=__importDefault(require(a560_0x4c9181(0x282))),ffmpeg_static_1=__importDefault(require('ffmpeg-static')),app_1=__importDefault(require(a560_0x4c9181(0x2ae))),mime_1=__importDefault(require('mime')),wbot_1=require(a560_0x4c9181(0x15e)),SendPresenceStatus_1=require(a560_0x4c9181(0x140)),MakeRandomId_1=require(a560_0x4c9181(0x1a1));fluent_ffmpeg_1['default'][a560_0x4c9181(0x1dc)](ffmpeg_static_1['default']);const sessionsOpenAi=[],isNumeric=_0x58ccb7=>/^-?\d+$/[a560_0x4c9181(0x11e)](_0x58ccb7);exports[a560_0x4c9181(0x144)]=isNumeric;let outOfHourMessageControl=[],completionMessageControl=[],greetingMessageControl=[],farewellMessageControl=[];const writeFileAsync=(0x0,util_1[a560_0x4c9181(0x21e)])(fs_1[a560_0x4c9181(0x1e7)]),getTypeMessage=_0x301b5d=>{const _0x57981d=a560_0x4c9181;return(0x0,baileys_1['getContentType'])(_0x301b5d[_0x57981d(0x1a9)]);},removeNonPrintableChars=_0x19f7f3=>{return _0x19f7f3['replace'](/[\x00-\x1F\x7F-\x9F]/g,'');};exports[a560_0x4c9181(0x13d)]=removeNonPrintableChars;async function getQueues(_0x2e3cf1){const _0x16bebf=a560_0x4c9181;try{const _0x3b75ab=await Queue_1[_0x16bebf(0x1a8)][_0x16bebf(0x1f3)]({'where':{'companyId':_0x2e3cf1}});return _0x3b75ab;}catch(_0x5909a4){return console[_0x16bebf(0x1f4)]('Failed\x20to\x20fetch\x20queues:',_0x5909a4),[];}}async function getContactFromTicket(_0x423e53){const _0x1477ba=a560_0x4c9181;try{const _0x2c721b=await Ticket_1[_0x1477ba(0x1a8)][_0x1477ba(0x115)](_0x423e53,{'include':[{'model':Contact_1[_0x1477ba(0x1a8)],'as':_0x1477ba(0x148)}]});return _0x2c721b&&_0x2c721b[_0x1477ba(0x148)]?_0x2c721b[_0x1477ba(0x148)]:(console[_0x1477ba(0x1c5)](_0x1477ba(0x1cf)),null);}catch(_0xe0daac){return console[_0x1477ba(0x1f4)](_0x1477ba(0x18e),_0xe0daac),null;}}function validaCpfCnpj(_0x2460eb){const _0x34b7ad=a560_0x4c9181;if(_0x2460eb[_0x34b7ad(0x136)]==0xb){var _0x2556ec=_0x2460eb['trim']();_0x2556ec=_0x2556ec['replace'](/\./g,''),_0x2556ec=_0x2556ec[_0x34b7ad(0x2c3)]('-',''),_0x2556ec=_0x2556ec[_0x34b7ad(0x266)]('');var _0x30a1e2=0x0,_0x3fb6be=0x0,_0x12719f=![];for(var _0x192e23=0x1;_0x2556ec[_0x34b7ad(0x136)]>_0x192e23;_0x192e23++){_0x2556ec[_0x192e23-0x1]!=_0x2556ec[_0x192e23]&&(_0x12719f=!![]);}if(_0x12719f==![])return![];for(var _0x192e23=0x0,_0x53e040=0xa;_0x2556ec[_0x34b7ad(0x136)]-0x2>_0x192e23;_0x192e23++,_0x53e040--){_0x30a1e2+=_0x2556ec[_0x192e23]*_0x53e040;}_0x30a1e2=_0x30a1e2*0xa%0xb;_0x30a1e2==0xa&&(_0x30a1e2=0x0);if(_0x30a1e2!=_0x2556ec[0x9])return![];for(var _0x192e23=0x0,_0x53e040=0xb;_0x2556ec['length']-0x1>_0x192e23;_0x192e23++,_0x53e040--){_0x3fb6be+=_0x2556ec[_0x192e23]*_0x53e040;}return _0x3fb6be=_0x3fb6be*0xa%0xb,_0x3fb6be==0xa&&(_0x3fb6be=0x0),_0x3fb6be!=_0x2556ec[0xa]?![]:!![];}else{if(_0x2460eb[_0x34b7ad(0x136)]==0xe){var _0x5a2042=_0x2460eb[_0x34b7ad(0x21a)]();_0x5a2042=_0x5a2042['replace'](/\./g,''),_0x5a2042=_0x5a2042[_0x34b7ad(0x2c3)]('-',''),_0x5a2042=_0x5a2042[_0x34b7ad(0x2c3)]('/',''),_0x5a2042=_0x5a2042[_0x34b7ad(0x266)]('');var _0x30a1e2=0x0,_0x3fb6be=0x0,_0x12719f=![];for(var _0x192e23=0x1;_0x5a2042['length']>_0x192e23;_0x192e23++){_0x5a2042[_0x192e23-0x1]!=_0x5a2042[_0x192e23]&&(_0x12719f=!![]);}if(_0x12719f==![])return![];for(var _0x192e23=0x0,_0x56008d=0x5,_0x224a03=0xd;_0x5a2042[_0x34b7ad(0x136)]-0x2>_0x192e23;_0x192e23++,_0x56008d--,_0x224a03--){_0x56008d>=0x2?_0x30a1e2+=_0x5a2042[_0x192e23]*_0x56008d:_0x30a1e2+=_0x5a2042[_0x192e23]*_0x224a03;}_0x30a1e2=_0x30a1e2%0xb;_0x30a1e2<0x2?_0x30a1e2=0x0:_0x30a1e2=0xb-_0x30a1e2;if(_0x30a1e2!=_0x5a2042[0xc])return![];for(var _0x192e23=0x0,_0x56008d=0x6,_0x224a03=0xe;_0x5a2042[_0x34b7ad(0x136)]-0x1>_0x192e23;_0x192e23++,_0x56008d--,_0x224a03--){_0x56008d>=0x2?_0x3fb6be+=_0x5a2042[_0x192e23]*_0x56008d:_0x3fb6be+=_0x5a2042[_0x192e23]*_0x224a03;}return _0x3fb6be=_0x3fb6be%0xb,_0x3fb6be<0x2?_0x3fb6be=0x0:_0x3fb6be=0xb-_0x3fb6be,_0x3fb6be!=_0x5a2042[0xd]?![]:!![];}else return![];}}exports[a560_0x4c9181(0x2c5)]=validaCpfCnpj;function timeout(_0x49bcbb){return new Promise(_0x57ae40=>setTimeout(_0x57ae40,_0x49bcbb));}async function sleep(_0x6c9c6e){await timeout(_0x6c9c6e);}exports[a560_0x4c9181(0x2b0)]=sleep;const sendMessageImage=async(_0x1ed914,_0x153a12,_0x224c65,_0x2f3f69,_0x59ca25)=>{const _0x262d21=a560_0x4c9181;let _0x550ba7;try{_0x550ba7=await _0x1ed914['sendMessage'](_0x153a12[_0x262d21(0x11f)]+'@'+(_0x224c65[_0x262d21(0x1c9)]?'g.us':'s.whatsapp.net'),{'image':_0x2f3f69?{'url':_0x2f3f69}:fs_2['default'][_0x262d21(0x260)]('public/temp/'+_0x59ca25+'-'+makeid(0xa)),'fileName':_0x59ca25,'caption':_0x59ca25,'mimetype':_0x262d21(0x156)});}catch(_0x1a6864){_0x550ba7=await _0x1ed914[_0x262d21(0x252)](_0x153a12['number']+'@'+(_0x224c65[_0x262d21(0x1c9)]?_0x262d21(0x233):_0x262d21(0x26d)),{'text':(0x0,Mustache_1['default'])(_0x262d21(0x126),_0x224c65)});}(0x0,exports[_0x262d21(0x240)])(_0x550ba7,_0x224c65,_0x153a12);};exports[a560_0x4c9181(0x1ca)]=sendMessageImage;const sendMessageLink=async(_0x4e2523,_0x3fdd21,_0x33d985,_0x3d115d,_0x48ff36)=>{const _0x468924=a560_0x4c9181;let _0x4c09cd;try{_0x4c09cd=await _0x4e2523[_0x468924(0x252)](_0x3fdd21[_0x468924(0x11f)]+'@'+(_0x33d985[_0x468924(0x1c9)]?'g.us':_0x468924(0x26d)),{'document':_0x3d115d?{'url':_0x3d115d}:fs_2[_0x468924(0x1a8)][_0x468924(0x260)]('public/temp/'+_0x48ff36+'-'+makeid(0xa)),'fileName':_0x48ff36,'caption':_0x48ff36,'mimetype':_0x468924(0x1da)});}catch(_0x2330e4){_0x4c09cd=await _0x4e2523[_0x468924(0x252)](_0x3fdd21[_0x468924(0x11f)]+'@'+(_0x33d985[_0x468924(0x1c9)]?'g.us':_0x468924(0x26d)),{'text':(0x0,Mustache_1['default'])('Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!',_0x33d985)});}(0x0,exports[_0x468924(0x240)])(_0x4c09cd,_0x33d985,_0x3fdd21);};exports[a560_0x4c9181(0x204)]=sendMessageLink;function makeid(_0x272f3d){const _0x58110b=a560_0x4c9181;var _0x5e513d='',_0x45da80=_0x58110b(0x249),_0x23ff4c=_0x45da80[_0x58110b(0x136)];for(var _0x8aa612=0x0;_0x8aa612<_0x272f3d;_0x8aa612++){_0x5e513d+=_0x45da80['charAt'](Math['floor'](Math[_0x58110b(0x1ad)]()*_0x23ff4c));}return _0x5e513d;}exports[a560_0x4c9181(0x2cc)]=makeid;const msgLocation=(_0x1bda23,_0x5d2bab,_0x35ded2)=>{const _0x1583ef=a560_0x4c9181;if(_0x1bda23){var _0x119f0a=Buffer[_0x1583ef(0x297)](_0x1bda23)[_0x1583ef(0x2ac)](_0x1583ef(0x258));let _0x4d202f=_0x1583ef(0x2c7)+_0x119f0a+'\x20|\x20https://maps.google.com/maps?q='+_0x5d2bab+_0x1583ef(0x1e3)+_0x35ded2+'&z=17&hl=pt-BR|'+_0x5d2bab+',\x20'+_0x35ded2+'\x20';return _0x4d202f;}},getBodyMessage=_0x2b850a=>{const _0x4067ef=a560_0x4c9181;try{let _0x4536c2=getTypeMessage(_0x2b850a);const _0x3533f7={'conversation':MessageUtils[_0x4067ef(0x152)](_0x2b850a),'editedMessage':_0x2b850a?.['message']?.[_0x4067ef(0x14e)]?.['message']?.['protocolMessage']?.['editedMessage']?.[_0x4067ef(0x270)]||_0x2b850a?.[_0x4067ef(0x1a9)]?.[_0x4067ef(0x14e)]?.[_0x4067ef(0x1a9)]?.[_0x4067ef(0x206)]?.[_0x4067ef(0x2a4)],'imageMessage':MessageUtils['getImageMessage'](_0x2b850a),'videoMessage':MessageUtils[_0x4067ef(0x17e)](_0x2b850a),'extendedTextMessage':_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x206)]?.[_0x4067ef(0x2a4)],'buttonsResponseMessage':MessageUtils[_0x4067ef(0x224)](_0x2b850a),'templateButtonReplyMessage':_0x2b850a['message']?.[_0x4067ef(0x23f)]?.[_0x4067ef(0x19f)],'messageContextInfo':_0x2b850a[_0x4067ef(0x1a9)]?.['buttonsResponseMessage']?.[_0x4067ef(0x2bf)]||_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x17d)]?.[_0x4067ef(0x253)],'buttonsMessage':MessageUtils[_0x4067ef(0x1e0)](_0x2b850a)||_0x2b850a[_0x4067ef(0x1a9)]?.['listResponseMessage']?.['singleSelectReply']?.[_0x4067ef(0x237)],'viewOnceMessage':MessageUtils[_0x4067ef(0x1a4)](_0x2b850a),'viewOnceMessageV2':MessageUtils['getViewOnceMessageV2'](_0x2b850a),'stickerMessage':MessageUtils[_0x4067ef(0x10d)](_0x2b850a),'contactMessage':MessageUtils[_0x4067ef(0x1b2)](_0x2b850a),'contactsArrayMessage':_0x2b850a[_0x4067ef(0x1a9)]?.['contactsArrayMessage']?.[_0x4067ef(0x231)]&&MessageUtils[_0x4067ef(0x2c9)](_0x2b850a),'pollCreationMessageV2':_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x154)]?.[_0x4067ef(0x294)]||_0x4067ef(0x2aa),'pollCreationMessageV3':_0x2b850a['message']?.['pollCreationMessageV3']?.[_0x4067ef(0x294)]||_0x4067ef(0x2aa),'interactiveMessage':_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x1bd)]?.['body']||_0x2b850a[_0x4067ef(0x1a9)]?.['interactiveMessage']?.['contextInfo']||_0x4067ef(0x1ff),'locationMessage':MessageUtils[_0x4067ef(0x203)](_0x2b850a),'liveLocationMessage':_0x4067ef(0x106)+_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x2a2)]?.['degreesLatitude']+_0x4067ef(0x22d)+_0x2b850a[_0x4067ef(0x1a9)]?.['liveLocationMessage']?.[_0x4067ef(0x24f)],'documentMessage':MessageUtils['getDocumentMessage'](_0x2b850a),'documentWithCaptionMessage':_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x2b1)]?.[_0x4067ef(0x1a9)]?.[_0x4067ef(0x22e)]?.[_0x4067ef(0x15c)],'audioMessage':MessageUtils[_0x4067ef(0x10b)](_0x2b850a),'ephemeralMessage':_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x117)]?.['message']?.[_0x4067ef(0x206)]?.[_0x4067ef(0x2a4)],'listMessage':MessageUtils['getBodyButton'](_0x2b850a)||_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x17d)]?.[_0x4067ef(0x253)],'listResponseMessage':MessageUtils['getListMessage'](_0x2b850a),'reactionMessage':MessageUtils[_0x4067ef(0x1fb)](_0x2b850a)||_0x4067ef(0x2cb),'advertising':MessageUtils[_0x4067ef(0x13c)](_0x2b850a)||_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x17d)]?.['contextInfo']?.[_0x4067ef(0x238)]?.[_0x4067ef(0x253)],'productMessage':_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x263)]?.['product']?.[_0x4067ef(0x2a5)]?.['caption']||'Produto','multiProductMessage':_0x4067ef(0x1ce),'orderMessage':_0x4067ef(0x2b6),'paymentMessage':MessageUtils[_0x4067ef(0x113)](_0x2b850a),'paymentRequestMessage':'Solicitação\x20de\x20Pagamento','groupInviteMessage':MessageUtils[_0x4067ef(0x161)](_0x2b850a),'revokeInviteMessage':'Convite\x20Revogado','protocolMessage':_0x2b850a[_0x4067ef(0x1a9)]?.[_0x4067ef(0x159)]?.[_0x4067ef(0x14e)]?.['conversation']||null,'disappearingMessage':_0x4067ef(0x256),'callMessage':MessageUtils[_0x4067ef(0x1ac)](_0x2b850a),'templateMessage':MessageUtils['getTemplateMessage'](_0x2b850a),'statusUpdateMessage':_0x4067ef(0x26e)};return _0x3533f7[_0x4536c2]||null;}catch(_0x34d7c7){return console['error'](_0x4067ef(0x193),_0x34d7c7),null;}};exports[a560_0x4c9181(0x14d)]=getBodyMessage;const getQuotedMessage=_0x5255b6=>{const _0x64e7c6=a560_0x4c9181,_0x81f3e8=_0x5255b6['message'][_0x64e7c6(0x2a9)][_0x64e7c6(0x245)]||_0x5255b6['message'][_0x64e7c6(0x28e)][_0x64e7c6(0x245)]||_0x5255b6[_0x64e7c6(0x1a9)]?.['documentMessage']||_0x5255b6['message'][_0x64e7c6(0x206)][_0x64e7c6(0x245)]||_0x5255b6['message'][_0x64e7c6(0x223)]['contextInfo']||_0x5255b6[_0x64e7c6(0x1a9)][_0x64e7c6(0x17d)]['contextInfo']||_0x5255b6['message']['templateButtonReplyMessage'][_0x64e7c6(0x245)]||_0x5255b6[_0x64e7c6(0x1a9)][_0x64e7c6(0x223)]?.[_0x64e7c6(0x245)]||_0x5255b6?.[_0x64e7c6(0x1a9)]?.['buttonsResponseMessage']?.['selectedButtonId']||_0x5255b6['message'][_0x64e7c6(0x17d)]?.['singleSelectReply']?.['selectedRowId']||_0x5255b6?.['message']?.[_0x64e7c6(0x17d)]?.[_0x64e7c6(0x2bd)]['selectedRowId']||_0x5255b6[_0x64e7c6(0x1a9)][_0x64e7c6(0x17d)]?.[_0x64e7c6(0x245)];return _0x5255b6[_0x64e7c6(0x1a9)]['senderKeyDistributionMessage'],(0x0,baileys_1['extractMessageContent'])(_0x81f3e8[Object[_0x64e7c6(0x261)](_0x81f3e8)[_0x64e7c6(0x1ba)]()[_0x64e7c6(0x1ec)]()[_0x64e7c6(0x1d4)]]);};function a560_0x48b7(_0x374fbf,_0x13b921){const _0x36b6cb=a560_0x40dd();return a560_0x48b7=function(_0x398107,_0x31e202){_0x398107=_0x398107-0x102;let _0x40dd63=_0x36b6cb[_0x398107];return _0x40dd63;},a560_0x48b7(_0x374fbf,_0x13b921);}exports['getQuotedMessage']=getQuotedMessage;const getQuotedMessageId=_0x5dc7f9=>{const _0x15f8ed=a560_0x4c9181,_0x525177=(0x0,baileys_1[_0x15f8ed(0x16e)])(_0x5dc7f9[_0x15f8ed(0x1a9)])[Object[_0x15f8ed(0x261)](_0x5dc7f9?.[_0x15f8ed(0x1a9)])['values']()['next']()[_0x15f8ed(0x1d4)]];let _0x420fe4=_0x5dc7f9?.[_0x15f8ed(0x1a9)]?.['reactionMessage']?_0x5dc7f9?.[_0x15f8ed(0x1a9)]?.[_0x15f8ed(0x1ae)]?.[_0x15f8ed(0x1b3)]?.['id']:'';return _0x420fe4?_0x420fe4:_0x525177?.[_0x15f8ed(0x245)]?.['stanzaId'];};exports[a560_0x4c9181(0x19b)]=getQuotedMessageId;const getMeSocket=_0x5594c8=>{const _0x2e2b41=a560_0x4c9181;return{'id':(0x0,baileys_1[_0x2e2b41(0x2ab)])(_0x5594c8[_0x2e2b41(0x21d)]['id']),'name':_0x5594c8[_0x2e2b41(0x21d)][_0x2e2b41(0x294)]};},getSenderMessage=(_0x3cc498,_0x57a5d6)=>{const _0x4bd656=a560_0x4c9181,_0x7e8fc=getMeSocket(_0x57a5d6);if(_0x3cc498[_0x4bd656(0x1b3)]['fromMe'])return _0x7e8fc['id'];const _0x3b735b=_0x3cc498[_0x4bd656(0x139)]||_0x3cc498['key'][_0x4bd656(0x139)]||_0x3cc498[_0x4bd656(0x1b3)][_0x4bd656(0x14b)]||undefined;return _0x3b735b&&(0x0,baileys_1['jidNormalizedUser'])(_0x3b735b);},getContactMessage=async(_0x391a02,_0x2b3c30)=>{const _0x4d0521=a560_0x4c9181,_0x22ec25=_0x391a02[_0x4d0521(0x1b3)][_0x4d0521(0x14b)][_0x4d0521(0x279)](_0x4d0521(0x233)),_0x2c2a1b=_0x391a02[_0x4d0521(0x1b3)][_0x4d0521(0x14b)][_0x4d0521(0x2c3)](/\D/g,'');return _0x22ec25?{'id':getSenderMessage(_0x391a02,_0x2b3c30),'name':_0x391a02[_0x4d0521(0x2a7)]}:{'id':_0x391a02[_0x4d0521(0x1b3)][_0x4d0521(0x14b)],'name':_0x391a02[_0x4d0521(0x1b3)]['fromMe']?_0x2c2a1b:_0x391a02[_0x4d0521(0x2a7)]};},getUnpackedMessage=_0x31d729=>{const _0x4b603e=a560_0x4c9181;return _0x31d729[_0x4b603e(0x1a9)]?.[_0x4b603e(0x2b1)]?.['message']||_0x31d729[_0x4b603e(0x1a9)]?.[_0x4b603e(0x206)]?.['contextInfo']?.[_0x4b603e(0x2ce)]||_0x31d729['message']?.['ephemeralMessage']?.['message']||_0x31d729[_0x4b603e(0x1a9)]?.['viewOnceMessage']?.[_0x4b603e(0x1a9)]||_0x31d729[_0x4b603e(0x1a9)]?.[_0x4b603e(0x18d)]?.[_0x4b603e(0x1a9)]||_0x31d729[_0x4b603e(0x1a9)]?.[_0x4b603e(0x117)]?.['message']||_0x31d729[_0x4b603e(0x1a9)]?.[_0x4b603e(0x1f7)]?.[_0x4b603e(0x12b)]||_0x31d729[_0x4b603e(0x1a9)]?.[_0x4b603e(0x1f7)]?.[_0x4b603e(0x210)]||_0x31d729[_0x4b603e(0x1a9)]?.[_0x4b603e(0x1f7)]?.['fourRowTemplate']||_0x31d729[_0x4b603e(0x1a9)]?.[_0x4b603e(0x1bd)]?.['header']||_0x31d729['message']?.[_0x4b603e(0x27b)]?.[_0x4b603e(0x170)]?.['hydratedTemplate']||_0x31d729[_0x4b603e(0x1a9)];},getMessageMedia=_0x493800=>{const _0x363f59=a560_0x4c9181;return _0x493800?.['imageMessage']||_0x493800?.[_0x363f59(0x10f)]||_0x493800?.['videoMessage']||_0x493800?.[_0x363f59(0x13a)]||_0x493800?.[_0x363f59(0x22e)]||null;},downloadMedia=async _0x15e25e=>{const _0x3cbf47=a560_0x4c9181,_0xdcbd3a=getUnpackedMessage(_0x15e25e),_0xae3d74=getMessageMedia(_0xdcbd3a);if(!_0xae3d74)return null;const _0x2003ed=_0xdcbd3a?.['documentMessage']?'document':_0xae3d74[_0x3cbf47(0x15f)][_0x3cbf47(0x266)]('/')[0x0][_0x3cbf47(0x2c3)](_0x3cbf47(0x1f2),_0x3cbf47(0x1a3))?_0xae3d74[_0x3cbf47(0x15f)]['split']('/')[0x0][_0x3cbf47(0x2c3)]('application',_0x3cbf47(0x1a3)):_0xae3d74[_0x3cbf47(0x15f)][_0x3cbf47(0x266)]('/')[0x0];let _0x6dbab1,_0x59b70f=0x0;while(_0x59b70f<0xa&&!_0x6dbab1){try{_0xae3d74?.[_0x3cbf47(0x176)]&&(_0xae3d74[_0x3cbf47(0x2be)]=''),_0x6dbab1=await(0x0,baileys_1['downloadContentFromMessage'])(_0xae3d74,_0x2003ed);}catch(_0x240231){_0x59b70f+=0x1,await new Promise(_0x31e5fd=>{setTimeout(_0x31e5fd,0x3e8*_0x59b70f*0x2);}),logger_1[_0x3cbf47(0x1d2)][_0x3cbf47(0x1e8)](_0x3cbf47(0x2cd)+_0x59b70f+'\x20de\x20baixar\x20o\x20arquivo\x20'+_0x15e25e?.[_0x3cbf47(0x1b3)]?.['id']);}}if(!_0x6dbab1)throw new Error(_0x3cbf47(0x230));let _0x54f3f2=_0xdcbd3a?.['documentMessage']?.['fileName']||'';if(!_0x54f3f2){const _0x57e706=mime_1[_0x3cbf47(0x1a8)][_0x3cbf47(0x190)](_0xae3d74[_0x3cbf47(0x15f)]);_0x54f3f2=(0x0,MakeRandomId_1[_0x3cbf47(0x216)])(0x5)+'-'+new Date()[_0x3cbf47(0x24a)]()+'.'+_0x57e706;}else _0x54f3f2=_0x54f3f2[_0x3cbf47(0x266)]('.')[_0x3cbf47(0x21c)](0x0,-0x1)[_0x3cbf47(0x2c1)]('.')+'.'+(0x0,MakeRandomId_1['makeRandomId'])(0x5)+'.'+_0x54f3f2[_0x3cbf47(0x266)]('.')['slice'](-0x1);const _0x18da6e=0x5*0x400*0x400/0x8,_0x3e7921=0x400*0x400/0x8,_0xbe46b9=0x400*0x400,_0x57c07a=new stream_throttle_1[(_0x3cbf47(0x292))]({'rate':_0x18da6e});let _0x1e3b4e=Buffer['from']([]),_0x59b3e1=0x0;const _0x5cfe61=Date[_0x3cbf47(0x29c)]();try{for await(const _0xb2821e of _0x6dbab1['pipe'](_0x57c07a)){_0x1e3b4e=Buffer[_0x3cbf47(0x1e6)]([_0x1e3b4e,_0xb2821e]),_0x59b3e1+=_0xb2821e[_0x3cbf47(0x136)],_0x59b3e1>_0xbe46b9&&(_0x57c07a[_0x3cbf47(0x29e)]=_0x3e7921);}}catch(_0x375dab){return{'data':_0x3cbf47(0x1f4),'mimetype':'','filename':''};}const _0x5b241a=Date[_0x3cbf47(0x29c)](),_0x29a471=(_0x5b241a-_0x5cfe61)/0x3e8,_0x940501=_0x59b3e1/_0x29a471;logger_1['logger'][_0x3cbf47(0x2a8)](_0x54f3f2+_0x3cbf47(0x133)+_0x29a471[_0x3cbf47(0x273)](0x2)+_0x3cbf47(0x2c2)+(_0x940501/0x400/0x400)[_0x3cbf47(0x273)](0x2)+_0x3cbf47(0x1fe));if(!_0x1e3b4e){Sentry['setExtra'](_0x3cbf47(0x2ba),{'msg':_0x15e25e}),Sentry['captureException'](new Error(_0x3cbf47(0x2ba)));throw new Error(_0x3cbf47(0x2ba));}const _0xceca97={'data':_0x1e3b4e,'mimetype':_0xae3d74[_0x3cbf47(0x15f)],'filename':_0x54f3f2};return _0xceca97;},verifyContact=async(_0xd37cd5,_0x71ebfd,_0x13fcc9)=>{const _0x32d1dc=a560_0x4c9181,_0x51af23={'name':_0xd37cd5?.[_0x32d1dc(0x294)]||_0xd37cd5['id'][_0x32d1dc(0x2c3)](/\D/g,''),'number':_0xd37cd5['id'][_0x32d1dc(0x25a)](0x0,_0xd37cd5['id'][_0x32d1dc(0x12c)]('@')),'isGroup':_0xd37cd5['id'][_0x32d1dc(0x279)](_0x32d1dc(0x233)),'companyId':_0x13fcc9,'whatsappId':_0x71ebfd['id']},_0x248630=(0x0,CreateOrUpdateContactService_1[_0x32d1dc(0x1a8)])(_0x51af23,_0x71ebfd,_0xd37cd5['id']);return _0x248630;},verifyQuotedMessage=async _0x5f1493=>{const _0xef5eaa=a560_0x4c9181;if(!_0x5f1493)return null;const _0x434679=(0x0,exports[_0xef5eaa(0x19b)])(_0x5f1493);if(!_0x434679)return null;const _0x100cf1=await Message_1[_0xef5eaa(0x1a8)][_0xef5eaa(0x217)]({'where':{'id':_0x434679}});if(!_0x100cf1)return null;return _0x100cf1;};exports[a560_0x4c9181(0x2bb)]=verifyQuotedMessage;const sanitizeName=_0x23c1b0=>{const _0x13d98e=a560_0x4c9181;let _0x44a1da=_0x23c1b0[_0x13d98e(0x266)]('\x20')[0x0];return _0x44a1da=_0x44a1da['replace'](/[^a-zA-Z0-9]/g,''),_0x44a1da[_0x13d98e(0x25a)](0x0,0x3c);},convertTextToSpeechAndSaveToFile=(_0x2c6c4a,_0xab8c1d,_0x161769,_0x1d763d,_0x37e29b=a560_0x4c9181(0x16d),_0x51b76b='mp3')=>{return new Promise((_0x5072f1,_0x2e996a)=>{const _0x8ea38=a560_0x48b7,_0x3e14fe=microsoft_cognitiveservices_speech_sdk_1[_0x8ea38(0x150)][_0x8ea38(0x145)](_0x161769,_0x1d763d);_0x3e14fe[_0x8ea38(0x19c)]=_0x37e29b;const _0x420c71=microsoft_cognitiveservices_speech_sdk_1['AudioConfig'][_0x8ea38(0x2ca)](_0xab8c1d+_0x8ea38(0x29f)),_0x3b4958=new microsoft_cognitiveservices_speech_sdk_1[(_0x8ea38(0x2b2))](_0x3e14fe,_0x420c71);_0x3b4958['speakTextAsync'](_0x2c6c4a,_0xf6ee1b=>{const _0x2293ef=_0x8ea38;_0xf6ee1b?convertWavToAnotherFormat(_0xab8c1d+'.wav',_0xab8c1d+'.'+_0x51b76b,_0x51b76b)[_0x2293ef(0x290)](_0x218f45=>{_0x5072f1();})[_0x2293ef(0x2bc)](_0x1bf34e=>{const _0xd2ddd=_0x2293ef;console[_0xd2ddd(0x1f4)](_0x1bf34e),_0x2e996a(_0x1bf34e);}):_0x2e996a(new Error(_0x2293ef(0x1d8))),_0x3b4958[_0x2293ef(0x26c)]();},_0x5a985a=>{const _0x5a0a2a=_0x8ea38;console[_0x5a0a2a(0x1f4)](_0x5a0a2a(0x199)+_0x5a985a),_0x3b4958[_0x5a0a2a(0x26c)](),_0x2e996a(_0x5a985a);});});},convertWavToAnotherFormat=(_0x34b0a4,_0x232de6,_0x2aefa5)=>{return new Promise((_0x26660a,_0x373f78)=>{const _0x5c5504=a560_0x48b7;(0x0,fluent_ffmpeg_1['default'])()[_0x5c5504(0x2b4)](_0x34b0a4)[_0x5c5504(0x188)](_0x2aefa5)['on'](_0x5c5504(0x20b),()=>_0x26660a(_0x232de6))['on'](_0x5c5504(0x1f4),_0x19acfe=>_0x373f78(new Error(_0x5c5504(0x178)+_0x19acfe[_0x5c5504(0x1a9)])))[_0x5c5504(0x134)](_0x232de6);});},deleteFileSync=_0x5ddb6c=>{const _0x5c863c=a560_0x4c9181;try{fs_2['default'][_0x5c863c(0x27a)](_0x5ddb6c);}catch(_0x570240){console[_0x5c863c(0x1f4)](_0x5c863c(0x1eb),_0x570240);}},keepOnlySpecifiedChars=_0x2a17a0=>{const _0x47b9f0=a560_0x4c9181;return _0x2a17a0[_0x47b9f0(0x2c3)](/[^a-zA-Z0-9áéíóúÁÉÍÓÚâêîôûÂÊÎÔÛãõÃÕçÇ!?.,;:\s]/g,'');},handleOpenAi=async(_0x1c46a0,_0x2f86f6,_0x286b10,_0x9abfd0,_0x36462e)=>{const _0x344e46=a560_0x4c9181,_0x576938=(0x0,exports[_0x344e46(0x14d)])(_0x1c46a0);if(!_0x576938)return;let {prompt:_0x200f77}=await(0x0,ShowWhatsAppService_1[_0x344e46(0x1a8)])(_0x2f86f6['id'],_0x286b10[_0x344e46(0x174)]);!_0x200f77&&!(0x0,lodash_1['isNil'])(_0x286b10?.[_0x344e46(0x274)]?.['prompt'])&&(_0x200f77=_0x286b10['queue']['prompt']);if(!_0x200f77)return;if(_0x1c46a0[_0x344e46(0x12f)])return;const _0x206fe3=path_1['default'][_0x344e46(0x220)](__dirname,'..','..','..',_0x344e46(0x1be));let _0x1a1b43;const _0x42d306=sessionsOpenAi['findIndex'](_0x1dc66b=>_0x1dc66b['id']===_0x2f86f6['id']);if(_0x42d306===-0x1){const _0x3f5979=new openai_1['Configuration']({'apiKey':_0x200f77[_0x344e46(0x259)]});_0x1a1b43=new openai_1[(_0x344e46(0x229))](_0x3f5979),_0x1a1b43['id']=_0x2f86f6['id'],sessionsOpenAi['push'](_0x1a1b43);}else _0x1a1b43=sessionsOpenAi[_0x42d306];const _0x33b56b=await Message_1[_0x344e46(0x1a8)]['findAll']({'where':{'ticketId':_0x286b10['id']},'order':[[_0x344e46(0x23c),'ASC']],'limit':_0x200f77[_0x344e46(0x221)]}),_0x577bfa=_0x344e46(0x1ef)+sanitizeName(_0x9abfd0[_0x344e46(0x294)]||'Amigo(a)')+'\x20para\x20identificar\x20o\x20cliente.\x0aSua\x20resposta\x20deve\x20usar\x20no\x20máximo\x20'+_0x200f77[_0x344e46(0x29d)]+'\x20tokens\x20e\x20cuide\x20para\x20não\x20truncar\x20o\x20final.\x0aSempre\x20que\x20possível,\x20mencione\x20o\x20nome\x20dele\x20para\x20ser\x20mais\x20personalizado\x20o\x20atendimento\x20e\x20mais\x20educado.\x20Quando\x20a\x20resposta\x20requer\x20uma\x20transferência\x20para\x20o\x20setor\x20de\x20atendimento,\x20comece\x20sua\x20resposta\x20com\x20\x27Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento\x27.\x0a\x0a\x20\x20'+_0x200f77[_0x344e46(0x257)]+'\x0a';let _0x2c0957=[];if(_0x1c46a0[_0x344e46(0x1a9)]?.['conversation']||_0x1c46a0[_0x344e46(0x1a9)]?.[_0x344e46(0x206)]?.['text']){_0x2c0957=[],_0x2c0957[_0x344e46(0x14c)]({'role':_0x344e46(0x191),'content':_0x577bfa});for(let _0x21b07d=0x0;_0x21b07d<Math[_0x344e46(0x251)](_0x200f77['maxMessages'],_0x33b56b['length']);_0x21b07d++){const _0x1775b0=_0x33b56b[_0x21b07d];_0x1775b0[_0x344e46(0x1d0)]===_0x344e46(0x1e1)&&(_0x1775b0[_0x344e46(0x25c)]?_0x2c0957['push']({'role':_0x344e46(0x189),'content':_0x1775b0[_0x344e46(0x269)]}):_0x2c0957[_0x344e46(0x14c)]({'role':'user','content':_0x1775b0[_0x344e46(0x269)]}));}_0x2c0957[_0x344e46(0x14c)]({'role':_0x344e46(0x21d),'content':_0x576938});const _0x5e88c1=await _0x1a1b43[_0x344e46(0x13e)]({'model':'gpt-3.5-turbo-1106','messages':_0x2c0957,'max_tokens':_0x200f77[_0x344e46(0x29d)],'temperature':_0x200f77[_0x344e46(0x28c)]});let _0x4c8987=_0x5e88c1[_0x344e46(0x26b)]['choices'][0x0][_0x344e46(0x1a9)]?.[_0x344e46(0x209)];_0x4c8987?.['includes'](_0x344e46(0x1bb))&&(await transferQueue(_0x200f77[_0x344e46(0x169)],_0x286b10,_0x9abfd0),_0x4c8987=_0x4c8987[_0x344e46(0x2c3)](_0x344e46(0x1bb),'')[_0x344e46(0x21a)]());if(_0x200f77['voice']===_0x344e46(0x28d)){const _0x345eea=await _0x2f86f6[_0x344e46(0x252)](_0x1c46a0['key'][_0x344e46(0x14b)],{'text':_0x4c8987});await(0x0,exports['verifyMessage'])(_0x345eea,_0x286b10,_0x9abfd0);}else{const _0x1fbb83=_0x286b10['id']+'_'+Date[_0x344e46(0x29c)]();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x4c8987),_0x206fe3+'/'+_0x1fbb83,_0x200f77[_0x344e46(0x1f9)],_0x200f77[_0x344e46(0x129)],_0x200f77[_0x344e46(0x103)],_0x344e46(0x2b5))[_0x344e46(0x290)](async()=>{const _0x68fdc2=_0x344e46;try{const _0x35b747=await _0x2f86f6[_0x68fdc2(0x252)](_0x1c46a0['key'][_0x68fdc2(0x14b)],{'audio':{'url':_0x206fe3+'/'+_0x1fbb83+_0x68fdc2(0x184)},'mimetype':_0x68fdc2(0x1f6),'ptt':!![]});await verifyMediaMessage(_0x35b747,_0x286b10,_0x9abfd0),deleteFileSync(_0x206fe3+'/'+_0x1fbb83+'.mp3'),deleteFileSync(_0x206fe3+'/'+_0x1fbb83+'.wav');}catch(_0x100b57){console[_0x68fdc2(0x1c5)](_0x68fdc2(0x147)+_0x100b57);}});}}else{if(_0x1c46a0['message']?.['audioMessage']){const _0x250f42=_0x36462e[_0x344e46(0x1db)]['split']('/')[_0x344e46(0x179)](),_0x1afe85=fs_2[_0x344e46(0x1a8)]['createReadStream'](_0x206fe3+'/'+_0x250f42),_0x16e6f9=await _0x1a1b43[_0x344e46(0x255)](_0x1afe85,_0x344e46(0x1e5));_0x2c0957=[],_0x2c0957[_0x344e46(0x14c)]({'role':_0x344e46(0x191),'content':_0x577bfa});for(let _0x31ad3c=0x0;_0x31ad3c<Math[_0x344e46(0x251)](_0x200f77[_0x344e46(0x221)],_0x33b56b['length']);_0x31ad3c++){const _0x2c0160=_0x33b56b[_0x31ad3c];_0x2c0160[_0x344e46(0x1d0)]===_0x344e46(0x1e1)&&(_0x2c0160[_0x344e46(0x25c)]?_0x2c0957[_0x344e46(0x14c)]({'role':_0x344e46(0x189),'content':_0x2c0160['body']}):_0x2c0957[_0x344e46(0x14c)]({'role':_0x344e46(0x21d),'content':_0x2c0160[_0x344e46(0x269)]}));}_0x2c0957[_0x344e46(0x14c)]({'role':_0x344e46(0x21d),'content':_0x16e6f9[_0x344e46(0x26b)]['text']});const _0x3dfd97=await _0x1a1b43[_0x344e46(0x13e)]({'model':_0x344e46(0x1b7),'messages':_0x2c0957,'max_tokens':_0x200f77[_0x344e46(0x29d)],'temperature':_0x200f77[_0x344e46(0x28c)]});let _0x546e8b=_0x3dfd97[_0x344e46(0x26b)][_0x344e46(0x149)][0x0]['message']?.[_0x344e46(0x209)];_0x546e8b?.[_0x344e46(0x279)](_0x344e46(0x1bb))&&(await transferQueue(_0x200f77[_0x344e46(0x169)],_0x286b10,_0x9abfd0),_0x546e8b=_0x546e8b[_0x344e46(0x2c3)](_0x344e46(0x1bb),'')[_0x344e46(0x21a)]());if(_0x200f77['voice']===_0x344e46(0x28d)){const _0x30ff74=await _0x2f86f6[_0x344e46(0x252)](_0x1c46a0[_0x344e46(0x1b3)][_0x344e46(0x14b)],{'text':_0x546e8b});await(0x0,exports['verifyMessage'])(_0x30ff74,_0x286b10,_0x9abfd0);}else{const _0x50161e=_0x286b10['id']+'_'+Date[_0x344e46(0x29c)]();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x546e8b),_0x206fe3+'/'+_0x50161e,_0x200f77[_0x344e46(0x1f9)],_0x200f77[_0x344e46(0x129)],_0x200f77[_0x344e46(0x103)],'mp3')[_0x344e46(0x290)](async()=>{const _0x1860ab=_0x344e46;try{const _0x367e50=await _0x2f86f6[_0x1860ab(0x252)](_0x1c46a0['key'][_0x1860ab(0x14b)],{'audio':{'url':_0x206fe3+'/'+_0x50161e+_0x1860ab(0x184)},'mimetype':'audio/mpeg','ptt':!![]});await verifyMediaMessage(_0x367e50,_0x286b10,_0x9abfd0),deleteFileSync(_0x206fe3+'/'+_0x50161e+_0x1860ab(0x184)),deleteFileSync(_0x206fe3+'/'+_0x50161e+_0x1860ab(0x29f));}catch(_0x57eb8a){console[_0x1860ab(0x1c5)](_0x1860ab(0x147)+_0x57eb8a);}});}}}_0x2c0957=[];},transferQueue=async(_0x1f73aa,_0x171dcf,_0xae3b9d)=>{const _0x3633fd=a560_0x4c9181;console[_0x3633fd(0x286)]('update!'),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x1f73aa,'useIntegration':![],'promptId':null},'ticketId':_0x171dcf['id'],'companyId':_0x171dcf[_0x3633fd(0x174)]});},verifyMediaMessage=async(_0x5d9d59,_0x1b3a5d,_0x45d8b8)=>{const _0x452d31=a560_0x4c9181,_0x349319=(0x0,socket_1[_0x452d31(0x13f)])();let _0x387ee5=await Message_1[_0x452d31(0x1a8)][_0x452d31(0x217)]({'where':{'id':_0x5d9d59[_0x452d31(0x1b3)]['id']}});if(!_0x387ee5){const _0x5b27e8=await(0x0,exports[_0x452d31(0x2bb)])(_0x5d9d59),_0x3cb6f7=(0x0,wbot_1[_0x452d31(0x299)])(_0x1b3a5d[_0x452d31(0x2a0)]),_0x428d7d=await downloadMedia(_0x5d9d59);if(!_0x428d7d)throw new Error(_0x452d31(0x2ba));if(!_0x428d7d[_0x452d31(0x291)]){const _0x271834=typeof _0x428d7d[_0x452d31(0x15f)]===_0x452d31(0x1b5)&&_0x428d7d[_0x452d31(0x15f)][_0x452d31(0x279)]('/')&&_0x428d7d[_0x452d31(0x15f)][_0x452d31(0x279)](';')?mime_1[_0x452d31(0x1a8)][_0x452d31(0x190)](_0x428d7d[_0x452d31(0x15f)]):_0x452d31(0x11a);_0x428d7d[_0x452d31(0x291)]=new Date()[_0x452d31(0x24a)]()+'.'+_0x271834;}else{let _0x19e13b=_0x428d7d[_0x452d31(0x291)]?'-'+_0x428d7d['filename']:'';_0x428d7d[_0x452d31(0x291)]=''+new Date()[_0x452d31(0x24a)]()+_0x19e13b;}try{const _0x24f468='public/company'+_0x1b3a5d[_0x452d31(0x174)];!fs_2['default'][_0x452d31(0x1e4)](_0x24f468)&&(fs_2[_0x452d31(0x1a8)][_0x452d31(0x10e)](_0x24f468),fs_2[_0x452d31(0x1a8)][_0x452d31(0x276)](_0x24f468,0x1ff)),await writeFileAsync((0x0,path_1[_0x452d31(0x2c1)])(__dirname,'..','..','..',_0x24f468,_0x428d7d['filename']),_0x428d7d['data'],_0x452d31(0x258));}catch(_0x2f195a){Sentry[_0x452d31(0x296)](_0x2f195a),logger_1[_0x452d31(0x1d2)][_0x452d31(0x1f4)](_0x2f195a);}const _0x419ca5=(0x0,exports['getBodyMessage'])(_0x5d9d59);var _0x74372=getTypeMessage(_0x5d9d59);const _0x47b99a={'id':_0x5d9d59['key']['id'],'ticketId':_0x1b3a5d['id'],'contactId':_0x5d9d59[_0x452d31(0x1b3)][_0x452d31(0x25c)]?undefined:_0x45d8b8['id'],'body':_0x419ca5?(0x0,Mustache_1[_0x452d31(0x1a8)])(_0x419ca5,_0x1b3a5d):_0x428d7d['filename'],'fromMe':_0x5d9d59[_0x452d31(0x1b3)]['fromMe'],'read':_0x5d9d59[_0x452d31(0x1b3)][_0x452d31(0x25c)],'mediaUrl':_0x428d7d[_0x452d31(0x291)],'mediaType':typeof _0x428d7d[_0x452d31(0x15f)]==='string'?_0x428d7d[_0x452d31(0x15f)][_0x452d31(0x266)]('/')[0x0]:_0x452d31(0x11a),'quotedMsgId':_0x5b27e8?.['id'],'ack':getStatus(_0x5d9d59,_0x452d31(0x20a)),'remoteJid':_0x5d9d59[_0x452d31(0x1b3)][_0x452d31(0x14b)],'participant':_0x5d9d59['key']['participant'],'dataJson':JSON[_0x452d31(0x22f)](_0x5d9d59)};var _0x4d9f71=_0x419ca5||_0x428d7d[_0x452d31(0x291)];typeof _0x4d9f71!=_0x452d31(0x1b5)&&console[_0x452d31(0x286)](_0x452d31(0x146),_0x4d9f71),await _0x1b3a5d['update']({'lastMessage':_0x4d9f71}),_0x387ee5=await(0x0,CreateMessageService_1[_0x452d31(0x1a8)])({'messageData':_0x47b99a,'ticket':_0x1b3a5d,'companyId':_0x1b3a5d['companyId']});}else typeof _0x387ee5['body']!=_0x452d31(0x1b5)&&console['trace']('body\x20is\x20not\x20a\x20string',_0x387ee5[_0x452d31(0x269)]),await _0x1b3a5d[_0x452d31(0x29b)]({'lastMessage':_0x387ee5[_0x452d31(0x269)]}),_0x387ee5['ack']=getStatus(_0x5d9d59,_0x452d31(0x20a)),_0x387ee5[_0x452d31(0x139)]=_0x5d9d59[_0x452d31(0x1b3)][_0x452d31(0x139)],_0x387ee5[_0x452d31(0x1a6)]=JSON['stringify'](_0x5d9d59),await _0x387ee5[_0x452d31(0x134)]();return!_0x5d9d59[_0x452d31(0x1b3)][_0x452d31(0x25c)]&&_0x1b3a5d['status']===_0x452d31(0x20f)&&(await _0x1b3a5d['update']({'status':_0x452d31(0x22a)}),await _0x1b3a5d[_0x452d31(0x283)]({'include':[{'model':Queue_1[_0x452d31(0x1a8)],'as':_0x452d31(0x274)},{'model':User_1[_0x452d31(0x1a8)],'as':_0x452d31(0x21d)},{'model':Contact_1[_0x452d31(0x1a8)],'as':'contact'}]}),_0x349319['to'](_0x452d31(0x11d)+_0x1b3a5d[_0x452d31(0x174)]+_0x452d31(0x244))[_0x452d31(0x1b0)]('company-'+_0x1b3a5d['companyId']+_0x452d31(0x1c7),{'action':_0x452d31(0x1aa),'ticket':_0x1b3a5d,'ticketId':_0x1b3a5d['id']}),_0x349319['to']('company-'+_0x1b3a5d[_0x452d31(0x174)]+'-'+_0x1b3a5d[_0x452d31(0x15d)])['to'](_0x1b3a5d['id']['toString']())[_0x452d31(0x1b0)]('company-'+_0x1b3a5d[_0x452d31(0x174)]+'-ticket',{'action':_0x452d31(0x29b),'ticket':_0x1b3a5d,'ticketId':_0x1b3a5d['id']})),_0x387ee5;};function getStatus(_0x24b5cc,_0x522291){const _0x283424=a560_0x4c9181;if(_0x24b5cc[_0x283424(0x15d)]==baileys_1['proto']['WebMessageInfo']['Status'][_0x283424(0x246)]){if(_0x24b5cc[_0x283424(0x1b3)]['fromMe']&&_0x522291==_0x283424(0x1ae))return 0x3;return 0x1;}else{if(_0x24b5cc[_0x283424(0x15d)]==baileys_1[_0x283424(0x226)][_0x283424(0x24b)][_0x283424(0x293)][_0x283424(0x1c6)])return 0x1;else{if(_0x24b5cc[_0x283424(0x15d)]==baileys_1[_0x283424(0x226)][_0x283424(0x24b)]['Status'][_0x283424(0x164)])return 0x2;else{if(_0x24b5cc[_0x283424(0x15d)]==baileys_1[_0x283424(0x226)][_0x283424(0x24b)][_0x283424(0x293)][_0x283424(0x17a)]||_0x24b5cc[_0x283424(0x15d)]==baileys_1[_0x283424(0x226)][_0x283424(0x24b)][_0x283424(0x293)]['PLAYED'])return 0x3;}}}return 0x0;}const verifyMessage=async(_0x2e288c,_0xd80c17,_0x20a096)=>{const _0x2ce715=a560_0x4c9181,_0x26d638=(0x0,socket_1[_0x2ce715(0x13f)])(),_0x5ac7a8=await(0x0,exports[_0x2ce715(0x2bb)])(_0x2e288c),_0x5b91b7=(0x0,exports[_0x2ce715(0x14d)])(_0x2e288c);if(!_0x5b91b7)return;let _0x2f18ca=getTypeMessage(_0x2e288c);const _0x2f33d7=_0x2f18ca=='editedMessage'||_0x2e288c?.[_0x2ce715(0x1a9)]?.['protocolMessage']?.[_0x2ce715(0x187)]==baileys_1[_0x2ce715(0x226)][_0x2ce715(0x26f)][_0x2ce715(0x1fa)][_0x2ce715(0x130)][_0x2ce715(0x232)]||_0x2e288c?.[_0x2ce715(0x1a9)]?.[_0x2ce715(0x159)]?.[_0x2ce715(0x14e)]?.['conversation']?.['length']>0x0;let _0x2058a4=_0x2e288c[_0x2ce715(0x1b3)]['id'];if(_0x2f18ca=='protocolMessage')_0x2058a4=_0x2e288c?.['message']?.[_0x2ce715(0x159)]?.[_0x2ce715(0x1b3)]?.['id']||_0x2e288c[_0x2ce715(0x1b3)]['id'];else _0x2f18ca==_0x2ce715(0x14e)&&(_0x2058a4=_0x2e288c?.[_0x2ce715(0x1a9)]?.[_0x2ce715(0x14e)]?.[_0x2ce715(0x1a9)]?.['protocolMessage']?.['key']?.['id']||_0x2e288c[_0x2ce715(0x1b3)]['id']);const _0x45a7bb={'id':_0x2058a4,'ticketId':_0xd80c17['id'],'contactId':_0x2e288c[_0x2ce715(0x1b3)][_0x2ce715(0x25c)]?undefined:_0x20a096['id'],'body':_0x5b91b7,'fromMe':_0x2e288c[_0x2ce715(0x1b3)][_0x2ce715(0x25c)],'mediaType':_0x2f18ca,'read':_0x2e288c[_0x2ce715(0x1b3)][_0x2ce715(0x25c)],'quotedMsgId':_0x5ac7a8?.['id'],'ack':getStatus(_0x2e288c,_0x2f18ca),'remoteJid':_0x2e288c['key'][_0x2ce715(0x14b)],'participant':_0x2e288c['key'][_0x2ce715(0x139)],'dataJson':JSON[_0x2ce715(0x22f)](_0x2e288c),'isEdited':_0x2f33d7};typeof _0x5b91b7!='string'&&console[_0x2ce715(0x286)](_0x2ce715(0x146),_0x5b91b7);await _0xd80c17[_0x2ce715(0x29b)]({'lastMessage':_0x5b91b7});if(_0x2f33d7){let _0x8ebc34=await Message_1[_0x2ce715(0x1a8)]['findByPk'](_0x45a7bb['id']);if(_0x8ebc34){const _0x3fca88={'messageId':_0x45a7bb['id'],'body':_0x8ebc34[_0x2ce715(0x269)]};await OldMessage_1[_0x2ce715(0x1a8)][_0x2ce715(0x262)](_0x3fca88);}else console[_0x2ce715(0x1c5)]('Mensagem\x20editada\x20não\x20encontrada:\x20'+_0x45a7bb['id']);}await(0x0,CreateMessageService_1['default'])({'messageData':_0x45a7bb,'ticket':_0xd80c17,'companyId':_0xd80c17[_0x2ce715(0x174)]}),!_0x2e288c[_0x2ce715(0x1b3)]['fromMe']&&_0xd80c17['status']===_0x2ce715(0x20f)&&(await _0xd80c17['update']({'status':_0x2ce715(0x22a)}),await _0xd80c17[_0x2ce715(0x283)]({'include':[{'model':Queue_1[_0x2ce715(0x1a8)],'as':_0x2ce715(0x274)},{'model':User_1[_0x2ce715(0x1a8)],'as':'user'},{'model':Contact_1[_0x2ce715(0x1a8)],'as':_0x2ce715(0x148)}]}),_0x26d638['to'](_0x2ce715(0x11d)+_0xd80c17[_0x2ce715(0x174)]+_0x2ce715(0x244))[_0x2ce715(0x1b0)]('company-'+_0xd80c17[_0x2ce715(0x174)]+_0x2ce715(0x1c7),{'action':_0x2ce715(0x1aa),'ticket':_0xd80c17,'ticketId':_0xd80c17['id']}),_0x26d638['to'](_0x2ce715(0x11d)+_0xd80c17[_0x2ce715(0x174)]+'-'+_0xd80c17[_0x2ce715(0x15d)])['to'](_0xd80c17['id']['toString']())[_0x2ce715(0x1b0)](_0x2ce715(0x11d)+_0xd80c17[_0x2ce715(0x174)]+'-ticket',{'action':_0x2ce715(0x29b),'ticket':_0xd80c17,'ticketId':_0xd80c17['id']}));};exports['verifyMessage']=verifyMessage;const isValidMsg=_0x154769=>{const _0x1e0444=a560_0x4c9181;if(_0x154769[_0x1e0444(0x1b3)][_0x1e0444(0x14b)]==='status@broadcast')return![];try{const _0x932a49=getTypeMessage(_0x154769);if(!_0x932a49)return![];const _0x4d5d5b=_0x932a49===_0x1e0444(0x270)||_0x932a49===_0x1e0444(0x14e)||_0x932a49===_0x1e0444(0x206)||_0x932a49===_0x1e0444(0x10f)||_0x932a49===_0x1e0444(0x28e)||_0x932a49==='pollCreationMessageV2'||_0x932a49===_0x1e0444(0x1f7)||_0x932a49===_0x1e0444(0x22b)||_0x932a49==='interactiveMessage'||_0x932a49===_0x1e0444(0x2a9)||_0x932a49==='documentMessage'||_0x932a49==='documentWithCaptionMessage'||_0x932a49===_0x1e0444(0x13a)||_0x932a49===_0x1e0444(0x223)||_0x932a49===_0x1e0444(0x121)||_0x932a49===_0x1e0444(0x24e)||_0x932a49===_0x1e0444(0x213)||_0x932a49===_0x1e0444(0x2a2)||_0x932a49==='contactMessage'||_0x932a49===_0x1e0444(0x2c8)||_0x932a49===_0x1e0444(0x112)||_0x932a49===_0x1e0444(0x28a)||_0x932a49===_0x1e0444(0x1ae)||_0x932a49===_0x1e0444(0x117)||_0x932a49==='protocolMessage'||_0x932a49===_0x1e0444(0x17d)||_0x932a49===_0x1e0444(0x265)||_0x932a49===_0x1e0444(0x118)||_0x932a49===_0x1e0444(0x18d)||_0x932a49===_0x1e0444(0x27f)||_0x932a49===_0x1e0444(0x27b);return!_0x4d5d5b&&(logger_1['logger'][_0x1e0444(0x1e8)]('####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20'+_0x932a49+'\x0a'+JSON[_0x1e0444(0x22f)](_0x154769?.['message'])),Sentry[_0x1e0444(0x2af)](_0x1e0444(0x158),{'BodyMsg':_0x154769[_0x1e0444(0x1a9)],'msg':_0x154769,'msgType':_0x932a49}),Sentry[_0x1e0444(0x296)](new Error('Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg'))),!!_0x4d5d5b;}catch(_0x4fc596){Sentry[_0x1e0444(0x2af)](_0x1e0444(0x1d6),{'msg':_0x154769}),Sentry['captureException'](_0x4fc596);}return![];};exports['isValidMsg']=isValidMsg;const Push=_0x295145=>{const _0x3bd6d0=a560_0x4c9181;return _0x295145[_0x3bd6d0(0x2a7)];},verifyQueue=async(_0x46952c,_0x48d714,_0x2630c3,_0x28d51a,_0xe60aa0)=>{const _0x8d07de=a560_0x4c9181,_0x5ac0c4=_0x2630c3[_0x8d07de(0x174)],{queues:_0x1fce98,greetingMessage:_0xab14d3,maxUseBotQueues:_0x4784e4,timeUseBotQueues:_0x2493b6}=await(0x0,ShowWhatsAppService_1[_0x8d07de(0x1a8)])(_0x46952c['id'],_0x2630c3[_0x8d07de(0x174)]);if(_0x1fce98[_0x8d07de(0x136)]===0x1){const _0x12d4d6=(0x0,lodash_1[_0x8d07de(0x2b8)])(_0x1fce98);let _0x47ab44=![];_0x12d4d6?.[_0x8d07de(0x1a0)]&&(_0x47ab44=_0x12d4d6[_0x8d07de(0x1a0)][_0x8d07de(0x136)]>0x0);const _0x279599=await Setting_1[_0x8d07de(0x1a8)][_0x8d07de(0x217)]({'where':{'key':_0x8d07de(0x225),'companyId':_0x2630c3['companyId']}});greetingMessageControl['push']({'ticketId':_0x2630c3['id'],'greetingMessage':_0xab14d3,'companyId':_0x5ac0c4});if(_0xab14d3[_0x8d07de(0x136)]>0x1&&_0x279599?.[_0x8d07de(0x1d4)]===_0x8d07de(0x27c)){const _0x200f81=await Message_1[_0x8d07de(0x1a8)]['findOne']({'where':{'ticketId':_0x2630c3['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x8d07de(0x1d3)]]:(0x0,moment_1[_0x8d07de(0x1a8)])()[_0x8d07de(0x183)](0x5,_0x8d07de(0x23d))[_0x8d07de(0x239)]()}}});if(_0x200f81)return;const _0x2fa1be=(0x0,Mustache_1[_0x8d07de(0x1a8)])(''+_0xab14d3,_0x2630c3);await _0x46952c['sendMessage'](_0x28d51a[_0x8d07de(0x11f)]+'@'+(_0x2630c3[_0x8d07de(0x1c9)]?_0x8d07de(0x233):_0x8d07de(0x26d)),{'text':_0x2fa1be});}const _0x5e22a=await(0x0,ShowWhatsAppService_1[_0x8d07de(0x1a8)])(_0x46952c['id'],_0x5ac0c4),_0x2817e9=_0x1fce98[0x0]?.['integrationId']||_0x5e22a[_0x8d07de(0x141)];if(!_0x48d714[_0x8d07de(0x1b3)][_0x8d07de(0x25c)]&&!_0x2630c3[_0x8d07de(0x1c9)]&&!(0x0,lodash_1['isNil'])(_0x2817e9)){const _0x1cc854=await(0x0,ShowQueueIntegrationService_1[_0x8d07de(0x1a8)])(_0x2817e9,_0x5ac0c4);await(0x0,exports[_0x8d07de(0x20c)])(_0x48d714,_0x46952c,_0x1cc854,_0x2630c3),await _0x2630c3[_0x8d07de(0x29b)]({'useIntegration':!![],'integrationId':_0x1cc854['id']});}const _0x4ef669=_0x1fce98[0x0]?.[_0x8d07de(0x110)]||_0x5e22a[_0x8d07de(0x110)];!_0x48d714[_0x8d07de(0x1b3)][_0x8d07de(0x25c)]&&!_0x2630c3[_0x8d07de(0x1c9)]&&!(0x0,lodash_1[_0x8d07de(0x27d)])(_0x4ef669)&&(console[_0x8d07de(0x1c5)](_0x8d07de(0x2a6)),await handleOpenAi(_0x48d714,_0x46952c,_0x2630c3,_0x28d51a,_0xe60aa0),await _0x2630c3[_0x8d07de(0x29b)]({'useIntegration':!![],'promptId':_0x4ef669}));await(0x0,UpdateTicketService_1[_0x8d07de(0x1a8)])({'ticketData':{'queueId':_0x12d4d6?.['id'],'chatbot':_0x47ab44,'status':_0x8d07de(0x22a)},'ticketId':_0x2630c3['id'],'companyId':_0x2630c3[_0x8d07de(0x174)]});return;}const _0x1cf568=_0x48d714?.[_0x8d07de(0x1a9)]?.[_0x8d07de(0x223)]?.[_0x8d07de(0x2bf)]||_0x48d714?.['message']?.['listResponseMessage']?.['singleSelectReply']?.['selectedRowId']||_0x48d714?.['message']?.[_0x8d07de(0x206)]?.[_0x8d07de(0x2a4)]||_0x48d714?.[_0x8d07de(0x1a9)]?.[_0x8d07de(0x270)];let _0x5e9975=null;if(_0x1cf568&&!(0x0,exports['isNumeric'])(_0x1cf568)||+_0x1cf568>_0x1fce98[_0x8d07de(0x136)]){const _0x12d935=_0x1cf568[_0x8d07de(0x177)]();for(let _0x1bc496 of _0x1fce98){if(_0x1bc496[_0x8d07de(0x294)][_0x8d07de(0x177)]()===_0x12d935){_0x5e9975=_0x1bc496;break;}if(_0x1bc496['keywords']&&_0x1bc496[_0x8d07de(0x287)][_0x8d07de(0x136)]>0x0){let _0x1106ce=_0x1bc496[_0x8d07de(0x287)]['split'](',\x20');for(let _0x35e4f9 of _0x1106ce){if(_0x35e4f9[_0x8d07de(0x177)]()==_0x12d935){_0x5e9975=_0x1bc496;break;}}}}}else _0x5e9975=_0x1fce98[+_0x1cf568-0x1];const _0x501bdc=await Setting_1[_0x8d07de(0x1a8)][_0x8d07de(0x217)]({'where':{'key':_0x8d07de(0x11c),'companyId':_0x5ac0c4}}),_0x1fe922=async()=>{const _0x2bc6fe=_0x8d07de;let _0x59b608='';if(outOfHourMessageControl[_0x2bc6fe(0x136)]>0x1388)outOfHourMessageControl=[];_0x1fce98[_0x2bc6fe(0x1d1)]((_0x4d3439,_0x496315)=>{const _0x7468c8=_0x2bc6fe;_0x59b608+=_0x7468c8(0x20e)+(_0x496315+0x1)+_0x7468c8(0x2ad)+_0x4d3439[_0x7468c8(0x294)]+'\x0a';});if(process[_0x2bc6fe(0x14f)][_0x2bc6fe(0x1ab)]?.[_0x2bc6fe(0x136)]>=0x8){if(_0x2630c3['contact'][_0x2bc6fe(0x11f)]!=process[_0x2bc6fe(0x14f)][_0x2bc6fe(0x1ab)]){console[_0x2bc6fe(0x286)](_0x2bc6fe(0x162));return;}}const _0x88a42d={'text':(0x0,Mustache_1[_0x2bc6fe(0x1a8)])('‎'+_0xab14d3+'\x0a\x0a'+_0x59b608,_0x2630c3)};await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x2630c3['amountUsedBotQueues']+0x1},'ticketId':_0x2630c3['id'],'companyId':_0x2630c3[_0x2bc6fe(0x174)]});const _0x56b95b=await _0x46952c[_0x2bc6fe(0x252)](_0x28d51a[_0x2bc6fe(0x11f)]+'@'+(_0x2630c3[_0x2bc6fe(0x1c9)]?'g.us':_0x2bc6fe(0x26d)),_0x88a42d);await(0x0,exports['verifyMessage'])(_0x56b95b,_0x2630c3,_0x2630c3[_0x2bc6fe(0x148)]);};if(_0x5e9975){let _0x170b7d=![];_0x5e9975?.[_0x8d07de(0x1a0)]&&(_0x170b7d=_0x5e9975['options'][_0x8d07de(0x136)]>0x0);await(0x0,UpdateTicketService_1[_0x8d07de(0x1a8)])({'ticketData':{'queueId':_0x5e9975['id'],'chatbot':_0x170b7d,'status':_0x8d07de(0x22a),'amountUsedBotQueues':0x0},'ticketId':_0x2630c3['id'],'companyId':_0x2630c3[_0x8d07de(0x174)]}),console[_0x8d07de(0x286)](_0x5e9975[_0x8d07de(0x1a0)]);if(_0x5e9975[_0x8d07de(0x1a0)][_0x8d07de(0x136)]===0x0){const _0x5504a0=await Queue_1[_0x8d07de(0x1a8)][_0x8d07de(0x115)](_0x5e9975['id']),{schedules:_0x427ffe}=_0x5504a0,_0x57894b=(0x0,moment_1[_0x8d07de(0x1a8)])(),_0x2db1c2=_0x57894b['format']('dddd')[_0x8d07de(0x177)]();let _0x460b3b;Array['isArray'](_0x427ffe)&&_0x427ffe[_0x8d07de(0x136)]>0x0&&(_0x460b3b=_0x427ffe[_0x8d07de(0x1b9)](_0x349aa8=>_0x349aa8[_0x8d07de(0x218)]===_0x2db1c2&&_0x349aa8['startTime']!==''&&_0x349aa8['startTime']!==null&&_0x349aa8[_0x8d07de(0x214)]!==''&&_0x349aa8[_0x8d07de(0x214)]!==null));if(_0x5504a0[_0x8d07de(0x28f)]!==null&&_0x5504a0['outOfHoursMessage']!==''&&!(0x0,lodash_1[_0x8d07de(0x27d)])(_0x460b3b)){var _0x41c83d=outOfHourMessageControl['find'](_0x22124c=>_0x22124c[_0x8d07de(0x1c3)]===_0x2630c3['id']||_0x22124c[_0x8d07de(0x222)]===_0x28d51a[_0x8d07de(0x11f)]);if(!_0x41c83d||_0x41c83d&&_0x41c83d[_0x8d07de(0x17c)]+0x3e8*0x3c*0x5<new Date()[_0x8d07de(0x24a)]()){_0x41c83d&&(outOfHourMessageControl=outOfHourMessageControl[_0x8d07de(0x1af)](_0x48c612=>_0x48c612[_0x8d07de(0x1c3)]!==_0x2630c3['id']),_0x41c83d=null);const _0x1f46fc=(0x0,moment_1[_0x8d07de(0x1a8)])(_0x460b3b['startTime'],_0x8d07de(0x23a)),_0x194a79=(0x0,moment_1[_0x8d07de(0x1a8)])(_0x460b3b[_0x8d07de(0x214)],'HH:mm');outOfHourMessageControl['push']({'ticketId':_0x2630c3['id'],'time':new Date()[_0x8d07de(0x24a)]()});if(_0x57894b['isBefore'](_0x1f46fc)||_0x57894b['isAfter'](_0x194a79)){const _0x1aca66=(0x0,Mustache_1['default'])('‎\x20'+_0x5504a0[_0x8d07de(0x28f)]+_0x8d07de(0x1ed),_0x2630c3),_0x4cb221=await _0x46952c[_0x8d07de(0x252)](_0x28d51a[_0x8d07de(0x11f)]+'@'+(_0x2630c3[_0x8d07de(0x1c9)]?_0x8d07de(0x233):_0x8d07de(0x26d)),{'text':_0x1aca66});await(0x0,exports[_0x8d07de(0x240)])(_0x4cb221,_0x2630c3,_0x28d51a),await(0x0,UpdateTicketService_1[_0x8d07de(0x1a8)])({'ticketData':{'queueId':null,'chatbot':_0x170b7d},'ticketId':_0x2630c3['id'],'companyId':_0x2630c3['companyId']}),console['log'](_0x8d07de(0x102));return;}}!_0x41c83d&&outOfHourMessageControl['push']({'ticketId':_0x2630c3['id'],'dest':_0x28d51a[_0x8d07de(0x11f)],'time':new Date()[_0x8d07de(0x24a)]()});}console[_0x8d07de(0x286)](_0x5e9975[_0x8d07de(0x141)]);if(!_0x48d714[_0x8d07de(0x1b3)][_0x8d07de(0x25c)]&&!_0x2630c3[_0x8d07de(0x1c9)]&&_0x5e9975[_0x8d07de(0x141)]){const _0xce8077=await(0x0,ShowQueueIntegrationService_1[_0x8d07de(0x1a8)])(_0x5e9975[_0x8d07de(0x141)],_0x5ac0c4);await(0x0,exports['handleMessageIntegration'])(_0x48d714,_0x46952c,_0xce8077,_0x2630c3),await _0x2630c3[_0x8d07de(0x29b)]({'useIntegration':!![],'integrationId':_0xce8077['id']});}!_0x48d714[_0x8d07de(0x1b3)][_0x8d07de(0x25c)]&&!_0x2630c3[_0x8d07de(0x1c9)]&&!(0x0,lodash_1[_0x8d07de(0x27d)])(_0x5e9975?.['promptId'])&&(await handleOpenAi(_0x48d714,_0x46952c,_0x2630c3,_0x28d51a,_0xe60aa0),await _0x2630c3[_0x8d07de(0x29b)]({'useIntegration':!![],'promptId':_0x5e9975?.['promptId']}));const _0x2a50d4=(0x0,Mustache_1[_0x8d07de(0x1a8)])('‎'+_0x5e9975[_0x8d07de(0x268)],_0x2630c3);if(_0x5e9975['greetingMessage']){const _0x2c3d45=await _0x46952c[_0x8d07de(0x252)](_0x28d51a['number']+'@'+(_0x2630c3['isGroup']?_0x8d07de(0x233):_0x8d07de(0x26d)),{'text':_0x2a50d4});await(0x0,exports[_0x8d07de(0x240)])(_0x2c3d45,_0x2630c3,_0x28d51a);if(_0x5e9975[_0x8d07de(0x298)]!==null&&_0x5e9975[_0x8d07de(0x298)]!==''){const _0x159e47=path_1[_0x8d07de(0x1a8)]['resolve']('public',_0x8d07de(0x1c1)+_0x5e9975['companyId'],_0x5e9975[_0x8d07de(0x298)]),_0x499b85=await(0x0,SendWhatsAppMedia_1[_0x8d07de(0x24d)])(_0x5e9975[_0x8d07de(0x143)],_0x159e47,null,_0x2630c3['companyId']);let _0x17d0c2=await _0x46952c[_0x8d07de(0x252)](_0x2630c3[_0x8d07de(0x148)][_0x8d07de(0x11f)]+'@'+(_0x2630c3[_0x8d07de(0x1c9)]?_0x8d07de(0x233):_0x8d07de(0x26d)),{..._0x499b85});await verifyMediaMessage(_0x17d0c2,_0x2630c3,_0x28d51a);}}}}else{if(_0x4784e4&&_0x4784e4!==0x0&&_0x2630c3[_0x8d07de(0x124)]>=_0x4784e4)return;const _0x38eab1=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x2630c3['id'],'companyId':_0x5ac0c4});let _0x4f33df=new Date(),_0x46384e=new Date();if(_0x38eab1['chatbotAt']!==null){_0x4f33df[_0x8d07de(0x1ee)](_0x38eab1['chatbotAt']['getMinutes']()+Number(_0x2493b6));if(_0x38eab1[_0x8d07de(0x18f)]!==null&&_0x46384e<_0x4f33df&&_0x2493b6!=='0'&&_0x2630c3[_0x8d07de(0x124)]!==0x0)return;}await _0x38eab1[_0x8d07de(0x29b)]({'updatedAt':new Date()});if(_0x501bdc['value']===_0x8d07de(0x2a4))return console[_0x8d07de(0x286)](_0x8d07de(0x2a1)),_0x1fe922();}},verifyRating=_0x3ff5dc=>{const _0x3e432e=a560_0x4c9181;return _0x3ff5dc&&_0x3ff5dc[_0x3e432e(0x155)]===null&&_0x3ff5dc[_0x3e432e(0x12d)]!==null&&_0x3ff5dc[_0x3e432e(0x264)]!==null;};exports[a560_0x4c9181(0x168)]=verifyRating;const handleRating=async(_0x2fdcd6,_0x32e5b4,_0x4900bf)=>{const _0x40472a=a560_0x4c9181,_0xee0a9f=(0x0,socket_1[_0x40472a(0x13f)])();let _0x44eafc=null;(_0x2fdcd6?.[_0x40472a(0x1a9)]?.[_0x40472a(0x270)]||_0x2fdcd6?.[_0x40472a(0x1a9)]?.[_0x40472a(0x206)])&&(_0x44eafc=parseInt(_0x2fdcd6[_0x40472a(0x1a9)]['conversation']||_0x2fdcd6[_0x40472a(0x1a9)][_0x40472a(0x206)][_0x40472a(0x2a4)],0xa)||null);if(!Number[_0x40472a(0x236)](_0x44eafc)&&Number['isInteger'](_0x44eafc)&&!(0x0,lodash_1[_0x40472a(0x172)])(_0x44eafc)){const {complationMessage:_0x3af8c8}=await(0x0,ShowWhatsAppService_1[_0x40472a(0x1a8)])(_0x32e5b4[_0x40472a(0x2a0)],_0x32e5b4[_0x40472a(0x174)]);let _0x1df520=_0x44eafc;_0x44eafc<0x1&&(_0x1df520=0x1);_0x44eafc>0x5&&(_0x1df520=0x5);await UserRating_1['default'][_0x40472a(0x18b)]({'ticketId':_0x4900bf[_0x40472a(0x1c3)],'companyId':_0x4900bf[_0x40472a(0x174)],'userId':_0x4900bf['userId'],'rate':_0x1df520});if(_0x3af8c8){if(completionMessageControl[_0x40472a(0x136)]>=0x9c4)completionMessageControl=[];var _0x30f0ac=completionMessageControl[_0x40472a(0x1b9)](_0x52f719=>_0x52f719[_0x40472a(0x1c3)]===_0x32e5b4['id']||_0x52f719['dest']===_0x32e5b4['contact']['number']);if(!_0x30f0ac||_0x30f0ac&&_0x30f0ac[_0x40472a(0x17c)]+0x3e8*0x3c*0x1e<new Date()['getTime']()){_0x30f0ac&&(completionMessageControl=completionMessageControl[_0x40472a(0x1af)](_0x9be8a=>_0x9be8a[_0x40472a(0x1c3)]!==_0x32e5b4['id']),_0x30f0ac=null);const _0x47660c=(0x0,Mustache_1['default'])('‎'+_0x3af8c8,_0x32e5b4);await(0x0,SendPresenceStatus_1[_0x40472a(0x167)])((0x0,wbot_1[_0x40472a(0x299)])(_0x32e5b4[_0x40472a(0x2a0)]),_0x32e5b4[_0x40472a(0x148)][_0x40472a(0x11f)]+'@'+(_0x32e5b4[_0x40472a(0x1c9)]?_0x40472a(0x233):_0x40472a(0x26d))),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x47660c,'ticket':_0x32e5b4});}!_0x30f0ac&&completionMessageControl[_0x40472a(0x14c)]({'ticketId':_0x32e5b4['id'],'dest':_0x32e5b4['contact'][_0x40472a(0x11f)],'time':new Date()[_0x40472a(0x24a)]()});}await _0x4900bf[_0x40472a(0x29b)]({'finishedAt':(0x0,moment_1[_0x40472a(0x1a8)])()[_0x40472a(0x239)](),'ratedAt':(0x0,moment_1[_0x40472a(0x1a8)])()[_0x40472a(0x239)](),'rated':!![]}),await _0x32e5b4['update']({'queueId':null,'chatbot':null,'queueOptionId':null,'userId':null,'status':_0x40472a(0x20f)}),_0xee0a9f['to'](_0x40472a(0x11d)+_0x32e5b4[_0x40472a(0x174)]+_0x40472a(0x13b))[_0x40472a(0x1b0)](_0x40472a(0x11d)+_0x32e5b4[_0x40472a(0x174)]+_0x40472a(0x1c7),{'action':_0x40472a(0x1aa),'ticket':_0x32e5b4,'ticketId':_0x32e5b4['id']}),_0xee0a9f['to']('company-'+_0x32e5b4[_0x40472a(0x174)]+'-'+_0x32e5b4['status'])['to'](_0x32e5b4['id']['toString']())[_0x40472a(0x1b0)](_0x40472a(0x11d)+_0x32e5b4['companyId']+_0x40472a(0x1c7),{'action':_0x40472a(0x29b),'ticket':_0x32e5b4,'ticketId':_0x32e5b4['id']});}};exports[a560_0x4c9181(0x142)]=handleRating;const handleChartbot=async(_0x51c018,_0x28d6d8,_0x19d71d,_0x2e3d13,_0x19e597=![])=>{const _0x292ccf=a560_0x4c9181;if(!_0x51c018[_0x292ccf(0x148)][_0x292ccf(0x1bc)]){const _0x2c4c82=await Queue_1[_0x292ccf(0x1a8)][_0x292ccf(0x115)](_0x51c018['queueId'],{'include':[{'model':QueueOption_1[_0x292ccf(0x1a8)],'as':_0x292ccf(0x1a0),'where':{'parentId':null},'order':[[_0x292ccf(0x2c4),_0x292ccf(0x207)],[_0x292ccf(0x23c),'ASC']]}]}),_0x30f88c=_0x28d6d8?.[_0x292ccf(0x1a9)]?.[_0x292ccf(0x223)]?.[_0x292ccf(0x2bf)]||_0x28d6d8?.[_0x292ccf(0x1a9)]?.[_0x292ccf(0x17d)]?.[_0x292ccf(0x2bd)]?.[_0x292ccf(0x237)]||_0x28d6d8?.['message']?.[_0x292ccf(0x206)]?.[_0x292ccf(0x2a4)]||_0x28d6d8?.['message']?.[_0x292ccf(0x270)];if(_0x30f88c=='#'&&(!_0x51c018['userId']||_0x51c018[_0x292ccf(0x15d)]==_0x292ccf(0x22a))){console[_0x292ccf(0x286)](_0x292ccf(0x105)),await _0x51c018[_0x292ccf(0x29b)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x19d71d,_0x28d6d8,_0x51c018,_0x51c018[_0x292ccf(0x148)]);return;}if(!(0x0,lodash_1[_0x292ccf(0x27d)])(_0x2c4c82)&&!(0x0,lodash_1[_0x292ccf(0x27d)])(_0x51c018[_0x292ccf(0x243)])&&_0x30f88c=='0'){console['trace'](_0x292ccf(0x1a7));const _0x2aa9a8=await QueueOption_1[_0x292ccf(0x1a8)][_0x292ccf(0x115)](_0x51c018[_0x292ccf(0x243)]);await _0x51c018[_0x292ccf(0x29b)]({'queueOptionId':_0x2aa9a8?.[_0x292ccf(0x185)],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1['isNil'])(_0x2c4c82)&&!(0x0,lodash_1[_0x292ccf(0x27d)])(_0x51c018[_0x292ccf(0x243)])){console[_0x292ccf(0x286)](_0x292ccf(0x280));const _0x193452=await QueueOption_1[_0x292ccf(0x1a8)][_0x292ccf(0x250)]({'where':{'parentId':_0x51c018[_0x292ccf(0x243)]}});let _0x529707={};_0x193452==0x1?_0x529707=await QueueOption_1['default'][_0x292ccf(0x217)]({'where':{'parentId':_0x51c018['queueOptionId']}}):(console[_0x292ccf(0x286)](_0x292ccf(0x17b)),_0x529707=await QueueOption_1[_0x292ccf(0x1a8)]['findOne']({'where':{[sequelize_1['Op']['or']]:[{'option':_0x30f88c||''},{'title':_0x30f88c||''}],'parentId':_0x51c018[_0x292ccf(0x243)]}})),_0x529707&&await _0x51c018['update']({'queueOptionId':_0x529707?.['id'],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1[_0x292ccf(0x27d)])(_0x2c4c82)&&(0x0,lodash_1[_0x292ccf(0x27d)])(_0x51c018[_0x292ccf(0x243)])&&!_0x19e597){console[_0x292ccf(0x286)]('quarto\x20if');const _0x370d55=_0x2c4c82?.[_0x292ccf(0x1a0)][_0x292ccf(0x1b9)](_0x15c415=>_0x15c415[_0x292ccf(0x2c4)]==_0x30f88c||_0x15c415[_0x292ccf(0x253)][_0x292ccf(0x177)]()==_0x30f88c['toLowerCase']());if(_0x370d55)await _0x51c018[_0x292ccf(0x29b)]({'queueOptionId':_0x370d55?.['id'],'amountUsedBotQueues':0x0});else{if(_0x2e3d13[_0x292ccf(0x195)]&&_0x2e3d13[_0x292ccf(0x195)]!==0x0&&_0x51c018['amountUsedBotQueues']>=_0x2e3d13[_0x292ccf(0x195)])return;await _0x51c018[_0x292ccf(0x29b)]({'amountUsedBotQueues':_0x51c018[_0x292ccf(0x124)]+0x1});}}else{if(_0x2e3d13[_0x292ccf(0x195)]&&_0x2e3d13[_0x292ccf(0x195)]!==0x0&&_0x51c018[_0x292ccf(0x124)]>=_0x2e3d13[_0x292ccf(0x195)])return;await _0x51c018['update']({'amountUsedBotQueues':_0x51c018['amountUsedBotQueues']+0x1});}}}await _0x51c018[_0x292ccf(0x283)]();if(!(0x0,lodash_1[_0x292ccf(0x27d)])(_0x2c4c82)&&(0x0,lodash_1[_0x292ccf(0x27d)])(_0x51c018[_0x292ccf(0x243)])){const _0x10300c=await QueueOption_1['default'][_0x292ccf(0x1f3)]({'where':{'queueId':_0x51c018[_0x292ccf(0x169)],'parentId':null},'order':[[_0x292ccf(0x2c4),'ASC'],[_0x292ccf(0x23c),'ASC']]}),_0x261d9e=_0x51c018[_0x292ccf(0x174)],_0x34d8c9=await Setting_1['default'][_0x292ccf(0x217)]({'where':{'key':_0x292ccf(0x11c),'companyId':_0x261d9e}}),_0x1d927c=async()=>{const _0x367b80=_0x292ccf,_0x1940f4=[];_0x10300c[_0x367b80(0x1d1)]((_0x2ff1fb,_0x3e921e)=>{const _0x31dbe4=_0x367b80;_0x1940f4[_0x31dbe4(0x14c)]({'buttonId':''+_0x2ff1fb['option'],'buttonText':{'displayText':_0x2ff1fb[_0x31dbe4(0x253)]},'type':0x4});}),_0x1940f4['push']({'buttonId':'#','buttonText':{'displayText':_0x367b80(0x182)},'type':0x4});const _0x3ac879={'text':(0x0,Mustache_1[_0x367b80(0x1a8)])('‎'+_0x2c4c82['greetingMessage'],_0x51c018),'buttons':_0x1940f4,'footer':'DAUMZAP','headerType':0x1},_0x581eac=await _0x19d71d[_0x367b80(0x252)](_0x51c018[_0x367b80(0x148)]['number']+'@'+(_0x51c018[_0x367b80(0x1c9)]?_0x367b80(0x233):_0x367b80(0x26d)),_0x3ac879);await(0x0,exports[_0x367b80(0x240)])(_0x581eac,_0x51c018,_0x51c018[_0x367b80(0x148)]);},_0x518b58=async()=>{const _0x5f1c27=_0x292ccf;let _0x15fec2='';console[_0x5f1c27(0x286)]('botText'),console[_0x5f1c27(0x1c5)](_0x2c4c82['mediaPath']),_0x10300c[_0x5f1c27(0x1d1)]((_0x344f71,_0x553ef2)=>{const _0x580f1c=_0x5f1c27;_0x15fec2+='*[\x20'+_0x344f71[_0x580f1c(0x2c4)]+_0x580f1c(0x2ad)+_0x344f71[_0x580f1c(0x253)]+'\x0a';}),_0x15fec2+=_0x5f1c27(0x1b1);const _0x21c83d={'text':(0x0,Mustache_1['default'])('‎'+_0x2c4c82[_0x5f1c27(0x268)]+'\x0a\x0a'+_0x15fec2,_0x51c018)};let _0x2a7115;if(!_0x2c4c82[_0x5f1c27(0x298)])_0x2a7115=await _0x19d71d[_0x5f1c27(0x252)](_0x51c018[_0x5f1c27(0x148)][_0x5f1c27(0x11f)]+'@'+(_0x51c018[_0x5f1c27(0x1c9)]?_0x5f1c27(0x233):_0x5f1c27(0x26d)),_0x21c83d),await(0x0,exports[_0x5f1c27(0x240)])(_0x2a7115,_0x51c018,_0x51c018[_0x5f1c27(0x148)]);else{const _0x20ab5f=path_1[_0x5f1c27(0x1a8)][_0x5f1c27(0x220)]('public',_0x5f1c27(0x1c1)+_0x51c018[_0x5f1c27(0x174)],_0x2c4c82[_0x5f1c27(0x298)]),_0x10536f=await(0x0,SendWhatsAppMedia_1[_0x5f1c27(0x24d)])(_0x21c83d['text'],_0x20ab5f,_0x21c83d[_0x5f1c27(0x2a4)],_0x51c018[_0x5f1c27(0x174)]);_0x2a7115=await _0x19d71d[_0x5f1c27(0x252)](_0x51c018[_0x5f1c27(0x148)][_0x5f1c27(0x11f)]+'@'+(_0x51c018[_0x5f1c27(0x1c9)]?_0x5f1c27(0x233):_0x5f1c27(0x26d)),{..._0x10536f}),await verifyMediaMessage(_0x2a7115,_0x51c018,_0x51c018['contact']);}};if(_0x34d8c9[_0x292ccf(0x1d4)]==='button'&&QueueOption_1[_0x292ccf(0x1a8)][_0x292ccf(0x136)]<=0x4)return _0x1d927c();if(_0x34d8c9[_0x292ccf(0x1d4)]===_0x292ccf(0x2a4))return console[_0x292ccf(0x286)]('botText'),_0x518b58();if(_0x34d8c9[_0x292ccf(0x1d4)]===_0x292ccf(0x1fd)&&QueueOption_1['default'][_0x292ccf(0x136)]>0x4)return console[_0x292ccf(0x286)](_0x292ccf(0x2a1)),_0x518b58();}else{if(!(0x0,lodash_1[_0x292ccf(0x27d)])(_0x2c4c82)&&!(0x0,lodash_1['isNil'])(_0x51c018[_0x292ccf(0x243)])){const _0x2704ae=await QueueOption_1[_0x292ccf(0x1a8)][_0x292ccf(0x115)](_0x51c018['queueOptionId']),_0x1b2979=await QueueOption_1['default'][_0x292ccf(0x1f3)]({'where':{'parentId':_0x51c018[_0x292ccf(0x243)]},'order':[[_0x292ccf(0x2c4),'ASC'],[_0x292ccf(0x23c),_0x292ccf(0x207)]]});if(_0x1b2979[_0x292ccf(0x136)]===0x0){const _0x5a2ed9={'text':(0x0,Mustache_1[_0x292ccf(0x1a8)])('‎'+_0x2704ae[_0x292ccf(0x1a9)],_0x51c018)},_0x1f0a2f=await _0x19d71d[_0x292ccf(0x252)](_0x51c018[_0x292ccf(0x148)][_0x292ccf(0x11f)]+'@'+(_0x51c018[_0x292ccf(0x1c9)]?'g.us':_0x292ccf(0x26d)),_0x5a2ed9);await(0x0,exports[_0x292ccf(0x240)])(_0x1f0a2f,_0x51c018,_0x51c018[_0x292ccf(0x148)]),await _0x51c018[_0x292ccf(0x29b)]({'queueOptionId':null,'chatbot':![]});return;}if(_0x1b2979[_0x292ccf(0x136)]>-0x1){const _0x582e06=_0x51c018[_0x292ccf(0x174)],_0x170318=await Setting_1['default']['findOne']({'where':{'key':_0x292ccf(0x11c),'companyId':_0x582e06}}),_0x28cad2=async()=>{const _0x308aa0=_0x292ccf,_0x10777f=[],_0x57af72=_0x51c018[_0x308aa0(0x174)],_0x3df147=await getQueues(_0x57af72),_0x1d9e8d=await getContactFromTicket(_0x51c018['id']);_0x3df147[_0x308aa0(0x1d1)]((_0x450527,_0x134cb5)=>{const _0x4861c3=_0x308aa0;_0x10777f['push']({'title':'['+(_0x134cb5+0x1)+_0x4861c3(0x1f1)+_0x450527['name'],'rowId':''+(_0x134cb5+0x1)});});const _0x4bea74=[{'rows':_0x10777f}],_0x364e05={'text':(0x0,Mustache_1[_0x308aa0(0x1a8)])('‎'+_0x2704ae[_0x308aa0(0x1a9)],_0x51c018),'title':_0x308aa0(0x1f0),'buttonText':_0x308aa0(0x227),'sections':_0x4bea74};await sleep(0x3e8);const _0x37ab8b=await _0x19d71d['sendMessage']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x1d9e8d[_0x308aa0(0x11f)]+'@'+(_0x51c018[_0x308aa0(0x1c9)]?_0x308aa0(0x233):'s.whatsapp.net'),_0x364e05);await(0x0,exports['verifyMessage'])(_0x37ab8b,_0x51c018,_0x51c018[_0x308aa0(0x148)]);},_0x4d51e5=async()=>{const _0x16bef9=_0x292ccf,_0x3830fb=[];_0x1b2979[_0x16bef9(0x1d1)]((_0x29099b,_0x144b6c)=>{const _0x7595d0=_0x16bef9;_0x3830fb['push']({'buttonId':''+_0x29099b[_0x7595d0(0x2c4)],'buttonText':{'displayText':_0x29099b[_0x7595d0(0x253)]},'type':0x4});}),_0x3830fb[_0x16bef9(0x14c)]({'buttonId':'#','buttonText':{'displayText':_0x16bef9(0x182)},'type':0x4});const _0x39fccc={'text':(0x0,Mustache_1[_0x16bef9(0x1a8)])('‎'+_0x2704ae[_0x16bef9(0x1a9)],_0x51c018),'buttons':_0x3830fb,'headerType':0x4};if(process[_0x16bef9(0x14f)][_0x16bef9(0x1ab)]?.[_0x16bef9(0x136)]>=0x8){if(_0x51c018[_0x16bef9(0x148)]['number']!=process['env'][_0x16bef9(0x1ab)]){console[_0x16bef9(0x286)]('chatbot\x20desativado!');return;}}if(!_0x2704ae[_0x16bef9(0x298)]){const _0x3a8cc3=await _0x19d71d['sendMessage'](_0x51c018['contact'][_0x16bef9(0x11f)]+'@'+(_0x51c018['isGroup']?_0x16bef9(0x233):_0x16bef9(0x26d)),_0x39fccc);await(0x0,exports[_0x16bef9(0x240)])(_0x3a8cc3,_0x51c018,_0x51c018[_0x16bef9(0x148)]);}else{const _0x11d42a=path_1['default'][_0x16bef9(0x220)](_0x16bef9(0x1be),_0x16bef9(0x1c1)+_0x51c018[_0x16bef9(0x174)],_0x2704ae[_0x16bef9(0x298)]),_0x5a39a9=await(0x0,SendWhatsAppMedia_1[_0x16bef9(0x24d)])(_0x2704ae[_0x16bef9(0x143)],_0x11d42a,_0x39fccc[_0x16bef9(0x2a4)],_0x51c018[_0x16bef9(0x174)]);let _0x309bd1=await _0x19d71d[_0x16bef9(0x252)](_0x51c018[_0x16bef9(0x148)][_0x16bef9(0x11f)]+'@'+(_0x51c018[_0x16bef9(0x1c9)]?_0x16bef9(0x233):_0x16bef9(0x26d)),{..._0x5a39a9});await verifyMediaMessage(_0x309bd1,_0x51c018,_0x51c018[_0x16bef9(0x148)]);}const _0x4aa4f0=await _0x19d71d[_0x16bef9(0x252)](_0x51c018[_0x16bef9(0x148)][_0x16bef9(0x11f)]+'@'+(_0x51c018[_0x16bef9(0x1c9)]?_0x16bef9(0x233):_0x16bef9(0x26d)),_0x39fccc);await(0x0,exports[_0x16bef9(0x240)])(_0x4aa4f0,_0x51c018,_0x51c018[_0x16bef9(0x148)]);},_0x164276=async()=>{const _0x474a3c=_0x292ccf;let _0x2a143c='';_0x1b2979['forEach']((_0x1effc8,_0x45cdc)=>{const _0x5285f5=a560_0x48b7;_0x2a143c+=_0x5285f5(0x20e)+_0x1effc8[_0x5285f5(0x2c4)]+_0x5285f5(0x2ad)+_0x1effc8[_0x5285f5(0x253)]+'\x0a';}),_0x2a143c+=_0x474a3c(0x104),_0x2a143c+='\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial';const _0x399749={'text':(0x0,Mustache_1[_0x474a3c(0x1a8)])('‎'+_0x2704ae[_0x474a3c(0x1a9)]+'\x0a\x0a'+_0x2a143c,_0x51c018)};if(process[_0x474a3c(0x14f)][_0x474a3c(0x1ab)]?.['length']>=0x8){if(_0x51c018[_0x474a3c(0x148)]['number']!=process[_0x474a3c(0x14f)][_0x474a3c(0x1ab)]){console[_0x474a3c(0x286)](_0x474a3c(0x162));return;}}if(!_0x2704ae[_0x474a3c(0x298)]){const _0x20a4a5=await _0x19d71d[_0x474a3c(0x252)](_0x51c018['contact'][_0x474a3c(0x11f)]+'@'+(_0x51c018[_0x474a3c(0x1c9)]?_0x474a3c(0x233):_0x474a3c(0x26d)),_0x399749);await(0x0,exports[_0x474a3c(0x240)])(_0x20a4a5,_0x51c018,_0x51c018[_0x474a3c(0x148)]);}else{const _0x381cc4=path_1[_0x474a3c(0x1a8)][_0x474a3c(0x220)](_0x474a3c(0x1be),'company'+_0x51c018[_0x474a3c(0x174)],_0x2704ae[_0x474a3c(0x298)]),_0x4a3633=await(0x0,SendWhatsAppMedia_1[_0x474a3c(0x24d)])(_0x2704ae[_0x474a3c(0x143)],_0x381cc4,_0x399749[_0x474a3c(0x2a4)],_0x51c018['companyId']);let _0x40c096=await _0x19d71d['sendMessage'](_0x51c018['contact'][_0x474a3c(0x11f)]+'@'+(_0x51c018['isGroup']?_0x474a3c(0x233):_0x474a3c(0x26d)),{..._0x4a3633});await verifyMediaMessage(_0x40c096,_0x51c018,_0x51c018['contact']);}};if(_0x170318['value']===_0x292ccf(0x1d9))return _0x28cad2();if(_0x170318[_0x292ccf(0x1d4)]===_0x292ccf(0x1fd)&&QueueOption_1[_0x292ccf(0x1a8)][_0x292ccf(0x136)]<=0x4)return _0x4d51e5();if(_0x170318[_0x292ccf(0x1d4)]==='text')return console[_0x292ccf(0x286)](_0x292ccf(0x138)),_0x164276();if(_0x170318[_0x292ccf(0x1d4)]===_0x292ccf(0x1fd)&&QueueOption_1[_0x292ccf(0x1a8)]['length']>0x4)return console[_0x292ccf(0x286)]('botText\x202'),_0x164276();}}}}},handleMessageIntegration=async(_0x1873bd,_0x2fb0ed,_0x2ad6fc,_0x38e6dd)=>{const _0x422216=a560_0x4c9181;if(process[_0x422216(0x14f)][_0x422216(0x1ab)]){if(_0x38e6dd['contact'][_0x422216(0x11f)]!=process[_0x422216(0x14f)]['CHATBOT_RESTRICT_NUMBER']){console[_0x422216(0x1c5)]('chatbot\x20desativado!');return;}}const _0x3eb938=getTypeMessage(_0x1873bd);if(_0x2ad6fc[_0x422216(0x187)]==='n8n'||_0x2ad6fc[_0x422216(0x187)]===_0x422216(0x1df)){if(_0x2ad6fc?.[_0x422216(0x21f)]){const _0x509374={'method':_0x422216(0x123),'url':_0x2ad6fc?.['urlN8N'],'headers':{'Content-Type':_0x422216(0x15a)},'json':_0x1873bd};try{(0x0,request_1[_0x422216(0x1a8)])(_0x509374,function(_0x1219b7,_0x42cd55){const _0x3cf068=_0x422216;if(_0x1219b7)throw new Error(_0x1219b7);else console[_0x3cf068(0x1c5)](_0x42cd55[_0x3cf068(0x269)]);});}catch(_0x28c4d1){throw new Error(_0x28c4d1);}}}else _0x2ad6fc[_0x422216(0x187)]===_0x422216(0x1cd)&&await(0x0,typebotListener_1[_0x422216(0x1a8)])({'ticket':_0x38e6dd,'msg':_0x1873bd,'wbot':_0x2fb0ed,'typebot':_0x2ad6fc});};exports[a560_0x4c9181(0x20c)]=handleMessageIntegration;const messageContainsMedia=_0x3e8453=>{const _0x4fadc3=a560_0x4c9181;return _0x3e8453['message']?.['imageMessage']||_0x3e8453['message']?.[_0x4fadc3(0x10f)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x28e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.['stickerMessage']||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x22e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x2b1)]?.[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x22e)]||_0x3e8453['message']?.[_0x4fadc3(0x117)]?.[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x10f)]||_0x3e8453[_0x4fadc3(0x1a9)]?.['ephemeralMessage']?.[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x22e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x117)]?.['message']?.['videoMessage']||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x117)]?.[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x13a)]||_0x3e8453[_0x4fadc3(0x1a9)]?.['ephemeralMessage']?.[_0x4fadc3(0x1a9)]?.['imageMessage']||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x118)]?.[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x2a9)]||_0x3e8453[_0x4fadc3(0x1a9)]?.['viewOnceMessage']?.['message']?.[_0x4fadc3(0x28e)]||_0x3e8453['message']?.['ephemeralMessage']?.[_0x4fadc3(0x1a9)]?.['viewOnceMessage']?.['message']?.[_0x4fadc3(0x2a9)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x117)]?.[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x118)]?.[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x28e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x117)]?.[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x118)]?.[_0x4fadc3(0x1a9)]?.['audioMessage']||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x117)]?.[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x118)]?.[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x22e)]||_0x3e8453['message']?.[_0x4fadc3(0x2b1)]?.[_0x4fadc3(0x1a9)]?.['documentMessage']||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x1f7)]?.[_0x4fadc3(0x12b)]?.['imageMessage']||_0x3e8453['message']?.[_0x4fadc3(0x1f7)]?.['hydratedTemplate']?.[_0x4fadc3(0x22e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x1f7)]?.[_0x4fadc3(0x12b)]?.[_0x4fadc3(0x28e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x1f7)]?.[_0x4fadc3(0x210)]?.['imageMessage']||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x1f7)]?.[_0x4fadc3(0x210)]?.[_0x4fadc3(0x22e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x1f7)]?.[_0x4fadc3(0x210)]?.[_0x4fadc3(0x28e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x1f7)]?.[_0x4fadc3(0x281)]?.[_0x4fadc3(0x2a9)]||_0x3e8453['message']?.[_0x4fadc3(0x1f7)]?.[_0x4fadc3(0x281)]?.[_0x4fadc3(0x22e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x1f7)]?.[_0x4fadc3(0x281)]?.[_0x4fadc3(0x28e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x1bd)]?.[_0x4fadc3(0x215)]?.[_0x4fadc3(0x2a9)]||_0x3e8453[_0x4fadc3(0x1a9)]?.['interactiveMessage']?.[_0x4fadc3(0x215)]?.['documentMessage']||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x1bd)]?.[_0x4fadc3(0x215)]?.[_0x4fadc3(0x28e)]||_0x3e8453['message']?.[_0x4fadc3(0x27b)]?.[_0x4fadc3(0x170)]?.[_0x4fadc3(0x12b)]?.[_0x4fadc3(0x22e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.['highlyStructuredMessage']?.['hydratedHsm']?.['hydratedTemplate']?.[_0x4fadc3(0x28e)]||_0x3e8453[_0x4fadc3(0x1a9)]?.[_0x4fadc3(0x27b)]?.['hydratedHsm']?.[_0x4fadc3(0x12b)]?.[_0x4fadc3(0x2a9)]||_0x3e8453[_0x4fadc3(0x1a9)]?.['highlyStructuredMessage']?.[_0x4fadc3(0x170)]?.[_0x4fadc3(0x12b)]?.[_0x4fadc3(0x213)];},handleMessage=async(_0x2ad700,_0x5593,_0x570a61,_0x189081=![])=>{const _0x4c0450=a560_0x4c9181;if(_0x189081){console[_0x4c0450(0x1c5)]('Importando\x20mensagens!!');let _0x46f81c=_0x2ad700[_0x4c0450(0x1b3)]['id'],_0x2e74bb=await Message_1[_0x4c0450(0x1a8)]['count']({'where':{'id':_0x46f81c}});if(_0x2e74bb>0x0){await new Promise(_0x3bf13a=>setTimeout(_0x3bf13a,0x96));return;}else await new Promise(_0x57c2a9=>setTimeout(_0x57c2a9,0x14a));}let _0x32d59b;if(!(0x0,exports[_0x4c0450(0x15b)])(_0x2ad700)){console['log']('Mensagem\x20inválida!'),console[_0x4c0450(0x1c5)](_0x2ad700);return;}_0x2ad700[_0x4c0450(0x1a9)]?.['ephemeralMessage']&&(_0x2ad700[_0x4c0450(0x1a9)]=_0x2ad700[_0x4c0450(0x1a9)][_0x4c0450(0x117)]['message']);try{let _0x37361d;const _0xdba4fb=_0x2ad700['key'][_0x4c0450(0x14b)]?.['endsWith'](_0x4c0450(0x131)),_0xe08426=await Setting_1[_0x4c0450(0x1a8)][_0x4c0450(0x217)]({'where':{'companyId':_0x570a61,'key':'CheckMsgIsGroup'}});if(_0xe08426?.[_0x4c0450(0x1d4)]===_0x4c0450(0x27c)&&_0xdba4fb){console[_0x4c0450(0x1c5)]('Mensagem\x20de\x20grupo\x20bloqueada!');return;}let _0x3c87a4=(0x0,exports[_0x4c0450(0x14d)])(_0x2ad700);const _0x35eea1=getTypeMessage(_0x2ad700);typeof _0x3c87a4===_0x4c0450(0x1b5)&&(_0x3c87a4=_0x3c87a4['replace'](/\u200c/,''));const _0x1e9b15=messageContainsMedia(_0x2ad700);if(_0x2ad700['key'][_0x4c0450(0x25c)]){if(!_0x1e9b15&&_0x35eea1!==_0x4c0450(0x270)&&_0x35eea1!==_0x4c0450(0x206)&&_0x35eea1!==_0x4c0450(0x120)&&_0x35eea1!==_0x4c0450(0x16a)&&_0x35eea1!=='ephemeralMessage'&&_0x35eea1!=='protocolMessage'&&_0x35eea1!==_0x4c0450(0x1ae)&&_0x35eea1!==_0x4c0450(0x118)&&_0x35eea1!==_0x4c0450(0x213)&&_0x35eea1!==_0x4c0450(0x295)&&_0x35eea1!=='advertising'){console[_0x4c0450(0x286)](_0x35eea1);return;}}const _0x4af204=await(0x0,ShowWhatsAppService_1[_0x4c0450(0x1a8)])(_0x5593['id'],_0x570a61);let _0x213afe,_0x5eb92f=await getContactMessage(_0x2ad700,_0x5593);_0x37361d=await verifyContact(_0x5eb92f,_0x5593,_0x570a61);if(_0xdba4fb){if(!_0x4af204[_0x4c0450(0x165)])return;try{const _0x5d7e38=await _0x5593[_0x4c0450(0x18c)](_0x2ad700[_0x4c0450(0x1b3)][_0x4c0450(0x14b)]),_0x31b95a={'id':_0x5d7e38['id'],'name':_0x5d7e38[_0x4c0450(0x201)]};_0x213afe=await verifyContact(_0x31b95a,_0x5593,_0x570a61);}catch(_0x438254){console[_0x4c0450(0x1c5)](_0x4c0450(0x2a3)),console[_0x4c0450(0x1c5)](_0x438254);return;}}let _0x53091b=0x0;if(_0x2ad700[_0x4c0450(0x1b3)][_0x4c0450(0x25c)])await cache_1['cacheLayer'][_0x4c0450(0x137)](_0x4c0450(0x192)+_0x37361d['id']+_0x4c0450(0x1cc),'0');else{const _0x538382=await cache_1[_0x4c0450(0x1f5)][_0x4c0450(0x254)]('contacts:'+_0x37361d['id']+':unreads');_0x53091b=+_0x538382+0x1,await cache_1[_0x4c0450(0x1f5)]['set'](_0x4c0450(0x192)+_0x37361d['id']+_0x4c0450(0x1cc),''+_0x53091b);}const _0x35cc46=await(0x0,FindOrCreateTicketService_1[_0x4c0450(0x1a8)])(_0x37361d,_0x5593['id'],_0x53091b,_0x570a61,_0x213afe,_0x189081),_0x208aa4=await(0x0,FindOrCreateATicketTrakingService_1[_0x4c0450(0x1a8)])({'ticketId':_0x35cc46['id'],'companyId':_0x570a61,'whatsappId':_0x4af204?.['id']});_0x208aa4['changed'](_0x4c0450(0x208),!![]),await _0x208aa4[_0x4c0450(0x29b)]({'updatedAt':new Date()}),await(0x0,providers_1[_0x4c0450(0x205)])(_0x35cc46,_0x2ad700,_0x570a61,_0x37361d,_0x5593);if(_0x4af204[_0x4c0450(0x17f)]&&_0x53091b===0x0){const _0x5851cd=await Message_1['default'][_0x4c0450(0x217)]({'where':{'contactId':_0x37361d['id'],'companyId':_0x570a61},'order':[[_0x4c0450(0x23c),'DESC']]});if((0x0,Mustache_1[_0x4c0450(0x1a8)])(_0x4af204[_0x4c0450(0x17f)],_0x35cc46)['trim']()[_0x4c0450(0x177)]()===_0x5851cd?.[_0x4c0450(0x269)]['trim']()['toLowerCase']())return;}if(_0x3c87a4=='#'&&!_0x189081&&(!_0x35cc46[_0x4c0450(0x12d)]||_0x35cc46[_0x4c0450(0x15d)]==_0x4c0450(0x22a))){await _0x35cc46[_0x4c0450(0x29b)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x5593,_0x2ad700,_0x35cc46,_0x35cc46[_0x4c0450(0x148)]);return;}try{if(!_0x2ad700[_0x4c0450(0x1b3)][_0x4c0450(0x25c)]&&!_0x189081){if(_0x3c87a4!=null&&typeof _0x3c87a4!=='string'){console[_0x4c0450(0x1c5)](_0x3c87a4),console[_0x4c0450(0x286)](_0x4c0450(0x153),typeof _0x3c87a4);return;}if(_0x3c87a4?.[_0x4c0450(0x25f)]()===_0x4c0450(0x114)&&_0x35cc46[_0x4c0450(0x15d)]!='closed'){await(0x0,SendPresenceStatus_1[_0x4c0450(0x167)])(_0x5593,_0x35cc46[_0x4c0450(0x148)]['number']+'@'+(_0x35cc46[_0x4c0450(0x1c9)]?_0x4c0450(0x233):_0x4c0450(0x26d)));const _0x3f7315=await _0x5593[_0x4c0450(0x252)](_0x35cc46[_0x4c0450(0x148)][_0x4c0450(0x11f)]+'@'+(_0x35cc46['isGroup']?_0x4c0450(0x233):_0x4c0450(0x26d)),{'text':_0x4c0450(0x211)});await(0x0,exports[_0x4c0450(0x240)])(_0x3f7315,_0x35cc46,_0x35cc46['contact']),await(0x0,UpdateTicketService_1[_0x4c0450(0x1a8)])({'ticketData':{'queueId':null,'status':_0x4c0450(0x20f)},'ticketId':_0x35cc46['id'],'companyId':_0x35cc46[_0x4c0450(0x174)]}),await _0x35cc46['reload']();return;}}}catch(_0x536185){console['log'](_0x4c0450(0x1bf)),console[_0x4c0450(0x1c5)](_0x536185),Sentry['captureException'](_0x536185);}try{await _0x35cc46[_0x4c0450(0x29b)]({'fromMe':_0x2ad700['key']['fromMe']});}catch(_0x267ad7){console[_0x4c0450(0x1c5)]('Erro\x20ao\x20salvar\x20ticket!'),console[_0x4c0450(0x1c5)](_0x267ad7),Sentry['captureException'](_0x267ad7);}try{if(!_0x2ad700['key'][_0x4c0450(0x25c)]){if((0x0,exports[_0x4c0450(0x168)])(_0x208aa4)){await(0x0,exports[_0x4c0450(0x142)])(_0x2ad700,_0x35cc46,_0x208aa4),console[_0x4c0450(0x1c5)]('Mensagem\x20inválida\x208!\x20'+_0x2ad700);return;}}}catch(_0x4ea5e5){console[_0x4c0450(0x1c5)](_0x4c0450(0x1de)),Sentry[_0x4c0450(0x296)](_0x4ea5e5),console['log'](_0x4ea5e5);}_0x1e9b15?_0x32d59b=await verifyMediaMessage(_0x2ad700,_0x35cc46,_0x37361d):await(0x0,exports['verifyMessage'])(_0x2ad700,_0x35cc46,_0x37361d);const _0x4146db=await(0x0,VerifyCurrentSchedule_1[_0x4c0450(0x1a8)])(_0x570a61),_0x5bb6c2=await Setting_1[_0x4c0450(0x1a8)]['findOne']({'where':{'companyId':_0x570a61,'key':_0x4c0450(0x19d)}});if(!_0x2ad700[_0x4c0450(0x1b3)][_0x4c0450(0x25c)]&&_0x5bb6c2&&!_0x189081)await handleOutOfHour(_0x5593,_0x35cc46,_0x5bb6c2,_0x37361d,_0x4146db,_0x4af204);!_0x35cc46[_0x4c0450(0x274)]&&!_0xdba4fb&&!_0x2ad700[_0x4c0450(0x1b3)][_0x4c0450(0x25c)]&&!_0x35cc46[_0x4c0450(0x12d)]&&!(0x0,lodash_1[_0x4c0450(0x27d)])(_0x4af204[_0x4c0450(0x110)])&&!_0x189081&&await handleOpenAi(_0x2ad700,_0x5593,_0x35cc46,_0x37361d,_0x32d59b);if(!_0x2ad700[_0x4c0450(0x1b3)][_0x4c0450(0x25c)]&&!_0x35cc46[_0x4c0450(0x1c9)]&&!_0x35cc46[_0x4c0450(0x274)]&&!_0x35cc46[_0x4c0450(0x21d)]&&_0x35cc46[_0x4c0450(0x194)]&&!(0x0,lodash_1[_0x4c0450(0x27d)])(_0x4af204[_0x4c0450(0x141)])&&!_0x35cc46[_0x4c0450(0x1b4)]&&!_0x189081){const _0x35e758=await(0x0,ShowQueueIntegrationService_1['default'])(_0x4af204[_0x4c0450(0x141)],_0x570a61);await(0x0,exports[_0x4c0450(0x20c)])(_0x2ad700,_0x5593,_0x35e758,_0x35cc46);return;}!_0xdba4fb&&!_0x2ad700[_0x4c0450(0x1b3)]['fromMe']&&!_0x35cc46[_0x4c0450(0x12d)]&&!(0x0,lodash_1[_0x4c0450(0x27d)])(_0x35cc46[_0x4c0450(0x110)])&&_0x35cc46[_0x4c0450(0x1b4)]&&!_0x189081&&await handleOpenAi(_0x2ad700,_0x5593,_0x35cc46,_0x37361d,_0x32d59b);if(!_0x2ad700[_0x4c0450(0x1b3)][_0x4c0450(0x25c)]&&!_0x35cc46[_0x4c0450(0x1c9)]&&!_0x35cc46['userId']&&_0x35cc46['integrationId']&&_0x35cc46[_0x4c0450(0x1b4)]&&!_0x189081){const _0x21b234=await(0x0,ShowQueueIntegrationService_1['default'])(_0x35cc46[_0x4c0450(0x141)],_0x570a61);await(0x0,exports['handleMessageIntegration'])(_0x2ad700,_0x5593,_0x21b234,_0x35cc46);}!_0x35cc46[_0x4c0450(0x274)]&&!_0x35cc46['isGroup']&&!_0x2ad700[_0x4c0450(0x1b3)][_0x4c0450(0x25c)]&&!_0x35cc46[_0x4c0450(0x12d)]&&_0x4af204[_0x4c0450(0x23e)][_0x4c0450(0x136)]>=0x1&&!_0x35cc46[_0x4c0450(0x1b4)]&&!_0x189081&&(await verifyQueue(_0x5593,_0x2ad700,_0x35cc46,_0x37361d),_0x208aa4[_0x4c0450(0x267)]('chatbotAt',!![]),_0x208aa4[_0x4c0450(0x267)](_0x4c0450(0x208),!![]),await _0x208aa4['update']({'chatbotAt':(0x0,moment_1[_0x4c0450(0x1a8)])()['toDate'](),'updatedAt':new Date()}));const _0x5b5cd6=_0x35cc46[_0x4c0450(0x274)]===null;await _0x35cc46['reload']();if(!_0x189081&&_0x4af204['greetingMessage'])await greetingMessage(_0x5593,_0x35cc46,_0x2ad700,_0x4af204,_0xdba4fb);_0x4af204[_0x4c0450(0x23e)][_0x4c0450(0x136)]==0x1&&_0x35cc46[_0x4c0450(0x274)]&&!_0x189081&&(_0x35cc46['chatbot']&&!_0x2ad700[_0x4c0450(0x1b3)][_0x4c0450(0x25c)]&&!_0x35cc46['userId']&&await handleChartbot(_0x35cc46,_0x2ad700,_0x5593,_0x4af204)),_0x4af204[_0x4c0450(0x23e)][_0x4c0450(0x136)]>0x1&&_0x35cc46[_0x4c0450(0x274)]&&!_0x189081&&(_0x35cc46['chatbot']&&!_0x2ad700[_0x4c0450(0x1b3)][_0x4c0450(0x25c)]&&!_0x35cc46[_0x4c0450(0x12d)]&&await handleChartbot(_0x35cc46,_0x2ad700,_0x5593,_0x4af204,_0x5b5cd6));}catch(_0x376c9f){console[_0x4c0450(0x1c5)](_0x376c9f),Sentry[_0x4c0450(0x296)](_0x376c9f),logger_1['logger']['error']('Error\x20handling\x20whatsapp\x20message:\x20Err:\x20'+_0x376c9f);}};exports[a560_0x4c9181(0x289)]=handleMessage;const handleOutOfHour=async(_0x56fa37,_0x5e7543,_0x3aa7da,_0x1bf408,_0x2fffe6,_0x273dfb)=>{const _0x102763=a560_0x4c9181;try{if(outOfHourMessageControl[_0x102763(0x136)]>0x1388)outOfHourMessageControl=[];let _0x1d1c97=outOfHourMessageControl[_0x102763(0x1b9)](_0x35fba3=>_0x35fba3[_0x102763(0x1c3)]===_0x5e7543['id']||_0x35fba3[_0x102763(0x222)]===_0x1bf408['number']);if(_0x3aa7da[_0x102763(0x1d4)]===_0x102763(0x1c1)&&!(0x0,lodash_1[_0x102763(0x27d)])(_0x2fffe6)&&_0x273dfb[_0x102763(0x28f)]&&(!_0x2fffe6||_0x2fffe6[_0x102763(0x2b3)]===![])){if(!_0x1d1c97||_0x1d1c97&&_0x1d1c97[_0x102763(0x17c)]+0x3e8*0x3c*0x5<new Date()['getTime']()){_0x1d1c97&&(outOfHourMessageControl=outOfHourMessageControl['filter'](_0x30a1d1=>_0x30a1d1[_0x102763(0x1c3)]!==_0x5e7543['id']),_0x1d1c97=null);if(!_0x1d1c97)outOfHourMessageControl['push']({'ticketId':_0x5e7543['id'],'dest':_0x1bf408[_0x102763(0x11f)],'time':new Date()[_0x102763(0x24a)]()});const _0x1e832d='‎\x20'+_0x273dfb[_0x102763(0x28f)],_0x3565e7=(0x0,Debounce_1[_0x102763(0x16c)])(async()=>{const _0x34d3e7=_0x102763;await _0x56fa37[_0x34d3e7(0x252)](_0x5e7543[_0x34d3e7(0x148)][_0x34d3e7(0x11f)]+'@'+(_0x5e7543[_0x34d3e7(0x1c9)]?_0x34d3e7(0x233):_0x34d3e7(0x26d)),{'text':_0x1e832d});},(0x0,queues_1[_0x102763(0x1b6)])(0x5dc,0xdac),_0x5e7543['id']);_0x3565e7();return;}}if(_0x3aa7da['value']==='queue'&&_0x5e7543[_0x102763(0x169)]!==null){const _0x3065c5=await Queue_1[_0x102763(0x1a8)][_0x102763(0x115)](_0x5e7543[_0x102763(0x169)]),{schedules:_0x20771e}=_0x3065c5,_0xecdadf=(0x0,moment_1[_0x102763(0x1a8)])(),_0x486e3b=_0xecdadf[_0x102763(0x1c2)]('dddd')[_0x102763(0x177)]();let _0x4c4b02=null;Array[_0x102763(0x135)](_0x20771e)&&_0x20771e[_0x102763(0x136)]>0x0&&(_0x4c4b02=_0x20771e[_0x102763(0x1b9)](_0x416135=>_0x416135[_0x102763(0x218)]===_0x486e3b&&_0x416135[_0x102763(0x2b9)]!==''&&_0x416135['startTime']!==null&&_0x416135[_0x102763(0x214)]!==''&&_0x416135[_0x102763(0x214)]!==null));if(_0x3aa7da[_0x102763(0x1d4)]===_0x102763(0x274)&&_0x3065c5['outOfHoursMessage']!==null&&_0x3065c5[_0x102763(0x28f)]!==''&&!(0x0,lodash_1[_0x102763(0x27d)])(_0x4c4b02)){const _0x32ff50=(0x0,moment_1['default'])(_0x4c4b02[_0x102763(0x2b9)],_0x102763(0x23a)),_0x3795c3=(0x0,moment_1[_0x102763(0x1a8)])(_0x4c4b02[_0x102763(0x214)],'HH:mm');let _0x39514c=_0xecdadf[_0x102763(0x285)](_0x32ff50)||_0xecdadf[_0x102763(0x1ea)](_0x3795c3);if(!_0x39514c){if(_0x4c4b02['startLunchTime']&&_0x4c4b02[_0x102763(0x25b)]){const _0x49c468=(0x0,moment_1[_0x102763(0x1a8)])(_0x4c4b02[_0x102763(0x1e2)],'HH:mm'),_0x56f3dc=(0x0,moment_1['default'])(_0x4c4b02[_0x102763(0x25b)],_0x102763(0x23a));_0x39514c=_0xecdadf[_0x102763(0x198)](_0x49c468,_0x56f3dc);}}if(_0x39514c){if(!_0x1d1c97||_0x1d1c97&&_0x1d1c97[_0x102763(0x17c)]+0x3e8*0x3c*0x1e<new Date()[_0x102763(0x24a)]()){const _0x234a85=_0x3065c5[_0x102763(0x28f)],_0x113c51=(0x0,Debounce_1[_0x102763(0x16c)])(async()=>{const _0x1de47c=_0x102763;await _0x56fa37[_0x1de47c(0x252)](_0x5e7543[_0x1de47c(0x148)]['number']+'@'+(_0x5e7543['isGroup']?_0x1de47c(0x233):_0x1de47c(0x26d)),{'text':_0x234a85});},(0x0,queues_1[_0x102763(0x1b6)])(0x3e8,0xbb8),_0x5e7543['id']);_0x113c51();return;}if(!_0x1d1c97)outOfHourMessageControl[_0x102763(0x14c)]({'ticketId':_0x5e7543['id'],'dest':_0x1bf408[_0x102763(0x11f)],'time':new Date()[_0x102763(0x24a)]()});}}}}catch(_0x984a21){Sentry[_0x102763(0x296)](_0x984a21),console['log'](_0x984a21);}},greetingMessage=async(_0x5596ff,_0x506e81,_0x5a52b0,_0x52b86b,_0x5e4773)=>{const _0x329657=a560_0x4c9181;if(!_0x52b86b?.['queues']?.[_0x329657(0x136)]&&!_0x506e81[_0x329657(0x12d)]&&!_0x5e4773&&!_0x5a52b0[_0x329657(0x1b3)]['fromMe']){if(process[_0x329657(0x14f)][_0x329657(0x1ab)]?.['length']>=0x8){if(_0x506e81[_0x329657(0x148)][_0x329657(0x11f)]!=process[_0x329657(0x14f)][_0x329657(0x1ab)])return;}if(greetingMessageControl[_0x329657(0x136)]>0x1388)greetingMessageControl=[];var _0x7cc30=greetingMessageControl[_0x329657(0x1b9)](_0xa20902=>_0xa20902[_0x329657(0x1c3)]===_0x506e81['id']||_0xa20902[_0x329657(0x222)]===_0x506e81['contact'][_0x329657(0x11f)]);if(_0x7cc30&&_0x7cc30['time']+0x3e8*0x3c*0x5>=new Date()[_0x329657(0x24a)]())return;const _0x12e742=await Message_1[_0x329657(0x1a8)][_0x329657(0x217)]({'where':{'ticketId':_0x506e81['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x329657(0x1d3)]]:(0x0,moment_1[_0x329657(0x1a8)])()['subtract'](0x5,'minutes')[_0x329657(0x239)]()}}});if(_0x12e742)return;const _0x201eca=(0x0,Debounce_1['debounce'])(async()=>{const _0x3ce0c2=_0x329657;if(!_0x52b86b[_0x3ce0c2(0x25d)])await _0x5596ff['sendMessage'](_0x506e81['contact'][_0x3ce0c2(0x11f)]+'@'+(_0x506e81[_0x3ce0c2(0x1c9)]?'g.us':'s.whatsapp.net'),{'text':(0x0,Mustache_1[_0x3ce0c2(0x1a8)])(_0x52b86b[_0x3ce0c2(0x268)],_0x506e81)});else{const _0x5e501b=path_1[_0x3ce0c2(0x1a8)][_0x3ce0c2(0x220)]('public',_0x3ce0c2(0x1c1)+_0x506e81[_0x3ce0c2(0x174)],_0x52b86b[_0x3ce0c2(0x25d)]),_0x58c2e8=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x52b86b['greetingMediaAttachment'],_0x5e501b,_0x52b86b['greetingMessage'],_0x506e81[_0x3ce0c2(0x174)]);await _0x5596ff[_0x3ce0c2(0x252)](_0x506e81[_0x3ce0c2(0x148)][_0x3ce0c2(0x11f)]+'@'+(_0x506e81['isGroup']?_0x3ce0c2(0x233):'s.whatsapp.net'),{..._0x58c2e8});}},0x3e8,_0x506e81['id']);_0x201eca();return;}},handleMsgAck=async(_0x28451a,_0x4c54cb)=>{const _0x5ad242=a560_0x4c9181,_0x30f958=(0x0,socket_1[_0x5ad242(0x13f)])();try{const _0x3b509c=await Message_1[_0x5ad242(0x1a8)][_0x5ad242(0x115)](_0x28451a[_0x5ad242(0x1b3)]['id'],{'include':[_0x5ad242(0x148),{'model':Message_1['default'],'as':_0x5ad242(0x10a),'include':['contact']}]});if(!_0x3b509c){console[_0x5ad242(0x1c5)](_0x28451a),console[_0x5ad242(0x1c5)]('Mensagem\x20não\x20encontrada!');return;}await _0x3b509c[_0x5ad242(0x29b)]({'ack':_0x4c54cb}),_0x30f958['to'](_0x3b509c[_0x5ad242(0x1c3)][_0x5ad242(0x2ac)]())['emit'](_0x5ad242(0x11d)+_0x3b509c['companyId']+_0x5ad242(0x12e),{'action':_0x5ad242(0x29b),'message':_0x3b509c});}catch(_0x34a127){Sentry[_0x5ad242(0x296)](_0x34a127),logger_1[_0x5ad242(0x1d2)][_0x5ad242(0x1f4)](_0x5ad242(0x196)+_0x34a127);}};exports['handleMsgAck']=handleMsgAck;const verifyRecentCampaign=async(_0x2d8a8a,_0x20c7af)=>{const _0x1c6aab=a560_0x4c9181;if(!_0x2d8a8a[_0x1c6aab(0x1b3)][_0x1c6aab(0x25c)]){const _0x3eb4ee=_0x2d8a8a['key'][_0x1c6aab(0x14b)]['replace'](/\D/g,''),_0x93e5e5=await Campaign_1[_0x1c6aab(0x1a8)][_0x1c6aab(0x1f3)]({'where':{'companyId':_0x20c7af,'status':_0x1c6aab(0x234),'confirmation':!![]}});if(_0x93e5e5){const _0x389b48=_0x93e5e5[_0x1c6aab(0x284)](_0xf08c6=>_0xf08c6['id']),_0x5aa4cd=await CampaignShipping_1[_0x1c6aab(0x1a8)][_0x1c6aab(0x217)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x389b48},'number':_0x3eb4ee,'confirmation':null}});_0x5aa4cd&&(await _0x5aa4cd[_0x1c6aab(0x29b)]({'confirmedAt':(0x0,moment_1[_0x1c6aab(0x1a8)])(),'confirmation':!![]}),await queues_1[_0x1c6aab(0x28b)][_0x1c6aab(0x11b)]('DispatchCampaign',{'campaignShippingId':_0x5aa4cd['id'],'campaignId':_0x5aa4cd[_0x1c6aab(0x132)]},{'delay':(0x0,queues_1[_0x1c6aab(0x180)])((0x0,queues_1[_0x1c6aab(0x1b6)])(0x0,0xa))}));}}};exports[a560_0x4c9181(0x24c)]=verifyRecentCampaign;const verifyCampaignMessageAndCloseTicket=async(_0xff58b3,_0x47c1b8)=>{const _0x4e4942=a560_0x4c9181,_0x43f631=(0x0,socket_1[_0x4e4942(0x13f)])(),_0x38bd01=(0x0,exports['getBodyMessage'])(_0xff58b3),_0x238ea1=/\u200c/[_0x4e4942(0x11e)](_0x38bd01);if(_0xff58b3['key'][_0x4e4942(0x25c)]&&_0x238ea1){const _0x20a7e6=await Message_1['default']['findOne']({'where':{'id':_0xff58b3[_0x4e4942(0x1b3)]['id'],'companyId':_0x47c1b8}}),_0x2354e5=await Ticket_1[_0x4e4942(0x1a8)]['findByPk'](_0x20a7e6[_0x4e4942(0x1c3)]);await _0x2354e5[_0x4e4942(0x29b)]({'status':_0x4e4942(0x20f)}),_0x43f631['to'](_0x4e4942(0x11d)+_0x2354e5['companyId']+_0x4e4942(0x13b))['emit'](_0x4e4942(0x11d)+_0x2354e5['companyId']+'-ticket',{'action':_0x4e4942(0x1aa),'ticket':_0x2354e5,'ticketId':_0x2354e5['id']}),_0x43f631['to']('company-'+_0x47c1b8+'-'+_0x2354e5['status'])['to'](_0x2354e5['id'][_0x4e4942(0x2ac)]())['emit'](_0x4e4942(0x11d)+_0x2354e5[_0x4e4942(0x174)]+_0x4e4942(0x1c7),{'action':_0x4e4942(0x29b),'ticket':_0x2354e5,'ticketId':_0x2354e5['id']});}};exports['verifyCampaignMessageAndCloseTicket']=verifyCampaignMessageAndCloseTicket;const filterMessages=_0x6e3e46=>{const _0x538586=a560_0x4c9181;if([baileys_1[_0x538586(0x2cf)][_0x538586(0x1cb)],baileys_1['WAMessageStubType'][_0x538586(0x1dd)],baileys_1['WAMessageStubType'][_0x538586(0x202)],baileys_1[_0x538586(0x2cf)][_0x538586(0x151)]][_0x538586(0x279)](_0x6e3e46['messageStubType']))return![];return!![];},wbotMessageListener=async(_0x2229c2,_0x313bb1,_0x3c39f9)=>{const _0x4e8772=a560_0x4c9181;_0x2229c2['ev']['on'](_0x4e8772(0x29a),async _0x2a9a22=>{const _0x46da05=_0x4e8772,_0x501a30=_0x2a9a22[_0x46da05(0x19a)][_0x46da05(0x1af)](filterMessages);if(!_0x501a30)return;await app_1['default'][_0x46da05(0x254)](_0x46da05(0x23e))[_0x46da05(0x25e)][_0x46da05(0x11b)](_0x46da05(0x2c6),{'whatsappId':_0x3c39f9['id'],'messages':_0x501a30,'companyId':_0x313bb1},{'removeOnComplete':!![],'attempts':0x3});}),_0x2229c2['ev']['on'](_0x4e8772(0x2b7),async _0x48679a=>{const _0x178ac2=_0x4e8772;if(_0x48679a['length']===0x0)return;await app_1[_0x178ac2(0x1a8)]['get'](_0x178ac2(0x23e))[_0x178ac2(0x25e)][_0x178ac2(0x11b)](_0x178ac2(0x122),{'whatsappId':_0x3c39f9['id'],'messageUpdate':_0x48679a,'companyId':_0x313bb1},{'removeOnComplete':!![],'attempts':0x3,'delay':0x64});}),_0x2229c2['ev']['on'](_0x4e8772(0x248),async _0x574e43=>{const _0xfd52b9=_0x4e8772;console[_0xfd52b9(0x1c5)](_0x574e43);if(_0x574e43['length']===0x0)return;for(const _0x1a3cd8 of _0x574e43){const _0xc74ccd=_0x1a3cd8['id'][_0xfd52b9(0x266)]('@')[0x0],_0x5d56eb=_0x1a3cd8['subject']||_0xc74ccd,_0x4de5c9={'name':_0x5d56eb,'number':_0xc74ccd,'isGroup':!![],'companyId':_0x313bb1,'remoteJid':_0x1a3cd8['id'],'whatsappId':_0x2229c2['id']};await(0x0,CreateOrUpdateContactService_1[_0xfd52b9(0x1a8)])(_0x4de5c9,_0x2229c2,_0x1a3cd8['id']);}});};exports['wbotMessageListener']=wbotMessageListener;