'use strict';function a696_0x33cd(_0x2e2ad0,_0x5353fb){const _0x3ca32d=a696_0xd6b1();return a696_0x33cd=function(_0x1f7c48,_0x38a2c1){_0x1f7c48=_0x1f7c48-0x11c;let _0xd6b1f5=_0x3ca32d[_0x1f7c48];return _0xd6b1f5;},a696_0x33cd(_0x2e2ad0,_0x5353fb);}const a696_0xd7f3be=a696_0x33cd;(function(_0xfb096f,_0x5edb8f){const _0x10a1ec=a696_0x33cd,_0x55e3e8=_0xfb096f();while(!![]){try{const _0x13eef5=-parseInt(_0x10a1ec(0x1d3))/0x1+-parseInt(_0x10a1ec(0x1f2))/0x2+-parseInt(_0x10a1ec(0x184))/0x3+-parseInt(_0x10a1ec(0x1e5))/0x4+-parseInt(_0x10a1ec(0x125))/0x5+parseInt(_0x10a1ec(0x12a))/0x6+parseInt(_0x10a1ec(0x175))/0x7;if(_0x13eef5===_0x5edb8f)break;else _0x55e3e8['push'](_0x55e3e8['shift']());}catch(_0x341b0b){_0x55e3e8['push'](_0x55e3e8['shift']());}}}(a696_0xd6b1,0x74e3d));var __createBinding=this&&this[a696_0xd7f3be(0x1b5)]||(Object[a696_0xd7f3be(0x131)]?function(_0x2febc0,_0x13c375,_0x65daf1,_0x263b25){const _0x60c2e0=a696_0xd7f3be;if(_0x263b25===undefined)_0x263b25=_0x65daf1;var _0xb8eb10=Object[_0x60c2e0(0x199)](_0x13c375,_0x65daf1);(!_0xb8eb10||('get'in _0xb8eb10?!_0x13c375['__esModule']:_0xb8eb10[_0x60c2e0(0x122)]||_0xb8eb10[_0x60c2e0(0x178)]))&&(_0xb8eb10={'enumerable':!![],'get':function(){return _0x13c375[_0x65daf1];}}),Object[_0x60c2e0(0x16e)](_0x2febc0,_0x263b25,_0xb8eb10);}:function(_0x18cb47,_0x3cdcc2,_0x3867e4,_0x4b00e2){if(_0x4b00e2===undefined)_0x4b00e2=_0x3867e4;_0x18cb47[_0x4b00e2]=_0x3cdcc2[_0x3867e4];}),__setModuleDefault=this&&this[a696_0xd7f3be(0x19c)]||(Object['create']?function(_0x303a91,_0x24474b){const _0x636c8b=a696_0xd7f3be;Object[_0x636c8b(0x16e)](_0x303a91,'default',{'enumerable':!![],'value':_0x24474b});}:function(_0x1a40d2,_0x10ea0f){_0x1a40d2['default']=_0x10ea0f;}),__importStar=this&&this[a696_0xd7f3be(0x148)]||(function(){const _0x57553f=(function(){let _0x4925c0=!![];return function(_0x550e54,_0x240e06){const _0x47f108=_0x4925c0?function(){const _0x16ef7a=a696_0x33cd;if(_0x240e06){const _0x107fce=_0x240e06[_0x16ef7a(0x18d)](_0x550e54,arguments);return _0x240e06=null,_0x107fce;}}:function(){};return _0x4925c0=![],_0x47f108;};}()),_0x1d2279=_0x57553f(this,function(){const _0x43d2bd=a696_0x33cd;return _0x1d2279[_0x43d2bd(0x19b)]()[_0x43d2bd(0x1c9)](_0x43d2bd(0x1b9))[_0x43d2bd(0x19b)]()[_0x43d2bd(0x150)](_0x1d2279)[_0x43d2bd(0x1c9)](_0x43d2bd(0x1b9));});_0x1d2279();var _0x3ca7cf=function(_0x455185){return _0x3ca7cf=Object['getOwnPropertyNames']||function(_0x2c335d){const _0x32500b=a696_0x33cd;var _0x597388=[];for(var _0x128d43 in _0x2c335d)if(Object['prototype']['hasOwnProperty'][_0x32500b(0x12c)](_0x2c335d,_0x128d43))_0x597388[_0x597388['length']]=_0x128d43;return _0x597388;},_0x3ca7cf(_0x455185);};return function(_0xa3a04c){const _0x379c05=a696_0x33cd;if(_0xa3a04c&&_0xa3a04c[_0x379c05(0x1ad)])return _0xa3a04c;var _0x4d0493={};if(_0xa3a04c!=null){for(var _0x276f6a=_0x3ca7cf(_0xa3a04c),_0x4f4d0c=0x0;_0x4f4d0c<_0x276f6a['length'];_0x4f4d0c++)if(_0x276f6a[_0x4f4d0c]!=='default')__createBinding(_0x4d0493,_0xa3a04c,_0x276f6a[_0x4f4d0c]);}return __setModuleDefault(_0x4d0493,_0xa3a04c),_0x4d0493;};}()),__importDefault=this&&this[a696_0xd7f3be(0x1f4)]||function(_0x579ffb){const _0x24dfae=a696_0xd7f3be;return _0x579ffb&&_0x579ffb[_0x24dfae(0x1ad)]?_0x579ffb:{'default':_0x579ffb};};Object[a696_0xd7f3be(0x16e)](exports,'__esModule',{'value':!![]}),exports[a696_0xd7f3be(0x11c)]=exports[a696_0xd7f3be(0x160)]=exports[a696_0xd7f3be(0x193)]=exports[a696_0xd7f3be(0x1eb)]=exports['handleRating']=void 0x0,exports[a696_0xd7f3be(0x146)]=makeid;const Sentry=__importStar(require(a696_0xd7f3be(0x1bb))),lodash_1=require(a696_0xd7f3be(0x134)),baileys_1=require(a696_0xd7f3be(0x139)),async_mutex_1=require(a696_0xd7f3be(0x1ab)),sequelize_1=require(a696_0xd7f3be(0x176)),moment_1=__importDefault(require('moment')),Contact_1=__importDefault(require(a696_0xd7f3be(0x17d))),Ticket_1=__importDefault(require(a696_0xd7f3be(0x180))),Message_1=__importDefault(require('../../models/Message')),socket_1=require(a696_0xd7f3be(0x145)),logger_1=require(a696_0xd7f3be(0x137)),FindOrCreateTicketService_1=__importDefault(require(a696_0xd7f3be(0x15e))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),UpdateTicketService_1=__importDefault(require(a696_0xd7f3be(0x149))),Mustache_1=__importDefault(require('../../helpers/Mustache')),TicketTraking_1=__importDefault(require('../../models/TicketTraking')),UserRating_1=__importDefault(require(a696_0xd7f3be(0x1b7))),SendWhatsAppMessage_1=__importDefault(require(a696_0xd7f3be(0x1df))),Queue_1=__importDefault(require(a696_0xd7f3be(0x189))),FlowBuilder_1=__importDefault(require(a696_0xd7f3be(0x183))),ActionsWebhookService_1=require('../WebhookService/ActionsWebhookService'),VerifyCurrentSchedule_1=__importDefault(require(a696_0xd7f3be(0x14e))),User_1=__importDefault(require('../../models/User')),Setting_1=__importDefault(require(a696_0xd7f3be(0x138))),cache_1=require('../../libs/cache'),Debounce_1=require(a696_0xd7f3be(0x1ea)),CheckSettings_1=require(a696_0xd7f3be(0x1d2)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),simpleObjectCache_1=require('../../helpers/simpleObjectCache'),ShowQueueIntegrationService_1=__importDefault(require(a696_0xd7f3be(0x166))),typebotListener_1=__importDefault(require(a696_0xd7f3be(0x15f))),VerifyHandlers_1=require(a696_0xd7f3be(0x1e0)),GetHandlers_1=require(a696_0xd7f3be(0x151)),wbotMutex=new async_mutex_1[(a696_0xd7f3be(0x16c))](),ackMutex=new async_mutex_1['Mutex'](),groupContactCache=new simpleObjectCache_1[(a696_0xd7f3be(0x161))](0x3e8*0x1e,logger_1[a696_0xd7f3be(0x17f)]),outOfHoursCache=new simpleObjectCache_1[(a696_0xd7f3be(0x161))](0x3e8*0x3c*0x5,logger_1[a696_0xd7f3be(0x17f)]);function makeid(_0x2d93ac){const _0x262685=a696_0xd7f3be;let _0x37effe='';const _0x1c7426=_0x262685(0x198),_0x15b983=_0x1c7426[_0x262685(0x129)];for(let _0x5c0a6a=0x0;_0x5c0a6a<_0x2d93ac;_0x5c0a6a+=0x1){_0x37effe+=_0x1c7426['charAt'](Math[_0x262685(0x1d0)](Math[_0x262685(0x182)]()*_0x15b983));}return _0x37effe;}const isValidMsg=_0x5badda=>{const _0x150ba2=a696_0xd7f3be;if(_0x5badda['key'][_0x150ba2(0x18f)]===_0x150ba2(0x1a1))return![];try{const _0x10b7b7=(0x0,GetHandlers_1[_0x150ba2(0x157)])(_0x5badda);if(!_0x10b7b7)return![];const _0x320f7d=_0x10b7b7===_0x150ba2(0x1ae)||_0x10b7b7===_0x150ba2(0x17a)||_0x10b7b7===_0x150ba2(0x1f0)||_0x10b7b7==='audioMessage'||_0x10b7b7===_0x150ba2(0x130)||_0x10b7b7===_0x150ba2(0x19e)||_0x10b7b7===_0x150ba2(0x1bd)||_0x10b7b7===_0x150ba2(0x17b)||_0x10b7b7==='stickerMessage'||_0x10b7b7===_0x150ba2(0x167)||_0x10b7b7===_0x150ba2(0x1cc)||_0x10b7b7==='messageContextInfo'||_0x10b7b7===_0x150ba2(0x18c)||_0x10b7b7===_0x150ba2(0x1f6)||_0x10b7b7===_0x150ba2(0x1f7)||_0x10b7b7==='voiceMessage'||_0x10b7b7==='mediaMessage'||_0x10b7b7===_0x150ba2(0x144)||_0x10b7b7==='reactionMessage'||_0x10b7b7==='ephemeralMessage'||_0x10b7b7===_0x150ba2(0x1ca)||_0x10b7b7==='listResponseMessage'||_0x10b7b7==='listMessage'||_0x10b7b7===_0x150ba2(0x13d)||_0x10b7b7==='viewOnceMessage'||_0x10b7b7===_0x150ba2(0x1ec);return!_0x320f7d&&(logger_1['logger'][_0x150ba2(0x1e7)](_0x150ba2(0x1e2)+_0x10b7b7+'\x0a'+JSON[_0x150ba2(0x162)](_0x5badda?.[_0x150ba2(0x1b1)])),Sentry['setExtra']('Mensagem',{'BodyMsg':_0x5badda[_0x150ba2(0x1b1)],'msg':_0x5badda,'msgType':_0x10b7b7}),Sentry[_0x150ba2(0x12d)](new Error(_0x150ba2(0x185)))),!!_0x320f7d;}catch(_0x521cbe){return Sentry[_0x150ba2(0x1a2)](_0x150ba2(0x165),{'msg':_0x5badda}),Sentry[_0x150ba2(0x12d)](_0x521cbe),![];}},handleRating=async(_0x59d16c,_0x1954e5,_0x4d1e9a)=>{const _0x44ff57=a696_0xd7f3be,_0x1d2590=(0x0,socket_1[_0x44ff57(0x133)])();let _0x53f191=null;(_0x59d16c?.[_0x44ff57(0x1b1)]?.[_0x44ff57(0x1ae)]||_0x59d16c?.[_0x44ff57(0x1b1)]?.[_0x44ff57(0x1f0)])&&(_0x53f191=parseInt(_0x59d16c[_0x44ff57(0x1b1)]['conversation']||_0x59d16c[_0x44ff57(0x1b1)][_0x44ff57(0x1f0)][_0x44ff57(0x11f)],0xa)||null);if(!Number['isNaN'](_0x53f191)&&Number[_0x44ff57(0x1cf)](_0x53f191)&&!(0x0,lodash_1['isNull'])(_0x53f191)){const _0x1d9e3b=await(0x0,ShowWhatsAppService_1[_0x44ff57(0x1b3)])(_0x1954e5[_0x44ff57(0x190)],_0x1954e5[_0x44ff57(0x13e)]);let _0x3ab606=_0x53f191;_0x53f191<0x1&&(_0x3ab606=0x1);_0x53f191>0x5&&(_0x3ab606=0x5);await UserRating_1[_0x44ff57(0x1b3)][_0x44ff57(0x131)]({'ticketId':_0x4d1e9a[_0x44ff57(0x1f5)],'companyId':_0x4d1e9a[_0x44ff57(0x13e)],'userId':_0x4d1e9a[_0x44ff57(0x1f8)],'rate':_0x3ab606});const _0x104ecc=_0x1d9e3b[_0x44ff57(0x1d5)][_0x44ff57(0x1ac)]()||_0x44ff57(0x140);await(0x0,SendWhatsAppMessage_1[_0x44ff57(0x1b3)])({'ticket':_0x1954e5,'body':_0x104ecc}),await _0x4d1e9a['update']({'finishedAt':(0x0,moment_1[_0x44ff57(0x1b3)])()['toDate'](),'rated':!![]});const _0xba0a1b=await(0x0,CheckSettings_1[_0x44ff57(0x15c)])(_0x1954e5[_0x44ff57(0x13e)],_0x44ff57(0x1c6),_0x44ff57(0x152))==='enabled';await _0x1954e5[_0x44ff57(0x1b4)]({'queueId':_0xba0a1b?_0x1954e5[_0x44ff57(0x156)]:null,'chatbot':null,'userId':_0xba0a1b?_0x1954e5[_0x44ff57(0x1f8)]:null,'status':'closed'}),_0x1d2590['to'](_0x44ff57(0x128)+_0x1954e5[_0x44ff57(0x13e)]+_0x44ff57(0x18a))['to'](_0x44ff57(0x1d4)+_0x1954e5[_0x44ff57(0x156)]+'-open')[_0x44ff57(0x1ce)](_0x44ff57(0x128)+_0x1954e5['companyId']+_0x44ff57(0x164),{'action':'delete','ticket':_0x1954e5,'ticketId':_0x1954e5['id']}),_0x1d2590['to'](_0x44ff57(0x128)+_0x1954e5['companyId']+'-'+_0x1954e5['status'])['to'](_0x44ff57(0x1d4)+_0x1954e5[_0x44ff57(0x156)]+'-'+_0x1954e5['status'])['to'](_0x1954e5['id'][_0x44ff57(0x19b)]())[_0x44ff57(0x1ce)](_0x44ff57(0x128)+_0x1954e5['companyId']+'-ticket',{'action':_0x44ff57(0x1b4),'ticket':_0x1954e5,'ticketId':_0x1954e5['id']});}};exports[a696_0xd7f3be(0x13b)]=handleRating;const handleFlowBuilderExecution=async(_0x349b63,_0x432b68,_0x5e46bc='')=>{const _0x1ea48e=a696_0xd7f3be;console[_0x1ea48e(0x159)]('Iniciando\x20execução\x20do\x20FlowBuilder\x20para\x20ticket\x20'+_0x349b63['id']+_0x1ea48e(0x1a4)+_0x349b63[_0x1ea48e(0x1fa)]);const _0x228419=await FlowBuilder_1[_0x1ea48e(0x1b3)]['findByPk'](_0x349b63['flowBuilderId']);if(!_0x228419||!_0x228419['flow']){console[_0x1ea48e(0x15b)](_0x1ea48e(0x16a)+_0x349b63[_0x1ea48e(0x1fa)]+_0x1ea48e(0x1af));return;}const _0x15bea6=await Whatsapp_1['default'][_0x1ea48e(0x1cb)](_0x349b63[_0x1ea48e(0x190)]),_0x261f1f=await Contact_1[_0x1ea48e(0x1b3)][_0x1ea48e(0x1cb)](_0x349b63[_0x1ea48e(0x174)]);if(!_0x15bea6||!_0x261f1f){console['error'](_0x1ea48e(0x1c4));return;}const _0x847b74={'number':_0x261f1f[_0x1ea48e(0x1e3)],'name':_0x261f1f[_0x1ea48e(0x1c1)],'email':_0x261f1f['email']},_0x57edcb=_0x228419[_0x1ea48e(0x1dc)]['nodes'],_0x512a95=_0x228419['flow'][_0x1ea48e(0x158)]||_0x228419[_0x1ea48e(0x1dc)][_0x1ea48e(0x1de)],_0xe3c8e0=_0x57edcb[_0x1ea48e(0x1da)](_0x2caeb5=>_0x2caeb5[_0x1ea48e(0x123)]===_0x1ea48e(0x16b)),_0xaba10e=_0xe3c8e0?_0xe3c8e0['id']:_0x57edcb[0x0]?.['id']||'1';await _0x349b63[_0x1ea48e(0x1b4)]({'flowWebhook':!![],'flowStopped':String(_0x349b63[_0x1ea48e(0x1fa)])}),await(0x0,ActionsWebhookService_1['ActionsWebhookService'])(_0x15bea6['id'],parseInt(String(_0x349b63[_0x1ea48e(0x1fa)])),_0x349b63[_0x1ea48e(0x13e)],_0x57edcb,_0x512a95,_0xaba10e,null,'','',_0x5e46bc,_0x349b63['id'],_0x847b74,null);};exports['handleFlowBuilderExecution']=handleFlowBuilderExecution;const handleFlowBuilder=async(_0x5308ef,_0x81e405,_0x4465b8)=>{const _0x25c128=a696_0xd7f3be,_0x577a84=_0x81e405[_0x25c128(0x195)]['id'];if(_0x5308ef[_0x25c128(0x1a3)]===_0x577a84){console[_0x25c128(0x159)](_0x25c128(0x141)+_0x577a84+_0x25c128(0x1ba)+_0x5308ef['id']+_0x25c128(0x1be));return;}await _0x5308ef[_0x25c128(0x1b4)]({'lastProcessedMessageId':_0x577a84});const _0x20a7aa=(0x0,GetHandlers_1['getBodyMessage'])(_0x81e405);console[_0x25c128(0x159)](_0x25c128(0x12b)+_0x20a7aa+_0x25c128(0x14b)+_0x5308ef['id']),await(0x0,exports[_0x25c128(0x1eb)])(_0x5308ef,_0x4465b8,_0x20a7aa);},handleMessageIntegration=async(_0x3a535a,_0x10f2a7,_0x5693f5,_0x5e299e)=>{const _0x2ffc89=a696_0xd7f3be;if(process[_0x2ffc89(0x143)][_0x2ffc89(0x187)]){if(_0x5e299e[_0x2ffc89(0x168)][_0x2ffc89(0x1e3)]!=process[_0x2ffc89(0x143)]['CHATBOT_RESTRICT_NUMBER']){console['log'](_0x2ffc89(0x15a));return;}}console[_0x2ffc89(0x159)](_0x2ffc89(0x1cd),_0x5e299e[_0x2ffc89(0x17e)]),_0x5693f5[_0x2ffc89(0x123)]===_0x2ffc89(0x11e)&&!_0x5e299e[_0x2ffc89(0x17e)]?(await(0x0,typebotListener_1[_0x2ffc89(0x1b3)])({'ticket':_0x5e299e,'msg':_0x3a535a,'wbot':_0x10f2a7,'typebot':_0x5693f5}),!_0x5e299e[_0x2ffc89(0x172)]&&(await _0x5e299e[_0x2ffc89(0x1b4)]({'useIntegration':!![],'integrationId':_0x5693f5['id']}),console['log']('Atualizando\x20estado\x20de\x20integração\x20do\x20ticket\x20#'+_0x5e299e['id']))):console['log']('Tipo\x20de\x20integração\x20não\x20suportada.');};exports['handleMessageIntegration']=handleMessageIntegration;const handleMessage=async(_0x266c81,_0xd8698e,_0xd650b3)=>{const _0x1b86c6=a696_0xd7f3be;if(!isValidMsg(_0x266c81))return;_0x266c81[_0x1b86c6(0x1b1)]?.[_0x1b86c6(0x11d)]&&(_0x266c81[_0x1b86c6(0x1b1)]=_0x266c81[_0x1b86c6(0x1b1)]['ephemeralMessage'][_0x1b86c6(0x1b1)]);try{let _0x434f32,_0x25a010;const _0x79453b=_0x266c81[_0x1b86c6(0x195)][_0x1b86c6(0x18f)]?.[_0x1b86c6(0x18e)](_0x1b86c6(0x13a)),_0x3da72b=_0x266c81[_0x1b86c6(0x195)][_0x1b86c6(0x18f)]?.[_0x1b86c6(0x18e)](_0x1b86c6(0x181)),_0x5843c4=_0x266c81[_0x1b86c6(0x195)]['remoteJid']==='status@broadcast';if(_0x5843c4){logger_1['logger']['debug']('Mensagem\x20de\x20status\x20ignorada\x20de:\x20'+_0x266c81[_0x1b86c6(0x195)][_0x1b86c6(0x1e8)]);return;}if(_0x3da72b){logger_1[_0x1b86c6(0x17f)]['info'](_0x1b86c6(0x1b8)+_0x266c81['key'][_0x1b86c6(0x18f)]);return;}if(_0x79453b){const _0x810306=await Setting_1[_0x1b86c6(0x1b3)]['findOne']({'where':{'companyId':_0xd650b3,'key':'CheckMsgIsGroup'}});if(!_0x810306||_0x810306[_0x1b86c6(0x16d)]===_0x1b86c6(0x152))return;}const _0x516840=(0x0,GetHandlers_1[_0x1b86c6(0x1e9)])(_0x266c81),_0x27a226=(0x0,GetHandlers_1[_0x1b86c6(0x157)])(_0x266c81),_0x343de2=_0x27a226!==_0x1b86c6(0x13d)&&(0x0,GetHandlers_1[_0x1b86c6(0x171)])(_0x266c81),_0x2bcf6f=_0x343de2&&(0x0,GetHandlers_1[_0x1b86c6(0x1dd)])(_0x343de2);if(_0x266c81[_0x1b86c6(0x195)][_0x1b86c6(0x1f1)]){if(_0x516840?.['startsWith']('‎'))return;if(!_0x2bcf6f&&_0x27a226!==_0x1b86c6(0x1ae)&&_0x27a226!==_0x1b86c6(0x1f0)&&_0x27a226!==_0x1b86c6(0x18b))return;_0x434f32=await(0x0,GetHandlers_1[_0x1b86c6(0x14a)])(_0x266c81,_0xd8698e);}else _0x434f32=await(0x0,GetHandlers_1[_0x1b86c6(0x14a)])(_0x266c81,_0xd8698e);_0x79453b&&(_0x25a010=await wbotMutex['runExclusive'](async()=>{const _0x21a7a0=_0x1b86c6;let _0x5459c9=groupContactCache['get'](_0x266c81[_0x21a7a0(0x195)][_0x21a7a0(0x18f)]);if(!_0x5459c9){const _0x206525=await _0xd8698e[_0x21a7a0(0x1c7)](_0x266c81[_0x21a7a0(0x195)][_0x21a7a0(0x18f)]),_0x3b452d={'id':_0x206525['id'],'name':_0x206525[_0x21a7a0(0x1c3)]};_0x5459c9=await(0x0,VerifyHandlers_1[_0x21a7a0(0x155)])(_0x3b452d,_0xd8698e,_0xd650b3),groupContactCache[_0x21a7a0(0x192)](_0x266c81[_0x21a7a0(0x195)][_0x21a7a0(0x18f)],_0x5459c9);}return _0x5459c9;}));const _0x9dd913=await(0x0,ShowWhatsAppService_1[_0x1b86c6(0x1b3)])(_0xd8698e['id'],_0xd650b3),_0x578514=_0x266c81[_0x1b86c6(0x195)],_0x1a39fc=_0x578514[_0x1b86c6(0x13f)]||_0x578514['remoteJidAlt'],_0x20a53d=await(0x0,VerifyHandlers_1[_0x1b86c6(0x155)])(_0x434f32,_0xd8698e,_0xd650b3,_0x1a39fc);let _0x39f267=_0x20a53d;if(!_0x266c81[_0x1b86c6(0x195)]['fromMe']){const _0x254a58=_0x266c81[_0x1b86c6(0x195)],_0x11dd5b=_0x266c81['key'][_0x1b86c6(0x18f)],_0xa5e36c=_0x254a58[_0x1b86c6(0x1e1)];let _0x3303ec=null,_0x26f858=![];if(_0x11dd5b?.[_0x1b86c6(0x14f)](_0x1b86c6(0x194)))_0x3303ec=_0x11dd5b,_0x26f858=_0x20a53d[_0x1b86c6(0x1e3)][_0x1b86c6(0x129)]>0xd;else _0x11dd5b?.[_0x1b86c6(0x14f)](_0x1b86c6(0x1fb))&&_0xa5e36c?.[_0x1b86c6(0x14f)](_0x1b86c6(0x194))&&(_0x3303ec=_0xa5e36c,_0x26f858=!![]);if(_0x3303ec&&_0x26f858){const _0x33900c=_0x3303ec[_0x1b86c6(0x1fd)]('@')[0x0],_0x5a0c2f=await Contact_1[_0x1b86c6(0x1b3)][_0x1b86c6(0x163)]({'where':{'number':_0x33900c,'companyId':_0x20a53d[_0x1b86c6(0x13e)]}});if(_0x5a0c2f&&_0x5a0c2f['id']!==_0x20a53d['id']){_0x39f267=_0x5a0c2f;const _0x584fed=_0x11dd5b?.[_0x1b86c6(0x14f)](_0x1b86c6(0x1fb))?_0x11dd5b:_0xa5e36c,_0xf1a60a=_0x584fed?.[_0x1b86c6(0x1fd)]('@')[0x0],_0x3032ae={};_0xf1a60a&&!_0x5a0c2f['lid']&&(_0x3032ae[_0x1b86c6(0x1f9)]=_0xf1a60a);_0x3303ec&&!_0x5a0c2f[_0x1b86c6(0x18f)]&&(_0x3032ae['remoteJid']=_0x3303ec);const _0x21f9ca=!_0x5a0c2f[_0x1b86c6(0x135)]||_0x5a0c2f[_0x1b86c6(0x135)]===''||_0x5a0c2f[_0x1b86c6(0x135)]===process[_0x1b86c6(0x143)]['FRONTEND_URL']+_0x1b86c6(0x170);_0x21f9ca&&_0x20a53d[_0x1b86c6(0x135)]&&_0x20a53d[_0x1b86c6(0x135)]!==process[_0x1b86c6(0x143)]['FRONTEND_URL']+_0x1b86c6(0x170)&&(_0x3032ae[_0x1b86c6(0x135)]=_0x20a53d[_0x1b86c6(0x135)]);Object[_0x1b86c6(0x147)](_0x3032ae)[_0x1b86c6(0x129)]>0x0&&await _0x5a0c2f[_0x1b86c6(0x1b4)](_0x3032ae);const _0x544271=await Ticket_1['default']['count']({'where':{'contactId':_0x20a53d['id']}});_0x544271===0x0&&await _0x20a53d[_0x1b86c6(0x121)]();}else!_0x5a0c2f&&(await _0x20a53d[_0x1b86c6(0x1b4)]({'number':_0x33900c,'remoteJid':_0x3303ec}),_0x39f267=_0x20a53d);}}let _0xd04a89=0x0;if(_0x266c81['key'][_0x1b86c6(0x1f1)])await cache_1[_0x1b86c6(0x177)][_0x1b86c6(0x192)](_0x1b86c6(0x1b6)+_0x39f267['id']+_0x1b86c6(0x1f3),'0');else{const _0xec9273=await cache_1[_0x1b86c6(0x177)][_0x1b86c6(0x127)](_0x1b86c6(0x1b6)+_0x39f267['id']+_0x1b86c6(0x1f3));_0xd04a89=+_0xec9273+0x1,await cache_1[_0x1b86c6(0x177)]['set']('contacts:'+_0x39f267['id']+_0x1b86c6(0x1f3),''+_0xd04a89);}const _0x30913e=await Message_1[_0x1b86c6(0x1b3)][_0x1b86c6(0x163)]({'where':{'contactId':_0x39f267['id'],'companyId':_0xd650b3,'$ticket.whatsappId$':_0x9dd913['id']},'include':[_0x1b86c6(0x1c2)],'order':[[_0x1b86c6(0x17c),_0x1b86c6(0x1a0)]]}),_0x549668=_0x9dd913[_0x1b86c6(0x1d5)][_0x1b86c6(0x1ac)]()||_0x1b86c6(0x140);if(_0x30913e&&_0xd04a89===0x0&&_0x549668&&(0x0,Mustache_1[_0x1b86c6(0x1b3)])(_0x549668,_0x30913e[_0x1b86c6(0x1c2)])[_0x1b86c6(0x1ac)]()[_0x1b86c6(0x1aa)]()===_0x30913e?.[_0x1b86c6(0x186)][_0x1b86c6(0x1ac)]()['toLowerCase']())return;if(!_0x266c81[_0x1b86c6(0x195)][_0x1b86c6(0x1f1)]&&!_0x39f267[_0x1b86c6(0x1a5)]){if(_0x9dd913['useRating']){const _0x4f1c5d=await TicketTraking_1[_0x1b86c6(0x1b3)][_0x1b86c6(0x163)]({'where':{'whatsappId':_0x9dd913['id'],'rated':![],'ratingAt':{[sequelize_1['Op'][_0x1b86c6(0x12e)]]:null},'finishedAt':null},'include':[{'model':Ticket_1['default'],'where':{'status':'open','contactId':_0x39f267['id']},'include':[{'model':Contact_1[_0x1b86c6(0x1b3)]},{'model':User_1[_0x1b86c6(0x1b3)]},{'model':Queue_1[_0x1b86c6(0x1b3)]}]}]});if(_0x4f1c5d)try{const _0x50f83c=Number(_0x516840);if(!Number[_0x1b86c6(0x1ee)](_0x50f83c)){const _0x2c94f4=(0x0,Debounce_1[_0x1b86c6(0x1c5)])(async()=>{const _0x4d651b=_0x1b86c6,_0x4b8993=_0x9dd913[_0x4d651b(0x1bf)]?.[_0x4d651b(0x1ac)]()||_0x4d651b(0x1fc);await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x1326ab,'body':'\x0a*'+_0x4b8993+'*'});},0x3e8,_0x4f1c5d[_0x1b86c6(0x1c2)]['id']);_0x2c94f4();return;}if((0x0,VerifyHandlers_1['verifyRating'])(_0x4f1c5d)){(0x0,exports[_0x1b86c6(0x13b)])(_0x266c81,_0x4f1c5d[_0x1b86c6(0x1c2)],_0x4f1c5d);return;}}catch(_0x5b7fb3){Sentry[_0x1b86c6(0x12d)](_0x5b7fb3),console['log'](_0x1b86c6(0x196),_0x5b7fb3);}}}const {ticket:_0x1326ab,justCreated:_0x319468}=await(0x0,FindOrCreateTicketService_1[_0x1b86c6(0x1b3)])(_0x39f267,_0xd8698e['id'],_0xd04a89,_0xd650b3,_0x25a010);if(_0x2bcf6f||_0x266c81?.[_0x1b86c6(0x1b1)]?.[_0x1b86c6(0x1f0)]?.['thumbnailDirectPath'])await(0x0,VerifyHandlers_1[_0x1b86c6(0x124)])(_0x266c81,_0x1326ab,_0x39f267,_0xd8698e,_0x2bcf6f);else{if(_0x266c81[_0x1b86c6(0x1b1)]?.[_0x1b86c6(0x17a)]?.['message']?.[_0x1b86c6(0x1ca)]?.[_0x1b86c6(0x17a)])await(0x0,VerifyHandlers_1['verifyEditedMessage'])(_0x266c81[_0x1b86c6(0x1b1)][_0x1b86c6(0x17a)][_0x1b86c6(0x1b1)][_0x1b86c6(0x1ca)][_0x1b86c6(0x17a)],_0x1326ab,_0x266c81[_0x1b86c6(0x1b1)]['editedMessage'][_0x1b86c6(0x1b1)]['protocolMessage'][_0x1b86c6(0x195)]['id']);else{if(_0x266c81[_0x1b86c6(0x1b1)]?.[_0x1b86c6(0x1ca)]?.['editedMessage'])await(0x0,VerifyHandlers_1[_0x1b86c6(0x1d6)])(_0x266c81[_0x1b86c6(0x1b1)][_0x1b86c6(0x1ca)][_0x1b86c6(0x17a)],_0x1326ab,_0x266c81[_0x1b86c6(0x1b1)][_0x1b86c6(0x1ca)][_0x1b86c6(0x195)]['id']);else _0x266c81[_0x1b86c6(0x1b1)]?.[_0x1b86c6(0x1ca)]?.[_0x1b86c6(0x123)]===0x0?await(0x0,VerifyHandlers_1['verifyDeleteMessage'])(_0x266c81[_0x1b86c6(0x1b1)]['protocolMessage'],_0x1326ab):await(0x0,VerifyHandlers_1[_0x1b86c6(0x1e6)])(_0x266c81,_0x1326ab,_0x39f267,null,_0xd8698e);}}if(_0x1326ab[_0x1b86c6(0x172)]===!![]&&_0x1326ab[_0x1b86c6(0x13c)]){const _0x1f7fe9=await(0x0,ShowQueueIntegrationService_1[_0x1b86c6(0x1b3)])(_0x1326ab[_0x1b86c6(0x13c)],_0xd650b3);if(_0x1f7fe9){await(0x0,exports[_0x1b86c6(0x193)])(_0x266c81,_0xd8698e,_0x1f7fe9,_0x1326ab);return;}else await _0x1326ab[_0x1b86c6(0x1b4)]({'useIntegration':![],'integrationId':null,'typebotSessionId':null});}if(_0x516840==='#'&&!_0x79453b){await _0x1326ab['update']({'chatbot':![],'queueId':null,'flowBuilderId':null,'flowWebhook':![],'lastFlowId':null,'flowStopped':null,'hashFlowId':null,'dataWebhook':null}),await(0x0,VerifyHandlers_1[_0x1b86c6(0x1ed)])(_0xd8698e,_0x266c81,_0x1326ab,_0x1326ab[_0x1b86c6(0x168)]);return;}const _0x27f0b3=await(0x0,CheckSettings_1[_0x1b86c6(0x15c)])(_0xd650b3,_0x1b86c6(0x197),'disabled');try{if(!_0x266c81[_0x1b86c6(0x195)][_0x1b86c6(0x1f1)]&&_0x27f0b3){const _0x53e1c6=await(0x0,CheckSettings_1[_0x1b86c6(0x15c)])(_0xd650b3,_0x1b86c6(0x1a8),_0x1b86c6(0x1c0));let _0x488aa4=null;const _0x588431=_0x1326ab['status']==='open'&&_0x1326ab['user'][_0x1b86c6(0x154)][_0x1b86c6(0x129)]>0x0,_0x3513b2=!_0x588431&&outOfHoursCache['get'](_0x1b86c6(0x1d1)+_0x1326ab['id']);if(_0x27f0b3===_0x1b86c6(0x1e4)&&!_0x588431){_0x488aa4=await(0x0,VerifyCurrentSchedule_1[_0x1b86c6(0x1b3)])(_0xd650b3),console['log']('Resultado\x20da\x20verificação\x20de\x20horário:',{'currentSchedule':_0x488aa4,'isInActivity':_0x488aa4?.[_0x1b86c6(0x1d7)]});if(_0x488aa4&&_0x488aa4[_0x1b86c6(0x1d7)]===![]){if(!_0x3513b2){outOfHoursCache[_0x1b86c6(0x192)](_0x1b86c6(0x1d1)+_0x1326ab['id'],!![]);const _0x5dc048=_0x9dd913[_0x1b86c6(0x1db)][_0x1b86c6(0x1ac)]()||_0x1b86c6(0x1bc);await(0x0,SendWhatsAppMessage_1[_0x1b86c6(0x1b3)])({'ticket':_0x1326ab,'body':_0x5dc048});}_0x1326ab[_0x1b86c6(0x19a)]!==_0x1b86c6(0x120)&&await(0x0,UpdateTicketService_1[_0x1b86c6(0x1b3)])({'ticketData':{'chatbot':![],'status':_0x53e1c6},'ticketId':_0x1326ab['id'],'companyId':_0x1326ab[_0x1b86c6(0x13e)]});return;}}if(_0x27f0b3===_0x1b86c6(0x1a9)&&_0x1326ab[_0x1b86c6(0x156)]!==null&&!_0x588431){_0x488aa4=await(0x0,VerifyCurrentSchedule_1[_0x1b86c6(0x1b3)])(_0xd650b3,_0x1326ab[_0x1b86c6(0x156)]);const _0x5c92c5=await Queue_1[_0x1b86c6(0x1b3)][_0x1b86c6(0x1cb)](_0x1326ab[_0x1b86c6(0x156)]);if(!(0x0,lodash_1[_0x1b86c6(0x1c8)])(_0x488aa4)&&(!_0x488aa4||_0x488aa4[_0x1b86c6(0x1d7)]===![])){if(!_0x3513b2){outOfHoursCache['set'](_0x1b86c6(0x1d1)+_0x1326ab['id'],!![]);const _0x2bb3a0=_0x5c92c5[_0x1b86c6(0x1db)]?.[_0x1b86c6(0x1ac)]()||_0x1b86c6(0x1bc);await(0x0,SendWhatsAppMessage_1[_0x1b86c6(0x1b3)])({'ticket':_0x1326ab,'body':_0x2bb3a0});}_0x1326ab[_0x1b86c6(0x19a)]!=='open'&&await(0x0,UpdateTicketService_1['default'])({'ticketData':{'chatbot':![],'status':_0x53e1c6},'ticketId':_0x1326ab['id'],'companyId':_0x1326ab[_0x1b86c6(0x13e)]});return;}}}}catch(_0x575079){Sentry[_0x1b86c6(0x12d)](_0x575079),console[_0x1b86c6(0x159)](_0x1b86c6(0x142),_0x575079);}if(_0x1326ab['flowWebhook']&&_0x1326ab['flowBuilderId']&&!_0x266c81['key']['fromMe']){console[_0x1b86c6(0x159)](_0x1b86c6(0x173)+_0x1326ab['id']+'\x20está\x20em\x20flow\x20ativo.\x20Processando\x20dentro\x20do\x20flow.'),await handleFlowBuilder(_0x1326ab,_0x266c81,_0xd8698e);return;}!_0x1326ab[_0x1b86c6(0x1a9)]&&!_0x1326ab[_0x1b86c6(0x1fa)]&&!_0x79453b&&!_0x266c81[_0x1b86c6(0x195)][_0x1b86c6(0x1f1)]&&!_0x1326ab['userId']&&(_0x9dd913[_0x1b86c6(0x1b2)]&&_0x9dd913[_0x1b86c6(0x1b2)][_0x1b86c6(0x129)]>=0x1&&await(0x0,VerifyHandlers_1[_0x1b86c6(0x1ed)])(_0xd8698e,_0x266c81,_0x1326ab,_0x1326ab[_0x1b86c6(0x168)]));const _0x259681=_0x1326ab[_0x1b86c6(0x1a9)]===null;await _0x1326ab[_0x1b86c6(0x19d)]();if(_0x319468&&!_0x9dd913?.['queues']?.[_0x1b86c6(0x129)]&&!_0x1326ab[_0x1b86c6(0x1f8)]&&!_0x79453b&&!_0x266c81[_0x1b86c6(0x195)][_0x1b86c6(0x1f1)]){const _0x3d0bc7=await Message_1['default']['findOne']({'where':{'ticketId':_0x1326ab['id'],'fromMe':!![]},'order':[[_0x1b86c6(0x17c),_0x1b86c6(0x1a0)]]});if(_0x3d0bc7&&_0x3d0bc7[_0x1b86c6(0x186)][_0x1b86c6(0x14f)](_0x9dd913['greetingMessage']))return;if(_0x9dd913['greetingMessage']){const _0x12bae0=(0x0,Debounce_1[_0x1b86c6(0x1c5)])(async()=>{const _0x2c9c24=_0x1b86c6;await(0x0,SendWhatsAppMessage_1[_0x2c9c24(0x1b3)])({'ticket':_0x1326ab,'body':''+_0x9dd913[_0x2c9c24(0x14c)]});},0x3e8,_0x1326ab['id']);_0x12bae0();return;}}if(!_0x1326ab[_0x1b86c6(0x1d9)]&&_0x1326ab[_0x1b86c6(0x126)]>=_0x9dd913?.[_0x1b86c6(0x1a7)])return;if(_0x9dd913[_0x1b86c6(0x1b2)][_0x1b86c6(0x129)]===0x1&&_0x1326ab['queue']){}if(_0x9dd913[_0x1b86c6(0x1b2)][_0x1b86c6(0x129)]>0x1&&_0x1326ab[_0x1b86c6(0x1a9)]){}}catch(_0x5cf27a){Sentry[_0x1b86c6(0x12d)](_0x5cf27a),logger_1['logger']['error'](_0x1b86c6(0x169)+_0x5cf27a);}};exports['handleMessage']=handleMessage;const handleMsgAck=async(_0x7075b6,_0x3795f1)=>{const _0x2a61b0=a696_0xd7f3be;if(!_0x3795f1)return;const _0x42021f=(0x0,socket_1[_0x2a61b0(0x133)])();try{const _0x49b402=await Message_1['default'][_0x2a61b0(0x1cb)](_0x7075b6[_0x2a61b0(0x195)]['id'],{'include':['contact',{'model':Message_1['default'],'as':_0x2a61b0(0x12f),'include':['contact']}]});if(!_0x49b402||_0x3795f1<=_0x49b402[_0x2a61b0(0x188)])return;await _0x49b402[_0x2a61b0(0x1b4)]({'ack':_0x3795f1}),_0x42021f['to'](_0x49b402[_0x2a61b0(0x1f5)][_0x2a61b0(0x19b)]())[_0x2a61b0(0x1ce)]('company-'+_0x49b402[_0x2a61b0(0x13e)]+'-appMessage',{'action':'update','message':_0x49b402});}catch(_0x390af9){Sentry[_0x2a61b0(0x12d)](_0x390af9),logger_1[_0x2a61b0(0x17f)][_0x2a61b0(0x15b)]('Error\x20handling\x20message\x20ack.\x20Err:\x20'+_0x390af9);}},filterMessages=_0x5c9109=>{const _0x47a87d=a696_0xd7f3be;if(_0x5c9109[_0x47a87d(0x195)][_0x47a87d(0x18f)]===_0x47a87d(0x1a1))return![];if(_0x5c9109['key'][_0x47a87d(0x18f)]?.[_0x47a87d(0x18e)](_0x47a87d(0x181)))return![];if(_0x5c9109[_0x47a87d(0x1b1)]?.['protocolMessage']?.['editedMessage'])return!![];if(_0x5c9109[_0x47a87d(0x1b1)]?.['protocolMessage']?.['type']===0x0)return!![];if(_0x5c9109[_0x47a87d(0x1b1)]?.[_0x47a87d(0x1ca)])return![];if([baileys_1[_0x47a87d(0x15d)][_0x47a87d(0x1a6)],baileys_1[_0x47a87d(0x15d)][_0x47a87d(0x1d8)],baileys_1[_0x47a87d(0x15d)][_0x47a87d(0x132)],baileys_1['WAMessageStubType']['CIPHERTEXT']]['includes'](_0x5c9109[_0x47a87d(0x14d)]))return![];return!![];},wbotMessageListener=async(_0xddab41,_0x38e867)=>{const _0x49d47c=a696_0xd7f3be;try{_0xddab41['ev']['on']('messages.upsert',async _0xe13fa9=>{const _0x326055=a696_0x33cd,_0x68befa=_0xe13fa9['messages'][_0x326055(0x16f)](filterMessages)['map'](_0x78892e=>_0x78892e);if(!_0x68befa)return;_0x68befa[_0x326055(0x1ef)](async _0x16c3ec=>{const _0x581bb4=_0x326055;try{const _0x57e5de=await Message_1['default'][_0x581bb4(0x1b0)]({'where':{'id':_0x16c3ec[_0x581bb4(0x195)]['id'],'companyId':_0x38e867}});if(!_0x57e5de){if(await(0x0,VerifyHandlers_1[_0x581bb4(0x191)])(_0x16c3ec,_0x38e867))return;await handleMessage(_0x16c3ec,_0xddab41,_0x38e867);}}catch(_0xc46049){if(_0xc46049[_0x581bb4(0x1b1)]?.[_0x581bb4(0x14f)](_0x581bb4(0x136))||_0xc46049[_0x581bb4(0x1b1)]?.[_0x581bb4(0x14f)]('failed\x20to\x20decrypt')){logger_1[_0x581bb4(0x17f)]['debug'](_0x581bb4(0x153)+_0x16c3ec[_0x581bb4(0x195)]['id']+_0x581bb4(0x179)+_0x16c3ec['key'][_0x581bb4(0x18f)]+':\x20'+_0xc46049[_0x581bb4(0x1b1)]);return;}Sentry['captureException'](_0xc46049),logger_1[_0x581bb4(0x17f)][_0x581bb4(0x15b)]('Error\x20processing\x20message\x20'+_0x16c3ec[_0x581bb4(0x195)]['id']+':\x20'+_0xc46049);}});}),_0xddab41['ev']['on']('messages.update',_0x489f41=>{const _0x41218b=a696_0x33cd;if(_0x489f41[_0x41218b(0x129)]===0x0)return;_0x489f41['forEach'](async _0x446dd1=>{const _0x18cc68=_0x41218b;_0xddab41['readMessages']([_0x446dd1[_0x18cc68(0x195)]]),await ackMutex[_0x18cc68(0x19f)](async()=>{const _0x465116=_0x18cc68;handleMsgAck(_0x446dd1,_0x446dd1['update'][_0x465116(0x19a)]);});});});}catch(_0x306709){Sentry[_0x49d47c(0x12d)](_0x306709),logger_1[_0x49d47c(0x17f)][_0x49d47c(0x15b)]('Error\x20handling\x20wbot\x20message\x20listener.\x20Err:\x20'+_0x306709);}};function a696_0xd6b1(){const _0x439a30=['getContactMessage','\x22\x20para\x20ticket\x20','greetingMessage','messageStubType','../CompanyService/VerifyCurrentSchedule','includes','constructor','./GetHandlers','enabled','Erro\x20de\x20decriptação\x20ignorado\x20para\x20mensagem\x20','socketSessions','verifyContact','queueId','getTypeMessage','edges','log','chatbot\x20desativado!','error','GetCompanySetting','WAMessageStubType','../TicketServices/FindOrCreateTicketService','../TypebotServices/typebotListener','wbotMessageListener','SimpleObjectCache','stringify','findOne','-ticket','Error\x20isValidMsg','../QueueIntegrationServices/ShowQueueIntegrationService','buttonsResponseMessage','contact','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','FlowBuilder\x20','start','Mutex','value','defineProperty','filter','/nopicture.png','getUnpackedMessage','useIntegration','Ticket\x20#','contactId','20248102ZMxjVM','sequelize','cacheLayer','configurable','\x20de\x20','editedMessage','documentWithCaptionMessage','createdAt','../../models/Contact','typebotStatus','logger','../../models/Ticket','@newsletter','random','../../models/FlowBuilder','1875375rnICOm','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','body','CHATBOT_RESTRICT_NUMBER','ack','../../models/Queue','-open','vcard','locationMessage','apply','endsWith','remoteJid','whatsappId','verifyRecentCampaign','set','handleMessageIntegration','@s.whatsapp.net','key','Erro\x20ao\x20processar\x20avaliação:','scheduleType','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','getOwnPropertyDescriptor','status','toString','__setModuleDefault','reload','imageMessage','runExclusive','DESC','status@broadcast','setExtra','lastProcessedMessageId',',\x20flowBuilderId:\x20','isGroup','REVOKE','maxUseBotQueues','outOfHoursAction','queue','toLowerCase','async-mutex','trim','__esModule','conversation','\x20não\x20encontrado\x20ou\x20sem\x20flow','count','message','queues','default','update','__createBinding','contacts:','../../models/UserRating','Mensagem\x20de\x20canal/newsletter\x20ignorada:\x20','(((.+)+)+)+$','\x20já\x20processada\x20para\x20o\x20ticket\x20','@sentry/node','Estamos\x20fora\x20do\x20horário\x20de\x20expediente','documentMessage','.\x20Ignorando\x20em\x20handleFlowBuilder.','ratingMessage','pending','name','ticket','subject','WhatsApp\x20ou\x20Contact\x20não\x20encontrado','debounce','keepUserAndQueue','groupMetadata','isNil','search','protocolMessage','findByPk','buttonsMessage','typebotStatus:\x20','emit','isInteger','floor','ticket-','../../helpers/CheckSettings','470049htHmLS','queue-','complationMessage','verifyEditedMessage','inActivity','E2E_DEVICE_CHANGED','chatbot','find','outOfHoursMessage','flow','getMessageMedia','connections','./SendWhatsAppMessage','./VerifyHandlers','remoteJidAlt','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','number','company','3562740TpoCKx','verifyMessage','warn','participant','getBodyMessage','../../helpers/Debounce','handleFlowBuilderExecution','viewOnceMessageV2','verifyQueue','isFinite','forEach','extendedTextMessage','fromMe','1099438OGrjau',':unreads','__importDefault','ticketId','liveLocationMessage','contactMessage','userId','lid','flowBuilderId','@lid','Por\x20favor\x20avalie\x20nosso\x20atendimento','split','handleMessage','ephemeralMessage','typebot','text','open','destroy','writable','type','verifyMediaMessage','2701345aeApGk','amountUsedBotQueues','get','company-','length','3972252bTiopd','Processando\x20mensagem\x20do\x20FlowBuilder:\x20\x22','call','captureException','not','quotedMsg','videoMessage','create','E2E_IDENTITY_CHANGED','getIO','lodash','profilePicUrl','serialized\x20is\x20not\x20iterable','../../utils/logger','../../models/Setting','@whiskeysockets/baileys','@g.us','handleRating','integrationId','templateMessage','companyId','senderPn','Atendimento\x20finalizado','Mensagem\x20','Erro\x20ao\x20verificar\x20horário\x20de\x20atendimento:','env','contactsArrayMessage','../../libs/socket','makeid','keys','__importStar','../TicketServices/UpdateTicketService'];a696_0xd6b1=function(){return _0x439a30;};return a696_0xd6b1();}exports['wbotMessageListener']=wbotMessageListener;