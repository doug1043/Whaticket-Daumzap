const a550_0x4aba8b=a550_0x29ba;(function(_0x18c9c2,_0x55f247){const _0x3f5abb=a550_0x29ba,_0x3d588a=_0x18c9c2();while(!![]){try{const _0x47d320=-parseInt(_0x3f5abb(0x27d))/0x1+-parseInt(_0x3f5abb(0x238))/0x2*(parseInt(_0x3f5abb(0x2d4))/0x3)+parseInt(_0x3f5abb(0x274))/0x4+parseInt(_0x3f5abb(0x2c4))/0x5*(-parseInt(_0x3f5abb(0x257))/0x6)+parseInt(_0x3f5abb(0x283))/0x7*(-parseInt(_0x3f5abb(0x1c1))/0x8)+parseInt(_0x3f5abb(0x223))/0x9*(parseInt(_0x3f5abb(0x22a))/0xa)+parseInt(_0x3f5abb(0x29f))/0xb*(parseInt(_0x3f5abb(0x247))/0xc);if(_0x47d320===_0x55f247)break;else _0x3d588a['push'](_0x3d588a['shift']());}catch(_0x3458f8){_0x3d588a['push'](_0x3d588a['shift']());}}}(a550_0x2d55,0x7bd7d));const a550_0xf91be=(function(){let _0x218078=!![];return function(_0x560d99,_0x50ffbc){const _0x4112c4=_0x218078?function(){if(_0x50ffbc){const _0x5cef5d=_0x50ffbc['apply'](_0x560d99,arguments);return _0x50ffbc=null,_0x5cef5d;}}:function(){};return _0x218078=![],_0x4112c4;};}()),a550_0x5cb467=a550_0xf91be(this,function(){const _0x5d9eba=a550_0x29ba;return a550_0x5cb467[_0x5d9eba(0x1f6)]()[_0x5d9eba(0x1e4)](_0x5d9eba(0x28c))[_0x5d9eba(0x1f6)]()[_0x5d9eba(0x2e2)](a550_0x5cb467)[_0x5d9eba(0x1e4)](_0x5d9eba(0x28c));});a550_0x5cb467();'use strict';var __createBinding=this&&this[a550_0x4aba8b(0x252)]||(Object[a550_0x4aba8b(0x2a1)]?function(_0x27040f,_0x1b3510,_0x343ad7,_0x354b13){const _0x49f76b=a550_0x4aba8b;if(_0x354b13===undefined)_0x354b13=_0x343ad7;var _0x3ce2a0=Object[_0x49f76b(0x31d)](_0x1b3510,_0x343ad7);(!_0x3ce2a0||(_0x49f76b(0x2a6)in _0x3ce2a0?!_0x1b3510[_0x49f76b(0x1de)]:_0x3ce2a0['writable']||_0x3ce2a0[_0x49f76b(0x204)]))&&(_0x3ce2a0={'enumerable':!![],'get':function(){return _0x1b3510[_0x343ad7];}}),Object['defineProperty'](_0x27040f,_0x354b13,_0x3ce2a0);}:function(_0x452124,_0x57c88d,_0xf51b41,_0x38ec2b){if(_0x38ec2b===undefined)_0x38ec2b=_0xf51b41;_0x452124[_0x38ec2b]=_0x57c88d[_0xf51b41];}),__setModuleDefault=this&&this[a550_0x4aba8b(0x311)]||(Object[a550_0x4aba8b(0x2a1)]?function(_0x2a7e48,_0x448ab3){const _0x43ad4d=a550_0x4aba8b;Object[_0x43ad4d(0x279)](_0x2a7e48,_0x43ad4d(0x20f),{'enumerable':!![],'value':_0x448ab3});}:function(_0x3f311b,_0x21e90d){const _0x1fbb35=a550_0x4aba8b;_0x3f311b[_0x1fbb35(0x20f)]=_0x21e90d;}),__importStar=this&&this[a550_0x4aba8b(0x31f)]||function(_0x108b2d){const _0x2a8093=a550_0x4aba8b;if(_0x108b2d&&_0x108b2d[_0x2a8093(0x1de)])return _0x108b2d;var _0x9134e3={};if(_0x108b2d!=null){for(var _0x45950c in _0x108b2d)if(_0x45950c!==_0x2a8093(0x20f)&&Object[_0x2a8093(0x22e)]['hasOwnProperty'][_0x2a8093(0x1e6)](_0x108b2d,_0x45950c))__createBinding(_0x9134e3,_0x108b2d,_0x45950c);}return __setModuleDefault(_0x9134e3,_0x108b2d),_0x9134e3;},__importDefault=this&&this[a550_0x4aba8b(0x235)]||function(_0x485783){const _0x2ea30d=a550_0x4aba8b;return _0x485783&&_0x485783[_0x2ea30d(0x1de)]?_0x485783:{'default':_0x485783};};Object[a550_0x4aba8b(0x279)](exports,'__esModule',{'value':!![]}),exports[a550_0x4aba8b(0x284)]=exports[a550_0x4aba8b(0x2d5)]=exports[a550_0x4aba8b(0x233)]=exports[a550_0x4aba8b(0x26e)]=exports[a550_0x4aba8b(0x1d5)]=exports['handleMessageIntegration']=exports[a550_0x4aba8b(0x1f9)]=exports['verifyRating']=exports[a550_0x4aba8b(0x317)]=exports[a550_0x4aba8b(0x1e0)]=exports[a550_0x4aba8b(0x298)]=exports[a550_0x4aba8b(0x29c)]=exports[a550_0x4aba8b(0x2ad)]=exports[a550_0x4aba8b(0x26c)]=exports[a550_0x4aba8b(0x289)]=exports[a550_0x4aba8b(0x1d4)]=exports[a550_0x4aba8b(0x2e4)]=exports[a550_0x4aba8b(0x196)]=exports['removeNonPrintableChars']=exports[a550_0x4aba8b(0x21b)]=exports[a550_0x4aba8b(0x21e)]=void 0x0;const path_1=__importStar(require(a550_0x4aba8b(0x1af))),util_1=require(a550_0x4aba8b(0x24a)),fs_1=require('fs'),Sentry=__importStar(require(a550_0x4aba8b(0x1f0))),lodash_1=require(a550_0x4aba8b(0x296)),baileys_1=require(a550_0x4aba8b(0x2b8)),MessageUtils=__importStar(require('./wbotGetMessageFromType')),stream_throttle_1=require(a550_0x4aba8b(0x1d2)),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require('../../models/Ticket')),Message_1=__importDefault(require(a550_0x4aba8b(0x21f))),OldMessage_1=__importDefault(require(a550_0x4aba8b(0x194))),socket_1=require(a550_0x4aba8b(0x263)),CreateMessageService_1=__importDefault(require(a550_0x4aba8b(0x26d))),logger_1=require('../../utils/logger'),CreateOrUpdateContactService_1=__importDefault(require('../ContactServices/CreateOrUpdateContactService')),FindOrCreateTicketService_1=__importDefault(require(a550_0x4aba8b(0x22c))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),UpdateTicketService_1=__importDefault(require(a550_0x4aba8b(0x226))),Mustache_1=__importDefault(require('../../helpers/Mustache')),UserRating_1=__importDefault(require(a550_0x4aba8b(0x272))),SendWhatsAppMessage_1=__importDefault(require(a550_0x4aba8b(0x244))),moment_1=__importDefault(require(a550_0x4aba8b(0x2c6))),Queue_1=__importDefault(require(a550_0x4aba8b(0x1d3))),QueueOption_1=__importDefault(require(a550_0x4aba8b(0x2d8))),FindOrCreateATicketTrakingService_1=__importDefault(require('../TicketServices/FindOrCreateATicketTrakingService')),VerifyCurrentSchedule_1=__importDefault(require('../CompanyService/VerifyCurrentSchedule')),Campaign_1=__importDefault(require('../../models/Campaign')),CampaignShipping_1=__importDefault(require('../../models/CampaignShipping')),sequelize_1=require('sequelize'),queues_1=require(a550_0x4aba8b(0x1ba)),User_1=__importDefault(require(a550_0x4aba8b(0x193))),Setting_1=__importDefault(require(a550_0x4aba8b(0x1e8))),cache_1=__importDefault(require(a550_0x4aba8b(0x299))),Debounce_1=require(a550_0x4aba8b(0x275)),fluent_ffmpeg_1=__importDefault(require(a550_0x4aba8b(0x246))),typebotListener_1=__importDefault(require('../TypebotServices/typebotListener')),ShowQueueIntegrationService_1=__importDefault(require(a550_0x4aba8b(0x192))),SendWhatsAppMedia_1=require('./SendWhatsAppMedia'),fs_2=__importDefault(require('fs')),ffmpeg_static_1=__importDefault(require(a550_0x4aba8b(0x308))),app_1=__importDefault(require('../../app')),mime_1=__importDefault(require('mime')),wbot_1=require(a550_0x4aba8b(0x221)),SendPresenceStatus_1=require(a550_0x4aba8b(0x214)),MakeRandomId_1=require(a550_0x4aba8b(0x273));fluent_ffmpeg_1[a550_0x4aba8b(0x20f)][a550_0x4aba8b(0x28e)](ffmpeg_static_1[a550_0x4aba8b(0x20f)]);const isNumeric=_0x1f8547=>/^-?\d+$/[a550_0x4aba8b(0x241)](_0x1f8547);exports[a550_0x4aba8b(0x21e)]=isNumeric;let outOfHourMessageControl=[],completionMessageControl=[],greetingMessageControl=[];const writeFileAsync=(0x0,util_1[a550_0x4aba8b(0x1f7)])(fs_1[a550_0x4aba8b(0x230)]),getTypeMessage=_0x1677ec=>{const _0x301faa=a550_0x4aba8b;return(0x0,baileys_1[_0x301faa(0x2ff)])(_0x1677ec[_0x301faa(0x19b)]);};exports[a550_0x4aba8b(0x21b)]=getTypeMessage;const removeNonPrintableChars=_0x52f7b1=>{const _0x347a6f=a550_0x4aba8b;return _0x52f7b1[_0x347a6f(0x25c)](/[\x00-\x1F\x7F-\x9F]/g,'');};exports[a550_0x4aba8b(0x2fc)]=removeNonPrintableChars;function timeout(_0x455f65){return new Promise(_0x2eaead=>setTimeout(_0x2eaead,_0x455f65));}async function sleep(_0x30492a){await timeout(_0x30492a);}exports['sleep']=sleep;const sendMessageImage=async(_0x4082c7,_0x5dd8f3,_0x599d30,_0x1ddcdd,_0x27aa68)=>{const _0x2f536f=a550_0x4aba8b;let _0x22e3d4;try{_0x22e3d4=await _0x4082c7[_0x2f536f(0x1a9)](_0x5dd8f3[_0x2f536f(0x2c5)]+'@'+(_0x599d30[_0x2f536f(0x260)]?'g.us':_0x2f536f(0x2cc)),{'image':_0x1ddcdd?{'url':_0x1ddcdd}:fs_2[_0x2f536f(0x20f)][_0x2f536f(0x322)]('public/temp/'+_0x27aa68+'-'+makeid(0xa)),'fileName':_0x27aa68,'caption':_0x27aa68,'mimetype':_0x2f536f(0x1e1)});}catch(_0x468396){_0x22e3d4=await _0x4082c7['sendMessage'](_0x5dd8f3[_0x2f536f(0x2c5)]+'@'+(_0x599d30[_0x2f536f(0x260)]?'g.us':_0x2f536f(0x2cc)),{'text':(0x0,Mustache_1[_0x2f536f(0x20f)])(_0x2f536f(0x218),_0x599d30)});}(0x0,exports['verifyMessage'])(_0x22e3d4,_0x599d30,_0x5dd8f3);};exports[a550_0x4aba8b(0x2e4)]=sendMessageImage;const sendMessageLink=async(_0x4bb897,_0x14f107,_0x3dde20,_0x2f625b,_0x4610cc)=>{const _0x3877e7=a550_0x4aba8b;let _0x111261;try{_0x111261=await _0x4bb897['sendMessage'](_0x14f107[_0x3877e7(0x2c5)]+'@'+(_0x3dde20[_0x3877e7(0x260)]?_0x3877e7(0x280):_0x3877e7(0x2cc)),{'document':_0x2f625b?{'url':_0x2f625b}:fs_2['default'][_0x3877e7(0x322)](_0x3877e7(0x301)+_0x4610cc+'-'+makeid(0xa)),'fileName':_0x4610cc,'caption':_0x4610cc,'mimetype':_0x3877e7(0x2c7)});}catch(_0x1e571b){_0x111261=await _0x4bb897[_0x3877e7(0x1a9)](_0x14f107[_0x3877e7(0x2c5)]+'@'+(_0x3dde20['isGroup']?_0x3877e7(0x280):_0x3877e7(0x2cc)),{'text':(0x0,Mustache_1[_0x3877e7(0x20f)])('NÃ£o\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!',_0x3dde20)});}(0x0,exports[_0x3877e7(0x1e0)])(_0x111261,_0x3dde20,_0x14f107);};exports[a550_0x4aba8b(0x1d4)]=sendMessageLink;function makeid(_0x1a7d1e){const _0x3ae80a=a550_0x4aba8b;var _0x3c2d3a='',_0x1f7aaa=_0x3ae80a(0x26a),_0x56099e=_0x1f7aaa[_0x3ae80a(0x20c)];for(var _0xabcdb2=0x0;_0xabcdb2<_0x1a7d1e;_0xabcdb2++){_0x3c2d3a+=_0x1f7aaa[_0x3ae80a(0x200)](Math[_0x3ae80a(0x1a2)](Math[_0x3ae80a(0x1a8)]()*_0x56099e));}return _0x3c2d3a;}exports[a550_0x4aba8b(0x289)]=makeid;const msgLocation=(_0x8f4f3b,_0x2735c7,_0x3cf1f4)=>{const _0x1e043f=a550_0x4aba8b;if(_0x8f4f3b){var _0x188e9b=Buffer[_0x1e043f(0x1aa)](_0x8f4f3b)[_0x1e043f(0x1f6)]('base64');let _0x32e48f=_0x1e043f(0x2a5)+_0x188e9b+'\x20|\x20https://maps.google.com/maps?q='+_0x2735c7+_0x1e043f(0x28f)+_0x3cf1f4+_0x1e043f(0x2d0)+_0x2735c7+',\x20'+_0x3cf1f4+'\x20';return _0x32e48f;}},getBodyMessage=_0x188bef=>{const _0x1ae2d8=a550_0x4aba8b;try{let _0x33d072=(0x0,exports[_0x1ae2d8(0x21b)])(_0x188bef);const _0x89051d={'conversation':MessageUtils['getTextMessage'](_0x188bef),'editedMessage':_0x188bef?.[_0x1ae2d8(0x19b)]?.['editedMessage']?.[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x2ca)]?.[_0x1ae2d8(0x1a5)]?.[_0x1ae2d8(0x2d7)]||_0x188bef?.[_0x1ae2d8(0x19b)]?.['editedMessage']?.[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x1be)]?.[_0x1ae2d8(0x251)],'imageMessage':MessageUtils[_0x1ae2d8(0x1cf)](_0x188bef),'videoMessage':MessageUtils[_0x1ae2d8(0x304)](_0x188bef),'extendedTextMessage':_0x188bef[_0x1ae2d8(0x19b)]?.['extendedTextMessage']?.['text'],'buttonsResponseMessage':MessageUtils[_0x1ae2d8(0x216)](_0x188bef),'templateButtonReplyMessage':_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x1a0)]?.[_0x1ae2d8(0x302)],'messageContextInfo':_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x1e5)]?.[_0x1ae2d8(0x253)]||_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x315)]?.[_0x1ae2d8(0x1b3)],'buttonsMessage':MessageUtils['getBodyButton'](_0x188bef)||_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x315)]?.[_0x1ae2d8(0x31a)]?.['selectedRowId'],'viewOnceMessage':MessageUtils[_0x1ae2d8(0x1f2)](_0x188bef),'viewOnceMessageV2':MessageUtils[_0x1ae2d8(0x19e)](_0x188bef),'stickerMessage':MessageUtils[_0x1ae2d8(0x2ec)](_0x188bef),'contactMessage':MessageUtils[_0x1ae2d8(0x30c)](_0x188bef),'contactsArrayMessage':_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x20a)]?.[_0x1ae2d8(0x1ac)]&&MessageUtils[_0x1ae2d8(0x1c9)](_0x188bef),'pollCreationMessageV2':_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x2cf)]?.[_0x1ae2d8(0x2ae)]||_0x1ae2d8(0x2ed),'pollCreationMessageV3':_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x25b)]?.[_0x1ae2d8(0x2ae)]||'Enquete\x20nÃ£o\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','interactiveMessage':_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x2c3)]?.['body']||_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x2c3)]?.[_0x1ae2d8(0x2c2)]||_0x1ae2d8(0x212),'locationMessage':MessageUtils[_0x1ae2d8(0x2b3)](_0x188bef),'liveLocationMessage':'Latitude:\x20'+_0x188bef[_0x1ae2d8(0x19b)]?.['liveLocationMessage']?.['degreesLatitude']+_0x1ae2d8(0x239)+_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x21a)]?.[_0x1ae2d8(0x30d)],'documentMessage':MessageUtils['getDocumentMessage'](_0x188bef),'documentWithCaptionMessage':_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x2f3)]?.[_0x1ae2d8(0x19b)]?.['documentMessage']?.[_0x1ae2d8(0x281)],'audioMessage':MessageUtils[_0x1ae2d8(0x2ee)](_0x188bef),'ephemeralMessage':_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x294)]?.[_0x1ae2d8(0x19b)]?.['extendedTextMessage']?.[_0x1ae2d8(0x251)],'listMessage':MessageUtils[_0x1ae2d8(0x1b4)](_0x188bef)||_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x315)]?.[_0x1ae2d8(0x1b3)],'listResponseMessage':MessageUtils[_0x1ae2d8(0x26f)](_0x188bef),'reactionMessage':MessageUtils[_0x1ae2d8(0x255)](_0x188bef)||_0x1ae2d8(0x286),'advertising':MessageUtils[_0x1ae2d8(0x256)](_0x188bef)||_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x315)]?.[_0x1ae2d8(0x2c2)]?.[_0x1ae2d8(0x1fe)]?.[_0x1ae2d8(0x1b3)],'productMessage':_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x18e)]?.[_0x1ae2d8(0x21c)]?.[_0x1ae2d8(0x314)]?.[_0x1ae2d8(0x281)]||_0x1ae2d8(0x2fb),'multiProductMessage':'MÃºltiplos\x20Produtos','orderMessage':_0x1ae2d8(0x266),'paymentMessage':MessageUtils[_0x1ae2d8(0x1fd)](_0x188bef),'paymentRequestMessage':_0x1ae2d8(0x1ca),'groupInviteMessage':MessageUtils[_0x1ae2d8(0x262)](_0x188bef),'revokeInviteMessage':'Convite\x20Revogado','protocolMessage':_0x188bef[_0x1ae2d8(0x19b)]?.[_0x1ae2d8(0x2ca)]?.['editedMessage']?.[_0x1ae2d8(0x2d7)]||null,'disappearingMessage':'Mensagem\x20que\x20Desaparece','callMessage':MessageUtils[_0x1ae2d8(0x2bf)](_0x188bef),'templateMessage':MessageUtils[_0x1ae2d8(0x2f2)](_0x188bef),'statusUpdateMessage':_0x1ae2d8(0x321)};return _0x89051d[_0x33d072]||null;}catch(_0x18bd3d){return console[_0x1ae2d8(0x1b2)]('Error\x20getting\x20message\x20body:',_0x18bd3d),null;}};exports[a550_0x4aba8b(0x26c)]=getBodyMessage;const getQuotedMessage=_0x11b3de=>{const _0x23f1b5=a550_0x4aba8b,_0xb002b0=_0x11b3de[_0x23f1b5(0x19b)][_0x23f1b5(0x1b0)][_0x23f1b5(0x2c2)]||_0x11b3de[_0x23f1b5(0x19b)]['videoMessage'][_0x23f1b5(0x2c2)]||_0x11b3de[_0x23f1b5(0x19b)]?.[_0x23f1b5(0x1b9)]||_0x11b3de['message']['extendedTextMessage']['contextInfo']||_0x11b3de[_0x23f1b5(0x19b)]['buttonsResponseMessage'][_0x23f1b5(0x2c2)]||_0x11b3de[_0x23f1b5(0x19b)]['listResponseMessage']['contextInfo']||_0x11b3de[_0x23f1b5(0x19b)][_0x23f1b5(0x1a0)][_0x23f1b5(0x2c2)]||_0x11b3de[_0x23f1b5(0x19b)][_0x23f1b5(0x1e5)]?.[_0x23f1b5(0x2c2)]||_0x11b3de?.[_0x23f1b5(0x19b)]?.[_0x23f1b5(0x1e5)]?.['selectedButtonId']||_0x11b3de[_0x23f1b5(0x19b)][_0x23f1b5(0x315)]?.['singleSelectReply']?.[_0x23f1b5(0x198)]||_0x11b3de?.['message']?.[_0x23f1b5(0x315)]?.[_0x23f1b5(0x31a)][_0x23f1b5(0x198)]||_0x11b3de[_0x23f1b5(0x19b)][_0x23f1b5(0x315)]?.['contextInfo'];return _0x11b3de[_0x23f1b5(0x19b)]['senderKeyDistributionMessage'],(0x0,baileys_1[_0x23f1b5(0x277)])(_0xb002b0[Object['keys'](_0xb002b0)[_0x23f1b5(0x313)]()['next']()[_0x23f1b5(0x1ae)]]);};exports[a550_0x4aba8b(0x2ad)]=getQuotedMessage;const getQuotedMessageId=_0xeb8c66=>{const _0x4c3395=a550_0x4aba8b,_0xef711d=(0x0,baileys_1[_0x4c3395(0x277)])(_0xeb8c66[_0x4c3395(0x19b)])[Object[_0x4c3395(0x28d)](_0xeb8c66?.[_0x4c3395(0x19b)])['values']()[_0x4c3395(0x231)]()[_0x4c3395(0x1ae)]];let _0x583925=_0xeb8c66?.[_0x4c3395(0x19b)]?.[_0x4c3395(0x2e0)]?_0xeb8c66?.[_0x4c3395(0x19b)]?.['reactionMessage']?.['key']?.['id']:'';return _0x583925?_0x583925:_0xef711d?.['contextInfo']?.[_0x4c3395(0x2ce)];};exports[a550_0x4aba8b(0x29c)]=getQuotedMessageId;const getMeSocket=_0x1765bb=>{const _0x1a3e87=a550_0x4aba8b;return{'id':(0x0,baileys_1[_0x1a3e87(0x1d8)])(_0x1765bb[_0x1a3e87(0x222)]['id']),'name':_0x1765bb[_0x1a3e87(0x222)]['name']};},getSenderMessage=(_0x307c49,_0x5de231)=>{const _0x115ea7=a550_0x4aba8b,_0x3b009f=getMeSocket(_0x5de231);if(_0x307c49['key'][_0x115ea7(0x1d6)])return _0x3b009f['id'];const _0x58f563=_0x307c49[_0x115ea7(0x1df)]||_0x307c49[_0x115ea7(0x1da)][_0x115ea7(0x1df)]||_0x307c49['key'][_0x115ea7(0x2b0)]||undefined;return _0x58f563&&(0x0,baileys_1[_0x115ea7(0x1d8)])(_0x58f563);},getContactMessage=async(_0x1417f9,_0x24c9a5)=>{const _0x2a803f=a550_0x4aba8b,_0x6f5f64=_0x1417f9[_0x2a803f(0x1da)][_0x2a803f(0x2b0)][_0x2a803f(0x27f)]('g.us'),_0x5982ca=_0x1417f9[_0x2a803f(0x1da)][_0x2a803f(0x2b0)][_0x2a803f(0x25c)](/\D/g,'');return _0x6f5f64?{'id':getSenderMessage(_0x1417f9,_0x24c9a5),'name':_0x1417f9['pushName']}:{'id':_0x1417f9[_0x2a803f(0x1da)]['remoteJid'],'name':_0x1417f9[_0x2a803f(0x1da)][_0x2a803f(0x1d6)]?_0x5982ca:_0x1417f9[_0x2a803f(0x2fa)]};},getUnpackedMessage=_0x25a6bf=>{const _0x416106=a550_0x4aba8b;return _0x25a6bf[_0x416106(0x19b)]?.['documentWithCaptionMessage']?.[_0x416106(0x19b)]||_0x25a6bf[_0x416106(0x19b)]?.[_0x416106(0x1be)]?.['contextInfo']?.[_0x416106(0x1eb)]||_0x25a6bf[_0x416106(0x19b)]?.[_0x416106(0x294)]?.['message']||_0x25a6bf[_0x416106(0x19b)]?.[_0x416106(0x2b6)]?.[_0x416106(0x19b)]||_0x25a6bf[_0x416106(0x19b)]?.[_0x416106(0x1f5)]?.[_0x416106(0x19b)]||_0x25a6bf[_0x416106(0x19b)]?.[_0x416106(0x294)]?.[_0x416106(0x19b)]||_0x25a6bf['message']?.[_0x416106(0x30b)]?.[_0x416106(0x1c5)]||_0x25a6bf['message']?.[_0x416106(0x30b)]?.[_0x416106(0x1d7)]||_0x25a6bf[_0x416106(0x19b)]?.[_0x416106(0x30b)]?.[_0x416106(0x22f)]||_0x25a6bf[_0x416106(0x19b)]?.[_0x416106(0x2c3)]?.[_0x416106(0x2e5)]||_0x25a6bf['message']?.[_0x416106(0x320)]?.[_0x416106(0x2bc)]?.['hydratedTemplate']||_0x25a6bf['message'];},getMessageMedia=_0x121523=>{const _0x9ba042=a550_0x4aba8b;return _0x121523?.['imageMessage']||_0x121523?.['audioMessage']||_0x121523?.[_0x9ba042(0x19d)]||_0x121523?.[_0x9ba042(0x1c7)]||_0x121523?.['documentMessage']||null;},downloadMedia=async _0xc14179=>{const _0x1d2374=a550_0x4aba8b,_0x200f6e=getUnpackedMessage(_0xc14179),_0x7da222=getMessageMedia(_0x200f6e);if(!_0x7da222)return null;const _0x2bb380=_0x200f6e?.[_0x1d2374(0x1b9)]?_0x1d2374(0x1d9):_0x7da222[_0x1d2374(0x208)][_0x1d2374(0x307)]('/')[0x0][_0x1d2374(0x25c)](_0x1d2374(0x306),_0x1d2374(0x1d9))?_0x7da222['mimetype'][_0x1d2374(0x307)]('/')[0x0][_0x1d2374(0x25c)](_0x1d2374(0x306),_0x1d2374(0x1d9)):_0x7da222[_0x1d2374(0x208)][_0x1d2374(0x307)]('/')[0x0];let _0x206394,_0x4d5cd7=0x0;while(_0x4d5cd7<0xa&&!_0x206394){try{_0x7da222?.[_0x1d2374(0x19f)]&&(_0x7da222[_0x1d2374(0x227)]=''),_0x206394=await(0x0,baileys_1[_0x1d2374(0x2da)])(_0x7da222,_0x2bb380);}catch(_0x389390){_0x4d5cd7+=0x1,await new Promise(_0x4afbff=>{setTimeout(_0x4afbff,0x3e8*_0x4d5cd7*0x2);}),logger_1[_0x1d2374(0x2cd)][_0x1d2374(0x1ea)](_0x1d2374(0x288)+_0x4d5cd7+_0x1d2374(0x1d0)+_0xc14179?.[_0x1d2374(0x1da)]?.['id']);}}if(!_0x206394)throw new Error(_0x1d2374(0x18d));let _0x397961=_0x200f6e?.[_0x1d2374(0x1b9)]?.[_0x1d2374(0x2ea)]||'';if(!_0x397961){const _0x39a721=mime_1['default'][_0x1d2374(0x2bd)](_0x7da222['mimetype']);_0x397961=(0x0,MakeRandomId_1[_0x1d2374(0x2ba)])(0x5)+'-'+new Date()[_0x1d2374(0x265)]()+'.'+_0x39a721;}else _0x397961=_0x397961[_0x1d2374(0x307)]('.')[_0x1d2374(0x2d6)](0x0,-0x1)[_0x1d2374(0x287)]('.')+'.'+(0x0,MakeRandomId_1[_0x1d2374(0x2ba)])(0x5)+'.'+_0x397961['split']('.')['slice'](-0x1);const _0x4babe0=0x5*0x400*0x400/0x8,_0x4f19c6=0x400*0x400/0x8,_0x4b643f=0x400*0x400,_0x342ea0=new stream_throttle_1[(_0x1d2374(0x267))]({'rate':_0x4babe0});let _0x1f8122=Buffer['from']([]),_0x454c5a=0x0;const _0x494c1b=Date[_0x1d2374(0x24b)]();try{for await(const _0x47bf68 of _0x206394[_0x1d2374(0x310)](_0x342ea0)){_0x1f8122=Buffer[_0x1d2374(0x1bc)]([_0x1f8122,_0x47bf68]),_0x454c5a+=_0x47bf68['length'],_0x454c5a>_0x4b643f&&(_0x342ea0[_0x1d2374(0x258)]=_0x4f19c6);}}catch(_0x579efb){return{'data':'error','mimetype':'','filename':''};}const _0x1627e5=Date['now'](),_0x9c4d1=(_0x1627e5-_0x494c1b)/0x3e8,_0x3cdf79=_0x454c5a/_0x9c4d1;logger_1[_0x1d2374(0x2cd)]['debug'](_0x397961+_0x1d2374(0x259)+_0x9c4d1['toFixed'](0x2)+'\x20seconds\x20with\x20an\x20effective\x20speed\x20of\x20'+(_0x3cdf79/0x400/0x400)[_0x1d2374(0x2f8)](0x2)+_0x1d2374(0x2ab));if(!_0x1f8122){Sentry['setExtra']('ERR_WAPP_DOWNLOAD_MEDIA',{'msg':_0xc14179}),Sentry[_0x1d2374(0x20d)](new Error(_0x1d2374(0x213)));throw new Error(_0x1d2374(0x213));}const _0x2aeeea={'data':_0x1f8122,'mimetype':_0x7da222['mimetype'],'filename':_0x397961};return _0x2aeeea;},verifyContact=async(_0x32aac8,_0x274638,_0x3a252f)=>{const _0x36b600=a550_0x4aba8b,_0x2243cb={'name':_0x32aac8?.['name']||_0x32aac8['id']['replace'](/\D/g,''),'number':_0x32aac8['id'][_0x36b600(0x29d)](0x0,_0x32aac8['id'][_0x36b600(0x22d)]('@')),'isGroup':_0x32aac8['id'][_0x36b600(0x27f)](_0x36b600(0x280)),'companyId':_0x3a252f,'whatsappId':_0x274638['id']},_0x175c80=(0x0,CreateOrUpdateContactService_1[_0x36b600(0x20f)])(_0x2243cb,_0x274638,_0x32aac8['id']);return _0x175c80;},verifyQuotedMessage=async _0x16ca80=>{const _0xe47415=a550_0x4aba8b;if(!_0x16ca80)return null;const _0x32571a=(0x0,exports['getQuotedMessageId'])(_0x16ca80);if(!_0x32571a)return null;const _0x4b844c=await Message_1[_0xe47415(0x20f)][_0xe47415(0x2c9)]({'where':{'id':_0x32571a}});if(!_0x4b844c)return null;return _0x4b844c;};exports[a550_0x4aba8b(0x298)]=verifyQuotedMessage;const verifyMediaMessage=async(_0x1391d5,_0x4a390a,_0x43fe20)=>{const _0x24d55b=a550_0x4aba8b,_0x1e9ab0=(0x0,socket_1[_0x24d55b(0x1c0)])();let _0x4fcd79=await Message_1['default'][_0x24d55b(0x2c9)]({'where':{'id':_0x1391d5['key']['id']}});if(!_0x4fcd79){const _0x5eed92=await(0x0,exports[_0x24d55b(0x298)])(_0x1391d5),_0x3f6c0b=(0x0,wbot_1[_0x24d55b(0x237)])(_0x4a390a['whatsappId']),_0x4cdb14=await downloadMedia(_0x1391d5);if(!_0x4cdb14)throw new Error(_0x24d55b(0x213));if(!_0x4cdb14[_0x24d55b(0x30e)]){const _0x5c942d=typeof _0x4cdb14[_0x24d55b(0x208)]===_0x24d55b(0x25f)&&_0x4cdb14[_0x24d55b(0x208)][_0x24d55b(0x27f)]('/')&&_0x4cdb14[_0x24d55b(0x208)][_0x24d55b(0x27f)](';')?mime_1[_0x24d55b(0x20f)]['extension'](_0x4cdb14[_0x24d55b(0x208)]):_0x24d55b(0x23f);_0x4cdb14[_0x24d55b(0x30e)]=new Date()['getTime']()+'.'+_0x5c942d;}else{let _0x101797=_0x4cdb14[_0x24d55b(0x30e)]?'-'+_0x4cdb14['filename']:'';_0x4cdb14[_0x24d55b(0x30e)]=''+new Date()[_0x24d55b(0x265)]()+_0x101797;}try{const _0x29a6e2=_0x24d55b(0x2a2)+_0x4a390a[_0x24d55b(0x2f4)];!fs_2[_0x24d55b(0x20f)]['existsSync'](_0x29a6e2)&&(fs_2['default'][_0x24d55b(0x2d2)](_0x29a6e2),fs_2['default'][_0x24d55b(0x250)](_0x29a6e2,0x1ff)),await writeFileAsync((0x0,path_1['join'])(__dirname,'..','..','..',_0x29a6e2,_0x4cdb14['filename']),_0x4cdb14['data'],_0x24d55b(0x1f8));}catch(_0xb97774){Sentry['captureException'](_0xb97774),logger_1['logger'][_0x24d55b(0x1b2)](_0xb97774);}const _0x52feee=(0x0,exports[_0x24d55b(0x26c)])(_0x1391d5);var _0x574afe=(0x0,exports[_0x24d55b(0x21b)])(_0x1391d5);const _0x39bcf1={'id':_0x1391d5['key']['id'],'ticketId':_0x4a390a['id'],'contactId':_0x1391d5['key'][_0x24d55b(0x1d6)]?undefined:_0x43fe20['id'],'body':_0x52feee?(0x0,Mustache_1['default'])(_0x52feee,_0x4a390a):_0x4cdb14[_0x24d55b(0x30e)],'fromMe':_0x1391d5['key'][_0x24d55b(0x1d6)],'read':_0x1391d5[_0x24d55b(0x1da)][_0x24d55b(0x1d6)],'mediaUrl':_0x4cdb14[_0x24d55b(0x30e)],'mediaType':typeof _0x4cdb14['mimetype']===_0x24d55b(0x25f)?_0x4cdb14[_0x24d55b(0x208)][_0x24d55b(0x307)]('/')[0x0]:_0x24d55b(0x23f),'quotedMsgId':_0x5eed92?.['id'],'ack':getStatus(_0x1391d5,'media'),'remoteJid':_0x1391d5[_0x24d55b(0x1da)]['remoteJid'],'participant':_0x1391d5[_0x24d55b(0x1da)]['participant'],'dataJson':JSON[_0x24d55b(0x23a)](_0x1391d5)};var _0x49298e=_0x52feee||_0x4cdb14[_0x24d55b(0x30e)];typeof _0x49298e!=_0x24d55b(0x25f)&&console[_0x24d55b(0x19a)](_0x24d55b(0x243),_0x49298e),await _0x4a390a[_0x24d55b(0x2a3)]({'lastMessage':_0x49298e}),_0x4fcd79=await(0x0,CreateMessageService_1[_0x24d55b(0x20f)])({'messageData':_0x39bcf1,'ticket':_0x4a390a,'companyId':_0x4a390a[_0x24d55b(0x2f4)]});}else typeof _0x4fcd79[_0x24d55b(0x309)]!=_0x24d55b(0x25f)&&console[_0x24d55b(0x19a)](_0x24d55b(0x243),_0x4fcd79[_0x24d55b(0x309)]),await _0x4a390a[_0x24d55b(0x2a3)]({'lastMessage':_0x4fcd79[_0x24d55b(0x309)]}),_0x4fcd79['ack']=getStatus(_0x1391d5,'media'),_0x4fcd79[_0x24d55b(0x1df)]=_0x1391d5[_0x24d55b(0x1da)][_0x24d55b(0x1df)],_0x4fcd79['dataJson']=JSON['stringify'](_0x1391d5),await _0x4fcd79[_0x24d55b(0x232)]();return!_0x1391d5[_0x24d55b(0x1da)][_0x24d55b(0x1d6)]&&_0x4a390a[_0x24d55b(0x26b)]==='closed'&&(await _0x4a390a[_0x24d55b(0x2a3)]({'status':_0x24d55b(0x1b8)}),await _0x4a390a['reload']({'include':[{'model':Queue_1[_0x24d55b(0x20f)],'as':_0x24d55b(0x1bb)},{'model':User_1[_0x24d55b(0x20f)],'as':_0x24d55b(0x222)},{'model':Contact_1[_0x24d55b(0x20f)],'as':_0x24d55b(0x1cb)}]}),_0x1e9ab0['to'](_0x24d55b(0x2a7)+_0x4a390a[_0x24d55b(0x2f4)]+_0x24d55b(0x2f1))[_0x24d55b(0x305)](_0x24d55b(0x2a7)+_0x4a390a[_0x24d55b(0x2f4)]+'-ticket',{'action':_0x24d55b(0x245),'ticket':_0x4a390a,'ticketId':_0x4a390a['id']}),_0x1e9ab0['to'](_0x24d55b(0x2a7)+_0x4a390a['companyId']+'-'+_0x4a390a[_0x24d55b(0x26b)])['to'](_0x4a390a['id'][_0x24d55b(0x1f6)]())[_0x24d55b(0x305)]('company-'+_0x4a390a[_0x24d55b(0x2f4)]+'-ticket',{'action':_0x24d55b(0x2a3),'ticket':_0x4a390a,'ticketId':_0x4a390a['id']})),_0x4fcd79;};function getStatus(_0x2b7c8a,_0xf15bab){const _0x40aac1=a550_0x4aba8b;if(_0x2b7c8a[_0x40aac1(0x26b)]==baileys_1['proto'][_0x40aac1(0x1e3)][_0x40aac1(0x206)][_0x40aac1(0x2a8)]){if(_0x2b7c8a[_0x40aac1(0x1da)][_0x40aac1(0x1d6)]&&_0xf15bab==_0x40aac1(0x2e0))return 0x3;return 0x1;}else{if(_0x2b7c8a['status']==baileys_1[_0x40aac1(0x229)]['WebMessageInfo'][_0x40aac1(0x206)][_0x40aac1(0x2df)])return 0x1;else{if(_0x2b7c8a[_0x40aac1(0x26b)]==baileys_1[_0x40aac1(0x229)][_0x40aac1(0x1e3)][_0x40aac1(0x206)][_0x40aac1(0x1cc)])return 0x2;else{if(_0x2b7c8a[_0x40aac1(0x26b)]==baileys_1[_0x40aac1(0x229)][_0x40aac1(0x1e3)][_0x40aac1(0x206)]['READ']||_0x2b7c8a[_0x40aac1(0x26b)]==baileys_1[_0x40aac1(0x229)][_0x40aac1(0x1e3)][_0x40aac1(0x206)][_0x40aac1(0x19c)])return 0x3;}}}return 0x0;}const verifyMessage=async(_0x3329a3,_0x44d8e1,_0x4df04a)=>{const _0x585995=a550_0x4aba8b,_0x1c9b8e=(0x0,socket_1[_0x585995(0x1c0)])(),_0x342a22=await(0x0,exports[_0x585995(0x298)])(_0x3329a3),_0x5b5e1c=(0x0,exports[_0x585995(0x26c)])(_0x3329a3);if(!_0x5b5e1c)return;let _0x1da188=(0x0,exports[_0x585995(0x21b)])(_0x3329a3);const _0x130bf8=_0x1da188==_0x585995(0x1a5)||_0x3329a3?.[_0x585995(0x19b)]?.[_0x585995(0x2ca)]?.[_0x585995(0x1a4)]==baileys_1[_0x585995(0x229)][_0x585995(0x312)]['ProtocolMessage'][_0x585995(0x195)][_0x585995(0x2d9)]||_0x3329a3?.['message']?.[_0x585995(0x2ca)]?.[_0x585995(0x1a5)]?.[_0x585995(0x2d7)]?.[_0x585995(0x20c)]>0x0;let _0x2ba9d5=_0x3329a3[_0x585995(0x1da)]['id'];if(_0x1da188==_0x585995(0x2ca))_0x2ba9d5=_0x3329a3?.[_0x585995(0x19b)]?.['protocolMessage']?.[_0x585995(0x1da)]?.['id']||_0x3329a3[_0x585995(0x1da)]['id'];else _0x1da188=='editedMessage'&&(_0x2ba9d5=_0x3329a3?.[_0x585995(0x19b)]?.['editedMessage']?.['message']?.[_0x585995(0x2ca)]?.[_0x585995(0x1da)]?.['id']||_0x3329a3[_0x585995(0x1da)]['id']);const _0x211e4c={'id':_0x2ba9d5,'ticketId':_0x44d8e1['id'],'contactId':_0x3329a3[_0x585995(0x1da)][_0x585995(0x1d6)]?undefined:_0x4df04a['id'],'body':_0x5b5e1c,'fromMe':_0x3329a3['key']['fromMe'],'mediaType':_0x1da188,'read':_0x3329a3[_0x585995(0x1da)]['fromMe'],'quotedMsgId':_0x342a22?.['id'],'ack':getStatus(_0x3329a3,_0x1da188),'remoteJid':_0x3329a3['key'][_0x585995(0x2b0)],'participant':_0x3329a3[_0x585995(0x1da)][_0x585995(0x1df)],'dataJson':JSON['stringify'](_0x3329a3),'isEdited':_0x130bf8};typeof _0x5b5e1c!=_0x585995(0x25f)&&console[_0x585995(0x19a)]('body\x20is\x20not\x20a\x20string',_0x5b5e1c);await _0x44d8e1[_0x585995(0x2a3)]({'lastMessage':_0x5b5e1c});if(_0x130bf8){let _0x1dd146=await Message_1[_0x585995(0x20f)][_0x585995(0x24d)](_0x211e4c['id']);if(_0x1dd146){const _0x1065ed={'messageId':_0x211e4c['id'],'body':_0x1dd146[_0x585995(0x309)]};await OldMessage_1['default']['upsert'](_0x1065ed);}else console[_0x585995(0x2b4)](_0x585995(0x28a)+_0x211e4c['id']);}await(0x0,CreateMessageService_1[_0x585995(0x20f)])({'messageData':_0x211e4c,'ticket':_0x44d8e1,'companyId':_0x44d8e1[_0x585995(0x2f4)]}),!_0x3329a3['key'][_0x585995(0x1d6)]&&_0x44d8e1[_0x585995(0x26b)]===_0x585995(0x27e)&&(await _0x44d8e1[_0x585995(0x2a3)]({'status':_0x585995(0x1b8)}),await _0x44d8e1[_0x585995(0x1f4)]({'include':[{'model':Queue_1[_0x585995(0x20f)],'as':_0x585995(0x1bb)},{'model':User_1['default'],'as':_0x585995(0x222)},{'model':Contact_1[_0x585995(0x20f)],'as':_0x585995(0x1cb)}]}),_0x1c9b8e['to'](_0x585995(0x2a7)+_0x44d8e1[_0x585995(0x2f4)]+_0x585995(0x2f1))[_0x585995(0x305)]('company-'+_0x44d8e1[_0x585995(0x2f4)]+_0x585995(0x1dd),{'action':_0x585995(0x245),'ticket':_0x44d8e1,'ticketId':_0x44d8e1['id']}),_0x1c9b8e['to'](_0x585995(0x2a7)+_0x44d8e1[_0x585995(0x2f4)]+'-'+_0x44d8e1[_0x585995(0x26b)])['to'](_0x44d8e1['id'][_0x585995(0x1f6)]())[_0x585995(0x305)](_0x585995(0x2a7)+_0x44d8e1['companyId']+'-ticket',{'action':_0x585995(0x2a3),'ticket':_0x44d8e1,'ticketId':_0x44d8e1['id']}));};exports['verifyMessage']=verifyMessage;const isValidMsg=_0x5278b1=>{const _0x576141=a550_0x4aba8b;if(_0x5278b1[_0x576141(0x1da)][_0x576141(0x2b0)]===_0x576141(0x24f))return![];try{const _0x3261a4=(0x0,exports['getTypeMessage'])(_0x5278b1);if(!_0x3261a4)return![];const _0x84f529=_0x3261a4===_0x576141(0x2d7)||_0x3261a4==='editedMessage'||_0x3261a4==='extendedTextMessage'||_0x3261a4==='audioMessage'||_0x3261a4===_0x576141(0x19d)||_0x3261a4===_0x576141(0x2cf)||_0x3261a4===_0x576141(0x30b)||_0x3261a4===_0x576141(0x25b)||_0x3261a4==='interactiveMessage'||_0x3261a4===_0x576141(0x1b0)||_0x3261a4===_0x576141(0x1b9)||_0x3261a4===_0x576141(0x2f3)||_0x3261a4==='stickerMessage'||_0x3261a4===_0x576141(0x1e5)||_0x3261a4===_0x576141(0x207)||_0x3261a4===_0x576141(0x236)||_0x3261a4===_0x576141(0x303)||_0x3261a4===_0x576141(0x21a)||_0x3261a4===_0x576141(0x2d3)||_0x3261a4==='voiceMessage'||_0x3261a4==='mediaMessage'||_0x3261a4==='contactsArrayMessage'||_0x3261a4==='reactionMessage'||_0x3261a4===_0x576141(0x294)||_0x3261a4===_0x576141(0x2ca)||_0x3261a4==='listResponseMessage'||_0x3261a4===_0x576141(0x1a6)||_0x3261a4===_0x576141(0x2b6)||_0x3261a4===_0x576141(0x1f5)||_0x3261a4===_0x576141(0x1a3)||_0x3261a4===_0x576141(0x320);return!_0x84f529&&(logger_1['logger'][_0x576141(0x1ea)](_0x576141(0x2af)+_0x3261a4+'\x0a'+JSON[_0x576141(0x23a)](_0x5278b1?.[_0x576141(0x19b)])),Sentry[_0x576141(0x2e8)]('Mensagem',{'BodyMsg':_0x5278b1[_0x576141(0x19b)],'msg':_0x5278b1,'msgType':_0x3261a4}),Sentry['captureException'](new Error(_0x576141(0x1ec)))),!!_0x84f529;}catch(_0x5e1b2d){Sentry[_0x576141(0x2e8)](_0x576141(0x2f5),{'msg':_0x5278b1}),Sentry[_0x576141(0x20d)](_0x5e1b2d);}return![];};function a550_0x29ba(_0x505c98,_0x3ee17e){const _0x25d95b=a550_0x2d55();return a550_0x29ba=function(_0x5cb467,_0xf91be){_0x5cb467=_0x5cb467-0x18d;let _0x2d5551=_0x25d95b[_0x5cb467];return _0x2d5551;},a550_0x29ba(_0x505c98,_0x3ee17e);}exports[a550_0x4aba8b(0x317)]=isValidMsg;const verifyQueue=async(_0x3fa54b,_0x1f5da9,_0x329db6,_0x8b4de9,_0x25f1cb)=>{const _0x4e3088=a550_0x4aba8b,_0x318a73=_0x329db6[_0x4e3088(0x2f4)],{queues:_0x5a40ee,greetingMessage:_0x37cc57,maxUseBotQueues:_0x281a52,timeUseBotQueues:_0xc73b40}=await(0x0,ShowWhatsAppService_1[_0x4e3088(0x20f)])(_0x3fa54b['id'],_0x329db6[_0x4e3088(0x2f4)]);if(_0x5a40ee[_0x4e3088(0x20c)]===0x1){const _0x32e3e0=(0x0,lodash_1['head'])(_0x5a40ee);let _0x5e881e=![];_0x32e3e0?.[_0x4e3088(0x2be)]&&(_0x5e881e=_0x32e3e0[_0x4e3088(0x2be)]['length']>0x0);const _0x4c78bf=await Setting_1['default'][_0x4e3088(0x2c9)]({'where':{'key':_0x4e3088(0x1c6),'companyId':_0x329db6['companyId']}});greetingMessageControl[_0x4e3088(0x25d)]({'ticketId':_0x329db6['id'],'greetingMessage':_0x37cc57,'companyId':_0x318a73});if(_0x37cc57[_0x4e3088(0x20c)]>0x1&&_0x4c78bf?.[_0x4e3088(0x1ae)]===_0x4e3088(0x191)){const _0x5dd3e8=await Message_1[_0x4e3088(0x20f)]['findOne']({'where':{'ticketId':_0x329db6['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x4e3088(0x28b)]]:(0x0,moment_1[_0x4e3088(0x20f)])()[_0x4e3088(0x2aa)](0x5,'minutes')['toDate']()}}});if(_0x5dd3e8)return;const _0x180549=(0x0,Mustache_1['default'])(''+_0x37cc57,_0x329db6);await _0x3fa54b['sendMessage'](_0x8b4de9[_0x4e3088(0x2c5)]+'@'+(_0x329db6[_0x4e3088(0x260)]?_0x4e3088(0x280):_0x4e3088(0x2cc)),{'text':_0x180549});}const _0x4437f6=await(0x0,ShowWhatsAppService_1['default'])(_0x3fa54b['id'],_0x318a73),_0x2e4d79=_0x5a40ee[0x0]?.[_0x4e3088(0x2f7)]||_0x4437f6[_0x4e3088(0x2f7)];if(!_0x1f5da9['key'][_0x4e3088(0x1d6)]&&!_0x329db6[_0x4e3088(0x260)]&&!(0x0,lodash_1[_0x4e3088(0x271)])(_0x2e4d79)){const _0x1cf76c=await(0x0,ShowQueueIntegrationService_1[_0x4e3088(0x20f)])(_0x2e4d79,_0x318a73);await(0x0,exports['handleMessageIntegration'])(_0x1f5da9,_0x3fa54b,_0x1cf76c,_0x329db6),await _0x329db6[_0x4e3088(0x2a3)]({'useIntegration':!![],'integrationId':_0x1cf76c['id']});}await(0x0,UpdateTicketService_1[_0x4e3088(0x20f)])({'ticketData':{'queueId':_0x32e3e0?.['id'],'chatbot':_0x5e881e,'status':'pending'},'ticketId':_0x329db6['id'],'companyId':_0x329db6[_0x4e3088(0x2f4)]});return;}const _0x7eaef4=_0x1f5da9?.[_0x4e3088(0x19b)]?.[_0x4e3088(0x1e5)]?.[_0x4e3088(0x253)]||_0x1f5da9?.[_0x4e3088(0x19b)]?.['listResponseMessage']?.[_0x4e3088(0x31a)]?.[_0x4e3088(0x198)]||_0x1f5da9?.[_0x4e3088(0x19b)]?.[_0x4e3088(0x1be)]?.['text']||_0x1f5da9?.[_0x4e3088(0x19b)]?.['conversation'];let _0xa7b044=null;if(_0x7eaef4&&!(0x0,exports[_0x4e3088(0x21e)])(_0x7eaef4)||+_0x7eaef4>_0x5a40ee[_0x4e3088(0x20c)]){const _0x2e04d4=_0x7eaef4[_0x4e3088(0x1c2)]();for(let _0x46e684 of _0x5a40ee){if(_0x46e684[_0x4e3088(0x2ae)]['toLowerCase']()===_0x2e04d4){_0xa7b044=_0x46e684;break;}if(_0x46e684[_0x4e3088(0x295)]&&_0x46e684[_0x4e3088(0x295)]['length']>0x0){let _0x7932de=_0x46e684[_0x4e3088(0x295)][_0x4e3088(0x307)](',\x20');for(let _0x3f3b13 of _0x7932de){if(_0x3f3b13[_0x4e3088(0x1c2)]()==_0x2e04d4){_0xa7b044=_0x46e684;break;}}}}}else _0xa7b044=_0x5a40ee[+_0x7eaef4-0x1];const _0x18ba7=await Setting_1[_0x4e3088(0x20f)][_0x4e3088(0x2c9)]({'where':{'key':'chatBotType','companyId':_0x318a73}}),_0x37eca3=async()=>{const _0x27d8e9=_0x4e3088;let _0x596f3f='';if(outOfHourMessageControl['length']>0x1388)outOfHourMessageControl=[];_0x5a40ee[_0x27d8e9(0x29b)]((_0x3258b3,_0x3193b6)=>{const _0x2241b=_0x27d8e9;_0x596f3f+=_0x2241b(0x2bb)+(_0x3193b6+0x1)+_0x2241b(0x2b7)+_0x3258b3['name']+'\x0a';});if(process[_0x27d8e9(0x268)][_0x27d8e9(0x1ad)]?.[_0x27d8e9(0x20c)]>=0x8){if(_0x329db6[_0x27d8e9(0x1cb)][_0x27d8e9(0x2c5)]!=process[_0x27d8e9(0x268)][_0x27d8e9(0x1ad)]){console[_0x27d8e9(0x19a)](_0x27d8e9(0x20e));return;}}const _0x58bd45={'text':(0x0,Mustache_1[_0x27d8e9(0x20f)])('â'+_0x37cc57+'\x0a\x0a'+_0x596f3f,_0x329db6)};await(0x0,UpdateTicketService_1['default'])({'ticketData':{'amountUsedBotQueues':_0x329db6[_0x27d8e9(0x264)]+0x1},'ticketId':_0x329db6['id'],'companyId':_0x329db6[_0x27d8e9(0x2f4)]});const _0x50d3dc=await _0x3fa54b[_0x27d8e9(0x1a9)](_0x8b4de9[_0x27d8e9(0x2c5)]+'@'+(_0x329db6['isGroup']?_0x27d8e9(0x280):_0x27d8e9(0x2cc)),_0x58bd45);await(0x0,exports[_0x27d8e9(0x1e0)])(_0x50d3dc,_0x329db6,_0x329db6[_0x27d8e9(0x1cb)]);};if(_0xa7b044){let _0x400266=![];_0xa7b044?.['options']&&(_0x400266=_0xa7b044['options']['length']>0x0);await(0x0,UpdateTicketService_1[_0x4e3088(0x20f)])({'ticketData':{'queueId':_0xa7b044['id'],'chatbot':_0x400266,'status':'pending','amountUsedBotQueues':0x0},'ticketId':_0x329db6['id'],'companyId':_0x329db6[_0x4e3088(0x2f4)]}),console[_0x4e3088(0x19a)](_0xa7b044[_0x4e3088(0x2be)]);if(_0xa7b044[_0x4e3088(0x2be)][_0x4e3088(0x20c)]===0x0){const _0xe983f=await Queue_1[_0x4e3088(0x20f)]['findByPk'](_0xa7b044['id']),{schedules:_0x282786}=_0xe983f,_0x297586=(0x0,moment_1[_0x4e3088(0x20f)])(),_0x1d6abf=_0x297586[_0x4e3088(0x248)](_0x4e3088(0x249))[_0x4e3088(0x1c2)]();let _0x4e2960;Array[_0x4e3088(0x2fd)](_0x282786)&&_0x282786[_0x4e3088(0x20c)]>0x0&&(_0x4e2960=_0x282786[_0x4e3088(0x282)](_0x2c3c70=>_0x2c3c70['weekdayEn']===_0x1d6abf&&_0x2c3c70[_0x4e3088(0x2e6)]!==''&&_0x2c3c70[_0x4e3088(0x2e6)]!==null&&_0x2c3c70[_0x4e3088(0x22b)]!==''&&_0x2c3c70[_0x4e3088(0x22b)]!==null));if(_0xe983f['outOfHoursMessage']!==null&&_0xe983f[_0x4e3088(0x300)]!==''&&!(0x0,lodash_1[_0x4e3088(0x271)])(_0x4e2960)){var _0x276f67=outOfHourMessageControl[_0x4e3088(0x282)](_0xb84591=>_0xb84591[_0x4e3088(0x225)]===_0x329db6['id']||_0xb84591[_0x4e3088(0x31e)]===_0x8b4de9['number']);if(!_0x276f67||_0x276f67&&_0x276f67[_0x4e3088(0x210)]+0x3e8*0x3c*0x5<new Date()[_0x4e3088(0x265)]()){_0x276f67&&(outOfHourMessageControl=outOfHourMessageControl[_0x4e3088(0x2a4)](_0x591581=>_0x591581[_0x4e3088(0x225)]!==_0x329db6['id']),_0x276f67=null);const _0x4380b2=(0x0,moment_1[_0x4e3088(0x20f)])(_0x4e2960[_0x4e3088(0x2e6)],_0x4e3088(0x1f3)),_0x5dffe6=(0x0,moment_1[_0x4e3088(0x20f)])(_0x4e2960[_0x4e3088(0x22b)],_0x4e3088(0x1f3));outOfHourMessageControl[_0x4e3088(0x25d)]({'ticketId':_0x329db6['id'],'time':new Date()[_0x4e3088(0x265)]()});if(_0x297586[_0x4e3088(0x2f6)](_0x4380b2)||_0x297586[_0x4e3088(0x1b6)](_0x5dffe6)){const _0x583e11=(0x0,Mustache_1[_0x4e3088(0x20f)])('â\x20'+_0xe983f[_0x4e3088(0x300)]+_0x4e3088(0x254),_0x329db6),_0x454a61=await _0x3fa54b['sendMessage'](_0x8b4de9['number']+'@'+(_0x329db6[_0x4e3088(0x260)]?_0x4e3088(0x280):_0x4e3088(0x2cc)),{'text':_0x583e11});await(0x0,exports[_0x4e3088(0x1e0)])(_0x454a61,_0x329db6,_0x8b4de9),await(0x0,UpdateTicketService_1[_0x4e3088(0x20f)])({'ticketData':{'queueId':null,'chatbot':_0x400266},'ticketId':_0x329db6['id'],'companyId':_0x329db6[_0x4e3088(0x2f4)]}),console[_0x4e3088(0x2b4)](_0x4e3088(0x1fc));return;}}!_0x276f67&&outOfHourMessageControl[_0x4e3088(0x25d)]({'ticketId':_0x329db6['id'],'dest':_0x8b4de9[_0x4e3088(0x2c5)],'time':new Date()[_0x4e3088(0x265)]()});}console[_0x4e3088(0x19a)](_0xa7b044[_0x4e3088(0x2f7)]);if(!_0x1f5da9[_0x4e3088(0x1da)]['fromMe']&&!_0x329db6[_0x4e3088(0x260)]&&_0xa7b044[_0x4e3088(0x2f7)]){const _0x40d3c1=await(0x0,ShowQueueIntegrationService_1['default'])(_0xa7b044['integrationId'],_0x318a73);await(0x0,exports['handleMessageIntegration'])(_0x1f5da9,_0x3fa54b,_0x40d3c1,_0x329db6),await _0x329db6[_0x4e3088(0x2a3)]({'useIntegration':!![],'integrationId':_0x40d3c1['id']});}const _0x20a3a4=(0x0,Mustache_1[_0x4e3088(0x20f)])('â'+_0xa7b044[_0x4e3088(0x2b2)],_0x329db6);if(_0xa7b044[_0x4e3088(0x2b2)]){const _0x3f1903=await _0x3fa54b['sendMessage'](_0x8b4de9[_0x4e3088(0x2c5)]+'@'+(_0x329db6[_0x4e3088(0x260)]?_0x4e3088(0x280):_0x4e3088(0x2cc)),{'text':_0x20a3a4});await(0x0,exports[_0x4e3088(0x1e0)])(_0x3f1903,_0x329db6,_0x8b4de9);if(_0xa7b044[_0x4e3088(0x18f)]!==null&&_0xa7b044[_0x4e3088(0x18f)]!==''){const _0x4d17ad=path_1[_0x4e3088(0x20f)]['resolve']('public','company'+_0xa7b044[_0x4e3088(0x2f4)],_0xa7b044[_0x4e3088(0x18f)]),_0x455abe=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0xa7b044['mediaName'],_0x4d17ad,null,_0x329db6[_0x4e3088(0x2f4)]);let _0x48e598=await _0x3fa54b[_0x4e3088(0x1a9)](_0x329db6[_0x4e3088(0x1cb)][_0x4e3088(0x2c5)]+'@'+(_0x329db6[_0x4e3088(0x260)]?_0x4e3088(0x280):'s.whatsapp.net'),{..._0x455abe});await verifyMediaMessage(_0x48e598,_0x329db6,_0x8b4de9);}}}}else{if(_0x281a52&&_0x281a52!==0x0&&_0x329db6[_0x4e3088(0x264)]>=_0x281a52)return;const _0x326735=await(0x0,FindOrCreateATicketTrakingService_1[_0x4e3088(0x20f)])({'ticketId':_0x329db6['id'],'companyId':_0x318a73});let _0x54c46f=new Date(),_0x54d416=new Date();if(_0x326735[_0x4e3088(0x242)]!==null){_0x54c46f['setMinutes'](_0x326735[_0x4e3088(0x242)][_0x4e3088(0x31b)]()+Number(_0xc73b40));if(_0x326735['chatbotAt']!==null&&_0x54d416<_0x54c46f&&_0xc73b40!=='0'&&_0x329db6[_0x4e3088(0x264)]!==0x0)return;}await _0x326735['update']({'updatedAt':new Date()});if(_0x18ba7[_0x4e3088(0x1ae)]===_0x4e3088(0x251))return console[_0x4e3088(0x19a)](_0x4e3088(0x25a)),_0x37eca3();}},verifyRating=_0x351af0=>{const _0x20c55f=a550_0x4aba8b;return _0x351af0&&_0x351af0[_0x20c55f(0x29e)]===null&&_0x351af0[_0x20c55f(0x2e7)]!==null&&_0x351af0['ratingAt']!==null;};exports[a550_0x4aba8b(0x2ac)]=verifyRating;const handleRating=async(_0x3633f7,_0x814f23,_0x47fb37)=>{const _0x2f0749=a550_0x4aba8b,_0x41725c=(0x0,socket_1['getIO'])();let _0x560593=null;(_0x3633f7?.[_0x2f0749(0x19b)]?.[_0x2f0749(0x2d7)]||_0x3633f7?.[_0x2f0749(0x19b)]?.[_0x2f0749(0x1be)])&&(_0x560593=parseInt(_0x3633f7['message'][_0x2f0749(0x2d7)]||_0x3633f7['message'][_0x2f0749(0x1be)][_0x2f0749(0x251)],0xa)||null);if(!Number[_0x2f0749(0x30f)](_0x560593)&&Number[_0x2f0749(0x23c)](_0x560593)&&!(0x0,lodash_1[_0x2f0749(0x205)])(_0x560593)){const {complationMessage:_0x1ac3e1}=await(0x0,ShowWhatsAppService_1[_0x2f0749(0x20f)])(_0x814f23['whatsappId'],_0x814f23[_0x2f0749(0x2f4)]);let _0xf41813=_0x560593;_0x560593<0x1&&(_0xf41813=0x1);_0x560593>0x5&&(_0xf41813=0x5);await UserRating_1['default'][_0x2f0749(0x2a1)]({'ticketId':_0x47fb37[_0x2f0749(0x225)],'companyId':_0x47fb37[_0x2f0749(0x2f4)],'userId':_0x47fb37['userId'],'rate':_0xf41813});if(_0x1ac3e1){if(completionMessageControl['length']>=0x9c4)completionMessageControl=[];var _0x21f321=completionMessageControl[_0x2f0749(0x282)](_0xa0ab45=>_0xa0ab45[_0x2f0749(0x225)]===_0x814f23['id']||_0xa0ab45[_0x2f0749(0x31e)]===_0x814f23['contact']['number']);if(!_0x21f321||_0x21f321&&_0x21f321[_0x2f0749(0x210)]+0x3e8*0x3c*0x1e<new Date()['getTime']()){_0x21f321&&(completionMessageControl=completionMessageControl[_0x2f0749(0x2a4)](_0x4c0469=>_0x4c0469[_0x2f0749(0x225)]!==_0x814f23['id']),_0x21f321=null);const _0x5ba929=(0x0,Mustache_1['default'])('â'+_0x1ac3e1,_0x814f23);await(0x0,SendPresenceStatus_1['SendPresenceStatus'])((0x0,wbot_1['getWbot'])(_0x814f23[_0x2f0749(0x24e)]),_0x814f23[_0x2f0749(0x1cb)][_0x2f0749(0x2c5)]+'@'+(_0x814f23['isGroup']?_0x2f0749(0x280):_0x2f0749(0x2cc))),await(0x0,SendWhatsAppMessage_1[_0x2f0749(0x20f)])({'body':_0x5ba929,'ticket':_0x814f23});}!_0x21f321&&completionMessageControl['push']({'ticketId':_0x814f23['id'],'dest':_0x814f23['contact']['number'],'time':new Date()[_0x2f0749(0x265)]()});}await _0x47fb37[_0x2f0749(0x2a3)]({'finishedAt':(0x0,moment_1[_0x2f0749(0x20f)])()[_0x2f0749(0x202)](),'ratedAt':(0x0,moment_1[_0x2f0749(0x20f)])()['toDate'](),'rated':!![]}),await _0x814f23[_0x2f0749(0x2a3)]({'queueId':null,'chatbot':null,'queueOptionId':null,'userId':null,'status':'closed'}),_0x41725c['to'](_0x2f0749(0x2a7)+_0x814f23[_0x2f0749(0x2f4)]+_0x2f0749(0x2a9))[_0x2f0749(0x305)](_0x2f0749(0x2a7)+_0x814f23['companyId']+_0x2f0749(0x1dd),{'action':_0x2f0749(0x245),'ticket':_0x814f23,'ticketId':_0x814f23['id']}),_0x41725c['to'](_0x2f0749(0x2a7)+_0x814f23[_0x2f0749(0x2f4)]+'-'+_0x814f23[_0x2f0749(0x26b)])['to'](_0x814f23['id']['toString']())[_0x2f0749(0x305)](_0x2f0749(0x2a7)+_0x814f23[_0x2f0749(0x2f4)]+'-ticket',{'action':_0x2f0749(0x2a3),'ticket':_0x814f23,'ticketId':_0x814f23['id']});}};exports[a550_0x4aba8b(0x1f9)]=handleRating;const handleChartbot=async(_0x47b4e7,_0x44aca2,_0x17a087,_0x3b074e,_0x425710=![])=>{const _0x37468b=a550_0x4aba8b;if(!_0x47b4e7['contact'][_0x37468b(0x1a7)]){const _0x2ec3ad=await Queue_1['default'][_0x37468b(0x24d)](_0x47b4e7[_0x37468b(0x1ab)],{'include':[{'model':QueueOption_1[_0x37468b(0x20f)],'as':'options','where':{'parentId':null},'order':[[_0x37468b(0x1ef),_0x37468b(0x1d1)],[_0x37468b(0x291),_0x37468b(0x1d1)]]}]}),_0xf06bf5=_0x44aca2?.[_0x37468b(0x19b)]?.[_0x37468b(0x1e5)]?.[_0x37468b(0x253)]||_0x44aca2?.[_0x37468b(0x19b)]?.[_0x37468b(0x315)]?.[_0x37468b(0x31a)]?.[_0x37468b(0x198)]||_0x44aca2?.[_0x37468b(0x19b)]?.[_0x37468b(0x1be)]?.[_0x37468b(0x251)]||_0x44aca2?.[_0x37468b(0x19b)]?.[_0x37468b(0x2d7)];if(_0xf06bf5=='#'&&(!_0x47b4e7[_0x37468b(0x2e7)]||_0x47b4e7['status']==_0x37468b(0x1b8))){console['trace'](_0x37468b(0x27c)),await _0x47b4e7[_0x37468b(0x2a3)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x17a087,_0x44aca2,_0x47b4e7,_0x47b4e7[_0x37468b(0x1cb)]);return;}if(!(0x0,lodash_1[_0x37468b(0x271)])(_0x2ec3ad)&&!(0x0,lodash_1['isNil'])(_0x47b4e7[_0x37468b(0x276)])&&_0xf06bf5=='0'){console['trace']('primeiro\x20if');const _0x53b83d=await QueueOption_1[_0x37468b(0x20f)][_0x37468b(0x24d)](_0x47b4e7[_0x37468b(0x276)]);await _0x47b4e7[_0x37468b(0x2a3)]({'queueOptionId':_0x53b83d?.[_0x37468b(0x1fa)],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1[_0x37468b(0x271)])(_0x2ec3ad)&&!(0x0,lodash_1['isNil'])(_0x47b4e7['queueOptionId'])){console['trace'](_0x37468b(0x2dc));const _0x232784=await QueueOption_1[_0x37468b(0x20f)]['count']({'where':{'parentId':_0x47b4e7[_0x37468b(0x276)]}});let _0x5356c7={};_0x232784==0x1?_0x5356c7=await QueueOption_1[_0x37468b(0x20f)]['findOne']({'where':{'parentId':_0x47b4e7[_0x37468b(0x276)]}}):(console[_0x37468b(0x19a)]('terceiro\x20if'),_0x5356c7=await QueueOption_1['default'][_0x37468b(0x2c9)]({'where':{[sequelize_1['Op']['or']]:[{'option':_0xf06bf5||''},{'title':_0xf06bf5||''}],'parentId':_0x47b4e7[_0x37468b(0x276)]}})),_0x5356c7&&await _0x47b4e7['update']({'queueOptionId':_0x5356c7?.['id'],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1[_0x37468b(0x271)])(_0x2ec3ad)&&(0x0,lodash_1[_0x37468b(0x271)])(_0x47b4e7[_0x37468b(0x276)])&&!_0x425710){console['trace'](_0x37468b(0x2db));const _0xacecee=_0x2ec3ad?.[_0x37468b(0x2be)][_0x37468b(0x282)](_0x5bd028=>_0x5bd028[_0x37468b(0x1ef)]==_0xf06bf5||_0x5bd028['title'][_0x37468b(0x1c2)]()==_0xf06bf5[_0x37468b(0x1c2)]());if(_0xacecee)await _0x47b4e7[_0x37468b(0x2a3)]({'queueOptionId':_0xacecee?.['id'],'amountUsedBotQueues':0x0});else{if(_0x3b074e['maxUseBotQueues']&&_0x3b074e[_0x37468b(0x215)]!==0x0&&_0x47b4e7[_0x37468b(0x264)]>=_0x3b074e[_0x37468b(0x215)])return;await _0x47b4e7[_0x37468b(0x2a3)]({'amountUsedBotQueues':_0x47b4e7[_0x37468b(0x264)]+0x1});}}else{if(_0x3b074e[_0x37468b(0x215)]&&_0x3b074e['maxUseBotQueues']!==0x0&&_0x47b4e7[_0x37468b(0x264)]>=_0x3b074e[_0x37468b(0x215)])return;await _0x47b4e7[_0x37468b(0x2a3)]({'amountUsedBotQueues':_0x47b4e7['amountUsedBotQueues']+0x1});}}}await _0x47b4e7[_0x37468b(0x1f4)]();if(!(0x0,lodash_1['isNil'])(_0x2ec3ad)&&(0x0,lodash_1[_0x37468b(0x271)])(_0x47b4e7[_0x37468b(0x276)])){const _0x36bdac=await QueueOption_1[_0x37468b(0x20f)][_0x37468b(0x1bd)]({'where':{'queueId':_0x47b4e7[_0x37468b(0x1ab)],'parentId':null},'order':[[_0x37468b(0x1ef),'ASC'],[_0x37468b(0x291),_0x37468b(0x1d1)]]}),_0x4876b3=_0x47b4e7[_0x37468b(0x2f4)],_0x9d1554=await Setting_1[_0x37468b(0x20f)][_0x37468b(0x2c9)]({'where':{'key':_0x37468b(0x290),'companyId':_0x4876b3}}),_0x128634=async()=>{const _0x5a031c=_0x37468b;let _0x29b5ce='';console['trace'](_0x5a031c(0x25a)),console[_0x5a031c(0x2b4)](_0x2ec3ad[_0x5a031c(0x18f)]),_0x36bdac[_0x5a031c(0x29b)]((_0x2a3a48,_0x3cef13)=>{const _0x47cc86=_0x5a031c;_0x29b5ce+='*[\x20'+_0x2a3a48[_0x47cc86(0x1ef)]+_0x47cc86(0x2b7)+_0x2a3a48[_0x47cc86(0x1b3)]+'\x0a';}),_0x29b5ce+='\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial';const _0x50e350={'text':(0x0,Mustache_1[_0x5a031c(0x20f)])('â'+_0x2ec3ad[_0x5a031c(0x2b2)]+'\x0a\x0a'+_0x29b5ce,_0x47b4e7)};let _0x11a136;if(!_0x2ec3ad['mediaPath'])_0x11a136=await _0x17a087['sendMessage'](_0x47b4e7[_0x5a031c(0x1cb)][_0x5a031c(0x2c5)]+'@'+(_0x47b4e7[_0x5a031c(0x260)]?_0x5a031c(0x280):_0x5a031c(0x2cc)),_0x50e350),await(0x0,exports[_0x5a031c(0x1e0)])(_0x11a136,_0x47b4e7,_0x47b4e7[_0x5a031c(0x1cb)]);else{const _0x51d2a5=path_1[_0x5a031c(0x20f)]['resolve'](_0x5a031c(0x1dc),_0x5a031c(0x2ef)+_0x47b4e7[_0x5a031c(0x2f4)],_0x2ec3ad[_0x5a031c(0x18f)]),_0x5499df=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x50e350[_0x5a031c(0x251)],_0x51d2a5,_0x50e350[_0x5a031c(0x251)],_0x47b4e7['companyId']);_0x11a136=await _0x17a087['sendMessage'](_0x47b4e7[_0x5a031c(0x1cb)][_0x5a031c(0x2c5)]+'@'+(_0x47b4e7[_0x5a031c(0x260)]?_0x5a031c(0x280):_0x5a031c(0x2cc)),{..._0x5499df}),await verifyMediaMessage(_0x11a136,_0x47b4e7,_0x47b4e7['contact']);}};if(_0x9d1554[_0x37468b(0x1ae)]===_0x37468b(0x251))return console[_0x37468b(0x19a)](_0x37468b(0x25a)),_0x128634();if(_0x9d1554[_0x37468b(0x1ae)]===_0x37468b(0x2d1)&&QueueOption_1[_0x37468b(0x20f)][_0x37468b(0x20c)]>0x4)return console[_0x37468b(0x19a)](_0x37468b(0x25a)),_0x128634();}else{if(!(0x0,lodash_1['isNil'])(_0x2ec3ad)&&!(0x0,lodash_1[_0x37468b(0x271)])(_0x47b4e7[_0x37468b(0x276)])){const _0xaa7f6c=await QueueOption_1[_0x37468b(0x20f)][_0x37468b(0x24d)](_0x47b4e7[_0x37468b(0x276)]),_0x5df79b=await QueueOption_1[_0x37468b(0x20f)][_0x37468b(0x1bd)]({'where':{'parentId':_0x47b4e7[_0x37468b(0x276)]},'order':[[_0x37468b(0x1ef),_0x37468b(0x1d1)],[_0x37468b(0x291),_0x37468b(0x1d1)]]});if(_0x5df79b[_0x37468b(0x20c)]===0x0){const _0x53a2b7={'text':(0x0,Mustache_1[_0x37468b(0x20f)])('â'+_0xaa7f6c[_0x37468b(0x19b)],_0x47b4e7)},_0x6b7202=await _0x17a087[_0x37468b(0x1a9)](_0x47b4e7['contact'][_0x37468b(0x2c5)]+'@'+(_0x47b4e7[_0x37468b(0x260)]?'g.us':_0x37468b(0x2cc)),_0x53a2b7);await(0x0,exports[_0x37468b(0x1e0)])(_0x6b7202,_0x47b4e7,_0x47b4e7['contact']),await _0x47b4e7[_0x37468b(0x2a3)]({'queueOptionId':null,'chatbot':![]});return;}if(_0x5df79b[_0x37468b(0x20c)]>-0x1){const _0x1c90d6=_0x47b4e7['companyId'],_0x263153=await Setting_1[_0x37468b(0x20f)]['findOne']({'where':{'key':'chatBotType','companyId':_0x1c90d6}}),_0x398d35=async()=>{const _0x2019b8=_0x37468b;let _0x24e5f1='';_0x5df79b[_0x2019b8(0x29b)]((_0x50904b,_0x3ebce6)=>{const _0x4ba870=_0x2019b8;_0x24e5f1+=_0x4ba870(0x2bb)+_0x50904b[_0x4ba870(0x1ef)]+_0x4ba870(0x2b7)+_0x50904b[_0x4ba870(0x1b3)]+'\x0a';}),_0x24e5f1+='\x0a*[\x200\x20]*\x20-\x20Menu\x20anterior',_0x24e5f1+=_0x2019b8(0x240);const _0x41e523={'text':(0x0,Mustache_1[_0x2019b8(0x20f)])('â'+_0xaa7f6c[_0x2019b8(0x19b)]+'\x0a\x0a'+_0x24e5f1,_0x47b4e7)};if(process['env'][_0x2019b8(0x1ad)]?.[_0x2019b8(0x20c)]>=0x8){if(_0x47b4e7['contact'][_0x2019b8(0x2c5)]!=process[_0x2019b8(0x268)][_0x2019b8(0x1ad)]){console[_0x2019b8(0x19a)]('chatbot\x20desativado!');return;}}if(!_0xaa7f6c[_0x2019b8(0x18f)]){const _0x53a183=await _0x17a087[_0x2019b8(0x1a9)](_0x47b4e7[_0x2019b8(0x1cb)][_0x2019b8(0x2c5)]+'@'+(_0x47b4e7[_0x2019b8(0x260)]?_0x2019b8(0x280):_0x2019b8(0x2cc)),_0x41e523);await(0x0,exports[_0x2019b8(0x1e0)])(_0x53a183,_0x47b4e7,_0x47b4e7['contact']);}else{const _0x34446b=path_1[_0x2019b8(0x20f)][_0x2019b8(0x211)]('public',_0x2019b8(0x2ef)+_0x47b4e7['companyId'],_0xaa7f6c['mediaPath']),_0x499e98=await(0x0,SendWhatsAppMedia_1[_0x2019b8(0x24c)])(_0xaa7f6c[_0x2019b8(0x2e9)],_0x34446b,_0x41e523['text'],_0x47b4e7[_0x2019b8(0x2f4)]);let _0x3a5eaf=await _0x17a087[_0x2019b8(0x1a9)](_0x47b4e7[_0x2019b8(0x1cb)][_0x2019b8(0x2c5)]+'@'+(_0x47b4e7[_0x2019b8(0x260)]?_0x2019b8(0x280):_0x2019b8(0x2cc)),{..._0x499e98});await verifyMediaMessage(_0x3a5eaf,_0x47b4e7,_0x47b4e7['contact']);}};if(_0x263153[_0x37468b(0x1ae)]===_0x37468b(0x251))return console[_0x37468b(0x19a)](_0x37468b(0x29a)),_0x398d35();if(_0x263153[_0x37468b(0x1ae)]==='button'&&QueueOption_1[_0x37468b(0x20f)][_0x37468b(0x20c)]>0x4)return console[_0x37468b(0x19a)]('botText\x202'),_0x398d35();}}}}},handleMessageIntegration=async(_0x5a8b0d,_0x4b2142,_0x17e503,_0x58f9d5)=>{const _0x2a0456=a550_0x4aba8b;if(process['env'][_0x2a0456(0x1ad)]){if(_0x58f9d5[_0x2a0456(0x1cb)][_0x2a0456(0x2c5)]!=process[_0x2a0456(0x268)][_0x2a0456(0x1ad)]){console[_0x2a0456(0x2b4)]('chatbot\x20desativado!');return;}}_0x17e503[_0x2a0456(0x1a4)]===_0x2a0456(0x292)?await(0x0,typebotListener_1[_0x2a0456(0x20f)])({'ticket':_0x58f9d5,'msg':_0x5a8b0d,'wbot':_0x4b2142,'typebot':_0x17e503}):console[_0x2a0456(0x2b4)](_0x2a0456(0x20b));};exports[a550_0x4aba8b(0x1ee)]=handleMessageIntegration;const messageContainsMedia=_0x291ab9=>{const _0xd61e5b=a550_0x4aba8b;return _0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x1b0)]||_0x291ab9['message']?.[_0xd61e5b(0x2f0)]||_0x291ab9[_0xd61e5b(0x19b)]?.['videoMessage']||_0x291ab9['message']?.[_0xd61e5b(0x1c7)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x1b9)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x2f3)]?.[_0xd61e5b(0x19b)]?.['documentMessage']||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x294)]?.[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x2f0)]||_0x291ab9['message']?.[_0xd61e5b(0x294)]?.['message']?.['documentMessage']||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x294)]?.[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x19d)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x294)]?.['message']?.[_0xd61e5b(0x1c7)]||_0x291ab9[_0xd61e5b(0x19b)]?.['ephemeralMessage']?.[_0xd61e5b(0x19b)]?.['imageMessage']||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x2b6)]?.['message']?.[_0xd61e5b(0x1b0)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x2b6)]?.['message']?.['videoMessage']||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x294)]?.[_0xd61e5b(0x19b)]?.['viewOnceMessage']?.[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x1b0)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x294)]?.[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x2b6)]?.[_0xd61e5b(0x19b)]?.['videoMessage']||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x294)]?.[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x2b6)]?.[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x2f0)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x294)]?.[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x2b6)]?.['message']?.[_0xd61e5b(0x1b9)]||_0x291ab9[_0xd61e5b(0x19b)]?.['documentWithCaptionMessage']?.[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x1b9)]||_0x291ab9['message']?.[_0xd61e5b(0x30b)]?.['hydratedTemplate']?.[_0xd61e5b(0x1b0)]||_0x291ab9['message']?.['templateMessage']?.[_0xd61e5b(0x1c5)]?.[_0xd61e5b(0x1b9)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x30b)]?.[_0xd61e5b(0x1c5)]?.[_0xd61e5b(0x19d)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x30b)]?.[_0xd61e5b(0x1d7)]?.[_0xd61e5b(0x1b0)]||_0x291ab9['message']?.[_0xd61e5b(0x30b)]?.[_0xd61e5b(0x1d7)]?.['documentMessage']||_0x291ab9['message']?.[_0xd61e5b(0x30b)]?.[_0xd61e5b(0x1d7)]?.[_0xd61e5b(0x19d)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x30b)]?.[_0xd61e5b(0x22f)]?.[_0xd61e5b(0x1b0)]||_0x291ab9['message']?.[_0xd61e5b(0x30b)]?.[_0xd61e5b(0x22f)]?.[_0xd61e5b(0x1b9)]||_0x291ab9['message']?.[_0xd61e5b(0x30b)]?.[_0xd61e5b(0x22f)]?.[_0xd61e5b(0x19d)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x2c3)]?.[_0xd61e5b(0x2e5)]?.[_0xd61e5b(0x1b0)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x2c3)]?.[_0xd61e5b(0x2e5)]?.[_0xd61e5b(0x1b9)]||_0x291ab9['message']?.['interactiveMessage']?.['header']?.[_0xd61e5b(0x19d)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x320)]?.[_0xd61e5b(0x2bc)]?.[_0xd61e5b(0x1c5)]?.[_0xd61e5b(0x1b9)]||_0x291ab9[_0xd61e5b(0x19b)]?.[_0xd61e5b(0x320)]?.[_0xd61e5b(0x2bc)]?.[_0xd61e5b(0x1c5)]?.['videoMessage']||_0x291ab9[_0xd61e5b(0x19b)]?.['highlyStructuredMessage']?.[_0xd61e5b(0x2bc)]?.['hydratedTemplate']?.[_0xd61e5b(0x1b0)]||_0x291ab9[_0xd61e5b(0x19b)]?.['highlyStructuredMessage']?.[_0xd61e5b(0x2bc)]?.[_0xd61e5b(0x1c5)]?.[_0xd61e5b(0x303)];},handleMessage=async(_0x2c6f55,_0x43178b,_0x10dd5e,_0x4bc115=![])=>{const _0x3139e5=a550_0x4aba8b;if(_0x4bc115){console[_0x3139e5(0x2b4)](_0x3139e5(0x1ce));let _0x4916e9=_0x2c6f55['key']['id'],_0x2394b8=await Message_1['default'][_0x3139e5(0x1e9)]({'where':{'id':_0x4916e9}});if(_0x2394b8>0x0){await new Promise(_0x22f9d2=>setTimeout(_0x22f9d2,0x96));return;}else await new Promise(_0x55ec47=>setTimeout(_0x55ec47,0x14a));}let _0x5cab09;if(!(0x0,exports[_0x3139e5(0x317)])(_0x2c6f55)){console[_0x3139e5(0x2b4)]('Mensagem\x20invÃ¡lida!'),console[_0x3139e5(0x2b4)](_0x2c6f55);return;}_0x2c6f55[_0x3139e5(0x19b)]?.['ephemeralMessage']&&(_0x2c6f55['message']=_0x2c6f55[_0x3139e5(0x19b)][_0x3139e5(0x294)][_0x3139e5(0x19b)]);try{let _0x5d5fc6;const _0xf6e6a7=_0x2c6f55['key']['remoteJid']?.[_0x3139e5(0x2c0)](_0x3139e5(0x285)),_0xaa408d=await Setting_1['default'][_0x3139e5(0x2c9)]({'where':{'companyId':_0x10dd5e,'key':_0x3139e5(0x1e7)}});if(_0xaa408d?.[_0x3139e5(0x1ae)]===_0x3139e5(0x191)&&_0xf6e6a7){console[_0x3139e5(0x2b4)](_0x3139e5(0x1c8));return;}let _0x523c11=(0x0,exports[_0x3139e5(0x26c)])(_0x2c6f55);const _0x461e34=(0x0,exports['getTypeMessage'])(_0x2c6f55);typeof _0x523c11===_0x3139e5(0x25f)&&(_0x523c11=_0x523c11['replace'](/\u200c/,''));const _0x5f30bd=messageContainsMedia(_0x2c6f55);if(_0x2c6f55[_0x3139e5(0x1da)][_0x3139e5(0x1d6)]){if(!_0x5f30bd&&_0x461e34!=='conversation'&&_0x461e34!=='extendedTextMessage'&&_0x461e34!==_0x3139e5(0x197)&&_0x461e34!=='contactMessage'&&_0x461e34!==_0x3139e5(0x294)&&_0x461e34!==_0x3139e5(0x2ca)&&_0x461e34!==_0x3139e5(0x2e0)&&_0x461e34!==_0x3139e5(0x2b6)&&_0x461e34!==_0x3139e5(0x303)&&_0x461e34!==_0x3139e5(0x199)&&_0x461e34!==_0x3139e5(0x1a3)){console[_0x3139e5(0x19a)](_0x461e34);return;}}const _0x1230eb=await(0x0,ShowWhatsAppService_1[_0x3139e5(0x20f)])(_0x43178b['id'],_0x10dd5e);let _0x570f39,_0x2dc2bd=await getContactMessage(_0x2c6f55,_0x43178b);_0x5d5fc6=await verifyContact(_0x2dc2bd,_0x43178b,_0x10dd5e);if(_0xf6e6a7){if(!_0x1230eb[_0x3139e5(0x261)])return;try{const _0x405a59=await _0x43178b[_0x3139e5(0x2b5)](_0x2c6f55[_0x3139e5(0x1da)][_0x3139e5(0x2b0)]),_0x4b471c={'id':_0x405a59['id'],'name':_0x405a59[_0x3139e5(0x1cd)]};_0x570f39=await verifyContact(_0x4b471c,_0x43178b,_0x10dd5e);}catch(_0x27a1b1){console['log'](_0x3139e5(0x2eb)),console[_0x3139e5(0x2b4)](_0x27a1b1);return;}}let _0x2a297d=0x0;if(_0x2c6f55[_0x3139e5(0x1da)][_0x3139e5(0x1d6)])await cache_1[_0x3139e5(0x20f)][_0x3139e5(0x1b5)](_0x3139e5(0x1db)+_0x5d5fc6['id']+':unreads','0');else{const _0x449ef6=await cache_1[_0x3139e5(0x20f)][_0x3139e5(0x2a6)]('contacts:'+_0x5d5fc6['id']+_0x3139e5(0x1bf));_0x2a297d=+_0x449ef6+0x1,await cache_1['default'][_0x3139e5(0x1b5)](_0x3139e5(0x1db)+_0x5d5fc6['id']+':unreads',''+_0x2a297d);}if(_0x5d5fc6[_0x3139e5(0x2c5)]===_0x1230eb[_0x3139e5(0x2c5)]){logger_1['logger'][_0x3139e5(0x269)]('Ignorando\x20criaÃ§Ã£o\x20de\x20ticket\x20para\x20o\x20nÃºmero\x20proprietÃ¡rio.');return;}const _0x14370a=await(0x0,FindOrCreateTicketService_1['default'])(_0x5d5fc6,_0x43178b['id'],_0x2a297d,_0x10dd5e,_0x570f39,_0x4bc115),_0x27a3ee=await(0x0,FindOrCreateATicketTrakingService_1[_0x3139e5(0x20f)])({'ticketId':_0x14370a['id'],'companyId':_0x10dd5e,'whatsappId':_0x1230eb?.['id']});_0x27a3ee[_0x3139e5(0x21d)](_0x3139e5(0x25e),!![]),await _0x27a3ee['update']({'updatedAt':new Date()});if(_0x1230eb[_0x3139e5(0x2dd)]&&_0x2a297d===0x0){const _0x2e064e=await Message_1['default'][_0x3139e5(0x2c9)]({'where':{'contactId':_0x5d5fc6['id'],'companyId':_0x10dd5e},'order':[[_0x3139e5(0x291),_0x3139e5(0x2e3)]]});if((0x0,Mustache_1[_0x3139e5(0x20f)])(_0x1230eb[_0x3139e5(0x2dd)],_0x14370a)[_0x3139e5(0x27a)]()['toLowerCase']()===_0x2e064e?.[_0x3139e5(0x309)][_0x3139e5(0x27a)]()[_0x3139e5(0x1c2)]())return;}if(_0x523c11=='#'&&!_0x4bc115&&(!_0x14370a['userId']||_0x14370a[_0x3139e5(0x26b)]==_0x3139e5(0x1b8))){await _0x14370a[_0x3139e5(0x2a3)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x43178b,_0x2c6f55,_0x14370a,_0x14370a[_0x3139e5(0x1cb)]);return;}try{if(!_0x2c6f55[_0x3139e5(0x1da)][_0x3139e5(0x1d6)]&&!_0x4bc115){if(_0x523c11!=null&&typeof _0x523c11!==_0x3139e5(0x25f)){console[_0x3139e5(0x2b4)](_0x523c11),console[_0x3139e5(0x19a)](_0x3139e5(0x2cb),typeof _0x523c11);return;}if(_0x523c11?.[_0x3139e5(0x1ff)]()==='SAIR'&&_0x14370a['status']!=_0x3139e5(0x27e)){await(0x0,SendPresenceStatus_1[_0x3139e5(0x293)])(_0x43178b,_0x14370a[_0x3139e5(0x1cb)][_0x3139e5(0x2c5)]+'@'+(_0x14370a['isGroup']?_0x3139e5(0x280):_0x3139e5(0x2cc)));const _0x501b0e=await _0x43178b['sendMessage'](_0x14370a[_0x3139e5(0x1cb)][_0x3139e5(0x2c5)]+'@'+(_0x14370a[_0x3139e5(0x260)]?_0x3139e5(0x280):_0x3139e5(0x2cc)),{'text':_0x3139e5(0x2b1)});await(0x0,exports[_0x3139e5(0x1e0)])(_0x501b0e,_0x14370a,_0x14370a[_0x3139e5(0x1cb)]),await(0x0,UpdateTicketService_1[_0x3139e5(0x20f)])({'ticketData':{'queueId':null,'status':_0x3139e5(0x27e)},'ticketId':_0x14370a['id'],'companyId':_0x14370a[_0x3139e5(0x2f4)]}),await _0x14370a[_0x3139e5(0x1f4)]();return;}}}catch(_0x278c8d){console['log'](_0x3139e5(0x228)),console[_0x3139e5(0x2b4)](_0x278c8d),Sentry['captureException'](_0x278c8d);}try{await _0x14370a[_0x3139e5(0x2a3)]({'fromMe':_0x2c6f55['key'][_0x3139e5(0x1d6)]});}catch(_0x12f40d){console[_0x3139e5(0x2b4)](_0x3139e5(0x220)),console['log'](_0x12f40d),Sentry[_0x3139e5(0x20d)](_0x12f40d);}try{if(!_0x2c6f55['key'][_0x3139e5(0x1d6)]){if((0x0,exports[_0x3139e5(0x2ac)])(_0x27a3ee)){await(0x0,exports['handleRating'])(_0x2c6f55,_0x14370a,_0x27a3ee),console[_0x3139e5(0x2b4)](_0x3139e5(0x30a)+_0x2c6f55);return;}}}catch(_0x45ce6c){console['log'](_0x3139e5(0x23d)),Sentry['captureException'](_0x45ce6c),console[_0x3139e5(0x2b4)](_0x45ce6c);}_0x5f30bd?_0x5cab09=await verifyMediaMessage(_0x2c6f55,_0x14370a,_0x5d5fc6):await(0x0,exports[_0x3139e5(0x1e0)])(_0x2c6f55,_0x14370a,_0x5d5fc6);const _0x510146=await(0x0,VerifyCurrentSchedule_1[_0x3139e5(0x20f)])(_0x10dd5e),_0x14f065=await Setting_1[_0x3139e5(0x20f)]['findOne']({'where':{'companyId':_0x10dd5e,'key':_0x3139e5(0x318)}});if(!_0x2c6f55[_0x3139e5(0x1da)][_0x3139e5(0x1d6)]&&_0x14f065&&!_0x4bc115)await handleOutOfHour(_0x43178b,_0x14370a,_0x14f065,_0x5d5fc6,_0x510146,_0x1230eb);if(!_0x2c6f55[_0x3139e5(0x1da)][_0x3139e5(0x1d6)]&&!_0x14370a[_0x3139e5(0x260)]&&!_0x14370a[_0x3139e5(0x1bb)]&&!_0x14370a[_0x3139e5(0x222)]&&_0x14370a[_0x3139e5(0x1a1)]&&!(0x0,lodash_1['isNil'])(_0x1230eb[_0x3139e5(0x2f7)])&&!_0x14370a[_0x3139e5(0x201)]&&!_0x4bc115){const _0x57a1e8=await(0x0,ShowQueueIntegrationService_1['default'])(_0x1230eb['integrationId'],_0x10dd5e);await(0x0,exports['handleMessageIntegration'])(_0x2c6f55,_0x43178b,_0x57a1e8,_0x14370a);return;}if(!_0x2c6f55[_0x3139e5(0x1da)][_0x3139e5(0x1d6)]&&!_0x14370a[_0x3139e5(0x260)]&&!_0x14370a[_0x3139e5(0x2e7)]&&_0x14370a['integrationId']&&_0x14370a[_0x3139e5(0x201)]&&!_0x4bc115){const _0x27819a=await(0x0,ShowQueueIntegrationService_1[_0x3139e5(0x20f)])(_0x14370a['integrationId'],_0x10dd5e);await(0x0,exports[_0x3139e5(0x1ee)])(_0x2c6f55,_0x43178b,_0x27819a,_0x14370a);}!_0x14370a[_0x3139e5(0x1bb)]&&!_0x14370a[_0x3139e5(0x260)]&&!_0x2c6f55[_0x3139e5(0x1da)][_0x3139e5(0x1d6)]&&!_0x14370a[_0x3139e5(0x2e7)]&&_0x1230eb[_0x3139e5(0x2f9)][_0x3139e5(0x20c)]>=0x1&&!_0x14370a[_0x3139e5(0x201)]&&!_0x4bc115&&(await verifyQueue(_0x43178b,_0x2c6f55,_0x14370a,_0x5d5fc6),_0x27a3ee['changed'](_0x3139e5(0x242),!![]),_0x27a3ee['changed'](_0x3139e5(0x25e),!![]),await _0x27a3ee[_0x3139e5(0x2a3)]({'chatbotAt':(0x0,moment_1[_0x3139e5(0x20f)])()['toDate'](),'updatedAt':new Date()}));const _0x39a319=_0x14370a[_0x3139e5(0x1bb)]===null;await _0x14370a[_0x3139e5(0x1f4)]();if(!_0x4bc115&&_0x1230eb[_0x3139e5(0x2b2)])await greetingMessage(_0x43178b,_0x14370a,_0x2c6f55,_0x1230eb,_0xf6e6a7);_0x1230eb[_0x3139e5(0x2f9)]['length']==0x1&&_0x14370a['queue']&&!_0x4bc115&&(_0x14370a[_0x3139e5(0x1a1)]&&!_0x2c6f55['key'][_0x3139e5(0x1d6)]&&!_0x14370a[_0x3139e5(0x2e7)]&&await handleChartbot(_0x14370a,_0x2c6f55,_0x43178b,_0x1230eb)),_0x1230eb[_0x3139e5(0x2f9)][_0x3139e5(0x20c)]>0x1&&_0x14370a['queue']&&!_0x4bc115&&(_0x14370a[_0x3139e5(0x1a1)]&&!_0x2c6f55['key'][_0x3139e5(0x1d6)]&&!_0x14370a['userId']&&await handleChartbot(_0x14370a,_0x2c6f55,_0x43178b,_0x1230eb,_0x39a319));}catch(_0x4e5d59){console['log'](_0x4e5d59),Sentry[_0x3139e5(0x20d)](_0x4e5d59),logger_1[_0x3139e5(0x2cd)][_0x3139e5(0x1b2)](_0x3139e5(0x1fb)+_0x4e5d59);}};function a550_0x2d55(){const _0x136371=['test','chatbotAt','body\x20is\x20not\x20a\x20string','./SendWhatsAppMessage','delete','fluent-ffmpeg','36ctfRyJ','format','dddd','util','now','getMessageOptions','findByPk','whatsappId','status@broadcast','chmodSync','text','__createBinding','selectedButtonId','\x0a\x0a*[\x20#\x20]*\x20-\x20Voltar\x20ao\x20Menu\x20Principal','getReactionMessage','getAd','1559592cbdxMc','rate','\x20Download\x20completed\x20in\x20','botText','pollCreationMessageV3','replace','push','updatedAt','string','isGroup','allowGroup','getGroupInviteMessage','../../libs/socket','amountUsedBotQueues','getTime','Pedido','Throttle','env','info','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','status','getBodyMessage','../MessageServices/CreateMessageService','handleMsgAck','getListMessage','add','isNil','../../models/UserRating','../../helpers/MakeRandomId','309048lrkDYH','../../helpers/Debounce','queueOptionId','extractMessageContent','EM_ANDAMENTO','defineProperty','trim','messageStubType','##\x20if','322723FZOsaz','closed','includes','g.us','caption','find','18319fJIDyF','wbotMessageListener','@g.us','reaction','join','>>>>\x20erro\x20','makeid','Mensagem\x20editada\x20nÃ£o\x20encontrada:\x20','gte','(((.+)+)+)+$','keys','setFfmpegPath','%2C','chatBotType','createdAt','typebot','SendPresenceStatus','ephemeralMessage','keywords','lodash','randomValue','verifyQuotedMessage','../../libs/cache','botText\x203','forEach','getQuotedMessageId','substring','finishedAt','8117956IwRJxn','MessageUpdateJob','create','public/company','update','filter','data:image/png;base64,\x20','get','company-','PENDING','-open','subtract','\x20MBps','verifyRating','getQuotedMessage','name','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','remoteJid','*VocÃª\x20encerrou\x20este\x20atendimento\x20usando\x20o\x20comando\x20SAIR*.\x0a\x0a\x0aSe\x20vocÃª\x20finalizou\x20o\x20atendimento\x20*ANTES*\x20de\x20receber\x20um\x20retorno\x20do\x20operador,\x20ele\x20*NÃO*\x20irÃ¡\x20visualizar\x20sua\x20solicitaÃ§Ã£o!\x0a\x0aVocÃª\x20deve\x20aguardar\x20o\x20retorno\x20do\x20operador\x20e\x20que\x20ele\x20encerre\x20seu\x20atendimento\x20quando\x20necessÃ¡rio.\x0a\x0aUse\x20a\x20opÃ§Ã£o\x20*SAIR*\x20somente\x20em\x20casos\x20de\x20emergÃªncia\x20ou\x20se\x20ficou\x20preso\x20em\x20algum\x20setor.\x0a\x0a\x0aPara\x20iniciar\x20um\x20novo\x20atendimento\x20basta\x20enviar\x20uma\x20nova\x20mensagem!','greetingMessage','getLocationMessage','log','groupMetadata','viewOnceMessage','\x20]*\x20-\x20','@whiskeysockets/baileys','endLunchTime','makeRandomId','*[\x20','hydratedHsm','extension','options','getCallMessage','endsWith','messages.upsert','contextInfo','interactiveMessage','10FbCNIE','number','moment','application/pdf','quotedMsg','findOne','protocolMessage','Expected\x20bodyMessage\x20to\x20be\x20a\x20string,\x20got:','s.whatsapp.net','logger','stanzaId','pollCreationMessageV2','&z=17&hl=pt-BR|','button','mkdirSync','contactMessage','110478VZdakZ','verifyCampaignMessageAndCloseTicket','slice','conversation','../../models/QueueOption','MESSAGE_EDIT','downloadContentFromMessage','quarto\x20if','segundo\x20if','complationMessage','CIPHERTEXT','SERVER_ACK','reactionMessage','E2E_DEVICE_CHANGED','constructor','DESC','sendMessageImage','header','startTime','userId','setExtra','mediaName','fileName','Erro\x20ao\x20buscar\x20grupo!','getStickerMessage','Enquete\x20nÃ£o\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','getAudioMessage','company','audioMessage','-closed','getTemplateMessage','documentWithCaptionMessage','companyId','Error\x20isValidMsg','isBefore','integrationId','toFixed','queues','pushName','Produto','removeNonPrintableChars','isArray','Erro\x20ao\x20processar\x20ACK\x20da\x20mensagem.\x20ID:\x20','getContentType','outOfHoursMessage','public/temp/','selectedId','locationMessage','getVideoMessage','emit','application','split','ffmpeg-static','body','Mensagem\x20invÃ¡lida\x208!\x20','templateMessage','getContactMessage','degreesLongitude','filename','isNaN','pipe','__setModuleDefault','Message','values','productImage','listResponseMessage','ID\x20da\x20mensagem\x20invÃ¡lido\x20ou\x20ausente:','isValidMsg','scheduleType','startLunchTime','singleSelectReply','getMinutes',',\x20ACK:\x20','getOwnPropertyDescriptor','dest','__importStar','highlyStructuredMessage','AtualizaÃ§Ã£o\x20de\x20Status','readFileSync','Failed\x20to\x20get\x20stream','productMessage','mediaPath',',\x20Erro:\x20','enabled','../QueueIntegrationServices/ShowQueueIntegrationService','../../models/User','../../models/OldMessage','Type','sleep','vcard','selectedRowId','hydratedContentText','trace','message','PLAYED','videoMessage','getViewOnceMessageV2','directPath','templateButtonReplyMessage','chatbot','floor','advertising','type','editedMessage','listMessage','disableBot','random','sendMessage','from','queueId','contacts','CHATBOT_RESTRICT_NUMBER','value','path','imageMessage','groups.update','error','title','getBodyButton','set','isAfter','map','pending','documentMessage','../../queues','queue','concat','findAll','extendedTextMessage',':unreads','getIO','1112XnVISz','toLowerCase','greetingMediaAttachment','DispatchCampaign','hydratedTemplate','sendGreetingMessageOneQueues','stickerMessage','Mensagem\x20de\x20grupo\x20bloqueada!','getContactsArrayMessage','SolicitaÃ§Ã£o\x20de\x20Pagamento','contact','DELIVERY_ACK','subject','Importando\x20mensagens!!','getImageMessage','\x20de\x20baixar\x20o\x20arquivo\x20','ASC','stream-throttle','../../models/Queue','sendMessageLink','handleMessage','fromMe','hydratedFourRowTemplate','jidNormalizedUser','document','key','contacts:','public','-ticket','__esModule','participant','verifyMessage','image/jpeg','isBetween','WebMessageInfo','search','buttonsResponseMessage','call','CheckMsgIsGroup','../../models/Setting','count','warn','quotedMessage','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','messageQueue','handleMessageIntegration','option','@sentry/node','HandleMessageJob','getViewOnceMessage','HH:mm','reload','viewOnceMessageV2','toString','promisify','base64','handleRating','parentId','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','fora\x20do\x20horario','getPaymentMessage','externalAdReply','toUpperCase','charAt','useIntegration','toDate','campaignQueue','configurable','isNull','Status','buttonsMessage','mimetype','weekdayEn','contactsArrayMessage','Tipo\x20de\x20integraÃ§Ã£o\x20nÃ£o\x20suportada.','length','captureException','chatbot\x20desativado!','default','time','resolve','Mensagem\x20interativa\x20nÃ£o\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','ERR_WAPP_DOWNLOAD_MEDIA','../../helpers/SendPresenceStatus','maxUseBotQueues','getButtonsMessage','debug','NÃ£o\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','ack','liveLocationMessage','getTypeMessage','product','changed','isNumeric','../../models/Message','Erro\x20ao\x20salvar\x20ticket!','../../libs/wbot','user','298971cqRcUi','Ticket\x20ID\x20ausente\x20na\x20mensagem.\x20ID:','ticketId','../TicketServices/UpdateTicketService','url','Erro\x20ao\x20salvar\x20mensagem!','proto','70wZVEkb','endTime','../TicketServices/FindOrCreateTicketService','indexOf','prototype','fourRowTemplate','writeFile','next','save','verifyRecentCampaign','WAMessageStubType','__importDefault','messageContextInfo','getWbot','44CcolVk','\x20-\x20Longitude:\x20','stringify','messages','isInteger','Erro\x20ao\x20salvar\x20avaliaÃ§Ã£o!','messages.update','unknown','\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial'];a550_0x2d55=function(){return _0x136371;};return a550_0x2d55();}exports[a550_0x4aba8b(0x1d5)]=handleMessage;const handleOutOfHour=async(_0x2735ff,_0x80ba3,_0x41100d,_0x1c034b,_0x211cea,_0x1c7d85)=>{const _0x5d081f=a550_0x4aba8b;try{if(outOfHourMessageControl[_0x5d081f(0x20c)]>0x1388)outOfHourMessageControl=[];let _0x3b6d01=outOfHourMessageControl['find'](_0x511a92=>_0x511a92[_0x5d081f(0x225)]===_0x80ba3['id']||_0x511a92[_0x5d081f(0x31e)]===_0x1c034b[_0x5d081f(0x2c5)]);if(_0x41100d[_0x5d081f(0x1ae)]===_0x5d081f(0x2ef)&&!(0x0,lodash_1[_0x5d081f(0x271)])(_0x211cea)&&_0x1c7d85['outOfHoursMessage']&&(!_0x211cea||_0x211cea['inActivity']===![])){if(!_0x3b6d01||_0x3b6d01&&_0x3b6d01['time']+0x3e8*0x3c*0x5<new Date()[_0x5d081f(0x265)]()){_0x3b6d01&&(outOfHourMessageControl=outOfHourMessageControl[_0x5d081f(0x2a4)](_0x9571f3=>_0x9571f3[_0x5d081f(0x225)]!==_0x80ba3['id']),_0x3b6d01=null);if(!_0x3b6d01)outOfHourMessageControl[_0x5d081f(0x25d)]({'ticketId':_0x80ba3['id'],'dest':_0x1c034b[_0x5d081f(0x2c5)],'time':new Date()[_0x5d081f(0x265)]()});const _0x260505='â\x20'+_0x1c7d85[_0x5d081f(0x300)],_0x1c3118=(0x0,Debounce_1['debounce'])(async()=>{const _0x439884=_0x5d081f;await _0x2735ff[_0x439884(0x1a9)](_0x80ba3[_0x439884(0x1cb)][_0x439884(0x2c5)]+'@'+(_0x80ba3[_0x439884(0x260)]?_0x439884(0x280):_0x439884(0x2cc)),{'text':_0x260505});},(0x0,queues_1[_0x5d081f(0x297)])(0x5dc,0xdac),_0x80ba3['id']);_0x1c3118();return;}}if(_0x41100d[_0x5d081f(0x1ae)]==='queue'&&_0x80ba3[_0x5d081f(0x1ab)]!==null){const _0x3ebe0a=await Queue_1[_0x5d081f(0x20f)][_0x5d081f(0x24d)](_0x80ba3[_0x5d081f(0x1ab)]),{schedules:_0x3eebfc}=_0x3ebe0a,_0x376fe6=(0x0,moment_1[_0x5d081f(0x20f)])(),_0x19886d=_0x376fe6[_0x5d081f(0x248)]('dddd')[_0x5d081f(0x1c2)]();let _0x784674=null;Array['isArray'](_0x3eebfc)&&_0x3eebfc[_0x5d081f(0x20c)]>0x0&&(_0x784674=_0x3eebfc['find'](_0x241aed=>_0x241aed[_0x5d081f(0x209)]===_0x19886d&&_0x241aed[_0x5d081f(0x2e6)]!==''&&_0x241aed[_0x5d081f(0x2e6)]!==null&&_0x241aed[_0x5d081f(0x22b)]!==''&&_0x241aed[_0x5d081f(0x22b)]!==null));if(_0x41100d[_0x5d081f(0x1ae)]===_0x5d081f(0x1bb)&&_0x3ebe0a['outOfHoursMessage']!==null&&_0x3ebe0a[_0x5d081f(0x300)]!==''&&!(0x0,lodash_1[_0x5d081f(0x271)])(_0x784674)){const _0x12b119=(0x0,moment_1[_0x5d081f(0x20f)])(_0x784674[_0x5d081f(0x2e6)],_0x5d081f(0x1f3)),_0x2ebfc3=(0x0,moment_1[_0x5d081f(0x20f)])(_0x784674[_0x5d081f(0x22b)],_0x5d081f(0x1f3));let _0xae6c4d=_0x376fe6[_0x5d081f(0x2f6)](_0x12b119)||_0x376fe6[_0x5d081f(0x1b6)](_0x2ebfc3);if(!_0xae6c4d){if(_0x784674[_0x5d081f(0x319)]&&_0x784674['endLunchTime']){const _0x13f617=(0x0,moment_1[_0x5d081f(0x20f)])(_0x784674[_0x5d081f(0x319)],_0x5d081f(0x1f3)),_0x3a7e41=(0x0,moment_1[_0x5d081f(0x20f)])(_0x784674[_0x5d081f(0x2b9)],_0x5d081f(0x1f3));_0xae6c4d=_0x376fe6[_0x5d081f(0x1e2)](_0x13f617,_0x3a7e41);}}if(_0xae6c4d){if(!_0x3b6d01||_0x3b6d01&&_0x3b6d01[_0x5d081f(0x210)]+0x3e8*0x3c*0x1e<new Date()[_0x5d081f(0x265)]()){const _0x273fa6=_0x3ebe0a[_0x5d081f(0x300)],_0x349017=(0x0,Debounce_1['debounce'])(async()=>{const _0x5d4c48=_0x5d081f;await _0x2735ff['sendMessage'](_0x80ba3[_0x5d4c48(0x1cb)][_0x5d4c48(0x2c5)]+'@'+(_0x80ba3[_0x5d4c48(0x260)]?'g.us':_0x5d4c48(0x2cc)),{'text':_0x273fa6});},(0x0,queues_1[_0x5d081f(0x297)])(0x3e8,0xbb8),_0x80ba3['id']);_0x349017();return;}if(!_0x3b6d01)outOfHourMessageControl[_0x5d081f(0x25d)]({'ticketId':_0x80ba3['id'],'dest':_0x1c034b['number'],'time':new Date()[_0x5d081f(0x265)]()});}}}}catch(_0x10e3e9){Sentry[_0x5d081f(0x20d)](_0x10e3e9),console[_0x5d081f(0x2b4)](_0x10e3e9);}},greetingMessage=async(_0x38779c,_0x5587a4,_0x14080d,_0x31930c,_0x10a111)=>{const _0x480d9a=a550_0x4aba8b;if(!_0x31930c?.[_0x480d9a(0x2f9)]?.['length']&&!_0x5587a4[_0x480d9a(0x2e7)]&&!_0x10a111&&!_0x14080d[_0x480d9a(0x1da)][_0x480d9a(0x1d6)]){if(process['env']['CHATBOT_RESTRICT_NUMBER']?.[_0x480d9a(0x20c)]>=0x8){if(_0x5587a4[_0x480d9a(0x1cb)]['number']!=process['env'][_0x480d9a(0x1ad)])return;}if(greetingMessageControl['length']>0x1388)greetingMessageControl=[];var _0x56a882=greetingMessageControl[_0x480d9a(0x282)](_0x20fee2=>_0x20fee2[_0x480d9a(0x225)]===_0x5587a4['id']||_0x20fee2[_0x480d9a(0x31e)]===_0x5587a4[_0x480d9a(0x1cb)][_0x480d9a(0x2c5)]);if(_0x56a882&&_0x56a882[_0x480d9a(0x210)]+0x3e8*0x3c*0x5>=new Date()[_0x480d9a(0x265)]())return;const _0x3321c7=await Message_1[_0x480d9a(0x20f)]['findOne']({'where':{'ticketId':_0x5587a4['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x480d9a(0x28b)]]:(0x0,moment_1[_0x480d9a(0x20f)])()[_0x480d9a(0x2aa)](0x5,'minutes')['toDate']()}}});if(_0x3321c7)return;const _0x589ec3=(0x0,Debounce_1['debounce'])(async()=>{const _0xd07c69=_0x480d9a;if(!_0x31930c[_0xd07c69(0x1c3)])await _0x38779c[_0xd07c69(0x1a9)](_0x5587a4[_0xd07c69(0x1cb)][_0xd07c69(0x2c5)]+'@'+(_0x5587a4[_0xd07c69(0x260)]?'g.us':_0xd07c69(0x2cc)),{'text':(0x0,Mustache_1[_0xd07c69(0x20f)])(_0x31930c['greetingMessage'],_0x5587a4)});else{const _0x580098=path_1[_0xd07c69(0x20f)]['resolve']('public',_0xd07c69(0x2ef)+_0x5587a4[_0xd07c69(0x2f4)],_0x31930c[_0xd07c69(0x1c3)]),_0xa8b929=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x31930c[_0xd07c69(0x1c3)],_0x580098,_0x31930c[_0xd07c69(0x2b2)],_0x5587a4['companyId']);await _0x38779c[_0xd07c69(0x1a9)](_0x5587a4['contact'][_0xd07c69(0x2c5)]+'@'+(_0x5587a4['isGroup']?_0xd07c69(0x280):_0xd07c69(0x2cc)),{..._0xa8b929});}},0x3e8,_0x5587a4['id']);_0x589ec3();return;}},handleMsgAck=async(_0x42069a,_0x30db7f)=>{const _0x388fe2=a550_0x4aba8b,_0x38c190=(0x0,socket_1[_0x388fe2(0x1c0)])();try{if(!_0x42069a?.[_0x388fe2(0x1da)]?.['id']||typeof _0x42069a[_0x388fe2(0x1da)]['id']!==_0x388fe2(0x25f)){logger_1[_0x388fe2(0x2cd)][_0x388fe2(0x1ea)](_0x388fe2(0x316),_0x42069a[_0x388fe2(0x1da)]?.['id']);return;}const _0x5bacc9=await Message_1[_0x388fe2(0x20f)][_0x388fe2(0x24d)](_0x42069a[_0x388fe2(0x1da)]['id'],{'include':[_0x388fe2(0x1cb),{'model':Message_1[_0x388fe2(0x20f)],'as':_0x388fe2(0x2c8),'include':[_0x388fe2(0x1cb)]}]});if(!_0x5bacc9){logger_1[_0x388fe2(0x2cd)][_0x388fe2(0x1ea)]('Mensagem\x20nÃ£o\x20encontrada\x20no\x20banco\x20de\x20dados.\x20ID:',_0x42069a['key']['id']);return;}if(!_0x5bacc9[_0x388fe2(0x225)]){logger_1[_0x388fe2(0x2cd)][_0x388fe2(0x1ea)](_0x388fe2(0x224),_0x42069a[_0x388fe2(0x1da)]['id']);return;}await _0x5bacc9[_0x388fe2(0x2a3)]({'ack':_0x30db7f},{'fields':[_0x388fe2(0x219)]}),_0x38c190['to'](_0x5bacc9[_0x388fe2(0x225)][_0x388fe2(0x1f6)]())[_0x388fe2(0x305)](_0x388fe2(0x2a7)+_0x5bacc9[_0x388fe2(0x2f4)]+'-appMessage',{'action':_0x388fe2(0x2a3),'message':_0x5bacc9}),logger_1[_0x388fe2(0x2cd)][_0x388fe2(0x217)]('Status\x20da\x20mensagem\x20atualizado.\x20ID:\x20'+_0x42069a['key']['id']+_0x388fe2(0x31c)+_0x30db7f);}catch(_0x5a9289){logger_1['logger'][_0x388fe2(0x1b2)](_0x388fe2(0x2fe)+_0x42069a?.[_0x388fe2(0x1da)]?.['id']+_0x388fe2(0x190)+_0x5a9289[_0x388fe2(0x19b)]),Sentry[_0x388fe2(0x20d)](_0x5a9289);}};exports[a550_0x4aba8b(0x26e)]=handleMsgAck;const verifyRecentCampaign=async(_0x3b4aa9,_0x45680a)=>{const _0xeac31e=a550_0x4aba8b;if(!_0x3b4aa9[_0xeac31e(0x1da)][_0xeac31e(0x1d6)]){const _0xb34918=_0x3b4aa9[_0xeac31e(0x1da)][_0xeac31e(0x2b0)]['replace'](/\D/g,''),_0x4be7da=await Campaign_1['default'][_0xeac31e(0x1bd)]({'where':{'companyId':_0x45680a,'status':_0xeac31e(0x278),'confirmation':!![]}});if(_0x4be7da){const _0x19d81c=_0x4be7da[_0xeac31e(0x1b7)](_0x55c36d=>_0x55c36d['id']),_0xbd626f=await CampaignShipping_1['default'][_0xeac31e(0x2c9)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x19d81c},'number':_0xb34918,'confirmation':null}});_0xbd626f&&(await _0xbd626f[_0xeac31e(0x2a3)]({'confirmedAt':(0x0,moment_1['default'])(),'confirmation':!![]}),await queues_1[_0xeac31e(0x203)][_0xeac31e(0x270)](_0xeac31e(0x1c4),{'campaignShippingId':_0xbd626f['id'],'campaignId':_0xbd626f['campaignId']},{'delay':(0x0,queues_1['parseToMilliseconds'])((0x0,queues_1[_0xeac31e(0x297)])(0x0,0xa))}));}}};exports[a550_0x4aba8b(0x233)]=verifyRecentCampaign;const verifyCampaignMessageAndCloseTicket=async(_0x23d8a6,_0x4121e2)=>{const _0x4c4aac=a550_0x4aba8b,_0x3d1e5a=(0x0,socket_1[_0x4c4aac(0x1c0)])(),_0x5d3afa=(0x0,exports[_0x4c4aac(0x26c)])(_0x23d8a6),_0x501f85=/\u200c/['test'](_0x5d3afa);if(_0x23d8a6[_0x4c4aac(0x1da)][_0x4c4aac(0x1d6)]&&_0x501f85){const _0x2172ef=await Message_1['default'][_0x4c4aac(0x2c9)]({'where':{'id':_0x23d8a6[_0x4c4aac(0x1da)]['id'],'companyId':_0x4121e2}}),_0x3baad9=await Ticket_1[_0x4c4aac(0x20f)][_0x4c4aac(0x24d)](_0x2172ef[_0x4c4aac(0x225)]);await _0x3baad9[_0x4c4aac(0x2a3)]({'status':_0x4c4aac(0x27e)}),_0x3d1e5a['to'](_0x4c4aac(0x2a7)+_0x3baad9[_0x4c4aac(0x2f4)]+_0x4c4aac(0x2a9))[_0x4c4aac(0x305)](_0x4c4aac(0x2a7)+_0x3baad9[_0x4c4aac(0x2f4)]+'-ticket',{'action':_0x4c4aac(0x245),'ticket':_0x3baad9,'ticketId':_0x3baad9['id']}),_0x3d1e5a['to']('company-'+_0x4121e2+'-'+_0x3baad9[_0x4c4aac(0x26b)])['to'](_0x3baad9['id'][_0x4c4aac(0x1f6)]())[_0x4c4aac(0x305)](_0x4c4aac(0x2a7)+_0x3baad9['companyId']+'-ticket',{'action':_0x4c4aac(0x2a3),'ticket':_0x3baad9,'ticketId':_0x3baad9['id']});}};exports['verifyCampaignMessageAndCloseTicket']=verifyCampaignMessageAndCloseTicket;const filterMessages=_0x58974c=>{const _0x493016=a550_0x4aba8b;if([baileys_1[_0x493016(0x234)]['REVOKE'],baileys_1[_0x493016(0x234)][_0x493016(0x2e1)],baileys_1['WAMessageStubType']['E2E_IDENTITY_CHANGED'],baileys_1[_0x493016(0x234)][_0x493016(0x2de)]]['includes'](_0x58974c[_0x493016(0x27b)]))return![];return!![];},wbotMessageListener=async(_0x381aa0,_0x2d7083,_0x510bf6)=>{const _0xcd98f3=a550_0x4aba8b;_0x381aa0['ev']['on'](_0xcd98f3(0x2c1),async _0x2629f2=>{const _0xb0b5b3=_0xcd98f3,_0x18204e=_0x2629f2[_0xb0b5b3(0x23b)][_0xb0b5b3(0x2a4)](filterMessages);if(!_0x18204e)return;await app_1[_0xb0b5b3(0x20f)][_0xb0b5b3(0x2a6)]('queues')[_0xb0b5b3(0x1ed)][_0xb0b5b3(0x270)](_0xb0b5b3(0x1f1),{'whatsappId':_0x510bf6['id'],'messages':_0x18204e,'companyId':_0x2d7083},{'removeOnComplete':!![],'attempts':0x3});}),_0x381aa0['ev']['on'](_0xcd98f3(0x23e),async _0x1e21dd=>{const _0x3e4c61=_0xcd98f3;if(_0x1e21dd[_0x3e4c61(0x20c)]===0x0)return;await app_1[_0x3e4c61(0x20f)][_0x3e4c61(0x2a6)](_0x3e4c61(0x2f9))[_0x3e4c61(0x1ed)][_0x3e4c61(0x270)](_0x3e4c61(0x2a0),{'whatsappId':_0x510bf6['id'],'messageUpdate':_0x1e21dd,'companyId':_0x2d7083},{'removeOnComplete':!![],'attempts':0x3,'delay':0x64});}),_0x381aa0['ev']['on'](_0xcd98f3(0x1b1),async _0x576c0b=>{const _0xe82911=_0xcd98f3;console[_0xe82911(0x2b4)](_0x576c0b);if(_0x576c0b[_0xe82911(0x20c)]===0x0)return;for(const _0x1324e3 of _0x576c0b){const _0x112769=_0x1324e3['id'][_0xe82911(0x307)]('@')[0x0],_0x525ef2=_0x1324e3['subject']||_0x112769,_0x433399={'name':_0x525ef2,'number':_0x112769,'isGroup':!![],'companyId':_0x2d7083,'remoteJid':_0x1324e3['id'],'whatsappId':_0x381aa0['id']};await(0x0,CreateOrUpdateContactService_1[_0xe82911(0x20f)])(_0x433399,_0x381aa0,_0x1324e3['id']);}});};exports[a550_0x4aba8b(0x284)]=wbotMessageListener;