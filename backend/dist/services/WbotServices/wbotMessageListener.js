'use strict';const a698_0x6c503d=a698_0x3ab7;(function(_0x56f443,_0x1cb29e){const _0x4db6fd=a698_0x3ab7,_0xe325de=_0x56f443();while(!![]){try{const _0x33ccca=parseInt(_0x4db6fd(0x132))/0x1+-parseInt(_0x4db6fd(0x128))/0x2+-parseInt(_0x4db6fd(0x1ca))/0x3+-parseInt(_0x4db6fd(0x134))/0x4+parseInt(_0x4db6fd(0x169))/0x5*(parseInt(_0x4db6fd(0x1d0))/0x6)+-parseInt(_0x4db6fd(0x189))/0x7*(-parseInt(_0x4db6fd(0x12d))/0x8)+parseInt(_0x4db6fd(0x190))/0x9;if(_0x33ccca===_0x1cb29e)break;else _0xe325de['push'](_0xe325de['shift']());}catch(_0x42e928){_0xe325de['push'](_0xe325de['shift']());}}}(a698_0x5cf3,0x7f4f1));var __createBinding=this&&this[a698_0x6c503d(0x14b)]||(Object[a698_0x6c503d(0x15c)]?function(_0xea58fc,_0x29fe08,_0x36479b,_0x15534d){const _0x5bda54=a698_0x6c503d;if(_0x15534d===undefined)_0x15534d=_0x36479b;var _0x14e778=Object[_0x5bda54(0x1d9)](_0x29fe08,_0x36479b);(!_0x14e778||(_0x5bda54(0x143)in _0x14e778?!_0x29fe08['__esModule']:_0x14e778[_0x5bda54(0x186)]||_0x14e778[_0x5bda54(0x114)]))&&(_0x14e778={'enumerable':!![],'get':function(){return _0x29fe08[_0x36479b];}}),Object[_0x5bda54(0x10f)](_0xea58fc,_0x15534d,_0x14e778);}:function(_0x29a4d1,_0x2da8b1,_0x286a21,_0x27186a){if(_0x27186a===undefined)_0x27186a=_0x286a21;_0x29a4d1[_0x27186a]=_0x2da8b1[_0x286a21];}),__setModuleDefault=this&&this[a698_0x6c503d(0x11d)]||(Object[a698_0x6c503d(0x15c)]?function(_0x954ec6,_0xdf3a8b){const _0x1e90c8=a698_0x6c503d;Object['defineProperty'](_0x954ec6,_0x1e90c8(0x109),{'enumerable':!![],'value':_0xdf3a8b});}:function(_0x47f565,_0x4924a3){const _0x5530ba=a698_0x6c503d;_0x47f565[_0x5530ba(0x109)]=_0x4924a3;}),__importStar=this&&this[a698_0x6c503d(0x1ea)]||(function(){const _0x312517=(function(){let _0x2d6937=!![];return function(_0x44e91c,_0x3d4f81){const _0x5503be=_0x2d6937?function(){const _0x37a243=a698_0x3ab7;if(_0x3d4f81){const _0x4d2035=_0x3d4f81[_0x37a243(0x193)](_0x44e91c,arguments);return _0x3d4f81=null,_0x4d2035;}}:function(){};return _0x2d6937=![],_0x5503be;};}()),_0x101c4=_0x312517(this,function(){const _0x2b5a2e=a698_0x3ab7;return _0x101c4[_0x2b5a2e(0x151)]()['search']('(((.+)+)+)+$')[_0x2b5a2e(0x151)]()[_0x2b5a2e(0x14a)](_0x101c4)[_0x2b5a2e(0x1b8)]('(((.+)+)+)+$');});_0x101c4();var _0x10fa44=function(_0x232281){const _0x46becf=a698_0x3ab7;return _0x10fa44=Object[_0x46becf(0x1c4)]||function(_0x5edbe7){const _0x43a439=_0x46becf;var _0x56787b=[];for(var _0xbbb6e4 in _0x5edbe7)if(Object[_0x43a439(0x1e2)][_0x43a439(0x171)][_0x43a439(0x1a1)](_0x5edbe7,_0xbbb6e4))_0x56787b[_0x56787b[_0x43a439(0x1d3)]]=_0xbbb6e4;return _0x56787b;},_0x10fa44(_0x232281);};return function(_0x47ad9d){const _0x3c463c=a698_0x3ab7;if(_0x47ad9d&&_0x47ad9d[_0x3c463c(0x199)])return _0x47ad9d;var _0x32ce2e={};if(_0x47ad9d!=null){for(var _0x2e8ba5=_0x10fa44(_0x47ad9d),_0x5e11c3=0x0;_0x5e11c3<_0x2e8ba5[_0x3c463c(0x1d3)];_0x5e11c3++)if(_0x2e8ba5[_0x5e11c3]!==_0x3c463c(0x109))__createBinding(_0x32ce2e,_0x47ad9d,_0x2e8ba5[_0x5e11c3]);}return __setModuleDefault(_0x32ce2e,_0x47ad9d),_0x32ce2e;};}()),__importDefault=this&&this[a698_0x6c503d(0x176)]||function(_0xffe1e7){const _0x24c0fc=a698_0x6c503d;return _0xffe1e7&&_0xffe1e7[_0x24c0fc(0x199)]?_0xffe1e7:{'default':_0xffe1e7};};Object[a698_0x6c503d(0x10f)](exports,a698_0x6c503d(0x199),{'value':!![]}),exports[a698_0x6c503d(0x137)]=exports[a698_0x6c503d(0x13b)]=exports[a698_0x6c503d(0x18f)]=exports[a698_0x6c503d(0x14c)]=exports[a698_0x6c503d(0x147)]=void 0x0,exports['makeid']=makeid;function a698_0x3ab7(_0x4eaa20,_0x3b94ea){const _0x5e702d=a698_0x5cf3();return a698_0x3ab7=function(_0x3c9b02,_0x80a3e){_0x3c9b02=_0x3c9b02-0x107;let _0x5cf328=_0x5e702d[_0x3c9b02];return _0x5cf328;},a698_0x3ab7(_0x4eaa20,_0x3b94ea);}const Sentry=__importStar(require(a698_0x6c503d(0x15e))),lodash_1=require(a698_0x6c503d(0x135)),baileys_1=require(a698_0x6c503d(0x12a)),async_mutex_1=require('async-mutex'),sequelize_1=require('sequelize'),moment_1=__importDefault(require(a698_0x6c503d(0x157))),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require('../../models/Ticket')),Message_1=__importDefault(require('../../models/Message')),socket_1=require(a698_0x6c503d(0x18e)),logger_1=require(a698_0x6c503d(0x1c3)),FindOrCreateTicketService_1=__importDefault(require(a698_0x6c503d(0x1f1))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),UpdateTicketService_1=__importDefault(require(a698_0x6c503d(0x15b))),Mustache_1=__importDefault(require(a698_0x6c503d(0x19b))),TicketTraking_1=__importDefault(require(a698_0x6c503d(0x12b))),UserRating_1=__importDefault(require(a698_0x6c503d(0x1aa))),SendWhatsAppMessage_1=__importDefault(require(a698_0x6c503d(0x1a9))),Queue_1=__importDefault(require(a698_0x6c503d(0x166))),FlowBuilder_1=__importDefault(require(a698_0x6c503d(0x1d6))),ActionsWebhookService_1=require(a698_0x6c503d(0x131)),VerifyCurrentSchedule_1=__importDefault(require(a698_0x6c503d(0x13d))),User_1=__importDefault(require(a698_0x6c503d(0x16f))),Setting_1=__importDefault(require(a698_0x6c503d(0x172))),cache_1=require(a698_0x6c503d(0x162)),Debounce_1=require(a698_0x6c503d(0x17f)),CheckSettings_1=require(a698_0x6c503d(0x184)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),simpleObjectCache_1=require('../../helpers/simpleObjectCache'),ShowQueueIntegrationService_1=__importDefault(require('../QueueIntegrationServices/ShowQueueIntegrationService')),typebotListener_1=__importDefault(require(a698_0x6c503d(0x182))),VerifyHandlers_1=require(a698_0x6c503d(0x119)),GetHandlers_1=require(a698_0x6c503d(0x198)),wbotMutex=new async_mutex_1[(a698_0x6c503d(0x139))](),ackMutex=new async_mutex_1[(a698_0x6c503d(0x139))](),groupContactCache=new simpleObjectCache_1['SimpleObjectCache'](0x3e8*0x1e,logger_1['logger']),outOfHoursCache=new simpleObjectCache_1[(a698_0x6c503d(0x174))](0x3e8*0x3c*0x5,logger_1[a698_0x6c503d(0x16a)]);function makeid(_0x3840f9){const _0x2ef349=a698_0x6c503d;let _0x5d3e92='';const _0xa95351=_0x2ef349(0x1ad),_0xb521ed=_0xa95351[_0x2ef349(0x1d3)];for(let _0x43c63c=0x0;_0x43c63c<_0x3840f9;_0x43c63c+=0x1){_0x5d3e92+=_0xa95351[_0x2ef349(0x1b4)](Math[_0x2ef349(0x1ce)](Math[_0x2ef349(0x183)]()*_0xb521ed));}return _0x5d3e92;}const isValidMsg=_0x586f25=>{const _0x2e96be=a698_0x6c503d;if(_0x586f25[_0x2e96be(0x136)][_0x2e96be(0x19f)]===_0x2e96be(0x141))return![];try{const _0x3d96f4=(0x0,GetHandlers_1['getTypeMessage'])(_0x586f25);if(!_0x3d96f4)return![];const _0x439dd0=_0x3d96f4===_0x2e96be(0x180)||_0x3d96f4===_0x2e96be(0x124)||_0x3d96f4==='extendedTextMessage'||_0x3d96f4==='audioMessage'||_0x3d96f4===_0x2e96be(0x1f9)||_0x3d96f4===_0x2e96be(0x14d)||_0x3d96f4==='documentMessage'||_0x3d96f4==='documentWithCaptionMessage'||_0x3d96f4==='stickerMessage'||_0x3d96f4===_0x2e96be(0x17d)||_0x3d96f4===_0x2e96be(0x1e1)||_0x3d96f4===_0x2e96be(0x113)||_0x3d96f4===_0x2e96be(0x158)||_0x3d96f4===_0x2e96be(0x156)||_0x3d96f4===_0x2e96be(0x13e)||_0x3d96f4===_0x2e96be(0x126)||_0x3d96f4===_0x2e96be(0x11e)||_0x3d96f4===_0x2e96be(0x140)||_0x3d96f4===_0x2e96be(0x1f6)||_0x3d96f4===_0x2e96be(0x133)||_0x3d96f4===_0x2e96be(0x12c)||_0x3d96f4===_0x2e96be(0x153)||_0x3d96f4===_0x2e96be(0x13a)||_0x3d96f4==='templateMessage'||_0x3d96f4===_0x2e96be(0x1d5)||_0x3d96f4===_0x2e96be(0x168);return!_0x439dd0&&(logger_1[_0x2e96be(0x16a)][_0x2e96be(0x177)](_0x2e96be(0x1dd)+_0x3d96f4+'\x0a'+JSON[_0x2e96be(0x1a8)](_0x586f25?.['message'])),Sentry[_0x2e96be(0x1f2)]('Mensagem',{'BodyMsg':_0x586f25[_0x2e96be(0x164)],'msg':_0x586f25,'msgType':_0x3d96f4}),Sentry[_0x2e96be(0x1c8)](new Error(_0x2e96be(0x1ec)))),!!_0x439dd0;}catch(_0x332583){return Sentry[_0x2e96be(0x1f2)](_0x2e96be(0x1b2),{'msg':_0x586f25}),Sentry['captureException'](_0x332583),![];}},handleRating=async(_0x122ea5,_0x52581f,_0x3cd9ae)=>{const _0x41889a=a698_0x6c503d,_0x1958a2=(0x0,socket_1[_0x41889a(0x111)])();let _0x4f5a42=null;(_0x122ea5?.[_0x41889a(0x164)]?.[_0x41889a(0x180)]||_0x122ea5?.[_0x41889a(0x164)]?.[_0x41889a(0x1db)])&&(_0x4f5a42=parseInt(_0x122ea5[_0x41889a(0x164)][_0x41889a(0x180)]||_0x122ea5[_0x41889a(0x164)][_0x41889a(0x1db)]['text'],0xa)||null);if(!Number[_0x41889a(0x149)](_0x4f5a42)&&Number[_0x41889a(0x191)](_0x4f5a42)&&!(0x0,lodash_1[_0x41889a(0x16e)])(_0x4f5a42)){const _0x50e29b=await(0x0,ShowWhatsAppService_1[_0x41889a(0x109)])(_0x52581f['whatsappId'],_0x52581f['companyId']);let _0xc0e471=_0x4f5a42;_0x4f5a42<0x1&&(_0xc0e471=0x1);_0x4f5a42>0x5&&(_0xc0e471=0x5);await UserRating_1[_0x41889a(0x109)]['create']({'ticketId':_0x3cd9ae[_0x41889a(0x14f)],'companyId':_0x3cd9ae['companyId'],'userId':_0x3cd9ae['userId'],'rate':_0xc0e471});const _0x591052=_0x50e29b['complationMessage'][_0x41889a(0x15d)]()||_0x41889a(0x1ab);await(0x0,SendWhatsAppMessage_1[_0x41889a(0x109)])({'ticket':_0x52581f,'body':_0x591052}),await _0x3cd9ae[_0x41889a(0x1d2)]({'finishedAt':(0x0,moment_1[_0x41889a(0x109)])()[_0x41889a(0x1df)](),'rated':!![]});const _0x139816=await(0x0,CheckSettings_1[_0x41889a(0x160)])(_0x52581f[_0x41889a(0x1e9)],_0x41889a(0x1b0),_0x41889a(0x129))===_0x41889a(0x129);await _0x52581f['update']({'queueId':_0x139816?_0x52581f[_0x41889a(0x13c)]:null,'chatbot':null,'userId':_0x139816?_0x52581f['userId']:null,'status':'closed'}),_0x1958a2['to'](_0x41889a(0x19a)+_0x52581f[_0x41889a(0x1e9)]+_0x41889a(0x10e))['to'](_0x41889a(0x138)+_0x52581f[_0x41889a(0x13c)]+_0x41889a(0x10e))[_0x41889a(0x146)]('company-'+_0x52581f[_0x41889a(0x1e9)]+_0x41889a(0x1fd),{'action':_0x41889a(0x195),'ticket':_0x52581f,'ticketId':_0x52581f['id']}),_0x1958a2['to']('company-'+_0x52581f[_0x41889a(0x1e9)]+'-'+_0x52581f['status'])['to'](_0x41889a(0x138)+_0x52581f[_0x41889a(0x13c)]+'-'+_0x52581f['status'])['to'](_0x52581f['id'][_0x41889a(0x151)]())[_0x41889a(0x146)](_0x41889a(0x19a)+_0x52581f['companyId']+_0x41889a(0x1fd),{'action':_0x41889a(0x1d2),'ticket':_0x52581f,'ticketId':_0x52581f['id']});}};exports[a698_0x6c503d(0x147)]=handleRating;const handleFlowBuilderExecution=async(_0x325b5c,_0x11e7f7,_0x53552d='')=>{const _0x5e6c60=a698_0x6c503d;console[_0x5e6c60(0x1de)]('Iniciando\x20execução\x20do\x20FlowBuilder\x20para\x20ticket\x20'+_0x325b5c['id']+_0x5e6c60(0x1e3)+_0x325b5c['flowBuilderId']);const _0x5a7bf2=await FlowBuilder_1[_0x5e6c60(0x109)][_0x5e6c60(0x1cb)](_0x325b5c[_0x5e6c60(0x15a)]);if(!_0x5a7bf2||!_0x5a7bf2[_0x5e6c60(0x107)]){console[_0x5e6c60(0x1fb)](_0x5e6c60(0x110)+_0x325b5c[_0x5e6c60(0x15a)]+_0x5e6c60(0x18a));return;}const _0x2c5d53=await Whatsapp_1['default'][_0x5e6c60(0x1cb)](_0x325b5c[_0x5e6c60(0x1b6)]),_0x4b3933=await Contact_1[_0x5e6c60(0x109)][_0x5e6c60(0x1cb)](_0x325b5c[_0x5e6c60(0x1ef)]);if(!_0x2c5d53||!_0x4b3933){console['error'](_0x5e6c60(0x16d));return;}const _0x3d7348={'number':_0x4b3933[_0x5e6c60(0x1eb)],'name':_0x4b3933[_0x5e6c60(0x18b)],'email':_0x4b3933['email']},_0x16c5ef=_0x5a7bf2[_0x5e6c60(0x107)][_0x5e6c60(0x1e4)],_0x2bc4d6=_0x5a7bf2[_0x5e6c60(0x107)][_0x5e6c60(0x1f3)]||_0x5a7bf2[_0x5e6c60(0x107)][_0x5e6c60(0x122)],_0x213b10=_0x16c5ef[_0x5e6c60(0x125)](_0x3d3a36=>_0x3d3a36[_0x5e6c60(0x181)]==='start'),_0x495e1f=_0x213b10?_0x213b10['id']:_0x16c5ef[0x0]?.['id']||'1';await _0x325b5c[_0x5e6c60(0x1d2)]({'flowWebhook':!![],'flowStopped':String(_0x325b5c['flowBuilderId'])}),await(0x0,ActionsWebhookService_1[_0x5e6c60(0x159)])(_0x2c5d53['id'],parseInt(String(_0x325b5c[_0x5e6c60(0x15a)])),_0x325b5c[_0x5e6c60(0x1e9)],_0x16c5ef,_0x2bc4d6,_0x495e1f,null,'','',_0x53552d,_0x325b5c['id'],_0x3d7348,null);};exports[a698_0x6c503d(0x14c)]=handleFlowBuilderExecution;const handleFlowBuilder=async(_0x4fb54f,_0x30e9f8,_0x525b8c)=>{const _0x617a4e=a698_0x6c503d,_0x1ce468=_0x30e9f8[_0x617a4e(0x136)]['id'];if(_0x4fb54f[_0x617a4e(0x1b1)]===_0x1ce468){console[_0x617a4e(0x1de)](_0x617a4e(0x15f)+_0x1ce468+_0x617a4e(0x1c0)+_0x4fb54f['id']+_0x617a4e(0x1a0));return;}await _0x4fb54f[_0x617a4e(0x1d2)]({'lastProcessedMessageId':_0x1ce468});const _0x3434d0=(0x0,GetHandlers_1[_0x617a4e(0x1a6)])(_0x30e9f8);console['log'](_0x617a4e(0x197)+_0x3434d0+_0x617a4e(0x1e6)+_0x4fb54f['id']),await(0x0,exports['handleFlowBuilderExecution'])(_0x4fb54f,_0x525b8c,_0x3434d0);},handleMessageIntegration=async(_0x14b90d,_0x48e3d2,_0xda1d2c,_0x3eb0a2)=>{const _0x5b966a=a698_0x6c503d;if(process['env']['CHATBOT_RESTRICT_NUMBER']){if(_0x3eb0a2['contact']['number']!=process[_0x5b966a(0x11a)][_0x5b966a(0x1e0)]){console[_0x5b966a(0x1de)](_0x5b966a(0x192));return;}}console[_0x5b966a(0x1de)](_0x5b966a(0x1be),_0x3eb0a2[_0x5b966a(0x1b3)]),_0xda1d2c[_0x5b966a(0x181)]===_0x5b966a(0x1ee)&&!_0x3eb0a2[_0x5b966a(0x1b3)]?(await(0x0,typebotListener_1[_0x5b966a(0x109)])({'ticket':_0x3eb0a2,'msg':_0x14b90d,'wbot':_0x48e3d2,'typebot':_0xda1d2c}),!_0x3eb0a2['useIntegration']&&(await _0x3eb0a2['update']({'useIntegration':!![],'integrationId':_0xda1d2c['id']}),console[_0x5b966a(0x1de)](_0x5b966a(0x170)+_0x3eb0a2['id']))):console[_0x5b966a(0x1de)]('Tipo\x20de\x20integração\x20não\x20suportada.');};exports[a698_0x6c503d(0x18f)]=handleMessageIntegration;const handleMessage=async(_0x4dc3f7,_0x525fd6,_0x40c5b7)=>{const _0x5817b2=a698_0x6c503d;if(!isValidMsg(_0x4dc3f7))return;_0x4dc3f7[_0x5817b2(0x164)]?.[_0x5817b2(0x133)]&&(_0x4dc3f7[_0x5817b2(0x164)]=_0x4dc3f7[_0x5817b2(0x164)]['ephemeralMessage'][_0x5817b2(0x164)]);try{let _0x4d4b72,_0x5326fa;const _0x54e8ac=_0x4dc3f7[_0x5817b2(0x136)][_0x5817b2(0x19f)]?.['endsWith'](_0x5817b2(0x19e)),_0x7833ff=_0x4dc3f7[_0x5817b2(0x136)][_0x5817b2(0x19f)]?.[_0x5817b2(0x1f4)]('@newsletter'),_0x12d2e3=_0x4dc3f7['key'][_0x5817b2(0x19f)]==='status@broadcast';if(_0x12d2e3){logger_1[_0x5817b2(0x16a)][_0x5817b2(0x1a5)](_0x5817b2(0x185)+_0x4dc3f7[_0x5817b2(0x136)][_0x5817b2(0x17b)]);return;}if(_0x7833ff){logger_1[_0x5817b2(0x16a)]['info'](_0x5817b2(0x179)+_0x4dc3f7[_0x5817b2(0x136)][_0x5817b2(0x19f)]);return;}if(_0x54e8ac){const _0x1a5c54=await Setting_1['default'][_0x5817b2(0x142)]({'where':{'companyId':_0x40c5b7,'key':'CheckMsgIsGroup'}});if(!_0x1a5c54||_0x1a5c54['value']===_0x5817b2(0x129))return;}const _0x308279=(0x0,GetHandlers_1[_0x5817b2(0x1a6)])(_0x4dc3f7),_0x13a64e=(0x0,GetHandlers_1[_0x5817b2(0x145)])(_0x4dc3f7),_0x45b891=_0x13a64e!==_0x5817b2(0x1bd)&&(0x0,GetHandlers_1[_0x5817b2(0x12f)])(_0x4dc3f7),_0x41d7c3=_0x45b891&&(0x0,GetHandlers_1[_0x5817b2(0x1f8)])(_0x45b891);if(_0x4dc3f7[_0x5817b2(0x136)]['fromMe']){if(_0x308279?.[_0x5817b2(0x11f)]('‎'))return;if(!_0x41d7c3&&_0x13a64e!==_0x5817b2(0x180)&&_0x13a64e!==_0x5817b2(0x1db)&&_0x13a64e!==_0x5817b2(0x1da))return;_0x4d4b72=await(0x0,GetHandlers_1[_0x5817b2(0x10a)])(_0x4dc3f7,_0x525fd6);}else _0x4d4b72=await(0x0,GetHandlers_1[_0x5817b2(0x10a)])(_0x4dc3f7,_0x525fd6);_0x54e8ac&&(_0x5326fa=await wbotMutex[_0x5817b2(0x17c)](async()=>{const _0x51ebd2=_0x5817b2;let _0x14a829=groupContactCache[_0x51ebd2(0x143)](_0x4dc3f7[_0x51ebd2(0x136)][_0x51ebd2(0x19f)]);if(!_0x14a829){const _0x50bb11=await _0x525fd6['groupMetadata'](_0x4dc3f7[_0x51ebd2(0x136)]['remoteJid']),_0x1a2276={'id':_0x50bb11['id'],'name':_0x50bb11[_0x51ebd2(0x1bf)]};_0x14a829=await(0x0,VerifyHandlers_1[_0x51ebd2(0x194)])(_0x1a2276,_0x525fd6,_0x40c5b7),groupContactCache['set'](_0x4dc3f7[_0x51ebd2(0x136)][_0x51ebd2(0x19f)],_0x14a829);}return _0x14a829;}));const _0x43f9a3=await(0x0,ShowWhatsAppService_1[_0x5817b2(0x109)])(_0x525fd6['id'],_0x40c5b7),_0x4d5bb7=_0x4dc3f7[_0x5817b2(0x136)],_0x3bf901=_0x4d5bb7[_0x5817b2(0x1ac)]||_0x4d5bb7[_0x5817b2(0x16c)],_0x20731c=await(0x0,VerifyHandlers_1[_0x5817b2(0x194)])(_0x4d4b72,_0x525fd6,_0x40c5b7,_0x3bf901);let _0x5199c4=_0x20731c;if(!_0x4dc3f7[_0x5817b2(0x136)][_0x5817b2(0x117)]){const _0x2cda83=_0x4dc3f7[_0x5817b2(0x136)],_0x4a2d92=_0x4dc3f7[_0x5817b2(0x136)]['remoteJid'],_0x51055e=_0x2cda83[_0x5817b2(0x16c)];let _0x468d92=null,_0x593c87=![];if(_0x4a2d92?.[_0x5817b2(0x10b)](_0x5817b2(0x148)))_0x468d92=_0x4a2d92,_0x593c87=_0x20731c[_0x5817b2(0x1eb)][_0x5817b2(0x1d3)]>0xd;else _0x4a2d92?.[_0x5817b2(0x10b)]('@lid')&&_0x51055e?.[_0x5817b2(0x10b)](_0x5817b2(0x148))&&(_0x468d92=_0x51055e,_0x593c87=!![]);if(_0x468d92&&_0x593c87){const _0x15fee9=_0x468d92[_0x5817b2(0x1bc)]('@')[0x0],_0x398afc=await Contact_1[_0x5817b2(0x109)][_0x5817b2(0x142)]({'where':{'number':_0x15fee9,'companyId':_0x20731c[_0x5817b2(0x1e9)]}});if(_0x398afc&&_0x398afc['id']!==_0x20731c['id']){_0x5199c4=_0x398afc;const _0x28eab9=_0x4a2d92?.[_0x5817b2(0x10b)](_0x5817b2(0x161))?_0x4a2d92:_0x51055e,_0x49aa77=_0x28eab9?.[_0x5817b2(0x1bc)]('@')[0x0],_0x280acb={};_0x49aa77&&!_0x398afc[_0x5817b2(0x1a2)]&&(_0x280acb[_0x5817b2(0x1a2)]=_0x49aa77);_0x468d92&&!_0x398afc[_0x5817b2(0x19f)]&&(_0x280acb[_0x5817b2(0x19f)]=_0x468d92);const _0x1e7f4e=!_0x398afc[_0x5817b2(0x1bb)]||_0x398afc[_0x5817b2(0x1bb)]===''||_0x398afc['profilePicUrl']===process[_0x5817b2(0x11a)]['FRONTEND_URL']+'/nopicture.png';_0x1e7f4e&&_0x20731c[_0x5817b2(0x1bb)]&&_0x20731c[_0x5817b2(0x1bb)]!==process[_0x5817b2(0x11a)]['FRONTEND_URL']+_0x5817b2(0x1d4)&&(_0x280acb['profilePicUrl']=_0x20731c['profilePicUrl']);Object[_0x5817b2(0x1d7)](_0x280acb)['length']>0x0&&await _0x398afc['update'](_0x280acb);const _0x1e921f=await Ticket_1[_0x5817b2(0x109)][_0x5817b2(0x196)]({'where':{'contactId':_0x20731c['id']}});_0x1e921f===0x0&&await _0x20731c[_0x5817b2(0x1fe)]();}else!_0x398afc&&(await _0x20731c[_0x5817b2(0x1d2)]({'number':_0x15fee9,'remoteJid':_0x468d92}),_0x5199c4=_0x20731c);}}let _0x2da27d=0x0;if(_0x4dc3f7[_0x5817b2(0x136)][_0x5817b2(0x117)])await cache_1[_0x5817b2(0x130)]['set'](_0x5817b2(0x1b5)+_0x5199c4['id']+':unreads','0');else{const _0x27a001=await cache_1[_0x5817b2(0x130)]['get'](_0x5817b2(0x1b5)+_0x5199c4['id']+_0x5817b2(0x1f5));_0x2da27d=+_0x27a001+0x1,await cache_1[_0x5817b2(0x130)][_0x5817b2(0x1c9)]('contacts:'+_0x5199c4['id']+':unreads',''+_0x2da27d);}const _0xa8faa3=await Message_1[_0x5817b2(0x109)]['findOne']({'where':{'contactId':_0x5199c4['id'],'companyId':_0x40c5b7,'$ticket.whatsappId$':_0x43f9a3['id']},'include':[_0x5817b2(0x1af)],'order':[[_0x5817b2(0x155),_0x5817b2(0x1a4)]]}),_0x5ba6eb=_0x43f9a3['complationMessage'][_0x5817b2(0x15d)]()||_0x5817b2(0x1ab);if(_0xa8faa3&&_0x2da27d===0x0&&_0x5ba6eb&&(0x0,Mustache_1[_0x5817b2(0x109)])(_0x5ba6eb,_0xa8faa3['ticket'])[_0x5817b2(0x15d)]()[_0x5817b2(0x1fc)]()===_0xa8faa3?.[_0x5817b2(0x12e)][_0x5817b2(0x15d)]()[_0x5817b2(0x1fc)]())return;if(!_0x4dc3f7[_0x5817b2(0x136)][_0x5817b2(0x117)]&&!_0x5199c4[_0x5817b2(0x1c1)]){if(_0x43f9a3[_0x5817b2(0x165)]){const _0x235ad9=await TicketTraking_1['default'][_0x5817b2(0x142)]({'where':{'whatsappId':_0x43f9a3['id'],'rated':![],'ratingAt':{[sequelize_1['Op']['not']]:null},'finishedAt':null},'include':[{'model':Ticket_1[_0x5817b2(0x109)],'where':{'status':_0x5817b2(0x18d),'contactId':_0x5199c4['id']},'include':[{'model':Contact_1[_0x5817b2(0x109)]},{'model':User_1[_0x5817b2(0x109)]},{'model':Queue_1[_0x5817b2(0x109)]}]}]});if(_0x235ad9)try{const _0x22d335=Number(_0x308279);if(!Number[_0x5817b2(0x1e8)](_0x22d335)){const _0x4b0f5f=(0x0,Debounce_1[_0x5817b2(0x118)])(async()=>{const _0x348065=_0x5817b2,_0x239fa2=_0x43f9a3[_0x348065(0x1f0)]?.[_0x348065(0x15d)]()||_0x348065(0x1b7);await(0x0,SendWhatsAppMessage_1[_0x348065(0x109)])({'ticket':_0x49d603,'body':'\x0a*'+_0x239fa2+'*'});},0x3e8,_0x235ad9[_0x5817b2(0x1af)]['id']);_0x4b0f5f();return;}if((0x0,VerifyHandlers_1['verifyRating'])(_0x235ad9)){(0x0,exports[_0x5817b2(0x147)])(_0x4dc3f7,_0x235ad9[_0x5817b2(0x1af)],_0x235ad9);return;}}catch(_0x1e7705){Sentry[_0x5817b2(0x1c8)](_0x1e7705),console['log'](_0x5817b2(0x10d),_0x1e7705);}}}const {ticket:_0x49d603,justCreated:_0x32365e,inVacation:_0xec6249}=await(0x0,FindOrCreateTicketService_1[_0x5817b2(0x109)])(_0x5199c4,_0x525fd6['id'],_0x2da27d,_0x40c5b7,_0x5326fa);if(_0xec6249&&_0x32365e&&!_0x54e8ac){const _0x1fba81=await(0x0,ShowWhatsAppService_1[_0x5817b2(0x109)])(_0x525fd6['id'],_0x40c5b7);if(_0x1fba81['collectiveVacationMessage']){console[_0x5817b2(0x1de)](_0x5817b2(0x154)+_0x49d603['id']+_0x5817b2(0x17e));if(_0x41d7c3||_0x4dc3f7?.[_0x5817b2(0x164)]?.[_0x5817b2(0x1db)]?.['thumbnailDirectPath'])await(0x0,VerifyHandlers_1[_0x5817b2(0x1c2)])(_0x4dc3f7,_0x49d603,_0x5199c4,_0x525fd6,_0x41d7c3);else!_0x4dc3f7[_0x5817b2(0x164)]?.[_0x5817b2(0x12c)]&&await(0x0,VerifyHandlers_1[_0x5817b2(0x10c)])(_0x4dc3f7,_0x49d603,_0x5199c4,null,_0x525fd6);await(0x0,SendWhatsAppMessage_1[_0x5817b2(0x109)])({'body':_0x1fba81[_0x5817b2(0x123)],'ticket':_0x49d603,'quotedMsg':null}),console['log'](_0x5817b2(0x1d8)+_0x49d603['id']+'\x20-\x20Mensagem\x20enviada,\x20ticket\x20fica\x20pendente\x20para\x20atendimento\x20posterior');return;}}if(_0x41d7c3||_0x4dc3f7?.[_0x5817b2(0x164)]?.[_0x5817b2(0x1db)]?.['thumbnailDirectPath'])await(0x0,VerifyHandlers_1[_0x5817b2(0x1c2)])(_0x4dc3f7,_0x49d603,_0x5199c4,_0x525fd6,_0x41d7c3);else{if(_0x4dc3f7[_0x5817b2(0x164)]?.[_0x5817b2(0x124)]?.['message']?.[_0x5817b2(0x12c)]?.[_0x5817b2(0x124)])await(0x0,VerifyHandlers_1[_0x5817b2(0x120)])(_0x4dc3f7['message']['editedMessage']['message'][_0x5817b2(0x12c)][_0x5817b2(0x124)],_0x49d603,_0x4dc3f7[_0x5817b2(0x164)][_0x5817b2(0x124)]['message'][_0x5817b2(0x12c)][_0x5817b2(0x136)]['id']);else{if(_0x4dc3f7[_0x5817b2(0x164)]?.['protocolMessage']?.['editedMessage'])await(0x0,VerifyHandlers_1[_0x5817b2(0x120)])(_0x4dc3f7[_0x5817b2(0x164)][_0x5817b2(0x12c)][_0x5817b2(0x124)],_0x49d603,_0x4dc3f7['message'][_0x5817b2(0x12c)][_0x5817b2(0x136)]['id']);else _0x4dc3f7[_0x5817b2(0x164)]?.[_0x5817b2(0x12c)]?.[_0x5817b2(0x181)]===0x0?await(0x0,VerifyHandlers_1['verifyDeleteMessage'])(_0x4dc3f7[_0x5817b2(0x164)][_0x5817b2(0x12c)],_0x49d603):await(0x0,VerifyHandlers_1[_0x5817b2(0x10c)])(_0x4dc3f7,_0x49d603,_0x5199c4,null,_0x525fd6);}}if(_0x49d603[_0x5817b2(0x112)]===!![]&&_0x49d603[_0x5817b2(0x1e5)]){const _0x56b5fa=await(0x0,ShowQueueIntegrationService_1['default'])(_0x49d603[_0x5817b2(0x1e5)],_0x40c5b7);if(_0x56b5fa){await(0x0,exports[_0x5817b2(0x18f)])(_0x4dc3f7,_0x525fd6,_0x56b5fa,_0x49d603);return;}else await _0x49d603['update']({'useIntegration':![],'integrationId':null,'typebotSessionId':null});}if(_0x308279==='#'&&!_0x54e8ac){await _0x49d603['update']({'chatbot':![],'queueId':null,'flowBuilderId':null,'flowWebhook':![],'lastFlowId':null,'flowStopped':null,'hashFlowId':null,'dataWebhook':null}),await(0x0,VerifyHandlers_1[_0x5817b2(0x16b)])(_0x525fd6,_0x4dc3f7,_0x49d603,_0x49d603['contact']);return;}const _0x43bece=await(0x0,CheckSettings_1['GetCompanySetting'])(_0x40c5b7,_0x5817b2(0x1c6),_0x5817b2(0x17a));try{if(!_0x4dc3f7[_0x5817b2(0x136)][_0x5817b2(0x117)]&&_0x43bece){const _0x465252=await(0x0,CheckSettings_1[_0x5817b2(0x160)])(_0x40c5b7,_0x5817b2(0x1ff),_0x5817b2(0x116));let _0x130bc0=null;const _0x55c6ab=_0x49d603[_0x5817b2(0x115)]===_0x5817b2(0x18d)&&_0x49d603['user'][_0x5817b2(0x1fa)][_0x5817b2(0x1d3)]>0x0,_0x474cf0=!_0x55c6ab&&outOfHoursCache[_0x5817b2(0x143)]('ticket-'+_0x49d603['id']);if(_0x43bece===_0x5817b2(0x1a7)&&!_0x55c6ab){_0x130bc0=await(0x0,VerifyCurrentSchedule_1[_0x5817b2(0x109)])(_0x40c5b7),console[_0x5817b2(0x1de)]('Resultado\x20da\x20verificação\x20de\x20horário:',{'currentSchedule':_0x130bc0,'isInActivity':_0x130bc0?.['inActivity']});if(_0x130bc0&&_0x130bc0[_0x5817b2(0x163)]===![]){if(!_0x474cf0){outOfHoursCache[_0x5817b2(0x1c9)]('ticket-'+_0x49d603['id'],!![]);const _0x3fc47d=_0x43f9a3[_0x5817b2(0x188)]['trim']()||'Estamos\x20fora\x20do\x20horário\x20de\x20expediente';await(0x0,SendWhatsAppMessage_1[_0x5817b2(0x109)])({'ticket':_0x49d603,'body':_0x3fc47d});}_0x49d603[_0x5817b2(0x115)]!=='open'&&await(0x0,UpdateTicketService_1[_0x5817b2(0x109)])({'ticketData':{'chatbot':![],'status':_0x465252},'ticketId':_0x49d603['id'],'companyId':_0x49d603[_0x5817b2(0x1e9)]});return;}}if(_0x43bece==='queue'&&_0x49d603[_0x5817b2(0x13c)]!==null&&!_0x55c6ab){_0x130bc0=await(0x0,VerifyCurrentSchedule_1[_0x5817b2(0x109)])(_0x40c5b7,_0x49d603[_0x5817b2(0x13c)]);const _0x1f9911=await Queue_1['default'][_0x5817b2(0x1cb)](_0x49d603[_0x5817b2(0x13c)]);if(!(0x0,lodash_1['isNil'])(_0x130bc0)&&(!_0x130bc0||_0x130bc0['inActivity']===![])){if(!_0x474cf0){outOfHoursCache[_0x5817b2(0x1c9)](_0x5817b2(0x178)+_0x49d603['id'],!![]);const _0x495c91=_0x1f9911['outOfHoursMessage']?.[_0x5817b2(0x15d)]()||'Estamos\x20fora\x20do\x20horário\x20de\x20expediente';await(0x0,SendWhatsAppMessage_1[_0x5817b2(0x109)])({'ticket':_0x49d603,'body':_0x495c91});}_0x49d603[_0x5817b2(0x115)]!=='open'&&await(0x0,UpdateTicketService_1[_0x5817b2(0x109)])({'ticketData':{'chatbot':![],'status':_0x465252},'ticketId':_0x49d603['id'],'companyId':_0x49d603[_0x5817b2(0x1e9)]});return;}}}}catch(_0x4ca7ee){Sentry[_0x5817b2(0x1c8)](_0x4ca7ee),console[_0x5817b2(0x1de)](_0x5817b2(0x11c),_0x4ca7ee);}if(_0x49d603[_0x5817b2(0x1ba)]&&_0x49d603[_0x5817b2(0x15a)]&&!_0x4dc3f7[_0x5817b2(0x136)]['fromMe']){console[_0x5817b2(0x1de)](_0x5817b2(0x13f)+_0x49d603['id']+'\x20está\x20em\x20flow\x20ativo.\x20Processando\x20dentro\x20do\x20flow.'),await handleFlowBuilder(_0x49d603,_0x4dc3f7,_0x525fd6);return;}!_0x49d603['queue']&&!_0x49d603[_0x5817b2(0x15a)]&&!_0x54e8ac&&!_0x4dc3f7[_0x5817b2(0x136)][_0x5817b2(0x117)]&&!_0x49d603['userId']&&!_0xec6249&&(_0x43f9a3[_0x5817b2(0x18c)]&&_0x43f9a3[_0x5817b2(0x18c)][_0x5817b2(0x1d3)]>=0x1&&await(0x0,VerifyHandlers_1[_0x5817b2(0x16b)])(_0x525fd6,_0x4dc3f7,_0x49d603,_0x49d603[_0x5817b2(0x1cd)]));const _0x3a21cd=_0x49d603[_0x5817b2(0x173)]===null;await _0x49d603[_0x5817b2(0x1cc)]();if(_0x32365e&&!_0x43f9a3?.[_0x5817b2(0x18c)]?.[_0x5817b2(0x1d3)]&&!_0x49d603['userId']&&!_0x54e8ac&&!_0x4dc3f7[_0x5817b2(0x136)][_0x5817b2(0x117)]){const _0x75dc60=await Message_1[_0x5817b2(0x109)][_0x5817b2(0x142)]({'where':{'ticketId':_0x49d603['id'],'fromMe':!![]},'order':[['createdAt',_0x5817b2(0x1a4)]]});if(_0x75dc60&&_0x75dc60[_0x5817b2(0x12e)]['includes'](_0x43f9a3[_0x5817b2(0x121)]))return;if(_0x43f9a3['greetingMessage']){const _0x3f31be=(0x0,Debounce_1[_0x5817b2(0x118)])(async()=>{const _0x455ca6=_0x5817b2;await(0x0,SendWhatsAppMessage_1[_0x455ca6(0x109)])({'ticket':_0x49d603,'body':''+_0x43f9a3['greetingMessage']});},0x3e8,_0x49d603['id']);_0x3f31be();return;}}if(!_0x49d603[_0x5817b2(0x167)]&&_0x49d603[_0x5817b2(0x150)]>=_0x43f9a3?.[_0x5817b2(0x127)])return;if(_0x43f9a3['queues'][_0x5817b2(0x1d3)]===0x1&&_0x49d603[_0x5817b2(0x173)]){}if(_0x43f9a3[_0x5817b2(0x18c)]['length']>0x1&&_0x49d603[_0x5817b2(0x173)]){}}catch(_0x175e2e){Sentry['captureException'](_0x175e2e),logger_1['logger'][_0x5817b2(0x1fb)](_0x5817b2(0x1ed)+_0x175e2e);}};function a698_0x5cf3(){const _0x5e7919=['../WebhookService/ActionsWebhookService','360002ubZXSz','ephemeralMessage','3365572CbsMis','lodash','key','handleMessage','queue-','Mutex','listMessage','wbotMessageListener','queueId','../CompanyService/VerifyCurrentSchedule','contactMessage','Ticket\x20#','contactsArrayMessage','status@broadcast','findOne','get','CIPHERTEXT','getTypeMessage','emit','handleRating','@s.whatsapp.net','isNaN','constructor','__createBinding','handleFlowBuilderExecution','imageMessage','messages.upsert','ticketId','amountUsedBotQueues','toString','map','listResponseMessage','[Férias\x20Coletivas]\x20Novo\x20ticket\x20#','createdAt','liveLocationMessage','moment','locationMessage','ActionsWebhookService','flowBuilderId','../TicketServices/UpdateTicketService','create','trim','@sentry/node','Mensagem\x20','GetCompanySetting','@lid','../../libs/cache','inActivity','message','useRating','../../models/Queue','chatbot','viewOnceMessageV2','25GrHpth','logger','verifyQueue','remoteJidAlt','WhatsApp\x20ou\x20Contact\x20não\x20encontrado','isNull','../../models/User','Atualizando\x20estado\x20de\x20integração\x20do\x20ticket\x20#','hasOwnProperty','../../models/Setting','queue','SimpleObjectCache','\x20de\x20','__importDefault','warn','ticket-','Mensagem\x20de\x20canal/newsletter\x20ignorada:\x20','disabled','participant','runExclusive','buttonsResponseMessage','\x20-\x20Enviando\x20mensagem\x20de\x20férias\x20(apenas\x201\x20vez)','../../helpers/Debounce','conversation','type','../TypebotServices/typebotListener','random','../../helpers/CheckSettings','Mensagem\x20de\x20status\x20ignorada\x20de:\x20','writable','E2E_IDENTITY_CHANGED','outOfHoursMessage','170072VYfnkQ','\x20não\x20encontrado\x20ou\x20sem\x20flow','name','queues','open','../../libs/socket','handleMessageIntegration','10628091COJUrY','isInteger','chatbot\x20desativado!','apply','verifyContact','delete','count','Processando\x20mensagem\x20do\x20FlowBuilder:\x20\x22','./GetHandlers','__esModule','company-','../../helpers/Mustache','Error\x20handling\x20message\x20ack.\x20Err:\x20','Erro\x20de\x20decriptação\x20ignorado\x20para\x20mensagem\x20','@g.us','remoteJid','.\x20Ignorando\x20em\x20handleFlowBuilder.','call','lid','WAMessageStubType','DESC','debug','getBodyMessage','company','stringify','./SendWhatsAppMessage','../../models/UserRating','Atendimento\x20finalizado','senderPn','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','messageStubType','ticket','keepUserAndQueue','lastProcessedMessageId','Error\x20isValidMsg','typebotStatus','charAt','contacts:','whatsappId','Por\x20favor\x20avalie\x20nosso\x20atendimento','search','REVOKE','flowWebhook','profilePicUrl','split','templateMessage','typebotStatus:\x20','subject','\x20já\x20processada\x20para\x20o\x20ticket\x20','isGroup','verifyMediaMessage','../../utils/logger','getOwnPropertyNames','failed\x20to\x20decrypt','scheduleType','Error\x20handling\x20wbot\x20message\x20listener.\x20Err:\x20','captureException','set','513117XAJBfK','findByPk','reload','contact','floor','Error\x20processing\x20message\x20','333702IcKJIX','quotedMsg','update','length','/nopicture.png','viewOnceMessage','../../models/FlowBuilder','keys','[Férias\x20Coletivas]\x20Ticket\x20#','getOwnPropertyDescriptor','vcard','extendedTextMessage','forEach','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','log','toDate','CHATBOT_RESTRICT_NUMBER','buttonsMessage','prototype',',\x20flowBuilderId:\x20','nodes','integrationId','\x22\x20para\x20ticket\x20','readMessages','isFinite','companyId','__importStar','number','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','typebot','contactId','ratingMessage','../TicketServices/FindOrCreateTicketService','setExtra','edges','endsWith',':unreads','reactionMessage','filter','getMessageMedia','videoMessage','socketSessions','error','toLowerCase','-ticket','destroy','outOfHoursAction','flow','verifyRecentCampaign','default','getContactMessage','includes','verifyMessage','Erro\x20ao\x20processar\x20avaliação:','-open','defineProperty','FlowBuilder\x20','getIO','useIntegration','messageContextInfo','configurable','status','pending','fromMe','debounce','./VerifyHandlers','env','@newsletter','Erro\x20ao\x20verificar\x20horário\x20de\x20atendimento:','__setModuleDefault','mediaMessage','startsWith','verifyEditedMessage','greetingMessage','connections','collectiveVacationMessage','editedMessage','find','voiceMessage','maxUseBotQueues','813154lAkMAO','enabled','@whiskeysockets/baileys','../../models/TicketTraking','protocolMessage','40zahEkm','body','getUnpackedMessage','cacheLayer'];a698_0x5cf3=function(){return _0x5e7919;};return a698_0x5cf3();}exports['handleMessage']=handleMessage;const handleMsgAck=async(_0x330563,_0x5c1ec4)=>{const _0x3cc7a6=a698_0x6c503d;if(!_0x5c1ec4)return;const _0x1da598=(0x0,socket_1[_0x3cc7a6(0x111)])();try{const _0x469a30=await Message_1[_0x3cc7a6(0x109)][_0x3cc7a6(0x1cb)](_0x330563['key']['id'],{'include':[_0x3cc7a6(0x1cd),{'model':Message_1[_0x3cc7a6(0x109)],'as':_0x3cc7a6(0x1d1),'include':[_0x3cc7a6(0x1cd)]}]});if(!_0x469a30||_0x5c1ec4<=_0x469a30['ack'])return;await _0x469a30[_0x3cc7a6(0x1d2)]({'ack':_0x5c1ec4}),_0x1da598['to'](_0x469a30[_0x3cc7a6(0x14f)][_0x3cc7a6(0x151)]())[_0x3cc7a6(0x146)]('company-'+_0x469a30[_0x3cc7a6(0x1e9)]+'-appMessage',{'action':_0x3cc7a6(0x1d2),'message':_0x469a30});}catch(_0x17c75e){Sentry[_0x3cc7a6(0x1c8)](_0x17c75e),logger_1['logger'][_0x3cc7a6(0x1fb)](_0x3cc7a6(0x19c)+_0x17c75e);}},filterMessages=_0x1fea3b=>{const _0x563024=a698_0x6c503d;if(_0x1fea3b[_0x563024(0x136)][_0x563024(0x19f)]==='status@broadcast')return![];if(_0x1fea3b[_0x563024(0x136)][_0x563024(0x19f)]?.['endsWith'](_0x563024(0x11b)))return![];if(_0x1fea3b[_0x563024(0x164)]?.[_0x563024(0x12c)]?.['editedMessage'])return!![];if(_0x1fea3b[_0x563024(0x164)]?.[_0x563024(0x12c)]?.[_0x563024(0x181)]===0x0)return!![];if(_0x1fea3b[_0x563024(0x164)]?.[_0x563024(0x12c)])return![];if([baileys_1['WAMessageStubType'][_0x563024(0x1b9)],baileys_1['WAMessageStubType']['E2E_DEVICE_CHANGED'],baileys_1[_0x563024(0x1a3)][_0x563024(0x187)],baileys_1['WAMessageStubType'][_0x563024(0x144)]]['includes'](_0x1fea3b[_0x563024(0x1ae)]))return![];return!![];},wbotMessageListener=async(_0xdc57a9,_0x524270)=>{const _0x2e2d5a=a698_0x6c503d;try{_0xdc57a9['ev']['on'](_0x2e2d5a(0x14e),async _0x3024e3=>{const _0x527e34=_0x2e2d5a,_0x5a9c1f=_0x3024e3['messages'][_0x527e34(0x1f7)](filterMessages)[_0x527e34(0x152)](_0x5a2a2b=>_0x5a2a2b);if(!_0x5a9c1f)return;_0x5a9c1f[_0x527e34(0x1dc)](async _0x34e1f9=>{const _0x3994a7=_0x527e34;try{const _0x4660ae=await Message_1[_0x3994a7(0x109)][_0x3994a7(0x196)]({'where':{'id':_0x34e1f9[_0x3994a7(0x136)]['id'],'companyId':_0x524270}});if(!_0x4660ae){if(await(0x0,VerifyHandlers_1[_0x3994a7(0x108)])(_0x34e1f9,_0x524270))return;await handleMessage(_0x34e1f9,_0xdc57a9,_0x524270);}}catch(_0x36701d){if(_0x36701d[_0x3994a7(0x164)]?.['includes']('serialized\x20is\x20not\x20iterable')||_0x36701d['message']?.[_0x3994a7(0x10b)](_0x3994a7(0x1c5))){logger_1[_0x3994a7(0x16a)][_0x3994a7(0x1a5)](_0x3994a7(0x19d)+_0x34e1f9[_0x3994a7(0x136)]['id']+_0x3994a7(0x175)+_0x34e1f9[_0x3994a7(0x136)][_0x3994a7(0x19f)]+':\x20'+_0x36701d[_0x3994a7(0x164)]);return;}Sentry[_0x3994a7(0x1c8)](_0x36701d),logger_1['logger'][_0x3994a7(0x1fb)](_0x3994a7(0x1cf)+_0x34e1f9[_0x3994a7(0x136)]['id']+':\x20'+_0x36701d);}});}),_0xdc57a9['ev']['on']('messages.update',_0x3af410=>{const _0xe3e651=_0x2e2d5a;if(_0x3af410['length']===0x0)return;_0x3af410[_0xe3e651(0x1dc)](async _0x455795=>{const _0x253676=_0xe3e651;_0xdc57a9[_0x253676(0x1e7)]([_0x455795['key']]),await ackMutex[_0x253676(0x17c)](async()=>{const _0x5d5ab3=_0x253676;handleMsgAck(_0x455795,_0x455795[_0x5d5ab3(0x1d2)][_0x5d5ab3(0x115)]);});});});}catch(_0x1da7a4){Sentry[_0x2e2d5a(0x1c8)](_0x1da7a4),logger_1['logger'][_0x2e2d5a(0x1fb)](_0x2e2d5a(0x1c7)+_0x1da7a4);}};exports[a698_0x6c503d(0x13b)]=wbotMessageListener;