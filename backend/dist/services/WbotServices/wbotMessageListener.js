const a561_0x810c34=a561_0x439c;(function(_0x42b604,_0x1b297d){const _0x23e548=a561_0x439c,_0x1d44c3=_0x42b604();while(!![]){try{const _0x57b23f=-parseInt(_0x23e548(0x256))/0x1*(-parseInt(_0x23e548(0x267))/0x2)+-parseInt(_0x23e548(0x1ea))/0x3+parseInt(_0x23e548(0x215))/0x4*(parseInt(_0x23e548(0x170))/0x5)+-parseInt(_0x23e548(0x1de))/0x6+-parseInt(_0x23e548(0x1b1))/0x7+parseInt(_0x23e548(0x2b6))/0x8+-parseInt(_0x23e548(0x26c))/0x9;if(_0x57b23f===_0x1b297d)break;else _0x1d44c3['push'](_0x1d44c3['shift']());}catch(_0x37ae25){_0x1d44c3['push'](_0x1d44c3['shift']());}}}(a561_0x555d,0x49d8d));const a561_0x4ac03f=(function(){let _0x2e452a=!![];return function(_0x2bd9e3,_0x3692ce){const _0x1cceba=_0x2e452a?function(){const _0x17d221=a561_0x439c;if(_0x3692ce){const _0x217dd0=_0x3692ce[_0x17d221(0x191)](_0x2bd9e3,arguments);return _0x3692ce=null,_0x217dd0;}}:function(){};return _0x2e452a=![],_0x1cceba;};}()),a561_0x4b0560=a561_0x4ac03f(this,function(){const _0x251c27=a561_0x439c;return a561_0x4b0560[_0x251c27(0x164)]()['search'](_0x251c27(0x182))[_0x251c27(0x164)]()[_0x251c27(0x1fa)](a561_0x4b0560)['search'](_0x251c27(0x182));});a561_0x4b0560();'use strict';var __createBinding=this&&this[a561_0x810c34(0x110)]||(Object['create']?function(_0x2429fc,_0x1580ba,_0x3304c2,_0x3598cc){const _0x1c75e7=a561_0x810c34;if(_0x3598cc===undefined)_0x3598cc=_0x3304c2;var _0x1f09a2=Object[_0x1c75e7(0x15c)](_0x1580ba,_0x3304c2);(!_0x1f09a2||(_0x1c75e7(0x104)in _0x1f09a2?!_0x1580ba[_0x1c75e7(0x217)]:_0x1f09a2['writable']||_0x1f09a2[_0x1c75e7(0x26b)]))&&(_0x1f09a2={'enumerable':!![],'get':function(){return _0x1580ba[_0x3304c2];}}),Object[_0x1c75e7(0x13f)](_0x2429fc,_0x3598cc,_0x1f09a2);}:function(_0x4b0ef6,_0x53d17b,_0xff3eaa,_0x3de2ca){if(_0x3de2ca===undefined)_0x3de2ca=_0xff3eaa;_0x4b0ef6[_0x3de2ca]=_0x53d17b[_0xff3eaa];}),__setModuleDefault=this&&this[a561_0x810c34(0x1f3)]||(Object['create']?function(_0x320d23,_0x27a16a){const _0x3a7532=a561_0x810c34;Object['defineProperty'](_0x320d23,_0x3a7532(0x266),{'enumerable':!![],'value':_0x27a16a});}:function(_0x36326b,_0x4fdad1){const _0x52106a=a561_0x810c34;_0x36326b[_0x52106a(0x266)]=_0x4fdad1;}),__importStar=this&&this['__importStar']||function(_0x9cd63){const _0x431070=a561_0x810c34;if(_0x9cd63&&_0x9cd63[_0x431070(0x217)])return _0x9cd63;var _0x451615={};if(_0x9cd63!=null){for(var _0x1b6b5d in _0x9cd63)if(_0x1b6b5d!=='default'&&Object[_0x431070(0x239)]['hasOwnProperty'][_0x431070(0x1b4)](_0x9cd63,_0x1b6b5d))__createBinding(_0x451615,_0x9cd63,_0x1b6b5d);}return __setModuleDefault(_0x451615,_0x9cd63),_0x451615;},__importDefault=this&&this[a561_0x810c34(0x264)]||function(_0x2d4cd0){const _0x3fbd7c=a561_0x810c34;return _0x2d4cd0&&_0x2d4cd0[_0x3fbd7c(0x217)]?_0x2d4cd0:{'default':_0x2d4cd0};};Object[a561_0x810c34(0x13f)](exports,a561_0x810c34(0x217),{'value':!![]}),exports['wbotMessageListener']=exports['verifyCampaignMessageAndCloseTicket']=exports['verifyRecentCampaign']=exports['handleMsgAck']=exports['handleMessage']=exports[a561_0x810c34(0x205)]=exports[a561_0x810c34(0x17c)]=exports[a561_0x810c34(0x118)]=exports['isValidMsg']=exports[a561_0x810c34(0x143)]=exports[a561_0x810c34(0x224)]=exports[a561_0x810c34(0x16e)]=exports[a561_0x810c34(0xff)]=exports[a561_0x810c34(0x19e)]=exports['makeid']=exports[a561_0x810c34(0x138)]=exports['sendMessageImage']=exports[a561_0x810c34(0x17d)]=exports[a561_0x810c34(0x190)]=exports[a561_0x810c34(0x140)]=exports[a561_0x810c34(0x187)]=void 0x0;const path_1=__importStar(require(a561_0x810c34(0x14f))),util_1=require(a561_0x810c34(0x220)),fs_1=require('fs'),Sentry=__importStar(require('@sentry/node')),lodash_1=require(a561_0x810c34(0x21a)),baileys_1=require(a561_0x810c34(0x2b4)),MessageUtils=__importStar(require(a561_0x810c34(0x22c))),stream_throttle_1=require(a561_0x810c34(0x153)),Contact_1=__importDefault(require(a561_0x810c34(0x214))),Ticket_1=__importDefault(require(a561_0x810c34(0x1d7))),Message_1=__importDefault(require('../../models/Message')),OldMessage_1=__importDefault(require('../../models/OldMessage')),socket_1=require(a561_0x810c34(0x1ff)),CreateMessageService_1=__importDefault(require(a561_0x810c34(0x287))),logger_1=require('../../utils/logger'),CreateOrUpdateContactService_1=__importDefault(require(a561_0x810c34(0x13b))),FindOrCreateTicketService_1=__importDefault(require(a561_0x810c34(0x23e))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),UpdateTicketService_1=__importDefault(require(a561_0x810c34(0x1fe))),Mustache_1=__importDefault(require(a561_0x810c34(0x1b0))),UserRating_1=__importDefault(require(a561_0x810c34(0x1d9))),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),moment_1=__importDefault(require(a561_0x810c34(0x166))),Queue_1=__importDefault(require(a561_0x810c34(0x20a))),QueueOption_1=__importDefault(require(a561_0x810c34(0x27f))),FindOrCreateATicketTrakingService_1=__importDefault(require(a561_0x810c34(0x1a3))),VerifyCurrentSchedule_1=__importDefault(require(a561_0x810c34(0x172))),Campaign_1=__importDefault(require('../../models/Campaign')),CampaignShipping_1=__importDefault(require(a561_0x810c34(0x1aa))),sequelize_1=require(a561_0x810c34(0x10e)),queues_1=require(a561_0x810c34(0x1e4)),User_1=__importDefault(require('../../models/User')),Setting_1=__importDefault(require(a561_0x810c34(0x156))),cache_1=require(a561_0x810c34(0x169)),Debounce_1=require('../../helpers/Debounce'),openai_1=require(a561_0x810c34(0x209)),fluent_ffmpeg_1=__importDefault(require(a561_0x810c34(0x22a))),microsoft_cognitiveservices_speech_sdk_1=require(a561_0x810c34(0x208)),providers_1=require('./providers'),typebotListener_1=__importDefault(require(a561_0x810c34(0x21f))),ShowQueueIntegrationService_1=__importDefault(require(a561_0x810c34(0x226))),SendWhatsAppMedia_1=require('./SendWhatsAppMedia'),fs_2=__importDefault(require('fs')),request_1=__importDefault(require('request')),ffmpeg_static_1=__importDefault(require('ffmpeg-static')),app_1=__importDefault(require(a561_0x810c34(0x2ac))),mime_1=__importDefault(require('mime')),wbot_1=require(a561_0x810c34(0x17f)),SendPresenceStatus_1=require(a561_0x810c34(0x262)),MakeRandomId_1=require(a561_0x810c34(0x1a6));fluent_ffmpeg_1[a561_0x810c34(0x266)][a561_0x810c34(0x243)](ffmpeg_static_1[a561_0x810c34(0x266)]);const sessionsOpenAi=[],isNumeric=_0x27e93a=>/^-?\d+$/[a561_0x810c34(0x1a2)](_0x27e93a);exports['isNumeric']=isNumeric;let outOfHourMessageControl=[],completionMessageControl=[],greetingMessageControl=[],farewellMessageControl=[];const writeFileAsync=(0x0,util_1[a561_0x810c34(0x263)])(fs_1[a561_0x810c34(0x186)]),getTypeMessage=_0x5ecc2a=>{const _0x29d5fe=a561_0x810c34;return(0x0,baileys_1['getContentType'])(_0x5ecc2a[_0x29d5fe(0x285)]);},removeNonPrintableChars=_0x1bac19=>{return _0x1bac19['replace'](/[\x00-\x1F\x7F-\x9F]/g,'');};function a561_0x555d(){const _0xe60d26=['816282JBBpfa','contextInfo','buttonsMessage','mediaPath','keys','ratingAt','getReactionMessage','minutes','hydratedTemplate','__setModuleDefault','queueId','\x20tokens\x20e\x20cuide\x20para\x20não\x20truncar\x20o\x20final.\x0aSempre\x20que\x20possível,\x20mencione\x20o\x20nome\x20dele\x20para\x20ser\x20mais\x20personalizado\x20o\x20atendimento\x20e\x20mais\x20educado.\x20Quando\x20a\x20resposta\x20requer\x20uma\x20transferência\x20para\x20o\x20setor\x20de\x20atendimento,\x20comece\x20sua\x20resposta\x20com\x20\x27Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento\x27.\x0a\x0a\x20\x20','Erro\x20ao\x20deletar\x20o\x20arquivo:','type',']\x20-\x20','participant','constructor','amountUsedBotQueues','getButtonsMessage','&z=17&hl=pt-BR|','../TicketServices/UpdateTicketService','../../libs/socket','isGroup','findOne','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','getAd','setMinutes','handleMessageIntegration','hydratedFourRowTemplate','resolve','microsoft-cognitiveservices-speech-sdk','openai','../../models/Queue','ProtocolMessage','createReadStream','apiKey','captureException','\x20-\x20Longitude:\x20','isArray','SAIR','viewOnceMessageV2','header','../../models/Contact','4wxCQgt','enabled','__esModule','SpeechConfig','media','lodash','greetingMessage','verifyCampaignMessageAndCloseTicket','SERVER_ACK','isValidMsg','../TypebotServices/typebotListener','util','speakTextAsync','Convite\x20Revogado','.mp3','verifyQuotedMessage','Failed\x20to\x20fetch\x20queues:','../QueueIntegrationServices/ShowQueueIntegrationService','content','\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial','Error\x20isValidMsg','fluent-ffmpeg','option','./wbotGetMessageFromType','gte','-open','options','messages.update','findIndex','pop','maxTokens','\x20para\x20identificar\x20o\x20cliente.\x0aSua\x20resposta\x20deve\x20usar\x20no\x20máximo\x20','update!','dataJson','values','push','prototype','createChatCompletion','pushName','cacheLayer','finishedAt','../TicketServices/FindOrCreateTicketService','handleMsgAck','delete','toFormat','reload','setFfmpegPath','chat','temperature','base64','fourRowTemplate','endTime','concat','mp3','contactMessage','company-','campaignId','assistant','prompt','\x201286\x20-\x20Entrei\x20na\x20integracao\x20openai.','audio/mpeg','Latitude:\x20','findByPk','stickerMessage','error','51977AuztZg','videoMessage','caption','choices','voiceMessage','string','ERR_WAPP_DOWNLOAD_MEDIA','documentMessage','contactsArrayMessage','integrationId','getVideoMessage','title','../../helpers/SendPresenceStatus','promisify','__importDefault','getWbot','default','20MULsoz','ack','selectedRowId','closed','configurable','2000655CJuune','parseToMilliseconds','substring','catch','emit','pollCreationMessageV3','outOfHoursMessage','parentId','endLunchTime','application','CIPHERTEXT','Mensagem\x20que\x20Desaparece','maxUseBotQueues','SendPresenceStatus','-closed','min','Status','templateMessage','CHATBOT_RESTRICT_NUMBER','../../models/QueueOption','weekdayEn','close','promptId','listMessage','singleSelectReply','message','find','../MessageServices/CreateMessageService','-appMessage',':unreads','messages','PENDING','set','\x20seconds\x20with\x20an\x20effective\x20speed\x20of\x20','makeid','indexOf','*[\x20','voice','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','companyId','startTime','random','mediaName','extractMessageContent','pt-BR-FabioNeural','locationMessage','viewOnceMessage','name','hydratedHsm','voiceKey','getGroupInviteMessage','public','replace','keywords','externalAdReply','\x0a\x0a*[\x20#\x20]*\x20-\x20Voltar\x20ao\x20Menu\x20Principal','g.us','Erro\x20ao\x20salvar\x20ticket!','key','contacts:','Enquete\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','getContactMessage','isInteger','getImageMessage','../../app','Erro\x20ao\x20salvar\x20mensagem!','input','startLunchTime','complationMessage','Error\x20converting\x20file:\x20','Configuration','DESC','@whiskeysockets/baileys','disableBot','3565344aTtaty','*Você\x20encerrou\x20este\x20atendimento\x20usando\x20o\x20comando\x20SAIR*.\x0a\x0a\x0aSe\x20você\x20finalizou\x20o\x20atendimento\x20*ANTES*\x20de\x20receber\x20um\x20retorno\x20do\x20operador,\x20ele\x20*NÃO*\x20irá\x20visualizar\x20sua\x20solicitação!\x0a\x0aVocê\x20deve\x20aguardar\x20o\x20retorno\x20do\x20operador\x20e\x20que\x20ele\x20encerre\x20seu\x20atendimento\x20quando\x20necessário.\x0a\x0aUse\x20a\x20opção\x20*SAIR*\x20somente\x20em\x20casos\x20de\x20emergência\x20ou\x20se\x20ficou\x20preso\x20em\x20algum\x20setor.\x0a\x0a\x0aPara\x20iniciar\x20um\x20novo\x20atendimento\x20basta\x20enviar\x20uma\x20nova\x20mensagem!','messageStubType','editedMessage','remoteJid','getQuotedMessage','getMinutes','env','queues','HH:mm','get','stanzaId','Múltiplos\x20Produtos','CheckMsgIsGroup','map','length','subtract','Lista','Failed\x20to\x20get\x20stream','setExtra','sequelize','user','__createBinding','Menu\x20inicial\x20*[\x200\x20]*\x20Menu\x20anterior','\x20Download\x20completed\x20in\x20','isNil','highlyStructuredMessage','upsert','toDate','Mensagem\x20de\x20grupo\x20bloqueada!','verifyRating','selectedId','typebot','dddd','logger','sendMessageImage','getCallMessage','getTextMessage','botText\x202','unlinkSync','trace','join','forEach','\x20]*\x20-\x20','stringify','%2C','DELIVERY_ACK','chmodSync','botText','EM_ANDAMENTO','Erro\x20para\x20responder\x20com\x20audio:\x20','image/jpeg','Type','Erro\x20ao\x20salvar\x20avaliação!','WAMessageStubType','ephemeralMessage','document','application/pdf','dest','debounce','trim','listResponseMessage','sendMessageLink','isBetween','subject','../ContactServices/CreateOrUpdateContactService','whatsappId','from','save','defineProperty','removeNonPrintableChars','SpeechSynthesizer','greetingMediaAttachment','verifyMessage','E2E_DEVICE_CHANGED','createdAt','text','toLowerCase','then','useIntegration','liveLocationMessage','status@broadcast','verifyRecentCampaign','isAfter','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','path','Produto','whisper-1','includes','stream-throttle','makeRandomId','public/temp/','../../models/Setting','pollCreationMessageV2','MESSAGE_EDIT','body','chatBotType','documentWithCaptionMessage','getOwnPropertyDescriptor','existsSync','getTime','add','value','quotedMessage','isBefore','chatbotAt','toString','\x0a*[\x200\x20]*\x20-\x20Menu\x20anterior','moment','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','urlN8N','../../libs/cache','Escolha\x20uma\x20opção','userId','READ','PLAYED','getQuotedMessageId','public/company','1365965MsZBQW','log','../CompanyService/VerifyCurrentSchedule','MessageUpdateJob','endsWith','getViewOnceMessage','-ticket','WebMessageInfo','pending','advertising','now','slice','handleRating','sleep','Error:\x20','../../libs/wbot','E2E_IDENTITY_CHANGED','filter','(((.+)+)+)+$','Throttle','company','Mensagem','writeFile','isNumeric','contacts','Solicitação\x20de\x20Pagamento','voiceRegion','findAll','reactionMessage','create','buttonsResponseMessage','getIO','validaCpfCnpj','apply','number','contact','.wav','>>>>\x20erro\x20','charAt','pipe','productImage','jidNormalizedUser','AudioConfig','Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','status','data','getBodyMessage','productMessage','protocolMessage','maxMessages','test','../TicketServices/FindOrCreateATicketTrakingService','getBodyButton','end','../../helpers/MakeRandomId','campaignQueue','imageMessage','mediaUrl','../../models/CampaignShipping','button','changed','interactiveMessage','head','data:image/png;base64,\x20','../../helpers/Mustache','202874wYjvNr','queueOptionId','chatbot\x20desativado!','call','Erro\x20ao\x20buscar\x20grupo!','getMessageOptions','Expected\x20bodyMessage\x20to\x20be\x20a\x20string,\x20got:','botText\x203','Mensagem\x20inválida\x208!\x20','time','mimetype','conversation','Failed\x20to\x20fetch\x20contact\x20from\x20ticket:','proto','filename','updatedAt','speechSynthesisVoiceName','DispatchCampaign','Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','randomValue','system','rate','ASC','sendMessage','fromMe','gpt-3.5-turbo-1106','fromSubscription','body\x20is\x20not\x20a\x20string','ticketId','groups.update','selectedButtonId','extension','chatbot','handleMessage','Amigo(a)','s.whatsapp.net','fora\x20do\x20horario','extendedTextMessage','../../models/Ticket','scheduleType','../../models/UserRating','audioMessage','fromAudioFileOutput','next','hydratedContentText','2476698HfULPy','toFixed','queue','Mensagem\x20editada\x20não\x20encontrada:\x20','unknown','warn','../../queues','mediaType','split','createTranscription','update','count'];a561_0x555d=function(){return _0xe60d26;};return a561_0x555d();}exports[a561_0x810c34(0x140)]=removeNonPrintableChars;async function getQueues(_0x37152f){const _0x5f49a7=a561_0x810c34;try{const _0x5d2b4f=await Queue_1['default']['findAll']({'where':{'companyId':_0x37152f}});return _0x5d2b4f;}catch(_0x566973){return console[_0x5f49a7(0x255)](_0x5f49a7(0x225),_0x566973),[];}}async function getContactFromTicket(_0x5ef234){const _0x32c3a1=a561_0x810c34;try{const _0x32be13=await Ticket_1[_0x32c3a1(0x266)][_0x32c3a1(0x253)](_0x5ef234,{'include':[{'model':Contact_1['default'],'as':_0x32c3a1(0x193)}]});return _0x32be13&&_0x32be13[_0x32c3a1(0x193)]?_0x32be13[_0x32c3a1(0x193)]:(console[_0x32c3a1(0x171)]('No\x20contact\x20found\x20for\x20this\x20ticket.'),null);}catch(_0x42dd6c){return console[_0x32c3a1(0x255)](_0x32c3a1(0x1bd),_0x42dd6c),null;}}function a561_0x439c(_0x320180,_0x328faf){const _0x270d79=a561_0x555d();return a561_0x439c=function(_0x4b0560,_0x4ac03f){_0x4b0560=_0x4b0560-0xff;let _0x555d24=_0x270d79[_0x4b0560];return _0x555d24;},a561_0x439c(_0x320180,_0x328faf);}function validaCpfCnpj(_0x1d2a05){const _0x5bd06e=a561_0x810c34;if(_0x1d2a05[_0x5bd06e(0x109)]==0xb){var _0x21a419=_0x1d2a05['trim']();_0x21a419=_0x21a419[_0x5bd06e(0x2a0)](/\./g,''),_0x21a419=_0x21a419[_0x5bd06e(0x2a0)]('-',''),_0x21a419=_0x21a419[_0x5bd06e(0x1e6)]('');var _0x29c74f=0x0,_0x55fdd7=0x0,_0x9b1469=![];for(var _0x4659b2=0x1;_0x21a419[_0x5bd06e(0x109)]>_0x4659b2;_0x4659b2++){_0x21a419[_0x4659b2-0x1]!=_0x21a419[_0x4659b2]&&(_0x9b1469=!![]);}if(_0x9b1469==![])return![];for(var _0x4659b2=0x0,_0x368602=0xa;_0x21a419['length']-0x2>_0x4659b2;_0x4659b2++,_0x368602--){_0x29c74f+=_0x21a419[_0x4659b2]*_0x368602;}_0x29c74f=_0x29c74f*0xa%0xb;_0x29c74f==0xa&&(_0x29c74f=0x0);if(_0x29c74f!=_0x21a419[0x9])return![];for(var _0x4659b2=0x0,_0x368602=0xb;_0x21a419[_0x5bd06e(0x109)]-0x1>_0x4659b2;_0x4659b2++,_0x368602--){_0x55fdd7+=_0x21a419[_0x4659b2]*_0x368602;}return _0x55fdd7=_0x55fdd7*0xa%0xb,_0x55fdd7==0xa&&(_0x55fdd7=0x0),_0x55fdd7!=_0x21a419[0xa]?![]:!![];}else{if(_0x1d2a05[_0x5bd06e(0x109)]==0xe){var _0x3fec97=_0x1d2a05[_0x5bd06e(0x136)]();_0x3fec97=_0x3fec97['replace'](/\./g,''),_0x3fec97=_0x3fec97['replace']('-',''),_0x3fec97=_0x3fec97[_0x5bd06e(0x2a0)]('/',''),_0x3fec97=_0x3fec97[_0x5bd06e(0x1e6)]('');var _0x29c74f=0x0,_0x55fdd7=0x0,_0x9b1469=![];for(var _0x4659b2=0x1;_0x3fec97[_0x5bd06e(0x109)]>_0x4659b2;_0x4659b2++){_0x3fec97[_0x4659b2-0x1]!=_0x3fec97[_0x4659b2]&&(_0x9b1469=!![]);}if(_0x9b1469==![])return![];for(var _0x4659b2=0x0,_0x5d164f=0x5,_0x21df04=0xd;_0x3fec97[_0x5bd06e(0x109)]-0x2>_0x4659b2;_0x4659b2++,_0x5d164f--,_0x21df04--){_0x5d164f>=0x2?_0x29c74f+=_0x3fec97[_0x4659b2]*_0x5d164f:_0x29c74f+=_0x3fec97[_0x4659b2]*_0x21df04;}_0x29c74f=_0x29c74f%0xb;_0x29c74f<0x2?_0x29c74f=0x0:_0x29c74f=0xb-_0x29c74f;if(_0x29c74f!=_0x3fec97[0xc])return![];for(var _0x4659b2=0x0,_0x5d164f=0x6,_0x21df04=0xe;_0x3fec97[_0x5bd06e(0x109)]-0x1>_0x4659b2;_0x4659b2++,_0x5d164f--,_0x21df04--){_0x5d164f>=0x2?_0x55fdd7+=_0x3fec97[_0x4659b2]*_0x5d164f:_0x55fdd7+=_0x3fec97[_0x4659b2]*_0x21df04;}return _0x55fdd7=_0x55fdd7%0xb,_0x55fdd7<0x2?_0x55fdd7=0x0:_0x55fdd7=0xb-_0x55fdd7,_0x55fdd7!=_0x3fec97[0xd]?![]:!![];}else return![];}}exports[a561_0x810c34(0x190)]=validaCpfCnpj;function timeout(_0x1c0496){return new Promise(_0x2bbdd7=>setTimeout(_0x2bbdd7,_0x1c0496));}async function sleep(_0x5816de){await timeout(_0x5816de);}exports['sleep']=sleep;const sendMessageImage=async(_0x112a54,_0x3277c3,_0x36ef70,_0x52f408,_0x402abe)=>{const _0x2821a2=a561_0x810c34;let _0xcc14e1;try{_0xcc14e1=await _0x112a54[_0x2821a2(0x1c8)](_0x3277c3['number']+'@'+(_0x36ef70[_0x2821a2(0x200)]?_0x2821a2(0x2a4):_0x2821a2(0x1d4)),{'image':_0x52f408?{'url':_0x52f408}:fs_2[_0x2821a2(0x266)]['readFileSync'](_0x2821a2(0x155)+_0x402abe+'-'+makeid(0xa)),'fileName':_0x402abe,'caption':_0x402abe,'mimetype':_0x2821a2(0x12d)});}catch(_0xfca775){_0xcc14e1=await _0x112a54[_0x2821a2(0x1c8)](_0x3277c3[_0x2821a2(0x192)]+'@'+(_0x36ef70[_0x2821a2(0x200)]?_0x2821a2(0x2a4):_0x2821a2(0x1d4)),{'text':(0x0,Mustache_1['default'])(_0x2821a2(0x19b),_0x36ef70)});}(0x0,exports[_0x2821a2(0x143)])(_0xcc14e1,_0x36ef70,_0x3277c3);};exports[a561_0x810c34(0x11d)]=sendMessageImage;const sendMessageLink=async(_0x1dc413,_0x486757,_0x170d32,_0x412954,_0x56591b)=>{const _0x4f71af=a561_0x810c34;let _0x54c793;try{_0x54c793=await _0x1dc413['sendMessage'](_0x486757[_0x4f71af(0x192)]+'@'+(_0x170d32[_0x4f71af(0x200)]?_0x4f71af(0x2a4):'s.whatsapp.net'),{'document':_0x412954?{'url':_0x412954}:fs_2['default']['readFileSync'](_0x4f71af(0x155)+_0x56591b+'-'+makeid(0xa)),'fileName':_0x56591b,'caption':_0x56591b,'mimetype':_0x4f71af(0x133)});}catch(_0x1544c0){_0x54c793=await _0x1dc413['sendMessage'](_0x486757[_0x4f71af(0x192)]+'@'+(_0x170d32[_0x4f71af(0x200)]?'g.us':'s.whatsapp.net'),{'text':(0x0,Mustache_1[_0x4f71af(0x266)])('Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!',_0x170d32)});}(0x0,exports[_0x4f71af(0x143)])(_0x54c793,_0x170d32,_0x486757);};exports[a561_0x810c34(0x138)]=sendMessageLink;function makeid(_0x131337){const _0x3a5583=a561_0x810c34;var _0x48a97='',_0x3b83d4=_0x3a5583(0x292),_0x96ff92=_0x3b83d4[_0x3a5583(0x109)];for(var _0x2f66d8=0x0;_0x2f66d8<_0x131337;_0x2f66d8++){_0x48a97+=_0x3b83d4[_0x3a5583(0x196)](Math['floor'](Math[_0x3a5583(0x295)]()*_0x96ff92));}return _0x48a97;}exports[a561_0x810c34(0x28e)]=makeid;const msgLocation=(_0xa99ea7,_0x1bd554,_0x28c687)=>{const _0x361500=a561_0x810c34;if(_0xa99ea7){var _0x549f63=Buffer['from'](_0xa99ea7)[_0x361500(0x164)](_0x361500(0x246));let _0x48a450=_0x361500(0x1af)+_0x549f63+'\x20|\x20https://maps.google.com/maps?q='+_0x1bd554+_0x361500(0x127)+_0x28c687+_0x361500(0x1fd)+_0x1bd554+',\x20'+_0x28c687+'\x20';return _0x48a450;}},getBodyMessage=_0x523dd3=>{const _0x303d67=a561_0x810c34;try{let _0x5355ab=getTypeMessage(_0x523dd3);const _0x2b4a45={'conversation':MessageUtils[_0x303d67(0x11f)](_0x523dd3),'editedMessage':_0x523dd3?.['message']?.[_0x303d67(0x2b9)]?.[_0x303d67(0x285)]?.[_0x303d67(0x1a0)]?.[_0x303d67(0x2b9)]?.[_0x303d67(0x1bc)]||_0x523dd3?.[_0x303d67(0x285)]?.[_0x303d67(0x2b9)]?.[_0x303d67(0x285)]?.['extendedTextMessage']?.[_0x303d67(0x146)],'imageMessage':MessageUtils[_0x303d67(0x2ab)](_0x523dd3),'videoMessage':MessageUtils[_0x303d67(0x260)](_0x523dd3),'extendedTextMessage':_0x523dd3['message']?.[_0x303d67(0x1d6)]?.[_0x303d67(0x146)],'buttonsResponseMessage':MessageUtils[_0x303d67(0x1fc)](_0x523dd3),'templateButtonReplyMessage':_0x523dd3[_0x303d67(0x285)]?.['templateButtonReplyMessage']?.[_0x303d67(0x119)],'messageContextInfo':_0x523dd3['message']?.[_0x303d67(0x18e)]?.[_0x303d67(0x1cf)]||_0x523dd3[_0x303d67(0x285)]?.[_0x303d67(0x137)]?.[_0x303d67(0x261)],'buttonsMessage':MessageUtils[_0x303d67(0x1a4)](_0x523dd3)||_0x523dd3['message']?.[_0x303d67(0x137)]?.[_0x303d67(0x284)]?.[_0x303d67(0x269)],'viewOnceMessage':MessageUtils[_0x303d67(0x175)](_0x523dd3),'viewOnceMessageV2':MessageUtils['getViewOnceMessageV2'](_0x523dd3),'stickerMessage':MessageUtils['getStickerMessage'](_0x523dd3),'contactMessage':MessageUtils[_0x303d67(0x2a9)](_0x523dd3),'contactsArrayMessage':_0x523dd3[_0x303d67(0x285)]?.[_0x303d67(0x25e)]?.[_0x303d67(0x188)]&&MessageUtils['getContactsArrayMessage'](_0x523dd3),'pollCreationMessageV2':_0x523dd3[_0x303d67(0x285)]?.[_0x303d67(0x157)]?.[_0x303d67(0x29b)]||_0x303d67(0x2a8),'pollCreationMessageV3':_0x523dd3[_0x303d67(0x285)]?.['pollCreationMessageV3']?.[_0x303d67(0x29b)]||_0x303d67(0x2a8),'interactiveMessage':_0x523dd3[_0x303d67(0x285)]?.[_0x303d67(0x1ad)]?.['body']||_0x523dd3[_0x303d67(0x285)]?.[_0x303d67(0x1ad)]?.['contextInfo']||'Mensagem\x20interativa\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','locationMessage':MessageUtils['getLocationMessage'](_0x523dd3),'liveLocationMessage':_0x303d67(0x252)+_0x523dd3[_0x303d67(0x285)]?.[_0x303d67(0x14a)]?.['degreesLatitude']+_0x303d67(0x20f)+_0x523dd3[_0x303d67(0x285)]?.[_0x303d67(0x14a)]?.['degreesLongitude'],'documentMessage':MessageUtils['getDocumentMessage'](_0x523dd3),'documentWithCaptionMessage':_0x523dd3[_0x303d67(0x285)]?.['documentWithCaptionMessage']?.[_0x303d67(0x285)]?.[_0x303d67(0x25d)]?.[_0x303d67(0x258)],'audioMessage':MessageUtils['getAudioMessage'](_0x523dd3),'ephemeralMessage':_0x523dd3[_0x303d67(0x285)]?.[_0x303d67(0x131)]?.[_0x303d67(0x285)]?.[_0x303d67(0x1d6)]?.[_0x303d67(0x146)],'listMessage':MessageUtils['getBodyButton'](_0x523dd3)||_0x523dd3[_0x303d67(0x285)]?.[_0x303d67(0x137)]?.[_0x303d67(0x261)],'listResponseMessage':MessageUtils['getListMessage'](_0x523dd3),'reactionMessage':MessageUtils[_0x303d67(0x1f0)](_0x523dd3)||'reaction','advertising':MessageUtils[_0x303d67(0x203)](_0x523dd3)||_0x523dd3['message']?.[_0x303d67(0x137)]?.['contextInfo']?.[_0x303d67(0x2a2)]?.[_0x303d67(0x261)],'productMessage':_0x523dd3[_0x303d67(0x285)]?.[_0x303d67(0x19f)]?.['product']?.[_0x303d67(0x198)]?.[_0x303d67(0x258)]||_0x303d67(0x150),'multiProductMessage':_0x303d67(0x106),'orderMessage':'Pedido','paymentMessage':MessageUtils['getPaymentMessage'](_0x523dd3),'paymentRequestMessage':_0x303d67(0x189),'groupInviteMessage':MessageUtils[_0x303d67(0x29e)](_0x523dd3),'revokeInviteMessage':_0x303d67(0x222),'protocolMessage':_0x523dd3['message']?.[_0x303d67(0x1a0)]?.[_0x303d67(0x2b9)]?.[_0x303d67(0x1bc)]||null,'disappearingMessage':_0x303d67(0x277),'callMessage':MessageUtils[_0x303d67(0x11e)](_0x523dd3),'templateMessage':MessageUtils['getTemplateMessage'](_0x523dd3),'statusUpdateMessage':'Atualização\x20de\x20Status'};return _0x2b4a45[_0x5355ab]||null;}catch(_0xb43e46){return console['error']('Error\x20getting\x20message\x20body:',_0xb43e46),null;}};exports[a561_0x810c34(0x19e)]=getBodyMessage;const getQuotedMessage=_0x30098f=>{const _0x28e50c=a561_0x810c34,_0x105e40=_0x30098f[_0x28e50c(0x285)][_0x28e50c(0x1a8)]['contextInfo']||_0x30098f['message'][_0x28e50c(0x257)][_0x28e50c(0x1eb)]||_0x30098f['message']?.['documentMessage']||_0x30098f[_0x28e50c(0x285)][_0x28e50c(0x1d6)][_0x28e50c(0x1eb)]||_0x30098f['message']['buttonsResponseMessage'][_0x28e50c(0x1eb)]||_0x30098f[_0x28e50c(0x285)]['listResponseMessage'][_0x28e50c(0x1eb)]||_0x30098f[_0x28e50c(0x285)]['templateButtonReplyMessage'][_0x28e50c(0x1eb)]||_0x30098f[_0x28e50c(0x285)]['buttonsResponseMessage']?.[_0x28e50c(0x1eb)]||_0x30098f?.[_0x28e50c(0x285)]?.['buttonsResponseMessage']?.['selectedButtonId']||_0x30098f[_0x28e50c(0x285)]['listResponseMessage']?.[_0x28e50c(0x284)]?.[_0x28e50c(0x269)]||_0x30098f?.[_0x28e50c(0x285)]?.['listResponseMessage']?.[_0x28e50c(0x284)][_0x28e50c(0x269)]||_0x30098f['message']['listResponseMessage']?.[_0x28e50c(0x1eb)];return _0x30098f[_0x28e50c(0x285)]['senderKeyDistributionMessage'],(0x0,baileys_1[_0x28e50c(0x297)])(_0x105e40[Object[_0x28e50c(0x1ee)](_0x105e40)[_0x28e50c(0x237)]()[_0x28e50c(0x1dc)]()[_0x28e50c(0x160)]]);};exports[a561_0x810c34(0xff)]=getQuotedMessage;const getQuotedMessageId=_0x14a677=>{const _0x288626=a561_0x810c34,_0x292a72=(0x0,baileys_1['extractMessageContent'])(_0x14a677[_0x288626(0x285)])[Object[_0x288626(0x1ee)](_0x14a677?.[_0x288626(0x285)])[_0x288626(0x237)]()[_0x288626(0x1dc)]()['value']];let _0x3f8666=_0x14a677?.['message']?.['reactionMessage']?_0x14a677?.[_0x288626(0x285)]?.['reactionMessage']?.[_0x288626(0x2a6)]?.['id']:'';return _0x3f8666?_0x3f8666:_0x292a72?.[_0x288626(0x1eb)]?.[_0x288626(0x105)];};exports[a561_0x810c34(0x16e)]=getQuotedMessageId;const getMeSocket=_0x39fdf8=>{const _0x5df239=a561_0x810c34;return{'id':(0x0,baileys_1[_0x5df239(0x199)])(_0x39fdf8['user']['id']),'name':_0x39fdf8['user'][_0x5df239(0x29b)]};},getSenderMessage=(_0x32dbb1,_0xd1cbdc)=>{const _0x34f7bb=a561_0x810c34,_0x16428f=getMeSocket(_0xd1cbdc);if(_0x32dbb1[_0x34f7bb(0x2a6)][_0x34f7bb(0x1c9)])return _0x16428f['id'];const _0x1b87ae=_0x32dbb1['participant']||_0x32dbb1[_0x34f7bb(0x2a6)][_0x34f7bb(0x1f9)]||_0x32dbb1['key'][_0x34f7bb(0x2ba)]||undefined;return _0x1b87ae&&(0x0,baileys_1[_0x34f7bb(0x199)])(_0x1b87ae);},getContactMessage=async(_0x12837f,_0x428392)=>{const _0x3eeec0=a561_0x810c34,_0x1b3880=_0x12837f[_0x3eeec0(0x2a6)][_0x3eeec0(0x2ba)][_0x3eeec0(0x152)]('g.us'),_0x4980c3=_0x12837f[_0x3eeec0(0x2a6)][_0x3eeec0(0x2ba)][_0x3eeec0(0x2a0)](/\D/g,'');return _0x1b3880?{'id':getSenderMessage(_0x12837f,_0x428392),'name':_0x12837f[_0x3eeec0(0x23b)]}:{'id':_0x12837f[_0x3eeec0(0x2a6)][_0x3eeec0(0x2ba)],'name':_0x12837f[_0x3eeec0(0x2a6)][_0x3eeec0(0x1c9)]?_0x4980c3:_0x12837f[_0x3eeec0(0x23b)]};},getUnpackedMessage=_0x2373fb=>{const _0x579a83=a561_0x810c34;return _0x2373fb['message']?.[_0x579a83(0x15b)]?.['message']||_0x2373fb[_0x579a83(0x285)]?.[_0x579a83(0x1d6)]?.[_0x579a83(0x1eb)]?.[_0x579a83(0x161)]||_0x2373fb[_0x579a83(0x285)]?.[_0x579a83(0x131)]?.[_0x579a83(0x285)]||_0x2373fb[_0x579a83(0x285)]?.[_0x579a83(0x29a)]?.[_0x579a83(0x285)]||_0x2373fb[_0x579a83(0x285)]?.[_0x579a83(0x212)]?.[_0x579a83(0x285)]||_0x2373fb['message']?.[_0x579a83(0x131)]?.['message']||_0x2373fb[_0x579a83(0x285)]?.[_0x579a83(0x27d)]?.[_0x579a83(0x1f2)]||_0x2373fb[_0x579a83(0x285)]?.['templateMessage']?.[_0x579a83(0x206)]||_0x2373fb[_0x579a83(0x285)]?.[_0x579a83(0x27d)]?.[_0x579a83(0x247)]||_0x2373fb['message']?.[_0x579a83(0x1ad)]?.['header']||_0x2373fb['message']?.['highlyStructuredMessage']?.['hydratedHsm']?.[_0x579a83(0x1f2)]||_0x2373fb['message'];},getMessageMedia=_0x1176ec=>{const _0x4ebcbc=a561_0x810c34;return _0x1176ec?.[_0x4ebcbc(0x1a8)]||_0x1176ec?.[_0x4ebcbc(0x1da)]||_0x1176ec?.[_0x4ebcbc(0x257)]||_0x1176ec?.['stickerMessage']||_0x1176ec?.[_0x4ebcbc(0x25d)]||null;},downloadMedia=async _0x9b2c94=>{const _0x513696=a561_0x810c34,_0x5da19b=getUnpackedMessage(_0x9b2c94),_0x3234d4=getMessageMedia(_0x5da19b);if(!_0x3234d4)return null;const _0x34af57=_0x5da19b?.[_0x513696(0x25d)]?'document':_0x3234d4[_0x513696(0x1bb)][_0x513696(0x1e6)]('/')[0x0]['replace'](_0x513696(0x275),_0x513696(0x132))?_0x3234d4['mimetype'][_0x513696(0x1e6)]('/')[0x0][_0x513696(0x2a0)](_0x513696(0x275),_0x513696(0x132)):_0x3234d4[_0x513696(0x1bb)][_0x513696(0x1e6)]('/')[0x0];let _0xc40133,_0x4a5d5b=0x0;while(_0x4a5d5b<0xa&&!_0xc40133){try{_0x3234d4?.['directPath']&&(_0x3234d4['url']=''),_0xc40133=await(0x0,baileys_1['downloadContentFromMessage'])(_0x3234d4,_0x34af57);}catch(_0x4eee81){_0x4a5d5b+=0x1,await new Promise(_0x4cf09a=>{setTimeout(_0x4cf09a,0x3e8*_0x4a5d5b*0x2);}),logger_1['logger'][_0x513696(0x1e3)](_0x513696(0x195)+_0x4a5d5b+'\x20de\x20baixar\x20o\x20arquivo\x20'+_0x9b2c94?.[_0x513696(0x2a6)]?.['id']);}}if(!_0xc40133)throw new Error(_0x513696(0x10c));let _0x11e129=_0x5da19b?.[_0x513696(0x25d)]?.['fileName']||'';if(!_0x11e129){const _0x29458b=mime_1['default'][_0x513696(0x1d0)](_0x3234d4[_0x513696(0x1bb)]);_0x11e129=(0x0,MakeRandomId_1[_0x513696(0x154)])(0x5)+'-'+new Date()[_0x513696(0x15e)]()+'.'+_0x29458b;}else _0x11e129=_0x11e129['split']('.')[_0x513696(0x17b)](0x0,-0x1)['join']('.')+'.'+(0x0,MakeRandomId_1[_0x513696(0x154)])(0x5)+'.'+_0x11e129['split']('.')[_0x513696(0x17b)](-0x1);const _0x2edb8c=0x5*0x400*0x400/0x8,_0x4d25e4=0x400*0x400/0x8,_0x4cab5d=0x400*0x400,_0x87d873=new stream_throttle_1[(_0x513696(0x183))]({'rate':_0x2edb8c});let _0x4e0cd1=Buffer[_0x513696(0x13d)]([]),_0x158b35=0x0;const _0x39a26b=Date['now']();try{for await(const _0x2d4d33 of _0xc40133[_0x513696(0x197)](_0x87d873)){_0x4e0cd1=Buffer[_0x513696(0x249)]([_0x4e0cd1,_0x2d4d33]),_0x158b35+=_0x2d4d33[_0x513696(0x109)],_0x158b35>_0x4cab5d&&(_0x87d873[_0x513696(0x1c6)]=_0x4d25e4);}}catch(_0x2945c5){return{'data':_0x513696(0x255),'mimetype':'','filename':''};}const _0x2280ce=Date[_0x513696(0x17a)](),_0x4782e3=(_0x2280ce-_0x39a26b)/0x3e8,_0x4782e2=_0x158b35/_0x4782e3;logger_1['logger']['debug'](_0x11e129+_0x513696(0x112)+_0x4782e3[_0x513696(0x1df)](0x2)+_0x513696(0x28d)+(_0x4782e2/0x400/0x400)['toFixed'](0x2)+'\x20MBps');if(!_0x4e0cd1){Sentry['setExtra']('ERR_WAPP_DOWNLOAD_MEDIA',{'msg':_0x9b2c94}),Sentry[_0x513696(0x20e)](new Error(_0x513696(0x25c)));throw new Error(_0x513696(0x25c));}const _0x4b25d7={'data':_0x4e0cd1,'mimetype':_0x3234d4[_0x513696(0x1bb)],'filename':_0x11e129};return _0x4b25d7;},verifyContact=async(_0x3bd9c9,_0xc2b4b8,_0x3bd768)=>{const _0xe1cbbd=a561_0x810c34,_0x7db697={'name':_0x3bd9c9?.[_0xe1cbbd(0x29b)]||_0x3bd9c9['id'][_0xe1cbbd(0x2a0)](/\D/g,''),'number':_0x3bd9c9['id'][_0xe1cbbd(0x26e)](0x0,_0x3bd9c9['id'][_0xe1cbbd(0x28f)]('@')),'isGroup':_0x3bd9c9['id'][_0xe1cbbd(0x152)](_0xe1cbbd(0x2a4)),'companyId':_0x3bd768,'whatsappId':_0xc2b4b8['id']},_0x21d955=(0x0,CreateOrUpdateContactService_1[_0xe1cbbd(0x266)])(_0x7db697,_0xc2b4b8,_0x3bd9c9['id']);return _0x21d955;},verifyQuotedMessage=async _0xd5b48=>{const _0x58c520=a561_0x810c34;if(!_0xd5b48)return null;const _0x4dfffa=(0x0,exports[_0x58c520(0x16e)])(_0xd5b48);if(!_0x4dfffa)return null;const _0x16f077=await Message_1['default']['findOne']({'where':{'id':_0x4dfffa}});if(!_0x16f077)return null;return _0x16f077;};exports[a561_0x810c34(0x224)]=verifyQuotedMessage;const sanitizeName=_0x7956b4=>{const _0x196e3e=a561_0x810c34;let _0x2454b2=_0x7956b4[_0x196e3e(0x1e6)]('\x20')[0x0];return _0x2454b2=_0x2454b2[_0x196e3e(0x2a0)](/[^a-zA-Z0-9]/g,''),_0x2454b2[_0x196e3e(0x26e)](0x0,0x3c);},convertTextToSpeechAndSaveToFile=(_0x4ec18e,_0x59bb10,_0x5c0beb,_0x4c553f,_0x252e81=a561_0x810c34(0x298),_0x42543d='mp3')=>{return new Promise((_0x5e68ce,_0x4d67fd)=>{const _0x1f076a=a561_0x439c,_0xca554c=microsoft_cognitiveservices_speech_sdk_1[_0x1f076a(0x218)][_0x1f076a(0x1cb)](_0x5c0beb,_0x4c553f);_0xca554c[_0x1f076a(0x1c1)]=_0x252e81;const _0x5b0907=microsoft_cognitiveservices_speech_sdk_1[_0x1f076a(0x19a)][_0x1f076a(0x1db)](_0x59bb10+_0x1f076a(0x194)),_0x24b837=new microsoft_cognitiveservices_speech_sdk_1[(_0x1f076a(0x141))](_0xca554c,_0x5b0907);_0x24b837[_0x1f076a(0x221)](_0x4ec18e,_0x56f6a1=>{const _0x60e1fb=_0x1f076a;_0x56f6a1?convertWavToAnotherFormat(_0x59bb10+'.wav',_0x59bb10+'.'+_0x42543d,_0x42543d)['then'](_0x439a31=>{_0x5e68ce();})[_0x60e1fb(0x26f)](_0x33e3d9=>{const _0x173e08=_0x60e1fb;console[_0x173e08(0x255)](_0x33e3d9),_0x4d67fd(_0x33e3d9);}):_0x4d67fd(new Error('No\x20result\x20from\x20synthesizer')),_0x24b837['close']();},_0x2b5442=>{const _0x5cd40f=_0x1f076a;console[_0x5cd40f(0x255)](_0x5cd40f(0x17e)+_0x2b5442),_0x24b837[_0x5cd40f(0x281)](),_0x4d67fd(_0x2b5442);});});},convertWavToAnotherFormat=(_0xac4c89,_0x4f568c,_0x3187)=>{return new Promise((_0x5dc856,_0x48b189)=>{const _0x1faf52=a561_0x439c;(0x0,fluent_ffmpeg_1['default'])()[_0x1faf52(0x2ae)](_0xac4c89)[_0x1faf52(0x241)](_0x3187)['on'](_0x1faf52(0x1a5),()=>_0x5dc856(_0x4f568c))['on']('error',_0x4dbcec=>_0x48b189(new Error(_0x1faf52(0x2b1)+_0x4dbcec[_0x1faf52(0x285)])))['save'](_0x4f568c);});},deleteFileSync=_0x1fee1d=>{const _0x15290f=a561_0x810c34;try{fs_2[_0x15290f(0x266)][_0x15290f(0x121)](_0x1fee1d);}catch(_0x48bbb0){console[_0x15290f(0x255)](_0x15290f(0x1f6),_0x48bbb0);}},keepOnlySpecifiedChars=_0x2670b0=>{const _0x3d000c=a561_0x810c34;return _0x2670b0[_0x3d000c(0x2a0)](/[^a-zA-Z0-9áéíóúÁÉÍÓÚâêîôûÂÊÎÔÛãõÃÕçÇ!?.,;:\s]/g,'');},handleOpenAi=async(_0x21a926,_0x358159,_0x52cf04,_0x41937e,_0x8d489e)=>{const _0x32e758=a561_0x810c34,_0x59b036=(0x0,exports[_0x32e758(0x19e)])(_0x21a926);if(!_0x59b036)return;let {prompt:_0x269fb2}=await(0x0,ShowWhatsAppService_1[_0x32e758(0x266)])(_0x358159['id'],_0x52cf04[_0x32e758(0x293)]);!_0x269fb2&&!(0x0,lodash_1[_0x32e758(0x113)])(_0x52cf04?.[_0x32e758(0x1e0)]?.['prompt'])&&(_0x269fb2=_0x52cf04[_0x32e758(0x1e0)][_0x32e758(0x24f)]);if(!_0x269fb2)return;if(_0x21a926[_0x32e758(0x2b8)])return;const _0x58148f=path_1[_0x32e758(0x266)]['resolve'](__dirname,'..','..','..',_0x32e758(0x29f));let _0x2356f5;const _0x5ae055=sessionsOpenAi[_0x32e758(0x231)](_0x1ea708=>_0x1ea708['id']===_0x358159['id']);if(_0x5ae055===-0x1){const _0x599c09=new openai_1[(_0x32e758(0x2b2))]({'apiKey':_0x269fb2[_0x32e758(0x20d)]});_0x2356f5=new openai_1['OpenAIApi'](_0x599c09),_0x2356f5['id']=_0x358159['id'],sessionsOpenAi[_0x32e758(0x238)](_0x2356f5);}else _0x2356f5=sessionsOpenAi[_0x5ae055];const _0x53cc46=await Message_1[_0x32e758(0x266)][_0x32e758(0x18b)]({'where':{'ticketId':_0x52cf04['id']},'order':[[_0x32e758(0x145),_0x32e758(0x1c7)]],'limit':_0x269fb2[_0x32e758(0x1a1)]}),_0x16e808='Nas\x20respostas\x20utilize\x20o\x20nome\x20'+sanitizeName(_0x41937e[_0x32e758(0x29b)]||_0x32e758(0x1d3))+_0x32e758(0x234)+_0x269fb2[_0x32e758(0x233)]+_0x32e758(0x1f5)+_0x269fb2[_0x32e758(0x24f)]+'\x0a';let _0x5380e6=[];if(_0x21a926['message']?.[_0x32e758(0x1bc)]||_0x21a926['message']?.[_0x32e758(0x1d6)]?.[_0x32e758(0x146)]){_0x5380e6=[],_0x5380e6[_0x32e758(0x238)]({'role':'system','content':_0x16e808});for(let _0x12dc6c=0x0;_0x12dc6c<Math[_0x32e758(0x27b)](_0x269fb2[_0x32e758(0x1a1)],_0x53cc46['length']);_0x12dc6c++){const _0x3b9101=_0x53cc46[_0x12dc6c];_0x3b9101[_0x32e758(0x1e5)]===_0x32e758(0x244)&&(_0x3b9101[_0x32e758(0x1c9)]?_0x5380e6[_0x32e758(0x238)]({'role':_0x32e758(0x24e),'content':_0x3b9101[_0x32e758(0x159)]}):_0x5380e6[_0x32e758(0x238)]({'role':_0x32e758(0x10f),'content':_0x3b9101['body']}));}_0x5380e6['push']({'role':_0x32e758(0x10f),'content':_0x59b036});const _0x2dde66=await _0x2356f5[_0x32e758(0x23a)]({'model':'gpt-3.5-turbo-1106','messages':_0x5380e6,'max_tokens':_0x269fb2[_0x32e758(0x233)],'temperature':_0x269fb2[_0x32e758(0x245)]});let _0x12efed=_0x2dde66[_0x32e758(0x19d)][_0x32e758(0x259)][0x0]['message']?.['content'];_0x12efed?.['includes'](_0x32e758(0x1c3))&&(await transferQueue(_0x269fb2[_0x32e758(0x1f4)],_0x52cf04,_0x41937e),_0x12efed=_0x12efed[_0x32e758(0x2a0)]('Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','')[_0x32e758(0x136)]());if(_0x269fb2[_0x32e758(0x291)]==='texto'){const _0x4f0137=await _0x358159[_0x32e758(0x1c8)](_0x21a926[_0x32e758(0x2a6)]['remoteJid'],{'text':_0x12efed});await(0x0,exports[_0x32e758(0x143)])(_0x4f0137,_0x52cf04,_0x41937e);}else{const _0x37f25e=_0x52cf04['id']+'_'+Date['now']();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x12efed),_0x58148f+'/'+_0x37f25e,_0x269fb2[_0x32e758(0x29d)],_0x269fb2[_0x32e758(0x18a)],_0x269fb2[_0x32e758(0x291)],_0x32e758(0x24a))[_0x32e758(0x148)](async()=>{const _0x369816=_0x32e758;try{const _0x563c51=await _0x358159['sendMessage'](_0x21a926['key'][_0x369816(0x2ba)],{'audio':{'url':_0x58148f+'/'+_0x37f25e+_0x369816(0x223)},'mimetype':_0x369816(0x251),'ptt':!![]});await verifyMediaMessage(_0x563c51,_0x52cf04,_0x41937e),deleteFileSync(_0x58148f+'/'+_0x37f25e+_0x369816(0x223)),deleteFileSync(_0x58148f+'/'+_0x37f25e+'.wav');}catch(_0x13671b){console['log']('Erro\x20para\x20responder\x20com\x20audio:\x20'+_0x13671b);}});}}else{if(_0x21a926[_0x32e758(0x285)]?.['audioMessage']){const _0x14ac8f=_0x8d489e[_0x32e758(0x1a9)][_0x32e758(0x1e6)]('/')[_0x32e758(0x232)](),_0xc15b34=fs_2[_0x32e758(0x266)][_0x32e758(0x20c)](_0x58148f+'/'+_0x14ac8f),_0x305b9c=await _0x2356f5[_0x32e758(0x1e7)](_0xc15b34,_0x32e758(0x151));_0x5380e6=[],_0x5380e6[_0x32e758(0x238)]({'role':_0x32e758(0x1c5),'content':_0x16e808});for(let _0x160e08=0x0;_0x160e08<Math[_0x32e758(0x27b)](_0x269fb2[_0x32e758(0x1a1)],_0x53cc46['length']);_0x160e08++){const _0x23391d=_0x53cc46[_0x160e08];_0x23391d[_0x32e758(0x1e5)]===_0x32e758(0x244)&&(_0x23391d[_0x32e758(0x1c9)]?_0x5380e6[_0x32e758(0x238)]({'role':_0x32e758(0x24e),'content':_0x23391d[_0x32e758(0x159)]}):_0x5380e6[_0x32e758(0x238)]({'role':_0x32e758(0x10f),'content':_0x23391d[_0x32e758(0x159)]}));}_0x5380e6['push']({'role':'user','content':_0x305b9c[_0x32e758(0x19d)][_0x32e758(0x146)]});const _0x586c6b=await _0x2356f5[_0x32e758(0x23a)]({'model':_0x32e758(0x1ca),'messages':_0x5380e6,'max_tokens':_0x269fb2[_0x32e758(0x233)],'temperature':_0x269fb2[_0x32e758(0x245)]});let _0x4ef535=_0x586c6b[_0x32e758(0x19d)]['choices'][0x0][_0x32e758(0x285)]?.[_0x32e758(0x227)];_0x4ef535?.[_0x32e758(0x152)]('Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento')&&(await transferQueue(_0x269fb2[_0x32e758(0x1f4)],_0x52cf04,_0x41937e),_0x4ef535=_0x4ef535[_0x32e758(0x2a0)](_0x32e758(0x1c3),'')['trim']());if(_0x269fb2['voice']==='texto'){const _0x1518a2=await _0x358159[_0x32e758(0x1c8)](_0x21a926[_0x32e758(0x2a6)][_0x32e758(0x2ba)],{'text':_0x4ef535});await(0x0,exports[_0x32e758(0x143)])(_0x1518a2,_0x52cf04,_0x41937e);}else{const _0x444e84=_0x52cf04['id']+'_'+Date['now']();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x4ef535),_0x58148f+'/'+_0x444e84,_0x269fb2[_0x32e758(0x29d)],_0x269fb2[_0x32e758(0x18a)],_0x269fb2['voice'],_0x32e758(0x24a))[_0x32e758(0x148)](async()=>{const _0x47c1f6=_0x32e758;try{const _0x107aa5=await _0x358159[_0x47c1f6(0x1c8)](_0x21a926['key'][_0x47c1f6(0x2ba)],{'audio':{'url':_0x58148f+'/'+_0x444e84+_0x47c1f6(0x223)},'mimetype':_0x47c1f6(0x251),'ptt':!![]});await verifyMediaMessage(_0x107aa5,_0x52cf04,_0x41937e),deleteFileSync(_0x58148f+'/'+_0x444e84+_0x47c1f6(0x223)),deleteFileSync(_0x58148f+'/'+_0x444e84+_0x47c1f6(0x194));}catch(_0x686b08){console[_0x47c1f6(0x171)](_0x47c1f6(0x12c)+_0x686b08);}});}}}_0x5380e6=[];},transferQueue=async(_0x88022c,_0x4d085c,_0x1f6b0e)=>{const _0x49a50b=a561_0x810c34;console['trace'](_0x49a50b(0x235)),await(0x0,UpdateTicketService_1[_0x49a50b(0x266)])({'ticketData':{'queueId':_0x88022c,'useIntegration':![],'promptId':null},'ticketId':_0x4d085c['id'],'companyId':_0x4d085c[_0x49a50b(0x293)]});},verifyMediaMessage=async(_0x3fe2bf,_0x4f8e84,_0x25feb7)=>{const _0x398e18=a561_0x810c34,_0x165896=(0x0,socket_1['getIO'])();let _0x387a4d=await Message_1[_0x398e18(0x266)][_0x398e18(0x201)]({'where':{'id':_0x3fe2bf[_0x398e18(0x2a6)]['id']}});if(!_0x387a4d){const _0x94363a=await(0x0,exports[_0x398e18(0x224)])(_0x3fe2bf),_0x735d04=(0x0,wbot_1[_0x398e18(0x265)])(_0x4f8e84[_0x398e18(0x13c)]),_0x4b9303=await downloadMedia(_0x3fe2bf);if(!_0x4b9303)throw new Error(_0x398e18(0x25c));if(!_0x4b9303[_0x398e18(0x1bf)]){const _0x53c8aa=typeof _0x4b9303[_0x398e18(0x1bb)]===_0x398e18(0x25b)&&_0x4b9303['mimetype'][_0x398e18(0x152)]('/')&&_0x4b9303['mimetype']['includes'](';')?mime_1['default'][_0x398e18(0x1d0)](_0x4b9303['mimetype']):_0x398e18(0x1e2);_0x4b9303[_0x398e18(0x1bf)]=new Date()[_0x398e18(0x15e)]()+'.'+_0x53c8aa;}else{let _0x255017=_0x4b9303[_0x398e18(0x1bf)]?'-'+_0x4b9303[_0x398e18(0x1bf)]:'';_0x4b9303[_0x398e18(0x1bf)]=''+new Date()[_0x398e18(0x15e)]()+_0x255017;}try{const _0x38f3d6=_0x398e18(0x16f)+_0x4f8e84[_0x398e18(0x293)];!fs_2[_0x398e18(0x266)][_0x398e18(0x15d)](_0x38f3d6)&&(fs_2[_0x398e18(0x266)]['mkdirSync'](_0x38f3d6),fs_2[_0x398e18(0x266)][_0x398e18(0x129)](_0x38f3d6,0x1ff)),await writeFileAsync((0x0,path_1[_0x398e18(0x123)])(__dirname,'..','..','..',_0x38f3d6,_0x4b9303[_0x398e18(0x1bf)]),_0x4b9303[_0x398e18(0x19d)],'base64');}catch(_0x87b5e5){Sentry[_0x398e18(0x20e)](_0x87b5e5),logger_1[_0x398e18(0x11c)][_0x398e18(0x255)](_0x87b5e5);}const _0x1e809c=(0x0,exports[_0x398e18(0x19e)])(_0x3fe2bf);var _0x593b95=getTypeMessage(_0x3fe2bf);const _0x3554c9={'id':_0x3fe2bf[_0x398e18(0x2a6)]['id'],'ticketId':_0x4f8e84['id'],'contactId':_0x3fe2bf[_0x398e18(0x2a6)][_0x398e18(0x1c9)]?undefined:_0x25feb7['id'],'body':_0x1e809c?(0x0,Mustache_1[_0x398e18(0x266)])(_0x1e809c,_0x4f8e84):_0x4b9303[_0x398e18(0x1bf)],'fromMe':_0x3fe2bf[_0x398e18(0x2a6)][_0x398e18(0x1c9)],'read':_0x3fe2bf[_0x398e18(0x2a6)]['fromMe'],'mediaUrl':_0x4b9303[_0x398e18(0x1bf)],'mediaType':typeof _0x4b9303[_0x398e18(0x1bb)]===_0x398e18(0x25b)?_0x4b9303[_0x398e18(0x1bb)][_0x398e18(0x1e6)]('/')[0x0]:_0x398e18(0x1e2),'quotedMsgId':_0x94363a?.['id'],'ack':getStatus(_0x3fe2bf,_0x398e18(0x219)),'remoteJid':_0x3fe2bf['key'][_0x398e18(0x2ba)],'participant':_0x3fe2bf[_0x398e18(0x2a6)][_0x398e18(0x1f9)],'dataJson':JSON['stringify'](_0x3fe2bf)};var _0x2320ae=_0x1e809c||_0x4b9303[_0x398e18(0x1bf)];typeof _0x2320ae!='string'&&console[_0x398e18(0x122)](_0x398e18(0x1cc),_0x2320ae),await _0x4f8e84[_0x398e18(0x1e8)]({'lastMessage':_0x2320ae}),_0x387a4d=await(0x0,CreateMessageService_1[_0x398e18(0x266)])({'messageData':_0x3554c9,'ticket':_0x4f8e84,'companyId':_0x4f8e84[_0x398e18(0x293)]});}else typeof _0x387a4d[_0x398e18(0x159)]!=_0x398e18(0x25b)&&console[_0x398e18(0x122)](_0x398e18(0x1cc),_0x387a4d['body']),await _0x4f8e84['update']({'lastMessage':_0x387a4d['body']}),_0x387a4d[_0x398e18(0x268)]=getStatus(_0x3fe2bf,_0x398e18(0x219)),_0x387a4d[_0x398e18(0x1f9)]=_0x3fe2bf['key'][_0x398e18(0x1f9)],_0x387a4d[_0x398e18(0x236)]=JSON[_0x398e18(0x126)](_0x3fe2bf),await _0x387a4d[_0x398e18(0x13e)]();return!_0x3fe2bf[_0x398e18(0x2a6)]['fromMe']&&_0x4f8e84[_0x398e18(0x19c)]===_0x398e18(0x26a)&&(await _0x4f8e84[_0x398e18(0x1e8)]({'status':_0x398e18(0x178)}),await _0x4f8e84[_0x398e18(0x242)]({'include':[{'model':Queue_1['default'],'as':_0x398e18(0x1e0)},{'model':User_1['default'],'as':_0x398e18(0x10f)},{'model':Contact_1[_0x398e18(0x266)],'as':'contact'}]}),_0x165896['to'](_0x398e18(0x24c)+_0x4f8e84['companyId']+'-closed')[_0x398e18(0x270)](_0x398e18(0x24c)+_0x4f8e84['companyId']+_0x398e18(0x176),{'action':_0x398e18(0x240),'ticket':_0x4f8e84,'ticketId':_0x4f8e84['id']}),_0x165896['to']('company-'+_0x4f8e84['companyId']+'-'+_0x4f8e84[_0x398e18(0x19c)])['to'](_0x4f8e84['id']['toString']())[_0x398e18(0x270)]('company-'+_0x4f8e84[_0x398e18(0x293)]+_0x398e18(0x176),{'action':'update','ticket':_0x4f8e84,'ticketId':_0x4f8e84['id']})),_0x387a4d;};function getStatus(_0x3ff014,_0x2cfc89){const _0x260c44=a561_0x810c34;if(_0x3ff014[_0x260c44(0x19c)]==baileys_1[_0x260c44(0x1be)][_0x260c44(0x177)][_0x260c44(0x27c)][_0x260c44(0x28b)]){if(_0x3ff014[_0x260c44(0x2a6)][_0x260c44(0x1c9)]&&_0x2cfc89==_0x260c44(0x18c))return 0x3;return 0x1;}else{if(_0x3ff014[_0x260c44(0x19c)]==baileys_1[_0x260c44(0x1be)][_0x260c44(0x177)][_0x260c44(0x27c)][_0x260c44(0x21d)])return 0x1;else{if(_0x3ff014[_0x260c44(0x19c)]==baileys_1[_0x260c44(0x1be)]['WebMessageInfo'][_0x260c44(0x27c)][_0x260c44(0x128)])return 0x2;else{if(_0x3ff014['status']==baileys_1['proto'][_0x260c44(0x177)][_0x260c44(0x27c)][_0x260c44(0x16c)]||_0x3ff014[_0x260c44(0x19c)]==baileys_1[_0x260c44(0x1be)]['WebMessageInfo'][_0x260c44(0x27c)][_0x260c44(0x16d)])return 0x3;}}}return 0x0;}const verifyMessage=async(_0x4e2888,_0x5c55af,_0x2d9b57)=>{const _0x144171=a561_0x810c34,_0x172a69=(0x0,socket_1['getIO'])(),_0x2e05b2=await(0x0,exports[_0x144171(0x224)])(_0x4e2888),_0x540ff7=(0x0,exports['getBodyMessage'])(_0x4e2888);if(!_0x540ff7)return;let _0x416fb5=getTypeMessage(_0x4e2888);const _0xee00c6=_0x416fb5=='editedMessage'||_0x4e2888?.[_0x144171(0x285)]?.[_0x144171(0x1a0)]?.[_0x144171(0x1f7)]==baileys_1[_0x144171(0x1be)]['Message'][_0x144171(0x20b)][_0x144171(0x12e)][_0x144171(0x158)]||_0x4e2888?.[_0x144171(0x285)]?.[_0x144171(0x1a0)]?.['editedMessage']?.['conversation']?.[_0x144171(0x109)]>0x0;let _0x7b292f=_0x4e2888[_0x144171(0x2a6)]['id'];if(_0x416fb5=='protocolMessage')_0x7b292f=_0x4e2888?.[_0x144171(0x285)]?.[_0x144171(0x1a0)]?.[_0x144171(0x2a6)]?.['id']||_0x4e2888['key']['id'];else _0x416fb5==_0x144171(0x2b9)&&(_0x7b292f=_0x4e2888?.['message']?.[_0x144171(0x2b9)]?.[_0x144171(0x285)]?.['protocolMessage']?.['key']?.['id']||_0x4e2888[_0x144171(0x2a6)]['id']);const _0x3bbe14={'id':_0x7b292f,'ticketId':_0x5c55af['id'],'contactId':_0x4e2888[_0x144171(0x2a6)]['fromMe']?undefined:_0x2d9b57['id'],'body':_0x540ff7,'fromMe':_0x4e2888['key'][_0x144171(0x1c9)],'mediaType':_0x416fb5,'read':_0x4e2888['key'][_0x144171(0x1c9)],'quotedMsgId':_0x2e05b2?.['id'],'ack':getStatus(_0x4e2888,_0x416fb5),'remoteJid':_0x4e2888[_0x144171(0x2a6)]['remoteJid'],'participant':_0x4e2888[_0x144171(0x2a6)][_0x144171(0x1f9)],'dataJson':JSON[_0x144171(0x126)](_0x4e2888),'isEdited':_0xee00c6};typeof _0x540ff7!=_0x144171(0x25b)&&console[_0x144171(0x122)](_0x144171(0x1cc),_0x540ff7);await _0x5c55af['update']({'lastMessage':_0x540ff7});if(_0xee00c6){let _0x46fa38=await Message_1[_0x144171(0x266)][_0x144171(0x253)](_0x3bbe14['id']);if(_0x46fa38){const _0x59e0d3={'messageId':_0x3bbe14['id'],'body':_0x46fa38['body']};await OldMessage_1['default'][_0x144171(0x115)](_0x59e0d3);}else console['log'](_0x144171(0x1e1)+_0x3bbe14['id']);}await(0x0,CreateMessageService_1[_0x144171(0x266)])({'messageData':_0x3bbe14,'ticket':_0x5c55af,'companyId':_0x5c55af[_0x144171(0x293)]}),!_0x4e2888[_0x144171(0x2a6)][_0x144171(0x1c9)]&&_0x5c55af[_0x144171(0x19c)]==='closed'&&(await _0x5c55af[_0x144171(0x1e8)]({'status':'pending'}),await _0x5c55af[_0x144171(0x242)]({'include':[{'model':Queue_1['default'],'as':_0x144171(0x1e0)},{'model':User_1[_0x144171(0x266)],'as':'user'},{'model':Contact_1[_0x144171(0x266)],'as':'contact'}]}),_0x172a69['to'](_0x144171(0x24c)+_0x5c55af[_0x144171(0x293)]+_0x144171(0x27a))[_0x144171(0x270)](_0x144171(0x24c)+_0x5c55af['companyId']+'-ticket',{'action':_0x144171(0x240),'ticket':_0x5c55af,'ticketId':_0x5c55af['id']}),_0x172a69['to'](_0x144171(0x24c)+_0x5c55af[_0x144171(0x293)]+'-'+_0x5c55af[_0x144171(0x19c)])['to'](_0x5c55af['id'][_0x144171(0x164)]())['emit'](_0x144171(0x24c)+_0x5c55af[_0x144171(0x293)]+_0x144171(0x176),{'action':_0x144171(0x1e8),'ticket':_0x5c55af,'ticketId':_0x5c55af['id']}));};exports[a561_0x810c34(0x143)]=verifyMessage;const isValidMsg=_0xc60433=>{const _0x1f4887=a561_0x810c34;if(_0xc60433['key'][_0x1f4887(0x2ba)]===_0x1f4887(0x14b))return![];try{const _0x47103a=getTypeMessage(_0xc60433);if(!_0x47103a)return![];const _0x32a52a=_0x47103a==='conversation'||_0x47103a==='editedMessage'||_0x47103a==='extendedTextMessage'||_0x47103a===_0x1f4887(0x1da)||_0x47103a===_0x1f4887(0x257)||_0x47103a===_0x1f4887(0x157)||_0x47103a===_0x1f4887(0x27d)||_0x47103a===_0x1f4887(0x271)||_0x47103a===_0x1f4887(0x1ad)||_0x47103a===_0x1f4887(0x1a8)||_0x47103a===_0x1f4887(0x25d)||_0x47103a===_0x1f4887(0x15b)||_0x47103a==='stickerMessage'||_0x47103a===_0x1f4887(0x18e)||_0x47103a===_0x1f4887(0x1ec)||_0x47103a==='messageContextInfo'||_0x47103a===_0x1f4887(0x299)||_0x47103a==='liveLocationMessage'||_0x47103a===_0x1f4887(0x24b)||_0x47103a===_0x1f4887(0x25a)||_0x47103a==='mediaMessage'||_0x47103a==='contactsArrayMessage'||_0x47103a===_0x1f4887(0x18c)||_0x47103a==='ephemeralMessage'||_0x47103a===_0x1f4887(0x1a0)||_0x47103a===_0x1f4887(0x137)||_0x47103a===_0x1f4887(0x283)||_0x47103a===_0x1f4887(0x29a)||_0x47103a==='viewOnceMessageV2'||_0x47103a===_0x1f4887(0x179)||_0x47103a===_0x1f4887(0x114);return!_0x32a52a&&(logger_1['logger']['warn'](_0x1f4887(0x202)+_0x47103a+'\x0a'+JSON[_0x1f4887(0x126)](_0xc60433?.[_0x1f4887(0x285)])),Sentry[_0x1f4887(0x10d)](_0x1f4887(0x185),{'BodyMsg':_0xc60433['message'],'msg':_0xc60433,'msgType':_0x47103a}),Sentry[_0x1f4887(0x20e)](new Error(_0x1f4887(0x167)))),!!_0x32a52a;}catch(_0x51a10d){Sentry[_0x1f4887(0x10d)](_0x1f4887(0x229),{'msg':_0xc60433}),Sentry['captureException'](_0x51a10d);}return![];};exports[a561_0x810c34(0x21e)]=isValidMsg;const Push=_0x5273c4=>{const _0x452b07=a561_0x810c34;return _0x5273c4[_0x452b07(0x23b)];},verifyQueue=async(_0x5624bf,_0x3ce91c,_0x36a3bc,_0x412ce2,_0x57ef90)=>{const _0x15cd08=a561_0x810c34,_0x3ba5c1=_0x36a3bc[_0x15cd08(0x293)],{queues:_0x2d7b79,greetingMessage:_0x50bd6d,maxUseBotQueues:_0x5b6b9e,timeUseBotQueues:_0x5ad612}=await(0x0,ShowWhatsAppService_1['default'])(_0x5624bf['id'],_0x36a3bc['companyId']);if(_0x2d7b79[_0x15cd08(0x109)]===0x1){const _0x2602da=(0x0,lodash_1[_0x15cd08(0x1ae)])(_0x2d7b79);let _0x5b3cf9=![];_0x2602da?.[_0x15cd08(0x22f)]&&(_0x5b3cf9=_0x2602da[_0x15cd08(0x22f)][_0x15cd08(0x109)]>0x0);const _0x1e4e3f=await Setting_1['default'][_0x15cd08(0x201)]({'where':{'key':'sendGreetingMessageOneQueues','companyId':_0x36a3bc[_0x15cd08(0x293)]}});greetingMessageControl['push']({'ticketId':_0x36a3bc['id'],'greetingMessage':_0x50bd6d,'companyId':_0x3ba5c1});if(_0x50bd6d[_0x15cd08(0x109)]>0x1&&_0x1e4e3f?.['value']===_0x15cd08(0x216)){const _0x5010d4=await Message_1[_0x15cd08(0x266)][_0x15cd08(0x201)]({'where':{'ticketId':_0x36a3bc['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x15cd08(0x22d)]]:(0x0,moment_1[_0x15cd08(0x266)])()['subtract'](0x5,'minutes')[_0x15cd08(0x116)]()}}});if(_0x5010d4)return;const _0x26c8fa=(0x0,Mustache_1[_0x15cd08(0x266)])(''+_0x50bd6d,_0x36a3bc);await _0x5624bf['sendMessage'](_0x412ce2[_0x15cd08(0x192)]+'@'+(_0x36a3bc[_0x15cd08(0x200)]?_0x15cd08(0x2a4):_0x15cd08(0x1d4)),{'text':_0x26c8fa});}const _0x30a264=await(0x0,ShowWhatsAppService_1[_0x15cd08(0x266)])(_0x5624bf['id'],_0x3ba5c1),_0x16dab1=_0x2d7b79[0x0]?.[_0x15cd08(0x25f)]||_0x30a264[_0x15cd08(0x25f)];if(!_0x3ce91c[_0x15cd08(0x2a6)][_0x15cd08(0x1c9)]&&!_0x36a3bc[_0x15cd08(0x200)]&&!(0x0,lodash_1[_0x15cd08(0x113)])(_0x16dab1)){const _0x202bd3=await(0x0,ShowQueueIntegrationService_1['default'])(_0x16dab1,_0x3ba5c1);await(0x0,exports['handleMessageIntegration'])(_0x3ce91c,_0x5624bf,_0x202bd3,_0x36a3bc),await _0x36a3bc[_0x15cd08(0x1e8)]({'useIntegration':!![],'integrationId':_0x202bd3['id']});}const _0x4aafc5=_0x2d7b79[0x0]?.[_0x15cd08(0x282)]||_0x30a264[_0x15cd08(0x282)];!_0x3ce91c['key']['fromMe']&&!_0x36a3bc[_0x15cd08(0x200)]&&!(0x0,lodash_1[_0x15cd08(0x113)])(_0x4aafc5)&&(console[_0x15cd08(0x171)](_0x15cd08(0x250)),await handleOpenAi(_0x3ce91c,_0x5624bf,_0x36a3bc,_0x412ce2,_0x57ef90),await _0x36a3bc[_0x15cd08(0x1e8)]({'useIntegration':!![],'promptId':_0x4aafc5}));await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x2602da?.['id'],'chatbot':_0x5b3cf9,'status':_0x15cd08(0x178)},'ticketId':_0x36a3bc['id'],'companyId':_0x36a3bc['companyId']});return;}const _0x5d90a8=_0x3ce91c?.[_0x15cd08(0x285)]?.[_0x15cd08(0x18e)]?.[_0x15cd08(0x1cf)]||_0x3ce91c?.[_0x15cd08(0x285)]?.['listResponseMessage']?.[_0x15cd08(0x284)]?.[_0x15cd08(0x269)]||_0x3ce91c?.[_0x15cd08(0x285)]?.[_0x15cd08(0x1d6)]?.[_0x15cd08(0x146)]||_0x3ce91c?.[_0x15cd08(0x285)]?.[_0x15cd08(0x1bc)];let _0x6b7016=null;if(_0x5d90a8&&!(0x0,exports[_0x15cd08(0x187)])(_0x5d90a8)||+_0x5d90a8>_0x2d7b79[_0x15cd08(0x109)]){const _0x403c58=_0x5d90a8[_0x15cd08(0x147)]();for(let _0x45cb34 of _0x2d7b79){if(_0x45cb34[_0x15cd08(0x29b)][_0x15cd08(0x147)]()===_0x403c58){_0x6b7016=_0x45cb34;break;}if(_0x45cb34[_0x15cd08(0x2a1)]&&_0x45cb34[_0x15cd08(0x2a1)][_0x15cd08(0x109)]>0x0){let _0x4301ee=_0x45cb34[_0x15cd08(0x2a1)][_0x15cd08(0x1e6)](',\x20');for(let _0x1c3252 of _0x4301ee){if(_0x1c3252[_0x15cd08(0x147)]()==_0x403c58){_0x6b7016=_0x45cb34;break;}}}}}else _0x6b7016=_0x2d7b79[+_0x5d90a8-0x1];const _0x2ed677=await Setting_1['default']['findOne']({'where':{'key':_0x15cd08(0x15a),'companyId':_0x3ba5c1}}),_0x9da389=async()=>{const _0x1278aa=_0x15cd08;let _0x2d6fb7='';if(outOfHourMessageControl['length']>0x1388)outOfHourMessageControl=[];_0x2d7b79['forEach']((_0x40a398,_0x2b84f6)=>{const _0x134f15=a561_0x439c;_0x2d6fb7+=_0x134f15(0x290)+(_0x2b84f6+0x1)+'\x20]*\x20-\x20'+_0x40a398['name']+'\x0a';});if(process[_0x1278aa(0x101)][_0x1278aa(0x27e)]?.[_0x1278aa(0x109)]>=0x8){if(_0x36a3bc[_0x1278aa(0x193)][_0x1278aa(0x192)]!=process['env'][_0x1278aa(0x27e)]){console[_0x1278aa(0x122)](_0x1278aa(0x1b3));return;}}const _0x3ffc88={'text':(0x0,Mustache_1['default'])('‎'+_0x50bd6d+'\x0a\x0a'+_0x2d6fb7,_0x36a3bc)};await(0x0,UpdateTicketService_1[_0x1278aa(0x266)])({'ticketData':{'amountUsedBotQueues':_0x36a3bc[_0x1278aa(0x1fb)]+0x1},'ticketId':_0x36a3bc['id'],'companyId':_0x36a3bc[_0x1278aa(0x293)]});const _0x292660=await _0x5624bf[_0x1278aa(0x1c8)](_0x412ce2[_0x1278aa(0x192)]+'@'+(_0x36a3bc[_0x1278aa(0x200)]?_0x1278aa(0x2a4):_0x1278aa(0x1d4)),_0x3ffc88);await(0x0,exports['verifyMessage'])(_0x292660,_0x36a3bc,_0x36a3bc[_0x1278aa(0x193)]);};if(_0x6b7016){let _0xfd5d73=![];_0x6b7016?.['options']&&(_0xfd5d73=_0x6b7016['options'][_0x15cd08(0x109)]>0x0);await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x6b7016['id'],'chatbot':_0xfd5d73,'status':_0x15cd08(0x178),'amountUsedBotQueues':0x0},'ticketId':_0x36a3bc['id'],'companyId':_0x36a3bc[_0x15cd08(0x293)]}),console[_0x15cd08(0x122)](_0x6b7016['options']);if(_0x6b7016[_0x15cd08(0x22f)]['length']===0x0){const _0xb0e2f7=await Queue_1['default'][_0x15cd08(0x253)](_0x6b7016['id']),{schedules:_0x2c2977}=_0xb0e2f7,_0x44e8bc=(0x0,moment_1['default'])(),_0x46593f=_0x44e8bc['format']('dddd')[_0x15cd08(0x147)]();let _0x54244f;Array[_0x15cd08(0x210)](_0x2c2977)&&_0x2c2977[_0x15cd08(0x109)]>0x0&&(_0x54244f=_0x2c2977['find'](_0x3db4b5=>_0x3db4b5[_0x15cd08(0x280)]===_0x46593f&&_0x3db4b5[_0x15cd08(0x294)]!==''&&_0x3db4b5['startTime']!==null&&_0x3db4b5[_0x15cd08(0x248)]!==''&&_0x3db4b5['endTime']!==null));if(_0xb0e2f7[_0x15cd08(0x272)]!==null&&_0xb0e2f7['outOfHoursMessage']!==''&&!(0x0,lodash_1['isNil'])(_0x54244f)){var _0x1d0006=outOfHourMessageControl['find'](_0x31c3c4=>_0x31c3c4['ticketId']===_0x36a3bc['id']||_0x31c3c4['dest']===_0x412ce2[_0x15cd08(0x192)]);if(!_0x1d0006||_0x1d0006&&_0x1d0006[_0x15cd08(0x1ba)]+0x3e8*0x3c*0x5<new Date()[_0x15cd08(0x15e)]()){_0x1d0006&&(outOfHourMessageControl=outOfHourMessageControl['filter'](_0x33761f=>_0x33761f['ticketId']!==_0x36a3bc['id']),_0x1d0006=null);const _0x113a45=(0x0,moment_1[_0x15cd08(0x266)])(_0x54244f[_0x15cd08(0x294)],_0x15cd08(0x103)),_0x33e4fa=(0x0,moment_1[_0x15cd08(0x266)])(_0x54244f[_0x15cd08(0x248)],'HH:mm');outOfHourMessageControl[_0x15cd08(0x238)]({'ticketId':_0x36a3bc['id'],'time':new Date()['getTime']()});if(_0x44e8bc[_0x15cd08(0x162)](_0x113a45)||_0x44e8bc['isAfter'](_0x33e4fa)){const _0x504ae4=(0x0,Mustache_1[_0x15cd08(0x266)])('‎\x20'+_0xb0e2f7[_0x15cd08(0x272)]+_0x15cd08(0x2a3),_0x36a3bc),_0x382678=await _0x5624bf['sendMessage'](_0x412ce2[_0x15cd08(0x192)]+'@'+(_0x36a3bc[_0x15cd08(0x200)]?'g.us':'s.whatsapp.net'),{'text':_0x504ae4});await(0x0,exports[_0x15cd08(0x143)])(_0x382678,_0x36a3bc,_0x412ce2),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null,'chatbot':_0xfd5d73},'ticketId':_0x36a3bc['id'],'companyId':_0x36a3bc[_0x15cd08(0x293)]}),console[_0x15cd08(0x171)](_0x15cd08(0x1d5));return;}}!_0x1d0006&&outOfHourMessageControl['push']({'ticketId':_0x36a3bc['id'],'dest':_0x412ce2['number'],'time':new Date()[_0x15cd08(0x15e)]()});}console[_0x15cd08(0x122)](_0x6b7016[_0x15cd08(0x25f)]);if(!_0x3ce91c[_0x15cd08(0x2a6)][_0x15cd08(0x1c9)]&&!_0x36a3bc[_0x15cd08(0x200)]&&_0x6b7016[_0x15cd08(0x25f)]){const _0x2a41da=await(0x0,ShowQueueIntegrationService_1[_0x15cd08(0x266)])(_0x6b7016['integrationId'],_0x3ba5c1);await(0x0,exports['handleMessageIntegration'])(_0x3ce91c,_0x5624bf,_0x2a41da,_0x36a3bc),await _0x36a3bc['update']({'useIntegration':!![],'integrationId':_0x2a41da['id']});}!_0x3ce91c[_0x15cd08(0x2a6)]['fromMe']&&!_0x36a3bc[_0x15cd08(0x200)]&&!(0x0,lodash_1[_0x15cd08(0x113)])(_0x6b7016?.[_0x15cd08(0x282)])&&(await handleOpenAi(_0x3ce91c,_0x5624bf,_0x36a3bc,_0x412ce2,_0x57ef90),await _0x36a3bc['update']({'useIntegration':!![],'promptId':_0x6b7016?.['promptId']}));const _0x3ea20f=(0x0,Mustache_1[_0x15cd08(0x266)])('‎'+_0x6b7016[_0x15cd08(0x21b)],_0x36a3bc);if(_0x6b7016[_0x15cd08(0x21b)]){const _0x4859dd=await _0x5624bf[_0x15cd08(0x1c8)](_0x412ce2[_0x15cd08(0x192)]+'@'+(_0x36a3bc['isGroup']?_0x15cd08(0x2a4):_0x15cd08(0x1d4)),{'text':_0x3ea20f});await(0x0,exports[_0x15cd08(0x143)])(_0x4859dd,_0x36a3bc,_0x412ce2);if(_0x6b7016[_0x15cd08(0x1ed)]!==null&&_0x6b7016[_0x15cd08(0x1ed)]!==''){const _0x5b1ec4=path_1[_0x15cd08(0x266)][_0x15cd08(0x207)]('public','company'+_0x6b7016[_0x15cd08(0x293)],_0x6b7016['mediaPath']),_0x268318=await(0x0,SendWhatsAppMedia_1[_0x15cd08(0x1b6)])(_0x6b7016[_0x15cd08(0x296)],_0x5b1ec4,null,_0x36a3bc[_0x15cd08(0x293)]);let _0x42178a=await _0x5624bf[_0x15cd08(0x1c8)](_0x36a3bc[_0x15cd08(0x193)][_0x15cd08(0x192)]+'@'+(_0x36a3bc[_0x15cd08(0x200)]?_0x15cd08(0x2a4):_0x15cd08(0x1d4)),{..._0x268318});await verifyMediaMessage(_0x42178a,_0x36a3bc,_0x412ce2);}}}}else{if(_0x5b6b9e&&_0x5b6b9e!==0x0&&_0x36a3bc[_0x15cd08(0x1fb)]>=_0x5b6b9e)return;const _0x33c5db=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x36a3bc['id'],'companyId':_0x3ba5c1});let _0xd1c73=new Date(),_0x2049c7=new Date();if(_0x33c5db[_0x15cd08(0x163)]!==null){_0xd1c73[_0x15cd08(0x204)](_0x33c5db[_0x15cd08(0x163)][_0x15cd08(0x100)]()+Number(_0x5ad612));if(_0x33c5db['chatbotAt']!==null&&_0x2049c7<_0xd1c73&&_0x5ad612!=='0'&&_0x36a3bc[_0x15cd08(0x1fb)]!==0x0)return;}await _0x33c5db[_0x15cd08(0x1e8)]({'updatedAt':new Date()});if(_0x2ed677['value']===_0x15cd08(0x146))return console[_0x15cd08(0x122)](_0x15cd08(0x12a)),_0x9da389();}},verifyRating=_0x5c44ea=>{const _0x39b840=a561_0x810c34;return _0x5c44ea&&_0x5c44ea[_0x39b840(0x23d)]===null&&_0x5c44ea[_0x39b840(0x16b)]!==null&&_0x5c44ea[_0x39b840(0x1ef)]!==null;};exports[a561_0x810c34(0x118)]=verifyRating;const handleRating=async(_0x17a0f1,_0x15755a,_0x315759)=>{const _0x3881b5=a561_0x810c34,_0x15e7b1=(0x0,socket_1[_0x3881b5(0x18f)])();let _0x396dca=null;(_0x17a0f1?.[_0x3881b5(0x285)]?.[_0x3881b5(0x1bc)]||_0x17a0f1?.[_0x3881b5(0x285)]?.[_0x3881b5(0x1d6)])&&(_0x396dca=parseInt(_0x17a0f1['message'][_0x3881b5(0x1bc)]||_0x17a0f1['message'][_0x3881b5(0x1d6)]['text'],0xa)||null);if(!Number['isNaN'](_0x396dca)&&Number[_0x3881b5(0x2aa)](_0x396dca)&&!(0x0,lodash_1['isNull'])(_0x396dca)){const {complationMessage:_0x19881b}=await(0x0,ShowWhatsAppService_1['default'])(_0x15755a[_0x3881b5(0x13c)],_0x15755a[_0x3881b5(0x293)]);let _0x54b4fa=_0x396dca;_0x396dca<0x1&&(_0x54b4fa=0x1);_0x396dca>0x5&&(_0x54b4fa=0x5);await UserRating_1['default'][_0x3881b5(0x18d)]({'ticketId':_0x315759[_0x3881b5(0x1cd)],'companyId':_0x315759['companyId'],'userId':_0x315759[_0x3881b5(0x16b)],'rate':_0x54b4fa});if(_0x19881b){if(completionMessageControl[_0x3881b5(0x109)]>=0x9c4)completionMessageControl=[];var _0x357704=completionMessageControl[_0x3881b5(0x286)](_0x4c971d=>_0x4c971d[_0x3881b5(0x1cd)]===_0x15755a['id']||_0x4c971d[_0x3881b5(0x134)]===_0x15755a[_0x3881b5(0x193)][_0x3881b5(0x192)]);if(!_0x357704||_0x357704&&_0x357704['time']+0x3e8*0x3c*0x1e<new Date()['getTime']()){_0x357704&&(completionMessageControl=completionMessageControl[_0x3881b5(0x181)](_0x21328c=>_0x21328c[_0x3881b5(0x1cd)]!==_0x15755a['id']),_0x357704=null);const _0x1d99c2=(0x0,Mustache_1[_0x3881b5(0x266)])('‎'+_0x19881b,_0x15755a);await(0x0,SendPresenceStatus_1[_0x3881b5(0x279)])((0x0,wbot_1[_0x3881b5(0x265)])(_0x15755a[_0x3881b5(0x13c)]),_0x15755a[_0x3881b5(0x193)]['number']+'@'+(_0x15755a[_0x3881b5(0x200)]?'g.us':_0x3881b5(0x1d4))),await(0x0,SendWhatsAppMessage_1[_0x3881b5(0x266)])({'body':_0x1d99c2,'ticket':_0x15755a});}!_0x357704&&completionMessageControl[_0x3881b5(0x238)]({'ticketId':_0x15755a['id'],'dest':_0x15755a[_0x3881b5(0x193)][_0x3881b5(0x192)],'time':new Date()[_0x3881b5(0x15e)]()});}await _0x315759[_0x3881b5(0x1e8)]({'finishedAt':(0x0,moment_1['default'])()['toDate'](),'ratedAt':(0x0,moment_1[_0x3881b5(0x266)])()[_0x3881b5(0x116)](),'rated':!![]}),await _0x15755a[_0x3881b5(0x1e8)]({'queueId':null,'chatbot':null,'queueOptionId':null,'userId':null,'status':'closed'}),_0x15e7b1['to'](_0x3881b5(0x24c)+_0x15755a[_0x3881b5(0x293)]+_0x3881b5(0x22e))[_0x3881b5(0x270)](_0x3881b5(0x24c)+_0x15755a[_0x3881b5(0x293)]+'-ticket',{'action':'delete','ticket':_0x15755a,'ticketId':_0x15755a['id']}),_0x15e7b1['to'](_0x3881b5(0x24c)+_0x15755a['companyId']+'-'+_0x15755a[_0x3881b5(0x19c)])['to'](_0x15755a['id'][_0x3881b5(0x164)]())[_0x3881b5(0x270)](_0x3881b5(0x24c)+_0x15755a[_0x3881b5(0x293)]+'-ticket',{'action':'update','ticket':_0x15755a,'ticketId':_0x15755a['id']});}};exports['handleRating']=handleRating;const handleChartbot=async(_0x1723d1,_0x68991c,_0x621bcd,_0x363d66,_0x356a3f=![])=>{const _0x41966a=a561_0x810c34;if(!_0x1723d1[_0x41966a(0x193)][_0x41966a(0x2b5)]){const _0x4b9adb=await Queue_1[_0x41966a(0x266)]['findByPk'](_0x1723d1['queueId'],{'include':[{'model':QueueOption_1[_0x41966a(0x266)],'as':_0x41966a(0x22f),'where':{'parentId':null},'order':[[_0x41966a(0x22b),_0x41966a(0x1c7)],[_0x41966a(0x145),_0x41966a(0x1c7)]]}]}),_0xfcb1db=_0x68991c?.[_0x41966a(0x285)]?.[_0x41966a(0x18e)]?.[_0x41966a(0x1cf)]||_0x68991c?.[_0x41966a(0x285)]?.[_0x41966a(0x137)]?.['singleSelectReply']?.[_0x41966a(0x269)]||_0x68991c?.['message']?.['extendedTextMessage']?.[_0x41966a(0x146)]||_0x68991c?.[_0x41966a(0x285)]?.[_0x41966a(0x1bc)];if(_0xfcb1db=='#'&&(!_0x1723d1[_0x41966a(0x16b)]||_0x1723d1[_0x41966a(0x19c)]==_0x41966a(0x178))){console[_0x41966a(0x122)]('##\x20if'),await _0x1723d1[_0x41966a(0x1e8)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x621bcd,_0x68991c,_0x1723d1,_0x1723d1[_0x41966a(0x193)]);return;}if(!(0x0,lodash_1[_0x41966a(0x113)])(_0x4b9adb)&&!(0x0,lodash_1[_0x41966a(0x113)])(_0x1723d1[_0x41966a(0x1b2)])&&_0xfcb1db=='0'){console[_0x41966a(0x122)]('primeiro\x20if');const _0x969034=await QueueOption_1['default'][_0x41966a(0x253)](_0x1723d1[_0x41966a(0x1b2)]);await _0x1723d1[_0x41966a(0x1e8)]({'queueOptionId':_0x969034?.[_0x41966a(0x273)],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1[_0x41966a(0x113)])(_0x4b9adb)&&!(0x0,lodash_1[_0x41966a(0x113)])(_0x1723d1[_0x41966a(0x1b2)])){console['trace']('segundo\x20if');const _0x482885=await QueueOption_1[_0x41966a(0x266)]['count']({'where':{'parentId':_0x1723d1[_0x41966a(0x1b2)]}});let _0x54d275={};_0x482885==0x1?_0x54d275=await QueueOption_1[_0x41966a(0x266)][_0x41966a(0x201)]({'where':{'parentId':_0x1723d1[_0x41966a(0x1b2)]}}):(console[_0x41966a(0x122)]('terceiro\x20if'),_0x54d275=await QueueOption_1['default'][_0x41966a(0x201)]({'where':{[sequelize_1['Op']['or']]:[{'option':_0xfcb1db||''},{'title':_0xfcb1db||''}],'parentId':_0x1723d1[_0x41966a(0x1b2)]}})),_0x54d275&&await _0x1723d1[_0x41966a(0x1e8)]({'queueOptionId':_0x54d275?.['id'],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1[_0x41966a(0x113)])(_0x4b9adb)&&(0x0,lodash_1[_0x41966a(0x113)])(_0x1723d1[_0x41966a(0x1b2)])&&!_0x356a3f){console['trace']('quarto\x20if');const _0x45937e=_0x4b9adb?.['options'][_0x41966a(0x286)](_0x387e28=>_0x387e28[_0x41966a(0x22b)]==_0xfcb1db||_0x387e28[_0x41966a(0x261)][_0x41966a(0x147)]()==_0xfcb1db[_0x41966a(0x147)]());if(_0x45937e)await _0x1723d1['update']({'queueOptionId':_0x45937e?.['id'],'amountUsedBotQueues':0x0});else{if(_0x363d66[_0x41966a(0x278)]&&_0x363d66['maxUseBotQueues']!==0x0&&_0x1723d1[_0x41966a(0x1fb)]>=_0x363d66[_0x41966a(0x278)])return;await _0x1723d1[_0x41966a(0x1e8)]({'amountUsedBotQueues':_0x1723d1[_0x41966a(0x1fb)]+0x1});}}else{if(_0x363d66['maxUseBotQueues']&&_0x363d66['maxUseBotQueues']!==0x0&&_0x1723d1[_0x41966a(0x1fb)]>=_0x363d66[_0x41966a(0x278)])return;await _0x1723d1[_0x41966a(0x1e8)]({'amountUsedBotQueues':_0x1723d1[_0x41966a(0x1fb)]+0x1});}}}await _0x1723d1[_0x41966a(0x242)]();if(!(0x0,lodash_1['isNil'])(_0x4b9adb)&&(0x0,lodash_1[_0x41966a(0x113)])(_0x1723d1[_0x41966a(0x1b2)])){const _0x3b088e=await QueueOption_1[_0x41966a(0x266)][_0x41966a(0x18b)]({'where':{'queueId':_0x1723d1[_0x41966a(0x1f4)],'parentId':null},'order':[['option',_0x41966a(0x1c7)],[_0x41966a(0x145),_0x41966a(0x1c7)]]}),_0x4ff19b=_0x1723d1[_0x41966a(0x293)],_0x3c4956=await Setting_1[_0x41966a(0x266)]['findOne']({'where':{'key':_0x41966a(0x15a),'companyId':_0x4ff19b}}),_0x3396fc=async()=>{const _0x2d01d3=_0x41966a,_0x20d73c=[];_0x3b088e[_0x2d01d3(0x124)]((_0x520f68,_0x28c89a)=>{const _0xcd2715=_0x2d01d3;_0x20d73c[_0xcd2715(0x238)]({'buttonId':''+_0x520f68[_0xcd2715(0x22b)],'buttonText':{'displayText':_0x520f68[_0xcd2715(0x261)]},'type':0x4});}),_0x20d73c[_0x2d01d3(0x238)]({'buttonId':'#','buttonText':{'displayText':_0x2d01d3(0x111)},'type':0x4});const _0x3f4658={'text':(0x0,Mustache_1[_0x2d01d3(0x266)])('‎'+_0x4b9adb[_0x2d01d3(0x21b)],_0x1723d1),'buttons':_0x20d73c,'footer':'DAUMZAP','headerType':0x1},_0x1db39d=await _0x621bcd[_0x2d01d3(0x1c8)](_0x1723d1[_0x2d01d3(0x193)][_0x2d01d3(0x192)]+'@'+(_0x1723d1['isGroup']?_0x2d01d3(0x2a4):'s.whatsapp.net'),_0x3f4658);await(0x0,exports['verifyMessage'])(_0x1db39d,_0x1723d1,_0x1723d1[_0x2d01d3(0x193)]);},_0xadd487=async()=>{const _0x6083fe=_0x41966a;let _0x54c1e6='';console['trace'](_0x6083fe(0x12a)),console['log'](_0x4b9adb[_0x6083fe(0x1ed)]),_0x3b088e['forEach']((_0x35862b,_0x32a7f7)=>{const _0x2a829a=_0x6083fe;_0x54c1e6+=_0x2a829a(0x290)+_0x35862b[_0x2a829a(0x22b)]+_0x2a829a(0x125)+_0x35862b[_0x2a829a(0x261)]+'\x0a';}),_0x54c1e6+='\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial';const _0x41da34={'text':(0x0,Mustache_1['default'])('‎'+_0x4b9adb['greetingMessage']+'\x0a\x0a'+_0x54c1e6,_0x1723d1)};let _0x2b6619;if(!_0x4b9adb[_0x6083fe(0x1ed)])_0x2b6619=await _0x621bcd[_0x6083fe(0x1c8)](_0x1723d1[_0x6083fe(0x193)][_0x6083fe(0x192)]+'@'+(_0x1723d1[_0x6083fe(0x200)]?_0x6083fe(0x2a4):_0x6083fe(0x1d4)),_0x41da34),await(0x0,exports['verifyMessage'])(_0x2b6619,_0x1723d1,_0x1723d1[_0x6083fe(0x193)]);else{const _0x1d8c95=path_1['default']['resolve'](_0x6083fe(0x29f),_0x6083fe(0x184)+_0x1723d1[_0x6083fe(0x293)],_0x4b9adb[_0x6083fe(0x1ed)]),_0x1c6a36=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x41da34['text'],_0x1d8c95,_0x41da34['text'],_0x1723d1['companyId']);_0x2b6619=await _0x621bcd['sendMessage'](_0x1723d1[_0x6083fe(0x193)][_0x6083fe(0x192)]+'@'+(_0x1723d1[_0x6083fe(0x200)]?_0x6083fe(0x2a4):_0x6083fe(0x1d4)),{..._0x1c6a36}),await verifyMediaMessage(_0x2b6619,_0x1723d1,_0x1723d1[_0x6083fe(0x193)]);}};if(_0x3c4956[_0x41966a(0x160)]===_0x41966a(0x1ab)&&QueueOption_1[_0x41966a(0x266)][_0x41966a(0x109)]<=0x4)return _0x3396fc();if(_0x3c4956[_0x41966a(0x160)]==='text')return console[_0x41966a(0x122)](_0x41966a(0x12a)),_0xadd487();if(_0x3c4956[_0x41966a(0x160)]===_0x41966a(0x1ab)&&QueueOption_1[_0x41966a(0x266)][_0x41966a(0x109)]>0x4)return console[_0x41966a(0x122)]('botText'),_0xadd487();}else{if(!(0x0,lodash_1[_0x41966a(0x113)])(_0x4b9adb)&&!(0x0,lodash_1[_0x41966a(0x113)])(_0x1723d1['queueOptionId'])){const _0x198d8f=await QueueOption_1['default'][_0x41966a(0x253)](_0x1723d1[_0x41966a(0x1b2)]),_0x316c22=await QueueOption_1[_0x41966a(0x266)]['findAll']({'where':{'parentId':_0x1723d1['queueOptionId']},'order':[[_0x41966a(0x22b),'ASC'],[_0x41966a(0x145),_0x41966a(0x1c7)]]});if(_0x316c22[_0x41966a(0x109)]===0x0){const _0x42e647={'text':(0x0,Mustache_1[_0x41966a(0x266)])('‎'+_0x198d8f[_0x41966a(0x285)],_0x1723d1)},_0x226a1a=await _0x621bcd[_0x41966a(0x1c8)](_0x1723d1[_0x41966a(0x193)]['number']+'@'+(_0x1723d1[_0x41966a(0x200)]?_0x41966a(0x2a4):_0x41966a(0x1d4)),_0x42e647);await(0x0,exports[_0x41966a(0x143)])(_0x226a1a,_0x1723d1,_0x1723d1[_0x41966a(0x193)]),await _0x1723d1[_0x41966a(0x1e8)]({'queueOptionId':null,'chatbot':![]});return;}if(_0x316c22[_0x41966a(0x109)]>-0x1){const _0x2b0835=_0x1723d1[_0x41966a(0x293)],_0x2cea71=await Setting_1[_0x41966a(0x266)][_0x41966a(0x201)]({'where':{'key':_0x41966a(0x15a),'companyId':_0x2b0835}}),_0x10f2d6=async()=>{const _0x1f8edc=_0x41966a,_0x4d9040=[],_0x2f3b37=_0x1723d1[_0x1f8edc(0x293)],_0x4f54f5=await getQueues(_0x2f3b37),_0x50aa03=await getContactFromTicket(_0x1723d1['id']);_0x4f54f5[_0x1f8edc(0x124)]((_0x4d2b66,_0x216661)=>{const _0x871266=_0x1f8edc;_0x4d9040[_0x871266(0x238)]({'title':'['+(_0x216661+0x1)+_0x871266(0x1f8)+_0x4d2b66[_0x871266(0x29b)],'rowId':''+(_0x216661+0x1)});});const _0x4b8a73=[{'rows':_0x4d9040}],_0x2bc053={'text':(0x0,Mustache_1[_0x1f8edc(0x266)])('‎'+_0x198d8f[_0x1f8edc(0x285)],_0x1723d1),'title':_0x1f8edc(0x10b),'buttonText':_0x1f8edc(0x16a),'sections':_0x4b8a73};await sleep(0x3e8);const _0x1736d0=await _0x621bcd[_0x1f8edc(0x1c8)](_0x1f8edc(0x14e)+_0x50aa03[_0x1f8edc(0x192)]+'@'+(_0x1723d1[_0x1f8edc(0x200)]?_0x1f8edc(0x2a4):_0x1f8edc(0x1d4)),_0x2bc053);await(0x0,exports[_0x1f8edc(0x143)])(_0x1736d0,_0x1723d1,_0x1723d1[_0x1f8edc(0x193)]);},_0xb95888=async()=>{const _0x5b46a5=_0x41966a,_0x4746c9=[];_0x316c22['forEach']((_0x395983,_0x35230f)=>{const _0x28b686=a561_0x439c;_0x4746c9[_0x28b686(0x238)]({'buttonId':''+_0x395983[_0x28b686(0x22b)],'buttonText':{'displayText':_0x395983['title']},'type':0x4});}),_0x4746c9[_0x5b46a5(0x238)]({'buttonId':'#','buttonText':{'displayText':_0x5b46a5(0x111)},'type':0x4});const _0x4b5c0e={'text':(0x0,Mustache_1[_0x5b46a5(0x266)])('‎'+_0x198d8f[_0x5b46a5(0x285)],_0x1723d1),'buttons':_0x4746c9,'headerType':0x4};if(process[_0x5b46a5(0x101)][_0x5b46a5(0x27e)]?.[_0x5b46a5(0x109)]>=0x8){if(_0x1723d1[_0x5b46a5(0x193)]['number']!=process['env'][_0x5b46a5(0x27e)]){console[_0x5b46a5(0x122)]('chatbot\x20desativado!');return;}}if(!_0x198d8f[_0x5b46a5(0x1ed)]){const _0x7bc905=await _0x621bcd['sendMessage'](_0x1723d1[_0x5b46a5(0x193)][_0x5b46a5(0x192)]+'@'+(_0x1723d1['isGroup']?'g.us':_0x5b46a5(0x1d4)),_0x4b5c0e);await(0x0,exports['verifyMessage'])(_0x7bc905,_0x1723d1,_0x1723d1[_0x5b46a5(0x193)]);}else{const _0x50b3c0=path_1[_0x5b46a5(0x266)][_0x5b46a5(0x207)]('public',_0x5b46a5(0x184)+_0x1723d1[_0x5b46a5(0x293)],_0x198d8f['mediaPath']),_0x213424=await(0x0,SendWhatsAppMedia_1[_0x5b46a5(0x1b6)])(_0x198d8f[_0x5b46a5(0x296)],_0x50b3c0,_0x4b5c0e[_0x5b46a5(0x146)],_0x1723d1['companyId']);let _0xf4b4c4=await _0x621bcd[_0x5b46a5(0x1c8)](_0x1723d1[_0x5b46a5(0x193)][_0x5b46a5(0x192)]+'@'+(_0x1723d1['isGroup']?_0x5b46a5(0x2a4):_0x5b46a5(0x1d4)),{..._0x213424});await verifyMediaMessage(_0xf4b4c4,_0x1723d1,_0x1723d1[_0x5b46a5(0x193)]);}const _0xeb66cc=await _0x621bcd[_0x5b46a5(0x1c8)](_0x1723d1[_0x5b46a5(0x193)][_0x5b46a5(0x192)]+'@'+(_0x1723d1[_0x5b46a5(0x200)]?_0x5b46a5(0x2a4):'s.whatsapp.net'),_0x4b5c0e);await(0x0,exports[_0x5b46a5(0x143)])(_0xeb66cc,_0x1723d1,_0x1723d1['contact']);},_0x2deeee=async()=>{const _0x1d689e=_0x41966a;let _0x3af9a0='';_0x316c22[_0x1d689e(0x124)]((_0x12aac5,_0x18efcb)=>{const _0x42eb11=_0x1d689e;_0x3af9a0+=_0x42eb11(0x290)+_0x12aac5[_0x42eb11(0x22b)]+_0x42eb11(0x125)+_0x12aac5[_0x42eb11(0x261)]+'\x0a';}),_0x3af9a0+=_0x1d689e(0x165),_0x3af9a0+=_0x1d689e(0x228);const _0x4aefa7={'text':(0x0,Mustache_1[_0x1d689e(0x266)])('‎'+_0x198d8f[_0x1d689e(0x285)]+'\x0a\x0a'+_0x3af9a0,_0x1723d1)};if(process[_0x1d689e(0x101)][_0x1d689e(0x27e)]?.[_0x1d689e(0x109)]>=0x8){if(_0x1723d1[_0x1d689e(0x193)]['number']!=process[_0x1d689e(0x101)][_0x1d689e(0x27e)]){console['trace'](_0x1d689e(0x1b3));return;}}if(!_0x198d8f[_0x1d689e(0x1ed)]){const _0x9a1e8c=await _0x621bcd[_0x1d689e(0x1c8)](_0x1723d1[_0x1d689e(0x193)][_0x1d689e(0x192)]+'@'+(_0x1723d1[_0x1d689e(0x200)]?'g.us':_0x1d689e(0x1d4)),_0x4aefa7);await(0x0,exports[_0x1d689e(0x143)])(_0x9a1e8c,_0x1723d1,_0x1723d1[_0x1d689e(0x193)]);}else{const _0x56e373=path_1[_0x1d689e(0x266)]['resolve'](_0x1d689e(0x29f),_0x1d689e(0x184)+_0x1723d1[_0x1d689e(0x293)],_0x198d8f['mediaPath']),_0x3d7dc2=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x198d8f[_0x1d689e(0x296)],_0x56e373,_0x4aefa7['text'],_0x1723d1[_0x1d689e(0x293)]);let _0x3ccb82=await _0x621bcd[_0x1d689e(0x1c8)](_0x1723d1[_0x1d689e(0x193)]['number']+'@'+(_0x1723d1[_0x1d689e(0x200)]?'g.us':_0x1d689e(0x1d4)),{..._0x3d7dc2});await verifyMediaMessage(_0x3ccb82,_0x1723d1,_0x1723d1[_0x1d689e(0x193)]);}};if(_0x2cea71['value']==='list')return _0x10f2d6();if(_0x2cea71[_0x41966a(0x160)]===_0x41966a(0x1ab)&&QueueOption_1[_0x41966a(0x266)][_0x41966a(0x109)]<=0x4)return _0xb95888();if(_0x2cea71[_0x41966a(0x160)]===_0x41966a(0x146))return console[_0x41966a(0x122)](_0x41966a(0x1b8)),_0x2deeee();if(_0x2cea71['value']===_0x41966a(0x1ab)&&QueueOption_1[_0x41966a(0x266)]['length']>0x4)return console[_0x41966a(0x122)](_0x41966a(0x120)),_0x2deeee();}}}}},handleMessageIntegration=async(_0x3b7157,_0x1ac4f9,_0x592d28,_0x3440a3)=>{const _0x2c22a2=a561_0x810c34;if(process[_0x2c22a2(0x101)][_0x2c22a2(0x27e)]){if(_0x3440a3[_0x2c22a2(0x193)][_0x2c22a2(0x192)]!=process[_0x2c22a2(0x101)]['CHATBOT_RESTRICT_NUMBER']){console[_0x2c22a2(0x171)](_0x2c22a2(0x1b3));return;}}const _0x3a3d8a=getTypeMessage(_0x3b7157);if(_0x592d28[_0x2c22a2(0x1f7)]==='n8n'||_0x592d28[_0x2c22a2(0x1f7)]==='webhook'){if(_0x592d28?.['urlN8N']){const _0x1d2dca={'method':'POST','url':_0x592d28?.[_0x2c22a2(0x168)],'headers':{'Content-Type':'application/json'},'json':_0x3b7157};try{(0x0,request_1[_0x2c22a2(0x266)])(_0x1d2dca,function(_0x318091,_0x297c83){const _0x3a8ff7=_0x2c22a2;if(_0x318091)throw new Error(_0x318091);else console[_0x3a8ff7(0x171)](_0x297c83[_0x3a8ff7(0x159)]);});}catch(_0x587d22){throw new Error(_0x587d22);}}}else _0x592d28[_0x2c22a2(0x1f7)]===_0x2c22a2(0x11a)&&await(0x0,typebotListener_1[_0x2c22a2(0x266)])({'ticket':_0x3440a3,'msg':_0x3b7157,'wbot':_0x1ac4f9,'typebot':_0x592d28});};exports[a561_0x810c34(0x205)]=handleMessageIntegration;const messageContainsMedia=_0x6d2ecf=>{const _0x234471=a561_0x810c34;return _0x6d2ecf[_0x234471(0x285)]?.['imageMessage']||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x1da)]||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x257)]||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x254)]||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x25d)]||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x15b)]?.[_0x234471(0x285)]?.['documentMessage']||_0x6d2ecf['message']?.[_0x234471(0x131)]?.[_0x234471(0x285)]?.[_0x234471(0x1da)]||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x131)]?.['message']?.[_0x234471(0x25d)]||_0x6d2ecf[_0x234471(0x285)]?.['ephemeralMessage']?.[_0x234471(0x285)]?.[_0x234471(0x257)]||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x131)]?.[_0x234471(0x285)]?.[_0x234471(0x254)]||_0x6d2ecf['message']?.[_0x234471(0x131)]?.[_0x234471(0x285)]?.['imageMessage']||_0x6d2ecf[_0x234471(0x285)]?.['viewOnceMessage']?.[_0x234471(0x285)]?.[_0x234471(0x1a8)]||_0x6d2ecf[_0x234471(0x285)]?.['viewOnceMessage']?.[_0x234471(0x285)]?.[_0x234471(0x257)]||_0x6d2ecf['message']?.[_0x234471(0x131)]?.[_0x234471(0x285)]?.[_0x234471(0x29a)]?.['message']?.['imageMessage']||_0x6d2ecf['message']?.['ephemeralMessage']?.[_0x234471(0x285)]?.[_0x234471(0x29a)]?.[_0x234471(0x285)]?.[_0x234471(0x257)]||_0x6d2ecf['message']?.[_0x234471(0x131)]?.[_0x234471(0x285)]?.['viewOnceMessage']?.[_0x234471(0x285)]?.['audioMessage']||_0x6d2ecf[_0x234471(0x285)]?.['ephemeralMessage']?.[_0x234471(0x285)]?.[_0x234471(0x29a)]?.['message']?.[_0x234471(0x25d)]||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x15b)]?.[_0x234471(0x285)]?.['documentMessage']||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x27d)]?.[_0x234471(0x1f2)]?.[_0x234471(0x1a8)]||_0x6d2ecf[_0x234471(0x285)]?.['templateMessage']?.[_0x234471(0x1f2)]?.[_0x234471(0x25d)]||_0x6d2ecf['message']?.['templateMessage']?.['hydratedTemplate']?.[_0x234471(0x257)]||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x27d)]?.[_0x234471(0x206)]?.[_0x234471(0x1a8)]||_0x6d2ecf['message']?.[_0x234471(0x27d)]?.[_0x234471(0x206)]?.['documentMessage']||_0x6d2ecf[_0x234471(0x285)]?.['templateMessage']?.[_0x234471(0x206)]?.[_0x234471(0x257)]||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x27d)]?.[_0x234471(0x247)]?.['imageMessage']||_0x6d2ecf['message']?.['templateMessage']?.['fourRowTemplate']?.['documentMessage']||_0x6d2ecf[_0x234471(0x285)]?.['templateMessage']?.['fourRowTemplate']?.[_0x234471(0x257)]||_0x6d2ecf[_0x234471(0x285)]?.['interactiveMessage']?.['header']?.[_0x234471(0x1a8)]||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x1ad)]?.[_0x234471(0x213)]?.[_0x234471(0x25d)]||_0x6d2ecf['message']?.[_0x234471(0x1ad)]?.['header']?.[_0x234471(0x257)]||_0x6d2ecf['message']?.[_0x234471(0x114)]?.[_0x234471(0x29c)]?.[_0x234471(0x1f2)]?.[_0x234471(0x25d)]||_0x6d2ecf[_0x234471(0x285)]?.['highlyStructuredMessage']?.[_0x234471(0x29c)]?.[_0x234471(0x1f2)]?.['videoMessage']||_0x6d2ecf[_0x234471(0x285)]?.[_0x234471(0x114)]?.[_0x234471(0x29c)]?.[_0x234471(0x1f2)]?.[_0x234471(0x1a8)]||_0x6d2ecf['message']?.['highlyStructuredMessage']?.['hydratedHsm']?.[_0x234471(0x1f2)]?.[_0x234471(0x299)];},handleMessage=async(_0x446b88,_0x5ba8cd,_0x1b2540,_0x438bc2=![])=>{const _0xf771ee=a561_0x810c34;if(_0x438bc2){console[_0xf771ee(0x171)]('Importando\x20mensagens!!');let _0x28b4b6=_0x446b88[_0xf771ee(0x2a6)]['id'],_0x38e80d=await Message_1[_0xf771ee(0x266)][_0xf771ee(0x1e9)]({'where':{'id':_0x28b4b6}});if(_0x38e80d>0x0){await new Promise(_0x1425b7=>setTimeout(_0x1425b7,0x96));return;}else await new Promise(_0x5abb91=>setTimeout(_0x5abb91,0x14a));}let _0x3b1f16;if(!(0x0,exports[_0xf771ee(0x21e)])(_0x446b88)){console['log']('Mensagem\x20inválida!'),console[_0xf771ee(0x171)](_0x446b88);return;}_0x446b88[_0xf771ee(0x285)]?.[_0xf771ee(0x131)]&&(_0x446b88[_0xf771ee(0x285)]=_0x446b88[_0xf771ee(0x285)][_0xf771ee(0x131)]['message']);try{let _0x203ec4;const _0x2676d5=_0x446b88[_0xf771ee(0x2a6)][_0xf771ee(0x2ba)]?.[_0xf771ee(0x174)]('@g.us'),_0x3fa8eb=await Setting_1[_0xf771ee(0x266)]['findOne']({'where':{'companyId':_0x1b2540,'key':_0xf771ee(0x107)}});if(_0x3fa8eb?.['value']==='enabled'&&_0x2676d5){console['log'](_0xf771ee(0x117));return;}let _0x136c63=(0x0,exports[_0xf771ee(0x19e)])(_0x446b88);const _0x101499=getTypeMessage(_0x446b88);typeof _0x136c63===_0xf771ee(0x25b)&&(_0x136c63=_0x136c63[_0xf771ee(0x2a0)](/\u200c/,''));const _0xc981d9=messageContainsMedia(_0x446b88);if(_0x446b88[_0xf771ee(0x2a6)][_0xf771ee(0x1c9)]){if(!_0xc981d9&&_0x101499!=='conversation'&&_0x101499!==_0xf771ee(0x1d6)&&_0x101499!=='vcard'&&_0x101499!==_0xf771ee(0x24b)&&_0x101499!=='ephemeralMessage'&&_0x101499!=='protocolMessage'&&_0x101499!==_0xf771ee(0x18c)&&_0x101499!==_0xf771ee(0x29a)&&_0x101499!==_0xf771ee(0x299)&&_0x101499!==_0xf771ee(0x1dd)&&_0x101499!==_0xf771ee(0x179)){console[_0xf771ee(0x122)](_0x101499);return;}}const _0x172053=await(0x0,ShowWhatsAppService_1[_0xf771ee(0x266)])(_0x5ba8cd['id'],_0x1b2540);let _0x2d9212,_0x5649af=await getContactMessage(_0x446b88,_0x5ba8cd);_0x203ec4=await verifyContact(_0x5649af,_0x5ba8cd,_0x1b2540);if(_0x2676d5){if(!_0x172053['allowGroup'])return;try{const _0x374450=await _0x5ba8cd['groupMetadata'](_0x446b88['key'][_0xf771ee(0x2ba)]),_0x448fd3={'id':_0x374450['id'],'name':_0x374450[_0xf771ee(0x13a)]};_0x2d9212=await verifyContact(_0x448fd3,_0x5ba8cd,_0x1b2540);}catch(_0x761217){console['log'](_0xf771ee(0x1b5)),console['log'](_0x761217);return;}}let _0x3098d2=0x0;if(_0x446b88[_0xf771ee(0x2a6)][_0xf771ee(0x1c9)])await cache_1['cacheLayer'][_0xf771ee(0x28c)](_0xf771ee(0x2a7)+_0x203ec4['id']+_0xf771ee(0x289),'0');else{const _0x5c8c8d=await cache_1[_0xf771ee(0x23c)]['get'](_0xf771ee(0x2a7)+_0x203ec4['id']+':unreads');_0x3098d2=+_0x5c8c8d+0x1,await cache_1['cacheLayer']['set']('contacts:'+_0x203ec4['id']+_0xf771ee(0x289),''+_0x3098d2);}const _0x1fb965=await(0x0,FindOrCreateTicketService_1[_0xf771ee(0x266)])(_0x203ec4,_0x5ba8cd['id'],_0x3098d2,_0x1b2540,_0x2d9212,_0x438bc2),_0x255ea7=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x1fb965['id'],'companyId':_0x1b2540,'whatsappId':_0x172053?.['id']});_0x255ea7[_0xf771ee(0x1ac)](_0xf771ee(0x1c0),!![]),await _0x255ea7['update']({'updatedAt':new Date()}),await(0x0,providers_1['provider'])(_0x1fb965,_0x446b88,_0x1b2540,_0x203ec4,_0x5ba8cd);if(_0x172053[_0xf771ee(0x2b0)]&&_0x3098d2===0x0){const _0x454f45=await Message_1['default'][_0xf771ee(0x201)]({'where':{'contactId':_0x203ec4['id'],'companyId':_0x1b2540},'order':[[_0xf771ee(0x145),_0xf771ee(0x2b3)]]});if((0x0,Mustache_1[_0xf771ee(0x266)])(_0x172053['complationMessage'],_0x1fb965)[_0xf771ee(0x136)]()[_0xf771ee(0x147)]()===_0x454f45?.[_0xf771ee(0x159)][_0xf771ee(0x136)]()[_0xf771ee(0x147)]())return;}if(_0x136c63=='#'&&!_0x438bc2&&(!_0x1fb965[_0xf771ee(0x16b)]||_0x1fb965['status']==_0xf771ee(0x178))){await _0x1fb965[_0xf771ee(0x1e8)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x5ba8cd,_0x446b88,_0x1fb965,_0x1fb965['contact']);return;}try{if(!_0x446b88[_0xf771ee(0x2a6)][_0xf771ee(0x1c9)]&&!_0x438bc2){if(_0x136c63!=null&&typeof _0x136c63!==_0xf771ee(0x25b)){console['log'](_0x136c63),console[_0xf771ee(0x122)](_0xf771ee(0x1b7),typeof _0x136c63);return;}if(_0x136c63?.['toUpperCase']()===_0xf771ee(0x211)&&_0x1fb965[_0xf771ee(0x19c)]!=_0xf771ee(0x26a)){await(0x0,SendPresenceStatus_1[_0xf771ee(0x279)])(_0x5ba8cd,_0x1fb965[_0xf771ee(0x193)]['number']+'@'+(_0x1fb965[_0xf771ee(0x200)]?_0xf771ee(0x2a4):_0xf771ee(0x1d4)));const _0xe60f81=await _0x5ba8cd[_0xf771ee(0x1c8)](_0x1fb965[_0xf771ee(0x193)][_0xf771ee(0x192)]+'@'+(_0x1fb965['isGroup']?_0xf771ee(0x2a4):_0xf771ee(0x1d4)),{'text':_0xf771ee(0x2b7)});await(0x0,exports[_0xf771ee(0x143)])(_0xe60f81,_0x1fb965,_0x1fb965[_0xf771ee(0x193)]),await(0x0,UpdateTicketService_1[_0xf771ee(0x266)])({'ticketData':{'queueId':null,'status':_0xf771ee(0x26a)},'ticketId':_0x1fb965['id'],'companyId':_0x1fb965[_0xf771ee(0x293)]}),await _0x1fb965[_0xf771ee(0x242)]();return;}}}catch(_0x40f39e){console['log'](_0xf771ee(0x2ad)),console[_0xf771ee(0x171)](_0x40f39e),Sentry[_0xf771ee(0x20e)](_0x40f39e);}try{await _0x1fb965['update']({'fromMe':_0x446b88[_0xf771ee(0x2a6)]['fromMe']});}catch(_0x2bd64e){console[_0xf771ee(0x171)](_0xf771ee(0x2a5)),console[_0xf771ee(0x171)](_0x2bd64e),Sentry[_0xf771ee(0x20e)](_0x2bd64e);}try{if(!_0x446b88['key'][_0xf771ee(0x1c9)]){if((0x0,exports[_0xf771ee(0x118)])(_0x255ea7)){await(0x0,exports[_0xf771ee(0x17c)])(_0x446b88,_0x1fb965,_0x255ea7),console[_0xf771ee(0x171)](_0xf771ee(0x1b9)+_0x446b88);return;}}}catch(_0x421af5){console[_0xf771ee(0x171)](_0xf771ee(0x12f)),Sentry[_0xf771ee(0x20e)](_0x421af5),console[_0xf771ee(0x171)](_0x421af5);}_0xc981d9?_0x3b1f16=await verifyMediaMessage(_0x446b88,_0x1fb965,_0x203ec4):await(0x0,exports[_0xf771ee(0x143)])(_0x446b88,_0x1fb965,_0x203ec4);const _0x149f29=await(0x0,VerifyCurrentSchedule_1[_0xf771ee(0x266)])(_0x1b2540),_0x3ee804=await Setting_1[_0xf771ee(0x266)][_0xf771ee(0x201)]({'where':{'companyId':_0x1b2540,'key':_0xf771ee(0x1d8)}});if(!_0x446b88[_0xf771ee(0x2a6)]['fromMe']&&_0x3ee804&&!_0x438bc2)await handleOutOfHour(_0x5ba8cd,_0x1fb965,_0x3ee804,_0x203ec4,_0x149f29,_0x172053);!_0x1fb965[_0xf771ee(0x1e0)]&&!_0x2676d5&&!_0x446b88[_0xf771ee(0x2a6)][_0xf771ee(0x1c9)]&&!_0x1fb965['userId']&&!(0x0,lodash_1['isNil'])(_0x172053[_0xf771ee(0x282)])&&!_0x438bc2&&await handleOpenAi(_0x446b88,_0x5ba8cd,_0x1fb965,_0x203ec4,_0x3b1f16);if(!_0x446b88[_0xf771ee(0x2a6)][_0xf771ee(0x1c9)]&&!_0x1fb965[_0xf771ee(0x200)]&&!_0x1fb965[_0xf771ee(0x1e0)]&&!_0x1fb965[_0xf771ee(0x10f)]&&_0x1fb965[_0xf771ee(0x1d1)]&&!(0x0,lodash_1[_0xf771ee(0x113)])(_0x172053[_0xf771ee(0x25f)])&&!_0x1fb965[_0xf771ee(0x149)]&&!_0x438bc2){const _0x1d1fc7=await(0x0,ShowQueueIntegrationService_1[_0xf771ee(0x266)])(_0x172053[_0xf771ee(0x25f)],_0x1b2540);await(0x0,exports[_0xf771ee(0x205)])(_0x446b88,_0x5ba8cd,_0x1d1fc7,_0x1fb965);return;}!_0x2676d5&&!_0x446b88['key'][_0xf771ee(0x1c9)]&&!_0x1fb965[_0xf771ee(0x16b)]&&!(0x0,lodash_1[_0xf771ee(0x113)])(_0x1fb965[_0xf771ee(0x282)])&&_0x1fb965[_0xf771ee(0x149)]&&!_0x438bc2&&await handleOpenAi(_0x446b88,_0x5ba8cd,_0x1fb965,_0x203ec4,_0x3b1f16);if(!_0x446b88[_0xf771ee(0x2a6)]['fromMe']&&!_0x1fb965[_0xf771ee(0x200)]&&!_0x1fb965[_0xf771ee(0x16b)]&&_0x1fb965['integrationId']&&_0x1fb965[_0xf771ee(0x149)]&&!_0x438bc2){const _0x3c1e4b=await(0x0,ShowQueueIntegrationService_1[_0xf771ee(0x266)])(_0x1fb965['integrationId'],_0x1b2540);await(0x0,exports[_0xf771ee(0x205)])(_0x446b88,_0x5ba8cd,_0x3c1e4b,_0x1fb965);}!_0x1fb965['queue']&&!_0x1fb965[_0xf771ee(0x200)]&&!_0x446b88[_0xf771ee(0x2a6)][_0xf771ee(0x1c9)]&&!_0x1fb965['userId']&&_0x172053[_0xf771ee(0x102)][_0xf771ee(0x109)]>=0x1&&!_0x1fb965['useIntegration']&&!_0x438bc2&&(await verifyQueue(_0x5ba8cd,_0x446b88,_0x1fb965,_0x203ec4),_0x255ea7[_0xf771ee(0x1ac)](_0xf771ee(0x163),!![]),_0x255ea7['changed'](_0xf771ee(0x1c0),!![]),await _0x255ea7[_0xf771ee(0x1e8)]({'chatbotAt':(0x0,moment_1[_0xf771ee(0x266)])()[_0xf771ee(0x116)](),'updatedAt':new Date()}));const _0x479439=_0x1fb965[_0xf771ee(0x1e0)]===null;await _0x1fb965[_0xf771ee(0x242)]();if(!_0x438bc2&&_0x172053[_0xf771ee(0x21b)])await greetingMessage(_0x5ba8cd,_0x1fb965,_0x446b88,_0x172053,_0x2676d5);_0x172053[_0xf771ee(0x102)]['length']==0x1&&_0x1fb965[_0xf771ee(0x1e0)]&&!_0x438bc2&&(_0x1fb965[_0xf771ee(0x1d1)]&&!_0x446b88[_0xf771ee(0x2a6)]['fromMe']&&!_0x1fb965[_0xf771ee(0x16b)]&&await handleChartbot(_0x1fb965,_0x446b88,_0x5ba8cd,_0x172053)),_0x172053[_0xf771ee(0x102)][_0xf771ee(0x109)]>0x1&&_0x1fb965['queue']&&!_0x438bc2&&(_0x1fb965[_0xf771ee(0x1d1)]&&!_0x446b88[_0xf771ee(0x2a6)][_0xf771ee(0x1c9)]&&!_0x1fb965['userId']&&await handleChartbot(_0x1fb965,_0x446b88,_0x5ba8cd,_0x172053,_0x479439));}catch(_0x385759){console[_0xf771ee(0x171)](_0x385759),Sentry['captureException'](_0x385759),logger_1[_0xf771ee(0x11c)][_0xf771ee(0x255)]('Error\x20handling\x20whatsapp\x20message:\x20Err:\x20'+_0x385759);}};exports[a561_0x810c34(0x1d2)]=handleMessage;const handleOutOfHour=async(_0x4bef24,_0x10e675,_0xe5d84c,_0x29135e,_0x8282ac,_0x483a15)=>{const _0x198b67=a561_0x810c34;try{if(outOfHourMessageControl[_0x198b67(0x109)]>0x1388)outOfHourMessageControl=[];let _0x43e3a2=outOfHourMessageControl[_0x198b67(0x286)](_0x4774c8=>_0x4774c8[_0x198b67(0x1cd)]===_0x10e675['id']||_0x4774c8[_0x198b67(0x134)]===_0x29135e['number']);if(_0xe5d84c[_0x198b67(0x160)]===_0x198b67(0x184)&&!(0x0,lodash_1[_0x198b67(0x113)])(_0x8282ac)&&_0x483a15[_0x198b67(0x272)]&&(!_0x8282ac||_0x8282ac['inActivity']===![])){if(!_0x43e3a2||_0x43e3a2&&_0x43e3a2['time']+0x3e8*0x3c*0x5<new Date()[_0x198b67(0x15e)]()){_0x43e3a2&&(outOfHourMessageControl=outOfHourMessageControl[_0x198b67(0x181)](_0x218028=>_0x218028['ticketId']!==_0x10e675['id']),_0x43e3a2=null);if(!_0x43e3a2)outOfHourMessageControl[_0x198b67(0x238)]({'ticketId':_0x10e675['id'],'dest':_0x29135e[_0x198b67(0x192)],'time':new Date()[_0x198b67(0x15e)]()});const _0x4ab201='‎\x20'+_0x483a15[_0x198b67(0x272)],_0x17537c=(0x0,Debounce_1[_0x198b67(0x135)])(async()=>{const _0x467d27=_0x198b67;await _0x4bef24[_0x467d27(0x1c8)](_0x10e675[_0x467d27(0x193)][_0x467d27(0x192)]+'@'+(_0x10e675[_0x467d27(0x200)]?_0x467d27(0x2a4):'s.whatsapp.net'),{'text':_0x4ab201});},(0x0,queues_1[_0x198b67(0x1c4)])(0x5dc,0xdac),_0x10e675['id']);_0x17537c();return;}}if(_0xe5d84c[_0x198b67(0x160)]===_0x198b67(0x1e0)&&_0x10e675[_0x198b67(0x1f4)]!==null){const _0x2afada=await Queue_1[_0x198b67(0x266)]['findByPk'](_0x10e675[_0x198b67(0x1f4)]),{schedules:_0x13f4fe}=_0x2afada,_0x4ee068=(0x0,moment_1[_0x198b67(0x266)])(),_0x40b6b5=_0x4ee068['format'](_0x198b67(0x11b))[_0x198b67(0x147)]();let _0x2212b6=null;Array[_0x198b67(0x210)](_0x13f4fe)&&_0x13f4fe[_0x198b67(0x109)]>0x0&&(_0x2212b6=_0x13f4fe[_0x198b67(0x286)](_0x2998b6=>_0x2998b6[_0x198b67(0x280)]===_0x40b6b5&&_0x2998b6['startTime']!==''&&_0x2998b6[_0x198b67(0x294)]!==null&&_0x2998b6[_0x198b67(0x248)]!==''&&_0x2998b6[_0x198b67(0x248)]!==null));if(_0xe5d84c[_0x198b67(0x160)]==='queue'&&_0x2afada[_0x198b67(0x272)]!==null&&_0x2afada[_0x198b67(0x272)]!==''&&!(0x0,lodash_1['isNil'])(_0x2212b6)){const _0x3d5d56=(0x0,moment_1[_0x198b67(0x266)])(_0x2212b6['startTime'],_0x198b67(0x103)),_0x35dab0=(0x0,moment_1['default'])(_0x2212b6[_0x198b67(0x248)],'HH:mm');let _0x20777a=_0x4ee068['isBefore'](_0x3d5d56)||_0x4ee068[_0x198b67(0x14d)](_0x35dab0);if(!_0x20777a){if(_0x2212b6[_0x198b67(0x2af)]&&_0x2212b6['endLunchTime']){const _0x576e78=(0x0,moment_1[_0x198b67(0x266)])(_0x2212b6['startLunchTime'],'HH:mm'),_0x379f5f=(0x0,moment_1[_0x198b67(0x266)])(_0x2212b6[_0x198b67(0x274)],_0x198b67(0x103));_0x20777a=_0x4ee068[_0x198b67(0x139)](_0x576e78,_0x379f5f);}}if(_0x20777a){if(!_0x43e3a2||_0x43e3a2&&_0x43e3a2[_0x198b67(0x1ba)]+0x3e8*0x3c*0x1e<new Date()['getTime']()){const _0x47abb8=_0x2afada[_0x198b67(0x272)],_0x28df89=(0x0,Debounce_1[_0x198b67(0x135)])(async()=>{const _0x2476b7=_0x198b67;await _0x4bef24['sendMessage'](_0x10e675[_0x2476b7(0x193)][_0x2476b7(0x192)]+'@'+(_0x10e675[_0x2476b7(0x200)]?_0x2476b7(0x2a4):'s.whatsapp.net'),{'text':_0x47abb8});},(0x0,queues_1['randomValue'])(0x3e8,0xbb8),_0x10e675['id']);_0x28df89();return;}if(!_0x43e3a2)outOfHourMessageControl['push']({'ticketId':_0x10e675['id'],'dest':_0x29135e[_0x198b67(0x192)],'time':new Date()['getTime']()});}}}}catch(_0x21d3e8){Sentry['captureException'](_0x21d3e8),console[_0x198b67(0x171)](_0x21d3e8);}},greetingMessage=async(_0x19a6b3,_0x4153e1,_0x23a262,_0x4a5470,_0x368def)=>{const _0x57407d=a561_0x810c34;if(!_0x4a5470?.[_0x57407d(0x102)]?.[_0x57407d(0x109)]&&!_0x4153e1['userId']&&!_0x368def&&!_0x23a262[_0x57407d(0x2a6)]['fromMe']){if(process[_0x57407d(0x101)]['CHATBOT_RESTRICT_NUMBER']?.[_0x57407d(0x109)]>=0x8){if(_0x4153e1[_0x57407d(0x193)][_0x57407d(0x192)]!=process['env'][_0x57407d(0x27e)])return;}if(greetingMessageControl[_0x57407d(0x109)]>0x1388)greetingMessageControl=[];var _0x48eccc=greetingMessageControl[_0x57407d(0x286)](_0xaabfe2=>_0xaabfe2['ticketId']===_0x4153e1['id']||_0xaabfe2['dest']===_0x4153e1[_0x57407d(0x193)][_0x57407d(0x192)]);if(_0x48eccc&&_0x48eccc['time']+0x3e8*0x3c*0x5>=new Date()['getTime']())return;const _0x4d02d8=await Message_1[_0x57407d(0x266)][_0x57407d(0x201)]({'where':{'ticketId':_0x4153e1['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x57407d(0x22d)]]:(0x0,moment_1['default'])()[_0x57407d(0x10a)](0x5,_0x57407d(0x1f1))[_0x57407d(0x116)]()}}});if(_0x4d02d8)return;const _0x4eb7bc=(0x0,Debounce_1[_0x57407d(0x135)])(async()=>{const _0x52004e=_0x57407d;if(!_0x4a5470[_0x52004e(0x142)])await _0x19a6b3[_0x52004e(0x1c8)](_0x4153e1['contact'][_0x52004e(0x192)]+'@'+(_0x4153e1[_0x52004e(0x200)]?'g.us':_0x52004e(0x1d4)),{'text':(0x0,Mustache_1['default'])(_0x4a5470[_0x52004e(0x21b)],_0x4153e1)});else{const _0x4aaf92=path_1[_0x52004e(0x266)]['resolve'](_0x52004e(0x29f),_0x52004e(0x184)+_0x4153e1[_0x52004e(0x293)],_0x4a5470[_0x52004e(0x142)]),_0x34d58e=await(0x0,SendWhatsAppMedia_1[_0x52004e(0x1b6)])(_0x4a5470[_0x52004e(0x142)],_0x4aaf92,_0x4a5470[_0x52004e(0x21b)],_0x4153e1[_0x52004e(0x293)]);await _0x19a6b3[_0x52004e(0x1c8)](_0x4153e1[_0x52004e(0x193)]['number']+'@'+(_0x4153e1[_0x52004e(0x200)]?_0x52004e(0x2a4):'s.whatsapp.net'),{..._0x34d58e});}},0x3e8,_0x4153e1['id']);_0x4eb7bc();return;}},handleMsgAck=async(_0x4e18fa,_0x5308b0)=>{const _0x500a7b=a561_0x810c34,_0x557283=(0x0,socket_1[_0x500a7b(0x18f)])();try{const _0x5337d7=await Message_1[_0x500a7b(0x266)][_0x500a7b(0x253)](_0x4e18fa[_0x500a7b(0x2a6)]['id'],{'include':[_0x500a7b(0x193),{'model':Message_1[_0x500a7b(0x266)],'as':'quotedMsg','include':[_0x500a7b(0x193)]}]});if(!_0x5337d7){console[_0x500a7b(0x171)](_0x4e18fa),console[_0x500a7b(0x171)]('Mensagem\x20não\x20encontrada!');return;}await _0x5337d7[_0x500a7b(0x1e8)]({'ack':_0x5308b0}),_0x557283['to'](_0x5337d7['ticketId'][_0x500a7b(0x164)]())[_0x500a7b(0x270)](_0x500a7b(0x24c)+_0x5337d7['companyId']+_0x500a7b(0x288),{'action':_0x500a7b(0x1e8),'message':_0x5337d7});}catch(_0x30c48a){Sentry['captureException'](_0x30c48a),logger_1[_0x500a7b(0x11c)][_0x500a7b(0x255)]('Error\x20handling\x20message\x20ack.\x20Err:\x20'+_0x30c48a);}};exports[a561_0x810c34(0x23f)]=handleMsgAck;const verifyRecentCampaign=async(_0x25f49a,_0x45dc0c)=>{const _0x5267ec=a561_0x810c34;if(!_0x25f49a[_0x5267ec(0x2a6)]['fromMe']){const _0x143f80=_0x25f49a[_0x5267ec(0x2a6)][_0x5267ec(0x2ba)]['replace'](/\D/g,''),_0x56d95d=await Campaign_1[_0x5267ec(0x266)][_0x5267ec(0x18b)]({'where':{'companyId':_0x45dc0c,'status':_0x5267ec(0x12b),'confirmation':!![]}});if(_0x56d95d){const _0x1b0666=_0x56d95d[_0x5267ec(0x108)](_0xd6d24=>_0xd6d24['id']),_0x4ed229=await CampaignShipping_1[_0x5267ec(0x266)][_0x5267ec(0x201)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x1b0666},'number':_0x143f80,'confirmation':null}});_0x4ed229&&(await _0x4ed229[_0x5267ec(0x1e8)]({'confirmedAt':(0x0,moment_1[_0x5267ec(0x266)])(),'confirmation':!![]}),await queues_1[_0x5267ec(0x1a7)][_0x5267ec(0x15f)](_0x5267ec(0x1c2),{'campaignShippingId':_0x4ed229['id'],'campaignId':_0x4ed229[_0x5267ec(0x24d)]},{'delay':(0x0,queues_1[_0x5267ec(0x26d)])((0x0,queues_1[_0x5267ec(0x1c4)])(0x0,0xa))}));}}};exports[a561_0x810c34(0x14c)]=verifyRecentCampaign;const verifyCampaignMessageAndCloseTicket=async(_0x42f1c3,_0x376c9b)=>{const _0x225dd6=a561_0x810c34,_0x4f7d3c=(0x0,socket_1[_0x225dd6(0x18f)])(),_0x38ed07=(0x0,exports['getBodyMessage'])(_0x42f1c3),_0x265309=/\u200c/[_0x225dd6(0x1a2)](_0x38ed07);if(_0x42f1c3['key']['fromMe']&&_0x265309){const _0x5c4ee4=await Message_1[_0x225dd6(0x266)][_0x225dd6(0x201)]({'where':{'id':_0x42f1c3[_0x225dd6(0x2a6)]['id'],'companyId':_0x376c9b}}),_0x5d5fd6=await Ticket_1[_0x225dd6(0x266)][_0x225dd6(0x253)](_0x5c4ee4[_0x225dd6(0x1cd)]);await _0x5d5fd6[_0x225dd6(0x1e8)]({'status':'closed'}),_0x4f7d3c['to'](_0x225dd6(0x24c)+_0x5d5fd6['companyId']+_0x225dd6(0x22e))[_0x225dd6(0x270)](_0x225dd6(0x24c)+_0x5d5fd6[_0x225dd6(0x293)]+_0x225dd6(0x176),{'action':_0x225dd6(0x240),'ticket':_0x5d5fd6,'ticketId':_0x5d5fd6['id']}),_0x4f7d3c['to'](_0x225dd6(0x24c)+_0x376c9b+'-'+_0x5d5fd6[_0x225dd6(0x19c)])['to'](_0x5d5fd6['id'][_0x225dd6(0x164)]())['emit'](_0x225dd6(0x24c)+_0x5d5fd6[_0x225dd6(0x293)]+_0x225dd6(0x176),{'action':_0x225dd6(0x1e8),'ticket':_0x5d5fd6,'ticketId':_0x5d5fd6['id']});}};exports[a561_0x810c34(0x21c)]=verifyCampaignMessageAndCloseTicket;const filterMessages=_0x79a83c=>{const _0x1226bc=a561_0x810c34;if([baileys_1[_0x1226bc(0x130)]['REVOKE'],baileys_1[_0x1226bc(0x130)][_0x1226bc(0x144)],baileys_1[_0x1226bc(0x130)][_0x1226bc(0x180)],baileys_1[_0x1226bc(0x130)][_0x1226bc(0x276)]][_0x1226bc(0x152)](_0x79a83c[_0x1226bc(0x2b8)]))return![];return!![];},wbotMessageListener=async(_0x5b4da8,_0x24c6db,_0x657ad8)=>{const _0x5ab8a3=a561_0x810c34;_0x5b4da8['ev']['on']('messages.upsert',async _0x490e09=>{const _0x1d3c6b=a561_0x439c,_0x45782c=_0x490e09[_0x1d3c6b(0x28a)][_0x1d3c6b(0x181)](filterMessages);if(!_0x45782c)return;await app_1['default']['get'](_0x1d3c6b(0x102))['messageQueue'][_0x1d3c6b(0x15f)]('HandleMessageJob',{'whatsappId':_0x657ad8['id'],'messages':_0x45782c,'companyId':_0x24c6db},{'removeOnComplete':!![],'attempts':0x3});}),_0x5b4da8['ev']['on'](_0x5ab8a3(0x230),async _0x3323fb=>{const _0x4c55a5=_0x5ab8a3;if(_0x3323fb[_0x4c55a5(0x109)]===0x0)return;await app_1[_0x4c55a5(0x266)][_0x4c55a5(0x104)]('queues')['messageQueue'][_0x4c55a5(0x15f)](_0x4c55a5(0x173),{'whatsappId':_0x657ad8['id'],'messageUpdate':_0x3323fb,'companyId':_0x24c6db},{'removeOnComplete':!![],'attempts':0x3,'delay':0x64});}),_0x5b4da8['ev']['on'](_0x5ab8a3(0x1ce),async _0x89ee3b=>{const _0x185253=_0x5ab8a3;console['log'](_0x89ee3b);if(_0x89ee3b[_0x185253(0x109)]===0x0)return;for(const _0x153954 of _0x89ee3b){const _0x3abbf9=_0x153954['id'][_0x185253(0x1e6)]('@')[0x0],_0x576d0c=_0x153954[_0x185253(0x13a)]||_0x3abbf9,_0x1f0825={'name':_0x576d0c,'number':_0x3abbf9,'isGroup':!![],'companyId':_0x24c6db,'remoteJid':_0x153954['id'],'whatsappId':_0x5b4da8['id']};await(0x0,CreateOrUpdateContactService_1[_0x185253(0x266)])(_0x1f0825,_0x5b4da8,_0x153954['id']);}});};exports['wbotMessageListener']=wbotMessageListener;