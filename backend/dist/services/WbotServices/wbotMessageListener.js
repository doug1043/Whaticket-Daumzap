const a559_0x53de00=a559_0x5eea;(function(_0x34d9a2,_0x1f4179){const _0x2c9f95=a559_0x5eea,_0x5bffa1=_0x34d9a2();while(!![]){try{const _0x5e8bfd=parseInt(_0x2c9f95(0xfd))/0x1+-parseInt(_0x2c9f95(0x1b9))/0x2+-parseInt(_0x2c9f95(0x225))/0x3*(-parseInt(_0x2c9f95(0x1bf))/0x4)+-parseInt(_0x2c9f95(0xe2))/0x5*(-parseInt(_0x2c9f95(0x143))/0x6)+-parseInt(_0x2c9f95(0xd9))/0x7*(parseInt(_0x2c9f95(0x1a9))/0x8)+-parseInt(_0x2c9f95(0xfb))/0x9*(-parseInt(_0x2c9f95(0x210))/0xa)+-parseInt(_0x2c9f95(0x10d))/0xb*(parseInt(_0x2c9f95(0x161))/0xc);if(_0x5e8bfd===_0x1f4179)break;else _0x5bffa1['push'](_0x5bffa1['shift']());}catch(_0x206471){_0x5bffa1['push'](_0x5bffa1['shift']());}}}(a559_0x29a6,0xa83cd));const a559_0x3f37c7=(function(){let _0x58adf8=!![];return function(_0x451153,_0x392a55){const _0x2b9f24=_0x58adf8?function(){const _0x1ea33f=a559_0x5eea;if(_0x392a55){const _0x693375=_0x392a55[_0x1ea33f(0x14e)](_0x451153,arguments);return _0x392a55=null,_0x693375;}}:function(){};return _0x58adf8=![],_0x2b9f24;};}()),a559_0x4104a5=a559_0x3f37c7(this,function(){const _0x91b888=a559_0x5eea;return a559_0x4104a5[_0x91b888(0x136)]()[_0x91b888(0x179)](_0x91b888(0x186))[_0x91b888(0x136)]()[_0x91b888(0x213)](a559_0x4104a5)[_0x91b888(0x179)](_0x91b888(0x186));});a559_0x4104a5();function a559_0x29a6(){const _0x5b3fe7=['time','whatsappId','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','chatbotAt','update','../MessageServices/CreateMessageService','ephemeralMessage','microsoft-cognitiveservices-speech-sdk','HandleMessageJob','emit','\x20|\x20https://maps.google.com/maps?q=','67584QtCAtS','string','messages','fromSubscription','keys','dest','includes','DESC','Failed\x20to\x20get\x20stream','contact','*Você\x20encerrou\x20este\x20atendimento\x20usando\x20o\x20comando\x20SAIR*.\x0a\x0a\x0aSe\x20você\x20finalizou\x20o\x20atendimento\x20*ANTES*\x20de\x20receber\x20um\x20retorno\x20do\x20operador,\x20ele\x20*NÃO*\x20irá\x20visualizar\x20sua\x20solicitação!\x0a\x0aVocê\x20deve\x20aguardar\x20o\x20retorno\x20do\x20operador\x20e\x20que\x20ele\x20encerre\x20seu\x20atendimento\x20quando\x20necessário.\x0a\x0aUse\x20a\x20opção\x20*SAIR*\x20somente\x20em\x20casos\x20de\x20emergência\x20ou\x20se\x20ficou\x20preso\x20em\x20algum\x20setor.\x0a\x0a\x0aPara\x20iniciar\x20um\x20novo\x20atendimento\x20basta\x20enviar\x20uma\x20nova\x20mensagem!','mime','Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','indexOf','No\x20contact\x20found\x20for\x20this\x20ticket.','parseToMilliseconds','messageQueue','../../app','sendGreetingMessageOneQueues','chatbot','Enquete\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','verifyMessage','campaignQueue','botText\x203','mediaName','\x0a*[\x200\x20]*\x20-\x20Menu\x20anterior','title','HH:mm','maxUseBotQueues','unlinkSync','defineProperty','pending','vcard','caption','s.whatsapp.net','../../models/Message','getBodyMessage','documentWithCaptionMessage','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','../../models/Ticket','set','handleMessage','push','image/jpeg','mimetype','../TicketServices/UpdateTicketService','Solicitação\x20de\x20Pagamento','botText\x202','greetingMessage','random','captureException','../TicketServices/FindOrCreateATicketTrakingService','list','Erro\x20para\x20responder\x20com\x20audio:\x20','Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','fluent-ffmpeg','sendMessageImage','choices','../../models/CampaignShipping','remoteJid','system','error','hydratedFourRowTemplate','cacheLayer','voiceMessage','../TypebotServices/typebotListener','pipe','wbotMessageListener','groupMetadata','quotedMsg','pollCreationMessageV2','ack','promptId','conversation','end','extension','createChatCompletion','getQuotedMessage','Menu\x20inicial\x20*[\x200\x20]*\x20Menu\x20anterior','isValidMsg','isAfter','Mensagem\x20inválida\x208!\x20','minutes','\x20seconds\x20with\x20an\x20effective\x20speed\x20of\x20','contacts','public/company','Type','stanzaId','DELIVERY_ACK','weekdayEn','Amigo(a)',':unreads','gpt-3.5-turbo-1106','Error\x20isValidMsg','protocolMessage','getViewOnceMessage','chmodSync','message','request','removeNonPrintableChars','getTextMessage','startTime','messageStubType','extendedTextMessage','listMessage','openai','../../helpers/Mustache','Message','options','./SendWhatsAppMessage','\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial','READ','contactMessage','prompt','../../helpers/Debounce','verifyRecentCampaign','../../utils/logger','debug','getListMessage','-closed','makeid','verifyCampaignMessageAndCloseTicket','createTranscription','media','1260231iivbtk','amountUsedBotQueues','public/temp/','toFormat','\x20de\x20baixar\x20o\x20arquivo\x20','voiceRegion','speechSynthesisVoiceName','proto','product','640670FUIYyv','reactionMessage','directPath','getButtonsMessage','makeRandomId','format','PLAYED','Failed\x20to\x20fetch\x20contact\x20from\x20ticket:','participant','length','lodash','then','body\x20is\x20not\x20a\x20string','WebMessageInfo','fromMe','verifyRating','startLunchTime','whisper-1','writeFile','min','quotedMessage','__esModule','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','locationMessage','chatbot\x20desativado!','55638omdKbT','>>>>\x20erro\x20','1161527CWGiDg','messageContextInfo','../../queues','../../models/UserRating','Status','REVOKE','degreesLatitude','writable','company-','./wbotGetMessageFromType','body','fromAudioFileOutput','values','content','dataJson','toDate','2246695VSbNVJ','getStickerMessage','pollCreationMessageV3','debounce','call','stickerMessage','CheckMsgIsGroup','createReadStream','upsert','chat','getOwnPropertyDescriptor','SpeechSynthesizer','public','inActivity','isNumeric','delete','reload','&z=17&hl=pt-BR|','name','configurable','hydratedHsm','extractMessageContent','unknown','get','audioMessage','%2C','setExtra','voiceKey','Atualização\x20de\x20Status','isBefore','default','../../libs/cache','Escolha\x20uma\x20opção','fourRowTemplate','findByPk','maxMessages','../../models/Queue','speakTextAsync','scheduleType','subtract','SAIR','toString','*[\x20','\x20-\x20Longitude:\x20','ProtocolMessage','getMessageOptions','interactiveMessage','../WhatsappService/ShowWhatsAppService','toLowerCase','document','moment','isGroup','getPaymentMessage','\x20MBps','6wdjIUb','viewOnceMessageV2','Erro\x20ao\x20buscar\x20grupo!','reaction','forEach','segundo\x20if','buttonsResponseMessage','gte','g.us','assistant','hasOwnProperty','apply','create','Latitude:\x20','templateMessage','./SendWhatsAppMedia','fora\x20do\x20horario','texto','\x0a\x0a*[\x20#\x20]*\x20-\x20Voltar\x20ao\x20Menu\x20Principal','.wav','findOne','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','subject','Erro\x20ao\x20salvar\x20ticket!','selectedRowId','getAd','replace','option','ERR_WAPP_DOWNLOAD_MEDIA','existsSync','36Ljbvvc','charAt','setMinutes','viewOnceMessage','readFileSync','parentId','trim','editedMessage','getReactionMessage','No\x20result\x20from\x20synthesizer','setFfmpegPath','Mensagem\x20que\x20Desaparece','singleSelectReply','DAUMZAP','useIntegration','trace','getLocationMessage','##\x20if','changed','jidNormalizedUser','queue','Mensagem\x20não\x20encontrada!','\x201286\x20-\x20Entrei\x20na\x20integracao\x20openai.','test','search','promisify','queues','documentMessage','-open','Mensagem\x20editada\x20não\x20encontrada:\x20','liveLocationMessage','value','quarto\x20if','Expected\x20bodyMessage\x20to\x20be\x20a\x20string,\x20got:','button','text','handleMessageIntegration','(((.+)+)+)+$','companyId','userId','messages.update','resolve','pt-BR-FabioNeural','Pedido','ticketId','handleMsgAck','@g.us','webhook','find','company','primeiro\x20if','key','getTime','header','mediaPath','queueId','closed','getAudioMessage','selectedButtonId','findAll','randomValue','Error:\x20','createdAt','getIO','add','Erro\x20ao\x20salvar\x20mensagem!','validaCpfCnpj','-ticket','application/json','log','MESSAGE_EDIT','from','24IahLqb','sendMessage','logger','@sentry/node','enabled','.mp3','@whiskeysockets/baileys','messages.upsert','__importDefault','../../models/Campaign','ratingAt','isArray','toFixed',']\x20-\x20','E2E_IDENTITY_CHANGED','POST','1959656lIAEku','mp3','senderKeyDistributionMessage','isNull','advertising','../../libs/socket','148OwwsQa','WAMessageStubType','data:image/png;base64,\x20','getWbot','filter','OpenAIApi','listResponseMessage','ffmpeg-static','imageMessage','buttonsMessage','user','getQuotedMessageId','split','chatBotType','floor','endLunchTime','outOfHoursMessage','next','\x20]*\x20-\x20','EM_ANDAMENTO','base64','groups.update','application','close','Mensagem\x20inválida!','warn','Múltiplos\x20Produtos','url','now','greetingMediaAttachment','updatedAt','join','filename','getBodyButton','Error\x20converting\x20file:\x20','handleRating','contextInfo','highlyStructuredMessage','isNil','./providers','endTime','AudioConfig','integrationId','application/pdf','complationMessage','path','type','number','verifyQuotedMessage','fileName','sleep','mediaType','isBetween','stringify','maxTokens','botText','contacts:','../../models/QueueOption','audio/mpeg','urlN8N','voice','queueOptionId','catch','slice','keywords','env','E2E_DEVICE_CHANGED','videoMessage','temperature','\x20para\x20identificar\x20o\x20cliente.\x0aSua\x20resposta\x20deve\x20usar\x20no\x20máximo\x20','endsWith','pushName','status','externalAdReply','DispatchCampaign','isInteger','substring','ASC','hydratedTemplate','PENDING','degreesLongitude','1130zKAuHJ','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','data','constructor','CHATBOT_RESTRICT_NUMBER','isNaN','Mensagem','update!','Configuration','toUpperCase'];a559_0x29a6=function(){return _0x5b3fe7;};return a559_0x29a6();}'use strict';var __createBinding=this&&this['__createBinding']||(Object[a559_0x53de00(0x14f)]?function(_0x4e61bc,_0x54fec4,_0xe52ea4,_0x188a42){const _0x3f68d0=a559_0x53de00;if(_0x188a42===undefined)_0x188a42=_0xe52ea4;var _0xfe7909=Object[_0x3f68d0(0x117)](_0x54fec4,_0xe52ea4);(!_0xfe7909||('get'in _0xfe7909?!_0x54fec4[_0x3f68d0(0xf7)]:_0xfe7909[_0x3f68d0(0x104)]||_0xfe7909[_0x3f68d0(0x120)]))&&(_0xfe7909={'enumerable':!![],'get':function(){return _0x54fec4[_0xe52ea4];}}),Object[_0x3f68d0(0x7b)](_0x4e61bc,_0x188a42,_0xfe7909);}:function(_0x12c67e,_0x3974f6,_0x464942,_0x2f2042){if(_0x2f2042===undefined)_0x2f2042=_0x464942;_0x12c67e[_0x2f2042]=_0x3974f6[_0x464942];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a559_0x53de00(0x14f)]?function(_0x5280a0,_0xaef621){const _0x2bcf24=a559_0x53de00;Object[_0x2bcf24(0x7b)](_0x5280a0,_0x2bcf24(0x12b),{'enumerable':!![],'value':_0xaef621});}:function(_0x314bb6,_0x136afe){const _0x8423d6=a559_0x53de00;_0x314bb6[_0x8423d6(0x12b)]=_0x136afe;}),__importStar=this&&this['__importStar']||function(_0x2db46e){const _0x530a7e=a559_0x53de00;if(_0x2db46e&&_0x2db46e[_0x530a7e(0xf7)])return _0x2db46e;var _0x5d2884={};if(_0x2db46e!=null){for(var _0x1d100e in _0x2db46e)if(_0x1d100e!==_0x530a7e(0x12b)&&Object['prototype'][_0x530a7e(0x14d)][_0x530a7e(0x111)](_0x2db46e,_0x1d100e))__createBinding(_0x5d2884,_0x2db46e,_0x1d100e);}return __setModuleDefault(_0x5d2884,_0x2db46e),_0x5d2884;},__importDefault=this&&this[a559_0x53de00(0x1b1)]||function(_0x264d98){const _0xbdc052=a559_0x53de00;return _0x264d98&&_0x264d98[_0xbdc052(0xf7)]?_0x264d98:{'default':_0x264d98};};Object[a559_0x53de00(0x7b)](exports,'__esModule',{'value':!![]}),exports['wbotMessageListener']=exports[a559_0x53de00(0xd6)]=exports[a559_0x53de00(0xd0)]=exports[a559_0x53de00(0x18e)]=exports['handleMessage']=exports[a559_0x53de00(0x185)]=exports[a559_0x53de00(0x1e2)]=exports['verifyRating']=exports[a559_0x53de00(0xac)]=exports[a559_0x53de00(0x23a)]=exports[a559_0x53de00(0x1ef)]=exports[a559_0x53de00(0x1ca)]=exports[a559_0x53de00(0xaa)]=exports[a559_0x53de00(0x81)]=exports[a559_0x53de00(0xd5)]=exports['sendMessageLink']=exports[a559_0x53de00(0x95)]=exports[a559_0x53de00(0x1f1)]=exports['validaCpfCnpj']=exports['removeNonPrintableChars']=exports[a559_0x53de00(0x11b)]=void 0x0;const path_1=__importStar(require(a559_0x53de00(0x1ec))),util_1=require('util'),fs_1=require('fs'),Sentry=__importStar(require(a559_0x53de00(0x1ac))),lodash_1=require(a559_0x53de00(0xec)),baileys_1=require(a559_0x53de00(0x1af)),MessageUtils=__importStar(require(a559_0x53de00(0x106))),stream_throttle_1=require('stream-throttle'),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require(a559_0x53de00(0x84))),Message_1=__importDefault(require(a559_0x53de00(0x80))),OldMessage_1=__importDefault(require('../../models/OldMessage')),socket_1=require(a559_0x53de00(0x1be)),CreateMessageService_1=__importDefault(require(a559_0x53de00(0x21f))),logger_1=require(a559_0x53de00(0xd1)),CreateOrUpdateContactService_1=__importDefault(require('../ContactServices/CreateOrUpdateContactService')),FindOrCreateTicketService_1=__importDefault(require('../TicketServices/FindOrCreateTicketService')),ShowWhatsAppService_1=__importDefault(require(a559_0x53de00(0x13c))),UpdateTicketService_1=__importDefault(require(a559_0x53de00(0x8a))),Mustache_1=__importDefault(require(a559_0x53de00(0xc7))),UserRating_1=__importDefault(require(a559_0x53de00(0x100))),SendWhatsAppMessage_1=__importDefault(require(a559_0x53de00(0xca))),moment_1=__importDefault(require(a559_0x53de00(0x13f))),Queue_1=__importDefault(require(a559_0x53de00(0x131))),QueueOption_1=__importDefault(require(a559_0x53de00(0x1f8))),FindOrCreateATicketTrakingService_1=__importDefault(require(a559_0x53de00(0x90))),VerifyCurrentSchedule_1=__importDefault(require('../CompanyService/VerifyCurrentSchedule')),Campaign_1=__importDefault(require(a559_0x53de00(0x1b2))),CampaignShipping_1=__importDefault(require(a559_0x53de00(0x97))),sequelize_1=require('sequelize'),queues_1=require(a559_0x53de00(0xff)),User_1=__importDefault(require('../../models/User')),Setting_1=__importDefault(require('../../models/Setting')),cache_1=require(a559_0x53de00(0x12c)),Debounce_1=require(a559_0x53de00(0xcf)),openai_1=require(a559_0x53de00(0xc6)),fluent_ffmpeg_1=__importDefault(require(a559_0x53de00(0x94))),microsoft_cognitiveservices_speech_sdk_1=require(a559_0x53de00(0x221)),providers_1=require(a559_0x53de00(0x1e6)),typebotListener_1=__importDefault(require(a559_0x53de00(0x9e))),ShowQueueIntegrationService_1=__importDefault(require('../QueueIntegrationServices/ShowQueueIntegrationService')),SendWhatsAppMedia_1=require(a559_0x53de00(0x152)),fs_2=__importDefault(require('fs')),request_1=__importDefault(require(a559_0x53de00(0xbf))),ffmpeg_static_1=__importDefault(require(a559_0x53de00(0x1c6))),app_1=__importDefault(require(a559_0x53de00(0x236))),mime_1=__importDefault(require(a559_0x53de00(0x230))),wbot_1=require('../../libs/wbot'),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus'),MakeRandomId_1=require('../../helpers/MakeRandomId');fluent_ffmpeg_1[a559_0x53de00(0x12b)][a559_0x53de00(0x16b)](ffmpeg_static_1[a559_0x53de00(0x12b)]);const sessionsOpenAi=[],isNumeric=_0x37b376=>/^-?\d+$/[a559_0x53de00(0x178)](_0x37b376);exports[a559_0x53de00(0x11b)]=isNumeric;let outOfHourMessageControl=[],completionMessageControl=[],greetingMessageControl=[],farewellMessageControl=[];const writeFileAsync=(0x0,util_1[a559_0x53de00(0x17a)])(fs_1[a559_0x53de00(0xf4)]),getTypeMessage=_0x18bc44=>{const _0x104c65=a559_0x53de00;return(0x0,baileys_1['getContentType'])(_0x18bc44[_0x104c65(0xbe)]);},removeNonPrintableChars=_0x4058d4=>{const _0x2785a3=a559_0x53de00;return _0x4058d4[_0x2785a3(0x15d)](/[\x00-\x1F\x7F-\x9F]/g,'');};exports[a559_0x53de00(0xc0)]=removeNonPrintableChars;async function getQueues(_0x5039d4){const _0x3e7ea6=a559_0x53de00;try{const _0x179906=await Queue_1['default'][_0x3e7ea6(0x19c)]({'where':{'companyId':_0x5039d4}});return _0x179906;}catch(_0x5b389c){return console[_0x3e7ea6(0x9a)]('Failed\x20to\x20fetch\x20queues:',_0x5b389c),[];}}async function getContactFromTicket(_0x20eb1b){const _0x432a90=a559_0x53de00;try{const _0x398b3e=await Ticket_1[_0x432a90(0x12b)]['findByPk'](_0x20eb1b,{'include':[{'model':Contact_1[_0x432a90(0x12b)],'as':_0x432a90(0x22e)}]});return _0x398b3e&&_0x398b3e[_0x432a90(0x22e)]?_0x398b3e[_0x432a90(0x22e)]:(console[_0x432a90(0x1a6)](_0x432a90(0x233)),null);}catch(_0x5057d5){return console[_0x432a90(0x9a)](_0x432a90(0xe9),_0x5057d5),null;}}function validaCpfCnpj(_0xb7985b){const _0x14e828=a559_0x53de00;if(_0xb7985b[_0x14e828(0xeb)]==0xb){var _0x1240c0=_0xb7985b[_0x14e828(0x167)]();_0x1240c0=_0x1240c0[_0x14e828(0x15d)](/\./g,''),_0x1240c0=_0x1240c0['replace']('-',''),_0x1240c0=_0x1240c0['split']('');var _0x5b278e=0x0,_0x468223=0x0,_0x4cd91c=![];for(var _0x16baf3=0x1;_0x1240c0['length']>_0x16baf3;_0x16baf3++){_0x1240c0[_0x16baf3-0x1]!=_0x1240c0[_0x16baf3]&&(_0x4cd91c=!![]);}if(_0x4cd91c==![])return![];for(var _0x16baf3=0x0,_0x1f6812=0xa;_0x1240c0[_0x14e828(0xeb)]-0x2>_0x16baf3;_0x16baf3++,_0x1f6812--){_0x5b278e+=_0x1240c0[_0x16baf3]*_0x1f6812;}_0x5b278e=_0x5b278e*0xa%0xb;_0x5b278e==0xa&&(_0x5b278e=0x0);if(_0x5b278e!=_0x1240c0[0x9])return![];for(var _0x16baf3=0x0,_0x1f6812=0xb;_0x1240c0[_0x14e828(0xeb)]-0x1>_0x16baf3;_0x16baf3++,_0x1f6812--){_0x468223+=_0x1240c0[_0x16baf3]*_0x1f6812;}return _0x468223=_0x468223*0xa%0xb,_0x468223==0xa&&(_0x468223=0x0),_0x468223!=_0x1240c0[0xa]?![]:!![];}else{if(_0xb7985b[_0x14e828(0xeb)]==0xe){var _0x578a20=_0xb7985b[_0x14e828(0x167)]();_0x578a20=_0x578a20[_0x14e828(0x15d)](/\./g,''),_0x578a20=_0x578a20['replace']('-',''),_0x578a20=_0x578a20[_0x14e828(0x15d)]('/',''),_0x578a20=_0x578a20['split']('');var _0x5b278e=0x0,_0x468223=0x0,_0x4cd91c=![];for(var _0x16baf3=0x1;_0x578a20[_0x14e828(0xeb)]>_0x16baf3;_0x16baf3++){_0x578a20[_0x16baf3-0x1]!=_0x578a20[_0x16baf3]&&(_0x4cd91c=!![]);}if(_0x4cd91c==![])return![];for(var _0x16baf3=0x0,_0x21a1b0=0x5,_0x4552a0=0xd;_0x578a20[_0x14e828(0xeb)]-0x2>_0x16baf3;_0x16baf3++,_0x21a1b0--,_0x4552a0--){_0x21a1b0>=0x2?_0x5b278e+=_0x578a20[_0x16baf3]*_0x21a1b0:_0x5b278e+=_0x578a20[_0x16baf3]*_0x4552a0;}_0x5b278e=_0x5b278e%0xb;_0x5b278e<0x2?_0x5b278e=0x0:_0x5b278e=0xb-_0x5b278e;if(_0x5b278e!=_0x578a20[0xc])return![];for(var _0x16baf3=0x0,_0x21a1b0=0x6,_0x4552a0=0xe;_0x578a20['length']-0x1>_0x16baf3;_0x16baf3++,_0x21a1b0--,_0x4552a0--){_0x21a1b0>=0x2?_0x468223+=_0x578a20[_0x16baf3]*_0x21a1b0:_0x468223+=_0x578a20[_0x16baf3]*_0x4552a0;}return _0x468223=_0x468223%0xb,_0x468223<0x2?_0x468223=0x0:_0x468223=0xb-_0x468223,_0x468223!=_0x578a20[0xd]?![]:!![];}else return![];}}exports[a559_0x53de00(0x1a3)]=validaCpfCnpj;function timeout(_0x1c032f){return new Promise(_0x4aed3c=>setTimeout(_0x4aed3c,_0x1c032f));}async function sleep(_0x4d08b3){await timeout(_0x4d08b3);}exports[a559_0x53de00(0x1f1)]=sleep;const sendMessageImage=async(_0x10476f,_0x5cab70,_0x476a28,_0x1ceed9,_0x275107)=>{const _0x537612=a559_0x53de00;let _0x56ff70;try{_0x56ff70=await _0x10476f[_0x537612(0x1aa)](_0x5cab70['number']+'@'+(_0x476a28[_0x537612(0x140)]?'g.us':_0x537612(0x7f)),{'image':_0x1ceed9?{'url':_0x1ceed9}:fs_2[_0x537612(0x12b)][_0x537612(0x165)](_0x537612(0xdb)+_0x275107+'-'+makeid(0xa)),'fileName':_0x275107,'caption':_0x275107,'mimetype':_0x537612(0x88)});}catch(_0x19fecd){_0x56ff70=await _0x10476f['sendMessage'](_0x5cab70['number']+'@'+(_0x476a28[_0x537612(0x140)]?'g.us':_0x537612(0x7f)),{'text':(0x0,Mustache_1[_0x537612(0x12b)])(_0x537612(0x93),_0x476a28)});}(0x0,exports['verifyMessage'])(_0x56ff70,_0x476a28,_0x5cab70);};exports['sendMessageImage']=sendMessageImage;const sendMessageLink=async(_0x5e38ac,_0x49f4a7,_0x2e593e,_0x551640,_0x1bfc6b)=>{const _0x22aa7d=a559_0x53de00;let _0x1a2432;try{_0x1a2432=await _0x5e38ac[_0x22aa7d(0x1aa)](_0x49f4a7[_0x22aa7d(0x1ee)]+'@'+(_0x2e593e[_0x22aa7d(0x140)]?'g.us':_0x22aa7d(0x7f)),{'document':_0x551640?{'url':_0x551640}:fs_2['default'][_0x22aa7d(0x165)](_0x22aa7d(0xdb)+_0x1bfc6b+'-'+makeid(0xa)),'fileName':_0x1bfc6b,'caption':_0x1bfc6b,'mimetype':_0x22aa7d(0x1ea)});}catch(_0x3fd82e){_0x1a2432=await _0x5e38ac[_0x22aa7d(0x1aa)](_0x49f4a7[_0x22aa7d(0x1ee)]+'@'+(_0x2e593e[_0x22aa7d(0x140)]?_0x22aa7d(0x14b):_0x22aa7d(0x7f)),{'text':(0x0,Mustache_1['default'])(_0x22aa7d(0x93),_0x2e593e)});}(0x0,exports[_0x22aa7d(0x23a)])(_0x1a2432,_0x2e593e,_0x49f4a7);};exports['sendMessageLink']=sendMessageLink;function makeid(_0x398c6e){const _0x58172f=a559_0x53de00;var _0x5b4683='',_0x4adade=_0x58172f(0xf8),_0x3e882f=_0x4adade[_0x58172f(0xeb)];for(var _0x248b96=0x0;_0x248b96<_0x398c6e;_0x248b96++){_0x5b4683+=_0x4adade[_0x58172f(0x162)](Math[_0x58172f(0x1cd)](Math[_0x58172f(0x8e)]()*_0x3e882f));}return _0x5b4683;}exports[a559_0x53de00(0xd5)]=makeid;const msgLocation=(_0x1848d0,_0x7b9bf,_0x3af877)=>{const _0x526dad=a559_0x53de00;if(_0x1848d0){var _0x527db5=Buffer[_0x526dad(0x1a8)](_0x1848d0)[_0x526dad(0x136)](_0x526dad(0x1d3));let _0x46d6c3=_0x526dad(0x1c1)+_0x527db5+_0x526dad(0x224)+_0x7b9bf+_0x526dad(0x126)+_0x3af877+_0x526dad(0x11e)+_0x7b9bf+',\x20'+_0x3af877+'\x20';return _0x46d6c3;}},getBodyMessage=_0x21235d=>{const _0x196576=a559_0x53de00;try{let _0x2ca443=getTypeMessage(_0x21235d);const _0x1d9d6e={'conversation':MessageUtils[_0x196576(0xc1)](_0x21235d),'editedMessage':_0x21235d?.[_0x196576(0xbe)]?.[_0x196576(0x168)]?.['message']?.[_0x196576(0xbb)]?.['editedMessage']?.[_0x196576(0xa6)]||_0x21235d?.[_0x196576(0xbe)]?.['editedMessage']?.[_0x196576(0xbe)]?.[_0x196576(0xc4)]?.[_0x196576(0x184)],'imageMessage':MessageUtils['getImageMessage'](_0x21235d),'videoMessage':MessageUtils['getVideoMessage'](_0x21235d),'extendedTextMessage':_0x21235d[_0x196576(0xbe)]?.[_0x196576(0xc4)]?.[_0x196576(0x184)],'buttonsResponseMessage':MessageUtils[_0x196576(0xe5)](_0x21235d),'templateButtonReplyMessage':_0x21235d[_0x196576(0xbe)]?.['templateButtonReplyMessage']?.['selectedId'],'messageContextInfo':_0x21235d['message']?.[_0x196576(0x149)]?.['selectedButtonId']||_0x21235d['message']?.[_0x196576(0x1c5)]?.[_0x196576(0x23f)],'buttonsMessage':MessageUtils[_0x196576(0x1e0)](_0x21235d)||_0x21235d[_0x196576(0xbe)]?.['listResponseMessage']?.[_0x196576(0x16d)]?.[_0x196576(0x15b)],'viewOnceMessage':MessageUtils[_0x196576(0xbc)](_0x21235d),'viewOnceMessageV2':MessageUtils['getViewOnceMessageV2'](_0x21235d),'stickerMessage':MessageUtils[_0x196576(0x10e)](_0x21235d),'contactMessage':MessageUtils['getContactMessage'](_0x21235d),'contactsArrayMessage':_0x21235d[_0x196576(0xbe)]?.['contactsArrayMessage']?.[_0x196576(0xb1)]&&MessageUtils['getContactsArrayMessage'](_0x21235d),'pollCreationMessageV2':_0x21235d[_0x196576(0xbe)]?.[_0x196576(0xa3)]?.[_0x196576(0x11f)]||_0x196576(0x239),'pollCreationMessageV3':_0x21235d[_0x196576(0xbe)]?.[_0x196576(0x10f)]?.[_0x196576(0x11f)]||_0x196576(0x239),'interactiveMessage':_0x21235d['message']?.[_0x196576(0x13b)]?.[_0x196576(0x107)]||_0x21235d['message']?.[_0x196576(0x13b)]?.[_0x196576(0x1e3)]||'Mensagem\x20interativa\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','locationMessage':MessageUtils[_0x196576(0x171)](_0x21235d),'liveLocationMessage':_0x196576(0x150)+_0x21235d['message']?.[_0x196576(0x17f)]?.[_0x196576(0x103)]+_0x196576(0x138)+_0x21235d['message']?.[_0x196576(0x17f)]?.[_0x196576(0x20f)],'documentMessage':MessageUtils['getDocumentMessage'](_0x21235d),'documentWithCaptionMessage':_0x21235d[_0x196576(0xbe)]?.[_0x196576(0x82)]?.[_0x196576(0xbe)]?.[_0x196576(0x17c)]?.[_0x196576(0x7e)],'audioMessage':MessageUtils[_0x196576(0x19a)](_0x21235d),'ephemeralMessage':_0x21235d[_0x196576(0xbe)]?.[_0x196576(0x220)]?.[_0x196576(0xbe)]?.[_0x196576(0xc4)]?.[_0x196576(0x184)],'listMessage':MessageUtils[_0x196576(0x1e0)](_0x21235d)||_0x21235d[_0x196576(0xbe)]?.[_0x196576(0x1c5)]?.[_0x196576(0x23f)],'listResponseMessage':MessageUtils[_0x196576(0xd3)](_0x21235d),'reactionMessage':MessageUtils[_0x196576(0x169)](_0x21235d)||_0x196576(0x146),'advertising':MessageUtils[_0x196576(0x15c)](_0x21235d)||_0x21235d[_0x196576(0xbe)]?.[_0x196576(0x1c5)]?.['contextInfo']?.[_0x196576(0x208)]?.[_0x196576(0x23f)],'productMessage':_0x21235d[_0x196576(0xbe)]?.['productMessage']?.[_0x196576(0xe1)]?.['productImage']?.['caption']||'Produto','multiProductMessage':_0x196576(0x1d9),'orderMessage':_0x196576(0x18c),'paymentMessage':MessageUtils[_0x196576(0x141)](_0x21235d),'paymentRequestMessage':_0x196576(0x8b),'groupInviteMessage':MessageUtils['getGroupInviteMessage'](_0x21235d),'revokeInviteMessage':'Convite\x20Revogado','protocolMessage':_0x21235d[_0x196576(0xbe)]?.[_0x196576(0xbb)]?.[_0x196576(0x168)]?.[_0x196576(0xa6)]||null,'disappearingMessage':_0x196576(0x16c),'callMessage':MessageUtils['getCallMessage'](_0x21235d),'templateMessage':MessageUtils['getTemplateMessage'](_0x21235d),'statusUpdateMessage':_0x196576(0x129)};return _0x1d9d6e[_0x2ca443]||null;}catch(_0x17b405){return console[_0x196576(0x9a)]('Error\x20getting\x20message\x20body:',_0x17b405),null;}};exports['getBodyMessage']=getBodyMessage;const getQuotedMessage=_0x253c8a=>{const _0x7b2254=a559_0x53de00,_0x2d611d=_0x253c8a[_0x7b2254(0xbe)][_0x7b2254(0x1c7)]['contextInfo']||_0x253c8a['message']['videoMessage'][_0x7b2254(0x1e3)]||_0x253c8a[_0x7b2254(0xbe)]?.[_0x7b2254(0x17c)]||_0x253c8a[_0x7b2254(0xbe)][_0x7b2254(0xc4)][_0x7b2254(0x1e3)]||_0x253c8a[_0x7b2254(0xbe)]['buttonsResponseMessage'][_0x7b2254(0x1e3)]||_0x253c8a[_0x7b2254(0xbe)][_0x7b2254(0x1c5)][_0x7b2254(0x1e3)]||_0x253c8a[_0x7b2254(0xbe)]['templateButtonReplyMessage'][_0x7b2254(0x1e3)]||_0x253c8a[_0x7b2254(0xbe)][_0x7b2254(0x149)]?.[_0x7b2254(0x1e3)]||_0x253c8a?.[_0x7b2254(0xbe)]?.[_0x7b2254(0x149)]?.[_0x7b2254(0x19b)]||_0x253c8a[_0x7b2254(0xbe)][_0x7b2254(0x1c5)]?.['singleSelectReply']?.[_0x7b2254(0x15b)]||_0x253c8a?.[_0x7b2254(0xbe)]?.[_0x7b2254(0x1c5)]?.[_0x7b2254(0x16d)][_0x7b2254(0x15b)]||_0x253c8a[_0x7b2254(0xbe)]['listResponseMessage']?.[_0x7b2254(0x1e3)];return _0x253c8a[_0x7b2254(0xbe)][_0x7b2254(0x1bb)],(0x0,baileys_1[_0x7b2254(0x122)])(_0x2d611d[Object[_0x7b2254(0x229)](_0x2d611d)[_0x7b2254(0x109)]()[_0x7b2254(0x1d0)]()[_0x7b2254(0x180)]]);};exports[a559_0x53de00(0xaa)]=getQuotedMessage;const getQuotedMessageId=_0x4b0ab9=>{const _0x26fd85=a559_0x53de00,_0x3243ee=(0x0,baileys_1[_0x26fd85(0x122)])(_0x4b0ab9[_0x26fd85(0xbe)])[Object['keys'](_0x4b0ab9?.['message'])[_0x26fd85(0x109)]()[_0x26fd85(0x1d0)]()['value']];let _0x35bdd7=_0x4b0ab9?.[_0x26fd85(0xbe)]?.[_0x26fd85(0xe3)]?_0x4b0ab9?.['message']?.[_0x26fd85(0xe3)]?.['key']?.['id']:'';return _0x35bdd7?_0x35bdd7:_0x3243ee?.[_0x26fd85(0x1e3)]?.[_0x26fd85(0xb4)];};exports[a559_0x53de00(0x1ca)]=getQuotedMessageId;const getMeSocket=_0x425b15=>{const _0x32712b=a559_0x53de00;return{'id':(0x0,baileys_1[_0x32712b(0x174)])(_0x425b15[_0x32712b(0x1c9)]['id']),'name':_0x425b15[_0x32712b(0x1c9)][_0x32712b(0x11f)]};},getSenderMessage=(_0xae02c1,_0x547d4a)=>{const _0x14cec2=a559_0x53de00,_0x6e0229=getMeSocket(_0x547d4a);if(_0xae02c1[_0x14cec2(0x194)][_0x14cec2(0xf0)])return _0x6e0229['id'];const _0x999c48=_0xae02c1[_0x14cec2(0xea)]||_0xae02c1['key'][_0x14cec2(0xea)]||_0xae02c1[_0x14cec2(0x194)][_0x14cec2(0x98)]||undefined;return _0x999c48&&(0x0,baileys_1[_0x14cec2(0x174)])(_0x999c48);},getContactMessage=async(_0x7bb288,_0x1e420d)=>{const _0x3c6525=a559_0x53de00,_0x16c3aa=_0x7bb288[_0x3c6525(0x194)]['remoteJid']['includes'](_0x3c6525(0x14b)),_0x32a1ff=_0x7bb288[_0x3c6525(0x194)][_0x3c6525(0x98)][_0x3c6525(0x15d)](/\D/g,'');return _0x16c3aa?{'id':getSenderMessage(_0x7bb288,_0x1e420d),'name':_0x7bb288[_0x3c6525(0x206)]}:{'id':_0x7bb288['key'][_0x3c6525(0x98)],'name':_0x7bb288[_0x3c6525(0x194)][_0x3c6525(0xf0)]?_0x32a1ff:_0x7bb288['pushName']};},getUnpackedMessage=_0x5c8361=>{const _0x3ee6f3=a559_0x53de00;return _0x5c8361['message']?.[_0x3ee6f3(0x82)]?.[_0x3ee6f3(0xbe)]||_0x5c8361[_0x3ee6f3(0xbe)]?.[_0x3ee6f3(0xc4)]?.['contextInfo']?.[_0x3ee6f3(0xf6)]||_0x5c8361[_0x3ee6f3(0xbe)]?.['ephemeralMessage']?.[_0x3ee6f3(0xbe)]||_0x5c8361[_0x3ee6f3(0xbe)]?.[_0x3ee6f3(0x164)]?.[_0x3ee6f3(0xbe)]||_0x5c8361[_0x3ee6f3(0xbe)]?.[_0x3ee6f3(0x144)]?.[_0x3ee6f3(0xbe)]||_0x5c8361[_0x3ee6f3(0xbe)]?.[_0x3ee6f3(0x220)]?.['message']||_0x5c8361[_0x3ee6f3(0xbe)]?.['templateMessage']?.[_0x3ee6f3(0x20d)]||_0x5c8361[_0x3ee6f3(0xbe)]?.[_0x3ee6f3(0x151)]?.['hydratedFourRowTemplate']||_0x5c8361[_0x3ee6f3(0xbe)]?.[_0x3ee6f3(0x151)]?.['fourRowTemplate']||_0x5c8361['message']?.[_0x3ee6f3(0x13b)]?.[_0x3ee6f3(0x196)]||_0x5c8361[_0x3ee6f3(0xbe)]?.[_0x3ee6f3(0x1e4)]?.[_0x3ee6f3(0x121)]?.['hydratedTemplate']||_0x5c8361['message'];},getMessageMedia=_0x2cfab2=>{const _0x16bd55=a559_0x53de00;return _0x2cfab2?.[_0x16bd55(0x1c7)]||_0x2cfab2?.[_0x16bd55(0x125)]||_0x2cfab2?.['videoMessage']||_0x2cfab2?.[_0x16bd55(0x112)]||_0x2cfab2?.[_0x16bd55(0x17c)]||null;},downloadMedia=async _0x38800c=>{const _0x236a1b=a559_0x53de00,_0x5b4f49=getUnpackedMessage(_0x38800c),_0x525caf=getMessageMedia(_0x5b4f49);if(!_0x525caf)return null;const _0x2929bf=_0x5b4f49?.[_0x236a1b(0x17c)]?_0x236a1b(0x13e):_0x525caf[_0x236a1b(0x89)][_0x236a1b(0x1cb)]('/')[0x0]['replace'](_0x236a1b(0x1d5),_0x236a1b(0x13e))?_0x525caf[_0x236a1b(0x89)]['split']('/')[0x0][_0x236a1b(0x15d)]('application',_0x236a1b(0x13e)):_0x525caf[_0x236a1b(0x89)][_0x236a1b(0x1cb)]('/')[0x0];let _0x2c9985,_0x27e76f=0x0;while(_0x27e76f<0xa&&!_0x2c9985){try{_0x525caf?.[_0x236a1b(0xe4)]&&(_0x525caf[_0x236a1b(0x1da)]=''),_0x2c9985=await(0x0,baileys_1['downloadContentFromMessage'])(_0x525caf,_0x2929bf);}catch(_0x3c143c){_0x27e76f+=0x1,await new Promise(_0x1da1e4=>{setTimeout(_0x1da1e4,0x3e8*_0x27e76f*0x2);}),logger_1[_0x236a1b(0x1ab)][_0x236a1b(0x1d8)](_0x236a1b(0xfc)+_0x27e76f+_0x236a1b(0xdd)+_0x38800c?.[_0x236a1b(0x194)]?.['id']);}}if(!_0x2c9985)throw new Error(_0x236a1b(0x22d));let _0x56b2a1=_0x5b4f49?.[_0x236a1b(0x17c)]?.[_0x236a1b(0x1f0)]||'';if(!_0x56b2a1){const _0xf8af43=mime_1['default'][_0x236a1b(0xa8)](_0x525caf[_0x236a1b(0x89)]);_0x56b2a1=(0x0,MakeRandomId_1[_0x236a1b(0xe6)])(0x5)+'-'+new Date()[_0x236a1b(0x195)]()+'.'+_0xf8af43;}else _0x56b2a1=_0x56b2a1[_0x236a1b(0x1cb)]('.')[_0x236a1b(0x1fe)](0x0,-0x1)[_0x236a1b(0x1de)]('.')+'.'+(0x0,MakeRandomId_1['makeRandomId'])(0x5)+'.'+_0x56b2a1[_0x236a1b(0x1cb)]('.')['slice'](-0x1);const _0x4bb656=0x5*0x400*0x400/0x8,_0x36d8cb=0x400*0x400/0x8,_0x5d7a0c=0x400*0x400,_0x512a16=new stream_throttle_1['Throttle']({'rate':_0x4bb656});let _0x5ad46b=Buffer['from']([]),_0xc350=0x0;const _0x11ec61=Date[_0x236a1b(0x1db)]();try{for await(const _0x28cb19 of _0x2c9985[_0x236a1b(0x9f)](_0x512a16)){_0x5ad46b=Buffer['concat']([_0x5ad46b,_0x28cb19]),_0xc350+=_0x28cb19['length'],_0xc350>_0x5d7a0c&&(_0x512a16['rate']=_0x36d8cb);}}catch(_0x10960e){return{'data':_0x236a1b(0x9a),'mimetype':'','filename':''};}const _0x302709=Date[_0x236a1b(0x1db)](),_0x3c0df0=(_0x302709-_0x11ec61)/0x3e8,_0x5ba022=_0xc350/_0x3c0df0;logger_1['logger'][_0x236a1b(0xd2)](_0x56b2a1+'\x20Download\x20completed\x20in\x20'+_0x3c0df0[_0x236a1b(0x1b5)](0x2)+_0x236a1b(0xb0)+(_0x5ba022/0x400/0x400)[_0x236a1b(0x1b5)](0x2)+_0x236a1b(0x142));if(!_0x5ad46b){Sentry[_0x236a1b(0x127)](_0x236a1b(0x15f),{'msg':_0x38800c}),Sentry[_0x236a1b(0x8f)](new Error(_0x236a1b(0x15f)));throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');}const _0x5390a8={'data':_0x5ad46b,'mimetype':_0x525caf[_0x236a1b(0x89)],'filename':_0x56b2a1};return _0x5390a8;},verifyContact=async(_0x935a12,_0x5dc629,_0x45baf6)=>{const _0x482227=a559_0x53de00,_0x20e132={'name':_0x935a12?.[_0x482227(0x11f)]||_0x935a12['id'][_0x482227(0x15d)](/\D/g,''),'number':_0x935a12['id'][_0x482227(0x20b)](0x0,_0x935a12['id'][_0x482227(0x232)]('@')),'isGroup':_0x935a12['id']['includes'](_0x482227(0x14b)),'companyId':_0x45baf6,'whatsappId':_0x5dc629['id']},_0x1269ac=(0x0,CreateOrUpdateContactService_1[_0x482227(0x12b)])(_0x20e132,_0x5dc629,_0x935a12['id']);return _0x1269ac;},verifyQuotedMessage=async _0x40e202=>{const _0x5ad234=a559_0x53de00;if(!_0x40e202)return null;const _0x13cdfc=(0x0,exports[_0x5ad234(0x1ca)])(_0x40e202);if(!_0x13cdfc)return null;const _0x1532f0=await Message_1[_0x5ad234(0x12b)][_0x5ad234(0x157)]({'where':{'id':_0x13cdfc}});if(!_0x1532f0)return null;return _0x1532f0;};exports[a559_0x53de00(0x1ef)]=verifyQuotedMessage;const sanitizeName=_0x11a873=>{const _0x275c80=a559_0x53de00;let _0xf19a38=_0x11a873[_0x275c80(0x1cb)]('\x20')[0x0];return _0xf19a38=_0xf19a38[_0x275c80(0x15d)](/[^a-zA-Z0-9]/g,''),_0xf19a38[_0x275c80(0x20b)](0x0,0x3c);},convertTextToSpeechAndSaveToFile=(_0x4c9e79,_0x4b45b6,_0x505775,_0x1bd204,_0xe79b8c=a559_0x53de00(0x18b),_0x231bfd='mp3')=>{return new Promise((_0x51a217,_0x1442c1)=>{const _0x2035fb=a559_0x5eea,_0x51004f=microsoft_cognitiveservices_speech_sdk_1['SpeechConfig'][_0x2035fb(0x228)](_0x505775,_0x1bd204);_0x51004f[_0x2035fb(0xdf)]=_0xe79b8c;const _0x1a74ce=microsoft_cognitiveservices_speech_sdk_1[_0x2035fb(0x1e8)][_0x2035fb(0x108)](_0x4b45b6+'.wav'),_0x451106=new microsoft_cognitiveservices_speech_sdk_1[(_0x2035fb(0x118))](_0x51004f,_0x1a74ce);_0x451106[_0x2035fb(0x132)](_0x4c9e79,_0x4d8478=>{const _0x2f92d3=_0x2035fb;_0x4d8478?convertWavToAnotherFormat(_0x4b45b6+'.wav',_0x4b45b6+'.'+_0x231bfd,_0x231bfd)[_0x2f92d3(0xed)](_0x597b9b=>{_0x51a217();})[_0x2f92d3(0x1fd)](_0x422580=>{const _0x5665e0=_0x2f92d3;console[_0x5665e0(0x9a)](_0x422580),_0x1442c1(_0x422580);}):_0x1442c1(new Error(_0x2f92d3(0x16a))),_0x451106[_0x2f92d3(0x1d6)]();},_0x187822=>{const _0x5e4dcc=_0x2035fb;console[_0x5e4dcc(0x9a)](_0x5e4dcc(0x19e)+_0x187822),_0x451106[_0x5e4dcc(0x1d6)](),_0x1442c1(_0x187822);});});},convertWavToAnotherFormat=(_0x3cee72,_0x16f46d,_0x455101)=>{return new Promise((_0x2cc543,_0x313d88)=>{const _0x2d07a8=a559_0x5eea;(0x0,fluent_ffmpeg_1['default'])()['input'](_0x3cee72)[_0x2d07a8(0xdc)](_0x455101)['on'](_0x2d07a8(0xa7),()=>_0x2cc543(_0x16f46d))['on']('error',_0x485e82=>_0x313d88(new Error(_0x2d07a8(0x1e1)+_0x485e82[_0x2d07a8(0xbe)])))['save'](_0x16f46d);});},deleteFileSync=_0x4ca131=>{const _0x50f283=a559_0x53de00;try{fs_2[_0x50f283(0x12b)][_0x50f283(0x242)](_0x4ca131);}catch(_0x18b3d5){console[_0x50f283(0x9a)]('Erro\x20ao\x20deletar\x20o\x20arquivo:',_0x18b3d5);}},keepOnlySpecifiedChars=_0x2eb154=>{return _0x2eb154['replace'](/[^a-zA-Z0-9áéíóúÁÉÍÓÚâêîôûÂÊÎÔÛãõÃÕçÇ!?.,;:\s]/g,'');},handleOpenAi=async(_0x153916,_0x5ad94f,_0x59afed,_0x140b70,_0xc66a34)=>{const _0x420ef2=a559_0x53de00,_0x11d6f3=(0x0,exports[_0x420ef2(0x81)])(_0x153916);if(!_0x11d6f3)return;let {prompt:_0x294417}=await(0x0,ShowWhatsAppService_1[_0x420ef2(0x12b)])(_0x5ad94f['id'],_0x59afed[_0x420ef2(0x187)]);!_0x294417&&!(0x0,lodash_1['isNil'])(_0x59afed?.[_0x420ef2(0x175)]?.['prompt'])&&(_0x294417=_0x59afed[_0x420ef2(0x175)][_0x420ef2(0xce)]);if(!_0x294417)return;if(_0x153916[_0x420ef2(0xc3)])return;const _0x4dc55a=path_1[_0x420ef2(0x12b)][_0x420ef2(0x18a)](__dirname,'..','..','..',_0x420ef2(0x119));let _0x4d4179;const _0xc75b25=sessionsOpenAi['findIndex'](_0x3283a3=>_0x3283a3['id']===_0x5ad94f['id']);if(_0xc75b25===-0x1){const _0x1f8562=new openai_1[(_0x420ef2(0x218))]({'apiKey':_0x294417['apiKey']});_0x4d4179=new openai_1[(_0x420ef2(0x1c4))](_0x1f8562),_0x4d4179['id']=_0x5ad94f['id'],sessionsOpenAi[_0x420ef2(0x87)](_0x4d4179);}else _0x4d4179=sessionsOpenAi[_0xc75b25];const _0x5d54ef=await Message_1[_0x420ef2(0x12b)][_0x420ef2(0x19c)]({'where':{'ticketId':_0x59afed['id']},'order':[[_0x420ef2(0x19f),'ASC']],'limit':_0x294417[_0x420ef2(0x130)]}),_0x342de6='Nas\x20respostas\x20utilize\x20o\x20nome\x20'+sanitizeName(_0x140b70[_0x420ef2(0x11f)]||_0x420ef2(0xb7))+_0x420ef2(0x204)+_0x294417[_0x420ef2(0x1f5)]+'\x20tokens\x20e\x20cuide\x20para\x20não\x20truncar\x20o\x20final.\x0aSempre\x20que\x20possível,\x20mencione\x20o\x20nome\x20dele\x20para\x20ser\x20mais\x20personalizado\x20o\x20atendimento\x20e\x20mais\x20educado.\x20Quando\x20a\x20resposta\x20requer\x20uma\x20transferência\x20para\x20o\x20setor\x20de\x20atendimento,\x20comece\x20sua\x20resposta\x20com\x20\x27Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento\x27.\x0a\x0a\x20\x20'+_0x294417[_0x420ef2(0xce)]+'\x0a';let _0x2f04a8=[];if(_0x153916['message']?.['conversation']||_0x153916['message']?.[_0x420ef2(0xc4)]?.[_0x420ef2(0x184)]){_0x2f04a8=[],_0x2f04a8[_0x420ef2(0x87)]({'role':_0x420ef2(0x99),'content':_0x342de6});for(let _0x653ad5=0x0;_0x653ad5<Math[_0x420ef2(0xf5)](_0x294417['maxMessages'],_0x5d54ef[_0x420ef2(0xeb)]);_0x653ad5++){const _0x398525=_0x5d54ef[_0x653ad5];_0x398525[_0x420ef2(0x1f2)]==='chat'&&(_0x398525[_0x420ef2(0xf0)]?_0x2f04a8[_0x420ef2(0x87)]({'role':_0x420ef2(0x14c),'content':_0x398525[_0x420ef2(0x107)]}):_0x2f04a8[_0x420ef2(0x87)]({'role':_0x420ef2(0x1c9),'content':_0x398525[_0x420ef2(0x107)]}));}_0x2f04a8[_0x420ef2(0x87)]({'role':_0x420ef2(0x1c9),'content':_0x11d6f3});const _0x34ef65=await _0x4d4179[_0x420ef2(0xa9)]({'model':_0x420ef2(0xb9),'messages':_0x2f04a8,'max_tokens':_0x294417[_0x420ef2(0x1f5)],'temperature':_0x294417[_0x420ef2(0x203)]});let _0x58d722=_0x34ef65['data'][_0x420ef2(0x96)][0x0][_0x420ef2(0xbe)]?.[_0x420ef2(0x10a)];_0x58d722?.[_0x420ef2(0x22b)](_0x420ef2(0x231))&&(await transferQueue(_0x294417[_0x420ef2(0x198)],_0x59afed,_0x140b70),_0x58d722=_0x58d722[_0x420ef2(0x15d)]('Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','')[_0x420ef2(0x167)]());if(_0x294417[_0x420ef2(0x1fb)]===_0x420ef2(0x154)){const _0x3289ca=await _0x5ad94f[_0x420ef2(0x1aa)](_0x153916['key']['remoteJid'],{'text':_0x58d722});await(0x0,exports['verifyMessage'])(_0x3289ca,_0x59afed,_0x140b70);}else{const _0x50b649=_0x59afed['id']+'_'+Date['now']();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x58d722),_0x4dc55a+'/'+_0x50b649,_0x294417[_0x420ef2(0x128)],_0x294417[_0x420ef2(0xde)],_0x294417[_0x420ef2(0x1fb)],_0x420ef2(0x1ba))['then'](async()=>{const _0x256c1d=_0x420ef2;try{const _0x5e1187=await _0x5ad94f[_0x256c1d(0x1aa)](_0x153916[_0x256c1d(0x194)]['remoteJid'],{'audio':{'url':_0x4dc55a+'/'+_0x50b649+_0x256c1d(0x1ae)},'mimetype':'audio/mpeg','ptt':!![]});await verifyMediaMessage(_0x5e1187,_0x59afed,_0x140b70),deleteFileSync(_0x4dc55a+'/'+_0x50b649+_0x256c1d(0x1ae)),deleteFileSync(_0x4dc55a+'/'+_0x50b649+_0x256c1d(0x156));}catch(_0x49db5e){console[_0x256c1d(0x1a6)](_0x256c1d(0x92)+_0x49db5e);}});}}else{if(_0x153916['message']?.[_0x420ef2(0x125)]){const _0x4ac3c0=_0xc66a34['mediaUrl'][_0x420ef2(0x1cb)]('/')['pop'](),_0x1b1642=fs_2['default'][_0x420ef2(0x114)](_0x4dc55a+'/'+_0x4ac3c0),_0x30a597=await _0x4d4179[_0x420ef2(0xd7)](_0x1b1642,_0x420ef2(0xf3));_0x2f04a8=[],_0x2f04a8[_0x420ef2(0x87)]({'role':'system','content':_0x342de6});for(let _0x371ebe=0x0;_0x371ebe<Math['min'](_0x294417[_0x420ef2(0x130)],_0x5d54ef[_0x420ef2(0xeb)]);_0x371ebe++){const _0xa1f5b4=_0x5d54ef[_0x371ebe];_0xa1f5b4['mediaType']===_0x420ef2(0x116)&&(_0xa1f5b4[_0x420ef2(0xf0)]?_0x2f04a8['push']({'role':_0x420ef2(0x14c),'content':_0xa1f5b4[_0x420ef2(0x107)]}):_0x2f04a8[_0x420ef2(0x87)]({'role':'user','content':_0xa1f5b4[_0x420ef2(0x107)]}));}_0x2f04a8[_0x420ef2(0x87)]({'role':_0x420ef2(0x1c9),'content':_0x30a597[_0x420ef2(0x212)][_0x420ef2(0x184)]});const _0x3880ae=await _0x4d4179[_0x420ef2(0xa9)]({'model':_0x420ef2(0xb9),'messages':_0x2f04a8,'max_tokens':_0x294417['maxTokens'],'temperature':_0x294417[_0x420ef2(0x203)]});let _0x1ce6c8=_0x3880ae['data'][_0x420ef2(0x96)][0x0]['message']?.['content'];_0x1ce6c8?.[_0x420ef2(0x22b)](_0x420ef2(0x231))&&(await transferQueue(_0x294417[_0x420ef2(0x198)],_0x59afed,_0x140b70),_0x1ce6c8=_0x1ce6c8[_0x420ef2(0x15d)](_0x420ef2(0x231),'')[_0x420ef2(0x167)]());if(_0x294417['voice']===_0x420ef2(0x154)){const _0x4676df=await _0x5ad94f[_0x420ef2(0x1aa)](_0x153916['key'][_0x420ef2(0x98)],{'text':_0x1ce6c8});await(0x0,exports['verifyMessage'])(_0x4676df,_0x59afed,_0x140b70);}else{const _0x13b5d6=_0x59afed['id']+'_'+Date['now']();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x1ce6c8),_0x4dc55a+'/'+_0x13b5d6,_0x294417[_0x420ef2(0x128)],_0x294417['voiceRegion'],_0x294417['voice'],_0x420ef2(0x1ba))['then'](async()=>{const _0x5cc480=_0x420ef2;try{const _0xb8d12e=await _0x5ad94f[_0x5cc480(0x1aa)](_0x153916[_0x5cc480(0x194)]['remoteJid'],{'audio':{'url':_0x4dc55a+'/'+_0x13b5d6+_0x5cc480(0x1ae)},'mimetype':_0x5cc480(0x1f9),'ptt':!![]});await verifyMediaMessage(_0xb8d12e,_0x59afed,_0x140b70),deleteFileSync(_0x4dc55a+'/'+_0x13b5d6+_0x5cc480(0x1ae)),deleteFileSync(_0x4dc55a+'/'+_0x13b5d6+_0x5cc480(0x156));}catch(_0x4f8aa4){console['log'](_0x5cc480(0x92)+_0x4f8aa4);}});}}}_0x2f04a8=[];},transferQueue=async(_0x5482fc,_0x1648b6,_0x4260a4)=>{const _0x36891e=a559_0x53de00;console['trace'](_0x36891e(0x217)),await(0x0,UpdateTicketService_1[_0x36891e(0x12b)])({'ticketData':{'queueId':_0x5482fc,'useIntegration':![],'promptId':null},'ticketId':_0x1648b6['id'],'companyId':_0x1648b6[_0x36891e(0x187)]});},verifyMediaMessage=async(_0x5a88b0,_0x3dcf4b,_0x5c590a)=>{const _0x1531b5=a559_0x53de00,_0x42c55f=(0x0,socket_1[_0x1531b5(0x1a0)])();let _0x23621a=await Message_1['default'][_0x1531b5(0x157)]({'where':{'id':_0x5a88b0[_0x1531b5(0x194)]['id']}});if(!_0x23621a){const _0x59b852=await(0x0,exports[_0x1531b5(0x1ef)])(_0x5a88b0),_0x3a9bc8=(0x0,wbot_1[_0x1531b5(0x1c2)])(_0x3dcf4b[_0x1531b5(0x21b)]),_0x28d1ab=await downloadMedia(_0x5a88b0);if(!_0x28d1ab)throw new Error(_0x1531b5(0x15f));if(!_0x28d1ab['filename']){const _0x31f0cd=typeof _0x28d1ab['mimetype']===_0x1531b5(0x226)&&_0x28d1ab['mimetype']['includes']('/')&&_0x28d1ab[_0x1531b5(0x89)][_0x1531b5(0x22b)](';')?mime_1[_0x1531b5(0x12b)]['extension'](_0x28d1ab['mimetype']):_0x1531b5(0x123);_0x28d1ab['filename']=new Date()[_0x1531b5(0x195)]()+'.'+_0x31f0cd;}else{let _0x2b934d=_0x28d1ab[_0x1531b5(0x1df)]?'-'+_0x28d1ab['filename']:'';_0x28d1ab[_0x1531b5(0x1df)]=''+new Date()[_0x1531b5(0x195)]()+_0x2b934d;}try{const _0x271847=_0x1531b5(0xb2)+_0x3dcf4b[_0x1531b5(0x187)];!fs_2[_0x1531b5(0x12b)][_0x1531b5(0x160)](_0x271847)&&(fs_2['default']['mkdirSync'](_0x271847),fs_2[_0x1531b5(0x12b)][_0x1531b5(0xbd)](_0x271847,0x1ff)),await writeFileAsync((0x0,path_1[_0x1531b5(0x1de)])(__dirname,'..','..','..',_0x271847,_0x28d1ab[_0x1531b5(0x1df)]),_0x28d1ab[_0x1531b5(0x212)],'base64');}catch(_0x37596b){Sentry[_0x1531b5(0x8f)](_0x37596b),logger_1[_0x1531b5(0x1ab)][_0x1531b5(0x9a)](_0x37596b);}const _0x1267d1=(0x0,exports[_0x1531b5(0x81)])(_0x5a88b0);var _0x23de25=getTypeMessage(_0x5a88b0);const _0x528305={'id':_0x5a88b0['key']['id'],'ticketId':_0x3dcf4b['id'],'contactId':_0x5a88b0[_0x1531b5(0x194)]['fromMe']?undefined:_0x5c590a['id'],'body':_0x1267d1?(0x0,Mustache_1[_0x1531b5(0x12b)])(_0x1267d1,_0x3dcf4b):_0x28d1ab['filename'],'fromMe':_0x5a88b0[_0x1531b5(0x194)][_0x1531b5(0xf0)],'read':_0x5a88b0[_0x1531b5(0x194)][_0x1531b5(0xf0)],'mediaUrl':_0x28d1ab['filename'],'mediaType':typeof _0x28d1ab[_0x1531b5(0x89)]===_0x1531b5(0x226)?_0x28d1ab[_0x1531b5(0x89)][_0x1531b5(0x1cb)]('/')[0x0]:_0x1531b5(0x123),'quotedMsgId':_0x59b852?.['id'],'ack':getStatus(_0x5a88b0,'media'),'remoteJid':_0x5a88b0[_0x1531b5(0x194)]['remoteJid'],'participant':_0x5a88b0[_0x1531b5(0x194)]['participant'],'dataJson':JSON[_0x1531b5(0x1f4)](_0x5a88b0)};var _0x27c1f3=_0x1267d1||_0x28d1ab['filename'];typeof _0x27c1f3!=_0x1531b5(0x226)&&console[_0x1531b5(0x170)](_0x1531b5(0xee),_0x27c1f3),await _0x3dcf4b['update']({'lastMessage':_0x27c1f3}),_0x23621a=await(0x0,CreateMessageService_1[_0x1531b5(0x12b)])({'messageData':_0x528305,'ticket':_0x3dcf4b,'companyId':_0x3dcf4b[_0x1531b5(0x187)]});}else typeof _0x23621a[_0x1531b5(0x107)]!=_0x1531b5(0x226)&&console[_0x1531b5(0x170)](_0x1531b5(0xee),_0x23621a[_0x1531b5(0x107)]),await _0x3dcf4b['update']({'lastMessage':_0x23621a[_0x1531b5(0x107)]}),_0x23621a[_0x1531b5(0xa4)]=getStatus(_0x5a88b0,_0x1531b5(0xd8)),_0x23621a[_0x1531b5(0xea)]=_0x5a88b0[_0x1531b5(0x194)][_0x1531b5(0xea)],_0x23621a[_0x1531b5(0x10b)]=JSON[_0x1531b5(0x1f4)](_0x5a88b0),await _0x23621a['save']();return!_0x5a88b0[_0x1531b5(0x194)]['fromMe']&&_0x3dcf4b['status']==='closed'&&(await _0x3dcf4b[_0x1531b5(0x21e)]({'status':_0x1531b5(0x7c)}),await _0x3dcf4b[_0x1531b5(0x11d)]({'include':[{'model':Queue_1[_0x1531b5(0x12b)],'as':_0x1531b5(0x175)},{'model':User_1[_0x1531b5(0x12b)],'as':_0x1531b5(0x1c9)},{'model':Contact_1[_0x1531b5(0x12b)],'as':_0x1531b5(0x22e)}]}),_0x42c55f['to'](_0x1531b5(0x105)+_0x3dcf4b['companyId']+_0x1531b5(0xd4))['emit'](_0x1531b5(0x105)+_0x3dcf4b['companyId']+'-ticket',{'action':_0x1531b5(0x11c),'ticket':_0x3dcf4b,'ticketId':_0x3dcf4b['id']}),_0x42c55f['to'](_0x1531b5(0x105)+_0x3dcf4b['companyId']+'-'+_0x3dcf4b[_0x1531b5(0x207)])['to'](_0x3dcf4b['id'][_0x1531b5(0x136)]())[_0x1531b5(0x223)](_0x1531b5(0x105)+_0x3dcf4b[_0x1531b5(0x187)]+'-ticket',{'action':_0x1531b5(0x21e),'ticket':_0x3dcf4b,'ticketId':_0x3dcf4b['id']})),_0x23621a;};function getStatus(_0x16daea,_0x139263){const _0x1a4351=a559_0x53de00;if(_0x16daea['status']==baileys_1[_0x1a4351(0xe0)][_0x1a4351(0xef)][_0x1a4351(0x101)][_0x1a4351(0x20e)]){if(_0x16daea[_0x1a4351(0x194)]['fromMe']&&_0x139263==_0x1a4351(0xe3))return 0x3;return 0x1;}else{if(_0x16daea[_0x1a4351(0x207)]==baileys_1[_0x1a4351(0xe0)]['WebMessageInfo']['Status']['SERVER_ACK'])return 0x1;else{if(_0x16daea[_0x1a4351(0x207)]==baileys_1[_0x1a4351(0xe0)]['WebMessageInfo'][_0x1a4351(0x101)][_0x1a4351(0xb5)])return 0x2;else{if(_0x16daea['status']==baileys_1[_0x1a4351(0xe0)][_0x1a4351(0xef)][_0x1a4351(0x101)][_0x1a4351(0xcc)]||_0x16daea[_0x1a4351(0x207)]==baileys_1[_0x1a4351(0xe0)][_0x1a4351(0xef)][_0x1a4351(0x101)][_0x1a4351(0xe8)])return 0x3;}}}return 0x0;}const verifyMessage=async(_0x118158,_0x2f8909,_0x241f3a)=>{const _0x403d4c=a559_0x53de00,_0x1d4e72=(0x0,socket_1['getIO'])(),_0xbae5ab=await(0x0,exports[_0x403d4c(0x1ef)])(_0x118158),_0x346d99=(0x0,exports[_0x403d4c(0x81)])(_0x118158);if(!_0x346d99)return;let _0x9b5fa2=getTypeMessage(_0x118158);const _0x2835cd=_0x9b5fa2==_0x403d4c(0x168)||_0x118158?.['message']?.[_0x403d4c(0xbb)]?.[_0x403d4c(0x1ed)]==baileys_1[_0x403d4c(0xe0)][_0x403d4c(0xc8)][_0x403d4c(0x139)][_0x403d4c(0xb3)][_0x403d4c(0x1a7)]||_0x118158?.[_0x403d4c(0xbe)]?.['protocolMessage']?.[_0x403d4c(0x168)]?.['conversation']?.[_0x403d4c(0xeb)]>0x0;let _0x4db480=_0x118158['key']['id'];if(_0x9b5fa2==_0x403d4c(0xbb))_0x4db480=_0x118158?.[_0x403d4c(0xbe)]?.[_0x403d4c(0xbb)]?.[_0x403d4c(0x194)]?.['id']||_0x118158[_0x403d4c(0x194)]['id'];else _0x9b5fa2==_0x403d4c(0x168)&&(_0x4db480=_0x118158?.[_0x403d4c(0xbe)]?.[_0x403d4c(0x168)]?.[_0x403d4c(0xbe)]?.[_0x403d4c(0xbb)]?.[_0x403d4c(0x194)]?.['id']||_0x118158[_0x403d4c(0x194)]['id']);const _0x21752d={'id':_0x4db480,'ticketId':_0x2f8909['id'],'contactId':_0x118158[_0x403d4c(0x194)][_0x403d4c(0xf0)]?undefined:_0x241f3a['id'],'body':_0x346d99,'fromMe':_0x118158['key'][_0x403d4c(0xf0)],'mediaType':_0x9b5fa2,'read':_0x118158[_0x403d4c(0x194)][_0x403d4c(0xf0)],'quotedMsgId':_0xbae5ab?.['id'],'ack':getStatus(_0x118158,_0x9b5fa2),'remoteJid':_0x118158[_0x403d4c(0x194)][_0x403d4c(0x98)],'participant':_0x118158[_0x403d4c(0x194)][_0x403d4c(0xea)],'dataJson':JSON[_0x403d4c(0x1f4)](_0x118158),'isEdited':_0x2835cd};typeof _0x346d99!=_0x403d4c(0x226)&&console[_0x403d4c(0x170)](_0x403d4c(0xee),_0x346d99);await _0x2f8909['update']({'lastMessage':_0x346d99});if(_0x2835cd){let _0x596e5a=await Message_1[_0x403d4c(0x12b)][_0x403d4c(0x12f)](_0x21752d['id']);if(_0x596e5a){const _0x3630af={'messageId':_0x21752d['id'],'body':_0x596e5a[_0x403d4c(0x107)]};await OldMessage_1[_0x403d4c(0x12b)][_0x403d4c(0x115)](_0x3630af);}else console['log'](_0x403d4c(0x17e)+_0x21752d['id']);}await(0x0,CreateMessageService_1[_0x403d4c(0x12b)])({'messageData':_0x21752d,'ticket':_0x2f8909,'companyId':_0x2f8909['companyId']}),!_0x118158[_0x403d4c(0x194)][_0x403d4c(0xf0)]&&_0x2f8909[_0x403d4c(0x207)]===_0x403d4c(0x199)&&(await _0x2f8909[_0x403d4c(0x21e)]({'status':_0x403d4c(0x7c)}),await _0x2f8909[_0x403d4c(0x11d)]({'include':[{'model':Queue_1[_0x403d4c(0x12b)],'as':'queue'},{'model':User_1[_0x403d4c(0x12b)],'as':_0x403d4c(0x1c9)},{'model':Contact_1[_0x403d4c(0x12b)],'as':_0x403d4c(0x22e)}]}),_0x1d4e72['to'](_0x403d4c(0x105)+_0x2f8909['companyId']+'-closed')[_0x403d4c(0x223)](_0x403d4c(0x105)+_0x2f8909['companyId']+_0x403d4c(0x1a4),{'action':'delete','ticket':_0x2f8909,'ticketId':_0x2f8909['id']}),_0x1d4e72['to'](_0x403d4c(0x105)+_0x2f8909[_0x403d4c(0x187)]+'-'+_0x2f8909['status'])['to'](_0x2f8909['id'][_0x403d4c(0x136)]())['emit'](_0x403d4c(0x105)+_0x2f8909[_0x403d4c(0x187)]+_0x403d4c(0x1a4),{'action':_0x403d4c(0x21e),'ticket':_0x2f8909,'ticketId':_0x2f8909['id']}));};exports[a559_0x53de00(0x23a)]=verifyMessage;const isValidMsg=_0x302472=>{const _0x5b5ebd=a559_0x53de00;if(_0x302472['key']['remoteJid']==='status@broadcast')return![];try{const _0x4dd07a=getTypeMessage(_0x302472);if(!_0x4dd07a)return![];const _0xe9e615=_0x4dd07a===_0x5b5ebd(0xa6)||_0x4dd07a==='editedMessage'||_0x4dd07a===_0x5b5ebd(0xc4)||_0x4dd07a==='audioMessage'||_0x4dd07a===_0x5b5ebd(0x202)||_0x4dd07a===_0x5b5ebd(0xa3)||_0x4dd07a==='templateMessage'||_0x4dd07a===_0x5b5ebd(0x10f)||_0x4dd07a===_0x5b5ebd(0x13b)||_0x4dd07a==='imageMessage'||_0x4dd07a===_0x5b5ebd(0x17c)||_0x4dd07a===_0x5b5ebd(0x82)||_0x4dd07a===_0x5b5ebd(0x112)||_0x4dd07a===_0x5b5ebd(0x149)||_0x4dd07a===_0x5b5ebd(0x1c8)||_0x4dd07a===_0x5b5ebd(0xfe)||_0x4dd07a===_0x5b5ebd(0xf9)||_0x4dd07a===_0x5b5ebd(0x17f)||_0x4dd07a===_0x5b5ebd(0xcd)||_0x4dd07a===_0x5b5ebd(0x9d)||_0x4dd07a==='mediaMessage'||_0x4dd07a==='contactsArrayMessage'||_0x4dd07a===_0x5b5ebd(0xe3)||_0x4dd07a===_0x5b5ebd(0x220)||_0x4dd07a===_0x5b5ebd(0xbb)||_0x4dd07a==='listResponseMessage'||_0x4dd07a===_0x5b5ebd(0xc5)||_0x4dd07a===_0x5b5ebd(0x164)||_0x4dd07a===_0x5b5ebd(0x144)||_0x4dd07a==='advertising'||_0x4dd07a==='highlyStructuredMessage';return!_0xe9e615&&(logger_1['logger']['warn'](_0x5b5ebd(0x21c)+_0x4dd07a+'\x0a'+JSON[_0x5b5ebd(0x1f4)](_0x302472?.[_0x5b5ebd(0xbe)])),Sentry[_0x5b5ebd(0x127)](_0x5b5ebd(0x216),{'BodyMsg':_0x302472[_0x5b5ebd(0xbe)],'msg':_0x302472,'msgType':_0x4dd07a}),Sentry[_0x5b5ebd(0x8f)](new Error(_0x5b5ebd(0x211)))),!!_0xe9e615;}catch(_0x1b4762){Sentry['setExtra'](_0x5b5ebd(0xba),{'msg':_0x302472}),Sentry[_0x5b5ebd(0x8f)](_0x1b4762);}return![];};function a559_0x5eea(_0x3fe07c,_0x558cc0){const _0xfd7aec=a559_0x29a6();return a559_0x5eea=function(_0x4104a5,_0x3f37c7){_0x4104a5=_0x4104a5-0x7b;let _0x29a610=_0xfd7aec[_0x4104a5];return _0x29a610;},a559_0x5eea(_0x3fe07c,_0x558cc0);}exports[a559_0x53de00(0xac)]=isValidMsg;const Push=_0x2acfbc=>{const _0x429157=a559_0x53de00;return _0x2acfbc[_0x429157(0x206)];},verifyQueue=async(_0x3ee9d3,_0x59107a,_0x1f7d5a,_0x38d9e3,_0x405552)=>{const _0x24e7c3=a559_0x53de00,_0x2c5ee0=_0x1f7d5a[_0x24e7c3(0x187)],{queues:_0x14bb55,greetingMessage:_0x359477,maxUseBotQueues:_0x5e1b3b,timeUseBotQueues:_0x2b0a7b}=await(0x0,ShowWhatsAppService_1['default'])(_0x3ee9d3['id'],_0x1f7d5a[_0x24e7c3(0x187)]);if(_0x14bb55[_0x24e7c3(0xeb)]===0x1){const _0x547d33=(0x0,lodash_1['head'])(_0x14bb55);let _0x1b03c4=![];_0x547d33?.['options']&&(_0x1b03c4=_0x547d33[_0x24e7c3(0xc9)][_0x24e7c3(0xeb)]>0x0);const _0x5102cb=await Setting_1[_0x24e7c3(0x12b)][_0x24e7c3(0x157)]({'where':{'key':_0x24e7c3(0x237),'companyId':_0x1f7d5a[_0x24e7c3(0x187)]}});greetingMessageControl['push']({'ticketId':_0x1f7d5a['id'],'greetingMessage':_0x359477,'companyId':_0x2c5ee0});if(_0x359477[_0x24e7c3(0xeb)]>0x1&&_0x5102cb?.['value']===_0x24e7c3(0x1ad)){const _0x114b65=await Message_1[_0x24e7c3(0x12b)][_0x24e7c3(0x157)]({'where':{'ticketId':_0x1f7d5a['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op']['gte']]:(0x0,moment_1[_0x24e7c3(0x12b)])()[_0x24e7c3(0x134)](0x5,_0x24e7c3(0xaf))['toDate']()}}});if(_0x114b65)return;const _0x365762=(0x0,Mustache_1[_0x24e7c3(0x12b)])(''+_0x359477,_0x1f7d5a);await _0x3ee9d3['sendMessage'](_0x38d9e3['number']+'@'+(_0x1f7d5a[_0x24e7c3(0x140)]?'g.us':_0x24e7c3(0x7f)),{'text':_0x365762});}const _0xde527=await(0x0,ShowWhatsAppService_1[_0x24e7c3(0x12b)])(_0x3ee9d3['id'],_0x2c5ee0),_0x4dc36d=_0x14bb55[0x0]?.['integrationId']||_0xde527[_0x24e7c3(0x1e9)];if(!_0x59107a[_0x24e7c3(0x194)][_0x24e7c3(0xf0)]&&!_0x1f7d5a[_0x24e7c3(0x140)]&&!(0x0,lodash_1[_0x24e7c3(0x1e5)])(_0x4dc36d)){const _0x4b1bae=await(0x0,ShowQueueIntegrationService_1[_0x24e7c3(0x12b)])(_0x4dc36d,_0x2c5ee0);await(0x0,exports['handleMessageIntegration'])(_0x59107a,_0x3ee9d3,_0x4b1bae,_0x1f7d5a),await _0x1f7d5a[_0x24e7c3(0x21e)]({'useIntegration':!![],'integrationId':_0x4b1bae['id']});}const _0x105208=_0x14bb55[0x0]?.[_0x24e7c3(0xa5)]||_0xde527[_0x24e7c3(0xa5)];!_0x59107a[_0x24e7c3(0x194)]['fromMe']&&!_0x1f7d5a[_0x24e7c3(0x140)]&&!(0x0,lodash_1[_0x24e7c3(0x1e5)])(_0x105208)&&(console[_0x24e7c3(0x1a6)](_0x24e7c3(0x177)),await handleOpenAi(_0x59107a,_0x3ee9d3,_0x1f7d5a,_0x38d9e3,_0x405552),await _0x1f7d5a[_0x24e7c3(0x21e)]({'useIntegration':!![],'promptId':_0x105208}));await(0x0,UpdateTicketService_1[_0x24e7c3(0x12b)])({'ticketData':{'queueId':_0x547d33?.['id'],'chatbot':_0x1b03c4,'status':_0x24e7c3(0x7c)},'ticketId':_0x1f7d5a['id'],'companyId':_0x1f7d5a['companyId']});return;}const _0x162016=_0x59107a?.[_0x24e7c3(0xbe)]?.[_0x24e7c3(0x149)]?.[_0x24e7c3(0x19b)]||_0x59107a?.[_0x24e7c3(0xbe)]?.[_0x24e7c3(0x1c5)]?.[_0x24e7c3(0x16d)]?.[_0x24e7c3(0x15b)]||_0x59107a?.['message']?.['extendedTextMessage']?.['text']||_0x59107a?.[_0x24e7c3(0xbe)]?.[_0x24e7c3(0xa6)];let _0x3d4f8c=null;if(_0x162016&&!(0x0,exports[_0x24e7c3(0x11b)])(_0x162016)||+_0x162016>_0x14bb55['length']){const _0x2ec5e3=_0x162016['toLowerCase']();for(let _0x57af63 of _0x14bb55){if(_0x57af63[_0x24e7c3(0x11f)][_0x24e7c3(0x13d)]()===_0x2ec5e3){_0x3d4f8c=_0x57af63;break;}if(_0x57af63[_0x24e7c3(0x1ff)]&&_0x57af63[_0x24e7c3(0x1ff)][_0x24e7c3(0xeb)]>0x0){let _0x2676aa=_0x57af63['keywords'][_0x24e7c3(0x1cb)](',\x20');for(let _0x16e671 of _0x2676aa){if(_0x16e671['toLowerCase']()==_0x2ec5e3){_0x3d4f8c=_0x57af63;break;}}}}}else _0x3d4f8c=_0x14bb55[+_0x162016-0x1];const _0x1c7ffd=await Setting_1['default'][_0x24e7c3(0x157)]({'where':{'key':_0x24e7c3(0x1cc),'companyId':_0x2c5ee0}}),_0x3d74e8=async()=>{const _0x5a7f8c=_0x24e7c3;let _0x3a8e47='';if(outOfHourMessageControl[_0x5a7f8c(0xeb)]>0x1388)outOfHourMessageControl=[];_0x14bb55['forEach']((_0x5e32fa,_0x2fd31f)=>{const _0xed51ad=_0x5a7f8c;_0x3a8e47+=_0xed51ad(0x137)+(_0x2fd31f+0x1)+_0xed51ad(0x1d1)+_0x5e32fa[_0xed51ad(0x11f)]+'\x0a';});if(process[_0x5a7f8c(0x200)][_0x5a7f8c(0x214)]?.[_0x5a7f8c(0xeb)]>=0x8){if(_0x1f7d5a[_0x5a7f8c(0x22e)][_0x5a7f8c(0x1ee)]!=process[_0x5a7f8c(0x200)][_0x5a7f8c(0x214)]){console[_0x5a7f8c(0x170)](_0x5a7f8c(0xfa));return;}}const _0x53228e={'text':(0x0,Mustache_1[_0x5a7f8c(0x12b)])('‎'+_0x359477+'\x0a\x0a'+_0x3a8e47,_0x1f7d5a)};await(0x0,UpdateTicketService_1[_0x5a7f8c(0x12b)])({'ticketData':{'amountUsedBotQueues':_0x1f7d5a[_0x5a7f8c(0xda)]+0x1},'ticketId':_0x1f7d5a['id'],'companyId':_0x1f7d5a[_0x5a7f8c(0x187)]});const _0x1faec6=await _0x3ee9d3['sendMessage'](_0x38d9e3['number']+'@'+(_0x1f7d5a['isGroup']?_0x5a7f8c(0x14b):_0x5a7f8c(0x7f)),_0x53228e);await(0x0,exports[_0x5a7f8c(0x23a)])(_0x1faec6,_0x1f7d5a,_0x1f7d5a[_0x5a7f8c(0x22e)]);};if(_0x3d4f8c){let _0x1f9e53=![];_0x3d4f8c?.[_0x24e7c3(0xc9)]&&(_0x1f9e53=_0x3d4f8c[_0x24e7c3(0xc9)]['length']>0x0);await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x3d4f8c['id'],'chatbot':_0x1f9e53,'status':_0x24e7c3(0x7c),'amountUsedBotQueues':0x0},'ticketId':_0x1f7d5a['id'],'companyId':_0x1f7d5a[_0x24e7c3(0x187)]}),console[_0x24e7c3(0x170)](_0x3d4f8c[_0x24e7c3(0xc9)]);if(_0x3d4f8c[_0x24e7c3(0xc9)][_0x24e7c3(0xeb)]===0x0){const _0x477ad7=await Queue_1[_0x24e7c3(0x12b)]['findByPk'](_0x3d4f8c['id']),{schedules:_0x6aa5f9}=_0x477ad7,_0x397827=(0x0,moment_1['default'])(),_0x135c05=_0x397827[_0x24e7c3(0xe7)]('dddd')[_0x24e7c3(0x13d)]();let _0x16fd30;Array[_0x24e7c3(0x1b4)](_0x6aa5f9)&&_0x6aa5f9[_0x24e7c3(0xeb)]>0x0&&(_0x16fd30=_0x6aa5f9['find'](_0x50ad76=>_0x50ad76[_0x24e7c3(0xb6)]===_0x135c05&&_0x50ad76[_0x24e7c3(0xc2)]!==''&&_0x50ad76['startTime']!==null&&_0x50ad76[_0x24e7c3(0x1e7)]!==''&&_0x50ad76[_0x24e7c3(0x1e7)]!==null));if(_0x477ad7[_0x24e7c3(0x1cf)]!==null&&_0x477ad7[_0x24e7c3(0x1cf)]!==''&&!(0x0,lodash_1[_0x24e7c3(0x1e5)])(_0x16fd30)){var _0x33970f=outOfHourMessageControl['find'](_0x3f737a=>_0x3f737a[_0x24e7c3(0x18d)]===_0x1f7d5a['id']||_0x3f737a[_0x24e7c3(0x22a)]===_0x38d9e3[_0x24e7c3(0x1ee)]);if(!_0x33970f||_0x33970f&&_0x33970f[_0x24e7c3(0x21a)]+0x3e8*0x3c*0x5<new Date()[_0x24e7c3(0x195)]()){_0x33970f&&(outOfHourMessageControl=outOfHourMessageControl[_0x24e7c3(0x1c3)](_0x15f5f5=>_0x15f5f5['ticketId']!==_0x1f7d5a['id']),_0x33970f=null);const _0x125c12=(0x0,moment_1[_0x24e7c3(0x12b)])(_0x16fd30[_0x24e7c3(0xc2)],_0x24e7c3(0x240)),_0x2ddd4=(0x0,moment_1[_0x24e7c3(0x12b)])(_0x16fd30['endTime'],'HH:mm');outOfHourMessageControl[_0x24e7c3(0x87)]({'ticketId':_0x1f7d5a['id'],'time':new Date()[_0x24e7c3(0x195)]()});if(_0x397827[_0x24e7c3(0x12a)](_0x125c12)||_0x397827[_0x24e7c3(0xad)](_0x2ddd4)){const _0x3572aa=(0x0,Mustache_1[_0x24e7c3(0x12b)])('‎\x20'+_0x477ad7['outOfHoursMessage']+_0x24e7c3(0x155),_0x1f7d5a),_0x5910fd=await _0x3ee9d3[_0x24e7c3(0x1aa)](_0x38d9e3[_0x24e7c3(0x1ee)]+'@'+(_0x1f7d5a[_0x24e7c3(0x140)]?'g.us':_0x24e7c3(0x7f)),{'text':_0x3572aa});await(0x0,exports[_0x24e7c3(0x23a)])(_0x5910fd,_0x1f7d5a,_0x38d9e3),await(0x0,UpdateTicketService_1[_0x24e7c3(0x12b)])({'ticketData':{'queueId':null,'chatbot':_0x1f9e53},'ticketId':_0x1f7d5a['id'],'companyId':_0x1f7d5a['companyId']}),console[_0x24e7c3(0x1a6)](_0x24e7c3(0x153));return;}}!_0x33970f&&outOfHourMessageControl[_0x24e7c3(0x87)]({'ticketId':_0x1f7d5a['id'],'dest':_0x38d9e3[_0x24e7c3(0x1ee)],'time':new Date()[_0x24e7c3(0x195)]()});}console['trace'](_0x3d4f8c[_0x24e7c3(0x1e9)]);if(!_0x59107a['key'][_0x24e7c3(0xf0)]&&!_0x1f7d5a[_0x24e7c3(0x140)]&&_0x3d4f8c[_0x24e7c3(0x1e9)]){const _0x33b280=await(0x0,ShowQueueIntegrationService_1[_0x24e7c3(0x12b)])(_0x3d4f8c['integrationId'],_0x2c5ee0);await(0x0,exports[_0x24e7c3(0x185)])(_0x59107a,_0x3ee9d3,_0x33b280,_0x1f7d5a),await _0x1f7d5a[_0x24e7c3(0x21e)]({'useIntegration':!![],'integrationId':_0x33b280['id']});}!_0x59107a[_0x24e7c3(0x194)]['fromMe']&&!_0x1f7d5a[_0x24e7c3(0x140)]&&!(0x0,lodash_1[_0x24e7c3(0x1e5)])(_0x3d4f8c?.[_0x24e7c3(0xa5)])&&(await handleOpenAi(_0x59107a,_0x3ee9d3,_0x1f7d5a,_0x38d9e3,_0x405552),await _0x1f7d5a[_0x24e7c3(0x21e)]({'useIntegration':!![],'promptId':_0x3d4f8c?.[_0x24e7c3(0xa5)]}));const _0x5ce533=(0x0,Mustache_1['default'])('‎'+_0x3d4f8c[_0x24e7c3(0x8d)],_0x1f7d5a);if(_0x3d4f8c[_0x24e7c3(0x8d)]){const _0x2adff6=await _0x3ee9d3[_0x24e7c3(0x1aa)](_0x38d9e3[_0x24e7c3(0x1ee)]+'@'+(_0x1f7d5a[_0x24e7c3(0x140)]?_0x24e7c3(0x14b):'s.whatsapp.net'),{'text':_0x5ce533});await(0x0,exports['verifyMessage'])(_0x2adff6,_0x1f7d5a,_0x38d9e3);if(_0x3d4f8c[_0x24e7c3(0x197)]!==null&&_0x3d4f8c[_0x24e7c3(0x197)]!==''){const _0x3ef781=path_1[_0x24e7c3(0x12b)][_0x24e7c3(0x18a)](_0x24e7c3(0x119),_0x24e7c3(0x192)+_0x3d4f8c[_0x24e7c3(0x187)],_0x3d4f8c[_0x24e7c3(0x197)]),_0x41e771=await(0x0,SendWhatsAppMedia_1[_0x24e7c3(0x13a)])(_0x3d4f8c[_0x24e7c3(0x23d)],_0x3ef781,null,_0x1f7d5a['companyId']);let _0x319cbe=await _0x3ee9d3[_0x24e7c3(0x1aa)](_0x1f7d5a[_0x24e7c3(0x22e)][_0x24e7c3(0x1ee)]+'@'+(_0x1f7d5a[_0x24e7c3(0x140)]?_0x24e7c3(0x14b):_0x24e7c3(0x7f)),{..._0x41e771});await verifyMediaMessage(_0x319cbe,_0x1f7d5a,_0x38d9e3);}}}}else{if(_0x5e1b3b&&_0x5e1b3b!==0x0&&_0x1f7d5a['amountUsedBotQueues']>=_0x5e1b3b)return;const _0x536883=await(0x0,FindOrCreateATicketTrakingService_1[_0x24e7c3(0x12b)])({'ticketId':_0x1f7d5a['id'],'companyId':_0x2c5ee0});let _0x27792=new Date(),_0x19fa7c=new Date();if(_0x536883['chatbotAt']!==null){_0x27792[_0x24e7c3(0x163)](_0x536883['chatbotAt']['getMinutes']()+Number(_0x2b0a7b));if(_0x536883['chatbotAt']!==null&&_0x19fa7c<_0x27792&&_0x2b0a7b!=='0'&&_0x1f7d5a['amountUsedBotQueues']!==0x0)return;}await _0x536883[_0x24e7c3(0x21e)]({'updatedAt':new Date()});if(_0x1c7ffd[_0x24e7c3(0x180)]==='text')return console['trace'](_0x24e7c3(0x1f6)),_0x3d74e8();}},verifyRating=_0xb84f3a=>{const _0x40e71f=a559_0x53de00;return _0xb84f3a&&_0xb84f3a['finishedAt']===null&&_0xb84f3a['userId']!==null&&_0xb84f3a[_0x40e71f(0x1b3)]!==null;};exports[a559_0x53de00(0xf1)]=verifyRating;const handleRating=async(_0x58fffe,_0x5d0d79,_0x5a3156)=>{const _0x41c3bb=a559_0x53de00,_0x320d33=(0x0,socket_1[_0x41c3bb(0x1a0)])();let _0x19fdb3=null;(_0x58fffe?.[_0x41c3bb(0xbe)]?.[_0x41c3bb(0xa6)]||_0x58fffe?.[_0x41c3bb(0xbe)]?.[_0x41c3bb(0xc4)])&&(_0x19fdb3=parseInt(_0x58fffe[_0x41c3bb(0xbe)][_0x41c3bb(0xa6)]||_0x58fffe[_0x41c3bb(0xbe)]['extendedTextMessage'][_0x41c3bb(0x184)],0xa)||null);if(!Number[_0x41c3bb(0x215)](_0x19fdb3)&&Number[_0x41c3bb(0x20a)](_0x19fdb3)&&!(0x0,lodash_1[_0x41c3bb(0x1bc)])(_0x19fdb3)){const {complationMessage:_0x12c29a}=await(0x0,ShowWhatsAppService_1[_0x41c3bb(0x12b)])(_0x5d0d79[_0x41c3bb(0x21b)],_0x5d0d79['companyId']);let _0xccda31=_0x19fdb3;_0x19fdb3<0x1&&(_0xccda31=0x1);_0x19fdb3>0x5&&(_0xccda31=0x5);await UserRating_1[_0x41c3bb(0x12b)][_0x41c3bb(0x14f)]({'ticketId':_0x5a3156[_0x41c3bb(0x18d)],'companyId':_0x5a3156['companyId'],'userId':_0x5a3156[_0x41c3bb(0x188)],'rate':_0xccda31});if(_0x12c29a){if(completionMessageControl[_0x41c3bb(0xeb)]>=0x9c4)completionMessageControl=[];var _0x1f05cf=completionMessageControl['find'](_0x509f3d=>_0x509f3d['ticketId']===_0x5d0d79['id']||_0x509f3d[_0x41c3bb(0x22a)]===_0x5d0d79[_0x41c3bb(0x22e)][_0x41c3bb(0x1ee)]);if(!_0x1f05cf||_0x1f05cf&&_0x1f05cf[_0x41c3bb(0x21a)]+0x3e8*0x3c*0x1e<new Date()[_0x41c3bb(0x195)]()){_0x1f05cf&&(completionMessageControl=completionMessageControl[_0x41c3bb(0x1c3)](_0x4b9b5d=>_0x4b9b5d['ticketId']!==_0x5d0d79['id']),_0x1f05cf=null);const _0x1a5655=(0x0,Mustache_1[_0x41c3bb(0x12b)])('‎'+_0x12c29a,_0x5d0d79);await(0x0,SendPresenceStatus_1['SendPresenceStatus'])((0x0,wbot_1[_0x41c3bb(0x1c2)])(_0x5d0d79[_0x41c3bb(0x21b)]),_0x5d0d79[_0x41c3bb(0x22e)][_0x41c3bb(0x1ee)]+'@'+(_0x5d0d79[_0x41c3bb(0x140)]?_0x41c3bb(0x14b):_0x41c3bb(0x7f))),await(0x0,SendWhatsAppMessage_1[_0x41c3bb(0x12b)])({'body':_0x1a5655,'ticket':_0x5d0d79});}!_0x1f05cf&&completionMessageControl[_0x41c3bb(0x87)]({'ticketId':_0x5d0d79['id'],'dest':_0x5d0d79['contact'][_0x41c3bb(0x1ee)],'time':new Date()[_0x41c3bb(0x195)]()});}await _0x5a3156[_0x41c3bb(0x21e)]({'finishedAt':(0x0,moment_1[_0x41c3bb(0x12b)])()[_0x41c3bb(0x10c)](),'ratedAt':(0x0,moment_1[_0x41c3bb(0x12b)])()['toDate'](),'rated':!![]}),await _0x5d0d79['update']({'queueId':null,'chatbot':null,'queueOptionId':null,'userId':null,'status':_0x41c3bb(0x199)}),_0x320d33['to'](_0x41c3bb(0x105)+_0x5d0d79[_0x41c3bb(0x187)]+_0x41c3bb(0x17d))[_0x41c3bb(0x223)](_0x41c3bb(0x105)+_0x5d0d79['companyId']+'-ticket',{'action':'delete','ticket':_0x5d0d79,'ticketId':_0x5d0d79['id']}),_0x320d33['to'](_0x41c3bb(0x105)+_0x5d0d79[_0x41c3bb(0x187)]+'-'+_0x5d0d79['status'])['to'](_0x5d0d79['id'][_0x41c3bb(0x136)]())[_0x41c3bb(0x223)](_0x41c3bb(0x105)+_0x5d0d79['companyId']+_0x41c3bb(0x1a4),{'action':_0x41c3bb(0x21e),'ticket':_0x5d0d79,'ticketId':_0x5d0d79['id']});}};exports[a559_0x53de00(0x1e2)]=handleRating;const handleChartbot=async(_0x1646c8,_0x4bbc9c,_0x5c7c9b,_0x5c4dfd,_0x16623e=![])=>{const _0x2e1068=a559_0x53de00;if(!_0x1646c8[_0x2e1068(0x22e)]['disableBot']){const _0x5f14c6=await Queue_1[_0x2e1068(0x12b)]['findByPk'](_0x1646c8[_0x2e1068(0x198)],{'include':[{'model':QueueOption_1['default'],'as':'options','where':{'parentId':null},'order':[['option',_0x2e1068(0x20c)],[_0x2e1068(0x19f),_0x2e1068(0x20c)]]}]}),_0x82c233=_0x4bbc9c?.[_0x2e1068(0xbe)]?.['buttonsResponseMessage']?.[_0x2e1068(0x19b)]||_0x4bbc9c?.[_0x2e1068(0xbe)]?.[_0x2e1068(0x1c5)]?.[_0x2e1068(0x16d)]?.['selectedRowId']||_0x4bbc9c?.['message']?.[_0x2e1068(0xc4)]?.[_0x2e1068(0x184)]||_0x4bbc9c?.[_0x2e1068(0xbe)]?.[_0x2e1068(0xa6)];if(_0x82c233=='#'&&(!_0x1646c8[_0x2e1068(0x188)]||_0x1646c8[_0x2e1068(0x207)]=='pending')){console[_0x2e1068(0x170)](_0x2e1068(0x172)),await _0x1646c8[_0x2e1068(0x21e)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x5c7c9b,_0x4bbc9c,_0x1646c8,_0x1646c8[_0x2e1068(0x22e)]);return;}if(!(0x0,lodash_1[_0x2e1068(0x1e5)])(_0x5f14c6)&&!(0x0,lodash_1[_0x2e1068(0x1e5)])(_0x1646c8[_0x2e1068(0x1fc)])&&_0x82c233=='0'){console[_0x2e1068(0x170)](_0x2e1068(0x193));const _0x398a48=await QueueOption_1['default'][_0x2e1068(0x12f)](_0x1646c8['queueOptionId']);await _0x1646c8[_0x2e1068(0x21e)]({'queueOptionId':_0x398a48?.[_0x2e1068(0x166)],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1[_0x2e1068(0x1e5)])(_0x5f14c6)&&!(0x0,lodash_1[_0x2e1068(0x1e5)])(_0x1646c8['queueOptionId'])){console['trace'](_0x2e1068(0x148));const _0x20e0ed=await QueueOption_1[_0x2e1068(0x12b)]['count']({'where':{'parentId':_0x1646c8[_0x2e1068(0x1fc)]}});let _0x2ae156={};_0x20e0ed==0x1?_0x2ae156=await QueueOption_1['default']['findOne']({'where':{'parentId':_0x1646c8[_0x2e1068(0x1fc)]}}):(console[_0x2e1068(0x170)]('terceiro\x20if'),_0x2ae156=await QueueOption_1[_0x2e1068(0x12b)]['findOne']({'where':{[sequelize_1['Op']['or']]:[{'option':_0x82c233||''},{'title':_0x82c233||''}],'parentId':_0x1646c8[_0x2e1068(0x1fc)]}})),_0x2ae156&&await _0x1646c8[_0x2e1068(0x21e)]({'queueOptionId':_0x2ae156?.['id'],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1['isNil'])(_0x5f14c6)&&(0x0,lodash_1[_0x2e1068(0x1e5)])(_0x1646c8['queueOptionId'])&&!_0x16623e){console[_0x2e1068(0x170)](_0x2e1068(0x181));const _0x455e9e=_0x5f14c6?.[_0x2e1068(0xc9)][_0x2e1068(0x191)](_0x3bb4ab=>_0x3bb4ab[_0x2e1068(0x15e)]==_0x82c233||_0x3bb4ab['title'][_0x2e1068(0x13d)]()==_0x82c233['toLowerCase']());if(_0x455e9e)await _0x1646c8[_0x2e1068(0x21e)]({'queueOptionId':_0x455e9e?.['id'],'amountUsedBotQueues':0x0});else{if(_0x5c4dfd['maxUseBotQueues']&&_0x5c4dfd[_0x2e1068(0x241)]!==0x0&&_0x1646c8['amountUsedBotQueues']>=_0x5c4dfd['maxUseBotQueues'])return;await _0x1646c8[_0x2e1068(0x21e)]({'amountUsedBotQueues':_0x1646c8[_0x2e1068(0xda)]+0x1});}}else{if(_0x5c4dfd[_0x2e1068(0x241)]&&_0x5c4dfd[_0x2e1068(0x241)]!==0x0&&_0x1646c8['amountUsedBotQueues']>=_0x5c4dfd['maxUseBotQueues'])return;await _0x1646c8['update']({'amountUsedBotQueues':_0x1646c8['amountUsedBotQueues']+0x1});}}}await _0x1646c8[_0x2e1068(0x11d)]();if(!(0x0,lodash_1['isNil'])(_0x5f14c6)&&(0x0,lodash_1[_0x2e1068(0x1e5)])(_0x1646c8[_0x2e1068(0x1fc)])){const _0x251acb=await QueueOption_1[_0x2e1068(0x12b)][_0x2e1068(0x19c)]({'where':{'queueId':_0x1646c8[_0x2e1068(0x198)],'parentId':null},'order':[[_0x2e1068(0x15e),_0x2e1068(0x20c)],[_0x2e1068(0x19f),'ASC']]}),_0x6eae40=_0x1646c8[_0x2e1068(0x187)],_0x5a61de=await Setting_1[_0x2e1068(0x12b)][_0x2e1068(0x157)]({'where':{'key':'chatBotType','companyId':_0x6eae40}}),_0x5b72ae=async()=>{const _0x25e02e=_0x2e1068,_0x3ba687=[];_0x251acb[_0x25e02e(0x147)]((_0xfd4385,_0x4373fb)=>{const _0x331c38=_0x25e02e;_0x3ba687[_0x331c38(0x87)]({'buttonId':''+_0xfd4385[_0x331c38(0x15e)],'buttonText':{'displayText':_0xfd4385[_0x331c38(0x23f)]},'type':0x4});}),_0x3ba687[_0x25e02e(0x87)]({'buttonId':'#','buttonText':{'displayText':_0x25e02e(0xab)},'type':0x4});const _0x51d2b6={'text':(0x0,Mustache_1[_0x25e02e(0x12b)])('‎'+_0x5f14c6[_0x25e02e(0x8d)],_0x1646c8),'buttons':_0x3ba687,'footer':_0x25e02e(0x16e),'headerType':0x1},_0x54d6f3=await _0x5c7c9b[_0x25e02e(0x1aa)](_0x1646c8[_0x25e02e(0x22e)][_0x25e02e(0x1ee)]+'@'+(_0x1646c8[_0x25e02e(0x140)]?_0x25e02e(0x14b):'s.whatsapp.net'),_0x51d2b6);await(0x0,exports[_0x25e02e(0x23a)])(_0x54d6f3,_0x1646c8,_0x1646c8['contact']);},_0x447950=async()=>{const _0x42b7ce=_0x2e1068;let _0x1a292b='';console['trace'](_0x42b7ce(0x1f6)),console['log'](_0x5f14c6[_0x42b7ce(0x197)]),_0x251acb['forEach']((_0x1b5104,_0x410199)=>{const _0x442779=_0x42b7ce;_0x1a292b+=_0x442779(0x137)+_0x1b5104[_0x442779(0x15e)]+_0x442779(0x1d1)+_0x1b5104['title']+'\x0a';}),_0x1a292b+='\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial';const _0x537f5a={'text':(0x0,Mustache_1[_0x42b7ce(0x12b)])('‎'+_0x5f14c6['greetingMessage']+'\x0a\x0a'+_0x1a292b,_0x1646c8)};let _0xb4031a;if(!_0x5f14c6[_0x42b7ce(0x197)])_0xb4031a=await _0x5c7c9b[_0x42b7ce(0x1aa)](_0x1646c8[_0x42b7ce(0x22e)][_0x42b7ce(0x1ee)]+'@'+(_0x1646c8[_0x42b7ce(0x140)]?_0x42b7ce(0x14b):_0x42b7ce(0x7f)),_0x537f5a),await(0x0,exports[_0x42b7ce(0x23a)])(_0xb4031a,_0x1646c8,_0x1646c8['contact']);else{const _0x5d9e38=path_1[_0x42b7ce(0x12b)][_0x42b7ce(0x18a)](_0x42b7ce(0x119),_0x42b7ce(0x192)+_0x1646c8[_0x42b7ce(0x187)],_0x5f14c6[_0x42b7ce(0x197)]),_0xd66576=await(0x0,SendWhatsAppMedia_1[_0x42b7ce(0x13a)])(_0x537f5a[_0x42b7ce(0x184)],_0x5d9e38,_0x537f5a[_0x42b7ce(0x184)],_0x1646c8[_0x42b7ce(0x187)]);_0xb4031a=await _0x5c7c9b['sendMessage'](_0x1646c8['contact']['number']+'@'+(_0x1646c8[_0x42b7ce(0x140)]?'g.us':_0x42b7ce(0x7f)),{..._0xd66576}),await verifyMediaMessage(_0xb4031a,_0x1646c8,_0x1646c8['contact']);}};if(_0x5a61de[_0x2e1068(0x180)]===_0x2e1068(0x183)&&QueueOption_1[_0x2e1068(0x12b)][_0x2e1068(0xeb)]<=0x4)return _0x5b72ae();if(_0x5a61de[_0x2e1068(0x180)]===_0x2e1068(0x184))return console['trace']('botText'),_0x447950();if(_0x5a61de[_0x2e1068(0x180)]===_0x2e1068(0x183)&&QueueOption_1[_0x2e1068(0x12b)]['length']>0x4)return console['trace'](_0x2e1068(0x1f6)),_0x447950();}else{if(!(0x0,lodash_1[_0x2e1068(0x1e5)])(_0x5f14c6)&&!(0x0,lodash_1['isNil'])(_0x1646c8[_0x2e1068(0x1fc)])){const _0x22935c=await QueueOption_1[_0x2e1068(0x12b)][_0x2e1068(0x12f)](_0x1646c8['queueOptionId']),_0x18b863=await QueueOption_1[_0x2e1068(0x12b)][_0x2e1068(0x19c)]({'where':{'parentId':_0x1646c8['queueOptionId']},'order':[[_0x2e1068(0x15e),_0x2e1068(0x20c)],[_0x2e1068(0x19f),_0x2e1068(0x20c)]]});if(_0x18b863[_0x2e1068(0xeb)]===0x0){const _0x56a645={'text':(0x0,Mustache_1['default'])('‎'+_0x22935c['message'],_0x1646c8)},_0x28ac6b=await _0x5c7c9b['sendMessage'](_0x1646c8[_0x2e1068(0x22e)][_0x2e1068(0x1ee)]+'@'+(_0x1646c8['isGroup']?'g.us':_0x2e1068(0x7f)),_0x56a645);await(0x0,exports[_0x2e1068(0x23a)])(_0x28ac6b,_0x1646c8,_0x1646c8[_0x2e1068(0x22e)]),await _0x1646c8[_0x2e1068(0x21e)]({'queueOptionId':null,'chatbot':![]});return;}if(_0x18b863['length']>-0x1){const _0x55e47f=_0x1646c8['companyId'],_0x51670d=await Setting_1[_0x2e1068(0x12b)][_0x2e1068(0x157)]({'where':{'key':'chatBotType','companyId':_0x55e47f}}),_0x2b53ff=async()=>{const _0x5f3cff=_0x2e1068,_0xb59db2=[],_0x47b033=_0x1646c8[_0x5f3cff(0x187)],_0x39e72f=await getQueues(_0x47b033),_0x8bd3db=await getContactFromTicket(_0x1646c8['id']);_0x39e72f[_0x5f3cff(0x147)]((_0x345c88,_0x251964)=>{const _0x292ef2=_0x5f3cff;_0xb59db2[_0x292ef2(0x87)]({'title':'['+(_0x251964+0x1)+_0x292ef2(0x1b6)+_0x345c88[_0x292ef2(0x11f)],'rowId':''+(_0x251964+0x1)});});const _0xf8daf8=[{'rows':_0xb59db2}],_0x4f57a1={'text':(0x0,Mustache_1[_0x5f3cff(0x12b)])('‎'+_0x22935c[_0x5f3cff(0xbe)],_0x1646c8),'title':'Lista','buttonText':_0x5f3cff(0x12d),'sections':_0xf8daf8};await sleep(0x3e8);const _0xb3460=await _0x5c7c9b['sendMessage'](_0x5f3cff(0x158)+_0x8bd3db[_0x5f3cff(0x1ee)]+'@'+(_0x1646c8[_0x5f3cff(0x140)]?'g.us':_0x5f3cff(0x7f)),_0x4f57a1);await(0x0,exports[_0x5f3cff(0x23a)])(_0xb3460,_0x1646c8,_0x1646c8[_0x5f3cff(0x22e)]);},_0x4cb621=async()=>{const _0x3456e6=_0x2e1068,_0x594807=[];_0x18b863[_0x3456e6(0x147)]((_0x51b121,_0x21c78b)=>{const _0x170252=_0x3456e6;_0x594807[_0x170252(0x87)]({'buttonId':''+_0x51b121[_0x170252(0x15e)],'buttonText':{'displayText':_0x51b121['title']},'type':0x4});}),_0x594807[_0x3456e6(0x87)]({'buttonId':'#','buttonText':{'displayText':_0x3456e6(0xab)},'type':0x4});const _0x4ed63b={'text':(0x0,Mustache_1[_0x3456e6(0x12b)])('‎'+_0x22935c[_0x3456e6(0xbe)],_0x1646c8),'buttons':_0x594807,'headerType':0x4};if(process[_0x3456e6(0x200)]['CHATBOT_RESTRICT_NUMBER']?.[_0x3456e6(0xeb)]>=0x8){if(_0x1646c8['contact'][_0x3456e6(0x1ee)]!=process['env']['CHATBOT_RESTRICT_NUMBER']){console[_0x3456e6(0x170)](_0x3456e6(0xfa));return;}}if(!_0x22935c['mediaPath']){const _0x5c6780=await _0x5c7c9b[_0x3456e6(0x1aa)](_0x1646c8['contact']['number']+'@'+(_0x1646c8['isGroup']?_0x3456e6(0x14b):_0x3456e6(0x7f)),_0x4ed63b);await(0x0,exports[_0x3456e6(0x23a)])(_0x5c6780,_0x1646c8,_0x1646c8[_0x3456e6(0x22e)]);}else{const _0x4d6196=path_1[_0x3456e6(0x12b)]['resolve']('public','company'+_0x1646c8['companyId'],_0x22935c['mediaPath']),_0x4bb1c9=await(0x0,SendWhatsAppMedia_1[_0x3456e6(0x13a)])(_0x22935c[_0x3456e6(0x23d)],_0x4d6196,_0x4ed63b[_0x3456e6(0x184)],_0x1646c8[_0x3456e6(0x187)]);let _0x3cb838=await _0x5c7c9b[_0x3456e6(0x1aa)](_0x1646c8['contact'][_0x3456e6(0x1ee)]+'@'+(_0x1646c8['isGroup']?_0x3456e6(0x14b):_0x3456e6(0x7f)),{..._0x4bb1c9});await verifyMediaMessage(_0x3cb838,_0x1646c8,_0x1646c8[_0x3456e6(0x22e)]);}const _0x5b3ffe=await _0x5c7c9b[_0x3456e6(0x1aa)](_0x1646c8[_0x3456e6(0x22e)][_0x3456e6(0x1ee)]+'@'+(_0x1646c8[_0x3456e6(0x140)]?_0x3456e6(0x14b):'s.whatsapp.net'),_0x4ed63b);await(0x0,exports[_0x3456e6(0x23a)])(_0x5b3ffe,_0x1646c8,_0x1646c8[_0x3456e6(0x22e)]);},_0x569a99=async()=>{const _0x4c3b7a=_0x2e1068;let _0x2df027='';_0x18b863[_0x4c3b7a(0x147)]((_0x357181,_0x26d8c5)=>{const _0x56b289=_0x4c3b7a;_0x2df027+='*[\x20'+_0x357181[_0x56b289(0x15e)]+_0x56b289(0x1d1)+_0x357181[_0x56b289(0x23f)]+'\x0a';}),_0x2df027+=_0x4c3b7a(0x23e),_0x2df027+=_0x4c3b7a(0xcb);const _0x21b6eb={'text':(0x0,Mustache_1[_0x4c3b7a(0x12b)])('‎'+_0x22935c[_0x4c3b7a(0xbe)]+'\x0a\x0a'+_0x2df027,_0x1646c8)};if(process[_0x4c3b7a(0x200)][_0x4c3b7a(0x214)]?.[_0x4c3b7a(0xeb)]>=0x8){if(_0x1646c8[_0x4c3b7a(0x22e)][_0x4c3b7a(0x1ee)]!=process[_0x4c3b7a(0x200)][_0x4c3b7a(0x214)]){console[_0x4c3b7a(0x170)]('chatbot\x20desativado!');return;}}if(!_0x22935c['mediaPath']){const _0x4ff2f9=await _0x5c7c9b[_0x4c3b7a(0x1aa)](_0x1646c8[_0x4c3b7a(0x22e)][_0x4c3b7a(0x1ee)]+'@'+(_0x1646c8[_0x4c3b7a(0x140)]?_0x4c3b7a(0x14b):_0x4c3b7a(0x7f)),_0x21b6eb);await(0x0,exports[_0x4c3b7a(0x23a)])(_0x4ff2f9,_0x1646c8,_0x1646c8[_0x4c3b7a(0x22e)]);}else{const _0x2f617a=path_1[_0x4c3b7a(0x12b)][_0x4c3b7a(0x18a)](_0x4c3b7a(0x119),_0x4c3b7a(0x192)+_0x1646c8[_0x4c3b7a(0x187)],_0x22935c[_0x4c3b7a(0x197)]),_0x1b0940=await(0x0,SendWhatsAppMedia_1[_0x4c3b7a(0x13a)])(_0x22935c[_0x4c3b7a(0x23d)],_0x2f617a,_0x21b6eb[_0x4c3b7a(0x184)],_0x1646c8[_0x4c3b7a(0x187)]);let _0x58add6=await _0x5c7c9b[_0x4c3b7a(0x1aa)](_0x1646c8[_0x4c3b7a(0x22e)][_0x4c3b7a(0x1ee)]+'@'+(_0x1646c8[_0x4c3b7a(0x140)]?'g.us':_0x4c3b7a(0x7f)),{..._0x1b0940});await verifyMediaMessage(_0x58add6,_0x1646c8,_0x1646c8[_0x4c3b7a(0x22e)]);}};if(_0x51670d['value']===_0x2e1068(0x91))return _0x2b53ff();if(_0x51670d[_0x2e1068(0x180)]===_0x2e1068(0x183)&&QueueOption_1[_0x2e1068(0x12b)][_0x2e1068(0xeb)]<=0x4)return _0x4cb621();if(_0x51670d[_0x2e1068(0x180)]==='text')return console[_0x2e1068(0x170)](_0x2e1068(0x23c)),_0x569a99();if(_0x51670d[_0x2e1068(0x180)]==='button'&&QueueOption_1[_0x2e1068(0x12b)][_0x2e1068(0xeb)]>0x4)return console[_0x2e1068(0x170)](_0x2e1068(0x8c)),_0x569a99();}}}}},handleMessageIntegration=async(_0x30b103,_0xad1e41,_0x2e799d,_0x1ddcd9)=>{const _0x21d8b7=a559_0x53de00;if(process['env'][_0x21d8b7(0x214)]){if(_0x1ddcd9['contact'][_0x21d8b7(0x1ee)]!=process[_0x21d8b7(0x200)][_0x21d8b7(0x214)]){console[_0x21d8b7(0x1a6)](_0x21d8b7(0xfa));return;}}const _0x3c6bec=getTypeMessage(_0x30b103);if(_0x2e799d[_0x21d8b7(0x1ed)]==='n8n'||_0x2e799d[_0x21d8b7(0x1ed)]===_0x21d8b7(0x190)){if(_0x2e799d?.[_0x21d8b7(0x1fa)]){const _0x40dfbe={'method':_0x21d8b7(0x1b8),'url':_0x2e799d?.[_0x21d8b7(0x1fa)],'headers':{'Content-Type':_0x21d8b7(0x1a5)},'json':_0x30b103};try{(0x0,request_1[_0x21d8b7(0x12b)])(_0x40dfbe,function(_0x4402a8,_0x5ba4be){const _0x1fe7aa=_0x21d8b7;if(_0x4402a8)throw new Error(_0x4402a8);else console[_0x1fe7aa(0x1a6)](_0x5ba4be['body']);});}catch(_0x4abe0c){throw new Error(_0x4abe0c);}}}else _0x2e799d[_0x21d8b7(0x1ed)]==='typebot'&&await(0x0,typebotListener_1[_0x21d8b7(0x12b)])({'ticket':_0x1ddcd9,'msg':_0x30b103,'wbot':_0xad1e41,'typebot':_0x2e799d});};exports[a559_0x53de00(0x185)]=handleMessageIntegration;const messageContainsMedia=_0xeefe1c=>{const _0x3483a8=a559_0x53de00;return _0xeefe1c['message']?.[_0x3483a8(0x1c7)]||_0xeefe1c['message']?.[_0x3483a8(0x125)]||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x202)]||_0xeefe1c['message']?.[_0x3483a8(0x112)]||_0xeefe1c[_0x3483a8(0xbe)]?.['documentMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x82)]?.[_0x3483a8(0xbe)]?.['documentMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x220)]?.['message']?.[_0x3483a8(0x125)]||_0xeefe1c['message']?.['ephemeralMessage']?.[_0x3483a8(0xbe)]?.[_0x3483a8(0x17c)]||_0xeefe1c['message']?.[_0x3483a8(0x220)]?.[_0x3483a8(0xbe)]?.[_0x3483a8(0x202)]||_0xeefe1c['message']?.[_0x3483a8(0x220)]?.[_0x3483a8(0xbe)]?.[_0x3483a8(0x112)]||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x220)]?.[_0x3483a8(0xbe)]?.[_0x3483a8(0x1c7)]||_0xeefe1c[_0x3483a8(0xbe)]?.['viewOnceMessage']?.[_0x3483a8(0xbe)]?.[_0x3483a8(0x1c7)]||_0xeefe1c[_0x3483a8(0xbe)]?.['viewOnceMessage']?.[_0x3483a8(0xbe)]?.[_0x3483a8(0x202)]||_0xeefe1c[_0x3483a8(0xbe)]?.['ephemeralMessage']?.['message']?.['viewOnceMessage']?.[_0x3483a8(0xbe)]?.[_0x3483a8(0x1c7)]||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x220)]?.['message']?.[_0x3483a8(0x164)]?.[_0x3483a8(0xbe)]?.['videoMessage']||_0xeefe1c['message']?.[_0x3483a8(0x220)]?.[_0x3483a8(0xbe)]?.[_0x3483a8(0x164)]?.[_0x3483a8(0xbe)]?.['audioMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x220)]?.[_0x3483a8(0xbe)]?.[_0x3483a8(0x164)]?.['message']?.[_0x3483a8(0x17c)]||_0xeefe1c['message']?.['documentWithCaptionMessage']?.['message']?.[_0x3483a8(0x17c)]||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x151)]?.['hydratedTemplate']?.['imageMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.['templateMessage']?.[_0x3483a8(0x20d)]?.[_0x3483a8(0x17c)]||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x151)]?.['hydratedTemplate']?.['videoMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.['templateMessage']?.['hydratedFourRowTemplate']?.['imageMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x151)]?.[_0x3483a8(0x9b)]?.[_0x3483a8(0x17c)]||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x151)]?.[_0x3483a8(0x9b)]?.['videoMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x151)]?.[_0x3483a8(0x12e)]?.['imageMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.['templateMessage']?.[_0x3483a8(0x12e)]?.['documentMessage']||_0xeefe1c['message']?.[_0x3483a8(0x151)]?.[_0x3483a8(0x12e)]?.[_0x3483a8(0x202)]||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x13b)]?.[_0x3483a8(0x196)]?.[_0x3483a8(0x1c7)]||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x13b)]?.[_0x3483a8(0x196)]?.['documentMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x13b)]?.[_0x3483a8(0x196)]?.[_0x3483a8(0x202)]||_0xeefe1c['message']?.[_0x3483a8(0x1e4)]?.[_0x3483a8(0x121)]?.[_0x3483a8(0x20d)]?.['documentMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x1e4)]?.[_0x3483a8(0x121)]?.[_0x3483a8(0x20d)]?.['videoMessage']||_0xeefe1c[_0x3483a8(0xbe)]?.[_0x3483a8(0x1e4)]?.[_0x3483a8(0x121)]?.['hydratedTemplate']?.[_0x3483a8(0x1c7)]||_0xeefe1c['message']?.[_0x3483a8(0x1e4)]?.['hydratedHsm']?.['hydratedTemplate']?.[_0x3483a8(0xf9)];},handleMessage=async(_0x1983f6,_0x1f7897,_0x27cfcb,_0x27bcba=![])=>{const _0x49493e=a559_0x53de00;if(_0x27bcba){console['log']('Importando\x20mensagens!!');let _0x508173=_0x1983f6[_0x49493e(0x194)]['id'],_0x720c9c=await Message_1[_0x49493e(0x12b)]['count']({'where':{'id':_0x508173}});if(_0x720c9c>0x0){await new Promise(_0x3a04c1=>setTimeout(_0x3a04c1,0x96));return;}else await new Promise(_0x30c6d3=>setTimeout(_0x30c6d3,0x14a));}let _0x318929;if(!(0x0,exports[_0x49493e(0xac)])(_0x1983f6)){console[_0x49493e(0x1a6)](_0x49493e(0x1d7)),console[_0x49493e(0x1a6)](_0x1983f6);return;}_0x1983f6['message']?.['ephemeralMessage']&&(_0x1983f6[_0x49493e(0xbe)]=_0x1983f6[_0x49493e(0xbe)][_0x49493e(0x220)][_0x49493e(0xbe)]);try{let _0x541f1b;const _0x2be1ed=_0x1983f6[_0x49493e(0x194)][_0x49493e(0x98)]?.[_0x49493e(0x205)](_0x49493e(0x18f)),_0x3dbb23=await Setting_1[_0x49493e(0x12b)][_0x49493e(0x157)]({'where':{'companyId':_0x27cfcb,'key':_0x49493e(0x113)}});if(_0x3dbb23?.['value']==='enabled'&&_0x2be1ed){console['log']('Mensagem\x20de\x20grupo\x20bloqueada!');return;}let _0x15c092=(0x0,exports['getBodyMessage'])(_0x1983f6);const _0x2d2a21=getTypeMessage(_0x1983f6);typeof _0x15c092===_0x49493e(0x226)&&(_0x15c092=_0x15c092['replace'](/\u200c/,''));const _0x1606c9=messageContainsMedia(_0x1983f6);if(_0x1983f6[_0x49493e(0x194)]['fromMe']){if(!_0x1606c9&&_0x2d2a21!==_0x49493e(0xa6)&&_0x2d2a21!=='extendedTextMessage'&&_0x2d2a21!==_0x49493e(0x7d)&&_0x2d2a21!==_0x49493e(0xcd)&&_0x2d2a21!=='ephemeralMessage'&&_0x2d2a21!==_0x49493e(0xbb)&&_0x2d2a21!==_0x49493e(0xe3)&&_0x2d2a21!==_0x49493e(0x164)&&_0x2d2a21!=='locationMessage'&&_0x2d2a21!=='hydratedContentText'&&_0x2d2a21!==_0x49493e(0x1bd)){console['trace'](_0x2d2a21);return;}}const _0x16402b=await(0x0,ShowWhatsAppService_1[_0x49493e(0x12b)])(_0x1f7897['id'],_0x27cfcb);let _0xd63c49,_0x232b8b=await getContactMessage(_0x1983f6,_0x1f7897);_0x541f1b=await verifyContact(_0x232b8b,_0x1f7897,_0x27cfcb);if(_0x2be1ed){if(!_0x16402b['allowGroup'])return;try{const _0x14dfe0=await _0x1f7897[_0x49493e(0xa1)](_0x1983f6[_0x49493e(0x194)]['remoteJid']),_0x132cdf={'id':_0x14dfe0['id'],'name':_0x14dfe0['subject']};_0xd63c49=await verifyContact(_0x132cdf,_0x1f7897,_0x27cfcb);}catch(_0x47871f){console[_0x49493e(0x1a6)](_0x49493e(0x145)),console[_0x49493e(0x1a6)](_0x47871f);return;}}let _0x5915ab=0x0;if(_0x1983f6[_0x49493e(0x194)][_0x49493e(0xf0)])await cache_1[_0x49493e(0x9c)]['set'](_0x49493e(0x1f7)+_0x541f1b['id']+_0x49493e(0xb8),'0');else{const _0x28f7b8=await cache_1['cacheLayer'][_0x49493e(0x124)](_0x49493e(0x1f7)+_0x541f1b['id']+':unreads');_0x5915ab=+_0x28f7b8+0x1,await cache_1[_0x49493e(0x9c)][_0x49493e(0x85)](_0x49493e(0x1f7)+_0x541f1b['id']+':unreads',''+_0x5915ab);}const _0x491d47=await(0x0,FindOrCreateTicketService_1[_0x49493e(0x12b)])(_0x541f1b,_0x1f7897['id'],_0x5915ab,_0x27cfcb,_0xd63c49,_0x27bcba),_0xe18f2c=await(0x0,FindOrCreateATicketTrakingService_1[_0x49493e(0x12b)])({'ticketId':_0x491d47['id'],'companyId':_0x27cfcb,'whatsappId':_0x16402b?.['id']});_0xe18f2c[_0x49493e(0x173)](_0x49493e(0x1dd),!![]),await _0xe18f2c[_0x49493e(0x21e)]({'updatedAt':new Date()}),await(0x0,providers_1['provider'])(_0x491d47,_0x1983f6,_0x27cfcb,_0x541f1b,_0x1f7897);if(_0x16402b[_0x49493e(0x1eb)]&&_0x5915ab===0x0){const _0x5119a9=await Message_1[_0x49493e(0x12b)]['findOne']({'where':{'contactId':_0x541f1b['id'],'companyId':_0x27cfcb},'order':[['createdAt',_0x49493e(0x22c)]]});if((0x0,Mustache_1[_0x49493e(0x12b)])(_0x16402b[_0x49493e(0x1eb)],_0x491d47)['trim']()[_0x49493e(0x13d)]()===_0x5119a9?.['body'][_0x49493e(0x167)]()[_0x49493e(0x13d)]())return;}if(_0x15c092=='#'&&!_0x27bcba&&(!_0x491d47[_0x49493e(0x188)]||_0x491d47[_0x49493e(0x207)]==_0x49493e(0x7c))){await _0x491d47[_0x49493e(0x21e)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x1f7897,_0x1983f6,_0x491d47,_0x491d47[_0x49493e(0x22e)]);return;}try{if(!_0x1983f6[_0x49493e(0x194)][_0x49493e(0xf0)]&&!_0x27bcba){if(_0x15c092!=null&&typeof _0x15c092!==_0x49493e(0x226)){console[_0x49493e(0x1a6)](_0x15c092),console['trace'](_0x49493e(0x182),typeof _0x15c092);return;}if(_0x15c092?.[_0x49493e(0x219)]()===_0x49493e(0x135)&&_0x491d47[_0x49493e(0x207)]!=_0x49493e(0x199)){await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x1f7897,_0x491d47[_0x49493e(0x22e)][_0x49493e(0x1ee)]+'@'+(_0x491d47[_0x49493e(0x140)]?_0x49493e(0x14b):_0x49493e(0x7f)));const _0x41dacf=await _0x1f7897[_0x49493e(0x1aa)](_0x491d47[_0x49493e(0x22e)][_0x49493e(0x1ee)]+'@'+(_0x491d47['isGroup']?_0x49493e(0x14b):_0x49493e(0x7f)),{'text':_0x49493e(0x22f)});await(0x0,exports['verifyMessage'])(_0x41dacf,_0x491d47,_0x491d47[_0x49493e(0x22e)]),await(0x0,UpdateTicketService_1[_0x49493e(0x12b)])({'ticketData':{'queueId':null,'status':_0x49493e(0x199)},'ticketId':_0x491d47['id'],'companyId':_0x491d47[_0x49493e(0x187)]}),await _0x491d47[_0x49493e(0x11d)]();return;}}}catch(_0x226100){console['log'](_0x49493e(0x1a2)),console[_0x49493e(0x1a6)](_0x226100),Sentry[_0x49493e(0x8f)](_0x226100);}try{await _0x491d47[_0x49493e(0x21e)]({'fromMe':_0x1983f6[_0x49493e(0x194)][_0x49493e(0xf0)]});}catch(_0x19e278){console[_0x49493e(0x1a6)](_0x49493e(0x15a)),console[_0x49493e(0x1a6)](_0x19e278),Sentry[_0x49493e(0x8f)](_0x19e278);}try{if(!_0x1983f6['key'][_0x49493e(0xf0)]){if((0x0,exports['verifyRating'])(_0xe18f2c)){await(0x0,exports[_0x49493e(0x1e2)])(_0x1983f6,_0x491d47,_0xe18f2c),console[_0x49493e(0x1a6)](_0x49493e(0xae)+_0x1983f6);return;}}}catch(_0x47797f){console[_0x49493e(0x1a6)]('Erro\x20ao\x20salvar\x20avaliação!'),Sentry[_0x49493e(0x8f)](_0x47797f),console['log'](_0x47797f);}_0x1606c9?_0x318929=await verifyMediaMessage(_0x1983f6,_0x491d47,_0x541f1b):await(0x0,exports[_0x49493e(0x23a)])(_0x1983f6,_0x491d47,_0x541f1b);const _0x15466a=await(0x0,VerifyCurrentSchedule_1['default'])(_0x27cfcb),_0x4d3df3=await Setting_1[_0x49493e(0x12b)][_0x49493e(0x157)]({'where':{'companyId':_0x27cfcb,'key':_0x49493e(0x133)}});if(!_0x1983f6[_0x49493e(0x194)][_0x49493e(0xf0)]&&_0x4d3df3&&!_0x27bcba)await handleOutOfHour(_0x1f7897,_0x491d47,_0x4d3df3,_0x541f1b,_0x15466a,_0x16402b);!_0x491d47[_0x49493e(0x175)]&&!_0x2be1ed&&!_0x1983f6[_0x49493e(0x194)]['fromMe']&&!_0x491d47[_0x49493e(0x188)]&&!(0x0,lodash_1[_0x49493e(0x1e5)])(_0x16402b['promptId'])&&!_0x27bcba&&await handleOpenAi(_0x1983f6,_0x1f7897,_0x491d47,_0x541f1b,_0x318929);if(!_0x1983f6['key'][_0x49493e(0xf0)]&&!_0x491d47[_0x49493e(0x140)]&&!_0x491d47[_0x49493e(0x175)]&&!_0x491d47[_0x49493e(0x1c9)]&&_0x491d47[_0x49493e(0x238)]&&!(0x0,lodash_1[_0x49493e(0x1e5)])(_0x16402b[_0x49493e(0x1e9)])&&!_0x491d47['useIntegration']&&!_0x27bcba){const _0x503a1e=await(0x0,ShowQueueIntegrationService_1[_0x49493e(0x12b)])(_0x16402b[_0x49493e(0x1e9)],_0x27cfcb);await(0x0,exports[_0x49493e(0x185)])(_0x1983f6,_0x1f7897,_0x503a1e,_0x491d47);return;}!_0x2be1ed&&!_0x1983f6[_0x49493e(0x194)][_0x49493e(0xf0)]&&!_0x491d47[_0x49493e(0x188)]&&!(0x0,lodash_1[_0x49493e(0x1e5)])(_0x491d47[_0x49493e(0xa5)])&&_0x491d47[_0x49493e(0x16f)]&&!_0x27bcba&&await handleOpenAi(_0x1983f6,_0x1f7897,_0x491d47,_0x541f1b,_0x318929);if(!_0x1983f6[_0x49493e(0x194)]['fromMe']&&!_0x491d47[_0x49493e(0x140)]&&!_0x491d47[_0x49493e(0x188)]&&_0x491d47['integrationId']&&_0x491d47[_0x49493e(0x16f)]&&!_0x27bcba){const _0x6c33f2=await(0x0,ShowQueueIntegrationService_1[_0x49493e(0x12b)])(_0x491d47['integrationId'],_0x27cfcb);await(0x0,exports[_0x49493e(0x185)])(_0x1983f6,_0x1f7897,_0x6c33f2,_0x491d47);}!_0x491d47[_0x49493e(0x175)]&&!_0x491d47[_0x49493e(0x140)]&&!_0x1983f6[_0x49493e(0x194)][_0x49493e(0xf0)]&&!_0x491d47[_0x49493e(0x188)]&&_0x16402b['queues'][_0x49493e(0xeb)]>=0x1&&!_0x491d47[_0x49493e(0x16f)]&&!_0x27bcba&&(await verifyQueue(_0x1f7897,_0x1983f6,_0x491d47,_0x541f1b),_0xe18f2c[_0x49493e(0x173)](_0x49493e(0x21d),!![]),_0xe18f2c[_0x49493e(0x173)](_0x49493e(0x1dd),!![]),await _0xe18f2c['update']({'chatbotAt':(0x0,moment_1[_0x49493e(0x12b)])()[_0x49493e(0x10c)](),'updatedAt':new Date()}));const _0x3d46fa=_0x491d47[_0x49493e(0x175)]===null;await _0x491d47[_0x49493e(0x11d)]();if(!_0x27bcba&&_0x16402b['greetingMessage'])await greetingMessage(_0x1f7897,_0x491d47,_0x1983f6,_0x16402b,_0x2be1ed);_0x16402b[_0x49493e(0x17b)][_0x49493e(0xeb)]==0x1&&_0x491d47['queue']&&!_0x27bcba&&(_0x491d47[_0x49493e(0x238)]&&!_0x1983f6[_0x49493e(0x194)][_0x49493e(0xf0)]&&!_0x491d47['userId']&&await handleChartbot(_0x491d47,_0x1983f6,_0x1f7897,_0x16402b)),_0x16402b[_0x49493e(0x17b)]['length']>0x1&&_0x491d47[_0x49493e(0x175)]&&!_0x27bcba&&(_0x491d47['chatbot']&&!_0x1983f6[_0x49493e(0x194)][_0x49493e(0xf0)]&&!_0x491d47['userId']&&await handleChartbot(_0x491d47,_0x1983f6,_0x1f7897,_0x16402b,_0x3d46fa));}catch(_0x673584){console[_0x49493e(0x1a6)](_0x673584),Sentry['captureException'](_0x673584),logger_1[_0x49493e(0x1ab)][_0x49493e(0x9a)](_0x49493e(0x83)+_0x673584);}};exports[a559_0x53de00(0x86)]=handleMessage;const handleOutOfHour=async(_0x5f1a35,_0x272bf5,_0x384098,_0x42f3e2,_0x37c733,_0x2b34be)=>{const _0x30c9f9=a559_0x53de00;try{if(outOfHourMessageControl[_0x30c9f9(0xeb)]>0x1388)outOfHourMessageControl=[];let _0x2a8286=outOfHourMessageControl['find'](_0x2e5d7a=>_0x2e5d7a['ticketId']===_0x272bf5['id']||_0x2e5d7a[_0x30c9f9(0x22a)]===_0x42f3e2['number']);if(_0x384098[_0x30c9f9(0x180)]===_0x30c9f9(0x192)&&!(0x0,lodash_1[_0x30c9f9(0x1e5)])(_0x37c733)&&_0x2b34be[_0x30c9f9(0x1cf)]&&(!_0x37c733||_0x37c733[_0x30c9f9(0x11a)]===![])){if(!_0x2a8286||_0x2a8286&&_0x2a8286[_0x30c9f9(0x21a)]+0x3e8*0x3c*0x5<new Date()[_0x30c9f9(0x195)]()){_0x2a8286&&(outOfHourMessageControl=outOfHourMessageControl[_0x30c9f9(0x1c3)](_0x577afe=>_0x577afe['ticketId']!==_0x272bf5['id']),_0x2a8286=null);if(!_0x2a8286)outOfHourMessageControl[_0x30c9f9(0x87)]({'ticketId':_0x272bf5['id'],'dest':_0x42f3e2[_0x30c9f9(0x1ee)],'time':new Date()[_0x30c9f9(0x195)]()});const _0x5c05ea='‎\x20'+_0x2b34be[_0x30c9f9(0x1cf)],_0x2e6472=(0x0,Debounce_1[_0x30c9f9(0x110)])(async()=>{const _0x52572a=_0x30c9f9;await _0x5f1a35[_0x52572a(0x1aa)](_0x272bf5[_0x52572a(0x22e)][_0x52572a(0x1ee)]+'@'+(_0x272bf5[_0x52572a(0x140)]?_0x52572a(0x14b):_0x52572a(0x7f)),{'text':_0x5c05ea});},(0x0,queues_1[_0x30c9f9(0x19d)])(0x5dc,0xdac),_0x272bf5['id']);_0x2e6472();return;}}if(_0x384098[_0x30c9f9(0x180)]==='queue'&&_0x272bf5[_0x30c9f9(0x198)]!==null){const _0x5536a9=await Queue_1[_0x30c9f9(0x12b)][_0x30c9f9(0x12f)](_0x272bf5[_0x30c9f9(0x198)]),{schedules:_0x4dbe13}=_0x5536a9,_0x81e9c=(0x0,moment_1[_0x30c9f9(0x12b)])(),_0x9af856=_0x81e9c[_0x30c9f9(0xe7)]('dddd')[_0x30c9f9(0x13d)]();let _0x33407a=null;Array[_0x30c9f9(0x1b4)](_0x4dbe13)&&_0x4dbe13['length']>0x0&&(_0x33407a=_0x4dbe13[_0x30c9f9(0x191)](_0xcf47f4=>_0xcf47f4[_0x30c9f9(0xb6)]===_0x9af856&&_0xcf47f4['startTime']!==''&&_0xcf47f4[_0x30c9f9(0xc2)]!==null&&_0xcf47f4[_0x30c9f9(0x1e7)]!==''&&_0xcf47f4[_0x30c9f9(0x1e7)]!==null));if(_0x384098[_0x30c9f9(0x180)]===_0x30c9f9(0x175)&&_0x5536a9['outOfHoursMessage']!==null&&_0x5536a9[_0x30c9f9(0x1cf)]!==''&&!(0x0,lodash_1[_0x30c9f9(0x1e5)])(_0x33407a)){const _0x5855ed=(0x0,moment_1[_0x30c9f9(0x12b)])(_0x33407a[_0x30c9f9(0xc2)],_0x30c9f9(0x240)),_0x11ee8a=(0x0,moment_1[_0x30c9f9(0x12b)])(_0x33407a[_0x30c9f9(0x1e7)],'HH:mm');let _0x7fc1b8=_0x81e9c[_0x30c9f9(0x12a)](_0x5855ed)||_0x81e9c[_0x30c9f9(0xad)](_0x11ee8a);if(!_0x7fc1b8){if(_0x33407a[_0x30c9f9(0xf2)]&&_0x33407a[_0x30c9f9(0x1ce)]){const _0x47f397=(0x0,moment_1[_0x30c9f9(0x12b)])(_0x33407a['startLunchTime'],'HH:mm'),_0x35f755=(0x0,moment_1[_0x30c9f9(0x12b)])(_0x33407a['endLunchTime'],_0x30c9f9(0x240));_0x7fc1b8=_0x81e9c[_0x30c9f9(0x1f3)](_0x47f397,_0x35f755);}}if(_0x7fc1b8){if(!_0x2a8286||_0x2a8286&&_0x2a8286[_0x30c9f9(0x21a)]+0x3e8*0x3c*0x1e<new Date()[_0x30c9f9(0x195)]()){const _0x8c51c=_0x5536a9[_0x30c9f9(0x1cf)],_0x2ce81a=(0x0,Debounce_1[_0x30c9f9(0x110)])(async()=>{const _0x10e10c=_0x30c9f9;await _0x5f1a35[_0x10e10c(0x1aa)](_0x272bf5[_0x10e10c(0x22e)][_0x10e10c(0x1ee)]+'@'+(_0x272bf5[_0x10e10c(0x140)]?'g.us':_0x10e10c(0x7f)),{'text':_0x8c51c});},(0x0,queues_1['randomValue'])(0x3e8,0xbb8),_0x272bf5['id']);_0x2ce81a();return;}if(!_0x2a8286)outOfHourMessageControl['push']({'ticketId':_0x272bf5['id'],'dest':_0x42f3e2[_0x30c9f9(0x1ee)],'time':new Date()[_0x30c9f9(0x195)]()});}}}}catch(_0x169d3c){Sentry[_0x30c9f9(0x8f)](_0x169d3c),console[_0x30c9f9(0x1a6)](_0x169d3c);}},greetingMessage=async(_0x1531c1,_0x162bb5,_0x591e38,_0x5be069,_0x233496)=>{const _0x4fdd12=a559_0x53de00;if(!_0x5be069?.['queues']?.['length']&&!_0x162bb5[_0x4fdd12(0x188)]&&!_0x233496&&!_0x591e38['key']['fromMe']){if(process[_0x4fdd12(0x200)][_0x4fdd12(0x214)]?.[_0x4fdd12(0xeb)]>=0x8){if(_0x162bb5['contact'][_0x4fdd12(0x1ee)]!=process[_0x4fdd12(0x200)][_0x4fdd12(0x214)])return;}if(greetingMessageControl[_0x4fdd12(0xeb)]>0x1388)greetingMessageControl=[];var _0x2cc74f=greetingMessageControl[_0x4fdd12(0x191)](_0x4c0553=>_0x4c0553[_0x4fdd12(0x18d)]===_0x162bb5['id']||_0x4c0553['dest']===_0x162bb5[_0x4fdd12(0x22e)][_0x4fdd12(0x1ee)]);if(_0x2cc74f&&_0x2cc74f[_0x4fdd12(0x21a)]+0x3e8*0x3c*0x5>=new Date()[_0x4fdd12(0x195)]())return;const _0x63b86a=await Message_1[_0x4fdd12(0x12b)][_0x4fdd12(0x157)]({'where':{'ticketId':_0x162bb5['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x4fdd12(0x14a)]]:(0x0,moment_1[_0x4fdd12(0x12b)])()[_0x4fdd12(0x134)](0x5,_0x4fdd12(0xaf))[_0x4fdd12(0x10c)]()}}});if(_0x63b86a)return;const _0x473dec=(0x0,Debounce_1[_0x4fdd12(0x110)])(async()=>{const _0x306285=_0x4fdd12;if(!_0x5be069[_0x306285(0x1dc)])await _0x1531c1[_0x306285(0x1aa)](_0x162bb5[_0x306285(0x22e)][_0x306285(0x1ee)]+'@'+(_0x162bb5[_0x306285(0x140)]?_0x306285(0x14b):_0x306285(0x7f)),{'text':(0x0,Mustache_1[_0x306285(0x12b)])(_0x5be069[_0x306285(0x8d)],_0x162bb5)});else{const _0x2c34e9=path_1['default'][_0x306285(0x18a)](_0x306285(0x119),_0x306285(0x192)+_0x162bb5['companyId'],_0x5be069[_0x306285(0x1dc)]),_0x1375c6=await(0x0,SendWhatsAppMedia_1[_0x306285(0x13a)])(_0x5be069[_0x306285(0x1dc)],_0x2c34e9,_0x5be069['greetingMessage'],_0x162bb5[_0x306285(0x187)]);await _0x1531c1[_0x306285(0x1aa)](_0x162bb5[_0x306285(0x22e)][_0x306285(0x1ee)]+'@'+(_0x162bb5[_0x306285(0x140)]?_0x306285(0x14b):'s.whatsapp.net'),{..._0x1375c6});}},0x3e8,_0x162bb5['id']);_0x473dec();return;}},handleMsgAck=async(_0x419607,_0x5f2cc2)=>{const _0x3f6ddc=a559_0x53de00,_0x5b2de5=(0x0,socket_1[_0x3f6ddc(0x1a0)])();try{const _0x5cfa88=await Message_1['default'][_0x3f6ddc(0x12f)](_0x419607['key']['id'],{'include':[_0x3f6ddc(0x22e),{'model':Message_1['default'],'as':_0x3f6ddc(0xa2),'include':[_0x3f6ddc(0x22e)]}]});if(!_0x5cfa88){console[_0x3f6ddc(0x1a6)](_0x419607),console[_0x3f6ddc(0x1a6)](_0x3f6ddc(0x176));return;}await _0x5cfa88['update']({'ack':_0x5f2cc2}),_0x5b2de5['to'](_0x5cfa88[_0x3f6ddc(0x18d)][_0x3f6ddc(0x136)]())[_0x3f6ddc(0x223)](_0x3f6ddc(0x105)+_0x5cfa88[_0x3f6ddc(0x187)]+'-appMessage',{'action':_0x3f6ddc(0x21e),'message':_0x5cfa88});}catch(_0x3302d6){Sentry['captureException'](_0x3302d6),logger_1['logger'][_0x3f6ddc(0x9a)]('Error\x20handling\x20message\x20ack.\x20Err:\x20'+_0x3302d6);}};exports[a559_0x53de00(0x18e)]=handleMsgAck;const verifyRecentCampaign=async(_0x28619c,_0x3e8f0e)=>{const _0x191975=a559_0x53de00;if(!_0x28619c[_0x191975(0x194)][_0x191975(0xf0)]){const _0x16fd85=_0x28619c[_0x191975(0x194)][_0x191975(0x98)]['replace'](/\D/g,''),_0x2a1938=await Campaign_1['default'][_0x191975(0x19c)]({'where':{'companyId':_0x3e8f0e,'status':_0x191975(0x1d2),'confirmation':!![]}});if(_0x2a1938){const _0x2885e3=_0x2a1938['map'](_0x3f1d32=>_0x3f1d32['id']),_0x3cdb3=await CampaignShipping_1[_0x191975(0x12b)][_0x191975(0x157)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x2885e3},'number':_0x16fd85,'confirmation':null}});_0x3cdb3&&(await _0x3cdb3[_0x191975(0x21e)]({'confirmedAt':(0x0,moment_1[_0x191975(0x12b)])(),'confirmation':!![]}),await queues_1[_0x191975(0x23b)][_0x191975(0x1a1)](_0x191975(0x209),{'campaignShippingId':_0x3cdb3['id'],'campaignId':_0x3cdb3['campaignId']},{'delay':(0x0,queues_1[_0x191975(0x234)])((0x0,queues_1[_0x191975(0x19d)])(0x0,0xa))}));}}};exports['verifyRecentCampaign']=verifyRecentCampaign;const verifyCampaignMessageAndCloseTicket=async(_0x2ff808,_0x67f5b0)=>{const _0x241516=a559_0x53de00,_0x1b665d=(0x0,socket_1[_0x241516(0x1a0)])(),_0x40ec22=(0x0,exports['getBodyMessage'])(_0x2ff808),_0xd51e5a=/\u200c/['test'](_0x40ec22);if(_0x2ff808[_0x241516(0x194)][_0x241516(0xf0)]&&_0xd51e5a){const _0x11972a=await Message_1['default'][_0x241516(0x157)]({'where':{'id':_0x2ff808[_0x241516(0x194)]['id'],'companyId':_0x67f5b0}}),_0x54b3ef=await Ticket_1[_0x241516(0x12b)][_0x241516(0x12f)](_0x11972a[_0x241516(0x18d)]);await _0x54b3ef[_0x241516(0x21e)]({'status':_0x241516(0x199)}),_0x1b665d['to'](_0x241516(0x105)+_0x54b3ef[_0x241516(0x187)]+_0x241516(0x17d))[_0x241516(0x223)](_0x241516(0x105)+_0x54b3ef[_0x241516(0x187)]+'-ticket',{'action':_0x241516(0x11c),'ticket':_0x54b3ef,'ticketId':_0x54b3ef['id']}),_0x1b665d['to'](_0x241516(0x105)+_0x67f5b0+'-'+_0x54b3ef[_0x241516(0x207)])['to'](_0x54b3ef['id'][_0x241516(0x136)]())['emit'](_0x241516(0x105)+_0x54b3ef[_0x241516(0x187)]+_0x241516(0x1a4),{'action':'update','ticket':_0x54b3ef,'ticketId':_0x54b3ef['id']});}};exports[a559_0x53de00(0xd6)]=verifyCampaignMessageAndCloseTicket;const filterMessages=_0x39c807=>{const _0x309cb5=a559_0x53de00;if([baileys_1[_0x309cb5(0x1c0)][_0x309cb5(0x102)],baileys_1[_0x309cb5(0x1c0)][_0x309cb5(0x201)],baileys_1[_0x309cb5(0x1c0)][_0x309cb5(0x1b7)],baileys_1['WAMessageStubType']['CIPHERTEXT']]['includes'](_0x39c807[_0x309cb5(0xc3)]))return![];return!![];},wbotMessageListener=async(_0x22139f,_0x102959,_0x2153d4)=>{const _0x530b1c=a559_0x53de00;_0x22139f['ev']['on'](_0x530b1c(0x1b0),async _0x48e5f3=>{const _0x29af35=_0x530b1c,_0x2ae776=_0x48e5f3[_0x29af35(0x227)]['filter'](filterMessages);if(!_0x2ae776)return;await app_1[_0x29af35(0x12b)][_0x29af35(0x124)](_0x29af35(0x17b))[_0x29af35(0x235)][_0x29af35(0x1a1)](_0x29af35(0x222),{'whatsappId':_0x2153d4['id'],'messages':_0x2ae776,'companyId':_0x102959},{'removeOnComplete':!![],'attempts':0x3});}),_0x22139f['ev']['on'](_0x530b1c(0x189),async _0x350bc6=>{const _0x335412=_0x530b1c;if(_0x350bc6[_0x335412(0xeb)]===0x0)return;await app_1[_0x335412(0x12b)]['get'](_0x335412(0x17b))[_0x335412(0x235)]['add']('MessageUpdateJob',{'whatsappId':_0x2153d4['id'],'messageUpdate':_0x350bc6,'companyId':_0x102959},{'removeOnComplete':!![],'attempts':0x3,'delay':0x64});}),_0x22139f['ev']['on'](_0x530b1c(0x1d4),async _0x3392ed=>{const _0x37869d=_0x530b1c;console[_0x37869d(0x1a6)](_0x3392ed);if(_0x3392ed['length']===0x0)return;for(const _0x520eea of _0x3392ed){const _0x240852=_0x520eea['id'][_0x37869d(0x1cb)]('@')[0x0],_0x86f92e=_0x520eea[_0x37869d(0x159)]||_0x240852,_0x31cc2a={'name':_0x86f92e,'number':_0x240852,'isGroup':!![],'companyId':_0x102959,'remoteJid':_0x520eea['id'],'whatsappId':_0x22139f['id']};await(0x0,CreateOrUpdateContactService_1[_0x37869d(0x12b)])(_0x31cc2a,_0x22139f,_0x520eea['id']);}});};exports[a559_0x53de00(0xa0)]=wbotMessageListener;