const a558_0x3b09f7=a558_0x3634;(function(_0x1aee5e,_0x563ebf){const _0x23fcbb=a558_0x3634,_0x39b71f=_0x1aee5e();while(!![]){try{const _0x51cd01=parseInt(_0x23fcbb(0x20a))/0x1+-parseInt(_0x23fcbb(0x203))/0x2+parseInt(_0x23fcbb(0x147))/0x3+-parseInt(_0x23fcbb(0x201))/0x4+-parseInt(_0x23fcbb(0x16a))/0x5+-parseInt(_0x23fcbb(0x10d))/0x6+parseInt(_0x23fcbb(0x1ec))/0x7*(parseInt(_0x23fcbb(0x14d))/0x8);if(_0x51cd01===_0x563ebf)break;else _0x39b71f['push'](_0x39b71f['shift']());}catch(_0x154469){_0x39b71f['push'](_0x39b71f['shift']());}}}(a558_0x576a,0xa8940));const a558_0x523fa5=(function(){let _0x500baa=!![];return function(_0x49f783,_0x1f777e){const _0x58bbf3=_0x500baa?function(){const _0x1cb660=a558_0x3634;if(_0x1f777e){const _0x41c5e5=_0x1f777e[_0x1cb660(0x286)](_0x49f783,arguments);return _0x1f777e=null,_0x41c5e5;}}:function(){};return _0x500baa=![],_0x58bbf3;};}()),a558_0x2057e4=a558_0x523fa5(this,function(){const _0x2f7e7a=a558_0x3634;return a558_0x2057e4[_0x2f7e7a(0x27d)]()[_0x2f7e7a(0x173)]('(((.+)+)+)+$')[_0x2f7e7a(0x27d)]()[_0x2f7e7a(0x1e3)](a558_0x2057e4)['search'](_0x2f7e7a(0x19e));});a558_0x2057e4();'use strict';var __createBinding=this&&this[a558_0x3b09f7(0x11d)]||(Object[a558_0x3b09f7(0x17c)]?function(_0x132034,_0x39da6d,_0x53551f,_0x1f49fd){const _0x5c8050=a558_0x3b09f7;if(_0x1f49fd===undefined)_0x1f49fd=_0x53551f;var _0x3158e5=Object[_0x5c8050(0x275)](_0x39da6d,_0x53551f);(!_0x3158e5||(_0x5c8050(0x1da)in _0x3158e5?!_0x39da6d[_0x5c8050(0x197)]:_0x3158e5['writable']||_0x3158e5[_0x5c8050(0x25c)]))&&(_0x3158e5={'enumerable':!![],'get':function(){return _0x39da6d[_0x53551f];}}),Object[_0x5c8050(0x216)](_0x132034,_0x1f49fd,_0x3158e5);}:function(_0x4d322d,_0x4d615b,_0x4b2239,_0x5d276d){if(_0x5d276d===undefined)_0x5d276d=_0x4b2239;_0x4d322d[_0x5d276d]=_0x4d615b[_0x4b2239];}),__setModuleDefault=this&&this[a558_0x3b09f7(0x284)]||(Object[a558_0x3b09f7(0x17c)]?function(_0x43ac34,_0x5c8481){const _0x5d9e51=a558_0x3b09f7;Object[_0x5d9e51(0x216)](_0x43ac34,_0x5d9e51(0x1a8),{'enumerable':!![],'value':_0x5c8481});}:function(_0x2613c2,_0x4b5a90){const _0xf034f8=a558_0x3b09f7;_0x2613c2[_0xf034f8(0x1a8)]=_0x4b5a90;}),__importStar=this&&this[a558_0x3b09f7(0x10f)]||function(_0x1723c7){const _0x276023=a558_0x3b09f7;if(_0x1723c7&&_0x1723c7[_0x276023(0x197)])return _0x1723c7;var _0x5d87ba={};if(_0x1723c7!=null){for(var _0x518bc7 in _0x1723c7)if(_0x518bc7!=='default'&&Object['prototype']['hasOwnProperty'][_0x276023(0x23c)](_0x1723c7,_0x518bc7))__createBinding(_0x5d87ba,_0x1723c7,_0x518bc7);}return __setModuleDefault(_0x5d87ba,_0x1723c7),_0x5d87ba;},__importDefault=this&&this[a558_0x3b09f7(0x253)]||function(_0xc0888e){const _0x1372ef=a558_0x3b09f7;return _0xc0888e&&_0xc0888e[_0x1372ef(0x197)]?_0xc0888e:{'default':_0xc0888e};};Object['defineProperty'](exports,a558_0x3b09f7(0x197),{'value':!![]}),exports[a558_0x3b09f7(0xf2)]=exports[a558_0x3b09f7(0x115)]=exports[a558_0x3b09f7(0x266)]=exports[a558_0x3b09f7(0x1a4)]=exports[a558_0x3b09f7(0x1cc)]=exports[a558_0x3b09f7(0x178)]=exports['handleRating']=exports[a558_0x3b09f7(0xe9)]=exports[a558_0x3b09f7(0x245)]=exports['verifyMessage']=exports[a558_0x3b09f7(0x1d4)]=exports[a558_0x3b09f7(0x100)]=exports[a558_0x3b09f7(0x1ed)]=exports[a558_0x3b09f7(0x297)]=exports[a558_0x3b09f7(0x11f)]=exports[a558_0x3b09f7(0x150)]=exports[a558_0x3b09f7(0x259)]=exports[a558_0x3b09f7(0x29d)]=exports['validaCpfCnpj']=exports[a558_0x3b09f7(0x28f)]=exports[a558_0x3b09f7(0x15b)]=void 0x0;const path_1=__importStar(require(a558_0x3b09f7(0x188))),util_1=require(a558_0x3b09f7(0x289)),fs_1=require('fs'),Sentry=__importStar(require('@sentry/node')),lodash_1=require(a558_0x3b09f7(0x233)),baileys_1=require('@whiskeysockets/baileys'),MessageUtils=__importStar(require(a558_0x3b09f7(0x1aa))),stream_throttle_1=require('stream-throttle'),Contact_1=__importDefault(require(a558_0x3b09f7(0x102))),Ticket_1=__importDefault(require('../../models/Ticket')),Message_1=__importDefault(require(a558_0x3b09f7(0x26f))),OldMessage_1=__importDefault(require('../../models/OldMessage')),socket_1=require('../../libs/socket'),CreateMessageService_1=__importDefault(require(a558_0x3b09f7(0x280))),logger_1=require(a558_0x3b09f7(0x29c)),CreateOrUpdateContactService_1=__importDefault(require(a558_0x3b09f7(0x182))),FindOrCreateTicketService_1=__importDefault(require(a558_0x3b09f7(0x1ab))),ShowWhatsAppService_1=__importDefault(require(a558_0x3b09f7(0x19b))),UpdateTicketService_1=__importDefault(require(a558_0x3b09f7(0x2ab))),Mustache_1=__importDefault(require(a558_0x3b09f7(0x19c))),UserRating_1=__importDefault(require('../../models/UserRating')),SendWhatsAppMessage_1=__importDefault(require(a558_0x3b09f7(0x1d0))),moment_1=__importDefault(require(a558_0x3b09f7(0x21d))),Queue_1=__importDefault(require(a558_0x3b09f7(0x295))),QueueOption_1=__importDefault(require(a558_0x3b09f7(0x15e))),FindOrCreateATicketTrakingService_1=__importDefault(require(a558_0x3b09f7(0x20c))),VerifyCurrentSchedule_1=__importDefault(require(a558_0x3b09f7(0x152))),Campaign_1=__importDefault(require(a558_0x3b09f7(0x18b))),CampaignShipping_1=__importDefault(require(a558_0x3b09f7(0x1af))),sequelize_1=require('sequelize'),queues_1=require('../../queues'),User_1=__importDefault(require('../../models/User')),Setting_1=__importDefault(require(a558_0x3b09f7(0x185))),cache_1=require(a558_0x3b09f7(0x1f1)),Debounce_1=require('../../helpers/Debounce'),openai_1=require(a558_0x3b09f7(0x1a6)),fluent_ffmpeg_1=__importDefault(require(a558_0x3b09f7(0x1b1))),microsoft_cognitiveservices_speech_sdk_1=require('microsoft-cognitiveservices-speech-sdk'),providers_1=require(a558_0x3b09f7(0x13a)),typebotListener_1=__importDefault(require(a558_0x3b09f7(0x21c))),ShowQueueIntegrationService_1=__importDefault(require(a558_0x3b09f7(0x171))),SendWhatsAppMedia_1=require(a558_0x3b09f7(0x190)),fs_2=__importDefault(require('fs')),request_1=__importDefault(require('request')),ffmpeg_static_1=__importDefault(require(a558_0x3b09f7(0x1f2))),app_1=__importDefault(require(a558_0x3b09f7(0x13d))),mime_1=__importDefault(require(a558_0x3b09f7(0xed))),wbot_1=require(a558_0x3b09f7(0x191)),SendPresenceStatus_1=require(a558_0x3b09f7(0x16c)),MakeRandomId_1=require(a558_0x3b09f7(0x111));fluent_ffmpeg_1['default'][a558_0x3b09f7(0x136)](ffmpeg_static_1[a558_0x3b09f7(0x1a8)]);const sessionsOpenAi=[],isNumeric=_0x536324=>/^-?\d+$/[a558_0x3b09f7(0x168)](_0x536324);exports['isNumeric']=isNumeric;let outOfHourMessageControl=[],completionMessageControl=[],greetingMessageControl=[],farewellMessageControl=[];const writeFileAsync=(0x0,util_1['promisify'])(fs_1[a558_0x3b09f7(0x28c)]),getTypeMessage=_0xa47c37=>{const _0x4f98bf=a558_0x3b09f7;return(0x0,baileys_1['getContentType'])(_0xa47c37[_0x4f98bf(0x2b2)]);},removeNonPrintableChars=_0x2d5aad=>{return _0x2d5aad['replace'](/[\x00-\x1F\x7F-\x9F]/g,'');};function a558_0x3634(_0x1f5c13,_0x4d4482){const _0x5334cf=a558_0x576a();return a558_0x3634=function(_0x2057e4,_0x523fa5){_0x2057e4=_0x2057e4-0xe9;let _0x576abe=_0x5334cf[_0x2057e4];return _0x576abe;},a558_0x3634(_0x1f5c13,_0x4d4482);}exports[a558_0x3b09f7(0x28f)]=removeNonPrintableChars;async function getQueues(_0x336627){const _0x3c3171=a558_0x3b09f7;try{const _0x19c05f=await Queue_1['default'][_0x3c3171(0xf5)]({'where':{'companyId':_0x336627}});return _0x19c05f;}catch(_0x2740b6){return console[_0x3c3171(0x105)](_0x3c3171(0x1f3),_0x2740b6),[];}}async function getContactFromTicket(_0x548193){const _0x11c3fa=a558_0x3b09f7;try{const _0x46bf9e=await Ticket_1[_0x11c3fa(0x1a8)][_0x11c3fa(0x237)](_0x548193,{'include':[{'model':Contact_1[_0x11c3fa(0x1a8)],'as':_0x11c3fa(0x135)}]});return _0x46bf9e&&_0x46bf9e[_0x11c3fa(0x135)]?_0x46bf9e[_0x11c3fa(0x135)]:(console['log'](_0x11c3fa(0x21e)),null);}catch(_0x140e27){return console[_0x11c3fa(0x105)](_0x11c3fa(0x25d),_0x140e27),null;}}function validaCpfCnpj(_0x4a1fc7){const _0x29c7ab=a558_0x3b09f7;if(_0x4a1fc7[_0x29c7ab(0x235)]==0xb){var _0x3448a0=_0x4a1fc7[_0x29c7ab(0x26c)]();_0x3448a0=_0x3448a0[_0x29c7ab(0x112)](/\./g,''),_0x3448a0=_0x3448a0[_0x29c7ab(0x112)]('-',''),_0x3448a0=_0x3448a0[_0x29c7ab(0x187)]('');var _0x452751=0x0,_0x15aa3a=0x0,_0x26c32d=![];for(var _0x4aa739=0x1;_0x3448a0[_0x29c7ab(0x235)]>_0x4aa739;_0x4aa739++){_0x3448a0[_0x4aa739-0x1]!=_0x3448a0[_0x4aa739]&&(_0x26c32d=!![]);}if(_0x26c32d==![])return![];for(var _0x4aa739=0x0,_0xf6f47=0xa;_0x3448a0[_0x29c7ab(0x235)]-0x2>_0x4aa739;_0x4aa739++,_0xf6f47--){_0x452751+=_0x3448a0[_0x4aa739]*_0xf6f47;}_0x452751=_0x452751*0xa%0xb;_0x452751==0xa&&(_0x452751=0x0);if(_0x452751!=_0x3448a0[0x9])return![];for(var _0x4aa739=0x0,_0xf6f47=0xb;_0x3448a0[_0x29c7ab(0x235)]-0x1>_0x4aa739;_0x4aa739++,_0xf6f47--){_0x15aa3a+=_0x3448a0[_0x4aa739]*_0xf6f47;}return _0x15aa3a=_0x15aa3a*0xa%0xb,_0x15aa3a==0xa&&(_0x15aa3a=0x0),_0x15aa3a!=_0x3448a0[0xa]?![]:!![];}else{if(_0x4a1fc7[_0x29c7ab(0x235)]==0xe){var _0x160d0a=_0x4a1fc7['trim']();_0x160d0a=_0x160d0a[_0x29c7ab(0x112)](/\./g,''),_0x160d0a=_0x160d0a[_0x29c7ab(0x112)]('-',''),_0x160d0a=_0x160d0a[_0x29c7ab(0x112)]('/',''),_0x160d0a=_0x160d0a[_0x29c7ab(0x187)]('');var _0x452751=0x0,_0x15aa3a=0x0,_0x26c32d=![];for(var _0x4aa739=0x1;_0x160d0a['length']>_0x4aa739;_0x4aa739++){_0x160d0a[_0x4aa739-0x1]!=_0x160d0a[_0x4aa739]&&(_0x26c32d=!![]);}if(_0x26c32d==![])return![];for(var _0x4aa739=0x0,_0x44bbcf=0x5,_0x150361=0xd;_0x160d0a['length']-0x2>_0x4aa739;_0x4aa739++,_0x44bbcf--,_0x150361--){_0x44bbcf>=0x2?_0x452751+=_0x160d0a[_0x4aa739]*_0x44bbcf:_0x452751+=_0x160d0a[_0x4aa739]*_0x150361;}_0x452751=_0x452751%0xb;_0x452751<0x2?_0x452751=0x0:_0x452751=0xb-_0x452751;if(_0x452751!=_0x160d0a[0xc])return![];for(var _0x4aa739=0x0,_0x44bbcf=0x6,_0x150361=0xe;_0x160d0a[_0x29c7ab(0x235)]-0x1>_0x4aa739;_0x4aa739++,_0x44bbcf--,_0x150361--){_0x44bbcf>=0x2?_0x15aa3a+=_0x160d0a[_0x4aa739]*_0x44bbcf:_0x15aa3a+=_0x160d0a[_0x4aa739]*_0x150361;}return _0x15aa3a=_0x15aa3a%0xb,_0x15aa3a<0x2?_0x15aa3a=0x0:_0x15aa3a=0xb-_0x15aa3a,_0x15aa3a!=_0x160d0a[0xd]?![]:!![];}else return![];}}exports['validaCpfCnpj']=validaCpfCnpj;function timeout(_0x373c3c){return new Promise(_0x103e3f=>setTimeout(_0x103e3f,_0x373c3c));}async function sleep(_0x18b87a){await timeout(_0x18b87a);}exports[a558_0x3b09f7(0x29d)]=sleep;const sendMessageImage=async(_0x5db668,_0x12f348,_0x39484c,_0x56f408,_0x392b86)=>{const _0x3c84e8=a558_0x3b09f7;let _0x2e2b97;try{_0x2e2b97=await _0x5db668[_0x3c84e8(0x258)](_0x12f348[_0x3c84e8(0xf7)]+'@'+(_0x39484c[_0x3c84e8(0x1a2)]?_0x3c84e8(0x281):_0x3c84e8(0x256)),{'image':_0x56f408?{'url':_0x56f408}:fs_2[_0x3c84e8(0x1a8)]['readFileSync']('public/temp/'+_0x392b86+'-'+makeid(0xa)),'fileName':_0x392b86,'caption':_0x392b86,'mimetype':'image/jpeg'});}catch(_0x2b9f63){_0x2e2b97=await _0x5db668[_0x3c84e8(0x258)](_0x12f348[_0x3c84e8(0xf7)]+'@'+(_0x39484c[_0x3c84e8(0x1a2)]?_0x3c84e8(0x281):_0x3c84e8(0x256)),{'text':(0x0,Mustache_1[_0x3c84e8(0x1a8)])(_0x3c84e8(0x218),_0x39484c)});}(0x0,exports['verifyMessage'])(_0x2e2b97,_0x39484c,_0x12f348);};exports[a558_0x3b09f7(0x259)]=sendMessageImage;const sendMessageLink=async(_0x2c0878,_0x4cac75,_0x207543,_0x4be331,_0x379ccb)=>{const _0x3f954f=a558_0x3b09f7;let _0x43b931;try{_0x43b931=await _0x2c0878['sendMessage'](_0x4cac75[_0x3f954f(0xf7)]+'@'+(_0x207543[_0x3f954f(0x1a2)]?_0x3f954f(0x281):_0x3f954f(0x256)),{'document':_0x4be331?{'url':_0x4be331}:fs_2[_0x3f954f(0x1a8)][_0x3f954f(0x291)](_0x3f954f(0x1d7)+_0x379ccb+'-'+makeid(0xa)),'fileName':_0x379ccb,'caption':_0x379ccb,'mimetype':_0x3f954f(0x1b9)});}catch(_0x1f382e){_0x43b931=await _0x2c0878[_0x3f954f(0x258)](_0x4cac75['number']+'@'+(_0x207543[_0x3f954f(0x1a2)]?_0x3f954f(0x281):_0x3f954f(0x256)),{'text':(0x0,Mustache_1[_0x3f954f(0x1a8)])('Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!',_0x207543)});}(0x0,exports[_0x3f954f(0xf8)])(_0x43b931,_0x207543,_0x4cac75);};exports[a558_0x3b09f7(0x150)]=sendMessageLink;function makeid(_0x488685){const _0xfc8fcd=a558_0x3b09f7;var _0x2abce8='',_0xef533a=_0xfc8fcd(0x113),_0x23ae74=_0xef533a['length'];for(var _0x4fdc05=0x0;_0x4fdc05<_0x488685;_0x4fdc05++){_0x2abce8+=_0xef533a[_0xfc8fcd(0x146)](Math[_0xfc8fcd(0x130)](Math[_0xfc8fcd(0x1fe)]()*_0x23ae74));}return _0x2abce8;}exports[a558_0x3b09f7(0x11f)]=makeid;const msgLocation=(_0x269139,_0x470458,_0x1e8244)=>{const _0x105db0=a558_0x3b09f7;if(_0x269139){var _0x257e7a=Buffer[_0x105db0(0x165)](_0x269139)[_0x105db0(0x27d)]('base64');let _0x25da85=_0x105db0(0x1c7)+_0x257e7a+_0x105db0(0x143)+_0x470458+'%2C'+_0x1e8244+_0x105db0(0x145)+_0x470458+',\x20'+_0x1e8244+'\x20';return _0x25da85;}},getBodyMessage=_0x1f2358=>{const _0x12ad8a=a558_0x3b09f7;try{let _0x462e8c=getTypeMessage(_0x1f2358);const _0x1fde86={'conversation':MessageUtils[_0x12ad8a(0xf3)](_0x1f2358),'editedMessage':_0x1f2358?.[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x114)]?.[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x226)]?.[_0x12ad8a(0x114)]?.[_0x12ad8a(0x244)]||_0x1f2358?.[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x114)]?.['message']?.[_0x12ad8a(0x1e5)]?.[_0x12ad8a(0x15c)],'imageMessage':MessageUtils[_0x12ad8a(0x1ea)](_0x1f2358),'videoMessage':MessageUtils[_0x12ad8a(0x250)](_0x1f2358),'extendedTextMessage':_0x1f2358[_0x12ad8a(0x2b2)]?.['extendedTextMessage']?.[_0x12ad8a(0x15c)],'buttonsResponseMessage':MessageUtils[_0x12ad8a(0x161)](_0x1f2358),'templateButtonReplyMessage':_0x1f2358[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x125)]?.[_0x12ad8a(0x2a8)],'messageContextInfo':_0x1f2358[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x158)]?.[_0x12ad8a(0x14b)]||_0x1f2358[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x11c)]?.['title'],'buttonsMessage':MessageUtils['getBodyButton'](_0x1f2358)||_0x1f2358[_0x12ad8a(0x2b2)]?.['listResponseMessage']?.[_0x12ad8a(0x169)]?.[_0x12ad8a(0x16f)],'viewOnceMessage':MessageUtils['getViewOnceMessage'](_0x1f2358),'viewOnceMessageV2':MessageUtils['getViewOnceMessageV2'](_0x1f2358),'stickerMessage':MessageUtils[_0x12ad8a(0x1cb)](_0x1f2358),'contactMessage':MessageUtils['getContactMessage'](_0x1f2358),'contactsArrayMessage':_0x1f2358['message']?.[_0x12ad8a(0x267)]?.[_0x12ad8a(0x116)]&&MessageUtils[_0x12ad8a(0x1dc)](_0x1f2358),'pollCreationMessageV2':_0x1f2358['message']?.['pollCreationMessageV2']?.[_0x12ad8a(0x1c9)]||_0x12ad8a(0x162),'pollCreationMessageV3':_0x1f2358[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x24d)]?.['name']||_0x12ad8a(0x162),'interactiveMessage':_0x1f2358[_0x12ad8a(0x2b2)]?.['interactiveMessage']?.[_0x12ad8a(0x251)]||_0x1f2358[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x254)]?.[_0x12ad8a(0x14f)]||_0x12ad8a(0x19f),'locationMessage':MessageUtils[_0x12ad8a(0x270)](_0x1f2358),'liveLocationMessage':_0x12ad8a(0x1f7)+_0x1f2358[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x18c)]?.[_0x12ad8a(0x22c)]+'\x20-\x20Longitude:\x20'+_0x1f2358[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x18c)]?.[_0x12ad8a(0x21a)],'documentMessage':MessageUtils[_0x12ad8a(0x24c)](_0x1f2358),'documentWithCaptionMessage':_0x1f2358[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x17b)]?.[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x2a3)]?.[_0x12ad8a(0x29b)],'audioMessage':MessageUtils[_0x12ad8a(0x19a)](_0x1f2358),'ephemeralMessage':_0x1f2358[_0x12ad8a(0x2b2)]?.['ephemeralMessage']?.[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x1e5)]?.[_0x12ad8a(0x15c)],'listMessage':MessageUtils[_0x12ad8a(0x208)](_0x1f2358)||_0x1f2358['message']?.['listResponseMessage']?.[_0x12ad8a(0x174)],'listResponseMessage':MessageUtils[_0x12ad8a(0x1be)](_0x1f2358),'reactionMessage':MessageUtils['getReactionMessage'](_0x1f2358)||'reaction','advertising':MessageUtils[_0x12ad8a(0x243)](_0x1f2358)||_0x1f2358['message']?.[_0x12ad8a(0x11c)]?.[_0x12ad8a(0x14f)]?.[_0x12ad8a(0x299)]?.['title'],'productMessage':_0x1f2358[_0x12ad8a(0x2b2)]?.[_0x12ad8a(0x164)]?.[_0x12ad8a(0x273)]?.['productImage']?.[_0x12ad8a(0x29b)]||_0x12ad8a(0x1cd),'multiProductMessage':_0x12ad8a(0x154),'orderMessage':_0x12ad8a(0x123),'paymentMessage':MessageUtils[_0x12ad8a(0xf6)](_0x1f2358),'paymentRequestMessage':'Solicitação\x20de\x20Pagamento','groupInviteMessage':MessageUtils['getGroupInviteMessage'](_0x1f2358),'revokeInviteMessage':'Convite\x20Revogado','protocolMessage':_0x1f2358[_0x12ad8a(0x2b2)]?.['protocolMessage']?.[_0x12ad8a(0x114)]?.[_0x12ad8a(0x244)]||null,'disappearingMessage':_0x12ad8a(0x12d),'callMessage':MessageUtils['getCallMessage'](_0x1f2358),'templateMessage':MessageUtils['getTemplateMessage'](_0x1f2358),'statusUpdateMessage':_0x12ad8a(0x27f)};return _0x1fde86[_0x462e8c]||null;}catch(_0x2ac691){return console[_0x12ad8a(0x105)](_0x12ad8a(0x1ba),_0x2ac691),null;}};exports[a558_0x3b09f7(0x297)]=getBodyMessage;const getQuotedMessage=_0x4545a7=>{const _0x450f6b=a558_0x3b09f7,_0xdcab47=_0x4545a7[_0x450f6b(0x2b2)][_0x450f6b(0x200)][_0x450f6b(0x14f)]||_0x4545a7[_0x450f6b(0x2b2)][_0x450f6b(0x213)][_0x450f6b(0x14f)]||_0x4545a7[_0x450f6b(0x2b2)]?.[_0x450f6b(0x2a3)]||_0x4545a7[_0x450f6b(0x2b2)][_0x450f6b(0x1e5)][_0x450f6b(0x14f)]||_0x4545a7[_0x450f6b(0x2b2)][_0x450f6b(0x158)][_0x450f6b(0x14f)]||_0x4545a7[_0x450f6b(0x2b2)][_0x450f6b(0x11c)][_0x450f6b(0x14f)]||_0x4545a7[_0x450f6b(0x2b2)][_0x450f6b(0x125)][_0x450f6b(0x14f)]||_0x4545a7[_0x450f6b(0x2b2)][_0x450f6b(0x158)]?.[_0x450f6b(0x14f)]||_0x4545a7?.['message']?.[_0x450f6b(0x158)]?.['selectedButtonId']||_0x4545a7[_0x450f6b(0x2b2)][_0x450f6b(0x11c)]?.[_0x450f6b(0x169)]?.[_0x450f6b(0x16f)]||_0x4545a7?.[_0x450f6b(0x2b2)]?.['listResponseMessage']?.[_0x450f6b(0x169)][_0x450f6b(0x16f)]||_0x4545a7[_0x450f6b(0x2b2)][_0x450f6b(0x11c)]?.[_0x450f6b(0x14f)];return _0x4545a7[_0x450f6b(0x2b2)][_0x450f6b(0x138)],(0x0,baileys_1['extractMessageContent'])(_0xdcab47[Object[_0x450f6b(0x215)](_0xdcab47)[_0x450f6b(0x19d)]()[_0x450f6b(0x1db)]()['value']]);};exports[a558_0x3b09f7(0x1ed)]=getQuotedMessage;const getQuotedMessageId=_0x21fe9a=>{const _0x46fc36=a558_0x3b09f7,_0xf94263=(0x0,baileys_1['extractMessageContent'])(_0x21fe9a['message'])[Object[_0x46fc36(0x215)](_0x21fe9a?.[_0x46fc36(0x2b2)])['values']()[_0x46fc36(0x1db)]()['value']];let _0x56a48a=_0x21fe9a?.['message']?.[_0x46fc36(0x18d)]?_0x21fe9a?.[_0x46fc36(0x2b2)]?.['reactionMessage']?.[_0x46fc36(0x20b)]?.['id']:'';return _0x56a48a?_0x56a48a:_0xf94263?.[_0x46fc36(0x14f)]?.[_0x46fc36(0x269)];};exports[a558_0x3b09f7(0x100)]=getQuotedMessageId;const getMeSocket=_0x44b079=>{const _0xf9cf33=a558_0x3b09f7;return{'id':(0x0,baileys_1[_0xf9cf33(0x15d)])(_0x44b079[_0xf9cf33(0x282)]['id']),'name':_0x44b079['user'][_0xf9cf33(0x1c9)]};},getSenderMessage=(_0x7cf600,_0x396d3b)=>{const _0x39c259=a558_0x3b09f7,_0x5a98e1=getMeSocket(_0x396d3b);if(_0x7cf600['key'][_0x39c259(0x255)])return _0x5a98e1['id'];const _0x11ba91=_0x7cf600[_0x39c259(0x17a)]||_0x7cf600[_0x39c259(0x20b)]['participant']||_0x7cf600['key'][_0x39c259(0x221)]||undefined;return _0x11ba91&&(0x0,baileys_1['jidNormalizedUser'])(_0x11ba91);},getContactMessage=async(_0x20c63a,_0x396fc0)=>{const _0x24c6e6=a558_0x3b09f7,_0x1ea744=_0x20c63a[_0x24c6e6(0x20b)]['remoteJid'][_0x24c6e6(0xeb)]('g.us'),_0x117c15=_0x20c63a['key'][_0x24c6e6(0x221)]['replace'](/\D/g,'');return _0x1ea744?{'id':getSenderMessage(_0x20c63a,_0x396fc0),'name':_0x20c63a[_0x24c6e6(0xea)]}:{'id':_0x20c63a['key'][_0x24c6e6(0x221)],'name':_0x20c63a['key'][_0x24c6e6(0x255)]?_0x117c15:_0x20c63a['pushName']};},getUnpackedMessage=_0x1d49ec=>{const _0x146f2d=a558_0x3b09f7;return _0x1d49ec[_0x146f2d(0x2b2)]?.[_0x146f2d(0x17b)]?.[_0x146f2d(0x2b2)]||_0x1d49ec[_0x146f2d(0x2b2)]?.['extendedTextMessage']?.[_0x146f2d(0x14f)]?.[_0x146f2d(0x140)]||_0x1d49ec['message']?.[_0x146f2d(0x129)]?.['message']||_0x1d49ec[_0x146f2d(0x2b2)]?.['viewOnceMessage']?.[_0x146f2d(0x2b2)]||_0x1d49ec[_0x146f2d(0x2b2)]?.[_0x146f2d(0x228)]?.[_0x146f2d(0x2b2)]||_0x1d49ec[_0x146f2d(0x2b2)]?.['ephemeralMessage']?.[_0x146f2d(0x2b2)]||_0x1d49ec['message']?.[_0x146f2d(0x29e)]?.[_0x146f2d(0x22d)]||_0x1d49ec[_0x146f2d(0x2b2)]?.['templateMessage']?.[_0x146f2d(0xf9)]||_0x1d49ec[_0x146f2d(0x2b2)]?.[_0x146f2d(0x29e)]?.[_0x146f2d(0x293)]||_0x1d49ec['message']?.['interactiveMessage']?.['header']||_0x1d49ec[_0x146f2d(0x2b2)]?.[_0x146f2d(0x118)]?.[_0x146f2d(0x263)]?.['hydratedTemplate']||_0x1d49ec[_0x146f2d(0x2b2)];},getMessageMedia=_0x21de8d=>{const _0xdd62bb=a558_0x3b09f7;return _0x21de8d?.['imageMessage']||_0x21de8d?.[_0xdd62bb(0x108)]||_0x21de8d?.['videoMessage']||_0x21de8d?.[_0xdd62bb(0x1c8)]||_0x21de8d?.[_0xdd62bb(0x2a3)]||null;},downloadMedia=async _0x2ed1ec=>{const _0x510920=a558_0x3b09f7,_0x9a288=getUnpackedMessage(_0x2ed1ec),_0x56c71d=getMessageMedia(_0x9a288);if(!_0x56c71d)return null;const _0x3539fc=_0x9a288?.[_0x510920(0x2a3)]?_0x510920(0x1ff):_0x56c71d[_0x510920(0x246)][_0x510920(0x187)]('/')[0x0][_0x510920(0x112)]('application',_0x510920(0x1ff))?_0x56c71d['mimetype']['split']('/')[0x0][_0x510920(0x112)](_0x510920(0x285),_0x510920(0x1ff)):_0x56c71d[_0x510920(0x246)][_0x510920(0x187)]('/')[0x0];let _0x9ce7f,_0x513dd9=0x0;while(_0x513dd9<0xa&&!_0x9ce7f){try{_0x56c71d?.[_0x510920(0x1df)]&&(_0x56c71d[_0x510920(0x1bb)]=''),_0x9ce7f=await(0x0,baileys_1['downloadContentFromMessage'])(_0x56c71d,_0x3539fc);}catch(_0x134b49){_0x513dd9+=0x1,await new Promise(_0x4f6aec=>{setTimeout(_0x4f6aec,0x3e8*_0x513dd9*0x2);}),logger_1[_0x510920(0x211)][_0x510920(0x1c1)]('>>>>\x20erro\x20'+_0x513dd9+_0x510920(0x1f6)+_0x2ed1ec?.['key']?.['id']);}}if(!_0x9ce7f)throw new Error(_0x510920(0x29a));let _0x1e2974=_0x9a288?.[_0x510920(0x2a3)]?.['fileName']||'';if(!_0x1e2974){const _0xfede37=mime_1[_0x510920(0x1a8)][_0x510920(0x1a0)](_0x56c71d[_0x510920(0x246)]);_0x1e2974=(0x0,MakeRandomId_1['makeRandomId'])(0x5)+'-'+new Date()[_0x510920(0x1e1)]()+'.'+_0xfede37;}else _0x1e2974=_0x1e2974['split']('.')[_0x510920(0x127)](0x0,-0x1)[_0x510920(0x230)]('.')+'.'+(0x0,MakeRandomId_1[_0x510920(0x101)])(0x5)+'.'+_0x1e2974[_0x510920(0x187)]('.')[_0x510920(0x127)](-0x1);const _0x4f84fd=0x5*0x400*0x400/0x8,_0x51ed77=0x400*0x400/0x8,_0x147cb9=0x400*0x400,_0x1aab73=new stream_throttle_1[(_0x510920(0x1c4))]({'rate':_0x4f84fd});let _0x25580b=Buffer[_0x510920(0x165)]([]),_0x350122=0x0;const _0x4c9842=Date['now']();try{for await(const _0x14c50e of _0x9ce7f[_0x510920(0x29f)](_0x1aab73)){_0x25580b=Buffer[_0x510920(0x117)]([_0x25580b,_0x14c50e]),_0x350122+=_0x14c50e['length'],_0x350122>_0x147cb9&&(_0x1aab73[_0x510920(0x272)]=_0x51ed77);}}catch(_0x5ec3cb){return{'data':'error','mimetype':'','filename':''};}const _0x1c85d9=Date[_0x510920(0x276)](),_0x1e5a69=(_0x1c85d9-_0x4c9842)/0x3e8,_0xf134ef=_0x350122/_0x1e5a69;logger_1[_0x510920(0x211)]['debug'](_0x1e2974+_0x510920(0x17d)+_0x1e5a69['toFixed'](0x2)+'\x20seconds\x20with\x20an\x20effective\x20speed\x20of\x20'+(_0xf134ef/0x400/0x400)[_0x510920(0x14c)](0x2)+_0x510920(0x23f));if(!_0x25580b){Sentry[_0x510920(0x13b)](_0x510920(0x160),{'msg':_0x2ed1ec}),Sentry['captureException'](new Error(_0x510920(0x160)));throw new Error(_0x510920(0x160));}const _0x23512f={'data':_0x25580b,'mimetype':_0x56c71d[_0x510920(0x246)],'filename':_0x1e2974};return _0x23512f;},verifyContact=async(_0x2e3c78,_0x1c3660,_0x5a6350)=>{const _0x30e3c6=a558_0x3b09f7,_0x5349de={'name':_0x2e3c78?.[_0x30e3c6(0x1c9)]||_0x2e3c78['id']['replace'](/\D/g,''),'number':_0x2e3c78['id'][_0x30e3c6(0x1e4)](0x0,_0x2e3c78['id'][_0x30e3c6(0x18f)]('@')),'isGroup':_0x2e3c78['id']['includes']('g.us'),'companyId':_0x5a6350,'whatsappId':_0x1c3660['id']},_0x59441e=(0x0,CreateOrUpdateContactService_1[_0x30e3c6(0x1a8)])(_0x5349de,_0x1c3660,_0x2e3c78['id']);return _0x59441e;},verifyQuotedMessage=async _0x28962d=>{const _0x56f680=a558_0x3b09f7;if(!_0x28962d)return null;const _0xddf7f5=(0x0,exports[_0x56f680(0x100)])(_0x28962d);if(!_0xddf7f5)return null;const _0x57e986=await Message_1[_0x56f680(0x1a8)][_0x56f680(0x1b6)]({'where':{'id':_0xddf7f5}});if(!_0x57e986)return null;return _0x57e986;};exports[a558_0x3b09f7(0x1d4)]=verifyQuotedMessage;const sanitizeName=_0x27a858=>{const _0x44aa75=a558_0x3b09f7;let _0x218c3c=_0x27a858['split']('\x20')[0x0];return _0x218c3c=_0x218c3c[_0x44aa75(0x112)](/[^a-zA-Z0-9]/g,''),_0x218c3c[_0x44aa75(0x1e4)](0x0,0x3c);},convertTextToSpeechAndSaveToFile=(_0x29030e,_0xd54b4f,_0x31f8fb,_0x1291a3,_0x34d36f=a558_0x3b09f7(0x2a2),_0x47ae9c=a558_0x3b09f7(0x12a))=>{return new Promise((_0x20f532,_0x10a720)=>{const _0x3a440f=a558_0x3634,_0x2cab7d=microsoft_cognitiveservices_speech_sdk_1['SpeechConfig'][_0x3a440f(0x1fb)](_0x31f8fb,_0x1291a3);_0x2cab7d[_0x3a440f(0x2a9)]=_0x34d36f;const _0x15f285=microsoft_cognitiveservices_speech_sdk_1[_0x3a440f(0x257)][_0x3a440f(0xef)](_0xd54b4f+_0x3a440f(0x2a7)),_0x20190e=new microsoft_cognitiveservices_speech_sdk_1[(_0x3a440f(0x192))](_0x2cab7d,_0x15f285);_0x20190e[_0x3a440f(0x2af)](_0x29030e,_0x16a1a4=>{const _0xe1c0d0=_0x3a440f;_0x16a1a4?convertWavToAnotherFormat(_0xd54b4f+_0xe1c0d0(0x2a7),_0xd54b4f+'.'+_0x47ae9c,_0x47ae9c)[_0xe1c0d0(0x260)](_0x1c2f10=>{_0x20f532();})['catch'](_0x33c11f=>{const _0x192ef8=_0xe1c0d0;console[_0x192ef8(0x105)](_0x33c11f),_0x10a720(_0x33c11f);}):_0x10a720(new Error(_0xe1c0d0(0x212))),_0x20190e['close']();},_0x20fba6=>{const _0x10c5fa=_0x3a440f;console[_0x10c5fa(0x105)](_0x10c5fa(0xf0)+_0x20fba6),_0x20190e[_0x10c5fa(0x11b)](),_0x10a720(_0x20fba6);});});},convertWavToAnotherFormat=(_0x5198aa,_0x5153ab,_0x5d43c4)=>{return new Promise((_0x365380,_0x43e956)=>{const _0x5df2f7=a558_0x3634;(0x0,fluent_ffmpeg_1[_0x5df2f7(0x1a8)])()['input'](_0x5198aa)[_0x5df2f7(0x28b)](_0x5d43c4)['on'](_0x5df2f7(0x24a),()=>_0x365380(_0x5153ab))['on']('error',_0x740aa5=>_0x43e956(new Error('Error\x20converting\x20file:\x20'+_0x740aa5[_0x5df2f7(0x2b2)])))[_0x5df2f7(0x2ad)](_0x5153ab);});},deleteFileSync=_0x283e45=>{const _0x1a5564=a558_0x3b09f7;try{fs_2['default'][_0x1a5564(0x13c)](_0x283e45);}catch(_0x42407e){console[_0x1a5564(0x105)](_0x1a5564(0x119),_0x42407e);}},keepOnlySpecifiedChars=_0x185bab=>{const _0x8fdf39=a558_0x3b09f7;return _0x185bab[_0x8fdf39(0x112)](/[^a-zA-Z0-9áéíóúÁÉÍÓÚâêîôûÂÊÎÔÛãõÃÕçÇ!?.,;:\s]/g,'');},handleOpenAi=async(_0x1674c8,_0x43e442,_0x11f3a1,_0x1a335c,_0x4e593d)=>{const _0x14144d=a558_0x3b09f7,_0x59ba26=(0x0,exports[_0x14144d(0x297)])(_0x1674c8);if(!_0x59ba26)return;let {prompt:_0x52f8e6}=await(0x0,ShowWhatsAppService_1[_0x14144d(0x1a8)])(_0x43e442['id'],_0x11f3a1[_0x14144d(0x287)]);!_0x52f8e6&&!(0x0,lodash_1[_0x14144d(0x142)])(_0x11f3a1?.[_0x14144d(0x28e)]?.[_0x14144d(0x238)])&&(_0x52f8e6=_0x11f3a1[_0x14144d(0x28e)][_0x14144d(0x238)]);if(!_0x52f8e6)return;if(_0x1674c8[_0x14144d(0x217)])return;const _0x4ab258=path_1[_0x14144d(0x1a8)][_0x14144d(0x22f)](__dirname,'..','..','..',_0x14144d(0xff));let _0x1389d2;const _0x1b3904=sessionsOpenAi[_0x14144d(0x1f0)](_0x409b25=>_0x409b25['id']===_0x43e442['id']);if(_0x1b3904===-0x1){const _0xc7073e=new openai_1[(_0x14144d(0x1c5))]({'apiKey':_0x52f8e6[_0x14144d(0x1bd)]});_0x1389d2=new openai_1['OpenAIApi'](_0xc7073e),_0x1389d2['id']=_0x43e442['id'],sessionsOpenAi[_0x14144d(0x167)](_0x1389d2);}else _0x1389d2=sessionsOpenAi[_0x1b3904];const _0x57eb18=await Message_1[_0x14144d(0x1a8)][_0x14144d(0xf5)]({'where':{'ticketId':_0x11f3a1['id']},'order':[[_0x14144d(0x1b7),_0x14144d(0x18e)]],'limit':_0x52f8e6['maxMessages']}),_0x26ecc5='Nas\x20respostas\x20utilize\x20o\x20nome\x20'+sanitizeName(_0x1a335c[_0x14144d(0x1c9)]||'Amigo(a)')+'\x20para\x20identificar\x20o\x20cliente.\x0aSua\x20resposta\x20deve\x20usar\x20no\x20máximo\x20'+_0x52f8e6[_0x14144d(0x27a)]+_0x14144d(0x1ef)+_0x52f8e6[_0x14144d(0x238)]+'\x0a';let _0x1b2fac=[];if(_0x1674c8[_0x14144d(0x2b2)]?.['conversation']||_0x1674c8[_0x14144d(0x2b2)]?.['extendedTextMessage']?.[_0x14144d(0x15c)]){_0x1b2fac=[],_0x1b2fac[_0x14144d(0x167)]({'role':_0x14144d(0x107),'content':_0x26ecc5});for(let _0x130715=0x0;_0x130715<Math[_0x14144d(0x183)](_0x52f8e6[_0x14144d(0x15f)],_0x57eb18[_0x14144d(0x235)]);_0x130715++){const _0x4acc7c=_0x57eb18[_0x130715];_0x4acc7c[_0x14144d(0x239)]==='chat'&&(_0x4acc7c[_0x14144d(0x255)]?_0x1b2fac['push']({'role':_0x14144d(0x181),'content':_0x4acc7c['body']}):_0x1b2fac['push']({'role':_0x14144d(0x282),'content':_0x4acc7c[_0x14144d(0x251)]}));}_0x1b2fac[_0x14144d(0x167)]({'role':_0x14144d(0x282),'content':_0x59ba26});const _0x55fada=await _0x1389d2[_0x14144d(0x1bf)]({'model':_0x14144d(0x26e),'messages':_0x1b2fac,'max_tokens':_0x52f8e6[_0x14144d(0x27a)],'temperature':_0x52f8e6['temperature']});let _0x396724=_0x55fada['data'][_0x14144d(0x249)][0x0][_0x14144d(0x2b2)]?.[_0x14144d(0x224)];_0x396724?.[_0x14144d(0xeb)](_0x14144d(0x149))&&(await transferQueue(_0x52f8e6[_0x14144d(0x23b)],_0x11f3a1,_0x1a335c),_0x396724=_0x396724[_0x14144d(0x112)]('Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','')['trim']());if(_0x52f8e6[_0x14144d(0x12c)]===_0x14144d(0x17e)){const _0x232604=await _0x43e442[_0x14144d(0x258)](_0x1674c8[_0x14144d(0x20b)][_0x14144d(0x221)],{'text':_0x396724});await(0x0,exports[_0x14144d(0xf8)])(_0x232604,_0x11f3a1,_0x1a335c);}else{const _0x5b1d29=_0x11f3a1['id']+'_'+Date[_0x14144d(0x276)]();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x396724),_0x4ab258+'/'+_0x5b1d29,_0x52f8e6[_0x14144d(0x24b)],_0x52f8e6[_0x14144d(0x186)],_0x52f8e6[_0x14144d(0x12c)],'mp3')[_0x14144d(0x260)](async()=>{const _0x2b93c0=_0x14144d;try{const _0x129ca3=await _0x43e442['sendMessage'](_0x1674c8['key'][_0x2b93c0(0x221)],{'audio':{'url':_0x4ab258+'/'+_0x5b1d29+'.mp3'},'mimetype':_0x2b93c0(0x104),'ptt':!![]});await verifyMediaMessage(_0x129ca3,_0x11f3a1,_0x1a335c),deleteFileSync(_0x4ab258+'/'+_0x5b1d29+_0x2b93c0(0x28d)),deleteFileSync(_0x4ab258+'/'+_0x5b1d29+'.wav');}catch(_0x42885c){console[_0x2b93c0(0x14e)]('Erro\x20para\x20responder\x20com\x20audio:\x20'+_0x42885c);}});}}else{if(_0x1674c8[_0x14144d(0x2b2)]?.[_0x14144d(0x108)]){const _0x470d04=_0x4e593d[_0x14144d(0x1e8)]['split']('/')['pop'](),_0x35b50c=fs_2[_0x14144d(0x1a8)][_0x14144d(0x13f)](_0x4ab258+'/'+_0x470d04),_0x385e15=await _0x1389d2['createTranscription'](_0x35b50c,_0x14144d(0x261));_0x1b2fac=[],_0x1b2fac[_0x14144d(0x167)]({'role':_0x14144d(0x107),'content':_0x26ecc5});for(let _0x2ffa3b=0x0;_0x2ffa3b<Math[_0x14144d(0x183)](_0x52f8e6[_0x14144d(0x15f)],_0x57eb18[_0x14144d(0x235)]);_0x2ffa3b++){const _0x49af50=_0x57eb18[_0x2ffa3b];_0x49af50['mediaType']===_0x14144d(0x1d6)&&(_0x49af50[_0x14144d(0x255)]?_0x1b2fac[_0x14144d(0x167)]({'role':_0x14144d(0x181),'content':_0x49af50[_0x14144d(0x251)]}):_0x1b2fac[_0x14144d(0x167)]({'role':_0x14144d(0x282),'content':_0x49af50[_0x14144d(0x251)]}));}_0x1b2fac[_0x14144d(0x167)]({'role':_0x14144d(0x282),'content':_0x385e15[_0x14144d(0x227)][_0x14144d(0x15c)]});const _0x2184a0=await _0x1389d2[_0x14144d(0x1bf)]({'model':_0x14144d(0x26e),'messages':_0x1b2fac,'max_tokens':_0x52f8e6[_0x14144d(0x27a)],'temperature':_0x52f8e6['temperature']});let _0x363f1a=_0x2184a0[_0x14144d(0x227)][_0x14144d(0x249)][0x0][_0x14144d(0x2b2)]?.[_0x14144d(0x224)];_0x363f1a?.[_0x14144d(0xeb)](_0x14144d(0x149))&&(await transferQueue(_0x52f8e6['queueId'],_0x11f3a1,_0x1a335c),_0x363f1a=_0x363f1a[_0x14144d(0x112)](_0x14144d(0x149),'')['trim']());if(_0x52f8e6[_0x14144d(0x12c)]==='texto'){const _0x348b09=await _0x43e442[_0x14144d(0x258)](_0x1674c8[_0x14144d(0x20b)][_0x14144d(0x221)],{'text':_0x363f1a});await(0x0,exports[_0x14144d(0xf8)])(_0x348b09,_0x11f3a1,_0x1a335c);}else{const _0x1ac55d=_0x11f3a1['id']+'_'+Date['now']();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x363f1a),_0x4ab258+'/'+_0x1ac55d,_0x52f8e6['voiceKey'],_0x52f8e6[_0x14144d(0x186)],_0x52f8e6['voice'],_0x14144d(0x12a))[_0x14144d(0x260)](async()=>{const _0x12d50e=_0x14144d;try{const _0x39d66d=await _0x43e442['sendMessage'](_0x1674c8[_0x12d50e(0x20b)][_0x12d50e(0x221)],{'audio':{'url':_0x4ab258+'/'+_0x1ac55d+'.mp3'},'mimetype':_0x12d50e(0x104),'ptt':!![]});await verifyMediaMessage(_0x39d66d,_0x11f3a1,_0x1a335c),deleteFileSync(_0x4ab258+'/'+_0x1ac55d+_0x12d50e(0x28d)),deleteFileSync(_0x4ab258+'/'+_0x1ac55d+_0x12d50e(0x2a7));}catch(_0x435b6c){console['log'](_0x12d50e(0x1e2)+_0x435b6c);}});}}}_0x1b2fac=[];},transferQueue=async(_0xf8f0de,_0x26b501,_0x15d42c)=>{const _0x5e56cc=a558_0x3b09f7;console['trace'](_0x5e56cc(0x225)),await(0x0,UpdateTicketService_1[_0x5e56cc(0x1a8)])({'ticketData':{'queueId':_0xf8f0de,'useIntegration':![],'promptId':null},'ticketId':_0x26b501['id'],'companyId':_0x26b501[_0x5e56cc(0x287)]});},verifyMediaMessage=async(_0x58458a,_0x41980d,_0x4215eb)=>{const _0x2971c2=a558_0x3b09f7,_0x21e231=(0x0,socket_1[_0x2971c2(0x122)])();let _0x3d0757=await Message_1[_0x2971c2(0x1a8)]['findOne']({'where':{'id':_0x58458a[_0x2971c2(0x20b)]['id']}});if(!_0x3d0757){const _0x50c084=await(0x0,exports[_0x2971c2(0x1d4)])(_0x58458a),_0x5cc422=(0x0,wbot_1['getWbot'])(_0x41980d[_0x2971c2(0x189)]),_0x4e9b2b=await downloadMedia(_0x58458a);if(!_0x4e9b2b)throw new Error(_0x2971c2(0x160));if(!_0x4e9b2b[_0x2971c2(0x1ca)]){const _0x299c59=typeof _0x4e9b2b[_0x2971c2(0x246)]===_0x2971c2(0x1a5)&&_0x4e9b2b[_0x2971c2(0x246)]['includes']('/')&&_0x4e9b2b[_0x2971c2(0x246)]['includes'](';')?mime_1[_0x2971c2(0x1a8)][_0x2971c2(0x1a0)](_0x4e9b2b[_0x2971c2(0x246)]):_0x2971c2(0x12f);_0x4e9b2b[_0x2971c2(0x1ca)]=new Date()[_0x2971c2(0x1e1)]()+'.'+_0x299c59;}else{let _0x4ed6cf=_0x4e9b2b[_0x2971c2(0x1ca)]?'-'+_0x4e9b2b[_0x2971c2(0x1ca)]:'';_0x4e9b2b[_0x2971c2(0x1ca)]=''+new Date()[_0x2971c2(0x1e1)]()+_0x4ed6cf;}try{const _0x197429=_0x2971c2(0x229)+_0x41980d[_0x2971c2(0x287)];!fs_2['default'][_0x2971c2(0x193)](_0x197429)&&(fs_2[_0x2971c2(0x1a8)][_0x2971c2(0x268)](_0x197429),fs_2['default'][_0x2971c2(0x22b)](_0x197429,0x1ff)),await writeFileAsync((0x0,path_1['join'])(__dirname,'..','..','..',_0x197429,_0x4e9b2b[_0x2971c2(0x1ca)]),_0x4e9b2b['data'],_0x2971c2(0x1bc));}catch(_0x2d7e2c){Sentry[_0x2971c2(0x180)](_0x2d7e2c),logger_1[_0x2971c2(0x211)][_0x2971c2(0x105)](_0x2d7e2c);}const _0x195d40=(0x0,exports[_0x2971c2(0x297)])(_0x58458a);var _0x5a54b0=getTypeMessage(_0x58458a);const _0x1fe067={'id':_0x58458a[_0x2971c2(0x20b)]['id'],'ticketId':_0x41980d['id'],'contactId':_0x58458a[_0x2971c2(0x20b)]['fromMe']?undefined:_0x4215eb['id'],'body':_0x195d40?(0x0,Mustache_1[_0x2971c2(0x1a8)])(_0x195d40,_0x41980d):_0x4e9b2b[_0x2971c2(0x1ca)],'fromMe':_0x58458a[_0x2971c2(0x20b)][_0x2971c2(0x255)],'read':_0x58458a['key']['fromMe'],'mediaUrl':_0x4e9b2b['filename'],'mediaType':typeof _0x4e9b2b['mimetype']==='string'?_0x4e9b2b[_0x2971c2(0x246)][_0x2971c2(0x187)]('/')[0x0]:_0x2971c2(0x12f),'quotedMsgId':_0x50c084?.['id'],'ack':getStatus(_0x58458a,_0x2971c2(0x1de)),'remoteJid':_0x58458a[_0x2971c2(0x20b)][_0x2971c2(0x221)],'participant':_0x58458a['key'][_0x2971c2(0x17a)],'dataJson':JSON[_0x2971c2(0x265)](_0x58458a)};var _0x4d7885=_0x195d40||_0x4e9b2b[_0x2971c2(0x1ca)];typeof _0x4d7885!='string'&&console['trace'](_0x2971c2(0x10a),_0x4d7885),await _0x41980d[_0x2971c2(0x126)]({'lastMessage':_0x4d7885}),_0x3d0757=await(0x0,CreateMessageService_1[_0x2971c2(0x1a8)])({'messageData':_0x1fe067,'ticket':_0x41980d,'companyId':_0x41980d[_0x2971c2(0x287)]});}else typeof _0x3d0757[_0x2971c2(0x251)]!=_0x2971c2(0x1a5)&&console[_0x2971c2(0x241)](_0x2971c2(0x10a),_0x3d0757['body']),await _0x41980d[_0x2971c2(0x126)]({'lastMessage':_0x3d0757[_0x2971c2(0x251)]}),_0x3d0757[_0x2971c2(0x277)]=getStatus(_0x58458a,_0x2971c2(0x1de)),_0x3d0757[_0x2971c2(0x17a)]=_0x58458a[_0x2971c2(0x20b)][_0x2971c2(0x17a)],_0x3d0757[_0x2971c2(0x14a)]=JSON[_0x2971c2(0x265)](_0x58458a),await _0x3d0757[_0x2971c2(0x2ad)]();return!_0x58458a[_0x2971c2(0x20b)][_0x2971c2(0x255)]&&_0x41980d[_0x2971c2(0x131)]==='closed'&&(await _0x41980d[_0x2971c2(0x126)]({'status':_0x2971c2(0x1fa)}),await _0x41980d['reload']({'include':[{'model':Queue_1[_0x2971c2(0x1a8)],'as':_0x2971c2(0x28e)},{'model':User_1[_0x2971c2(0x1a8)],'as':_0x2971c2(0x282)},{'model':Contact_1[_0x2971c2(0x1a8)],'as':_0x2971c2(0x135)}]}),_0x21e231['to'](_0x2971c2(0x1b0)+_0x41980d[_0x2971c2(0x287)]+_0x2971c2(0x20f))[_0x2971c2(0x248)](_0x2971c2(0x1b0)+_0x41980d[_0x2971c2(0x287)]+_0x2971c2(0xfa),{'action':_0x2971c2(0x1a7),'ticket':_0x41980d,'ticketId':_0x41980d['id']}),_0x21e231['to'](_0x2971c2(0x1b0)+_0x41980d[_0x2971c2(0x287)]+'-'+_0x41980d['status'])['to'](_0x41980d['id'][_0x2971c2(0x27d)]())[_0x2971c2(0x248)](_0x2971c2(0x1b0)+_0x41980d[_0x2971c2(0x287)]+_0x2971c2(0xfa),{'action':_0x2971c2(0x126),'ticket':_0x41980d,'ticketId':_0x41980d['id']})),_0x3d0757;};function getStatus(_0xc739e8,_0x315f7e){const _0x3e34b4=a558_0x3b09f7;if(_0xc739e8[_0x3e34b4(0x131)]==baileys_1[_0x3e34b4(0x2b3)][_0x3e34b4(0x210)][_0x3e34b4(0x194)][_0x3e34b4(0x1d5)]){if(_0xc739e8[_0x3e34b4(0x20b)][_0x3e34b4(0x255)]&&_0x315f7e==_0x3e34b4(0x18d))return 0x3;return 0x1;}else{if(_0xc739e8[_0x3e34b4(0x131)]==baileys_1['proto'][_0x3e34b4(0x210)][_0x3e34b4(0x194)][_0x3e34b4(0x252)])return 0x1;else{if(_0xc739e8[_0x3e34b4(0x131)]==baileys_1[_0x3e34b4(0x2b3)]['WebMessageInfo'][_0x3e34b4(0x194)][_0x3e34b4(0x155)])return 0x2;else{if(_0xc739e8[_0x3e34b4(0x131)]==baileys_1[_0x3e34b4(0x2b3)]['WebMessageInfo']['Status'][_0x3e34b4(0x157)]||_0xc739e8[_0x3e34b4(0x131)]==baileys_1[_0x3e34b4(0x2b3)][_0x3e34b4(0x210)]['Status'][_0x3e34b4(0x1c6)])return 0x3;}}}return 0x0;}const verifyMessage=async(_0x310566,_0x590275,_0x2f00ef)=>{const _0x102c22=a558_0x3b09f7,_0x31545f=(0x0,socket_1[_0x102c22(0x122)])(),_0x437aad=await(0x0,exports[_0x102c22(0x1d4)])(_0x310566),_0x52bd39=(0x0,exports['getBodyMessage'])(_0x310566);if(!_0x52bd39)return;let _0x24eb51=getTypeMessage(_0x310566);const _0x4e5694=_0x24eb51==_0x102c22(0x114)||_0x310566?.[_0x102c22(0x2b2)]?.[_0x102c22(0x226)]?.['type']==baileys_1['proto'][_0x102c22(0x16d)][_0x102c22(0x110)][_0x102c22(0x1e0)][_0x102c22(0x1a9)]||_0x310566?.['message']?.[_0x102c22(0x226)]?.[_0x102c22(0x114)]?.[_0x102c22(0x244)]?.[_0x102c22(0x235)]>0x0;let _0x417e2c=_0x310566['key']['id'];if(_0x24eb51==_0x102c22(0x226))_0x417e2c=_0x310566?.[_0x102c22(0x2b2)]?.['protocolMessage']?.[_0x102c22(0x20b)]?.['id']||_0x310566[_0x102c22(0x20b)]['id'];else _0x24eb51==_0x102c22(0x114)&&(_0x417e2c=_0x310566?.[_0x102c22(0x2b2)]?.['editedMessage']?.[_0x102c22(0x2b2)]?.[_0x102c22(0x226)]?.[_0x102c22(0x20b)]?.['id']||_0x310566[_0x102c22(0x20b)]['id']);const _0x5aae11={'id':_0x417e2c,'ticketId':_0x590275['id'],'contactId':_0x310566['key'][_0x102c22(0x255)]?undefined:_0x2f00ef['id'],'body':_0x52bd39,'fromMe':_0x310566[_0x102c22(0x20b)][_0x102c22(0x255)],'mediaType':_0x24eb51,'read':_0x310566[_0x102c22(0x20b)]['fromMe'],'quotedMsgId':_0x437aad?.['id'],'ack':getStatus(_0x310566,_0x24eb51),'remoteJid':_0x310566[_0x102c22(0x20b)][_0x102c22(0x221)],'participant':_0x310566[_0x102c22(0x20b)][_0x102c22(0x17a)],'dataJson':JSON['stringify'](_0x310566),'isEdited':_0x4e5694};typeof _0x52bd39!=_0x102c22(0x1a5)&&console[_0x102c22(0x241)](_0x102c22(0x10a),_0x52bd39);await _0x590275[_0x102c22(0x126)]({'lastMessage':_0x52bd39});if(_0x4e5694){let _0x3e29f0=await Message_1[_0x102c22(0x1a8)][_0x102c22(0x237)](_0x5aae11['id']);if(_0x3e29f0){const _0x428239={'messageId':_0x5aae11['id'],'body':_0x3e29f0[_0x102c22(0x251)]};await OldMessage_1[_0x102c22(0x1a8)][_0x102c22(0x1b8)](_0x428239);}else console['log'](_0x102c22(0x1d9)+_0x5aae11['id']);}await(0x0,CreateMessageService_1[_0x102c22(0x1a8)])({'messageData':_0x5aae11,'ticket':_0x590275,'companyId':_0x590275['companyId']}),!_0x310566[_0x102c22(0x20b)][_0x102c22(0x255)]&&_0x590275[_0x102c22(0x131)]===_0x102c22(0x296)&&(await _0x590275[_0x102c22(0x126)]({'status':_0x102c22(0x1fa)}),await _0x590275[_0x102c22(0x288)]({'include':[{'model':Queue_1[_0x102c22(0x1a8)],'as':_0x102c22(0x28e)},{'model':User_1['default'],'as':_0x102c22(0x282)},{'model':Contact_1['default'],'as':_0x102c22(0x135)}]}),_0x31545f['to'](_0x102c22(0x1b0)+_0x590275[_0x102c22(0x287)]+_0x102c22(0x20f))[_0x102c22(0x248)](_0x102c22(0x1b0)+_0x590275[_0x102c22(0x287)]+_0x102c22(0xfa),{'action':_0x102c22(0x1a7),'ticket':_0x590275,'ticketId':_0x590275['id']}),_0x31545f['to'](_0x102c22(0x1b0)+_0x590275['companyId']+'-'+_0x590275['status'])['to'](_0x590275['id'][_0x102c22(0x27d)]())[_0x102c22(0x248)]('company-'+_0x590275[_0x102c22(0x287)]+_0x102c22(0xfa),{'action':_0x102c22(0x126),'ticket':_0x590275,'ticketId':_0x590275['id']}));};exports[a558_0x3b09f7(0xf8)]=verifyMessage;const isValidMsg=_0x1bfa5e=>{const _0x19901b=a558_0x3b09f7;if(_0x1bfa5e[_0x19901b(0x20b)]['remoteJid']===_0x19901b(0x283))return![];try{const _0x394ae9=getTypeMessage(_0x1bfa5e);if(!_0x394ae9)return![];const _0x3422f9=_0x394ae9===_0x19901b(0x244)||_0x394ae9==='editedMessage'||_0x394ae9===_0x19901b(0x1e5)||_0x394ae9===_0x19901b(0x108)||_0x394ae9===_0x19901b(0x213)||_0x394ae9==='pollCreationMessageV2'||_0x394ae9==='templateMessage'||_0x394ae9===_0x19901b(0x24d)||_0x394ae9===_0x19901b(0x254)||_0x394ae9===_0x19901b(0x200)||_0x394ae9==='documentMessage'||_0x394ae9===_0x19901b(0x17b)||_0x394ae9===_0x19901b(0x1c8)||_0x394ae9==='buttonsResponseMessage'||_0x394ae9==='buttonsMessage'||_0x394ae9===_0x19901b(0x207)||_0x394ae9===_0x19901b(0x12b)||_0x394ae9==='liveLocationMessage'||_0x394ae9===_0x19901b(0x262)||_0x394ae9===_0x19901b(0x134)||_0x394ae9===_0x19901b(0x223)||_0x394ae9===_0x19901b(0x267)||_0x394ae9===_0x19901b(0x18d)||_0x394ae9==='ephemeralMessage'||_0x394ae9===_0x19901b(0x226)||_0x394ae9===_0x19901b(0x11c)||_0x394ae9===_0x19901b(0x196)||_0x394ae9===_0x19901b(0x236)||_0x394ae9===_0x19901b(0x228)||_0x394ae9===_0x19901b(0x139)||_0x394ae9===_0x19901b(0x118);return!_0x3422f9&&(logger_1[_0x19901b(0x211)]['warn'](_0x19901b(0x12e)+_0x394ae9+'\x0a'+JSON['stringify'](_0x1bfa5e?.['message'])),Sentry[_0x19901b(0x13b)]('Mensagem',{'BodyMsg':_0x1bfa5e[_0x19901b(0x2b2)],'msg':_0x1bfa5e,'msgType':_0x394ae9}),Sentry['captureException'](new Error(_0x19901b(0x294)))),!!_0x3422f9;}catch(_0x135b64){Sentry[_0x19901b(0x13b)](_0x19901b(0x2b6),{'msg':_0x1bfa5e}),Sentry[_0x19901b(0x180)](_0x135b64);}return![];};exports[a558_0x3b09f7(0x245)]=isValidMsg;const Push=_0x4890a5=>{return _0x4890a5['pushName'];},verifyQueue=async(_0xe3eea4,_0x5be3d0,_0x45cebc,_0x1ae752,_0x26c04c)=>{const _0x246517=a558_0x3b09f7,_0xc66004=_0x45cebc[_0x246517(0x287)],{queues:_0x4b8a44,greetingMessage:_0x48d254,maxUseBotQueues:_0x58e3de,timeUseBotQueues:_0x84fe20}=await(0x0,ShowWhatsAppService_1['default'])(_0xe3eea4['id'],_0x45cebc[_0x246517(0x287)]);if(_0x4b8a44[_0x246517(0x235)]===0x1){const _0x1b46fc=(0x0,lodash_1[_0x246517(0x1a1)])(_0x4b8a44);let _0x138343=![];_0x1b46fc?.[_0x246517(0x26b)]&&(_0x138343=_0x1b46fc['options']['length']>0x0);const _0x1b81f2=await Setting_1[_0x246517(0x1a8)][_0x246517(0x1b6)]({'where':{'key':_0x246517(0x10e),'companyId':_0x45cebc['companyId']}});greetingMessageControl[_0x246517(0x167)]({'ticketId':_0x45cebc['id'],'greetingMessage':_0x48d254,'companyId':_0xc66004});if(_0x48d254[_0x246517(0x235)]>0x1&&_0x1b81f2?.['value']===_0x246517(0x133)){const _0x1ed50f=await Message_1[_0x246517(0x1a8)][_0x246517(0x1b6)]({'where':{'ticketId':_0x45cebc['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x246517(0x26d)]]:(0x0,moment_1['default'])()[_0x246517(0x25e)](0x5,'minutes')[_0x246517(0x264)]()}}});if(_0x1ed50f)return;const _0xf087e5=(0x0,Mustache_1[_0x246517(0x1a8)])(''+_0x48d254,_0x45cebc);await _0xe3eea4[_0x246517(0x258)](_0x1ae752[_0x246517(0xf7)]+'@'+(_0x45cebc[_0x246517(0x1a2)]?'g.us':_0x246517(0x256)),{'text':_0xf087e5});}const _0x43c5d4=await(0x0,ShowWhatsAppService_1[_0x246517(0x1a8)])(_0xe3eea4['id'],_0xc66004),_0x56af63=_0x4b8a44[0x0]?.['integrationId']||_0x43c5d4[_0x246517(0x2b4)];if(!_0x5be3d0[_0x246517(0x20b)]['fromMe']&&!_0x45cebc[_0x246517(0x1a2)]&&!(0x0,lodash_1[_0x246517(0x142)])(_0x56af63)){const _0x4f7329=await(0x0,ShowQueueIntegrationService_1['default'])(_0x56af63,_0xc66004);await(0x0,exports[_0x246517(0x178)])(_0x5be3d0,_0xe3eea4,_0x4f7329,_0x45cebc),await _0x45cebc[_0x246517(0x126)]({'useIntegration':!![],'integrationId':_0x4f7329['id']});}const _0x256b50=_0x4b8a44[0x0]?.[_0x246517(0x106)]||_0x43c5d4['promptId'];!_0x5be3d0[_0x246517(0x20b)][_0x246517(0x255)]&&!_0x45cebc['isGroup']&&!(0x0,lodash_1[_0x246517(0x142)])(_0x256b50)&&(console[_0x246517(0x14e)](_0x246517(0x1e7)),await handleOpenAi(_0x5be3d0,_0xe3eea4,_0x45cebc,_0x1ae752,_0x26c04c),await _0x45cebc[_0x246517(0x126)]({'useIntegration':!![],'promptId':_0x256b50}));await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x1b46fc?.['id'],'chatbot':_0x138343,'status':'pending'},'ticketId':_0x45cebc['id'],'companyId':_0x45cebc['companyId']});return;}const _0x134aa9=_0x5be3d0?.[_0x246517(0x2b2)]?.['buttonsResponseMessage']?.[_0x246517(0x14b)]||_0x5be3d0?.[_0x246517(0x2b2)]?.['listResponseMessage']?.['singleSelectReply']?.[_0x246517(0x16f)]||_0x5be3d0?.[_0x246517(0x2b2)]?.[_0x246517(0x1e5)]?.[_0x246517(0x15c)]||_0x5be3d0?.[_0x246517(0x2b2)]?.['conversation'];let _0x3ed9e1=null;if(_0x134aa9&&!(0x0,exports[_0x246517(0x15b)])(_0x134aa9)||+_0x134aa9>_0x4b8a44['length']){const _0x2bed4d=_0x134aa9[_0x246517(0x1fc)]();for(let _0xa4ea1 of _0x4b8a44){if(_0xa4ea1['name'][_0x246517(0x1fc)]()===_0x2bed4d){_0x3ed9e1=_0xa4ea1;break;}if(_0xa4ea1['keywords']&&_0xa4ea1['keywords'][_0x246517(0x235)]>0x0){let _0x1ec718=_0xa4ea1[_0x246517(0x2b0)][_0x246517(0x187)](',\x20');for(let _0x40224f of _0x1ec718){if(_0x40224f[_0x246517(0x1fc)]()==_0x2bed4d){_0x3ed9e1=_0xa4ea1;break;}}}}}else _0x3ed9e1=_0x4b8a44[+_0x134aa9-0x1];const _0x364756=await Setting_1[_0x246517(0x1a8)][_0x246517(0x1b6)]({'where':{'key':_0x246517(0x121),'companyId':_0xc66004}}),_0x44b31e=async()=>{const _0x5e3d5e=_0x246517;let _0x5a780c='';if(outOfHourMessageControl[_0x5e3d5e(0x235)]>0x1388)outOfHourMessageControl=[];_0x4b8a44[_0x5e3d5e(0x1c3)]((_0x34cce8,_0x19c4e4)=>{const _0x28e656=_0x5e3d5e;_0x5a780c+=_0x28e656(0x25a)+(_0x19c4e4+0x1)+_0x28e656(0x271)+_0x34cce8[_0x28e656(0x1c9)]+'\x0a';});if(process[_0x5e3d5e(0x24e)][_0x5e3d5e(0x2a0)]?.[_0x5e3d5e(0x235)]>=0x8){if(_0x45cebc[_0x5e3d5e(0x135)][_0x5e3d5e(0xf7)]!=process[_0x5e3d5e(0x24e)][_0x5e3d5e(0x2a0)]){console['trace'](_0x5e3d5e(0x159));return;}}const _0x60144d={'text':(0x0,Mustache_1[_0x5e3d5e(0x1a8)])('‎'+_0x48d254+'\x0a\x0a'+_0x5a780c,_0x45cebc)};await(0x0,UpdateTicketService_1[_0x5e3d5e(0x1a8)])({'ticketData':{'amountUsedBotQueues':_0x45cebc[_0x5e3d5e(0x247)]+0x1},'ticketId':_0x45cebc['id'],'companyId':_0x45cebc[_0x5e3d5e(0x287)]});const _0x49d541=await _0xe3eea4[_0x5e3d5e(0x258)](_0x1ae752[_0x5e3d5e(0xf7)]+'@'+(_0x45cebc[_0x5e3d5e(0x1a2)]?_0x5e3d5e(0x281):_0x5e3d5e(0x256)),_0x60144d);await(0x0,exports[_0x5e3d5e(0xf8)])(_0x49d541,_0x45cebc,_0x45cebc[_0x5e3d5e(0x135)]);};if(_0x3ed9e1){let _0x2c3f3a=![];_0x3ed9e1?.[_0x246517(0x26b)]&&(_0x2c3f3a=_0x3ed9e1[_0x246517(0x26b)][_0x246517(0x235)]>0x0);await(0x0,UpdateTicketService_1[_0x246517(0x1a8)])({'ticketData':{'queueId':_0x3ed9e1['id'],'chatbot':_0x2c3f3a,'status':_0x246517(0x1fa),'amountUsedBotQueues':0x0},'ticketId':_0x45cebc['id'],'companyId':_0x45cebc[_0x246517(0x287)]}),console['trace'](_0x3ed9e1['options']);if(_0x3ed9e1[_0x246517(0x26b)][_0x246517(0x235)]===0x0){const _0x29a772=await Queue_1['default'][_0x246517(0x237)](_0x3ed9e1['id']),{schedules:_0x2ae960}=_0x29a772,_0x33c890=(0x0,moment_1['default'])(),_0x206cf1=_0x33c890[_0x246517(0x1ad)](_0x246517(0x1ac))[_0x246517(0x1fc)]();let _0xdc6819;Array[_0x246517(0x214)](_0x2ae960)&&_0x2ae960[_0x246517(0x235)]>0x0&&(_0xdc6819=_0x2ae960[_0x246517(0x2b1)](_0x3208a1=>_0x3208a1[_0x246517(0x179)]===_0x206cf1&&_0x3208a1[_0x246517(0x2a4)]!==''&&_0x3208a1[_0x246517(0x2a4)]!==null&&_0x3208a1[_0x246517(0x199)]!==''&&_0x3208a1[_0x246517(0x199)]!==null));if(_0x29a772['outOfHoursMessage']!==null&&_0x29a772[_0x246517(0x234)]!==''&&!(0x0,lodash_1[_0x246517(0x142)])(_0xdc6819)){var _0x34175b=outOfHourMessageControl['find'](_0x225165=>_0x225165[_0x246517(0x18a)]===_0x45cebc['id']||_0x225165[_0x246517(0x137)]===_0x1ae752[_0x246517(0xf7)]);if(!_0x34175b||_0x34175b&&_0x34175b[_0x246517(0x1f9)]+0x3e8*0x3c*0x5<new Date()[_0x246517(0x1e1)]()){_0x34175b&&(outOfHourMessageControl=outOfHourMessageControl['filter'](_0x32fce2=>_0x32fce2[_0x246517(0x18a)]!==_0x45cebc['id']),_0x34175b=null);const _0x4dc79f=(0x0,moment_1[_0x246517(0x1a8)])(_0xdc6819[_0x246517(0x2a4)],'HH:mm'),_0x2da213=(0x0,moment_1[_0x246517(0x1a8)])(_0xdc6819[_0x246517(0x199)],'HH:mm');outOfHourMessageControl[_0x246517(0x167)]({'ticketId':_0x45cebc['id'],'time':new Date()[_0x246517(0x1e1)]()});if(_0x33c890[_0x246517(0x278)](_0x4dc79f)||_0x33c890[_0x246517(0xfe)](_0x2da213)){const _0x328b8d=(0x0,Mustache_1['default'])('‎\x20'+_0x29a772[_0x246517(0x234)]+_0x246517(0x28a),_0x45cebc),_0x2c7ec5=await _0xe3eea4['sendMessage'](_0x1ae752['number']+'@'+(_0x45cebc['isGroup']?_0x246517(0x281):'s.whatsapp.net'),{'text':_0x328b8d});await(0x0,exports[_0x246517(0xf8)])(_0x2c7ec5,_0x45cebc,_0x1ae752),await(0x0,UpdateTicketService_1[_0x246517(0x1a8)])({'ticketData':{'queueId':null,'chatbot':_0x2c3f3a},'ticketId':_0x45cebc['id'],'companyId':_0x45cebc[_0x246517(0x287)]}),console[_0x246517(0x14e)](_0x246517(0x1ce));return;}}!_0x34175b&&outOfHourMessageControl['push']({'ticketId':_0x45cebc['id'],'dest':_0x1ae752['number'],'time':new Date()['getTime']()});}console['trace'](_0x3ed9e1[_0x246517(0x2b4)]);if(!_0x5be3d0['key']['fromMe']&&!_0x45cebc[_0x246517(0x1a2)]&&_0x3ed9e1[_0x246517(0x2b4)]){const _0x3f77c3=await(0x0,ShowQueueIntegrationService_1[_0x246517(0x1a8)])(_0x3ed9e1['integrationId'],_0xc66004);await(0x0,exports[_0x246517(0x178)])(_0x5be3d0,_0xe3eea4,_0x3f77c3,_0x45cebc),await _0x45cebc['update']({'useIntegration':!![],'integrationId':_0x3f77c3['id']});}!_0x5be3d0[_0x246517(0x20b)]['fromMe']&&!_0x45cebc[_0x246517(0x1a2)]&&!(0x0,lodash_1[_0x246517(0x142)])(_0x3ed9e1?.[_0x246517(0x106)])&&(await handleOpenAi(_0x5be3d0,_0xe3eea4,_0x45cebc,_0x1ae752,_0x26c04c),await _0x45cebc[_0x246517(0x126)]({'useIntegration':!![],'promptId':_0x3ed9e1?.[_0x246517(0x106)]}));const _0x509bd2=(0x0,Mustache_1[_0x246517(0x1a8)])('‎'+_0x3ed9e1[_0x246517(0x2ae)],_0x45cebc);if(_0x3ed9e1[_0x246517(0x2ae)]){const _0x1c0eaa=await _0xe3eea4[_0x246517(0x258)](_0x1ae752[_0x246517(0xf7)]+'@'+(_0x45cebc[_0x246517(0x1a2)]?_0x246517(0x281):_0x246517(0x256)),{'text':_0x509bd2});await(0x0,exports[_0x246517(0xf8)])(_0x1c0eaa,_0x45cebc,_0x1ae752);if(_0x3ed9e1['mediaPath']!==null&&_0x3ed9e1[_0x246517(0x2a1)]!==''){const _0x2bcde1=path_1[_0x246517(0x1a8)]['resolve'](_0x246517(0xff),_0x246517(0x1cf)+_0x3ed9e1[_0x246517(0x287)],_0x3ed9e1[_0x246517(0x2a1)]),_0x1fab7a=await(0x0,SendWhatsAppMedia_1[_0x246517(0x22e)])(_0x3ed9e1[_0x246517(0x120)],_0x2bcde1,null,_0x45cebc[_0x246517(0x287)]);let _0x2eca75=await _0xe3eea4[_0x246517(0x258)](_0x45cebc[_0x246517(0x135)]['number']+'@'+(_0x45cebc[_0x246517(0x1a2)]?_0x246517(0x281):_0x246517(0x256)),{..._0x1fab7a});await verifyMediaMessage(_0x2eca75,_0x45cebc,_0x1ae752);}}}}else{if(_0x58e3de&&_0x58e3de!==0x0&&_0x45cebc['amountUsedBotQueues']>=_0x58e3de)return;const _0x5da694=await(0x0,FindOrCreateATicketTrakingService_1[_0x246517(0x1a8)])({'ticketId':_0x45cebc['id'],'companyId':_0xc66004});let _0x168c1d=new Date(),_0x2b6cab=new Date();if(_0x5da694[_0x246517(0x21f)]!==null){_0x168c1d[_0x246517(0x15a)](_0x5da694[_0x246517(0x21f)]['getMinutes']()+Number(_0x84fe20));if(_0x5da694[_0x246517(0x21f)]!==null&&_0x2b6cab<_0x168c1d&&_0x84fe20!=='0'&&_0x45cebc['amountUsedBotQueues']!==0x0)return;}await _0x5da694[_0x246517(0x126)]({'updatedAt':new Date()});if(_0x364756[_0x246517(0x141)]===_0x246517(0x15c))return console['trace'](_0x246517(0x148)),_0x44b31e();}},verifyRating=_0x17c1a3=>{const _0x53acdb=a558_0x3b09f7;return _0x17c1a3&&_0x17c1a3[_0x53acdb(0x1d8)]===null&&_0x17c1a3['userId']!==null&&_0x17c1a3[_0x53acdb(0x23a)]!==null;};exports[a558_0x3b09f7(0xe9)]=verifyRating;const handleRating=async(_0x2041a0,_0x351ca5,_0x38f782)=>{const _0x4e9a6c=a558_0x3b09f7,_0x461a25=(0x0,socket_1['getIO'])();let _0x39394a=null;(_0x2041a0?.['message']?.[_0x4e9a6c(0x244)]||_0x2041a0?.[_0x4e9a6c(0x2b2)]?.[_0x4e9a6c(0x1e5)])&&(_0x39394a=parseInt(_0x2041a0[_0x4e9a6c(0x2b2)][_0x4e9a6c(0x244)]||_0x2041a0[_0x4e9a6c(0x2b2)]['extendedTextMessage']['text'],0xa)||null);if(!Number['isNaN'](_0x39394a)&&Number[_0x4e9a6c(0x17f)](_0x39394a)&&!(0x0,lodash_1[_0x4e9a6c(0x172)])(_0x39394a)){const {complationMessage:_0xda23c3}=await(0x0,ShowWhatsAppService_1[_0x4e9a6c(0x1a8)])(_0x351ca5[_0x4e9a6c(0x189)],_0x351ca5[_0x4e9a6c(0x287)]);let _0x8c073e=_0x39394a;_0x39394a<0x1&&(_0x8c073e=0x1);_0x39394a>0x5&&(_0x8c073e=0x5);await UserRating_1[_0x4e9a6c(0x1a8)][_0x4e9a6c(0x17c)]({'ticketId':_0x38f782['ticketId'],'companyId':_0x38f782[_0x4e9a6c(0x287)],'userId':_0x38f782[_0x4e9a6c(0x1f4)],'rate':_0x8c073e});if(_0xda23c3){if(completionMessageControl[_0x4e9a6c(0x235)]>=0x9c4)completionMessageControl=[];var _0x346f3b=completionMessageControl[_0x4e9a6c(0x2b1)](_0x45745f=>_0x45745f[_0x4e9a6c(0x18a)]===_0x351ca5['id']||_0x45745f['dest']===_0x351ca5[_0x4e9a6c(0x135)][_0x4e9a6c(0xf7)]);if(!_0x346f3b||_0x346f3b&&_0x346f3b[_0x4e9a6c(0x1f9)]+0x3e8*0x3c*0x1e<new Date()['getTime']()){_0x346f3b&&(completionMessageControl=completionMessageControl[_0x4e9a6c(0x274)](_0x3b1b8f=>_0x3b1b8f[_0x4e9a6c(0x18a)]!==_0x351ca5['id']),_0x346f3b=null);const _0x10e5ce=(0x0,Mustache_1[_0x4e9a6c(0x1a8)])('‎'+_0xda23c3,_0x351ca5);await(0x0,SendPresenceStatus_1[_0x4e9a6c(0x156)])((0x0,wbot_1[_0x4e9a6c(0x1c0)])(_0x351ca5[_0x4e9a6c(0x189)]),_0x351ca5[_0x4e9a6c(0x135)][_0x4e9a6c(0xf7)]+'@'+(_0x351ca5[_0x4e9a6c(0x1a2)]?_0x4e9a6c(0x281):_0x4e9a6c(0x256))),await(0x0,SendWhatsAppMessage_1[_0x4e9a6c(0x1a8)])({'body':_0x10e5ce,'ticket':_0x351ca5});}!_0x346f3b&&completionMessageControl['push']({'ticketId':_0x351ca5['id'],'dest':_0x351ca5[_0x4e9a6c(0x135)][_0x4e9a6c(0xf7)],'time':new Date()[_0x4e9a6c(0x1e1)]()});}await _0x38f782[_0x4e9a6c(0x126)]({'finishedAt':(0x0,moment_1[_0x4e9a6c(0x1a8)])()[_0x4e9a6c(0x264)](),'ratedAt':(0x0,moment_1[_0x4e9a6c(0x1a8)])()['toDate'](),'rated':!![]}),await _0x351ca5[_0x4e9a6c(0x126)]({'queueId':null,'chatbot':null,'queueOptionId':null,'userId':null,'status':'closed'}),_0x461a25['to'](_0x4e9a6c(0x1b0)+_0x351ca5[_0x4e9a6c(0x287)]+_0x4e9a6c(0x27b))['emit']('company-'+_0x351ca5[_0x4e9a6c(0x287)]+_0x4e9a6c(0xfa),{'action':_0x4e9a6c(0x1a7),'ticket':_0x351ca5,'ticketId':_0x351ca5['id']}),_0x461a25['to']('company-'+_0x351ca5['companyId']+'-'+_0x351ca5['status'])['to'](_0x351ca5['id']['toString']())[_0x4e9a6c(0x248)](_0x4e9a6c(0x1b0)+_0x351ca5[_0x4e9a6c(0x287)]+'-ticket',{'action':_0x4e9a6c(0x126),'ticket':_0x351ca5,'ticketId':_0x351ca5['id']});}};exports[a558_0x3b09f7(0x2a5)]=handleRating;const handleChartbot=async(_0x3a49ca,_0x560d7d,_0x3ed28c,_0x3517f8,_0x395821=![])=>{const _0x551b92=a558_0x3b09f7;if(!_0x3a49ca[_0x551b92(0x135)][_0x551b92(0x184)]){const _0x227649=await Queue_1[_0x551b92(0x1a8)][_0x551b92(0x237)](_0x3a49ca['queueId'],{'include':[{'model':QueueOption_1[_0x551b92(0x1a8)],'as':_0x551b92(0x26b),'where':{'parentId':null},'order':[[_0x551b92(0x170),_0x551b92(0x18e)],[_0x551b92(0x1b7),'ASC']]}]}),_0x24980a=_0x560d7d?.[_0x551b92(0x2b2)]?.[_0x551b92(0x158)]?.['selectedButtonId']||_0x560d7d?.['message']?.[_0x551b92(0x11c)]?.[_0x551b92(0x169)]?.['selectedRowId']||_0x560d7d?.[_0x551b92(0x2b2)]?.[_0x551b92(0x1e5)]?.[_0x551b92(0x15c)]||_0x560d7d?.[_0x551b92(0x2b2)]?.[_0x551b92(0x244)];if(_0x24980a=='#'&&(!_0x3a49ca[_0x551b92(0x1f4)]||_0x3a49ca[_0x551b92(0x131)]==_0x551b92(0x1fa))){console[_0x551b92(0x241)]('##\x20if'),await _0x3a49ca[_0x551b92(0x126)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x3ed28c,_0x560d7d,_0x3a49ca,_0x3a49ca[_0x551b92(0x135)]);return;}if(!(0x0,lodash_1[_0x551b92(0x142)])(_0x227649)&&!(0x0,lodash_1[_0x551b92(0x142)])(_0x3a49ca[_0x551b92(0x25b)])&&_0x24980a=='0'){console['trace'](_0x551b92(0x195));const _0xed2812=await QueueOption_1['default'][_0x551b92(0x237)](_0x3a49ca[_0x551b92(0x25b)]);await _0x3a49ca[_0x551b92(0x126)]({'queueOptionId':_0xed2812?.[_0x551b92(0x16b)],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1['isNil'])(_0x227649)&&!(0x0,lodash_1[_0x551b92(0x142)])(_0x3a49ca[_0x551b92(0x25b)])){console[_0x551b92(0x241)]('segundo\x20if');const _0x391387=await QueueOption_1[_0x551b92(0x1a8)][_0x551b92(0x231)]({'where':{'parentId':_0x3a49ca[_0x551b92(0x25b)]}});let _0x3a4f61={};_0x391387==0x1?_0x3a4f61=await QueueOption_1[_0x551b92(0x1a8)][_0x551b92(0x1b6)]({'where':{'parentId':_0x3a49ca['queueOptionId']}}):(console[_0x551b92(0x241)](_0x551b92(0x20d)),_0x3a4f61=await QueueOption_1[_0x551b92(0x1a8)][_0x551b92(0x1b6)]({'where':{[sequelize_1['Op']['or']]:[{'option':_0x24980a||''},{'title':_0x24980a||''}],'parentId':_0x3a49ca[_0x551b92(0x25b)]}})),_0x3a4f61&&await _0x3a49ca[_0x551b92(0x126)]({'queueOptionId':_0x3a4f61?.['id'],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1['isNil'])(_0x227649)&&(0x0,lodash_1['isNil'])(_0x3a49ca[_0x551b92(0x25b)])&&!_0x395821){console['trace'](_0x551b92(0xee));const _0x43ade3=_0x227649?.[_0x551b92(0x26b)][_0x551b92(0x2b1)](_0x4032b3=>_0x4032b3['option']==_0x24980a||_0x4032b3[_0x551b92(0x174)][_0x551b92(0x1fc)]()==_0x24980a[_0x551b92(0x1fc)]());if(_0x43ade3)await _0x3a49ca[_0x551b92(0x126)]({'queueOptionId':_0x43ade3?.['id'],'amountUsedBotQueues':0x0});else{if(_0x3517f8[_0x551b92(0xf4)]&&_0x3517f8[_0x551b92(0xf4)]!==0x0&&_0x3a49ca[_0x551b92(0x247)]>=_0x3517f8['maxUseBotQueues'])return;await _0x3a49ca[_0x551b92(0x126)]({'amountUsedBotQueues':_0x3a49ca['amountUsedBotQueues']+0x1});}}else{if(_0x3517f8[_0x551b92(0xf4)]&&_0x3517f8[_0x551b92(0xf4)]!==0x0&&_0x3a49ca['amountUsedBotQueues']>=_0x3517f8['maxUseBotQueues'])return;await _0x3a49ca[_0x551b92(0x126)]({'amountUsedBotQueues':_0x3a49ca[_0x551b92(0x247)]+0x1});}}}await _0x3a49ca['reload']();if(!(0x0,lodash_1[_0x551b92(0x142)])(_0x227649)&&(0x0,lodash_1[_0x551b92(0x142)])(_0x3a49ca[_0x551b92(0x25b)])){const _0x19b150=await QueueOption_1['default'][_0x551b92(0xf5)]({'where':{'queueId':_0x3a49ca['queueId'],'parentId':null},'order':[[_0x551b92(0x170),_0x551b92(0x18e)],[_0x551b92(0x1b7),'ASC']]}),_0x2b699a=_0x3a49ca[_0x551b92(0x287)],_0xa13336=await Setting_1[_0x551b92(0x1a8)][_0x551b92(0x1b6)]({'where':{'key':_0x551b92(0x121),'companyId':_0x2b699a}}),_0x6fc3a4=async()=>{const _0x383442=_0x551b92,_0x21cc8e=[];_0x19b150['forEach']((_0x3a5f69,_0x1c53bc)=>{const _0x1e3a10=a558_0x3634;_0x21cc8e[_0x1e3a10(0x167)]({'buttonId':''+_0x3a5f69['option'],'buttonText':{'displayText':_0x3a5f69[_0x1e3a10(0x174)]},'type':0x4});}),_0x21cc8e['push']({'buttonId':'#','buttonText':{'displayText':_0x383442(0x1c2)},'type':0x4});const _0x337170={'text':(0x0,Mustache_1[_0x383442(0x1a8)])('‎'+_0x227649[_0x383442(0x2ae)],_0x3a49ca),'buttons':_0x21cc8e,'footer':_0x383442(0x1d1),'headerType':0x1},_0x550ecb=await _0x3ed28c[_0x383442(0x258)](_0x3a49ca[_0x383442(0x135)][_0x383442(0xf7)]+'@'+(_0x3a49ca[_0x383442(0x1a2)]?'g.us':_0x383442(0x256)),_0x337170);await(0x0,exports['verifyMessage'])(_0x550ecb,_0x3a49ca,_0x3a49ca[_0x383442(0x135)]);},_0x29db57=async()=>{const _0x1a2695=_0x551b92;let _0x1c8028='';console[_0x1a2695(0x241)](_0x1a2695(0x148)),console[_0x1a2695(0x14e)](_0x227649[_0x1a2695(0x2a1)]),_0x19b150[_0x1a2695(0x1c3)]((_0x155a72,_0x412b0c)=>{const _0x23e257=_0x1a2695;_0x1c8028+='*[\x20'+_0x155a72[_0x23e257(0x170)]+_0x23e257(0x271)+_0x155a72['title']+'\x0a';}),_0x1c8028+=_0x1a2695(0x220);const _0x13d328={'text':(0x0,Mustache_1['default'])('‎'+_0x227649[_0x1a2695(0x2ae)]+'\x0a\x0a'+_0x1c8028,_0x3a49ca)};let _0x548ef3;if(!_0x227649['mediaPath'])_0x548ef3=await _0x3ed28c[_0x1a2695(0x258)](_0x3a49ca[_0x1a2695(0x135)][_0x1a2695(0xf7)]+'@'+(_0x3a49ca[_0x1a2695(0x1a2)]?_0x1a2695(0x281):_0x1a2695(0x256)),_0x13d328),await(0x0,exports[_0x1a2695(0xf8)])(_0x548ef3,_0x3a49ca,_0x3a49ca[_0x1a2695(0x135)]);else{const _0x37cbc9=path_1[_0x1a2695(0x1a8)][_0x1a2695(0x22f)]('public',_0x1a2695(0x1cf)+_0x3a49ca['companyId'],_0x227649[_0x1a2695(0x2a1)]),_0x3d32f7=await(0x0,SendWhatsAppMedia_1[_0x1a2695(0x22e)])(_0x13d328[_0x1a2695(0x15c)],_0x37cbc9,_0x13d328[_0x1a2695(0x15c)],_0x3a49ca['companyId']);_0x548ef3=await _0x3ed28c[_0x1a2695(0x258)](_0x3a49ca['contact'][_0x1a2695(0xf7)]+'@'+(_0x3a49ca[_0x1a2695(0x1a2)]?_0x1a2695(0x281):_0x1a2695(0x256)),{..._0x3d32f7}),await verifyMediaMessage(_0x548ef3,_0x3a49ca,_0x3a49ca['contact']);}};if(_0xa13336[_0x551b92(0x141)]===_0x551b92(0x151)&&QueueOption_1[_0x551b92(0x1a8)][_0x551b92(0x235)]<=0x4)return _0x6fc3a4();if(_0xa13336[_0x551b92(0x141)]===_0x551b92(0x15c))return console[_0x551b92(0x241)](_0x551b92(0x148)),_0x29db57();if(_0xa13336['value']===_0x551b92(0x151)&&QueueOption_1[_0x551b92(0x1a8)][_0x551b92(0x235)]>0x4)return console[_0x551b92(0x241)](_0x551b92(0x148)),_0x29db57();}else{if(!(0x0,lodash_1[_0x551b92(0x142)])(_0x227649)&&!(0x0,lodash_1[_0x551b92(0x142)])(_0x3a49ca[_0x551b92(0x25b)])){const _0x2ed48a=await QueueOption_1['default']['findByPk'](_0x3a49ca[_0x551b92(0x25b)]),_0x11f8df=await QueueOption_1['default'][_0x551b92(0xf5)]({'where':{'parentId':_0x3a49ca['queueOptionId']},'order':[[_0x551b92(0x170),'ASC'],['createdAt',_0x551b92(0x18e)]]});if(_0x11f8df['length']===0x0){const _0x2fe440={'text':(0x0,Mustache_1[_0x551b92(0x1a8)])('‎'+_0x2ed48a[_0x551b92(0x2b2)],_0x3a49ca)},_0x574e23=await _0x3ed28c['sendMessage'](_0x3a49ca[_0x551b92(0x135)][_0x551b92(0xf7)]+'@'+(_0x3a49ca[_0x551b92(0x1a2)]?_0x551b92(0x281):'s.whatsapp.net'),_0x2fe440);await(0x0,exports[_0x551b92(0xf8)])(_0x574e23,_0x3a49ca,_0x3a49ca['contact']),await _0x3a49ca[_0x551b92(0x126)]({'queueOptionId':null,'chatbot':![]});return;}if(_0x11f8df[_0x551b92(0x235)]>-0x1){const _0x292222=_0x3a49ca['companyId'],_0x482e6f=await Setting_1[_0x551b92(0x1a8)][_0x551b92(0x1b6)]({'where':{'key':_0x551b92(0x121),'companyId':_0x292222}}),_0x449952=async()=>{const _0x4872de=_0x551b92,_0x56e62b=[],_0x18a28f=_0x3a49ca[_0x4872de(0x287)],_0x2c66df=await getQueues(_0x18a28f),_0x6e830a=await getContactFromTicket(_0x3a49ca['id']);_0x2c66df[_0x4872de(0x1c3)]((_0x149f6a,_0x58265b)=>{const _0x3ccab2=_0x4872de;_0x56e62b['push']({'title':'['+(_0x58265b+0x1)+_0x3ccab2(0xf1)+_0x149f6a[_0x3ccab2(0x1c9)],'rowId':''+(_0x58265b+0x1)});});const _0xf34875=[{'rows':_0x56e62b}],_0x6cddfd={'text':(0x0,Mustache_1[_0x4872de(0x1a8)])('‎'+_0x2ed48a['message'],_0x3a49ca),'title':_0x4872de(0x279),'buttonText':_0x4872de(0x1f8),'sections':_0xf34875};await sleep(0x3e8);const _0xf689a=await _0x3ed28c[_0x4872de(0x258)](_0x4872de(0x132)+_0x6e830a[_0x4872de(0xf7)]+'@'+(_0x3a49ca[_0x4872de(0x1a2)]?'g.us':_0x4872de(0x256)),_0x6cddfd);await(0x0,exports['verifyMessage'])(_0xf689a,_0x3a49ca,_0x3a49ca[_0x4872de(0x135)]);},_0x35c7a5=async()=>{const _0xc80e4e=_0x551b92,_0x4b15a5=[];_0x11f8df[_0xc80e4e(0x1c3)]((_0x29346f,_0x331027)=>{const _0x1b8979=_0xc80e4e;_0x4b15a5[_0x1b8979(0x167)]({'buttonId':''+_0x29346f['option'],'buttonText':{'displayText':_0x29346f[_0x1b8979(0x174)]},'type':0x4});}),_0x4b15a5[_0xc80e4e(0x167)]({'buttonId':'#','buttonText':{'displayText':'Menu\x20inicial\x20*[\x200\x20]*\x20Menu\x20anterior'},'type':0x4});const _0x30a42c={'text':(0x0,Mustache_1[_0xc80e4e(0x1a8)])('‎'+_0x2ed48a[_0xc80e4e(0x2b2)],_0x3a49ca),'buttons':_0x4b15a5,'headerType':0x4};if(process[_0xc80e4e(0x24e)][_0xc80e4e(0x2a0)]?.['length']>=0x8){if(_0x3a49ca[_0xc80e4e(0x135)][_0xc80e4e(0xf7)]!=process[_0xc80e4e(0x24e)][_0xc80e4e(0x2a0)]){console['trace']('chatbot\x20desativado!');return;}}if(!_0x2ed48a[_0xc80e4e(0x2a1)]){const _0x5db80d=await _0x3ed28c[_0xc80e4e(0x258)](_0x3a49ca[_0xc80e4e(0x135)][_0xc80e4e(0xf7)]+'@'+(_0x3a49ca[_0xc80e4e(0x1a2)]?'g.us':'s.whatsapp.net'),_0x30a42c);await(0x0,exports[_0xc80e4e(0xf8)])(_0x5db80d,_0x3a49ca,_0x3a49ca['contact']);}else{const _0x1deabc=path_1[_0xc80e4e(0x1a8)]['resolve'](_0xc80e4e(0xff),_0xc80e4e(0x1cf)+_0x3a49ca[_0xc80e4e(0x287)],_0x2ed48a[_0xc80e4e(0x2a1)]),_0x2bd7d7=await(0x0,SendWhatsAppMedia_1[_0xc80e4e(0x22e)])(_0x2ed48a[_0xc80e4e(0x120)],_0x1deabc,_0x30a42c['text'],_0x3a49ca[_0xc80e4e(0x287)]);let _0x5bf88b=await _0x3ed28c['sendMessage'](_0x3a49ca[_0xc80e4e(0x135)]['number']+'@'+(_0x3a49ca[_0xc80e4e(0x1a2)]?_0xc80e4e(0x281):_0xc80e4e(0x256)),{..._0x2bd7d7});await verifyMediaMessage(_0x5bf88b,_0x3a49ca,_0x3a49ca[_0xc80e4e(0x135)]);}const _0x52ec55=await _0x3ed28c[_0xc80e4e(0x258)](_0x3a49ca[_0xc80e4e(0x135)]['number']+'@'+(_0x3a49ca[_0xc80e4e(0x1a2)]?_0xc80e4e(0x281):_0xc80e4e(0x256)),_0x30a42c);await(0x0,exports['verifyMessage'])(_0x52ec55,_0x3a49ca,_0x3a49ca[_0xc80e4e(0x135)]);},_0x558132=async()=>{const _0x34236d=_0x551b92;let _0x7f5fb3='';_0x11f8df[_0x34236d(0x1c3)]((_0x29f165,_0x19baf2)=>{const _0x41bfad=_0x34236d;_0x7f5fb3+=_0x41bfad(0x25a)+_0x29f165[_0x41bfad(0x170)]+'\x20]*\x20-\x20'+_0x29f165['title']+'\x0a';}),_0x7f5fb3+=_0x34236d(0x1d3),_0x7f5fb3+=_0x34236d(0x220);const _0x61de08={'text':(0x0,Mustache_1[_0x34236d(0x1a8)])('‎'+_0x2ed48a[_0x34236d(0x2b2)]+'\x0a\x0a'+_0x7f5fb3,_0x3a49ca)};if(process['env'][_0x34236d(0x2a0)]?.[_0x34236d(0x235)]>=0x8){if(_0x3a49ca[_0x34236d(0x135)]['number']!=process[_0x34236d(0x24e)][_0x34236d(0x2a0)]){console['trace'](_0x34236d(0x159));return;}}if(!_0x2ed48a[_0x34236d(0x2a1)]){const _0x2a4ec6=await _0x3ed28c[_0x34236d(0x258)](_0x3a49ca[_0x34236d(0x135)][_0x34236d(0xf7)]+'@'+(_0x3a49ca['isGroup']?_0x34236d(0x281):'s.whatsapp.net'),_0x61de08);await(0x0,exports['verifyMessage'])(_0x2a4ec6,_0x3a49ca,_0x3a49ca[_0x34236d(0x135)]);}else{const _0x35ddca=path_1[_0x34236d(0x1a8)][_0x34236d(0x22f)](_0x34236d(0xff),'company'+_0x3a49ca['companyId'],_0x2ed48a[_0x34236d(0x2a1)]),_0x32b832=await(0x0,SendWhatsAppMedia_1[_0x34236d(0x22e)])(_0x2ed48a[_0x34236d(0x120)],_0x35ddca,_0x61de08[_0x34236d(0x15c)],_0x3a49ca['companyId']);let _0x3fecb6=await _0x3ed28c[_0x34236d(0x258)](_0x3a49ca[_0x34236d(0x135)][_0x34236d(0xf7)]+'@'+(_0x3a49ca[_0x34236d(0x1a2)]?_0x34236d(0x281):_0x34236d(0x256)),{..._0x32b832});await verifyMediaMessage(_0x3fecb6,_0x3a49ca,_0x3a49ca[_0x34236d(0x135)]);}};if(_0x482e6f[_0x551b92(0x141)]===_0x551b92(0x23e))return _0x449952();if(_0x482e6f[_0x551b92(0x141)]===_0x551b92(0x151)&&QueueOption_1[_0x551b92(0x1a8)][_0x551b92(0x235)]<=0x4)return _0x35c7a5();if(_0x482e6f[_0x551b92(0x141)]===_0x551b92(0x15c))return console[_0x551b92(0x241)](_0x551b92(0x103)),_0x558132();if(_0x482e6f[_0x551b92(0x141)]===_0x551b92(0x151)&&QueueOption_1['default'][_0x551b92(0x235)]>0x4)return console[_0x551b92(0x241)](_0x551b92(0x2ac)),_0x558132();}}}}},handleMessageIntegration=async(_0x30e61d,_0x48d8ea,_0x4710a4,_0x3f16df)=>{const _0x141bd0=a558_0x3b09f7;if(process[_0x141bd0(0x24e)][_0x141bd0(0x2a0)]){if(_0x3f16df['contact'][_0x141bd0(0xf7)]!=process['env'][_0x141bd0(0x2a0)]){console[_0x141bd0(0x14e)](_0x141bd0(0x159));return;}}const _0x1f4fce=getTypeMessage(_0x30e61d);if(_0x4710a4[_0x141bd0(0x1b4)]===_0x141bd0(0x10c)||_0x4710a4['type']===_0x141bd0(0xfd)){if(_0x4710a4?.[_0x141bd0(0x198)]){const _0x26cae3={'method':'POST','url':_0x4710a4?.[_0x141bd0(0x198)],'headers':{'Content-Type':_0x141bd0(0x205)},'json':_0x30e61d};try{(0x0,request_1['default'])(_0x26cae3,function(_0x325cae,_0x1eddb8){const _0x689a16=_0x141bd0;if(_0x325cae)throw new Error(_0x325cae);else console['log'](_0x1eddb8[_0x689a16(0x251)]);});}catch(_0x1d44f0){throw new Error(_0x1d44f0);}}}else _0x4710a4[_0x141bd0(0x1b4)]===_0x141bd0(0x128)&&await(0x0,typebotListener_1[_0x141bd0(0x1a8)])({'ticket':_0x3f16df,'msg':_0x30e61d,'wbot':_0x48d8ea,'typebot':_0x4710a4});};exports[a558_0x3b09f7(0x178)]=handleMessageIntegration;const messageContainsMedia=_0xd7abad=>{const _0x59cef9=a558_0x3b09f7;return _0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x200)]||_0xd7abad['message']?.[_0x59cef9(0x108)]||_0xd7abad[_0x59cef9(0x2b2)]?.['videoMessage']||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x1c8)]||_0xd7abad[_0x59cef9(0x2b2)]?.['documentMessage']||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x17b)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x2a3)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x129)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x108)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x129)]?.['message']?.[_0x59cef9(0x2a3)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x129)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x213)]||_0xd7abad['message']?.['ephemeralMessage']?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x1c8)]||_0xd7abad[_0x59cef9(0x2b2)]?.['ephemeralMessage']?.['message']?.[_0x59cef9(0x200)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x236)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x200)]||_0xd7abad['message']?.[_0x59cef9(0x236)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x213)]||_0xd7abad[_0x59cef9(0x2b2)]?.['ephemeralMessage']?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x236)]?.[_0x59cef9(0x2b2)]?.['imageMessage']||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x129)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x236)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x213)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x129)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x236)]?.['message']?.['audioMessage']||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x129)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x236)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x2a3)]||_0xd7abad['message']?.[_0x59cef9(0x17b)]?.[_0x59cef9(0x2b2)]?.[_0x59cef9(0x2a3)]||_0xd7abad[_0x59cef9(0x2b2)]?.['templateMessage']?.[_0x59cef9(0x22d)]?.[_0x59cef9(0x200)]||_0xd7abad['message']?.[_0x59cef9(0x29e)]?.[_0x59cef9(0x22d)]?.[_0x59cef9(0x2a3)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x29e)]?.[_0x59cef9(0x22d)]?.['videoMessage']||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x29e)]?.[_0x59cef9(0xf9)]?.['imageMessage']||_0xd7abad[_0x59cef9(0x2b2)]?.['templateMessage']?.[_0x59cef9(0xf9)]?.['documentMessage']||_0xd7abad[_0x59cef9(0x2b2)]?.['templateMessage']?.[_0x59cef9(0xf9)]?.[_0x59cef9(0x213)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x29e)]?.[_0x59cef9(0x293)]?.[_0x59cef9(0x200)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x29e)]?.[_0x59cef9(0x293)]?.[_0x59cef9(0x2a3)]||_0xd7abad['message']?.[_0x59cef9(0x29e)]?.['fourRowTemplate']?.[_0x59cef9(0x213)]||_0xd7abad[_0x59cef9(0x2b2)]?.['interactiveMessage']?.['header']?.[_0x59cef9(0x200)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x254)]?.[_0x59cef9(0x27e)]?.[_0x59cef9(0x2a3)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x254)]?.[_0x59cef9(0x27e)]?.[_0x59cef9(0x213)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x118)]?.['hydratedHsm']?.['hydratedTemplate']?.[_0x59cef9(0x2a3)]||_0xd7abad[_0x59cef9(0x2b2)]?.['highlyStructuredMessage']?.['hydratedHsm']?.['hydratedTemplate']?.[_0x59cef9(0x213)]||_0xd7abad['message']?.[_0x59cef9(0x118)]?.['hydratedHsm']?.['hydratedTemplate']?.[_0x59cef9(0x200)]||_0xd7abad[_0x59cef9(0x2b2)]?.[_0x59cef9(0x118)]?.[_0x59cef9(0x263)]?.['hydratedTemplate']?.[_0x59cef9(0x12b)];},handleMessage=async(_0xa0765f,_0x465479,_0x463ef7,_0x479a73=![])=>{const _0x299960=a558_0x3b09f7;if(_0x479a73){console[_0x299960(0x14e)]('Importando\x20mensagens!!');let _0x20913b=_0xa0765f[_0x299960(0x20b)]['id'],_0x42f978=await Message_1[_0x299960(0x1a8)][_0x299960(0x231)]({'where':{'id':_0x20913b}});if(_0x42f978>0x0){await new Promise(_0x4647a8=>setTimeout(_0x4647a8,0x96));return;}else await new Promise(_0x1d0c3c=>setTimeout(_0x1d0c3c,0x14a));}let _0x177031;if(!(0x0,exports[_0x299960(0x245)])(_0xa0765f)){console[_0x299960(0x14e)](_0x299960(0x209)),console[_0x299960(0x14e)](_0xa0765f);return;}_0xa0765f[_0x299960(0x2b2)]?.['ephemeralMessage']&&(_0xa0765f['message']=_0xa0765f['message'][_0x299960(0x129)]['message']);try{let _0x5f5c23;const _0x224e34=_0xa0765f['key'][_0x299960(0x221)]?.[_0x299960(0x10b)](_0x299960(0x1a3)),_0x42a490=await Setting_1[_0x299960(0x1a8)][_0x299960(0x1b6)]({'where':{'companyId':_0x463ef7,'key':_0x299960(0x25f)}});if(_0x42a490?.[_0x299960(0x141)]===_0x299960(0x133)&&_0x224e34){console['log'](_0x299960(0x292));return;}let _0x5876b5=(0x0,exports[_0x299960(0x297)])(_0xa0765f);const _0x3167ca=getTypeMessage(_0xa0765f);typeof _0x5876b5===_0x299960(0x1a5)&&(_0x5876b5=_0x5876b5['replace'](/\u200c/,''));const _0x2accd1=messageContainsMedia(_0xa0765f);if(_0xa0765f[_0x299960(0x20b)][_0x299960(0x255)]){if(!_0x2accd1&&_0x3167ca!=='conversation'&&_0x3167ca!==_0x299960(0x1e5)&&_0x3167ca!==_0x299960(0x177)&&_0x3167ca!==_0x299960(0x262)&&_0x3167ca!==_0x299960(0x129)&&_0x3167ca!==_0x299960(0x226)&&_0x3167ca!==_0x299960(0x18d)&&_0x3167ca!=='viewOnceMessage'&&_0x3167ca!==_0x299960(0x12b)&&_0x3167ca!==_0x299960(0x1d2)&&_0x3167ca!==_0x299960(0x139)){console[_0x299960(0x241)](_0x3167ca);return;}}const _0x8bc2b7=await(0x0,ShowWhatsAppService_1[_0x299960(0x1a8)])(_0x465479['id'],_0x463ef7);let _0x592c32,_0x549381=await getContactMessage(_0xa0765f,_0x465479);_0x5f5c23=await verifyContact(_0x549381,_0x465479,_0x463ef7);if(_0x224e34){if(!_0x8bc2b7[_0x299960(0x13e)])return;try{const _0x39e69e=await _0x465479[_0x299960(0x1e6)](_0xa0765f[_0x299960(0x20b)]['remoteJid']),_0xbc3f4={'id':_0x39e69e['id'],'name':_0x39e69e['subject']};_0x592c32=await verifyContact(_0xbc3f4,_0x465479,_0x463ef7);}catch(_0x44e212){console[_0x299960(0x14e)](_0x299960(0x204)),console[_0x299960(0x14e)](_0x44e212);return;}}let _0x2cacfc=0x0;if(_0xa0765f[_0x299960(0x20b)][_0x299960(0x255)])await cache_1[_0x299960(0x20e)]['set'](_0x299960(0x175)+_0x5f5c23['id']+_0x299960(0xfc),'0');else{const _0x3cc666=await cache_1[_0x299960(0x20e)]['get'](_0x299960(0x175)+_0x5f5c23['id']+':unreads');_0x2cacfc=+_0x3cc666+0x1,await cache_1[_0x299960(0x20e)][_0x299960(0x1ee)](_0x299960(0x175)+_0x5f5c23['id']+':unreads',''+_0x2cacfc);}const _0x10b24f=await(0x0,FindOrCreateTicketService_1[_0x299960(0x1a8)])(_0x5f5c23,_0x465479['id'],_0x2cacfc,_0x463ef7,_0x592c32,_0x479a73),_0x3ce629=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x10b24f['id'],'companyId':_0x463ef7,'whatsappId':_0x8bc2b7?.['id']});_0x3ce629['changed'](_0x299960(0x124),!![]),await _0x3ce629[_0x299960(0x126)]({'updatedAt':new Date()}),await(0x0,providers_1[_0x299960(0x22a)])(_0x10b24f,_0xa0765f,_0x463ef7,_0x5f5c23,_0x465479);if(_0x8bc2b7['complationMessage']&&_0x2cacfc===0x0){const _0x4eefdb=await Message_1[_0x299960(0x1a8)][_0x299960(0x1b6)]({'where':{'contactId':_0x5f5c23['id'],'companyId':_0x463ef7},'order':[[_0x299960(0x1b7),_0x299960(0x11a)]]});if((0x0,Mustache_1[_0x299960(0x1a8)])(_0x8bc2b7[_0x299960(0x23d)],_0x10b24f)['trim']()[_0x299960(0x1fc)]()===_0x4eefdb?.[_0x299960(0x251)][_0x299960(0x26c)]()['toLowerCase']())return;}if(_0x5876b5=='#'&&!_0x479a73&&(!_0x10b24f[_0x299960(0x1f4)]||_0x10b24f[_0x299960(0x131)]==_0x299960(0x1fa))){await _0x10b24f['update']({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x465479,_0xa0765f,_0x10b24f,_0x10b24f[_0x299960(0x135)]);return;}try{if(!_0xa0765f[_0x299960(0x20b)]['fromMe']&&!_0x479a73){if(_0x5876b5!=null&&typeof _0x5876b5!==_0x299960(0x1a5)){console[_0x299960(0x14e)](_0x5876b5),console[_0x299960(0x241)]('Expected\x20bodyMessage\x20to\x20be\x20a\x20string,\x20got:',typeof _0x5876b5);return;}if(_0x5876b5?.[_0x299960(0x176)]()===_0x299960(0x144)&&_0x10b24f['status']!=_0x299960(0x296)){await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x465479,_0x10b24f['contact'][_0x299960(0xf7)]+'@'+(_0x10b24f[_0x299960(0x1a2)]?_0x299960(0x281):_0x299960(0x256)));const _0x2faaf6=await _0x465479['sendMessage'](_0x10b24f['contact']['number']+'@'+(_0x10b24f[_0x299960(0x1a2)]?'g.us':_0x299960(0x256)),{'text':_0x299960(0x206)});await(0x0,exports['verifyMessage'])(_0x2faaf6,_0x10b24f,_0x10b24f['contact']),await(0x0,UpdateTicketService_1[_0x299960(0x1a8)])({'ticketData':{'queueId':null,'status':_0x299960(0x296)},'ticketId':_0x10b24f['id'],'companyId':_0x10b24f[_0x299960(0x287)]}),await _0x10b24f[_0x299960(0x288)]();return;}}}catch(_0x15454b){console[_0x299960(0x14e)](_0x299960(0x222)),console[_0x299960(0x14e)](_0x15454b),Sentry['captureException'](_0x15454b);}try{await _0x10b24f[_0x299960(0x126)]({'fromMe':_0xa0765f[_0x299960(0x20b)]['fromMe']});}catch(_0x5e6097){console['log']('Erro\x20ao\x20salvar\x20ticket!'),console[_0x299960(0x14e)](_0x5e6097),Sentry[_0x299960(0x180)](_0x5e6097);}try{if(!_0xa0765f[_0x299960(0x20b)]['fromMe']){if((0x0,exports[_0x299960(0xe9)])(_0x3ce629)){await(0x0,exports[_0x299960(0x2a5)])(_0xa0765f,_0x10b24f,_0x3ce629),console[_0x299960(0x14e)](_0x299960(0x24f)+_0xa0765f);return;}}}catch(_0x1e8053){console['log'](_0x299960(0x1fd)),Sentry[_0x299960(0x180)](_0x1e8053),console[_0x299960(0x14e)](_0x1e8053);}_0x2accd1?_0x177031=await verifyMediaMessage(_0xa0765f,_0x10b24f,_0x5f5c23):await(0x0,exports[_0x299960(0xf8)])(_0xa0765f,_0x10b24f,_0x5f5c23);const _0x4b4e78=await(0x0,VerifyCurrentSchedule_1[_0x299960(0x1a8)])(_0x463ef7),_0x4df83a=await Setting_1[_0x299960(0x1a8)][_0x299960(0x1b6)]({'where':{'companyId':_0x463ef7,'key':_0x299960(0x26a)}});if(!_0xa0765f[_0x299960(0x20b)][_0x299960(0x255)]&&_0x4df83a&&!_0x479a73)await handleOutOfHour(_0x465479,_0x10b24f,_0x4df83a,_0x5f5c23,_0x4b4e78,_0x8bc2b7);!_0x10b24f[_0x299960(0x28e)]&&!_0x224e34&&!_0xa0765f[_0x299960(0x20b)]['fromMe']&&!_0x10b24f[_0x299960(0x1f4)]&&!(0x0,lodash_1[_0x299960(0x142)])(_0x8bc2b7['promptId'])&&!_0x479a73&&await handleOpenAi(_0xa0765f,_0x465479,_0x10b24f,_0x5f5c23,_0x177031);if(!_0xa0765f[_0x299960(0x20b)][_0x299960(0x255)]&&!_0x10b24f[_0x299960(0x1a2)]&&!_0x10b24f[_0x299960(0x28e)]&&!_0x10b24f[_0x299960(0x282)]&&_0x10b24f[_0x299960(0x2aa)]&&!(0x0,lodash_1[_0x299960(0x142)])(_0x8bc2b7[_0x299960(0x2b4)])&&!_0x10b24f['useIntegration']&&!_0x479a73){const _0xe16f80=await(0x0,ShowQueueIntegrationService_1['default'])(_0x8bc2b7['integrationId'],_0x463ef7);await(0x0,exports[_0x299960(0x178)])(_0xa0765f,_0x465479,_0xe16f80,_0x10b24f);return;}!_0x224e34&&!_0xa0765f[_0x299960(0x20b)][_0x299960(0x255)]&&!_0x10b24f[_0x299960(0x1f4)]&&!(0x0,lodash_1[_0x299960(0x142)])(_0x10b24f[_0x299960(0x106)])&&_0x10b24f['useIntegration']&&!_0x479a73&&await handleOpenAi(_0xa0765f,_0x465479,_0x10b24f,_0x5f5c23,_0x177031);if(!_0xa0765f[_0x299960(0x20b)]['fromMe']&&!_0x10b24f[_0x299960(0x1a2)]&&!_0x10b24f[_0x299960(0x1f4)]&&_0x10b24f[_0x299960(0x2b4)]&&_0x10b24f[_0x299960(0x1e9)]&&!_0x479a73){const _0x11aa57=await(0x0,ShowQueueIntegrationService_1['default'])(_0x10b24f['integrationId'],_0x463ef7);await(0x0,exports['handleMessageIntegration'])(_0xa0765f,_0x465479,_0x11aa57,_0x10b24f);}!_0x10b24f[_0x299960(0x28e)]&&!_0x10b24f[_0x299960(0x1a2)]&&!_0xa0765f[_0x299960(0x20b)][_0x299960(0x255)]&&!_0x10b24f[_0x299960(0x1f4)]&&_0x8bc2b7[_0x299960(0x242)][_0x299960(0x235)]>=0x1&&!_0x10b24f[_0x299960(0x1e9)]&&!_0x479a73&&(await verifyQueue(_0x465479,_0xa0765f,_0x10b24f,_0x5f5c23),_0x3ce629[_0x299960(0x240)](_0x299960(0x21f),!![]),_0x3ce629[_0x299960(0x240)](_0x299960(0x124),!![]),await _0x3ce629['update']({'chatbotAt':(0x0,moment_1[_0x299960(0x1a8)])()[_0x299960(0x264)](),'updatedAt':new Date()}));const _0x311e65=_0x10b24f[_0x299960(0x28e)]===null;await _0x10b24f['reload']();if(!_0x479a73&&_0x8bc2b7[_0x299960(0x2ae)])await greetingMessage(_0x465479,_0x10b24f,_0xa0765f,_0x8bc2b7,_0x224e34);_0x8bc2b7[_0x299960(0x242)][_0x299960(0x235)]==0x1&&_0x10b24f['queue']&&!_0x479a73&&(_0x10b24f[_0x299960(0x2aa)]&&!_0xa0765f[_0x299960(0x20b)]['fromMe']&&!_0x10b24f[_0x299960(0x1f4)]&&await handleChartbot(_0x10b24f,_0xa0765f,_0x465479,_0x8bc2b7)),_0x8bc2b7[_0x299960(0x242)][_0x299960(0x235)]>0x1&&_0x10b24f[_0x299960(0x28e)]&&!_0x479a73&&(_0x10b24f[_0x299960(0x2aa)]&&!_0xa0765f['key'][_0x299960(0x255)]&&!_0x10b24f[_0x299960(0x1f4)]&&await handleChartbot(_0x10b24f,_0xa0765f,_0x465479,_0x8bc2b7,_0x311e65));}catch(_0x2eeccb){console['log'](_0x2eeccb),Sentry[_0x299960(0x180)](_0x2eeccb),logger_1[_0x299960(0x211)][_0x299960(0x105)](_0x299960(0x1dd)+_0x2eeccb);}};exports[a558_0x3b09f7(0x1cc)]=handleMessage;const handleOutOfHour=async(_0x2abc32,_0x16b69a,_0x3f7a0c,_0x4106c5,_0x57cfa4,_0x583bdd)=>{const _0x57fe3c=a558_0x3b09f7;try{if(outOfHourMessageControl[_0x57fe3c(0x235)]>0x1388)outOfHourMessageControl=[];let _0x163380=outOfHourMessageControl[_0x57fe3c(0x2b1)](_0x492843=>_0x492843[_0x57fe3c(0x18a)]===_0x16b69a['id']||_0x492843['dest']===_0x4106c5[_0x57fe3c(0xf7)]);if(_0x3f7a0c[_0x57fe3c(0x141)]===_0x57fe3c(0x1cf)&&!(0x0,lodash_1['isNil'])(_0x57cfa4)&&_0x583bdd[_0x57fe3c(0x234)]&&(!_0x57cfa4||_0x57cfa4[_0x57fe3c(0x2a6)]===![])){if(!_0x163380||_0x163380&&_0x163380[_0x57fe3c(0x1f9)]+0x3e8*0x3c*0x5<new Date()[_0x57fe3c(0x1e1)]()){_0x163380&&(outOfHourMessageControl=outOfHourMessageControl[_0x57fe3c(0x274)](_0x2da42b=>_0x2da42b[_0x57fe3c(0x18a)]!==_0x16b69a['id']),_0x163380=null);if(!_0x163380)outOfHourMessageControl[_0x57fe3c(0x167)]({'ticketId':_0x16b69a['id'],'dest':_0x4106c5[_0x57fe3c(0xf7)],'time':new Date()[_0x57fe3c(0x1e1)]()});const _0x1009c9='‎\x20'+_0x583bdd[_0x57fe3c(0x234)],_0x4777ad=(0x0,Debounce_1[_0x57fe3c(0x109)])(async()=>{const _0x5f1124=_0x57fe3c;await _0x2abc32[_0x5f1124(0x258)](_0x16b69a[_0x5f1124(0x135)][_0x5f1124(0xf7)]+'@'+(_0x16b69a['isGroup']?'g.us':'s.whatsapp.net'),{'text':_0x1009c9});},(0x0,queues_1[_0x57fe3c(0x27c)])(0x5dc,0xdac),_0x16b69a['id']);_0x4777ad();return;}}if(_0x3f7a0c[_0x57fe3c(0x141)]==='queue'&&_0x16b69a['queueId']!==null){const _0xed3896=await Queue_1[_0x57fe3c(0x1a8)][_0x57fe3c(0x237)](_0x16b69a['queueId']),{schedules:_0x2cee13}=_0xed3896,_0x6e7fcd=(0x0,moment_1[_0x57fe3c(0x1a8)])(),_0xc58d31=_0x6e7fcd[_0x57fe3c(0x1ad)](_0x57fe3c(0x1ac))[_0x57fe3c(0x1fc)]();let _0xf425b7=null;Array['isArray'](_0x2cee13)&&_0x2cee13[_0x57fe3c(0x235)]>0x0&&(_0xf425b7=_0x2cee13[_0x57fe3c(0x2b1)](_0x645480=>_0x645480[_0x57fe3c(0x179)]===_0xc58d31&&_0x645480[_0x57fe3c(0x2a4)]!==''&&_0x645480[_0x57fe3c(0x2a4)]!==null&&_0x645480[_0x57fe3c(0x199)]!==''&&_0x645480['endTime']!==null));if(_0x3f7a0c[_0x57fe3c(0x141)]===_0x57fe3c(0x28e)&&_0xed3896[_0x57fe3c(0x234)]!==null&&_0xed3896['outOfHoursMessage']!==''&&!(0x0,lodash_1[_0x57fe3c(0x142)])(_0xf425b7)){const _0x9f0cbb=(0x0,moment_1[_0x57fe3c(0x1a8)])(_0xf425b7[_0x57fe3c(0x2a4)],_0x57fe3c(0x1b5)),_0x4829f7=(0x0,moment_1[_0x57fe3c(0x1a8)])(_0xf425b7[_0x57fe3c(0x199)],_0x57fe3c(0x1b5));let _0x19740e=_0x6e7fcd[_0x57fe3c(0x278)](_0x9f0cbb)||_0x6e7fcd[_0x57fe3c(0xfe)](_0x4829f7);if(!_0x19740e){if(_0xf425b7['startLunchTime']&&_0xf425b7[_0x57fe3c(0x202)]){const _0x31a921=(0x0,moment_1[_0x57fe3c(0x1a8)])(_0xf425b7[_0x57fe3c(0x1f5)],'HH:mm'),_0x22c0d5=(0x0,moment_1['default'])(_0xf425b7['endLunchTime'],'HH:mm');_0x19740e=_0x6e7fcd[_0x57fe3c(0x16e)](_0x31a921,_0x22c0d5);}}if(_0x19740e){if(!_0x163380||_0x163380&&_0x163380['time']+0x3e8*0x3c*0x1e<new Date()['getTime']()){const _0x3bc1c1=_0xed3896['outOfHoursMessage'],_0xab5ed3=(0x0,Debounce_1[_0x57fe3c(0x109)])(async()=>{const _0x70ff6=_0x57fe3c;await _0x2abc32[_0x70ff6(0x258)](_0x16b69a[_0x70ff6(0x135)]['number']+'@'+(_0x16b69a[_0x70ff6(0x1a2)]?'g.us':_0x70ff6(0x256)),{'text':_0x3bc1c1});},(0x0,queues_1['randomValue'])(0x3e8,0xbb8),_0x16b69a['id']);_0xab5ed3();return;}if(!_0x163380)outOfHourMessageControl[_0x57fe3c(0x167)]({'ticketId':_0x16b69a['id'],'dest':_0x4106c5['number'],'time':new Date()[_0x57fe3c(0x1e1)]()});}}}}catch(_0xd6a3ae){Sentry['captureException'](_0xd6a3ae),console['log'](_0xd6a3ae);}},greetingMessage=async(_0x4a7540,_0xf0bc33,_0x517868,_0x45b0e4,_0x560342)=>{const _0x24ed42=a558_0x3b09f7;if(!_0x45b0e4?.[_0x24ed42(0x242)]?.[_0x24ed42(0x235)]&&!_0xf0bc33[_0x24ed42(0x1f4)]&&!_0x560342&&!_0x517868[_0x24ed42(0x20b)]['fromMe']){if(process[_0x24ed42(0x24e)][_0x24ed42(0x2a0)]?.[_0x24ed42(0x235)]>=0x8){if(_0xf0bc33[_0x24ed42(0x135)][_0x24ed42(0xf7)]!=process[_0x24ed42(0x24e)][_0x24ed42(0x2a0)])return;}if(greetingMessageControl[_0x24ed42(0x235)]>0x1388)greetingMessageControl=[];var _0x2f5187=greetingMessageControl['find'](_0x1508c2=>_0x1508c2[_0x24ed42(0x18a)]===_0xf0bc33['id']||_0x1508c2['dest']===_0xf0bc33[_0x24ed42(0x135)][_0x24ed42(0xf7)]);if(_0x2f5187&&_0x2f5187[_0x24ed42(0x1f9)]+0x3e8*0x3c*0x5>=new Date()['getTime']())return;const _0x327209=await Message_1['default']['findOne']({'where':{'ticketId':_0xf0bc33['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x24ed42(0x26d)]]:(0x0,moment_1[_0x24ed42(0x1a8)])()[_0x24ed42(0x25e)](0x5,'minutes')[_0x24ed42(0x264)]()}}});if(_0x327209)return;const _0x58f7f8=(0x0,Debounce_1[_0x24ed42(0x109)])(async()=>{const _0x288e98=_0x24ed42;if(!_0x45b0e4[_0x288e98(0x1b2)])await _0x4a7540[_0x288e98(0x258)](_0xf0bc33['contact']['number']+'@'+(_0xf0bc33[_0x288e98(0x1a2)]?'g.us':_0x288e98(0x256)),{'text':(0x0,Mustache_1[_0x288e98(0x1a8)])(_0x45b0e4[_0x288e98(0x2ae)],_0xf0bc33)});else{const _0x204056=path_1['default']['resolve'](_0x288e98(0xff),_0x288e98(0x1cf)+_0xf0bc33[_0x288e98(0x287)],_0x45b0e4[_0x288e98(0x1b2)]),_0xb5d7bb=await(0x0,SendWhatsAppMedia_1[_0x288e98(0x22e)])(_0x45b0e4['greetingMediaAttachment'],_0x204056,_0x45b0e4[_0x288e98(0x2ae)],_0xf0bc33[_0x288e98(0x287)]);await _0x4a7540[_0x288e98(0x258)](_0xf0bc33['contact']['number']+'@'+(_0xf0bc33[_0x288e98(0x1a2)]?_0x288e98(0x281):'s.whatsapp.net'),{..._0xb5d7bb});}},0x3e8,_0xf0bc33['id']);_0x58f7f8();return;}},handleMsgAck=async(_0x2bd350,_0x23a14a)=>{const _0x351bea=a558_0x3b09f7,_0x28d362=(0x0,socket_1[_0x351bea(0x122)])();try{const _0xc0c1c2=await Message_1['default'][_0x351bea(0x237)](_0x2bd350[_0x351bea(0x20b)]['id'],{'include':[_0x351bea(0x135),{'model':Message_1[_0x351bea(0x1a8)],'as':_0x351bea(0x21b),'include':[_0x351bea(0x135)]}]});if(!_0xc0c1c2){console[_0x351bea(0x14e)](_0x2bd350),console[_0x351bea(0x14e)]('Mensagem\x20não\x20encontrada!');return;}await _0xc0c1c2[_0x351bea(0x126)]({'ack':_0x23a14a}),_0x28d362['to'](_0xc0c1c2[_0x351bea(0x18a)][_0x351bea(0x27d)]())[_0x351bea(0x248)]('company-'+_0xc0c1c2[_0x351bea(0x287)]+'-appMessage',{'action':'update','message':_0xc0c1c2});}catch(_0x39889d){Sentry[_0x351bea(0x180)](_0x39889d),logger_1['logger'][_0x351bea(0x105)]('Error\x20handling\x20message\x20ack.\x20Err:\x20'+_0x39889d);}};exports[a558_0x3b09f7(0x1a4)]=handleMsgAck;const verifyRecentCampaign=async(_0x52db49,_0x326b84)=>{const _0x587b56=a558_0x3b09f7;if(!_0x52db49['key'][_0x587b56(0x255)]){const _0x20b3ec=_0x52db49[_0x587b56(0x20b)][_0x587b56(0x221)][_0x587b56(0x112)](/\D/g,''),_0x1eac23=await Campaign_1[_0x587b56(0x1a8)][_0x587b56(0xf5)]({'where':{'companyId':_0x326b84,'status':_0x587b56(0x232),'confirmation':!![]}});if(_0x1eac23){const _0x1ec206=_0x1eac23['map'](_0x2fa2f5=>_0x2fa2f5['id']),_0x425031=await CampaignShipping_1['default'][_0x587b56(0x1b6)]({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x1ec206},'number':_0x20b3ec,'confirmation':null}});_0x425031&&(await _0x425031[_0x587b56(0x126)]({'confirmedAt':(0x0,moment_1['default'])(),'confirmation':!![]}),await queues_1[_0x587b56(0x290)][_0x587b56(0x1b3)](_0x587b56(0xec),{'campaignShippingId':_0x425031['id'],'campaignId':_0x425031['campaignId']},{'delay':(0x0,queues_1[_0x587b56(0x163)])((0x0,queues_1[_0x587b56(0x27c)])(0x0,0xa))}));}}};exports[a558_0x3b09f7(0x266)]=verifyRecentCampaign;const verifyCampaignMessageAndCloseTicket=async(_0x1922c0,_0x54f258)=>{const _0x1056c0=a558_0x3b09f7,_0x1eeae4=(0x0,socket_1[_0x1056c0(0x122)])(),_0x4b91fa=(0x0,exports[_0x1056c0(0x297)])(_0x1922c0),_0x46babb=/\u200c/[_0x1056c0(0x168)](_0x4b91fa);if(_0x1922c0[_0x1056c0(0x20b)][_0x1056c0(0x255)]&&_0x46babb){const _0x25093c=await Message_1[_0x1056c0(0x1a8)]['findOne']({'where':{'id':_0x1922c0['key']['id'],'companyId':_0x54f258}}),_0x2acbbf=await Ticket_1[_0x1056c0(0x1a8)]['findByPk'](_0x25093c['ticketId']);await _0x2acbbf[_0x1056c0(0x126)]({'status':_0x1056c0(0x296)}),_0x1eeae4['to'](_0x1056c0(0x1b0)+_0x2acbbf[_0x1056c0(0x287)]+'-open')[_0x1056c0(0x248)](_0x1056c0(0x1b0)+_0x2acbbf[_0x1056c0(0x287)]+'-ticket',{'action':_0x1056c0(0x1a7),'ticket':_0x2acbbf,'ticketId':_0x2acbbf['id']}),_0x1eeae4['to'](_0x1056c0(0x1b0)+_0x54f258+'-'+_0x2acbbf['status'])['to'](_0x2acbbf['id'][_0x1056c0(0x27d)]())[_0x1056c0(0x248)](_0x1056c0(0x1b0)+_0x2acbbf[_0x1056c0(0x287)]+_0x1056c0(0xfa),{'action':_0x1056c0(0x126),'ticket':_0x2acbbf,'ticketId':_0x2acbbf['id']});}};function a558_0x576a(){const _0x1e5706=['conversation','isValidMsg','mimetype','amountUsedBotQueues','emit','choices','end','voiceKey','getDocumentMessage','pollCreationMessageV3','env','Mensagem\x20inválida\x208!\x20','getVideoMessage','body','SERVER_ACK','__importDefault','interactiveMessage','fromMe','s.whatsapp.net','AudioConfig','sendMessage','sendMessageImage','*[\x20','queueOptionId','configurable','Failed\x20to\x20fetch\x20contact\x20from\x20ticket:','subtract','CheckMsgIsGroup','then','whisper-1','contactMessage','hydratedHsm','toDate','stringify','verifyRecentCampaign','contactsArrayMessage','mkdirSync','stanzaId','scheduleType','options','trim','gte','gpt-3.5-turbo-1106','../../models/Message','getLocationMessage','\x20]*\x20-\x20','rate','product','filter','getOwnPropertyDescriptor','now','ack','isBefore','Lista','maxTokens','-open','randomValue','toString','header','Atualização\x20de\x20Status','../MessageServices/CreateMessageService','g.us','user','status@broadcast','__setModuleDefault','application','apply','companyId','reload','util','\x0a\x0a*[\x20#\x20]*\x20-\x20Voltar\x20ao\x20Menu\x20Principal','toFormat','writeFile','.mp3','queue','removeNonPrintableChars','campaignQueue','readFileSync','Mensagem\x20de\x20grupo\x20bloqueada!','fourRowTemplate','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','../../models/Queue','closed','getBodyMessage','CIPHERTEXT','externalAdReply','Failed\x20to\x20get\x20stream','caption','../../utils/logger','sleep','templateMessage','pipe','CHATBOT_RESTRICT_NUMBER','mediaPath','pt-BR-FabioNeural','documentMessage','startTime','handleRating','inActivity','.wav','selectedId','speechSynthesisVoiceName','chatbot','../TicketServices/UpdateTicketService','botText\x202','save','greetingMessage','speakTextAsync','keywords','find','message','proto','integrationId','messageQueue','Error\x20isValidMsg','verifyRating','pushName','includes','DispatchCampaign','mime','quarto\x20if','fromAudioFileOutput','Error:\x20',']\x20-\x20','wbotMessageListener','getTextMessage','maxUseBotQueues','findAll','getPaymentMessage','number','verifyMessage','hydratedFourRowTemplate','-ticket','messages',':unreads','webhook','isAfter','public','getQuotedMessageId','makeRandomId','../../models/Contact','botText\x203','audio/mpeg','error','promptId','system','audioMessage','debounce','body\x20is\x20not\x20a\x20string','endsWith','n8n','5316108VhITzi','sendGreetingMessageOneQueues','__importStar','ProtocolMessage','../../helpers/MakeRandomId','replace','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','editedMessage','verifyCampaignMessageAndCloseTicket','contacts','concat','highlyStructuredMessage','Erro\x20ao\x20deletar\x20o\x20arquivo:','DESC','close','listResponseMessage','__createBinding','groups.update','makeid','mediaName','chatBotType','getIO','Pedido','updatedAt','templateButtonReplyMessage','update','slice','typebot','ephemeralMessage','mp3','locationMessage','voice','Mensagem\x20que\x20Desaparece','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','unknown','floor','status','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','enabled','voiceMessage','contact','setFfmpegPath','dest','senderKeyDistributionMessage','advertising','./providers','setExtra','unlinkSync','../../app','allowGroup','createReadStream','quotedMessage','value','isNil','\x20|\x20https://maps.google.com/maps?q=','SAIR','&z=17&hl=pt-BR|','charAt','1927365kOoPhJ','botText','Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','dataJson','selectedButtonId','toFixed','2426648zvbnbt','log','contextInfo','sendMessageLink','button','../CompanyService/VerifyCurrentSchedule','E2E_DEVICE_CHANGED','Múltiplos\x20Produtos','DELIVERY_ACK','SendPresenceStatus','READ','buttonsResponseMessage','chatbot\x20desativado!','setMinutes','isNumeric','text','jidNormalizedUser','../../models/QueueOption','maxMessages','ERR_WAPP_DOWNLOAD_MEDIA','getButtonsMessage','Enquete\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','parseToMilliseconds','productMessage','from','HandleMessageJob','push','test','singleSelectReply','4510350MPivna','parentId','../../helpers/SendPresenceStatus','Message','isBetween','selectedRowId','option','../QueueIntegrationServices/ShowQueueIntegrationService','isNull','search','title','contacts:','toUpperCase','vcard','handleMessageIntegration','weekdayEn','participant','documentWithCaptionMessage','create','\x20Download\x20completed\x20in\x20','texto','isInteger','captureException','assistant','../ContactServices/CreateOrUpdateContactService','min','disableBot','../../models/Setting','voiceRegion','split','path','whatsappId','ticketId','../../models/Campaign','liveLocationMessage','reactionMessage','ASC','indexOf','./SendWhatsAppMedia','../../libs/wbot','SpeechSynthesizer','existsSync','Status','primeiro\x20if','listMessage','__esModule','urlN8N','endTime','getAudioMessage','../WhatsappService/ShowWhatsAppService','../../helpers/Mustache','values','(((.+)+)+)+$','Mensagem\x20interativa\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','extension','head','isGroup','@g.us','handleMsgAck','string','openai','delete','default','MESSAGE_EDIT','./wbotGetMessageFromType','../TicketServices/FindOrCreateTicketService','dddd','format','WAMessageStubType','../../models/CampaignShipping','company-','fluent-ffmpeg','greetingMediaAttachment','add','type','HH:mm','findOne','createdAt','upsert','application/pdf','Error\x20getting\x20message\x20body:','url','base64','apiKey','getListMessage','createChatCompletion','getWbot','warn','Menu\x20inicial\x20*[\x200\x20]*\x20Menu\x20anterior','forEach','Throttle','Configuration','PLAYED','data:image/png;base64,\x20','stickerMessage','name','filename','getStickerMessage','handleMessage','Produto','fora\x20do\x20horario','company','./SendWhatsAppMessage','DAUMZAP','hydratedContentText','\x0a*[\x200\x20]*\x20-\x20Menu\x20anterior','verifyQuotedMessage','PENDING','chat','public/temp/','finishedAt','Mensagem\x20editada\x20não\x20encontrada:\x20','get','next','getContactsArrayMessage','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','media','directPath','Type','getTime','Erro\x20para\x20responder\x20com\x20audio:\x20','constructor','substring','extendedTextMessage','groupMetadata','\x201286\x20-\x20Entrei\x20na\x20integracao\x20openai.','mediaUrl','useIntegration','getImageMessage','subject','77RjzawG','getQuotedMessage','set','\x20tokens\x20e\x20cuide\x20para\x20não\x20truncar\x20o\x20final.\x0aSempre\x20que\x20possível,\x20mencione\x20o\x20nome\x20dele\x20para\x20ser\x20mais\x20personalizado\x20o\x20atendimento\x20e\x20mais\x20educado.\x20Quando\x20a\x20resposta\x20requer\x20uma\x20transferência\x20para\x20o\x20setor\x20de\x20atendimento,\x20comece\x20sua\x20resposta\x20com\x20\x27Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento\x27.\x0a\x0a\x20\x20','findIndex','../../libs/cache','ffmpeg-static','Failed\x20to\x20fetch\x20queues:','userId','startLunchTime','\x20de\x20baixar\x20o\x20arquivo\x20','Latitude:\x20','Escolha\x20uma\x20opção','time','pending','fromSubscription','toLowerCase','Erro\x20ao\x20salvar\x20avaliação!','random','document','imageMessage','4098392WFqeIP','endLunchTime','2477296vRFmFE','Erro\x20ao\x20buscar\x20grupo!','application/json','*Você\x20encerrou\x20este\x20atendimento\x20usando\x20o\x20comando\x20SAIR*.\x0a\x0a\x0aSe\x20você\x20finalizou\x20o\x20atendimento\x20*ANTES*\x20de\x20receber\x20um\x20retorno\x20do\x20operador,\x20ele\x20*NÃO*\x20irá\x20visualizar\x20sua\x20solicitação!\x0a\x0aVocê\x20deve\x20aguardar\x20o\x20retorno\x20do\x20operador\x20e\x20que\x20ele\x20encerre\x20seu\x20atendimento\x20quando\x20necessário.\x0a\x0aUse\x20a\x20opção\x20*SAIR*\x20somente\x20em\x20casos\x20de\x20emergência\x20ou\x20se\x20ficou\x20preso\x20em\x20algum\x20setor.\x0a\x0a\x0aPara\x20iniciar\x20um\x20novo\x20atendimento\x20basta\x20enviar\x20uma\x20nova\x20mensagem!','messageContextInfo','getBodyButton','Mensagem\x20inválida!','762734TSgdWU','key','../TicketServices/FindOrCreateATicketTrakingService','terceiro\x20if','cacheLayer','-closed','WebMessageInfo','logger','No\x20result\x20from\x20synthesizer','videoMessage','isArray','keys','defineProperty','messageStubType','Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','E2E_IDENTITY_CHANGED','degreesLongitude','quotedMsg','../TypebotServices/typebotListener','moment','No\x20contact\x20found\x20for\x20this\x20ticket.','chatbotAt','\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial','remoteJid','Erro\x20ao\x20salvar\x20mensagem!','mediaMessage','content','update!','protocolMessage','data','viewOnceMessageV2','public/company','provider','chmodSync','degreesLatitude','hydratedTemplate','getMessageOptions','resolve','join','count','EM_ANDAMENTO','lodash','outOfHoursMessage','length','viewOnceMessage','findByPk','prompt','mediaType','ratingAt','queueId','call','complationMessage','list','\x20MBps','changed','trace','queues','getAd'];a558_0x576a=function(){return _0x1e5706;};return a558_0x576a();}exports['verifyCampaignMessageAndCloseTicket']=verifyCampaignMessageAndCloseTicket;const filterMessages=_0x42edb7=>{const _0x3be8a5=a558_0x3b09f7;if([baileys_1[_0x3be8a5(0x1ae)]['REVOKE'],baileys_1['WAMessageStubType'][_0x3be8a5(0x153)],baileys_1[_0x3be8a5(0x1ae)][_0x3be8a5(0x219)],baileys_1[_0x3be8a5(0x1ae)][_0x3be8a5(0x298)]]['includes'](_0x42edb7[_0x3be8a5(0x217)]))return![];return!![];},wbotMessageListener=async(_0x19ad66,_0x8bd488,_0x16d21f)=>{const _0xda0061=a558_0x3b09f7;_0x19ad66['ev']['on']('messages.upsert',async _0x47cdf8=>{const _0x19ee2e=a558_0x3634,_0x6a9055=_0x47cdf8[_0x19ee2e(0xfb)][_0x19ee2e(0x274)](filterMessages);if(!_0x6a9055)return;await app_1[_0x19ee2e(0x1a8)][_0x19ee2e(0x1da)](_0x19ee2e(0x242))[_0x19ee2e(0x2b5)][_0x19ee2e(0x1b3)](_0x19ee2e(0x166),{'whatsappId':_0x16d21f['id'],'messages':_0x6a9055,'companyId':_0x8bd488},{'removeOnComplete':!![],'attempts':0x3});}),_0x19ad66['ev']['on']('messages.update',async _0x130527=>{const _0x5a941b=a558_0x3634;if(_0x130527[_0x5a941b(0x235)]===0x0)return;await app_1['default'][_0x5a941b(0x1da)]('queues')[_0x5a941b(0x2b5)][_0x5a941b(0x1b3)]('MessageUpdateJob',{'whatsappId':_0x16d21f['id'],'messageUpdate':_0x130527,'companyId':_0x8bd488},{'removeOnComplete':!![],'attempts':0x3,'delay':0x64});}),_0x19ad66['ev']['on'](_0xda0061(0x11e),async _0xa95261=>{const _0x59ba5b=_0xda0061;console[_0x59ba5b(0x14e)](_0xa95261);if(_0xa95261[_0x59ba5b(0x235)]===0x0)return;for(const _0xa7a6 of _0xa95261){const _0x46e2ac=_0xa7a6['id'][_0x59ba5b(0x187)]('@')[0x0],_0x5e8e28=_0xa7a6[_0x59ba5b(0x1eb)]||_0x46e2ac,_0x38df1d={'name':_0x5e8e28,'number':_0x46e2ac,'isGroup':!![],'companyId':_0x8bd488,'remoteJid':_0xa7a6['id'],'whatsappId':_0x19ad66['id']};await(0x0,CreateOrUpdateContactService_1[_0x59ba5b(0x1a8)])(_0x38df1d,_0x19ad66,_0xa7a6['id']);}});};exports[a558_0x3b09f7(0xf2)]=wbotMessageListener;