'use strict';const a578_0x153a17=a578_0x5d4c;function a578_0x4467(){const _0x82ba2a=['error','endsWith','greetingMessage','WAMessageStubType','isFinite','verifyDeleteMessage','Atendimento\x20finalizado','pending','4kcHXKh','apply','../../helpers/CheckSettings','250eHdbZI','30239ZwQnVh','open','number','Tipo\x20de\x20integração\x20não\x20suportada.','getTypeMessage','messages.update','enabled','toLowerCase','chatbot','verifyRecentCampaign','queues','mediaPath','../../models/Whatsapp','findOne','search','isGroup','3QycbVe','captureException','Nó\x20final\x20encontrado.\x20Exibindo\x20mensagem\x20final.','forEach','isInteger','ephemeralMessage','CheckMsgIsGroup','listResponseMessage','../WhatsappService/ShowWhatsAppService','createdAt','Mutex','findAll','moment','useIntegration','isNil','update','\x22\x20para\x20ticket\x20','12ZxNmpn','inActivity','complationMessage','__setModuleDefault','DESC','__esModule','readMessages',':unreads','../../models/Setting','\x20já\x20processada\x20para\x20o\x20ticket\x20','Submenu\x20encontrado\x20com\x20','../../models/TicketTraking','ticket-','outOfHoursAction','company-','-appMessage','Error\x20handling\x20wbot\x20message\x20listener.\x20Err:\x20','locationMessage','lodash','lastProcessedMessageId','contactMessage','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','handleRating','default','CIPHERTEXT','outOfHoursMessage','contact','type','Processando\x20mensagem:\x20\x22','message','reactionMessage','../../libs/socket','verifyRating','verifyMediaMessage','filter','*#*\x20-\x20Voltar\x20Menu\x20Inicial','verifyQueue','toString','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','queue','\x20opções.\x20Exibindo\x20submenu.','emit','viewOnceMessage','../../models/Queue','__createBinding','\x20não\x20encontrada.','\x20selecionada\x20no\x20menu\x20principal.\x20ID:\x20','text','scheduleType','makeid','imageMessage','protocolMessage','-open','*\x20-\x20','Exibindo\x20menu\x20para\x20ticket\x20','@g.us','amountUsedBotQueues','random','companyId','quotedMsg','userId','not','Mensagem\x20','status@broadcast','async-mutex','constructor','contacts:','remoteJid','documentWithCaptionMessage','../../models/User','create','trim','forwardQueueId','vcard','../../models/UserRating','floor','getMessageMedia','setExtra','../../helpers/Mustache','ticket','videoMessage','\x20inválida\x20para\x20o\x20submenu\x20atual.','toDate','ticketId','typebot','getIO','status','getContactMessage','Configurações\x20do\x20WhatsApp\x20não\x20encontradas.','env','-ticket','buttonsResponseMessage','../TypebotServices/typebotListener','body','3709712jPPeJD','isNull','public','mediaMessage','\x0a*#*\x20-\x20Voltar\x20Menu\x20Inicial','length','Estamos\x20fora\x20do\x20horário\x20de\x20expediente','CHATBOT_RESTRICT_NUMBER','integrationId','queueOptionId','150UajvIU','ASC','../QueueIntegrationServices/ShowQueueIntegrationService','maxUseBotQueues','verifyContact','handleMessage','logger','(((.+)+)+)+$','debounce','Erro\x20ao\x20verificar\x20horário\x20de\x20atendimento:','reload','charAt','Erro\x20ao\x20processar\x20mensagem\x20do\x20WhatsApp:','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','wbotMessageListener','defineProperty','SimpleObjectCache','@whiskeysockets/baileys','messages','get','../../utils/logger','Error\x20handling\x20message\x20ack.\x20Err:\x20','typebotStatus','conversation',',\x20queueOptionId:\x20','userRating','find','writable','E2E_IDENTITY_CHANGED','607131zqcdBU','exitChatbot','parentId','GetCompanySetting','audioMessage','subject','fromMe','queue-','verifyEditedMessage','\x0a*0*\x20-\x20Voltar\x20ao\x20menu\x20anterior\x0a','log','editedMessage','keepUserAndQueue','../../helpers/Debounce','whatsappId','@sentry/node','disableBot','key','delete','218277fUkCIR','findByPk','isNaN','./GetHandlers','E2E_DEVICE_CHANGED','displayCurrentMenu','forwardQueue','messages.upsert','includes','title','../../models/Ticket','groupMetadata','cacheLayer','Menu\x20principal\x20exibido.','option','messageStubType','37790yvXjyS','call','__importStar','templateMessage','REVOKE','989637XBhCCs','hasOwnProperty','../../helpers/simpleObjectCache','\x0a*Por\x20favor\x20avalie\x20nosso\x20atendimento\x20com\x20uma\x20nota\x20de\x201\x20a\x205*','Opção\x20','set','extendedTextMessage','runExclusive','user','\x20inválida\x20para\x20o\x20menu\x20principal.','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','value','prototype','startsWith','1750036CiRHVI','warn','Erro\x20ao\x20processar\x20avaliação:','./SendWhatsAppMessage','options','queueId','handleMessageIntegration'];a578_0x4467=function(){return _0x82ba2a;};return a578_0x4467();}(function(_0x2e4afb,_0x115551){const _0x542bd2=a578_0x5d4c,_0x58fd98=_0x2e4afb();while(!![]){try{const _0x466bf4=parseInt(_0x542bd2(0x20f))/0x1*(parseInt(_0x542bd2(0x20b))/0x2)+parseInt(_0x542bd2(0x21f))/0x3*(-parseInt(_0x542bd2(0x1fc))/0x4)+-parseInt(_0x542bd2(0x1e9))/0x5*(parseInt(_0x542bd2(0x1a9))/0x6)+-parseInt(_0x542bd2(0x1c6))/0x7+parseInt(_0x542bd2(0x19f))/0x8+parseInt(_0x542bd2(0x1d9))/0x9*(parseInt(_0x542bd2(0x20e))/0xa)+-parseInt(_0x542bd2(0x1ee))/0xb*(parseInt(_0x542bd2(0x141))/0xc);if(_0x466bf4===_0x115551)break;else _0x58fd98['push'](_0x58fd98['shift']());}catch(_0x47462e){_0x58fd98['push'](_0x58fd98['shift']());}}}(a578_0x4467,0x4febe));var __createBinding=this&&this[a578_0x153a17(0x16d)]||(Object[a578_0x153a17(0x187)]?function(_0x1778e5,_0x122f5a,_0x48cd94,_0xe4414d){const _0x5c714a=a578_0x153a17;if(_0xe4414d===undefined)_0xe4414d=_0x48cd94;var _0x2c3e06=Object['getOwnPropertyDescriptor'](_0x122f5a,_0x48cd94);(!_0x2c3e06||(_0x5c714a(0x1bc)in _0x2c3e06?!_0x122f5a[_0x5c714a(0x146)]:_0x2c3e06[_0x5c714a(0x1c4)]||_0x2c3e06['configurable']))&&(_0x2c3e06={'enumerable':!![],'get':function(){return _0x122f5a[_0x48cd94];}}),Object[_0x5c714a(0x1b8)](_0x1778e5,_0xe4414d,_0x2c3e06);}:function(_0x257b20,_0x2a33b2,_0x23154e,_0x36a803){if(_0x36a803===undefined)_0x36a803=_0x23154e;_0x257b20[_0x36a803]=_0x2a33b2[_0x23154e];}),__setModuleDefault=this&&this[a578_0x153a17(0x144)]||(Object[a578_0x153a17(0x187)]?function(_0x2a5646,_0x52e17b){const _0x301a1a=a578_0x153a17;Object[_0x301a1a(0x1b8)](_0x2a5646,_0x301a1a(0x158),{'enumerable':!![],'value':_0x52e17b});}:function(_0x190d0c,_0x539d3a){const _0x5684d6=a578_0x153a17;_0x190d0c[_0x5684d6(0x158)]=_0x539d3a;}),__importStar=this&&this[a578_0x153a17(0x1eb)]||(function(){const _0x132e6a=(function(){let _0x5e7132=!![];return function(_0x5c0fb4,_0x28f5f5){const _0x2e2b8b=_0x5e7132?function(){const _0x369fae=a578_0x5d4c;if(_0x28f5f5){const _0x46c28a=_0x28f5f5[_0x369fae(0x20c)](_0x5c0fb4,arguments);return _0x28f5f5=null,_0x46c28a;}}:function(){};return _0x5e7132=![],_0x2e2b8b;};}()),_0x2fba89=_0x132e6a(this,function(){const _0x56da66=a578_0x5d4c;return _0x2fba89[_0x56da66(0x166)]()[_0x56da66(0x21d)](_0x56da66(0x1b0))[_0x56da66(0x166)]()[_0x56da66(0x182)](_0x2fba89)['search'](_0x56da66(0x1b0));});_0x2fba89();var _0x3b0ace=function(_0x4e9fb3){return _0x3b0ace=Object['getOwnPropertyNames']||function(_0x1b0213){const _0x55af90=a578_0x5d4c;var _0x54c3e9=[];for(var _0xab981f in _0x1b0213)if(Object[_0x55af90(0x1fa)][_0x55af90(0x1ef)][_0x55af90(0x1ea)](_0x1b0213,_0xab981f))_0x54c3e9[_0x54c3e9[_0x55af90(0x1a4)]]=_0xab981f;return _0x54c3e9;},_0x3b0ace(_0x4e9fb3);};return function(_0xd9b28b){const _0x3bd5e7=a578_0x5d4c;if(_0xd9b28b&&_0xd9b28b[_0x3bd5e7(0x146)])return _0xd9b28b;var _0x3a7f0a={};if(_0xd9b28b!=null){for(var _0x3e0b1e=_0x3b0ace(_0xd9b28b),_0x23ec80=0x0;_0x23ec80<_0x3e0b1e[_0x3bd5e7(0x1a4)];_0x23ec80++)if(_0x3e0b1e[_0x23ec80]!==_0x3bd5e7(0x158))__createBinding(_0x3a7f0a,_0xd9b28b,_0x3e0b1e[_0x23ec80]);}return __setModuleDefault(_0x3a7f0a,_0xd9b28b),_0x3a7f0a;};}()),__importDefault=this&&this['__importDefault']||function(_0x2fec5f){const _0x430fe0=a578_0x153a17;return _0x2fec5f&&_0x2fec5f[_0x430fe0(0x146)]?_0x2fec5f:{'default':_0x2fec5f};};Object[a578_0x153a17(0x1b8)](exports,a578_0x153a17(0x146),{'value':!![]}),exports[a578_0x153a17(0x1ae)]=exports[a578_0x153a17(0x1b7)]=exports[a578_0x153a17(0x202)]=exports[a578_0x153a17(0x1de)]=exports[a578_0x153a17(0x157)]=void 0x0,exports[a578_0x153a17(0x172)]=makeid;const path_1=__importDefault(require('path')),Sentry=__importStar(require(a578_0x153a17(0x1d5))),lodash_1=require(a578_0x153a17(0x153)),baileys_1=require(a578_0x153a17(0x1ba)),async_mutex_1=require(a578_0x153a17(0x181)),sequelize_1=require('sequelize'),moment_1=__importDefault(require(a578_0x153a17(0x22b))),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require(a578_0x153a17(0x1e3))),Message_1=__importDefault(require('../../models/Message')),socket_1=require(a578_0x153a17(0x160)),logger_1=require(a578_0x153a17(0x1bd)),FindOrCreateTicketService_1=__importDefault(require('../TicketServices/FindOrCreateTicketService')),ShowWhatsAppService_1=__importDefault(require(a578_0x153a17(0x227))),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),Mustache_1=__importDefault(require(a578_0x153a17(0x18f))),TicketTraking_1=__importDefault(require(a578_0x153a17(0x14c))),UserRating_1=__importDefault(require(a578_0x153a17(0x18b))),SendWhatsAppMessage_1=__importDefault(require(a578_0x153a17(0x1ff))),Queue_1=__importDefault(require(a578_0x153a17(0x16c))),QueueOption_1=__importDefault(require('../../models/QueueOption')),VerifyCurrentSchedule_1=__importDefault(require('../CompanyService/VerifyCurrentSchedule')),User_1=__importDefault(require(a578_0x153a17(0x186))),Setting_1=__importDefault(require(a578_0x153a17(0x149))),cache_1=require('../../libs/cache'),Debounce_1=require(a578_0x153a17(0x1d3)),SendWhatsAppMedia_1=__importDefault(require('./SendWhatsAppMedia')),CheckSettings_1=require(a578_0x153a17(0x20d)),Whatsapp_1=__importDefault(require(a578_0x153a17(0x21b))),simpleObjectCache_1=require(a578_0x153a17(0x1f0)),ShowQueueIntegrationService_1=__importDefault(require(a578_0x153a17(0x1ab))),typebotListener_1=__importDefault(require(a578_0x153a17(0x19d))),VerifyHandlers_1=require('./VerifyHandlers'),GetHandlers_1=require(a578_0x153a17(0x1dc)),wbotMutex=new async_mutex_1[(a578_0x153a17(0x229))](),ackMutex=new async_mutex_1[(a578_0x153a17(0x229))](),groupContactCache=new simpleObjectCache_1[(a578_0x153a17(0x1b9))](0x3e8*0x1e,logger_1[a578_0x153a17(0x1af)]),outOfHoursCache=new simpleObjectCache_1['SimpleObjectCache'](0x3e8*0x3c*0x5,logger_1[a578_0x153a17(0x1af)]);function makeid(_0x2758e7){const _0x579f76=a578_0x153a17;let _0x334afd='';const _0x428816=_0x579f76(0x156),_0x2ccdc0=_0x428816['length'];for(let _0x2243e1=0x0;_0x2243e1<_0x2758e7;_0x2243e1+=0x1){_0x334afd+=_0x428816[_0x579f76(0x1b4)](Math[_0x579f76(0x18c)](Math[_0x579f76(0x17a)]()*_0x2ccdc0));}return _0x334afd;}const isValidMsg=_0x98f97a=>{const _0x42b607=a578_0x153a17;if(_0x98f97a['key'][_0x42b607(0x184)]===_0x42b607(0x180))return![];try{const _0x3024f0=(0x0,GetHandlers_1[_0x42b607(0x213)])(_0x98f97a);if(!_0x3024f0)return![];const _0x40a74d=_0x3024f0===_0x42b607(0x1c0)||_0x3024f0===_0x42b607(0x1d1)||_0x3024f0===_0x42b607(0x1f4)||_0x3024f0===_0x42b607(0x1ca)||_0x3024f0===_0x42b607(0x191)||_0x3024f0===_0x42b607(0x173)||_0x3024f0==='documentMessage'||_0x3024f0===_0x42b607(0x185)||_0x3024f0==='stickerMessage'||_0x3024f0===_0x42b607(0x19c)||_0x3024f0==='buttonsMessage'||_0x3024f0==='messageContextInfo'||_0x3024f0===_0x42b607(0x152)||_0x3024f0==='liveLocationMessage'||_0x3024f0===_0x42b607(0x155)||_0x3024f0==='voiceMessage'||_0x3024f0===_0x42b607(0x1a2)||_0x3024f0==='contactsArrayMessage'||_0x3024f0===_0x42b607(0x15f)||_0x3024f0===_0x42b607(0x224)||_0x3024f0==='protocolMessage'||_0x3024f0===_0x42b607(0x226)||_0x3024f0==='listMessage'||_0x3024f0===_0x42b607(0x1ec)||_0x3024f0===_0x42b607(0x16b)||_0x3024f0==='viewOnceMessageV2';return!_0x40a74d&&(logger_1[_0x42b607(0x1af)][_0x42b607(0x1fd)](_0x42b607(0x167)+_0x3024f0+'\x0a'+JSON['stringify'](_0x98f97a?.[_0x42b607(0x15e)])),Sentry[_0x42b607(0x18e)]('Mensagem',{'BodyMsg':_0x98f97a[_0x42b607(0x15e)],'msg':_0x98f97a,'msgType':_0x3024f0}),Sentry[_0x42b607(0x220)](new Error(_0x42b607(0x1b6)))),!!_0x40a74d;}catch(_0xbfde1b){return Sentry[_0x42b607(0x18e)]('Error\x20isValidMsg',{'msg':_0x98f97a}),Sentry[_0x42b607(0x220)](_0xbfde1b),![];}},handleRating=async(_0x41c52f,_0x25812e,_0x57282d)=>{const _0x3c077c=a578_0x153a17,_0x2da8ec=(0x0,socket_1[_0x3c077c(0x196)])();let _0x12a13d=null;(_0x41c52f?.[_0x3c077c(0x15e)]?.[_0x3c077c(0x1c0)]||_0x41c52f?.[_0x3c077c(0x15e)]?.[_0x3c077c(0x1f4)])&&(_0x12a13d=parseInt(_0x41c52f['message'][_0x3c077c(0x1c0)]||_0x41c52f[_0x3c077c(0x15e)][_0x3c077c(0x1f4)][_0x3c077c(0x170)],0xa)||null);if(!Number[_0x3c077c(0x1db)](_0x12a13d)&&Number[_0x3c077c(0x223)](_0x12a13d)&&!(0x0,lodash_1[_0x3c077c(0x1a0)])(_0x12a13d)){const _0x5dadf2=await(0x0,ShowWhatsAppService_1['default'])(_0x25812e['whatsappId'],_0x25812e[_0x3c077c(0x17b)]);let _0xeb588c=_0x12a13d;_0x12a13d<0x1&&(_0xeb588c=0x1);_0x12a13d>0x5&&(_0xeb588c=0x5);await UserRating_1['default'][_0x3c077c(0x187)]({'ticketId':_0x57282d[_0x3c077c(0x194)],'companyId':_0x57282d[_0x3c077c(0x17b)],'userId':_0x57282d[_0x3c077c(0x17d)],'rate':_0xeb588c});const _0x3f1729=_0x5dadf2[_0x3c077c(0x143)]['trim']()||_0x3c077c(0x209);await(0x0,SendWhatsAppMessage_1[_0x3c077c(0x158)])({'ticket':_0x25812e,'body':_0x3f1729}),await _0x57282d[_0x3c077c(0x22e)]({'finishedAt':(0x0,moment_1['default'])()[_0x3c077c(0x193)](),'rated':!![]});const _0x19102b=await(0x0,CheckSettings_1['GetCompanySetting'])(_0x25812e[_0x3c077c(0x17b)],_0x3c077c(0x1d2),_0x3c077c(0x215))==='enabled';await _0x25812e[_0x3c077c(0x22e)]({'queueId':_0x19102b?_0x25812e[_0x3c077c(0x201)]:null,'chatbot':null,'queueOptionId':null,'userId':_0x19102b?_0x25812e['userId']:null,'status':'closed'}),_0x2da8ec['to'](_0x3c077c(0x14f)+_0x25812e[_0x3c077c(0x17b)]+_0x3c077c(0x175))['to'](_0x3c077c(0x1cd)+_0x25812e['queueId']+_0x3c077c(0x175))[_0x3c077c(0x16a)](_0x3c077c(0x14f)+_0x25812e[_0x3c077c(0x17b)]+_0x3c077c(0x19b),{'action':_0x3c077c(0x1d8),'ticket':_0x25812e,'ticketId':_0x25812e['id']}),_0x2da8ec['to']('company-'+_0x25812e[_0x3c077c(0x17b)]+'-'+_0x25812e[_0x3c077c(0x197)])['to'](_0x3c077c(0x1cd)+_0x25812e['queueId']+'-'+_0x25812e[_0x3c077c(0x197)])['to'](_0x25812e['id'][_0x3c077c(0x166)]())[_0x3c077c(0x16a)](_0x3c077c(0x14f)+_0x25812e[_0x3c077c(0x17b)]+_0x3c077c(0x19b),{'action':'update','ticket':_0x25812e,'ticketId':_0x25812e['id']});}};exports['handleRating']=handleRating;const handleChartbot=async(_0x525fd1,_0x82a739,_0x5012b5,_0x90273e=![])=>{const _0x5dfcad=a578_0x153a17,_0x466db3=_0x82a739[_0x5dfcad(0x1d7)]['id'];if(_0x466db3&&_0x525fd1[_0x5dfcad(0x154)]===_0x466db3){console[_0x5dfcad(0x1d0)](_0x5dfcad(0x17f)+_0x466db3+_0x5dfcad(0x14a)+_0x525fd1['id']+'.\x20Ignorando\x20em\x20handleChartbot.');return;}await _0x525fd1[_0x5dfcad(0x22e)]({'lastProcessedMessageId':_0x466db3});const _0x2b5d27=(0x0,GetHandlers_1['getBodyMessage'])(_0x82a739);console[_0x5dfcad(0x1d0)](_0x5dfcad(0x15d)+_0x2b5d27+_0x5dfcad(0x22f)+_0x525fd1['id']+',\x20queueOptionId:\x20'+_0x525fd1['queueOptionId']);const _0x5b055d=await Queue_1[_0x5dfcad(0x158)][_0x5dfcad(0x1da)](_0x525fd1['queueId'],{'include':[{'model':QueueOption_1['default'],'as':_0x5dfcad(0x200),'where':{'parentId':null},'order':[['option',_0x5dfcad(0x1aa)]],'required':![]}]}),_0x5466d6=await Whatsapp_1[_0x5dfcad(0x158)][_0x5dfcad(0x1da)](_0x525fd1[_0x5dfcad(0x1d4)]);if(!_0x5466d6){console[_0x5dfcad(0x203)](_0x5dfcad(0x199));return;}if(_0x2b5d27==='#'){await _0x525fd1[_0x5dfcad(0x22e)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await(0x0,VerifyHandlers_1[_0x5dfcad(0x165)])(_0x5012b5,_0x82a739,_0x525fd1,_0x525fd1[_0x5dfcad(0x15b)]);return;}if(!(0x0,lodash_1[_0x5dfcad(0x22d)])(_0x5b055d)&&!(0x0,lodash_1[_0x5dfcad(0x22d)])(_0x525fd1['queueOptionId'])&&_0x2b5d27==='0'){const _0x33bdbe=await QueueOption_1['default'][_0x5dfcad(0x1da)](_0x525fd1['queueOptionId']);_0x33bdbe?.[_0x5dfcad(0x1c8)]?await _0x525fd1['update']({'queueOptionId':_0x33bdbe[_0x5dfcad(0x1c8)],'amountUsedBotQueues':0x0}):await _0x525fd1[_0x5dfcad(0x22e)]({'queueOptionId':null,'amountUsedBotQueues':0x0});await _0x525fd1[_0x5dfcad(0x1b3)](),await(0x0,exports['displayCurrentMenu'])(_0x525fd1,_0x5012b5);return;}if(!_0x525fd1[_0x5dfcad(0x217)]&&_0x525fd1[_0x5dfcad(0x179)]>=_0x5466d6[_0x5dfcad(0x1ac)])return;if(!(0x0,lodash_1['isNil'])(_0x5b055d)&&(0x0,lodash_1['isNil'])(_0x525fd1[_0x5dfcad(0x1a8)])&&!_0x90273e){if(_0x2b5d27&&_0x5b055d[_0x5dfcad(0x200)]?.['length']>0x0){const _0x37e558=_0x5b055d['options']['find'](_0x332739=>_0x332739[_0x5dfcad(0x1e7)]===_0x2b5d27);if(_0x37e558){console['log'](_0x5dfcad(0x1f2)+_0x2b5d27+_0x5dfcad(0x16f)+_0x37e558['id']),await _0x525fd1['update']({'queueOptionId':_0x37e558['id'],'amountUsedBotQueues':0x0}),await _0x525fd1[_0x5dfcad(0x1b3)](),await(0x0,exports[_0x5dfcad(0x1de)])(_0x525fd1,_0x5012b5);return;}else console['log'](_0x5dfcad(0x1f2)+_0x2b5d27+_0x5dfcad(0x1f7));}}else{if(!(0x0,lodash_1[_0x5dfcad(0x22d)])(_0x5b055d)&&!(0x0,lodash_1[_0x5dfcad(0x22d)])(_0x525fd1[_0x5dfcad(0x1a8)])){const _0x4415ff=await QueueOption_1[_0x5dfcad(0x158)][_0x5dfcad(0x22a)]({'where':{'parentId':_0x525fd1[_0x5dfcad(0x1a8)]},'order':[[_0x5dfcad(0x1e7),_0x5dfcad(0x1aa)]]});if(_0x2b5d27&&_0x4415ff[_0x5dfcad(0x1a4)]>0x0){const _0x8c1382=_0x4415ff[_0x5dfcad(0x1c3)](_0x2da941=>_0x2da941[_0x5dfcad(0x1e7)]===_0x2b5d27);if(_0x8c1382){console[_0x5dfcad(0x1d0)](_0x5dfcad(0x1f2)+_0x2b5d27+'\x20selecionada\x20no\x20submenu.\x20ID:\x20'+_0x8c1382['id']),await _0x525fd1['update']({'queueOptionId':_0x8c1382['id'],'amountUsedBotQueues':0x0}),await _0x525fd1['reload'](),await(0x0,exports[_0x5dfcad(0x1de)])(_0x525fd1,_0x5012b5);return;}else console[_0x5dfcad(0x1d0)](_0x5dfcad(0x1f2)+_0x2b5d27+_0x5dfcad(0x192));}}}if(_0x2b5d27&&_0x2b5d27!=='0'&&_0x2b5d27!=='#'){console[_0x5dfcad(0x1d0)]('Resposta\x20inválida:\x20'+_0x2b5d27);if(_0x5466d6[_0x5dfcad(0x1ac)]&&_0x5466d6['maxUseBotQueues']!==0x0&&_0x525fd1[_0x5dfcad(0x179)]>=_0x5466d6['maxUseBotQueues']){await _0x525fd1[_0x5dfcad(0x22e)]({'chatbot':![],'amountUsedBotQueues':_0x5466d6['maxUseBotQueues']});_0x5466d6['transferMessage']&&await(0x0,SendWhatsAppMessage_1[_0x5dfcad(0x158)])({'ticket':_0x525fd1,'body':_0x5466d6['transferMessage']});return;}await _0x525fd1[_0x5dfcad(0x22e)]({'amountUsedBotQueues':_0x525fd1[_0x5dfcad(0x179)]+0x1}),await _0x525fd1[_0x5dfcad(0x1b3)]();}!_0x90273e&&await(0x0,exports[_0x5dfcad(0x1de)])(_0x525fd1,_0x5012b5);},displayCurrentMenu=async(_0x36ab8b,_0x417b9a)=>{const _0x5aaa00=a578_0x153a17;console[_0x5aaa00(0x1d0)](_0x5aaa00(0x177)+_0x36ab8b['id']+_0x5aaa00(0x1c1)+_0x36ab8b['queueOptionId']);const _0x357087=await Queue_1[_0x5aaa00(0x158)][_0x5aaa00(0x1da)](_0x36ab8b[_0x5aaa00(0x201)]);if(!_0x357087)return;if((0x0,lodash_1[_0x5aaa00(0x22d)])(_0x36ab8b[_0x5aaa00(0x1a8)])){const _0x3eb76c=await QueueOption_1[_0x5aaa00(0x158)]['findAll']({'where':{'queueId':_0x36ab8b['queueId'],'parentId':null},'order':[['option',_0x5aaa00(0x1aa)]]});if(_0x3eb76c['length']>0x0){let _0x2910c5=_0x357087[_0x5aaa00(0x205)]?_0x357087[_0x5aaa00(0x205)]+'\x0a\x0a':'';_0x3eb76c[_0x5aaa00(0x222)](_0x28f7c0=>{const _0x828aea=_0x5aaa00;_0x2910c5+='*'+_0x28f7c0[_0x828aea(0x1e7)]+_0x828aea(0x176)+_0x28f7c0[_0x828aea(0x1e2)]+'\x0a';}),_0x2910c5+=_0x5aaa00(0x1a3),await(0x0,SendWhatsAppMessage_1[_0x5aaa00(0x158)])({'ticket':_0x36ab8b,'body':_0x2910c5}),console[_0x5aaa00(0x1d0)](_0x5aaa00(0x1e6));}return;}const _0x51687f=await QueueOption_1['default']['findByPk'](_0x36ab8b[_0x5aaa00(0x1a8)],{'include':[{'model':Queue_1[_0x5aaa00(0x158)],'as':'forwardQueue'}]});if(!_0x51687f){console[_0x5aaa00(0x1d0)](_0x5aaa00(0x1f2)+_0x36ab8b[_0x5aaa00(0x1a8)]+_0x5aaa00(0x16e));return;}const _0x126313=await QueueOption_1[_0x5aaa00(0x158)]['findAll']({'where':{'parentId':_0x36ab8b[_0x5aaa00(0x1a8)]},'order':[[_0x5aaa00(0x1e7),'ASC']]});if(_0x126313['length']===0x0){console[_0x5aaa00(0x1d0)](_0x5aaa00(0x221));let _0x17eabe=(0x0,Mustache_1[_0x5aaa00(0x158)])('‎'+_0x51687f[_0x5aaa00(0x15e)],_0x36ab8b);if(_0x51687f?.[_0x5aaa00(0x21a)]){const _0x5e9b85=path_1[_0x5aaa00(0x158)]['resolve'](_0x5aaa00(0x1a1),_0x51687f[_0x5aaa00(0x21a)]);_0x5e9b85?await(0x0,SendWhatsAppMedia_1[_0x5aaa00(0x158)])({'media':_0x5e9b85,'ticket':_0x36ab8b,'body':_0x17eabe}):await(0x0,SendWhatsAppMessage_1[_0x5aaa00(0x158)])({'ticket':_0x36ab8b,'body':_0x17eabe});}else await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x36ab8b,'body':_0x17eabe});if(_0x51687f[_0x5aaa00(0x1c7)])await _0x36ab8b['update']({'queueOptionId':null,'chatbot':![],'amountUsedBotQueues':0x0});else{if(_0x51687f[_0x5aaa00(0x189)]){await _0x36ab8b[_0x5aaa00(0x22e)]({'queueOptionId':null,'chatbot':![],'queueId':_0x51687f['forwardQueueId'],'amountUsedBotQueues':0x0}),await _0x36ab8b[_0x5aaa00(0x1b3)]();if(_0x51687f[_0x5aaa00(0x1df)]){const _0x1585a9=await QueueOption_1[_0x5aaa00(0x158)][_0x5aaa00(0x21c)]({'where':{'queueId':_0x51687f[_0x5aaa00(0x189)],'parentId':null}});await _0x36ab8b['update']({'chatbot':!!_0x1585a9}),_0x51687f[_0x5aaa00(0x1df)][_0x5aaa00(0x205)]&&await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x36ab8b,'body':_0x51687f[_0x5aaa00(0x1df)][_0x5aaa00(0x205)]}),_0x1585a9&&await(0x0,exports[_0x5aaa00(0x1de)])(_0x36ab8b,_0x417b9a);}}else await _0x36ab8b[_0x5aaa00(0x22e)]({'queueOptionId':null,'chatbot':![]});}return;}console[_0x5aaa00(0x1d0)](_0x5aaa00(0x14b)+_0x126313['length']+_0x5aaa00(0x169));let _0x426b97=_0x51687f[_0x5aaa00(0x15e)]?_0x51687f['message']+'\x0a\x0a':'';_0x126313[_0x5aaa00(0x222)](_0x2b3486=>{const _0x3221a7=_0x5aaa00;_0x426b97+='*'+_0x2b3486[_0x3221a7(0x1e7)]+'*\x20-\x20'+_0x2b3486[_0x3221a7(0x1e2)]+'\x0a';}),_0x426b97+=_0x5aaa00(0x1cf),_0x426b97+=_0x5aaa00(0x164);if(_0x51687f?.[_0x5aaa00(0x21a)]){const _0x51bd0f=path_1[_0x5aaa00(0x158)]['resolve'](_0x5aaa00(0x1a1),_0x51687f[_0x5aaa00(0x21a)]);_0x51bd0f?await(0x0,SendWhatsAppMedia_1[_0x5aaa00(0x158)])({'media':_0x51bd0f,'ticket':_0x36ab8b,'body':_0x426b97}):await(0x0,SendWhatsAppMessage_1[_0x5aaa00(0x158)])({'ticket':_0x36ab8b,'body':_0x426b97});}else await(0x0,SendWhatsAppMessage_1[_0x5aaa00(0x158)])({'ticket':_0x36ab8b,'body':_0x426b97});};exports[a578_0x153a17(0x1de)]=displayCurrentMenu;function a578_0x5d4c(_0x18dac1,_0x1d7358){const _0xd920ef=a578_0x4467();return a578_0x5d4c=function(_0x321dd9,_0x18ab7d){_0x321dd9=_0x321dd9-0x141;let _0x4467ab=_0xd920ef[_0x321dd9];return _0x4467ab;},a578_0x5d4c(_0x18dac1,_0x1d7358);}const handleMessageIntegration=async(_0x4b2b47,_0x140c05,_0x1e05dc,_0x306b5c)=>{const _0x3e7433=a578_0x153a17;if(process['env'][_0x3e7433(0x1a6)]){if(_0x306b5c[_0x3e7433(0x15b)][_0x3e7433(0x211)]!=process[_0x3e7433(0x19a)][_0x3e7433(0x1a6)]){console[_0x3e7433(0x1d0)]('chatbot\x20desativado!');return;}}console[_0x3e7433(0x1d0)]('typebotStatus:\x20',_0x306b5c['typebotStatus']),_0x1e05dc[_0x3e7433(0x15c)]===_0x3e7433(0x195)&&!_0x306b5c[_0x3e7433(0x1bf)]?(await(0x0,typebotListener_1[_0x3e7433(0x158)])({'ticket':_0x306b5c,'msg':_0x4b2b47,'wbot':_0x140c05,'typebot':_0x1e05dc}),!_0x306b5c[_0x3e7433(0x22c)]&&(await _0x306b5c['update']({'useIntegration':!![],'integrationId':_0x1e05dc['id']}),console[_0x3e7433(0x1d0)]('Atualizando\x20estado\x20de\x20integração\x20do\x20ticket\x20#'+_0x306b5c['id']))):console[_0x3e7433(0x1d0)](_0x3e7433(0x212));};exports['handleMessageIntegration']=handleMessageIntegration;const handleMessage=async(_0x422455,_0x50ba5e,_0x143eb4)=>{const _0x1e08ca=a578_0x153a17;if(!isValidMsg(_0x422455))return;_0x422455[_0x1e08ca(0x15e)]?.[_0x1e08ca(0x224)]&&(_0x422455[_0x1e08ca(0x15e)]=_0x422455[_0x1e08ca(0x15e)][_0x1e08ca(0x224)][_0x1e08ca(0x15e)]);try{let _0x14b741,_0x3de6ad;const _0xdee9a0=_0x422455[_0x1e08ca(0x1d7)][_0x1e08ca(0x184)]?.[_0x1e08ca(0x204)](_0x1e08ca(0x178));if(_0xdee9a0){const _0x22beaf=await Setting_1[_0x1e08ca(0x158)][_0x1e08ca(0x21c)]({'where':{'companyId':_0x143eb4,'key':_0x1e08ca(0x225)}});if(!_0x22beaf||_0x22beaf[_0x1e08ca(0x1f9)]===_0x1e08ca(0x215))return;}const _0x1c9c99=(0x0,GetHandlers_1['getBodyMessage'])(_0x422455),_0x189586=(0x0,GetHandlers_1['getTypeMessage'])(_0x422455),_0x336796=_0x189586!==_0x1e08ca(0x1ec)&&(0x0,GetHandlers_1['getUnpackedMessage'])(_0x422455),_0x2e4ddb=_0x336796&&(0x0,GetHandlers_1[_0x1e08ca(0x18d)])(_0x336796);if(_0x422455[_0x1e08ca(0x1d7)][_0x1e08ca(0x1cc)]){if(_0x1c9c99?.[_0x1e08ca(0x1fb)]('‎'))return;if(!_0x2e4ddb&&_0x189586!==_0x1e08ca(0x1c0)&&_0x189586!==_0x1e08ca(0x1f4)&&_0x189586!==_0x1e08ca(0x18a))return;_0x14b741=await(0x0,GetHandlers_1[_0x1e08ca(0x198)])(_0x422455,_0x50ba5e);}else _0x14b741=await(0x0,GetHandlers_1[_0x1e08ca(0x198)])(_0x422455,_0x50ba5e);_0xdee9a0&&(_0x3de6ad=await wbotMutex[_0x1e08ca(0x1f5)](async()=>{const _0x33ab90=_0x1e08ca;let _0x56da8c=groupContactCache['get'](_0x422455['key'][_0x33ab90(0x184)]);if(!_0x56da8c){const _0x6d8b53=await _0x50ba5e[_0x33ab90(0x1e4)](_0x422455['key']['remoteJid']),_0x1c5913={'id':_0x6d8b53['id'],'name':_0x6d8b53[_0x33ab90(0x1cb)]};_0x56da8c=await(0x0,VerifyHandlers_1[_0x33ab90(0x1ad)])(_0x1c5913,_0x50ba5e,_0x143eb4),groupContactCache[_0x33ab90(0x1f3)](_0x422455[_0x33ab90(0x1d7)]['remoteJid'],_0x56da8c);}return _0x56da8c;}));const _0x3fdb31=await(0x0,ShowWhatsAppService_1['default'])(_0x50ba5e['id'],_0x143eb4),_0x121798=await(0x0,VerifyHandlers_1[_0x1e08ca(0x1ad)])(_0x14b741,_0x50ba5e,_0x143eb4);let _0x4dc439=0x0;if(_0x422455[_0x1e08ca(0x1d7)][_0x1e08ca(0x1cc)])await cache_1[_0x1e08ca(0x1e5)]['set'](_0x1e08ca(0x183)+_0x121798['id']+_0x1e08ca(0x148),'0');else{const _0x27e674=await cache_1[_0x1e08ca(0x1e5)][_0x1e08ca(0x1bc)](_0x1e08ca(0x183)+_0x121798['id']+_0x1e08ca(0x148));_0x4dc439=+_0x27e674+0x1,await cache_1['cacheLayer'][_0x1e08ca(0x1f3)](_0x1e08ca(0x183)+_0x121798['id']+_0x1e08ca(0x148),''+_0x4dc439);}const _0x4532d2=await Message_1[_0x1e08ca(0x158)]['findOne']({'where':{'contactId':_0x121798['id'],'companyId':_0x143eb4,'$ticket.whatsappId$':_0x3fdb31['id']},'include':[_0x1e08ca(0x190)],'order':[['createdAt',_0x1e08ca(0x145)]]}),_0x438d9a=_0x3fdb31[_0x1e08ca(0x143)][_0x1e08ca(0x188)]()||_0x1e08ca(0x209);if(_0x4532d2&&_0x4dc439===0x0&&_0x438d9a&&(0x0,Mustache_1[_0x1e08ca(0x158)])(_0x438d9a,_0x4532d2[_0x1e08ca(0x190)])[_0x1e08ca(0x188)]()[_0x1e08ca(0x216)]()===_0x4532d2?.['body'][_0x1e08ca(0x188)]()[_0x1e08ca(0x216)]())return;if(!_0x422455[_0x1e08ca(0x1d7)][_0x1e08ca(0x1cc)]&&!_0x121798[_0x1e08ca(0x21e)]){const _0x3e2d1a=await(0x0,CheckSettings_1[_0x1e08ca(0x1c9)])(_0x143eb4,_0x1e08ca(0x1c2),'')===_0x1e08ca(0x215);if(_0x3e2d1a){const _0x415708=await TicketTraking_1[_0x1e08ca(0x158)][_0x1e08ca(0x21c)]({'where':{'whatsappId':_0x3fdb31['id'],'rated':![],'ratingAt':{[sequelize_1['Op'][_0x1e08ca(0x17e)]]:null},'finishedAt':null},'include':[{'model':Ticket_1[_0x1e08ca(0x158)],'where':{'status':_0x1e08ca(0x210),'contactId':_0x121798['id']},'include':[{'model':Contact_1[_0x1e08ca(0x158)]},{'model':User_1[_0x1e08ca(0x158)]},{'model':Queue_1['default']}]}]});if(_0x415708)try{const _0x38f9a0=Number(_0x1c9c99);if(!Number[_0x1e08ca(0x207)](_0x38f9a0)){const _0xf9a592=(0x0,Debounce_1[_0x1e08ca(0x1b1)])(async()=>{const _0x46a1e6=_0x1e08ca;await(0x0,SendWhatsAppMessage_1[_0x46a1e6(0x158)])({'ticket':_0x31df4a,'body':_0x46a1e6(0x1f1)});},0x3e8,_0x415708[_0x1e08ca(0x190)]['id']);_0xf9a592();return;}if((0x0,VerifyHandlers_1[_0x1e08ca(0x161)])(_0x415708)){(0x0,exports[_0x1e08ca(0x157)])(_0x422455,_0x415708[_0x1e08ca(0x190)],_0x415708);return;}}catch(_0x2aee71){Sentry[_0x1e08ca(0x220)](_0x2aee71),console[_0x1e08ca(0x1d0)](_0x1e08ca(0x1fe),_0x2aee71);}}}const {ticket:_0x31df4a,justCreated:_0x5bf8ea}=await(0x0,FindOrCreateTicketService_1[_0x1e08ca(0x158)])(_0x121798,_0x50ba5e['id'],_0x4dc439,_0x143eb4,_0x3de6ad);if(_0x2e4ddb||_0x422455?.['message']?.[_0x1e08ca(0x1f4)]?.['thumbnailDirectPath'])await(0x0,VerifyHandlers_1[_0x1e08ca(0x162)])(_0x422455,_0x31df4a,_0x121798,_0x50ba5e,_0x2e4ddb);else{if(_0x422455[_0x1e08ca(0x15e)]?.[_0x1e08ca(0x1d1)]?.[_0x1e08ca(0x15e)]?.[_0x1e08ca(0x174)]?.['editedMessage'])await(0x0,VerifyHandlers_1[_0x1e08ca(0x1ce)])(_0x422455['message'][_0x1e08ca(0x1d1)]['message'][_0x1e08ca(0x174)][_0x1e08ca(0x1d1)],_0x31df4a,_0x422455[_0x1e08ca(0x15e)][_0x1e08ca(0x1d1)][_0x1e08ca(0x15e)][_0x1e08ca(0x174)][_0x1e08ca(0x1d7)]['id']);else{if(_0x422455[_0x1e08ca(0x15e)]?.['protocolMessage']?.[_0x1e08ca(0x1d1)])await(0x0,VerifyHandlers_1[_0x1e08ca(0x1ce)])(_0x422455[_0x1e08ca(0x15e)]['protocolMessage']['editedMessage'],_0x31df4a,_0x422455[_0x1e08ca(0x15e)]['protocolMessage'][_0x1e08ca(0x1d7)]['id']);else _0x422455[_0x1e08ca(0x15e)]?.['protocolMessage']?.['type']===0x0?await(0x0,VerifyHandlers_1[_0x1e08ca(0x208)])(_0x422455[_0x1e08ca(0x15e)][_0x1e08ca(0x174)],_0x31df4a):await(0x0,VerifyHandlers_1['verifyMessage'])(_0x422455,_0x31df4a,_0x121798);}}if(_0x31df4a[_0x1e08ca(0x22c)]===!![]&&_0x31df4a[_0x1e08ca(0x1a7)]){const _0x17813e=await(0x0,ShowQueueIntegrationService_1[_0x1e08ca(0x158)])(_0x31df4a['integrationId'],_0x143eb4);if(_0x17813e){await(0x0,exports[_0x1e08ca(0x202)])(_0x422455,_0x50ba5e,_0x17813e,_0x31df4a);return;}else await _0x31df4a[_0x1e08ca(0x22e)]({'useIntegration':![],'integrationId':null,'typebotSessionId':null});}if(_0x1c9c99==='#'&&!_0xdee9a0){await _0x31df4a[_0x1e08ca(0x22e)]({'queueOptionId':null,'chatbot':![],'queueId':null}),await(0x0,VerifyHandlers_1[_0x1e08ca(0x165)])(_0x50ba5e,_0x422455,_0x31df4a,_0x31df4a[_0x1e08ca(0x15b)]);return;}if(_0xdee9a0||_0x121798[_0x1e08ca(0x1d6)])return;const _0x80e9f5=await(0x0,CheckSettings_1['GetCompanySetting'])(_0x143eb4,_0x1e08ca(0x171),'disabled');try{if(!_0x422455[_0x1e08ca(0x1d7)][_0x1e08ca(0x1cc)]&&_0x80e9f5){const _0x8956d=await(0x0,CheckSettings_1[_0x1e08ca(0x1c9)])(_0x143eb4,_0x1e08ca(0x14e),_0x1e08ca(0x20a));let _0x255eca=null;const _0x4020f5=_0x31df4a[_0x1e08ca(0x197)]==='open'&&_0x31df4a[_0x1e08ca(0x1f6)]['socketSessions'][_0x1e08ca(0x1a4)]>0x0,_0x353a6a=!_0x4020f5&&outOfHoursCache['get'](_0x1e08ca(0x14d)+_0x31df4a['id']);if(_0x80e9f5==='company'&&!_0x4020f5){_0x255eca=await(0x0,VerifyCurrentSchedule_1['default'])(_0x143eb4);if(!(0x0,lodash_1[_0x1e08ca(0x22d)])(_0x255eca)&&(!_0x255eca||_0x255eca[_0x1e08ca(0x142)]===![])){if(!_0x353a6a){outOfHoursCache[_0x1e08ca(0x1f3)]('ticket-'+_0x31df4a['id'],!![]);const _0x31a53e=_0x3fdb31['outOfHoursMessage'][_0x1e08ca(0x188)]()||'Estamos\x20fora\x20do\x20horário\x20de\x20expediente';await(0x0,SendWhatsAppMessage_1[_0x1e08ca(0x158)])({'ticket':_0x31df4a,'body':_0x31a53e});}_0x31df4a[_0x1e08ca(0x197)]!==_0x1e08ca(0x210)&&await(0x0,UpdateTicketService_1[_0x1e08ca(0x158)])({'ticketData':{'chatbot':![],'status':_0x8956d},'ticketId':_0x31df4a['id'],'companyId':_0x31df4a[_0x1e08ca(0x17b)]});return;}}if(_0x80e9f5===_0x1e08ca(0x168)&&_0x31df4a['queueId']!==null&&!_0x4020f5){_0x255eca=await(0x0,VerifyCurrentSchedule_1[_0x1e08ca(0x158)])(_0x143eb4,_0x31df4a[_0x1e08ca(0x201)]);const _0x22897f=await Queue_1['default'][_0x1e08ca(0x1da)](_0x31df4a[_0x1e08ca(0x201)]);if(!(0x0,lodash_1[_0x1e08ca(0x22d)])(_0x255eca)&&(!_0x255eca||_0x255eca[_0x1e08ca(0x142)]===![])){if(!_0x353a6a){outOfHoursCache[_0x1e08ca(0x1f3)]('ticket-'+_0x31df4a['id'],!![]);const _0x4b51ae=_0x22897f[_0x1e08ca(0x15a)]?.['trim']()||_0x1e08ca(0x1a5);await(0x0,SendWhatsAppMessage_1[_0x1e08ca(0x158)])({'ticket':_0x31df4a,'body':_0x4b51ae});}_0x31df4a[_0x1e08ca(0x197)]!==_0x1e08ca(0x210)&&await(0x0,UpdateTicketService_1[_0x1e08ca(0x158)])({'ticketData':{'chatbot':![],'status':_0x8956d},'ticketId':_0x31df4a['id'],'companyId':_0x31df4a[_0x1e08ca(0x17b)]});return;}}}}catch(_0x4efc78){Sentry['captureException'](_0x4efc78),console['log'](_0x1e08ca(0x1b2),_0x4efc78);}!_0x31df4a[_0x1e08ca(0x168)]&&!_0xdee9a0&&!_0x422455[_0x1e08ca(0x1d7)][_0x1e08ca(0x1cc)]&&!_0x31df4a[_0x1e08ca(0x17d)]&&_0x3fdb31['queues'][_0x1e08ca(0x1a4)]>=0x1&&await(0x0,VerifyHandlers_1['verifyQueue'])(_0x50ba5e,_0x422455,_0x31df4a,_0x31df4a['contact']);const _0x27f736=_0x31df4a['queue']===null;await _0x31df4a[_0x1e08ca(0x1b3)]();if(_0x5bf8ea&&!_0x3fdb31?.[_0x1e08ca(0x219)]?.[_0x1e08ca(0x1a4)]&&!_0x31df4a[_0x1e08ca(0x17d)]&&!_0xdee9a0&&!_0x422455['key'][_0x1e08ca(0x1cc)]){const _0x58553d=await Message_1[_0x1e08ca(0x158)][_0x1e08ca(0x21c)]({'where':{'ticketId':_0x31df4a['id'],'fromMe':!![]},'order':[[_0x1e08ca(0x228),'DESC']]});if(_0x58553d&&_0x58553d[_0x1e08ca(0x19e)]['includes'](_0x3fdb31['greetingMessage']))return;if(_0x3fdb31[_0x1e08ca(0x205)]){const _0x4e2f48=(0x0,Debounce_1[_0x1e08ca(0x1b1)])(async()=>{const _0x3782cf=_0x1e08ca;await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x31df4a,'body':''+_0x3fdb31[_0x3782cf(0x205)]});},0x3e8,_0x31df4a['id']);_0x4e2f48();return;}}if(!_0x31df4a[_0x1e08ca(0x217)]&&_0x31df4a[_0x1e08ca(0x179)]>=_0x3fdb31?.[_0x1e08ca(0x1ac)])return;if(_0x31df4a[_0x1e08ca(0x217)]&&!_0x422455['key'][_0x1e08ca(0x1cc)]){await handleChartbot(_0x31df4a,_0x422455,_0x50ba5e);return;}_0x3fdb31[_0x1e08ca(0x219)][_0x1e08ca(0x1a4)]===0x1&&_0x31df4a[_0x1e08ca(0x168)]&&(_0x31df4a[_0x1e08ca(0x217)]&&!_0x422455[_0x1e08ca(0x1d7)]['fromMe']&&!_0x31df4a['useIntegration']&&await handleChartbot(_0x31df4a,_0x422455,_0x50ba5e,_0x27f736)),_0x3fdb31['queues'][_0x1e08ca(0x1a4)]>0x1&&_0x31df4a[_0x1e08ca(0x168)]&&(_0x31df4a[_0x1e08ca(0x217)]&&!_0x422455['key'][_0x1e08ca(0x1cc)]&&!_0x31df4a[_0x1e08ca(0x22c)]&&await handleChartbot(_0x31df4a,_0x422455,_0x50ba5e,_0x27f736));}catch(_0x122c12){console[_0x1e08ca(0x1d0)](_0x1e08ca(0x1b5),_0x122c12),Sentry[_0x1e08ca(0x220)](_0x122c12),logger_1[_0x1e08ca(0x1af)][_0x1e08ca(0x203)](_0x1e08ca(0x1f8)+_0x122c12);}};exports['handleMessage']=handleMessage;const handleMsgAck=async(_0x186b65,_0x5dcf43)=>{const _0x54c3b9=a578_0x153a17;if(!_0x5dcf43)return;const _0x2ca9f1=(0x0,socket_1[_0x54c3b9(0x196)])();try{const _0xb0643c=await Message_1[_0x54c3b9(0x158)][_0x54c3b9(0x1da)](_0x186b65[_0x54c3b9(0x1d7)]['id'],{'include':[_0x54c3b9(0x15b),{'model':Message_1['default'],'as':_0x54c3b9(0x17c),'include':[_0x54c3b9(0x15b)]}]});if(!_0xb0643c||_0x5dcf43<=_0xb0643c['ack'])return;await _0xb0643c['update']({'ack':_0x5dcf43}),_0x2ca9f1['to'](_0xb0643c[_0x54c3b9(0x194)][_0x54c3b9(0x166)]())[_0x54c3b9(0x16a)](_0x54c3b9(0x14f)+_0xb0643c['companyId']+_0x54c3b9(0x150),{'action':'update','message':_0xb0643c});}catch(_0x4cfb4e){Sentry[_0x54c3b9(0x220)](_0x4cfb4e),logger_1['logger'][_0x54c3b9(0x203)](_0x54c3b9(0x1be)+_0x4cfb4e);}},filterMessages=_0x44b293=>{const _0x2b8aea=a578_0x153a17;if(_0x44b293['message']?.[_0x2b8aea(0x174)]?.[_0x2b8aea(0x1d1)])return!![];if(_0x44b293[_0x2b8aea(0x15e)]?.[_0x2b8aea(0x174)]?.['type']===0x0)return!![];if(_0x44b293[_0x2b8aea(0x15e)]?.[_0x2b8aea(0x174)])return![];if([baileys_1[_0x2b8aea(0x206)][_0x2b8aea(0x1ed)],baileys_1[_0x2b8aea(0x206)][_0x2b8aea(0x1dd)],baileys_1[_0x2b8aea(0x206)][_0x2b8aea(0x1c5)],baileys_1[_0x2b8aea(0x206)][_0x2b8aea(0x159)]][_0x2b8aea(0x1e1)](_0x44b293[_0x2b8aea(0x1e8)]))return![];return!![];},wbotMessageListener=async(_0x915b45,_0x1cb1c1)=>{const _0x53a991=a578_0x153a17;try{_0x915b45['ev']['on'](_0x53a991(0x1e0),async _0x5dc78a=>{const _0x3fd9e1=_0x53a991,_0x6984c9=_0x5dc78a[_0x3fd9e1(0x1bb)][_0x3fd9e1(0x163)](filterMessages)['map'](_0x120fd0=>_0x120fd0);if(!_0x6984c9)return;_0x6984c9[_0x3fd9e1(0x222)](async _0x2de544=>{const _0x597189=_0x3fd9e1,_0x262c6c=await Message_1[_0x597189(0x158)]['count']({'where':{'id':_0x2de544[_0x597189(0x1d7)]['id'],'companyId':_0x1cb1c1}});if(!_0x262c6c){if(await(0x0,VerifyHandlers_1[_0x597189(0x218)])(_0x2de544,_0x1cb1c1))return;await handleMessage(_0x2de544,_0x915b45,_0x1cb1c1);}});}),_0x915b45['ev']['on'](_0x53a991(0x214),_0x26cb90=>{const _0x21e9b4=_0x53a991;if(_0x26cb90[_0x21e9b4(0x1a4)]===0x0)return;_0x26cb90[_0x21e9b4(0x222)](async _0x4f7733=>{const _0x5ea965=_0x21e9b4;_0x915b45[_0x5ea965(0x147)]([_0x4f7733[_0x5ea965(0x1d7)]]),await ackMutex[_0x5ea965(0x1f5)](async()=>{const _0x3fe66e=_0x5ea965;handleMsgAck(_0x4f7733,_0x4f7733[_0x3fe66e(0x22e)]['status']);});});});}catch(_0x5cf5c5){Sentry['captureException'](_0x5cf5c5),logger_1[_0x53a991(0x1af)]['error'](_0x53a991(0x151)+_0x5cf5c5);}};exports['wbotMessageListener']=wbotMessageListener;