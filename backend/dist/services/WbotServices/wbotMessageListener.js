'use strict';const a582_0x3f5cda=a582_0x1d8f;(function(_0x5a7870,_0x35edbd){const _0x3c8489=a582_0x1d8f,_0x337724=_0x5a7870();while(!![]){try{const _0x563975=parseInt(_0x3c8489(0x126))/0x1+parseInt(_0x3c8489(0x1da))/0x2+-parseInt(_0x3c8489(0x16a))/0x3*(-parseInt(_0x3c8489(0x16f))/0x4)+parseInt(_0x3c8489(0x146))/0x5+-parseInt(_0x3c8489(0x1c4))/0x6+parseInt(_0x3c8489(0x130))/0x7*(-parseInt(_0x3c8489(0xf1))/0x8)+-parseInt(_0x3c8489(0x145))/0x9*(parseInt(_0x3c8489(0x136))/0xa);if(_0x563975===_0x35edbd)break;else _0x337724['push'](_0x337724['shift']());}catch(_0x68a546){_0x337724['push'](_0x337724['shift']());}}}(a582_0x3349,0xc6a2c));var __createBinding=this&&this[a582_0x3f5cda(0x196)]||(Object[a582_0x3f5cda(0x1d5)]?function(_0x1fe25c,_0xa28855,_0x135618,_0x22d598){const _0x74bccb=a582_0x3f5cda;if(_0x22d598===undefined)_0x22d598=_0x135618;var _0x54f986=Object['getOwnPropertyDescriptor'](_0xa28855,_0x135618);(!_0x54f986||(_0x74bccb(0x199)in _0x54f986?!_0xa28855[_0x74bccb(0x168)]:_0x54f986[_0x74bccb(0x179)]||_0x54f986[_0x74bccb(0x1bc)]))&&(_0x54f986={'enumerable':!![],'get':function(){return _0xa28855[_0x135618];}}),Object[_0x74bccb(0x1d3)](_0x1fe25c,_0x22d598,_0x54f986);}:function(_0x32083d,_0x1cf57c,_0x1de933,_0x38d447){if(_0x38d447===undefined)_0x38d447=_0x1de933;_0x32083d[_0x38d447]=_0x1cf57c[_0x1de933];}),__setModuleDefault=this&&this[a582_0x3f5cda(0x17e)]||(Object['create']?function(_0xa6d92c,_0x252568){const _0x52f4df=a582_0x3f5cda;Object[_0x52f4df(0x1d3)](_0xa6d92c,_0x52f4df(0x151),{'enumerable':!![],'value':_0x252568});}:function(_0x4a7e7a,_0x471b75){_0x4a7e7a['default']=_0x471b75;}),__importStar=this&&this[a582_0x3f5cda(0x171)]||(function(){const _0x5b517e=(function(){let _0x52fe61=!![];return function(_0x429e69,_0x1405d5){const _0x537d1e=_0x52fe61?function(){if(_0x1405d5){const _0x1c6c1b=_0x1405d5['apply'](_0x429e69,arguments);return _0x1405d5=null,_0x1c6c1b;}}:function(){};return _0x52fe61=![],_0x537d1e;};}()),_0x43cd9c=_0x5b517e(this,function(){const _0x414a22=a582_0x1d8f;return _0x43cd9c[_0x414a22(0x187)]()[_0x414a22(0x110)](_0x414a22(0x177))[_0x414a22(0x187)]()[_0x414a22(0x14f)](_0x43cd9c)['search'](_0x414a22(0x177));});_0x43cd9c();var _0x4b5831=function(_0x413d08){const _0x49f0a7=a582_0x1d8f;return _0x4b5831=Object[_0x49f0a7(0x1dd)]||function(_0x2a8c29){const _0x3348ca=_0x49f0a7;var _0x4e4768=[];for(var _0xa9f762 in _0x2a8c29)if(Object[_0x3348ca(0x1c6)]['hasOwnProperty'][_0x3348ca(0x133)](_0x2a8c29,_0xa9f762))_0x4e4768[_0x4e4768[_0x3348ca(0x1ce)]]=_0xa9f762;return _0x4e4768;},_0x4b5831(_0x413d08);};return function(_0x16e147){const _0x561daa=a582_0x1d8f;if(_0x16e147&&_0x16e147['__esModule'])return _0x16e147;var _0x2bf209={};if(_0x16e147!=null){for(var _0xaf9fae=_0x4b5831(_0x16e147),_0x1dec0e=0x0;_0x1dec0e<_0xaf9fae[_0x561daa(0x1ce)];_0x1dec0e++)if(_0xaf9fae[_0x1dec0e]!=='default')__createBinding(_0x2bf209,_0x16e147,_0xaf9fae[_0x1dec0e]);}return __setModuleDefault(_0x2bf209,_0x16e147),_0x2bf209;};}()),__importDefault=this&&this['__importDefault']||function(_0x280419){const _0x45f959=a582_0x3f5cda;return _0x280419&&_0x280419[_0x45f959(0x168)]?_0x280419:{'default':_0x280419};};function a582_0x1d8f(_0x535ce2,_0x54b5a0){const _0x24bdd1=a582_0x3349();return a582_0x1d8f=function(_0x2a0f12,_0x50375f){_0x2a0f12=_0x2a0f12-0xf1;let _0x3349eb=_0x24bdd1[_0x2a0f12];return _0x3349eb;},a582_0x1d8f(_0x535ce2,_0x54b5a0);}Object[a582_0x3f5cda(0x1d3)](exports,'__esModule',{'value':!![]}),exports[a582_0x3f5cda(0x149)]=exports[a582_0x3f5cda(0x13a)]=exports[a582_0x3f5cda(0x100)]=exports[a582_0x3f5cda(0x1cb)]=exports[a582_0x3f5cda(0x1c2)]=void 0x0,exports[a582_0x3f5cda(0x1b1)]=makeid;function a582_0x3349(){const _0x1020f4=['verifyQueue','messages.update','queues','protocolMessage','amountUsedBotQueues','isGroup','sequelize','readMessages','complationMessage','handleMessageIntegration','chatbot\x20desativado!','Mensagem','Exibindo\x20menu\x20para\x20ticket\x20','includes','../WhatsappService/ShowWhatsAppService','setExtra','ratingMessage','../../helpers/Mustache','chatbot','keepUserAndQueue','extendedTextMessage','subject','../../models/Queue','reload','emit','search','*\x20-\x20','value','E2E_IDENTITY_CHANGED','forEach','./SendWhatsAppMedia','pending','documentMessage','@whiskeysockets/baileys','verifyEditedMessage','path','integrationId','@sentry/node','mediaMessage','public','status@broadcast','findAll','Erro\x20ao\x20verificar\x20horário\x20de\x20atendimento:','body','stickerMessage','env','company','74903vYcxZD','disableBot','endsWith','Error\x20handling\x20wbot\x20message\x20listener.\x20Err:\x20','imageMessage','queue','verifyMessage','getMessageMedia','set','delete','14jwlcHY','typebotStatus','open','call','../TicketServices/FindOrCreateTicketService','../../models/QueueOption','4690GONhGT','documentWithCaptionMessage','getTypeMessage','map','wbotMessageListener','./SendWhatsAppMessage','\x20já\x20processada\x20para\x20o\x20ticket\x20','logger','buttonsResponseMessage','../../models/Whatsapp','\x22\x20para\x20ticket\x20','mediaPath','contact','useRating','Atualizando\x20estado\x20de\x20integração\x20do\x20ticket\x20#','5868WofCSc','4223975FrFWfb','warn','createdAt','handleMessage','-appMessage','key','WAMessageStubType','SimpleObjectCache','\x0a*0*\x20-\x20Voltar\x20ao\x20menu\x20anterior\x0a','constructor','-ticket','default','-open','verifyRating','isNaN','\x20selecionada\x20no\x20menu\x20principal.\x20ID:\x20','stringify','isNull','./GetHandlers','companyId','captureException','log','filter','../../helpers/CheckSettings','liveLocationMessage','disabled','../../helpers/Debounce','whatsappId','Erro\x20ao\x20processar\x20avaliação:','isFinite','scheduleType','trim','title','userId','__esModule','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','3GJYdCp','Atendimento\x20finalizado','CheckMsgIsGroup','transferMessage','templateMessage','3169756JBXDcv','thumbnailDirectPath','__importStar','resolve','Error\x20handling\x20message\x20ack.\x20Err:\x20','editedMessage','messageStubType','@g.us','(((.+)+)+)+$','messages','writable','locationMessage','\x20inválida\x20para\x20o\x20menu\x20principal.','fromMe','getUnpackedMessage','__setModuleDefault','number','getIO','Mutex','Menu\x20principal\x20exibido.','Erro\x20ao\x20processar\x20mensagem\x20do\x20WhatsApp:','error','../../models/Ticket','verifyContact','toString','\x20selecionada\x20no\x20submenu.\x20ID:\x20','../CompanyService/VerifyCurrentSchedule','update','useIntegration','inActivity','findByPk','greetingMessage','isNil','../../models/TicketTraking','option','contacts:','../../models/UserRating','status','ticketId','__createBinding','maxUseBotQueues','../TypebotServices/typebotListener','get','Opção\x20','message','\x20inválida\x20para\x20o\x20submenu\x20atual.','CIPHERTEXT','outOfHoursAction','Resultado\x20da\x20verificação\x20de\x20horário:','Por\x20favor\x20avalie\x20nosso\x20atendimento','../TicketServices/UpdateTicketService','Estamos\x20fora\x20do\x20horário\x20de\x20expediente','../../libs/socket','toDate','videoMessage','findOne','getContactMessage','socketSessions',',\x20queueOptionId:\x20','options','GetCompanySetting','viewOnceMessageV2','../../models/User','DESC','cacheLayer','remoteJid','makeid','enabled','audioMessage','charAt','closed','ephemeralMessage','Processando\x20mensagem:\x20\x22','count','conversation','Nó\x20final\x20encontrado.\x20Exibindo\x20mensagem\x20final.','REVOKE','configurable','outOfHoursMessage','messages.upsert','../QueueIntegrationServices/ShowQueueIntegrationService','company-','contactsArrayMessage','handleRating','find','6172410LnOCPK','queue-','prototype','forwardQueue','parentId','Error\x20isValidMsg','ticket-','displayCurrentMenu','vcard','ack','length','queueId','verifyDeleteMessage','debounce','getBodyMessage','defineProperty','reactionMessage','create','ASC','quotedMsg','messageContextInfo',':unreads','3236860vWRPjL','CHATBOT_RESTRICT_NUMBER','../../libs/cache','getOwnPropertyNames','\x20não\x20encontrada.','random','queueOptionId','.\x20Ignorando\x20em\x20handleChartbot.','runExclusive','4729728oyObNj','listMessage','forwardQueueId','ticket','E2E_DEVICE_CHANGED','buttonsMessage'];a582_0x3349=function(){return _0x1020f4;};return a582_0x3349();}const path_1=__importDefault(require(a582_0x3f5cda(0x11a))),Sentry=__importStar(require(a582_0x3f5cda(0x11c))),lodash_1=require('lodash'),baileys_1=require(a582_0x3f5cda(0x118)),async_mutex_1=require('async-mutex'),sequelize_1=require(a582_0x3f5cda(0xfd)),moment_1=__importDefault(require('moment')),Contact_1=__importDefault(require('../../models/Contact')),Ticket_1=__importDefault(require(a582_0x3f5cda(0x185))),Message_1=__importDefault(require('../../models/Message')),socket_1=require(a582_0x3f5cda(0x1a3)),logger_1=require('../../utils/logger'),FindOrCreateTicketService_1=__importDefault(require(a582_0x3f5cda(0x134))),ShowWhatsAppService_1=__importDefault(require(a582_0x3f5cda(0x105))),UpdateTicketService_1=__importDefault(require(a582_0x3f5cda(0x1a1))),Mustache_1=__importDefault(require(a582_0x3f5cda(0x108))),TicketTraking_1=__importDefault(require(a582_0x3f5cda(0x190))),UserRating_1=__importDefault(require(a582_0x3f5cda(0x193))),SendWhatsAppMessage_1=__importDefault(require(a582_0x3f5cda(0x13b))),Queue_1=__importDefault(require(a582_0x3f5cda(0x10d))),QueueOption_1=__importDefault(require(a582_0x3f5cda(0x135))),VerifyCurrentSchedule_1=__importDefault(require(a582_0x3f5cda(0x189))),User_1=__importDefault(require(a582_0x3f5cda(0x1ad))),Setting_1=__importDefault(require('../../models/Setting')),cache_1=require(a582_0x3f5cda(0x1dc)),Debounce_1=require(a582_0x3f5cda(0x160)),SendWhatsAppMedia_1=__importDefault(require(a582_0x3f5cda(0x115))),CheckSettings_1=require(a582_0x3f5cda(0x15d)),Whatsapp_1=__importDefault(require(a582_0x3f5cda(0x13f))),simpleObjectCache_1=require('../../helpers/simpleObjectCache'),ShowQueueIntegrationService_1=__importDefault(require(a582_0x3f5cda(0x1bf))),typebotListener_1=__importDefault(require(a582_0x3f5cda(0x198))),VerifyHandlers_1=require('./VerifyHandlers'),GetHandlers_1=require(a582_0x3f5cda(0x158)),wbotMutex=new async_mutex_1[(a582_0x3f5cda(0x181))](),ackMutex=new async_mutex_1['Mutex'](),groupContactCache=new simpleObjectCache_1[(a582_0x3f5cda(0x14d))](0x3e8*0x1e,logger_1[a582_0x3f5cda(0x13d)]),outOfHoursCache=new simpleObjectCache_1[(a582_0x3f5cda(0x14d))](0x3e8*0x3c*0x5,logger_1['logger']);function makeid(_0x3e3a50){const _0x7c50b7=a582_0x3f5cda;let _0x271fb2='';const _0x13bcb4='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',_0x39f3a9=_0x13bcb4[_0x7c50b7(0x1ce)];for(let _0x5a58ef=0x0;_0x5a58ef<_0x3e3a50;_0x5a58ef+=0x1){_0x271fb2+=_0x13bcb4[_0x7c50b7(0x1b4)](Math['floor'](Math[_0x7c50b7(0x1df)]()*_0x39f3a9));}return _0x271fb2;}const isValidMsg=_0x4a75fe=>{const _0x173eab=a582_0x3f5cda;if(_0x4a75fe[_0x173eab(0x14b)][_0x173eab(0x1b0)]===_0x173eab(0x11f))return![];try{const _0x260ab7=(0x0,GetHandlers_1[_0x173eab(0x138)])(_0x4a75fe);if(!_0x260ab7)return![];const _0x3097d1=_0x260ab7==='conversation'||_0x260ab7===_0x173eab(0x174)||_0x260ab7==='extendedTextMessage'||_0x260ab7===_0x173eab(0x1b3)||_0x260ab7===_0x173eab(0x1a5)||_0x260ab7===_0x173eab(0x12a)||_0x260ab7===_0x173eab(0x117)||_0x260ab7===_0x173eab(0x137)||_0x260ab7===_0x173eab(0x123)||_0x260ab7===_0x173eab(0x13e)||_0x260ab7===_0x173eab(0xf6)||_0x260ab7===_0x173eab(0x1d8)||_0x260ab7===_0x173eab(0x17a)||_0x260ab7===_0x173eab(0x15e)||_0x260ab7==='contactMessage'||_0x260ab7==='voiceMessage'||_0x260ab7===_0x173eab(0x11d)||_0x260ab7===_0x173eab(0x1c1)||_0x260ab7===_0x173eab(0x1d4)||_0x260ab7==='ephemeralMessage'||_0x260ab7===_0x173eab(0xfa)||_0x260ab7==='listResponseMessage'||_0x260ab7===_0x173eab(0xf2)||_0x260ab7===_0x173eab(0x16e)||_0x260ab7==='viewOnceMessage'||_0x260ab7===_0x173eab(0x1ac);return!_0x3097d1&&(logger_1[_0x173eab(0x13d)][_0x173eab(0x147)](_0x173eab(0x169)+_0x260ab7+'\x0a'+JSON[_0x173eab(0x156)](_0x4a75fe?.['message'])),Sentry[_0x173eab(0x106)](_0x173eab(0x102),{'BodyMsg':_0x4a75fe[_0x173eab(0x19b)],'msg':_0x4a75fe,'msgType':_0x260ab7}),Sentry[_0x173eab(0x15a)](new Error('Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg'))),!!_0x3097d1;}catch(_0x382012){return Sentry['setExtra'](_0x173eab(0x1c9),{'msg':_0x4a75fe}),Sentry[_0x173eab(0x15a)](_0x382012),![];}},handleRating=async(_0x2dcb8b,_0x4f5166,_0x4f402d)=>{const _0x28df2f=a582_0x3f5cda,_0x2d27dd=(0x0,socket_1[_0x28df2f(0x180)])();let _0x3ccb48=null;(_0x2dcb8b?.[_0x28df2f(0x19b)]?.['conversation']||_0x2dcb8b?.[_0x28df2f(0x19b)]?.['extendedTextMessage'])&&(_0x3ccb48=parseInt(_0x2dcb8b[_0x28df2f(0x19b)][_0x28df2f(0x1b9)]||_0x2dcb8b[_0x28df2f(0x19b)][_0x28df2f(0x10b)]['text'],0xa)||null);if(!Number[_0x28df2f(0x154)](_0x3ccb48)&&Number['isInteger'](_0x3ccb48)&&!(0x0,lodash_1[_0x28df2f(0x157)])(_0x3ccb48)){const _0x3a9c4c=await(0x0,ShowWhatsAppService_1['default'])(_0x4f5166[_0x28df2f(0x161)],_0x4f5166['companyId']);let _0x3336be=_0x3ccb48;_0x3ccb48<0x1&&(_0x3336be=0x1);_0x3ccb48>0x5&&(_0x3336be=0x5);await UserRating_1['default'][_0x28df2f(0x1d5)]({'ticketId':_0x4f402d[_0x28df2f(0x195)],'companyId':_0x4f402d[_0x28df2f(0x159)],'userId':_0x4f402d['userId'],'rate':_0x3336be});const _0x2519c3=_0x3a9c4c[_0x28df2f(0xff)][_0x28df2f(0x165)]()||_0x28df2f(0x16b);await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x4f5166,'body':_0x2519c3}),await _0x4f402d[_0x28df2f(0x18a)]({'finishedAt':(0x0,moment_1[_0x28df2f(0x151)])()[_0x28df2f(0x1a4)](),'rated':!![]});const _0x4be3cc=await(0x0,CheckSettings_1[_0x28df2f(0x1ab)])(_0x4f5166[_0x28df2f(0x159)],_0x28df2f(0x10a),'enabled')===_0x28df2f(0x1b2);await _0x4f5166[_0x28df2f(0x18a)]({'queueId':_0x4be3cc?_0x4f5166[_0x28df2f(0x1cf)]:null,'chatbot':null,'queueOptionId':null,'userId':_0x4be3cc?_0x4f5166[_0x28df2f(0x167)]:null,'status':_0x28df2f(0x1b5)}),_0x2d27dd['to'](_0x28df2f(0x1c0)+_0x4f5166[_0x28df2f(0x159)]+'-open')['to'](_0x28df2f(0x1c5)+_0x4f5166['queueId']+_0x28df2f(0x152))[_0x28df2f(0x10f)]('company-'+_0x4f5166['companyId']+_0x28df2f(0x150),{'action':_0x28df2f(0x12f),'ticket':_0x4f5166,'ticketId':_0x4f5166['id']}),_0x2d27dd['to'](_0x28df2f(0x1c0)+_0x4f5166[_0x28df2f(0x159)]+'-'+_0x4f5166['status'])['to'](_0x28df2f(0x1c5)+_0x4f5166[_0x28df2f(0x1cf)]+'-'+_0x4f5166[_0x28df2f(0x194)])['to'](_0x4f5166['id']['toString']())[_0x28df2f(0x10f)]('company-'+_0x4f5166[_0x28df2f(0x159)]+_0x28df2f(0x150),{'action':_0x28df2f(0x18a),'ticket':_0x4f5166,'ticketId':_0x4f5166['id']});}};exports['handleRating']=handleRating;const handleChartbot=async(_0x194151,_0x177788,_0x38767b,_0x3ae5c4=![])=>{const _0x524efa=a582_0x3f5cda,_0x3d3f29=_0x177788[_0x524efa(0x14b)]['id'];if(_0x3d3f29&&_0x194151['lastProcessedMessageId']===_0x3d3f29){console[_0x524efa(0x15b)]('Mensagem\x20'+_0x3d3f29+_0x524efa(0x13c)+_0x194151['id']+_0x524efa(0x1e1));return;}await _0x194151[_0x524efa(0x18a)]({'lastProcessedMessageId':_0x3d3f29});const _0x5ec6c9=(0x0,GetHandlers_1[_0x524efa(0x1d2)])(_0x177788);console[_0x524efa(0x15b)](_0x524efa(0x1b7)+_0x5ec6c9+_0x524efa(0x140)+_0x194151['id']+_0x524efa(0x1a9)+_0x194151['queueOptionId']);const _0x29d4e2=await Queue_1[_0x524efa(0x151)][_0x524efa(0x18d)](_0x194151['queueId'],{'include':[{'model':QueueOption_1['default'],'as':_0x524efa(0x1aa),'where':{'parentId':null},'order':[['option',_0x524efa(0x1d6)]],'required':![]}]}),_0x1d4035=await Whatsapp_1['default'][_0x524efa(0x18d)](_0x194151['whatsappId']);if(!_0x1d4035){console[_0x524efa(0x184)]('Configurações\x20do\x20WhatsApp\x20não\x20encontradas.');return;}if(_0x5ec6c9==='#'){await _0x194151[_0x524efa(0x18a)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await(0x0,VerifyHandlers_1['verifyQueue'])(_0x38767b,_0x177788,_0x194151,_0x194151[_0x524efa(0x142)]);return;}if(!(0x0,lodash_1['isNil'])(_0x29d4e2)&&!(0x0,lodash_1[_0x524efa(0x18f)])(_0x194151['queueOptionId'])&&_0x5ec6c9==='0'){const _0x9a0b1b=await QueueOption_1[_0x524efa(0x151)]['findByPk'](_0x194151[_0x524efa(0x1e0)]);_0x9a0b1b?.[_0x524efa(0x1c8)]?await _0x194151[_0x524efa(0x18a)]({'queueOptionId':_0x9a0b1b[_0x524efa(0x1c8)],'amountUsedBotQueues':0x0}):await _0x194151[_0x524efa(0x18a)]({'queueOptionId':null,'amountUsedBotQueues':0x0});await _0x194151[_0x524efa(0x10e)](),await(0x0,exports['displayCurrentMenu'])(_0x194151,_0x38767b);return;}if(!_0x194151[_0x524efa(0x109)]&&_0x194151[_0x524efa(0xfb)]>=_0x1d4035[_0x524efa(0x197)])return;if(!(0x0,lodash_1['isNil'])(_0x29d4e2)&&(0x0,lodash_1[_0x524efa(0x18f)])(_0x194151[_0x524efa(0x1e0)])&&!_0x3ae5c4){if(_0x5ec6c9&&_0x29d4e2[_0x524efa(0x1aa)]?.[_0x524efa(0x1ce)]>0x0){const _0x8abca1=_0x29d4e2['options']['find'](_0x5d83b7=>_0x5d83b7[_0x524efa(0x191)]===_0x5ec6c9);if(_0x8abca1){console[_0x524efa(0x15b)]('Opção\x20'+_0x5ec6c9+_0x524efa(0x155)+_0x8abca1['id']),await _0x194151[_0x524efa(0x18a)]({'queueOptionId':_0x8abca1['id'],'amountUsedBotQueues':0x0}),await _0x194151['reload'](),await(0x0,exports[_0x524efa(0x1cb)])(_0x194151,_0x38767b);return;}else console[_0x524efa(0x15b)](_0x524efa(0x19a)+_0x5ec6c9+_0x524efa(0x17b));}}else{if(!(0x0,lodash_1[_0x524efa(0x18f)])(_0x29d4e2)&&!(0x0,lodash_1['isNil'])(_0x194151[_0x524efa(0x1e0)])){const _0x5807d5=await QueueOption_1[_0x524efa(0x151)][_0x524efa(0x120)]({'where':{'parentId':_0x194151['queueOptionId']},'order':[['option',_0x524efa(0x1d6)]]});if(_0x5ec6c9&&_0x5807d5['length']>0x0){const _0x19d3a2=_0x5807d5[_0x524efa(0x1c3)](_0xa5fa1d=>_0xa5fa1d[_0x524efa(0x191)]===_0x5ec6c9);if(_0x19d3a2){console['log'](_0x524efa(0x19a)+_0x5ec6c9+_0x524efa(0x188)+_0x19d3a2['id']),await _0x194151['update']({'queueOptionId':_0x19d3a2['id'],'amountUsedBotQueues':0x0}),await _0x194151['reload'](),await(0x0,exports['displayCurrentMenu'])(_0x194151,_0x38767b);return;}else console[_0x524efa(0x15b)]('Opção\x20'+_0x5ec6c9+_0x524efa(0x19c));}}}if(_0x5ec6c9&&_0x5ec6c9!=='0'&&_0x5ec6c9!=='#'){console[_0x524efa(0x15b)]('Resposta\x20inválida:\x20'+_0x5ec6c9);if(_0x1d4035[_0x524efa(0x197)]&&_0x1d4035['maxUseBotQueues']!==0x0&&_0x194151[_0x524efa(0xfb)]>=_0x1d4035[_0x524efa(0x197)]){await _0x194151[_0x524efa(0x18a)]({'chatbot':![],'amountUsedBotQueues':_0x1d4035[_0x524efa(0x197)]});_0x1d4035[_0x524efa(0x16d)]&&await(0x0,SendWhatsAppMessage_1[_0x524efa(0x151)])({'ticket':_0x194151,'body':_0x1d4035[_0x524efa(0x16d)]});return;}await _0x194151[_0x524efa(0x18a)]({'amountUsedBotQueues':_0x194151[_0x524efa(0xfb)]+0x1}),await _0x194151[_0x524efa(0x10e)]();}!_0x3ae5c4&&await(0x0,exports['displayCurrentMenu'])(_0x194151,_0x38767b);},displayCurrentMenu=async(_0x349918,_0x545764)=>{const _0x44fba6=a582_0x3f5cda;console['log'](_0x44fba6(0x103)+_0x349918['id']+_0x44fba6(0x1a9)+_0x349918[_0x44fba6(0x1e0)]);const _0x219459=await Queue_1[_0x44fba6(0x151)][_0x44fba6(0x18d)](_0x349918['queueId']);if(!_0x219459)return;if((0x0,lodash_1['isNil'])(_0x349918[_0x44fba6(0x1e0)])){const _0x476c77=await QueueOption_1['default'][_0x44fba6(0x120)]({'where':{'queueId':_0x349918['queueId'],'parentId':null},'order':[[_0x44fba6(0x191),'ASC']]});if(_0x476c77[_0x44fba6(0x1ce)]>0x0){let _0x167e05=_0x219459[_0x44fba6(0x18e)]?_0x219459[_0x44fba6(0x18e)]+'\x0a\x0a':'';_0x476c77[_0x44fba6(0x114)](_0x5ee026=>{const _0x376456=_0x44fba6;_0x167e05+='*'+_0x5ee026[_0x376456(0x191)]+_0x376456(0x111)+_0x5ee026[_0x376456(0x166)]+'\x0a';}),_0x167e05+='\x0a*#*\x20-\x20Voltar\x20Menu\x20Inicial',await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x349918,'body':_0x167e05}),console[_0x44fba6(0x15b)](_0x44fba6(0x182));}return;}const _0xdd0c08=await QueueOption_1['default'][_0x44fba6(0x18d)](_0x349918[_0x44fba6(0x1e0)],{'include':[{'model':Queue_1[_0x44fba6(0x151)],'as':_0x44fba6(0x1c7)}]});if(!_0xdd0c08){console[_0x44fba6(0x15b)](_0x44fba6(0x19a)+_0x349918['queueOptionId']+_0x44fba6(0x1de));return;}const _0x103fc6=await QueueOption_1[_0x44fba6(0x151)][_0x44fba6(0x120)]({'where':{'parentId':_0x349918['queueOptionId']},'order':[[_0x44fba6(0x191),_0x44fba6(0x1d6)]]});if(_0x103fc6['length']===0x0){console[_0x44fba6(0x15b)](_0x44fba6(0x1ba));let _0x519116=(0x0,Mustache_1[_0x44fba6(0x151)])('‎'+_0xdd0c08[_0x44fba6(0x19b)],_0x349918);if(_0xdd0c08?.[_0x44fba6(0x141)]){const _0x40d3c0=path_1[_0x44fba6(0x151)][_0x44fba6(0x172)](_0x44fba6(0x11e),_0xdd0c08[_0x44fba6(0x141)]);_0x40d3c0?await(0x0,SendWhatsAppMedia_1[_0x44fba6(0x151)])({'media':_0x40d3c0,'ticket':_0x349918,'body':_0x519116}):await(0x0,SendWhatsAppMessage_1[_0x44fba6(0x151)])({'ticket':_0x349918,'body':_0x519116});}else await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x349918,'body':_0x519116});if(_0xdd0c08['exitChatbot'])await _0x349918[_0x44fba6(0x18a)]({'queueOptionId':null,'chatbot':![],'amountUsedBotQueues':0x0});else{if(_0xdd0c08[_0x44fba6(0xf3)]){await _0x349918['update']({'queueOptionId':null,'chatbot':![],'queueId':_0xdd0c08['forwardQueueId'],'amountUsedBotQueues':0x0}),await _0x349918[_0x44fba6(0x10e)]();if(_0xdd0c08['forwardQueue']){const _0x271d5e=await QueueOption_1[_0x44fba6(0x151)]['findOne']({'where':{'queueId':_0xdd0c08[_0x44fba6(0xf3)],'parentId':null}});await _0x349918[_0x44fba6(0x18a)]({'chatbot':!!_0x271d5e}),_0xdd0c08['forwardQueue'][_0x44fba6(0x18e)]&&await(0x0,SendWhatsAppMessage_1[_0x44fba6(0x151)])({'ticket':_0x349918,'body':_0xdd0c08['forwardQueue'][_0x44fba6(0x18e)]}),_0x271d5e&&await(0x0,exports[_0x44fba6(0x1cb)])(_0x349918,_0x545764);}}else await _0x349918[_0x44fba6(0x18a)]({'queueOptionId':null,'chatbot':![]});}return;}console[_0x44fba6(0x15b)]('Submenu\x20encontrado\x20com\x20'+_0x103fc6[_0x44fba6(0x1ce)]+'\x20opções.\x20Exibindo\x20submenu.');let _0xc47d8e=_0xdd0c08[_0x44fba6(0x19b)]?_0xdd0c08[_0x44fba6(0x19b)]+'\x0a\x0a':'';_0x103fc6[_0x44fba6(0x114)](_0x337e70=>{const _0x488e9a=_0x44fba6;_0xc47d8e+='*'+_0x337e70[_0x488e9a(0x191)]+_0x488e9a(0x111)+_0x337e70[_0x488e9a(0x166)]+'\x0a';}),_0xc47d8e+=_0x44fba6(0x14e),_0xc47d8e+='*#*\x20-\x20Voltar\x20Menu\x20Inicial';if(_0xdd0c08?.[_0x44fba6(0x141)]){const _0x542bed=path_1['default'][_0x44fba6(0x172)](_0x44fba6(0x11e),_0xdd0c08[_0x44fba6(0x141)]);_0x542bed?await(0x0,SendWhatsAppMedia_1[_0x44fba6(0x151)])({'media':_0x542bed,'ticket':_0x349918,'body':_0xc47d8e}):await(0x0,SendWhatsAppMessage_1[_0x44fba6(0x151)])({'ticket':_0x349918,'body':_0xc47d8e});}else await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x349918,'body':_0xc47d8e});};exports[a582_0x3f5cda(0x1cb)]=displayCurrentMenu;const handleMessageIntegration=async(_0x513c89,_0x5e0fc4,_0x2ef944,_0x4c1796)=>{const _0x460234=a582_0x3f5cda;if(process[_0x460234(0x124)]['CHATBOT_RESTRICT_NUMBER']){if(_0x4c1796['contact'][_0x460234(0x17f)]!=process[_0x460234(0x124)][_0x460234(0x1db)]){console[_0x460234(0x15b)](_0x460234(0x101));return;}}console[_0x460234(0x15b)]('typebotStatus:\x20',_0x4c1796[_0x460234(0x131)]),_0x2ef944['type']==='typebot'&&!_0x4c1796[_0x460234(0x131)]?(await(0x0,typebotListener_1[_0x460234(0x151)])({'ticket':_0x4c1796,'msg':_0x513c89,'wbot':_0x5e0fc4,'typebot':_0x2ef944}),!_0x4c1796['useIntegration']&&(await _0x4c1796[_0x460234(0x18a)]({'useIntegration':!![],'integrationId':_0x2ef944['id']}),console[_0x460234(0x15b)](_0x460234(0x144)+_0x4c1796['id']))):console[_0x460234(0x15b)]('Tipo\x20de\x20integração\x20não\x20suportada.');};exports['handleMessageIntegration']=handleMessageIntegration;const handleMessage=async(_0x1ae4d2,_0x56ed8b,_0x1f6db2)=>{const _0x3f41cd=a582_0x3f5cda;if(!isValidMsg(_0x1ae4d2))return;_0x1ae4d2[_0x3f41cd(0x19b)]?.[_0x3f41cd(0x1b6)]&&(_0x1ae4d2[_0x3f41cd(0x19b)]=_0x1ae4d2[_0x3f41cd(0x19b)]['ephemeralMessage'][_0x3f41cd(0x19b)]);try{let _0x5e9715,_0x5763e5;const _0x412fc6=_0x1ae4d2[_0x3f41cd(0x14b)][_0x3f41cd(0x1b0)]?.[_0x3f41cd(0x128)](_0x3f41cd(0x176));if(_0x412fc6){const _0x400c87=await Setting_1[_0x3f41cd(0x151)]['findOne']({'where':{'companyId':_0x1f6db2,'key':_0x3f41cd(0x16c)}});if(!_0x400c87||_0x400c87[_0x3f41cd(0x112)]===_0x3f41cd(0x1b2))return;}const _0x5263b9=(0x0,GetHandlers_1[_0x3f41cd(0x1d2)])(_0x1ae4d2),_0x595cd9=(0x0,GetHandlers_1[_0x3f41cd(0x138)])(_0x1ae4d2),_0x296437=_0x595cd9!==_0x3f41cd(0x16e)&&(0x0,GetHandlers_1[_0x3f41cd(0x17d)])(_0x1ae4d2),_0x268bfe=_0x296437&&(0x0,GetHandlers_1[_0x3f41cd(0x12d)])(_0x296437);if(_0x1ae4d2[_0x3f41cd(0x14b)]['fromMe']){if(_0x5263b9?.['startsWith']('‎'))return;if(!_0x268bfe&&_0x595cd9!==_0x3f41cd(0x1b9)&&_0x595cd9!==_0x3f41cd(0x10b)&&_0x595cd9!==_0x3f41cd(0x1cc))return;_0x5e9715=await(0x0,GetHandlers_1['getContactMessage'])(_0x1ae4d2,_0x56ed8b);}else _0x5e9715=await(0x0,GetHandlers_1[_0x3f41cd(0x1a7)])(_0x1ae4d2,_0x56ed8b);_0x412fc6&&(_0x5763e5=await wbotMutex['runExclusive'](async()=>{const _0x26c66e=_0x3f41cd;let _0x3a3508=groupContactCache[_0x26c66e(0x199)](_0x1ae4d2['key'][_0x26c66e(0x1b0)]);if(!_0x3a3508){const _0x3711b0=await _0x56ed8b['groupMetadata'](_0x1ae4d2[_0x26c66e(0x14b)][_0x26c66e(0x1b0)]),_0x1f6266={'id':_0x3711b0['id'],'name':_0x3711b0[_0x26c66e(0x10c)]};_0x3a3508=await(0x0,VerifyHandlers_1[_0x26c66e(0x186)])(_0x1f6266,_0x56ed8b,_0x1f6db2),groupContactCache[_0x26c66e(0x12e)](_0x1ae4d2[_0x26c66e(0x14b)][_0x26c66e(0x1b0)],_0x3a3508);}return _0x3a3508;}));const _0xea34d6=await(0x0,ShowWhatsAppService_1[_0x3f41cd(0x151)])(_0x56ed8b['id'],_0x1f6db2),_0x235b99=await(0x0,VerifyHandlers_1['verifyContact'])(_0x5e9715,_0x56ed8b,_0x1f6db2);let _0x3cfba1=0x0;if(_0x1ae4d2[_0x3f41cd(0x14b)][_0x3f41cd(0x17c)])await cache_1[_0x3f41cd(0x1af)][_0x3f41cd(0x12e)](_0x3f41cd(0x192)+_0x235b99['id']+_0x3f41cd(0x1d9),'0');else{const _0x5ead6c=await cache_1[_0x3f41cd(0x1af)][_0x3f41cd(0x199)](_0x3f41cd(0x192)+_0x235b99['id']+_0x3f41cd(0x1d9));_0x3cfba1=+_0x5ead6c+0x1,await cache_1[_0x3f41cd(0x1af)][_0x3f41cd(0x12e)]('contacts:'+_0x235b99['id']+':unreads',''+_0x3cfba1);}const _0x116733=await Message_1[_0x3f41cd(0x151)]['findOne']({'where':{'contactId':_0x235b99['id'],'companyId':_0x1f6db2,'$ticket.whatsappId$':_0xea34d6['id']},'include':[_0x3f41cd(0xf4)],'order':[[_0x3f41cd(0x148),_0x3f41cd(0x1ae)]]}),_0x46dccb=_0xea34d6[_0x3f41cd(0xff)][_0x3f41cd(0x165)]()||_0x3f41cd(0x16b);if(_0x116733&&_0x3cfba1===0x0&&_0x46dccb&&(0x0,Mustache_1[_0x3f41cd(0x151)])(_0x46dccb,_0x116733[_0x3f41cd(0xf4)])['trim']()['toLowerCase']()===_0x116733?.['body'][_0x3f41cd(0x165)]()['toLowerCase']())return;if(!_0x1ae4d2[_0x3f41cd(0x14b)]['fromMe']&&!_0x235b99[_0x3f41cd(0xfc)]){if(_0xea34d6[_0x3f41cd(0x143)]){const _0x3542a6=await TicketTraking_1[_0x3f41cd(0x151)][_0x3f41cd(0x1a6)]({'where':{'whatsappId':_0xea34d6['id'],'rated':![],'ratingAt':{[sequelize_1['Op']['not']]:null},'finishedAt':null},'include':[{'model':Ticket_1['default'],'where':{'status':'open','contactId':_0x235b99['id']},'include':[{'model':Contact_1[_0x3f41cd(0x151)]},{'model':User_1[_0x3f41cd(0x151)]},{'model':Queue_1[_0x3f41cd(0x151)]}]}]});if(_0x3542a6)try{const _0x181c9b=Number(_0x5263b9);if(!Number[_0x3f41cd(0x163)](_0x181c9b)){const _0x18e1e3=(0x0,Debounce_1[_0x3f41cd(0x1d1)])(async()=>{const _0x54cf38=_0x3f41cd,_0x4c4a99=_0xea34d6[_0x54cf38(0x107)]?.[_0x54cf38(0x165)]()||_0x54cf38(0x1a0);await(0x0,SendWhatsAppMessage_1[_0x54cf38(0x151)])({'ticket':_0x3d0075,'body':'\x0a*'+_0x4c4a99+'*'});},0x3e8,_0x3542a6[_0x3f41cd(0xf4)]['id']);_0x18e1e3();return;}if((0x0,VerifyHandlers_1[_0x3f41cd(0x153)])(_0x3542a6)){(0x0,exports['handleRating'])(_0x1ae4d2,_0x3542a6['ticket'],_0x3542a6);return;}}catch(_0x536a2c){Sentry[_0x3f41cd(0x15a)](_0x536a2c),console[_0x3f41cd(0x15b)](_0x3f41cd(0x162),_0x536a2c);}}}const {ticket:_0x3d0075,justCreated:_0x345c70}=await(0x0,FindOrCreateTicketService_1['default'])(_0x235b99,_0x56ed8b['id'],_0x3cfba1,_0x1f6db2,_0x5763e5);if(_0x268bfe||_0x1ae4d2?.[_0x3f41cd(0x19b)]?.[_0x3f41cd(0x10b)]?.[_0x3f41cd(0x170)])await(0x0,VerifyHandlers_1['verifyMediaMessage'])(_0x1ae4d2,_0x3d0075,_0x235b99,_0x56ed8b,_0x268bfe);else{if(_0x1ae4d2['message']?.[_0x3f41cd(0x174)]?.[_0x3f41cd(0x19b)]?.[_0x3f41cd(0xfa)]?.[_0x3f41cd(0x174)])await(0x0,VerifyHandlers_1['verifyEditedMessage'])(_0x1ae4d2['message'][_0x3f41cd(0x174)]['message']['protocolMessage'][_0x3f41cd(0x174)],_0x3d0075,_0x1ae4d2[_0x3f41cd(0x19b)][_0x3f41cd(0x174)]['message'][_0x3f41cd(0xfa)]['key']['id']);else{if(_0x1ae4d2[_0x3f41cd(0x19b)]?.['protocolMessage']?.['editedMessage'])await(0x0,VerifyHandlers_1[_0x3f41cd(0x119)])(_0x1ae4d2['message'][_0x3f41cd(0xfa)][_0x3f41cd(0x174)],_0x3d0075,_0x1ae4d2[_0x3f41cd(0x19b)][_0x3f41cd(0xfa)][_0x3f41cd(0x14b)]['id']);else _0x1ae4d2[_0x3f41cd(0x19b)]?.[_0x3f41cd(0xfa)]?.['type']===0x0?await(0x0,VerifyHandlers_1[_0x3f41cd(0x1d0)])(_0x1ae4d2[_0x3f41cd(0x19b)][_0x3f41cd(0xfa)],_0x3d0075):await(0x0,VerifyHandlers_1[_0x3f41cd(0x12c)])(_0x1ae4d2,_0x3d0075,_0x235b99);}}if(_0x3d0075[_0x3f41cd(0x18b)]===!![]&&_0x3d0075[_0x3f41cd(0x11b)]){const _0x571636=await(0x0,ShowQueueIntegrationService_1[_0x3f41cd(0x151)])(_0x3d0075[_0x3f41cd(0x11b)],_0x1f6db2);if(_0x571636){await(0x0,exports[_0x3f41cd(0x100)])(_0x1ae4d2,_0x56ed8b,_0x571636,_0x3d0075);return;}else await _0x3d0075[_0x3f41cd(0x18a)]({'useIntegration':![],'integrationId':null,'typebotSessionId':null});}if(_0x5263b9==='#'&&!_0x412fc6){await _0x3d0075['update']({'queueOptionId':null,'chatbot':![],'queueId':null}),await(0x0,VerifyHandlers_1[_0x3f41cd(0xf7)])(_0x56ed8b,_0x1ae4d2,_0x3d0075,_0x3d0075[_0x3f41cd(0x142)]);return;}if(_0x412fc6||_0x235b99[_0x3f41cd(0x127)])return;const _0x3570df=await(0x0,CheckSettings_1[_0x3f41cd(0x1ab)])(_0x1f6db2,_0x3f41cd(0x164),_0x3f41cd(0x15f));try{if(!_0x1ae4d2[_0x3f41cd(0x14b)][_0x3f41cd(0x17c)]&&_0x3570df){const _0x4e3fbb=await(0x0,CheckSettings_1[_0x3f41cd(0x1ab)])(_0x1f6db2,_0x3f41cd(0x19e),_0x3f41cd(0x116));let _0x4cd572=null;const _0x3af597=_0x3d0075['status']===_0x3f41cd(0x132)&&_0x3d0075['user'][_0x3f41cd(0x1a8)]['length']>0x0,_0x8f8c3f=!_0x3af597&&outOfHoursCache[_0x3f41cd(0x199)](_0x3f41cd(0x1ca)+_0x3d0075['id']);if(_0x3570df===_0x3f41cd(0x125)&&!_0x3af597){_0x4cd572=await(0x0,VerifyCurrentSchedule_1[_0x3f41cd(0x151)])(_0x1f6db2),console[_0x3f41cd(0x15b)](_0x3f41cd(0x19f),{'currentSchedule':_0x4cd572,'isInActivity':_0x4cd572?.[_0x3f41cd(0x18c)]});if(_0x4cd572&&_0x4cd572['inActivity']===![]){if(!_0x8f8c3f){outOfHoursCache[_0x3f41cd(0x12e)]('ticket-'+_0x3d0075['id'],!![]);const _0x36a846=_0xea34d6[_0x3f41cd(0x1bd)][_0x3f41cd(0x165)]()||'Estamos\x20fora\x20do\x20horário\x20de\x20expediente';await(0x0,SendWhatsAppMessage_1[_0x3f41cd(0x151)])({'ticket':_0x3d0075,'body':_0x36a846});}_0x3d0075[_0x3f41cd(0x194)]!==_0x3f41cd(0x132)&&await(0x0,UpdateTicketService_1['default'])({'ticketData':{'chatbot':![],'status':_0x4e3fbb},'ticketId':_0x3d0075['id'],'companyId':_0x3d0075[_0x3f41cd(0x159)]});return;}}if(_0x3570df===_0x3f41cd(0x12b)&&_0x3d0075[_0x3f41cd(0x1cf)]!==null&&!_0x3af597){_0x4cd572=await(0x0,VerifyCurrentSchedule_1[_0x3f41cd(0x151)])(_0x1f6db2,_0x3d0075[_0x3f41cd(0x1cf)]);const _0xea6627=await Queue_1[_0x3f41cd(0x151)][_0x3f41cd(0x18d)](_0x3d0075[_0x3f41cd(0x1cf)]);if(!(0x0,lodash_1[_0x3f41cd(0x18f)])(_0x4cd572)&&(!_0x4cd572||_0x4cd572[_0x3f41cd(0x18c)]===![])){if(!_0x8f8c3f){outOfHoursCache[_0x3f41cd(0x12e)](_0x3f41cd(0x1ca)+_0x3d0075['id'],!![]);const _0x5c23a6=_0xea6627[_0x3f41cd(0x1bd)]?.['trim']()||_0x3f41cd(0x1a2);await(0x0,SendWhatsAppMessage_1[_0x3f41cd(0x151)])({'ticket':_0x3d0075,'body':_0x5c23a6});}_0x3d0075[_0x3f41cd(0x194)]!==_0x3f41cd(0x132)&&await(0x0,UpdateTicketService_1[_0x3f41cd(0x151)])({'ticketData':{'chatbot':![],'status':_0x4e3fbb},'ticketId':_0x3d0075['id'],'companyId':_0x3d0075[_0x3f41cd(0x159)]});return;}}}}catch(_0x1274a6){Sentry[_0x3f41cd(0x15a)](_0x1274a6),console['log'](_0x3f41cd(0x121),_0x1274a6);}!_0x3d0075[_0x3f41cd(0x12b)]&&!_0x412fc6&&!_0x1ae4d2[_0x3f41cd(0x14b)][_0x3f41cd(0x17c)]&&!_0x3d0075[_0x3f41cd(0x167)]&&_0xea34d6[_0x3f41cd(0xf9)]['length']>=0x1&&await(0x0,VerifyHandlers_1['verifyQueue'])(_0x56ed8b,_0x1ae4d2,_0x3d0075,_0x3d0075['contact']);const _0x4055e5=_0x3d0075[_0x3f41cd(0x12b)]===null;await _0x3d0075[_0x3f41cd(0x10e)]();if(_0x345c70&&!_0xea34d6?.[_0x3f41cd(0xf9)]?.['length']&&!_0x3d0075[_0x3f41cd(0x167)]&&!_0x412fc6&&!_0x1ae4d2[_0x3f41cd(0x14b)][_0x3f41cd(0x17c)]){const _0x13c16f=await Message_1[_0x3f41cd(0x151)]['findOne']({'where':{'ticketId':_0x3d0075['id'],'fromMe':!![]},'order':[[_0x3f41cd(0x148),_0x3f41cd(0x1ae)]]});if(_0x13c16f&&_0x13c16f[_0x3f41cd(0x122)][_0x3f41cd(0x104)](_0xea34d6[_0x3f41cd(0x18e)]))return;if(_0xea34d6['greetingMessage']){const _0x54e98e=(0x0,Debounce_1[_0x3f41cd(0x1d1)])(async()=>{const _0x2b5549=_0x3f41cd;await(0x0,SendWhatsAppMessage_1[_0x2b5549(0x151)])({'ticket':_0x3d0075,'body':''+_0xea34d6[_0x2b5549(0x18e)]});},0x3e8,_0x3d0075['id']);_0x54e98e();return;}}if(!_0x3d0075[_0x3f41cd(0x109)]&&_0x3d0075[_0x3f41cd(0xfb)]>=_0xea34d6?.[_0x3f41cd(0x197)])return;if(_0x3d0075[_0x3f41cd(0x109)]&&!_0x1ae4d2[_0x3f41cd(0x14b)][_0x3f41cd(0x17c)]){await handleChartbot(_0x3d0075,_0x1ae4d2,_0x56ed8b);return;}_0xea34d6[_0x3f41cd(0xf9)][_0x3f41cd(0x1ce)]===0x1&&_0x3d0075[_0x3f41cd(0x12b)]&&(_0x3d0075[_0x3f41cd(0x109)]&&!_0x1ae4d2['key']['fromMe']&&!_0x3d0075[_0x3f41cd(0x18b)]&&await handleChartbot(_0x3d0075,_0x1ae4d2,_0x56ed8b,_0x4055e5)),_0xea34d6[_0x3f41cd(0xf9)][_0x3f41cd(0x1ce)]>0x1&&_0x3d0075['queue']&&(_0x3d0075[_0x3f41cd(0x109)]&&!_0x1ae4d2[_0x3f41cd(0x14b)][_0x3f41cd(0x17c)]&&!_0x3d0075[_0x3f41cd(0x18b)]&&await handleChartbot(_0x3d0075,_0x1ae4d2,_0x56ed8b,_0x4055e5));}catch(_0x10bcd2){console['log'](_0x3f41cd(0x183),_0x10bcd2),Sentry[_0x3f41cd(0x15a)](_0x10bcd2),logger_1[_0x3f41cd(0x13d)]['error']('Error\x20handling\x20whatsapp\x20message:\x20Err:\x20'+_0x10bcd2);}};exports[a582_0x3f5cda(0x149)]=handleMessage;const handleMsgAck=async(_0xb5aeac,_0x43a006)=>{const _0x32109d=a582_0x3f5cda;if(!_0x43a006)return;const _0x4b246d=(0x0,socket_1[_0x32109d(0x180)])();try{const _0x513986=await Message_1['default'][_0x32109d(0x18d)](_0xb5aeac[_0x32109d(0x14b)]['id'],{'include':['contact',{'model':Message_1[_0x32109d(0x151)],'as':_0x32109d(0x1d7),'include':[_0x32109d(0x142)]}]});if(!_0x513986||_0x43a006<=_0x513986[_0x32109d(0x1cd)])return;await _0x513986['update']({'ack':_0x43a006}),_0x4b246d['to'](_0x513986[_0x32109d(0x195)][_0x32109d(0x187)]())[_0x32109d(0x10f)](_0x32109d(0x1c0)+_0x513986['companyId']+_0x32109d(0x14a),{'action':_0x32109d(0x18a),'message':_0x513986});}catch(_0x53e416){Sentry['captureException'](_0x53e416),logger_1['logger'][_0x32109d(0x184)](_0x32109d(0x173)+_0x53e416);}},filterMessages=_0x24d504=>{const _0x4db394=a582_0x3f5cda;if(_0x24d504[_0x4db394(0x19b)]?.[_0x4db394(0xfa)]?.[_0x4db394(0x174)])return!![];if(_0x24d504[_0x4db394(0x19b)]?.[_0x4db394(0xfa)]?.['type']===0x0)return!![];if(_0x24d504['message']?.['protocolMessage'])return![];if([baileys_1[_0x4db394(0x14c)][_0x4db394(0x1bb)],baileys_1['WAMessageStubType'][_0x4db394(0xf5)],baileys_1[_0x4db394(0x14c)][_0x4db394(0x113)],baileys_1[_0x4db394(0x14c)][_0x4db394(0x19d)]][_0x4db394(0x104)](_0x24d504[_0x4db394(0x175)]))return![];return!![];},wbotMessageListener=async(_0x89e4f,_0x22b072)=>{const _0x4bf80a=a582_0x3f5cda;try{_0x89e4f['ev']['on'](_0x4bf80a(0x1be),async _0x43dc7a=>{const _0x2ef68a=_0x4bf80a,_0x40812f=_0x43dc7a[_0x2ef68a(0x178)][_0x2ef68a(0x15c)](filterMessages)[_0x2ef68a(0x139)](_0x2833e5=>_0x2833e5);if(!_0x40812f)return;_0x40812f[_0x2ef68a(0x114)](async _0x28eeb4=>{const _0x4ebe02=_0x2ef68a,_0x210150=await Message_1[_0x4ebe02(0x151)][_0x4ebe02(0x1b8)]({'where':{'id':_0x28eeb4[_0x4ebe02(0x14b)]['id'],'companyId':_0x22b072}});if(!_0x210150){if(await(0x0,VerifyHandlers_1['verifyRecentCampaign'])(_0x28eeb4,_0x22b072))return;await handleMessage(_0x28eeb4,_0x89e4f,_0x22b072);}});}),_0x89e4f['ev']['on'](_0x4bf80a(0xf8),_0x3bf129=>{const _0xcef801=_0x4bf80a;if(_0x3bf129[_0xcef801(0x1ce)]===0x0)return;_0x3bf129[_0xcef801(0x114)](async _0x4f8adb=>{const _0x58b81d=_0xcef801;_0x89e4f[_0x58b81d(0xfe)]([_0x4f8adb[_0x58b81d(0x14b)]]),await ackMutex[_0x58b81d(0x1e2)](async()=>{const _0x4ff65c=_0x58b81d;handleMsgAck(_0x4f8adb,_0x4f8adb[_0x4ff65c(0x18a)][_0x4ff65c(0x194)]);});});});}catch(_0x483386){Sentry[_0x4bf80a(0x15a)](_0x483386),logger_1['logger'][_0x4bf80a(0x184)](_0x4bf80a(0x129)+_0x483386);}};exports['wbotMessageListener']=wbotMessageListener;