const a550_0x2f75c3=a550_0x1143;(function(_0x473326,_0x52de93){const _0x2f4f55=a550_0x1143,_0x58b79e=_0x473326();while(!![]){try{const _0x35af72=-parseInt(_0x2f4f55(0xdb))/0x1*(parseInt(_0x2f4f55(0xf3))/0x2)+parseInt(_0x2f4f55(0xd8))/0x3+parseInt(_0x2f4f55(0xe5))/0x4+parseInt(_0x2f4f55(0xd1))/0x5*(-parseInt(_0x2f4f55(0xef))/0x6)+-parseInt(_0x2f4f55(0xda))/0x7*(-parseInt(_0x2f4f55(0xd4))/0x8)+parseInt(_0x2f4f55(0xfc))/0x9*(-parseInt(_0x2f4f55(0xcd))/0xa)+parseInt(_0x2f4f55(0xd6))/0xb;if(_0x35af72===_0x52de93)break;else _0x58b79e['push'](_0x58b79e['shift']());}catch(_0x55b26f){_0x58b79e['push'](_0x58b79e['shift']());}}}(a550_0x3a29,0xc06b2));const a550_0x5ba3f5=(function(){let _0x495ba1=!![];return function(_0x29acfa,_0x66d57b){const _0x4112fa=_0x495ba1?function(){const _0x4b7b0f=a550_0x1143;if(_0x66d57b){const _0x5eec56=_0x66d57b[_0x4b7b0f(0xe7)](_0x29acfa,arguments);return _0x66d57b=null,_0x5eec56;}}:function(){};return _0x495ba1=![],_0x4112fa;};}()),a550_0x47fe41=a550_0x5ba3f5(this,function(){const _0x24a901=a550_0x1143;return a550_0x47fe41['toString']()[_0x24a901(0xeb)](_0x24a901(0xdd))[_0x24a901(0xe2)]()[_0x24a901(0xe6)](a550_0x47fe41)['search'](_0x24a901(0xdd));});a550_0x47fe41();'use strict';function a550_0x1143(_0xd1cfab,_0x738fa8){const _0x3e5894=a550_0x3a29();return a550_0x1143=function(_0x47fe41,_0x5ba3f5){_0x47fe41=_0x47fe41-0xc8;let _0x3a2942=_0x3e5894[_0x47fe41];return _0x3a2942;},a550_0x1143(_0xd1cfab,_0x738fa8);}var __createBinding=this&&this[a550_0x2f75c3(0xee)]||(Object['create']?function(_0x19f282,_0x2340ab,_0x1e6836,_0xf6a4ea){const _0x528a44=a550_0x2f75c3;if(_0xf6a4ea===undefined)_0xf6a4ea=_0x1e6836;var _0x6e4588=Object['getOwnPropertyDescriptor'](_0x2340ab,_0x1e6836);(!_0x6e4588||('get'in _0x6e4588?!_0x2340ab[_0x528a44(0xf1)]:_0x6e4588[_0x528a44(0xf4)]||_0x6e4588[_0x528a44(0xf7)]))&&(_0x6e4588={'enumerable':!![],'get':function(){return _0x2340ab[_0x1e6836];}}),Object[_0x528a44(0xcb)](_0x19f282,_0xf6a4ea,_0x6e4588);}:function(_0x1704ba,_0x5524ee,_0xda54af,_0xce4466){if(_0xce4466===undefined)_0xce4466=_0xda54af;_0x1704ba[_0xce4466]=_0x5524ee[_0xda54af];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x288444,_0x2bcfb5){const _0x4bd92e=a550_0x2f75c3;Object[_0x4bd92e(0xcb)](_0x288444,_0x4bd92e(0xcc),{'enumerable':!![],'value':_0x2bcfb5});}:function(_0xebf40f,_0x517b23){const _0x390c7c=a550_0x2f75c3;_0xebf40f[_0x390c7c(0xcc)]=_0x517b23;}),__importStar=this&&this[a550_0x2f75c3(0xd3)]||function(_0x7c163){const _0xc926e0=a550_0x2f75c3;if(_0x7c163&&_0x7c163[_0xc926e0(0xf1)])return _0x7c163;var _0x5a72a1={};if(_0x7c163!=null){for(var _0x25d128 in _0x7c163)if(_0x25d128!==_0xc926e0(0xcc)&&Object[_0xc926e0(0xe3)][_0xc926e0(0xea)][_0xc926e0(0xe1)](_0x7c163,_0x25d128))__createBinding(_0x5a72a1,_0x7c163,_0x25d128);}return __setModuleDefault(_0x5a72a1,_0x7c163),_0x5a72a1;},__importDefault=this&&this[a550_0x2f75c3(0xed)]||function(_0x5ba730){return _0x5ba730&&_0x5ba730['__esModule']?_0x5ba730:{'default':_0x5ba730};};Object[a550_0x2f75c3(0xcb)](exports,a550_0x2f75c3(0xf1),{'value':!![]});const Sentry=__importStar(require('@sentry/node')),AppError_1=__importDefault(require(a550_0x2f75c3(0xd0))),GetTicketWbot_1=__importDefault(require(a550_0x2f75c3(0xce))),Message_1=__importDefault(require(a550_0x2f75c3(0xf0))),lodash_1=__importDefault(require(a550_0x2f75c3(0xd7))),Mustache_1=__importDefault(require(a550_0x2f75c3(0xf6))),SendWhatsAppMessage=async({body:_0x1b2147,ticket:_0x2c5922,quotedMsg:_0x51d488,vCard:_0xd9e96f})=>{const _0x548cb4=a550_0x2f75c3;let _0x322e97={};const _0x447d7e=await(0x0,GetTicketWbot_1[_0x548cb4(0xcc)])(_0x2c5922);if(!_0x447d7e)throw new AppError_1[(_0x548cb4(0xcc))](_0x548cb4(0xd5));const _0x12f101=_0x2c5922[_0x548cb4(0xde)]['number']+'@'+(_0x2c5922['isGroup']?_0x548cb4(0xf2):'s.whatsapp.net');if(_0x51d488){const _0x2a9827=await Message_1[_0x548cb4(0xcc)][_0x548cb4(0xca)]({'where':{'id':_0x51d488['id']}});if(_0x2a9827){const _0x11f8c4=JSON[_0x548cb4(0xdc)](_0x2a9827[_0x548cb4(0xf9)]);_0x322e97={'quoted':{'key':_0x11f8c4[_0x548cb4(0xe9)]||_0x2a9827['id'],'message':{'extendedTextMessage':_0x11f8c4?.[_0x548cb4(0xfa)][_0x548cb4(0xe0)]}}};}}if(!lodash_1[_0x548cb4(0xcc)][_0x548cb4(0xdf)](_0xd9e96f)){const _0x47bc96=_0xd9e96f[_0x548cb4(0xf8)],_0x4ad4c8=_0xd9e96f[_0x548cb4(0xe8)][_0x548cb4(0xf5)]('\x20')[0x0],_0x21c133=String(_0xd9e96f[_0x548cb4(0xe8)])['replace'](_0xd9e96f[_0x548cb4(0xe8)][_0x548cb4(0xf5)]('\x20')[0x0],''),_0x48d9c0=_0x548cb4(0xe4)+('N:'+_0x21c133+';'+_0x4ad4c8+_0x548cb4(0xd2))+(_0x548cb4(0xd9)+_0xd9e96f[_0x548cb4(0xe8)]+'\x0a')+(_0x548cb4(0xec)+_0x47bc96+':+'+_0x47bc96+'\x0a')+'END:VCARD';try{const _0x852d3b=await _0x447d7e[_0x548cb4(0xc8)](_0x12f101,{'contacts':{'displayName':''+_0xd9e96f[_0x548cb4(0xe8)],'contacts':[{'vcard':_0x48d9c0}]}});return await _0x2c5922[_0x548cb4(0xfb)]({'lastMessage':(0x0,Mustache_1[_0x548cb4(0xcc)])(_0x48d9c0,_0x2c5922),'imported':null}),_0x852d3b;}catch(_0xc7c595){Sentry['captureException'](_0xc7c595),console['trace'](_0xc7c595);throw new AppError_1[(_0x548cb4(0xcc))]('ERR_SENDING_WAPP_MSG');}}try{const _0x497b01=await _0x447d7e[_0x548cb4(0xc8)](_0x12f101,{'text':(0x0,Mustache_1[_0x548cb4(0xcc)])(_0x1b2147,_0x2c5922)},{..._0x322e97});return await _0x2c5922['update']({'lastMessage':(0x0,Mustache_1[_0x548cb4(0xcc)])(_0x1b2147,_0x2c5922)}),_0x497b01;}catch(_0x3d3bfa){Sentry[_0x548cb4(0xc9)](_0x3d3bfa),console[_0x548cb4(0xcf)](_0x3d3bfa);throw new AppError_1[(_0x548cb4(0xcc))]('ERR_SENDING_WAPP_MSG');}};function a550_0x3a29(){const _0x1e7958=['(((.+)+)+)+$','contact','isNil','extendedTextMessage','call','toString','prototype','BEGIN:VCARD\x0aVERSION:3.0\x0a','5470960eLTNxG','constructor','apply','name','key','hasOwnProperty','search','TEL;type=CELL;waid=','__importDefault','__createBinding','4233048YiaUsn','../../models/Message','__esModule','g.us','8938LGIEdu','writable','split','../../helpers/Mustache','configurable','number','dataJson','message','update','34731uBBzFk','sendMessage','captureException','findOne','defineProperty','default','1940tugrVf','../../helpers/GetTicketWbot','log','../../errors/AppError','5XYFFPP',';;;\x0a','__importStar','1585648bcjDTp','ERR_WBOT_NOT_FOUND','23991154xIcigb','lodash','30993Utypgc','FN:','7FAzfxX','339tVqcxb','parse'];a550_0x3a29=function(){return _0x1e7958;};return a550_0x3a29();}exports['default']=SendWhatsAppMessage;