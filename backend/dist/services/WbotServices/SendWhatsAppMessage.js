const a552_0x1a7b25=a552_0x5328;function a552_0x5328(_0xfbd9a5,_0x390961){const _0x53ad92=a552_0x1e39();return a552_0x5328=function(_0x7f0199,_0x574cf2){_0x7f0199=_0x7f0199-0x70;let _0x1e397c=_0x53ad92[_0x7f0199];return _0x1e397c;},a552_0x5328(_0xfbd9a5,_0x390961);}(function(_0x26d12f,_0x3228a0){const _0x4276c6=a552_0x5328,_0x2b80b9=_0x26d12f();while(!![]){try{const _0x3ecebd=-parseInt(_0x4276c6(0x7a))/0x1+parseInt(_0x4276c6(0x9e))/0x2*(-parseInt(_0x4276c6(0x84))/0x3)+-parseInt(_0x4276c6(0x72))/0x4+-parseInt(_0x4276c6(0x7b))/0x5*(parseInt(_0x4276c6(0x71))/0x6)+parseInt(_0x4276c6(0x73))/0x7*(-parseInt(_0x4276c6(0xa3))/0x8)+-parseInt(_0x4276c6(0xa2))/0x9+-parseInt(_0x4276c6(0x9d))/0xa*(-parseInt(_0x4276c6(0x70))/0xb);if(_0x3ecebd===_0x3228a0)break;else _0x2b80b9['push'](_0x2b80b9['shift']());}catch(_0x5b221d){_0x2b80b9['push'](_0x2b80b9['shift']());}}}(a552_0x1e39,0xa7ed7));const a552_0x574cf2=(function(){let _0x33321a=!![];return function(_0xc333,_0x54e763){const _0x298a7e=_0x33321a?function(){const _0x40122a=a552_0x5328;if(_0x54e763){const _0x1a520e=_0x54e763[_0x40122a(0x95)](_0xc333,arguments);return _0x54e763=null,_0x1a520e;}}:function(){};return _0x33321a=![],_0x298a7e;};}()),a552_0x7f0199=a552_0x574cf2(this,function(){const _0x273367=a552_0x5328;return a552_0x7f0199[_0x273367(0x96)]()['search'](_0x273367(0x7c))['toString']()[_0x273367(0x7e)](a552_0x7f0199)[_0x273367(0x77)](_0x273367(0x7c));});a552_0x7f0199();'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x769f29,_0x5547a4,_0x5b23a9,_0x4bd14f){const _0x4cfc9e=a552_0x5328;if(_0x4bd14f===undefined)_0x4bd14f=_0x5b23a9;var _0x5728f0=Object[_0x4cfc9e(0x94)](_0x5547a4,_0x5b23a9);(!_0x5728f0||(_0x4cfc9e(0x8d)in _0x5728f0?!_0x5547a4[_0x4cfc9e(0x74)]:_0x5728f0['writable']||_0x5728f0[_0x4cfc9e(0x9a)]))&&(_0x5728f0={'enumerable':!![],'get':function(){return _0x5547a4[_0x5b23a9];}}),Object[_0x4cfc9e(0x99)](_0x769f29,_0x4bd14f,_0x5728f0);}:function(_0x505271,_0xe5702d,_0x2fbd7c,_0x46af9d){if(_0x46af9d===undefined)_0x46af9d=_0x2fbd7c;_0x505271[_0x46af9d]=_0xe5702d[_0x2fbd7c];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a552_0x1a7b25(0x8c)]?function(_0xbd742c,_0x1b4988){const _0x7a114f=a552_0x1a7b25;Object['defineProperty'](_0xbd742c,_0x7a114f(0x75),{'enumerable':!![],'value':_0x1b4988});}:function(_0x34e99e,_0x2c0816){const _0x2d2452=a552_0x1a7b25;_0x34e99e[_0x2d2452(0x75)]=_0x2c0816;}),__importStar=this&&this[a552_0x1a7b25(0x85)]||function(_0x337d4e){const _0x41cf41=a552_0x1a7b25;if(_0x337d4e&&_0x337d4e[_0x41cf41(0x74)])return _0x337d4e;var _0x539f60={};if(_0x337d4e!=null){for(var _0x48320e in _0x337d4e)if(_0x48320e!==_0x41cf41(0x75)&&Object['prototype'][_0x41cf41(0x8a)][_0x41cf41(0x83)](_0x337d4e,_0x48320e))__createBinding(_0x539f60,_0x337d4e,_0x48320e);}return __setModuleDefault(_0x539f60,_0x337d4e),_0x539f60;},__importDefault=this&&this[a552_0x1a7b25(0x82)]||function(_0x1e8156){return _0x1e8156&&_0x1e8156['__esModule']?_0x1e8156:{'default':_0x1e8156};};Object[a552_0x1a7b25(0x99)](exports,a552_0x1a7b25(0x74),{'value':!![]});const Sentry=__importStar(require('@sentry/node')),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require(a552_0x1a7b25(0x8e))),Message_1=__importDefault(require(a552_0x1a7b25(0x7f))),lodash_1=__importDefault(require(a552_0x1a7b25(0x9f))),Mustache_1=__importDefault(require('../../helpers/Mustache')),SendWhatsAppMessage=async({body:_0x363bb3,ticket:_0x45df62,quotedMsg:_0x48a942,vCard:_0x14a8bc})=>{const _0xe07db=a552_0x1a7b25;let _0x513546={};const _0x988f79=await(0x0,GetTicketWbot_1['default'])(_0x45df62);if(!_0x988f79)throw new AppError_1[(_0xe07db(0x75))]('ERR_WBOT_NOT_FOUND');const _0x68fdfc=_0x45df62['contact'][_0xe07db(0x8f)]+'@'+(_0x45df62['isGroup']?'g.us':_0xe07db(0x93));if(_0x48a942){const _0x242043=await Message_1[_0xe07db(0x75)][_0xe07db(0x76)]({'where':{'id':_0x48a942['id']}});if(_0x242043){const _0xd4f219=JSON[_0xe07db(0x81)](_0x242043[_0xe07db(0x78)]);_0x513546={'quoted':{'key':_0xd4f219[_0xe07db(0x98)]||_0x242043['id'],'message':{'extendedTextMessage':_0xd4f219?.[_0xe07db(0x90)][_0xe07db(0x9b)]}}};}}if(!lodash_1[_0xe07db(0x75)][_0xe07db(0x97)](_0x14a8bc)){const _0x351e5b=_0x14a8bc[_0xe07db(0x8f)],_0x362c25=_0x14a8bc[_0xe07db(0xa0)][_0xe07db(0x92)]('\x20')[0x0],_0x3c2a0e=String(_0x14a8bc[_0xe07db(0xa0)])[_0xe07db(0x79)](_0x14a8bc['name'][_0xe07db(0x92)]('\x20')[0x0],''),_0x5419a0=_0xe07db(0xa1)+('N:'+_0x3c2a0e+';'+_0x362c25+_0xe07db(0x80))+(_0xe07db(0x86)+_0x14a8bc[_0xe07db(0xa0)]+'\x0a')+(_0xe07db(0x8b)+_0x351e5b+':+'+_0x351e5b+'\x0a')+_0xe07db(0x9c);try{const _0x3516d5=await _0x988f79[_0xe07db(0x7d)](_0x68fdfc,{'contacts':{'displayName':''+_0x14a8bc[_0xe07db(0xa0)],'contacts':[{'vcard':_0x5419a0}]}});return await _0x45df62[_0xe07db(0x87)]({'lastMessage':(0x0,Mustache_1[_0xe07db(0x75)])(_0x5419a0,_0x45df62),'imported':null}),_0x3516d5;}catch(_0x3209f5){Sentry[_0xe07db(0x88)](_0x3209f5),console[_0xe07db(0x91)](_0x3209f5);throw new AppError_1['default'](_0xe07db(0x89));}}try{const _0x2bf8b2=await _0x988f79['sendMessage'](_0x68fdfc,{'text':(0x0,Mustache_1[_0xe07db(0x75)])(_0x363bb3,_0x45df62)},{..._0x513546});return await _0x45df62[_0xe07db(0x87)]({'lastMessage':(0x0,Mustache_1[_0xe07db(0x75)])(_0x363bb3,_0x45df62)}),_0x2bf8b2;}catch(_0x36d092){Sentry[_0xe07db(0x88)](_0x36d092),console['log'](_0x36d092);throw new AppError_1[(_0xe07db(0x75))]('ERR_SENDING_WAPP_MSG');}};exports[a552_0x1a7b25(0x75)]=SendWhatsAppMessage;function a552_0x1e39(){const _0x14b0b1=['toString','isNil','key','defineProperty','configurable','extendedTextMessage','END:VCARD','10VdSPlD','1631922tLpSpB','lodash','name','BEGIN:VCARD\x0aVERSION:3.0\x0a','2231073zIzyYq','1654728HBHZKk','43577314APKsUF','86136EYpEqr','1092348sumnGm','28aiublV','__esModule','default','findOne','search','dataJson','replace','678754kOmSib','150ULvejO','(((.+)+)+)+$','sendMessage','constructor','../../models/Message',';;;\x0a','parse','__importDefault','call','3ezZAtp','__importStar','FN:','update','captureException','ERR_SENDING_WAPP_MSG','hasOwnProperty','TEL;type=CELL;waid=','create','get','../../helpers/GetTicketWbot','number','message','trace','split','s.whatsapp.net','getOwnPropertyDescriptor','apply'];a552_0x1e39=function(){return _0x14b0b1;};return a552_0x1e39();}