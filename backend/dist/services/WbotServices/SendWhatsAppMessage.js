const a550_0x42c216=a550_0x548d;(function(_0x288c78,_0x584998){const _0x264f9c=a550_0x548d,_0x1241dc=_0x288c78();while(!![]){try{const _0x5d1695=parseInt(_0x264f9c(0x1de))/0x1*(parseInt(_0x264f9c(0x1cc))/0x2)+-parseInt(_0x264f9c(0x1d3))/0x3+-parseInt(_0x264f9c(0x1d1))/0x4*(parseInt(_0x264f9c(0x1b9))/0x5)+parseInt(_0x264f9c(0x1ba))/0x6*(-parseInt(_0x264f9c(0x1b0))/0x7)+-parseInt(_0x264f9c(0x1b2))/0x8+-parseInt(_0x264f9c(0x1cd))/0x9+-parseInt(_0x264f9c(0x1d7))/0xa*(-parseInt(_0x264f9c(0x1c4))/0xb);if(_0x5d1695===_0x584998)break;else _0x1241dc['push'](_0x1241dc['shift']());}catch(_0x2805cb){_0x1241dc['push'](_0x1241dc['shift']());}}}(a550_0x3254,0x53706));const a550_0x2f9df3=(function(){let _0x459edc=!![];return function(_0x3f7bd5,_0x28a980){const _0x31eed4=_0x459edc?function(){if(_0x28a980){const _0x326443=_0x28a980['apply'](_0x3f7bd5,arguments);return _0x28a980=null,_0x326443;}}:function(){};return _0x459edc=![],_0x31eed4;};}()),a550_0x121b3a=a550_0x2f9df3(this,function(){const _0x496746=a550_0x548d;return a550_0x121b3a[_0x496746(0x1d8)]()[_0x496746(0x1b7)](_0x496746(0x1d6))['toString']()[_0x496746(0x1be)](a550_0x121b3a)['search'](_0x496746(0x1d6));});a550_0x121b3a();function a550_0x548d(_0x25d502,_0x5b803e){const _0x4aa544=a550_0x3254();return a550_0x548d=function(_0x121b3a,_0x2f9df3){_0x121b3a=_0x121b3a-0x1af;let _0x325488=_0x4aa544[_0x121b3a];return _0x325488;},a550_0x548d(_0x25d502,_0x5b803e);}'use strict';var __createBinding=this&&this[a550_0x42c216(0x1dd)]||(Object[a550_0x42c216(0x1bd)]?function(_0x5f1a02,_0x442e7a,_0x41294d,_0x247c89){const _0x4034d5=a550_0x42c216;if(_0x247c89===undefined)_0x247c89=_0x41294d;var _0x53726e=Object[_0x4034d5(0x1e2)](_0x442e7a,_0x41294d);(!_0x53726e||(_0x4034d5(0x1b4)in _0x53726e?!_0x442e7a[_0x4034d5(0x1d0)]:_0x53726e[_0x4034d5(0x1cf)]||_0x53726e[_0x4034d5(0x1ca)]))&&(_0x53726e={'enumerable':!![],'get':function(){return _0x442e7a[_0x41294d];}}),Object[_0x4034d5(0x1bb)](_0x5f1a02,_0x247c89,_0x53726e);}:function(_0x564666,_0x1be4cd,_0x47b85b,_0x223c6e){if(_0x223c6e===undefined)_0x223c6e=_0x47b85b;_0x564666[_0x223c6e]=_0x1be4cd[_0x47b85b];}),__setModuleDefault=this&&this[a550_0x42c216(0x1e3)]||(Object[a550_0x42c216(0x1bd)]?function(_0x4b2e54,_0x3158df){const _0x372817=a550_0x42c216;Object['defineProperty'](_0x4b2e54,_0x372817(0x1d5),{'enumerable':!![],'value':_0x3158df});}:function(_0x235185,_0x2b6084){const _0x5152a4=a550_0x42c216;_0x235185[_0x5152a4(0x1d5)]=_0x2b6084;}),__importStar=this&&this[a550_0x42c216(0x1ce)]||function(_0x4f7952){const _0x5a6faf=a550_0x42c216;if(_0x4f7952&&_0x4f7952[_0x5a6faf(0x1d0)])return _0x4f7952;var _0x449ab2={};if(_0x4f7952!=null){for(var _0x319a15 in _0x4f7952)if(_0x319a15!==_0x5a6faf(0x1d5)&&Object[_0x5a6faf(0x1af)][_0x5a6faf(0x1b8)]['call'](_0x4f7952,_0x319a15))__createBinding(_0x449ab2,_0x4f7952,_0x319a15);}return __setModuleDefault(_0x449ab2,_0x4f7952),_0x449ab2;},__importDefault=this&&this[a550_0x42c216(0x1e1)]||function(_0x70ab4b){return _0x70ab4b&&_0x70ab4b['__esModule']?_0x70ab4b:{'default':_0x70ab4b};};Object['defineProperty'](exports,a550_0x42c216(0x1d0),{'value':!![]});const Sentry=__importStar(require(a550_0x42c216(0x1c8))),AppError_1=__importDefault(require(a550_0x42c216(0x1c1))),GetTicketWbot_1=__importDefault(require(a550_0x42c216(0x1c5))),Message_1=__importDefault(require('../../models/Message')),lodash_1=__importDefault(require('lodash')),Mustache_1=__importDefault(require('../../helpers/Mustache')),SendWhatsAppMessage=async({body:_0x1173f0,ticket:_0x4c223c,quotedMsg:_0x390f8d,vCard:_0x4282ca})=>{const _0x433d6e=a550_0x42c216;let _0x502d29={};const _0xefc1a2=await(0x0,GetTicketWbot_1[_0x433d6e(0x1d5)])(_0x4c223c);if(!_0xefc1a2)throw new AppError_1[(_0x433d6e(0x1d5))](_0x433d6e(0x1bf));const _0x277a5a=_0x4c223c[_0x433d6e(0x1d4)][_0x433d6e(0x1b3)]+'@'+(_0x4c223c['isGroup']?'g.us':_0x433d6e(0x1b5));if(_0x390f8d){const _0x4862af=await Message_1['default'][_0x433d6e(0x1c2)]({'where':{'id':_0x390f8d['id']}});if(_0x4862af){const _0x4abc1a=JSON[_0x433d6e(0x1c9)](_0x4862af[_0x433d6e(0x1cb)]);_0x502d29={'quoted':{'key':_0x4abc1a[_0x433d6e(0x1d9)]||_0x4862af['id'],'message':{'extendedTextMessage':_0x4abc1a?.[_0x433d6e(0x1db)]['extendedTextMessage']}}};}}if(!lodash_1[_0x433d6e(0x1d5)][_0x433d6e(0x1c6)](_0x4282ca)){const _0x355dc7=_0x4282ca['number'],_0x4a26a7=_0x4282ca[_0x433d6e(0x1df)][_0x433d6e(0x1b6)]('\x20')[0x0],_0x5c7e3f=String(_0x4282ca['name'])[_0x433d6e(0x1bc)](_0x4282ca['name']['split']('\x20')[0x0],''),_0x30cc58='BEGIN:VCARD\x0aVERSION:3.0\x0a'+('N:'+_0x5c7e3f+';'+_0x4a26a7+_0x433d6e(0x1e0))+('FN:'+_0x4282ca[_0x433d6e(0x1df)]+'\x0a')+(_0x433d6e(0x1da)+_0x355dc7+':+'+_0x355dc7+'\x0a')+_0x433d6e(0x1c0);try{const _0x4774f2=await _0xefc1a2[_0x433d6e(0x1b1)](_0x277a5a,{'contacts':{'displayName':''+_0x4282ca[_0x433d6e(0x1df)],'contacts':[{'vcard':_0x30cc58}]}});return await _0x4c223c['update']({'lastMessage':(0x0,Mustache_1[_0x433d6e(0x1d5)])(_0x30cc58,_0x4c223c),'imported':null}),_0x4774f2;}catch(_0x3ca2d2){Sentry['captureException'](_0x3ca2d2),console[_0x433d6e(0x1c3)](_0x3ca2d2);throw new AppError_1[(_0x433d6e(0x1d5))]('ERR_SENDING_WAPP_MSG');}}try{const _0x27af2e=await _0xefc1a2['sendMessage'](_0x277a5a,{'text':(0x0,Mustache_1[_0x433d6e(0x1d5)])(_0x1173f0,_0x4c223c)},{..._0x502d29});return await _0x4c223c[_0x433d6e(0x1dc)]({'lastMessage':(0x0,Mustache_1[_0x433d6e(0x1d5)])(_0x1173f0,_0x4c223c)}),_0x27af2e;}catch(_0x3d4d92){Sentry['captureException'](_0x3d4d92),console[_0x433d6e(0x1d2)](_0x3d4d92);throw new AppError_1[(_0x433d6e(0x1d5))](_0x433d6e(0x1c7));}};function a550_0x3254(){const _0x11e43d=['isNil','ERR_SENDING_WAPP_MSG','@sentry/node','parse','configurable','dataJson','1552FtuPDq','4473558XKzrnn','__importStar','writable','__esModule','2672372NMpLVK','log','1276113SQgIFE','contact','default','(((.+)+)+)+$','306080DAVfdh','toString','key','TEL;type=CELL;waid=','message','update','__createBinding','288JqQgqp','name',';;;\x0a','__importDefault','getOwnPropertyDescriptor','__setModuleDefault','prototype','1267525HFLLvc','sendMessage','2776624BSmCaI','number','get','s.whatsapp.net','split','search','hasOwnProperty','5APCofp','12bOwZab','defineProperty','replace','create','constructor','ERR_WBOT_NOT_FOUND','END:VCARD','../../errors/AppError','findOne','trace','869MFnotD','../../helpers/GetTicketWbot'];a550_0x3254=function(){return _0x11e43d;};return a550_0x3254();}exports['default']=SendWhatsAppMessage;