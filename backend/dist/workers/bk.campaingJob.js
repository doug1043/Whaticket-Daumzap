const a574_0x3eaeaf=a574_0x1ee7;(function(_0x654918,_0x32874d){const _0x541417=a574_0x1ee7,_0x2190b3=_0x654918();while(!![]){try{const _0x3aa4fb=parseInt(_0x541417(0xc1))/0x1+-parseInt(_0x541417(0x121))/0x2*(-parseInt(_0x541417(0x91))/0x3)+parseInt(_0x541417(0xfa))/0x4+-parseInt(_0x541417(0xa3))/0x5+-parseInt(_0x541417(0xad))/0x6+parseInt(_0x541417(0xe7))/0x7*(-parseInt(_0x541417(0x106))/0x8)+-parseInt(_0x541417(0xbc))/0x9*(-parseInt(_0x541417(0x107))/0xa);if(_0x3aa4fb===_0x32874d)break;else _0x2190b3['push'](_0x2190b3['shift']());}catch(_0x3055ce){_0x2190b3['push'](_0x2190b3['shift']());}}}(a574_0x468a,0xdc6ac));const a574_0x20671a=(function(){let _0x495d23=!![];return function(_0x3afc33,_0x28ae42){const _0x1f8bdc=_0x495d23?function(){const _0x4664f8=a574_0x1ee7;if(_0x28ae42){const _0xdba5af=_0x28ae42[_0x4664f8(0xaa)](_0x3afc33,arguments);return _0x28ae42=null,_0xdba5af;}}:function(){};return _0x495d23=![],_0x1f8bdc;};}()),a574_0xda1f9f=a574_0x20671a(this,function(){const _0x39a648=a574_0x1ee7;return a574_0xda1f9f[_0x39a648(0x8d)]()[_0x39a648(0xae)](_0x39a648(0xda))[_0x39a648(0x8d)]()[_0x39a648(0x104)](a574_0xda1f9f)[_0x39a648(0xae)](_0x39a648(0xda));});a574_0xda1f9f();'use strict';var __createBinding=this&&this[a574_0x3eaeaf(0xb0)]||(Object[a574_0x3eaeaf(0xbe)]?function(_0x8dad6b,_0x5b24f0,_0x19995f,_0x7d6d20){const _0x361e8c=a574_0x3eaeaf;if(_0x7d6d20===undefined)_0x7d6d20=_0x19995f;var _0x4cc9cf=Object[_0x361e8c(0x10e)](_0x5b24f0,_0x19995f);(!_0x4cc9cf||(_0x361e8c(0x108)in _0x4cc9cf?!_0x5b24f0['__esModule']:_0x4cc9cf[_0x361e8c(0xa1)]||_0x4cc9cf[_0x361e8c(0xbb)]))&&(_0x4cc9cf={'enumerable':!![],'get':function(){return _0x5b24f0[_0x19995f];}}),Object['defineProperty'](_0x8dad6b,_0x7d6d20,_0x4cc9cf);}:function(_0x4857c8,_0x1e9195,_0x50aef2,_0x3af654){if(_0x3af654===undefined)_0x3af654=_0x50aef2;_0x4857c8[_0x3af654]=_0x1e9195[_0x50aef2];}),__setModuleDefault=this&&this[a574_0x3eaeaf(0xff)]||(Object[a574_0x3eaeaf(0xbe)]?function(_0x38ef6a,_0x5737b7){Object['defineProperty'](_0x38ef6a,'default',{'enumerable':!![],'value':_0x5737b7});}:function(_0x1a4636,_0x2582cb){_0x1a4636['default']=_0x2582cb;}),__importStar=this&&this[a574_0x3eaeaf(0x9f)]||function(_0x3e204a){const _0x28a3a3=a574_0x3eaeaf;if(_0x3e204a&&_0x3e204a[_0x28a3a3(0xc4)])return _0x3e204a;var _0x16a555={};if(_0x3e204a!=null){for(var _0x942f5c in _0x3e204a)if(_0x942f5c!==_0x28a3a3(0xf5)&&Object[_0x28a3a3(0xc7)][_0x28a3a3(0xac)][_0x28a3a3(0xc8)](_0x3e204a,_0x942f5c))__createBinding(_0x16a555,_0x3e204a,_0x942f5c);}return __setModuleDefault(_0x16a555,_0x3e204a),_0x16a555;},__importDefault=this&&this[a574_0x3eaeaf(0x9e)]||function(_0x1fc23b){return _0x1fc23b&&_0x1fc23b['__esModule']?_0x1fc23b:{'default':_0x1fc23b};};Object['defineProperty'](exports,a574_0x3eaeaf(0xc4),{'value':!![]});function a574_0x1ee7(_0x331404,_0x5e4d3c){const _0x53d4b1=a574_0x468a();return a574_0x1ee7=function(_0xda1f9f,_0x20671a){_0xda1f9f=_0xda1f9f-0x8c;let _0x468a81=_0x53d4b1[_0xda1f9f];return _0x468a81;},a574_0x1ee7(_0x331404,_0x5e4d3c);}const bullmq_1=require(a574_0x3eaeaf(0x125)),Campaign_1=__importDefault(require(a574_0x3eaeaf(0xa9))),sequelize_1=require(a574_0x3eaeaf(0xec)),logger_1=require('../utils/logger'),moment_1=__importDefault(require('moment/moment')),Sentry=__importStar(require(a574_0x3eaeaf(0xd8))),ContactList_1=__importDefault(require(a574_0x3eaeaf(0xa8))),ContactListItem_1=__importDefault(require(a574_0x3eaeaf(0xcf))),Whatsapp_1=__importDefault(require(a574_0x3eaeaf(0xa0))),CampaignShipping_1=__importDefault(require(a574_0x3eaeaf(0x9c))),queues_1=require(a574_0x3eaeaf(0xf0)),lodash_1=require(a574_0x3eaeaf(0x9b)),date_fns_1=require(a574_0x3eaeaf(0xd9)),GetWhatsappWbot_1=__importDefault(require('../helpers/GetWhatsappWbot')),path_1=__importDefault(require(a574_0x3eaeaf(0xb8))),ShowService_1=__importDefault(require('../services/FileServices/ShowService')),SendWhatsAppMedia_1=require(a574_0x3eaeaf(0x123)),socket_1=require(a574_0x3eaeaf(0xcd)),CampaignSetting_1=__importDefault(require(a574_0x3eaeaf(0x128))),SendPresenceStatus_1=require(a574_0x3eaeaf(0xd1));function a574_0x468a(){const _0x2dc8a2=['FINALIZADA','error','handleProcessCampaign','campaignQueue','parse','2177eSNvMt','completed','handlePrepareContact','Job\x20','companyId','sequelize','findAll','getCampaign','set','../queues','longerIntervalAfter','save','logger','calculateDelay','default','message2','name','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20user\x20not\x20found','value','1834164TRBHOj','ProcessCampaign','campaignId','diff',')\x20completed','__setModuleDefault','key','contactList','message1','contact','constructor','number','24968uikuLy','861460vPDsua','get','trimEnd','failed','-mainchannel','forEach','PROGRAMADA','getOwnPropertyDescriptor','getTime','lte','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20whatsapp\x20not\x20found','trimStart',';Contato=','emit','EM_ANDAMENTO','{nome}','calculateOptimizedDelay','scheduledAt','message3','update','resolve',';Registro=','push','Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha=','info','captureException','484258HBxjov','message5','../services/WbotServices/SendWhatsAppMedia','No\x20contacts\x20found\x20for\x20this\x20campaign','bullmq','findOrCreate','findByPk','../models/CampaignSetting','contactId','all','fileList','VerifyCampaigns','random','min','messageInterval','toString','mediaName','verifyAndFinalizeCampaign','reject','12ackJSN','getIO','{numero}','{email}','getCampaignValidMessages','Campanha\x20enviada\x20para:\x20Campanha=','floor','milliseconds','replace','SendPresenceStatus','lodash','../models/CampaignShipping','mediaPath','__importDefault','__importStar','../models/Whatsapp','writable','fileListId','2103010xKlxFi','company-','variables','isWhatsappValid','contacts','../models/ContactList','../models/Campaign','apply','getProcessedMessage','hasOwnProperty','7530264YCCxbO','search','company','__createBinding','isEmpty',',\x20Delay\x20Inicial=','DispatchCampaign','map','includes','handleVerifyCampaigns','length','path','getContact','ContactList\x20not\x20found\x20or\x20empty','configurable','81ocCCbZ','Error','create','public','join','1346734rqHBtQ','options','shipping','__esModule','user','message4','prototype','call','whatsapp','getSettings','PrepareContact','Campaign\x20or\x20ContactList\x20not\x20found','../libs/socket','deliveredAt','../models/ContactListItem','getMessageOptions','../helpers/SendPresenceStatus','data','-campaign','Error\x20sending\x20campaign\x20media:\x20','\x20failed\x20with\x20error:\x20','isNil','Worker','@sentry/node','date-fns','(((.+)+)+)+$','not','email','sendMessage','message','add','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','handleDispatchCampaign'];a574_0x468a=function(){return _0x2dc8a2;};return a574_0x468a();}class CampaingJob{constructor(_0x2baf3,_0x4b2a16){const _0x366fb2=a574_0x3eaeaf,_0x596d23=new bullmq_1[(_0x366fb2(0xd7))](_0x2baf3,async _0x4e5dba=>{const _0x1836bd=_0x366fb2;if(_0x4e5dba['name']===_0x1836bd(0x12c))await this[_0x1836bd(0xb6)](_0x4e5dba);else{if(_0x4e5dba[_0x1836bd(0xf7)]===_0x1836bd(0xfb))await this[_0x1836bd(0xe4)](_0x4e5dba);else{if(_0x4e5dba['name']==='PrepareContact')await this[_0x1836bd(0xe9)](_0x4e5dba);else _0x4e5dba[_0x1836bd(0xf7)]==='DispatchCampaign'&&await this[_0x1836bd(0xe1)](_0x4e5dba);}}},{'maxStalledCount':0xa,'useWorkerThreads':![],'concurrency':0x64,'connection':_0x4b2a16,'removeOnFail':{'count':0x0}});_0x596d23['on'](_0x366fb2(0xe8),async _0x95f75d=>{const _0x51ae4b=_0x366fb2;logger_1[_0x51ae4b(0xf3)][_0x51ae4b(0x11f)](_0x51ae4b(0xea)+_0x95f75d[_0x51ae4b(0xf7)]+'\x20('+_0x95f75d['id']+_0x51ae4b(0xfe));}),_0x596d23['on'](_0x366fb2(0x10a),async(_0x3019f4,_0x3d52ad)=>{const _0x3513f0=_0x366fb2;logger_1[_0x3513f0(0xf3)][_0x3513f0(0xe3)](_0x3513f0(0xea)+_0x3019f4[_0x3513f0(0xf7)]+_0x3513f0(0xd5)+_0x3d52ad[_0x3513f0(0xde)]);});}async[a574_0x3eaeaf(0xb9)](_0x214986){const _0x5a22ae=a574_0x3eaeaf;return ContactListItem_1[_0x5a22ae(0xf5)][_0x5a22ae(0x127)](_0x214986,{'attributes':['id',_0x5a22ae(0xf7),_0x5a22ae(0x105),_0x5a22ae(0xdc)]});}async[a574_0x3eaeaf(0xe9)](_0xd4b550){const _0x4610c2=a574_0x3eaeaf;try{const {contactId:_0x41567d,campaignId:_0x55af08,delay:_0x5f3022,variables:_0x1f9305}=_0xd4b550['data'],_0x4ef04d=await this['getCampaign'](_0x55af08),_0x444b56=await this[_0x4610c2(0xb9)](_0x41567d),_0x300d84={};_0x300d84[_0x4610c2(0x105)]=_0x444b56[_0x4610c2(0x105)],_0x300d84['contactId']=_0x41567d,_0x300d84['campaignId']=_0x55af08;const _0x5ac64b=this[_0x4610c2(0x95)](_0x4ef04d);if(_0x5ac64b[_0x4610c2(0xb7)]){const _0x6051e2=(0x0,queues_1['randomValue'])(0x0,_0x5ac64b[_0x4610c2(0xb7)]),_0x585a17=this[_0x4610c2(0xab)](_0x5ac64b[_0x6051e2],_0x1f9305,_0x444b56);_0x300d84[_0x4610c2(0xde)]='â€Œ\x20'+_0x585a17;}const [_0x2026aa,_0x15548e]=await CampaignShipping_1[_0x4610c2(0xf5)][_0x4610c2(0x126)]({'where':{'campaignId':_0x300d84[_0x4610c2(0xfc)],'contactId':_0x300d84[_0x4610c2(0x129)]},'defaults':_0x300d84});!_0x15548e&&_0x2026aa[_0x4610c2(0xce)]===null&&(_0x2026aa[_0x4610c2(0xef)](_0x300d84),await _0x2026aa[_0x4610c2(0xf2)]());if(_0x2026aa[_0x4610c2(0xce)]===null){const _0xdd7025=await queues_1['campaignQueue'][_0x4610c2(0xdf)](_0x4610c2(0xb3),{'campaignId':_0x4ef04d['id'],'campaignShippingId':_0x2026aa['id'],'contactListItemId':_0x41567d},{'removeOnComplete':!![],'delay':_0x5f3022});await _0x2026aa[_0x4610c2(0x11a)]({'jobId':_0xdd7025['id']});}await this[_0x4610c2(0x8f)](_0x4ef04d);}catch(_0x650285){Sentry['captureException'](_0x650285),logger_1[_0x4610c2(0xf3)]['error']('campaignQueue\x20->\x20PrepareContact\x20->\x20error:\x20'+_0x650285[_0x4610c2(0xde)]);}}async[a574_0x3eaeaf(0x8f)](_0x2bcccb){const _0x479823=a574_0x3eaeaf;if(!_0x2bcccb[_0x479823(0x101)])throw new sequelize_1[(_0x479823(0xbd))]('campaign.contactList\x20is\x20null\x20or\x20undefined');const {contacts:_0x3379a2}=_0x2bcccb[_0x479823(0x101)],_0x5eef19=_0x3379a2[_0x479823(0xb7)],_0x28387a=await CampaignShipping_1['default']['count']({'where':{'campaignId':_0x2bcccb['id'],'deliveredAt':{[sequelize_1['Op'][_0x479823(0xdb)]]:null}}});_0x5eef19===_0x28387a&&await _0x2bcccb[_0x479823(0x11a)]({'status':_0x479823(0xe2),'completedAt':(0x0,moment_1[_0x479823(0xf5)])()});const _0x408800=(0x0,socket_1[_0x479823(0x92)])();_0x408800['to'](_0x479823(0xa4)+_0x2bcccb[_0x479823(0xeb)]+_0x479823(0x10b))['emit'](_0x479823(0xa4)+_0x2bcccb['companyId']+'-campaign',{'action':_0x479823(0x11a),'record':_0x2bcccb});}[a574_0x3eaeaf(0xf4)](_0x21da1b,_0x1c7f8a,_0x1f554d,_0x21c49f,_0x229baf){const _0x48d741=(0x0,date_fns_1['differenceInSeconds'])(_0x1c7f8a,new Date());return _0x21da1b>_0x1f554d?_0x48d741*0x3e8+_0x21c49f:_0x48d741*0x3e8+_0x229baf;}async['handleDispatchCampaign'](_0x271b7c){const _0x32cb5b=a574_0x3eaeaf;try{const {data:_0x137ab2}=_0x271b7c,{campaignShippingId:_0x975f76,campaignId:_0x2de6b5}=_0x137ab2,_0x1b908e=await this[_0x32cb5b(0xee)](_0x2de6b5),_0xb4feb2=await(0x0,GetWhatsappWbot_1['default'])(_0x1b908e[_0x32cb5b(0xc9)]);if(!_0xb4feb2){logger_1['logger'][_0x32cb5b(0xe3)]('campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20not\x20found');return;}if(!_0x1b908e[_0x32cb5b(0xc9)]){logger_1['logger'][_0x32cb5b(0xe3)](_0x32cb5b(0x111));return;}if(!_0xb4feb2?.[_0x32cb5b(0xc5)]?.['id']){logger_1['logger']['error'](_0x32cb5b(0xf8));return;}logger_1[_0x32cb5b(0xf3)]['info'](_0x32cb5b(0xe0)+_0x2de6b5+_0x32cb5b(0x11c)+_0x975f76);const _0x1c063e=await CampaignShipping_1['default'][_0x32cb5b(0x127)](_0x975f76,{'include':[{'model':ContactListItem_1[_0x32cb5b(0xf5)],'as':'contact'}]}),_0x590315=_0x1c063e[_0x32cb5b(0x105)]+'@s.whatsapp.net';let _0x23a181=_0x1c063e[_0x32cb5b(0xde)][_0x32cb5b(0x109)]()[_0x32cb5b(0x112)]();const _0x12db56=await _0xb4feb2['sendMessage'](_0x590315,{'text':_0x23a181});await _0x1c063e['update']({'messageId':_0x12db56[_0x32cb5b(0x100)]['id'],'deliveredAt':(0x0,moment_1[_0x32cb5b(0xf5)])()}),await(0x0,SendPresenceStatus_1[_0x32cb5b(0x9a)])(_0xb4feb2,_0x590315);if(!(0x0,lodash_1[_0x32cb5b(0xd6)])(_0x1b908e[_0x32cb5b(0xa2)]))try{const _0x229203=path_1[_0x32cb5b(0xf5)]['resolve'](__dirname,'../..',_0x32cb5b(0xbf),_0x32cb5b(0xaf)+_0x1b908e[_0x32cb5b(0xeb)]),_0x2a6e50=await(0x0,ShowService_1[_0x32cb5b(0xf5)])(_0x1b908e[_0x32cb5b(0xa2)],_0x1b908e[_0x32cb5b(0xeb)]),_0x26a2fd=path_1[_0x32cb5b(0xf5)][_0x32cb5b(0x11b)](_0x229203,_0x32cb5b(0x12b),String(_0x2a6e50['id']));for(const _0xbbc284 of _0x2a6e50[_0x32cb5b(0xc2)]){const _0x276dbd=await(0x0,SendWhatsAppMedia_1[_0x32cb5b(0xd0)])(_0xbbc284[_0x32cb5b(0xb8)],path_1[_0x32cb5b(0xf5)][_0x32cb5b(0x11b)](_0x26a2fd,_0xbbc284[_0x32cb5b(0xb8)]),_0xbbc284['name'],_0x1b908e[_0x32cb5b(0xeb)]);await _0xb4feb2[_0x32cb5b(0xdd)](_0x590315,{..._0x276dbd});}}catch(_0x1e57e3){logger_1[_0x32cb5b(0xf3)][_0x32cb5b(0xe3)]('Error\x20sending\x20campaign\x20files:\x20'+_0x1e57e3);}if(_0x1b908e[_0x32cb5b(0x9d)])try{const _0x3800b4=path_1[_0x32cb5b(0xf5)][_0x32cb5b(0x11b)](__dirname,'../..','public','company'+_0x1b908e[_0x32cb5b(0xeb)]),_0x386d36=path_1[_0x32cb5b(0xf5)][_0x32cb5b(0xc0)](_0x3800b4,_0x1b908e[_0x32cb5b(0x9d)]),_0x1d5f28=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x1b908e[_0x32cb5b(0x8e)],_0x386d36,_0x23a181,_0x1b908e[_0x32cb5b(0xeb)]);Object['keys'](_0x1d5f28)[_0x32cb5b(0xb7)]&&await _0xb4feb2['sendMessage'](_0x590315,{..._0x1d5f28});}catch(_0x1cd7fd){logger_1[_0x32cb5b(0xf3)]['error'](_0x32cb5b(0xd4)+_0x1cd7fd);}await this[_0x32cb5b(0x8f)](_0x1b908e);const _0x4b9584=(0x0,socket_1[_0x32cb5b(0x92)])();_0x4b9584['to'](_0x32cb5b(0xa4)+_0x1b908e[_0x32cb5b(0xeb)]+'-mainchannel')[_0x32cb5b(0x114)](_0x32cb5b(0xa4)+_0x1b908e[_0x32cb5b(0xeb)]+_0x32cb5b(0xd3),{'action':'update','record':_0x1b908e}),logger_1[_0x32cb5b(0xf3)]['info'](_0x32cb5b(0x96)+_0x2de6b5+_0x32cb5b(0x113)+_0x1c063e[_0x32cb5b(0x103)]['name']);}catch(_0x1b92aa){Sentry[_0x32cb5b(0x120)](_0x1b92aa),logger_1[_0x32cb5b(0xf3)][_0x32cb5b(0xe3)](_0x1b92aa[_0x32cb5b(0xde)]);}}['getCampaignValidMessages'](_0x462cdb){const _0xdabcd4=a574_0x3eaeaf,_0xa196bb=[];return!(0x0,lodash_1[_0xdabcd4(0xb1)])(_0x462cdb[_0xdabcd4(0x102)])&&!(0x0,lodash_1[_0xdabcd4(0xd6)])(_0x462cdb[_0xdabcd4(0x102)])&&_0xa196bb['push'](_0x462cdb['message1']),!(0x0,lodash_1[_0xdabcd4(0xb1)])(_0x462cdb[_0xdabcd4(0xf6)])&&!(0x0,lodash_1[_0xdabcd4(0xd6)])(_0x462cdb[_0xdabcd4(0xf6)])&&_0xa196bb[_0xdabcd4(0x11d)](_0x462cdb[_0xdabcd4(0xf6)]),!(0x0,lodash_1[_0xdabcd4(0xb1)])(_0x462cdb['message3'])&&!(0x0,lodash_1[_0xdabcd4(0xd6)])(_0x462cdb[_0xdabcd4(0x119)])&&_0xa196bb[_0xdabcd4(0x11d)](_0x462cdb[_0xdabcd4(0x119)]),!(0x0,lodash_1['isEmpty'])(_0x462cdb['message4'])&&!(0x0,lodash_1[_0xdabcd4(0xd6)])(_0x462cdb[_0xdabcd4(0xc6)])&&_0xa196bb[_0xdabcd4(0x11d)](_0x462cdb['message4']),!(0x0,lodash_1[_0xdabcd4(0xb1)])(_0x462cdb[_0xdabcd4(0x122)])&&!(0x0,lodash_1[_0xdabcd4(0xd6)])(_0x462cdb[_0xdabcd4(0x122)])&&_0xa196bb['push'](_0x462cdb[_0xdabcd4(0x122)]),_0xa196bb;}[a574_0x3eaeaf(0xab)](_0x541a21,_0x49b500,_0x330259){const _0x2b8a42=a574_0x3eaeaf;let _0x13199c=_0x541a21;return _0x13199c['includes'](_0x2b8a42(0x116))&&(_0x13199c=_0x13199c[_0x2b8a42(0x99)](/{nome}/g,_0x330259[_0x2b8a42(0xf7)])),_0x13199c[_0x2b8a42(0xb5)](_0x2b8a42(0x94))&&(_0x13199c=_0x13199c[_0x2b8a42(0x99)](/{email}/g,_0x330259[_0x2b8a42(0xdc)])),_0x13199c['includes'](_0x2b8a42(0x93))&&(_0x13199c=_0x13199c['replace'](/{numero}/g,_0x330259[_0x2b8a42(0x105)])),_0x49b500[_0x2b8a42(0x10c)](_0x205a43=>{const _0x331f20=_0x2b8a42;if(_0x13199c[_0x331f20(0xb5)]('{'+_0x205a43[_0x331f20(0x100)]+'}')){const _0x2ca4b3=new RegExp('{'+_0x205a43['key']+'}','g');_0x13199c=_0x13199c[_0x331f20(0x99)](_0x2ca4b3,_0x205a43['value']);}}),_0x13199c;}async['getSettings'](_0x5bbd31){const _0x52b154=a574_0x3eaeaf,_0x224212=await CampaignSetting_1['default'][_0x52b154(0xed)]({'where':{'companyId':_0x5bbd31['companyId']},'attributes':[_0x52b154(0x100),_0x52b154(0xf9)]});let _0x32299c=0x5,_0x2f14d8=0x14,_0x1acff9=0xf,_0x371a79=[];return _0x224212['forEach'](_0x459543=>{const _0x51948f=_0x52b154;switch(_0x459543[_0x51948f(0x100)]){case _0x51948f(0x8c):_0x32299c=parseInt(_0x459543[_0x51948f(0xf9)],0xa)||0xa;break;case _0x51948f(0xf1):_0x2f14d8=parseInt(_0x459543[_0x51948f(0xf9)],0xa)||0x14;break;case'greaterInterval':_0x1acff9=parseInt(_0x459543[_0x51948f(0xf9)],0xa)||0xa;break;case'variables':_0x371a79=JSON[_0x51948f(0xe6)](_0x459543[_0x51948f(0xf9)]);break;}}),{'messageInterval':_0x32299c,'longerIntervalAfter':_0x2f14d8,'greaterInterval':_0x1acff9,'variables':_0x371a79};}async[a574_0x3eaeaf(0xe4)](_0x34f4f7){const _0x1978d4=a574_0x3eaeaf;try{const {id:_0x395bf8}=_0x34f4f7[_0x1978d4(0xd2)],_0x1c8dfb=await this[_0x1978d4(0xee)](_0x395bf8),_0x2e1737=await this[_0x1978d4(0xca)](_0x1c8dfb);if(!_0x1c8dfb||!_0x1c8dfb[_0x1978d4(0x101)]?.['contacts'])throw new sequelize_1[(_0x1978d4(0xbd))](_0x1978d4(0xcc));const {contacts:_0x1a8574}=_0x1c8dfb[_0x1978d4(0x101)];if(!_0x1a8574[_0x1978d4(0xb7)])throw new sequelize_1[(_0x1978d4(0xbd))](_0x1978d4(0x124));const _0x9f6f4c=_0x1a8574['map'](_0x4e25a2=>({'contactId':_0x4e25a2['id'],'campaignId':_0x1c8dfb['id'],'variables':_0x2e1737[_0x1978d4(0xa5)]})),_0x1b8c4e=_0x9f6f4c[_0x1978d4(0xb4)]((_0x321080,_0x1563b8)=>{const _0x23ebcb=_0x1978d4,_0x22aa47=this[_0x23ebcb(0x117)](_0x1563b8,_0x2e1737['messageInterval'],_0x2e1737[_0x23ebcb(0xf1)],_0x2e1737['greaterInterval']);return queues_1[_0x23ebcb(0xe5)][_0x23ebcb(0xdf)](_0x23ebcb(0xcb),{'contactId':_0x321080['contactId'],'campaignId':_0x321080['campaignId'],'variables':_0x321080[_0x23ebcb(0xa5)],'delay':_0x22aa47},{'removeOnComplete':!![]});});await Promise[_0x1978d4(0x12a)](_0x1b8c4e),await _0x1c8dfb[_0x1978d4(0x11a)]({'status':_0x1978d4(0x115)});}catch(_0x489b1b){logger_1[_0x1978d4(0xf3)][_0x1978d4(0xe3)](_0x489b1b),Sentry[_0x1978d4(0x120)](_0x489b1b);}}[a574_0x3eaeaf(0x117)](_0x15186b,_0x42e8b1,_0x284530,_0x134ada){const _0x1d2b62=a574_0x3eaeaf,_0x1aca4b=0x96,_0x261d7f=0x12c,_0x4d0d87=_0x15186b>_0x284530?Math[_0x1d2b62(0x12e)](_0x1aca4b+(_0x15186b-_0x284530)*_0x134ada,_0x1aca4b+_0x261d7f):Math[_0x1d2b62(0x12e)](_0x15186b*_0x42e8b1,_0x1aca4b),_0x520286=Math[_0x1d2b62(0x97)](Math[_0x1d2b62(0x12d)]()*0x5dc);return _0x4d0d87*0x3e8+_0x520286;}async[a574_0x3eaeaf(0xee)](_0x270ab5){const _0x576713=a574_0x3eaeaf,_0x34ffee=await Campaign_1[_0x576713(0xf5)][_0x576713(0x127)](_0x270ab5,{'include':[{'model':ContactList_1[_0x576713(0xf5)],'as':_0x576713(0x101),'attributes':['id','name'],'include':[{'model':ContactListItem_1[_0x576713(0xf5)],'as':_0x576713(0xa7),'attributes':['id',_0x576713(0xf7),_0x576713(0x105),_0x576713(0xdc),_0x576713(0xa6)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1[_0x576713(0xf5)],'as':_0x576713(0xc9),'attributes':['id',_0x576713(0xf7)]},{'model':CampaignShipping_1[_0x576713(0xf5)],'as':_0x576713(0xc3),'include':[{'model':ContactListItem_1[_0x576713(0xf5)],'as':_0x576713(0x103)}]}]});if(!_0x34ffee||!_0x34ffee['contactList'])throw new sequelize_1[(_0x576713(0xbd))](_0x576713(0xcc));return _0x34ffee;}async['handleVerifyCampaigns'](_0x173817){const _0x2d0723=a574_0x3eaeaf,_0x4d7667=new Date(new Date()[_0x2d0723(0x10f)]()+0x3c*0x3c*0x3e8);let _0x250466=await Campaign_1['default'][_0x2d0723(0xed)]({'where':{'scheduledAt':{[sequelize_1['Op'][_0x2d0723(0x110)]]:+_0x4d7667},'status':_0x2d0723(0x10d)},'attributes':['id',_0x2d0723(0x118)]});if(_0x250466[_0x2d0723(0xb7)]>0x0)logger_1[_0x2d0723(0xf3)][_0x2d0723(0x11f)]('Campanhas\x20encontradas:\x20'+_0x250466[_0x2d0723(0xb7)]);for(let _0x1f7ead of _0x250466){try{const _0x5d0789=(0x0,moment_1[_0x2d0723(0xf5)])(),_0x413897=(0x0,moment_1[_0x2d0723(0xf5)])(_0x1f7ead[_0x2d0723(0x118)]),_0x3360cb=_0x413897[_0x2d0723(0xfd)](_0x5d0789,_0x2d0723(0x98));logger_1[_0x2d0723(0xf3)]['info'](_0x2d0723(0x11e)+_0x1f7ead['id']+_0x2d0723(0xb2)+_0x3360cb);const _0x258079=await this[_0x2d0723(0xee)](_0x1f7ead['id']);if(!_0x258079[_0x2d0723(0x101)]||!_0x258079[_0x2d0723(0x101)][_0x2d0723(0xa7)])throw new sequelize_1[(_0x2d0723(0xbd))](_0x2d0723(0xba));await queues_1['campaignQueue'][_0x2d0723(0xdf)](_0x2d0723(0xfb),{'id':_0x1f7ead['id'],'delay':_0x3360cb},{'delay':_0x3360cb,'removeOnComplete':!![]});}catch(_0x335263){return Sentry[_0x2d0723(0x120)](_0x335263),Promise[_0x2d0723(0x90)](new sequelize_1[(_0x2d0723(0xbd))](_0x335263));}}return Promise[_0x2d0723(0x11b)]({'count':_0x250466[_0x2d0723(0xb7)]});}}exports[a574_0x3eaeaf(0xf5)]=CampaingJob;