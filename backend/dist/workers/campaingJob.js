const a573_0x3701ab=a573_0x1989;(function(_0x401db7,_0xe62489){const _0x4f9859=a573_0x1989,_0x53e4c0=_0x401db7();while(!![]){try{const _0x597904=parseInt(_0x4f9859(0x246))/0x1+-parseInt(_0x4f9859(0x209))/0x2*(parseInt(_0x4f9859(0x219))/0x3)+-parseInt(_0x4f9859(0x1f9))/0x4*(-parseInt(_0x4f9859(0x22f))/0x5)+-parseInt(_0x4f9859(0x22e))/0x6*(-parseInt(_0x4f9859(0x1de))/0x7)+-parseInt(_0x4f9859(0x1cf))/0x8*(-parseInt(_0x4f9859(0x214))/0x9)+-parseInt(_0x4f9859(0x21a))/0xa*(-parseInt(_0x4f9859(0x258))/0xb)+-parseInt(_0x4f9859(0x26a))/0xc*(parseInt(_0x4f9859(0x21f))/0xd);if(_0x597904===_0xe62489)break;else _0x53e4c0['push'](_0x53e4c0['shift']());}catch(_0x483ff4){_0x53e4c0['push'](_0x53e4c0['shift']());}}}(a573_0x544a,0xc6747));function a573_0x544a(){const _0x442ca8=['PrepareContact','message1','greaterInterval','message3','trimStart','default','handlePrepareContact','handleDispatchCampaign','../libs/socket','1158825FYxtPn','writable','../..','deliveredAt','{email}','public','contact','key','ProcessCampaign','add',';Registro=','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','messageInterval','EM_ANDAMENTO','includes','create','message2','variables','33BWCaNl','getSettings','save','isWhatsappValid','Error\x20sending\x20campaign\x20files:\x20','path','configurable','parse','getCampaignValidMessages','info','hasOwnProperty','push','differenceInSeconds','get','captureException','date-fns','mediaName','../services/WbotServices/SendWhatsAppMedia','44148180fVuDEd','{nome}','keys','Campanha\x20enviada\x20para:\x20Campanha=',')\x20completed','contactId','data','8HDmINX','set','email','campaignQueue\x20->\x20PrepareContact\x20->\x20error:\x20','(((.+)+)+)+$','findAll','SendPresenceStatus','handleProcessCampaign','options','VerifyCampaigns','logger','__importDefault','moment/moment','map','../utils/logger','77XqWstA','toString','lodash','__esModule','shipping','fileList','isEmpty','../helpers/GetWhatsappWbot','campaignQueue','PROGRAMADA','No\x20contacts\x20found\x20for\x20this\x20campaign','calculateOptimizedDelay','contactList','count','fileListId','{numero}','trimEnd','../models/Campaign','replace','getProcessedMessage','@sentry/node','milliseconds','error','apply','not','-mainchannel','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20whatsapp\x20not\x20found','548LEVGzD','../services/FileServices/ShowService','__createBinding','calculateDelay','length','bullmq','Error','campaign.contactList\x20is\x20null\x20or\x20undefined','Campaign\x20or\x20ContactList\x20not\x20found','update','sendMessage','Job\x20','findByPk',';Contato=','getMessageOptions','join','18246cKOAmi','emit','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20user\x20not\x20found','number','contacts','diff','company','reject','resolve','../models/CampaignSetting','Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha=','14212332EaNmCs','campaignId','getCampaign','min','call','225nYJUaG','1407230eTfIJL','getTime','name','lte','verifyAndFinalizeCampaign','13AlTxIX','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20not\x20found','getContact','forEach','company-','ContactList\x20not\x20found\x20or\x20empty','mediaPath','completed','random','floor','message4','../models/ContactList','defineProperty','__setModuleDefault','value','866844EBJTTl','15575WbNzHP','isNil','FINALIZADA','scheduledAt','Campanhas\x20encontradas:\x20','handleVerifyCampaigns','message','__importStar','message5','constructor','whatsapp','getIO','longerIntervalAfter','companyId'];a573_0x544a=function(){return _0x442ca8;};return a573_0x544a();}const a573_0xc5a05f=(function(){let _0x34cf49=!![];return function(_0x13d643,_0x556ab6){const _0x1fdb28=_0x34cf49?function(){const _0x2fe53a=a573_0x1989;if(_0x556ab6){const _0xf5215e=_0x556ab6[_0x2fe53a(0x1f5)](_0x13d643,arguments);return _0x556ab6=null,_0xf5215e;}}:function(){};return _0x34cf49=![],_0x1fdb28;};}()),a573_0x633bc8=a573_0xc5a05f(this,function(){const _0x49484d=a573_0x1989;return a573_0x633bc8[_0x49484d(0x1df)]()['search'](_0x49484d(0x1d3))[_0x49484d(0x1df)]()[_0x49484d(0x238)](a573_0x633bc8)['search'](_0x49484d(0x1d3));});function a573_0x1989(_0x280512,_0x21474a){const _0x4005e5=a573_0x544a();return a573_0x1989=function(_0x633bc8,_0xc5a05f){_0x633bc8=_0x633bc8-0x1cc;let _0x544a05=_0x4005e5[_0x633bc8];return _0x544a05;},a573_0x1989(_0x280512,_0x21474a);}a573_0x633bc8();'use strict';var __createBinding=this&&this[a573_0x3701ab(0x1fb)]||(Object[a573_0x3701ab(0x255)]?function(_0x1c6516,_0x271b84,_0x5ac99f,_0x23b64d){const _0x5ccb24=a573_0x3701ab;if(_0x23b64d===undefined)_0x23b64d=_0x5ac99f;var _0x37fd6c=Object['getOwnPropertyDescriptor'](_0x271b84,_0x5ac99f);(!_0x37fd6c||(_0x5ccb24(0x265)in _0x37fd6c?!_0x271b84['__esModule']:_0x37fd6c[_0x5ccb24(0x247)]||_0x37fd6c[_0x5ccb24(0x25e)]))&&(_0x37fd6c={'enumerable':!![],'get':function(){return _0x271b84[_0x5ac99f];}}),Object[_0x5ccb24(0x22b)](_0x1c6516,_0x23b64d,_0x37fd6c);}:function(_0x17a229,_0x27f321,_0x921696,_0x17c5eb){if(_0x17c5eb===undefined)_0x17c5eb=_0x921696;_0x17a229[_0x17c5eb]=_0x27f321[_0x921696];}),__setModuleDefault=this&&this[a573_0x3701ab(0x22c)]||(Object[a573_0x3701ab(0x255)]?function(_0x27f572,_0x3cff4){const _0x23b6ff=a573_0x3701ab;Object['defineProperty'](_0x27f572,_0x23b6ff(0x242),{'enumerable':!![],'value':_0x3cff4});}:function(_0x25faa5,_0xf9bf3f){const _0x1065d5=a573_0x3701ab;_0x25faa5[_0x1065d5(0x242)]=_0xf9bf3f;}),__importStar=this&&this[a573_0x3701ab(0x236)]||function(_0x4e1e07){const _0x4b5871=a573_0x3701ab;if(_0x4e1e07&&_0x4e1e07[_0x4b5871(0x1e1)])return _0x4e1e07;var _0x18305f={};if(_0x4e1e07!=null){for(var _0x351fc5 in _0x4e1e07)if(_0x351fc5!=='default'&&Object['prototype'][_0x4b5871(0x262)][_0x4b5871(0x218)](_0x4e1e07,_0x351fc5))__createBinding(_0x18305f,_0x4e1e07,_0x351fc5);}return __setModuleDefault(_0x18305f,_0x4e1e07),_0x18305f;},__importDefault=this&&this[a573_0x3701ab(0x1da)]||function(_0xebddbc){const _0x36ec76=a573_0x3701ab;return _0xebddbc&&_0xebddbc[_0x36ec76(0x1e1)]?_0xebddbc:{'default':_0xebddbc};};Object[a573_0x3701ab(0x22b)](exports,a573_0x3701ab(0x1e1),{'value':!![]});const bullmq_1=require(a573_0x3701ab(0x1fe)),Campaign_1=__importDefault(require(a573_0x3701ab(0x1ef))),sequelize_1=require('sequelize'),logger_1=require(a573_0x3701ab(0x1dd)),moment_1=__importDefault(require(a573_0x3701ab(0x1db))),Sentry=__importStar(require(a573_0x3701ab(0x1f2))),ContactList_1=__importDefault(require(a573_0x3701ab(0x22a))),ContactListItem_1=__importDefault(require('../models/ContactListItem')),Whatsapp_1=__importDefault(require('../models/Whatsapp')),CampaignShipping_1=__importDefault(require('../models/CampaignShipping')),queues_1=require('../queues'),lodash_1=require(a573_0x3701ab(0x1e0)),date_fns_1=require(a573_0x3701ab(0x267)),GetWhatsappWbot_1=__importDefault(require(a573_0x3701ab(0x1e5))),path_1=__importDefault(require(a573_0x3701ab(0x25d))),ShowService_1=__importDefault(require(a573_0x3701ab(0x1fa))),SendWhatsAppMedia_1=require(a573_0x3701ab(0x269)),socket_1=require(a573_0x3701ab(0x245)),CampaignSetting_1=__importDefault(require(a573_0x3701ab(0x212))),SendPresenceStatus_1=require('../helpers/SendPresenceStatus');class CampaingJob{constructor(_0x237f7f,_0x3c8201){const _0x151d33=a573_0x3701ab,_0x4cedf0=new bullmq_1['Worker'](_0x237f7f,async _0x611fdc=>{const _0x15d860=a573_0x1989;if(_0x611fdc[_0x15d860(0x21c)]===_0x15d860(0x1d8))await this[_0x15d860(0x234)](_0x611fdc);else{if(_0x611fdc['name']===_0x15d860(0x24e))await this[_0x15d860(0x1d6)](_0x611fdc);else{if(_0x611fdc[_0x15d860(0x21c)]==='PrepareContact')await this[_0x15d860(0x243)](_0x611fdc);else _0x611fdc['name']==='DispatchCampaign'&&await this[_0x15d860(0x244)](_0x611fdc);}}},{'maxStalledCount':0xa,'useWorkerThreads':![],'concurrency':0x64,'connection':_0x3c8201,'removeOnFail':{'count':0x0}});_0x4cedf0['on'](_0x151d33(0x226),async _0x44d095=>{const _0x15286f=_0x151d33;logger_1[_0x15286f(0x1d9)][_0x15286f(0x261)](_0x15286f(0x204)+_0x44d095[_0x15286f(0x21c)]+'\x20('+_0x44d095['id']+_0x15286f(0x1cc));}),_0x4cedf0['on']('failed',async(_0x4787e1,_0x59aeac)=>{const _0x33cfde=_0x151d33;logger_1[_0x33cfde(0x1d9)][_0x33cfde(0x1f4)](_0x33cfde(0x204)+_0x4787e1[_0x33cfde(0x21c)]+'\x20failed\x20with\x20error:\x20'+_0x59aeac[_0x33cfde(0x235)]);});}async['getContact'](_0x184088){const _0x1547e1=a573_0x3701ab;return ContactListItem_1[_0x1547e1(0x242)][_0x1547e1(0x205)](_0x184088,{'attributes':['id',_0x1547e1(0x21c),_0x1547e1(0x20c),'email']});}async[a573_0x3701ab(0x243)](_0x32e229){const _0x31a564=a573_0x3701ab;try{const {contactId:_0x2c1447,campaignId:_0x2af6f9,delay:_0x5c56ad,variables:_0x234b57}=_0x32e229[_0x31a564(0x1ce)],_0x44689d=await this[_0x31a564(0x216)](_0x2af6f9),_0x3b5b44=await this[_0x31a564(0x221)](_0x2c1447),_0x132c83={};_0x132c83['number']=_0x3b5b44['number'],_0x132c83[_0x31a564(0x1cd)]=_0x2c1447,_0x132c83[_0x31a564(0x215)]=_0x2af6f9;const _0x15d252=this[_0x31a564(0x260)](_0x44689d);if(_0x15d252['length']){const _0xcbb725=(0x0,queues_1['randomValue'])(0x0,_0x15d252[_0x31a564(0x1fd)]),_0x4d11d5=this[_0x31a564(0x1f1)](_0x15d252[_0xcbb725],_0x234b57,_0x3b5b44);_0x132c83[_0x31a564(0x235)]='â€Œ\x20'+_0x4d11d5;}const [_0x301158,_0x301bd2]=await CampaignShipping_1['default']['findOrCreate']({'where':{'campaignId':_0x132c83[_0x31a564(0x215)],'contactId':_0x132c83[_0x31a564(0x1cd)]},'defaults':_0x132c83});!_0x301bd2&&_0x301158['deliveredAt']===null&&(_0x301158[_0x31a564(0x1d0)](_0x132c83),await _0x301158[_0x31a564(0x25a)]());if(_0x301158[_0x31a564(0x249)]===null){const _0x8f003c=await queues_1[_0x31a564(0x1e6)][_0x31a564(0x24f)]('DispatchCampaign',{'campaignId':_0x44689d['id'],'campaignShippingId':_0x301158['id'],'contactListItemId':_0x2c1447},{'removeOnComplete':!![],'delay':_0x5c56ad});await _0x301158['update']({'jobId':_0x8f003c['id']});}await this[_0x31a564(0x21e)](_0x44689d);}catch(_0x2bba4d){Sentry[_0x31a564(0x266)](_0x2bba4d),logger_1[_0x31a564(0x1d9)]['error'](_0x31a564(0x1d2)+_0x2bba4d['message']);}}async['verifyAndFinalizeCampaign'](_0x11e19f){const _0x306b99=a573_0x3701ab;if(!_0x11e19f[_0x306b99(0x1ea)])throw new sequelize_1['Error'](_0x306b99(0x200));const {contacts:_0xd0831f}=_0x11e19f[_0x306b99(0x1ea)],_0xd20244=_0xd0831f[_0x306b99(0x1fd)],_0x4766af=await CampaignShipping_1[_0x306b99(0x242)][_0x306b99(0x1eb)]({'where':{'campaignId':_0x11e19f['id'],'deliveredAt':{[sequelize_1['Op'][_0x306b99(0x1f6)]]:null}}});_0xd20244===_0x4766af&&await _0x11e19f['update']({'status':_0x306b99(0x231),'completedAt':(0x0,moment_1[_0x306b99(0x242)])()});const _0x2dda24=(0x0,socket_1[_0x306b99(0x23a)])();_0x2dda24['to']('company-'+_0x11e19f[_0x306b99(0x23c)]+_0x306b99(0x1f7))[_0x306b99(0x20a)](_0x306b99(0x223)+_0x11e19f['companyId']+'-campaign',{'action':'update','record':_0x11e19f});}[a573_0x3701ab(0x1fc)](_0x59aef5,_0x4f81c,_0x1bafc8,_0x4c03dd,_0x34b81f){const _0x42a18f=a573_0x3701ab,_0xa9ceca=(0x0,date_fns_1[_0x42a18f(0x264)])(_0x4f81c,new Date());return _0x59aef5>_0x1bafc8?_0xa9ceca*0x3e8+_0x4c03dd:_0xa9ceca*0x3e8+_0x34b81f;}async['handleDispatchCampaign'](_0x52e55f){const _0x456bfd=a573_0x3701ab;try{const {data:_0x3bf3bc}=_0x52e55f,{campaignShippingId:_0x5ca1ae,campaignId:_0x2bd300}=_0x3bf3bc,_0x589c6e=await this[_0x456bfd(0x216)](_0x2bd300),_0x2d268d=await(0x0,GetWhatsappWbot_1[_0x456bfd(0x242)])(_0x589c6e[_0x456bfd(0x239)]);if(!_0x2d268d){logger_1[_0x456bfd(0x1d9)][_0x456bfd(0x1f4)](_0x456bfd(0x220));return;}if(!_0x589c6e[_0x456bfd(0x239)]){logger_1[_0x456bfd(0x1d9)][_0x456bfd(0x1f4)](_0x456bfd(0x1f8));return;}if(!_0x2d268d?.['user']?.['id']){logger_1[_0x456bfd(0x1d9)]['error'](_0x456bfd(0x20b));return;}logger_1[_0x456bfd(0x1d9)][_0x456bfd(0x261)](_0x456bfd(0x251)+_0x2bd300+_0x456bfd(0x250)+_0x5ca1ae);const _0x4460de=await CampaignShipping_1['default'][_0x456bfd(0x205)](_0x5ca1ae,{'include':[{'model':ContactListItem_1['default'],'as':_0x456bfd(0x24c)}]}),_0x234a04=_0x4460de[_0x456bfd(0x20c)]+'@s.whatsapp.net';let _0x45c20b=_0x4460de[_0x456bfd(0x235)][_0x456bfd(0x1ee)]()[_0x456bfd(0x241)]();const _0x3f24c2=await _0x2d268d['sendMessage'](_0x234a04,{'text':_0x45c20b});await _0x4460de['update']({'messageId':_0x3f24c2[_0x456bfd(0x24d)]['id'],'deliveredAt':(0x0,moment_1['default'])()}),await(0x0,SendPresenceStatus_1[_0x456bfd(0x1d5)])(_0x2d268d,_0x234a04);if(!(0x0,lodash_1['isNil'])(_0x589c6e[_0x456bfd(0x1ec)]))try{const _0x48887a=path_1['default']['resolve'](__dirname,_0x456bfd(0x248),_0x456bfd(0x24b),_0x456bfd(0x20f)+_0x589c6e['companyId']),_0x572c84=await(0x0,ShowService_1['default'])(_0x589c6e[_0x456bfd(0x1ec)],_0x589c6e[_0x456bfd(0x23c)]),_0x1eb2c9=path_1[_0x456bfd(0x242)][_0x456bfd(0x211)](_0x48887a,_0x456bfd(0x1e3),String(_0x572c84['id']));for(const _0x45e3c3 of _0x572c84[_0x456bfd(0x1d7)]){const _0x3eb9fd=await(0x0,SendWhatsAppMedia_1[_0x456bfd(0x207)])(_0x45e3c3['path'],path_1['default'][_0x456bfd(0x211)](_0x1eb2c9,_0x45e3c3[_0x456bfd(0x25d)]),_0x45e3c3['name'],_0x589c6e[_0x456bfd(0x23c)]);await _0x2d268d['sendMessage'](_0x234a04,{..._0x3eb9fd});}}catch(_0x5b9c84){logger_1[_0x456bfd(0x1d9)][_0x456bfd(0x1f4)](_0x456bfd(0x25c)+_0x5b9c84);}if(_0x589c6e[_0x456bfd(0x225)])try{const _0xdb0ed1=path_1[_0x456bfd(0x242)][_0x456bfd(0x211)](__dirname,'../..','public','company'+_0x589c6e[_0x456bfd(0x23c)]),_0x73606e=path_1['default'][_0x456bfd(0x208)](_0xdb0ed1,_0x589c6e[_0x456bfd(0x225)]),_0xf0fbc1=await(0x0,SendWhatsAppMedia_1[_0x456bfd(0x207)])(_0x589c6e[_0x456bfd(0x268)],_0x73606e,_0x45c20b,_0x589c6e['companyId']);Object[_0x456bfd(0x26c)](_0xf0fbc1)[_0x456bfd(0x1fd)]&&await _0x2d268d[_0x456bfd(0x203)](_0x234a04,{..._0xf0fbc1});}catch(_0x2ec9a9){logger_1[_0x456bfd(0x1d9)]['error']('Error\x20sending\x20campaign\x20media:\x20'+_0x2ec9a9);}await this[_0x456bfd(0x21e)](_0x589c6e);const _0x223a50=(0x0,socket_1['getIO'])();_0x223a50['to'](_0x456bfd(0x223)+_0x589c6e[_0x456bfd(0x23c)]+_0x456bfd(0x1f7))['emit'](_0x456bfd(0x223)+_0x589c6e[_0x456bfd(0x23c)]+'-campaign',{'action':_0x456bfd(0x202),'record':_0x589c6e}),logger_1[_0x456bfd(0x1d9)][_0x456bfd(0x261)](_0x456bfd(0x26d)+_0x2bd300+_0x456bfd(0x206)+_0x4460de[_0x456bfd(0x24c)][_0x456bfd(0x21c)]);}catch(_0x18493c){Sentry[_0x456bfd(0x266)](_0x18493c),logger_1[_0x456bfd(0x1d9)]['error'](_0x18493c['message']);}}[a573_0x3701ab(0x260)](_0x12bd7d){const _0x2b6526=a573_0x3701ab,_0x18f5ec=[];return!(0x0,lodash_1[_0x2b6526(0x1e4)])(_0x12bd7d[_0x2b6526(0x23e)])&&!(0x0,lodash_1['isNil'])(_0x12bd7d[_0x2b6526(0x23e)])&&_0x18f5ec[_0x2b6526(0x263)](_0x12bd7d[_0x2b6526(0x23e)]),!(0x0,lodash_1['isEmpty'])(_0x12bd7d[_0x2b6526(0x256)])&&!(0x0,lodash_1[_0x2b6526(0x230)])(_0x12bd7d[_0x2b6526(0x256)])&&_0x18f5ec[_0x2b6526(0x263)](_0x12bd7d[_0x2b6526(0x256)]),!(0x0,lodash_1[_0x2b6526(0x1e4)])(_0x12bd7d['message3'])&&!(0x0,lodash_1[_0x2b6526(0x230)])(_0x12bd7d[_0x2b6526(0x240)])&&_0x18f5ec[_0x2b6526(0x263)](_0x12bd7d['message3']),!(0x0,lodash_1[_0x2b6526(0x1e4)])(_0x12bd7d['message4'])&&!(0x0,lodash_1['isNil'])(_0x12bd7d['message4'])&&_0x18f5ec[_0x2b6526(0x263)](_0x12bd7d[_0x2b6526(0x229)]),!(0x0,lodash_1[_0x2b6526(0x1e4)])(_0x12bd7d[_0x2b6526(0x237)])&&!(0x0,lodash_1[_0x2b6526(0x230)])(_0x12bd7d[_0x2b6526(0x237)])&&_0x18f5ec[_0x2b6526(0x263)](_0x12bd7d[_0x2b6526(0x237)]),_0x18f5ec;}[a573_0x3701ab(0x1f1)](_0x282038,_0x1856cc,_0x56a7dd){const _0x514a5a=a573_0x3701ab;let _0x36154c=_0x282038;return _0x36154c[_0x514a5a(0x254)](_0x514a5a(0x26b))&&(_0x36154c=_0x36154c[_0x514a5a(0x1f0)](/{nome}/g,_0x56a7dd[_0x514a5a(0x21c)])),_0x36154c[_0x514a5a(0x254)](_0x514a5a(0x24a))&&(_0x36154c=_0x36154c[_0x514a5a(0x1f0)](/{email}/g,_0x56a7dd[_0x514a5a(0x1d1)])),_0x36154c['includes'](_0x514a5a(0x1ed))&&(_0x36154c=_0x36154c[_0x514a5a(0x1f0)](/{numero}/g,_0x56a7dd[_0x514a5a(0x20c)])),_0x1856cc[_0x514a5a(0x222)](_0x28076c=>{const _0x4bb533=_0x514a5a;if(_0x36154c[_0x4bb533(0x254)]('{'+_0x28076c[_0x4bb533(0x24d)]+'}')){const _0x29aa52=new RegExp('{'+_0x28076c[_0x4bb533(0x24d)]+'}','g');_0x36154c=_0x36154c['replace'](_0x29aa52,_0x28076c[_0x4bb533(0x22d)]);}}),_0x36154c;}async['getSettings'](_0x1a2924){const _0xdb06ae=a573_0x3701ab,_0x497826=await CampaignSetting_1[_0xdb06ae(0x242)][_0xdb06ae(0x1d4)]({'where':{'companyId':_0x1a2924[_0xdb06ae(0x23c)]},'attributes':[_0xdb06ae(0x24d),_0xdb06ae(0x22d)]});let _0x4a5657=0x5,_0x18b80b=0x14,_0x3bc945=0xf,_0x436469=[];return _0x497826[_0xdb06ae(0x222)](_0x3da6e8=>{const _0x2ac320=_0xdb06ae;switch(_0x3da6e8[_0x2ac320(0x24d)]){case _0x2ac320(0x252):_0x4a5657=parseInt(_0x3da6e8[_0x2ac320(0x22d)],0xa)||0xa;break;case _0x2ac320(0x23b):_0x18b80b=parseInt(_0x3da6e8[_0x2ac320(0x22d)],0xa)||0x14;break;case _0x2ac320(0x23f):_0x3bc945=parseInt(_0x3da6e8[_0x2ac320(0x22d)],0xa)||0xa;break;case _0x2ac320(0x257):_0x436469=JSON[_0x2ac320(0x25f)](_0x3da6e8[_0x2ac320(0x22d)]);break;}}),{'messageInterval':_0x4a5657,'longerIntervalAfter':_0x18b80b,'greaterInterval':_0x3bc945,'variables':_0x436469};}async[a573_0x3701ab(0x1d6)](_0x2c9771){const _0x4fc8da=a573_0x3701ab;try{const {id:_0x1e5492}=_0x2c9771[_0x4fc8da(0x1ce)],_0x4df4c5=await this[_0x4fc8da(0x216)](_0x1e5492),_0xd7036=await this[_0x4fc8da(0x259)](_0x4df4c5);if(!_0x4df4c5||!_0x4df4c5[_0x4fc8da(0x1ea)]?.[_0x4fc8da(0x20d)])throw new sequelize_1[(_0x4fc8da(0x1ff))](_0x4fc8da(0x201));const {contacts:_0x2808fd}=_0x4df4c5['contactList'];if(!_0x2808fd[_0x4fc8da(0x1fd)])throw new sequelize_1[(_0x4fc8da(0x1ff))](_0x4fc8da(0x1e8));const _0x39b7c7=_0x2808fd[_0x4fc8da(0x1dc)](_0x2d5f4f=>({'contactId':_0x2d5f4f['id'],'campaignId':_0x4df4c5['id'],'variables':_0xd7036['variables']})),_0x5d9ccf=_0x39b7c7[_0x4fc8da(0x1dc)]((_0x2fa507,_0x1feba5)=>{const _0x2ba5a4=_0x4fc8da,_0x19be7d=this[_0x2ba5a4(0x1e9)](_0x1feba5,_0xd7036['messageInterval'],_0xd7036[_0x2ba5a4(0x23b)],_0xd7036[_0x2ba5a4(0x23f)]);return queues_1[_0x2ba5a4(0x1e6)][_0x2ba5a4(0x24f)](_0x2ba5a4(0x23d),{'contactId':_0x2fa507[_0x2ba5a4(0x1cd)],'campaignId':_0x2fa507[_0x2ba5a4(0x215)],'variables':_0x2fa507['variables'],'delay':_0x19be7d},{'removeOnComplete':!![]});});await Promise['all'](_0x5d9ccf),await _0x4df4c5[_0x4fc8da(0x202)]({'status':_0x4fc8da(0x253)});}catch(_0x95725c){logger_1[_0x4fc8da(0x1d9)][_0x4fc8da(0x1f4)](_0x95725c),Sentry['captureException'](_0x95725c);}}['calculateOptimizedDelay'](_0x34c629,_0x8dbec4,_0x269907,_0x409988){const _0x4e70a0=a573_0x3701ab,_0x5bc975=0x96,_0x24657b=0x12c,_0x4bb084=_0x34c629>_0x269907?Math[_0x4e70a0(0x217)](_0x5bc975+(_0x34c629-_0x269907)*_0x409988,_0x5bc975+_0x24657b):Math['min'](_0x34c629*_0x8dbec4,_0x5bc975),_0x3fef32=Math[_0x4e70a0(0x228)](Math[_0x4e70a0(0x227)]()*0x5dc);return _0x4bb084*0x3e8+_0x3fef32;}async['getCampaign'](_0x5270a6){const _0x23fffd=a573_0x3701ab,_0x35cd3b=await Campaign_1[_0x23fffd(0x242)][_0x23fffd(0x205)](_0x5270a6,{'include':[{'model':ContactList_1[_0x23fffd(0x242)],'as':_0x23fffd(0x1ea),'attributes':['id','name'],'include':[{'model':ContactListItem_1[_0x23fffd(0x242)],'as':_0x23fffd(0x20d),'attributes':['id',_0x23fffd(0x21c),'number',_0x23fffd(0x1d1),_0x23fffd(0x25b)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1[_0x23fffd(0x242)],'as':_0x23fffd(0x239),'attributes':['id','name']},{'model':CampaignShipping_1[_0x23fffd(0x242)],'as':_0x23fffd(0x1e2),'include':[{'model':ContactListItem_1[_0x23fffd(0x242)],'as':_0x23fffd(0x24c)}]}]});if(!_0x35cd3b||!_0x35cd3b['contactList'])throw new sequelize_1[(_0x23fffd(0x1ff))](_0x23fffd(0x201));return _0x35cd3b;}async['handleVerifyCampaigns'](_0x50f019){const _0x4664f9=a573_0x3701ab,_0x49ab1c=new Date(new Date()[_0x4664f9(0x21b)]()+0x3c*0x3c*0x3e8);let _0x18cd47=await Campaign_1[_0x4664f9(0x242)][_0x4664f9(0x1d4)]({'where':{'scheduledAt':{[sequelize_1['Op'][_0x4664f9(0x21d)]]:+_0x49ab1c},'status':_0x4664f9(0x1e7)},'attributes':['id',_0x4664f9(0x232)]});if(_0x18cd47[_0x4664f9(0x1fd)]>0x0)logger_1[_0x4664f9(0x1d9)][_0x4664f9(0x261)](_0x4664f9(0x233)+_0x18cd47[_0x4664f9(0x1fd)]);for(let _0x5a4495 of _0x18cd47){try{const _0x138a74=(0x0,moment_1[_0x4664f9(0x242)])(),_0x225248=(0x0,moment_1[_0x4664f9(0x242)])(_0x5a4495[_0x4664f9(0x232)]),_0xf0d615=_0x225248[_0x4664f9(0x20e)](_0x138a74,_0x4664f9(0x1f3));logger_1[_0x4664f9(0x1d9)]['info'](_0x4664f9(0x213)+_0x5a4495['id']+',\x20Delay\x20Inicial='+_0xf0d615);const _0x4ec699=await this[_0x4664f9(0x216)](_0x5a4495['id']);if(!_0x4ec699[_0x4664f9(0x1ea)]||!_0x4ec699['contactList'][_0x4664f9(0x20d)])throw new sequelize_1['Error'](_0x4664f9(0x224));await queues_1[_0x4664f9(0x1e6)]['add'](_0x4664f9(0x24e),{'id':_0x5a4495['id'],'delay':_0xf0d615},{'delay':_0xf0d615,'removeOnComplete':!![]});}catch(_0x43725d){return Sentry[_0x4664f9(0x266)](_0x43725d),Promise[_0x4664f9(0x210)](new sequelize_1[(_0x4664f9(0x1ff))](_0x43725d));}}return Promise['resolve']({'count':_0x18cd47[_0x4664f9(0x1fd)]});}}exports[a573_0x3701ab(0x242)]=CampaingJob;