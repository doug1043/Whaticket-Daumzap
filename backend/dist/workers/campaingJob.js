function a575_0x55ee(_0x422014,_0x4a001c){const _0x1faaab=a575_0x105b();return a575_0x55ee=function(_0xaf43af,_0x3e0a1f){_0xaf43af=_0xaf43af-0x164;let _0x105bd9=_0x1faaab[_0xaf43af];return _0x105bd9;},a575_0x55ee(_0x422014,_0x4a001c);}const a575_0x5b0981=a575_0x55ee;(function(_0x21c371,_0x416708){const _0x10e461=a575_0x55ee,_0x4afbf3=_0x21c371();while(!![]){try{const _0x569d51=parseInt(_0x10e461(0x1a9))/0x1+-parseInt(_0x10e461(0x1b0))/0x2*(parseInt(_0x10e461(0x1a2))/0x3)+parseInt(_0x10e461(0x16b))/0x4+parseInt(_0x10e461(0x1a5))/0x5*(-parseInt(_0x10e461(0x1c9))/0x6)+-parseInt(_0x10e461(0x178))/0x7+parseInt(_0x10e461(0x195))/0x8*(-parseInt(_0x10e461(0x173))/0x9)+-parseInt(_0x10e461(0x1b9))/0xa*(-parseInt(_0x10e461(0x1dd))/0xb);if(_0x569d51===_0x416708)break;else _0x4afbf3['push'](_0x4afbf3['shift']());}catch(_0x4f9d83){_0x4afbf3['push'](_0x4afbf3['shift']());}}}(a575_0x105b,0x85897));const a575_0x3e0a1f=(function(){let _0x2de157=!![];return function(_0x6403ce,_0x3d0ede){const _0x13a54b=_0x2de157?function(){const _0x1bf0fc=a575_0x55ee;if(_0x3d0ede){const _0x56f1e6=_0x3d0ede[_0x1bf0fc(0x16a)](_0x6403ce,arguments);return _0x3d0ede=null,_0x56f1e6;}}:function(){};return _0x2de157=![],_0x13a54b;};}()),a575_0xaf43af=a575_0x3e0a1f(this,function(){const _0x1b8d00=a575_0x55ee;return a575_0xaf43af[_0x1b8d00(0x176)]()[_0x1b8d00(0x1ed)](_0x1b8d00(0x1aa))[_0x1b8d00(0x176)]()[_0x1b8d00(0x18f)](a575_0xaf43af)[_0x1b8d00(0x1ed)](_0x1b8d00(0x1aa));});a575_0xaf43af();'use strict';var __createBinding=this&&this[a575_0x5b0981(0x16f)]||(Object[a575_0x5b0981(0x19a)]?function(_0x406891,_0x21d7e9,_0x7de0b4,_0x1e976d){const _0x388202=a575_0x5b0981;if(_0x1e976d===undefined)_0x1e976d=_0x7de0b4;var _0x2ef2bc=Object[_0x388202(0x17f)](_0x21d7e9,_0x7de0b4);(!_0x2ef2bc||('get'in _0x2ef2bc?!_0x21d7e9[_0x388202(0x180)]:_0x2ef2bc[_0x388202(0x1bf)]||_0x2ef2bc[_0x388202(0x17c)]))&&(_0x2ef2bc={'enumerable':!![],'get':function(){return _0x21d7e9[_0x7de0b4];}}),Object[_0x388202(0x1c4)](_0x406891,_0x1e976d,_0x2ef2bc);}:function(_0x2298ee,_0x5da182,_0xea55fe,_0x231f7a){if(_0x231f7a===undefined)_0x231f7a=_0xea55fe;_0x2298ee[_0x231f7a]=_0x5da182[_0xea55fe];}),__setModuleDefault=this&&this[a575_0x5b0981(0x1dc)]||(Object[a575_0x5b0981(0x19a)]?function(_0x37b25a,_0x10458a){const _0x1fba03=a575_0x5b0981;Object[_0x1fba03(0x1c4)](_0x37b25a,_0x1fba03(0x1ec),{'enumerable':!![],'value':_0x10458a});}:function(_0x48f3ea,_0x1a74f2){const _0x216126=a575_0x5b0981;_0x48f3ea[_0x216126(0x1ec)]=_0x1a74f2;}),__importStar=this&&this[a575_0x5b0981(0x1b1)]||function(_0x402a96){const _0x1f9e5a=a575_0x5b0981;if(_0x402a96&&_0x402a96[_0x1f9e5a(0x180)])return _0x402a96;var _0xa5bc94={};if(_0x402a96!=null){for(var _0x5f5138 in _0x402a96)if(_0x5f5138!==_0x1f9e5a(0x1ec)&&Object[_0x1f9e5a(0x1b2)]['hasOwnProperty'][_0x1f9e5a(0x186)](_0x402a96,_0x5f5138))__createBinding(_0xa5bc94,_0x402a96,_0x5f5138);}return __setModuleDefault(_0xa5bc94,_0x402a96),_0xa5bc94;},__importDefault=this&&this[a575_0x5b0981(0x1e8)]||function(_0x361bf6){return _0x361bf6&&_0x361bf6['__esModule']?_0x361bf6:{'default':_0x361bf6};};Object[a575_0x5b0981(0x1c4)](exports,'__esModule',{'value':!![]});function a575_0x105b(){const _0x6298db=['handleVerifyCampaigns\x20iniciado','parse','__importDefault','{email}','SendPresenceStatus','max','default','search','findAll','FINALIZADA','greaterInterval','Job\x20','Queue','../utils/logger','apply','1870948YyzwUF','resolve','../models/ContactList','@sentry/node','__createBinding','has','getMessageOptions','../helpers/GetWhatsappWbot','1098MdHhqc','company-','key','toString','toJSON','6236699flVmil','isEmpty','path','Worker','configurable','longerIntervalAfter','moment/moment','getOwnPropertyDescriptor','__esModule','replace','{nome}','campaign-queue','number','fileList','call','fileListId','Campanha\x20ou\x20contato\x20não\x20encontrado','completed','../models/Campaign','contactList','../models/CampaignShipping','public','map','constructor','findByPk','campaignQueue','Erro\x20na\x20verificação\x20de\x20campanhas\x20travadas','Erro\x20ao\x20processar\x20campanha:\x20','{numero}','28936tpOIiY','value','env','update','VerifyCampaigns','create','handleVerifyCampaigns','diff','processing-queue','processingQueue','../models/CampaignSetting','@s.whatsapp.net','companyId','100785PaVdLc','data','add','22525cfjHFy','status','contactListId','isNil','205960oZLsNT','(((.+)+)+)+$','emit','logger','length','message','email','50kAONsk','__importStar','prototype','floor','company','whatsapp','../services/FileServices/ShowService','options','dispatchQueue','370zMjLxG','captureException','milliseconds','../services/WbotServices/SendWhatsAppMedia','dispatch-queue','lte','writable','forEach','getCampaignQueue','getSettings','calculateOptimizedDelay','defineProperty','process-campaign','includes','Error\x20sending\x20campaign\x20files:\x20','count','948RjBAMT','-mainchannel','Erro\x20no\x20envio\x20da\x20campanha:\x20','resumeStaledCampaigns','contactId','getCampaignValidMessages','variables','REDIS_PASSWORD','ceil','sendMessage','REDIS_PORT','initializeWorkers','not','getIO','messageInterval','send-campaign','bullmq','Retomando\x20campanha\x20travada:\x20','handleDispatchCampaign','__setModuleDefault','819698EeTVKZ','getProcessedMessage','name','lodash','toDate','slice','contacts','error','sequelize'];a575_0x105b=function(){return _0x6298db;};return a575_0x105b();}const bullmq_1=require(a575_0x5b0981(0x1d9)),Campaign_1=__importDefault(require(a575_0x5b0981(0x18a))),sequelize_1=require(a575_0x5b0981(0x1e5)),logger_1=require(a575_0x5b0981(0x169)),moment_1=__importDefault(require(a575_0x5b0981(0x17e))),Sentry=__importStar(require(a575_0x5b0981(0x16e))),ContactList_1=__importDefault(require(a575_0x5b0981(0x16d))),ContactListItem_1=__importDefault(require('../models/ContactListItem')),CampaignShipping_1=__importDefault(require(a575_0x5b0981(0x18c))),SendWhatsAppMedia_1=require(a575_0x5b0981(0x1bc)),GetWhatsappWbot_1=__importDefault(require(a575_0x5b0981(0x172))),SendPresenceStatus_1=require('../helpers/SendPresenceStatus'),socket_1=require('../libs/socket'),path_1=__importDefault(require('path')),ShowService_1=__importDefault(require(a575_0x5b0981(0x1b6))),CampaignSetting_1=__importDefault(require(a575_0x5b0981(0x19f))),lodash_1=require(a575_0x5b0981(0x1e0)),redisConfig={'port':parseInt(process[a575_0x5b0981(0x197)][a575_0x5b0981(0x1d3)]||'6379'),'host':process['env']['REDIS_HOST']||'127.0.0.1','password':process[a575_0x5b0981(0x197)][a575_0x5b0981(0x1d0)]},CAMPAIGN_CONCURRENCY=0x5,DISPATCH_CONCURRENCY=0xa,BATCH_SIZE=0x14,MAX_ATTEMPTS=0x3;class CampaignQueueManager{constructor(_0x30cc77,_0x1c7576){const _0x431477=a575_0x5b0981,_0x5ab06a=_0x1c7576||redisConfig;this[_0x431477(0x191)]=new bullmq_1[(_0x431477(0x168))](_0x30cc77||'campaign-queue',{'connection':_0x5ab06a}),this[_0x431477(0x19e)]=new bullmq_1[(_0x431477(0x168))]('processing-queue',{'connection':_0x5ab06a}),this[_0x431477(0x1b8)]=new bullmq_1[(_0x431477(0x168))](_0x431477(0x1bd),{'connection':_0x5ab06a}),this[_0x431477(0x1d4)](_0x5ab06a);}[a575_0x5b0981(0x1c1)](){const _0x468ce3=a575_0x5b0981;return this[_0x468ce3(0x191)];}async['getSettings'](_0x81c576){const _0x412bb0=a575_0x5b0981,_0x265aca=await CampaignSetting_1[_0x412bb0(0x1ec)][_0x412bb0(0x164)]({'where':{'companyId':_0x81c576},'attributes':['key','value']}),_0x33699b={'messageInterval':0x14,'longerIntervalAfter':0x14,'greaterInterval':0x3c,'variables':[]};return _0x265aca[_0x412bb0(0x1c0)](_0x342551=>{const _0x3d6a91=_0x412bb0;switch(_0x342551[_0x3d6a91(0x175)]){case _0x3d6a91(0x1d7):_0x33699b[_0x3d6a91(0x1d7)]=parseInt(_0x342551[_0x3d6a91(0x196)],0xa);break;case _0x3d6a91(0x17d):_0x33699b['longerIntervalAfter']=parseInt(_0x342551[_0x3d6a91(0x196)],0xa);break;case _0x3d6a91(0x166):_0x33699b[_0x3d6a91(0x166)]=parseInt(_0x342551[_0x3d6a91(0x196)],0xa);break;case _0x3d6a91(0x1cf):_0x33699b[_0x3d6a91(0x1cf)]=JSON[_0x3d6a91(0x1e7)](_0x342551['value']);break;}}),_0x33699b;}[a575_0x5b0981(0x1d4)](_0x1fd487){const _0x5b87f2=a575_0x5b0981,_0x4941aa=new bullmq_1[(_0x5b87f2(0x17b))](_0x5b87f2(0x183),async _0x510367=>{const _0x3da707=_0x5b87f2;if(_0x510367[_0x3da707(0x1df)]===_0x3da707(0x199))return this[_0x3da707(0x19b)](_0x510367);},{'connection':_0x1fd487,'concurrency':CAMPAIGN_CONCURRENCY});setInterval(async()=>{const _0x82f428=_0x5b87f2;try{await this[_0x82f428(0x1cc)]();}catch(_0x245df1){logger_1[_0x82f428(0x1ac)]['error'](_0x82f428(0x192),_0x245df1);}},0x1e*0x3c*0x3e8);const _0x1be72e=new bullmq_1[(_0x5b87f2(0x17b))](_0x5b87f2(0x19d),async _0x742a6=>{const _0x45985=_0x5b87f2;await this['handleProcessingBatch'](_0x742a6[_0x45985(0x1a3)]);},{'connection':_0x1fd487,'concurrency':CAMPAIGN_CONCURRENCY}),_0x16a74b=new bullmq_1[(_0x5b87f2(0x17b))]('dispatch-queue',async _0x4b6578=>{const _0x59749a=_0x5b87f2;await this['handleDispatchCampaign'](_0x4b6578[_0x59749a(0x1a3)]);},{'connection':_0x1fd487,'concurrency':DISPATCH_CONCURRENCY});[_0x4941aa,_0x1be72e,_0x16a74b]['forEach'](_0x268048=>{const _0xef661f=_0x5b87f2;_0x268048['on']('failed',(_0x2216d2,_0x2d7b80)=>{const _0x48f0cf=a575_0x55ee;logger_1[_0x48f0cf(0x1ac)][_0x48f0cf(0x1e4)](_0x48f0cf(0x167)+_0x2216d2[_0x48f0cf(0x1df)]+'\x20failed:\x20'+_0x2d7b80['message']),Sentry[_0x48f0cf(0x1ba)](_0x2d7b80);}),_0x268048['on'](_0xef661f(0x189),_0x2fc784=>{const _0x1ce992=_0xef661f;logger_1[_0x1ce992(0x1ac)]['info']('Job\x20'+_0x2fc784['name']+'\x20completed\x20successfully');});});}async[a575_0x5b0981(0x19b)](_0x1e609a){const _0x3b22d1=a575_0x5b0981;logger_1[_0x3b22d1(0x1ac)]['info'](_0x3b22d1(0x1e6));const _0x53e1ff=new Date(new Date()['getTime']()+0x3c*0x3c*0x3e8),_0x21098e=await Campaign_1[_0x3b22d1(0x1ec)][_0x3b22d1(0x164)]({'where':{'scheduledAt':{[sequelize_1['Op'][_0x3b22d1(0x1be)]]:+_0x53e1ff},'status':'PROGRAMADA'}});for(const _0x552fa0 of _0x21098e){try{const _0x446a19=(0x0,moment_1[_0x3b22d1(0x1ec)])(),_0x10f6f9=(0x0,moment_1[_0x3b22d1(0x1ec)])(_0x552fa0['scheduledAt']),_0x368f34=_0x10f6f9[_0x3b22d1(0x19c)](_0x446a19,_0x3b22d1(0x1bb));await this[_0x3b22d1(0x19e)][_0x3b22d1(0x1a4)]('process-campaign',{'campaignId':_0x552fa0['id']},{'delay':_0x368f34,'attempts':MAX_ATTEMPTS,'removeOnComplete':!![]}),await _0x552fa0[_0x3b22d1(0x198)]({'status':'EM_ANDAMENTO'});const _0xdd2942=(0x0,socket_1[_0x3b22d1(0x1d6)])();_0xdd2942['to']('company-'+_0x552fa0[_0x3b22d1(0x1a1)]+_0x3b22d1(0x1ca))['emit']('company-'+_0x552fa0[_0x3b22d1(0x1a1)]+'-campaign',{'action':_0x3b22d1(0x198),'record':_0x552fa0});}catch(_0x3735b8){Sentry[_0x3b22d1(0x1ba)](_0x3735b8),logger_1[_0x3b22d1(0x1ac)][_0x3b22d1(0x1e4)](_0x3b22d1(0x193)+_0x3735b8);}}return{'count':_0x21098e[_0x3b22d1(0x1ad)]};}async['handleProcessingBatch'](_0x1f93c3){const _0x32edb3=a575_0x5b0981,{campaignId:_0x2a2324}=_0x1f93c3;try{const _0x515454=await Campaign_1[_0x32edb3(0x1ec)]['findByPk'](_0x2a2324,{'include':[{'model':ContactList_1[_0x32edb3(0x1ec)],'as':_0x32edb3(0x18b),'include':[{'model':ContactListItem_1[_0x32edb3(0x1ec)],'as':_0x32edb3(0x1e3),'where':{'isWhatsappValid':!![]}}]}]});if(!_0x515454||!_0x515454['contactList'])throw new Error('Campanha\x20ou\x20lista\x20de\x20contatos\x20não\x20encontrada');const _0x23b0b7=await CampaignShipping_1[_0x32edb3(0x1ec)][_0x32edb3(0x164)]({'where':{'campaignId':_0x515454['id'],'deliveredAt':{[sequelize_1['Op']['not']]:null}},'attributes':['contactId']}),_0x522b4d=new Set(_0x23b0b7[_0x32edb3(0x18e)](_0x20e8bb=>_0x20e8bb[_0x32edb3(0x1cd)])),_0x2b87a7=await this[_0x32edb3(0x1c2)](_0x515454[_0x32edb3(0x1a1)]),_0x34a770=_0x515454[_0x32edb3(0x18b)][_0x32edb3(0x1e3)]['filter'](_0x56a225=>!_0x522b4d[_0x32edb3(0x170)](_0x56a225['id'])),_0x1f4cc3=Math[_0x32edb3(0x1d1)](_0x34a770['length']/BATCH_SIZE),_0x2bc4c3=this['calculateTotalTimeEstimate'](_0x34a770[_0x32edb3(0x1ad)],_0x2b87a7[_0x32edb3(0x1d7)],_0x2b87a7['longerIntervalAfter'],_0x2b87a7[_0x32edb3(0x166)]);await _0x515454[_0x32edb3(0x198)]({'estimatedCompletionTime':(0x0,moment_1[_0x32edb3(0x1ec)])()['add'](_0x2bc4c3,'seconds'),'updatedAt':new Date()});for(let _0x35ea18=0x0;_0x35ea18<_0x1f4cc3;_0x35ea18++){const _0x3481e8=_0x35ea18*BATCH_SIZE,_0x375138=_0x34a770[_0x32edb3(0x1e2)](_0x3481e8,_0x3481e8+BATCH_SIZE);for(let _0x3f2eee=0x0;_0x3f2eee<_0x375138[_0x32edb3(0x1ad)];_0x3f2eee++){const _0x1a8f3f=_0x375138[_0x3f2eee],_0x100ab2=_0x35ea18*BATCH_SIZE+_0x3f2eee,_0x55b847=this[_0x32edb3(0x1c3)](_0x100ab2,_0x2b87a7[_0x32edb3(0x1d7)],_0x2b87a7[_0x32edb3(0x17d)],_0x2b87a7[_0x32edb3(0x166)]);await this['dispatchQueue'][_0x32edb3(0x1a4)](_0x32edb3(0x1d8),{'campaignId':_0x2a2324,'contactId':_0x1a8f3f['id'],'totalContacts':_0x34a770[_0x32edb3(0x1ad)],'settings':_0x2b87a7},{'delay':_0x55b847,'attempts':MAX_ATTEMPTS,'removeOnComplete':!![]});}}}catch(_0x227369){Sentry[_0x32edb3(0x1ba)](_0x227369),logger_1[_0x32edb3(0x1ac)]['error']('Erro\x20no\x20processamento\x20em\x20lote:\x20'+_0x227369);}}['calculateTotalTimeEstimate'](_0x468486,_0x4ae7f0,_0xd2b11e,_0x9928dc){const _0x1ce7ab=a575_0x5b0981,_0x7a9198=Math['min'](_0x468486,_0xd2b11e),_0x5a6cd3=Math[_0x1ce7ab(0x1eb)](0x0,_0x468486-_0xd2b11e);return _0x7a9198*_0x4ae7f0+_0x5a6cd3*_0x9928dc;}async[a575_0x5b0981(0x1db)](_0xe15fb2){const _0x1cde4f=a575_0x5b0981,{campaignId:_0x4c4820,contactId:_0xa9655c,totalContacts:_0x5b5745,settings:_0x10b774}=_0xe15fb2;try{const _0x530d34=await Campaign_1[_0x1cde4f(0x1ec)]['findByPk'](_0x4c4820,{'include':['whatsapp']}),_0x5d4d38=await ContactListItem_1[_0x1cde4f(0x1ec)][_0x1cde4f(0x190)](_0xa9655c);if(!_0x530d34||!_0x5d4d38)throw new Error(_0x1cde4f(0x188));const _0x59bf97=await(0x0,GetWhatsappWbot_1[_0x1cde4f(0x1ec)])(_0x530d34[_0x1cde4f(0x1b5)]),_0x168d29=_0x5d4d38[_0x1cde4f(0x184)]+_0x1cde4f(0x1a0),_0x170194=this[_0x1cde4f(0x1ce)](_0x530d34),_0xc4bbb7=Math[_0x1cde4f(0x1b3)](Math['random']()*_0x170194[_0x1cde4f(0x1ad)]),_0x4c8722=_0x170194[_0xc4bbb7],_0x2a4890=this['getProcessedMessage'](_0x4c8722,_0x10b774['variables'],_0x5d4d38);await(0x0,SendPresenceStatus_1[_0x1cde4f(0x1ea)])(_0x59bf97,_0x168d29);const _0x145af2=await _0x59bf97['sendMessage'](_0x168d29,{'text':_0x2a4890});if(!(0x0,lodash_1[_0x1cde4f(0x1a8)])(_0x530d34[_0x1cde4f(0x187)]))try{const _0x3bc581=await(0x0,ShowService_1['default'])(_0x530d34[_0x1cde4f(0x187)],_0x530d34['companyId']),_0x32b26a=path_1[_0x1cde4f(0x1ec)][_0x1cde4f(0x16c)](__dirname,'../..',_0x1cde4f(0x18d),_0x1cde4f(0x1b4)+_0x530d34[_0x1cde4f(0x1a1)],_0x1cde4f(0x185),String(_0x3bc581['id']));for(const _0x254574 of _0x3bc581[_0x1cde4f(0x1b7)]){const _0x1b2a87=await(0x0,SendWhatsAppMedia_1[_0x1cde4f(0x171)])(_0x254574[_0x1cde4f(0x17a)],path_1['default'][_0x1cde4f(0x16c)](_0x32b26a,_0x254574['path']),_0x254574[_0x1cde4f(0x1df)],_0x530d34['companyId']);await _0x59bf97[_0x1cde4f(0x1d2)](_0x168d29,{..._0x1b2a87});}}catch(_0x4ac88f){logger_1[_0x1cde4f(0x1ac)]['error'](_0x1cde4f(0x1c7)+_0x4ac88f);}await CampaignShipping_1[_0x1cde4f(0x1ec)]['create']({'campaignId':_0x4c4820,'contactId':_0x5d4d38['id'],'number':_0x5d4d38['number'],'messageId':_0x145af2[_0x1cde4f(0x175)]['id'],'message':_0x2a4890,'deliveredAt':(0x0,moment_1['default'])()});const _0x35ce62=await CampaignShipping_1[_0x1cde4f(0x1ec)][_0x1cde4f(0x1c8)]({'where':{'campaignId':_0x4c4820,'deliveredAt':{[sequelize_1['Op'][_0x1cde4f(0x1d5)]]:null}}});_0x35ce62>=_0x5b5745&&await _0x530d34[_0x1cde4f(0x198)]({'status':_0x1cde4f(0x165),'completedAt':(0x0,moment_1['default'])()});const _0x8db536=(0x0,socket_1[_0x1cde4f(0x1d6)])();_0x8db536['to'](_0x1cde4f(0x174)+_0x530d34[_0x1cde4f(0x1a1)]+'-mainchannel')[_0x1cde4f(0x1ab)](_0x1cde4f(0x174)+_0x530d34[_0x1cde4f(0x1a1)]+'-campaign',{'action':'update','record':{..._0x530d34[_0x1cde4f(0x177)](),'completedContacts':_0x35ce62,'totalContacts':_0x5b5745,'status':_0x530d34[_0x1cde4f(0x1a6)]}});}catch(_0x32d918){Sentry[_0x1cde4f(0x1ba)](_0x32d918),logger_1[_0x1cde4f(0x1ac)][_0x1cde4f(0x1e4)](_0x1cde4f(0x1cb)+_0x32d918);}}[a575_0x5b0981(0x1c3)](_0x59f163,_0x2c7cd5,_0x1780a3,_0x46c05d){const _0x296ea5=0x32,_0x531b27=_0x59f163<_0x1780a3?_0x2c7cd5:_0x46c05d,_0x53c305=Math['floor'](_0x59f163/_0x296ea5),_0x395a98=_0x59f163%_0x296ea5,_0x5a9232=_0x531b27*0x3e8,_0x238341=0x64+Math['floor'](Math['random']()*0x190);return _0x395a98*_0x5a9232+_0x53c305*0x3e8+_0x238341;}[a575_0x5b0981(0x1ce)](_0x5e428b){const _0x493758=a575_0x5b0981,_0x2e64f2=[];for(let _0x3c445e=0x1;_0x3c445e<=0x5;_0x3c445e++){const _0x9f0b4b=_0x5e428b[_0x493758(0x1ae)+_0x3c445e];!(0x0,lodash_1[_0x493758(0x179)])(_0x9f0b4b)&&!(0x0,lodash_1['isNil'])(_0x9f0b4b)&&_0x2e64f2['push'](_0x9f0b4b);}return _0x2e64f2;}[a575_0x5b0981(0x1de)](_0x5ef02d,_0x46efee,_0x34e6b1){const _0x5c8fc5=a575_0x5b0981;let _0x3a8070=_0x5ef02d;return _0x3a8070[_0x5c8fc5(0x1c6)](_0x5c8fc5(0x182))&&(_0x3a8070=_0x3a8070[_0x5c8fc5(0x181)](/{nome}/g,_0x34e6b1[_0x5c8fc5(0x1df)])),_0x3a8070['includes'](_0x5c8fc5(0x1e9))&&(_0x3a8070=_0x3a8070[_0x5c8fc5(0x181)](/{email}/g,_0x34e6b1[_0x5c8fc5(0x1af)])),_0x3a8070['includes'](_0x5c8fc5(0x194))&&(_0x3a8070=_0x3a8070[_0x5c8fc5(0x181)](/{numero}/g,_0x34e6b1[_0x5c8fc5(0x184)])),_0x46efee['forEach'](_0x33016d=>{const _0x29a548=_0x5c8fc5;if(_0x3a8070['includes']('{'+_0x33016d[_0x29a548(0x175)]+'}')){const _0x9a8d92=new RegExp('{'+_0x33016d['key']+'}','g');_0x3a8070=_0x3a8070[_0x29a548(0x181)](_0x9a8d92,_0x33016d[_0x29a548(0x196)]);}}),_0x3a8070;}async[a575_0x5b0981(0x1cc)](){const _0x106790=a575_0x5b0981,_0x3e744a=await Campaign_1[_0x106790(0x1ec)][_0x106790(0x164)]({'where':{'status':'EM_ANDAMENTO','estimatedCompletionTime':{[sequelize_1['Op']['lt']]:(0x0,moment_1[_0x106790(0x1ec)])()[_0x106790(0x1e1)]()}}});for(const _0x7bf72e of _0x3e744a){try{const _0x466aa4=await CampaignShipping_1[_0x106790(0x1ec)][_0x106790(0x1c8)]({'where':{'campaignId':_0x7bf72e['id'],'deliveredAt':{[sequelize_1['Op']['not']]:null}}}),_0x4d61de=await ContactListItem_1['default']['count']({'where':{'contactListId':_0x7bf72e[_0x106790(0x1a7)],'isWhatsappValid':!![]}});_0x466aa4<_0x4d61de?(logger_1[_0x106790(0x1ac)]['info'](_0x106790(0x1da)+_0x7bf72e['id']),await _0x7bf72e[_0x106790(0x198)]({'status':'PROGRAMADA','updatedAt':new Date()}),await this['processingQueue'][_0x106790(0x1a4)](_0x106790(0x1c5),{'campaignId':_0x7bf72e['id']},{'attempts':MAX_ATTEMPTS,'removeOnComplete':!![]})):await _0x7bf72e[_0x106790(0x198)]({'status':_0x106790(0x165),'completedAt':(0x0,moment_1['default'])()});}catch(_0x5bc426){logger_1['logger']['error']('Erro\x20ao\x20recuperar\x20campanha\x20travada:\x20'+_0x5bc426),Sentry[_0x106790(0x1ba)](_0x5bc426);}}}}exports[a575_0x5b0981(0x1ec)]=CampaignQueueManager;