const a574_0x4223ea=a574_0x2e63;function a574_0x1a66(){const _0x198bc7=['search','handleProcessingBatch','info','captureException','call','emit','apply','path','REDIS_HOST','default','dispatch-queue','{numero}','count','messageInterval','random','hasOwnProperty','data','getCampaignQueue','Erro\x20no\x20envio\x20da\x20campanha:\x20','initializeWorkers','675030RfiwIM','diff','fileList','public','logger','__setModuleDefault','getProcessedMessage','sequelize','message','EM_ANDAMENTO','-campaign','processingQueue','error','number','floor','companyId','resolve','process-campaign','Error\x20sending\x20campaign\x20files:\x20','handleVerifyCampaigns','push','contactListId','../helpers/SendPresenceStatus','value','send-campaign','status','env','Retomando\x20campanha\x20travada:\x20','../helpers/GetWhatsappWbot','get','handleDispatchCampaign','Queue','getCampaignValidMessages','campaignQueue','fileListId','not','(((.+)+)+)+$','18zfyAEc','2800532sTLnuv','add','writable','getTime','email','toJSON','\x20failed:\x20','Erro\x20na\x20verificação\x20de\x20campanhas\x20travadas','ceil','lodash','replace','__esModule','20kUXNxe','whatsapp','isEmpty','Campanha\x20ou\x20lista\x20de\x20contatos\x20não\x20encontrada','12512740woYSoF','key','../services/FileServices/ShowService','SendPresenceStatus','length','milliseconds','name','REDIS_PASSWORD','calculateOptimizedDelay','contacts','create','6379','getSettings','Job\x20','slice','@s.whatsapp.net','contactList','findAll','failed','Worker','REDIS_PORT','../models/CampaignSetting','../models/Campaign','getOwnPropertyDescriptor','Erro\x20ao\x20recuperar\x20campanha\x20travada:\x20','findByPk','max','calculateTotalTimeEstimate','processing-queue','company','__createBinding','map','../libs/socket','variables','completed','{nome}','../utils/logger','VerifyCampaigns','Campanha\x20ou\x20contato\x20não\x20encontrado','PROGRAMADA','includes','Erro\x20no\x20processamento\x20em\x20lote:\x20','resumeStaledCampaigns','dispatchQueue','131645cGjySp','-mainchannel','company-','10619584IvkPGs','greaterInterval','longerIntervalAfter','127.0.0.1','4041760TrycWM','2rNOOve','update','getIO','../models/ContactList','1587666kVcujt','forEach','moment/moment','sendMessage'];a574_0x1a66=function(){return _0x198bc7;};return a574_0x1a66();}(function(_0xea3b27,_0x35b214){const _0x9dea65=a574_0x2e63,_0x5805ae=_0xea3b27();while(!![]){try{const _0x5a4aba=-parseInt(_0x9dea65(0x14e))/0x1*(parseInt(_0x9dea65(0x156))/0x2)+parseInt(_0x9dea65(0x172))/0x3*(parseInt(_0x9dea65(0x1a4))/0x4)+-parseInt(_0x9dea65(0x155))/0x5+-parseInt(_0x9dea65(0x15a))/0x6+-parseInt(_0x9dea65(0x198))/0x7+-parseInt(_0x9dea65(0x151))/0x8+-parseInt(_0x9dea65(0x197))/0x9*(-parseInt(_0x9dea65(0x1a8))/0xa);if(_0x5a4aba===_0x35b214)break;else _0x5805ae['push'](_0x5805ae['shift']());}catch(_0x5788cb){_0x5805ae['push'](_0x5805ae['shift']());}}}(a574_0x1a66,0xa9caa));const a574_0x25d8c2=(function(){let _0x3499bf=!![];return function(_0x19859e,_0x5c0fe9){const _0x407c2d=_0x3499bf?function(){const _0x4845d3=a574_0x2e63;if(_0x5c0fe9){const _0x913d43=_0x5c0fe9[_0x4845d3(0x164)](_0x19859e,arguments);return _0x5c0fe9=null,_0x913d43;}}:function(){};return _0x3499bf=![],_0x407c2d;};}()),a574_0x416247=a574_0x25d8c2(this,function(){const _0x193451=a574_0x2e63;return a574_0x416247['toString']()['search'](_0x193451(0x196))['toString']()['constructor'](a574_0x416247)[_0x193451(0x15e)](_0x193451(0x196));});a574_0x416247();'use strict';var __createBinding=this&&this[a574_0x4223ea(0x1c6)]||(Object[a574_0x4223ea(0x1b2)]?function(_0x10fde2,_0x1d8ab9,_0x45bca9,_0x1a00ab){const _0x2ce238=a574_0x4223ea;if(_0x1a00ab===undefined)_0x1a00ab=_0x45bca9;var _0x2a3cf4=Object[_0x2ce238(0x1bf)](_0x1d8ab9,_0x45bca9);(!_0x2a3cf4||(_0x2ce238(0x18f)in _0x2a3cf4?!_0x1d8ab9[_0x2ce238(0x1a3)]:_0x2a3cf4[_0x2ce238(0x19a)]||_0x2a3cf4['configurable']))&&(_0x2a3cf4={'enumerable':!![],'get':function(){return _0x1d8ab9[_0x45bca9];}}),Object['defineProperty'](_0x10fde2,_0x1a00ab,_0x2a3cf4);}:function(_0x43d5fb,_0x453203,_0x44f476,_0xdf64ac){if(_0xdf64ac===undefined)_0xdf64ac=_0x44f476;_0x43d5fb[_0xdf64ac]=_0x453203[_0x44f476];}),__setModuleDefault=this&&this[a574_0x4223ea(0x177)]||(Object[a574_0x4223ea(0x1b2)]?function(_0xff2f3d,_0x1f8a3d){const _0xc949e7=a574_0x4223ea;Object['defineProperty'](_0xff2f3d,_0xc949e7(0x167),{'enumerable':!![],'value':_0x1f8a3d});}:function(_0x97ec71,_0x13d9c3){const _0x139d42=a574_0x4223ea;_0x97ec71[_0x139d42(0x167)]=_0x13d9c3;}),__importStar=this&&this['__importStar']||function(_0x34c48d){const _0x1c3e05=a574_0x4223ea;if(_0x34c48d&&_0x34c48d[_0x1c3e05(0x1a3)])return _0x34c48d;var _0x58cfeb={};if(_0x34c48d!=null){for(var _0x2bc48d in _0x34c48d)if(_0x2bc48d!==_0x1c3e05(0x167)&&Object['prototype'][_0x1c3e05(0x16d)][_0x1c3e05(0x162)](_0x34c48d,_0x2bc48d))__createBinding(_0x58cfeb,_0x34c48d,_0x2bc48d);}return __setModuleDefault(_0x58cfeb,_0x34c48d),_0x58cfeb;},__importDefault=this&&this['__importDefault']||function(_0x49caa7){const _0x307045=a574_0x4223ea;return _0x49caa7&&_0x49caa7[_0x307045(0x1a3)]?_0x49caa7:{'default':_0x49caa7};};Object['defineProperty'](exports,a574_0x4223ea(0x1a3),{'value':!![]});const bullmq_1=require('bullmq'),Campaign_1=__importDefault(require(a574_0x4223ea(0x1be))),sequelize_1=require(a574_0x4223ea(0x179)),logger_1=require(a574_0x4223ea(0x1cc)),moment_1=__importDefault(require(a574_0x4223ea(0x15c))),Sentry=__importStar(require('@sentry/node')),ContactList_1=__importDefault(require(a574_0x4223ea(0x159))),ContactListItem_1=__importDefault(require('../models/ContactListItem')),CampaignShipping_1=__importDefault(require('../models/CampaignShipping')),SendWhatsAppMedia_1=require('../services/WbotServices/SendWhatsAppMedia'),GetWhatsappWbot_1=__importDefault(require(a574_0x4223ea(0x18e))),SendPresenceStatus_1=require(a574_0x4223ea(0x188)),socket_1=require(a574_0x4223ea(0x1c8)),path_1=__importDefault(require('path')),ShowService_1=__importDefault(require(a574_0x4223ea(0x1aa))),CampaignSetting_1=__importDefault(require(a574_0x4223ea(0x1bd))),lodash_1=require(a574_0x4223ea(0x1a1)),redisConfig={'port':parseInt(process[a574_0x4223ea(0x18c)][a574_0x4223ea(0x1bc)]||a574_0x4223ea(0x1b3)),'host':process['env'][a574_0x4223ea(0x166)]||a574_0x4223ea(0x154),'password':process['env'][a574_0x4223ea(0x1af)]},CAMPAIGN_CONCURRENCY=0x5,DISPATCH_CONCURRENCY=0x1,BATCH_SIZE=0x14,MAX_ATTEMPTS=0x3;function a574_0x2e63(_0x1b7f8e,_0x3f50e6){const _0x3e9aa8=a574_0x1a66();return a574_0x2e63=function(_0x416247,_0x25d8c2){_0x416247=_0x416247-0x148;let _0x1a664c=_0x3e9aa8[_0x416247];return _0x1a664c;},a574_0x2e63(_0x1b7f8e,_0x3f50e6);}class CampaignQueueManager{constructor(_0x2adb2b,_0x112b7e){const _0x392392=a574_0x4223ea,_0x1d19ff=_0x112b7e||redisConfig;this[_0x392392(0x193)]=new bullmq_1['Queue'](_0x2adb2b||'campaign-queue',{'connection':_0x1d19ff}),this[_0x392392(0x17d)]=new bullmq_1['Queue'](_0x392392(0x1c4),{'connection':_0x1d19ff}),this['dispatchQueue']=new bullmq_1[(_0x392392(0x191))](_0x392392(0x168),{'connection':_0x1d19ff}),this[_0x392392(0x171)](_0x1d19ff);}[a574_0x4223ea(0x16f)](){return this['campaignQueue'];}async[a574_0x4223ea(0x1b4)](_0x3c3412){const _0x1ddf71=a574_0x4223ea,_0x151598=await CampaignSetting_1['default'][_0x1ddf71(0x1b9)]({'where':{'companyId':_0x3c3412},'attributes':[_0x1ddf71(0x1a9),_0x1ddf71(0x189)]}),_0x448ea4={'messageInterval':0x14,'longerIntervalAfter':0x14,'greaterInterval':0x3c,'variables':[]};return _0x151598['forEach'](_0x47c880=>{const _0x1d450c=_0x1ddf71;switch(_0x47c880['key']){case _0x1d450c(0x16b):_0x448ea4['messageInterval']=parseInt(_0x47c880[_0x1d450c(0x189)],0xa);break;case'longerIntervalAfter':_0x448ea4[_0x1d450c(0x153)]=parseInt(_0x47c880[_0x1d450c(0x189)],0xa);break;case'greaterInterval':_0x448ea4['greaterInterval']=parseInt(_0x47c880[_0x1d450c(0x189)],0xa);break;case _0x1d450c(0x1c9):_0x448ea4[_0x1d450c(0x1c9)]=JSON['parse'](_0x47c880['value']);break;}}),_0x448ea4;}[a574_0x4223ea(0x171)](_0x183af1){const _0x17186f=a574_0x4223ea,_0x27065d=new bullmq_1[(_0x17186f(0x1bb))]('campaign-queue',async _0xbadf2a=>{const _0x5156ea=_0x17186f;if(_0xbadf2a[_0x5156ea(0x1ae)]===_0x5156ea(0x1cd))return this[_0x5156ea(0x185)](_0xbadf2a);},{'connection':_0x183af1,'concurrency':CAMPAIGN_CONCURRENCY});setInterval(async()=>{const _0x150651=_0x17186f;try{await this[_0x150651(0x14c)]();}catch(_0x305a3d){logger_1['logger'][_0x150651(0x17e)](_0x150651(0x19f),_0x305a3d);}},0x1e*0x3c*0x3e8);const _0x3ffbac=new bullmq_1[(_0x17186f(0x1bb))](_0x17186f(0x1c4),async _0x3cace9=>{const _0xc1cef8=_0x17186f;await this[_0xc1cef8(0x15f)](_0x3cace9[_0xc1cef8(0x16e)]);},{'connection':_0x183af1,'concurrency':CAMPAIGN_CONCURRENCY}),_0x386ceb=new bullmq_1['Worker'](_0x17186f(0x168),async _0x37fccb=>{const _0x11bf46=_0x17186f;await this[_0x11bf46(0x190)](_0x37fccb[_0x11bf46(0x16e)]);},{'connection':_0x183af1,'concurrency':DISPATCH_CONCURRENCY});[_0x27065d,_0x3ffbac,_0x386ceb]['forEach'](_0x5d3095=>{const _0x382720=_0x17186f;_0x5d3095['on'](_0x382720(0x1ba),(_0x335e6c,_0xaa1b99)=>{const _0x161421=_0x382720;logger_1[_0x161421(0x176)][_0x161421(0x17e)]('Job\x20'+_0x335e6c[_0x161421(0x1ae)]+_0x161421(0x19e)+_0xaa1b99['message']),Sentry[_0x161421(0x161)](_0xaa1b99);}),_0x5d3095['on'](_0x382720(0x1ca),_0x3a5c3a=>{const _0x10d1cb=_0x382720;logger_1['logger'][_0x10d1cb(0x160)](_0x10d1cb(0x1b5)+_0x3a5c3a['name']+'\x20completed\x20successfully');});});}async['handleVerifyCampaigns'](_0x34c194){const _0x3e754e=a574_0x4223ea;logger_1['logger'][_0x3e754e(0x160)]('handleVerifyCampaigns\x20iniciado');const _0x4435e4=new Date(new Date()[_0x3e754e(0x19b)]()+0x3c*0x3c*0x3e8),_0x35e701=await Campaign_1['default'][_0x3e754e(0x1b9)]({'where':{'scheduledAt':{[sequelize_1['Op']['lte']]:+_0x4435e4},'status':'PROGRAMADA'}});for(const _0x14c937 of _0x35e701){try{const _0x2ec8ff=(0x0,moment_1[_0x3e754e(0x167)])(),_0x221a98=(0x0,moment_1[_0x3e754e(0x167)])(_0x14c937['scheduledAt']),_0x19f890=_0x221a98[_0x3e754e(0x173)](_0x2ec8ff,_0x3e754e(0x1ad));await this[_0x3e754e(0x17d)][_0x3e754e(0x199)](_0x3e754e(0x183),{'campaignId':_0x14c937['id']},{'delay':_0x19f890,'attempts':MAX_ATTEMPTS,'removeOnComplete':!![]}),await _0x14c937[_0x3e754e(0x157)]({'status':'EM_ANDAMENTO'});const _0x4c331f=(0x0,socket_1[_0x3e754e(0x158)])();_0x4c331f['to']('company-'+_0x14c937['companyId']+'-mainchannel')[_0x3e754e(0x163)](_0x3e754e(0x150)+_0x14c937['companyId']+_0x3e754e(0x17c),{'action':_0x3e754e(0x157),'record':_0x14c937});}catch(_0x2d8ed1){Sentry[_0x3e754e(0x161)](_0x2d8ed1),logger_1[_0x3e754e(0x176)][_0x3e754e(0x17e)]('Erro\x20ao\x20processar\x20campanha:\x20'+_0x2d8ed1);}}return{'count':_0x35e701[_0x3e754e(0x1ac)]};}async[a574_0x4223ea(0x15f)](_0x2f0113){const _0x15697f=a574_0x4223ea,{campaignId:_0xc33071}=_0x2f0113;try{const _0xbc18ba=await Campaign_1['default'][_0x15697f(0x1c1)](_0xc33071,{'include':[{'model':ContactList_1[_0x15697f(0x167)],'as':'contactList','include':[{'model':ContactListItem_1[_0x15697f(0x167)],'as':_0x15697f(0x1b1),'where':{'isWhatsappValid':!![]}}]}]});if(!_0xbc18ba||!_0xbc18ba[_0x15697f(0x1b8)])throw new Error(_0x15697f(0x1a7));const _0x43b3f7=await CampaignShipping_1[_0x15697f(0x167)][_0x15697f(0x1b9)]({'where':{'campaignId':_0xbc18ba['id'],'deliveredAt':{[sequelize_1['Op'][_0x15697f(0x195)]]:null}},'attributes':['contactId']}),_0x30f391=new Set(_0x43b3f7[_0x15697f(0x1c7)](_0x1e1b3a=>_0x1e1b3a['contactId'])),_0x5a88a8=await this[_0x15697f(0x1b4)](_0xbc18ba[_0x15697f(0x181)]),_0x5d1b96=_0xbc18ba[_0x15697f(0x1b8)][_0x15697f(0x1b1)]['filter'](_0xd3f8e7=>!_0x30f391['has'](_0xd3f8e7['id'])),_0x2f83b7=Math[_0x15697f(0x1a0)](_0x5d1b96[_0x15697f(0x1ac)]/BATCH_SIZE),_0x17a9a0=this['calculateTotalTimeEstimate'](_0x5d1b96[_0x15697f(0x1ac)],_0x5a88a8[_0x15697f(0x16b)],_0x5a88a8[_0x15697f(0x153)],_0x5a88a8[_0x15697f(0x152)]);await _0xbc18ba[_0x15697f(0x157)]({'estimatedCompletionTime':(0x0,moment_1[_0x15697f(0x167)])()['add'](_0x17a9a0,'seconds'),'updatedAt':new Date()});for(let _0xa6237e=0x0;_0xa6237e<_0x2f83b7;_0xa6237e++){const _0x5a6441=_0xa6237e*BATCH_SIZE,_0x3b1134=_0x5d1b96[_0x15697f(0x1b6)](_0x5a6441,_0x5a6441+BATCH_SIZE);for(let _0x3894be=0x0;_0x3894be<_0x3b1134[_0x15697f(0x1ac)];_0x3894be++){const _0x5e523e=_0x3b1134[_0x3894be],_0x181273=_0xa6237e*BATCH_SIZE+_0x3894be,_0x1da78f=this[_0x15697f(0x1b0)](_0x181273,_0x5a88a8[_0x15697f(0x16b)],_0x5a88a8[_0x15697f(0x153)],_0x5a88a8[_0x15697f(0x152)]);await this[_0x15697f(0x14d)]['add'](_0x15697f(0x18a),{'campaignId':_0xc33071,'contactId':_0x5e523e['id'],'totalContacts':_0x5d1b96[_0x15697f(0x1ac)],'settings':_0x5a88a8},{'delay':_0x1da78f,'attempts':MAX_ATTEMPTS,'removeOnComplete':!![]});}}}catch(_0x5542b3){Sentry['captureException'](_0x5542b3),logger_1['logger'][_0x15697f(0x17e)](_0x15697f(0x14b)+_0x5542b3);}}[a574_0x4223ea(0x1c3)](_0x13bdf4,_0x2b90d0,_0x10c3fd,_0x289bfd){const _0x51e5c4=a574_0x4223ea,_0xa1f236=Math['min'](_0x13bdf4,_0x10c3fd),_0x5cb107=Math[_0x51e5c4(0x1c2)](0x0,_0x13bdf4-_0x10c3fd);return _0xa1f236*_0x2b90d0+_0x5cb107*_0x289bfd;}async[a574_0x4223ea(0x190)](_0x3fcb7b){const _0x4b7e8a=a574_0x4223ea,{campaignId:_0x5b3e16,contactId:_0x2e2036,totalContacts:_0x211d44,settings:_0x1b3b7b}=_0x3fcb7b;try{const _0x313676=await Campaign_1[_0x4b7e8a(0x167)][_0x4b7e8a(0x1c1)](_0x5b3e16,{'include':[_0x4b7e8a(0x1a5)]}),_0xca6c4f=await ContactListItem_1[_0x4b7e8a(0x167)]['findByPk'](_0x2e2036);if(!_0x313676||!_0xca6c4f)throw new Error(_0x4b7e8a(0x148));const _0x205ba5=await(0x0,GetWhatsappWbot_1[_0x4b7e8a(0x167)])(_0x313676[_0x4b7e8a(0x1a5)]),_0x1e66ee=_0xca6c4f['number']+_0x4b7e8a(0x1b7),_0x5051d0=this[_0x4b7e8a(0x192)](_0x313676),_0x226f84=Math['floor'](Math['random']()*_0x5051d0[_0x4b7e8a(0x1ac)]),_0x1611ef=_0x5051d0[_0x226f84],_0x2d957d=this[_0x4b7e8a(0x178)](_0x1611ef,_0x1b3b7b[_0x4b7e8a(0x1c9)],_0xca6c4f);await(0x0,SendPresenceStatus_1[_0x4b7e8a(0x1ab)])(_0x205ba5,_0x1e66ee);const _0x114a27=await _0x205ba5[_0x4b7e8a(0x15d)](_0x1e66ee,{'text':_0x2d957d});if(!(0x0,lodash_1['isNil'])(_0x313676[_0x4b7e8a(0x194)]))try{const _0x516366=await(0x0,ShowService_1[_0x4b7e8a(0x167)])(_0x313676['fileListId'],_0x313676[_0x4b7e8a(0x181)]),_0x16521e=path_1[_0x4b7e8a(0x167)][_0x4b7e8a(0x182)](__dirname,'../..',_0x4b7e8a(0x175),_0x4b7e8a(0x1c5)+_0x313676[_0x4b7e8a(0x181)],_0x4b7e8a(0x174),String(_0x516366['id']));for(const _0x47cb63 of _0x516366['options']){const _0x2680b8=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x47cb63[_0x4b7e8a(0x165)],path_1[_0x4b7e8a(0x167)]['resolve'](_0x16521e,_0x47cb63[_0x4b7e8a(0x165)]),_0x47cb63[_0x4b7e8a(0x1ae)],_0x313676[_0x4b7e8a(0x181)]);await _0x205ba5[_0x4b7e8a(0x15d)](_0x1e66ee,{..._0x2680b8});}}catch(_0x550f52){logger_1[_0x4b7e8a(0x176)][_0x4b7e8a(0x17e)](_0x4b7e8a(0x184)+_0x550f52);}await CampaignShipping_1['default'][_0x4b7e8a(0x1b2)]({'campaignId':_0x5b3e16,'contactId':_0xca6c4f['id'],'number':_0xca6c4f[_0x4b7e8a(0x17f)],'messageId':_0x114a27['key']['id'],'message':_0x2d957d,'deliveredAt':(0x0,moment_1[_0x4b7e8a(0x167)])()});const _0x3e50ec=await CampaignShipping_1['default'][_0x4b7e8a(0x16a)]({'where':{'campaignId':_0x5b3e16,'deliveredAt':{[sequelize_1['Op']['not']]:null}}});_0x3e50ec>=_0x211d44&&await _0x313676[_0x4b7e8a(0x157)]({'status':'FINALIZADA','completedAt':(0x0,moment_1['default'])()});const _0x41f43a=(0x0,socket_1['getIO'])();_0x41f43a['to']('company-'+_0x313676['companyId']+_0x4b7e8a(0x14f))[_0x4b7e8a(0x163)]('company-'+_0x313676['companyId']+_0x4b7e8a(0x17c),{'action':'update','record':{..._0x313676[_0x4b7e8a(0x19d)](),'completedContacts':_0x3e50ec,'totalContacts':_0x211d44,'status':_0x313676[_0x4b7e8a(0x18b)]}});}catch(_0x239bcd){Sentry['captureException'](_0x239bcd),logger_1[_0x4b7e8a(0x176)][_0x4b7e8a(0x17e)](_0x4b7e8a(0x170)+_0x239bcd);}}[a574_0x4223ea(0x1b0)](_0x1a5475,_0x3b8879,_0x2d4767,_0x3e4c14){const _0x2bc639=a574_0x4223ea,_0x5b880d=_0x1a5475<_0x2d4767?_0x3b8879:_0x3e4c14,_0x594ff0=0x64+Math[_0x2bc639(0x180)](Math[_0x2bc639(0x16c)]()*0x190);return _0x5b880d*0x3e8+_0x594ff0;}[a574_0x4223ea(0x192)](_0x13a6af){const _0x275a78=a574_0x4223ea,_0x15827d=[];for(let _0x3d0914=0x1;_0x3d0914<=0x5;_0x3d0914++){const _0x46009a=_0x13a6af[_0x275a78(0x17a)+_0x3d0914];!(0x0,lodash_1[_0x275a78(0x1a6)])(_0x46009a)&&!(0x0,lodash_1['isNil'])(_0x46009a)&&_0x15827d[_0x275a78(0x186)](_0x46009a);}return _0x15827d;}['getProcessedMessage'](_0x59b24c,_0x4cdbd1,_0x7a532f){const _0x469e00=a574_0x4223ea;let _0x156b56=_0x59b24c;return _0x156b56['includes'](_0x469e00(0x1cb))&&(_0x156b56=_0x156b56[_0x469e00(0x1a2)](/{nome}/g,_0x7a532f[_0x469e00(0x1ae)])),_0x156b56[_0x469e00(0x14a)]('{email}')&&(_0x156b56=_0x156b56[_0x469e00(0x1a2)](/{email}/g,_0x7a532f[_0x469e00(0x19c)])),_0x156b56[_0x469e00(0x14a)](_0x469e00(0x169))&&(_0x156b56=_0x156b56['replace'](/{numero}/g,_0x7a532f['number'])),_0x4cdbd1[_0x469e00(0x15b)](_0x56b8fb=>{const _0x3d6b74=_0x469e00;if(_0x156b56[_0x3d6b74(0x14a)]('{'+_0x56b8fb[_0x3d6b74(0x1a9)]+'}')){const _0xe4f914=new RegExp('{'+_0x56b8fb[_0x3d6b74(0x1a9)]+'}','g');_0x156b56=_0x156b56[_0x3d6b74(0x1a2)](_0xe4f914,_0x56b8fb[_0x3d6b74(0x189)]);}}),_0x156b56;}async[a574_0x4223ea(0x14c)](){const _0x43d6d9=a574_0x4223ea,_0x2d53ed=await Campaign_1[_0x43d6d9(0x167)][_0x43d6d9(0x1b9)]({'where':{'status':_0x43d6d9(0x17b),'estimatedCompletionTime':{[sequelize_1['Op']['lt']]:(0x0,moment_1['default'])()['toDate']()}}});for(const _0x433a58 of _0x2d53ed){try{const _0x26a7af=await CampaignShipping_1[_0x43d6d9(0x167)][_0x43d6d9(0x16a)]({'where':{'campaignId':_0x433a58['id'],'deliveredAt':{[sequelize_1['Op'][_0x43d6d9(0x195)]]:null}}}),_0x17dba9=await ContactListItem_1['default'][_0x43d6d9(0x16a)]({'where':{'contactListId':_0x433a58[_0x43d6d9(0x187)],'isWhatsappValid':!![]}});_0x26a7af<_0x17dba9?(logger_1['logger'][_0x43d6d9(0x160)](_0x43d6d9(0x18d)+_0x433a58['id']),await _0x433a58[_0x43d6d9(0x157)]({'status':_0x43d6d9(0x149),'updatedAt':new Date()}),await this['processingQueue'][_0x43d6d9(0x199)](_0x43d6d9(0x183),{'campaignId':_0x433a58['id']},{'attempts':MAX_ATTEMPTS,'removeOnComplete':!![]})):await _0x433a58[_0x43d6d9(0x157)]({'status':'FINALIZADA','completedAt':(0x0,moment_1['default'])()});}catch(_0x58681c){logger_1[_0x43d6d9(0x176)][_0x43d6d9(0x17e)](_0x43d6d9(0x1c0)+_0x58681c),Sentry[_0x43d6d9(0x161)](_0x58681c);}}}}exports[a574_0x4223ea(0x167)]=CampaignQueueManager;