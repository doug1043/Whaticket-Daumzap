const a309_0x35149a=a309_0x4a5b;(function(_0x528d94,_0x5a50a2){const _0x420fe4=a309_0x4a5b,_0x245818=_0x528d94();while(!![]){try{const _0x1e1d1e=parseInt(_0x420fe4(0x1bf))/0x1+-parseInt(_0x420fe4(0x1fa))/0x2+parseInt(_0x420fe4(0x21f))/0x3+-parseInt(_0x420fe4(0x208))/0x4*(parseInt(_0x420fe4(0x1c3))/0x5)+parseInt(_0x420fe4(0x1d7))/0x6+parseInt(_0x420fe4(0x21a))/0x7+parseInt(_0x420fe4(0x1de))/0x8*(parseInt(_0x420fe4(0x1d2))/0x9);if(_0x1e1d1e===_0x5a50a2)break;else _0x245818['push'](_0x245818['shift']());}catch(_0x3e6705){_0x245818['push'](_0x245818['shift']());}}}(a309_0x4d5d,0x912ad));const a309_0x42ab2b=(function(){let _0x21082c=!![];return function(_0x18f02e,_0x3dbe2){const _0x42f8f4=_0x21082c?function(){const _0x502a8a=a309_0x4a5b;if(_0x3dbe2){const _0x51d8da=_0x3dbe2[_0x502a8a(0x1bc)](_0x18f02e,arguments);return _0x3dbe2=null,_0x51d8da;}}:function(){};return _0x21082c=![],_0x42f8f4;};}()),a309_0x5b7fb8=a309_0x42ab2b(this,function(){const _0x29651a=a309_0x4a5b;return a309_0x5b7fb8[_0x29651a(0x1ad)]()[_0x29651a(0x1a2)](_0x29651a(0x1eb))[_0x29651a(0x1ad)]()['constructor'](a309_0x5b7fb8)[_0x29651a(0x1a2)](_0x29651a(0x1eb));});a309_0x5b7fb8();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a309_0x35149a(0x202)]?function(_0x45116c,_0x12214a,_0x31b8ab,_0x39946e){const _0x2dd882=a309_0x35149a;if(_0x39946e===undefined)_0x39946e=_0x31b8ab;var _0x3c6aaf=Object[_0x2dd882(0x1f5)](_0x12214a,_0x31b8ab);(!_0x3c6aaf||(_0x2dd882(0x1e6)in _0x3c6aaf?!_0x12214a['__esModule']:_0x3c6aaf[_0x2dd882(0x20b)]||_0x3c6aaf['configurable']))&&(_0x3c6aaf={'enumerable':!![],'get':function(){return _0x12214a[_0x31b8ab];}}),Object[_0x2dd882(0x20c)](_0x45116c,_0x39946e,_0x3c6aaf);}:function(_0x5559cd,_0x4b803a,_0x55df30,_0xc1b9f3){if(_0xc1b9f3===undefined)_0xc1b9f3=_0x55df30;_0x5559cd[_0xc1b9f3]=_0x4b803a[_0x55df30];}),__setModuleDefault=this&&this[a309_0x35149a(0x20a)]||(Object['create']?function(_0x46e6ba,_0x2b00b){const _0x9cbf6c=a309_0x35149a;Object['defineProperty'](_0x46e6ba,_0x9cbf6c(0x199),{'enumerable':!![],'value':_0x2b00b});}:function(_0x38f20a,_0x575899){_0x38f20a['default']=_0x575899;}),__importStar=this&&this[a309_0x35149a(0x22c)]||function(_0x1a3d3b){const _0x2fd2f7=a309_0x35149a;if(_0x1a3d3b&&_0x1a3d3b[_0x2fd2f7(0x22a)])return _0x1a3d3b;var _0x1c16ca={};if(_0x1a3d3b!=null){for(var _0x54f764 in _0x1a3d3b)if(_0x54f764!==_0x2fd2f7(0x199)&&Object[_0x2fd2f7(0x197)][_0x2fd2f7(0x21b)][_0x2fd2f7(0x1a4)](_0x1a3d3b,_0x54f764))__createBinding(_0x1c16ca,_0x1a3d3b,_0x54f764);}return __setModuleDefault(_0x1c16ca,_0x1a3d3b),_0x1c16ca;},__importDefault=this&&this[a309_0x35149a(0x201)]||function(_0xaa7740){return _0xaa7740&&_0xaa7740['__esModule']?_0xaa7740:{'default':_0xaa7740};};Object[a309_0x35149a(0x20c)](exports,'__esModule',{'value':!![]}),exports[a309_0x35149a(0x1b3)]=exports[a309_0x35149a(0x211)]=exports[a309_0x35149a(0x1f0)]=exports[a309_0x35149a(0x1e2)]=exports[a309_0x35149a(0x1b4)]=exports[a309_0x35149a(0x218)]=exports['queueMonitor']=exports[a309_0x35149a(0x1ee)]=exports[a309_0x35149a(0x1f3)]=exports['userMonitor']=void 0x0;const Sentry=__importStar(require(a309_0x35149a(0x1d9))),bullmq_1=require('bullmq'),SendMessage_1=require(a309_0x35149a(0x198)),Whatsapp_1=__importDefault(require(a309_0x35149a(0x1ac))),logger_1=require('./utils/logger'),moment_1=__importDefault(require(a309_0x35149a(0x20e))),Contact_1=__importDefault(require(a309_0x35149a(0x1cc))),sequelize_1=require('sequelize'),socket_1=require('./libs/socket'),User_1=__importDefault(require(a309_0x35149a(0x216))),Company_1=__importDefault(require(a309_0x35149a(0x22f))),Plan_1=__importDefault(require(a309_0x35149a(0x200))),Ticket_1=__importDefault(require(a309_0x35149a(0x1a6))),wbotClosedTickets_1=require('./services/WbotServices/wbotClosedTickets'),Invoices_1=__importDefault(require(a309_0x35149a(0x214))),wbotMessageListener_1=require('./services/WbotServices/wbotMessageListener'),wbot_1=require('./libs/wbot'),MarkDeleteWhatsAppMessage_1=__importDefault(require('./services/WbotServices/MarkDeleteWhatsAppMessage')),ioredis_1=__importDefault(require(a309_0x35149a(0x1c9))),campaingJob_1=__importDefault(require(a309_0x35149a(0x1f4))),scheduledMessageJob_1=__importDefault(require(a309_0x35149a(0x1d1))),connection={'port':parseInt(process['env'][a309_0x35149a(0x225)]),'host':process[a309_0x35149a(0x205)][a309_0x35149a(0x1ae)]||a309_0x35149a(0x220),'password':process[a309_0x35149a(0x205)][a309_0x35149a(0x1b7)]},limiterMax=process[a309_0x35149a(0x205)]['REDIS_OPT_LIMITER_MAX']||0x1,limiterDuration=process[a309_0x35149a(0x205)][a309_0x35149a(0x1a3)]||0xbb8,redis=new ioredis_1[(a309_0x35149a(0x199))](process['env']['REDIS_URI']);function a309_0x4d5d(){const _0x356014=['6764849KNsdvh','hasOwnProperty','SearchForQueue\x20->\x20VerifyQueue:\x20error','pending','logger','527541patMhh','127.0.0.1','Atendimento\x20Perdido:\x20','extraInfo','asDays','data','REDIS_PORT','CloseTicketsAutomatic','minutes','log','getQueue','__esModule','info','__importStar','name','handle\x20login','./models/Company','VerifyCampaigns','prototype','./helpers/SendMessage','default','messageUpdate','Job\x20','whatsapps','Whatsapp\x20não\x20identificado','MessageUpdateJob','\x20completed','whatsappId','remoteJid','search','REDIS_OPT_LIMITER_DURATION','call','number','./models/Ticket','getIO','email','userMonitor','floor','map','./models/Whatsapp','toString','REDIS_HOST','SendMessage','messages','ScheduleMonitor','findByPk','startQueueProcess','campaignQueue','Error','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','REDIS_PASSWORD','-notification','verify','getWbot','company-','apply','Sleep\x20de\x20','endsWith','61960gRRqLQ','profilePicUrl','messageStubType','subtract','3425405wafRtp','CampaignQueue','Iniciando\x20geração\x20de\x20boletos','-ticket','handleMessage','\x20segundos\x20iniciado:\x20','ioredis','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','Worker','./models/Contact','HH:mm:ss','message','queueMonitor','contact','./workers/scheduledMessageJob','523323lvFoWB','Iniciando\x20processamento\x20de\x20filas','companyId','update','literal','261624ANOwlu','captureException','@sentry/node','completed','YYYY-MM-DD','\x20segundos\x20finalizado:\x20','reload','88AVoxgg','CONNECTED','planId','status@broadcast','parseToMilliseconds','DD/MM/yyyy','timeSendQueue','HandleMessageJob','get','VerifyQueueStatus','ClosedAllOpenTickets','emit','VerifyLoginStatus','(((.+)+)+)+$','QueueMonitor','InvoiceCreate','messageQueue','verifyCampaignMessageAndCloseTicket','sleep','setHours','setMinutes','generalMonitor','./workers/campaingJob','getOwnPropertyDescriptor','error','CURRENT_DATE','findAndCountAll','diff','1215498UPrTxb','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','utc','HANDLE\x20SEND\x20MESSAGE','handleMsgAck','status','./models/Plan','__importDefault','create','sendIdQueue','isInteger','env','key','readMessages','4lapbSe','like','__setModuleDefault','writable','defineProperty','duration','moment','findAll','add','randomValue','format','Queue','./models/Invoices','Sequelize','./models/User','\x20-\x20Empresa:\x20','scheduleMonitor','GeneralMonitor'];a309_0x4d5d=function(){return _0x356014;};return a309_0x4d5d();}exports['userMonitor']=new bullmq_1[(a309_0x35149a(0x213))]('UserMonitor',{'connection':connection}),exports['generalMonitor']=new bullmq_1[(a309_0x35149a(0x213))](a309_0x35149a(0x219),{'connection':connection}),exports[a309_0x35149a(0x1ee)]=new bullmq_1[(a309_0x35149a(0x213))]('MessageQueue',{'connection':connection}),exports[a309_0x35149a(0x1cf)]=new bullmq_1[(a309_0x35149a(0x213))](a309_0x35149a(0x1ec),{'connection':connection}),exports[a309_0x35149a(0x218)]=new bullmq_1[(a309_0x35149a(0x213))](a309_0x35149a(0x1b1),{'connection':connection}),exports[a309_0x35149a(0x1b4)]=new bullmq_1[(a309_0x35149a(0x213))](a309_0x35149a(0x1c4),{'connection':connection});function a309_0x4a5b(_0x256175,_0x7c87b9){const _0x1185d7=a309_0x4d5d();return a309_0x4a5b=function(_0x5b7fb8,_0x42ab2b){_0x5b7fb8=_0x5b7fb8-0x197;let _0x4d5d4e=_0x1185d7[_0x5b7fb8];return _0x4d5d4e;},a309_0x4a5b(_0x256175,_0x7c87b9);}async function handleVerifyQueueOld(_0x5ebab6){const _0x4e867a=a309_0x35149a;logger_1[_0x4e867a(0x21e)]['info']('Buscando\x20atendimentos\x20perdidos\x20nas\x20filas');try{const _0x3bfa24=await Company_1['default'][_0x4e867a(0x20f)]({'attributes':['id',_0x4e867a(0x22d)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x4e867a(0x215)]['literal'](_0x4e867a(0x1f7))}},'include':[{'model':Whatsapp_1[_0x4e867a(0x199)],'attributes':['id',_0x4e867a(0x22d),_0x4e867a(0x1ff),_0x4e867a(0x1e4),'sendIdQueue'],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x3bfa24['map'](async _0x36ad1d=>{const _0x592e5d=_0x4e867a;_0x36ad1d[_0x592e5d(0x19c)][_0x592e5d(0x1ab)](async _0x15ae43=>{const _0x438fe2=_0x592e5d;if(_0x15ae43[_0x438fe2(0x1ff)]===_0x438fe2(0x1df)){var _0x10cc66=_0x36ad1d['id'];const _0x2be3f1=_0x15ae43['timeSendQueue']?_0x15ae43['timeSendQueue']:0x0,_0xfd71da=_0x15ae43[_0x438fe2(0x203)],_0x25641f=_0x2be3f1,_0x1b542f=_0xfd71da,_0x24b3d1=_0x25641f;if(_0x2be3f1>0x0){if(!isNaN(_0x1b542f)&&Number['isInteger'](_0x1b542f)&&!isNaN(_0x24b3d1)&&Number[_0x438fe2(0x204)](_0x24b3d1)){const _0x5e3bb5=(0x0,moment_1[_0x438fe2(0x199)])()[_0x438fe2(0x1c2)](_0x24b3d1,'minutes')[_0x438fe2(0x1fc)]()[_0x438fe2(0x212)](),{count:_0xfb98b9,rows:_0x341e07}=await Ticket_1[_0x438fe2(0x199)][_0x438fe2(0x1f8)]({'where':{'status':'pending','queueId':null,'companyId':_0x10cc66,'whatsappId':_0x15ae43['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x5e3bb5}},'include':[{'model':Contact_1[_0x438fe2(0x199)],'as':_0x438fe2(0x1d0),'attributes':['id',_0x438fe2(0x22d),_0x438fe2(0x1a5),_0x438fe2(0x1a8),_0x438fe2(0x1c0)],'include':[_0x438fe2(0x222)]}]});_0xfb98b9>0x0?_0x341e07[_0x438fe2(0x1ab)](async _0x3d348c=>{const _0xad1af=_0x438fe2;await _0x3d348c[_0xad1af(0x1d5)]({'queueId':_0x1b542f}),await _0x3d348c[_0xad1af(0x1dd)]();const _0x14b4dd=(0x0,socket_1['getIO'])();_0x14b4dd['to'](_0xad1af(0x1bb)+_0x3d348c[_0xad1af(0x1d4)]+'-'+_0x3d348c[_0xad1af(0x1ff)])['to'](_0xad1af(0x1bb)+_0x3d348c['companyId']+'-notification')['to'](_0x3d348c['id'][_0xad1af(0x1ad)]())[_0xad1af(0x1e9)](_0xad1af(0x1bb)+_0x10cc66+_0xad1af(0x1c6),{'action':'update','ticket':_0x3d348c,'ticketId':_0x3d348c['id']}),logger_1[_0xad1af(0x21e)][_0xad1af(0x22b)](_0xad1af(0x221)+_0x3d348c['id']+'\x20-\x20Empresa:\x20'+_0x10cc66);}):logger_1['logger']['info'](_0x438fe2(0x1b6)+_0x10cc66);}else logger_1[_0x438fe2(0x21e)][_0x438fe2(0x22b)]('Condição\x20não\x20respeitada\x20-\x20Empresa:\x20'+_0x10cc66);}}});});}catch(_0x173a66){Sentry[_0x4e867a(0x1d8)](_0x173a66),logger_1[_0x4e867a(0x21e)][_0x4e867a(0x1f6)](_0x4e867a(0x21c)+_0x173a66);throw _0x173a66;}};async function handleVerifyQueue(_0x111bd8){const _0x2e6112=a309_0x35149a;logger_1['logger']['info'](_0x2e6112(0x1fb));try{const _0x7a5862=await Company_1['default'][_0x2e6112(0x20f)]({'attributes':['id',_0x2e6112(0x22d)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x2e6112(0x215)][_0x2e6112(0x1d6)](_0x2e6112(0x1f7))}},'include':[{'model':Whatsapp_1[_0x2e6112(0x199)],'attributes':['id','name',_0x2e6112(0x1ff),_0x2e6112(0x1e4),'sendIdQueue'],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x7a5862[_0x2e6112(0x1ab)](async _0x2bd56b=>{const _0xdef7fe=_0x2e6112;_0x2bd56b[_0xdef7fe(0x19c)]['map'](async _0x56978d=>{const _0xa446bc=_0xdef7fe;if(_0x56978d[_0xa446bc(0x1ff)]===_0xa446bc(0x1df)){const _0x974068=_0x2bd56b['id'],_0x44d801=_0x56978d[_0xa446bc(0x1e4)]?_0x56978d[_0xa446bc(0x1e4)]:0x0,_0x33ec87=_0x56978d[_0xa446bc(0x203)],_0x475284=_0x44d801,_0x4dbdb6=_0x33ec87,_0x9ad9f6=_0x475284;if(_0x44d801>0x0&&!isNaN(_0x4dbdb6)&&Number['isInteger'](_0x4dbdb6)&&!isNaN(_0x9ad9f6)&&Number['isInteger'](_0x9ad9f6)){const _0x5cdea6=(0x0,moment_1[_0xa446bc(0x199)])()[_0xa446bc(0x1c2)](_0x9ad9f6,_0xa446bc(0x227))[_0xa446bc(0x1fc)]()[_0xa446bc(0x212)](),{count:_0x2c18eb,rows:_0x40b032}=await Ticket_1[_0xa446bc(0x199)][_0xa446bc(0x1f8)]({'where':{'status':_0xa446bc(0x21d),'queueId':null,'companyId':_0x974068,'whatsappId':_0x56978d['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x5cdea6}},'include':[{'model':Contact_1[_0xa446bc(0x199)],'as':_0xa446bc(0x1d0),'attributes':['id',_0xa446bc(0x22d),_0xa446bc(0x1a5),_0xa446bc(0x1a8),'profilePicUrl'],'include':[_0xa446bc(0x222)]}]});_0x2c18eb>0x0?_0x40b032[_0xa446bc(0x1ab)](async _0x51be41=>{const _0x5621a9=_0xa446bc;await _0x51be41['update']({'queueId':_0x4dbdb6}),await _0x51be41[_0x5621a9(0x1dd)]();const _0x182042=(0x0,socket_1[_0x5621a9(0x1a7)])();_0x182042['to'](_0x5621a9(0x1bb)+_0x51be41[_0x5621a9(0x1d4)]+'-'+_0x51be41[_0x5621a9(0x1ff)])['to'](_0x5621a9(0x1bb)+_0x51be41[_0x5621a9(0x1d4)]+_0x5621a9(0x1b8))['to'](_0x51be41['id'][_0x5621a9(0x1ad)]())['emit'](_0x5621a9(0x1bb)+_0x974068+_0x5621a9(0x1c6),{'action':'update','ticket':_0x51be41,'ticketId':_0x51be41['id']}),logger_1[_0x5621a9(0x21e)][_0x5621a9(0x22b)]('Atendimento\x20Perdido:\x20'+_0x51be41['id']+_0x5621a9(0x217)+_0x974068);}):logger_1['logger'][_0xa446bc(0x22b)](_0xa446bc(0x1b6)+_0x974068);}else logger_1['logger']['info'](_0xa446bc(0x1ca)+_0x974068);}});});}catch(_0x5f326a){console[_0x2e6112(0x1f6)](_0x5f326a);}}async function handleCloseTicketsAutomatic(){const _0x47b61b=a309_0x35149a,_0x1f289c=await Company_1['default'][_0x47b61b(0x20f)]({'where':{'status':!![]}});_0x1f289c['map'](async _0x10f0f7=>{const _0x5727f6=_0x47b61b;try{const _0x5ddfec=_0x10f0f7['id'];await(0x0,wbotClosedTickets_1[_0x5727f6(0x1e8)])(_0x5ddfec);}catch(_0x151d72){Sentry['captureException'](_0x151d72),logger_1['logger'][_0x5727f6(0x1f6)]('ClosedAllOpenTickets\x20->\x20Verify:\x20error',_0x151d72[_0x5727f6(0x1ce)]);throw _0x151d72;}});}async function messageUpdateJob(_0xaa8185){const _0x53a6b9=a309_0x35149a,{data:_0x2371d9}=_0xaa8185;var _0x216609=_0x2371d9['companyId'],_0x136873=_0x2371d9[_0x53a6b9(0x19a)],_0x219ec0=_0x2371d9[_0x53a6b9(0x1a0)];const _0x30b6e4=(0x0,wbot_1['getWbot'])(_0x2371d9[_0x53a6b9(0x1a0)]);for(const _0xc75ee5 of _0x136873){await _0x30b6e4[_0x53a6b9(0x207)]([_0xc75ee5[_0x53a6b9(0x206)]]);const _0x5c07d2={..._0x136873};_0x5c07d2['0']?.[_0x53a6b9(0x1d5)][_0x53a6b9(0x1c1)]===0x1&&_0x5c07d2['0']?.[_0x53a6b9(0x206)][_0x53a6b9(0x1a1)]!==_0x53a6b9(0x1e1)&&await(0x0,MarkDeleteWhatsAppMessage_1['default'])(_0x5c07d2['0']?.[_0x53a6b9(0x206)][_0x53a6b9(0x1a1)],null,_0x5c07d2['0']?.[_0x53a6b9(0x206)]['id'],_0x216609),await(0x0,wbotMessageListener_1[_0x53a6b9(0x1fe)])(_0xc75ee5,_0xc75ee5[_0x53a6b9(0x1d5)]['status']);}}async function handleMessageJob(_0x576634){const _0x11093c=a309_0x35149a,{data:_0x42bccd}=_0x576634;var _0x53cbd4=_0x42bccd[_0x11093c(0x1b0)],_0x1b00df=_0x42bccd[_0x11093c(0x1d4)];const _0x28f402=(0x0,wbot_1[_0x11093c(0x1ba)])(_0x42bccd[_0x11093c(0x1a0)]);for(const _0x197d73 of _0x53cbd4){await(0x0,wbotMessageListener_1[_0x11093c(0x1c7)])(_0x197d73,_0x28f402,_0x1b00df),await(0x0,wbotMessageListener_1['verifyRecentCampaign'])(_0x197d73,_0x1b00df),await(0x0,wbotMessageListener_1[_0x11093c(0x1ef)])(_0x197d73,_0x1b00df),_0x197d73[_0x11093c(0x206)]['remoteJid']?.[_0x11093c(0x1be)]('@g.us')&&await(0x0,wbotMessageListener_1[_0x11093c(0x1fe)])(_0x197d73,0x2);}}async function handleSendMessage(_0x3b66ba){const _0x1a7242=a309_0x35149a;console[_0x1a7242(0x228)](_0x1a7242(0x1fd));try{const {data:_0x3045c7}=_0x3b66ba,_0x5ef6b5=await Whatsapp_1[_0x1a7242(0x199)][_0x1a7242(0x1b2)](_0x3045c7[_0x1a7242(0x1a0)]);if(_0x5ef6b5==null)throw new sequelize_1[(_0x1a7242(0x1b5))](_0x1a7242(0x19d));const _0x92e49d=_0x3045c7[_0x1a7242(0x224)];await(0x0,SendMessage_1[_0x1a7242(0x1af)])(_0x5ef6b5,_0x92e49d);}catch(_0x1d5c52){Sentry[_0x1a7242(0x1d8)](_0x1d5c52),logger_1[_0x1a7242(0x21e)][_0x1a7242(0x1f6)]('MessageQueue\x20->\x20SendMessage:\x20error',_0x1d5c52[_0x1a7242(0x1ce)]);throw _0x1d5c52;}}function parseToMilliseconds(_0x2d318b){return _0x2d318b*0x3e8;}exports[a309_0x35149a(0x1e2)]=parseToMilliseconds;async function sleep(_0x594e77){const _0x628609=a309_0x35149a;return logger_1['logger']['info']('Sleep\x20de\x20'+_0x594e77+_0x628609(0x1c8)+(0x0,moment_1[_0x628609(0x199)])()[_0x628609(0x212)]('HH:mm:ss')),new Promise(_0x164bc8=>{setTimeout(()=>{const _0x548363=a309_0x4a5b;logger_1[_0x548363(0x21e)][_0x548363(0x22b)](_0x548363(0x1bd)+_0x594e77+_0x548363(0x1dc)+(0x0,moment_1[_0x548363(0x199)])()[_0x548363(0x212)](_0x548363(0x1cd))),_0x164bc8(!![]);},parseToMilliseconds(_0x594e77));});}exports[a309_0x35149a(0x1f0)]=sleep;function randomValue(_0x74f7b5,_0x11a071){const _0x3fc4f0=a309_0x35149a;return Math[_0x3fc4f0(0x1aa)](Math['random']()*_0x11a071)+_0x74f7b5;}exports[a309_0x35149a(0x211)]=randomValue;async function handleLoginStatus(){const _0x3f35d7=a309_0x35149a;console['log'](_0x3f35d7(0x22e));const _0xcde68e=new Date();_0xcde68e[_0x3f35d7(0x1f2)](_0xcde68e['getMinutes']()-0x5),await User_1[_0x3f35d7(0x199)][_0x3f35d7(0x1d5)]({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0xcde68e},'online':!![]}});}async function handleInvoiceCreate(){const _0x5352b0=a309_0x35149a;logger_1['logger'][_0x5352b0(0x22b)](_0x5352b0(0x1c5));const _0x12ecca=await Company_1[_0x5352b0(0x199)]['findAll']({'where':{'status':!![]}});_0x12ecca[_0x5352b0(0x1ab)](async _0x37d089=>{const _0x4a977a=_0x5352b0,{dueDate:_0x42f721}=_0x37d089,_0x181c1c=new Date(_0x42f721)[_0x4a977a(0x1f1)](0x0,0x0,0x0,0x0),_0x251271=new Date(_0x42f721)[_0x4a977a(0x1f1)](0x17,0x3b,0x3b,0x3e7),_0x31d499=(0x0,moment_1[_0x4a977a(0x199)])((0x0,moment_1['default'])())[_0x4a977a(0x212)](_0x4a977a(0x1e3)),_0xb6baef=(0x0,moment_1['default'])(_0x42f721)[_0x4a977a(0x212)]('DD/MM/yyyy'),_0x3d30f6=(0x0,moment_1['default'])(_0xb6baef,_0x4a977a(0x1e3))[_0x4a977a(0x1f9)]((0x0,moment_1[_0x4a977a(0x199)])(_0x31d499,_0x4a977a(0x1e3))),_0x5b4f5c=moment_1[_0x4a977a(0x199)][_0x4a977a(0x20d)](_0x3d30f6)[_0x4a977a(0x223)]();if(_0x5b4f5c<0x14){const _0x5467ac=await Plan_1[_0x4a977a(0x199)]['findByPk'](_0x37d089[_0x4a977a(0x1e0)]);let _0x38ed48=await Invoices_1['default']['count']({'where':{'companyId':_0x37d089['id'],'dueDate':{[sequelize_1['Op'][_0x4a977a(0x209)]]:(0x0,moment_1[_0x4a977a(0x199)])(_0x42f721)[_0x4a977a(0x212)]('YYYY-MM-DD')}}});if(+_0x38ed48===0x0){const _0x152527=(0x0,moment_1[_0x4a977a(0x199)])()[_0x4a977a(0x212)]();await Invoices_1[_0x4a977a(0x199)][_0x4a977a(0x202)]({'detail':_0x5467ac['name'],'status':'open','value':_0x5467ac['value'],'updatedAt':_0x152527,'createdAt':_0x152527,'dueDate':(0x0,moment_1[_0x4a977a(0x199)])(_0x42f721)[_0x4a977a(0x212)](_0x4a977a(0x1db)),'companyId':_0x37d089['id']});}}});}async function startQueueProcess(){const _0x3c753b=a309_0x35149a;logger_1[_0x3c753b(0x21e)]['info'](_0x3c753b(0x1d3)),await exports[_0x3c753b(0x1a9)]['add']('VerifyLoginStatus',{},{'repeat':{'every':0xea60*0x5,'key':_0x3c753b(0x1ea)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x4ce8d9=new bullmq_1[(_0x3c753b(0x1cb))](exports[_0x3c753b(0x1a9)][_0x3c753b(0x22d)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x4ce8d9['on'](_0x3c753b(0x1da),async _0x29cd13=>{const _0x2e0583=_0x3c753b;logger_1[_0x2e0583(0x21e)][_0x2e0583(0x22b)](_0x2e0583(0x19b)+_0x29cd13['name']+_0x2e0583(0x19f));}),await exports[_0x3c753b(0x1f3)][_0x3c753b(0x210)](_0x3c753b(0x226),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x3c753b(0x226)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x3c753b(0x1f3)]['add'](_0x3c753b(0x1ed),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x3c753b(0x1ed)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x54b23b=new bullmq_1[(_0x3c753b(0x1cb))](exports[_0x3c753b(0x1f3)][_0x3c753b(0x22d)],async _0x468d48=>{const _0xf4a839=_0x3c753b;if(_0x468d48[_0xf4a839(0x22d)]==_0xf4a839(0x226))await handleCloseTicketsAutomatic();else _0x468d48[_0xf4a839(0x22d)]==_0xf4a839(0x1ed)&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}});await exports[_0x3c753b(0x1b4)][_0x3c753b(0x210)](_0x3c753b(0x230),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x3c753b(0x230)},'removeOnComplete':!![],'removeOnFail':!![]}),new campaingJob_1[(_0x3c753b(0x199))](exports[_0x3c753b(0x1b4)][_0x3c753b(0x22d)],connection);const _0x5dcd40=new bullmq_1[(_0x3c753b(0x1cb))](exports['messageQueue'][_0x3c753b(0x22d)],async _0x39cf7f=>{const _0x4f4bf5=_0x3c753b;if(_0x39cf7f['name']==_0x4f4bf5(0x1e5))await handleMessageJob(_0x39cf7f);else{if(_0x39cf7f['name']==_0x4f4bf5(0x19e))await messageUpdateJob(_0x39cf7f);else _0x39cf7f['name']==_0x4f4bf5(0x1af)&&await handleSendMessage(_0x39cf7f);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x5dcd40['on']('completed',async _0x177923=>{const _0x2bfdc5=_0x3c753b;logger_1[_0x2bfdc5(0x21e)][_0x2bfdc5(0x22b)](_0x2bfdc5(0x19b)+_0x177923[_0x2bfdc5(0x22d)]+_0x2bfdc5(0x19f));}),_0x5dcd40['on']('failed',async(_0x3e86af,_0x37e428)=>{const _0x2c6ddf=_0x3c753b;logger_1[_0x2c6ddf(0x21e)][_0x2c6ddf(0x1f6)](_0x2c6ddf(0x19b)+_0x3e86af[_0x2c6ddf(0x22d)]+'\x20failed\x20with\x20error:\x20'+_0x37e428['message']);}),await exports[_0x3c753b(0x1cf)][_0x3c753b(0x210)](_0x3c753b(0x1e7),{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':_0x3c753b(0x1e7)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x5e5ae0=new bullmq_1[(_0x3c753b(0x1cb))](exports[_0x3c753b(0x1cf)]['name'],async _0x2e0a40=>{const _0x59476a=_0x3c753b;_0x2e0a40[_0x59476a(0x22d)]==_0x59476a(0x1e7)&&await handleVerifyQueue(_0x2e0a40);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x5e5ae0['on'](_0x3c753b(0x1da),async _0x1d6d15=>{const _0x263f81=_0x3c753b;logger_1[_0x263f81(0x21e)][_0x263f81(0x22b)](_0x263f81(0x19b)+_0x1d6d15['id']+_0x263f81(0x19f));});let _0x34f54a=new scheduledMessageJob_1['default'](exports['scheduleMonitor'],connection);await _0x34f54a[_0x3c753b(0x229)]()[_0x3c753b(0x210)]('VerifySchedules',{},{'repeat':{'every':0xea60*0x5,'key':_0x3c753b(0x1b9)},'removeOnComplete':!![],'removeOnFail':!![]});}exports['startQueueProcess']=startQueueProcess;