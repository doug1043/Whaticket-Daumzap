const a310_0x30e064=a310_0x20dd;(function(_0x3a420a,_0x24809b){const _0x5dde30=a310_0x20dd,_0x37a886=_0x3a420a();while(!![]){try{const _0x174242=-parseInt(_0x5dde30(0x112))/0x1*(parseInt(_0x5dde30(0x15d))/0x2)+-parseInt(_0x5dde30(0x156))/0x3+-parseInt(_0x5dde30(0x11b))/0x4+parseInt(_0x5dde30(0x154))/0x5+parseInt(_0x5dde30(0x15a))/0x6+-parseInt(_0x5dde30(0x104))/0x7*(parseInt(_0x5dde30(0x14f))/0x8)+parseInt(_0x5dde30(0x125))/0x9*(parseInt(_0x5dde30(0x13e))/0xa);if(_0x174242===_0x24809b)break;else _0x37a886['push'](_0x37a886['shift']());}catch(_0xd89579){_0x37a886['push'](_0x37a886['shift']());}}}(a310_0x2806,0x7e6bd));const a310_0x1d2183=(function(){let _0x7567a3=!![];return function(_0x24d76d,_0x4c20cd){const _0x5a9f1a=_0x7567a3?function(){const _0x3ab801=a310_0x20dd;if(_0x4c20cd){const _0x599e37=_0x4c20cd[_0x3ab801(0x117)](_0x24d76d,arguments);return _0x4c20cd=null,_0x599e37;}}:function(){};return _0x7567a3=![],_0x5a9f1a;};}()),a310_0x325f76=a310_0x1d2183(this,function(){const _0xf30742=a310_0x20dd;return a310_0x325f76[_0xf30742(0x140)]()[_0xf30742(0x116)](_0xf30742(0x19a))[_0xf30742(0x140)]()['constructor'](a310_0x325f76)[_0xf30742(0x116)](_0xf30742(0x19a));});a310_0x325f76();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a310_0x30e064(0x183)]?function(_0x5ad1f8,_0x28e62b,_0x4c06c8,_0x224925){const _0x4305ab=a310_0x30e064;if(_0x224925===undefined)_0x224925=_0x4c06c8;var _0x197703=Object[_0x4305ab(0x18d)](_0x28e62b,_0x4c06c8);(!_0x197703||('get'in _0x197703?!_0x28e62b['__esModule']:_0x197703[_0x4305ab(0x13f)]||_0x197703[_0x4305ab(0x133)]))&&(_0x197703={'enumerable':!![],'get':function(){return _0x28e62b[_0x4c06c8];}}),Object[_0x4305ab(0x14e)](_0x5ad1f8,_0x224925,_0x197703);}:function(_0x1f6495,_0x562f86,_0x2eb0ed,_0xa60601){if(_0xa60601===undefined)_0xa60601=_0x2eb0ed;_0x1f6495[_0xa60601]=_0x562f86[_0x2eb0ed];}),__setModuleDefault=this&&this[a310_0x30e064(0x130)]||(Object['create']?function(_0x42f6c8,_0x4e7ac5){const _0x1d2c59=a310_0x30e064;Object[_0x1d2c59(0x14e)](_0x42f6c8,_0x1d2c59(0x16d),{'enumerable':!![],'value':_0x4e7ac5});}:function(_0x24fbb0,_0x2d1713){_0x24fbb0['default']=_0x2d1713;}),__importStar=this&&this[a310_0x30e064(0x172)]||function(_0x199a54){const _0x14aa55=a310_0x30e064;if(_0x199a54&&_0x199a54[_0x14aa55(0x131)])return _0x199a54;var _0xc497f7={};if(_0x199a54!=null){for(var _0x47b83d in _0x199a54)if(_0x47b83d!==_0x14aa55(0x16d)&&Object[_0x14aa55(0x110)]['hasOwnProperty']['call'](_0x199a54,_0x47b83d))__createBinding(_0xc497f7,_0x199a54,_0x47b83d);}return __setModuleDefault(_0xc497f7,_0x199a54),_0xc497f7;},__importDefault=this&&this['__importDefault']||function(_0x4f1cb5){const _0x2b4bc3=a310_0x30e064;return _0x4f1cb5&&_0x4f1cb5[_0x2b4bc3(0x131)]?_0x4f1cb5:{'default':_0x4f1cb5};};Object[a310_0x30e064(0x14e)](exports,a310_0x30e064(0x131),{'value':!![]}),exports['startQueueProcess']=exports[a310_0x30e064(0x188)]=exports[a310_0x30e064(0x19b)]=exports[a310_0x30e064(0x18a)]=exports[a310_0x30e064(0x147)]=exports['scheduleMonitor']=exports[a310_0x30e064(0x176)]=exports['messageQueue']=exports['generalMonitor']=exports[a310_0x30e064(0x18b)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),bullmq_1=require('bullmq'),SendMessage_1=require(a310_0x30e064(0x124)),Whatsapp_1=__importDefault(require(a310_0x30e064(0x13c))),logger_1=require(a310_0x30e064(0x182)),moment_1=__importDefault(require(a310_0x30e064(0x137))),Contact_1=__importDefault(require('./models/Contact')),sequelize_1=require(a310_0x30e064(0x14a)),socket_1=require(a310_0x30e064(0x11e)),User_1=__importDefault(require(a310_0x30e064(0x167))),Company_1=__importDefault(require(a310_0x30e064(0x17a))),Plan_1=__importDefault(require(a310_0x30e064(0x120))),Ticket_1=__importDefault(require(a310_0x30e064(0x16c))),wbotClosedTickets_1=require(a310_0x30e064(0x17b)),Invoices_1=__importDefault(require(a310_0x30e064(0x107))),wbotMessageListener_1=require(a310_0x30e064(0x10e)),wbot_1=require(a310_0x30e064(0x102)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a310_0x30e064(0x155))),ioredis_1=__importDefault(require(a310_0x30e064(0x151))),campaingJob_1=__importDefault(require(a310_0x30e064(0x178))),scheduledMessageJob_1=__importDefault(require(a310_0x30e064(0x109))),connection={'port':parseInt(process['env'][a310_0x30e064(0x11c)]),'host':process[a310_0x30e064(0x166)]['REDIS_HOST']||'127.0.0.1','password':process[a310_0x30e064(0x166)][a310_0x30e064(0x127)]},limiterMax=process[a310_0x30e064(0x166)][a310_0x30e064(0x193)]||0x1,limiterDuration=process[a310_0x30e064(0x166)][a310_0x30e064(0x192)]||0xbb8,redis=new ioredis_1[(a310_0x30e064(0x16d))](process[a310_0x30e064(0x166)][a310_0x30e064(0x15b)]);exports[a310_0x30e064(0x18b)]=new bullmq_1[(a310_0x30e064(0x153))](a310_0x30e064(0x18f),{'connection':connection}),exports[a310_0x30e064(0x10a)]=new bullmq_1[(a310_0x30e064(0x153))](a310_0x30e064(0x196),{'connection':connection}),exports[a310_0x30e064(0x149)]=new bullmq_1['Queue'](a310_0x30e064(0x180),{'connection':connection}),exports[a310_0x30e064(0x176)]=new bullmq_1[(a310_0x30e064(0x153))](a310_0x30e064(0x181),{'connection':connection}),exports[a310_0x30e064(0x126)]=new bullmq_1[(a310_0x30e064(0x153))]('ScheduleMonitor',{'connection':connection}),exports[a310_0x30e064(0x147)]=new bullmq_1[(a310_0x30e064(0x153))](a310_0x30e064(0x184),{'connection':connection});async function handleVerifyQueueOld(_0x11422a){const _0x18396a=a310_0x30e064;logger_1[_0x18396a(0x18c)][_0x18396a(0x179)](_0x18396a(0x10f));try{const _0x864a97=await Company_1[_0x18396a(0x16d)]['findAll']({'attributes':['id',_0x18396a(0x10b)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x18396a(0x17c)][_0x18396a(0x146)](_0x18396a(0x11d))}},'include':[{'model':Whatsapp_1['default'],'attributes':['id',_0x18396a(0x10b),_0x18396a(0x13b),_0x18396a(0x15c),_0x18396a(0x12e)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x864a97['map'](async _0xe49dd1=>{const _0xa72f52=_0x18396a;_0xe49dd1['whatsapps'][_0xa72f52(0x195)](async _0x54de1d=>{const _0x29faa7=_0xa72f52;if(_0x54de1d['status']===_0x29faa7(0x113)){var _0x5472b3=_0xe49dd1['id'];const _0x391feb=_0x54de1d[_0x29faa7(0x15c)]?_0x54de1d[_0x29faa7(0x15c)]:0x0,_0x2a85a9=_0x54de1d[_0x29faa7(0x12e)],_0x4a7d6e=_0x391feb,_0xa2231b=_0x2a85a9,_0x32576d=_0x4a7d6e;if(_0x391feb>0x0){if(!isNaN(_0xa2231b)&&Number[_0x29faa7(0x17e)](_0xa2231b)&&!isNaN(_0x32576d)&&Number[_0x29faa7(0x17e)](_0x32576d)){const _0x2632e8=(0x0,moment_1[_0x29faa7(0x16d)])()[_0x29faa7(0x169)](_0x32576d,_0x29faa7(0x134))['utc']()['format'](),{count:_0x2e0e7b,rows:_0x32ecc3}=await Ticket_1[_0x29faa7(0x16d)][_0x29faa7(0x171)]({'where':{'status':_0x29faa7(0x142),'queueId':null,'companyId':_0x5472b3,'whatsappId':_0x54de1d['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x2632e8}},'include':[{'model':Contact_1[_0x29faa7(0x16d)],'as':_0x29faa7(0x139),'attributes':['id',_0x29faa7(0x10b),_0x29faa7(0x12b),_0x29faa7(0x194),_0x29faa7(0x152)],'include':['extraInfo']}]});_0x2e0e7b>0x0?_0x32ecc3['map'](async _0x2fc292=>{const _0x4a286c=_0x29faa7;await _0x2fc292[_0x4a286c(0x159)]({'queueId':_0xa2231b}),await _0x2fc292[_0x4a286c(0x12a)]();const _0x2e72e2=(0x0,socket_1[_0x4a286c(0x15e)])();_0x2e72e2['to'](_0x4a286c(0x11a)+_0x2fc292[_0x4a286c(0x164)]+'-'+_0x2fc292[_0x4a286c(0x13b)])['to'](_0x4a286c(0x11a)+_0x2fc292[_0x4a286c(0x164)]+_0x4a286c(0x13d))['to'](_0x2fc292['id'][_0x4a286c(0x140)]())[_0x4a286c(0x115)](_0x4a286c(0x11a)+_0x5472b3+'-ticket',{'action':_0x4a286c(0x159),'ticket':_0x2fc292,'ticketId':_0x2fc292['id']}),logger_1[_0x4a286c(0x18c)]['info']('Atendimento\x20Perdido:\x20'+_0x2fc292['id']+'\x20-\x20Empresa:\x20'+_0x5472b3);}):logger_1['logger'][_0x29faa7(0x179)]('Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20'+_0x5472b3);}else logger_1[_0x29faa7(0x18c)]['info'](_0x29faa7(0x162)+_0x5472b3);}}});});}catch(_0xdaa2bf){Sentry[_0x18396a(0x11f)](_0xdaa2bf),logger_1['logger'][_0x18396a(0x141)](_0x18396a(0x114)+_0xdaa2bf);throw _0xdaa2bf;}}async function handleVerifyQueue(_0x7ef585){const _0x4be2a6=a310_0x30e064;logger_1[_0x4be2a6(0x18c)][_0x4be2a6(0x179)](_0x4be2a6(0x10f));try{const _0xbd5071=await Company_1[_0x4be2a6(0x16d)][_0x4be2a6(0x16f)]({'attributes':['id',_0x4be2a6(0x10b)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x4be2a6(0x17c)][_0x4be2a6(0x146)](_0x4be2a6(0x11d))}},'include':[{'model':Whatsapp_1[_0x4be2a6(0x16d)],'attributes':['id',_0x4be2a6(0x10b),_0x4be2a6(0x13b),_0x4be2a6(0x15c),_0x4be2a6(0x12e)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0xbd5071[_0x4be2a6(0x195)](async _0x1576bc=>{const _0x1e08ec=_0x4be2a6;_0x1576bc[_0x1e08ec(0x106)]['map'](async _0x1f62cd=>{const _0x35ed30=_0x1e08ec;if(_0x1f62cd[_0x35ed30(0x13b)]==='CONNECTED'){const _0x4db0a7=_0x1576bc['id'],_0x1f6e9a=_0x1f62cd[_0x35ed30(0x15c)]?_0x1f62cd[_0x35ed30(0x15c)]:0x0,_0x1dc175=_0x1f62cd[_0x35ed30(0x12e)],_0x4c0301=_0x1f6e9a,_0x5dff6b=_0x1dc175,_0x54e09b=_0x4c0301;if(_0x1f6e9a>0x0&&!isNaN(_0x5dff6b)&&Number[_0x35ed30(0x17e)](_0x5dff6b)&&!isNaN(_0x54e09b)&&Number[_0x35ed30(0x17e)](_0x54e09b)){const _0x4defa1=(0x0,moment_1[_0x35ed30(0x16d)])()['subtract'](_0x54e09b,_0x35ed30(0x134))['utc']()[_0x35ed30(0x16e)](),{count:_0x5e08a8,rows:_0x4ca420}=await Ticket_1[_0x35ed30(0x16d)]['findAndCountAll']({'where':{'status':_0x35ed30(0x142),'queueId':null,'companyId':_0x4db0a7,'whatsappId':_0x1f62cd['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x4defa1}},'include':[{'model':Contact_1[_0x35ed30(0x16d)],'as':_0x35ed30(0x139),'attributes':['id',_0x35ed30(0x10b),_0x35ed30(0x12b),_0x35ed30(0x194),_0x35ed30(0x152)],'include':[_0x35ed30(0x145)]}]});_0x5e08a8>0x0?_0x4ca420['map'](async _0xd703fd=>{const _0x22e3b9=_0x35ed30;await _0xd703fd['update']({'queueId':_0x5dff6b}),await _0xd703fd[_0x22e3b9(0x12a)]();const _0x442ee1=(0x0,socket_1[_0x22e3b9(0x15e)])();_0x442ee1['to']('company-'+_0xd703fd[_0x22e3b9(0x164)]+'-'+_0xd703fd['status'])['to']('company-'+_0xd703fd['companyId']+'-notification')['to'](_0xd703fd['id'][_0x22e3b9(0x140)]())[_0x22e3b9(0x115)]('company-'+_0x4db0a7+'-ticket',{'action':_0x22e3b9(0x159),'ticket':_0xd703fd,'ticketId':_0xd703fd['id']}),logger_1[_0x22e3b9(0x18c)]['info'](_0x22e3b9(0x18e)+_0xd703fd['id']+_0x22e3b9(0x177)+_0x4db0a7);}):logger_1[_0x35ed30(0x18c)][_0x35ed30(0x179)](_0x35ed30(0x12d)+_0x4db0a7);}else logger_1[_0x35ed30(0x18c)][_0x35ed30(0x179)](_0x35ed30(0x162)+_0x4db0a7);}});});}catch(_0x1963bf){console[_0x4be2a6(0x141)](_0x1963bf);}}async function handleCloseTicketsAutomatic(){const _0x332035=a310_0x30e064,_0x3208de=await Company_1['default']['findAll']({'where':{'status':!![]}});_0x3208de[_0x332035(0x195)](async _0x344fff=>{const _0x402a43=_0x332035;try{const _0x3ae942=_0x344fff['id'];await(0x0,wbotClosedTickets_1['ClosedAllOpenTickets'])(_0x3ae942);}catch(_0x2b3920){Sentry[_0x402a43(0x11f)](_0x2b3920),logger_1['logger'][_0x402a43(0x141)](_0x402a43(0x150),_0x2b3920[_0x402a43(0x173)]);throw _0x2b3920;}});}async function messageUpdateJob(_0x15aa7c){const _0x36d540=a310_0x30e064,{data:_0x1c91ac}=_0x15aa7c;var _0x17536b=_0x1c91ac[_0x36d540(0x164)],_0x2b9e69=_0x1c91ac['messageUpdate'],_0x1bf227=_0x1c91ac[_0x36d540(0x135)];const _0x592287=(0x0,wbot_1[_0x36d540(0x158)])(_0x1c91ac[_0x36d540(0x135)]);for(const _0x4e0cf2 of _0x2b9e69){await _0x592287[_0x36d540(0x160)]([_0x4e0cf2[_0x36d540(0x128)]]);const _0x1e5135={..._0x2b9e69};_0x1e5135['0']?.[_0x36d540(0x159)][_0x36d540(0x157)]===0x1&&_0x1e5135['0']?.[_0x36d540(0x128)][_0x36d540(0x14d)]!=='status@broadcast'&&await(0x0,MarkDeleteWhatsAppMessage_1[_0x36d540(0x16d)])(_0x1e5135['0']?.[_0x36d540(0x128)][_0x36d540(0x14d)],null,_0x1e5135['0']?.[_0x36d540(0x128)]['id'],_0x17536b),await(0x0,wbotMessageListener_1[_0x36d540(0x105)])(_0x4e0cf2,_0x4e0cf2[_0x36d540(0x159)][_0x36d540(0x13b)]);}}async function handleMessageJob(_0x5f23e4){const _0x29458f=a310_0x30e064,{data:_0x5cd039}=_0x5f23e4;var _0x31f09d=_0x5cd039[_0x29458f(0x187)],_0x3e8fb0=_0x5cd039[_0x29458f(0x164)];const _0x1436ea=(0x0,wbot_1['getWbot'])(_0x5cd039['whatsappId']);for(const _0x5cef97 of _0x31f09d){await(0x0,wbotMessageListener_1['handleMessage'])(_0x5cef97,_0x1436ea,_0x3e8fb0),await(0x0,wbotMessageListener_1[_0x29458f(0x13a)])(_0x5cef97,_0x3e8fb0),await(0x0,wbotMessageListener_1[_0x29458f(0x132)])(_0x5cef97,_0x3e8fb0),_0x5cef97[_0x29458f(0x128)][_0x29458f(0x14d)]?.[_0x29458f(0x14c)]('@g.us')&&await(0x0,wbotMessageListener_1['handleMsgAck'])(_0x5cef97,0x2);}}async function handleSendMessage(_0x450d56){const _0x19ade6=a310_0x30e064;console[_0x19ade6(0x148)](_0x19ade6(0x163));try{const {data:_0x457454}=_0x450d56,_0x1c34da=await Whatsapp_1['default']['findByPk'](_0x457454['whatsappId']);if(_0x1c34da==null)throw new sequelize_1[(_0x19ade6(0x16a))]('Whatsapp\x20não\x20identificado');const _0x4c6c75=_0x457454[_0x19ade6(0x185)];await(0x0,SendMessage_1[_0x19ade6(0x175)])(_0x1c34da,_0x4c6c75);}catch(_0x4b0f37){Sentry[_0x19ade6(0x11f)](_0x4b0f37),logger_1[_0x19ade6(0x18c)][_0x19ade6(0x141)](_0x19ade6(0x121),_0x4b0f37[_0x19ade6(0x173)]);throw _0x4b0f37;}}function parseToMilliseconds(_0x5c11d2){return _0x5c11d2*0x3e8;}function a310_0x2806(){const _0x3c7b18=['686856iZLTzO','messageStubType','getWbot','update','5399640OafREG','REDIS_URI','timeSendQueue','22iybeEp','getIO','Worker','readMessages','Job\x20','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','HANDLE\x20SEND\x20MESSAGE','companyId','\x20segundos\x20finalizado:\x20','env','./models/User','MessageUpdateJob','subtract','Error','diff','./models/Ticket','default','format','findAll','InvoiceCreate','findAndCountAll','__importStar','message','\x20failed\x20with\x20error:\x20','SendMessage','queueMonitor','\x20-\x20Empresa:\x20','./workers/campaingJob','info','./models/Company','./services/WbotServices/wbotClosedTickets','Sequelize','completed','isInteger','handle\x20login','MessageQueue','QueueMonitor','./utils/logger','create','CampaignQueue','data','HandleMessageJob','messages','randomValue','getQueue','parseToMilliseconds','userMonitor','logger','getOwnPropertyDescriptor','Atendimento\x20Perdido:\x20','UserMonitor','getCampaignQueue','floor','REDIS_OPT_LIMITER_DURATION','REDIS_OPT_LIMITER_MAX','email','map','GeneralMonitor','Iniciando\x20processamento\x20de\x20filas','VerifyCampaigns','open','(((.+)+)+)+$','sleep','./libs/wbot','duration','25627GmLEYL','handleMsgAck','whatsapps','./models/Invoices','DD/MM/yyyy','./workers/scheduledMessageJob','generalMonitor','name','setMinutes','VerifyLoginStatus','./services/WbotServices/wbotMessageListener','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','prototype','planId','49559bBphgH','CONNECTED','SearchForQueue\x20->\x20VerifyQueue:\x20error','emit','search','apply','failed','YYYY-MM-DD','company-','3313584xoRwMC','REDIS_PORT','CURRENT_DATE','./libs/socket','captureException','./models/Plan','MessageQueue\x20->\x20SendMessage:\x20error','CloseTicketsAutomatic','add','./helpers/SendMessage','439191oQygNt','scheduleMonitor','REDIS_PASSWORD','key','like','reload','number','verify','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','sendIdQueue','count','__setModuleDefault','__esModule','verifyCampaignMessageAndCloseTicket','configurable','minutes','whatsappId','setHours','moment','startQueueProcess','contact','verifyRecentCampaign','status','./models/Whatsapp','-notification','350WAoYBk','writable','toString','error','pending','\x20completed','HH:mm:ss','extraInfo','literal','campaignQueue','log','messageQueue','sequelize','Sleep\x20de\x20','endsWith','remoteJid','defineProperty','1656akBSDA','ClosedAllOpenTickets\x20->\x20Verify:\x20error','ioredis','profilePicUrl','Queue','1351200ZVXsiQ','./services/WbotServices/MarkDeleteWhatsAppMessage'];a310_0x2806=function(){return _0x3c7b18;};return a310_0x2806();}exports[a310_0x30e064(0x18a)]=parseToMilliseconds;async function sleep(_0x3a9260){const _0x1681b7=a310_0x30e064;return logger_1[_0x1681b7(0x18c)][_0x1681b7(0x179)](_0x1681b7(0x14b)+_0x3a9260+'\x20segundos\x20iniciado:\x20'+(0x0,moment_1[_0x1681b7(0x16d)])()[_0x1681b7(0x16e)](_0x1681b7(0x144))),new Promise(_0x4936da=>{setTimeout(()=>{const _0x219999=a310_0x20dd;logger_1['logger'][_0x219999(0x179)]('Sleep\x20de\x20'+_0x3a9260+_0x219999(0x165)+(0x0,moment_1[_0x219999(0x16d)])()[_0x219999(0x16e)](_0x219999(0x144))),_0x4936da(!![]);},parseToMilliseconds(_0x3a9260));});}exports['sleep']=sleep;function randomValue(_0x42982d,_0x18a641){const _0x2a4940=a310_0x30e064;return Math[_0x2a4940(0x191)](Math['random']()*_0x18a641)+_0x42982d;}exports[a310_0x30e064(0x188)]=randomValue;async function handleLoginStatus(){const _0x5b68ca=a310_0x30e064;console[_0x5b68ca(0x148)](_0x5b68ca(0x17f));const _0x4097e3=new Date();_0x4097e3[_0x5b68ca(0x10c)](_0x4097e3['getMinutes']()-0x5),await User_1[_0x5b68ca(0x16d)][_0x5b68ca(0x159)]({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x4097e3},'online':!![]}});}async function handleInvoiceCreate(){const _0x4d63f4=a310_0x30e064;logger_1['logger'][_0x4d63f4(0x179)]('Iniciando\x20geração\x20de\x20boletos');const _0x2094e2=await Company_1[_0x4d63f4(0x16d)][_0x4d63f4(0x16f)]({'where':{'status':!![]}});_0x2094e2['map'](async _0x24ed81=>{const _0x49a3b5=_0x4d63f4,{dueDate:_0x315fd8}=_0x24ed81,_0x1a6319=new Date(_0x315fd8)[_0x49a3b5(0x136)](0x0,0x0,0x0,0x0),_0x18bef3=new Date(_0x315fd8)[_0x49a3b5(0x136)](0x17,0x3b,0x3b,0x3e7),_0x382fe8=(0x0,moment_1['default'])((0x0,moment_1[_0x49a3b5(0x16d)])())[_0x49a3b5(0x16e)](_0x49a3b5(0x108)),_0x3f06c8=(0x0,moment_1[_0x49a3b5(0x16d)])(_0x315fd8)['format'](_0x49a3b5(0x108)),_0x26fcb2=(0x0,moment_1['default'])(_0x3f06c8,_0x49a3b5(0x108))[_0x49a3b5(0x16b)]((0x0,moment_1[_0x49a3b5(0x16d)])(_0x382fe8,_0x49a3b5(0x108))),_0x1586b5=moment_1[_0x49a3b5(0x16d)][_0x49a3b5(0x103)](_0x26fcb2)['asDays']();if(_0x1586b5<0x14){const _0x4e88f1=await Plan_1[_0x49a3b5(0x16d)]['findByPk'](_0x24ed81[_0x49a3b5(0x111)]);let _0xe5ddc=await Invoices_1[_0x49a3b5(0x16d)][_0x49a3b5(0x12f)]({'where':{'companyId':_0x24ed81['id'],'dueDate':{[sequelize_1['Op'][_0x49a3b5(0x129)]]:(0x0,moment_1[_0x49a3b5(0x16d)])(_0x315fd8)[_0x49a3b5(0x16e)](_0x49a3b5(0x119))}}});if(+_0xe5ddc===0x0){const _0x44ea6d=(0x0,moment_1[_0x49a3b5(0x16d)])()[_0x49a3b5(0x16e)]();await Invoices_1['default'][_0x49a3b5(0x183)]({'detail':_0x4e88f1[_0x49a3b5(0x10b)],'status':_0x49a3b5(0x199),'value':_0x4e88f1['value'],'updatedAt':_0x44ea6d,'createdAt':_0x44ea6d,'dueDate':(0x0,moment_1[_0x49a3b5(0x16d)])(_0x315fd8)['format']('YYYY-MM-DD'),'companyId':_0x24ed81['id']});}}});}function a310_0x20dd(_0x5a8b07,_0x528fcb){const _0x163229=a310_0x2806();return a310_0x20dd=function(_0x325f76,_0x1d2183){_0x325f76=_0x325f76-0x102;let _0x2806a5=_0x163229[_0x325f76];return _0x2806a5;},a310_0x20dd(_0x5a8b07,_0x528fcb);}async function startQueueProcess(){const _0x13eae1=a310_0x30e064;logger_1[_0x13eae1(0x18c)][_0x13eae1(0x179)](_0x13eae1(0x197)),await exports[_0x13eae1(0x18b)][_0x13eae1(0x123)](_0x13eae1(0x10d),{},{'repeat':{'every':0xea60*0x5,'key':_0x13eae1(0x10d)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x42b473=new bullmq_1['Worker'](exports[_0x13eae1(0x18b)][_0x13eae1(0x10b)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x42b473['on'](_0x13eae1(0x17d),async _0x3f8c9c=>{const _0x3e0677=_0x13eae1;logger_1[_0x3e0677(0x18c)][_0x3e0677(0x179)](_0x3e0677(0x161)+_0x3f8c9c['name']+_0x3e0677(0x143));}),await exports[_0x13eae1(0x10a)]['add'](_0x13eae1(0x122),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x13eae1(0x122)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x13eae1(0x10a)]['add'](_0x13eae1(0x170),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x13eae1(0x170)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x35ebd1=new bullmq_1[(_0x13eae1(0x15f))](exports[_0x13eae1(0x10a)][_0x13eae1(0x10b)],async _0x245f2c=>{const _0x153bfc=_0x13eae1;if(_0x245f2c[_0x153bfc(0x10b)]=='CloseTicketsAutomatic')await handleCloseTicketsAutomatic();else _0x245f2c['name']==_0x153bfc(0x170)&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}}),_0x411fe3=new campaingJob_1[(_0x13eae1(0x16d))](),_0x413216=_0x411fe3[_0x13eae1(0x190)]();await _0x413216['add'](_0x13eae1(0x198),{},{'repeat':{'every':0x3c*0x3e8*0x1,'key':'VerifyCampaigns'},'removeOnComplete':!![],'removeOnFail':!![]});const _0x33ffd3=new bullmq_1['Worker'](exports[_0x13eae1(0x149)][_0x13eae1(0x10b)],async _0x381daf=>{const _0x476f11=_0x13eae1;if(_0x381daf[_0x476f11(0x10b)]==_0x476f11(0x186))await handleMessageJob(_0x381daf);else{if(_0x381daf[_0x476f11(0x10b)]==_0x476f11(0x168))await messageUpdateJob(_0x381daf);else _0x381daf[_0x476f11(0x10b)]==_0x476f11(0x175)&&await handleSendMessage(_0x381daf);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x33ffd3['on'](_0x13eae1(0x17d),async _0x562aa0=>{const _0x728b88=_0x13eae1;logger_1[_0x728b88(0x18c)]['info'](_0x728b88(0x161)+_0x562aa0[_0x728b88(0x10b)]+_0x728b88(0x143));}),_0x33ffd3['on'](_0x13eae1(0x118),async(_0x318fe5,_0xe3dccc)=>{const _0x30b44f=_0x13eae1;logger_1[_0x30b44f(0x18c)][_0x30b44f(0x141)]('Job\x20'+_0x318fe5[_0x30b44f(0x10b)]+_0x30b44f(0x174)+_0xe3dccc[_0x30b44f(0x173)]);}),await exports['queueMonitor'][_0x13eae1(0x123)]('VerifyQueueStatus',{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':'VerifyQueueStatus'},'removeOnComplete':!![],'removeOnFail':!![]});const _0x3d76d4=new bullmq_1[(_0x13eae1(0x15f))](exports['queueMonitor'][_0x13eae1(0x10b)],async _0x53ed5c=>{const _0x47246f=_0x13eae1;_0x53ed5c[_0x47246f(0x10b)]=='VerifyQueueStatus'&&await handleVerifyQueue(_0x53ed5c);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x3d76d4['on'](_0x13eae1(0x17d),async _0x342c0b=>{const _0x584b5e=_0x13eae1;logger_1[_0x584b5e(0x18c)]['info']('Job\x20'+_0x342c0b['id']+_0x584b5e(0x143));});let _0x32546e=new scheduledMessageJob_1[(_0x13eae1(0x16d))](exports[_0x13eae1(0x126)],connection);await _0x32546e[_0x13eae1(0x189)]()[_0x13eae1(0x123)]('VerifySchedules',{},{'repeat':{'every':0xea60*0x5,'key':_0x13eae1(0x12c)},'removeOnComplete':!![],'removeOnFail':!![]});}exports[a310_0x30e064(0x138)]=startQueueProcess;