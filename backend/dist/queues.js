const a310_0x44385a=a310_0x3acc;(function(_0x559337,_0x4e1f0f){const _0x29fc8f=a310_0x3acc,_0x25b22f=_0x559337();while(!![]){try{const _0x42159b=-parseInt(_0x29fc8f(0x11c))/0x1+-parseInt(_0x29fc8f(0xc3))/0x2*(parseInt(_0x29fc8f(0xcb))/0x3)+-parseInt(_0x29fc8f(0xd5))/0x4+parseInt(_0x29fc8f(0xcd))/0x5+parseInt(_0x29fc8f(0x10c))/0x6*(-parseInt(_0x29fc8f(0x98))/0x7)+parseInt(_0x29fc8f(0xc6))/0x8+-parseInt(_0x29fc8f(0xb4))/0x9*(-parseInt(_0x29fc8f(0x118))/0xa);if(_0x42159b===_0x4e1f0f)break;else _0x25b22f['push'](_0x25b22f['shift']());}catch(_0x5a907a){_0x25b22f['push'](_0x25b22f['shift']());}}}(a310_0x3e12,0x537fc));const a310_0x2077c1=(function(){let _0x33ca25=!![];return function(_0x488b76,_0x60377a){const _0x5713c1=_0x33ca25?function(){const _0x54fea4=a310_0x3acc;if(_0x60377a){const _0xd51f8=_0x60377a[_0x54fea4(0xf6)](_0x488b76,arguments);return _0x60377a=null,_0xd51f8;}}:function(){};return _0x33ca25=![],_0x5713c1;};}()),a310_0x2180a1=a310_0x2077c1(this,function(){const _0x501e34=a310_0x3acc;return a310_0x2180a1['toString']()[_0x501e34(0xbd)](_0x501e34(0xfd))[_0x501e34(0xe1)]()['constructor'](a310_0x2180a1)[_0x501e34(0xbd)](_0x501e34(0xfd));});a310_0x2180a1();'use strict';var __createBinding=this&&this[a310_0x44385a(0x11d)]||(Object[a310_0x44385a(0xed)]?function(_0x559cd3,_0x41e18d,_0x18aedb,_0x3012a8){const _0x5ea798=a310_0x44385a;if(_0x3012a8===undefined)_0x3012a8=_0x18aedb;var _0x2470b7=Object['getOwnPropertyDescriptor'](_0x41e18d,_0x18aedb);(!_0x2470b7||('get'in _0x2470b7?!_0x41e18d[_0x5ea798(0x124)]:_0x2470b7[_0x5ea798(0x11f)]||_0x2470b7[_0x5ea798(0xaa)]))&&(_0x2470b7={'enumerable':!![],'get':function(){return _0x41e18d[_0x18aedb];}}),Object[_0x5ea798(0x112)](_0x559cd3,_0x3012a8,_0x2470b7);}:function(_0x1efb04,_0x43395e,_0x5781df,_0x26255b){if(_0x26255b===undefined)_0x26255b=_0x5781df;_0x1efb04[_0x26255b]=_0x43395e[_0x5781df];}),__setModuleDefault=this&&this[a310_0x44385a(0xcf)]||(Object[a310_0x44385a(0xed)]?function(_0x195505,_0x35f296){const _0x464c9b=a310_0x44385a;Object[_0x464c9b(0x112)](_0x195505,_0x464c9b(0x10f),{'enumerable':!![],'value':_0x35f296});}:function(_0x2a6de0,_0x370cdd){const _0x477f8f=a310_0x44385a;_0x2a6de0[_0x477f8f(0x10f)]=_0x370cdd;}),__importStar=this&&this[a310_0x44385a(0xfb)]||function(_0x32adfd){const _0x5465c8=a310_0x44385a;if(_0x32adfd&&_0x32adfd[_0x5465c8(0x124)])return _0x32adfd;var _0x52868d={};if(_0x32adfd!=null){for(var _0x4dfdb2 in _0x32adfd)if(_0x4dfdb2!==_0x5465c8(0x10f)&&Object['prototype']['hasOwnProperty'][_0x5465c8(0xa5)](_0x32adfd,_0x4dfdb2))__createBinding(_0x52868d,_0x32adfd,_0x4dfdb2);}return __setModuleDefault(_0x52868d,_0x32adfd),_0x52868d;},__importDefault=this&&this['__importDefault']||function(_0x49562c){const _0x5cefb5=a310_0x44385a;return _0x49562c&&_0x49562c[_0x5cefb5(0x124)]?_0x49562c:{'default':_0x49562c};};Object[a310_0x44385a(0x112)](exports,a310_0x44385a(0x124),{'value':!![]}),exports[a310_0x44385a(0xd3)]=exports['randomValue']=exports[a310_0x44385a(0x110)]=exports['parseToMilliseconds']=exports[a310_0x44385a(0xae)]=exports['scheduleMonitor']=exports[a310_0x44385a(0xc1)]=exports[a310_0x44385a(0xb6)]=exports[a310_0x44385a(0xf7)]=exports['userMonitor']=void 0x0;const Sentry=__importStar(require('@sentry/node')),bullmq_1=require(a310_0x44385a(0xdc)),SendMessage_1=require(a310_0x44385a(0xf4)),Whatsapp_1=__importDefault(require('./models/Whatsapp')),logger_1=require(a310_0x44385a(0xd7)),moment_1=__importDefault(require(a310_0x44385a(0x97))),Contact_1=__importDefault(require(a310_0x44385a(0x93))),sequelize_1=require(a310_0x44385a(0x113)),socket_1=require('./libs/socket'),User_1=__importDefault(require(a310_0x44385a(0xfe))),Company_1=__importDefault(require(a310_0x44385a(0x100))),Plan_1=__importDefault(require(a310_0x44385a(0xc8))),Ticket_1=__importDefault(require(a310_0x44385a(0xd4))),wbotClosedTickets_1=require('./services/WbotServices/wbotClosedTickets'),Invoices_1=__importDefault(require('./models/Invoices')),wbotMessageListener_1=require(a310_0x44385a(0xf2)),wbot_1=require('./libs/wbot'),MarkDeleteWhatsAppMessage_1=__importDefault(require(a310_0x44385a(0xdf))),ioredis_1=__importDefault(require('ioredis')),campaingJob_1=__importDefault(require(a310_0x44385a(0xd2))),scheduledMessageJob_1=__importDefault(require(a310_0x44385a(0x108))),connection={'port':parseInt(process[a310_0x44385a(0x111)][a310_0x44385a(0xbb)]),'host':process[a310_0x44385a(0x111)][a310_0x44385a(0x116)]||a310_0x44385a(0xb2),'password':process[a310_0x44385a(0x111)][a310_0x44385a(0x125)]},limiterMax=process[a310_0x44385a(0x111)][a310_0x44385a(0xc2)]||0x1,limiterDuration=process['env']['REDIS_OPT_LIMITER_DURATION']||0xbb8,redis=new ioredis_1[(a310_0x44385a(0x10f))](process[a310_0x44385a(0x111)][a310_0x44385a(0x10b)]);exports[a310_0x44385a(0x10d)]=new bullmq_1[(a310_0x44385a(0xba))]('UserMonitor',{'connection':connection}),exports[a310_0x44385a(0xf7)]=new bullmq_1[(a310_0x44385a(0xba))](a310_0x44385a(0x11b),{'connection':connection}),exports[a310_0x44385a(0xb6)]=new bullmq_1[(a310_0x44385a(0xba))](a310_0x44385a(0x11e),{'connection':connection}),exports[a310_0x44385a(0xc1)]=new bullmq_1[(a310_0x44385a(0xba))](a310_0x44385a(0xce),{'connection':connection}),exports[a310_0x44385a(0x109)]=new bullmq_1[(a310_0x44385a(0xba))](a310_0x44385a(0xcc),{'connection':connection}),exports[a310_0x44385a(0xae)]=new bullmq_1[(a310_0x44385a(0xba))](a310_0x44385a(0xff),{'connection':connection});async function handleVerifyQueueOld(_0x393f57){const _0x4f6e41=a310_0x44385a;logger_1[_0x4f6e41(0xf9)][_0x4f6e41(0x95)]('Buscando\x20atendimentos\x20perdidos\x20nas\x20filas');try{const _0x4e3b82=await Company_1[_0x4f6e41(0x10f)][_0x4f6e41(0x9a)]({'attributes':['id',_0x4f6e41(0x127)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1['Sequelize'][_0x4f6e41(0xd9)](_0x4f6e41(0x9e))}},'include':[{'model':Whatsapp_1[_0x4f6e41(0x10f)],'attributes':['id',_0x4f6e41(0x127),_0x4f6e41(0x114),_0x4f6e41(0x9b),'sendIdQueue'],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x4e3b82['map'](async _0x24bb9c=>{const _0x48c775=_0x4f6e41;_0x24bb9c[_0x48c775(0xc7)][_0x48c775(0x9d)](async _0x55d741=>{const _0x2bb170=_0x48c775;if(_0x55d741[_0x2bb170(0x114)]==='CONNECTED'){var _0x1624cb=_0x24bb9c['id'];const _0x24c00b=_0x55d741[_0x2bb170(0x9b)]?_0x55d741[_0x2bb170(0x9b)]:0x0,_0x48bd22=_0x55d741[_0x2bb170(0xb3)],_0x5bdbf5=_0x24c00b,_0x50e10c=_0x48bd22,_0x97cf8a=_0x5bdbf5;if(_0x24c00b>0x0){if(!isNaN(_0x50e10c)&&Number[_0x2bb170(0xb9)](_0x50e10c)&&!isNaN(_0x97cf8a)&&Number[_0x2bb170(0xb9)](_0x97cf8a)){const _0x174851=(0x0,moment_1[_0x2bb170(0x10f)])()[_0x2bb170(0x128)](_0x97cf8a,_0x2bb170(0x106))['utc']()[_0x2bb170(0xb1)](),{count:_0x2f3e5f,rows:_0x31f856}=await Ticket_1[_0x2bb170(0x10f)][_0x2bb170(0x126)]({'where':{'status':_0x2bb170(0xd0),'queueId':null,'companyId':_0x1624cb,'whatsappId':_0x55d741['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x174851}},'include':[{'model':Contact_1[_0x2bb170(0x10f)],'as':_0x2bb170(0xe8),'attributes':['id','name',_0x2bb170(0x92),_0x2bb170(0xbf),_0x2bb170(0xa6)],'include':[_0x2bb170(0xb7)]}]});_0x2f3e5f>0x0?_0x31f856[_0x2bb170(0x9d)](async _0x24bb53=>{const _0x1eb002=_0x2bb170;await _0x24bb53[_0x1eb002(0x119)]({'queueId':_0x50e10c}),await _0x24bb53['reload']();const _0x4a487d=(0x0,socket_1['getIO'])();_0x4a487d['to']('company-'+_0x24bb53[_0x1eb002(0x99)]+'-'+_0x24bb53[_0x1eb002(0x114)])['to'](_0x1eb002(0x9f)+_0x24bb53[_0x1eb002(0x99)]+'-notification')['to'](_0x24bb53['id'][_0x1eb002(0xe1)]())[_0x1eb002(0xf3)]('company-'+_0x1624cb+_0x1eb002(0xea),{'action':_0x1eb002(0x119),'ticket':_0x24bb53,'ticketId':_0x24bb53['id']}),logger_1['logger'][_0x1eb002(0x95)](_0x1eb002(0xaf)+_0x24bb53['id']+'\x20-\x20Empresa:\x20'+_0x1624cb);}):logger_1[_0x2bb170(0xf9)][_0x2bb170(0x95)](_0x2bb170(0xee)+_0x1624cb);}else logger_1[_0x2bb170(0xf9)]['info'](_0x2bb170(0xd1)+_0x1624cb);}}});});}catch(_0x35691b){Sentry[_0x4f6e41(0xa9)](_0x35691b),logger_1['logger'][_0x4f6e41(0xe9)]('SearchForQueue\x20->\x20VerifyQueue:\x20error'+_0x35691b);throw _0x35691b;}}async function handleVerifyQueue(_0xb481c0){const _0x37ec7c=a310_0x44385a;logger_1['logger'][_0x37ec7c(0x95)](_0x37ec7c(0xa0));try{const _0x265c59=await Company_1['default'][_0x37ec7c(0x9a)]({'attributes':['id',_0x37ec7c(0x127)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x37ec7c(0xb5)][_0x37ec7c(0xd9)]('CURRENT_DATE')}},'include':[{'model':Whatsapp_1[_0x37ec7c(0x10f)],'attributes':['id',_0x37ec7c(0x127),'status','timeSendQueue',_0x37ec7c(0xb3)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x265c59[_0x37ec7c(0x9d)](async _0x5c8f81=>{const _0x278e84=_0x37ec7c;_0x5c8f81[_0x278e84(0xc7)][_0x278e84(0x9d)](async _0x18d69a=>{const _0x3a993e=_0x278e84;if(_0x18d69a['status']===_0x3a993e(0xad)){const _0x5752b0=_0x5c8f81['id'],_0x150a53=_0x18d69a[_0x3a993e(0x9b)]?_0x18d69a['timeSendQueue']:0x0,_0xe86362=_0x18d69a[_0x3a993e(0xb3)],_0x583e77=_0x150a53,_0x5a1f18=_0xe86362,_0x56f178=_0x583e77;if(_0x150a53>0x0&&!isNaN(_0x5a1f18)&&Number[_0x3a993e(0xb9)](_0x5a1f18)&&!isNaN(_0x56f178)&&Number[_0x3a993e(0xb9)](_0x56f178)){const _0x2c15d2=(0x0,moment_1[_0x3a993e(0x10f)])()[_0x3a993e(0x128)](_0x56f178,_0x3a993e(0x106))[_0x3a993e(0xa7)]()[_0x3a993e(0xb1)](),{count:_0x7d90b0,rows:_0xe0a329}=await Ticket_1['default'][_0x3a993e(0x126)]({'where':{'status':'pending','queueId':null,'companyId':_0x5752b0,'whatsappId':_0x18d69a['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x2c15d2}},'include':[{'model':Contact_1[_0x3a993e(0x10f)],'as':'contact','attributes':['id',_0x3a993e(0x127),_0x3a993e(0x92),'email',_0x3a993e(0xa6)],'include':['extraInfo']}]});_0x7d90b0>0x0?_0xe0a329[_0x3a993e(0x9d)](async _0x595bb8=>{const _0x519a2e=_0x3a993e;await _0x595bb8[_0x519a2e(0x119)]({'queueId':_0x5a1f18}),await _0x595bb8['reload']();const _0x733953=(0x0,socket_1['getIO'])();_0x733953['to'](_0x519a2e(0x9f)+_0x595bb8[_0x519a2e(0x99)]+'-'+_0x595bb8[_0x519a2e(0x114)])['to']('company-'+_0x595bb8[_0x519a2e(0x99)]+'-notification')['to'](_0x595bb8['id'][_0x519a2e(0xe1)]())[_0x519a2e(0xf3)](_0x519a2e(0x9f)+_0x5752b0+_0x519a2e(0xea),{'action':'update','ticket':_0x595bb8,'ticketId':_0x595bb8['id']}),logger_1['logger'][_0x519a2e(0x95)](_0x519a2e(0xaf)+_0x595bb8['id']+_0x519a2e(0x122)+_0x5752b0);}):logger_1[_0x3a993e(0xf9)][_0x3a993e(0x95)](_0x3a993e(0xee)+_0x5752b0);}else logger_1['logger'][_0x3a993e(0x95)]('Condição\x20não\x20respeitada\x20-\x20Empresa:\x20'+_0x5752b0);}});});}catch(_0x45f86a){console[_0x37ec7c(0xe9)](_0x45f86a);}}async function handleCloseTicketsAutomatic(){const _0xafda12=a310_0x44385a,_0x8581d3=await Company_1[_0xafda12(0x10f)][_0xafda12(0x9a)]({'where':{'status':!![]}});_0x8581d3['map'](async _0x3b18ba=>{const _0x1af7c1=_0xafda12;try{const _0x5f28d6=_0x3b18ba['id'];await(0x0,wbotClosedTickets_1[_0x1af7c1(0x10a)])(_0x5f28d6);}catch(_0x460890){Sentry['captureException'](_0x460890),logger_1[_0x1af7c1(0xf9)][_0x1af7c1(0xe9)](_0x1af7c1(0x103),_0x460890[_0x1af7c1(0x102)]);throw _0x460890;}});}async function messageUpdateJob(_0x38dfb0){const _0x297b8a=a310_0x44385a,{data:_0x7ab40d}=_0x38dfb0;var _0x2fc309=_0x7ab40d[_0x297b8a(0x99)],_0x160806=_0x7ab40d[_0x297b8a(0xca)],_0x1419b8=_0x7ab40d['whatsappId'];const _0xb528f2=(0x0,wbot_1[_0x297b8a(0x9c)])(_0x7ab40d['whatsappId']);for(const _0x4208b1 of _0x160806){await _0xb528f2[_0x297b8a(0xfc)]([_0x4208b1['key']]);const _0x426a99={..._0x160806};_0x426a99['0']?.[_0x297b8a(0x119)]['messageStubType']===0x1&&_0x426a99['0']?.['key']['remoteJid']!==_0x297b8a(0x94)&&await(0x0,MarkDeleteWhatsAppMessage_1['default'])(_0x426a99['0']?.[_0x297b8a(0xe3)][_0x297b8a(0xec)],null,_0x426a99['0']?.[_0x297b8a(0xe3)]['id'],_0x2fc309),await(0x0,wbotMessageListener_1['handleMsgAck'])(_0x4208b1,_0x4208b1[_0x297b8a(0x119)][_0x297b8a(0x114)]);}}function a310_0x3acc(_0x50872f,_0x46d2fa){const _0x240efe=a310_0x3e12();return a310_0x3acc=function(_0x2180a1,_0x2077c1){_0x2180a1=_0x2180a1-0x92;let _0x3e128f=_0x240efe[_0x2180a1];return _0x3e128f;},a310_0x3acc(_0x50872f,_0x46d2fa);}async function handleMessageJob(_0x1fee32){const _0x582202=a310_0x44385a,{data:_0x4c5d29}=_0x1fee32;var _0x49230f=_0x4c5d29[_0x582202(0xe5)],_0x97e2c7=_0x4c5d29[_0x582202(0x99)];const _0x408751=(0x0,wbot_1[_0x582202(0x9c)])(_0x4c5d29[_0x582202(0xfa)]);for(const _0x54d744 of _0x49230f){await(0x0,wbotMessageListener_1['handleMessage'])(_0x54d744,_0x408751,_0x97e2c7),await(0x0,wbotMessageListener_1[_0x582202(0xef)])(_0x54d744,_0x97e2c7),await(0x0,wbotMessageListener_1['verifyCampaignMessageAndCloseTicket'])(_0x54d744,_0x97e2c7),_0x54d744[_0x582202(0xe3)][_0x582202(0xec)]?.[_0x582202(0x96)]('@g.us')&&await(0x0,wbotMessageListener_1[_0x582202(0x11a)])(_0x54d744,0x2);}}async function handleSendMessage(_0x128cf7){const _0x292ba7=a310_0x44385a;console[_0x292ba7(0xdd)](_0x292ba7(0xbe));try{const {data:_0x201e04}=_0x128cf7,_0x3f5297=await Whatsapp_1[_0x292ba7(0x10f)][_0x292ba7(0x104)](_0x201e04[_0x292ba7(0xfa)]);if(_0x3f5297==null)throw new sequelize_1['Error'](_0x292ba7(0x107));const _0x12b594=_0x201e04['data'];await(0x0,SendMessage_1[_0x292ba7(0x105)])(_0x3f5297,_0x12b594);}catch(_0x3d77c8){Sentry['captureException'](_0x3d77c8),logger_1['logger'][_0x292ba7(0xe9)](_0x292ba7(0xc5),_0x3d77c8[_0x292ba7(0x102)]);throw _0x3d77c8;}}function parseToMilliseconds(_0x38a9de){return _0x38a9de*0x3e8;}exports[a310_0x44385a(0x121)]=parseToMilliseconds;async function sleep(_0x6b4bcd){const _0x2ca236=a310_0x44385a;return logger_1[_0x2ca236(0xf9)]['info']('Sleep\x20de\x20'+_0x6b4bcd+_0x2ca236(0xb8)+(0x0,moment_1[_0x2ca236(0x10f)])()[_0x2ca236(0xb1)](_0x2ca236(0xe4))),new Promise(_0x27a3e7=>{setTimeout(()=>{const _0x3dd7d1=a310_0x3acc;logger_1[_0x3dd7d1(0xf9)][_0x3dd7d1(0x95)]('Sleep\x20de\x20'+_0x6b4bcd+_0x3dd7d1(0xb0)+(0x0,moment_1[_0x3dd7d1(0x10f)])()[_0x3dd7d1(0xb1)](_0x3dd7d1(0xe4))),_0x27a3e7(!![]);},parseToMilliseconds(_0x6b4bcd));});}function a310_0x3e12(){const _0x45ceb8=['./workers/scheduledMessageJob','scheduleMonitor','ClosedAllOpenTickets','REDIS_URI','6dNBGkS','userMonitor','VerifyCampaigns','default','sleep','env','defineProperty','sequelize','status','InvoiceCreate','REDIS_HOST','failed','11806490byVcaA','update','handleMsgAck','GeneralMonitor','169074xavczH','__createBinding','MessageQueue','writable','verify','parseToMilliseconds','\x20-\x20Empresa:\x20','Job\x20','__esModule','REDIS_PASSWORD','findAndCountAll','name','subtract','MessageUpdateJob','number','./models/Contact','status@broadcast','info','endsWith','moment','3334814HikDHm','companyId','findAll','timeSendQueue','getWbot','map','CURRENT_DATE','company-','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','\x20failed\x20with\x20error:\x20','handle\x20login','CloseTicketsAutomatic','asDays','call','profilePicUrl','utc','setMinutes','captureException','configurable','YYYY-MM-DD','open','CONNECTED','campaignQueue','Atendimento\x20Perdido:\x20','\x20segundos\x20finalizado:\x20','format','127.0.0.1','sendIdQueue','9GKpydW','Sequelize','messageQueue','extraInfo','\x20segundos\x20iniciado:\x20','isInteger','Queue','REDIS_PORT','add','search','HANDLE\x20SEND\x20MESSAGE','email','planId','queueMonitor','REDIS_OPT_LIMITER_MAX','15520PWnwHR','setHours','MessageQueue\x20->\x20SendMessage:\x20error','1994592svDRUF','whatsapps','./models/Plan','Iniciando\x20geração\x20de\x20boletos','messageUpdate','36KPPGVu','ScheduleMonitor','1141910rvdfvN','QueueMonitor','__setModuleDefault','pending','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','./workers/campaingJob','startQueueProcess','./models/Ticket','2310988SREixh','floor','./utils/logger','Worker','literal','random','\x20completed','bullmq','log','duration','./services/WbotServices/MarkDeleteWhatsAppMessage','HandleMessageJob','toString','completed','key','HH:mm:ss','messages','getQueue','count','contact','error','-ticket','VerifySchedules','remoteJid','create','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','verifyRecentCampaign','DD/MM/yyyy','VerifyLoginStatus','./services/WbotServices/wbotMessageListener','emit','./helpers/SendMessage','like','apply','generalMonitor','Iniciando\x20processamento\x20de\x20filas','logger','whatsappId','__importStar','readMessages','(((.+)+)+)+$','./models/User','CampaignQueue','./models/Company','VerifyQueueStatus','message','ClosedAllOpenTickets\x20->\x20Verify:\x20error','findByPk','SendMessage','minutes','Whatsapp\x20não\x20identificado'];a310_0x3e12=function(){return _0x45ceb8;};return a310_0x3e12();}exports[a310_0x44385a(0x110)]=sleep;function randomValue(_0x1cca42,_0x16e1c8){const _0x27cfc9=a310_0x44385a;return Math[_0x27cfc9(0xd6)](Math[_0x27cfc9(0xda)]()*_0x16e1c8)+_0x1cca42;}exports['randomValue']=randomValue;async function handleLoginStatus(){const _0x33a305=a310_0x44385a;console[_0x33a305(0xdd)](_0x33a305(0xa2));const _0x4c07f8=new Date();_0x4c07f8[_0x33a305(0xa8)](_0x4c07f8['getMinutes']()-0x5),await User_1[_0x33a305(0x10f)][_0x33a305(0x119)]({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x4c07f8},'online':!![]}});}async function handleInvoiceCreate(){const _0x57069d=a310_0x44385a;logger_1[_0x57069d(0xf9)]['info'](_0x57069d(0xc9));const _0x4701cd=await Company_1['default']['findAll']({'where':{'status':!![]}});_0x4701cd['map'](async _0x375485=>{const _0x54cb0a=_0x57069d,{dueDate:_0x3fbcd3}=_0x375485,_0x502677=new Date(_0x3fbcd3)[_0x54cb0a(0xc4)](0x0,0x0,0x0,0x0),_0x1bcf2c=new Date(_0x3fbcd3)['setHours'](0x17,0x3b,0x3b,0x3e7),_0x1bb2da=(0x0,moment_1[_0x54cb0a(0x10f)])((0x0,moment_1[_0x54cb0a(0x10f)])())[_0x54cb0a(0xb1)](_0x54cb0a(0xf0)),_0x249785=(0x0,moment_1[_0x54cb0a(0x10f)])(_0x3fbcd3)['format'](_0x54cb0a(0xf0)),_0x192710=(0x0,moment_1[_0x54cb0a(0x10f)])(_0x249785,_0x54cb0a(0xf0))['diff']((0x0,moment_1[_0x54cb0a(0x10f)])(_0x1bb2da,_0x54cb0a(0xf0))),_0x25bd63=moment_1['default'][_0x54cb0a(0xde)](_0x192710)[_0x54cb0a(0xa4)]();if(_0x25bd63<0x14){const _0xc823e0=await Plan_1[_0x54cb0a(0x10f)][_0x54cb0a(0x104)](_0x375485[_0x54cb0a(0xc0)]);let _0x4374fa=await Invoices_1[_0x54cb0a(0x10f)][_0x54cb0a(0xe7)]({'where':{'companyId':_0x375485['id'],'dueDate':{[sequelize_1['Op'][_0x54cb0a(0xf5)]]:(0x0,moment_1['default'])(_0x3fbcd3)[_0x54cb0a(0xb1)](_0x54cb0a(0xab))}}});if(+_0x4374fa===0x0){const _0x4002b8=(0x0,moment_1[_0x54cb0a(0x10f)])()['format']();await Invoices_1[_0x54cb0a(0x10f)][_0x54cb0a(0xed)]({'detail':_0xc823e0[_0x54cb0a(0x127)],'status':_0x54cb0a(0xac),'value':_0xc823e0['value'],'updatedAt':_0x4002b8,'createdAt':_0x4002b8,'dueDate':(0x0,moment_1[_0x54cb0a(0x10f)])(_0x3fbcd3)[_0x54cb0a(0xb1)](_0x54cb0a(0xab)),'companyId':_0x375485['id']});}}});}async function startQueueProcess(){const _0x3d89f6=a310_0x44385a;logger_1[_0x3d89f6(0xf9)][_0x3d89f6(0x95)](_0x3d89f6(0xf8)),await exports['userMonitor'][_0x3d89f6(0xbc)](_0x3d89f6(0xf1),{},{'repeat':{'every':0xea60*0x5,'key':_0x3d89f6(0xf1)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x234320=new bullmq_1[(_0x3d89f6(0xd8))](exports[_0x3d89f6(0x10d)][_0x3d89f6(0x127)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x234320['on'](_0x3d89f6(0xe2),async _0x2e8a41=>{const _0x2da930=_0x3d89f6;logger_1[_0x2da930(0xf9)][_0x2da930(0x95)](_0x2da930(0x123)+_0x2e8a41[_0x2da930(0x127)]+_0x2da930(0xdb));}),await exports[_0x3d89f6(0xf7)][_0x3d89f6(0xbc)](_0x3d89f6(0xa3),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x3d89f6(0xa3)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x3d89f6(0xf7)][_0x3d89f6(0xbc)]('InvoiceCreate',{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x3d89f6(0x115)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x3a76ab=new bullmq_1[(_0x3d89f6(0xd8))](exports[_0x3d89f6(0xf7)]['name'],async _0xd5396b=>{if(_0xd5396b['name']=='CloseTicketsAutomatic')await handleCloseTicketsAutomatic();else _0xd5396b['name']=='InvoiceCreate'&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}}),_0x557c1c=new campaingJob_1['default'](),_0x2efa85=_0x557c1c['getCampaignQueue']();await _0x2efa85['add'](_0x3d89f6(0x10e),{},{'repeat':{'every':0x3c*0x3e8*0x1,'key':_0x3d89f6(0x10e)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x3d5889=new bullmq_1[(_0x3d89f6(0xd8))](exports['messageQueue'][_0x3d89f6(0x127)],async _0x49fb3e=>{const _0x1a2452=_0x3d89f6;if(_0x49fb3e[_0x1a2452(0x127)]==_0x1a2452(0xe0))await handleMessageJob(_0x49fb3e);else{if(_0x49fb3e[_0x1a2452(0x127)]==_0x1a2452(0x129))await messageUpdateJob(_0x49fb3e);else _0x49fb3e['name']==_0x1a2452(0x105)&&await handleSendMessage(_0x49fb3e);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x3d5889['on'](_0x3d89f6(0xe2),async _0x4316c4=>{const _0x1e0aa6=_0x3d89f6;logger_1[_0x1e0aa6(0xf9)][_0x1e0aa6(0x95)](_0x1e0aa6(0x123)+_0x4316c4[_0x1e0aa6(0x127)]+_0x1e0aa6(0xdb));}),_0x3d5889['on'](_0x3d89f6(0x117),async(_0x4405f8,_0x54930c)=>{const _0x71a168=_0x3d89f6;logger_1[_0x71a168(0xf9)][_0x71a168(0xe9)](_0x71a168(0x123)+_0x4405f8[_0x71a168(0x127)]+_0x71a168(0xa1)+_0x54930c[_0x71a168(0x102)]);}),await exports[_0x3d89f6(0xc1)][_0x3d89f6(0xbc)](_0x3d89f6(0x101),{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':_0x3d89f6(0x101)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x5803a6=new bullmq_1[(_0x3d89f6(0xd8))](exports[_0x3d89f6(0xc1)]['name'],async _0x37ec61=>{const _0x5d117f=_0x3d89f6;_0x37ec61['name']==_0x5d117f(0x101)&&await handleVerifyQueue(_0x37ec61);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x5803a6['on'](_0x3d89f6(0xe2),async _0x6e148f=>{const _0x3aac5a=_0x3d89f6;logger_1['logger'][_0x3aac5a(0x95)](_0x3aac5a(0x123)+_0x6e148f['id']+'\x20completed');});let _0x53f2a6=new scheduledMessageJob_1['default'](exports['scheduleMonitor'],connection);await _0x53f2a6[_0x3d89f6(0xe6)]()['add'](_0x3d89f6(0xeb),{},{'repeat':{'every':0xea60*0x5,'key':_0x3d89f6(0x120)},'removeOnComplete':!![],'removeOnFail':!![]});}exports[a310_0x44385a(0xd3)]=startQueueProcess;