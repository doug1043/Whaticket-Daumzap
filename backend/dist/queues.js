'use strict';const a349_0x49b0c7=a349_0x23a5;(function(_0x33de12,_0x48d43e){const _0x19a7e0=a349_0x23a5,_0x59ac1d=_0x33de12();while(!![]){try{const _0x2ecb31=parseInt(_0x19a7e0(0x2b5))/0x1*(parseInt(_0x19a7e0(0x274))/0x2)+parseInt(_0x19a7e0(0x261))/0x3+parseInt(_0x19a7e0(0x26c))/0x4+-parseInt(_0x19a7e0(0x255))/0x5+parseInt(_0x19a7e0(0x207))/0x6+parseInt(_0x19a7e0(0x222))/0x7*(-parseInt(_0x19a7e0(0x210))/0x8)+-parseInt(_0x19a7e0(0x1f1))/0x9*(-parseInt(_0x19a7e0(0x221))/0xa);if(_0x2ecb31===_0x48d43e)break;else _0x59ac1d['push'](_0x59ac1d['shift']());}catch(_0x589f04){_0x59ac1d['push'](_0x59ac1d['shift']());}}}(a349_0x4c11,0x7c29a));var __createBinding=this&&this[a349_0x49b0c7(0x29a)]||(Object['create']?function(_0x5b1ba9,_0x21f259,_0x4dd9e5,_0x31fc93){const _0x85b2e=a349_0x49b0c7;if(_0x31fc93===undefined)_0x31fc93=_0x4dd9e5;var _0x267789=Object[_0x85b2e(0x219)](_0x21f259,_0x4dd9e5);(!_0x267789||(_0x85b2e(0x292)in _0x267789?!_0x21f259[_0x85b2e(0x251)]:_0x267789['writable']||_0x267789[_0x85b2e(0x2a9)]))&&(_0x267789={'enumerable':!![],'get':function(){return _0x21f259[_0x4dd9e5];}}),Object['defineProperty'](_0x5b1ba9,_0x31fc93,_0x267789);}:function(_0x263718,_0x1849ef,_0x3e0c11,_0x5a1cfe){if(_0x5a1cfe===undefined)_0x5a1cfe=_0x3e0c11;_0x263718[_0x5a1cfe]=_0x1849ef[_0x3e0c11];}),__setModuleDefault=this&&this[a349_0x49b0c7(0x266)]||(Object[a349_0x49b0c7(0x20d)]?function(_0x5aee63,_0x2cf837){const _0x226a1d=a349_0x49b0c7;Object['defineProperty'](_0x5aee63,_0x226a1d(0x1f2),{'enumerable':!![],'value':_0x2cf837});}:function(_0x2cb4d8,_0x1bb86a){_0x2cb4d8['default']=_0x1bb86a;}),__importStar=this&&this[a349_0x49b0c7(0x283)]||(function(){const _0x17acb3=(function(){let _0xff5167=!![];return function(_0x1bba4e,_0x2911db){const _0x5cd58a=_0xff5167?function(){const _0x37f84d=a349_0x23a5;if(_0x2911db){const _0x1e8a4c=_0x2911db[_0x37f84d(0x226)](_0x1bba4e,arguments);return _0x2911db=null,_0x1e8a4c;}}:function(){};return _0xff5167=![],_0x5cd58a;};}()),_0x1972dc=_0x17acb3(this,function(){const _0x5b5bcb=a349_0x23a5;return _0x1972dc[_0x5b5bcb(0x2ab)]()[_0x5b5bcb(0x279)](_0x5b5bcb(0x26a))['toString']()['constructor'](_0x1972dc)[_0x5b5bcb(0x279)](_0x5b5bcb(0x26a));});_0x1972dc();var _0x15326e=function(_0x8d9ff7){const _0x2914f8=a349_0x23a5;return _0x15326e=Object[_0x2914f8(0x1fa)]||function(_0x24883b){const _0x3492c3=_0x2914f8;var _0x105ace=[];for(var _0x2a1c66 in _0x24883b)if(Object[_0x3492c3(0x23d)]['hasOwnProperty'][_0x3492c3(0x2bb)](_0x24883b,_0x2a1c66))_0x105ace[_0x105ace[_0x3492c3(0x228)]]=_0x2a1c66;return _0x105ace;},_0x15326e(_0x8d9ff7);};return function(_0x5d085e){const _0x530abf=a349_0x23a5;if(_0x5d085e&&_0x5d085e[_0x530abf(0x251)])return _0x5d085e;var _0x551313={};if(_0x5d085e!=null){for(var _0x21c8b6=_0x15326e(_0x5d085e),_0x2b5d83=0x0;_0x2b5d83<_0x21c8b6[_0x530abf(0x228)];_0x2b5d83++)if(_0x21c8b6[_0x2b5d83]!=='default')__createBinding(_0x551313,_0x5d085e,_0x21c8b6[_0x2b5d83]);}return __setModuleDefault(_0x551313,_0x5d085e),_0x551313;};}()),__importDefault=this&&this[a349_0x49b0c7(0x2cb)]||function(_0x252475){const _0x2793cc=a349_0x49b0c7;return _0x252475&&_0x252475[_0x2793cc(0x251)]?_0x252475:{'default':_0x252475};};Object['defineProperty'](exports,a349_0x49b0c7(0x251),{'value':!![]}),exports[a349_0x49b0c7(0x2b3)]=exports[a349_0x49b0c7(0x236)]=exports[a349_0x49b0c7(0x208)]=exports[a349_0x49b0c7(0x26f)]=exports[a349_0x49b0c7(0x1f4)]=exports[a349_0x49b0c7(0x287)]=exports[a349_0x49b0c7(0x1ec)]=exports[a349_0x49b0c7(0x259)]=void 0x0,exports[a349_0x49b0c7(0x2ba)]=handleWhatsappAutoRestart,exports[a349_0x49b0c7(0x263)]=parseToMilliseconds,exports[a349_0x49b0c7(0x2c5)]=sleep,exports[a349_0x49b0c7(0x26e)]=randomValue,exports['startQueueProcess']=startQueueProcess;const Sentry=__importStar(require(a349_0x49b0c7(0x272))),bull_1=__importDefault(require(a349_0x49b0c7(0x29d))),moment_1=__importDefault(require(a349_0x49b0c7(0x24d))),sequelize_1=require(a349_0x49b0c7(0x28d)),lodash_1=require(a349_0x49b0c7(0x260)),path_1=__importDefault(require(a349_0x49b0c7(0x2da))),cron_1=require(a349_0x49b0c7(0x224)),SendMessage_1=require(a349_0x49b0c7(0x27b)),Whatsapp_1=__importDefault(require(a349_0x49b0c7(0x25d))),logger_1=require('./utils/logger'),Schedule_1=__importDefault(require(a349_0x49b0c7(0x25e))),Contact_1=__importDefault(require(a349_0x49b0c7(0x2a4))),GetDefaultWhatsApp_1=__importDefault(require(a349_0x49b0c7(0x230))),Campaign_1=__importDefault(require(a349_0x49b0c7(0x1ef))),ContactList_1=__importDefault(require(a349_0x49b0c7(0x29f))),ContactListItem_1=__importDefault(require(a349_0x49b0c7(0x202))),CampaignSetting_1=__importDefault(require(a349_0x49b0c7(0x2aa))),CampaignShipping_1=__importDefault(require(a349_0x49b0c7(0x2d1))),GetWhatsappWbot_1=__importDefault(require('./helpers/GetWhatsappWbot')),database_1=__importDefault(require(a349_0x49b0c7(0x1ea))),SendWhatsAppMedia_1=require('./services/WbotServices/SendWhatsAppMedia'),socket_1=require(a349_0x49b0c7(0x29c)),User_1=__importDefault(require(a349_0x49b0c7(0x21f))),Company_1=__importDefault(require(a349_0x49b0c7(0x1f0))),Plan_1=__importDefault(require(a349_0x49b0c7(0x252))),wbotMessageListener_1=require(a349_0x49b0c7(0x2d5)),ShowService_1=__importDefault(require('./services/CampaignService/ShowService')),Ticket_1=__importDefault(require(a349_0x49b0c7(0x209))),SendWhatsAppMessage_1=__importDefault(require(a349_0x49b0c7(0x20f))),wbot_1=require(a349_0x49b0c7(0x2d0)),StartWhatsAppSession_1=require(a349_0x49b0c7(0x23e)),connection=process[a349_0x49b0c7(0x2c2)][a349_0x49b0c7(0x2d2)]||'',limiterMax=process[a349_0x49b0c7(0x2c2)][a349_0x49b0c7(0x214)]||0x1,limiterDuration=process[a349_0x49b0c7(0x2c2)]['REDIS_OPT_LIMITER_DURATION']||0xbb8;exports[a349_0x49b0c7(0x259)]=new bull_1['default']('UserMonitor',connection),exports[a349_0x49b0c7(0x1ec)]=new bull_1[(a349_0x49b0c7(0x1f2))]('MessageQueue',connection,{'limiter':{'max':limiterMax,'duration':limiterDuration}}),exports[a349_0x49b0c7(0x287)]=new bull_1['default'](a349_0x49b0c7(0x24c),connection),exports['sendScheduledMessages']=new bull_1[(a349_0x49b0c7(0x1f2))](a349_0x49b0c7(0x2a1),connection),exports[a349_0x49b0c7(0x26f)]=new bull_1['default'](a349_0x49b0c7(0x2b7),connection);async function handleWhatsappAutoRestart(){const _0x45542f=a349_0x49b0c7;try{const _0x135a0c=await Whatsapp_1[_0x45542f(0x1f2)][_0x45542f(0x269)]({'where':{'automaticRestart':!![],'status':_0x45542f(0x2ad)}}),_0x1cc1a7=new Date();for(const _0x4cd638 of _0x135a0c){const _0x58c4b9=_0x4cd638[_0x45542f(0x2a6)]||_0x4cd638[_0x45542f(0x244)]||_0x4cd638[_0x45542f(0x2c3)];shouldRestart(_0x1cc1a7,_0x58c4b9,_0x4cd638[_0x45542f(0x2dd)])&&(logger_1[_0x45542f(0x282)][_0x45542f(0x25a)](_0x45542f(0x2c0)+_0x4cd638['name']+_0x45542f(0x23b)+_0x4cd638['id']+_0x45542f(0x1f3)+_0x4cd638[_0x45542f(0x2dd)]+')'),await(0x0,wbot_1['removeWbot'])(_0x4cd638['id'],![]),await new Promise(_0x3fdd19=>setTimeout(_0x3fdd19,0xbb8)),await(0x0,StartWhatsAppSession_1[_0x45542f(0x23a)])(_0x4cd638,_0x4cd638[_0x45542f(0x227)]),await _0x4cd638[_0x45542f(0x295)]({'lastRestartAt':new Date()}));}}catch(_0x5ae10e){logger_1[_0x45542f(0x282)][_0x45542f(0x243)](_0x45542f(0x20b)+_0x5ae10e[_0x45542f(0x22d)]);}}exports[a349_0x49b0c7(0x208)]=new bull_1[(a349_0x49b0c7(0x1f2))](a349_0x49b0c7(0x22b),connection),exports[a349_0x49b0c7(0x236)]=new bull_1[(a349_0x49b0c7(0x1f2))](a349_0x49b0c7(0x2b0),connection);function shouldRestart(_0x3b7c20,_0x27de07,_0x15dbd8){const _0x35ed49=a349_0x49b0c7;if(_0x15dbd8===_0x35ed49(0x239))return(0x0,moment_1['default'])(_0x3b7c20)[_0x35ed49(0x24a)]((0x0,moment_1[_0x35ed49(0x1f2)])(_0x27de07),'days')>=0x1;if(_0x15dbd8==='semanalmente')return(0x0,moment_1[_0x35ed49(0x1f2)])(_0x3b7c20)[_0x35ed49(0x24a)]((0x0,moment_1['default'])(_0x27de07),'weeks')>=0x1;if(_0x15dbd8===_0x35ed49(0x204))return(0x0,moment_1['default'])(_0x3b7c20)[_0x35ed49(0x24a)]((0x0,moment_1[_0x35ed49(0x1f2)])(_0x27de07),_0x35ed49(0x2dc))>=0x1;return![];}async function handleVerifyTicketExpiration(){const _0x122f04=a349_0x49b0c7;try{const _0x2a7a26=await database_1[_0x122f04(0x1f2)][_0x122f04(0x229)](_0x122f04(0x288),{'type':sequelize_1[_0x122f04(0x2ac)][_0x122f04(0x28f)]});for(const _0x541014 of _0x2a7a26){let _0x4bdd79={};_0x541014[_0x122f04(0x2c6)]==='agent'&&(_0x4bdd79={'fromMe':!![]});if(_0x541014[_0x122f04(0x278)]>0x0&&_0x541014[_0x122f04(0x284)]){const _0xb56fb4=_0x541014[_0x122f04(0x1ed)]-_0x541014[_0x122f04(0x278)];if(_0xb56fb4>0x0){const _0x242e59=await Ticket_1['default'][_0x122f04(0x269)]({'where':{'status':_0x122f04(0x298),'whatsappId':_0x541014['id'],'companyId':_0x541014[_0x122f04(0x227)],'ticketsWithWarning':![],..._0x4bdd79,'updatedAt':{[sequelize_1['Op']['lt']]:(0x0,moment_1[_0x122f04(0x1f2)])()[_0x122f04(0x2ae)](_0xb56fb4,'minutes')[_0x122f04(0x28e)](),[sequelize_1['Op']['gt']]:(0x0,moment_1[_0x122f04(0x1f2)])()[_0x122f04(0x2ae)](_0x541014[_0x122f04(0x1ed)],_0x122f04(0x299))[_0x122f04(0x28e)]()}},'include':[{'model':Contact_1[_0x122f04(0x1f2)],'as':'contact'}]});for(const _0x5638c0 of _0x242e59){try{await(0x0,SendWhatsAppMessage_1[_0x122f04(0x1f2)])({'ticket':_0x5638c0,'body':_0x541014[_0x122f04(0x284)]}),await Ticket_1[_0x122f04(0x1f2)][_0x122f04(0x295)]({'ticketsWithWarning':!![]},{'where':{'id':_0x5638c0['id']},'silent':!![]}),logger_1[_0x122f04(0x282)][_0x122f04(0x25a)](_0x122f04(0x22f)+_0x5638c0['id']);}catch(_0x3c01f2){Sentry['captureException'](_0x3c01f2),logger_1[_0x122f04(0x282)][_0x122f04(0x243)](_0x122f04(0x27e)+_0x3c01f2[_0x122f04(0x22d)]);}}}}const _0xec96c5=await Ticket_1[_0x122f04(0x1f2)][_0x122f04(0x269)]({'where':{'status':_0x122f04(0x298),'whatsappId':_0x541014['id'],'companyId':_0x541014[_0x122f04(0x227)],..._0x4bdd79,'updatedAt':{[sequelize_1['Op']['lt']]:(0x0,moment_1[_0x122f04(0x1f2)])()[_0x122f04(0x2ae)](_0x541014['expiresTicket'],_0x122f04(0x299))[_0x122f04(0x28e)]()}},'include':[{'model':Contact_1['default'],'as':_0x122f04(0x2db)}]});for(const _0x171d98 of _0xec96c5){try{_0x541014[_0x122f04(0x235)]&&(await(0x0,SendWhatsAppMessage_1[_0x122f04(0x1f2)])({'ticket':_0x171d98,'body':_0x541014['expiresInactiveMessage']}),await new Promise(_0x598990=>setTimeout(_0x598990,0x3e8)));await _0x171d98[_0x122f04(0x295)]({'status':_0x122f04(0x2d4),'amountUsedBotQueues':0x0,'ticketsWithWarning':![]});const _0x1151ba=(0x0,socket_1['getIO'])();_0x1151ba['to']('company-'+_0x171d98[_0x122f04(0x227)]+_0x122f04(0x24e))['to']('queue-'+_0x171d98[_0x122f04(0x2b1)]+'-open')[_0x122f04(0x231)]('company-'+_0x171d98[_0x122f04(0x227)]+_0x122f04(0x1e9),{'action':_0x122f04(0x295),'ticket':{..._0x171d98[_0x122f04(0x27a)],'status':_0x122f04(0x2d4)}}),_0x1151ba['to']('company-'+_0x171d98['companyId']+'-closed')[_0x122f04(0x231)]('company-'+_0x171d98[_0x122f04(0x227)]+'-ticket',{'action':_0x122f04(0x295),'ticket':{..._0x171d98[_0x122f04(0x27a)],'status':_0x122f04(0x2d4)}}),logger_1[_0x122f04(0x282)]['info'](_0x122f04(0x296)+_0x171d98['id']+'\x20fechado\x20por\x20inatividade\x20após\x20'+_0x541014[_0x122f04(0x1ed)]+_0x122f04(0x2d9));}catch(_0x5415fb){Sentry[_0x122f04(0x280)](_0x5415fb),logger_1[_0x122f04(0x282)][_0x122f04(0x243)]({'error':_0x5415fb},_0x122f04(0x270));}}_0xec96c5[_0x122f04(0x228)]>0x0&&logger_1[_0x122f04(0x282)][_0x122f04(0x25a)](_0xec96c5[_0x122f04(0x228)]+'\x20tickets\x20fechados\x20por\x20inatividade\x20para\x20a\x20empresa\x20'+_0x541014[_0x122f04(0x227)]);}}catch(_0x4d2ad3){Sentry[_0x122f04(0x280)](_0x4d2ad3),logger_1[_0x122f04(0x282)]['error']({'error':_0x4d2ad3},'TicketMonitor\x20->\x20VerifyTicketExpiration:\x20erro');}}exports[a349_0x49b0c7(0x2b3)]=new bull_1[(a349_0x49b0c7(0x1f2))](a349_0x49b0c7(0x248),connection);async function handleSendMessage(_0x1541b6){const _0x20c204=a349_0x49b0c7;try{const {data:_0x489271}=_0x1541b6,_0x28e508=await Whatsapp_1[_0x20c204(0x1f2)][_0x20c204(0x2d8)](_0x489271[_0x20c204(0x25b)]);if(_0x28e508==null)throw Error(_0x20c204(0x2a2));const _0xb4d34=_0x489271[_0x20c204(0x2b4)];await(0x0,SendMessage_1[_0x20c204(0x2bd)])(_0x28e508,_0xb4d34);}catch(_0x1530d8){Sentry[_0x20c204(0x280)](_0x1530d8),logger_1[_0x20c204(0x282)]['error']({'error':_0x1530d8},_0x20c204(0x1f7));throw _0x1530d8;}}async function handleVerifySchedules(){const _0x35b82d=a349_0x49b0c7;try{const {count:_0x405d2c,rows:_0x5f191b}=await Schedule_1[_0x35b82d(0x1f2)][_0x35b82d(0x250)]({'where':{'status':'PENDENTE','sentAt':null,'sendAt':{[sequelize_1['Op']['gte']]:(0x0,moment_1[_0x35b82d(0x1f2)])()[_0x35b82d(0x291)](_0x35b82d(0x25c)),[sequelize_1['Op']['lte']]:(0x0,moment_1[_0x35b82d(0x1f2)])()[_0x35b82d(0x253)]('30',_0x35b82d(0x265))['format']('YYYY-MM-DD\x20HH:mm:ss')}},'include':[{'model':Contact_1[_0x35b82d(0x1f2)],'as':_0x35b82d(0x2db)}]});_0x405d2c>0x0&&_0x5f191b[_0x35b82d(0x256)](async _0x4be148=>{const _0x2295c4=_0x35b82d;await _0x4be148[_0x2295c4(0x295)]({'status':_0x2295c4(0x2a7)}),exports[_0x2295c4(0x1f4)][_0x2295c4(0x253)](_0x2295c4(0x2bd),{'schedule':_0x4be148},{'delay':0x9c40}),logger_1[_0x2295c4(0x282)][_0x2295c4(0x25a)]('Disparo\x20agendado\x20para:\x20'+_0x4be148[_0x2295c4(0x2db)][_0x2295c4(0x21b)]);});}catch(_0x9391e9){Sentry[_0x35b82d(0x280)](_0x9391e9),logger_1[_0x35b82d(0x282)]['error']({'error':_0x9391e9},_0x35b82d(0x29e));throw _0x9391e9;}}async function handleSendScheduledMessage(_0x546064){const _0x2c3b3b=a349_0x49b0c7,{data:{schedule:_0x1781ef}}=_0x546064;let _0x381df4=null;try{_0x381df4=await Schedule_1[_0x2c3b3b(0x1f2)]['findByPk'](_0x1781ef['id']);}catch(_0x953872){Sentry['captureException'](_0x953872),logger_1['logger']['info'](_0x2c3b3b(0x240)+_0x1781ef['id']);}try{const _0x1faa82=await(0x0,GetDefaultWhatsApp_1[_0x2c3b3b(0x1f2)])(_0x1781ef[_0x2c3b3b(0x227)]),_0x25fafb=await(0x0,SendMessage_1[_0x2c3b3b(0x2bd)])(_0x1faa82,{'number':_0x1781ef[_0x2c3b3b(0x2db)][_0x2c3b3b(0x286)],'body':_0x1781ef[_0x2c3b3b(0x268)]});_0x1781ef[_0x2c3b3b(0x27f)]&&(0x0,wbotMessageListener_1[_0x2c3b3b(0x2b9)])(_0x25fafb,await(0x0,GetWhatsappWbot_1[_0x2c3b3b(0x1f2)])(_0x1faa82),_0x1781ef[_0x2c3b3b(0x227)]),await _0x381df4?.[_0x2c3b3b(0x295)]({'sentAt':new Date(),'status':_0x2c3b3b(0x212)}),logger_1[_0x2c3b3b(0x282)][_0x2c3b3b(0x25a)](_0x2c3b3b(0x20a)+_0x1781ef['contact'][_0x2c3b3b(0x21b)]),exports[_0x2c3b3b(0x1f4)][_0x2c3b3b(0x1ff)](0x3a98,_0x2c3b3b(0x2d3));}catch(_0x3115a2){Sentry[_0x2c3b3b(0x280)](_0x3115a2),await _0x381df4?.['update']({'status':_0x2c3b3b(0x234)}),logger_1[_0x2c3b3b(0x282)][_0x2c3b3b(0x243)]({'error':_0x3115a2},_0x2c3b3b(0x232));throw _0x3115a2;}}async function handleVerifyCampaigns(){const _0x2045f0=a349_0x49b0c7,_0x47a2f9=await database_1['default'][_0x2045f0(0x229)](_0x2045f0(0x25f),{'type':sequelize_1[_0x2045f0(0x2ac)][_0x2045f0(0x28f)]});_0x47a2f9[_0x2045f0(0x228)]&&logger_1['logger'][_0x2045f0(0x25a)](_0x2045f0(0x238)+_0x47a2f9[_0x2045f0(0x228)]),_0x47a2f9[_0x2045f0(0x247)](_0x133555=>{const _0x1af42d=_0x2045f0;try{const _0x436a50=(0x0,moment_1[_0x1af42d(0x1f2)])(),_0x4ed055=(0x0,moment_1[_0x1af42d(0x1f2)])(_0x133555[_0x1af42d(0x2bc)]),_0x229d65=_0x4ed055['diff'](_0x436a50,_0x1af42d(0x2bf));logger_1['logger'][_0x1af42d(0x25a)](_0x1af42d(0x27d)+_0x133555['id']+_0x1af42d(0x237)+_0x229d65),exports[_0x1af42d(0x2b3)][_0x1af42d(0x253)](_0x1af42d(0x277),{'id':_0x133555['id'],'delay':_0x229d65},{'removeOnComplete':!![]});}catch(_0x495456){Sentry[_0x1af42d(0x280)](_0x495456);}});}async function getCampaign(_0x3add70){const _0x25bd6a=a349_0x49b0c7;return Campaign_1[_0x25bd6a(0x1f2)][_0x25bd6a(0x2d8)](_0x3add70,{'include':[{'model':ContactList_1['default'],'as':'contactList','attributes':['id',_0x25bd6a(0x21b)],'include':[{'model':ContactListItem_1['default'],'as':'contacts','attributes':['id',_0x25bd6a(0x21b),_0x25bd6a(0x286),_0x25bd6a(0x26b),_0x25bd6a(0x2ca)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1[_0x25bd6a(0x1f2)],'as':'whatsapp','attributes':['id',_0x25bd6a(0x21b)]},{'model':CampaignShipping_1[_0x25bd6a(0x1f2)],'as':_0x25bd6a(0x245),'include':[{'model':ContactListItem_1[_0x25bd6a(0x1f2)],'as':_0x25bd6a(0x2db)}]}]});}async function getSettings(_0x3448f0){const _0x26ca98=a349_0x49b0c7,_0x1e476c=await CampaignSetting_1[_0x26ca98(0x1f2)][_0x26ca98(0x269)]({'where':{'companyId':_0x3448f0['companyId']},'attributes':[_0x26ca98(0x233),_0x26ca98(0x2c4)]});let _0x316a8c=0x14,_0x177dfa=0x14,_0x402384=0x3c,_0x7b579f=[];return _0x1e476c[_0x26ca98(0x247)](_0xe31303=>{const _0x532d2a=_0x26ca98;_0xe31303[_0x532d2a(0x233)]==='messageInterval'&&(_0x316a8c=JSON[_0x532d2a(0x297)](_0xe31303['value'])),_0xe31303[_0x532d2a(0x233)]==='longerIntervalAfter'&&(_0x177dfa=JSON[_0x532d2a(0x297)](_0xe31303[_0x532d2a(0x2c4)])),_0xe31303[_0x532d2a(0x233)]===_0x532d2a(0x281)&&(_0x402384=JSON[_0x532d2a(0x297)](_0xe31303[_0x532d2a(0x2c4)])),_0xe31303['key']==='variables'&&(_0x7b579f=JSON[_0x532d2a(0x297)](_0xe31303[_0x532d2a(0x2c4)]));}),{'messageInterval':_0x316a8c,'longerIntervalAfter':_0x177dfa,'greaterInterval':_0x402384,'variables':_0x7b579f};}function parseToMilliseconds(_0x530b11){return _0x530b11*0x3e8;}function a349_0x23a5(_0x4b2884,_0x57062a){const _0x3056f0=a349_0x4c11();return a349_0x23a5=function(_0x56857b,_0x38d2bc){_0x56857b=_0x56857b-0x1e9;let _0x4c1188=_0x3056f0[_0x56857b];return _0x4c1188;},a349_0x23a5(_0x4b2884,_0x57062a);}async function sleep(_0x4ef501){const _0x5c7ef2=a349_0x49b0c7;return logger_1[_0x5c7ef2(0x282)][_0x5c7ef2(0x25a)](_0x5c7ef2(0x21d)+_0x4ef501+_0x5c7ef2(0x2a0)+(0x0,moment_1[_0x5c7ef2(0x1f2)])()[_0x5c7ef2(0x291)](_0x5c7ef2(0x2b8))),new Promise(_0x12a936=>{setTimeout(()=>{const _0xc14a0b=a349_0x23a5;logger_1['logger'][_0xc14a0b(0x25a)](_0xc14a0b(0x21d)+_0x4ef501+_0xc14a0b(0x20c)+(0x0,moment_1['default'])()[_0xc14a0b(0x291)](_0xc14a0b(0x2b8))),_0x12a936(!![]);},parseToMilliseconds(_0x4ef501));});}function getCampaignValidMessages(_0x193bb7){const _0xf87fdb=a349_0x49b0c7,_0x50e242=[];return!(0x0,lodash_1['isEmpty'])(_0x193bb7[_0xf87fdb(0x205)])&&!(0x0,lodash_1['isNil'])(_0x193bb7[_0xf87fdb(0x205)])&&_0x50e242[_0xf87fdb(0x2de)](_0x193bb7[_0xf87fdb(0x205)]),!(0x0,lodash_1[_0xf87fdb(0x264)])(_0x193bb7['message2'])&&!(0x0,lodash_1[_0xf87fdb(0x215)])(_0x193bb7[_0xf87fdb(0x217)])&&_0x50e242[_0xf87fdb(0x2de)](_0x193bb7[_0xf87fdb(0x217)]),!(0x0,lodash_1['isEmpty'])(_0x193bb7[_0xf87fdb(0x27c)])&&!(0x0,lodash_1['isNil'])(_0x193bb7[_0xf87fdb(0x27c)])&&_0x50e242[_0xf87fdb(0x2de)](_0x193bb7[_0xf87fdb(0x27c)]),!(0x0,lodash_1['isEmpty'])(_0x193bb7[_0xf87fdb(0x24f)])&&!(0x0,lodash_1[_0xf87fdb(0x215)])(_0x193bb7[_0xf87fdb(0x24f)])&&_0x50e242[_0xf87fdb(0x2de)](_0x193bb7[_0xf87fdb(0x24f)]),!(0x0,lodash_1[_0xf87fdb(0x264)])(_0x193bb7[_0xf87fdb(0x246)])&&!(0x0,lodash_1[_0xf87fdb(0x215)])(_0x193bb7[_0xf87fdb(0x246)])&&_0x50e242[_0xf87fdb(0x2de)](_0x193bb7[_0xf87fdb(0x246)]),_0x50e242;}function getCampaignValidConfirmationMessages(_0x426529){const _0xdf3fb2=a349_0x49b0c7,_0x246436=[];return!(0x0,lodash_1['isEmpty'])(_0x426529['confirmationMessage1'])&&!(0x0,lodash_1['isNil'])(_0x426529['confirmationMessage1'])&&_0x246436[_0xdf3fb2(0x2de)](_0x426529['confirmationMessage1']),!(0x0,lodash_1[_0xdf3fb2(0x264)])(_0x426529[_0xdf3fb2(0x257)])&&!(0x0,lodash_1[_0xdf3fb2(0x215)])(_0x426529[_0xdf3fb2(0x257)])&&_0x246436[_0xdf3fb2(0x2de)](_0x426529['confirmationMessage2']),!(0x0,lodash_1['isEmpty'])(_0x426529[_0xdf3fb2(0x2af)])&&!(0x0,lodash_1[_0xdf3fb2(0x215)])(_0x426529[_0xdf3fb2(0x2af)])&&_0x246436[_0xdf3fb2(0x2de)](_0x426529[_0xdf3fb2(0x2af)]),!(0x0,lodash_1[_0xdf3fb2(0x264)])(_0x426529[_0xdf3fb2(0x23f)])&&!(0x0,lodash_1[_0xdf3fb2(0x215)])(_0x426529[_0xdf3fb2(0x23f)])&&_0x246436[_0xdf3fb2(0x2de)](_0x426529['confirmationMessage4']),!(0x0,lodash_1[_0xdf3fb2(0x264)])(_0x426529[_0xdf3fb2(0x2b2)])&&!(0x0,lodash_1[_0xdf3fb2(0x215)])(_0x426529['confirmationMessage5'])&&_0x246436[_0xdf3fb2(0x2de)](_0x426529[_0xdf3fb2(0x2b2)]),_0x246436;}function getProcessedMessage(_0x27cc00,_0x231475,_0x3e5c12){const _0x2af854=a349_0x49b0c7;let _0x5cc19e=_0x27cc00;return _0x5cc19e['includes'](_0x2af854(0x294))&&(_0x5cc19e=_0x5cc19e[_0x2af854(0x242)](/{nome}/g,_0x3e5c12['name'])),_0x5cc19e[_0x2af854(0x2a5)](_0x2af854(0x20e))&&(_0x5cc19e=_0x5cc19e[_0x2af854(0x242)](/{email}/g,_0x3e5c12[_0x2af854(0x26b)])),_0x5cc19e['includes'](_0x2af854(0x254))&&(_0x5cc19e=_0x5cc19e[_0x2af854(0x242)](/{numero}/g,_0x3e5c12[_0x2af854(0x286)])),_0x231475[_0x2af854(0x247)](_0x9d5de6=>{const _0xfd5563=_0x2af854;if(_0x5cc19e[_0xfd5563(0x2a5)]('{'+_0x9d5de6[_0xfd5563(0x233)]+'}')){const _0xd4c379=new RegExp('{'+_0x9d5de6[_0xfd5563(0x233)]+'}','g');_0x5cc19e=_0x5cc19e[_0xfd5563(0x242)](_0xd4c379,_0x9d5de6['value']);}}),_0x5cc19e;}function randomValue(_0x1b3f09,_0x4f6e4b){const _0x1842e8=a349_0x49b0c7;return Math[_0x1842e8(0x2cf)](Math[_0x1842e8(0x206)]()*_0x4f6e4b)+_0x1b3f09;}function a349_0x4c11(){const _0x18e115=['isNil','resolve','message2','\x20AND\x20\x22dueDate\x22::text\x20LIKE\x20\x27','getOwnPropertyDescriptor',';Registro=','name','planId','Sleep\x20de\x20','isArray','./models/User','confirmation','2810ZVKTNZ','7rOOUDR','getMessageOptions','cron','asDays','apply','companyId','length','query','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','TicketMonitor','*\x20*\x20*\x20*\x20*','message','INSERT','Aviso\x20de\x20inatividade\x20enviado\x20para\x20o\x20ticket\x20#','./helpers/GetDefaultWhatsApp','emit','SendScheduledMessage\x20->\x20SendMessage:\x20error','key','ERRO','expiresInactiveMessage','whatsappRestartQueue',',\x20Delay\x20Inicial=','Campanhas\x20encontradas:\x20','diariamente','StartWhatsAppSession','\x20(ID:\x20',';Contato=','prototype','./services/WbotServices/StartWhatsAppSession','confirmationMessage4','Erro\x20ao\x20tentar\x20consultar\x20agendamento:\x20','save','replace','error','updatedAt','shipping','message5','forEach','CampaignQueue','Campanha\x20enviada\x20para:\x20Campanha=','diff','0\x20*\x20*\x20*\x20*','ScheduleMonitor','moment','-open','message4','findAndCountAll','__esModule','./models/Plan','add','{numero}','2400525VlJNtk','map','confirmationMessage2','Iniciando\x20processamento\x20de\x20filas','userMonitor','info','whatsappId','YYYY-MM-DD\x20HH:mm:ss','./models/Whatsapp','./models/Schedule','select\x20id,\x20\x22scheduledAt\x22\x20from\x20\x22Campaigns\x22\x20c\x0a\x20\x20\x20\x20where\x20\x22scheduledAt\x22\x20between\x20now()\x20and\x20now()\x20+\x20\x271\x20hour\x27::interval\x20and\x20status\x20=\x20\x27PROGRAMADA\x27','lodash','118986JxxPzR','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','parseToMilliseconds','isEmpty','seconds','__setModuleDefault','EM_ANDAMENTO','body','findAll','(((.+)+)+)+$','email','3373600RoOWJF','campaignId','randomValue','ticketInactiveWarningQueue','Erro\x20ao\x20fechar\x20ticket\x20por\x20inatividade','VerifyCampaignsDaatabase','@sentry/node','DispatchConfirmedCampaign','121988fLrboA','sendMessage','variables','ProcessCampaign','inactiveMessageTime','search','dataValues','./helpers/SendMessage','message3','Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha=','Erro\x20ao\x20enviar\x20aviso\x20de\x20inatividade:\x20','saveMessage','captureException','greaterInterval','logger','__importStar','inactiveMessage','contactList','number','scheduleMonitor','SELECT\x20id,\x20\x22expiresTicket\x22,\x20\x22companyId\x22,\x20\x22whenExpireTicket\x22,\x0a\x20\x20\x20\x22expiresInactiveMessage\x22,\x20\x22inactiveMessage\x22,\x20\x22inactiveMessageTime\x22\x0a\x20\x20\x20FROM\x20\x22Whatsapps\x22\x20WHERE\x20\x22expiresTicket\x22\x20>\x200','process','confirmationRequestedAt','Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha=','VerifyLoginStatus','sequelize','toDate','SELECT','messageInterval','format','get','mediaPath','{nome}','update','Ticket\x20#','parse','open','minutes','__createBinding',';Delay=','./libs/socket','bull','SendScheduledMessage\x20->\x20Verify:\x20error','./models/ContactList','\x20segundos\x20iniciado:\x20','SendSacheduledMessages','Whatsapp\x20não\x20identificado','duration','./models/Contact','includes','lastRestartAt','AGENDADA','\x27,\x20\x27open\x27,\x20\x27','configurable','./models/CampaignSetting','toString','QueryTypes','CONNECTED','subtract','confirmationMessage3','WhatsappRestartQueue','queueId','confirmationMessage5','campaignQueue','data','1GYgVYw','getIO','TicketInactiveWarning','HH:mm:ss','handleMessage','handleWhatsappAutoRestart','call','scheduledAt','SendMessage','\x27,\x20','milliseconds','Reiniciando\x20conexão\x20WhatsApp\x20','public','env','createdAt','value','sleep','whenExpireTicket','findOrCreate','DD/MM/yyyy','*/5\x20*\x20*\x20*\x20*\x20*','isWhatsappValid','__importDefault','contactId','VerifyTicketExpiration','confirmationMessage','floor','./libs/wbot','./models/CampaignShipping','REDIS_URI','completed','closed','./services/WbotServices/wbotMessageListener','deliveredAt','longerIntervalAfter','findByPk','\x20minutos.','path','contact','months','period','push','-ticket','./database','\x27,\x20\x27','messageQueue','expiresTicket','AutoRestart','./models/Campaign','./models/Company','6687TQSzlE','default',')\x20de\x20acordo\x20com\x20o\x20período\x20(','sendScheduledMessages','0\x20*\x20*\x20*\x20*\x20*','mediaName','MessageQueue\x20->\x20SendMessage:\x20error','Verify','company-','getOwnPropertyNames','@s.whatsapp.net','whatsapp','then','Usuário\x20passado\x20para\x20offline:\x20','clean','DispatchCampaign','*/20\x20*\x20*\x20*\x20*\x20*','./models/ContactListItem','-campaign','mensalmente','message1','random','494640FXFyoV','ticketMonitor','./models/Ticket','Mensagem\x20agendada\x20enviada\x20para:\x20','Erro\x20ao\x20reiniciar\x20conexões\x20WhatsApp\x20periodicamente:\x20','\x20segundos\x20finalizado:\x20','create','{email}','./services/WbotServices/SendWhatsAppMessage','1972832hMkgAv','start','ENVIADA','FINALIZADA','REDIS_OPT_LIMITER_MAX'];a349_0x4c11=function(){return _0x18e115;};return a349_0x4c11();}async function verifyAndFinalizeCampaign(_0x44aa37){const _0x353d3a=a349_0x49b0c7,_0x3ef1c2=await(0x0,ShowService_1['default'])(_0x44aa37['id']);_0x3ef1c2['valids']===_0x3ef1c2['delivered']&&await _0x44aa37[_0x353d3a(0x295)]({'status':_0x353d3a(0x213),'completedAt':(0x0,moment_1['default'])()});const _0x49c99f=(0x0,socket_1['getIO'])();_0x49c99f['emit'](_0x353d3a(0x1f9)+_0x44aa37[_0x353d3a(0x227)]+_0x353d3a(0x203),_0x3ef1c2);}async function prepareContact(_0x39b760,_0x378d7f,_0x2ed76f,_0x212739,_0x318b13,_0xc6ccfc){const _0x266b57=a349_0x49b0c7,_0x463d04={};_0x463d04[_0x266b57(0x286)]=_0x2ed76f[_0x266b57(0x286)],_0x463d04[_0x266b57(0x2cc)]=_0x2ed76f['id'],_0x463d04[_0x266b57(0x26d)]=_0x39b760['id'];if(_0x318b13['length']){const _0x2c1d16=randomValue(0x0,_0x318b13[_0x266b57(0x228)]),_0x485898=getProcessedMessage(_0x318b13[_0x2c1d16],_0x378d7f,_0x2ed76f);_0x463d04['message']=''+_0x485898;}if(_0x39b760[_0x266b57(0x220)]){if(_0xc6ccfc['length']){const _0x4b7df0=randomValue(0x0,_0xc6ccfc[_0x266b57(0x228)]),_0x2a9547=getProcessedMessage(_0xc6ccfc[_0x4b7df0],_0x378d7f,_0x2ed76f);_0x463d04[_0x266b57(0x2ce)]=''+_0x2a9547;}}const [_0x2c9948,_0x3aabac]=await CampaignShipping_1[_0x266b57(0x1f2)][_0x266b57(0x2c7)]({'where':{'campaignId':_0x463d04[_0x266b57(0x26d)],'contactId':_0x463d04['contactId']},'defaults':_0x463d04});!_0x3aabac&&_0x2c9948[_0x266b57(0x2d6)]===null&&_0x2c9948[_0x266b57(0x28a)]===null&&(_0x2c9948['set'](_0x463d04),await _0x2c9948[_0x266b57(0x241)]());if(_0x2c9948[_0x266b57(0x2d6)]===null&&_0x2c9948[_0x266b57(0x28a)]===null){const _0x2d7278=await exports[_0x266b57(0x2b3)][_0x266b57(0x253)](_0x266b57(0x200),{'campaignId':_0x39b760['id'],'campaignShippingId':_0x2c9948['id'],'contactListItemId':_0x2ed76f['id']},{'delay':_0x212739});await _0x2c9948[_0x266b57(0x295)]({'jobId':''+_0x2d7278['id']});}}async function handleProcessCampaign(_0x1efce3){const _0x1882a4=a349_0x49b0c7;try{const {id:_0x1a7864}=_0x1efce3[_0x1882a4(0x2b4)];let {delay:_0x4492b9}=_0x1efce3[_0x1882a4(0x2b4)];const _0x555ccb=await getCampaign(_0x1a7864),_0x543e37=await getSettings(_0x555ccb);if(_0x555ccb){const {contacts:_0x939f32}=_0x555ccb[_0x1882a4(0x285)],_0x21625e=getCampaignValidMessages(_0x555ccb),_0x3a93a0=_0x555ccb[_0x1882a4(0x220)]?getCampaignValidConfirmationMessages(_0x555ccb):null;if((0x0,lodash_1[_0x1882a4(0x21e)])(_0x939f32)){let _0x133686=0x0;_0x939f32[_0x1882a4(0x247)](_0x58d821=>{const _0x2eeece=_0x1882a4;prepareContact(_0x555ccb,_0x543e37[_0x2eeece(0x276)],_0x58d821,_0x4492b9,_0x21625e,_0x3a93a0)[_0x2eeece(0x1fd)](()=>{const _0x744261=_0x2eeece;logger_1[_0x744261(0x282)][_0x744261(0x25a)](_0x744261(0x28b)+_0x555ccb['id']+_0x744261(0x23c)+_0x58d821['name']+_0x744261(0x29b)+_0x4492b9);}),_0x133686+=0x1,_0x133686%_0x543e37[_0x2eeece(0x2d7)]===0x0?_0x4492b9+=parseToMilliseconds(_0x543e37[_0x2eeece(0x281)]):_0x4492b9+=parseToMilliseconds(randomValue(0x0,_0x543e37[_0x2eeece(0x290)]));}),await _0x555ccb[_0x1882a4(0x295)]({'status':_0x1882a4(0x267)});}}}catch(_0x4980d8){Sentry[_0x1882a4(0x280)](_0x4980d8);}}async function handleDispatchCampaign(_0x4dd3a3){const _0x55d0ee=a349_0x49b0c7;try{const {data:_0x53d95c}=_0x4dd3a3,{campaignShippingId:_0x4ce208,campaignId:_0x5d46cf}=_0x53d95c,_0x29d3f1=await Campaign_1[_0x55d0ee(0x1f2)][_0x55d0ee(0x2d8)](_0x5d46cf,{'include':[{'model':Whatsapp_1['default'],'as':'whatsapp'}]});if(!_0x29d3f1){logger_1[_0x55d0ee(0x282)][_0x55d0ee(0x243)]({'data':_0x53d95c},'Campaign\x20not\x20found');return;}const _0x5883bd=await(0x0,GetWhatsappWbot_1[_0x55d0ee(0x1f2)])(_0x29d3f1[_0x55d0ee(0x1fc)]);logger_1[_0x55d0ee(0x282)][_0x55d0ee(0x25a)](_0x55d0ee(0x262)+_0x5d46cf+_0x55d0ee(0x21a)+_0x4ce208);const _0x27490e=await CampaignShipping_1[_0x55d0ee(0x1f2)][_0x55d0ee(0x2d8)](_0x4ce208,{'include':[{'model':ContactListItem_1[_0x55d0ee(0x1f2)],'as':_0x55d0ee(0x2db)}]}),_0x5c695d=_0x27490e['number']+_0x55d0ee(0x1fb);if(_0x29d3f1[_0x55d0ee(0x220)]&&_0x27490e['confirmation']===null)await _0x5883bd[_0x55d0ee(0x275)](_0x5c695d,{'text':_0x27490e['confirmationMessage']}),await _0x27490e[_0x55d0ee(0x295)]({'confirmationRequestedAt':(0x0,moment_1[_0x55d0ee(0x1f2)])()});else{await _0x5883bd[_0x55d0ee(0x275)](_0x5c695d,{'text':_0x27490e['message']});if(_0x29d3f1[_0x55d0ee(0x293)]){const _0xb25377=path_1[_0x55d0ee(0x1f2)][_0x55d0ee(0x216)](_0x55d0ee(0x2c1),_0x29d3f1[_0x55d0ee(0x293)]),_0xf60929=await(0x0,SendWhatsAppMedia_1[_0x55d0ee(0x223)])(_0x29d3f1[_0x55d0ee(0x1f6)],_0xb25377);Object['keys'](_0xf60929)[_0x55d0ee(0x228)]&&await _0x5883bd[_0x55d0ee(0x275)](_0x5c695d,{..._0xf60929});}await _0x27490e[_0x55d0ee(0x295)]({'deliveredAt':(0x0,moment_1[_0x55d0ee(0x1f2)])()});}await verifyAndFinalizeCampaign(_0x29d3f1);const _0xd4b578=(0x0,socket_1[_0x55d0ee(0x2b6)])();_0xd4b578[_0x55d0ee(0x231)](_0x55d0ee(0x1f9)+_0x29d3f1[_0x55d0ee(0x227)]+'-campaign',{'action':_0x55d0ee(0x295),'record':_0x29d3f1}),logger_1['logger'][_0x55d0ee(0x25a)](_0x55d0ee(0x249)+_0x5d46cf+_0x55d0ee(0x23c)+_0x27490e[_0x55d0ee(0x2db)][_0x55d0ee(0x21b)]);}catch(_0x5bd1bb){Sentry['captureException'](_0x5bd1bb),logger_1[_0x55d0ee(0x282)]['error'](_0x5bd1bb[_0x55d0ee(0x22d)]);}}async function handleLoginStatus(){const _0x493ca1=a349_0x49b0c7,_0x9ea177=await database_1[_0x493ca1(0x1f2)][_0x493ca1(0x229)](_0x493ca1(0x22a),{'type':sequelize_1['QueryTypes']['SELECT']});_0x9ea177[_0x493ca1(0x247)](async _0x4f9cde=>{const _0x2a387c=_0x493ca1;try{const _0x536e88=await User_1[_0x2a387c(0x1f2)][_0x2a387c(0x2d8)](_0x4f9cde['id']);await _0x536e88[_0x2a387c(0x295)]({'online':![]}),logger_1[_0x2a387c(0x282)][_0x2a387c(0x25a)](_0x2a387c(0x1fe)+_0x4f9cde['id']);}catch(_0x587097){Sentry[_0x2a387c(0x280)](_0x587097);}});}async function handleInvoiceCreate(){const _0x562b3d=a349_0x49b0c7,_0x17126b=new cron_1['CronJob'](_0x562b3d(0x1f5),async()=>{const _0x11ea0d=_0x562b3d,_0xc07fb6=await Company_1['default'][_0x11ea0d(0x269)]();_0xc07fb6['map'](async _0x6b650a=>{const _0x147754=_0x11ea0d,{dueDate:_0x1e16d2}=_0x6b650a,_0xa72299=(0x0,moment_1[_0x147754(0x1f2)])(_0x1e16d2)['format'](),_0x33dcd8=(0x0,moment_1[_0x147754(0x1f2)])()[_0x147754(0x291)](),_0x235904=(0x0,moment_1[_0x147754(0x1f2)])((0x0,moment_1[_0x147754(0x1f2)])())[_0x147754(0x291)]('DD/MM/yyyy'),_0x846c33=(0x0,moment_1[_0x147754(0x1f2)])(_0x1e16d2)[_0x147754(0x291)](_0x147754(0x2c8)),_0x406318=(0x0,moment_1[_0x147754(0x1f2)])(_0x846c33,_0x147754(0x2c8))[_0x147754(0x24a)]((0x0,moment_1[_0x147754(0x1f2)])(_0x235904,_0x147754(0x2c8))),_0x59510a=moment_1['default'][_0x147754(0x2a3)](_0x406318)[_0x147754(0x225)]();if(_0x59510a<0x14){const _0x1ce1f6=await Plan_1[_0x147754(0x1f2)][_0x147754(0x2d8)](_0x6b650a[_0x147754(0x21c)]),_0xa9431e='SELECT\x20COUNT(*)\x20mycount\x20FROM\x20\x22Invoices\x22\x20WHERE\x20\x22companyId\x22\x20=\x20'+_0x6b650a['id']+_0x147754(0x218)+(0x0,moment_1[_0x147754(0x1f2)])(_0x1e16d2)[_0x147754(0x291)]('yyyy-MM-DD')+'%\x27;',_0x5c15a7=await database_1[_0x147754(0x1f2)][_0x147754(0x229)](_0xa9431e,{'type':sequelize_1[_0x147754(0x2ac)][_0x147754(0x28f)]});if(+_0x5c15a7[0x0]['mycount']===0x0){const _0x1fe2a7='INSERT\x20INTO\x20\x22Invoices\x22\x20(detail,\x20status,\x20value,\x20\x22updatedAt\x22,\x20\x22createdAt\x22,\x20\x22dueDate\x22,\x20\x22companyId\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(\x27'+_0x1ce1f6[_0x147754(0x21b)]+_0x147754(0x2a8)+_0x1ce1f6[_0x147754(0x2c4)]+_0x147754(0x1eb)+_0x33dcd8+_0x147754(0x1eb)+_0x33dcd8+_0x147754(0x1eb)+_0xa72299+_0x147754(0x2be)+_0x6b650a['id']+');';await database_1['default'][_0x147754(0x229)](_0x1fe2a7,{'type':sequelize_1[_0x147754(0x2ac)][_0x147754(0x22e)]});}}});});_0x17126b[_0x562b3d(0x211)]();}handleInvoiceCreate();async function startQueueProcess(){const _0x28ccc1=a349_0x49b0c7;logger_1['logger'][_0x28ccc1(0x25a)](_0x28ccc1(0x258)),exports[_0x28ccc1(0x1ec)][_0x28ccc1(0x289)](_0x28ccc1(0x2bd),handleSendMessage),exports[_0x28ccc1(0x287)][_0x28ccc1(0x289)](_0x28ccc1(0x1f8),handleVerifySchedules),exports[_0x28ccc1(0x1f4)][_0x28ccc1(0x289)]('SendMessage',handleSendScheduledMessage),exports[_0x28ccc1(0x2b3)][_0x28ccc1(0x289)](_0x28ccc1(0x271),handleVerifyCampaigns),exports[_0x28ccc1(0x2b3)][_0x28ccc1(0x289)](_0x28ccc1(0x277),handleProcessCampaign),exports[_0x28ccc1(0x2b3)]['process'](_0x28ccc1(0x200),handleDispatchCampaign),exports[_0x28ccc1(0x259)][_0x28ccc1(0x289)](_0x28ccc1(0x28c),handleLoginStatus),exports[_0x28ccc1(0x2b3)][_0x28ccc1(0x289)](_0x28ccc1(0x273),handleDispatchCampaign),exports[_0x28ccc1(0x208)][_0x28ccc1(0x289)](_0x28ccc1(0x2cd),handleVerifyTicketExpiration),exports[_0x28ccc1(0x236)][_0x28ccc1(0x289)](_0x28ccc1(0x1ee),handleWhatsappAutoRestart),exports[_0x28ccc1(0x287)]['add'](_0x28ccc1(0x1f8),{},{'repeat':{'cron':_0x28ccc1(0x2c9)},'removeOnComplete':!![]}),exports[_0x28ccc1(0x2b3)][_0x28ccc1(0x253)](_0x28ccc1(0x271),{},{'repeat':{'cron':_0x28ccc1(0x201)},'removeOnComplete':!![]}),exports[_0x28ccc1(0x259)]['add'](_0x28ccc1(0x28c),{},{'repeat':{'cron':_0x28ccc1(0x22c)},'removeOnComplete':!![]}),exports['ticketMonitor']['add'](_0x28ccc1(0x2cd),{},{'repeat':{'cron':_0x28ccc1(0x22c)},'removeOnComplete':!![]}),exports[_0x28ccc1(0x236)][_0x28ccc1(0x253)](_0x28ccc1(0x1ee),{},{'repeat':{'cron':_0x28ccc1(0x24b)},'removeOnComplete':!![]});}