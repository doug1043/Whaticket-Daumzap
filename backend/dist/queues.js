const a307_0x2ea9fe=a307_0x2407;(function(_0x512f24,_0x28a695){const _0x4cda9b=a307_0x2407,_0x4b46af=_0x512f24();while(!![]){try{const _0x170743=-parseInt(_0x4cda9b(0x135))/0x1*(parseInt(_0x4cda9b(0x18e))/0x2)+parseInt(_0x4cda9b(0x119))/0x3*(parseInt(_0x4cda9b(0x12b))/0x4)+-parseInt(_0x4cda9b(0x12a))/0x5+parseInt(_0x4cda9b(0x18f))/0x6*(-parseInt(_0x4cda9b(0x125))/0x7)+-parseInt(_0x4cda9b(0x1aa))/0x8*(-parseInt(_0x4cda9b(0x143))/0x9)+-parseInt(_0x4cda9b(0x13d))/0xa+-parseInt(_0x4cda9b(0x134))/0xb*(-parseInt(_0x4cda9b(0x183))/0xc);if(_0x170743===_0x28a695)break;else _0x4b46af['push'](_0x4b46af['shift']());}catch(_0x485534){_0x4b46af['push'](_0x4b46af['shift']());}}}(a307_0x3514,0x5d98b));const a307_0x31e423=(function(){let _0x23d025=!![];return function(_0x1ffb9d,_0x49b28f){const _0x6323cf=_0x23d025?function(){const _0x3abd12=a307_0x2407;if(_0x49b28f){const _0x59452a=_0x49b28f[_0x3abd12(0x16f)](_0x1ffb9d,arguments);return _0x49b28f=null,_0x59452a;}}:function(){};return _0x23d025=![],_0x6323cf;};}()),a307_0x78eca9=a307_0x31e423(this,function(){const _0x626db6=a307_0x2407;return a307_0x78eca9[_0x626db6(0x116)]()[_0x626db6(0x16c)](_0x626db6(0x16e))[_0x626db6(0x116)]()[_0x626db6(0x15d)](a307_0x78eca9)[_0x626db6(0x16c)](_0x626db6(0x16e));});a307_0x78eca9();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a307_0x2ea9fe(0x195)]?function(_0x5711df,_0x29bdf8,_0x3795a6,_0x2485b4){const _0x3cee35=a307_0x2ea9fe;if(_0x2485b4===undefined)_0x2485b4=_0x3795a6;var _0x4402d5=Object['getOwnPropertyDescriptor'](_0x29bdf8,_0x3795a6);(!_0x4402d5||('get'in _0x4402d5?!_0x29bdf8['__esModule']:_0x4402d5[_0x3cee35(0x123)]||_0x4402d5[_0x3cee35(0x138)]))&&(_0x4402d5={'enumerable':!![],'get':function(){return _0x29bdf8[_0x3795a6];}}),Object[_0x3cee35(0x13e)](_0x5711df,_0x2485b4,_0x4402d5);}:function(_0x2d0384,_0x2a0ffd,_0x1114f6,_0x9f20d){if(_0x9f20d===undefined)_0x9f20d=_0x1114f6;_0x2d0384[_0x9f20d]=_0x2a0ffd[_0x1114f6];}),__setModuleDefault=this&&this[a307_0x2ea9fe(0x19e)]||(Object[a307_0x2ea9fe(0x195)]?function(_0x2d2edc,_0xe93845){const _0x230728=a307_0x2ea9fe;Object['defineProperty'](_0x2d2edc,_0x230728(0x13c),{'enumerable':!![],'value':_0xe93845});}:function(_0x18a24e,_0x474f00){const _0x4584ad=a307_0x2ea9fe;_0x18a24e[_0x4584ad(0x13c)]=_0x474f00;}),__importStar=this&&this[a307_0x2ea9fe(0x17f)]||function(_0x4fd0d1){const _0x33ace3=a307_0x2ea9fe;if(_0x4fd0d1&&_0x4fd0d1[_0x33ace3(0x130)])return _0x4fd0d1;var _0x301a44={};if(_0x4fd0d1!=null){for(var _0x295d42 in _0x4fd0d1)if(_0x295d42!==_0x33ace3(0x13c)&&Object[_0x33ace3(0x16b)]['hasOwnProperty']['call'](_0x4fd0d1,_0x295d42))__createBinding(_0x301a44,_0x4fd0d1,_0x295d42);}return __setModuleDefault(_0x301a44,_0x4fd0d1),_0x301a44;},__importDefault=this&&this['__importDefault']||function(_0x5d9aa5){const _0x53445e=a307_0x2ea9fe;return _0x5d9aa5&&_0x5d9aa5[_0x53445e(0x130)]?_0x5d9aa5:{'default':_0x5d9aa5};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a307_0x2ea9fe(0x166)]=exports[a307_0x2ea9fe(0x1a7)]=exports[a307_0x2ea9fe(0x137)]=exports['parseToMilliseconds']=exports[a307_0x2ea9fe(0x192)]=exports[a307_0x2ea9fe(0x155)]=exports[a307_0x2ea9fe(0x1a2)]=exports[a307_0x2ea9fe(0x163)]=exports[a307_0x2ea9fe(0x14f)]=exports[a307_0x2ea9fe(0x170)]=void 0x0;const Sentry=__importStar(require(a307_0x2ea9fe(0x164))),bullmq_1=require(a307_0x2ea9fe(0x150)),SendMessage_1=require(a307_0x2ea9fe(0x124)),Whatsapp_1=__importDefault(require(a307_0x2ea9fe(0x15e))),logger_1=require(a307_0x2ea9fe(0x184)),moment_1=__importDefault(require(a307_0x2ea9fe(0x175))),Contact_1=__importDefault(require(a307_0x2ea9fe(0x17e))),sequelize_1=require(a307_0x2ea9fe(0x11a)),socket_1=require('./libs/socket'),User_1=__importDefault(require('./models/User')),Company_1=__importDefault(require(a307_0x2ea9fe(0x115))),Plan_1=__importDefault(require(a307_0x2ea9fe(0x159))),Ticket_1=__importDefault(require(a307_0x2ea9fe(0x12f))),wbotClosedTickets_1=require(a307_0x2ea9fe(0x126)),Invoices_1=__importDefault(require('./models/Invoices')),wbotMessageListener_1=require(a307_0x2ea9fe(0x197)),wbot_1=require(a307_0x2ea9fe(0x113)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a307_0x2ea9fe(0x1a0))),campaingJob_1=__importDefault(require('./workers/campaingJob')),scheduledMessageJob_1=__importDefault(require(a307_0x2ea9fe(0x165))),connection={'port':parseInt(process['env'][a307_0x2ea9fe(0x11d)]),'host':process[a307_0x2ea9fe(0x181)][a307_0x2ea9fe(0x14b)]||a307_0x2ea9fe(0x13f),'password':process[a307_0x2ea9fe(0x181)][a307_0x2ea9fe(0x127)]};function a307_0x2407(_0x48398c,_0x247926){const _0xd14368=a307_0x3514();return a307_0x2407=function(_0x78eca9,_0x31e423){_0x78eca9=_0x78eca9-0x10c;let _0x351430=_0xd14368[_0x78eca9];return _0x351430;},a307_0x2407(_0x48398c,_0x247926);}exports[a307_0x2ea9fe(0x170)]=new bullmq_1['Queue']('UserMonitor',{'connection':connection}),exports[a307_0x2ea9fe(0x14f)]=new bullmq_1[(a307_0x2ea9fe(0x189))](a307_0x2ea9fe(0x156),{'connection':connection}),exports[a307_0x2ea9fe(0x163)]=new bullmq_1['Queue'](a307_0x2ea9fe(0x16a),{'connection':connection}),exports['queueMonitor']=new bullmq_1[(a307_0x2ea9fe(0x189))](a307_0x2ea9fe(0x10e),{'connection':connection}),exports[a307_0x2ea9fe(0x155)]=new bullmq_1[(a307_0x2ea9fe(0x189))](a307_0x2ea9fe(0x19d),{'connection':connection}),exports[a307_0x2ea9fe(0x192)]=new bullmq_1[(a307_0x2ea9fe(0x189))](a307_0x2ea9fe(0x110),{'connection':connection});const campaignQueueManager=new campaingJob_1['default']();async function handleVerifyQueue(_0x2168c2){const _0x195f1f=a307_0x2ea9fe;logger_1['logger'][_0x195f1f(0x140)](_0x195f1f(0x161));try{const _0x38861e=await Company_1[_0x195f1f(0x13c)][_0x195f1f(0x120)]({'attributes':['id',_0x195f1f(0x121)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x195f1f(0x131)][_0x195f1f(0x190)]('CURRENT_DATE')}},'include':[{'model':Whatsapp_1[_0x195f1f(0x13c)],'attributes':['id','name','status',_0x195f1f(0x13a),'sendIdQueue'],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x38861e[_0x195f1f(0x194)](async _0x3abcd6=>{const _0x3c349=_0x195f1f;_0x3abcd6[_0x3c349(0x18a)][_0x3c349(0x194)](async _0x102aa0=>{const _0xe8a814=_0x3c349;if(_0x102aa0[_0xe8a814(0x1a1)]==='CONNECTED'){const _0x227b28=_0x3abcd6['id'],_0x121050=_0x102aa0[_0xe8a814(0x13a)]?_0x102aa0[_0xe8a814(0x13a)]:0x0,_0x23b818=_0x102aa0[_0xe8a814(0x117)],_0x49646c=_0x121050,_0x27db88=_0x23b818,_0x36aa8d=_0x49646c;if(_0x121050>0x0&&!isNaN(_0x27db88)&&Number[_0xe8a814(0x111)](_0x27db88)&&!isNaN(_0x36aa8d)&&Number[_0xe8a814(0x111)](_0x36aa8d)){const _0xee60dc=(0x0,moment_1[_0xe8a814(0x13c)])()[_0xe8a814(0x19c)](_0x36aa8d,_0xe8a814(0x15b))[_0xe8a814(0x112)]()[_0xe8a814(0x149)](),{count:_0x38353e,rows:_0x2f20d2}=await Ticket_1[_0xe8a814(0x13c)][_0xe8a814(0x14d)]({'where':{'status':_0xe8a814(0x17b),'queueId':null,'companyId':_0x227b28,'whatsappId':_0x102aa0['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0xee60dc}},'include':[{'model':Contact_1[_0xe8a814(0x13c)],'as':_0xe8a814(0x148),'attributes':['id','name',_0xe8a814(0x118),_0xe8a814(0x1a3),_0xe8a814(0x185)],'include':[_0xe8a814(0x160)]}]});_0x38353e>0x0?_0x2f20d2[_0xe8a814(0x194)](async _0x556821=>{const _0x427f58=_0xe8a814;await _0x556821['update']({'queueId':_0x27db88}),await _0x556821[_0x427f58(0x19b)]();const _0x84a7c1=(0x0,socket_1[_0x427f58(0x11f)])();_0x84a7c1['to']('company-'+_0x556821[_0x427f58(0x19f)]+'-'+_0x556821[_0x427f58(0x1a1)])['to'](_0x427f58(0x14c)+_0x556821[_0x427f58(0x19f)]+'-notification')['to'](_0x556821['id']['toString']())['emit'](_0x427f58(0x14c)+_0x227b28+_0x427f58(0x10d),{'action':'update','ticket':_0x556821,'ticketId':_0x556821['id']}),logger_1['logger'][_0x427f58(0x140)](_0x427f58(0x153)+_0x556821['id']+_0x427f58(0x154)+_0x227b28);}):logger_1[_0xe8a814(0x187)]['info']('Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20'+_0x227b28);}else logger_1[_0xe8a814(0x187)][_0xe8a814(0x140)](_0xe8a814(0x10c)+_0x227b28);}});});}catch(_0x160021){console[_0x195f1f(0x174)](_0x160021);}}async function handleCloseTicketsAutomatic(){const _0x3591d7=a307_0x2ea9fe,_0x3831e1=await Company_1[_0x3591d7(0x13c)][_0x3591d7(0x120)]({'where':{'status':!![]}});_0x3831e1[_0x3591d7(0x194)](async _0x36bccc=>{const _0x3e64e1=_0x3591d7;try{const _0x4f0cb8=_0x36bccc['id'];await(0x0,wbotClosedTickets_1[_0x3e64e1(0x144)])(_0x4f0cb8);}catch(_0x480442){Sentry[_0x3e64e1(0x19a)](_0x480442),logger_1['logger']['error'](_0x3e64e1(0x180),_0x480442['message']);throw _0x480442;}});}async function messageUpdateJob(_0xb1f542){const _0x5e53a4=a307_0x2ea9fe,{data:_0x167922}=_0xb1f542,_0x3a5486=_0x167922[_0x5e53a4(0x19f)],_0x216af3=_0x167922[_0x5e53a4(0x133)],_0x5030b0=_0x167922[_0x5e53a4(0x178)],_0x2aa8d6=(0x0,wbot_1['getWbot'])(_0x5030b0);if(!Array[_0x5e53a4(0x1a8)](_0x216af3)){logger_1[_0x5e53a4(0x187)]['warn'](_0x5e53a4(0x12d),_0x216af3);return;}for(const _0x3317d8 of _0x216af3){try{logger_1[_0x5e53a4(0x187)][_0x5e53a4(0x147)](_0x5e53a4(0x176),_0x3317d8);if(!_0x3317d8?.[_0x5e53a4(0x188)]?.['id']||typeof _0x3317d8[_0x5e53a4(0x188)]['id']!=='string'){logger_1[_0x5e53a4(0x187)][_0x5e53a4(0x11e)](_0x5e53a4(0x173),_0x3317d8?.[_0x5e53a4(0x188)]?.['id']);continue;}await _0x2aa8d6[_0x5e53a4(0x14e)]([_0x3317d8['key']]);_0x3317d8[_0x5e53a4(0x139)]?.[_0x5e53a4(0x17a)]===0x1&&_0x3317d8[_0x5e53a4(0x188)][_0x5e53a4(0x16d)]!==_0x5e53a4(0x141)&&await(0x0,MarkDeleteWhatsAppMessage_1[_0x5e53a4(0x13c)])(_0x3317d8[_0x5e53a4(0x188)][_0x5e53a4(0x16d)],null,_0x3317d8[_0x5e53a4(0x188)]['id'],_0x3a5486);if(_0x3317d8[_0x5e53a4(0x139)]?.[_0x5e53a4(0x1a1)]===undefined||_0x3317d8[_0x5e53a4(0x139)][_0x5e53a4(0x1a1)]===null){logger_1[_0x5e53a4(0x187)][_0x5e53a4(0x11e)](_0x5e53a4(0x122),_0x3317d8);continue;}await(0x0,wbotMessageListener_1['handleMsgAck'])(_0x3317d8,_0x3317d8[_0x5e53a4(0x139)][_0x5e53a4(0x1a1)]);}catch(_0x14cd05){logger_1['logger'][_0x5e53a4(0x174)](_0x5e53a4(0x145),_0x14cd05),Sentry['captureException'](_0x14cd05);}}}async function handleMessageJob(_0xb1209){const _0x287dfe=a307_0x2ea9fe,{data:_0x5a5aaf}=_0xb1209;var _0x1fb137=_0x5a5aaf['messages'],_0x4c5dc0=_0x5a5aaf[_0x287dfe(0x19f)];const _0xc833ef=(0x0,wbot_1[_0x287dfe(0x152)])(_0x5a5aaf[_0x287dfe(0x178)]);for(const _0x3529aa of _0x1fb137){await(0x0,wbotMessageListener_1[_0x287dfe(0x12c)])(_0x3529aa,_0xc833ef,_0x4c5dc0),await(0x0,wbotMessageListener_1[_0x287dfe(0x18c)])(_0x3529aa,_0x4c5dc0),await(0x0,wbotMessageListener_1[_0x287dfe(0x158)])(_0x3529aa,_0x4c5dc0),_0x3529aa[_0x287dfe(0x188)][_0x287dfe(0x16d)]?.['endsWith'](_0x287dfe(0x1ab))&&await(0x0,wbotMessageListener_1[_0x287dfe(0x162)])(_0x3529aa,0x2);}}async function handleSendMessage(_0x49056c){const _0x5c2260=a307_0x2ea9fe;console['log'](_0x5c2260(0x18b));try{const {data:_0x4050e7}=_0x49056c,_0x4d2e45=await Whatsapp_1[_0x5c2260(0x13c)][_0x5c2260(0x15c)](_0x4050e7[_0x5c2260(0x178)]);if(_0x4d2e45==null)throw new sequelize_1[(_0x5c2260(0x132))](_0x5c2260(0x136));const _0x442271=_0x4050e7['data'];await(0x0,SendMessage_1[_0x5c2260(0x1a9)])(_0x4d2e45,_0x442271);}catch(_0x1ec0ed){Sentry[_0x5c2260(0x19a)](_0x1ec0ed),logger_1[_0x5c2260(0x187)][_0x5c2260(0x174)](_0x5c2260(0x198),_0x1ec0ed[_0x5c2260(0x17c)]);throw _0x1ec0ed;}}function parseToMilliseconds(_0x560d1c){return _0x560d1c*0x3e8;}exports['parseToMilliseconds']=parseToMilliseconds;async function sleep(_0x1dc932){const _0x3e01b4=a307_0x2ea9fe;return logger_1[_0x3e01b4(0x187)][_0x3e01b4(0x140)]('Sleep\x20de\x20'+_0x1dc932+_0x3e01b4(0x114)+(0x0,moment_1[_0x3e01b4(0x13c)])()[_0x3e01b4(0x149)](_0x3e01b4(0x18d))),new Promise(_0x22e257=>{setTimeout(()=>{const _0x3e11b7=a307_0x2407;logger_1[_0x3e11b7(0x187)][_0x3e11b7(0x140)]('Sleep\x20de\x20'+_0x1dc932+_0x3e11b7(0x10f)+(0x0,moment_1[_0x3e11b7(0x13c)])()[_0x3e11b7(0x149)]('HH:mm:ss')),_0x22e257(!![]);},parseToMilliseconds(_0x1dc932));});}exports[a307_0x2ea9fe(0x137)]=sleep;function a307_0x3514(){const _0x520823=['CloseTicketsAutomatic','map','create','\x20failed\x20with\x20error:\x20','./services/WbotServices/wbotMessageListener','MessageQueue\x20->\x20SendMessage:\x20error','diff','captureException','reload','subtract','ScheduleMonitor','__setModuleDefault','companyId','./services/WbotServices/MarkDeleteWhatsAppMessage','status','queueMonitor','email','getQueue','handle\x20login','duration','randomValue','isArray','SendMessage','1688irBvJJ','@g.us','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','-ticket','QueueMonitor','\x20segundos\x20finalizado:\x20','CampaignQueue','isInteger','utc','./libs/wbot','\x20segundos\x20iniciado:\x20','./models/Company','toString','sendIdQueue','number','1447626nvYekj','sequelize','setHours','VerifyLoginStatus','REDIS_PORT','warn','getIO','findAll','name','Campo\x20update.status\x20ausente\x20ou\x20inválido:','writable','./helpers/SendMessage','7iqazva','./services/WbotServices/wbotClosedTickets','REDIS_PASSWORD','VerifyCampaigns','verify','3659605xcefeW','4XRFcLv','handleMessage','messageUpdate\x20não\x20é\x20um\x20array\x20válido:','asDays','./models/Ticket','__esModule','Sequelize','Error','messageUpdate','220cjPKoX','141eIcvPJ','Whatsapp\x20não\x20identificado','sleep','configurable','update','timeSendQueue','\x20completed','default','2122000ZleLxA','defineProperty','127.0.0.1','info','status@broadcast','floor','963shivtD','ClosedAllOpenTickets','Erro\x20ao\x20processar\x20mensagem:','VerifyQueueStatus','debug','contact','format','log','REDIS_HOST','company-','findAndCountAll','readMessages','generalMonitor','bullmq','Job\x20','getWbot','Atendimento\x20Perdido:\x20','\x20-\x20Empresa:\x20','scheduleMonitor','GeneralMonitor','MessageUpdateJob','verifyCampaignMessageAndCloseTicket','./models/Plan','VerifySchedules','minutes','findByPk','constructor','./models/Whatsapp','Iniciando\x20geração\x20de\x20boletos','extraInfo','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','handleMsgAck','messageQueue','@sentry/node','./workers/scheduledMessageJob','startQueueProcess','DD/MM/yyyy','completed','failed','MessageQueue','prototype','search','remoteJid','(((.+)+)+)+$','apply','userMonitor','value','HandleMessageJob','ID\x20da\x20mensagem\x20inválido:','error','moment','Processando\x20atualização\x20de\x20mensagem:','add','whatsappId','Iniciando\x20processamento\x20de\x20filas','messageStubType','pending','message','YYYY-MM-DD','./models/Contact','__importStar','ClosedAllOpenTickets\x20->\x20Verify:\x20error','env','getMinutes','1238796srZbKH','./utils/logger','profilePicUrl','Worker','logger','key','Queue','whatsapps','HANDLE\x20SEND\x20MESSAGE','verifyRecentCampaign','HH:mm:ss','8808AolBor','3727938MPkTEC','literal','InvoiceCreate','campaignQueue'];a307_0x3514=function(){return _0x520823;};return a307_0x3514();}function randomValue(_0x49e110,_0x3b24cf){const _0x22c684=a307_0x2ea9fe;return Math[_0x22c684(0x142)](Math['random']()*_0x3b24cf)+_0x49e110;}exports[a307_0x2ea9fe(0x1a7)]=randomValue;async function handleLoginStatus(){const _0x445ed1=a307_0x2ea9fe;console[_0x445ed1(0x14a)](_0x445ed1(0x1a5));const _0x5c02c7=new Date();_0x5c02c7['setMinutes'](_0x5c02c7[_0x445ed1(0x182)]()-0x5),await User_1[_0x445ed1(0x13c)][_0x445ed1(0x139)]({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x5c02c7},'online':!![]}});}async function handleInvoiceCreate(){const _0x58fb88=a307_0x2ea9fe;logger_1[_0x58fb88(0x187)]['info'](_0x58fb88(0x15f));const _0x421c2f=await Company_1[_0x58fb88(0x13c)][_0x58fb88(0x120)]({'where':{'status':!![]}});_0x421c2f[_0x58fb88(0x194)](async _0x4b048d=>{const _0x9efed9=_0x58fb88,{dueDate:_0x5d8afa}=_0x4b048d,_0x2a17c0=new Date(_0x5d8afa)['setHours'](0x0,0x0,0x0,0x0),_0x2dbc11=new Date(_0x5d8afa)[_0x9efed9(0x11b)](0x17,0x3b,0x3b,0x3e7),_0x50b50d=(0x0,moment_1['default'])((0x0,moment_1[_0x9efed9(0x13c)])())[_0x9efed9(0x149)](_0x9efed9(0x167)),_0x4aad8c=(0x0,moment_1[_0x9efed9(0x13c)])(_0x5d8afa)[_0x9efed9(0x149)](_0x9efed9(0x167)),_0x49405b=(0x0,moment_1[_0x9efed9(0x13c)])(_0x4aad8c,_0x9efed9(0x167))[_0x9efed9(0x199)]((0x0,moment_1['default'])(_0x50b50d,_0x9efed9(0x167))),_0xa692d4=moment_1['default'][_0x9efed9(0x1a6)](_0x49405b)[_0x9efed9(0x12e)]();if(_0xa692d4<0x14){const _0x1ea945=await Plan_1[_0x9efed9(0x13c)][_0x9efed9(0x15c)](_0x4b048d['planId']);let _0x2e5cc5=await Invoices_1[_0x9efed9(0x13c)]['count']({'where':{'companyId':_0x4b048d['id'],'dueDate':{[sequelize_1['Op']['like']]:(0x0,moment_1['default'])(_0x5d8afa)['format'](_0x9efed9(0x17d))}}});if(+_0x2e5cc5===0x0){const _0x238f49=(0x0,moment_1[_0x9efed9(0x13c)])()[_0x9efed9(0x149)]();await Invoices_1['default'][_0x9efed9(0x195)]({'detail':_0x1ea945['name'],'status':'open','value':_0x1ea945[_0x9efed9(0x171)],'updatedAt':_0x238f49,'createdAt':_0x238f49,'dueDate':(0x0,moment_1[_0x9efed9(0x13c)])(_0x5d8afa)[_0x9efed9(0x149)](_0x9efed9(0x17d)),'companyId':_0x4b048d['id']});}}});}async function startQueueProcess(){const _0x38e20a=a307_0x2ea9fe;logger_1[_0x38e20a(0x187)][_0x38e20a(0x140)](_0x38e20a(0x179)),await exports['userMonitor'][_0x38e20a(0x177)](_0x38e20a(0x11c),{},{'repeat':{'every':0xea60*0x5,'key':_0x38e20a(0x11c)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x1803c9=new bullmq_1[(_0x38e20a(0x186))](exports[_0x38e20a(0x170)][_0x38e20a(0x121)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x1803c9['on'](_0x38e20a(0x168),async _0x480314=>{const _0x31727d=_0x38e20a;logger_1[_0x31727d(0x187)][_0x31727d(0x140)](_0x31727d(0x151)+_0x480314[_0x31727d(0x121)]+_0x31727d(0x13b));}),await exports[_0x38e20a(0x14f)][_0x38e20a(0x177)](_0x38e20a(0x193),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':'CloseTicketsAutomatic'},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x38e20a(0x14f)][_0x38e20a(0x177)](_0x38e20a(0x191),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x38e20a(0x191)},'removeOnComplete':!![],'removeOnFail':!![]});const _0xf6a5ce=new bullmq_1['Worker'](exports[_0x38e20a(0x14f)][_0x38e20a(0x121)],async _0x3f408f=>{const _0x4b980c=_0x38e20a;if(_0x3f408f[_0x4b980c(0x121)]=='CloseTicketsAutomatic')await handleCloseTicketsAutomatic();else _0x3f408f[_0x4b980c(0x121)]==_0x4b980c(0x191)&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}}),_0x48ccac=campaignQueueManager['getCampaignQueue']();await _0x48ccac[_0x38e20a(0x177)](_0x38e20a(0x128),{},{'repeat':{'every':0x3c*0x3e8*0x1,'key':_0x38e20a(0x128)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports['campaignQueue'][_0x38e20a(0x177)](_0x38e20a(0x128),{},{'repeat':{'every':0x3c*0x3e8*0x1,'key':_0x38e20a(0x128)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x2a77e7=new bullmq_1[(_0x38e20a(0x186))](exports[_0x38e20a(0x163)][_0x38e20a(0x121)],async _0x4c9cdc=>{const _0x4ceb26=_0x38e20a;if(_0x4c9cdc['name']==_0x4ceb26(0x172))await handleMessageJob(_0x4c9cdc);else{if(_0x4c9cdc[_0x4ceb26(0x121)]==_0x4ceb26(0x157))await messageUpdateJob(_0x4c9cdc);else _0x4c9cdc[_0x4ceb26(0x121)]==_0x4ceb26(0x1a9)&&await handleSendMessage(_0x4c9cdc);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x2a77e7['on']('completed',async _0x46f99d=>{const _0x1c1d56=_0x38e20a;logger_1[_0x1c1d56(0x187)][_0x1c1d56(0x140)](_0x1c1d56(0x151)+_0x46f99d[_0x1c1d56(0x121)]+'\x20completed');}),_0x2a77e7['on'](_0x38e20a(0x169),async(_0x530a6c,_0x42591c)=>{const _0x454133=_0x38e20a;logger_1[_0x454133(0x187)][_0x454133(0x174)](_0x454133(0x151)+_0x530a6c[_0x454133(0x121)]+_0x454133(0x196)+_0x42591c['message']);}),await exports['queueMonitor'][_0x38e20a(0x177)]('VerifyQueueStatus',{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':_0x38e20a(0x146)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x28c039=new bullmq_1[(_0x38e20a(0x186))](exports[_0x38e20a(0x1a2)][_0x38e20a(0x121)],async _0x3cf145=>{const _0x19fa01=_0x38e20a;_0x3cf145['name']==_0x19fa01(0x146)&&await handleVerifyQueue(_0x3cf145);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x28c039['on'](_0x38e20a(0x168),async _0x37aaa8=>{const _0x100465=_0x38e20a;logger_1['logger']['info'](_0x100465(0x151)+_0x37aaa8['id']+_0x100465(0x13b));});let _0x336325=new scheduledMessageJob_1[(_0x38e20a(0x13c))](exports['scheduleMonitor'],connection);await _0x336325[_0x38e20a(0x1a4)]()[_0x38e20a(0x177)](_0x38e20a(0x15a),{},{'repeat':{'every':0xea60*0x5,'key':_0x38e20a(0x129)},'removeOnComplete':!![],'removeOnFail':!![]});}exports[a307_0x2ea9fe(0x166)]=startQueueProcess;