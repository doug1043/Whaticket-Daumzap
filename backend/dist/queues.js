const a308_0x1f780c=a308_0x2a31;(function(_0x204168,_0x2bb5cb){const _0x596db3=a308_0x2a31,_0x4bca7f=_0x204168();while(!![]){try{const _0x3476e8=-parseInt(_0x596db3(0x11b))/0x1+-parseInt(_0x596db3(0x109))/0x2+-parseInt(_0x596db3(0x103))/0x3*(-parseInt(_0x596db3(0x11a))/0x4)+-parseInt(_0x596db3(0x14c))/0x5*(parseInt(_0x596db3(0x113))/0x6)+-parseInt(_0x596db3(0xfa))/0x7+-parseInt(_0x596db3(0xff))/0x8+parseInt(_0x596db3(0x11c))/0x9*(parseInt(_0x596db3(0x176))/0xa);if(_0x3476e8===_0x2bb5cb)break;else _0x4bca7f['push'](_0x4bca7f['shift']());}catch(_0x78574a){_0x4bca7f['push'](_0x4bca7f['shift']());}}}(a308_0xf936,0xaeb9d));const a308_0x350884=(function(){let _0x4d2777=!![];return function(_0x2a9600,_0x3d681e){const _0x32b135=_0x4d2777?function(){if(_0x3d681e){const _0x2676d8=_0x3d681e['apply'](_0x2a9600,arguments);return _0x3d681e=null,_0x2676d8;}}:function(){};return _0x4d2777=![],_0x32b135;};}()),a308_0x422152=a308_0x350884(this,function(){const _0x1fb0e5=a308_0x2a31;return a308_0x422152[_0x1fb0e5(0x167)]()[_0x1fb0e5(0x15d)](_0x1fb0e5(0x140))[_0x1fb0e5(0x167)]()[_0x1fb0e5(0x110)](a308_0x422152)[_0x1fb0e5(0x15d)](_0x1fb0e5(0x140));});a308_0x422152();'use strict';var __createBinding=this&&this[a308_0x1f780c(0xed)]||(Object[a308_0x1f780c(0x104)]?function(_0x49ae4e,_0x421a85,_0x6afd2f,_0x27708a){const _0x2693de=a308_0x1f780c;if(_0x27708a===undefined)_0x27708a=_0x6afd2f;var _0x519c0a=Object[_0x2693de(0x14b)](_0x421a85,_0x6afd2f);(!_0x519c0a||(_0x2693de(0x155)in _0x519c0a?!_0x421a85[_0x2693de(0x125)]:_0x519c0a[_0x2693de(0x180)]||_0x519c0a[_0x2693de(0x153)]))&&(_0x519c0a={'enumerable':!![],'get':function(){return _0x421a85[_0x6afd2f];}}),Object['defineProperty'](_0x49ae4e,_0x27708a,_0x519c0a);}:function(_0x5682d6,_0x3fb5f0,_0x58d0c2,_0x1993d9){if(_0x1993d9===undefined)_0x1993d9=_0x58d0c2;_0x5682d6[_0x1993d9]=_0x3fb5f0[_0x58d0c2];}),__setModuleDefault=this&&this[a308_0x1f780c(0x15c)]||(Object[a308_0x1f780c(0x104)]?function(_0x254189,_0x4e4a52){const _0x5c673c=a308_0x1f780c;Object[_0x5c673c(0x17e)](_0x254189,_0x5c673c(0xec),{'enumerable':!![],'value':_0x4e4a52});}:function(_0x122262,_0x434968){const _0x31d369=a308_0x1f780c;_0x122262[_0x31d369(0xec)]=_0x434968;}),__importStar=this&&this[a308_0x1f780c(0x12e)]||function(_0x2c95b8){const _0x17fa3e=a308_0x1f780c;if(_0x2c95b8&&_0x2c95b8['__esModule'])return _0x2c95b8;var _0x1911b3={};if(_0x2c95b8!=null){for(var _0x1dd824 in _0x2c95b8)if(_0x1dd824!==_0x17fa3e(0xec)&&Object[_0x17fa3e(0x14f)]['hasOwnProperty']['call'](_0x2c95b8,_0x1dd824))__createBinding(_0x1911b3,_0x2c95b8,_0x1dd824);}return __setModuleDefault(_0x1911b3,_0x2c95b8),_0x1911b3;},__importDefault=this&&this['__importDefault']||function(_0x2b3aa3){const _0x448096=a308_0x1f780c;return _0x2b3aa3&&_0x2b3aa3[_0x448096(0x125)]?_0x2b3aa3:{'default':_0x2b3aa3};};Object[a308_0x1f780c(0x17e)](exports,'__esModule',{'value':!![]}),exports[a308_0x1f780c(0x15a)]=exports[a308_0x1f780c(0x130)]=exports[a308_0x1f780c(0x12a)]=exports['parseToMilliseconds']=exports[a308_0x1f780c(0x15f)]=exports['scheduleMonitor']=exports[a308_0x1f780c(0x112)]=exports[a308_0x1f780c(0x163)]=exports['generalMonitor']=exports['userMonitor']=void 0x0;const Sentry=__importStar(require('@sentry/node')),bullmq_1=require(a308_0x1f780c(0x141)),SendMessage_1=require(a308_0x1f780c(0xf5)),Whatsapp_1=__importDefault(require(a308_0x1f780c(0x161))),logger_1=require(a308_0x1f780c(0x146)),moment_1=__importDefault(require('moment')),Contact_1=__importDefault(require('./models/Contact')),sequelize_1=require(a308_0x1f780c(0x14e)),socket_1=require(a308_0x1f780c(0x118)),User_1=__importDefault(require(a308_0x1f780c(0x12b))),Company_1=__importDefault(require(a308_0x1f780c(0x152))),Plan_1=__importDefault(require(a308_0x1f780c(0x168))),Ticket_1=__importDefault(require(a308_0x1f780c(0x179))),wbotClosedTickets_1=require('./services/WbotServices/wbotClosedTickets'),Invoices_1=__importDefault(require(a308_0x1f780c(0xeb))),wbotMessageListener_1=require('./services/WbotServices/wbotMessageListener'),wbot_1=require('./libs/wbot'),MarkDeleteWhatsAppMessage_1=__importDefault(require(a308_0x1f780c(0x127))),ioredis_1=__importDefault(require('ioredis')),campaingJob_1=__importDefault(require('./workers/campaingJob')),scheduledMessageJob_1=__importDefault(require(a308_0x1f780c(0x173))),connection={'port':parseInt(process[a308_0x1f780c(0x16c)]['REDIS_PORT']),'host':process[a308_0x1f780c(0x16c)][a308_0x1f780c(0xfb)]||a308_0x1f780c(0x158),'password':process['env']['REDIS_PASSWORD']},limiterMax=process['env'][a308_0x1f780c(0x11d)]||0x1,limiterDuration=process[a308_0x1f780c(0x16c)]['REDIS_OPT_LIMITER_DURATION']||0xbb8,redis=new ioredis_1[(a308_0x1f780c(0xec))](process[a308_0x1f780c(0x16c)]['REDIS_URI']);function a308_0xf936(){const _0x4e4fb3=['prototype','random','getQueue','./models/Company','configurable','isInteger','get','messageStubType','literal','127.0.0.1','verifyCampaignMessageAndCloseTicket','startQueueProcess','QueueMonitor','__setModuleDefault','search','error','campaignQueue','verifyRecentCampaign','./models/Whatsapp','setHours','messageQueue','ClosedAllOpenTickets','minutes','DD/MM/yyyy','toString','./models/Plan','YYYY-MM-DD','subtract','reload','env','getMinutes','pending','CampaignQueue','parseToMilliseconds','Job\x20','ScheduleMonitor','./workers/scheduledMessageJob','Queue','status','2155950qphGck','captureException','Sequelize','./models/Ticket','UserMonitor','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','floor','add','defineProperty','CURRENT_DATE','writable','findAndCountAll','sendIdQueue','count','./models/Invoices','default','__createBinding','Whatsapp\x20não\x20identificado','CONNECTED','CloseTicketsAutomatic','format','emit','Worker','log','./helpers/SendMessage','Atendimento\x20Perdido:\x20','VerifyCampaigns','contact','duration','3809232VTTFVk','REDIS_HOST','company-','\x20failed\x20with\x20error:\x20','InvoiceCreate','7056328RRxDoX','scheduleMonitor','findByPk','findAll','15978IfBNde','create','whatsappId','HH:mm:ss','info','number','741282kFCWrS','ClosedAllOpenTickets\x20->\x20Verify:\x20error','\x20-\x20Empresa:\x20','endsWith','utc','key','like','constructor','VerifyQueueStatus','queueMonitor','1194dBfiZl','message','profilePicUrl','@g.us','handle\x20login','./libs/socket','\x20completed','148bRPsez','1239267FtFWxs','207qIyFTX','REDIS_OPT_LIMITER_MAX','userMonitor','Iniciando\x20geração\x20de\x20boletos','\x20segundos\x20iniciado:\x20','data','completed','extraInfo','open','__esModule','logger','./services/WbotServices/MarkDeleteWhatsAppMessage','companyId','status@broadcast','sleep','./models/User','email','MessageQueue','__importStar','getIO','randomValue','verify','name','VerifyLoginStatus','Sleep\x20de\x20','-notification','planId','\x20segundos\x20finalizado:\x20','Error','readMessages','update','diff','map','SearchForQueue\x20->\x20VerifyQueue:\x20error','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','whatsapps','(((.+)+)+)+$','bullmq','asDays','getWbot','remoteJid','generalMonitor','./utils/logger','timeSendQueue','-ticket','Iniciando\x20processamento\x20de\x20filas','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','getOwnPropertyDescriptor','35275qmGcFc','GeneralMonitor','sequelize'];a308_0xf936=function(){return _0x4e4fb3;};return a308_0xf936();}exports[a308_0x1f780c(0x11e)]=new bullmq_1[(a308_0x1f780c(0x174))](a308_0x1f780c(0x17a),{'connection':connection}),exports[a308_0x1f780c(0x145)]=new bullmq_1[(a308_0x1f780c(0x174))](a308_0x1f780c(0x14d),{'connection':connection}),exports[a308_0x1f780c(0x163)]=new bullmq_1[(a308_0x1f780c(0x174))](a308_0x1f780c(0x12d),{'connection':connection}),exports[a308_0x1f780c(0x112)]=new bullmq_1[(a308_0x1f780c(0x174))](a308_0x1f780c(0x15b),{'connection':connection}),exports['scheduleMonitor']=new bullmq_1[(a308_0x1f780c(0x174))](a308_0x1f780c(0x172),{'connection':connection}),exports['campaignQueue']=new bullmq_1['Queue'](a308_0x1f780c(0x16f),{'connection':connection});async function handleVerifyQueueOld(_0x625cd5){const _0x5c16bb=a308_0x1f780c;logger_1[_0x5c16bb(0x126)][_0x5c16bb(0x107)](_0x5c16bb(0x14a));try{const _0x394590=await Company_1[_0x5c16bb(0xec)][_0x5c16bb(0x102)]({'attributes':['id',_0x5c16bb(0x132)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x5c16bb(0x178)]['literal'](_0x5c16bb(0x17f))}},'include':[{'model':Whatsapp_1['default'],'attributes':['id','name',_0x5c16bb(0x175),_0x5c16bb(0x147),_0x5c16bb(0x182)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x394590[_0x5c16bb(0x13c)](async _0x4bc0a5=>{const _0x4389d2=_0x5c16bb;_0x4bc0a5[_0x4389d2(0x13f)][_0x4389d2(0x13c)](async _0x56aa05=>{const _0x3af74b=_0x4389d2;if(_0x56aa05[_0x3af74b(0x175)]==='CONNECTED'){var _0xa6099f=_0x4bc0a5['id'];const _0x38a1de=_0x56aa05[_0x3af74b(0x147)]?_0x56aa05[_0x3af74b(0x147)]:0x0,_0x1f9b79=_0x56aa05['sendIdQueue'],_0x531dba=_0x38a1de,_0x2cc964=_0x1f9b79,_0x3b6d48=_0x531dba;if(_0x38a1de>0x0){if(!isNaN(_0x2cc964)&&Number[_0x3af74b(0x154)](_0x2cc964)&&!isNaN(_0x3b6d48)&&Number[_0x3af74b(0x154)](_0x3b6d48)){const _0x3b0168=(0x0,moment_1['default'])()[_0x3af74b(0x16a)](_0x3b6d48,_0x3af74b(0x165))['utc']()['format'](),{count:_0x8ffe11,rows:_0x3134f8}=await Ticket_1[_0x3af74b(0xec)][_0x3af74b(0x181)]({'where':{'status':_0x3af74b(0x16e),'queueId':null,'companyId':_0xa6099f,'whatsappId':_0x56aa05['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x3b0168}},'include':[{'model':Contact_1[_0x3af74b(0xec)],'as':_0x3af74b(0xf8),'attributes':['id',_0x3af74b(0x132),_0x3af74b(0x108),'email',_0x3af74b(0x115)],'include':['extraInfo']}]});_0x8ffe11>0x0?_0x3134f8['map'](async _0x41f470=>{const _0x39acc0=_0x3af74b;await _0x41f470[_0x39acc0(0x13a)]({'queueId':_0x2cc964}),await _0x41f470[_0x39acc0(0x16b)]();const _0x42064d=(0x0,socket_1[_0x39acc0(0x12f)])();_0x42064d['to'](_0x39acc0(0xfc)+_0x41f470[_0x39acc0(0x128)]+'-'+_0x41f470['status'])['to']('company-'+_0x41f470[_0x39acc0(0x128)]+_0x39acc0(0x135))['to'](_0x41f470['id'][_0x39acc0(0x167)]())[_0x39acc0(0xf2)](_0x39acc0(0xfc)+_0xa6099f+'-ticket',{'action':'update','ticket':_0x41f470,'ticketId':_0x41f470['id']}),logger_1[_0x39acc0(0x126)][_0x39acc0(0x107)]('Atendimento\x20Perdido:\x20'+_0x41f470['id']+_0x39acc0(0x10b)+_0xa6099f);}):logger_1[_0x3af74b(0x126)][_0x3af74b(0x107)]('Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20'+_0xa6099f);}else logger_1[_0x3af74b(0x126)]['info'](_0x3af74b(0x17b)+_0xa6099f);}}});});}catch(_0x18d1eb){Sentry[_0x5c16bb(0x177)](_0x18d1eb),logger_1[_0x5c16bb(0x126)][_0x5c16bb(0x15e)](_0x5c16bb(0x13d)+_0x18d1eb);throw _0x18d1eb;}};async function handleVerifyQueue(_0x2aa3a0){const _0x4a3d99=a308_0x1f780c;logger_1['logger']['info'](_0x4a3d99(0x14a));try{const _0x5ca257=await Company_1[_0x4a3d99(0xec)]['findAll']({'attributes':['id',_0x4a3d99(0x132)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1['Sequelize'][_0x4a3d99(0x157)]('CURRENT_DATE')}},'include':[{'model':Whatsapp_1[_0x4a3d99(0xec)],'attributes':['id',_0x4a3d99(0x132),_0x4a3d99(0x175),_0x4a3d99(0x147),_0x4a3d99(0x182)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x5ca257[_0x4a3d99(0x13c)](async _0x27d97a=>{const _0x53c30d=_0x4a3d99;_0x27d97a[_0x53c30d(0x13f)][_0x53c30d(0x13c)](async _0x552239=>{const _0x179446=_0x53c30d;if(_0x552239[_0x179446(0x175)]===_0x179446(0xef)){const _0x48548d=_0x27d97a['id'],_0x109c83=_0x552239['timeSendQueue']?_0x552239[_0x179446(0x147)]:0x0,_0x352e78=_0x552239[_0x179446(0x182)],_0x3a12fc=_0x109c83,_0xadcbff=_0x352e78,_0x2837b1=_0x3a12fc;if(_0x109c83>0x0&&!isNaN(_0xadcbff)&&Number['isInteger'](_0xadcbff)&&!isNaN(_0x2837b1)&&Number[_0x179446(0x154)](_0x2837b1)){const _0x3c9fa4=(0x0,moment_1[_0x179446(0xec)])()[_0x179446(0x16a)](_0x2837b1,_0x179446(0x165))[_0x179446(0x10d)]()['format'](),{count:_0x59ca6c,rows:_0x37fe01}=await Ticket_1[_0x179446(0xec)]['findAndCountAll']({'where':{'status':'pending','queueId':null,'companyId':_0x48548d,'whatsappId':_0x552239['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x3c9fa4}},'include':[{'model':Contact_1[_0x179446(0xec)],'as':_0x179446(0xf8),'attributes':['id',_0x179446(0x132),_0x179446(0x108),_0x179446(0x12c),_0x179446(0x115)],'include':[_0x179446(0x123)]}]});_0x59ca6c>0x0?_0x37fe01[_0x179446(0x13c)](async _0x4b6bde=>{const _0x444715=_0x179446;await _0x4b6bde[_0x444715(0x13a)]({'queueId':_0xadcbff}),await _0x4b6bde[_0x444715(0x16b)]();const _0x53b74b=(0x0,socket_1[_0x444715(0x12f)])();_0x53b74b['to'](_0x444715(0xfc)+_0x4b6bde[_0x444715(0x128)]+'-'+_0x4b6bde[_0x444715(0x175)])['to']('company-'+_0x4b6bde[_0x444715(0x128)]+_0x444715(0x135))['to'](_0x4b6bde['id'][_0x444715(0x167)]())['emit'](_0x444715(0xfc)+_0x48548d+_0x444715(0x148),{'action':_0x444715(0x13a),'ticket':_0x4b6bde,'ticketId':_0x4b6bde['id']}),logger_1[_0x444715(0x126)][_0x444715(0x107)](_0x444715(0xf6)+_0x4b6bde['id']+_0x444715(0x10b)+_0x48548d);}):logger_1[_0x179446(0x126)][_0x179446(0x107)](_0x179446(0x13e)+_0x48548d);}else logger_1[_0x179446(0x126)][_0x179446(0x107)](_0x179446(0x17b)+_0x48548d);}});});}catch(_0x47af67){console['error'](_0x47af67);}}async function handleCloseTicketsAutomatic(){const _0x33464e=a308_0x1f780c,_0x2c9616=await Company_1['default']['findAll']({'where':{'status':!![]}});_0x2c9616[_0x33464e(0x13c)](async _0x4d3e41=>{const _0x248e80=_0x33464e;try{const _0x1dc203=_0x4d3e41['id'];await(0x0,wbotClosedTickets_1[_0x248e80(0x164)])(_0x1dc203);}catch(_0x5815d0){Sentry[_0x248e80(0x177)](_0x5815d0),logger_1[_0x248e80(0x126)]['error'](_0x248e80(0x10a),_0x5815d0[_0x248e80(0x114)]);throw _0x5815d0;}});}async function messageUpdateJob(_0x5eda75){const _0x5420f9=a308_0x1f780c,{data:_0x2c7291}=_0x5eda75;var _0x50ecfb=_0x2c7291['companyId'],_0x5852cf=_0x2c7291['messageUpdate'],_0x37a63b=_0x2c7291[_0x5420f9(0x105)];const _0x47baba=(0x0,wbot_1['getWbot'])(_0x2c7291[_0x5420f9(0x105)]);for(const _0x46b0ba of _0x5852cf){await _0x47baba[_0x5420f9(0x139)]([_0x46b0ba[_0x5420f9(0x10e)]]);const _0x54174b={..._0x5852cf};_0x54174b['0']?.[_0x5420f9(0x13a)][_0x5420f9(0x156)]===0x1&&_0x54174b['0']?.['key'][_0x5420f9(0x144)]!==_0x5420f9(0x129)&&await(0x0,MarkDeleteWhatsAppMessage_1[_0x5420f9(0xec)])(_0x54174b['0']?.[_0x5420f9(0x10e)]['remoteJid'],null,_0x54174b['0']?.[_0x5420f9(0x10e)]['id'],_0x50ecfb),await(0x0,wbotMessageListener_1['handleMsgAck'])(_0x46b0ba,_0x46b0ba[_0x5420f9(0x13a)][_0x5420f9(0x175)]);}}async function handleMessageJob(_0x24c5c5){const _0xecceda=a308_0x1f780c,{data:_0x35dbdf}=_0x24c5c5;var _0x4fe701=_0x35dbdf['messages'],_0x4b2b43=_0x35dbdf[_0xecceda(0x128)];const _0x1ac9d4=(0x0,wbot_1[_0xecceda(0x143)])(_0x35dbdf[_0xecceda(0x105)]);for(const _0x287fca of _0x4fe701){await(0x0,wbotMessageListener_1['handleMessage'])(_0x287fca,_0x1ac9d4,_0x4b2b43),await(0x0,wbotMessageListener_1[_0xecceda(0x160)])(_0x287fca,_0x4b2b43),await(0x0,wbotMessageListener_1[_0xecceda(0x159)])(_0x287fca,_0x4b2b43),_0x287fca[_0xecceda(0x10e)][_0xecceda(0x144)]?.[_0xecceda(0x10c)](_0xecceda(0x116))&&await(0x0,wbotMessageListener_1['handleMsgAck'])(_0x287fca,0x2);}}async function handleSendMessage(_0x4892d2){const _0x366531=a308_0x1f780c;console['log']('HANDLE\x20SEND\x20MESSAGE');try{const {data:_0x248e5a}=_0x4892d2,_0x1183a3=await Whatsapp_1['default'][_0x366531(0x101)](_0x248e5a[_0x366531(0x105)]);if(_0x1183a3==null)throw new sequelize_1[(_0x366531(0x138))](_0x366531(0xee));const _0x5ae819=_0x248e5a[_0x366531(0x121)];await(0x0,SendMessage_1['SendMessage'])(_0x1183a3,_0x5ae819);}catch(_0x57bf90){Sentry[_0x366531(0x177)](_0x57bf90),logger_1[_0x366531(0x126)][_0x366531(0x15e)]('MessageQueue\x20->\x20SendMessage:\x20error',_0x57bf90[_0x366531(0x114)]);throw _0x57bf90;}}function parseToMilliseconds(_0x578346){return _0x578346*0x3e8;}exports[a308_0x1f780c(0x170)]=parseToMilliseconds;async function sleep(_0x40957e){const _0x4821ec=a308_0x1f780c;return logger_1['logger'][_0x4821ec(0x107)]('Sleep\x20de\x20'+_0x40957e+_0x4821ec(0x120)+(0x0,moment_1[_0x4821ec(0xec)])()['format'](_0x4821ec(0x106))),new Promise(_0x5efcc0=>{setTimeout(()=>{const _0x1da88c=a308_0x2a31;logger_1['logger']['info'](_0x1da88c(0x134)+_0x40957e+_0x1da88c(0x137)+(0x0,moment_1[_0x1da88c(0xec)])()['format']('HH:mm:ss')),_0x5efcc0(!![]);},parseToMilliseconds(_0x40957e));});}exports['sleep']=sleep;function randomValue(_0x400304,_0x1019bf){const _0x3b0e85=a308_0x1f780c;return Math[_0x3b0e85(0x17c)](Math[_0x3b0e85(0x150)]()*_0x1019bf)+_0x400304;}exports[a308_0x1f780c(0x130)]=randomValue;async function handleLoginStatus(){const _0x5dc7da=a308_0x1f780c;console[_0x5dc7da(0xf4)](_0x5dc7da(0x117));const _0xe40d61=new Date();_0xe40d61['setMinutes'](_0xe40d61[_0x5dc7da(0x16d)]()-0x5),await User_1[_0x5dc7da(0xec)]['update']({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0xe40d61},'online':!![]}});}async function handleInvoiceCreate(){const _0x525873=a308_0x1f780c;logger_1[_0x525873(0x126)][_0x525873(0x107)](_0x525873(0x11f));const _0x413b36=await Company_1[_0x525873(0xec)]['findAll']({'where':{'status':!![]}});_0x413b36['map'](async _0x1f0698=>{const _0x2db146=_0x525873,{dueDate:_0x1d7b43}=_0x1f0698,_0x1b1a6d=new Date(_0x1d7b43)[_0x2db146(0x162)](0x0,0x0,0x0,0x0),_0xf3a0f3=new Date(_0x1d7b43)[_0x2db146(0x162)](0x17,0x3b,0x3b,0x3e7),_0x359d13=(0x0,moment_1[_0x2db146(0xec)])((0x0,moment_1[_0x2db146(0xec)])())['format'](_0x2db146(0x166)),_0x2f3765=(0x0,moment_1['default'])(_0x1d7b43)['format'](_0x2db146(0x166)),_0x208b34=(0x0,moment_1[_0x2db146(0xec)])(_0x2f3765,'DD/MM/yyyy')[_0x2db146(0x13b)]((0x0,moment_1['default'])(_0x359d13,_0x2db146(0x166))),_0x3568e1=moment_1[_0x2db146(0xec)][_0x2db146(0xf9)](_0x208b34)[_0x2db146(0x142)]();if(_0x3568e1<0x14){const _0x2d7e82=await Plan_1['default']['findByPk'](_0x1f0698[_0x2db146(0x136)]);let _0x2a5e52=await Invoices_1[_0x2db146(0xec)][_0x2db146(0xea)]({'where':{'companyId':_0x1f0698['id'],'dueDate':{[sequelize_1['Op'][_0x2db146(0x10f)]]:(0x0,moment_1['default'])(_0x1d7b43)[_0x2db146(0xf1)](_0x2db146(0x169))}}});if(+_0x2a5e52===0x0){const _0x2e593b=(0x0,moment_1['default'])()[_0x2db146(0xf1)]();await Invoices_1['default'][_0x2db146(0x104)]({'detail':_0x2d7e82['name'],'status':_0x2db146(0x124),'value':_0x2d7e82['value'],'updatedAt':_0x2e593b,'createdAt':_0x2e593b,'dueDate':(0x0,moment_1[_0x2db146(0xec)])(_0x1d7b43)[_0x2db146(0xf1)](_0x2db146(0x169)),'companyId':_0x1f0698['id']});}}});}async function startQueueProcess(){const _0x222aa6=a308_0x1f780c;logger_1[_0x222aa6(0x126)][_0x222aa6(0x107)](_0x222aa6(0x149)),await exports[_0x222aa6(0x11e)][_0x222aa6(0x17d)]('VerifyLoginStatus',{},{'repeat':{'every':0xea60*0x5,'key':_0x222aa6(0x133)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x19bb6c=new bullmq_1[(_0x222aa6(0xf3))](exports[_0x222aa6(0x11e)][_0x222aa6(0x132)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x19bb6c['on'](_0x222aa6(0x122),async _0x3ac331=>{const _0x235541=_0x222aa6;logger_1[_0x235541(0x126)][_0x235541(0x107)](_0x235541(0x171)+_0x3ac331[_0x235541(0x132)]+'\x20completed');}),await exports['generalMonitor'][_0x222aa6(0x17d)]('CloseTicketsAutomatic',{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x222aa6(0xf0)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports['generalMonitor'][_0x222aa6(0x17d)](_0x222aa6(0xfe),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x222aa6(0xfe)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x16f808=new bullmq_1[(_0x222aa6(0xf3))](exports['generalMonitor'][_0x222aa6(0x132)],async _0x1af8bd=>{const _0x2e656e=_0x222aa6;if(_0x1af8bd[_0x2e656e(0x132)]==_0x2e656e(0xf0))await handleCloseTicketsAutomatic();else _0x1af8bd[_0x2e656e(0x132)]==_0x2e656e(0xfe)&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}});await exports[_0x222aa6(0x15f)][_0x222aa6(0x17d)]('VerifyCampaigns',{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x222aa6(0xf7)},'removeOnComplete':!![],'removeOnFail':!![]}),new campaingJob_1['default'](exports[_0x222aa6(0x15f)][_0x222aa6(0x132)],connection);const _0x58e7ca=new bullmq_1[(_0x222aa6(0xf3))](exports[_0x222aa6(0x163)][_0x222aa6(0x132)],async _0x7fb303=>{const _0x3693e8=_0x222aa6;if(_0x7fb303[_0x3693e8(0x132)]=='HandleMessageJob')await handleMessageJob(_0x7fb303);else{if(_0x7fb303[_0x3693e8(0x132)]=='MessageUpdateJob')await messageUpdateJob(_0x7fb303);else _0x7fb303[_0x3693e8(0x132)]=='SendMessage'&&await handleSendMessage(_0x7fb303);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x58e7ca['on']('completed',async _0x25381b=>{const _0x487d65=_0x222aa6;logger_1[_0x487d65(0x126)]['info'](_0x487d65(0x171)+_0x25381b[_0x487d65(0x132)]+_0x487d65(0x119));}),_0x58e7ca['on']('failed',async(_0x4639a5,_0x401bb0)=>{const _0x30495f=_0x222aa6;logger_1['logger'][_0x30495f(0x15e)](_0x30495f(0x171)+_0x4639a5[_0x30495f(0x132)]+_0x30495f(0xfd)+_0x401bb0['message']);}),await exports['queueMonitor'][_0x222aa6(0x17d)](_0x222aa6(0x111),{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':_0x222aa6(0x111)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x31369e=new bullmq_1[(_0x222aa6(0xf3))](exports[_0x222aa6(0x112)]['name'],async _0x502c29=>{const _0x425905=_0x222aa6;_0x502c29[_0x425905(0x132)]==_0x425905(0x111)&&await handleVerifyQueue(_0x502c29);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x31369e['on']('completed',async _0x135a43=>{const _0x35beb8=_0x222aa6;logger_1[_0x35beb8(0x126)][_0x35beb8(0x107)](_0x35beb8(0x171)+_0x135a43['id']+_0x35beb8(0x119));});let _0x767f5a=new scheduledMessageJob_1[(_0x222aa6(0xec))](exports[_0x222aa6(0x100)],connection);await _0x767f5a[_0x222aa6(0x151)]()['add']('VerifySchedules',{},{'repeat':{'every':0xea60*0x5,'key':_0x222aa6(0x131)},'removeOnComplete':!![],'removeOnFail':!![]});}function a308_0x2a31(_0x40c71e,_0x459bef){const _0x546e65=a308_0xf936();return a308_0x2a31=function(_0x422152,_0x350884){_0x422152=_0x422152-0xea;let _0xf936ca=_0x546e65[_0x422152];return _0xf936ca;},a308_0x2a31(_0x40c71e,_0x459bef);}exports[a308_0x1f780c(0x15a)]=startQueueProcess;