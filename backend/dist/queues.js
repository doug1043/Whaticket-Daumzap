'use strict';const a345_0x2bebf7=a345_0x2f20;(function(_0xf594d9,_0x4e516c){const _0x8c5082=a345_0x2f20,_0x40f817=_0xf594d9();while(!![]){try{const _0x5a020b=-parseInt(_0x8c5082(0x262))/0x1+-parseInt(_0x8c5082(0x1de))/0x2*(parseInt(_0x8c5082(0x1d4))/0x3)+parseInt(_0x8c5082(0x1da))/0x4+-parseInt(_0x8c5082(0x1e4))/0x5*(parseInt(_0x8c5082(0x1a0))/0x6)+parseInt(_0x8c5082(0x266))/0x7+-parseInt(_0x8c5082(0x263))/0x8*(parseInt(_0x8c5082(0x1fd))/0x9)+-parseInt(_0x8c5082(0x21e))/0xa*(-parseInt(_0x8c5082(0x195))/0xb);if(_0x5a020b===_0x4e516c)break;else _0x40f817['push'](_0x40f817['shift']());}catch(_0x2d9c6a){_0x40f817['push'](_0x40f817['shift']());}}}(a345_0x3ae4,0xc718b));var __createBinding=this&&this[a345_0x2bebf7(0x27b)]||(Object['create']?function(_0x427869,_0x4857ab,_0x2544a6,_0x11c73f){const _0x44aff6=a345_0x2bebf7;if(_0x11c73f===undefined)_0x11c73f=_0x2544a6;var _0x321044=Object[_0x44aff6(0x199)](_0x4857ab,_0x2544a6);(!_0x321044||(_0x44aff6(0x23d)in _0x321044?!_0x4857ab[_0x44aff6(0x22f)]:_0x321044[_0x44aff6(0x25c)]||_0x321044[_0x44aff6(0x244)]))&&(_0x321044={'enumerable':!![],'get':function(){return _0x4857ab[_0x2544a6];}}),Object[_0x44aff6(0x190)](_0x427869,_0x11c73f,_0x321044);}:function(_0x224f9f,_0x269bc3,_0x1fdfeb,_0x838cb5){if(_0x838cb5===undefined)_0x838cb5=_0x1fdfeb;_0x224f9f[_0x838cb5]=_0x269bc3[_0x1fdfeb];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a345_0x2bebf7(0x1c3)]?function(_0x5b1269,_0x1e3b9e){const _0x2d5727=a345_0x2bebf7;Object[_0x2d5727(0x190)](_0x5b1269,_0x2d5727(0x208),{'enumerable':!![],'value':_0x1e3b9e});}:function(_0x3ecf6e,_0x46ae4a){const _0x2a66cc=a345_0x2bebf7;_0x3ecf6e[_0x2a66cc(0x208)]=_0x46ae4a;}),__importStar=this&&this[a345_0x2bebf7(0x1d9)]||(function(){const _0x124e39=(function(){let _0x131378=!![];return function(_0x4437a9,_0x2411db){const _0x2ef4cb=_0x131378?function(){const _0x243c52=a345_0x2f20;if(_0x2411db){const _0x39d0bd=_0x2411db[_0x243c52(0x228)](_0x4437a9,arguments);return _0x2411db=null,_0x39d0bd;}}:function(){};return _0x131378=![],_0x2ef4cb;};}()),_0x5a9629=_0x124e39(this,function(){const _0x5d6ee2=a345_0x2f20;return _0x5a9629[_0x5d6ee2(0x245)]()['search'](_0x5d6ee2(0x1af))[_0x5d6ee2(0x245)]()['constructor'](_0x5a9629)[_0x5d6ee2(0x1ee)]('(((.+)+)+)+$');});_0x5a9629();var _0x29fdcf=function(_0x501a2c){const _0x4cdc1f=a345_0x2f20;return _0x29fdcf=Object[_0x4cdc1f(0x202)]||function(_0x2e6976){const _0xb2219=_0x4cdc1f;var _0x113ec5=[];for(var _0x29e698 in _0x2e6976)if(Object['prototype'][_0xb2219(0x264)]['call'](_0x2e6976,_0x29e698))_0x113ec5[_0x113ec5[_0xb2219(0x239)]]=_0x29e698;return _0x113ec5;},_0x29fdcf(_0x501a2c);};return function(_0x49c00b){const _0x4a7dc8=a345_0x2f20;if(_0x49c00b&&_0x49c00b[_0x4a7dc8(0x22f)])return _0x49c00b;var _0x5dee5e={};if(_0x49c00b!=null){for(var _0x4a0466=_0x29fdcf(_0x49c00b),_0x3616f0=0x0;_0x3616f0<_0x4a0466[_0x4a7dc8(0x239)];_0x3616f0++)if(_0x4a0466[_0x3616f0]!==_0x4a7dc8(0x208))__createBinding(_0x5dee5e,_0x49c00b,_0x4a0466[_0x3616f0]);}return __setModuleDefault(_0x5dee5e,_0x49c00b),_0x5dee5e;};}()),__importDefault=this&&this['__importDefault']||function(_0x49bd54){return _0x49bd54&&_0x49bd54['__esModule']?_0x49bd54:{'default':_0x49bd54};};Object[a345_0x2bebf7(0x190)](exports,a345_0x2bebf7(0x22f),{'value':!![]}),exports[a345_0x2bebf7(0x250)]=exports['whatsappRestartQueue']=exports[a345_0x2bebf7(0x1c6)]=exports['ticketInactiveWarningQueue']=exports['sendScheduledMessages']=exports[a345_0x2bebf7(0x207)]=exports[a345_0x2bebf7(0x21b)]=exports[a345_0x2bebf7(0x1db)]=void 0x0,exports[a345_0x2bebf7(0x1ff)]=handleWhatsappAutoRestart,exports[a345_0x2bebf7(0x267)]=parseToMilliseconds,exports['sleep']=sleep,exports['randomValue']=randomValue,exports[a345_0x2bebf7(0x215)]=startQueueProcess;const Sentry=__importStar(require('@sentry/node')),bull_1=__importDefault(require(a345_0x2bebf7(0x1b8))),moment_1=__importDefault(require(a345_0x2bebf7(0x257))),sequelize_1=require(a345_0x2bebf7(0x23c)),lodash_1=require(a345_0x2bebf7(0x21c)),path_1=__importDefault(require(a345_0x2bebf7(0x1cc))),cron_1=require(a345_0x2bebf7(0x23f)),SendMessage_1=require(a345_0x2bebf7(0x24d)),Whatsapp_1=__importDefault(require(a345_0x2bebf7(0x261))),logger_1=require('./utils/logger'),Schedule_1=__importDefault(require(a345_0x2bebf7(0x20a))),Contact_1=__importDefault(require(a345_0x2bebf7(0x279))),GetDefaultWhatsApp_1=__importDefault(require(a345_0x2bebf7(0x220))),Campaign_1=__importDefault(require(a345_0x2bebf7(0x21d))),ContactList_1=__importDefault(require('./models/ContactList')),ContactListItem_1=__importDefault(require('./models/ContactListItem')),CampaignSetting_1=__importDefault(require(a345_0x2bebf7(0x1b5))),CampaignShipping_1=__importDefault(require(a345_0x2bebf7(0x1b2))),GetWhatsappWbot_1=__importDefault(require(a345_0x2bebf7(0x1ef))),database_1=__importDefault(require('./database')),SendWhatsAppMedia_1=require('./services/WbotServices/SendWhatsAppMedia'),socket_1=require('./libs/socket'),User_1=__importDefault(require(a345_0x2bebf7(0x221))),Company_1=__importDefault(require('./models/Company')),Plan_1=__importDefault(require(a345_0x2bebf7(0x1ce))),wbotMessageListener_1=require(a345_0x2bebf7(0x1d1)),ShowService_1=__importDefault(require('./services/CampaignService/ShowService')),Ticket_1=__importDefault(require('./models/Ticket')),SendWhatsAppMessage_1=__importDefault(require(a345_0x2bebf7(0x206))),wbot_1=require(a345_0x2bebf7(0x1f6)),StartWhatsAppSession_1=require(a345_0x2bebf7(0x1cb)),connection=process[a345_0x2bebf7(0x258)][a345_0x2bebf7(0x205)]||'',limiterMax=process[a345_0x2bebf7(0x258)][a345_0x2bebf7(0x1e7)]||0x1,limiterDuration=process[a345_0x2bebf7(0x258)][a345_0x2bebf7(0x1b1)]||0xbb8;exports[a345_0x2bebf7(0x1db)]=new bull_1['default'](a345_0x2bebf7(0x1bf),connection),exports[a345_0x2bebf7(0x21b)]=new bull_1[(a345_0x2bebf7(0x208))](a345_0x2bebf7(0x236),connection,{'limiter':{'max':limiterMax,'duration':limiterDuration}}),exports[a345_0x2bebf7(0x207)]=new bull_1['default'](a345_0x2bebf7(0x1bb),connection),exports[a345_0x2bebf7(0x24a)]=new bull_1[(a345_0x2bebf7(0x208))](a345_0x2bebf7(0x1fb),connection),exports[a345_0x2bebf7(0x1f0)]=new bull_1['default'](a345_0x2bebf7(0x1ec),connection);async function handleWhatsappAutoRestart(){const _0x5d19ae=a345_0x2bebf7;try{const _0x4b9e63=await Whatsapp_1[_0x5d19ae(0x208)][_0x5d19ae(0x218)]({'where':{'automaticRestart':!![],'status':_0x5d19ae(0x241)}}),_0x3d74d0=new Date();for(const _0x3c826e of _0x4b9e63){const _0x1fb549=_0x3c826e[_0x5d19ae(0x1c4)]||_0x3c826e[_0x5d19ae(0x256)]||_0x3c826e[_0x5d19ae(0x24e)];shouldRestart(_0x3d74d0,_0x1fb549,_0x3c826e['period'])&&(logger_1[_0x5d19ae(0x1ad)][_0x5d19ae(0x242)]('Reiniciando\x20conexão\x20WhatsApp\x20'+_0x3c826e[_0x5d19ae(0x274)]+_0x5d19ae(0x19f)+_0x3c826e['id']+_0x5d19ae(0x238)+_0x3c826e[_0x5d19ae(0x193)]+')'),await(0x0,wbot_1[_0x5d19ae(0x19c)])(_0x3c826e['id'],![]),await new Promise(_0x2b3fa8=>setTimeout(_0x2b3fa8,0xbb8)),await(0x0,StartWhatsAppSession_1[_0x5d19ae(0x272)])(_0x3c826e,_0x3c826e[_0x5d19ae(0x22a)]),await _0x3c826e[_0x5d19ae(0x27a)]({'lastRestartAt':new Date()}));}}catch(_0x46d158){logger_1[_0x5d19ae(0x1ad)][_0x5d19ae(0x1c8)]('Erro\x20ao\x20reiniciar\x20conexões\x20WhatsApp\x20periodicamente:\x20'+_0x46d158['message']);}}exports[a345_0x2bebf7(0x1c6)]=new bull_1['default'](a345_0x2bebf7(0x251),connection),exports[a345_0x2bebf7(0x25d)]=new bull_1[(a345_0x2bebf7(0x208))](a345_0x2bebf7(0x1f2),connection);function shouldRestart(_0x4a49a0,_0x454204,_0x3a31ec){const _0x57079b=a345_0x2bebf7;if(_0x3a31ec==='diariamente')return(0x0,moment_1[_0x57079b(0x208)])(_0x4a49a0)['diff']((0x0,moment_1[_0x57079b(0x208)])(_0x454204),'days')>=0x1;if(_0x3a31ec===_0x57079b(0x1ba))return(0x0,moment_1['default'])(_0x4a49a0)['diff']((0x0,moment_1['default'])(_0x454204),'weeks')>=0x1;if(_0x3a31ec===_0x57079b(0x210))return(0x0,moment_1[_0x57079b(0x208)])(_0x4a49a0)[_0x57079b(0x211)]((0x0,moment_1[_0x57079b(0x208)])(_0x454204),'months')>=0x1;return![];}async function handleVerifyTicketExpiration(){const _0x4f47e2=a345_0x2bebf7;try{const _0x51a0fd=await database_1[_0x4f47e2(0x208)][_0x4f47e2(0x25f)](_0x4f47e2(0x249),{'type':sequelize_1[_0x4f47e2(0x276)][_0x4f47e2(0x19d)]});for(const _0x3fb58a of _0x51a0fd){let _0xe544eb={};_0x3fb58a[_0x4f47e2(0x26f)]===_0x4f47e2(0x1f8)&&(_0xe544eb={'fromMe':!![]});if(_0x3fb58a['inactiveMessageTime']>0x0&&_0x3fb58a[_0x4f47e2(0x216)]){const _0x37570b=_0x3fb58a[_0x4f47e2(0x1f7)]-_0x3fb58a[_0x4f47e2(0x1be)];if(_0x37570b>0x0){const _0x26f8b3=await Ticket_1[_0x4f47e2(0x208)]['findAll']({'where':{'status':_0x4f47e2(0x20f),'whatsappId':_0x3fb58a['id'],'companyId':_0x3fb58a['companyId'],'ticketsWithWarning':![],..._0xe544eb,'updatedAt':{[sequelize_1['Op']['lt']]:(0x0,moment_1[_0x4f47e2(0x208)])()[_0x4f47e2(0x1a1)](_0x37570b,_0x4f47e2(0x237))['toDate'](),[sequelize_1['Op']['gt']]:(0x0,moment_1['default'])()[_0x4f47e2(0x1a1)](_0x3fb58a['expiresTicket'],_0x4f47e2(0x237))[_0x4f47e2(0x270)]()}},'include':[{'model':Contact_1['default'],'as':'contact'}]});for(const _0x34fc83 of _0x26f8b3){try{await(0x0,SendWhatsAppMessage_1[_0x4f47e2(0x208)])({'ticket':_0x34fc83,'body':_0x3fb58a[_0x4f47e2(0x216)]}),await Ticket_1['default'][_0x4f47e2(0x27a)]({'ticketsWithWarning':!![]},{'where':{'id':_0x34fc83['id']},'silent':!![]}),logger_1[_0x4f47e2(0x1ad)][_0x4f47e2(0x242)](_0x4f47e2(0x1cf)+_0x34fc83['id']);}catch(_0x45dbb0){Sentry[_0x4f47e2(0x22d)](_0x45dbb0),logger_1[_0x4f47e2(0x1ad)][_0x4f47e2(0x1c8)](_0x4f47e2(0x277)+_0x45dbb0[_0x4f47e2(0x1aa)]);}}}}const _0x4eaf25=await Ticket_1[_0x4f47e2(0x208)]['findAll']({'where':{'status':_0x4f47e2(0x20f),'whatsappId':_0x3fb58a['id'],'companyId':_0x3fb58a[_0x4f47e2(0x22a)],..._0xe544eb,'updatedAt':{[sequelize_1['Op']['lt']]:(0x0,moment_1[_0x4f47e2(0x208)])()[_0x4f47e2(0x1a1)](_0x3fb58a[_0x4f47e2(0x1f7)],_0x4f47e2(0x237))[_0x4f47e2(0x270)]()}},'include':[{'model':Contact_1[_0x4f47e2(0x208)],'as':_0x4f47e2(0x1c7)}]});for(const _0x880c79 of _0x4eaf25){try{_0x3fb58a[_0x4f47e2(0x1e1)]&&(await(0x0,SendWhatsAppMessage_1[_0x4f47e2(0x208)])({'ticket':_0x880c79,'body':_0x3fb58a['expiresInactiveMessage']}),await new Promise(_0x453ccf=>setTimeout(_0x453ccf,0x3e8)));await _0x880c79['update']({'status':_0x4f47e2(0x231),'amountUsedBotQueues':0x0,'ticketsWithWarning':![]});const _0x24dcf7=(0x0,socket_1[_0x4f47e2(0x1a2)])();_0x24dcf7['to'](_0x4f47e2(0x27c)+_0x880c79[_0x4f47e2(0x22a)]+_0x4f47e2(0x198))['to'](_0x4f47e2(0x253)+_0x880c79[_0x4f47e2(0x1fe)]+_0x4f47e2(0x198))[_0x4f47e2(0x19e)](_0x4f47e2(0x27c)+_0x880c79[_0x4f47e2(0x22a)]+'-ticket',{'action':_0x4f47e2(0x27a),'ticket':{..._0x880c79[_0x4f47e2(0x1d3)],'status':'closed'}}),_0x24dcf7['to'](_0x4f47e2(0x27c)+_0x880c79['companyId']+'-closed')['emit']('company-'+_0x880c79[_0x4f47e2(0x22a)]+_0x4f47e2(0x20e),{'action':_0x4f47e2(0x27a),'ticket':{..._0x880c79['dataValues'],'status':_0x4f47e2(0x231)}}),logger_1[_0x4f47e2(0x1ad)][_0x4f47e2(0x242)](_0x4f47e2(0x1a3)+_0x880c79['id']+_0x4f47e2(0x1ea)+_0x3fb58a['expiresTicket']+_0x4f47e2(0x25a));}catch(_0x878a43){Sentry['captureException'](_0x878a43),logger_1[_0x4f47e2(0x1ad)][_0x4f47e2(0x1c8)](_0x4f47e2(0x20c)+_0x878a43[_0x4f47e2(0x1aa)]);}}_0x4eaf25[_0x4f47e2(0x239)]>0x0&&logger_1[_0x4f47e2(0x1ad)][_0x4f47e2(0x242)](_0x4eaf25[_0x4f47e2(0x239)]+'\x20tickets\x20fechados\x20por\x20inatividade\x20para\x20a\x20empresa\x20'+_0x3fb58a[_0x4f47e2(0x22a)]);}}catch(_0x525dea){Sentry[_0x4f47e2(0x22d)](_0x525dea),logger_1[_0x4f47e2(0x1ad)]['error'](_0x4f47e2(0x191),_0x525dea['message']);}}function a345_0x2f20(_0x1a1e3c,_0x5a0c48){const _0x20a915=a345_0x3ae4();return a345_0x2f20=function(_0x5bd01a,_0x116a46){_0x5bd01a=_0x5bd01a-0x189;let _0x3ae4cd=_0x20a915[_0x5bd01a];return _0x3ae4cd;},a345_0x2f20(_0x1a1e3c,_0x5a0c48);}exports[a345_0x2bebf7(0x250)]=new bull_1[(a345_0x2bebf7(0x208))](a345_0x2bebf7(0x19b),connection);async function handleSendMessage(_0x3ad29b){const _0x3d1828=a345_0x2bebf7;try{const {data:_0x3458e7}=_0x3ad29b,_0x63ddf4=await Whatsapp_1['default'][_0x3d1828(0x275)](_0x3458e7['whatsappId']);if(_0x63ddf4==null)throw Error('Whatsapp\x20não\x20identificado');const _0x1d940f=_0x3458e7[_0x3d1828(0x213)];await(0x0,SendMessage_1[_0x3d1828(0x1d5)])(_0x63ddf4,_0x1d940f);}catch(_0x17375e){Sentry['captureException'](_0x17375e),logger_1[_0x3d1828(0x1ad)][_0x3d1828(0x1c8)]('MessageQueue\x20->\x20SendMessage:\x20error',_0x17375e[_0x3d1828(0x1aa)]);throw _0x17375e;}}async function handleVerifySchedules(){const _0xdabf88=a345_0x2bebf7;try{const {count:_0x4ce101,rows:_0x3ab338}=await Schedule_1['default'][_0xdabf88(0x247)]({'where':{'status':_0xdabf88(0x201),'sentAt':null,'sendAt':{[sequelize_1['Op'][_0xdabf88(0x1e3)]]:(0x0,moment_1['default'])()[_0xdabf88(0x25b)](_0xdabf88(0x226)),[sequelize_1['Op'][_0xdabf88(0x214)]]:(0x0,moment_1[_0xdabf88(0x208)])()['add']('30',_0xdabf88(0x22e))[_0xdabf88(0x25b)](_0xdabf88(0x226))}},'include':[{'model':Contact_1[_0xdabf88(0x208)],'as':'contact'}]});_0x4ce101>0x0&&_0x3ab338[_0xdabf88(0x27d)](async _0x16fca5=>{const _0x314604=_0xdabf88;await _0x16fca5[_0x314604(0x27a)]({'status':_0x314604(0x1c9)}),exports[_0x314604(0x24a)]['add'](_0x314604(0x1d5),{'schedule':_0x16fca5},{'delay':0x9c40}),logger_1[_0x314604(0x1ad)]['info'](_0x314604(0x23e)+_0x16fca5['contact'][_0x314604(0x274)]);});}catch(_0x10622a){Sentry['captureException'](_0x10622a),logger_1[_0xdabf88(0x1ad)][_0xdabf88(0x1c8)](_0xdabf88(0x1f1),_0x10622a[_0xdabf88(0x1aa)]);throw _0x10622a;}}async function handleSendScheduledMessage(_0x10b9d2){const _0x43671d=a345_0x2bebf7,{data:{schedule:_0x48a8f9}}=_0x10b9d2;let _0x2ae126=null;try{_0x2ae126=await Schedule_1[_0x43671d(0x208)][_0x43671d(0x275)](_0x48a8f9['id']);}catch(_0x577b51){Sentry[_0x43671d(0x22d)](_0x577b51),logger_1[_0x43671d(0x1ad)][_0x43671d(0x242)](_0x43671d(0x22c)+_0x48a8f9['id']);}try{const _0x22c86c=await(0x0,GetDefaultWhatsApp_1[_0x43671d(0x208)])(_0x48a8f9['companyId']),_0x170bed=await(0x0,SendMessage_1['SendMessage'])(_0x22c86c,{'number':_0x48a8f9['contact']['number'],'body':_0x48a8f9[_0x43671d(0x1eb)]});_0x48a8f9[_0x43671d(0x1b7)]&&(0x0,wbotMessageListener_1[_0x43671d(0x1ac)])(_0x170bed,await(0x0,GetWhatsappWbot_1[_0x43671d(0x208)])(_0x22c86c),_0x48a8f9[_0x43671d(0x22a)]),await _0x2ae126?.[_0x43671d(0x27a)]({'sentAt':new Date(),'status':_0x43671d(0x20d)}),logger_1[_0x43671d(0x1ad)][_0x43671d(0x242)](_0x43671d(0x1dd)+_0x48a8f9[_0x43671d(0x1c7)]['name']),exports['sendScheduledMessages'][_0x43671d(0x1dc)](0x3a98,_0x43671d(0x1fc));}catch(_0x3c5122){Sentry[_0x43671d(0x22d)](_0x3c5122),await _0x2ae126?.['update']({'status':_0x43671d(0x1d6)}),logger_1[_0x43671d(0x1ad)]['error'](_0x43671d(0x223),_0x3c5122[_0x43671d(0x1aa)]);throw _0x3c5122;}}async function handleVerifyCampaigns(){const _0x3d4916=a345_0x2bebf7,_0x29b9c1=await database_1['default'][_0x3d4916(0x25f)](_0x3d4916(0x1b6),{'type':sequelize_1[_0x3d4916(0x276)][_0x3d4916(0x19d)]});_0x29b9c1[_0x3d4916(0x239)]&&logger_1[_0x3d4916(0x1ad)][_0x3d4916(0x242)](_0x3d4916(0x21f)+_0x29b9c1['length']),_0x29b9c1[_0x3d4916(0x260)](_0x5d002e=>{const _0x4c8a1d=_0x3d4916;try{const _0x4cb5c0=(0x0,moment_1[_0x4c8a1d(0x208)])(),_0x55979a=(0x0,moment_1['default'])(_0x5d002e[_0x4c8a1d(0x196)]),_0x8f0475=_0x55979a[_0x4c8a1d(0x211)](_0x4cb5c0,_0x4c8a1d(0x24f));logger_1[_0x4c8a1d(0x1ad)]['info']('Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha='+_0x5d002e['id']+_0x4c8a1d(0x209)+_0x8f0475),exports[_0x4c8a1d(0x250)][_0x4c8a1d(0x212)](_0x4c8a1d(0x1bc),{'id':_0x5d002e['id'],'delay':_0x8f0475},{'removeOnComplete':!![]});}catch(_0x1066c9){Sentry[_0x4c8a1d(0x22d)](_0x1066c9);}});}async function getCampaign(_0x5a68b6){const _0x3d0cf8=a345_0x2bebf7;return Campaign_1['default'][_0x3d0cf8(0x275)](_0x5a68b6,{'include':[{'model':ContactList_1[_0x3d0cf8(0x208)],'as':_0x3d0cf8(0x1b0),'attributes':['id','name'],'include':[{'model':ContactListItem_1['default'],'as':_0x3d0cf8(0x18e),'attributes':['id','name',_0x3d0cf8(0x1c2),_0x3d0cf8(0x1e5),_0x3d0cf8(0x230)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1[_0x3d0cf8(0x208)],'as':_0x3d0cf8(0x1ab),'attributes':['id',_0x3d0cf8(0x274)]},{'model':CampaignShipping_1[_0x3d0cf8(0x208)],'as':_0x3d0cf8(0x1b3),'include':[{'model':ContactListItem_1[_0x3d0cf8(0x208)],'as':_0x3d0cf8(0x1c7)}]}]});}async function getSettings(_0x541934){const _0x36aeb7=a345_0x2bebf7,_0x3503a5=await CampaignSetting_1['default']['findAll']({'where':{'companyId':_0x541934[_0x36aeb7(0x22a)]},'attributes':['key',_0x36aeb7(0x1a7)]});let _0xdbbb15=0x14,_0x438163=0x14,_0x4e7bf6=0x3c,_0x160935=[];return _0x3503a5['forEach'](_0x5816ea=>{const _0x23efe5=_0x36aeb7;_0x5816ea[_0x23efe5(0x18a)]===_0x23efe5(0x243)&&(_0xdbbb15=JSON[_0x23efe5(0x18d)](_0x5816ea[_0x23efe5(0x1a7)])),_0x5816ea[_0x23efe5(0x18a)]===_0x23efe5(0x1ed)&&(_0x438163=JSON[_0x23efe5(0x18d)](_0x5816ea['value'])),_0x5816ea[_0x23efe5(0x18a)]===_0x23efe5(0x1e6)&&(_0x4e7bf6=JSON[_0x23efe5(0x18d)](_0x5816ea[_0x23efe5(0x1a7)])),_0x5816ea[_0x23efe5(0x18a)]===_0x23efe5(0x26d)&&(_0x160935=JSON[_0x23efe5(0x18d)](_0x5816ea[_0x23efe5(0x1a7)]));}),{'messageInterval':_0xdbbb15,'longerIntervalAfter':_0x438163,'greaterInterval':_0x4e7bf6,'variables':_0x160935};}function parseToMilliseconds(_0x4f1e37){return _0x4f1e37*0x3e8;}async function sleep(_0x3daeb5){const _0x4b25d5=a345_0x2bebf7;return logger_1['logger']['info'](_0x4b25d5(0x232)+_0x3daeb5+_0x4b25d5(0x18c)+(0x0,moment_1[_0x4b25d5(0x208)])()[_0x4b25d5(0x25b)](_0x4b25d5(0x192))),new Promise(_0x51752d=>{setTimeout(()=>{const _0x12cbdb=a345_0x2f20;logger_1['logger'][_0x12cbdb(0x242)](_0x12cbdb(0x232)+_0x3daeb5+_0x12cbdb(0x225)+(0x0,moment_1[_0x12cbdb(0x208)])()['format'](_0x12cbdb(0x192))),_0x51752d(!![]);},parseToMilliseconds(_0x3daeb5));});}function getCampaignValidMessages(_0x415e6c){const _0x41d853=a345_0x2bebf7,_0x6c2a5a=[];return!(0x0,lodash_1[_0x41d853(0x254)])(_0x415e6c[_0x41d853(0x1e9)])&&!(0x0,lodash_1['isNil'])(_0x415e6c[_0x41d853(0x1e9)])&&_0x6c2a5a[_0x41d853(0x203)](_0x415e6c[_0x41d853(0x1e9)]),!(0x0,lodash_1['isEmpty'])(_0x415e6c[_0x41d853(0x246)])&&!(0x0,lodash_1[_0x41d853(0x1c1)])(_0x415e6c[_0x41d853(0x246)])&&_0x6c2a5a[_0x41d853(0x203)](_0x415e6c[_0x41d853(0x246)]),!(0x0,lodash_1['isEmpty'])(_0x415e6c['message3'])&&!(0x0,lodash_1[_0x41d853(0x1c1)])(_0x415e6c[_0x41d853(0x1c5)])&&_0x6c2a5a['push'](_0x415e6c[_0x41d853(0x1c5)]),!(0x0,lodash_1['isEmpty'])(_0x415e6c[_0x41d853(0x252)])&&!(0x0,lodash_1['isNil'])(_0x415e6c[_0x41d853(0x252)])&&_0x6c2a5a[_0x41d853(0x203)](_0x415e6c[_0x41d853(0x252)]),!(0x0,lodash_1[_0x41d853(0x254)])(_0x415e6c[_0x41d853(0x271)])&&!(0x0,lodash_1[_0x41d853(0x1c1)])(_0x415e6c[_0x41d853(0x271)])&&_0x6c2a5a['push'](_0x415e6c[_0x41d853(0x271)]),_0x6c2a5a;}function getCampaignValidConfirmationMessages(_0x364c8b){const _0x426c4f=a345_0x2bebf7,_0x2cefe0=[];return!(0x0,lodash_1['isEmpty'])(_0x364c8b[_0x426c4f(0x19a)])&&!(0x0,lodash_1[_0x426c4f(0x1c1)])(_0x364c8b[_0x426c4f(0x19a)])&&_0x2cefe0['push'](_0x364c8b[_0x426c4f(0x19a)]),!(0x0,lodash_1[_0x426c4f(0x254)])(_0x364c8b[_0x426c4f(0x194)])&&!(0x0,lodash_1[_0x426c4f(0x1c1)])(_0x364c8b[_0x426c4f(0x194)])&&_0x2cefe0['push'](_0x364c8b[_0x426c4f(0x194)]),!(0x0,lodash_1[_0x426c4f(0x254)])(_0x364c8b[_0x426c4f(0x189)])&&!(0x0,lodash_1[_0x426c4f(0x1c1)])(_0x364c8b['confirmationMessage3'])&&_0x2cefe0[_0x426c4f(0x203)](_0x364c8b['confirmationMessage3']),!(0x0,lodash_1[_0x426c4f(0x254)])(_0x364c8b['confirmationMessage4'])&&!(0x0,lodash_1[_0x426c4f(0x1c1)])(_0x364c8b[_0x426c4f(0x217)])&&_0x2cefe0[_0x426c4f(0x203)](_0x364c8b[_0x426c4f(0x217)]),!(0x0,lodash_1[_0x426c4f(0x254)])(_0x364c8b[_0x426c4f(0x1a8)])&&!(0x0,lodash_1[_0x426c4f(0x1c1)])(_0x364c8b[_0x426c4f(0x1a8)])&&_0x2cefe0[_0x426c4f(0x203)](_0x364c8b[_0x426c4f(0x1a8)]),_0x2cefe0;}function getProcessedMessage(_0x2b9dca,_0x432c68,_0x5b2331){const _0x102cc3=a345_0x2bebf7;let _0x1f6cd6=_0x2b9dca;return _0x1f6cd6[_0x102cc3(0x26a)](_0x102cc3(0x222))&&(_0x1f6cd6=_0x1f6cd6[_0x102cc3(0x233)](/{nome}/g,_0x5b2331['name'])),_0x1f6cd6[_0x102cc3(0x26a)](_0x102cc3(0x219))&&(_0x1f6cd6=_0x1f6cd6[_0x102cc3(0x233)](/{email}/g,_0x5b2331['email'])),_0x1f6cd6[_0x102cc3(0x26a)](_0x102cc3(0x235))&&(_0x1f6cd6=_0x1f6cd6[_0x102cc3(0x233)](/{numero}/g,_0x5b2331[_0x102cc3(0x1c2)])),_0x432c68[_0x102cc3(0x260)](_0x4cc38a=>{const _0x31e51a=_0x102cc3;if(_0x1f6cd6['includes']('{'+_0x4cc38a[_0x31e51a(0x18a)]+'}')){const _0x3648b9=new RegExp('{'+_0x4cc38a[_0x31e51a(0x18a)]+'}','g');_0x1f6cd6=_0x1f6cd6[_0x31e51a(0x233)](_0x3648b9,_0x4cc38a[_0x31e51a(0x1a7)]);}}),_0x1f6cd6;}function randomValue(_0x3a37f9,_0x35fe77){return Math['floor'](Math['random']()*_0x35fe77)+_0x3a37f9;}async function verifyAndFinalizeCampaign(_0x24fe0e){const _0x2b2821=a345_0x2bebf7,_0xc201da=await(0x0,ShowService_1[_0x2b2821(0x208)])(_0x24fe0e['id']);_0xc201da[_0x2b2821(0x1f4)]===_0xc201da[_0x2b2821(0x269)]&&await _0x24fe0e[_0x2b2821(0x27a)]({'status':_0x2b2821(0x1ae),'completedAt':(0x0,moment_1['default'])()});const _0xbeb3eb=(0x0,socket_1[_0x2b2821(0x1a2)])();_0xbeb3eb[_0x2b2821(0x19e)]('company-'+_0x24fe0e[_0x2b2821(0x22a)]+_0x2b2821(0x23a),_0xc201da);}async function prepareContact(_0x49bf4b,_0x21d9c0,_0x14280d,_0x47ca03,_0x34d0a5,_0x32ec2c){const _0x2a2645=a345_0x2bebf7,_0x1892c3={};_0x1892c3[_0x2a2645(0x1c2)]=_0x14280d[_0x2a2645(0x1c2)],_0x1892c3[_0x2a2645(0x1df)]=_0x14280d['id'],_0x1892c3['campaignId']=_0x49bf4b['id'];if(_0x34d0a5['length']){const _0x6002f7=randomValue(0x0,_0x34d0a5[_0x2a2645(0x239)]),_0x2df2c5=getProcessedMessage(_0x34d0a5[_0x6002f7],_0x21d9c0,_0x14280d);_0x1892c3[_0x2a2645(0x1aa)]=''+_0x2df2c5;}if(_0x49bf4b['confirmation']){if(_0x32ec2c[_0x2a2645(0x239)]){const _0x9d8263=randomValue(0x0,_0x32ec2c[_0x2a2645(0x239)]),_0x1feccf=getProcessedMessage(_0x32ec2c[_0x9d8263],_0x21d9c0,_0x14280d);_0x1892c3['confirmationMessage']=''+_0x1feccf;}}const [_0x4abd41,_0x300c14]=await CampaignShipping_1[_0x2a2645(0x208)][_0x2a2645(0x1f5)]({'where':{'campaignId':_0x1892c3[_0x2a2645(0x22b)],'contactId':_0x1892c3[_0x2a2645(0x1df)]},'defaults':_0x1892c3});!_0x300c14&&_0x4abd41[_0x2a2645(0x259)]===null&&_0x4abd41[_0x2a2645(0x224)]===null&&(_0x4abd41[_0x2a2645(0x1a4)](_0x1892c3),await _0x4abd41[_0x2a2645(0x25e)]());if(_0x4abd41[_0x2a2645(0x259)]===null&&_0x4abd41['confirmationRequestedAt']===null){const _0x5f5cfa=await exports[_0x2a2645(0x250)][_0x2a2645(0x212)](_0x2a2645(0x1fa),{'campaignId':_0x49bf4b['id'],'campaignShippingId':_0x4abd41['id'],'contactListItemId':_0x14280d['id']},{'delay':_0x47ca03});await _0x4abd41['update']({'jobId':''+_0x5f5cfa['id']});}}async function handleProcessCampaign(_0x3f66f0){const _0x5af9ad=a345_0x2bebf7;try{const {id:_0x4136e1}=_0x3f66f0[_0x5af9ad(0x213)];let {delay:_0x502e88}=_0x3f66f0['data'];const _0x1abdaf=await getCampaign(_0x4136e1),_0x4f689b=await getSettings(_0x1abdaf);if(_0x1abdaf){const {contacts:_0x2f5f67}=_0x1abdaf[_0x5af9ad(0x1b0)],_0x54647f=getCampaignValidMessages(_0x1abdaf),_0x36d2c3=_0x1abdaf[_0x5af9ad(0x200)]?getCampaignValidConfirmationMessages(_0x1abdaf):null;if((0x0,lodash_1[_0x5af9ad(0x1f3)])(_0x2f5f67)){let _0x3be03a=0x0;_0x2f5f67[_0x5af9ad(0x260)](_0x1f0a36=>{const _0x29c4a8=_0x5af9ad;prepareContact(_0x1abdaf,_0x4f689b[_0x29c4a8(0x26d)],_0x1f0a36,_0x502e88,_0x54647f,_0x36d2c3)[_0x29c4a8(0x26c)](()=>{const _0x30a6dc=_0x29c4a8;logger_1[_0x30a6dc(0x1ad)][_0x30a6dc(0x242)](_0x30a6dc(0x1e2)+_0x1abdaf['id']+_0x30a6dc(0x1e0)+_0x1f0a36['name']+_0x30a6dc(0x204)+_0x502e88);}),_0x3be03a+=0x1,_0x3be03a%_0x4f689b[_0x29c4a8(0x1ed)]===0x0?_0x502e88+=parseToMilliseconds(_0x4f689b[_0x29c4a8(0x1e6)]):_0x502e88+=parseToMilliseconds(randomValue(0x0,_0x4f689b['messageInterval']));}),await _0x1abdaf[_0x5af9ad(0x27a)]({'status':_0x5af9ad(0x278)});}}}catch(_0x2563cf){Sentry['captureException'](_0x2563cf);}}async function handleDispatchCampaign(_0x5f49a9){const _0x1c1008=a345_0x2bebf7;try{const {data:_0x3bda65}=_0x5f49a9,{campaignShippingId:_0x1e5b22,campaignId:_0x300895}=_0x3bda65,_0x3627b2=await Campaign_1[_0x1c1008(0x208)]['findByPk'](_0x300895,{'include':[{'model':Whatsapp_1[_0x1c1008(0x208)],'as':_0x1c1008(0x1ab)}]});if(!_0x3627b2){logger_1['logger'][_0x1c1008(0x1c8)]({'data':_0x3bda65},_0x1c1008(0x1d2));return;}const _0xb9a30c=await(0x0,GetWhatsappWbot_1[_0x1c1008(0x208)])(_0x3627b2[_0x1c1008(0x1ab)]);logger_1['logger'][_0x1c1008(0x242)](_0x1c1008(0x21a)+_0x300895+_0x1c1008(0x1a5)+_0x1e5b22);const _0x3420e0=await CampaignShipping_1[_0x1c1008(0x208)][_0x1c1008(0x275)](_0x1e5b22,{'include':[{'model':ContactListItem_1[_0x1c1008(0x208)],'as':'contact'}]}),_0x5ba5d0=_0x3420e0['number']+_0x1c1008(0x234);if(_0x3627b2['confirmation']&&_0x3420e0[_0x1c1008(0x200)]===null)await _0xb9a30c['sendMessage'](_0x5ba5d0,{'text':_0x3420e0['confirmationMessage']}),await _0x3420e0[_0x1c1008(0x27a)]({'confirmationRequestedAt':(0x0,moment_1[_0x1c1008(0x208)])()});else{await _0xb9a30c[_0x1c1008(0x1e8)](_0x5ba5d0,{'text':_0x3420e0[_0x1c1008(0x1aa)]});if(_0x3627b2['mediaPath']){const _0x37616a=path_1[_0x1c1008(0x208)][_0x1c1008(0x197)]('public',_0x3627b2['mediaPath']),_0x11ffe6=await(0x0,SendWhatsAppMedia_1[_0x1c1008(0x268)])(_0x3627b2[_0x1c1008(0x18f)],_0x37616a);Object['keys'](_0x11ffe6)[_0x1c1008(0x239)]&&await _0xb9a30c[_0x1c1008(0x1e8)](_0x5ba5d0,{..._0x11ffe6});}await _0x3420e0[_0x1c1008(0x27a)]({'deliveredAt':(0x0,moment_1['default'])()});}await verifyAndFinalizeCampaign(_0x3627b2);const _0xd61d33=(0x0,socket_1['getIO'])();_0xd61d33[_0x1c1008(0x19e)](_0x1c1008(0x27c)+_0x3627b2[_0x1c1008(0x22a)]+'-campaign',{'action':_0x1c1008(0x27a),'record':_0x3627b2}),logger_1[_0x1c1008(0x1ad)][_0x1c1008(0x242)](_0x1c1008(0x1f9)+_0x300895+_0x1c1008(0x1e0)+_0x3420e0['contact']['name']);}catch(_0x501cf9){Sentry[_0x1c1008(0x22d)](_0x501cf9),logger_1[_0x1c1008(0x1ad)][_0x1c1008(0x1c8)](_0x501cf9[_0x1c1008(0x1aa)]);}}function a345_0x3ae4(){const _0xe43cf3=['saveMessage','bull','DD/MM/yyyy','semanalmente','ScheduleMonitor','ProcessCampaign','mycount','inactiveMessageTime','UserMonitor','INSERT\x20INTO\x20\x22Invoices\x22\x20(detail,\x20status,\x20value,\x20\x22updatedAt\x22,\x20\x22createdAt\x22,\x20\x22dueDate\x22,\x20\x22companyId\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(\x27','isNil','number','create','lastRestartAt','message3','ticketMonitor','contact','error','AGENDADA','start','./services/WbotServices/StartWhatsAppSession','path','VerifyLoginStatus','./models/Plan','Aviso\x20de\x20inatividade\x20enviado\x20para\x20o\x20ticket\x20#','VerifyTicketExpiration','./services/WbotServices/wbotMessageListener','Campaign\x20not\x20found','dataValues','30LBGVJE','SendMessage','ERRO','Iniciando\x20processamento\x20de\x20filas','CronJob','__importStar','884136joJVam','userMonitor','clean','Mensagem\x20agendada\x20enviada\x20para:\x20','27324tnsVlZ','contactId',';Contato=','expiresInactiveMessage','Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha=','gte','30jQdxlf','email','greaterInterval','REDIS_OPT_LIMITER_MAX','sendMessage','message1','\x20fechado\x20por\x20inatividade\x20após\x20','body','TicketInactiveWarning','longerIntervalAfter','search','./helpers/GetWhatsappWbot','ticketInactiveWarningQueue','SendScheduledMessage\x20->\x20Verify:\x20error','WhatsappRestartQueue','isArray','valids','findOrCreate','./libs/wbot','expiresTicket','agent','Campanha\x20enviada\x20para:\x20Campanha=','DispatchCampaign','SendSacheduledMessages','completed','2880369hJiWfE','queueId','handleWhatsappAutoRestart','confirmation','PENDENTE','getOwnPropertyNames','push',';Delay=','REDIS_URI','./services/WbotServices/SendWhatsAppMessage','scheduleMonitor','default',',\x20Delay\x20Inicial=','./models/Schedule','0\x20*\x20*\x20*\x20*','Erro\x20ao\x20fechar\x20ticket\x20por\x20inatividade:\x20','ENVIADA','-ticket','open','mensalmente','diff','add','data','lte','startQueueProcess','inactiveMessage','confirmationMessage4','findAll','{email}','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','messageQueue','lodash','./models/Campaign','2702580Jrkycn','Campanhas\x20encontradas:\x20','./helpers/GetDefaultWhatsApp','./models/User','{nome}','SendScheduledMessage\x20->\x20SendMessage:\x20error','confirmationRequestedAt','\x20segundos\x20finalizado:\x20','YYYY-MM-DD\x20HH:mm:ss','*/20\x20*\x20*\x20*\x20*\x20*','apply','process','companyId','campaignId','Erro\x20ao\x20tentar\x20consultar\x20agendamento:\x20','captureException','seconds','__esModule','isWhatsappValid','closed','Sleep\x20de\x20','replace','@s.whatsapp.net','{numero}','MessageQueue','minutes',')\x20de\x20acordo\x20com\x20o\x20período\x20(','length','-campaign','\x27,\x20\x27','sequelize','get','Disparo\x20agendado\x20para:\x20','cron','\x27,\x20','CONNECTED','info','messageInterval','configurable','toString','message2','findAndCountAll','planId','SELECT\x20id,\x20\x22expiresTicket\x22,\x20\x22companyId\x22,\x20\x22whenExpireTicket\x22,\x0a\x20\x20\x20\x22expiresInactiveMessage\x22,\x20\x22inactiveMessage\x22,\x20\x22inactiveMessageTime\x22\x0a\x20\x20\x20FROM\x20\x22Whatsapps\x22\x20WHERE\x20\x22expiresTicket\x22\x20>\x200','sendScheduledMessages','0\x20*\x20*\x20*\x20*\x20*','VerifyCampaignsDaatabase','./helpers/SendMessage','createdAt','milliseconds','campaignQueue','TicketMonitor','message4','queue-','isEmpty','Usuário\x20passado\x20para\x20offline:\x20','updatedAt','moment','env','deliveredAt','\x20minutos.','format','writable','whatsappRestartQueue','save','query','forEach','./models/Whatsapp','1380276PeTKFO','32ikONvk','hasOwnProperty','%\x27;','9162223XAvFiM','parseToMilliseconds','getMessageOptions','delivered','includes','\x27,\x20\x27open\x27,\x20\x27','then','variables','Verify','whenExpireTicket','toDate','message5','StartWhatsAppSession','DispatchConfirmedCampaign','name','findByPk','QueryTypes','Erro\x20ao\x20enviar\x20aviso\x20de\x20inatividade:\x20','EM_ANDAMENTO','./models/Contact','update','__createBinding','company-','map','confirmationMessage3','key','SELECT\x20COUNT(*)\x20mycount\x20FROM\x20\x22Invoices\x22\x20WHERE\x20\x22companyId\x22\x20=\x20','\x20segundos\x20iniciado:\x20','parse','contacts','mediaName','defineProperty','TicketMonitor\x20->\x20VerifyTicketExpiration:\x20erro','HH:mm:ss','period','confirmationMessage2','143OFGQIQ','scheduledAt','resolve','-open','getOwnPropertyDescriptor','confirmationMessage1','CampaignQueue','removeWbot','SELECT','emit','\x20(ID:\x20','1430718uGRRDG','subtract','getIO','Ticket\x20#','set',';Registro=','*\x20*\x20*\x20*\x20*','value','confirmationMessage5','*/5\x20*\x20*\x20*\x20*\x20*','message','whatsapp','handleMessage','logger','FINALIZADA','(((.+)+)+)+$','contactList','REDIS_OPT_LIMITER_DURATION','./models/CampaignShipping','shipping','AutoRestart','./models/CampaignSetting','select\x20id,\x20\x22scheduledAt\x22\x20from\x20\x22Campaigns\x22\x20c\x0a\x20\x20\x20\x20where\x20\x22scheduledAt\x22\x20between\x20now()\x20and\x20now()\x20+\x20\x271\x20hour\x27::interval\x20and\x20status\x20=\x20\x27PROGRAMADA\x27'];a345_0x3ae4=function(){return _0xe43cf3;};return a345_0x3ae4();}async function handleLoginStatus(){const _0x45c998=a345_0x2bebf7,_0x2e920d=await database_1['default']['query']('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x45c998(0x276)][_0x45c998(0x19d)]});_0x2e920d['forEach'](async _0x2478bc=>{const _0x2404f7=_0x45c998;try{const _0x91efd3=await User_1['default'][_0x2404f7(0x275)](_0x2478bc['id']);await _0x91efd3[_0x2404f7(0x27a)]({'online':![]}),logger_1[_0x2404f7(0x1ad)][_0x2404f7(0x242)](_0x2404f7(0x255)+_0x2478bc['id']);}catch(_0x29b42c){Sentry[_0x2404f7(0x22d)](_0x29b42c);}});}async function handleInvoiceCreate(){const _0x2e0b9c=a345_0x2bebf7,_0x303f50=new cron_1[(_0x2e0b9c(0x1d8))](_0x2e0b9c(0x24b),async()=>{const _0x11fbbd=_0x2e0b9c,_0x3cadb=await Company_1[_0x11fbbd(0x208)][_0x11fbbd(0x218)]();_0x3cadb[_0x11fbbd(0x27d)](async _0x3e41cb=>{const _0x1cf01d=_0x11fbbd,{dueDate:_0xd72e69}=_0x3e41cb,_0x1ae954=(0x0,moment_1['default'])(_0xd72e69)['format'](),_0x122ab2=(0x0,moment_1['default'])()[_0x1cf01d(0x25b)](),_0x1815a2=(0x0,moment_1['default'])((0x0,moment_1[_0x1cf01d(0x208)])())[_0x1cf01d(0x25b)](_0x1cf01d(0x1b9)),_0x3c8890=(0x0,moment_1['default'])(_0xd72e69)[_0x1cf01d(0x25b)]('DD/MM/yyyy'),_0x574a8d=(0x0,moment_1[_0x1cf01d(0x208)])(_0x3c8890,'DD/MM/yyyy')[_0x1cf01d(0x211)]((0x0,moment_1[_0x1cf01d(0x208)])(_0x1815a2,_0x1cf01d(0x1b9))),_0x5d4a5e=moment_1[_0x1cf01d(0x208)]['duration'](_0x574a8d)['asDays']();if(_0x5d4a5e<0x14){const _0x2bfb1f=await Plan_1[_0x1cf01d(0x208)][_0x1cf01d(0x275)](_0x3e41cb[_0x1cf01d(0x248)]),_0x895a1=_0x1cf01d(0x18b)+_0x3e41cb['id']+'\x20AND\x20\x22dueDate\x22::text\x20LIKE\x20\x27'+(0x0,moment_1[_0x1cf01d(0x208)])(_0xd72e69)[_0x1cf01d(0x25b)]('yyyy-MM-DD')+_0x1cf01d(0x265),_0x18b94f=await database_1['default'][_0x1cf01d(0x25f)](_0x895a1,{'type':sequelize_1['QueryTypes'][_0x1cf01d(0x19d)]});if(+_0x18b94f[0x0][_0x1cf01d(0x1bd)]===0x0){const _0x1f0137=_0x1cf01d(0x1c0)+_0x2bfb1f['name']+_0x1cf01d(0x26b)+_0x2bfb1f['value']+_0x1cf01d(0x23b)+_0x122ab2+_0x1cf01d(0x23b)+_0x122ab2+_0x1cf01d(0x23b)+_0x1ae954+_0x1cf01d(0x240)+_0x3e41cb['id']+');';await database_1['default']['query'](_0x1f0137,{'type':sequelize_1['QueryTypes']['INSERT']});}}});});_0x303f50[_0x2e0b9c(0x1ca)]();}handleInvoiceCreate();async function startQueueProcess(){const _0xdf4f51=a345_0x2bebf7;logger_1[_0xdf4f51(0x1ad)][_0xdf4f51(0x242)](_0xdf4f51(0x1d7)),exports[_0xdf4f51(0x21b)]['process'](_0xdf4f51(0x1d5),handleSendMessage),exports[_0xdf4f51(0x207)][_0xdf4f51(0x229)]('Verify',handleVerifySchedules),exports['sendScheduledMessages'][_0xdf4f51(0x229)](_0xdf4f51(0x1d5),handleSendScheduledMessage),exports['campaignQueue'][_0xdf4f51(0x229)](_0xdf4f51(0x24c),handleVerifyCampaigns),exports['campaignQueue'][_0xdf4f51(0x229)](_0xdf4f51(0x1bc),handleProcessCampaign),exports[_0xdf4f51(0x250)][_0xdf4f51(0x229)]('DispatchCampaign',handleDispatchCampaign),exports[_0xdf4f51(0x1db)][_0xdf4f51(0x229)](_0xdf4f51(0x1cd),handleLoginStatus),exports[_0xdf4f51(0x250)][_0xdf4f51(0x229)](_0xdf4f51(0x273),handleDispatchCampaign),exports[_0xdf4f51(0x1c6)][_0xdf4f51(0x229)](_0xdf4f51(0x1d0),handleVerifyTicketExpiration),exports[_0xdf4f51(0x25d)][_0xdf4f51(0x229)](_0xdf4f51(0x1b4),handleWhatsappAutoRestart),exports[_0xdf4f51(0x207)]['add'](_0xdf4f51(0x26e),{},{'repeat':{'cron':_0xdf4f51(0x1a9)},'removeOnComplete':!![]}),exports[_0xdf4f51(0x250)][_0xdf4f51(0x212)]('VerifyCampaignsDaatabase',{},{'repeat':{'cron':_0xdf4f51(0x227)},'removeOnComplete':!![]}),exports[_0xdf4f51(0x1db)]['add'](_0xdf4f51(0x1cd),{},{'repeat':{'cron':_0xdf4f51(0x1a6)},'removeOnComplete':!![]}),exports[_0xdf4f51(0x1c6)][_0xdf4f51(0x212)](_0xdf4f51(0x1d0),{},{'repeat':{'cron':_0xdf4f51(0x1a6)},'removeOnComplete':!![]}),exports[_0xdf4f51(0x25d)][_0xdf4f51(0x212)](_0xdf4f51(0x1b4),{},{'repeat':{'cron':_0xdf4f51(0x20b)},'removeOnComplete':!![]});}