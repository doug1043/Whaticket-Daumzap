const a309_0x38932e=a309_0x151a;(function(_0x3d0092,_0xae6211){const _0x52ff52=a309_0x151a,_0x376e3b=_0x3d0092();while(!![]){try{const _0x44cf77=-parseInt(_0x52ff52(0x225))/0x1*(-parseInt(_0x52ff52(0x23e))/0x2)+-parseInt(_0x52ff52(0x233))/0x3*(-parseInt(_0x52ff52(0x1fe))/0x4)+-parseInt(_0x52ff52(0x1ff))/0x5*(parseInt(_0x52ff52(0x1a8))/0x6)+-parseInt(_0x52ff52(0x1b7))/0x7*(-parseInt(_0x52ff52(0x234))/0x8)+parseInt(_0x52ff52(0x1de))/0x9*(-parseInt(_0x52ff52(0x1c0))/0xa)+parseInt(_0x52ff52(0x1f0))/0xb+-parseInt(_0x52ff52(0x1d7))/0xc*(parseInt(_0x52ff52(0x1d6))/0xd);if(_0x44cf77===_0xae6211)break;else _0x376e3b['push'](_0x376e3b['shift']());}catch(_0x676c20){_0x376e3b['push'](_0x376e3b['shift']());}}}(a309_0x31ed,0xa3c5a));const a309_0x54f4ed=(function(){let _0xe0d51c=!![];return function(_0x502f1c,_0x436bd1){const _0x55fcff=_0xe0d51c?function(){const _0x5bb6c2=a309_0x151a;if(_0x436bd1){const _0x3f5fa8=_0x436bd1[_0x5bb6c2(0x22e)](_0x502f1c,arguments);return _0x436bd1=null,_0x3f5fa8;}}:function(){};return _0xe0d51c=![],_0x55fcff;};}()),a309_0xc32780=a309_0x54f4ed(this,function(){const _0x4d5639=a309_0x151a;return a309_0xc32780['toString']()[_0x4d5639(0x208)](_0x4d5639(0x216))[_0x4d5639(0x224)]()['constructor'](a309_0xc32780)[_0x4d5639(0x208)](_0x4d5639(0x216));});a309_0xc32780();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a309_0x38932e(0x1dd)]?function(_0x16424d,_0x55982e,_0x1d6912,_0x38babf){const _0x59a96f=a309_0x38932e;if(_0x38babf===undefined)_0x38babf=_0x1d6912;var _0x16911b=Object[_0x59a96f(0x212)](_0x55982e,_0x1d6912);(!_0x16911b||(_0x59a96f(0x1f6)in _0x16911b?!_0x55982e['__esModule']:_0x16911b[_0x59a96f(0x1b4)]||_0x16911b[_0x59a96f(0x1af)]))&&(_0x16911b={'enumerable':!![],'get':function(){return _0x55982e[_0x1d6912];}}),Object[_0x59a96f(0x202)](_0x16424d,_0x38babf,_0x16911b);}:function(_0x42facd,_0x3b0696,_0x2bda8a,_0x3a295b){if(_0x3a295b===undefined)_0x3a295b=_0x2bda8a;_0x42facd[_0x3a295b]=_0x3b0696[_0x2bda8a];}),__setModuleDefault=this&&this[a309_0x38932e(0x1d8)]||(Object[a309_0x38932e(0x1dd)]?function(_0x251bbd,_0x194294){const _0x50c0da=a309_0x38932e;Object[_0x50c0da(0x202)](_0x251bbd,_0x50c0da(0x1f5),{'enumerable':!![],'value':_0x194294});}:function(_0x45e6e4,_0x434833){const _0x35f4b3=a309_0x38932e;_0x45e6e4[_0x35f4b3(0x1f5)]=_0x434833;}),__importStar=this&&this['__importStar']||function(_0x51b541){const _0xa5dec0=a309_0x38932e;if(_0x51b541&&_0x51b541[_0xa5dec0(0x1da)])return _0x51b541;var _0x56953f={};if(_0x51b541!=null){for(var _0x1e64ee in _0x51b541)if(_0x1e64ee!==_0xa5dec0(0x1f5)&&Object[_0xa5dec0(0x1ae)][_0xa5dec0(0x22a)]['call'](_0x51b541,_0x1e64ee))__createBinding(_0x56953f,_0x51b541,_0x1e64ee);}return __setModuleDefault(_0x56953f,_0x51b541),_0x56953f;},__importDefault=this&&this['__importDefault']||function(_0x3f0077){const _0x58a767=a309_0x38932e;return _0x3f0077&&_0x3f0077[_0x58a767(0x1da)]?_0x3f0077:{'default':_0x3f0077};};Object[a309_0x38932e(0x202)](exports,'__esModule',{'value':!![]}),exports[a309_0x38932e(0x241)]=exports[a309_0x38932e(0x20e)]=exports[a309_0x38932e(0x1fc)]=exports[a309_0x38932e(0x201)]=exports[a309_0x38932e(0x229)]=exports[a309_0x38932e(0x205)]=exports[a309_0x38932e(0x1ee)]=exports['messageQueue']=exports[a309_0x38932e(0x23b)]=exports[a309_0x38932e(0x1be)]=void 0x0;const Sentry=__importStar(require(a309_0x38932e(0x1ce))),bullmq_1=require('bullmq'),SendMessage_1=require(a309_0x38932e(0x1c6)),Whatsapp_1=__importDefault(require(a309_0x38932e(0x245))),logger_1=require(a309_0x38932e(0x215)),moment_1=__importDefault(require(a309_0x38932e(0x1e7))),Contact_1=__importDefault(require(a309_0x38932e(0x20f))),sequelize_1=require(a309_0x38932e(0x20a)),socket_1=require(a309_0x38932e(0x210)),User_1=__importDefault(require('./models/User')),Company_1=__importDefault(require('./models/Company')),Plan_1=__importDefault(require(a309_0x38932e(0x1b6))),Ticket_1=__importDefault(require(a309_0x38932e(0x213))),wbotClosedTickets_1=require('./services/WbotServices/wbotClosedTickets'),Invoices_1=__importDefault(require(a309_0x38932e(0x239))),wbotMessageListener_1=require('./services/WbotServices/wbotMessageListener'),wbot_1=require(a309_0x38932e(0x220)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a309_0x38932e(0x22f))),ioredis_1=__importDefault(require('ioredis')),campaingJob_1=__importDefault(require(a309_0x38932e(0x217))),scheduledMessageJob_1=__importDefault(require('./workers/scheduledMessageJob')),connection={'port':parseInt(process[a309_0x38932e(0x1a6)][a309_0x38932e(0x236)]),'host':process[a309_0x38932e(0x1a6)]['REDIS_HOST']||a309_0x38932e(0x22d),'password':process[a309_0x38932e(0x1a6)][a309_0x38932e(0x1ac)]},limiterMax=process[a309_0x38932e(0x1a6)][a309_0x38932e(0x1db)]||0x1,limiterDuration=process[a309_0x38932e(0x1a6)][a309_0x38932e(0x1f1)]||0xbb8,redis=new ioredis_1[(a309_0x38932e(0x1f5))](process[a309_0x38932e(0x1a6)][a309_0x38932e(0x1fa)]);exports[a309_0x38932e(0x1be)]=new bullmq_1[(a309_0x38932e(0x221))](a309_0x38932e(0x20c),{'connection':connection}),exports[a309_0x38932e(0x23b)]=new bullmq_1[(a309_0x38932e(0x221))](a309_0x38932e(0x203),{'connection':connection}),exports[a309_0x38932e(0x1cb)]=new bullmq_1[(a309_0x38932e(0x221))]('MessageQueue',{'connection':connection}),exports[a309_0x38932e(0x1ee)]=new bullmq_1[(a309_0x38932e(0x221))](a309_0x38932e(0x1df),{'connection':connection}),exports[a309_0x38932e(0x205)]=new bullmq_1['Queue']('ScheduleMonitor',{'connection':connection}),exports[a309_0x38932e(0x229)]=new bullmq_1['Queue'](a309_0x38932e(0x23c),{'connection':connection});async function handleVerifyQueueOld(_0x3b6428){const _0x25b1c2=a309_0x38932e;logger_1[_0x25b1c2(0x1d5)][_0x25b1c2(0x232)](_0x25b1c2(0x1cf));try{const _0x5a5950=await Company_1[_0x25b1c2(0x1f5)][_0x25b1c2(0x1e6)]({'attributes':['id',_0x25b1c2(0x238)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x25b1c2(0x21a)]['literal'](_0x25b1c2(0x214))}},'include':[{'model':Whatsapp_1['default'],'attributes':['id',_0x25b1c2(0x238),'status',_0x25b1c2(0x218),_0x25b1c2(0x1a9)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x5a5950[_0x25b1c2(0x1fb)](async _0xa6b67d=>{const _0x495e72=_0x25b1c2;_0xa6b67d[_0x495e72(0x230)][_0x495e72(0x1fb)](async _0x24f7c5=>{const _0x14acf6=_0x495e72;if(_0x24f7c5['status']===_0x14acf6(0x223)){var _0x298853=_0xa6b67d['id'];const _0x303aca=_0x24f7c5[_0x14acf6(0x218)]?_0x24f7c5[_0x14acf6(0x218)]:0x0,_0x4e1681=_0x24f7c5[_0x14acf6(0x1a9)],_0x979baa=_0x303aca,_0x447015=_0x4e1681,_0x3ec4e8=_0x979baa;if(_0x303aca>0x0){if(!isNaN(_0x447015)&&Number[_0x14acf6(0x1bb)](_0x447015)&&!isNaN(_0x3ec4e8)&&Number[_0x14acf6(0x1bb)](_0x3ec4e8)){const _0x3b8e22=(0x0,moment_1[_0x14acf6(0x1f5)])()[_0x14acf6(0x1ef)](_0x3ec4e8,_0x14acf6(0x1f8))[_0x14acf6(0x1d4)]()[_0x14acf6(0x247)](),{count:_0x50b48e,rows:_0x20aa80}=await Ticket_1[_0x14acf6(0x1f5)]['findAndCountAll']({'where':{'status':_0x14acf6(0x1aa),'queueId':null,'companyId':_0x298853,'whatsappId':_0x24f7c5['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x3b8e22}},'include':[{'model':Contact_1[_0x14acf6(0x1f5)],'as':_0x14acf6(0x1ed),'attributes':['id','name',_0x14acf6(0x1b9),_0x14acf6(0x1f7),_0x14acf6(0x1b3)],'include':[_0x14acf6(0x200)]}]});_0x50b48e>0x0?_0x20aa80[_0x14acf6(0x1fb)](async _0x52c30d=>{const _0x37c70c=_0x14acf6;await _0x52c30d['update']({'queueId':_0x447015}),await _0x52c30d[_0x37c70c(0x1e5)]();const _0xa1e0f2=(0x0,socket_1[_0x37c70c(0x21e)])();_0xa1e0f2['to'](_0x37c70c(0x243)+_0x52c30d[_0x37c70c(0x20b)]+'-'+_0x52c30d['status'])['to']('company-'+_0x52c30d['companyId']+'-notification')['to'](_0x52c30d['id']['toString']())[_0x37c70c(0x235)](_0x37c70c(0x243)+_0x298853+_0x37c70c(0x1d0),{'action':'update','ticket':_0x52c30d,'ticketId':_0x52c30d['id']}),logger_1[_0x37c70c(0x1d5)]['info'](_0x37c70c(0x1e9)+_0x52c30d['id']+_0x37c70c(0x222)+_0x298853);}):logger_1['logger'][_0x14acf6(0x232)](_0x14acf6(0x21c)+_0x298853);}else logger_1[_0x14acf6(0x1d5)]['info'](_0x14acf6(0x21d)+_0x298853);}}});});}catch(_0x34b9cd){Sentry[_0x25b1c2(0x1b2)](_0x34b9cd),logger_1[_0x25b1c2(0x1d5)][_0x25b1c2(0x1d2)](_0x25b1c2(0x1b5)+_0x34b9cd);throw _0x34b9cd;}};async function handleVerifyQueue(_0xbb59ec){const _0x5a4b90=a309_0x38932e;logger_1[_0x5a4b90(0x1d5)][_0x5a4b90(0x232)](_0x5a4b90(0x1cf));try{const _0x53a909=await Company_1[_0x5a4b90(0x1f5)][_0x5a4b90(0x1e6)]({'attributes':['id','name'],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x5a4b90(0x21a)][_0x5a4b90(0x226)](_0x5a4b90(0x214))}},'include':[{'model':Whatsapp_1[_0x5a4b90(0x1f5)],'attributes':['id','name',_0x5a4b90(0x1bf),_0x5a4b90(0x218),_0x5a4b90(0x1a9)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x53a909['map'](async _0x2a272b=>{const _0x4ef282=_0x5a4b90;_0x2a272b['whatsapps'][_0x4ef282(0x1fb)](async _0x4e2f2b=>{const _0x46dcdb=_0x4ef282;if(_0x4e2f2b['status']===_0x46dcdb(0x223)){const _0x2dbd35=_0x2a272b['id'],_0x500ca6=_0x4e2f2b[_0x46dcdb(0x218)]?_0x4e2f2b[_0x46dcdb(0x218)]:0x0,_0x260dcd=_0x4e2f2b['sendIdQueue'],_0x404e45=_0x500ca6,_0x59ad6b=_0x260dcd,_0x8642c3=_0x404e45;if(_0x500ca6>0x0&&!isNaN(_0x59ad6b)&&Number[_0x46dcdb(0x1bb)](_0x59ad6b)&&!isNaN(_0x8642c3)&&Number['isInteger'](_0x8642c3)){const _0x1bc272=(0x0,moment_1[_0x46dcdb(0x1f5)])()[_0x46dcdb(0x1ef)](_0x8642c3,'minutes')[_0x46dcdb(0x1d4)]()[_0x46dcdb(0x247)](),{count:_0x47488d,rows:_0x2ee86a}=await Ticket_1[_0x46dcdb(0x1f5)][_0x46dcdb(0x1cd)]({'where':{'status':_0x46dcdb(0x1aa),'queueId':null,'companyId':_0x2dbd35,'whatsappId':_0x4e2f2b['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x1bc272}},'include':[{'model':Contact_1['default'],'as':'contact','attributes':['id',_0x46dcdb(0x238),_0x46dcdb(0x1b9),_0x46dcdb(0x1f7),'profilePicUrl'],'include':['extraInfo']}]});_0x47488d>0x0?_0x2ee86a['map'](async _0x497909=>{const _0x3b023d=_0x46dcdb;await _0x497909[_0x3b023d(0x244)]({'queueId':_0x59ad6b}),await _0x497909[_0x3b023d(0x1e5)]();const _0x4bbffe=(0x0,socket_1[_0x3b023d(0x21e)])();_0x4bbffe['to'](_0x3b023d(0x243)+_0x497909[_0x3b023d(0x20b)]+'-'+_0x497909['status'])['to']('company-'+_0x497909['companyId']+_0x3b023d(0x1b1))['to'](_0x497909['id'][_0x3b023d(0x224)]())[_0x3b023d(0x235)](_0x3b023d(0x243)+_0x2dbd35+_0x3b023d(0x1d0),{'action':'update','ticket':_0x497909,'ticketId':_0x497909['id']}),logger_1[_0x3b023d(0x1d5)][_0x3b023d(0x232)]('Atendimento\x20Perdido:\x20'+_0x497909['id']+_0x3b023d(0x222)+_0x2dbd35);}):logger_1[_0x46dcdb(0x1d5)][_0x46dcdb(0x232)](_0x46dcdb(0x21c)+_0x2dbd35);}else logger_1[_0x46dcdb(0x1d5)][_0x46dcdb(0x232)](_0x46dcdb(0x21d)+_0x2dbd35);}});});}catch(_0x2220cd){console[_0x5a4b90(0x1d2)](_0x2220cd);}}async function handleCloseTicketsAutomatic(){const _0x30ab0b=a309_0x38932e,_0x2ad062=await Company_1[_0x30ab0b(0x1f5)][_0x30ab0b(0x1e6)]({'where':{'status':!![]}});_0x2ad062['map'](async _0x1ceebb=>{const _0x4e8ac0=_0x30ab0b;try{const _0x183a22=_0x1ceebb['id'];await(0x0,wbotClosedTickets_1[_0x4e8ac0(0x1bc)])(_0x183a22);}catch(_0x57772d){Sentry[_0x4e8ac0(0x1b2)](_0x57772d),logger_1[_0x4e8ac0(0x1d5)][_0x4e8ac0(0x1d2)](_0x4e8ac0(0x1e4),_0x57772d[_0x4e8ac0(0x23a)]);throw _0x57772d;}});}async function messageUpdateJob(_0x1d259e){const _0x5f1baf=a309_0x38932e,{data:_0x4e6e40}=_0x1d259e;var _0x2bbe88=_0x4e6e40[_0x5f1baf(0x20b)],_0x5a5b0f=_0x4e6e40['messageUpdate'],_0x4dcc48=_0x4e6e40[_0x5f1baf(0x23f)];const _0x218a37=(0x0,wbot_1[_0x5f1baf(0x206)])(_0x4e6e40[_0x5f1baf(0x23f)]);for(const _0x69b098 of _0x5a5b0f){await _0x218a37[_0x5f1baf(0x1e1)]([_0x69b098[_0x5f1baf(0x1b8)]]);const _0x3caf4a={..._0x5a5b0f};_0x3caf4a['0']?.[_0x5f1baf(0x244)][_0x5f1baf(0x1c3)]===0x1&&_0x3caf4a['0']?.[_0x5f1baf(0x1b8)][_0x5f1baf(0x1c9)]!==_0x5f1baf(0x23d)&&await(0x0,MarkDeleteWhatsAppMessage_1[_0x5f1baf(0x1f5)])(_0x3caf4a['0']?.[_0x5f1baf(0x1b8)][_0x5f1baf(0x1c9)],null,_0x3caf4a['0']?.[_0x5f1baf(0x1b8)]['id'],_0x2bbe88),await(0x0,wbotMessageListener_1[_0x5f1baf(0x1b0)])(_0x69b098,_0x69b098[_0x5f1baf(0x244)][_0x5f1baf(0x1bf)]);}}async function handleMessageJob(_0x411957){const _0x56d742=a309_0x38932e,{data:_0x56a33f}=_0x411957;var _0xc04f02=_0x56a33f['messages'],_0x235396=_0x56a33f['companyId'];const _0x21abe4=(0x0,wbot_1[_0x56d742(0x206)])(_0x56a33f[_0x56d742(0x23f)]);for(const _0x256ff4 of _0xc04f02){await(0x0,wbotMessageListener_1[_0x56d742(0x227)])(_0x256ff4,_0x21abe4,_0x235396),await(0x0,wbotMessageListener_1[_0x56d742(0x1e2)])(_0x256ff4,_0x235396),await(0x0,wbotMessageListener_1[_0x56d742(0x1c4)])(_0x256ff4,_0x235396),_0x256ff4[_0x56d742(0x1b8)]['remoteJid']?.[_0x56d742(0x1c2)]('@g.us')&&await(0x0,wbotMessageListener_1[_0x56d742(0x1b0)])(_0x256ff4,0x2);}}async function handleSendMessage(_0x1ac42b){const _0x3b7e8e=a309_0x38932e;console[_0x3b7e8e(0x1d3)]('HANDLE\x20SEND\x20MESSAGE');try{const {data:_0x547656}=_0x1ac42b,_0x5ca141=await Whatsapp_1[_0x3b7e8e(0x1f5)][_0x3b7e8e(0x1f3)](_0x547656[_0x3b7e8e(0x23f)]);if(_0x5ca141==null)throw new sequelize_1['Error'](_0x3b7e8e(0x21b));const _0x7685fe=_0x547656['data'];await(0x0,SendMessage_1['SendMessage'])(_0x5ca141,_0x7685fe);}catch(_0x3c5843){Sentry['captureException'](_0x3c5843),logger_1[_0x3b7e8e(0x1d5)][_0x3b7e8e(0x1d2)](_0x3b7e8e(0x1fd),_0x3c5843['message']);throw _0x3c5843;}}function parseToMilliseconds(_0x5e811d){return _0x5e811d*0x3e8;}exports['parseToMilliseconds']=parseToMilliseconds;async function sleep(_0x16c6f8){const _0x3d5de7=a309_0x38932e;return logger_1[_0x3d5de7(0x1d5)]['info'](_0x3d5de7(0x1c1)+_0x16c6f8+_0x3d5de7(0x207)+(0x0,moment_1[_0x3d5de7(0x1f5)])()[_0x3d5de7(0x247)]('HH:mm:ss')),new Promise(_0x3fe667=>{setTimeout(()=>{const _0x4bd2a9=a309_0x151a;logger_1[_0x4bd2a9(0x1d5)][_0x4bd2a9(0x232)](_0x4bd2a9(0x1c1)+_0x16c6f8+_0x4bd2a9(0x1ad)+(0x0,moment_1[_0x4bd2a9(0x1f5)])()['format'](_0x4bd2a9(0x1e3))),_0x3fe667(!![]);},parseToMilliseconds(_0x16c6f8));});}exports[a309_0x38932e(0x1fc)]=sleep;function randomValue(_0x1bd423,_0x26191d){const _0x2ee9fd=a309_0x38932e;return Math[_0x2ee9fd(0x1f9)](Math[_0x2ee9fd(0x242)]()*_0x26191d)+_0x1bd423;}exports[a309_0x38932e(0x20e)]=randomValue;async function handleLoginStatus(){const _0x1b76af=a309_0x38932e;console[_0x1b76af(0x1d3)](_0x1b76af(0x219));const _0x8e9b76=new Date();_0x8e9b76[_0x1b76af(0x1c8)](_0x8e9b76[_0x1b76af(0x1cc)]()-0x5),await User_1[_0x1b76af(0x1f5)][_0x1b76af(0x244)]({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x8e9b76},'online':!![]}});}function a309_0x151a(_0x284436,_0x1dd731){const _0x250e11=a309_0x31ed();return a309_0x151a=function(_0xc32780,_0x54f4ed){_0xc32780=_0xc32780-0x1a6;let _0x31ed8e=_0x250e11[_0xc32780];return _0x31ed8e;},a309_0x151a(_0x284436,_0x1dd731);}async function handleInvoiceCreate(){const _0x4202b7=a309_0x38932e;logger_1[_0x4202b7(0x1d5)][_0x4202b7(0x232)](_0x4202b7(0x237));const _0x3b34c8=await Company_1['default'][_0x4202b7(0x1e6)]({'where':{'status':!![]}});_0x3b34c8[_0x4202b7(0x1fb)](async _0x23abb6=>{const _0x1eaf9a=_0x4202b7,{dueDate:_0x4b7ef2}=_0x23abb6,_0x1298f3=new Date(_0x4b7ef2)['setHours'](0x0,0x0,0x0,0x0),_0x16488f=new Date(_0x4b7ef2)[_0x1eaf9a(0x22b)](0x17,0x3b,0x3b,0x3e7),_0x1cb222=(0x0,moment_1[_0x1eaf9a(0x1f5)])((0x0,moment_1[_0x1eaf9a(0x1f5)])())[_0x1eaf9a(0x247)](_0x1eaf9a(0x21f)),_0xe5bf1a=(0x0,moment_1[_0x1eaf9a(0x1f5)])(_0x4b7ef2)[_0x1eaf9a(0x247)](_0x1eaf9a(0x21f)),_0x127468=(0x0,moment_1[_0x1eaf9a(0x1f5)])(_0xe5bf1a,_0x1eaf9a(0x21f))[_0x1eaf9a(0x228)]((0x0,moment_1[_0x1eaf9a(0x1f5)])(_0x1cb222,_0x1eaf9a(0x21f))),_0xb415ae=moment_1[_0x1eaf9a(0x1f5)][_0x1eaf9a(0x246)](_0x127468)['asDays']();if(_0xb415ae<0x14){const _0x3d6141=await Plan_1[_0x1eaf9a(0x1f5)][_0x1eaf9a(0x1f3)](_0x23abb6[_0x1eaf9a(0x1e8)]);let _0x4b6f48=await Invoices_1[_0x1eaf9a(0x1f5)][_0x1eaf9a(0x1ba)]({'where':{'companyId':_0x23abb6['id'],'dueDate':{[sequelize_1['Op'][_0x1eaf9a(0x1e0)]]:(0x0,moment_1['default'])(_0x4b7ef2)[_0x1eaf9a(0x247)](_0x1eaf9a(0x1eb))}}});if(+_0x4b6f48===0x0){const _0x2476a0=(0x0,moment_1[_0x1eaf9a(0x1f5)])()[_0x1eaf9a(0x247)]();await Invoices_1[_0x1eaf9a(0x1f5)][_0x1eaf9a(0x1dd)]({'detail':_0x3d6141[_0x1eaf9a(0x238)],'status':_0x1eaf9a(0x1c5),'value':_0x3d6141['value'],'updatedAt':_0x2476a0,'createdAt':_0x2476a0,'dueDate':(0x0,moment_1[_0x1eaf9a(0x1f5)])(_0x4b7ef2)[_0x1eaf9a(0x247)](_0x1eaf9a(0x1eb)),'companyId':_0x23abb6['id']});}}});}async function startQueueProcess(){const _0xc92f8a=a309_0x38932e;logger_1[_0xc92f8a(0x1d5)][_0xc92f8a(0x232)](_0xc92f8a(0x1d9)),await exports[_0xc92f8a(0x1be)][_0xc92f8a(0x1a7)](_0xc92f8a(0x1ea),{},{'repeat':{'every':0xea60*0x5,'key':_0xc92f8a(0x1ea)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x7af3f=new bullmq_1[(_0xc92f8a(0x22c))](exports[_0xc92f8a(0x1be)][_0xc92f8a(0x238)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x7af3f['on'](_0xc92f8a(0x209),async _0x5b62a5=>{const _0x2cafb3=_0xc92f8a;logger_1[_0x2cafb3(0x1d5)][_0x2cafb3(0x232)](_0x2cafb3(0x1ca)+_0x5b62a5[_0x2cafb3(0x238)]+_0x2cafb3(0x1f4));}),await exports[_0xc92f8a(0x23b)][_0xc92f8a(0x1a7)]('CloseTicketsAutomatic',{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0xc92f8a(0x1dc)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0xc92f8a(0x23b)][_0xc92f8a(0x1a7)](_0xc92f8a(0x240),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0xc92f8a(0x240)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x27782b=new bullmq_1[(_0xc92f8a(0x22c))](exports[_0xc92f8a(0x23b)]['name'],async _0x3a99da=>{const _0x37cd88=_0xc92f8a;if(_0x3a99da[_0x37cd88(0x238)]==_0x37cd88(0x1dc))await handleCloseTicketsAutomatic();else _0x3a99da['name']=='InvoiceCreate'&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}});await exports[_0xc92f8a(0x229)][_0xc92f8a(0x1a7)](_0xc92f8a(0x231),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0xc92f8a(0x231)},'removeOnComplete':!![],'removeOnFail':!![]}),new campaingJob_1[(_0xc92f8a(0x1f5))](exports['campaignQueue'][_0xc92f8a(0x238)],connection);const _0x240340=new bullmq_1[(_0xc92f8a(0x22c))](exports[_0xc92f8a(0x1cb)]['name'],async _0x1cdd6d=>{const _0x36fe7e=_0xc92f8a;if(_0x1cdd6d[_0x36fe7e(0x238)]==_0x36fe7e(0x1ab))await handleMessageJob(_0x1cdd6d);else{if(_0x1cdd6d[_0x36fe7e(0x238)]==_0x36fe7e(0x211))await messageUpdateJob(_0x1cdd6d);else _0x1cdd6d[_0x36fe7e(0x238)]==_0x36fe7e(0x1ec)&&await handleSendMessage(_0x1cdd6d);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x240340['on']('completed',async _0x64a56d=>{const _0x18bf60=_0xc92f8a;logger_1[_0x18bf60(0x1d5)][_0x18bf60(0x232)](_0x18bf60(0x1ca)+_0x64a56d[_0x18bf60(0x238)]+_0x18bf60(0x1f4));}),_0x240340['on'](_0xc92f8a(0x1c7),async(_0xbfc660,_0x198a54)=>{const _0x30dd80=_0xc92f8a;logger_1['logger']['error'](_0x30dd80(0x1ca)+_0xbfc660[_0x30dd80(0x238)]+_0x30dd80(0x204)+_0x198a54[_0x30dd80(0x23a)]);}),await exports['queueMonitor'][_0xc92f8a(0x1a7)](_0xc92f8a(0x1f2),{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':'VerifyQueueStatus'},'removeOnComplete':!![],'removeOnFail':!![]});const _0x46d118=new bullmq_1[(_0xc92f8a(0x22c))](exports[_0xc92f8a(0x1ee)][_0xc92f8a(0x238)],async _0x4bc625=>{const _0x4c80a5=_0xc92f8a;_0x4bc625[_0x4c80a5(0x238)]==_0x4c80a5(0x1f2)&&await handleVerifyQueue(_0x4bc625);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x46d118['on'](_0xc92f8a(0x209),async _0x25ba5e=>{const _0x51d333=_0xc92f8a;logger_1['logger']['info']('Job\x20'+_0x25ba5e['id']+_0x51d333(0x1f4));});let _0x520896=new scheduledMessageJob_1[(_0xc92f8a(0x1f5))](exports['scheduleMonitor'],connection);await _0x520896[_0xc92f8a(0x1d1)]()[_0xc92f8a(0x1a7)](_0xc92f8a(0x1bd),{},{'repeat':{'every':0xea60*0x5,'key':_0xc92f8a(0x20d)},'removeOnComplete':!![],'removeOnFail':!![]});}function a309_0x31ed(){const _0x604cc=['scheduleMonitor','getWbot','\x20segundos\x20iniciado:\x20','search','completed','sequelize','companyId','UserMonitor','verify','randomValue','./models/Contact','./libs/socket','MessageUpdateJob','getOwnPropertyDescriptor','./models/Ticket','CURRENT_DATE','./utils/logger','(((.+)+)+)+$','./workers/campaingJob','timeSendQueue','handle\x20login','Sequelize','Whatsapp\x20não\x20identificado','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','getIO','DD/MM/yyyy','./libs/wbot','Queue','\x20-\x20Empresa:\x20','CONNECTED','toString','40433IHVYGt','literal','handleMessage','diff','campaignQueue','hasOwnProperty','setHours','Worker','127.0.0.1','apply','./services/WbotServices/MarkDeleteWhatsAppMessage','whatsapps','VerifyCampaigns','info','3SZCPbz','275512FBmoyv','emit','REDIS_PORT','Iniciando\x20geração\x20de\x20boletos','name','./models/Invoices','message','generalMonitor','CampaignQueue','status@broadcast','22shoGes','whatsappId','InvoiceCreate','startQueueProcess','random','company-','update','./models/Whatsapp','duration','format','env','add','126RtatJi','sendIdQueue','pending','HandleMessageJob','REDIS_PASSWORD','\x20segundos\x20finalizado:\x20','prototype','configurable','handleMsgAck','-notification','captureException','profilePicUrl','writable','SearchForQueue\x20->\x20VerifyQueue:\x20error','./models/Plan','210VRiaKn','key','number','count','isInteger','ClosedAllOpenTickets','VerifySchedules','userMonitor','status','645530vWfscg','Sleep\x20de\x20','endsWith','messageStubType','verifyCampaignMessageAndCloseTicket','open','./helpers/SendMessage','failed','setMinutes','remoteJid','Job\x20','messageQueue','getMinutes','findAndCountAll','@sentry/node','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','-ticket','getQueue','error','log','utc','logger','10632089CXwOiC','12mOXOtJ','__setModuleDefault','Iniciando\x20processamento\x20de\x20filas','__esModule','REDIS_OPT_LIMITER_MAX','CloseTicketsAutomatic','create','117EGjyvY','QueueMonitor','like','readMessages','verifyRecentCampaign','HH:mm:ss','ClosedAllOpenTickets\x20->\x20Verify:\x20error','reload','findAll','moment','planId','Atendimento\x20Perdido:\x20','VerifyLoginStatus','YYYY-MM-DD','SendMessage','contact','queueMonitor','subtract','13188648rmnHOg','REDIS_OPT_LIMITER_DURATION','VerifyQueueStatus','findByPk','\x20completed','default','get','email','minutes','floor','REDIS_URI','map','sleep','MessageQueue\x20->\x20SendMessage:\x20error','3059332RKKIub','265210dJIGmm','extraInfo','parseToMilliseconds','defineProperty','GeneralMonitor','\x20failed\x20with\x20error:\x20'];a309_0x31ed=function(){return _0x604cc;};return a309_0x31ed();}exports[a309_0x38932e(0x241)]=startQueueProcess;