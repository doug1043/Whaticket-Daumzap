const a308_0x12edfb=a308_0x2823;function a308_0x403d(){const _0xf8e702=['defineProperty','moment','-ticket','queueMonitor','writable','like','minutes','ScheduleMonitor','update','HH:mm:ss','QueueMonitor','Whatsapp\x20não\x20identificado','utc','value','verify','ioredis','completed','getIO','4467468nIYliC','bullmq','configurable','get','name','create','generalMonitor','REDIS_OPT_LIMITER_MAX','UserMonitor','Queue','startQueueProcess','findAll','getWbot','./services/WbotServices/wbotClosedTickets','env','__createBinding','./models/Invoices','VerifySchedules','whatsappId','@sentry/node','ClosedAllOpenTickets','emit','companyId','Sleep\x20de\x20','contact','VerifyCampaigns','floor','CloseTicketsAutomatic','8354274fUfuQI','subtract','error','getOwnPropertyDescriptor','\x20completed','DD/MM/yyyy','Job\x20','messageQueue','prototype','Atendimento\x20Perdido:\x20','Sequelize','SendMessage','GeneralMonitor','Iniciando\x20geração\x20de\x20boletos','VerifyLoginStatus','./libs/wbot','map','REDIS_HOST','hasOwnProperty','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','parseToMilliseconds','endsWith','isInteger','findAndCountAll','CampaignQueue','./services/WbotServices/wbotMessageListener','toString','32534000rEBCmi','2462204qTuOpt','verifyRecentCampaign','52PrKTYS','sequelize','asDays','handle\x20login','log','sendIdQueue','info','Error','constructor','YYYY-MM-DD','failed','./helpers/SendMessage','status@broadcast','\x20failed\x20with\x20error:\x20','\x20segundos\x20finalizado:\x20','data','./models/Contact','MessageQueue','./models/Ticket','open','logger','scheduleMonitor','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','add','sleep','format','Worker','CURRENT_DATE','REDIS_URI','extraInfo','./libs/socket','handleMsgAck','number','status','key','./models/Plan','__importStar','Iniciando\x20processamento\x20de\x20filas','readMessages','./utils/logger','remoteJid','5947172qlOVik','count','randomValue','userMonitor','__setModuleDefault','literal','timeSendQueue','captureException','HANDLE\x20SEND\x20MESSAGE','search','profilePicUrl','messageStubType','@g.us','message','apply','handleMessage','VerifyQueueStatus','__esModule','-notification','campaignQueue','MessageUpdateJob','3831560KeJGtT','REDIS_PASSWORD','(((.+)+)+)+$','39124NOsGln','reload','diff','whatsapps','default','./models/Whatsapp','InvoiceCreate','company-','pending','getQueue','MessageQueue\x20->\x20SendMessage:\x20error'];a308_0x403d=function(){return _0xf8e702;};return a308_0x403d();}(function(_0x515246,_0x207133){const _0x5de73f=a308_0x2823,_0x4d5dfd=_0x515246();while(!![]){try{const _0x32456b=parseInt(_0x5de73f(0x192))/0x1*(-parseInt(_0x5de73f(0x150))/0x2)+-parseInt(_0x5de73f(0x1af))/0x3+parseInt(_0x5de73f(0x14e))/0x4+-parseInt(_0x5de73f(0x18f))/0x5+-parseInt(_0x5de73f(0x132))/0x6+parseInt(_0x5de73f(0x17a))/0x7+parseInt(_0x5de73f(0x14d))/0x8;if(_0x32456b===_0x207133)break;else _0x4d5dfd['push'](_0x4d5dfd['shift']());}catch(_0x571c07){_0x4d5dfd['push'](_0x4d5dfd['shift']());}}}(a308_0x403d,0xd3a0a));const a308_0x12603e=(function(){let _0x22657b=!![];return function(_0x7f5b0e,_0x1f3141){const _0x4f7b49=_0x22657b?function(){const _0x3c81dc=a308_0x2823;if(_0x1f3141){const _0xe25d1d=_0x1f3141[_0x3c81dc(0x188)](_0x7f5b0e,arguments);return _0x1f3141=null,_0xe25d1d;}}:function(){};return _0x22657b=![],_0x4f7b49;};}()),a308_0x495f16=a308_0x12603e(this,function(){const _0x100a12=a308_0x2823;return a308_0x495f16[_0x100a12(0x14c)]()[_0x100a12(0x183)](_0x100a12(0x191))[_0x100a12(0x14c)]()[_0x100a12(0x158)](a308_0x495f16)['search'](_0x100a12(0x191));});a308_0x495f16();'use strict';var __createBinding=this&&this[a308_0x12edfb(0x125)]||(Object['create']?function(_0x3a7c65,_0x3f3546,_0x19b895,_0x56441d){const _0x4e5be6=a308_0x12edfb;if(_0x56441d===undefined)_0x56441d=_0x19b895;var _0x1f8dc6=Object[_0x4e5be6(0x135)](_0x3f3546,_0x19b895);(!_0x1f8dc6||(_0x4e5be6(0x1b2)in _0x1f8dc6?!_0x3f3546[_0x4e5be6(0x18b)]:_0x1f8dc6[_0x4e5be6(0x1a1)]||_0x1f8dc6[_0x4e5be6(0x1b1)]))&&(_0x1f8dc6={'enumerable':!![],'get':function(){return _0x3f3546[_0x19b895];}}),Object[_0x4e5be6(0x19d)](_0x3a7c65,_0x56441d,_0x1f8dc6);}:function(_0x57b651,_0x49f9c3,_0x55dcac,_0x43027a){if(_0x43027a===undefined)_0x43027a=_0x55dcac;_0x57b651[_0x43027a]=_0x49f9c3[_0x55dcac];}),__setModuleDefault=this&&this[a308_0x12edfb(0x17e)]||(Object[a308_0x12edfb(0x1b4)]?function(_0x5a4f1f,_0x1145a2){const _0x4f0ab6=a308_0x12edfb;Object['defineProperty'](_0x5a4f1f,_0x4f0ab6(0x196),{'enumerable':!![],'value':_0x1145a2});}:function(_0x4db9b2,_0x1212f1){const _0x5db03a=a308_0x12edfb;_0x4db9b2[_0x5db03a(0x196)]=_0x1212f1;}),__importStar=this&&this[a308_0x12edfb(0x175)]||function(_0x3d1f77){const _0x1c99e3=a308_0x12edfb;if(_0x3d1f77&&_0x3d1f77[_0x1c99e3(0x18b)])return _0x3d1f77;var _0x50a54b={};if(_0x3d1f77!=null){for(var _0x5b289c in _0x3d1f77)if(_0x5b289c!==_0x1c99e3(0x196)&&Object[_0x1c99e3(0x13a)][_0x1c99e3(0x144)]['call'](_0x3d1f77,_0x5b289c))__createBinding(_0x50a54b,_0x3d1f77,_0x5b289c);}return __setModuleDefault(_0x50a54b,_0x3d1f77),_0x50a54b;},__importDefault=this&&this['__importDefault']||function(_0x21707b){const _0x52015f=a308_0x12edfb;return _0x21707b&&_0x21707b[_0x52015f(0x18b)]?_0x21707b:{'default':_0x21707b};};Object[a308_0x12edfb(0x19d)](exports,a308_0x12edfb(0x18b),{'value':!![]}),exports[a308_0x12edfb(0x1b9)]=exports['randomValue']=exports[a308_0x12edfb(0x169)]=exports['parseToMilliseconds']=exports[a308_0x12edfb(0x18d)]=exports[a308_0x12edfb(0x165)]=exports[a308_0x12edfb(0x1a0)]=exports[a308_0x12edfb(0x139)]=exports[a308_0x12edfb(0x1b5)]=exports[a308_0x12edfb(0x17d)]=void 0x0;const Sentry=__importStar(require(a308_0x12edfb(0x129))),bullmq_1=require(a308_0x12edfb(0x1b0)),SendMessage_1=require(a308_0x12edfb(0x15b)),Whatsapp_1=__importDefault(require(a308_0x12edfb(0x197))),logger_1=require(a308_0x12edfb(0x178)),moment_1=__importDefault(require(a308_0x12edfb(0x19e))),Contact_1=__importDefault(require(a308_0x12edfb(0x160))),sequelize_1=require(a308_0x12edfb(0x151)),socket_1=require(a308_0x12edfb(0x16f)),User_1=__importDefault(require('./models/User')),Company_1=__importDefault(require('./models/Company')),Plan_1=__importDefault(require(a308_0x12edfb(0x174))),Ticket_1=__importDefault(require(a308_0x12edfb(0x162))),wbotClosedTickets_1=require(a308_0x12edfb(0x1bc)),Invoices_1=__importDefault(require(a308_0x12edfb(0x126))),wbotMessageListener_1=require(a308_0x12edfb(0x14b)),wbot_1=require(a308_0x12edfb(0x141)),MarkDeleteWhatsAppMessage_1=__importDefault(require('./services/WbotServices/MarkDeleteWhatsAppMessage')),ioredis_1=__importDefault(require(a308_0x12edfb(0x1ac))),campaingJob_1=__importDefault(require('./workers/campaingJob')),scheduledMessageJob_1=__importDefault(require('./workers/scheduledMessageJob')),connection={'port':parseInt(process[a308_0x12edfb(0x124)]['REDIS_PORT']),'host':process[a308_0x12edfb(0x124)][a308_0x12edfb(0x143)]||'127.0.0.1','password':process[a308_0x12edfb(0x124)][a308_0x12edfb(0x190)]},limiterMax=process[a308_0x12edfb(0x124)][a308_0x12edfb(0x1b6)]||0x1,limiterDuration=process['env']['REDIS_OPT_LIMITER_DURATION']||0xbb8,redis=new ioredis_1['default'](process[a308_0x12edfb(0x124)][a308_0x12edfb(0x16d)]);exports['userMonitor']=new bullmq_1['Queue'](a308_0x12edfb(0x1b7),{'connection':connection}),exports[a308_0x12edfb(0x1b5)]=new bullmq_1[(a308_0x12edfb(0x1b8))](a308_0x12edfb(0x13e),{'connection':connection}),exports[a308_0x12edfb(0x139)]=new bullmq_1[(a308_0x12edfb(0x1b8))](a308_0x12edfb(0x161),{'connection':connection}),exports['queueMonitor']=new bullmq_1[(a308_0x12edfb(0x1b8))](a308_0x12edfb(0x1a7),{'connection':connection}),exports[a308_0x12edfb(0x165)]=new bullmq_1[(a308_0x12edfb(0x1b8))](a308_0x12edfb(0x1a4),{'connection':connection}),exports[a308_0x12edfb(0x18d)]=new bullmq_1['Queue'](a308_0x12edfb(0x14a),{'connection':connection});async function handleVerifyQueueOld(_0x4f8afc){const _0x5a5100=a308_0x12edfb;logger_1[_0x5a5100(0x164)][_0x5a5100(0x156)](_0x5a5100(0x167));try{const _0x4c8b34=await Company_1[_0x5a5100(0x196)][_0x5a5100(0x1ba)]({'attributes':['id',_0x5a5100(0x1b3)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x5a5100(0x13c)]['literal'](_0x5a5100(0x16c))}},'include':[{'model':Whatsapp_1[_0x5a5100(0x196)],'attributes':['id',_0x5a5100(0x1b3),_0x5a5100(0x172),_0x5a5100(0x180),'sendIdQueue'],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x4c8b34['map'](async _0x1f4467=>{const _0x537f03=_0x5a5100;_0x1f4467[_0x537f03(0x195)][_0x537f03(0x142)](async _0x31267b=>{const _0x35efe4=_0x537f03;if(_0x31267b[_0x35efe4(0x172)]==='CONNECTED'){var _0x42085b=_0x1f4467['id'];const _0x3f7c74=_0x31267b['timeSendQueue']?_0x31267b[_0x35efe4(0x180)]:0x0,_0x23e438=_0x31267b[_0x35efe4(0x155)],_0x4f305a=_0x3f7c74,_0x2df3ca=_0x23e438,_0x23731d=_0x4f305a;if(_0x3f7c74>0x0){if(!isNaN(_0x2df3ca)&&Number[_0x35efe4(0x148)](_0x2df3ca)&&!isNaN(_0x23731d)&&Number[_0x35efe4(0x148)](_0x23731d)){const _0x44cb48=(0x0,moment_1[_0x35efe4(0x196)])()[_0x35efe4(0x133)](_0x23731d,_0x35efe4(0x1a3))[_0x35efe4(0x1a9)]()[_0x35efe4(0x16a)](),{count:_0x6dc137,rows:_0x3a4488}=await Ticket_1[_0x35efe4(0x196)][_0x35efe4(0x149)]({'where':{'status':_0x35efe4(0x19a),'queueId':null,'companyId':_0x42085b,'whatsappId':_0x31267b['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x44cb48}},'include':[{'model':Contact_1[_0x35efe4(0x196)],'as':_0x35efe4(0x12e),'attributes':['id',_0x35efe4(0x1b3),_0x35efe4(0x171),'email',_0x35efe4(0x184)],'include':[_0x35efe4(0x16e)]}]});_0x6dc137>0x0?_0x3a4488[_0x35efe4(0x142)](async _0x3df698=>{const _0x2277a2=_0x35efe4;await _0x3df698[_0x2277a2(0x1a5)]({'queueId':_0x2df3ca}),await _0x3df698[_0x2277a2(0x193)]();const _0x163b98=(0x0,socket_1[_0x2277a2(0x1ae)])();_0x163b98['to'](_0x2277a2(0x199)+_0x3df698[_0x2277a2(0x12c)]+'-'+_0x3df698[_0x2277a2(0x172)])['to'](_0x2277a2(0x199)+_0x3df698[_0x2277a2(0x12c)]+_0x2277a2(0x18c))['to'](_0x3df698['id'][_0x2277a2(0x14c)]())[_0x2277a2(0x12b)](_0x2277a2(0x199)+_0x42085b+_0x2277a2(0x19f),{'action':'update','ticket':_0x3df698,'ticketId':_0x3df698['id']}),logger_1[_0x2277a2(0x164)][_0x2277a2(0x156)](_0x2277a2(0x13b)+_0x3df698['id']+'\x20-\x20Empresa:\x20'+_0x42085b);}):logger_1[_0x35efe4(0x164)][_0x35efe4(0x156)]('Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20'+_0x42085b);}else logger_1[_0x35efe4(0x164)][_0x35efe4(0x156)]('Condição\x20não\x20respeitada\x20-\x20Empresa:\x20'+_0x42085b);}}});});}catch(_0xbf6b60){Sentry[_0x5a5100(0x181)](_0xbf6b60),logger_1['logger'][_0x5a5100(0x134)]('SearchForQueue\x20->\x20VerifyQueue:\x20error'+_0xbf6b60);throw _0xbf6b60;}};async function handleVerifyQueue(_0x137257){const _0x23b3b9=a308_0x12edfb;logger_1[_0x23b3b9(0x164)][_0x23b3b9(0x156)](_0x23b3b9(0x167));try{const _0x5a7fd2=await Company_1[_0x23b3b9(0x196)][_0x23b3b9(0x1ba)]({'attributes':['id',_0x23b3b9(0x1b3)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1['Sequelize'][_0x23b3b9(0x17f)](_0x23b3b9(0x16c))}},'include':[{'model':Whatsapp_1[_0x23b3b9(0x196)],'attributes':['id',_0x23b3b9(0x1b3),_0x23b3b9(0x172),_0x23b3b9(0x180),_0x23b3b9(0x155)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x5a7fd2[_0x23b3b9(0x142)](async _0x5a148c=>{const _0x809bde=_0x23b3b9;_0x5a148c['whatsapps'][_0x809bde(0x142)](async _0x11fa5e=>{const _0xd96c92=_0x809bde;if(_0x11fa5e['status']==='CONNECTED'){const _0x463bce=_0x5a148c['id'],_0x446ea4=_0x11fa5e['timeSendQueue']?_0x11fa5e[_0xd96c92(0x180)]:0x0,_0x44b9c5=_0x11fa5e[_0xd96c92(0x155)],_0x5cb9ba=_0x446ea4,_0x217d1d=_0x44b9c5,_0xa3f276=_0x5cb9ba;if(_0x446ea4>0x0&&!isNaN(_0x217d1d)&&Number[_0xd96c92(0x148)](_0x217d1d)&&!isNaN(_0xa3f276)&&Number['isInteger'](_0xa3f276)){const _0x3323f7=(0x0,moment_1[_0xd96c92(0x196)])()[_0xd96c92(0x133)](_0xa3f276,'minutes')[_0xd96c92(0x1a9)]()[_0xd96c92(0x16a)](),{count:_0x52fd99,rows:_0x29113c}=await Ticket_1[_0xd96c92(0x196)][_0xd96c92(0x149)]({'where':{'status':'pending','queueId':null,'companyId':_0x463bce,'whatsappId':_0x11fa5e['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x3323f7}},'include':[{'model':Contact_1[_0xd96c92(0x196)],'as':_0xd96c92(0x12e),'attributes':['id',_0xd96c92(0x1b3),_0xd96c92(0x171),'email',_0xd96c92(0x184)],'include':[_0xd96c92(0x16e)]}]});_0x52fd99>0x0?_0x29113c['map'](async _0x115341=>{const _0x30275d=_0xd96c92;await _0x115341[_0x30275d(0x1a5)]({'queueId':_0x217d1d}),await _0x115341[_0x30275d(0x193)]();const _0x5e4d66=(0x0,socket_1[_0x30275d(0x1ae)])();_0x5e4d66['to']('company-'+_0x115341[_0x30275d(0x12c)]+'-'+_0x115341[_0x30275d(0x172)])['to']('company-'+_0x115341['companyId']+_0x30275d(0x18c))['to'](_0x115341['id']['toString']())['emit'](_0x30275d(0x199)+_0x463bce+_0x30275d(0x19f),{'action':_0x30275d(0x1a5),'ticket':_0x115341,'ticketId':_0x115341['id']}),logger_1['logger'][_0x30275d(0x156)](_0x30275d(0x13b)+_0x115341['id']+'\x20-\x20Empresa:\x20'+_0x463bce);}):logger_1[_0xd96c92(0x164)][_0xd96c92(0x156)](_0xd96c92(0x145)+_0x463bce);}else logger_1[_0xd96c92(0x164)][_0xd96c92(0x156)](_0xd96c92(0x166)+_0x463bce);}});});}catch(_0x322c85){console['error'](_0x322c85);}}async function handleCloseTicketsAutomatic(){const _0x2082a3=a308_0x12edfb,_0xf19139=await Company_1[_0x2082a3(0x196)][_0x2082a3(0x1ba)]({'where':{'status':!![]}});_0xf19139[_0x2082a3(0x142)](async _0x4fee49=>{const _0x201499=_0x2082a3;try{const _0x3e1280=_0x4fee49['id'];await(0x0,wbotClosedTickets_1[_0x201499(0x12a)])(_0x3e1280);}catch(_0x50f171){Sentry[_0x201499(0x181)](_0x50f171),logger_1['logger'][_0x201499(0x134)]('ClosedAllOpenTickets\x20->\x20Verify:\x20error',_0x50f171[_0x201499(0x187)]);throw _0x50f171;}});}async function messageUpdateJob(_0x95d543){const _0x45ebc7=a308_0x12edfb,{data:_0x612fe3}=_0x95d543;var _0x5809c5=_0x612fe3[_0x45ebc7(0x12c)],_0x2abf1d=_0x612fe3['messageUpdate'],_0x584b62=_0x612fe3[_0x45ebc7(0x128)];const _0x23472d=(0x0,wbot_1[_0x45ebc7(0x1bb)])(_0x612fe3[_0x45ebc7(0x128)]);for(const _0x3586dc of _0x2abf1d){await _0x23472d[_0x45ebc7(0x177)]([_0x3586dc['key']]);const _0x2ddc0c={..._0x2abf1d};_0x2ddc0c['0']?.[_0x45ebc7(0x1a5)][_0x45ebc7(0x185)]===0x1&&_0x2ddc0c['0']?.[_0x45ebc7(0x173)]['remoteJid']!==_0x45ebc7(0x15c)&&await(0x0,MarkDeleteWhatsAppMessage_1[_0x45ebc7(0x196)])(_0x2ddc0c['0']?.[_0x45ebc7(0x173)][_0x45ebc7(0x179)],null,_0x2ddc0c['0']?.[_0x45ebc7(0x173)]['id'],_0x5809c5),await(0x0,wbotMessageListener_1[_0x45ebc7(0x170)])(_0x3586dc,_0x3586dc['update'][_0x45ebc7(0x172)]);}}async function handleMessageJob(_0x144dbf){const _0x46d3d0=a308_0x12edfb,{data:_0x1b64e1}=_0x144dbf;var _0x59c67c=_0x1b64e1['messages'],_0x528f8a=_0x1b64e1[_0x46d3d0(0x12c)];const _0x11a942=(0x0,wbot_1[_0x46d3d0(0x1bb)])(_0x1b64e1[_0x46d3d0(0x128)]);for(const _0x14d299 of _0x59c67c){await(0x0,wbotMessageListener_1[_0x46d3d0(0x189)])(_0x14d299,_0x11a942,_0x528f8a),await(0x0,wbotMessageListener_1[_0x46d3d0(0x14f)])(_0x14d299,_0x528f8a),await(0x0,wbotMessageListener_1['verifyCampaignMessageAndCloseTicket'])(_0x14d299,_0x528f8a),_0x14d299[_0x46d3d0(0x173)]['remoteJid']?.[_0x46d3d0(0x147)](_0x46d3d0(0x186))&&await(0x0,wbotMessageListener_1['handleMsgAck'])(_0x14d299,0x2);}}async function handleSendMessage(_0x6a621d){const _0x319bdf=a308_0x12edfb;console[_0x319bdf(0x154)](_0x319bdf(0x182));try{const {data:_0x2fce3b}=_0x6a621d,_0x83ccea=await Whatsapp_1[_0x319bdf(0x196)]['findByPk'](_0x2fce3b[_0x319bdf(0x128)]);if(_0x83ccea==null)throw new sequelize_1[(_0x319bdf(0x157))](_0x319bdf(0x1a8));const _0x213022=_0x2fce3b[_0x319bdf(0x15f)];await(0x0,SendMessage_1[_0x319bdf(0x13d)])(_0x83ccea,_0x213022);}catch(_0x990daa){Sentry[_0x319bdf(0x181)](_0x990daa),logger_1[_0x319bdf(0x164)]['error'](_0x319bdf(0x19c),_0x990daa[_0x319bdf(0x187)]);throw _0x990daa;}}function parseToMilliseconds(_0x338460){return _0x338460*0x3e8;}exports[a308_0x12edfb(0x146)]=parseToMilliseconds;async function sleep(_0x1e4839){const _0x2272ef=a308_0x12edfb;return logger_1[_0x2272ef(0x164)]['info'](_0x2272ef(0x12d)+_0x1e4839+'\x20segundos\x20iniciado:\x20'+(0x0,moment_1[_0x2272ef(0x196)])()['format'](_0x2272ef(0x1a6))),new Promise(_0x4e4c7f=>{setTimeout(()=>{const _0x58d822=a308_0x2823;logger_1[_0x58d822(0x164)][_0x58d822(0x156)]('Sleep\x20de\x20'+_0x1e4839+_0x58d822(0x15e)+(0x0,moment_1[_0x58d822(0x196)])()[_0x58d822(0x16a)](_0x58d822(0x1a6))),_0x4e4c7f(!![]);},parseToMilliseconds(_0x1e4839));});}exports[a308_0x12edfb(0x169)]=sleep;function randomValue(_0x48a76a,_0x23a520){const _0x2bfe53=a308_0x12edfb;return Math[_0x2bfe53(0x130)](Math['random']()*_0x23a520)+_0x48a76a;}exports[a308_0x12edfb(0x17c)]=randomValue;async function handleLoginStatus(){const _0x5c5af0=a308_0x12edfb;console[_0x5c5af0(0x154)](_0x5c5af0(0x153));const _0x3b7529=new Date();_0x3b7529['setMinutes'](_0x3b7529['getMinutes']()-0x5),await User_1['default'][_0x5c5af0(0x1a5)]({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x3b7529},'online':!![]}});}function a308_0x2823(_0x3172e7,_0x6fe60b){const _0x5f593c=a308_0x403d();return a308_0x2823=function(_0x495f16,_0x12603e){_0x495f16=_0x495f16-0x124;let _0x403d2a=_0x5f593c[_0x495f16];return _0x403d2a;},a308_0x2823(_0x3172e7,_0x6fe60b);}async function handleInvoiceCreate(){const _0x2c0f82=a308_0x12edfb;logger_1[_0x2c0f82(0x164)][_0x2c0f82(0x156)](_0x2c0f82(0x13f));const _0x3c1fb7=await Company_1[_0x2c0f82(0x196)]['findAll']({'where':{'status':!![]}});_0x3c1fb7[_0x2c0f82(0x142)](async _0x46e223=>{const _0x1ae0c9=_0x2c0f82,{dueDate:_0x6286fd}=_0x46e223,_0x34b30f=new Date(_0x6286fd)['setHours'](0x0,0x0,0x0,0x0),_0x4dbdac=new Date(_0x6286fd)['setHours'](0x17,0x3b,0x3b,0x3e7),_0x6d75ea=(0x0,moment_1[_0x1ae0c9(0x196)])((0x0,moment_1[_0x1ae0c9(0x196)])())[_0x1ae0c9(0x16a)](_0x1ae0c9(0x137)),_0x3721e0=(0x0,moment_1[_0x1ae0c9(0x196)])(_0x6286fd)[_0x1ae0c9(0x16a)](_0x1ae0c9(0x137)),_0x9c3d89=(0x0,moment_1['default'])(_0x3721e0,_0x1ae0c9(0x137))[_0x1ae0c9(0x194)]((0x0,moment_1['default'])(_0x6d75ea,'DD/MM/yyyy')),_0x36843b=moment_1['default']['duration'](_0x9c3d89)[_0x1ae0c9(0x152)]();if(_0x36843b<0x14){const _0x4934cf=await Plan_1['default']['findByPk'](_0x46e223['planId']);let _0x5883b8=await Invoices_1[_0x1ae0c9(0x196)][_0x1ae0c9(0x17b)]({'where':{'companyId':_0x46e223['id'],'dueDate':{[sequelize_1['Op'][_0x1ae0c9(0x1a2)]]:(0x0,moment_1[_0x1ae0c9(0x196)])(_0x6286fd)[_0x1ae0c9(0x16a)](_0x1ae0c9(0x159))}}});if(+_0x5883b8===0x0){const _0x1b253a=(0x0,moment_1['default'])()['format']();await Invoices_1[_0x1ae0c9(0x196)][_0x1ae0c9(0x1b4)]({'detail':_0x4934cf[_0x1ae0c9(0x1b3)],'status':_0x1ae0c9(0x163),'value':_0x4934cf[_0x1ae0c9(0x1aa)],'updatedAt':_0x1b253a,'createdAt':_0x1b253a,'dueDate':(0x0,moment_1[_0x1ae0c9(0x196)])(_0x6286fd)[_0x1ae0c9(0x16a)](_0x1ae0c9(0x159)),'companyId':_0x46e223['id']});}}});}async function startQueueProcess(){const _0x408041=a308_0x12edfb;logger_1['logger'][_0x408041(0x156)](_0x408041(0x176)),await exports[_0x408041(0x17d)][_0x408041(0x168)](_0x408041(0x140),{},{'repeat':{'every':0xea60*0x5,'key':_0x408041(0x140)},'removeOnComplete':!![],'removeOnFail':!![]});const _0xe5db6c=new bullmq_1[(_0x408041(0x16b))](exports['userMonitor'][_0x408041(0x1b3)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0xe5db6c['on'](_0x408041(0x1ad),async _0x565c5a=>{const _0x3183a6=_0x408041;logger_1[_0x3183a6(0x164)][_0x3183a6(0x156)](_0x3183a6(0x138)+_0x565c5a['name']+_0x3183a6(0x136));}),await exports['generalMonitor'][_0x408041(0x168)](_0x408041(0x131),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x408041(0x131)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x408041(0x1b5)]['add'](_0x408041(0x198),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x408041(0x198)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x41ce5f=new bullmq_1[(_0x408041(0x16b))](exports[_0x408041(0x1b5)][_0x408041(0x1b3)],async _0x1d4478=>{const _0x17df0c=_0x408041;if(_0x1d4478[_0x17df0c(0x1b3)]==_0x17df0c(0x131))await handleCloseTicketsAutomatic();else _0x1d4478['name']==_0x17df0c(0x198)&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}});await exports['campaignQueue'][_0x408041(0x168)](_0x408041(0x12f),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':'VerifyCampaigns'},'removeOnComplete':!![],'removeOnFail':!![]}),new campaingJob_1[(_0x408041(0x196))](exports[_0x408041(0x18d)]['name'],connection);const _0x250980=new bullmq_1[(_0x408041(0x16b))](exports[_0x408041(0x139)][_0x408041(0x1b3)],async _0x385817=>{const _0x2754cf=_0x408041;if(_0x385817[_0x2754cf(0x1b3)]=='HandleMessageJob')await handleMessageJob(_0x385817);else{if(_0x385817[_0x2754cf(0x1b3)]==_0x2754cf(0x18e))await messageUpdateJob(_0x385817);else _0x385817['name']==_0x2754cf(0x13d)&&await handleSendMessage(_0x385817);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x250980['on'](_0x408041(0x1ad),async _0x640778=>{const _0x36c3d1=_0x408041;logger_1[_0x36c3d1(0x164)][_0x36c3d1(0x156)](_0x36c3d1(0x138)+_0x640778['name']+_0x36c3d1(0x136));}),_0x250980['on'](_0x408041(0x15a),async(_0x49f7f6,_0x123c11)=>{const _0x24c033=_0x408041;logger_1[_0x24c033(0x164)][_0x24c033(0x134)](_0x24c033(0x138)+_0x49f7f6[_0x24c033(0x1b3)]+_0x24c033(0x15d)+_0x123c11['message']);}),await exports[_0x408041(0x1a0)][_0x408041(0x168)](_0x408041(0x18a),{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':'VerifyQueueStatus'},'removeOnComplete':!![],'removeOnFail':!![]});const _0x5dcc14=new bullmq_1[(_0x408041(0x16b))](exports[_0x408041(0x1a0)][_0x408041(0x1b3)],async _0x58689d=>{const _0x198b8f=_0x408041;_0x58689d[_0x198b8f(0x1b3)]==_0x198b8f(0x18a)&&await handleVerifyQueue(_0x58689d);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x5dcc14['on'](_0x408041(0x1ad),async _0x29d6fd=>{const _0x13d8b0=_0x408041;logger_1['logger'][_0x13d8b0(0x156)](_0x13d8b0(0x138)+_0x29d6fd['id']+_0x13d8b0(0x136));});let _0x32c08f=new scheduledMessageJob_1[(_0x408041(0x196))](exports['scheduleMonitor'],connection);await _0x32c08f[_0x408041(0x19b)]()[_0x408041(0x168)](_0x408041(0x127),{},{'repeat':{'every':0xea60*0x5,'key':_0x408041(0x1ab)},'removeOnComplete':!![],'removeOnFail':!![]});}exports['startQueueProcess']=startQueueProcess;