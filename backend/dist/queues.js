'use strict';function a344_0xf7ef(_0x421dfc,_0x40bdad){const _0x51ef2a=a344_0x4aba();return a344_0xf7ef=function(_0x52d191,_0x50f167){_0x52d191=_0x52d191-0x1e8;let _0x4abacf=_0x51ef2a[_0x52d191];return _0x4abacf;},a344_0xf7ef(_0x421dfc,_0x40bdad);}const a344_0x5aed11=a344_0xf7ef;(function(_0x81a0f9,_0x65a60a){const _0x2eaa43=a344_0xf7ef,_0x3a1e62=_0x81a0f9();while(!![]){try{const _0x2cfdf5=-parseInt(_0x2eaa43(0x1f7))/0x1+parseInt(_0x2eaa43(0x283))/0x2*(-parseInt(_0x2eaa43(0x279))/0x3)+-parseInt(_0x2eaa43(0x276))/0x4+-parseInt(_0x2eaa43(0x2c5))/0x5+-parseInt(_0x2eaa43(0x1ed))/0x6+-parseInt(_0x2eaa43(0x20a))/0x7*(parseInt(_0x2eaa43(0x263))/0x8)+parseInt(_0x2eaa43(0x2ba))/0x9*(parseInt(_0x2eaa43(0x2a2))/0xa);if(_0x2cfdf5===_0x65a60a)break;else _0x3a1e62['push'](_0x3a1e62['shift']());}catch(_0x3b16ae){_0x3a1e62['push'](_0x3a1e62['shift']());}}}(a344_0x4aba,0x92042));var __createBinding=this&&this[a344_0x5aed11(0x270)]||(Object[a344_0x5aed11(0x2d1)]?function(_0x35a477,_0x1cfa3c,_0xd48906,_0xc90e91){const _0x466b5c=a344_0x5aed11;if(_0xc90e91===undefined)_0xc90e91=_0xd48906;var _0x4732f2=Object['getOwnPropertyDescriptor'](_0x1cfa3c,_0xd48906);(!_0x4732f2||('get'in _0x4732f2?!_0x1cfa3c['__esModule']:_0x4732f2[_0x466b5c(0x218)]||_0x4732f2[_0x466b5c(0x2c0)]))&&(_0x4732f2={'enumerable':!![],'get':function(){return _0x1cfa3c[_0xd48906];}}),Object[_0x466b5c(0x268)](_0x35a477,_0xc90e91,_0x4732f2);}:function(_0x2eede6,_0x8180c1,_0x38d99b,_0x45b72c){if(_0x45b72c===undefined)_0x45b72c=_0x38d99b;_0x2eede6[_0x45b72c]=_0x8180c1[_0x38d99b];}),__setModuleDefault=this&&this[a344_0x5aed11(0x2c4)]||(Object[a344_0x5aed11(0x2d1)]?function(_0x3d3b53,_0x4a9251){const _0x2a108=a344_0x5aed11;Object[_0x2a108(0x268)](_0x3d3b53,_0x2a108(0x219),{'enumerable':!![],'value':_0x4a9251});}:function(_0x348a53,_0x1c4d6f){const _0x45fb0a=a344_0x5aed11;_0x348a53[_0x45fb0a(0x219)]=_0x1c4d6f;}),__importStar=this&&this[a344_0x5aed11(0x1fb)]||(function(){const _0x1e56fe=(function(){let _0x3598ea=!![];return function(_0x2779d5,_0x34fca7){const _0x3a5941=_0x3598ea?function(){const _0x401d1f=a344_0xf7ef;if(_0x34fca7){const _0x59a8b6=_0x34fca7[_0x401d1f(0x294)](_0x2779d5,arguments);return _0x34fca7=null,_0x59a8b6;}}:function(){};return _0x3598ea=![],_0x3a5941;};}()),_0xd552e3=_0x1e56fe(this,function(){const _0x3bacb6=a344_0xf7ef;return _0xd552e3['toString']()[_0x3bacb6(0x299)](_0x3bacb6(0x249))[_0x3bacb6(0x1fe)]()[_0x3bacb6(0x1f1)](_0xd552e3)[_0x3bacb6(0x299)]('(((.+)+)+)+$');});_0xd552e3();var _0x455ff3=function(_0x58632e){const _0x4a5649=a344_0xf7ef;return _0x455ff3=Object[_0x4a5649(0x2a9)]||function(_0x49d002){const _0x45ed22=_0x4a5649;var _0x38868d=[];for(var _0x243353 in _0x49d002)if(Object[_0x45ed22(0x1ff)][_0x45ed22(0x1f2)][_0x45ed22(0x207)](_0x49d002,_0x243353))_0x38868d[_0x38868d[_0x45ed22(0x203)]]=_0x243353;return _0x38868d;},_0x455ff3(_0x58632e);};return function(_0x3a4613){const _0x660e8f=a344_0xf7ef;if(_0x3a4613&&_0x3a4613['__esModule'])return _0x3a4613;var _0x2fec5d={};if(_0x3a4613!=null){for(var _0x4d8745=_0x455ff3(_0x3a4613),_0x26b703=0x0;_0x26b703<_0x4d8745['length'];_0x26b703++)if(_0x4d8745[_0x26b703]!==_0x660e8f(0x219))__createBinding(_0x2fec5d,_0x3a4613,_0x4d8745[_0x26b703]);}return __setModuleDefault(_0x2fec5d,_0x3a4613),_0x2fec5d;};}()),__importDefault=this&&this[a344_0x5aed11(0x2a1)]||function(_0x207d1f){return _0x207d1f&&_0x207d1f['__esModule']?_0x207d1f:{'default':_0x207d1f};};Object[a344_0x5aed11(0x268)](exports,'__esModule',{'value':!![]}),exports[a344_0x5aed11(0x2de)]=exports[a344_0x5aed11(0x285)]=exports['ticketMonitor']=exports['ticketInactiveWarningQueue']=exports['sendScheduledMessages']=exports[a344_0x5aed11(0x2d2)]=exports[a344_0x5aed11(0x25e)]=exports[a344_0x5aed11(0x2a8)]=void 0x0,exports[a344_0x5aed11(0x226)]=handleWhatsappAutoRestart,exports[a344_0x5aed11(0x29e)]=parseToMilliseconds,exports[a344_0x5aed11(0x2b0)]=sleep,exports['randomValue']=randomValue,exports[a344_0x5aed11(0x236)]=startQueueProcess;const Sentry=__importStar(require(a344_0x5aed11(0x241))),bull_1=__importDefault(require(a344_0x5aed11(0x1eb))),moment_1=__importDefault(require(a344_0x5aed11(0x21f))),sequelize_1=require(a344_0x5aed11(0x28b)),lodash_1=require('lodash'),path_1=__importDefault(require(a344_0x5aed11(0x2c6))),cron_1=require(a344_0x5aed11(0x246)),SendMessage_1=require(a344_0x5aed11(0x2aa)),Whatsapp_1=__importDefault(require(a344_0x5aed11(0x2c9))),logger_1=require(a344_0x5aed11(0x211)),Schedule_1=__importDefault(require(a344_0x5aed11(0x209))),Contact_1=__importDefault(require(a344_0x5aed11(0x2b4))),GetDefaultWhatsApp_1=__importDefault(require(a344_0x5aed11(0x1fa))),Campaign_1=__importDefault(require(a344_0x5aed11(0x21c))),ContactList_1=__importDefault(require('./models/ContactList')),ContactListItem_1=__importDefault(require('./models/ContactListItem')),CampaignSetting_1=__importDefault(require('./models/CampaignSetting')),CampaignShipping_1=__importDefault(require('./models/CampaignShipping')),GetWhatsappWbot_1=__importDefault(require(a344_0x5aed11(0x280))),database_1=__importDefault(require(a344_0x5aed11(0x1f0))),SendWhatsAppMedia_1=require(a344_0x5aed11(0x2cf)),socket_1=require(a344_0x5aed11(0x291)),User_1=__importDefault(require(a344_0x5aed11(0x2a5))),Company_1=__importDefault(require('./models/Company')),Plan_1=__importDefault(require(a344_0x5aed11(0x217))),wbotMessageListener_1=require(a344_0x5aed11(0x295)),ShowService_1=__importDefault(require(a344_0x5aed11(0x281))),Ticket_1=__importDefault(require(a344_0x5aed11(0x25a))),SendWhatsAppMessage_1=__importDefault(require('./services/WbotServices/SendWhatsAppMessage')),wbot_1=require(a344_0x5aed11(0x1e8)),StartWhatsAppSession_1=require(a344_0x5aed11(0x216)),connection=process[a344_0x5aed11(0x204)][a344_0x5aed11(0x26b)]||'',limiterMax=process[a344_0x5aed11(0x204)][a344_0x5aed11(0x2ac)]||0x1,limiterDuration=process[a344_0x5aed11(0x204)][a344_0x5aed11(0x254)]||0xbb8;function a344_0x4aba(){const _0x4f616f=['\x20segundos\x20finalizado:\x20','Disparo\x20agendado\x20para:\x20','confirmationMessage4','\x20fechado\x20por\x20inatividade\x20após\x20','agent','SendMessage','key','whenExpireTicket','expiresTicket','floor','-ticket','asDays','Aviso\x20de\x20inatividade\x20enviado\x20para\x20o\x20ticket\x20#','toDate','valids','startQueueProcess',';Delay=','scheduledAt','getMessageOptions','Reiniciando\x20conexão\x20WhatsApp\x20','VerifyTicketExpiration','update','DD/MM/yyyy','company-','replace','data','@sentry/node','inactiveMessageTime','ticketMonitor','Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha=','contact','cron','select\x20id,\x20\x22scheduledAt\x22\x20from\x20\x22Campaigns\x22\x20c\x0a\x20\x20\x20\x20where\x20\x22scheduledAt\x22\x20between\x20now()\x20and\x20now()\x20+\x20\x271\x20hour\x27::interval\x20and\x20status\x20=\x20\x27PROGRAMADA\x27','captureException','(((.+)+)+)+$','findAll','query','Erro\x20ao\x20tentar\x20consultar\x20agendamento:\x20','set','info','shipping','findAndCountAll','value','ERRO','emit','REDIS_OPT_LIMITER_DURATION','inactiveMessage','closed','confirmationMessage3','sendScheduledMessages','diariamente','./models/Ticket','TicketInactiveWarning','confirmationMessage5','confirmationRequestedAt','messageQueue','Erro\x20ao\x20reiniciar\x20conexões\x20WhatsApp\x20periodicamente:\x20','VerifyCampaignsDaatabase','contactId','INSERT\x20INTO\x20\x22Invoices\x22\x20(detail,\x20status,\x20value,\x20\x22updatedAt\x22,\x20\x22createdAt\x22,\x20\x22dueDate\x22,\x20\x22companyId\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(\x27','609976oiNkbb','AGENDADA','\x20minutos.','Campanha\x20enviada\x20para:\x20Campanha=','logger','defineProperty','*\x20*\x20*\x20*\x20*','message2','REDIS_URI','forEach','updatedAt','0\x20*\x20*\x20*\x20*','\x27,\x20\x27open\x27,\x20\x27','__createBinding','map','Campanhas\x20encontradas:\x20','random','Mensagem\x20agendada\x20enviada\x20para:\x20','\x27,\x20','2952556CzjXkj','CampaignQueue','AutoRestart','819OZQImD','Ticket\x20#','longerIntervalAfter','open','getIO','UserMonitor','months','./helpers/GetWhatsappWbot','./services/CampaignService/ShowService','add','8518CnPwPQ','planId','whatsappRestartQueue','delivered','subtract','completed','HH:mm:ss','DispatchCampaign','sequelize','body','messageInterval','whatsappId','Usuário\x20passado\x20para\x20offline:\x20','findByPk','./libs/socket','INSERT','period','apply','./services/WbotServices/wbotMessageListener','isArray','deliveredAt','process','search','DispatchConfirmedCampaign','removeWbot','{nome}','VerifyLoginStatus','parseToMilliseconds','SendSacheduledMessages','CronJob','__importDefault','2410azaCFp','mensalmente','semanalmente','./models/User',';Contato=','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','userMonitor','getOwnPropertyNames','./helpers/SendMessage','seconds','REDIS_OPT_LIMITER_MAX','QueryTypes','-campaign','lte','sleep','parse','gte','variables','./models/Contact','push','companyId','save','SendScheduledMessage\x20->\x20Verify:\x20error','SELECT','198657APskae','days','duration','format',')\x20de\x20acordo\x20com\x20o\x20período\x20(','{numero}','configurable','\x27,\x20\x27','confirmationMessage1','whatsapp','__setModuleDefault','5371785aWoyaK','path','isWhatsappValid','PENDENTE','./models/Whatsapp','ENVIADA','start','clean','contactList','FINALIZADA','./services/WbotServices/SendWhatsAppMedia','message','create','scheduleMonitor','\x20segundos\x20iniciado:\x20','isNil','includes','sendMessage','message4','message5','expiresInactiveMessage','findOrCreate','Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha=','yyyy-MM-DD','-open','campaignQueue','isEmpty','./libs/wbot','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','error','bull','mediaName','3839454ThKEUy','diff','queue-','./database','constructor','hasOwnProperty','ProcessCampaign','greaterInterval','SELECT\x20COUNT(*)\x20mycount\x20FROM\x20\x22Invoices\x22\x20WHERE\x20\x22companyId\x22\x20=\x20','minutes','953905LisZxR','Whatsapp\x20não\x20identificado','confirmationMessage','./helpers/GetDefaultWhatsApp','__importStar','TicketMonitor\x20->\x20VerifyTicketExpiration:\x20erro','name','toString','prototype','saveMessage','Sleep\x20de\x20','MessageQueue\x20->\x20SendMessage:\x20error','length','env','confirmationMessage2','number','call','{email}','./models/Schedule','14RVwtRe','MessageQueue','Erro\x20ao\x20fechar\x20ticket\x20por\x20inatividade:\x20','ticketInactiveWarningQueue','confirmation','resolve','mediaPath','./utils/logger','milliseconds','WhatsappRestartQueue','public','*/20\x20*\x20*\x20*\x20*\x20*','./services/WbotServices/StartWhatsAppSession','./models/Plan','writable','default','\x20AND\x20\x22dueDate\x22::text\x20LIKE\x20\x27','email','./models/Campaign','TicketMonitor','EM_ANDAMENTO','moment','message1','Verify','message3','dataValues','contacts','CONNECTED','handleWhatsappAutoRestart'];a344_0x4aba=function(){return _0x4f616f;};return a344_0x4aba();}exports[a344_0x5aed11(0x2a8)]=new bull_1[(a344_0x5aed11(0x219))](a344_0x5aed11(0x27e),connection),exports[a344_0x5aed11(0x25e)]=new bull_1[(a344_0x5aed11(0x219))](a344_0x5aed11(0x20b),connection,{'limiter':{'max':limiterMax,'duration':limiterDuration}}),exports[a344_0x5aed11(0x2d2)]=new bull_1[(a344_0x5aed11(0x219))]('ScheduleMonitor',connection),exports[a344_0x5aed11(0x258)]=new bull_1[(a344_0x5aed11(0x219))](a344_0x5aed11(0x29f),connection),exports[a344_0x5aed11(0x20d)]=new bull_1[(a344_0x5aed11(0x219))](a344_0x5aed11(0x25b),connection);async function handleWhatsappAutoRestart(){const _0x39f86e=a344_0x5aed11;try{const _0x5daa62=await Whatsapp_1[_0x39f86e(0x219)][_0x39f86e(0x24a)]({'where':{'automaticRestart':!![],'status':_0x39f86e(0x225)}}),_0x57ddd4=new Date();for(const _0x1ddbbc of _0x5daa62){const _0xbc3275=_0x1ddbbc['lastRestartAt']||_0x1ddbbc[_0x39f86e(0x26d)]||_0x1ddbbc['createdAt'];shouldRestart(_0x57ddd4,_0xbc3275,_0x1ddbbc[_0x39f86e(0x293)])&&(logger_1[_0x39f86e(0x267)][_0x39f86e(0x24e)](_0x39f86e(0x23a)+_0x1ddbbc[_0x39f86e(0x1fd)]+'\x20(ID:\x20'+_0x1ddbbc['id']+_0x39f86e(0x2be)+_0x1ddbbc[_0x39f86e(0x293)]+')'),await(0x0,wbot_1[_0x39f86e(0x29b)])(_0x1ddbbc['id'],![]),await new Promise(_0x5b20f8=>setTimeout(_0x5b20f8,0xbb8)),await(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x1ddbbc,_0x1ddbbc['companyId']),await _0x1ddbbc[_0x39f86e(0x23c)]({'lastRestartAt':new Date()}));}}catch(_0x1c0cc1){logger_1[_0x39f86e(0x267)][_0x39f86e(0x1ea)](_0x39f86e(0x25f)+_0x1c0cc1['message']);}}exports[a344_0x5aed11(0x243)]=new bull_1[(a344_0x5aed11(0x219))](a344_0x5aed11(0x21d),connection),exports[a344_0x5aed11(0x285)]=new bull_1['default'](a344_0x5aed11(0x213),connection);function shouldRestart(_0x25cd68,_0x412dd3,_0x1470c1){const _0x28f324=a344_0x5aed11;if(_0x1470c1===_0x28f324(0x259))return(0x0,moment_1[_0x28f324(0x219)])(_0x25cd68)[_0x28f324(0x1ee)]((0x0,moment_1['default'])(_0x412dd3),_0x28f324(0x2bb))>=0x1;if(_0x1470c1===_0x28f324(0x2a4))return(0x0,moment_1['default'])(_0x25cd68)[_0x28f324(0x1ee)]((0x0,moment_1[_0x28f324(0x219)])(_0x412dd3),'weeks')>=0x1;if(_0x1470c1===_0x28f324(0x2a3))return(0x0,moment_1[_0x28f324(0x219)])(_0x25cd68)[_0x28f324(0x1ee)]((0x0,moment_1[_0x28f324(0x219)])(_0x412dd3),_0x28f324(0x27f))>=0x1;return![];}async function handleVerifyTicketExpiration(){const _0x655ded=a344_0x5aed11;try{const _0x3d2230=await database_1[_0x655ded(0x219)][_0x655ded(0x24b)]('SELECT\x20id,\x20\x22expiresTicket\x22,\x20\x22companyId\x22,\x20\x22whenExpireTicket\x22,\x0a\x20\x20\x20\x22expiresInactiveMessage\x22,\x20\x22inactiveMessage\x22,\x20\x22inactiveMessageTime\x22\x0a\x20\x20\x20FROM\x20\x22Whatsapps\x22\x20WHERE\x20\x22expiresTicket\x22\x20>\x200',{'type':sequelize_1[_0x655ded(0x2ad)][_0x655ded(0x2b9)]});for(const _0x23fadc of _0x3d2230){let _0x4b38a2={};_0x23fadc[_0x655ded(0x22e)]===_0x655ded(0x22b)&&(_0x4b38a2={'fromMe':!![]});if(_0x23fadc[_0x655ded(0x242)]>0x0&&_0x23fadc['inactiveMessage']){const _0x5e0300=_0x23fadc[_0x655ded(0x22f)]-_0x23fadc[_0x655ded(0x242)];if(_0x5e0300>0x0){const _0x162188=await Ticket_1['default'][_0x655ded(0x24a)]({'where':{'status':'open','whatsappId':_0x23fadc['id'],'companyId':_0x23fadc['companyId'],'ticketsWithWarning':![],..._0x4b38a2,'updatedAt':{[sequelize_1['Op']['lt']]:(0x0,moment_1[_0x655ded(0x219)])()[_0x655ded(0x287)](_0x5e0300,_0x655ded(0x1f6))['toDate'](),[sequelize_1['Op']['gt']]:(0x0,moment_1['default'])()[_0x655ded(0x287)](_0x23fadc[_0x655ded(0x22f)],_0x655ded(0x1f6))[_0x655ded(0x234)]()}},'include':[{'model':Contact_1[_0x655ded(0x219)],'as':_0x655ded(0x245)}]});for(const _0x8c459a of _0x162188){try{await(0x0,SendWhatsAppMessage_1['default'])({'ticket':_0x8c459a,'body':_0x23fadc[_0x655ded(0x255)]}),await Ticket_1['default'][_0x655ded(0x23c)]({'ticketsWithWarning':!![]},{'where':{'id':_0x8c459a['id']},'silent':!![]}),logger_1[_0x655ded(0x267)]['info'](_0x655ded(0x233)+_0x8c459a['id']);}catch(_0x11a4d6){Sentry[_0x655ded(0x248)](_0x11a4d6),logger_1[_0x655ded(0x267)][_0x655ded(0x1ea)]('Erro\x20ao\x20enviar\x20aviso\x20de\x20inatividade:\x20'+_0x11a4d6[_0x655ded(0x2d0)]);}}}}const _0xe3310=await Ticket_1[_0x655ded(0x219)][_0x655ded(0x24a)]({'where':{'status':_0x655ded(0x27c),'whatsappId':_0x23fadc['id'],'companyId':_0x23fadc[_0x655ded(0x2b6)],..._0x4b38a2,'updatedAt':{[sequelize_1['Op']['lt']]:(0x0,moment_1[_0x655ded(0x219)])()[_0x655ded(0x287)](_0x23fadc['expiresTicket'],'minutes')['toDate']()}},'include':[{'model':Contact_1[_0x655ded(0x219)],'as':_0x655ded(0x245)}]});for(const _0x43d923 of _0xe3310){try{_0x23fadc[_0x655ded(0x2d9)]&&(await(0x0,SendWhatsAppMessage_1[_0x655ded(0x219)])({'ticket':_0x43d923,'body':_0x23fadc['expiresInactiveMessage']}),await new Promise(_0x447dd1=>setTimeout(_0x447dd1,0x3e8)));await _0x43d923[_0x655ded(0x23c)]({'status':'closed','amountUsedBotQueues':0x0,'ticketsWithWarning':![]});const _0x2e2c5a=(0x0,socket_1[_0x655ded(0x27d)])();_0x2e2c5a['to'](_0x655ded(0x23e)+_0x43d923['companyId']+_0x655ded(0x2dd))['to'](_0x655ded(0x1ef)+_0x43d923['queueId']+_0x655ded(0x2dd))['emit'](_0x655ded(0x23e)+_0x43d923['companyId']+_0x655ded(0x231),{'action':_0x655ded(0x23c),'ticket':{..._0x43d923[_0x655ded(0x223)],'status':_0x655ded(0x256)}}),_0x2e2c5a['to'](_0x655ded(0x23e)+_0x43d923[_0x655ded(0x2b6)]+'-closed')[_0x655ded(0x253)](_0x655ded(0x23e)+_0x43d923[_0x655ded(0x2b6)]+'-ticket',{'action':'update','ticket':{..._0x43d923[_0x655ded(0x223)],'status':'closed'}}),logger_1[_0x655ded(0x267)]['info'](_0x655ded(0x27a)+_0x43d923['id']+_0x655ded(0x22a)+_0x23fadc['expiresTicket']+_0x655ded(0x265));}catch(_0x52edd0){Sentry[_0x655ded(0x248)](_0x52edd0),logger_1['logger'][_0x655ded(0x1ea)](_0x655ded(0x20c)+_0x52edd0[_0x655ded(0x2d0)]);}}_0xe3310[_0x655ded(0x203)]>0x0&&logger_1[_0x655ded(0x267)]['info'](_0xe3310[_0x655ded(0x203)]+'\x20tickets\x20fechados\x20por\x20inatividade\x20para\x20a\x20empresa\x20'+_0x23fadc['companyId']);}}catch(_0x4bad60){Sentry['captureException'](_0x4bad60),logger_1[_0x655ded(0x267)][_0x655ded(0x1ea)](_0x655ded(0x1fc),_0x4bad60[_0x655ded(0x2d0)]);}}exports[a344_0x5aed11(0x2de)]=new bull_1[(a344_0x5aed11(0x219))](a344_0x5aed11(0x277),connection);async function handleSendMessage(_0x499e48){const _0x37c9ca=a344_0x5aed11;try{const {data:_0x5ead82}=_0x499e48,_0x4471a5=await Whatsapp_1[_0x37c9ca(0x219)][_0x37c9ca(0x290)](_0x5ead82[_0x37c9ca(0x28e)]);if(_0x4471a5==null)throw Error(_0x37c9ca(0x1f8));const _0x59c37b=_0x5ead82['data'];await(0x0,SendMessage_1[_0x37c9ca(0x22c)])(_0x4471a5,_0x59c37b);}catch(_0x1ad80c){Sentry[_0x37c9ca(0x248)](_0x1ad80c),logger_1[_0x37c9ca(0x267)][_0x37c9ca(0x1ea)](_0x37c9ca(0x202),_0x1ad80c[_0x37c9ca(0x2d0)]);throw _0x1ad80c;}}async function handleVerifySchedules(){const _0xfaf764=a344_0x5aed11;try{const {count:_0xb56639,rows:_0x1aebf8}=await Schedule_1[_0xfaf764(0x219)][_0xfaf764(0x250)]({'where':{'status':_0xfaf764(0x2c8),'sentAt':null,'sendAt':{[sequelize_1['Op'][_0xfaf764(0x2b2)]]:(0x0,moment_1[_0xfaf764(0x219)])()['format']('YYYY-MM-DD\x20HH:mm:ss'),[sequelize_1['Op'][_0xfaf764(0x2af)]]:(0x0,moment_1[_0xfaf764(0x219)])()[_0xfaf764(0x282)]('30',_0xfaf764(0x2ab))['format']('YYYY-MM-DD\x20HH:mm:ss')}},'include':[{'model':Contact_1[_0xfaf764(0x219)],'as':_0xfaf764(0x245)}]});_0xb56639>0x0&&_0x1aebf8[_0xfaf764(0x271)](async _0x49719a=>{const _0x5e7866=_0xfaf764;await _0x49719a[_0x5e7866(0x23c)]({'status':_0x5e7866(0x264)}),exports[_0x5e7866(0x258)]['add'](_0x5e7866(0x22c),{'schedule':_0x49719a},{'delay':0x9c40}),logger_1[_0x5e7866(0x267)][_0x5e7866(0x24e)](_0x5e7866(0x228)+_0x49719a[_0x5e7866(0x245)]['name']);});}catch(_0xe18a63){Sentry[_0xfaf764(0x248)](_0xe18a63),logger_1[_0xfaf764(0x267)][_0xfaf764(0x1ea)](_0xfaf764(0x2b8),_0xe18a63[_0xfaf764(0x2d0)]);throw _0xe18a63;}}async function handleSendScheduledMessage(_0x5bb46d){const _0xe2f98a=a344_0x5aed11,{data:{schedule:_0xc7df0c}}=_0x5bb46d;let _0x569a3f=null;try{_0x569a3f=await Schedule_1[_0xe2f98a(0x219)][_0xe2f98a(0x290)](_0xc7df0c['id']);}catch(_0x5c05db){Sentry['captureException'](_0x5c05db),logger_1[_0xe2f98a(0x267)]['info'](_0xe2f98a(0x24c)+_0xc7df0c['id']);}try{const _0x47dece=await(0x0,GetDefaultWhatsApp_1['default'])(_0xc7df0c['companyId']),_0x355fea=await(0x0,SendMessage_1[_0xe2f98a(0x22c)])(_0x47dece,{'number':_0xc7df0c[_0xe2f98a(0x245)][_0xe2f98a(0x206)],'body':_0xc7df0c[_0xe2f98a(0x28c)]});_0xc7df0c[_0xe2f98a(0x200)]&&(0x0,wbotMessageListener_1['handleMessage'])(_0x355fea,await(0x0,GetWhatsappWbot_1['default'])(_0x47dece),_0xc7df0c['companyId']),await _0x569a3f?.[_0xe2f98a(0x23c)]({'sentAt':new Date(),'status':_0xe2f98a(0x2ca)}),logger_1[_0xe2f98a(0x267)][_0xe2f98a(0x24e)](_0xe2f98a(0x274)+_0xc7df0c[_0xe2f98a(0x245)][_0xe2f98a(0x1fd)]),exports[_0xe2f98a(0x258)][_0xe2f98a(0x2cc)](0x3a98,_0xe2f98a(0x288));}catch(_0x553c4a){Sentry[_0xe2f98a(0x248)](_0x553c4a),await _0x569a3f?.['update']({'status':_0xe2f98a(0x252)}),logger_1[_0xe2f98a(0x267)][_0xe2f98a(0x1ea)]('SendScheduledMessage\x20->\x20SendMessage:\x20error',_0x553c4a[_0xe2f98a(0x2d0)]);throw _0x553c4a;}}async function handleVerifyCampaigns(){const _0x104207=a344_0x5aed11,_0x2af3a0=await database_1[_0x104207(0x219)][_0x104207(0x24b)](_0x104207(0x247),{'type':sequelize_1[_0x104207(0x2ad)]['SELECT']});_0x2af3a0[_0x104207(0x203)]&&logger_1[_0x104207(0x267)][_0x104207(0x24e)](_0x104207(0x272)+_0x2af3a0[_0x104207(0x203)]),_0x2af3a0['forEach'](_0x3999a8=>{const _0x3e4f93=_0x104207;try{const _0x19e960=(0x0,moment_1[_0x3e4f93(0x219)])(),_0x40d9ba=(0x0,moment_1[_0x3e4f93(0x219)])(_0x3999a8[_0x3e4f93(0x238)]),_0x580c00=_0x40d9ba['diff'](_0x19e960,_0x3e4f93(0x212));logger_1[_0x3e4f93(0x267)][_0x3e4f93(0x24e)](_0x3e4f93(0x2db)+_0x3999a8['id']+',\x20Delay\x20Inicial='+_0x580c00),exports['campaignQueue']['add'](_0x3e4f93(0x1f3),{'id':_0x3999a8['id'],'delay':_0x580c00},{'removeOnComplete':!![]});}catch(_0x4f86ee){Sentry['captureException'](_0x4f86ee);}});}async function getCampaign(_0x22e8f1){const _0x45012d=a344_0x5aed11;return Campaign_1[_0x45012d(0x219)][_0x45012d(0x290)](_0x22e8f1,{'include':[{'model':ContactList_1[_0x45012d(0x219)],'as':_0x45012d(0x2cd),'attributes':['id',_0x45012d(0x1fd)],'include':[{'model':ContactListItem_1['default'],'as':_0x45012d(0x224),'attributes':['id',_0x45012d(0x1fd),_0x45012d(0x206),_0x45012d(0x21b),_0x45012d(0x2c7)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1[_0x45012d(0x219)],'as':_0x45012d(0x2c3),'attributes':['id',_0x45012d(0x1fd)]},{'model':CampaignShipping_1[_0x45012d(0x219)],'as':_0x45012d(0x24f),'include':[{'model':ContactListItem_1[_0x45012d(0x219)],'as':_0x45012d(0x245)}]}]});}async function getSettings(_0x1bb790){const _0x4df1a5=a344_0x5aed11,_0x436545=await CampaignSetting_1[_0x4df1a5(0x219)][_0x4df1a5(0x24a)]({'where':{'companyId':_0x1bb790[_0x4df1a5(0x2b6)]},'attributes':[_0x4df1a5(0x22d),_0x4df1a5(0x251)]});let _0x415b04=0x14,_0x8592a=0x14,_0x334f80=0x3c,_0xb67225=[];return _0x436545['forEach'](_0x1efa74=>{const _0x3f81c3=_0x4df1a5;_0x1efa74[_0x3f81c3(0x22d)]===_0x3f81c3(0x28d)&&(_0x415b04=JSON[_0x3f81c3(0x2b1)](_0x1efa74[_0x3f81c3(0x251)])),_0x1efa74[_0x3f81c3(0x22d)]===_0x3f81c3(0x27b)&&(_0x8592a=JSON['parse'](_0x1efa74[_0x3f81c3(0x251)])),_0x1efa74['key']===_0x3f81c3(0x1f4)&&(_0x334f80=JSON['parse'](_0x1efa74['value'])),_0x1efa74['key']==='variables'&&(_0xb67225=JSON[_0x3f81c3(0x2b1)](_0x1efa74[_0x3f81c3(0x251)]));}),{'messageInterval':_0x415b04,'longerIntervalAfter':_0x8592a,'greaterInterval':_0x334f80,'variables':_0xb67225};}function parseToMilliseconds(_0x3ca13e){return _0x3ca13e*0x3e8;}async function sleep(_0x22c864){const _0x4f183b=a344_0x5aed11;return logger_1[_0x4f183b(0x267)][_0x4f183b(0x24e)](_0x4f183b(0x201)+_0x22c864+_0x4f183b(0x2d3)+(0x0,moment_1[_0x4f183b(0x219)])()[_0x4f183b(0x2bd)](_0x4f183b(0x289))),new Promise(_0x1693ad=>{setTimeout(()=>{const _0x525626=a344_0xf7ef;logger_1[_0x525626(0x267)][_0x525626(0x24e)](_0x525626(0x201)+_0x22c864+_0x525626(0x227)+(0x0,moment_1[_0x525626(0x219)])()[_0x525626(0x2bd)]('HH:mm:ss')),_0x1693ad(!![]);},parseToMilliseconds(_0x22c864));});}function getCampaignValidMessages(_0x5b6ca2){const _0x35039d=a344_0x5aed11,_0x395252=[];return!(0x0,lodash_1[_0x35039d(0x2df)])(_0x5b6ca2[_0x35039d(0x220)])&&!(0x0,lodash_1[_0x35039d(0x2d4)])(_0x5b6ca2[_0x35039d(0x220)])&&_0x395252[_0x35039d(0x2b5)](_0x5b6ca2[_0x35039d(0x220)]),!(0x0,lodash_1['isEmpty'])(_0x5b6ca2[_0x35039d(0x26a)])&&!(0x0,lodash_1[_0x35039d(0x2d4)])(_0x5b6ca2[_0x35039d(0x26a)])&&_0x395252[_0x35039d(0x2b5)](_0x5b6ca2[_0x35039d(0x26a)]),!(0x0,lodash_1['isEmpty'])(_0x5b6ca2[_0x35039d(0x222)])&&!(0x0,lodash_1[_0x35039d(0x2d4)])(_0x5b6ca2['message3'])&&_0x395252['push'](_0x5b6ca2[_0x35039d(0x222)]),!(0x0,lodash_1[_0x35039d(0x2df)])(_0x5b6ca2['message4'])&&!(0x0,lodash_1[_0x35039d(0x2d4)])(_0x5b6ca2[_0x35039d(0x2d7)])&&_0x395252['push'](_0x5b6ca2[_0x35039d(0x2d7)]),!(0x0,lodash_1[_0x35039d(0x2df)])(_0x5b6ca2[_0x35039d(0x2d8)])&&!(0x0,lodash_1[_0x35039d(0x2d4)])(_0x5b6ca2[_0x35039d(0x2d8)])&&_0x395252[_0x35039d(0x2b5)](_0x5b6ca2[_0x35039d(0x2d8)]),_0x395252;}function getCampaignValidConfirmationMessages(_0x1500be){const _0x64a9cc=a344_0x5aed11,_0x407fdb=[];return!(0x0,lodash_1[_0x64a9cc(0x2df)])(_0x1500be[_0x64a9cc(0x2c2)])&&!(0x0,lodash_1[_0x64a9cc(0x2d4)])(_0x1500be[_0x64a9cc(0x2c2)])&&_0x407fdb['push'](_0x1500be[_0x64a9cc(0x2c2)]),!(0x0,lodash_1[_0x64a9cc(0x2df)])(_0x1500be[_0x64a9cc(0x205)])&&!(0x0,lodash_1['isNil'])(_0x1500be['confirmationMessage2'])&&_0x407fdb[_0x64a9cc(0x2b5)](_0x1500be[_0x64a9cc(0x205)]),!(0x0,lodash_1[_0x64a9cc(0x2df)])(_0x1500be['confirmationMessage3'])&&!(0x0,lodash_1[_0x64a9cc(0x2d4)])(_0x1500be[_0x64a9cc(0x257)])&&_0x407fdb['push'](_0x1500be[_0x64a9cc(0x257)]),!(0x0,lodash_1[_0x64a9cc(0x2df)])(_0x1500be[_0x64a9cc(0x229)])&&!(0x0,lodash_1[_0x64a9cc(0x2d4)])(_0x1500be[_0x64a9cc(0x229)])&&_0x407fdb[_0x64a9cc(0x2b5)](_0x1500be[_0x64a9cc(0x229)]),!(0x0,lodash_1[_0x64a9cc(0x2df)])(_0x1500be[_0x64a9cc(0x25c)])&&!(0x0,lodash_1['isNil'])(_0x1500be[_0x64a9cc(0x25c)])&&_0x407fdb[_0x64a9cc(0x2b5)](_0x1500be[_0x64a9cc(0x25c)]),_0x407fdb;}function getProcessedMessage(_0x1666d1,_0x319c32,_0x5a7bcb){const _0xd19a45=a344_0x5aed11;let _0x44d75a=_0x1666d1;return _0x44d75a[_0xd19a45(0x2d5)](_0xd19a45(0x29c))&&(_0x44d75a=_0x44d75a[_0xd19a45(0x23f)](/{nome}/g,_0x5a7bcb[_0xd19a45(0x1fd)])),_0x44d75a[_0xd19a45(0x2d5)](_0xd19a45(0x208))&&(_0x44d75a=_0x44d75a[_0xd19a45(0x23f)](/{email}/g,_0x5a7bcb['email'])),_0x44d75a[_0xd19a45(0x2d5)](_0xd19a45(0x2bf))&&(_0x44d75a=_0x44d75a['replace'](/{numero}/g,_0x5a7bcb[_0xd19a45(0x206)])),_0x319c32[_0xd19a45(0x26c)](_0x382ae5=>{const _0x3c8124=_0xd19a45;if(_0x44d75a['includes']('{'+_0x382ae5[_0x3c8124(0x22d)]+'}')){const _0x20a24a=new RegExp('{'+_0x382ae5[_0x3c8124(0x22d)]+'}','g');_0x44d75a=_0x44d75a[_0x3c8124(0x23f)](_0x20a24a,_0x382ae5['value']);}}),_0x44d75a;}function randomValue(_0x3a8e68,_0x3c05a9){const _0x42af1d=a344_0x5aed11;return Math[_0x42af1d(0x230)](Math[_0x42af1d(0x273)]()*_0x3c05a9)+_0x3a8e68;}async function verifyAndFinalizeCampaign(_0x3c6069){const _0x1b1a59=a344_0x5aed11,_0x5640ba=await(0x0,ShowService_1['default'])(_0x3c6069['id']);_0x5640ba[_0x1b1a59(0x235)]===_0x5640ba[_0x1b1a59(0x286)]&&await _0x3c6069['update']({'status':_0x1b1a59(0x2ce),'completedAt':(0x0,moment_1[_0x1b1a59(0x219)])()});const _0x407fcd=(0x0,socket_1['getIO'])();_0x407fcd[_0x1b1a59(0x253)](_0x1b1a59(0x23e)+_0x3c6069['companyId']+_0x1b1a59(0x2ae),_0x5640ba);}async function prepareContact(_0x317846,_0x5c6fab,_0xdac42b,_0x477fb8,_0x58daa8,_0x609964){const _0x2a00cc=a344_0x5aed11,_0x53f521={};_0x53f521['number']=_0xdac42b['number'],_0x53f521[_0x2a00cc(0x261)]=_0xdac42b['id'],_0x53f521['campaignId']=_0x317846['id'];if(_0x58daa8['length']){const _0x39e77d=randomValue(0x0,_0x58daa8[_0x2a00cc(0x203)]),_0x2b2fc8=getProcessedMessage(_0x58daa8[_0x39e77d],_0x5c6fab,_0xdac42b);_0x53f521[_0x2a00cc(0x2d0)]=''+_0x2b2fc8;}if(_0x317846[_0x2a00cc(0x20e)]){if(_0x609964[_0x2a00cc(0x203)]){const _0x55fa12=randomValue(0x0,_0x609964[_0x2a00cc(0x203)]),_0x3452b4=getProcessedMessage(_0x609964[_0x55fa12],_0x5c6fab,_0xdac42b);_0x53f521[_0x2a00cc(0x1f9)]=''+_0x3452b4;}}const [_0x5ec40,_0x49e0c0]=await CampaignShipping_1[_0x2a00cc(0x219)][_0x2a00cc(0x2da)]({'where':{'campaignId':_0x53f521['campaignId'],'contactId':_0x53f521[_0x2a00cc(0x261)]},'defaults':_0x53f521});!_0x49e0c0&&_0x5ec40[_0x2a00cc(0x297)]===null&&_0x5ec40[_0x2a00cc(0x25d)]===null&&(_0x5ec40[_0x2a00cc(0x24d)](_0x53f521),await _0x5ec40[_0x2a00cc(0x2b7)]());if(_0x5ec40[_0x2a00cc(0x297)]===null&&_0x5ec40[_0x2a00cc(0x25d)]===null){const _0x40ca36=await exports[_0x2a00cc(0x2de)][_0x2a00cc(0x282)](_0x2a00cc(0x28a),{'campaignId':_0x317846['id'],'campaignShippingId':_0x5ec40['id'],'contactListItemId':_0xdac42b['id']},{'delay':_0x477fb8});await _0x5ec40[_0x2a00cc(0x23c)]({'jobId':''+_0x40ca36['id']});}}async function handleProcessCampaign(_0x44a8be){const _0x22239a=a344_0x5aed11;try{const {id:_0x2f0a59}=_0x44a8be[_0x22239a(0x240)];let {delay:_0x120a34}=_0x44a8be[_0x22239a(0x240)];const _0x3f1ee7=await getCampaign(_0x2f0a59),_0x360280=await getSettings(_0x3f1ee7);if(_0x3f1ee7){const {contacts:_0x367255}=_0x3f1ee7[_0x22239a(0x2cd)],_0x1230c5=getCampaignValidMessages(_0x3f1ee7),_0x5f4297=_0x3f1ee7[_0x22239a(0x20e)]?getCampaignValidConfirmationMessages(_0x3f1ee7):null;if((0x0,lodash_1[_0x22239a(0x296)])(_0x367255)){let _0xe88ada=0x0;_0x367255[_0x22239a(0x26c)](_0x37b01e=>{const _0x2fdd6c=_0x22239a;prepareContact(_0x3f1ee7,_0x360280[_0x2fdd6c(0x2b3)],_0x37b01e,_0x120a34,_0x1230c5,_0x5f4297)['then'](()=>{const _0x3b5cf5=_0x2fdd6c;logger_1[_0x3b5cf5(0x267)][_0x3b5cf5(0x24e)](_0x3b5cf5(0x244)+_0x3f1ee7['id']+_0x3b5cf5(0x2a6)+_0x37b01e[_0x3b5cf5(0x1fd)]+_0x3b5cf5(0x237)+_0x120a34);}),_0xe88ada+=0x1,_0xe88ada%_0x360280[_0x2fdd6c(0x27b)]===0x0?_0x120a34+=parseToMilliseconds(_0x360280[_0x2fdd6c(0x1f4)]):_0x120a34+=parseToMilliseconds(randomValue(0x0,_0x360280[_0x2fdd6c(0x28d)]));}),await _0x3f1ee7[_0x22239a(0x23c)]({'status':_0x22239a(0x21e)});}}}catch(_0x4b3139){Sentry[_0x22239a(0x248)](_0x4b3139);}}async function handleDispatchCampaign(_0x1f0607){const _0x5ccde3=a344_0x5aed11;try{const {data:_0x248f63}=_0x1f0607,{campaignShippingId:_0xdf47ad,campaignId:_0x40a82b}=_0x248f63,_0x5c36d8=await Campaign_1['default'][_0x5ccde3(0x290)](_0x40a82b,{'include':[{'model':Whatsapp_1['default'],'as':_0x5ccde3(0x2c3)}]});if(!_0x5c36d8){logger_1[_0x5ccde3(0x267)]['error']({'data':_0x248f63},'Campaign\x20not\x20found');return;}const _0x5f2102=await(0x0,GetWhatsappWbot_1[_0x5ccde3(0x219)])(_0x5c36d8[_0x5ccde3(0x2c3)]);logger_1['logger'][_0x5ccde3(0x24e)](_0x5ccde3(0x2a7)+_0x40a82b+';Registro='+_0xdf47ad);const _0x33c4c1=await CampaignShipping_1[_0x5ccde3(0x219)][_0x5ccde3(0x290)](_0xdf47ad,{'include':[{'model':ContactListItem_1['default'],'as':_0x5ccde3(0x245)}]}),_0x3465d8=_0x33c4c1[_0x5ccde3(0x206)]+'@s.whatsapp.net';if(_0x5c36d8[_0x5ccde3(0x20e)]&&_0x33c4c1[_0x5ccde3(0x20e)]===null)await _0x5f2102[_0x5ccde3(0x2d6)](_0x3465d8,{'text':_0x33c4c1[_0x5ccde3(0x1f9)]}),await _0x33c4c1['update']({'confirmationRequestedAt':(0x0,moment_1[_0x5ccde3(0x219)])()});else{await _0x5f2102['sendMessage'](_0x3465d8,{'text':_0x33c4c1[_0x5ccde3(0x2d0)]});if(_0x5c36d8['mediaPath']){const _0x37fdfb=path_1['default'][_0x5ccde3(0x20f)](_0x5ccde3(0x214),_0x5c36d8[_0x5ccde3(0x210)]),_0x5c04ee=await(0x0,SendWhatsAppMedia_1[_0x5ccde3(0x239)])(_0x5c36d8[_0x5ccde3(0x1ec)],_0x37fdfb);Object['keys'](_0x5c04ee)[_0x5ccde3(0x203)]&&await _0x5f2102[_0x5ccde3(0x2d6)](_0x3465d8,{..._0x5c04ee});}await _0x33c4c1[_0x5ccde3(0x23c)]({'deliveredAt':(0x0,moment_1[_0x5ccde3(0x219)])()});}await verifyAndFinalizeCampaign(_0x5c36d8);const _0x25e1e0=(0x0,socket_1[_0x5ccde3(0x27d)])();_0x25e1e0[_0x5ccde3(0x253)]('company-'+_0x5c36d8['companyId']+_0x5ccde3(0x2ae),{'action':_0x5ccde3(0x23c),'record':_0x5c36d8}),logger_1[_0x5ccde3(0x267)]['info'](_0x5ccde3(0x266)+_0x40a82b+';Contato='+_0x33c4c1[_0x5ccde3(0x245)][_0x5ccde3(0x1fd)]);}catch(_0x429105){Sentry[_0x5ccde3(0x248)](_0x429105),logger_1[_0x5ccde3(0x267)][_0x5ccde3(0x1ea)](_0x429105['message']);}}async function handleLoginStatus(){const _0x48086b=a344_0x5aed11,_0x364dd0=await database_1[_0x48086b(0x219)][_0x48086b(0x24b)](_0x48086b(0x1e9),{'type':sequelize_1[_0x48086b(0x2ad)]['SELECT']});_0x364dd0['forEach'](async _0x173cfd=>{const _0x1985f4=_0x48086b;try{const _0x41d27d=await User_1[_0x1985f4(0x219)][_0x1985f4(0x290)](_0x173cfd['id']);await _0x41d27d[_0x1985f4(0x23c)]({'online':![]}),logger_1[_0x1985f4(0x267)][_0x1985f4(0x24e)](_0x1985f4(0x28f)+_0x173cfd['id']);}catch(_0x49af49){Sentry[_0x1985f4(0x248)](_0x49af49);}});}async function handleInvoiceCreate(){const _0x417237=a344_0x5aed11,_0x1b1200=new cron_1[(_0x417237(0x2a0))]('0\x20*\x20*\x20*\x20*\x20*',async()=>{const _0x30928e=_0x417237,_0x3311ed=await Company_1[_0x30928e(0x219)][_0x30928e(0x24a)]();_0x3311ed[_0x30928e(0x271)](async _0x380a84=>{const _0x352e14=_0x30928e,{dueDate:_0x45afa5}=_0x380a84,_0xc25bd2=(0x0,moment_1[_0x352e14(0x219)])(_0x45afa5)[_0x352e14(0x2bd)](),_0xf561ea=(0x0,moment_1[_0x352e14(0x219)])()[_0x352e14(0x2bd)](),_0x16fe40=(0x0,moment_1[_0x352e14(0x219)])((0x0,moment_1['default'])())['format'](_0x352e14(0x23d)),_0x48b61d=(0x0,moment_1['default'])(_0x45afa5)[_0x352e14(0x2bd)]('DD/MM/yyyy'),_0x9028b1=(0x0,moment_1[_0x352e14(0x219)])(_0x48b61d,_0x352e14(0x23d))[_0x352e14(0x1ee)]((0x0,moment_1[_0x352e14(0x219)])(_0x16fe40,_0x352e14(0x23d))),_0x275e50=moment_1[_0x352e14(0x219)][_0x352e14(0x2bc)](_0x9028b1)[_0x352e14(0x232)]();if(_0x275e50<0x14){const _0x4af29b=await Plan_1[_0x352e14(0x219)][_0x352e14(0x290)](_0x380a84[_0x352e14(0x284)]),_0x20f1d1=_0x352e14(0x1f5)+_0x380a84['id']+_0x352e14(0x21a)+(0x0,moment_1['default'])(_0x45afa5)[_0x352e14(0x2bd)](_0x352e14(0x2dc))+'%\x27;',_0x4ae8bb=await database_1[_0x352e14(0x219)][_0x352e14(0x24b)](_0x20f1d1,{'type':sequelize_1[_0x352e14(0x2ad)]['SELECT']});if(+_0x4ae8bb[0x0]['mycount']===0x0){const _0x31ef59=_0x352e14(0x262)+_0x4af29b[_0x352e14(0x1fd)]+_0x352e14(0x26f)+_0x4af29b[_0x352e14(0x251)]+_0x352e14(0x2c1)+_0xf561ea+_0x352e14(0x2c1)+_0xf561ea+_0x352e14(0x2c1)+_0xc25bd2+_0x352e14(0x275)+_0x380a84['id']+');';await database_1[_0x352e14(0x219)][_0x352e14(0x24b)](_0x31ef59,{'type':sequelize_1[_0x352e14(0x2ad)][_0x352e14(0x292)]});}}});});_0x1b1200[_0x417237(0x2cb)]();}handleInvoiceCreate();async function startQueueProcess(){const _0x43c41d=a344_0x5aed11;logger_1['logger'][_0x43c41d(0x24e)]('Iniciando\x20processamento\x20de\x20filas'),exports['messageQueue'][_0x43c41d(0x298)](_0x43c41d(0x22c),handleSendMessage),exports[_0x43c41d(0x2d2)]['process'](_0x43c41d(0x221),handleVerifySchedules),exports[_0x43c41d(0x258)][_0x43c41d(0x298)](_0x43c41d(0x22c),handleSendScheduledMessage),exports['campaignQueue'][_0x43c41d(0x298)]('VerifyCampaignsDaatabase',handleVerifyCampaigns),exports[_0x43c41d(0x2de)][_0x43c41d(0x298)](_0x43c41d(0x1f3),handleProcessCampaign),exports[_0x43c41d(0x2de)]['process'](_0x43c41d(0x28a),handleDispatchCampaign),exports[_0x43c41d(0x2a8)][_0x43c41d(0x298)](_0x43c41d(0x29d),handleLoginStatus),exports[_0x43c41d(0x2de)][_0x43c41d(0x298)](_0x43c41d(0x29a),handleDispatchCampaign),exports['ticketMonitor'][_0x43c41d(0x298)](_0x43c41d(0x23b),handleVerifyTicketExpiration),exports[_0x43c41d(0x285)]['process'](_0x43c41d(0x278),handleWhatsappAutoRestart),exports[_0x43c41d(0x2d2)]['add'](_0x43c41d(0x221),{},{'repeat':{'cron':'*/5\x20*\x20*\x20*\x20*\x20*'},'removeOnComplete':!![]}),exports[_0x43c41d(0x2de)]['add'](_0x43c41d(0x260),{},{'repeat':{'cron':_0x43c41d(0x215)},'removeOnComplete':!![]}),exports['userMonitor'][_0x43c41d(0x282)]('VerifyLoginStatus',{},{'repeat':{'cron':'*\x20*\x20*\x20*\x20*'},'removeOnComplete':!![]}),exports['ticketMonitor']['add'](_0x43c41d(0x23b),{},{'repeat':{'cron':_0x43c41d(0x269)},'removeOnComplete':!![]}),exports[_0x43c41d(0x285)]['add']('AutoRestart',{},{'repeat':{'cron':_0x43c41d(0x26e)},'removeOnComplete':!![]});}