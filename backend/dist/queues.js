const a311_0x9ee590=a311_0x3d01;(function(_0x4a226c,_0x251c62){const _0x319699=a311_0x3d01,_0x3ccfdc=_0x4a226c();while(!![]){try{const _0x3d0e7d=-parseInt(_0x319699(0x229))/0x1*(parseInt(_0x319699(0x22a))/0x2)+-parseInt(_0x319699(0x1fd))/0x3*(-parseInt(_0x319699(0x1be))/0x4)+parseInt(_0x319699(0x210))/0x5*(parseInt(_0x319699(0x251))/0x6)+-parseInt(_0x319699(0x1e9))/0x7*(-parseInt(_0x319699(0x22d))/0x8)+-parseInt(_0x319699(0x1fb))/0x9+-parseInt(_0x319699(0x1ca))/0xa*(-parseInt(_0x319699(0x22c))/0xb)+-parseInt(_0x319699(0x21d))/0xc*(parseInt(_0x319699(0x235))/0xd);if(_0x3d0e7d===_0x251c62)break;else _0x3ccfdc['push'](_0x3ccfdc['shift']());}catch(_0x5a33c0){_0x3ccfdc['push'](_0x3ccfdc['shift']());}}}(a311_0x2722,0x74c2b));const a311_0x287f83=(function(){let _0x5be60b=!![];return function(_0x35dd9a,_0x24ab50){const _0x3073c9=_0x5be60b?function(){const _0x5c98e7=a311_0x3d01;if(_0x24ab50){const _0x21a266=_0x24ab50[_0x5c98e7(0x1d4)](_0x35dd9a,arguments);return _0x24ab50=null,_0x21a266;}}:function(){};return _0x5be60b=![],_0x3073c9;};}()),a311_0x430228=a311_0x287f83(this,function(){const _0x3757ec=a311_0x3d01;return a311_0x430228[_0x3757ec(0x1c3)]()[_0x3757ec(0x232)](_0x3757ec(0x1cd))['toString']()['constructor'](a311_0x430228)[_0x3757ec(0x232)](_0x3757ec(0x1cd));});a311_0x430228();function a311_0x2722(){const _0x343187=['findAndCountAll','1715820nrOmun','prototype','verifyCampaignMessageAndCloseTicket','messageQueue','HH:mm:ss','Worker','./models/Whatsapp','value','\x20segundos\x20iniciado:\x20','info','bullmq','VerifyQueueStatus','206ThnSTp','6694VbaXLH','Sequelize','11epFiET','16yPsplh','planId','captureException','getMinutes','timeSendQueue','search','Atendimento\x20Perdido:\x20','failed','104RbJKeH','./services/WbotServices/MarkDeleteWhatsAppMessage','generalMonitor','REDIS_PASSWORD','status@broadcast','campaignQueue','Iniciando\x20geração\x20de\x20boletos','floor','VerifyLoginStatus','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','default','userMonitor','./workers/campaingJob','./libs/socket','\x20-\x20Empresa:\x20','REDIS_PORT','randomValue','number','Queue','log','\x20segundos\x20finalizado:\x20','minutes','InvoiceCreate','key','findAll','getQueue','Iniciando\x20processamento\x20de\x20filas','call','372RFeFtC','__importDefault','messages','CampaignQueue','./models/Ticket','writable','defineProperty','./services/WbotServices/wbotMessageListener','27184UfROCq','VerifySchedules','findByPk','error','setHours','toString','VerifyCampaigns','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','-ticket','MessageUpdateJob','diff','data','5400570jkIMWF','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','name','(((.+)+)+)+$','MessageQueue\x20->\x20SendMessage:\x20error','getIO','REDIS_URI','utc','Sleep\x20de\x20','whatsappId','apply','DD/MM/yyyy','__esModule','getOwnPropertyDescriptor','ClosedAllOpenTickets','SendMessage','readMessages','parseToMilliseconds','whatsapps','GeneralMonitor','\x20completed','configurable','./models/Contact','UserMonitor','remoteJid','sendIdQueue','CloseTicketsAutomatic','sequelize','./models/Plan','pending','CURRENT_DATE','2956359KQKQhP','YYYY-MM-DD','companyId','CONNECTED','-notification','reload','create','count','handleMsgAck','QueueMonitor','format','\x20failed\x20with\x20error:\x20','verify','127.0.0.1','endsWith','add','completed','extraInfo','1412460snRnYS','logger','93hersBv','profilePicUrl','setMinutes','./utils/logger','subtract','message','isInteger','status','update','./helpers/SendMessage','getWbot','messageUpdate','ClosedAllOpenTickets\x20->\x20Verify:\x20error','duration','asDays','company-','Job\x20','./workers/scheduledMessageJob','startQueueProcess','70415SakkKN','queueMonitor','env','REDIS_HOST','contact','map','ScheduleMonitor','messageStubType','scheduleMonitor','SearchForQueue\x20->\x20VerifyQueue:\x20error','hasOwnProperty','MessageQueue'];a311_0x2722=function(){return _0x343187;};return a311_0x2722();}'use strict';var __createBinding=this&&this['__createBinding']||(Object[a311_0x9ee590(0x1ef)]?function(_0x328152,_0x4b59e,_0x9de3aa,_0x13a1eb){const _0x2e590b=a311_0x9ee590;if(_0x13a1eb===undefined)_0x13a1eb=_0x9de3aa;var _0xe5ac17=Object[_0x2e590b(0x1d7)](_0x4b59e,_0x9de3aa);(!_0xe5ac17||('get'in _0xe5ac17?!_0x4b59e[_0x2e590b(0x1d6)]:_0xe5ac17[_0x2e590b(0x1bb)]||_0xe5ac17[_0x2e590b(0x1df)]))&&(_0xe5ac17={'enumerable':!![],'get':function(){return _0x4b59e[_0x9de3aa];}}),Object['defineProperty'](_0x328152,_0x13a1eb,_0xe5ac17);}:function(_0x1c24f5,_0x2bcb15,_0x42a8b1,_0x5891c3){if(_0x5891c3===undefined)_0x5891c3=_0x42a8b1;_0x1c24f5[_0x5891c3]=_0x2bcb15[_0x42a8b1];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a311_0x9ee590(0x1ef)]?function(_0x2334d9,_0x5ea5a0){const _0x48320f=a311_0x9ee590;Object[_0x48320f(0x1bc)](_0x2334d9,_0x48320f(0x23f),{'enumerable':!![],'value':_0x5ea5a0});}:function(_0x57f9e3,_0x64a20d){const _0x576a40=a311_0x9ee590;_0x57f9e3[_0x576a40(0x23f)]=_0x64a20d;}),__importStar=this&&this['__importStar']||function(_0x991d13){const _0x2211f5=a311_0x9ee590;if(_0x991d13&&_0x991d13['__esModule'])return _0x991d13;var _0x3bb02a={};if(_0x991d13!=null){for(var _0x4e5e17 in _0x991d13)if(_0x4e5e17!==_0x2211f5(0x23f)&&Object[_0x2211f5(0x21e)][_0x2211f5(0x21a)][_0x2211f5(0x250)](_0x991d13,_0x4e5e17))__createBinding(_0x3bb02a,_0x991d13,_0x4e5e17);}return __setModuleDefault(_0x3bb02a,_0x991d13),_0x3bb02a;},__importDefault=this&&this[a311_0x9ee590(0x252)]||function(_0x1bc98d){const _0x4c9176=a311_0x9ee590;return _0x1bc98d&&_0x1bc98d[_0x4c9176(0x1d6)]?_0x1bc98d:{'default':_0x1bc98d};};Object[a311_0x9ee590(0x1bc)](exports,a311_0x9ee590(0x1d6),{'value':!![]}),exports[a311_0x9ee590(0x20f)]=exports[a311_0x9ee590(0x245)]=exports['sleep']=exports[a311_0x9ee590(0x1db)]=exports[a311_0x9ee590(0x23a)]=exports[a311_0x9ee590(0x218)]=exports['queueMonitor']=exports[a311_0x9ee590(0x220)]=exports['generalMonitor']=exports[a311_0x9ee590(0x240)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),bullmq_1=require(a311_0x9ee590(0x227)),SendMessage_1=require(a311_0x9ee590(0x206)),Whatsapp_1=__importDefault(require(a311_0x9ee590(0x223))),logger_1=require(a311_0x9ee590(0x200)),moment_1=__importDefault(require('moment')),Contact_1=__importDefault(require(a311_0x9ee590(0x1e0))),sequelize_1=require(a311_0x9ee590(0x1e5)),socket_1=require(a311_0x9ee590(0x242)),User_1=__importDefault(require('./models/User')),Company_1=__importDefault(require('./models/Company')),Plan_1=__importDefault(require(a311_0x9ee590(0x1e6))),Ticket_1=__importDefault(require(a311_0x9ee590(0x255))),wbotClosedTickets_1=require('./services/WbotServices/wbotClosedTickets'),Invoices_1=__importDefault(require('./models/Invoices')),wbotMessageListener_1=require(a311_0x9ee590(0x1bd)),wbot_1=require('./libs/wbot'),MarkDeleteWhatsAppMessage_1=__importDefault(require(a311_0x9ee590(0x236))),ioredis_1=__importDefault(require('ioredis')),campaingJob_1=__importDefault(require(a311_0x9ee590(0x241))),scheduledMessageJob_1=__importDefault(require(a311_0x9ee590(0x20e))),connection={'port':parseInt(process[a311_0x9ee590(0x212)][a311_0x9ee590(0x244)]),'host':process[a311_0x9ee590(0x212)][a311_0x9ee590(0x213)]||a311_0x9ee590(0x1f6),'password':process[a311_0x9ee590(0x212)][a311_0x9ee590(0x238)]},limiterMax=process['env']['REDIS_OPT_LIMITER_MAX']||0x1,limiterDuration=process[a311_0x9ee590(0x212)]['REDIS_OPT_LIMITER_DURATION']||0xbb8,redis=new ioredis_1[(a311_0x9ee590(0x23f))](process['env'][a311_0x9ee590(0x1d0)]);exports[a311_0x9ee590(0x240)]=new bullmq_1['Queue'](a311_0x9ee590(0x1e1),{'connection':connection}),exports['generalMonitor']=new bullmq_1[(a311_0x9ee590(0x247))](a311_0x9ee590(0x1dd),{'connection':connection}),exports['messageQueue']=new bullmq_1['Queue'](a311_0x9ee590(0x21b),{'connection':connection}),exports[a311_0x9ee590(0x211)]=new bullmq_1[(a311_0x9ee590(0x247))](a311_0x9ee590(0x1f2),{'connection':connection}),exports['scheduleMonitor']=new bullmq_1[(a311_0x9ee590(0x247))](a311_0x9ee590(0x216),{'connection':connection}),exports[a311_0x9ee590(0x23a)]=new bullmq_1[(a311_0x9ee590(0x247))](a311_0x9ee590(0x254),{'connection':connection});async function handleVerifyQueueOld(_0x3e507c){const _0x1ac501=a311_0x9ee590;logger_1[_0x1ac501(0x1fc)]['info'](_0x1ac501(0x1c5));try{const _0x4dd81a=await Company_1[_0x1ac501(0x23f)][_0x1ac501(0x24d)]({'attributes':['id',_0x1ac501(0x1cc)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1['Sequelize']['literal']('CURRENT_DATE')}},'include':[{'model':Whatsapp_1[_0x1ac501(0x23f)],'attributes':['id',_0x1ac501(0x1cc),_0x1ac501(0x204),_0x1ac501(0x231),_0x1ac501(0x1e3)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x4dd81a['map'](async _0x66c000=>{const _0x5e3596=_0x1ac501;_0x66c000[_0x5e3596(0x1dc)][_0x5e3596(0x215)](async _0xcaea76=>{const _0xc2e6a3=_0x5e3596;if(_0xcaea76[_0xc2e6a3(0x204)]===_0xc2e6a3(0x1ec)){var _0x199d64=_0x66c000['id'];const _0x2c31c1=_0xcaea76[_0xc2e6a3(0x231)]?_0xcaea76[_0xc2e6a3(0x231)]:0x0,_0x156a1b=_0xcaea76[_0xc2e6a3(0x1e3)],_0x5532fa=_0x2c31c1,_0x55a111=_0x156a1b,_0x147285=_0x5532fa;if(_0x2c31c1>0x0){if(!isNaN(_0x55a111)&&Number[_0xc2e6a3(0x203)](_0x55a111)&&!isNaN(_0x147285)&&Number[_0xc2e6a3(0x203)](_0x147285)){const _0x204aca=(0x0,moment_1['default'])()[_0xc2e6a3(0x201)](_0x147285,_0xc2e6a3(0x24a))[_0xc2e6a3(0x1d1)]()[_0xc2e6a3(0x1f3)](),{count:_0x513498,rows:_0x52d1ea}=await Ticket_1['default'][_0xc2e6a3(0x21c)]({'where':{'status':_0xc2e6a3(0x1e7),'queueId':null,'companyId':_0x199d64,'whatsappId':_0xcaea76['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x204aca}},'include':[{'model':Contact_1[_0xc2e6a3(0x23f)],'as':_0xc2e6a3(0x214),'attributes':['id','name',_0xc2e6a3(0x246),'email',_0xc2e6a3(0x1fe)],'include':[_0xc2e6a3(0x1fa)]}]});_0x513498>0x0?_0x52d1ea['map'](async _0x46c75e=>{const _0x47de07=_0xc2e6a3;await _0x46c75e[_0x47de07(0x205)]({'queueId':_0x55a111}),await _0x46c75e[_0x47de07(0x1ee)]();const _0x39dd1e=(0x0,socket_1[_0x47de07(0x1cf)])();_0x39dd1e['to'](_0x47de07(0x20c)+_0x46c75e[_0x47de07(0x1eb)]+'-'+_0x46c75e[_0x47de07(0x204)])['to'](_0x47de07(0x20c)+_0x46c75e['companyId']+_0x47de07(0x1ed))['to'](_0x46c75e['id'][_0x47de07(0x1c3)]())['emit'](_0x47de07(0x20c)+_0x199d64+_0x47de07(0x1c6),{'action':'update','ticket':_0x46c75e,'ticketId':_0x46c75e['id']}),logger_1[_0x47de07(0x1fc)]['info'](_0x47de07(0x233)+_0x46c75e['id']+_0x47de07(0x243)+_0x199d64);}):logger_1[_0xc2e6a3(0x1fc)][_0xc2e6a3(0x226)]('Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20'+_0x199d64);}else logger_1[_0xc2e6a3(0x1fc)][_0xc2e6a3(0x226)]('Condição\x20não\x20respeitada\x20-\x20Empresa:\x20'+_0x199d64);}}});});}catch(_0x1ea5dd){Sentry[_0x1ac501(0x22f)](_0x1ea5dd),logger_1['logger'][_0x1ac501(0x1c1)](_0x1ac501(0x219)+_0x1ea5dd);throw _0x1ea5dd;}};async function handleVerifyQueue(_0x57d511){const _0x52abba=a311_0x9ee590;logger_1['logger'][_0x52abba(0x226)](_0x52abba(0x1c5));try{const _0x31f245=await Company_1[_0x52abba(0x23f)][_0x52abba(0x24d)]({'attributes':['id',_0x52abba(0x1cc)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x52abba(0x22b)]['literal'](_0x52abba(0x1e8))}},'include':[{'model':Whatsapp_1[_0x52abba(0x23f)],'attributes':['id',_0x52abba(0x1cc),_0x52abba(0x204),_0x52abba(0x231),'sendIdQueue'],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x31f245[_0x52abba(0x215)](async _0x46ebb8=>{const _0x154c58=_0x52abba;_0x46ebb8['whatsapps'][_0x154c58(0x215)](async _0x956e53=>{const _0x538875=_0x154c58;if(_0x956e53[_0x538875(0x204)]===_0x538875(0x1ec)){const _0x25beb9=_0x46ebb8['id'],_0x7464d2=_0x956e53[_0x538875(0x231)]?_0x956e53[_0x538875(0x231)]:0x0,_0xef73b1=_0x956e53['sendIdQueue'],_0xe60cbf=_0x7464d2,_0x58291e=_0xef73b1,_0x1d6b0=_0xe60cbf;if(_0x7464d2>0x0&&!isNaN(_0x58291e)&&Number[_0x538875(0x203)](_0x58291e)&&!isNaN(_0x1d6b0)&&Number[_0x538875(0x203)](_0x1d6b0)){const _0x267ce6=(0x0,moment_1['default'])()[_0x538875(0x201)](_0x1d6b0,_0x538875(0x24a))['utc']()[_0x538875(0x1f3)](),{count:_0x45901e,rows:_0x48e43c}=await Ticket_1['default'][_0x538875(0x21c)]({'where':{'status':'pending','queueId':null,'companyId':_0x25beb9,'whatsappId':_0x956e53['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x267ce6}},'include':[{'model':Contact_1['default'],'as':_0x538875(0x214),'attributes':['id',_0x538875(0x1cc),_0x538875(0x246),'email',_0x538875(0x1fe)],'include':[_0x538875(0x1fa)]}]});_0x45901e>0x0?_0x48e43c[_0x538875(0x215)](async _0x3e8cc4=>{const _0x59cdd6=_0x538875;await _0x3e8cc4[_0x59cdd6(0x205)]({'queueId':_0x58291e}),await _0x3e8cc4[_0x59cdd6(0x1ee)]();const _0x499ef1=(0x0,socket_1[_0x59cdd6(0x1cf)])();_0x499ef1['to'](_0x59cdd6(0x20c)+_0x3e8cc4[_0x59cdd6(0x1eb)]+'-'+_0x3e8cc4['status'])['to'](_0x59cdd6(0x20c)+_0x3e8cc4['companyId']+_0x59cdd6(0x1ed))['to'](_0x3e8cc4['id']['toString']())['emit'](_0x59cdd6(0x20c)+_0x25beb9+'-ticket',{'action':_0x59cdd6(0x205),'ticket':_0x3e8cc4,'ticketId':_0x3e8cc4['id']}),logger_1[_0x59cdd6(0x1fc)][_0x59cdd6(0x226)]('Atendimento\x20Perdido:\x20'+_0x3e8cc4['id']+_0x59cdd6(0x243)+_0x25beb9);}):logger_1[_0x538875(0x1fc)][_0x538875(0x226)](_0x538875(0x23e)+_0x25beb9);}else logger_1['logger'][_0x538875(0x226)](_0x538875(0x1cb)+_0x25beb9);}});});}catch(_0x549b96){console['error'](_0x549b96);}}async function handleCloseTicketsAutomatic(){const _0x18bb79=a311_0x9ee590,_0xf27968=await Company_1[_0x18bb79(0x23f)][_0x18bb79(0x24d)]({'where':{'status':!![]}});_0xf27968[_0x18bb79(0x215)](async _0x206a8f=>{const _0x14dfb6=_0x18bb79;try{const _0x3a0b07=_0x206a8f['id'];await(0x0,wbotClosedTickets_1[_0x14dfb6(0x1d8)])(_0x3a0b07);}catch(_0xe054c6){Sentry[_0x14dfb6(0x22f)](_0xe054c6),logger_1[_0x14dfb6(0x1fc)][_0x14dfb6(0x1c1)](_0x14dfb6(0x209),_0xe054c6[_0x14dfb6(0x202)]);throw _0xe054c6;}});}async function messageUpdateJob(_0xd92e9d){const _0x2af15f=a311_0x9ee590,{data:_0xfbdfb0}=_0xd92e9d;var _0x408041=_0xfbdfb0[_0x2af15f(0x1eb)],_0x421ab7=_0xfbdfb0[_0x2af15f(0x208)],_0x16ee08=_0xfbdfb0[_0x2af15f(0x1d3)];const _0x1effa0=(0x0,wbot_1[_0x2af15f(0x207)])(_0xfbdfb0[_0x2af15f(0x1d3)]);for(const _0x11938e of _0x421ab7){await _0x1effa0[_0x2af15f(0x1da)]([_0x11938e['key']]);const _0x4608f2={..._0x421ab7};_0x4608f2['0']?.[_0x2af15f(0x205)][_0x2af15f(0x217)]===0x1&&_0x4608f2['0']?.[_0x2af15f(0x24c)][_0x2af15f(0x1e2)]!==_0x2af15f(0x239)&&await(0x0,MarkDeleteWhatsAppMessage_1['default'])(_0x4608f2['0']?.[_0x2af15f(0x24c)][_0x2af15f(0x1e2)],null,_0x4608f2['0']?.['key']['id'],_0x408041),await(0x0,wbotMessageListener_1[_0x2af15f(0x1f1)])(_0x11938e,_0x11938e['update'][_0x2af15f(0x204)]);}}async function handleMessageJob(_0x4e45ab){const _0x33a896=a311_0x9ee590,{data:_0x5a0ea7}=_0x4e45ab;var _0x35aecd=_0x5a0ea7[_0x33a896(0x253)],_0xd24559=_0x5a0ea7['companyId'];const _0x555b98=(0x0,wbot_1[_0x33a896(0x207)])(_0x5a0ea7[_0x33a896(0x1d3)]);for(const _0x1f6d13 of _0x35aecd){await(0x0,wbotMessageListener_1['handleMessage'])(_0x1f6d13,_0x555b98,_0xd24559),await(0x0,wbotMessageListener_1['verifyRecentCampaign'])(_0x1f6d13,_0xd24559),await(0x0,wbotMessageListener_1[_0x33a896(0x21f)])(_0x1f6d13,_0xd24559),_0x1f6d13['key'][_0x33a896(0x1e2)]?.[_0x33a896(0x1f7)]('@g.us')&&await(0x0,wbotMessageListener_1['handleMsgAck'])(_0x1f6d13,0x2);}}async function handleSendMessage(_0x3bd9c2){const _0x5a1a72=a311_0x9ee590;console['log']('HANDLE\x20SEND\x20MESSAGE');try{const {data:_0x3c9136}=_0x3bd9c2,_0x5d4ba1=await Whatsapp_1['default'][_0x5a1a72(0x1c0)](_0x3c9136[_0x5a1a72(0x1d3)]);if(_0x5d4ba1==null)throw new sequelize_1['Error']('Whatsapp\x20não\x20identificado');const _0x278477=_0x3c9136[_0x5a1a72(0x1c9)];await(0x0,SendMessage_1[_0x5a1a72(0x1d9)])(_0x5d4ba1,_0x278477);}catch(_0x21b1b2){Sentry[_0x5a1a72(0x22f)](_0x21b1b2),logger_1[_0x5a1a72(0x1fc)][_0x5a1a72(0x1c1)](_0x5a1a72(0x1ce),_0x21b1b2[_0x5a1a72(0x202)]);throw _0x21b1b2;}}function parseToMilliseconds(_0x107484){return _0x107484*0x3e8;}exports[a311_0x9ee590(0x1db)]=parseToMilliseconds;async function sleep(_0xb27060){const _0x1943ff=a311_0x9ee590;return logger_1['logger'][_0x1943ff(0x226)](_0x1943ff(0x1d2)+_0xb27060+_0x1943ff(0x225)+(0x0,moment_1['default'])()[_0x1943ff(0x1f3)](_0x1943ff(0x221))),new Promise(_0x349068=>{setTimeout(()=>{const _0x29096d=a311_0x3d01;logger_1[_0x29096d(0x1fc)]['info'](_0x29096d(0x1d2)+_0xb27060+_0x29096d(0x249)+(0x0,moment_1[_0x29096d(0x23f)])()[_0x29096d(0x1f3)](_0x29096d(0x221))),_0x349068(!![]);},parseToMilliseconds(_0xb27060));});}exports['sleep']=sleep;function a311_0x3d01(_0x4024c7,_0x5cac94){const _0x4323c8=a311_0x2722();return a311_0x3d01=function(_0x430228,_0x287f83){_0x430228=_0x430228-0x1bb;let _0x2722b2=_0x4323c8[_0x430228];return _0x2722b2;},a311_0x3d01(_0x4024c7,_0x5cac94);}function randomValue(_0x123dc5,_0x34770e){const _0xe6c236=a311_0x9ee590;return Math[_0xe6c236(0x23c)](Math['random']()*_0x34770e)+_0x123dc5;}exports[a311_0x9ee590(0x245)]=randomValue;async function handleLoginStatus(){const _0x52b377=a311_0x9ee590;console[_0x52b377(0x248)]('handle\x20login');const _0x42cda1=new Date();_0x42cda1[_0x52b377(0x1ff)](_0x42cda1[_0x52b377(0x230)]()-0x5),await User_1[_0x52b377(0x23f)][_0x52b377(0x205)]({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x42cda1},'online':!![]}});}async function handleInvoiceCreate(){const _0x3e53b7=a311_0x9ee590;logger_1['logger']['info'](_0x3e53b7(0x23b));const _0x3ec964=await Company_1[_0x3e53b7(0x23f)][_0x3e53b7(0x24d)]({'where':{'status':!![]}});_0x3ec964[_0x3e53b7(0x215)](async _0x4605c0=>{const _0x5ea8ca=_0x3e53b7,{dueDate:_0x202aab}=_0x4605c0,_0x16d50c=new Date(_0x202aab)['setHours'](0x0,0x0,0x0,0x0),_0x193e22=new Date(_0x202aab)[_0x5ea8ca(0x1c2)](0x17,0x3b,0x3b,0x3e7),_0x26a7dd=(0x0,moment_1['default'])((0x0,moment_1[_0x5ea8ca(0x23f)])())[_0x5ea8ca(0x1f3)](_0x5ea8ca(0x1d5)),_0x9be513=(0x0,moment_1[_0x5ea8ca(0x23f)])(_0x202aab)[_0x5ea8ca(0x1f3)](_0x5ea8ca(0x1d5)),_0x265690=(0x0,moment_1[_0x5ea8ca(0x23f)])(_0x9be513,'DD/MM/yyyy')[_0x5ea8ca(0x1c8)]((0x0,moment_1['default'])(_0x26a7dd,_0x5ea8ca(0x1d5))),_0x473ffc=moment_1[_0x5ea8ca(0x23f)][_0x5ea8ca(0x20a)](_0x265690)[_0x5ea8ca(0x20b)]();if(_0x473ffc<0x14){const _0x1eb82d=await Plan_1['default']['findByPk'](_0x4605c0[_0x5ea8ca(0x22e)]);let _0x21f73c=await Invoices_1[_0x5ea8ca(0x23f)][_0x5ea8ca(0x1f0)]({'where':{'companyId':_0x4605c0['id'],'dueDate':{[sequelize_1['Op']['like']]:(0x0,moment_1[_0x5ea8ca(0x23f)])(_0x202aab)[_0x5ea8ca(0x1f3)](_0x5ea8ca(0x1ea))}}});if(+_0x21f73c===0x0){const _0x300369=(0x0,moment_1[_0x5ea8ca(0x23f)])()[_0x5ea8ca(0x1f3)]();await Invoices_1['default'][_0x5ea8ca(0x1ef)]({'detail':_0x1eb82d[_0x5ea8ca(0x1cc)],'status':'open','value':_0x1eb82d[_0x5ea8ca(0x224)],'updatedAt':_0x300369,'createdAt':_0x300369,'dueDate':(0x0,moment_1[_0x5ea8ca(0x23f)])(_0x202aab)[_0x5ea8ca(0x1f3)]('YYYY-MM-DD'),'companyId':_0x4605c0['id']});}}});}async function startQueueProcess(){const _0x3cc920=a311_0x9ee590;logger_1[_0x3cc920(0x1fc)]['info'](_0x3cc920(0x24f)),await exports[_0x3cc920(0x240)][_0x3cc920(0x1f8)]('VerifyLoginStatus',{},{'repeat':{'every':0xea60*0x5,'key':_0x3cc920(0x23d)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x590be4=new bullmq_1[(_0x3cc920(0x222))](exports['userMonitor']['name'],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x590be4['on'](_0x3cc920(0x1f9),async _0x1316f7=>{const _0x170533=_0x3cc920;logger_1['logger'][_0x170533(0x226)](_0x170533(0x20d)+_0x1316f7[_0x170533(0x1cc)]+_0x170533(0x1de));}),await exports[_0x3cc920(0x237)]['add'](_0x3cc920(0x1e4),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x3cc920(0x1e4)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x3cc920(0x237)][_0x3cc920(0x1f8)]('InvoiceCreate',{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x3cc920(0x24b)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x5a4111=new bullmq_1[(_0x3cc920(0x222))](exports[_0x3cc920(0x237)][_0x3cc920(0x1cc)],async _0x515d3b=>{const _0x4c3ac9=_0x3cc920;if(_0x515d3b[_0x4c3ac9(0x1cc)]=='CloseTicketsAutomatic')await handleCloseTicketsAutomatic();else _0x515d3b[_0x4c3ac9(0x1cc)]==_0x4c3ac9(0x24b)&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}});await exports[_0x3cc920(0x23a)][_0x3cc920(0x1f8)](_0x3cc920(0x1c4),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x3cc920(0x1c4)},'removeOnComplete':!![],'removeOnFail':!![]}),new campaingJob_1[(_0x3cc920(0x23f))](exports['campaignQueue']['name'],connection);const _0x91b535=new bullmq_1[(_0x3cc920(0x222))](exports[_0x3cc920(0x220)][_0x3cc920(0x1cc)],async _0x5a5f6f=>{const _0xb33c7f=_0x3cc920;if(_0x5a5f6f[_0xb33c7f(0x1cc)]=='HandleMessageJob')await handleMessageJob(_0x5a5f6f);else{if(_0x5a5f6f['name']==_0xb33c7f(0x1c7))await messageUpdateJob(_0x5a5f6f);else _0x5a5f6f[_0xb33c7f(0x1cc)]==_0xb33c7f(0x1d9)&&await handleSendMessage(_0x5a5f6f);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x91b535['on']('completed',async _0x56cd7b=>{const _0x38f563=_0x3cc920;logger_1[_0x38f563(0x1fc)][_0x38f563(0x226)](_0x38f563(0x20d)+_0x56cd7b[_0x38f563(0x1cc)]+'\x20completed');}),_0x91b535['on'](_0x3cc920(0x234),async(_0x352438,_0x512051)=>{const _0x3919d8=_0x3cc920;logger_1[_0x3919d8(0x1fc)][_0x3919d8(0x1c1)]('Job\x20'+_0x352438[_0x3919d8(0x1cc)]+_0x3919d8(0x1f4)+_0x512051[_0x3919d8(0x202)]);}),await exports[_0x3cc920(0x211)][_0x3cc920(0x1f8)]('VerifyQueueStatus',{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':_0x3cc920(0x228)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x360fd6=new bullmq_1[(_0x3cc920(0x222))](exports[_0x3cc920(0x211)]['name'],async _0x2e47ad=>{const _0x1465ec=_0x3cc920;_0x2e47ad[_0x1465ec(0x1cc)]=='VerifyQueueStatus'&&await handleVerifyQueue(_0x2e47ad);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x360fd6['on'](_0x3cc920(0x1f9),async _0x2a191c=>{const _0x26c517=_0x3cc920;logger_1[_0x26c517(0x1fc)]['info'](_0x26c517(0x20d)+_0x2a191c['id']+_0x26c517(0x1de));});let _0x28afdf=new scheduledMessageJob_1[(_0x3cc920(0x23f))](exports['scheduleMonitor'],connection);await _0x28afdf[_0x3cc920(0x24e)]()[_0x3cc920(0x1f8)](_0x3cc920(0x1bf),{},{'repeat':{'every':0xea60*0x5,'key':_0x3cc920(0x1f5)},'removeOnComplete':!![],'removeOnFail':!![]});}exports[a311_0x9ee590(0x20f)]=startQueueProcess;