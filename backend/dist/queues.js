'use strict';const a346_0x18ac5c=a346_0x117b;(function(_0x33aca6,_0xce6fe1){const _0x1566af=a346_0x117b,_0x133d17=_0x33aca6();while(!![]){try{const _0x40cea1=parseInt(_0x1566af(0x23e))/0x1*(-parseInt(_0x1566af(0x1fe))/0x2)+-parseInt(_0x1566af(0x258))/0x3*(-parseInt(_0x1566af(0x21b))/0x4)+-parseInt(_0x1566af(0x254))/0x5*(parseInt(_0x1566af(0x294))/0x6)+-parseInt(_0x1566af(0x29a))/0x7+parseInt(_0x1566af(0x271))/0x8+-parseInt(_0x1566af(0x23c))/0x9+parseInt(_0x1566af(0x1e7))/0xa*(parseInt(_0x1566af(0x1fa))/0xb);if(_0x40cea1===_0xce6fe1)break;else _0x133d17['push'](_0x133d17['shift']());}catch(_0x59c0e7){_0x133d17['push'](_0x133d17['shift']());}}}(a346_0x2b4e,0x7b4b8));var __createBinding=this&&this[a346_0x18ac5c(0x1ec)]||(Object[a346_0x18ac5c(0x1c7)]?function(_0x252028,_0x5c51af,_0x5d9120,_0x4d3e9a){const _0x295a30=a346_0x18ac5c;if(_0x4d3e9a===undefined)_0x4d3e9a=_0x5d9120;var _0x4d2617=Object[_0x295a30(0x28a)](_0x5c51af,_0x5d9120);(!_0x4d2617||(_0x295a30(0x20a)in _0x4d2617?!_0x5c51af[_0x295a30(0x1df)]:_0x4d2617[_0x295a30(0x28c)]||_0x4d2617[_0x295a30(0x235)]))&&(_0x4d2617={'enumerable':!![],'get':function(){return _0x5c51af[_0x5d9120];}}),Object[_0x295a30(0x1d4)](_0x252028,_0x4d3e9a,_0x4d2617);}:function(_0x54cbb0,_0x5068ca,_0x5e74a6,_0x243c86){if(_0x243c86===undefined)_0x243c86=_0x5e74a6;_0x54cbb0[_0x243c86]=_0x5068ca[_0x5e74a6];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a346_0x18ac5c(0x1c7)]?function(_0x91fbec,_0x1ef3a1){const _0x58b4a3=a346_0x18ac5c;Object[_0x58b4a3(0x1d4)](_0x91fbec,_0x58b4a3(0x1c6),{'enumerable':!![],'value':_0x1ef3a1});}:function(_0x452b41,_0x17caf6){_0x452b41['default']=_0x17caf6;}),__importStar=this&&this[a346_0x18ac5c(0x2a8)]||(function(){const _0x3b488c=(function(){let _0x1808c9=!![];return function(_0x38c16e,_0xff7d07){const _0x1174dd=_0x1808c9?function(){const _0x16996c=a346_0x117b;if(_0xff7d07){const _0x205e80=_0xff7d07[_0x16996c(0x287)](_0x38c16e,arguments);return _0xff7d07=null,_0x205e80;}}:function(){};return _0x1808c9=![],_0x1174dd;};}()),_0x1d2ddc=_0x3b488c(this,function(){const _0x1d7fbd=a346_0x117b;return _0x1d2ddc[_0x1d7fbd(0x29e)]()[_0x1d7fbd(0x206)](_0x1d7fbd(0x298))['toString']()['constructor'](_0x1d2ddc)[_0x1d7fbd(0x206)]('(((.+)+)+)+$');});_0x1d2ddc();var _0x1d6329=function(_0x45a46c){const _0x4e2026=a346_0x117b;return _0x1d6329=Object[_0x4e2026(0x23b)]||function(_0x123aa5){const _0x126121=_0x4e2026;var _0x3c7b9f=[];for(var _0x3b5edb in _0x123aa5)if(Object[_0x126121(0x1f8)][_0x126121(0x207)][_0x126121(0x22c)](_0x123aa5,_0x3b5edb))_0x3c7b9f[_0x3c7b9f[_0x126121(0x1d8)]]=_0x3b5edb;return _0x3c7b9f;},_0x1d6329(_0x45a46c);};return function(_0x52d092){const _0x4d8b29=a346_0x117b;if(_0x52d092&&_0x52d092['__esModule'])return _0x52d092;var _0x292d3f={};if(_0x52d092!=null){for(var _0x413b3c=_0x1d6329(_0x52d092),_0x2ae69a=0x0;_0x2ae69a<_0x413b3c[_0x4d8b29(0x1d8)];_0x2ae69a++)if(_0x413b3c[_0x2ae69a]!==_0x4d8b29(0x1c6))__createBinding(_0x292d3f,_0x52d092,_0x413b3c[_0x2ae69a]);}return __setModuleDefault(_0x292d3f,_0x52d092),_0x292d3f;};}()),__importDefault=this&&this[a346_0x18ac5c(0x1f9)]||function(_0x20c36b){const _0x43ad85=a346_0x18ac5c;return _0x20c36b&&_0x20c36b[_0x43ad85(0x1df)]?_0x20c36b:{'default':_0x20c36b};};Object[a346_0x18ac5c(0x1d4)](exports,a346_0x18ac5c(0x1df),{'value':!![]}),exports[a346_0x18ac5c(0x2a6)]=exports[a346_0x18ac5c(0x295)]=exports['ticketMonitor']=exports[a346_0x18ac5c(0x283)]=exports[a346_0x18ac5c(0x221)]=exports[a346_0x18ac5c(0x1ed)]=exports['messageQueue']=exports[a346_0x18ac5c(0x1d6)]=void 0x0,exports[a346_0x18ac5c(0x203)]=handleWhatsappAutoRestart,exports[a346_0x18ac5c(0x28f)]=parseToMilliseconds,exports[a346_0x18ac5c(0x278)]=sleep,exports[a346_0x18ac5c(0x223)]=randomValue,exports[a346_0x18ac5c(0x215)]=startQueueProcess;const Sentry=__importStar(require(a346_0x18ac5c(0x1f3))),bull_1=__importDefault(require(a346_0x18ac5c(0x27c))),moment_1=__importDefault(require(a346_0x18ac5c(0x1ee))),sequelize_1=require(a346_0x18ac5c(0x1cc)),lodash_1=require(a346_0x18ac5c(0x24d)),path_1=__importDefault(require('path')),cron_1=require('cron'),SendMessage_1=require('./helpers/SendMessage'),Whatsapp_1=__importDefault(require(a346_0x18ac5c(0x2ab))),logger_1=require('./utils/logger'),Schedule_1=__importDefault(require(a346_0x18ac5c(0x230))),Contact_1=__importDefault(require(a346_0x18ac5c(0x275))),GetDefaultWhatsApp_1=__importDefault(require(a346_0x18ac5c(0x252))),Campaign_1=__importDefault(require(a346_0x18ac5c(0x285))),ContactList_1=__importDefault(require(a346_0x18ac5c(0x222))),ContactListItem_1=__importDefault(require(a346_0x18ac5c(0x1d9))),CampaignSetting_1=__importDefault(require(a346_0x18ac5c(0x1cb))),CampaignShipping_1=__importDefault(require('./models/CampaignShipping')),GetWhatsappWbot_1=__importDefault(require(a346_0x18ac5c(0x1da))),database_1=__importDefault(require('./database')),SendWhatsAppMedia_1=require(a346_0x18ac5c(0x239)),socket_1=require(a346_0x18ac5c(0x1c2)),User_1=__importDefault(require(a346_0x18ac5c(0x1c3))),Company_1=__importDefault(require(a346_0x18ac5c(0x281))),Plan_1=__importDefault(require(a346_0x18ac5c(0x1db))),wbotMessageListener_1=require(a346_0x18ac5c(0x2a9)),ShowService_1=__importDefault(require('./services/CampaignService/ShowService')),Ticket_1=__importDefault(require('./models/Ticket')),SendWhatsAppMessage_1=__importDefault(require(a346_0x18ac5c(0x22e))),wbot_1=require('./libs/wbot'),StartWhatsAppSession_1=require(a346_0x18ac5c(0x23a)),connection=process[a346_0x18ac5c(0x1cf)][a346_0x18ac5c(0x237)]||'',limiterMax=process[a346_0x18ac5c(0x1cf)]['REDIS_OPT_LIMITER_MAX']||0x1,limiterDuration=process[a346_0x18ac5c(0x1cf)]['REDIS_OPT_LIMITER_DURATION']||0xbb8;exports['userMonitor']=new bull_1[(a346_0x18ac5c(0x1c6))]('UserMonitor',connection),exports['messageQueue']=new bull_1[(a346_0x18ac5c(0x1c6))](a346_0x18ac5c(0x2a7),connection,{'limiter':{'max':limiterMax,'duration':limiterDuration}}),exports[a346_0x18ac5c(0x1ed)]=new bull_1['default'](a346_0x18ac5c(0x243),connection),exports[a346_0x18ac5c(0x221)]=new bull_1[(a346_0x18ac5c(0x1c6))](a346_0x18ac5c(0x21a),connection),exports['ticketInactiveWarningQueue']=new bull_1['default'](a346_0x18ac5c(0x28e),connection);async function handleWhatsappAutoRestart(){const _0x3dedb1=a346_0x18ac5c;try{const _0x1a360e=await Whatsapp_1['default'][_0x3dedb1(0x1e6)]({'where':{'automaticRestart':!![],'status':_0x3dedb1(0x25c)}}),_0x31a890=new Date();for(const _0x54ebcc of _0x1a360e){const _0x56969b=_0x54ebcc[_0x3dedb1(0x267)]||_0x54ebcc['updatedAt']||_0x54ebcc['createdAt'];shouldRestart(_0x31a890,_0x56969b,_0x54ebcc[_0x3dedb1(0x286)])&&(logger_1[_0x3dedb1(0x20b)]['info'](_0x3dedb1(0x26b)+_0x54ebcc[_0x3dedb1(0x1d0)]+_0x3dedb1(0x200)+_0x54ebcc['id']+_0x3dedb1(0x2ac)+_0x54ebcc['period']+')'),await(0x0,wbot_1['removeWbot'])(_0x54ebcc['id'],![]),await new Promise(_0x3ed465=>setTimeout(_0x3ed465,0xbb8)),await(0x0,StartWhatsAppSession_1[_0x3dedb1(0x21d)])(_0x54ebcc,_0x54ebcc[_0x3dedb1(0x23f)]),await _0x54ebcc[_0x3dedb1(0x269)]({'lastRestartAt':new Date()}));}}catch(_0x1e49b4){logger_1['logger']['error'](_0x3dedb1(0x1f7)+_0x1e49b4['message']);}}exports[a346_0x18ac5c(0x201)]=new bull_1[(a346_0x18ac5c(0x1c6))](a346_0x18ac5c(0x1ca),connection),exports['whatsappRestartQueue']=new bull_1[(a346_0x18ac5c(0x1c6))](a346_0x18ac5c(0x23d),connection);function a346_0x2b4e(){const _0x196dad=['search','hasOwnProperty','findAndCountAll','isWhatsappValid','get','logger','expiresTicket','\x27,\x20\x27open\x27,\x20\x27','PENDENTE','clean','confirmationMessage2','-open','DD/MM/yyyy','valids','message2','startQueueProcess','captureException','-campaign','{nome}','VerifyLoginStatus','SendSacheduledMessages','852iNJBSt','\x20AND\x20\x22dueDate\x22::text\x20LIKE\x20\x27','StartWhatsAppSession','data','confirmationMessage4','\x20tickets\x20fechados\x20por\x20inatividade\x20para\x20a\x20empresa\x20','sendScheduledMessages','./models/ContactList','randomValue','Campaign\x20not\x20found','floor','\x20fechado\x20por\x20inatividade\x20após\x20','duration','sendMessage','queue-','company-','forEach','call','key','./services/WbotServices/SendWhatsAppMessage','message3','./models/Schedule','error','0\x20*\x20*\x20*\x20*','email','message4','configurable','public','REDIS_URI','map','./services/WbotServices/SendWhatsAppMedia','./services/WbotServices/StartWhatsAppSession','getOwnPropertyNames','2927709YEGOdY','WhatsappRestartQueue','579MtsvNB','companyId','agent','expiresInactiveMessage','ProcessCampaign','ScheduleMonitor','isNil','Erro\x20ao\x20enviar\x20aviso\x20de\x20inatividade:\x20','mediaName','replace','Verify','ERRO','getMessageOptions','deliveredAt','months','lodash','whatsappId','*/20\x20*\x20*\x20*\x20*\x20*','FINALIZADA','toDate','./helpers/GetDefaultWhatsApp','Whatsapp\x20não\x20identificado','132970eVGhcr','confirmationRequestedAt','-closed','greaterInterval','10419GrhfHx','push','SELECT\x20id,\x20\x22expiresTicket\x22,\x20\x22companyId\x22,\x20\x22whenExpireTicket\x22,\x0a\x20\x20\x20\x22expiresInactiveMessage\x22,\x20\x22inactiveMessage\x22,\x20\x22inactiveMessageTime\x22\x0a\x20\x20\x20FROM\x20\x22Whatsapps\x22\x20WHERE\x20\x22expiresTicket\x22\x20>\x200','longerIntervalAfter','CONNECTED','asDays','open','whenExpireTicket','start','EM_ANDAMENTO','QueryTypes','message5','diff',',\x20Delay\x20Inicial=','findByPk','lastRestartAt','info','update','contact','Reiniciando\x20conexão\x20WhatsApp\x20','planId','parse','confirmationMessage1','subtract','HH:mm:ss','2386736pcNkki','seconds','SELECT','\x27,\x20','./models/Contact','*\x20*\x20*\x20*\x20*','Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha=','sleep','%\x27;',';Delay=','INSERT\x20INTO\x20\x22Invoices\x22\x20(detail,\x20status,\x20value,\x20\x22updatedAt\x22,\x20\x22createdAt\x22,\x20\x22dueDate\x22,\x20\x22companyId\x22)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(\x27','bull','value','variables','isEmpty','set','./models/Company','inactiveMessage','ticketInactiveWarningQueue','contactList','./models/Campaign','period','apply','CronJob','semanalmente','getOwnPropertyDescriptor','minutes','writable','campaignId','TicketInactiveWarning','parseToMilliseconds','format','SendScheduledMessage\x20->\x20Verify:\x20error','messageQueue','random','6qnrgzW','whatsappRestartQueue','confirmationMessage3','emit','(((.+)+)+)+$','confirmationMessage','5560121tDejwl','MessageQueue\x20->\x20SendMessage:\x20error','{email}','isArray','toString','weeks','days','handleMessage','completed','DispatchCampaign','closed','messageInterval','campaignQueue','MessageQueue','__importStar','./services/WbotServices/wbotMessageListener','confirmation','./models/Whatsapp',')\x20de\x20acordo\x20com\x20o\x20período\x20(',';Contato=','SendMessage','yyyy-MM-DD','saveMessage','queueId','Erro\x20ao\x20tentar\x20consultar\x20agendamento:\x20','message','./libs/socket','./models/User','YYYY-MM-DD\x20HH:mm:ss','number','default','create','Usuário\x20passado\x20para\x20offline:\x20','scheduledAt','TicketMonitor','./models/CampaignSetting','sequelize','VerifyCampaignsDaatabase','whatsapp','env','name','-ticket','dataValues','shipping','defineProperty','query','userMonitor','SendScheduledMessage\x20->\x20SendMessage:\x20error','length','./models/ContactListItem','./helpers/GetWhatsappWbot','./models/Plan','diariamente','\x27,\x20\x27','process','__esModule','message1','mediaPath','VerifyTicketExpiration',';Registro=','contacts','AutoRestart','findAll','20DIHibx','Sleep\x20de\x20','ENVIADA','@s.whatsapp.net','inactiveMessageTime','__createBinding','scheduleMonitor','moment','Aviso\x20de\x20inatividade\x20enviado\x20para\x20o\x20ticket\x20#','confirmationMessage5','add','gte','@sentry/node','then','SELECT\x20COUNT(*)\x20mycount\x20FROM\x20\x22Invoices\x22\x20WHERE\x20\x22companyId\x22\x20=\x20','includes','Erro\x20ao\x20reiniciar\x20conexões\x20WhatsApp\x20periodicamente:\x20','prototype','__importDefault','5585404PoZTVg','body','DispatchConfirmedCampaign','contactId','1390ilxEAf','Mensagem\x20agendada\x20enviada\x20para:\x20','\x20(ID:\x20','ticketMonitor','Campanhas\x20encontradas:\x20','handleWhatsappAutoRestart','milliseconds','\x20segundos\x20finalizado:\x20'];a346_0x2b4e=function(){return _0x196dad;};return a346_0x2b4e();}function shouldRestart(_0x1e0535,_0x38198d,_0x503903){const _0x476dec=a346_0x18ac5c;if(_0x503903===_0x476dec(0x1dc))return(0x0,moment_1[_0x476dec(0x1c6)])(_0x1e0535)[_0x476dec(0x264)]((0x0,moment_1['default'])(_0x38198d),_0x476dec(0x2a0))>=0x1;if(_0x503903===_0x476dec(0x289))return(0x0,moment_1[_0x476dec(0x1c6)])(_0x1e0535)['diff']((0x0,moment_1[_0x476dec(0x1c6)])(_0x38198d),_0x476dec(0x29f))>=0x1;if(_0x503903==='mensalmente')return(0x0,moment_1[_0x476dec(0x1c6)])(_0x1e0535)[_0x476dec(0x264)]((0x0,moment_1['default'])(_0x38198d),_0x476dec(0x24c))>=0x1;return![];}async function handleVerifyTicketExpiration(){const _0x25ac7b=a346_0x18ac5c;try{const _0x18f38c=await database_1[_0x25ac7b(0x1c6)]['query'](_0x25ac7b(0x25a),{'type':sequelize_1[_0x25ac7b(0x262)]['SELECT']});for(const _0x59edc1 of _0x18f38c){let _0x5a25e1={};_0x59edc1[_0x25ac7b(0x25f)]===_0x25ac7b(0x240)&&(_0x5a25e1={'fromMe':!![]});if(_0x59edc1[_0x25ac7b(0x1eb)]>0x0&&_0x59edc1[_0x25ac7b(0x282)]){const _0xa707ff=_0x59edc1[_0x25ac7b(0x20c)]-_0x59edc1['inactiveMessageTime'];if(_0xa707ff>0x0){const _0x2f1eaa=await Ticket_1[_0x25ac7b(0x1c6)][_0x25ac7b(0x1e6)]({'where':{'status':'open','whatsappId':_0x59edc1['id'],'companyId':_0x59edc1[_0x25ac7b(0x23f)],'ticketsWithWarning':![],..._0x5a25e1,'updatedAt':{[sequelize_1['Op']['lt']]:(0x0,moment_1[_0x25ac7b(0x1c6)])()[_0x25ac7b(0x26f)](_0xa707ff,_0x25ac7b(0x28b))[_0x25ac7b(0x251)](),[sequelize_1['Op']['gt']]:(0x0,moment_1['default'])()['subtract'](_0x59edc1['expiresTicket'],_0x25ac7b(0x28b))['toDate']()}},'include':[{'model':Contact_1[_0x25ac7b(0x1c6)],'as':'contact'}]});for(const _0x40d5de of _0x2f1eaa){try{await(0x0,SendWhatsAppMessage_1[_0x25ac7b(0x1c6)])({'ticket':_0x40d5de,'body':_0x59edc1['inactiveMessage']}),await Ticket_1[_0x25ac7b(0x1c6)][_0x25ac7b(0x269)]({'ticketsWithWarning':!![]},{'where':{'id':_0x40d5de['id']},'silent':!![]}),logger_1[_0x25ac7b(0x20b)]['info'](_0x25ac7b(0x1ef)+_0x40d5de['id']);}catch(_0x4a97cd){Sentry[_0x25ac7b(0x216)](_0x4a97cd),logger_1[_0x25ac7b(0x20b)][_0x25ac7b(0x231)](_0x25ac7b(0x245)+_0x4a97cd['message']);}}}}const _0x2deae2=await Ticket_1[_0x25ac7b(0x1c6)]['findAll']({'where':{'status':_0x25ac7b(0x25e),'whatsappId':_0x59edc1['id'],'companyId':_0x59edc1[_0x25ac7b(0x23f)],..._0x5a25e1,'updatedAt':{[sequelize_1['Op']['lt']]:(0x0,moment_1[_0x25ac7b(0x1c6)])()['subtract'](_0x59edc1[_0x25ac7b(0x20c)],_0x25ac7b(0x28b))[_0x25ac7b(0x251)]()}},'include':[{'model':Contact_1[_0x25ac7b(0x1c6)],'as':_0x25ac7b(0x26a)}]});for(const _0x4b1d55 of _0x2deae2){try{_0x59edc1[_0x25ac7b(0x241)]&&(await(0x0,SendWhatsAppMessage_1[_0x25ac7b(0x1c6)])({'ticket':_0x4b1d55,'body':_0x59edc1[_0x25ac7b(0x241)]}),await new Promise(_0x11b54b=>setTimeout(_0x11b54b,0x3e8)));await _0x4b1d55[_0x25ac7b(0x269)]({'status':'closed','amountUsedBotQueues':0x0,'ticketsWithWarning':![]});const _0x3986aa=(0x0,socket_1['getIO'])();_0x3986aa['to']('company-'+_0x4b1d55[_0x25ac7b(0x23f)]+_0x25ac7b(0x211))['to'](_0x25ac7b(0x229)+_0x4b1d55[_0x25ac7b(0x1bf)]+_0x25ac7b(0x211))[_0x25ac7b(0x297)](_0x25ac7b(0x22a)+_0x4b1d55['companyId']+_0x25ac7b(0x1d1),{'action':_0x25ac7b(0x269),'ticket':{..._0x4b1d55[_0x25ac7b(0x1d2)],'status':_0x25ac7b(0x2a4)}}),_0x3986aa['to']('company-'+_0x4b1d55[_0x25ac7b(0x23f)]+_0x25ac7b(0x256))['emit'](_0x25ac7b(0x22a)+_0x4b1d55[_0x25ac7b(0x23f)]+_0x25ac7b(0x1d1),{'action':'update','ticket':{..._0x4b1d55[_0x25ac7b(0x1d2)],'status':'closed'}}),logger_1['logger'][_0x25ac7b(0x268)]('Ticket\x20#'+_0x4b1d55['id']+_0x25ac7b(0x226)+_0x59edc1[_0x25ac7b(0x20c)]+'\x20minutos.');}catch(_0x5e96ae){Sentry[_0x25ac7b(0x216)](_0x5e96ae),logger_1[_0x25ac7b(0x20b)]['error']('Erro\x20ao\x20fechar\x20ticket\x20por\x20inatividade:\x20'+_0x5e96ae[_0x25ac7b(0x1c1)]);}}_0x2deae2[_0x25ac7b(0x1d8)]>0x0&&logger_1[_0x25ac7b(0x20b)][_0x25ac7b(0x268)](_0x2deae2[_0x25ac7b(0x1d8)]+_0x25ac7b(0x220)+_0x59edc1[_0x25ac7b(0x23f)]);}}catch(_0x1dba10){Sentry['captureException'](_0x1dba10),logger_1[_0x25ac7b(0x20b)][_0x25ac7b(0x231)]('TicketMonitor\x20->\x20VerifyTicketExpiration:\x20erro',_0x1dba10[_0x25ac7b(0x1c1)]);}}exports[a346_0x18ac5c(0x2a6)]=new bull_1[(a346_0x18ac5c(0x1c6))]('CampaignQueue',connection);async function handleSendMessage(_0x548d2f){const _0x30c540=a346_0x18ac5c;try{const {data:_0x58ce89}=_0x548d2f,_0xdc7f1a=await Whatsapp_1['default'][_0x30c540(0x266)](_0x58ce89[_0x30c540(0x24e)]);if(_0xdc7f1a==null)throw Error(_0x30c540(0x253));const _0x2b21dc=_0x58ce89['data'];await(0x0,SendMessage_1[_0x30c540(0x1bc)])(_0xdc7f1a,_0x2b21dc);}catch(_0x4b7773){Sentry['captureException'](_0x4b7773),logger_1[_0x30c540(0x20b)][_0x30c540(0x231)](_0x30c540(0x29b),_0x4b7773[_0x30c540(0x1c1)]);throw _0x4b7773;}}async function handleVerifySchedules(){const _0x243b34=a346_0x18ac5c;try{const {count:_0x146f96,rows:_0x2411cb}=await Schedule_1[_0x243b34(0x1c6)][_0x243b34(0x208)]({'where':{'status':_0x243b34(0x20e),'sentAt':null,'sendAt':{[sequelize_1['Op'][_0x243b34(0x1f2)]]:(0x0,moment_1[_0x243b34(0x1c6)])()['format'](_0x243b34(0x1c4)),[sequelize_1['Op']['lte']]:(0x0,moment_1[_0x243b34(0x1c6)])()[_0x243b34(0x1f1)]('30',_0x243b34(0x272))['format'](_0x243b34(0x1c4))}},'include':[{'model':Contact_1['default'],'as':'contact'}]});_0x146f96>0x0&&_0x2411cb[_0x243b34(0x238)](async _0x31d15d=>{const _0x39eb31=_0x243b34;await _0x31d15d[_0x39eb31(0x269)]({'status':'AGENDADA'}),exports['sendScheduledMessages'][_0x39eb31(0x1f1)](_0x39eb31(0x1bc),{'schedule':_0x31d15d},{'delay':0x9c40}),logger_1[_0x39eb31(0x20b)][_0x39eb31(0x268)]('Disparo\x20agendado\x20para:\x20'+_0x31d15d[_0x39eb31(0x26a)]['name']);});}catch(_0x4dbe10){Sentry[_0x243b34(0x216)](_0x4dbe10),logger_1['logger'][_0x243b34(0x231)](_0x243b34(0x291),_0x4dbe10[_0x243b34(0x1c1)]);throw _0x4dbe10;}}async function handleSendScheduledMessage(_0x2edf2c){const _0x2ee86f=a346_0x18ac5c,{data:{schedule:_0x28df12}}=_0x2edf2c;let _0x38c815=null;try{_0x38c815=await Schedule_1[_0x2ee86f(0x1c6)][_0x2ee86f(0x266)](_0x28df12['id']);}catch(_0x5f38af){Sentry[_0x2ee86f(0x216)](_0x5f38af),logger_1[_0x2ee86f(0x20b)][_0x2ee86f(0x268)](_0x2ee86f(0x1c0)+_0x28df12['id']);}try{const _0x4f3ea6=await(0x0,GetDefaultWhatsApp_1[_0x2ee86f(0x1c6)])(_0x28df12['companyId']),_0x2600f1=await(0x0,SendMessage_1[_0x2ee86f(0x1bc)])(_0x4f3ea6,{'number':_0x28df12[_0x2ee86f(0x26a)]['number'],'body':_0x28df12[_0x2ee86f(0x1fb)]});_0x28df12[_0x2ee86f(0x1be)]&&(0x0,wbotMessageListener_1[_0x2ee86f(0x2a1)])(_0x2600f1,await(0x0,GetWhatsappWbot_1[_0x2ee86f(0x1c6)])(_0x4f3ea6),_0x28df12[_0x2ee86f(0x23f)]),await _0x38c815?.[_0x2ee86f(0x269)]({'sentAt':new Date(),'status':_0x2ee86f(0x1e9)}),logger_1[_0x2ee86f(0x20b)]['info'](_0x2ee86f(0x1ff)+_0x28df12[_0x2ee86f(0x26a)][_0x2ee86f(0x1d0)]),exports[_0x2ee86f(0x221)][_0x2ee86f(0x20f)](0x3a98,_0x2ee86f(0x2a2));}catch(_0x3c349d){Sentry[_0x2ee86f(0x216)](_0x3c349d),await _0x38c815?.['update']({'status':_0x2ee86f(0x249)}),logger_1[_0x2ee86f(0x20b)][_0x2ee86f(0x231)](_0x2ee86f(0x1d7),_0x3c349d[_0x2ee86f(0x1c1)]);throw _0x3c349d;}}async function handleVerifyCampaigns(){const _0x30d3c7=a346_0x18ac5c,_0x2a8e61=await database_1[_0x30d3c7(0x1c6)]['query']('select\x20id,\x20\x22scheduledAt\x22\x20from\x20\x22Campaigns\x22\x20c\x0a\x20\x20\x20\x20where\x20\x22scheduledAt\x22\x20between\x20now()\x20and\x20now()\x20+\x20\x271\x20hour\x27::interval\x20and\x20status\x20=\x20\x27PROGRAMADA\x27',{'type':sequelize_1[_0x30d3c7(0x262)][_0x30d3c7(0x273)]});_0x2a8e61[_0x30d3c7(0x1d8)]&&logger_1['logger'][_0x30d3c7(0x268)](_0x30d3c7(0x202)+_0x2a8e61['length']),_0x2a8e61[_0x30d3c7(0x22b)](_0x1f1c64=>{const _0x147e3e=_0x30d3c7;try{const _0x1fc920=(0x0,moment_1['default'])(),_0x101cd7=(0x0,moment_1[_0x147e3e(0x1c6)])(_0x1f1c64[_0x147e3e(0x1c9)]),_0x23e75c=_0x101cd7[_0x147e3e(0x264)](_0x1fc920,_0x147e3e(0x204));logger_1[_0x147e3e(0x20b)][_0x147e3e(0x268)](_0x147e3e(0x277)+_0x1f1c64['id']+_0x147e3e(0x265)+_0x23e75c),exports[_0x147e3e(0x2a6)][_0x147e3e(0x1f1)]('ProcessCampaign',{'id':_0x1f1c64['id'],'delay':_0x23e75c},{'removeOnComplete':!![]});}catch(_0x5706e3){Sentry[_0x147e3e(0x216)](_0x5706e3);}});}async function getCampaign(_0x4c16cf){const _0x6a22c3=a346_0x18ac5c;return Campaign_1['default'][_0x6a22c3(0x266)](_0x4c16cf,{'include':[{'model':ContactList_1[_0x6a22c3(0x1c6)],'as':'contactList','attributes':['id',_0x6a22c3(0x1d0)],'include':[{'model':ContactListItem_1[_0x6a22c3(0x1c6)],'as':_0x6a22c3(0x1e4),'attributes':['id',_0x6a22c3(0x1d0),_0x6a22c3(0x1c5),_0x6a22c3(0x233),_0x6a22c3(0x209)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1[_0x6a22c3(0x1c6)],'as':_0x6a22c3(0x1ce),'attributes':['id',_0x6a22c3(0x1d0)]},{'model':CampaignShipping_1[_0x6a22c3(0x1c6)],'as':_0x6a22c3(0x1d3),'include':[{'model':ContactListItem_1[_0x6a22c3(0x1c6)],'as':_0x6a22c3(0x26a)}]}]});}async function getSettings(_0x23fcf5){const _0x3981f7=a346_0x18ac5c,_0x3ba501=await CampaignSetting_1[_0x3981f7(0x1c6)]['findAll']({'where':{'companyId':_0x23fcf5[_0x3981f7(0x23f)]},'attributes':[_0x3981f7(0x22d),_0x3981f7(0x27d)]});let _0x468e3a=0x14,_0x27cd0f=0x14,_0x148265=0x3c,_0x3fed9c=[];return _0x3ba501[_0x3981f7(0x22b)](_0x53141c=>{const _0x2daff1=_0x3981f7;_0x53141c[_0x2daff1(0x22d)]===_0x2daff1(0x2a5)&&(_0x468e3a=JSON[_0x2daff1(0x26d)](_0x53141c[_0x2daff1(0x27d)])),_0x53141c[_0x2daff1(0x22d)]===_0x2daff1(0x25b)&&(_0x27cd0f=JSON[_0x2daff1(0x26d)](_0x53141c['value'])),_0x53141c[_0x2daff1(0x22d)]===_0x2daff1(0x257)&&(_0x148265=JSON[_0x2daff1(0x26d)](_0x53141c[_0x2daff1(0x27d)])),_0x53141c[_0x2daff1(0x22d)]===_0x2daff1(0x27e)&&(_0x3fed9c=JSON[_0x2daff1(0x26d)](_0x53141c[_0x2daff1(0x27d)]));}),{'messageInterval':_0x468e3a,'longerIntervalAfter':_0x27cd0f,'greaterInterval':_0x148265,'variables':_0x3fed9c};}function parseToMilliseconds(_0x2369c4){return _0x2369c4*0x3e8;}async function sleep(_0x54abf8){const _0xfec92d=a346_0x18ac5c;return logger_1['logger']['info'](_0xfec92d(0x1e8)+_0x54abf8+'\x20segundos\x20iniciado:\x20'+(0x0,moment_1[_0xfec92d(0x1c6)])()['format'](_0xfec92d(0x270))),new Promise(_0x14be33=>{setTimeout(()=>{const _0x316bf9=a346_0x117b;logger_1[_0x316bf9(0x20b)]['info'](_0x316bf9(0x1e8)+_0x54abf8+_0x316bf9(0x205)+(0x0,moment_1['default'])()[_0x316bf9(0x290)](_0x316bf9(0x270))),_0x14be33(!![]);},parseToMilliseconds(_0x54abf8));});}function getCampaignValidMessages(_0x2463bc){const _0x26abfd=a346_0x18ac5c,_0x1139d2=[];return!(0x0,lodash_1['isEmpty'])(_0x2463bc[_0x26abfd(0x1e0)])&&!(0x0,lodash_1[_0x26abfd(0x244)])(_0x2463bc[_0x26abfd(0x1e0)])&&_0x1139d2['push'](_0x2463bc['message1']),!(0x0,lodash_1[_0x26abfd(0x27f)])(_0x2463bc['message2'])&&!(0x0,lodash_1[_0x26abfd(0x244)])(_0x2463bc[_0x26abfd(0x214)])&&_0x1139d2[_0x26abfd(0x259)](_0x2463bc['message2']),!(0x0,lodash_1[_0x26abfd(0x27f)])(_0x2463bc[_0x26abfd(0x22f)])&&!(0x0,lodash_1[_0x26abfd(0x244)])(_0x2463bc[_0x26abfd(0x22f)])&&_0x1139d2[_0x26abfd(0x259)](_0x2463bc[_0x26abfd(0x22f)]),!(0x0,lodash_1[_0x26abfd(0x27f)])(_0x2463bc[_0x26abfd(0x234)])&&!(0x0,lodash_1[_0x26abfd(0x244)])(_0x2463bc['message4'])&&_0x1139d2[_0x26abfd(0x259)](_0x2463bc[_0x26abfd(0x234)]),!(0x0,lodash_1[_0x26abfd(0x27f)])(_0x2463bc[_0x26abfd(0x263)])&&!(0x0,lodash_1[_0x26abfd(0x244)])(_0x2463bc[_0x26abfd(0x263)])&&_0x1139d2[_0x26abfd(0x259)](_0x2463bc[_0x26abfd(0x263)]),_0x1139d2;}function getCampaignValidConfirmationMessages(_0x155291){const _0x393b40=a346_0x18ac5c,_0x554ebe=[];return!(0x0,lodash_1[_0x393b40(0x27f)])(_0x155291[_0x393b40(0x26e)])&&!(0x0,lodash_1[_0x393b40(0x244)])(_0x155291[_0x393b40(0x26e)])&&_0x554ebe[_0x393b40(0x259)](_0x155291[_0x393b40(0x26e)]),!(0x0,lodash_1[_0x393b40(0x27f)])(_0x155291[_0x393b40(0x210)])&&!(0x0,lodash_1['isNil'])(_0x155291[_0x393b40(0x210)])&&_0x554ebe[_0x393b40(0x259)](_0x155291[_0x393b40(0x210)]),!(0x0,lodash_1[_0x393b40(0x27f)])(_0x155291['confirmationMessage3'])&&!(0x0,lodash_1[_0x393b40(0x244)])(_0x155291[_0x393b40(0x296)])&&_0x554ebe[_0x393b40(0x259)](_0x155291[_0x393b40(0x296)]),!(0x0,lodash_1['isEmpty'])(_0x155291['confirmationMessage4'])&&!(0x0,lodash_1[_0x393b40(0x244)])(_0x155291[_0x393b40(0x21f)])&&_0x554ebe[_0x393b40(0x259)](_0x155291[_0x393b40(0x21f)]),!(0x0,lodash_1[_0x393b40(0x27f)])(_0x155291[_0x393b40(0x1f0)])&&!(0x0,lodash_1['isNil'])(_0x155291['confirmationMessage5'])&&_0x554ebe[_0x393b40(0x259)](_0x155291['confirmationMessage5']),_0x554ebe;}function getProcessedMessage(_0x2cc197,_0x198fa2,_0xe8edb3){const _0x3c8af5=a346_0x18ac5c;let _0x4958fd=_0x2cc197;return _0x4958fd[_0x3c8af5(0x1f6)](_0x3c8af5(0x218))&&(_0x4958fd=_0x4958fd[_0x3c8af5(0x247)](/{nome}/g,_0xe8edb3[_0x3c8af5(0x1d0)])),_0x4958fd[_0x3c8af5(0x1f6)](_0x3c8af5(0x29c))&&(_0x4958fd=_0x4958fd[_0x3c8af5(0x247)](/{email}/g,_0xe8edb3['email'])),_0x4958fd[_0x3c8af5(0x1f6)]('{numero}')&&(_0x4958fd=_0x4958fd[_0x3c8af5(0x247)](/{numero}/g,_0xe8edb3[_0x3c8af5(0x1c5)])),_0x198fa2[_0x3c8af5(0x22b)](_0x1566dc=>{const _0x53e20b=_0x3c8af5;if(_0x4958fd['includes']('{'+_0x1566dc['key']+'}')){const _0x5a4462=new RegExp('{'+_0x1566dc[_0x53e20b(0x22d)]+'}','g');_0x4958fd=_0x4958fd['replace'](_0x5a4462,_0x1566dc[_0x53e20b(0x27d)]);}}),_0x4958fd;}function randomValue(_0x2a8020,_0x5923fb){const _0x503686=a346_0x18ac5c;return Math[_0x503686(0x225)](Math[_0x503686(0x293)]()*_0x5923fb)+_0x2a8020;}async function verifyAndFinalizeCampaign(_0x35c417){const _0x32e53a=a346_0x18ac5c,_0x360a7f=await(0x0,ShowService_1[_0x32e53a(0x1c6)])(_0x35c417['id']);_0x360a7f[_0x32e53a(0x213)]===_0x360a7f['delivered']&&await _0x35c417[_0x32e53a(0x269)]({'status':_0x32e53a(0x250),'completedAt':(0x0,moment_1[_0x32e53a(0x1c6)])()});const _0x28f4ef=(0x0,socket_1['getIO'])();_0x28f4ef[_0x32e53a(0x297)](_0x32e53a(0x22a)+_0x35c417['companyId']+_0x32e53a(0x217),_0x360a7f);}async function prepareContact(_0x1e52e6,_0x5be3e6,_0x29e06f,_0x15d99e,_0x1aed8c,_0x49ebd9){const _0x5bb02e=a346_0x18ac5c,_0x2130fc={};_0x2130fc[_0x5bb02e(0x1c5)]=_0x29e06f[_0x5bb02e(0x1c5)],_0x2130fc['contactId']=_0x29e06f['id'],_0x2130fc['campaignId']=_0x1e52e6['id'];if(_0x1aed8c[_0x5bb02e(0x1d8)]){const _0x567703=randomValue(0x0,_0x1aed8c[_0x5bb02e(0x1d8)]),_0x323ea9=getProcessedMessage(_0x1aed8c[_0x567703],_0x5be3e6,_0x29e06f);_0x2130fc[_0x5bb02e(0x1c1)]=''+_0x323ea9;}if(_0x1e52e6['confirmation']){if(_0x49ebd9[_0x5bb02e(0x1d8)]){const _0x211882=randomValue(0x0,_0x49ebd9[_0x5bb02e(0x1d8)]),_0x2eed47=getProcessedMessage(_0x49ebd9[_0x211882],_0x5be3e6,_0x29e06f);_0x2130fc[_0x5bb02e(0x299)]=''+_0x2eed47;}}const [_0xee499,_0x2440d9]=await CampaignShipping_1[_0x5bb02e(0x1c6)]['findOrCreate']({'where':{'campaignId':_0x2130fc[_0x5bb02e(0x28d)],'contactId':_0x2130fc[_0x5bb02e(0x1fd)]},'defaults':_0x2130fc});!_0x2440d9&&_0xee499[_0x5bb02e(0x24b)]===null&&_0xee499['confirmationRequestedAt']===null&&(_0xee499[_0x5bb02e(0x280)](_0x2130fc),await _0xee499['save']());if(_0xee499[_0x5bb02e(0x24b)]===null&&_0xee499[_0x5bb02e(0x255)]===null){const _0xbdb116=await exports[_0x5bb02e(0x2a6)][_0x5bb02e(0x1f1)](_0x5bb02e(0x2a3),{'campaignId':_0x1e52e6['id'],'campaignShippingId':_0xee499['id'],'contactListItemId':_0x29e06f['id']},{'delay':_0x15d99e});await _0xee499['update']({'jobId':''+_0xbdb116['id']});}}async function handleProcessCampaign(_0x2df013){const _0x6202dd=a346_0x18ac5c;try{const {id:_0x41918e}=_0x2df013[_0x6202dd(0x21e)];let {delay:_0x38863a}=_0x2df013[_0x6202dd(0x21e)];const _0x57e45e=await getCampaign(_0x41918e),_0x2e1e60=await getSettings(_0x57e45e);if(_0x57e45e){const {contacts:_0x357b27}=_0x57e45e[_0x6202dd(0x284)],_0x71e7b4=getCampaignValidMessages(_0x57e45e),_0x429923=_0x57e45e['confirmation']?getCampaignValidConfirmationMessages(_0x57e45e):null;if((0x0,lodash_1[_0x6202dd(0x29d)])(_0x357b27)){let _0x1828d1=0x0;_0x357b27[_0x6202dd(0x22b)](_0x30ee00=>{const _0x45c986=_0x6202dd;prepareContact(_0x57e45e,_0x2e1e60[_0x45c986(0x27e)],_0x30ee00,_0x38863a,_0x71e7b4,_0x429923)[_0x45c986(0x1f4)](()=>{const _0x110d73=_0x45c986;logger_1[_0x110d73(0x20b)][_0x110d73(0x268)]('Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha='+_0x57e45e['id']+_0x110d73(0x1bb)+_0x30ee00[_0x110d73(0x1d0)]+_0x110d73(0x27a)+_0x38863a);}),_0x1828d1+=0x1,_0x1828d1%_0x2e1e60[_0x45c986(0x25b)]===0x0?_0x38863a+=parseToMilliseconds(_0x2e1e60[_0x45c986(0x257)]):_0x38863a+=parseToMilliseconds(randomValue(0x0,_0x2e1e60['messageInterval']));}),await _0x57e45e[_0x6202dd(0x269)]({'status':_0x6202dd(0x261)});}}}catch(_0x2bd7b7){Sentry[_0x6202dd(0x216)](_0x2bd7b7);}}function a346_0x117b(_0x7b1858,_0x471e9c){const _0x11dae5=a346_0x2b4e();return a346_0x117b=function(_0x53ea8b,_0x4b7e10){_0x53ea8b=_0x53ea8b-0x1bb;let _0x2b4e01=_0x11dae5[_0x53ea8b];return _0x2b4e01;},a346_0x117b(_0x7b1858,_0x471e9c);}async function handleDispatchCampaign(_0x403dc6){const _0x3c1b28=a346_0x18ac5c;try{const {data:_0x3b35f0}=_0x403dc6,{campaignShippingId:_0x1f44cf,campaignId:_0x5d905b}=_0x3b35f0,_0x4a2cb6=await Campaign_1[_0x3c1b28(0x1c6)][_0x3c1b28(0x266)](_0x5d905b,{'include':[{'model':Whatsapp_1[_0x3c1b28(0x1c6)],'as':'whatsapp'}]});if(!_0x4a2cb6){logger_1[_0x3c1b28(0x20b)][_0x3c1b28(0x231)]({'data':_0x3b35f0},_0x3c1b28(0x224));return;}const _0x539f20=await(0x0,GetWhatsappWbot_1[_0x3c1b28(0x1c6)])(_0x4a2cb6['whatsapp']);logger_1[_0x3c1b28(0x20b)][_0x3c1b28(0x268)]('Disparo\x20de\x20campanha\x20solicitado:\x20Campanha='+_0x5d905b+_0x3c1b28(0x1e3)+_0x1f44cf);const _0x44a024=await CampaignShipping_1[_0x3c1b28(0x1c6)][_0x3c1b28(0x266)](_0x1f44cf,{'include':[{'model':ContactListItem_1[_0x3c1b28(0x1c6)],'as':_0x3c1b28(0x26a)}]}),_0x122283=_0x44a024[_0x3c1b28(0x1c5)]+_0x3c1b28(0x1ea);if(_0x4a2cb6[_0x3c1b28(0x2aa)]&&_0x44a024[_0x3c1b28(0x2aa)]===null)await _0x539f20[_0x3c1b28(0x228)](_0x122283,{'text':_0x44a024[_0x3c1b28(0x299)]}),await _0x44a024['update']({'confirmationRequestedAt':(0x0,moment_1['default'])()});else{await _0x539f20[_0x3c1b28(0x228)](_0x122283,{'text':_0x44a024[_0x3c1b28(0x1c1)]});if(_0x4a2cb6['mediaPath']){const _0x35c90c=path_1[_0x3c1b28(0x1c6)]['resolve'](_0x3c1b28(0x236),_0x4a2cb6[_0x3c1b28(0x1e1)]),_0x49a54b=await(0x0,SendWhatsAppMedia_1[_0x3c1b28(0x24a)])(_0x4a2cb6[_0x3c1b28(0x246)],_0x35c90c);Object['keys'](_0x49a54b)[_0x3c1b28(0x1d8)]&&await _0x539f20[_0x3c1b28(0x228)](_0x122283,{..._0x49a54b});}await _0x44a024[_0x3c1b28(0x269)]({'deliveredAt':(0x0,moment_1[_0x3c1b28(0x1c6)])()});}await verifyAndFinalizeCampaign(_0x4a2cb6);const _0x3895dd=(0x0,socket_1['getIO'])();_0x3895dd[_0x3c1b28(0x297)](_0x3c1b28(0x22a)+_0x4a2cb6[_0x3c1b28(0x23f)]+_0x3c1b28(0x217),{'action':_0x3c1b28(0x269),'record':_0x4a2cb6}),logger_1['logger'][_0x3c1b28(0x268)]('Campanha\x20enviada\x20para:\x20Campanha='+_0x5d905b+';Contato='+_0x44a024['contact']['name']);}catch(_0x562894){Sentry[_0x3c1b28(0x216)](_0x562894),logger_1[_0x3c1b28(0x20b)]['error'](_0x562894[_0x3c1b28(0x1c1)]);}}async function handleLoginStatus(){const _0x3e8190=a346_0x18ac5c,_0xb23370=await database_1[_0x3e8190(0x1c6)][_0x3e8190(0x1d5)]('select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true',{'type':sequelize_1[_0x3e8190(0x262)]['SELECT']});_0xb23370['forEach'](async _0x4f963b=>{const _0x7256f=_0x3e8190;try{const _0x56fd15=await User_1['default']['findByPk'](_0x4f963b['id']);await _0x56fd15[_0x7256f(0x269)]({'online':![]}),logger_1['logger']['info'](_0x7256f(0x1c8)+_0x4f963b['id']);}catch(_0x16bc59){Sentry[_0x7256f(0x216)](_0x16bc59);}});}async function handleInvoiceCreate(){const _0xc332f8=a346_0x18ac5c,_0x1ec08c=new cron_1[(_0xc332f8(0x288))]('0\x20*\x20*\x20*\x20*\x20*',async()=>{const _0x2544f3=_0xc332f8,_0x26ec63=await Company_1['default'][_0x2544f3(0x1e6)]();_0x26ec63[_0x2544f3(0x238)](async _0xdd4518=>{const _0x4f6325=_0x2544f3,{dueDate:_0x344b76}=_0xdd4518,_0x4f6163=(0x0,moment_1[_0x4f6325(0x1c6)])(_0x344b76)[_0x4f6325(0x290)](),_0x4ea5ac=(0x0,moment_1[_0x4f6325(0x1c6)])()[_0x4f6325(0x290)](),_0x26e6b1=(0x0,moment_1['default'])((0x0,moment_1['default'])())[_0x4f6325(0x290)](_0x4f6325(0x212)),_0x277d90=(0x0,moment_1[_0x4f6325(0x1c6)])(_0x344b76)[_0x4f6325(0x290)](_0x4f6325(0x212)),_0x49e228=(0x0,moment_1[_0x4f6325(0x1c6)])(_0x277d90,_0x4f6325(0x212))[_0x4f6325(0x264)]((0x0,moment_1[_0x4f6325(0x1c6)])(_0x26e6b1,_0x4f6325(0x212))),_0x38e8f6=moment_1[_0x4f6325(0x1c6)][_0x4f6325(0x227)](_0x49e228)[_0x4f6325(0x25d)]();if(_0x38e8f6<0x14){const _0x3c2c0c=await Plan_1[_0x4f6325(0x1c6)]['findByPk'](_0xdd4518[_0x4f6325(0x26c)]),_0xdffe6=_0x4f6325(0x1f5)+_0xdd4518['id']+_0x4f6325(0x21c)+(0x0,moment_1[_0x4f6325(0x1c6)])(_0x344b76)[_0x4f6325(0x290)](_0x4f6325(0x1bd))+_0x4f6325(0x279),_0x2319cc=await database_1[_0x4f6325(0x1c6)][_0x4f6325(0x1d5)](_0xdffe6,{'type':sequelize_1[_0x4f6325(0x262)][_0x4f6325(0x273)]});if(+_0x2319cc[0x0]['mycount']===0x0){const _0x5f0d22=_0x4f6325(0x27b)+_0x3c2c0c[_0x4f6325(0x1d0)]+_0x4f6325(0x20d)+_0x3c2c0c[_0x4f6325(0x27d)]+_0x4f6325(0x1dd)+_0x4ea5ac+_0x4f6325(0x1dd)+_0x4ea5ac+_0x4f6325(0x1dd)+_0x4f6163+_0x4f6325(0x274)+_0xdd4518['id']+');';await database_1[_0x4f6325(0x1c6)][_0x4f6325(0x1d5)](_0x5f0d22,{'type':sequelize_1[_0x4f6325(0x262)]['INSERT']});}}});});_0x1ec08c[_0xc332f8(0x260)]();}handleInvoiceCreate();async function startQueueProcess(){const _0x3a7334=a346_0x18ac5c;logger_1['logger'][_0x3a7334(0x268)]('Iniciando\x20processamento\x20de\x20filas'),exports[_0x3a7334(0x292)][_0x3a7334(0x1de)](_0x3a7334(0x1bc),handleSendMessage),exports['scheduleMonitor'][_0x3a7334(0x1de)](_0x3a7334(0x248),handleVerifySchedules),exports['sendScheduledMessages'][_0x3a7334(0x1de)]('SendMessage',handleSendScheduledMessage),exports[_0x3a7334(0x2a6)][_0x3a7334(0x1de)](_0x3a7334(0x1cd),handleVerifyCampaigns),exports['campaignQueue'][_0x3a7334(0x1de)](_0x3a7334(0x242),handleProcessCampaign),exports['campaignQueue']['process'](_0x3a7334(0x2a3),handleDispatchCampaign),exports[_0x3a7334(0x1d6)][_0x3a7334(0x1de)]('VerifyLoginStatus',handleLoginStatus),exports['campaignQueue'][_0x3a7334(0x1de)](_0x3a7334(0x1fc),handleDispatchCampaign),exports[_0x3a7334(0x201)][_0x3a7334(0x1de)](_0x3a7334(0x1e2),handleVerifyTicketExpiration),exports[_0x3a7334(0x295)]['process'](_0x3a7334(0x1e5),handleWhatsappAutoRestart),exports[_0x3a7334(0x1ed)][_0x3a7334(0x1f1)](_0x3a7334(0x248),{},{'repeat':{'cron':'*/5\x20*\x20*\x20*\x20*\x20*'},'removeOnComplete':!![]}),exports[_0x3a7334(0x2a6)][_0x3a7334(0x1f1)](_0x3a7334(0x1cd),{},{'repeat':{'cron':_0x3a7334(0x24f)},'removeOnComplete':!![]}),exports[_0x3a7334(0x1d6)][_0x3a7334(0x1f1)](_0x3a7334(0x219),{},{'repeat':{'cron':'*\x20*\x20*\x20*\x20*'},'removeOnComplete':!![]}),exports[_0x3a7334(0x201)][_0x3a7334(0x1f1)]('VerifyTicketExpiration',{},{'repeat':{'cron':_0x3a7334(0x276)},'removeOnComplete':!![]}),exports[_0x3a7334(0x295)][_0x3a7334(0x1f1)](_0x3a7334(0x1e5),{},{'repeat':{'cron':_0x3a7334(0x232)},'removeOnComplete':!![]});}