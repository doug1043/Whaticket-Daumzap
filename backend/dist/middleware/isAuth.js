const a368_0x1b8617=a368_0x25b7;(function(_0x436924,_0x2b9f18){const _0x4861d6=a368_0x25b7,_0x172380=_0x436924();while(!![]){try{const _0x279940=-parseInt(_0x4861d6(0x113))/0x1*(-parseInt(_0x4861d6(0x10f))/0x2)+-parseInt(_0x4861d6(0x118))/0x3*(parseInt(_0x4861d6(0x103))/0x4)+-parseInt(_0x4861d6(0x101))/0x5*(-parseInt(_0x4861d6(0x106))/0x6)+-parseInt(_0x4861d6(0xf6))/0x7+parseInt(_0x4861d6(0xfa))/0x8+-parseInt(_0x4861d6(0x104))/0x9+parseInt(_0x4861d6(0x111))/0xa;if(_0x279940===_0x2b9f18)break;else _0x172380['push'](_0x172380['shift']());}catch(_0x5a8606){_0x172380['push'](_0x172380['shift']());}}}(a368_0x73c7,0xdfbfd));const a368_0x3bfca7=(function(){let _0x585847=!![];return function(_0x44b0a9,_0x5fc7b1){const _0x3867b8=_0x585847?function(){const _0x238914=a368_0x25b7;if(_0x5fc7b1){const _0x399678=_0x5fc7b1[_0x238914(0xec)](_0x44b0a9,arguments);return _0x5fc7b1=null,_0x399678;}}:function(){};return _0x585847=![],_0x3867b8;};}()),a368_0x242fcf=a368_0x3bfca7(this,function(){const _0x91d38b=a368_0x25b7;return a368_0x242fcf[_0x91d38b(0x10a)]()[_0x91d38b(0x10d)](_0x91d38b(0x107))[_0x91d38b(0x10a)]()[_0x91d38b(0x116)](a368_0x242fcf)[_0x91d38b(0x10d)](_0x91d38b(0x107));});a368_0x242fcf();'use strict';var __importDefault=this&&this[a368_0x1b8617(0xff)]||function(_0x1e43be){return _0x1e43be&&_0x1e43be['__esModule']?_0x1e43be:{'default':_0x1e43be};};function a368_0x25b7(_0x277193,_0x4e3e18){const _0x552294=a368_0x73c7();return a368_0x25b7=function(_0x242fcf,_0x3bfca7){_0x242fcf=_0x242fcf-0xea;let _0x73c7e5=_0x552294[_0x242fcf];return _0x73c7e5;},a368_0x25b7(_0x277193,_0x4e3e18);}Object[a368_0x1b8617(0x110)](exports,a368_0x1b8617(0xee),{'value':!![]});const jsonwebtoken_1=require(a368_0x1b8617(0x108)),AppError_1=__importDefault(require(a368_0x1b8617(0x114))),auth_1=__importDefault(require(a368_0x1b8617(0xef))),User_1=__importDefault(require('../models/User')),ProfilePermission_1=__importDefault(require('../models/ProfilePermission')),workHoursCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8,isAuth=async(_0x1e5b17,_0x268f08,_0x4321f9)=>{const _0x209974=a368_0x1b8617;if(_0x1e5b17?.[_0x209974(0x119)])return _0x4321f9();const _0x527005=_0x1e5b17[_0x209974(0x11b)][_0x209974(0xf1)];if(!_0x527005)throw new AppError_1['default']('ERR_SESSION_EXPIRED',0x191,_0x209974(0x109));const [,_0x585e18]=_0x527005[_0x209974(0xfe)]('\x20');let _0x2cb34a;try{_0x2cb34a=(0x0,jsonwebtoken_1[_0x209974(0xeb)])(_0x585e18),_0x1e5b17['tokenData']=(0x0,jsonwebtoken_1[_0x209974(0xed)])(_0x585e18,auth_1['default']['secret']);const _0x2da36a=await ProfilePermission_1[_0x209974(0x105)][_0x209974(0xf4)]({'where':{'profile':_0x1e5b17[_0x209974(0x10e)][_0x209974(0x115)],'companyId':_0x1e5b17['tokenData']['companyId']}});_0x1e5b17[_0x209974(0x119)]={'id':_0x1e5b17[_0x209974(0x10e)]['id'],'profile':_0x1e5b17[_0x209974(0x10e)]['profile'],'isSuper':_0x1e5b17[_0x209974(0x10e)][_0x209974(0xf8)],'companyId':_0x1e5b17['tokenData'][_0x209974(0xf5)],'permissions':_0x2da36a?{'canEditContacts':_0x2da36a[_0x209974(0x100)],'canSpyConversations':_0x2da36a[_0x209974(0xfb)],'canViewTicketsWithoutQueue':_0x2da36a[_0x209974(0xfc)],'allowedRoutes':_0x2da36a[_0x209974(0x10c)]?JSON[_0x209974(0xfd)](_0x2da36a[_0x209974(0x10c)]):[]}:undefined};if(_0x1e5b17['tokenData'][_0x209974(0x115)]!==_0x209974(0xf2)){const _0x5944c2=_0x1e5b17['tokenData']['id'],_0x1c52ce=Date[_0x209974(0xf9)]();let _0x1671fb=workHoursCache[_0x209974(0xf7)](_0x5944c2);if(!_0x1671fb||_0x1c52ce-_0x1671fb['timestamp']>CACHE_DURATION){const _0x111cb0=await User_1[_0x209974(0x105)][_0x209974(0x112)](_0x5944c2,{'attributes':['startWork',_0x209974(0xea)]});_0x111cb0&&_0x111cb0['startWork']&&_0x111cb0[_0x209974(0xea)]&&(_0x1671fb={'startWork':_0x111cb0[_0x209974(0x102)],'endWork':_0x111cb0['endWork'],'timestamp':_0x1c52ce},workHoursCache[_0x209974(0x11a)](_0x5944c2,_0x1671fb));}if(_0x1671fb){const _0xf08d8b=new Date(),_0x505687=String(_0xf08d8b[_0x209974(0x117)]())[_0x209974(0x10b)](0x2,'0')+':'+String(_0xf08d8b['getMinutes']())[_0x209974(0x10b)](0x2,'0');if(_0x505687<_0x1671fb[_0x209974(0x102)]||_0x505687>_0x1671fb[_0x209974(0xea)])throw new AppError_1[(_0x209974(0x105))](_0x209974(0xf0),0x191);}}}catch(_0x2921d4){if(_0x2921d4 instanceof AppError_1[_0x209974(0x105)])throw _0x2921d4;throw new AppError_1[(_0x209974(0x105))](_0x209974(0xf3)+_0x2cb34a?.['id']+'\x20Invalid\x20token.\x20We\x27ll\x20try\x20to\x20assign\x20a\x20new\x20one\x20on\x20next\x20request',0x193,_0x209974(0x109));}return _0x4321f9();};exports[a368_0x1b8617(0x105)]=isAuth;function a368_0x73c7(){const _0x30912b=['defineProperty','32750420xyVzAC','findByPk','208654URZJrL','../errors/AppError','profile','constructor','getHours','276753QoIrPS','user','set','headers','endWork','decode','apply','verify','__esModule','../config/auth','ERR_OUT_OF_WORK_HOURS','authorization','admin','User:\x20','findOne','companyId','9936157KtdMRA','get','super','now','5592936TCTStf','canSpyConversations','canViewTicketsWithoutQueue','parse','split','__importDefault','canEditContacts','417405BUsPEo','startWork','8THRixI','16464105jSwMvS','default','12rbSETA','(((.+)+)+)+$','jsonwebtoken','debug','toString','padStart','allowedRoutes','search','tokenData','2FsdWQW'];a368_0x73c7=function(){return _0x30912b;};return a368_0x73c7();}