const a367_0x5d0317=a367_0x21d6;(function(_0x1dedad,_0x5868d4){const _0x5e03fc=a367_0x21d6,_0x1de8a3=_0x1dedad();while(!![]){try{const _0x18e852=-parseInt(_0x5e03fc(0xc2))/0x1+parseInt(_0x5e03fc(0xd2))/0x2*(parseInt(_0x5e03fc(0xbd))/0x3)+parseInt(_0x5e03fc(0xca))/0x4*(parseInt(_0x5e03fc(0xd6))/0x5)+parseInt(_0x5e03fc(0xcc))/0x6*(-parseInt(_0x5e03fc(0xb8))/0x7)+parseInt(_0x5e03fc(0xb5))/0x8*(parseInt(_0x5e03fc(0xc0))/0x9)+parseInt(_0x5e03fc(0xaa))/0xa+-parseInt(_0x5e03fc(0xad))/0xb;if(_0x18e852===_0x5868d4)break;else _0x1de8a3['push'](_0x1de8a3['shift']());}catch(_0x2d67ad){_0x1de8a3['push'](_0x1de8a3['shift']());}}}(a367_0x232c,0x645fb));const a367_0x1ee5d8=(function(){let _0x4e349a=!![];return function(_0x3135fa,_0x53bd2c){const _0x5d36a8=_0x4e349a?function(){const _0x415086=a367_0x21d6;if(_0x53bd2c){const _0x148af3=_0x53bd2c[_0x415086(0xcd)](_0x3135fa,arguments);return _0x53bd2c=null,_0x148af3;}}:function(){};return _0x4e349a=![],_0x5d36a8;};}()),a367_0x21b1d9=a367_0x1ee5d8(this,function(){const _0x41c5b7=a367_0x21d6;return a367_0x21b1d9[_0x41c5b7(0xc4)]()['search']('(((.+)+)+)+$')[_0x41c5b7(0xc4)]()[_0x41c5b7(0xd0)](a367_0x21b1d9)['search'](_0x41c5b7(0xab));});a367_0x21b1d9();'use strict';var __importDefault=this&&this[a367_0x5d0317(0xb3)]||function(_0x47dde3){return _0x47dde3&&_0x47dde3['__esModule']?_0x47dde3:{'default':_0x47dde3};};Object[a367_0x5d0317(0xb4)](exports,'__esModule',{'value':!![]});const jsonwebtoken_1=require(a367_0x5d0317(0xd3)),AppError_1=__importDefault(require('../errors/AppError')),auth_1=__importDefault(require(a367_0x5d0317(0xc8))),User_1=__importDefault(require(a367_0x5d0317(0xb7))),ProfilePermission_1=__importDefault(require(a367_0x5d0317(0xbc))),workHoursCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8,isAuth=async(_0x2ed18f,_0x2b7c46,_0x31162c)=>{const _0x3ffa90=a367_0x5d0317;if(_0x2ed18f?.[_0x3ffa90(0xc1)])return _0x31162c();const _0x50a5a3=_0x2ed18f[_0x3ffa90(0xc3)][_0x3ffa90(0xcf)];if(!_0x50a5a3)throw new AppError_1[(_0x3ffa90(0xcb))](_0x3ffa90(0xb2),0x191,_0x3ffa90(0xd7));const [,_0x23fa8a]=_0x50a5a3[_0x3ffa90(0xc9)]('\x20');let _0x95e093;try{_0x95e093=(0x0,jsonwebtoken_1['decode'])(_0x23fa8a),_0x2ed18f[_0x3ffa90(0xbe)]=(0x0,jsonwebtoken_1[_0x3ffa90(0xac)])(_0x23fa8a,auth_1[_0x3ffa90(0xcb)][_0x3ffa90(0xb6)]);const _0x555227=await ProfilePermission_1['default']['findOne']({'where':{'profile':_0x2ed18f[_0x3ffa90(0xbe)][_0x3ffa90(0xb9)],'companyId':_0x2ed18f[_0x3ffa90(0xbe)][_0x3ffa90(0xd5)]}});_0x2ed18f[_0x3ffa90(0xc1)]={'id':_0x2ed18f[_0x3ffa90(0xbe)]['id'],'profile':_0x2ed18f[_0x3ffa90(0xbe)]['profile'],'isSuper':_0x2ed18f[_0x3ffa90(0xbe)]['super'],'companyId':_0x2ed18f['tokenData']['companyId'],'permissions':_0x555227?{'canEditContacts':_0x555227[_0x3ffa90(0xb0)],'canSpyConversations':_0x555227['canSpyConversations'],'canViewTicketsWithoutQueue':_0x555227[_0x3ffa90(0xbb)],'allowedRoutes':_0x555227[_0x3ffa90(0xce)]?JSON[_0x3ffa90(0xc5)](_0x555227[_0x3ffa90(0xce)]):[]}:undefined};if(_0x2ed18f[_0x3ffa90(0xbe)][_0x3ffa90(0xb9)]!=='admin'){const _0x64468b=_0x2ed18f[_0x3ffa90(0xbe)]['id'],_0x16dda0=Date['now']();let _0x29eb65=workHoursCache['get'](_0x64468b);if(!_0x29eb65||_0x16dda0-_0x29eb65[_0x3ffa90(0xd4)]>CACHE_DURATION){const _0x15136b=await User_1[_0x3ffa90(0xcb)][_0x3ffa90(0xd1)](_0x64468b,{'attributes':[_0x3ffa90(0xc6),_0x3ffa90(0xc7)]});_0x15136b&&_0x15136b[_0x3ffa90(0xc6)]&&_0x15136b[_0x3ffa90(0xc7)]&&(_0x29eb65={'startWork':_0x15136b[_0x3ffa90(0xc6)],'endWork':_0x15136b[_0x3ffa90(0xc7)],'timestamp':_0x16dda0},workHoursCache[_0x3ffa90(0xba)](_0x64468b,_0x29eb65));}if(_0x29eb65){const _0x2fff50=new Date(),_0x3f3473=String(_0x2fff50['getHours']())['padStart'](0x2,'0')+':'+String(_0x2fff50[_0x3ffa90(0xaf)]())[_0x3ffa90(0xbf)](0x2,'0');if(_0x3f3473<_0x29eb65[_0x3ffa90(0xc6)]||_0x3f3473>_0x29eb65['endWork'])throw new AppError_1['default'](_0x3ffa90(0xb1),0x191);}}}catch(_0x343589){if(_0x343589 instanceof AppError_1[_0x3ffa90(0xcb)])throw _0x343589;throw new AppError_1[(_0x3ffa90(0xcb))]('User:\x20'+_0x95e093?.['id']+_0x3ffa90(0xae),0x193,_0x3ffa90(0xd7));}return _0x31162c();};function a367_0x21d6(_0x1bf738,_0xf0c6cd){const _0x2ee9e3=a367_0x232c();return a367_0x21d6=function(_0x21b1d9,_0x1ee5d8){_0x21b1d9=_0x21b1d9-0xaa;let _0x232c62=_0x2ee9e3[_0x21b1d9];return _0x232c62;},a367_0x21d6(_0x1bf738,_0xf0c6cd);}function a367_0x232c(){const _0x4d6359=['headers','toString','parse','startWork','endWork','../config/auth','split','28QCIgCS','default','1432734eWHYWn','apply','allowedRoutes','authorization','constructor','findByPk','198492tMsUwo','jsonwebtoken','timestamp','companyId','359435JcKMdc','debug','6844150HlmnNZ','(((.+)+)+)+$','verify','4076325UmCpkW','\x20Invalid\x20token.\x20We\x27ll\x20try\x20to\x20assign\x20a\x20new\x20one\x20on\x20next\x20request','getMinutes','canEditContacts','ERR_OUT_OF_WORK_HOURS','ERR_SESSION_EXPIRED','__importDefault','defineProperty','8LhAJGI','secret','../models/User','7goJrpS','profile','set','canViewTicketsWithoutQueue','../models/ProfilePermission','6yRXgNv','tokenData','padStart','2059011dwhaev','user','594400ADnROz'];a367_0x232c=function(){return _0x4d6359;};return a367_0x232c();}exports[a367_0x5d0317(0xcb)]=isAuth;