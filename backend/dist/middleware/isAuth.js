function a368_0x3344(_0x186fb8,_0x2e2279){const _0x2ddab0=a368_0x1359();return a368_0x3344=function(_0x48d300,_0x2fad4a){_0x48d300=_0x48d300-0x75;let _0x13598e=_0x2ddab0[_0x48d300];return _0x13598e;},a368_0x3344(_0x186fb8,_0x2e2279);}const a368_0x51eb27=a368_0x3344;(function(_0x169981,_0x2f4841){const _0x502ae2=a368_0x3344,_0xec7079=_0x169981();while(!![]){try{const _0x15202b=-parseInt(_0x502ae2(0x95))/0x1*(parseInt(_0x502ae2(0x88))/0x2)+parseInt(_0x502ae2(0x8a))/0x3+parseInt(_0x502ae2(0x94))/0x4*(parseInt(_0x502ae2(0x75))/0x5)+-parseInt(_0x502ae2(0x84))/0x6*(-parseInt(_0x502ae2(0x9c))/0x7)+-parseInt(_0x502ae2(0xa1))/0x8+-parseInt(_0x502ae2(0x7d))/0x9+parseInt(_0x502ae2(0x8c))/0xa*(-parseInt(_0x502ae2(0x9b))/0xb);if(_0x15202b===_0x2f4841)break;else _0xec7079['push'](_0xec7079['shift']());}catch(_0x467d19){_0xec7079['push'](_0xec7079['shift']());}}}(a368_0x1359,0x89247));function a368_0x1359(){const _0x15b1b6=['admin','8810HtoqJs','tokenData','2480865wixmot','headers','170LnRKqV','apply','set','canEditContacts','defineProperty','ERR_OUT_OF_WORK_HOURS','search','authorization','12imCLzp','1NSGujU','secret','user','now','decode','default','514327PgdWhY','147dILlxV','../errors/AppError','allowedRoutes','constructor','canSpyConversations','3998952TsCxuw','toString','endWork','debug','(((.+)+)+)+$','1026835WbsjuV','super','getMinutes','ERR_SESSION_EXPIRED','__esModule','verify','getHours','findByPk','5634603VvPSGc','timestamp','startWork','companyId','../models/ProfilePermission','parse','profile','298254wTwcVy','padStart','canViewTicketsWithoutQueue'];a368_0x1359=function(){return _0x15b1b6;};return a368_0x1359();}const a368_0x2fad4a=(function(){let _0x212340=!![];return function(_0x22b310,_0x207c7b){const _0x2b684b=_0x212340?function(){const _0x5eebdd=a368_0x3344;if(_0x207c7b){const _0x39a6ff=_0x207c7b[_0x5eebdd(0x8d)](_0x22b310,arguments);return _0x207c7b=null,_0x39a6ff;}}:function(){};return _0x212340=![],_0x2b684b;};}()),a368_0x48d300=a368_0x2fad4a(this,function(){const _0x17492f=a368_0x3344;return a368_0x48d300[_0x17492f(0xa2)]()['search'](_0x17492f(0xa5))[_0x17492f(0xa2)]()[_0x17492f(0x9f)](a368_0x48d300)[_0x17492f(0x92)](_0x17492f(0xa5));});a368_0x48d300();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x17fe34){const _0x59ca2c=a368_0x3344;return _0x17fe34&&_0x17fe34[_0x59ca2c(0x79)]?_0x17fe34:{'default':_0x17fe34};};Object[a368_0x51eb27(0x90)](exports,a368_0x51eb27(0x79),{'value':!![]});const jsonwebtoken_1=require('jsonwebtoken'),AppError_1=__importDefault(require(a368_0x51eb27(0x9d))),auth_1=__importDefault(require('../config/auth')),User_1=__importDefault(require('../models/User')),ProfilePermission_1=__importDefault(require(a368_0x51eb27(0x81))),workHoursCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8,isAuth=async(_0x273afe,_0x2d301a,_0x4a5d81)=>{const _0x20a3dd=a368_0x51eb27;if(_0x273afe?.[_0x20a3dd(0x97)])return _0x4a5d81();const _0x1b4134=_0x273afe[_0x20a3dd(0x8b)][_0x20a3dd(0x93)];if(!_0x1b4134)throw new AppError_1['default'](_0x20a3dd(0x78),0x191,'debug');const [,_0x209296]=_0x1b4134['split']('\x20');let _0x26ff25;try{_0x26ff25=(0x0,jsonwebtoken_1[_0x20a3dd(0x99)])(_0x209296),_0x273afe[_0x20a3dd(0x89)]=(0x0,jsonwebtoken_1[_0x20a3dd(0x7a)])(_0x209296,auth_1[_0x20a3dd(0x9a)][_0x20a3dd(0x96)]);const _0x519fc6=await ProfilePermission_1[_0x20a3dd(0x9a)]['findOne']({'where':{'profile':_0x273afe[_0x20a3dd(0x89)]['profile'],'companyId':_0x273afe[_0x20a3dd(0x89)][_0x20a3dd(0x80)]}});_0x273afe['user']={'id':_0x273afe[_0x20a3dd(0x89)]['id'],'profile':_0x273afe[_0x20a3dd(0x89)][_0x20a3dd(0x83)],'isSuper':_0x273afe[_0x20a3dd(0x89)][_0x20a3dd(0x76)],'companyId':_0x273afe[_0x20a3dd(0x89)]['companyId'],'permissions':_0x519fc6?{'canEditContacts':_0x519fc6[_0x20a3dd(0x8f)],'canSpyConversations':_0x519fc6[_0x20a3dd(0xa0)],'canViewTicketsWithoutQueue':_0x519fc6[_0x20a3dd(0x86)],'allowedRoutes':_0x519fc6[_0x20a3dd(0x9e)]?JSON[_0x20a3dd(0x82)](_0x519fc6['allowedRoutes']):[]}:undefined};if(_0x273afe[_0x20a3dd(0x89)][_0x20a3dd(0x83)]!==_0x20a3dd(0x87)){const _0xc7870a=_0x273afe['tokenData']['id'],_0x5ea536=Date[_0x20a3dd(0x98)]();let _0x2ea0b6=workHoursCache['get'](_0xc7870a);if(!_0x2ea0b6||_0x5ea536-_0x2ea0b6[_0x20a3dd(0x7e)]>CACHE_DURATION){const _0x36c757=await User_1[_0x20a3dd(0x9a)][_0x20a3dd(0x7c)](_0xc7870a,{'attributes':[_0x20a3dd(0x7f),_0x20a3dd(0xa3)]});_0x36c757&&_0x36c757['startWork']&&_0x36c757[_0x20a3dd(0xa3)]&&(_0x2ea0b6={'startWork':_0x36c757[_0x20a3dd(0x7f)],'endWork':_0x36c757[_0x20a3dd(0xa3)],'timestamp':_0x5ea536},workHoursCache[_0x20a3dd(0x8e)](_0xc7870a,_0x2ea0b6));}if(_0x2ea0b6){const _0x598101=new Date(),_0x55a046=String(_0x598101[_0x20a3dd(0x7b)]())[_0x20a3dd(0x85)](0x2,'0')+':'+String(_0x598101[_0x20a3dd(0x77)]())[_0x20a3dd(0x85)](0x2,'0');if(_0x55a046<_0x2ea0b6['startWork']||_0x55a046>_0x2ea0b6[_0x20a3dd(0xa3)])throw new AppError_1[(_0x20a3dd(0x9a))](_0x20a3dd(0x91),0x191);}}}catch(_0x4ba11a){if(_0x4ba11a instanceof AppError_1[_0x20a3dd(0x9a)])throw _0x4ba11a;throw new AppError_1[(_0x20a3dd(0x9a))]('User:\x20'+_0x26ff25?.['id']+'\x20Invalid\x20token.\x20We\x27ll\x20try\x20to\x20assign\x20a\x20new\x20one\x20on\x20next\x20request',0x193,_0x20a3dd(0xa4));}return _0x4a5d81();};exports[a368_0x51eb27(0x9a)]=isAuth;