const a303_0x1bd5a4=a303_0x49cc;(function(_0x565b0f,_0x3201ab){const _0x5f2438=a303_0x49cc,_0x3682c4=_0x565b0f();while(!![]){try{const _0x1f2cab=parseInt(_0x5f2438(0xaa))/0x1+-parseInt(_0x5f2438(0x91))/0x2+-parseInt(_0x5f2438(0x92))/0x3*(-parseInt(_0x5f2438(0x88))/0x4)+-parseInt(_0x5f2438(0x8f))/0x5+parseInt(_0x5f2438(0x8d))/0x6*(parseInt(_0x5f2438(0x9d))/0x7)+-parseInt(_0x5f2438(0xab))/0x8*(parseInt(_0x5f2438(0xa8))/0x9)+-parseInt(_0x5f2438(0x9e))/0xa;if(_0x1f2cab===_0x3201ab)break;else _0x3682c4['push'](_0x3682c4['shift']());}catch(_0x49a6f7){_0x3682c4['push'](_0x3682c4['shift']());}}}(a303_0x29be,0x8b2b0));function a303_0x29be(){const _0x31c36a=['../models/User','startWork','(((.+)+)+)+$','tokenData','../errors/AppError','endWork','defineProperty','toString','get','profile','817313khhHBt','3766130dkUklH','secret','split','padStart','search','__esModule','authorization','debug','constructor','getMinutes','3907791SLsHUv','companyId','663286pnQZcv','8HbkYvF','super','decode','findByPk','200kuraMV','user','User:\x20','default','set','30seXwHB','ERR_SESSION_EXPIRED','2735200CkdWEa','ERR_OUT_OF_WORK_HOURS','820094rVVIXE','65451MPYbAa'];a303_0x29be=function(){return _0x31c36a;};return a303_0x29be();}const a303_0xacc312=(function(){let _0x4ab24c=!![];return function(_0x2d9de2,_0x43a52b){const _0x5d4418=_0x4ab24c?function(){if(_0x43a52b){const _0x1ebb0e=_0x43a52b['apply'](_0x2d9de2,arguments);return _0x43a52b=null,_0x1ebb0e;}}:function(){};return _0x4ab24c=![],_0x5d4418;};}()),a303_0x3c2fa9=a303_0xacc312(this,function(){const _0x3c1f1d=a303_0x49cc;return a303_0x3c2fa9[_0x3c1f1d(0x9a)]()[_0x3c1f1d(0xa2)](_0x3c1f1d(0x95))[_0x3c1f1d(0x9a)]()[_0x3c1f1d(0xa6)](a303_0x3c2fa9)[_0x3c1f1d(0xa2)](_0x3c1f1d(0x95));});function a303_0x49cc(_0x38341a,_0x291149){const _0x4dadf3=a303_0x29be();return a303_0x49cc=function(_0x3c2fa9,_0xacc312){_0x3c2fa9=_0x3c2fa9-0x86;let _0x29be1e=_0x4dadf3[_0x3c2fa9];return _0x29be1e;},a303_0x49cc(_0x38341a,_0x291149);}a303_0x3c2fa9();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x19e21b){const _0x5172f8=a303_0x49cc;return _0x19e21b&&_0x19e21b[_0x5172f8(0xa3)]?_0x19e21b:{'default':_0x19e21b};};Object[a303_0x1bd5a4(0x99)](exports,'__esModule',{'value':!![]});const jsonwebtoken_1=require('jsonwebtoken'),AppError_1=__importDefault(require(a303_0x1bd5a4(0x97))),auth_1=__importDefault(require('../config/auth')),User_1=__importDefault(require(a303_0x1bd5a4(0x93))),workHoursCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8,isAuth=async(_0x360acd,_0x250d97,_0x30f86f)=>{const _0x54f634=a303_0x1bd5a4;if(_0x360acd?.[_0x54f634(0x89)])return _0x30f86f();const _0x2b6466=_0x360acd['headers'][_0x54f634(0xa4)];if(!_0x2b6466)throw new AppError_1[(_0x54f634(0x8b))](_0x54f634(0x8e),0x191,_0x54f634(0xa5));const [,_0x3fc0e4]=_0x2b6466[_0x54f634(0xa0)]('\x20');let _0x1b85e8;try{_0x1b85e8=(0x0,jsonwebtoken_1[_0x54f634(0x86)])(_0x3fc0e4),_0x360acd[_0x54f634(0x96)]=(0x0,jsonwebtoken_1['verify'])(_0x3fc0e4,auth_1[_0x54f634(0x8b)][_0x54f634(0x9f)]),_0x360acd[_0x54f634(0x89)]={'id':_0x360acd[_0x54f634(0x96)]['id'],'profile':_0x360acd[_0x54f634(0x96)]['profile'],'isSuper':_0x360acd[_0x54f634(0x96)][_0x54f634(0xac)],'companyId':_0x360acd['tokenData'][_0x54f634(0xa9)]};if(_0x360acd[_0x54f634(0x96)][_0x54f634(0x9c)]!=='admin'){const _0xc61d89=_0x360acd[_0x54f634(0x96)]['id'],_0x36cab4=Date['now']();let _0x514a16=workHoursCache[_0x54f634(0x9b)](_0xc61d89);if(!_0x514a16||_0x36cab4-_0x514a16['timestamp']>CACHE_DURATION){const _0x5de6e8=await User_1[_0x54f634(0x8b)][_0x54f634(0x87)](_0xc61d89,{'attributes':[_0x54f634(0x94),'endWork']});_0x5de6e8&&_0x5de6e8['startWork']&&_0x5de6e8[_0x54f634(0x98)]&&(_0x514a16={'startWork':_0x5de6e8[_0x54f634(0x94)],'endWork':_0x5de6e8['endWork'],'timestamp':_0x36cab4},workHoursCache[_0x54f634(0x8c)](_0xc61d89,_0x514a16));}if(_0x514a16){const _0x39ca7f=new Date(),_0x1756c2=String(_0x39ca7f['getHours']())['padStart'](0x2,'0')+':'+String(_0x39ca7f[_0x54f634(0xa7)]())[_0x54f634(0xa1)](0x2,'0');if(_0x1756c2<_0x514a16[_0x54f634(0x94)]||_0x1756c2>_0x514a16['endWork'])throw new AppError_1[(_0x54f634(0x8b))](_0x54f634(0x90),0x191);}}}catch(_0x533ac7){if(_0x533ac7 instanceof AppError_1[_0x54f634(0x8b)])throw _0x533ac7;throw new AppError_1[(_0x54f634(0x8b))](_0x54f634(0x8a)+_0x1b85e8?.['id']+'\x20Invalid\x20token.\x20We\x27ll\x20try\x20to\x20assign\x20a\x20new\x20one\x20on\x20next\x20request',0x193,'debug');}return _0x30f86f();};exports['default']=isAuth;