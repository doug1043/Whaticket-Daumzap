function a288_0x1f29(_0x36720e,_0x477551){const _0x449d4e=a288_0x4123();return a288_0x1f29=function(_0x681d05,_0x1c34da){_0x681d05=_0x681d05-0x1de;let _0x4123a2=_0x449d4e[_0x681d05];return _0x4123a2;},a288_0x1f29(_0x36720e,_0x477551);}const a288_0x42fbfe=a288_0x1f29;function a288_0x4123(){const _0x16d151=['joinNotification[','User\x20','(((.+)+)+)+$','handshake','Client\x20Connected','getIO','../utils/logger','logger','Admin\x20',']:\x20User:\x20','queues','jsonwebtoken','464542BZRQiZ','onConnect:\x20User\x20','notification','leaveChatBox','env','profile','\x20joined\x20','\x20by\x20user\x20','Socket\x20IO\x20not\x20initialized','ticket-',']:\x20Channel:\x20','-notification','forEach','\x20joined\x20queue\x20','7jwhubh','debug','search','__importDefault','create','../config/auth','admin','incrementCounter','email','leaveTickets','status-','query','leave','__esModule','Server','2940TJtXFy','disabled','\x20not\x20found','pending','730HYxkTc','update','GetCompanySetting','message','super','development','Error\x20fetching\x20ticket\x20','331677UkgsJt','userId','join','joinTickets','socket.io','\x20of\x20company\x20','findByPk','\x20cannot\x20subscribe\x20to\x20','disconnect','constructor','then','passwordHash','Invalid\x20attempt\x20to\x20join\x20channel\x20of\x20ticket\x20','./counter','info','../models/UserSocketSession','joinNotification','5795jrKkmF','\x20pending\x20tickets\x20channel.','leaveNotification','toString','../models/Queue','6867126iktJlb','company-','FRONTEND_URL','-mainchannel','963223zasFHk','-pending','Clossing\x20all\x20socket\x20sessions','joinChatbox[','basic','ready','companyId','../errors/AppError','parse','defineProperty','instrument','Error\x20decoding\x20token:\x20','\x20channel.','\x20leaved\x20queue\x20','verify','\x20tickets\x20channel.','apply','initIO','io-onConnection:\x20tokenData','null','1002768oifiYK','\x20leaved\x20','leaveChatbox[','decrementCounter','../helpers/CheckSettings','default','\x20for\x20user\x20','isGroup','groupsTab','enabled','6471128safZnN','undefined','queue-','joinChatBox'];a288_0x4123=function(){return _0x16d151;};return a288_0x4123();}(function(_0x7443b3,_0x33603e){const _0x321df1=a288_0x1f29,_0x4ef093=_0x7443b3();while(!![]){try{const _0x37688d=-parseInt(_0x321df1(0x1e4))/0x1+-parseInt(_0x321df1(0x212))/0x2+-parseInt(_0x321df1(0x1f8))/0x3+-parseInt(_0x321df1(0x22f))/0x4*(parseInt(_0x321df1(0x24b))/0x5)+parseInt(_0x321df1(0x1e0))/0x6+-parseInt(_0x321df1(0x220))/0x7*(parseInt(_0x321df1(0x202))/0x8)+parseInt(_0x321df1(0x23a))/0x9*(parseInt(_0x321df1(0x233))/0xa);if(_0x37688d===_0x33603e)break;else _0x4ef093['push'](_0x4ef093['shift']());}catch(_0x5bec35){_0x4ef093['push'](_0x4ef093['shift']());}}}(a288_0x4123,0x9d4bc));const a288_0x1c34da=(function(){let _0x2d4c5b=!![];return function(_0x460bc7,_0x1f2020){const _0x1acb33=_0x2d4c5b?function(){const _0x883963=a288_0x1f29;if(_0x1f2020){const _0x498b81=_0x1f2020[_0x883963(0x1f4)](_0x460bc7,arguments);return _0x1f2020=null,_0x498b81;}}:function(){};return _0x2d4c5b=![],_0x1acb33;};}()),a288_0x681d05=a288_0x1c34da(this,function(){const _0x50f5a1=a288_0x1f29;return a288_0x681d05[_0x50f5a1(0x1de)]()['search'](_0x50f5a1(0x208))['toString']()[_0x50f5a1(0x243)](a288_0x681d05)[_0x50f5a1(0x222)](_0x50f5a1(0x208));});a288_0x681d05();'use strict';var __importDefault=this&&this[a288_0x42fbfe(0x223)]||function(_0xce26d0){const _0x265677=a288_0x42fbfe;return _0xce26d0&&_0xce26d0[_0x265677(0x22d)]?_0xce26d0:{'default':_0xce26d0};};Object[a288_0x42fbfe(0x1ed)](exports,a288_0x42fbfe(0x22d),{'value':!![]}),exports[a288_0x42fbfe(0x20b)]=exports[a288_0x42fbfe(0x1f5)]=void 0x0;const socket_io_1=require(a288_0x42fbfe(0x23e)),admin_ui_1=require('@socket.io/admin-ui'),jsonwebtoken_1=require(a288_0x42fbfe(0x211)),AppError_1=__importDefault(require(a288_0x42fbfe(0x1eb))),logger_1=require(a288_0x42fbfe(0x20c)),User_1=__importDefault(require('../models/User')),Queue_1=__importDefault(require(a288_0x42fbfe(0x1df))),Ticket_1=__importDefault(require('../models/Ticket')),auth_1=__importDefault(require(a288_0x42fbfe(0x225))),counter_1=require(a288_0x42fbfe(0x247)),UserSocketSession_1=__importDefault(require(a288_0x42fbfe(0x249))),CheckSettings_1=require(a288_0x42fbfe(0x1fc));let io;const joinTicketChannel=async(_0x352b7c,_0x34fd01,_0x7ffc7b,_0x3f1c55)=>{const _0x64c5c5=a288_0x42fbfe,_0x1583ab=_0x3f1c55[_0x64c5c5(0x227)](_0x64c5c5(0x21b)+_0x34fd01);_0x1583ab===0x1&&_0x352b7c[_0x64c5c5(0x23c)](_0x34fd01),logger_1['logger'][_0x64c5c5(0x221)](_0x64c5c5(0x1e7)+_0x1583ab+']:\x20Channel:\x20'+_0x34fd01+'\x20by\x20user\x20'+_0x7ffc7b['id']);},initIO=_0x458417=>{const _0x36de53=a288_0x42fbfe;return io=new socket_io_1[(_0x36de53(0x22e))](_0x458417,{'cors':{'origin':process[_0x36de53(0x216)][_0x36de53(0x1e2)]}}),process['env']['SOCKET_ADMIN']&&JSON[_0x36de53(0x1ec)](process[_0x36de53(0x216)]['SOCKET_ADMIN'])&&User_1[_0x36de53(0x1fd)]['findByPk'](0x1)[_0x36de53(0x244)](_0x23bfeb=>{const _0x982572=_0x36de53;(0x0,admin_ui_1[_0x982572(0x1ee)])(io,{'auth':{'type':_0x982572(0x1e8),'username':_0x23bfeb[_0x982572(0x228)],'password':_0x23bfeb[_0x982572(0x245)]},'mode':_0x982572(0x238)});}),UserSocketSession_1[_0x36de53(0x1fd)][_0x36de53(0x234)]({'active':![]},{'where':{'active':!![]}})['then'](_0x2d4d6a=>{const _0x41c83d=_0x36de53;logger_1['logger'][_0x41c83d(0x221)](_0x41c83d(0x1e6));}),io['on']('connection',async _0x1e08dc=>{const _0x47c4e4=_0x36de53;logger_1[_0x47c4e4(0x20d)][_0x47c4e4(0x248)](_0x47c4e4(0x20a));const {token:_0x5e9f3c}=_0x1e08dc[_0x47c4e4(0x209)][_0x47c4e4(0x22b)];let _0x10f21d=null;try{_0x10f21d=(0x0,jsonwebtoken_1[_0x47c4e4(0x1f2)])(_0x5e9f3c,auth_1['default']['secret']),logger_1[_0x47c4e4(0x20d)][_0x47c4e4(0x221)](_0x10f21d,_0x47c4e4(0x1f6));}catch(_0x74d7ba){return logger_1[_0x47c4e4(0x20d)]['debug'](_0x47c4e4(0x1ef)+_0x74d7ba?.[_0x47c4e4(0x236)]),_0x1e08dc[_0x47c4e4(0x242)](),io;}const _0xc86b9d=new counter_1['CounterManager']();let _0x1316a9=null;const _0x3748f4=_0x10f21d['id'];if(_0x3748f4&&_0x3748f4!=='undefined'&&_0x3748f4!==_0x47c4e4(0x1f7)){_0x1316a9=await User_1[_0x47c4e4(0x1fd)][_0x47c4e4(0x240)](_0x3748f4,{'include':[Queue_1[_0x47c4e4(0x1fd)]]});if(_0x1316a9)_0x1316a9['online']=!![],await _0x1316a9['save']();else return logger_1['logger'][_0x47c4e4(0x248)](_0x47c4e4(0x213)+_0x3748f4+_0x47c4e4(0x231)),_0x1e08dc[_0x47c4e4(0x242)](),io;}else return logger_1[_0x47c4e4(0x20d)]['info']('onConnect:\x20Missing\x20userId'),_0x1e08dc['disconnect'](),io;return UserSocketSession_1[_0x47c4e4(0x1fd)][_0x47c4e4(0x224)]({'id':_0x1e08dc['id'],'userId':_0x3748f4,'active':!![]})[_0x47c4e4(0x244)](_0x2e9009=>{const _0x461a85=_0x47c4e4;logger_1[_0x461a85(0x20d)][_0x461a85(0x221)]('started\x20session\x20'+_0x1e08dc['id']+'\x20for\x20user\x20'+_0x3748f4);}),_0x1e08dc['on'](_0x47c4e4(0x242),async()=>{UserSocketSession_1['default']['update']({'active':![]},{'where':{'id':_0x1e08dc['id']}})['then'](()=>{const _0x94bdfc=a288_0x1f29;logger_1[_0x94bdfc(0x20d)]['debug']('finished\x20session\x20'+_0x1e08dc['id']+_0x94bdfc(0x1fe)+_0x3748f4);});}),_0x1e08dc['join'](_0x47c4e4(0x1e1)+_0x1316a9[_0x47c4e4(0x1ea)]+_0x47c4e4(0x1e3)),_0x1e08dc[_0x47c4e4(0x23c)]('user-'+_0x1316a9['id']),_0x1316a9[_0x47c4e4(0x237)]&&_0x1e08dc['join'](_0x47c4e4(0x237)),_0x1e08dc['on'](_0x47c4e4(0x205),async _0x5cf9e1=>{const _0x145e7b=_0x47c4e4;if(!_0x5cf9e1||_0x5cf9e1==='undefined')return;Ticket_1['default']['findByPk'](_0x5cf9e1)[_0x145e7b(0x244)](async _0x495939=>{const _0x57d0cf=_0x145e7b;if(_0x495939&&_0x495939['companyId']===_0x1316a9[_0x57d0cf(0x1ea)]&&(_0x495939[_0x57d0cf(0x23b)]===_0x1316a9['id']||_0x1316a9['profile']===_0x57d0cf(0x226)))joinTicketChannel(_0x1e08dc,_0x5cf9e1,_0x1316a9,_0xc86b9d);else{if(_0x495939[_0x57d0cf(0x1ff)]&&await(0x0,CheckSettings_1[_0x57d0cf(0x235)])(_0x1316a9[_0x57d0cf(0x1ea)],_0x57d0cf(0x200),_0x57d0cf(0x230))===_0x57d0cf(0x201)){let _0x4ea494=![];_0x1316a9[_0x57d0cf(0x210)][_0x57d0cf(0x21e)](_0x56d985=>{_0x56d985['id']===_0x495939['queueId']&&(_0x4ea494=!![]);}),_0x4ea494?joinTicketChannel(_0x1e08dc,_0x5cf9e1,_0x1316a9,_0xc86b9d):logger_1[_0x57d0cf(0x20d)][_0x57d0cf(0x248)](_0x57d0cf(0x246)+_0x5cf9e1+'\x20by\x20user\x20'+_0x1316a9['id']);}else logger_1['logger'][_0x57d0cf(0x248)](_0x57d0cf(0x246)+_0x5cf9e1+_0x57d0cf(0x219)+_0x1316a9['id']);}},_0x49b71c=>{const _0x697625=_0x145e7b;logger_1[_0x697625(0x20d)]['error'](_0x49b71c,_0x697625(0x239)+_0x5cf9e1);});}),_0x1e08dc['on'](_0x47c4e4(0x215),async _0x11b310=>{const _0x213613=_0x47c4e4;if(!_0x11b310||_0x11b310===_0x213613(0x203))return;const _0x9ed2f1=_0xc86b9d[_0x213613(0x1fb)](_0x213613(0x21b)+_0x11b310);_0x9ed2f1===0x0&&_0x1e08dc['leave'](_0x11b310),logger_1[_0x213613(0x20d)][_0x213613(0x221)](_0x213613(0x1fa)+_0x9ed2f1+_0x213613(0x21c)+_0x11b310+_0x213613(0x219)+_0x1316a9['id']);}),_0x1e08dc['on'](_0x47c4e4(0x24a),async()=>{const _0x4d5cfa=_0x47c4e4,_0x2d93a1=_0xc86b9d[_0x4d5cfa(0x227)](_0x4d5cfa(0x214));_0x2d93a1===0x1&&(_0x1316a9[_0x4d5cfa(0x217)]===_0x4d5cfa(0x226)?_0x1e08dc[_0x4d5cfa(0x23c)](_0x4d5cfa(0x1e1)+_0x1316a9['companyId']+_0x4d5cfa(0x21d)):_0x1316a9['queues'][_0x4d5cfa(0x21e)](_0x3615ff=>{const _0x1ed9b8=_0x4d5cfa;logger_1[_0x1ed9b8(0x20d)][_0x1ed9b8(0x221)](_0x1ed9b8(0x207)+_0x1316a9['id']+_0x1ed9b8(0x23f)+_0x1316a9[_0x1ed9b8(0x1ea)]+'\x20joined\x20queue\x20'+_0x3615ff['id']+_0x1ed9b8(0x1f0)),_0x1e08dc[_0x1ed9b8(0x23c)](_0x1ed9b8(0x204)+_0x3615ff['id']+_0x1ed9b8(0x21d));})),logger_1[_0x4d5cfa(0x20d)]['debug'](_0x4d5cfa(0x206)+_0x2d93a1+_0x4d5cfa(0x20f)+_0x1316a9['id']);}),_0x1e08dc['on'](_0x47c4e4(0x24d),async()=>{const _0x5cebe3=_0x47c4e4,_0x5c7a9f=_0xc86b9d[_0x5cebe3(0x1fb)]('notification');_0x5c7a9f===0x0&&(_0x1316a9['profile']===_0x5cebe3(0x226)?_0x1e08dc[_0x5cebe3(0x22c)](_0x5cebe3(0x1e1)+_0x1316a9[_0x5cebe3(0x1ea)]+_0x5cebe3(0x21d)):_0x1316a9[_0x5cebe3(0x210)][_0x5cebe3(0x21e)](_0x6351ea=>{const _0x408313=_0x5cebe3;logger_1[_0x408313(0x20d)]['debug'](_0x408313(0x207)+_0x1316a9['id']+'\x20of\x20company\x20'+_0x1316a9[_0x408313(0x1ea)]+_0x408313(0x1f1)+_0x6351ea['id']+'\x20channel.'),_0x1e08dc['leave'](_0x408313(0x204)+_0x6351ea['id']+_0x408313(0x21d));})),logger_1['logger'][_0x5cebe3(0x221)]('leaveNotification['+_0x5c7a9f+']:\x20User:\x20'+_0x1316a9['id']);}),_0x1e08dc['on'](_0x47c4e4(0x23d),_0x59f515=>{const _0x32acd8=_0x47c4e4;if(_0xc86b9d['incrementCounter'](_0x32acd8(0x22a)+_0x59f515)===0x1){if(_0x1316a9['profile']===_0x32acd8(0x226))logger_1[_0x32acd8(0x20d)][_0x32acd8(0x221)](_0x32acd8(0x20e)+_0x1316a9['id']+'\x20of\x20company\x20'+_0x1316a9[_0x32acd8(0x1ea)]+_0x32acd8(0x218)+_0x59f515+_0x32acd8(0x1f3)),_0x1e08dc['join'](_0x32acd8(0x1e1)+_0x1316a9['companyId']+'-'+_0x59f515);else _0x59f515==='pending'?_0x1316a9[_0x32acd8(0x210)][_0x32acd8(0x21e)](_0x56196f=>{const _0x44bf25=_0x32acd8;logger_1['logger'][_0x44bf25(0x221)](_0x44bf25(0x207)+_0x1316a9['id']+'\x20of\x20company\x20'+_0x1316a9['companyId']+_0x44bf25(0x21f)+_0x56196f['id']+_0x44bf25(0x24c)),_0x1e08dc[_0x44bf25(0x23c)](_0x44bf25(0x204)+_0x56196f['id']+_0x44bf25(0x1e5));}):logger_1[_0x32acd8(0x20d)][_0x32acd8(0x221)](_0x32acd8(0x207)+_0x1316a9['id']+_0x32acd8(0x241)+_0x59f515);}}),_0x1e08dc['on'](_0x47c4e4(0x229),_0x3088b1=>{const _0x103b8b=_0x47c4e4;if(_0xc86b9d[_0x103b8b(0x1fb)]('status-'+_0x3088b1)===0x0){if(_0x1316a9['profile']===_0x103b8b(0x226))logger_1['logger'][_0x103b8b(0x221)](_0x103b8b(0x20e)+_0x1316a9['id']+'\x20of\x20company\x20'+_0x1316a9['companyId']+_0x103b8b(0x1f9)+_0x3088b1+_0x103b8b(0x1f3)),_0x1e08dc[_0x103b8b(0x22c)]('company-'+_0x1316a9['companyId']+'-'+_0x3088b1);else _0x3088b1===_0x103b8b(0x232)&&_0x1316a9[_0x103b8b(0x210)]['forEach'](_0xbe621a=>{const _0x3545bc=_0x103b8b;logger_1['logger']['debug'](_0x3545bc(0x207)+_0x1316a9['id']+_0x3545bc(0x23f)+_0x1316a9['companyId']+_0x3545bc(0x1f1)+_0xbe621a['id']+'\x20pending\x20tickets\x20channel.'),_0x1e08dc[_0x3545bc(0x22c)](_0x3545bc(0x204)+_0xbe621a['id']+'-pending');});}}),_0x1e08dc['emit'](_0x47c4e4(0x1e9)),io;}),io;};exports[a288_0x42fbfe(0x1f5)]=initIO;const getIO=()=>{const _0x26cd0a=a288_0x42fbfe;if(!io)throw new AppError_1['default'](_0x26cd0a(0x21a));return io;};exports[a288_0x42fbfe(0x20b)]=getIO;