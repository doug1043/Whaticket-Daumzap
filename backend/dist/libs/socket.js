const a257_0x15e9a3=a257_0x2de6;(function(_0x25beed,_0x8c8200){const _0x1051ab=a257_0x2de6,_0xc3830b=_0x25beed();while(!![]){try{const _0x548ba8=parseInt(_0x1051ab(0x164))/0x1+parseInt(_0x1051ab(0x180))/0x2+parseInt(_0x1051ab(0x183))/0x3*(-parseInt(_0x1051ab(0x156))/0x4)+-parseInt(_0x1051ab(0x195))/0x5+parseInt(_0x1051ab(0x1a7))/0x6+-parseInt(_0x1051ab(0x188))/0x7*(parseInt(_0x1051ab(0x15a))/0x8)+parseInt(_0x1051ab(0x169))/0x9*(parseInt(_0x1051ab(0x155))/0xa);if(_0x548ba8===_0x8c8200)break;else _0xc3830b['push'](_0xc3830b['shift']());}catch(_0x5c1c33){_0xc3830b['push'](_0xc3830b['shift']());}}}(a257_0x46ae,0x23b20));function a257_0x2de6(_0x152e13,_0x37f572){const _0xd6bf09=a257_0x46ae();return a257_0x2de6=function(_0x268479,_0x282731){_0x268479=_0x268479-0x14a;let _0x46aec7=_0xd6bf09[_0x268479];return _0x46aec7;},a257_0x2de6(_0x152e13,_0x37f572);}const a257_0x282731=(function(){let _0x42637d=!![];return function(_0x284ed0,_0x3cd859){const _0x578a97=_0x42637d?function(){if(_0x3cd859){const _0x30d15d=_0x3cd859['apply'](_0x284ed0,arguments);return _0x3cd859=null,_0x30d15d;}}:function(){};return _0x42637d=![],_0x578a97;};}()),a257_0x268479=a257_0x282731(this,function(){const _0x5d1ffb=a257_0x2de6;return a257_0x268479[_0x5d1ffb(0x158)]()['search']('(((.+)+)+)+$')[_0x5d1ffb(0x158)]()['constructor'](a257_0x268479)[_0x5d1ffb(0x16b)]('(((.+)+)+)+$');});a257_0x268479();function a257_0x46ae(){const _0x2cb88e=['Usuário\x20','../models/User','companyId','leave','20783GKogYK','leaveNotification[','Usuário\x20desconectado:\x20','joinNotification[','\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20','findByPk','handshake','../errors/AppError','query','profile','Usuário\x20conectado:\x20','Erro\x20ao\x20buscar\x20ticket\x20','user-','1451820dZtXpj','jsonwebtoken','auth','SOCKET_ADMIN','\x20pelo\x20usuário\x20','warn','-mainchannel',']:\x20Usuário:\x20','test','joinNotification','Token\x20inválido','-notification','\x20saiu\x20do\x20canal\x20de\x20tickets\x20','allTicket','FRONTEND_URL','Erro\x20de\x20autenticação:\x20','getIO','../models/Ticket','1050666ymicEF','leaveTickets','notification','company-','__esModule','CounterManager','Usuário\x20não\x20encontrado','basic','leaveNotification','ID\x20de\x20ticket\x20inválido:\x20','../models/Queue','error','decrementCounter','debug','default','\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20','logger','\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','socket.io','1134690sZkaZz','900jYkrVC','use','toString','data','72dGcvep','@socket.io/admin-ui','connection','queues','env','message','save','initIO','number',']:\x20Canal:\x20','254465RKvNNG','online','Server','\x20da\x20empresa\x20','disconnect','9UneBnZ','forEach','search','joinTickets','user','status-','admin','then','\x20entrou\x20no\x20canal\x20de\x20tickets\x20','incrementCounter','instrument','parse','queue-','leaveChatbox[','../utils/logger','join','string','__importDefault','Socket\x20IO\x20não\x20inicializado','token','passwordHash','joinChatBox','ticket-','141546aZkQcJ','\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','Falha\x20na\x20autenticação','2007HfZjGA'];a257_0x46ae=function(){return _0x2cb88e;};return a257_0x46ae();}'use strict';var __importDefault=this&&this[a257_0x15e9a3(0x17a)]||function(_0x11efed){return _0x11efed&&_0x11efed['__esModule']?_0x11efed:{'default':_0x11efed};};Object['defineProperty'](exports,a257_0x15e9a3(0x1ab),{'value':!![]}),exports[a257_0x15e9a3(0x1a5)]=exports['initIO']=void 0x0;const socket_io_1=require(a257_0x15e9a3(0x154)),admin_ui_1=require(a257_0x15e9a3(0x15b)),jsonwebtoken_1=require(a257_0x15e9a3(0x196)),AppError_1=__importDefault(require(a257_0x15e9a3(0x18f))),logger_1=require(a257_0x15e9a3(0x177)),User_1=__importDefault(require(a257_0x15e9a3(0x185))),Queue_1=__importDefault(require(a257_0x15e9a3(0x14c))),Ticket_1=__importDefault(require(a257_0x15e9a3(0x1a6))),auth_1=__importDefault(require('../config/auth')),counter_1=require('./counter');let io;const initIO=_0x502ead=>{const _0x5551b9=a257_0x15e9a3;return io=new socket_io_1[(_0x5551b9(0x166))](_0x502ead,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process[_0x5551b9(0x15e)][_0x5551b9(0x1a3)]}}),process[_0x5551b9(0x15e)][_0x5551b9(0x198)]&&JSON[_0x5551b9(0x174)](process[_0x5551b9(0x15e)][_0x5551b9(0x198)])&&User_1[_0x5551b9(0x150)][_0x5551b9(0x18d)](0x1)[_0x5551b9(0x170)](_0x166463=>{const _0x538697=_0x5551b9;(0x0,admin_ui_1[_0x538697(0x173)])(io,{'auth':{'type':_0x538697(0x1ae),'username':_0x166463['email'],'password':_0x166463[_0x538697(0x17d)]},'mode':'development'});}),io[_0x5551b9(0x157)](async(_0x598b96,_0x3ba87f)=>{const _0x21a347=_0x5551b9;try{const _0x127049=_0x598b96[_0x21a347(0x18e)][_0x21a347(0x197)][_0x21a347(0x17c)]||_0x598b96[_0x21a347(0x18e)][_0x21a347(0x190)][_0x21a347(0x17c)];if(!_0x127049)throw new Error('Token\x20não\x20fornecido');const _0x21201a=(0x0,jsonwebtoken_1['verify'])(_0x127049,auth_1[_0x21a347(0x150)]['secret']);if(!_0x21201a||typeof _0x21201a['id']!==_0x21a347(0x162))throw new Error(_0x21a347(0x19f));const _0x4b6843=await User_1[_0x21a347(0x150)][_0x21a347(0x18d)](_0x21201a['id'],{'include':[Queue_1[_0x21a347(0x150)]]});if(!_0x4b6843)throw new Error(_0x21a347(0x1ad));_0x598b96[_0x21a347(0x159)][_0x21a347(0x16d)]=_0x4b6843,_0x3ba87f();}catch(_0x36407c){logger_1['logger'][_0x21a347(0x14d)](_0x21a347(0x1a4)+_0x36407c[_0x21a347(0x15f)]),_0x3ba87f(new Error(_0x21a347(0x182)));}}),io['on'](_0x5551b9(0x15c),async _0x17b31b=>{const _0xba0959=_0x5551b9,_0x297e4c=_0x17b31b[_0xba0959(0x159)][_0xba0959(0x16d)],_0x1ec97b=new counter_1[(_0xba0959(0x1ac))]();logger_1[_0xba0959(0x152)]['info'](_0xba0959(0x192)+_0x297e4c['id']),_0x297e4c['online']=!![],await _0x297e4c[_0xba0959(0x160)](),_0x17b31b[_0xba0959(0x178)](_0xba0959(0x1aa)+_0x297e4c[_0xba0959(0x186)]+_0xba0959(0x19b)),_0x17b31b['join'](_0xba0959(0x1aa)+_0x297e4c[_0xba0959(0x186)]),_0x17b31b[_0xba0959(0x178)](_0xba0959(0x194)+_0x297e4c['id']),_0x17b31b['on'](_0xba0959(0x17e),async _0x1aa050=>{const _0x5b29c4=_0xba0959;if(typeof _0x1aa050!=='string'||!/^\d+$/[_0x5b29c4(0x19d)](_0x1aa050)){logger_1['logger'][_0x5b29c4(0x19a)](_0x5b29c4(0x14b)+_0x1aa050);return;}try{const _0x460220=await Ticket_1['default'][_0x5b29c4(0x18d)](_0x1aa050);if(_0x460220&&_0x460220['companyId']===_0x297e4c['companyId']&&(_0x460220['userId']===_0x297e4c['id']||_0x297e4c[_0x5b29c4(0x191)]==='admin'||_0x297e4c['allTicket'])){const _0x2bf14a=_0x1ec97b[_0x5b29c4(0x172)]('ticket-'+_0x1aa050);_0x2bf14a===0x1&&_0x17b31b[_0x5b29c4(0x178)](_0x1aa050),logger_1[_0x5b29c4(0x152)][_0x5b29c4(0x14f)]('joinChatbox['+_0x2bf14a+_0x5b29c4(0x163)+_0x1aa050+_0x5b29c4(0x199)+_0x297e4c['id']);}else logger_1['logger']['warn']('Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20'+_0x1aa050+_0x5b29c4(0x199)+_0x297e4c['id']);}catch(_0x5f2fce){logger_1['logger']['error'](_0x5b29c4(0x193)+_0x1aa050+':\x20'+_0x5f2fce[_0x5b29c4(0x15f)]);}}),_0x17b31b['on']('leaveChatBox',_0xcaa895=>{const _0x4f27ec=_0xba0959;if(typeof _0xcaa895===_0x4f27ec(0x179)&&/^\d+$/[_0x4f27ec(0x19d)](_0xcaa895)){const _0x10b3a2=_0x1ec97b[_0x4f27ec(0x14e)](_0x4f27ec(0x17f)+_0xcaa895);_0x10b3a2===0x0&&_0x17b31b[_0x4f27ec(0x187)](_0xcaa895),logger_1[_0x4f27ec(0x152)]['debug'](_0x4f27ec(0x176)+_0x10b3a2+_0x4f27ec(0x163)+_0xcaa895+'\x20pelo\x20usuário\x20'+_0x297e4c['id']);}}),_0x17b31b['on'](_0xba0959(0x19e),()=>{const _0x21b6b5=_0xba0959,_0x10e936=_0x1ec97b[_0x21b6b5(0x172)](_0x21b6b5(0x1a9));_0x10e936===0x1&&(_0x297e4c[_0x21b6b5(0x191)]===_0x21b6b5(0x16f)||_0x297e4c['allTicket']?_0x17b31b[_0x21b6b5(0x178)](_0x21b6b5(0x1aa)+_0x297e4c[_0x21b6b5(0x186)]+'-notification'):_0x297e4c[_0x21b6b5(0x15d)][_0x21b6b5(0x16a)](_0x527845=>{const _0x45f144=_0x21b6b5;logger_1[_0x45f144(0x152)][_0x45f144(0x14f)](_0x45f144(0x184)+_0x297e4c['id']+_0x45f144(0x167)+_0x297e4c[_0x45f144(0x186)]+_0x45f144(0x18c)+_0x527845['id']+'.'),_0x17b31b[_0x45f144(0x178)](_0x45f144(0x175)+_0x527845['id']+_0x45f144(0x1a0));})),logger_1['logger'][_0x21b6b5(0x14f)](_0x21b6b5(0x18b)+_0x10e936+_0x21b6b5(0x19c)+_0x297e4c['id']);}),_0x17b31b['on'](_0xba0959(0x14a),()=>{const _0x465a2e=_0xba0959,_0x51ba8f=_0x1ec97b[_0x465a2e(0x14e)](_0x465a2e(0x1a9));_0x51ba8f===0x0&&(_0x297e4c[_0x465a2e(0x191)]==='admin'||_0x297e4c['allTicket']?_0x17b31b[_0x465a2e(0x187)](_0x465a2e(0x1aa)+_0x297e4c[_0x465a2e(0x186)]+'-notification'):_0x297e4c[_0x465a2e(0x15d)][_0x465a2e(0x16a)](_0x42dc7e=>{const _0x376833=_0x465a2e;logger_1[_0x376833(0x152)]['debug'](_0x376833(0x184)+_0x297e4c['id']+_0x376833(0x167)+_0x297e4c[_0x376833(0x186)]+_0x376833(0x151)+_0x42dc7e['id']+'.'),_0x17b31b[_0x376833(0x187)](_0x376833(0x175)+_0x42dc7e['id']+'-notification');})),logger_1[_0x465a2e(0x152)][_0x465a2e(0x14f)](_0x465a2e(0x189)+_0x51ba8f+_0x465a2e(0x19c)+_0x297e4c['id']);}),_0x17b31b['on'](_0xba0959(0x16c),_0x416697=>{const _0x17ca5e=_0xba0959;_0x1ec97b['incrementCounter']('status-'+_0x416697)===0x1&&(_0x297e4c[_0x17ca5e(0x191)]===_0x17ca5e(0x16f)||_0x297e4c[_0x17ca5e(0x1a2)]?(logger_1[_0x17ca5e(0x152)]['debug']('Admin\x20'+_0x297e4c['id']+'\x20da\x20empresa\x20'+_0x297e4c['companyId']+_0x17ca5e(0x171)+_0x416697+'.'),_0x17b31b[_0x17ca5e(0x178)](_0x17ca5e(0x1aa)+_0x297e4c[_0x17ca5e(0x186)]+'-'+_0x416697)):_0x297e4c['queues']['forEach'](_0x363713=>{const _0x89ac41=_0x17ca5e;logger_1[_0x89ac41(0x152)][_0x89ac41(0x14f)](_0x89ac41(0x184)+_0x297e4c['id']+_0x89ac41(0x167)+_0x297e4c['companyId']+_0x89ac41(0x153)+_0x363713['id']+'.'),_0x17b31b['join'](_0x89ac41(0x175)+_0x363713['id']+'-'+_0x416697);}));}),_0x17b31b['on'](_0xba0959(0x1a8),_0x2ee454=>{const _0x2447ca=_0xba0959;_0x1ec97b[_0x2447ca(0x14e)](_0x2447ca(0x16e)+_0x2ee454)===0x0&&(_0x297e4c['profile']===_0x2447ca(0x16f)||_0x297e4c[_0x2447ca(0x1a2)]?(logger_1['logger'][_0x2447ca(0x14f)]('Admin\x20'+_0x297e4c['id']+'\x20da\x20empresa\x20'+_0x297e4c[_0x2447ca(0x186)]+_0x2447ca(0x1a1)+_0x2ee454+'.'),_0x17b31b[_0x2447ca(0x187)]('company-'+_0x297e4c[_0x2447ca(0x186)]+'-'+_0x2ee454)):_0x297e4c[_0x2447ca(0x15d)]['forEach'](_0x184fa8=>{const _0x5ab996=_0x2447ca;logger_1[_0x5ab996(0x152)][_0x5ab996(0x14f)](_0x5ab996(0x184)+_0x297e4c['id']+_0x5ab996(0x167)+_0x297e4c[_0x5ab996(0x186)]+_0x5ab996(0x181)+_0x184fa8['id']+'.'),_0x17b31b[_0x5ab996(0x187)]('queue-'+_0x184fa8['id']+'-'+_0x2ee454);}));}),_0x17b31b['on'](_0xba0959(0x168),async()=>{const _0x2aaa16=_0xba0959;logger_1[_0x2aaa16(0x152)]['info'](_0x2aaa16(0x18a)+_0x297e4c['id']),_0x297e4c[_0x2aaa16(0x165)]=![],await _0x297e4c[_0x2aaa16(0x160)]();});}),io;};exports[a257_0x15e9a3(0x161)]=initIO;const getIO=()=>{const _0x1b35da=a257_0x15e9a3;if(!io)throw new AppError_1[(_0x1b35da(0x150))](_0x1b35da(0x17b));return io;};exports[a257_0x15e9a3(0x1a5)]=getIO;