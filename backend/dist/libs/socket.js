const a256_0x5f5c89=a256_0x4709;(function(_0x42152c,_0x41001c){const _0x265462=a256_0x4709,_0x4b0ce1=_0x42152c();while(!![]){try{const _0x3da4d1=parseInt(_0x265462(0x71))/0x1*(parseInt(_0x265462(0xae))/0x2)+parseInt(_0x265462(0x7a))/0x3+-parseInt(_0x265462(0xc8))/0x4*(-parseInt(_0x265462(0x95))/0x5)+parseInt(_0x265462(0x96))/0x6*(-parseInt(_0x265462(0x9c))/0x7)+-parseInt(_0x265462(0x85))/0x8*(parseInt(_0x265462(0xa0))/0x9)+parseInt(_0x265462(0x76))/0xa*(parseInt(_0x265462(0xd0))/0xb)+parseInt(_0x265462(0xcd))/0xc*(parseInt(_0x265462(0xc9))/0xd);if(_0x3da4d1===_0x41001c)break;else _0x4b0ce1['push'](_0x4b0ce1['shift']());}catch(_0x3b4db3){_0x4b0ce1['push'](_0x4b0ce1['shift']());}}}(a256_0x1441,0x4e6cd));const a256_0x3a3901=(function(){let _0x585bfb=!![];return function(_0x56ee22,_0x56e08f){const _0x2e839b=_0x585bfb?function(){const _0x57e189=a256_0x4709;if(_0x56e08f){const _0x2241b9=_0x56e08f[_0x57e189(0x6c)](_0x56ee22,arguments);return _0x56e08f=null,_0x2241b9;}}:function(){};return _0x585bfb=![],_0x2e839b;};}()),a256_0x48e67d=a256_0x3a3901(this,function(){const _0x24bba0=a256_0x4709;return a256_0x48e67d[_0x24bba0(0x81)]()[_0x24bba0(0xb9)](_0x24bba0(0xc5))[_0x24bba0(0x81)]()['constructor'](a256_0x48e67d)[_0x24bba0(0xb9)](_0x24bba0(0xc5));});a256_0x48e67d();function a256_0x4709(_0x12729b,_0x35f6f2){const _0x149c67=a256_0x1441();return a256_0x4709=function(_0x48e67d,_0x3a3901){_0x48e67d=_0x48e67d-0x6a;let _0x144190=_0x149c67[_0x48e67d];return _0x144190;},a256_0x4709(_0x12729b,_0x35f6f2);}'use strict';var __importDefault=this&&this[a256_0x5f5c89(0x6e)]||function(_0x13cc36){const _0x28f0d9=a256_0x5f5c89;return _0x13cc36&&_0x13cc36[_0x28f0d9(0xce)]?_0x13cc36:{'default':_0x13cc36};};Object['defineProperty'](exports,a256_0x5f5c89(0xce),{'value':!![]}),exports[a256_0x5f5c89(0x98)]=exports['initIO']=void 0x0;const socket_io_1=require(a256_0x5f5c89(0xa3)),admin_ui_1=require(a256_0x5f5c89(0x94)),jsonwebtoken_1=require(a256_0x5f5c89(0x9a)),AppError_1=__importDefault(require(a256_0x5f5c89(0xaa))),logger_1=require(a256_0x5f5c89(0x7f)),User_1=__importDefault(require(a256_0x5f5c89(0x93))),Queue_1=__importDefault(require(a256_0x5f5c89(0x9b))),Ticket_1=__importDefault(require(a256_0x5f5c89(0xa6))),auth_1=__importDefault(require(a256_0x5f5c89(0x74))),counter_1=require(a256_0x5f5c89(0xcf));let io;function a256_0x1441(){const _0x10f589=['-mainchannel',']:\x20Canal:\x20','2xoPbnZ','queues','development','token','parse','ticket-','join','Token\x20inválido','Token\x20não\x20fornecido','passwordHash','Usuário\x20','search','Socket\x20IO\x20não\x20inicializado','warn','leaveNotification','Admin\x20','company-','user','info','\x20da\x20empresa\x20','-notification','\x20entrou\x20no\x20canal\x20de\x20tickets\x20','\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20','(((.+)+)+)+$','message','FRONTEND_URL','230064CMunOz','1952769rtoiTi','queue-','connection','Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20','48SaMtqB','__esModule','./counter','11EOWBFi','auth','Erro\x20ao\x20buscar\x20ticket\x20','joinChatbox[','joinNotification[','then','\x20pelo\x20usuário\x20','\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20','apply','forEach','__importDefault','leave','error','139226DMqxKA','leaveTickets','default','../config/auth','initIO','3414400tUEFRF','joinChatBox','notification','handshake','40971ZmicIO','joinTickets','leaveNotification[','instrument','\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','../utils/logger','Erro\x20de\x20autenticação:\x20','toString','status-','findByPk','user-','16gNZLvU','disconnect','secret','data','debug','string','email','profile','leaveChatBox','Falha\x20na\x20autenticação','\x20saiu\x20do\x20canal\x20de\x20tickets\x20','env','decrementCounter','verify','../models/User','@socket.io/admin-ui','25wSweZE','64830TiaAMh','incrementCounter','getIO','allTicket','jsonwebtoken','../models/Queue','280VyDuBH','Server','companyId','save','2831967jsstWJ','Usuário\x20não\x20encontrado','leaveChatbox[','socket.io','online',']:\x20Usuário:\x20','../models/Ticket','admin','query','logger','../errors/AppError','Usuário\x20desconectado:\x20'];a256_0x1441=function(){return _0x10f589;};return a256_0x1441();}const initIO=_0x553527=>{const _0x516b2f=a256_0x5f5c89;return io=new socket_io_1[(_0x516b2f(0x9d))](_0x553527,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process['env'][_0x516b2f(0xc7)]}}),process[_0x516b2f(0x90)]['SOCKET_ADMIN']&&JSON[_0x516b2f(0xb2)](process[_0x516b2f(0x90)]['SOCKET_ADMIN'])&&User_1[_0x516b2f(0x73)][_0x516b2f(0x83)](0x1)[_0x516b2f(0xd5)](_0x1fcbd2=>{const _0xf4a402=_0x516b2f;(0x0,admin_ui_1[_0xf4a402(0x7d)])(io,{'auth':{'type':'basic','username':_0x1fcbd2[_0xf4a402(0x8b)],'password':_0x1fcbd2[_0xf4a402(0xb7)]},'mode':_0xf4a402(0xb0)});}),io['use'](async(_0x2c7ce7,_0x5a3ba6)=>{const _0x42ec25=_0x516b2f;try{const _0x269766=_0x2c7ce7[_0x42ec25(0x79)][_0x42ec25(0xd1)][_0x42ec25(0xb1)]||_0x2c7ce7[_0x42ec25(0x79)][_0x42ec25(0xa8)][_0x42ec25(0xb1)];if(!_0x269766)throw new Error(_0x42ec25(0xb6));const _0x3eaa7a=(0x0,jsonwebtoken_1[_0x42ec25(0x92)])(_0x269766,auth_1[_0x42ec25(0x73)][_0x42ec25(0x87)]);if(!_0x3eaa7a||typeof _0x3eaa7a['id']!=='number')throw new Error(_0x42ec25(0xb5));const _0x2fe8a2=await User_1[_0x42ec25(0x73)][_0x42ec25(0x83)](_0x3eaa7a['id'],{'include':[Queue_1['default']]});if(!_0x2fe8a2)throw new Error(_0x42ec25(0xa1));_0x2c7ce7[_0x42ec25(0x88)][_0x42ec25(0xbf)]=_0x2fe8a2,_0x5a3ba6();}catch(_0x2162ec){logger_1[_0x42ec25(0xa9)][_0x42ec25(0x70)](_0x42ec25(0x80)+_0x2162ec['message']),_0x5a3ba6(new Error(_0x42ec25(0x8e)));}}),io['on'](_0x516b2f(0xcb),async _0x5908f8=>{const _0x4a53d2=_0x516b2f,_0x34604a=_0x5908f8[_0x4a53d2(0x88)][_0x4a53d2(0xbf)],_0x565bf2=new counter_1['CounterManager']();logger_1[_0x4a53d2(0xa9)][_0x4a53d2(0xc0)]('Usuário\x20conectado:\x20'+_0x34604a['id']),_0x34604a[_0x4a53d2(0xa4)]=!![],await _0x34604a[_0x4a53d2(0x9f)](),_0x5908f8['join'](_0x4a53d2(0xbe)+_0x34604a[_0x4a53d2(0x9e)]+_0x4a53d2(0xac)),_0x5908f8[_0x4a53d2(0xb4)](_0x4a53d2(0xbe)+_0x34604a[_0x4a53d2(0x9e)]),_0x5908f8[_0x4a53d2(0xb4)](_0x4a53d2(0x84)+_0x34604a['id']),_0x5908f8['on'](_0x4a53d2(0x77),async _0x5a9c61=>{const _0x437904=_0x4a53d2;if(typeof _0x5a9c61!==_0x437904(0x8a)||!/^\d+$/['test'](_0x5a9c61)){logger_1[_0x437904(0xa9)][_0x437904(0xbb)]('ID\x20de\x20ticket\x20inválido:\x20'+_0x5a9c61);return;}try{const _0x3dd4c3=await Ticket_1[_0x437904(0x73)][_0x437904(0x83)](_0x5a9c61);if(_0x3dd4c3&&_0x3dd4c3[_0x437904(0x9e)]===_0x34604a[_0x437904(0x9e)]&&(_0x3dd4c3['userId']===_0x34604a['id']||_0x34604a['profile']===_0x437904(0xa7)||_0x34604a[_0x437904(0x99)])){const _0x1a481a=_0x565bf2[_0x437904(0x97)](_0x437904(0xb3)+_0x5a9c61);_0x1a481a===0x1&&_0x5908f8['join'](_0x5a9c61),logger_1[_0x437904(0xa9)][_0x437904(0x89)](_0x437904(0xd3)+_0x1a481a+_0x437904(0xad)+_0x5a9c61+'\x20pelo\x20usuário\x20'+_0x34604a['id']);}else logger_1['logger'][_0x437904(0xbb)](_0x437904(0xcc)+_0x5a9c61+_0x437904(0x6a)+_0x34604a['id']);}catch(_0x5026fb){logger_1[_0x437904(0xa9)]['error'](_0x437904(0xd2)+_0x5a9c61+':\x20'+_0x5026fb[_0x437904(0xc6)]);}}),_0x5908f8['on'](_0x4a53d2(0x8d),_0x52f310=>{const _0x4978b9=_0x4a53d2;if(typeof _0x52f310===_0x4978b9(0x8a)&&/^\d+$/['test'](_0x52f310)){const _0x115b0a=_0x565bf2[_0x4978b9(0x91)](_0x4978b9(0xb3)+_0x52f310);_0x115b0a===0x0&&_0x5908f8[_0x4978b9(0x6f)](_0x52f310),logger_1[_0x4978b9(0xa9)]['debug'](_0x4978b9(0xa2)+_0x115b0a+']:\x20Canal:\x20'+_0x52f310+_0x4978b9(0x6a)+_0x34604a['id']);}}),_0x5908f8['on']('joinNotification',()=>{const _0xe9a992=_0x4a53d2,_0x17896a=_0x565bf2[_0xe9a992(0x97)](_0xe9a992(0x78));_0x17896a===0x1&&(_0x34604a[_0xe9a992(0x8c)]===_0xe9a992(0xa7)||_0x34604a[_0xe9a992(0x99)]?_0x5908f8['join'](_0xe9a992(0xbe)+_0x34604a[_0xe9a992(0x9e)]+'-notification'):_0x34604a[_0xe9a992(0xaf)][_0xe9a992(0x6d)](_0x310980=>{const _0x231d5c=_0xe9a992;logger_1['logger'][_0x231d5c(0x89)]('Usuário\x20'+_0x34604a['id']+_0x231d5c(0xc1)+_0x34604a['companyId']+_0x231d5c(0x6b)+_0x310980['id']+'.'),_0x5908f8[_0x231d5c(0xb4)](_0x231d5c(0xca)+_0x310980['id']+_0x231d5c(0xc2));})),logger_1[_0xe9a992(0xa9)][_0xe9a992(0x89)](_0xe9a992(0xd4)+_0x17896a+']:\x20Usuário:\x20'+_0x34604a['id']);}),_0x5908f8['on'](_0x4a53d2(0xbc),()=>{const _0x1ca0ab=_0x4a53d2,_0x30c12d=_0x565bf2[_0x1ca0ab(0x91)](_0x1ca0ab(0x78));_0x30c12d===0x0&&(_0x34604a[_0x1ca0ab(0x8c)]===_0x1ca0ab(0xa7)||_0x34604a[_0x1ca0ab(0x99)]?_0x5908f8[_0x1ca0ab(0x6f)](_0x1ca0ab(0xbe)+_0x34604a['companyId']+'-notification'):_0x34604a['queues'][_0x1ca0ab(0x6d)](_0x229797=>{const _0x375172=_0x1ca0ab;logger_1['logger']['debug']('Usuário\x20'+_0x34604a['id']+'\x20da\x20empresa\x20'+_0x34604a['companyId']+_0x375172(0xc4)+_0x229797['id']+'.'),_0x5908f8['leave'](_0x375172(0xca)+_0x229797['id']+_0x375172(0xc2));})),logger_1[_0x1ca0ab(0xa9)][_0x1ca0ab(0x89)](_0x1ca0ab(0x7c)+_0x30c12d+_0x1ca0ab(0xa5)+_0x34604a['id']);}),_0x5908f8['on'](_0x4a53d2(0x7b),_0x237e06=>{const _0x2aa5b5=_0x4a53d2;_0x565bf2['incrementCounter'](_0x2aa5b5(0x82)+_0x237e06)===0x1&&(_0x34604a[_0x2aa5b5(0x8c)]===_0x2aa5b5(0xa7)||_0x34604a[_0x2aa5b5(0x99)]?(logger_1[_0x2aa5b5(0xa9)][_0x2aa5b5(0x89)]('Admin\x20'+_0x34604a['id']+_0x2aa5b5(0xc1)+_0x34604a[_0x2aa5b5(0x9e)]+_0x2aa5b5(0xc3)+_0x237e06+'.'),_0x5908f8[_0x2aa5b5(0xb4)](_0x2aa5b5(0xbe)+_0x34604a[_0x2aa5b5(0x9e)]+'-'+_0x237e06)):_0x34604a['queues']['forEach'](_0x3c854f=>{const _0x2f0ba1=_0x2aa5b5;logger_1['logger'][_0x2f0ba1(0x89)](_0x2f0ba1(0xb8)+_0x34604a['id']+_0x2f0ba1(0xc1)+_0x34604a['companyId']+'\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20'+_0x3c854f['id']+'.'),_0x5908f8[_0x2f0ba1(0xb4)](_0x2f0ba1(0xca)+_0x3c854f['id']+'-'+_0x237e06);}));}),_0x5908f8['on'](_0x4a53d2(0x72),_0x345bcb=>{const _0x8280ed=_0x4a53d2;_0x565bf2[_0x8280ed(0x91)](_0x8280ed(0x82)+_0x345bcb)===0x0&&(_0x34604a[_0x8280ed(0x8c)]===_0x8280ed(0xa7)||_0x34604a['allTicket']?(logger_1[_0x8280ed(0xa9)][_0x8280ed(0x89)](_0x8280ed(0xbd)+_0x34604a['id']+'\x20da\x20empresa\x20'+_0x34604a[_0x8280ed(0x9e)]+_0x8280ed(0x8f)+_0x345bcb+'.'),_0x5908f8[_0x8280ed(0x6f)]('company-'+_0x34604a[_0x8280ed(0x9e)]+'-'+_0x345bcb)):_0x34604a[_0x8280ed(0xaf)][_0x8280ed(0x6d)](_0x94a540=>{const _0x3a805e=_0x8280ed;logger_1[_0x3a805e(0xa9)][_0x3a805e(0x89)](_0x3a805e(0xb8)+_0x34604a['id']+_0x3a805e(0xc1)+_0x34604a[_0x3a805e(0x9e)]+_0x3a805e(0x7e)+_0x94a540['id']+'.'),_0x5908f8[_0x3a805e(0x6f)](_0x3a805e(0xca)+_0x94a540['id']+'-'+_0x345bcb);}));}),_0x5908f8['on'](_0x4a53d2(0x86),async()=>{const _0x54b05e=_0x4a53d2;logger_1[_0x54b05e(0xa9)][_0x54b05e(0xc0)](_0x54b05e(0xab)+_0x34604a['id']),_0x34604a[_0x54b05e(0xa4)]=![],await _0x34604a[_0x54b05e(0x9f)]();});}),io;};exports[a256_0x5f5c89(0x75)]=initIO;const getIO=()=>{const _0x3c626f=a256_0x5f5c89;if(!io)throw new AppError_1[(_0x3c626f(0x73))](_0x3c626f(0xba));return io;};exports['getIO']=getIO;