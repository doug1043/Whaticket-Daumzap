const a255_0x2605c9=a255_0x27ba;(function(_0x1b79d7,_0x4a5120){const _0x95bb27=a255_0x27ba,_0x293d34=_0x1b79d7();while(!![]){try{const _0x7e7a08=parseInt(_0x95bb27(0x19a))/0x1+parseInt(_0x95bb27(0x165))/0x2*(-parseInt(_0x95bb27(0x1a5))/0x3)+-parseInt(_0x95bb27(0x18b))/0x4*(-parseInt(_0x95bb27(0x1a6))/0x5)+parseInt(_0x95bb27(0x16b))/0x6+parseInt(_0x95bb27(0x152))/0x7*(parseInt(_0x95bb27(0x182))/0x8)+parseInt(_0x95bb27(0x1a8))/0x9*(parseInt(_0x95bb27(0x15c))/0xa)+-parseInt(_0x95bb27(0x19d))/0xb*(parseInt(_0x95bb27(0x1a7))/0xc);if(_0x7e7a08===_0x4a5120)break;else _0x293d34['push'](_0x293d34['shift']());}catch(_0x508063){_0x293d34['push'](_0x293d34['shift']());}}}(a255_0x10ab,0x1b633));const a255_0x461e54=(function(){let _0x3cf961=!![];return function(_0x4be184,_0x15740d){const _0x396901=_0x3cf961?function(){if(_0x15740d){const _0x5a5a7f=_0x15740d['apply'](_0x4be184,arguments);return _0x15740d=null,_0x5a5a7f;}}:function(){};return _0x3cf961=![],_0x396901;};}()),a255_0x10d3bc=a255_0x461e54(this,function(){const _0x483806=a255_0x27ba;return a255_0x10d3bc['toString']()[_0x483806(0x181)]('(((.+)+)+)+$')[_0x483806(0x149)]()['constructor'](a255_0x10d3bc)[_0x483806(0x181)](_0x483806(0x166));});a255_0x10d3bc();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1c0611){const _0x3d6f2d=a255_0x27ba;return _0x1c0611&&_0x1c0611[_0x3d6f2d(0x1aa)]?_0x1c0611:{'default':_0x1c0611};};Object[a255_0x2605c9(0x171)](exports,a255_0x2605c9(0x1aa),{'value':!![]}),exports['getIO']=exports[a255_0x2605c9(0x148)]=void 0x0;const socket_io_1=require(a255_0x2605c9(0x15b)),admin_ui_1=require('@socket.io/admin-ui'),jsonwebtoken_1=require(a255_0x2605c9(0x187)),AppError_1=__importDefault(require(a255_0x2605c9(0x174))),logger_1=require('../utils/logger'),User_1=__importDefault(require(a255_0x2605c9(0x173))),Queue_1=__importDefault(require(a255_0x2605c9(0x183))),Ticket_1=__importDefault(require(a255_0x2605c9(0x1a2))),auth_1=__importDefault(require(a255_0x2605c9(0x18f))),counter_1=require(a255_0x2605c9(0x196));let io;const initIO=_0x17e29b=>{const _0x31fba6=a255_0x2605c9;return io=new socket_io_1['Server'](_0x17e29b,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process[_0x31fba6(0x161)][_0x31fba6(0x1a9)]}}),process['env'][_0x31fba6(0x18a)]&&JSON[_0x31fba6(0x199)](process[_0x31fba6(0x161)][_0x31fba6(0x18a)])&&User_1[_0x31fba6(0x189)]['findByPk'](0x1)[_0x31fba6(0x179)](_0x541e45=>{const _0x3e7669=_0x31fba6;(0x0,admin_ui_1[_0x3e7669(0x16a)])(io,{'auth':{'type':_0x3e7669(0x18e),'username':_0x541e45['email'],'password':_0x541e45[_0x3e7669(0x195)]},'mode':'development'});}),io[_0x31fba6(0x14a)](async(_0x1547a6,_0x499e8f)=>{const _0x40b54f=_0x31fba6;try{const _0x2da6d4=_0x1547a6['handshake'][_0x40b54f(0x14b)][_0x40b54f(0x163)]||_0x1547a6[_0x40b54f(0x146)][_0x40b54f(0x17a)][_0x40b54f(0x163)];if(!_0x2da6d4)throw new Error(_0x40b54f(0x16f));const _0x431cf8=(0x0,jsonwebtoken_1[_0x40b54f(0x17d)])(_0x2da6d4,auth_1['default'][_0x40b54f(0x15d)]);if(!_0x431cf8||typeof _0x431cf8['id']!=='number')throw new Error(_0x40b54f(0x157));const _0x331d1c=await User_1['default']['findByPk'](_0x431cf8['id'],{'include':[Queue_1['default']]});if(!_0x331d1c)throw new Error('Usuário\x20não\x20encontrado');_0x1547a6['data'][_0x40b54f(0x16e)]=_0x331d1c,_0x499e8f();}catch(_0x2bb8c5){logger_1['logger'][_0x40b54f(0x153)](_0x40b54f(0x19f)+_0x2bb8c5[_0x40b54f(0x164)]),_0x499e8f(new Error('Falha\x20na\x20autenticação'));}}),io['on']('connection',async _0x4d8374=>{const _0x146b72=_0x31fba6,_0x1aa64d=_0x4d8374[_0x146b72(0x192)][_0x146b72(0x16e)],_0x64b571=new counter_1['CounterManager']();logger_1['logger'][_0x146b72(0x19e)](_0x146b72(0x1a3)+_0x1aa64d['id']),_0x1aa64d[_0x146b72(0x154)]=!![],await _0x1aa64d[_0x146b72(0x190)](),_0x4d8374[_0x146b72(0x193)](_0x146b72(0x17e)+_0x1aa64d[_0x146b72(0x15e)]+_0x146b72(0x197)),_0x4d8374[_0x146b72(0x193)](_0x146b72(0x17e)+_0x1aa64d[_0x146b72(0x15e)]),_0x4d8374[_0x146b72(0x193)](_0x146b72(0x19c)+_0x1aa64d['id']),_0x4d8374['on']('joinChatBox',async _0x345bb0=>{const _0xc218b5=_0x146b72;if(typeof _0x345bb0!==_0xc218b5(0x159)||!/^\d+$/[_0xc218b5(0x177)](_0x345bb0)){logger_1['logger'][_0xc218b5(0x175)](_0xc218b5(0x156)+_0x345bb0);return;}try{const _0x4b016c=await Ticket_1['default'][_0xc218b5(0x160)](_0x345bb0);if(_0x4b016c&&_0x4b016c['companyId']===_0x1aa64d['companyId']&&(_0x4b016c[_0xc218b5(0x16d)]===_0x1aa64d['id']||_0x1aa64d['profile']===_0xc218b5(0x14c)||_0x1aa64d[_0xc218b5(0x18d)])){const _0x3e16bb=_0x64b571['incrementCounter']('ticket-'+_0x345bb0);_0x3e16bb===0x1&&_0x4d8374[_0xc218b5(0x193)](_0x345bb0),logger_1[_0xc218b5(0x14d)]['debug'](_0xc218b5(0x191)+_0x3e16bb+']:\x20Canal:\x20'+_0x345bb0+'\x20pelo\x20usuário\x20'+_0x1aa64d['id']);}else logger_1[_0xc218b5(0x14d)][_0xc218b5(0x175)](_0xc218b5(0x170)+_0x345bb0+_0xc218b5(0x151)+_0x1aa64d['id']);}catch(_0x5f4c03){logger_1[_0xc218b5(0x14d)][_0xc218b5(0x153)](_0xc218b5(0x185)+_0x345bb0+':\x20'+_0x5f4c03['message']);}}),_0x4d8374['on'](_0x146b72(0x14f),_0x1e1df6=>{const _0x43f3cf=_0x146b72;if(typeof _0x1e1df6===_0x43f3cf(0x159)&&/^\d+$/[_0x43f3cf(0x177)](_0x1e1df6)){const _0x35b84c=_0x64b571['decrementCounter'](_0x43f3cf(0x14e)+_0x1e1df6);_0x35b84c===0x0&&_0x4d8374[_0x43f3cf(0x17f)](_0x1e1df6),logger_1['logger'][_0x43f3cf(0x18c)](_0x43f3cf(0x15f)+_0x35b84c+']:\x20Canal:\x20'+_0x1e1df6+_0x43f3cf(0x151)+_0x1aa64d['id']);}}),_0x4d8374['on'](_0x146b72(0x1a0),()=>{const _0x2ac520=_0x146b72,_0x2480ae=_0x64b571['incrementCounter'](_0x2ac520(0x178));_0x2480ae===0x1&&(_0x1aa64d[_0x2ac520(0x184)]===_0x2ac520(0x14c)||_0x1aa64d[_0x2ac520(0x18d)]?_0x4d8374[_0x2ac520(0x193)](_0x2ac520(0x17e)+_0x1aa64d[_0x2ac520(0x15e)]+_0x2ac520(0x194)):_0x1aa64d['queues'][_0x2ac520(0x16c)](_0x3c2e1d=>{const _0x2afea7=_0x2ac520;logger_1[_0x2afea7(0x14d)][_0x2afea7(0x18c)](_0x2afea7(0x155)+_0x1aa64d['id']+'\x20da\x20empresa\x20'+_0x1aa64d[_0x2afea7(0x15e)]+_0x2afea7(0x198)+_0x3c2e1d['id']+'.'),_0x4d8374[_0x2afea7(0x193)](_0x2afea7(0x172)+_0x3c2e1d['id']+'-notification');})),logger_1['logger'][_0x2ac520(0x18c)](_0x2ac520(0x162)+_0x2480ae+_0x2ac520(0x186)+_0x1aa64d['id']);}),_0x4d8374['on']('leaveNotification',()=>{const _0x2fd36b=_0x146b72,_0x23533d=_0x64b571[_0x2fd36b(0x180)](_0x2fd36b(0x178));_0x23533d===0x0&&(_0x1aa64d[_0x2fd36b(0x184)]==='admin'||_0x1aa64d['allTicket']?_0x4d8374[_0x2fd36b(0x17f)](_0x2fd36b(0x17e)+_0x1aa64d[_0x2fd36b(0x15e)]+_0x2fd36b(0x194)):_0x1aa64d[_0x2fd36b(0x188)][_0x2fd36b(0x16c)](_0x54e626=>{const _0x509871=_0x2fd36b;logger_1[_0x509871(0x14d)][_0x509871(0x18c)](_0x509871(0x155)+_0x1aa64d['id']+_0x509871(0x19b)+_0x1aa64d[_0x509871(0x15e)]+_0x509871(0x169)+_0x54e626['id']+'.'),_0x4d8374[_0x509871(0x17f)]('queue-'+_0x54e626['id']+_0x509871(0x194));})),logger_1[_0x2fd36b(0x14d)]['debug'](_0x2fd36b(0x15a)+_0x23533d+']:\x20Usuário:\x20'+_0x1aa64d['id']);}),_0x4d8374['on']('joinTickets',_0x41d167=>{const _0x2a6bd8=_0x146b72;_0x64b571[_0x2a6bd8(0x17b)](_0x2a6bd8(0x176)+_0x41d167)===0x1&&(_0x1aa64d[_0x2a6bd8(0x184)]==='admin'||_0x1aa64d[_0x2a6bd8(0x18d)]?(logger_1['logger'][_0x2a6bd8(0x18c)](_0x2a6bd8(0x168)+_0x1aa64d['id']+_0x2a6bd8(0x19b)+_0x1aa64d['companyId']+_0x2a6bd8(0x1a1)+_0x41d167+'.'),_0x4d8374[_0x2a6bd8(0x193)](_0x2a6bd8(0x17e)+_0x1aa64d[_0x2a6bd8(0x15e)]+'-'+_0x41d167)):_0x1aa64d[_0x2a6bd8(0x188)]['forEach'](_0x2b85b0=>{const _0x586791=_0x2a6bd8;logger_1[_0x586791(0x14d)][_0x586791(0x18c)]('Usuário\x20'+_0x1aa64d['id']+_0x586791(0x19b)+_0x1aa64d[_0x586791(0x15e)]+_0x586791(0x158)+_0x2b85b0['id']+'.'),_0x4d8374[_0x586791(0x193)](_0x586791(0x172)+_0x2b85b0['id']+'-'+_0x41d167);}));}),_0x4d8374['on']('leaveTickets',_0x5c6b04=>{const _0x1f3507=_0x146b72;_0x64b571[_0x1f3507(0x180)](_0x1f3507(0x176)+_0x5c6b04)===0x0&&(_0x1aa64d['profile']===_0x1f3507(0x14c)||_0x1aa64d['allTicket']?(logger_1[_0x1f3507(0x14d)][_0x1f3507(0x18c)](_0x1f3507(0x168)+_0x1aa64d['id']+_0x1f3507(0x19b)+_0x1aa64d[_0x1f3507(0x15e)]+'\x20saiu\x20do\x20canal\x20de\x20tickets\x20'+_0x5c6b04+'.'),_0x4d8374[_0x1f3507(0x17f)]('company-'+_0x1aa64d[_0x1f3507(0x15e)]+'-'+_0x5c6b04)):_0x1aa64d[_0x1f3507(0x188)][_0x1f3507(0x16c)](_0xf7e937=>{const _0x18bc87=_0x1f3507;logger_1[_0x18bc87(0x14d)]['debug'](_0x18bc87(0x155)+_0x1aa64d['id']+_0x18bc87(0x19b)+_0x1aa64d['companyId']+_0x18bc87(0x167)+_0xf7e937['id']+'.'),_0x4d8374[_0x18bc87(0x17f)](_0x18bc87(0x172)+_0xf7e937['id']+'-'+_0x5c6b04);}));}),_0x4d8374['on'](_0x146b72(0x147),async()=>{const _0x18c55b=_0x146b72;logger_1[_0x18c55b(0x14d)][_0x18c55b(0x19e)](_0x18c55b(0x150)+_0x1aa64d['id']),_0x1aa64d['online']=![],await _0x1aa64d[_0x18c55b(0x190)]();});}),io;};exports[a255_0x2605c9(0x148)]=initIO;const getIO=()=>{const _0x791443=a255_0x2605c9;if(!io)throw new AppError_1[(_0x791443(0x189))](_0x791443(0x17c));return io;};exports[a255_0x2605c9(0x1a4)]=getIO;function a255_0x27ba(_0x139686,_0x4493f9){const _0x47acfa=a255_0x10ab();return a255_0x27ba=function(_0x10d3bc,_0x461e54){_0x10d3bc=_0x10d3bc-0x146;let _0x10abef=_0x47acfa[_0x10d3bc];return _0x10abef;},a255_0x27ba(_0x139686,_0x4493f9);}function a255_0x10ab(){const _0x5b0194=['handshake','disconnect','initIO','toString','use','auth','admin','logger','ticket-','leaveChatBox','Usuário\x20desconectado:\x20','\x20pelo\x20usuário\x20','7OUyXTt','error','online','Usuário\x20','ID\x20de\x20ticket\x20inválido:\x20','Token\x20inválido','\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','string','leaveNotification[','socket.io','70YjApBL','secret','companyId','leaveChatbox[','findByPk','env','joinNotification[','token','message','72892ltIINn','(((.+)+)+)+$','\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','Admin\x20','\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20','instrument','64086ufQwUc','forEach','userId','user','Token\x20não\x20fornecido','Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20','defineProperty','queue-','../models/User','../errors/AppError','warn','status-','test','notification','then','query','incrementCounter','Socket\x20IO\x20não\x20inicializado','verify','company-','leave','decrementCounter','search','1577240namyTj','../models/Queue','profile','Erro\x20ao\x20buscar\x20ticket\x20',']:\x20Usuário:\x20','jsonwebtoken','queues','default','SOCKET_ADMIN','24JPojUj','debug','allTicket','basic','../config/auth','save','joinChatbox[','data','join','-notification','passwordHash','./counter','-mainchannel','\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20','parse','42781OGLtht','\x20da\x20empresa\x20','user-','69179yswwzd','info','Erro\x20de\x20autenticação:\x20','joinNotification','\x20entrou\x20no\x20canal\x20de\x20tickets\x20','../models/Ticket','Usuário\x20conectado:\x20','getIO','6fvByTr','67285EIszkr','540YUawzr','175779kioNOX','FRONTEND_URL','__esModule'];a255_0x10ab=function(){return _0x5b0194;};return a255_0x10ab();}