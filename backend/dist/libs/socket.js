function a255_0x1c8c(_0xe34606,_0x9eaa58){const _0x463cae=a255_0x388c();return a255_0x1c8c=function(_0x2a1f0b,_0x14f882){_0x2a1f0b=_0x2a1f0b-0x165;let _0x388c63=_0x463cae[_0x2a1f0b];return _0x388c63;},a255_0x1c8c(_0xe34606,_0x9eaa58);}const a255_0x276634=a255_0x1c8c;function a255_0x388c(){const _0xd09df6=['Usuário\x20conectado:\x20','__importDefault','\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','joinTickets','10BgIZVI','Erro\x20ao\x20buscar\x20ticket\x20','allTicket','-notification','online','status-','joinNotification[','notification','string','number','logger','incrementCounter','../errors/AppError','\x20pelo\x20usuário\x20','Falha\x20na\x20autenticação','test','106808ZVLVZc','leaveChatbox[','ticket-','leaveNotification','-mainchannel','1103310oFbTEE','warn','default','initIO',']:\x20Canal:\x20','data','\x20saiu\x20do\x20canal\x20de\x20tickets\x20','message','leave','queues','../models/Ticket','Usuário\x20','816452ylhkzK','companyId','\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20','verify','FRONTEND_URL','(((.+)+)+)+$','jsonwebtoken','__esModule','token','2182572YqcKBa','profile','parse','./counter','instrument','@socket.io/admin-ui','1078386vJlnhv','Socket\x20IO\x20não\x20inicializado','../config/auth','secret','\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20','forEach','leaveChatBox','Token\x20não\x20fornecido','Usuário\x20não\x20encontrado','company-','69780KbmSVt','613485INEtSU','env','../models/Queue','info','admin','apply','socket.io','constructor','queue-','ID\x20de\x20ticket\x20inválido:\x20','toString','query','email','userId','auth','join','getIO','decrementCounter','findByPk','../utils/logger','connection','\x20da\x20empresa\x20','\x20entrou\x20no\x20canal\x20de\x20tickets\x20','search',']:\x20Usuário:\x20','use','SOCKET_ADMIN','passwordHash','debug','save','handshake','user','disconnect','leaveNotification[','Admin\x20','Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20','Erro\x20de\x20autenticação:\x20'];a255_0x388c=function(){return _0xd09df6;};return a255_0x388c();}(function(_0x137c11,_0x1db1d4){const _0x5dd342=a255_0x1c8c,_0x2d0f78=_0x137c11();while(!![]){try{const _0x230597=parseInt(_0x5dd342(0x18c))/0x1*(-parseInt(_0x5dd342(0x1c6))/0x2)+parseInt(_0x5dd342(0x1bc))/0x3+parseInt(_0x5dd342(0x1b6))/0x4+-parseInt(_0x5dd342(0x1c7))/0x5+-parseInt(_0x5dd342(0x1a1))/0x6+parseInt(_0x5dd342(0x1ad))/0x7+-parseInt(_0x5dd342(0x19c))/0x8;if(_0x230597===_0x1db1d4)break;else _0x2d0f78['push'](_0x2d0f78['shift']());}catch(_0x1b04b5){_0x2d0f78['push'](_0x2d0f78['shift']());}}}(a255_0x388c,0x5628c));const a255_0x14f882=(function(){let _0x26fadd=!![];return function(_0x400232,_0x34137b){const _0x3f0fbd=_0x26fadd?function(){const _0x2cbca4=a255_0x1c8c;if(_0x34137b){const _0x1727aa=_0x34137b[_0x2cbca4(0x168)](_0x400232,arguments);return _0x34137b=null,_0x1727aa;}}:function(){};return _0x26fadd=![],_0x3f0fbd;};}()),a255_0x2a1f0b=a255_0x14f882(this,function(){const _0x1e695c=a255_0x1c8c;return a255_0x2a1f0b[_0x1e695c(0x16d)]()['search'](_0x1e695c(0x1b2))[_0x1e695c(0x16d)]()[_0x1e695c(0x16a)](a255_0x2a1f0b)[_0x1e695c(0x17a)](_0x1e695c(0x1b2));});a255_0x2a1f0b();'use strict';var __importDefault=this&&this[a255_0x276634(0x189)]||function(_0x33489b){const _0x5b9827=a255_0x276634;return _0x33489b&&_0x33489b[_0x5b9827(0x1b4)]?_0x33489b:{'default':_0x33489b};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a255_0x276634(0x173)]=exports[a255_0x276634(0x1a4)]=void 0x0;const socket_io_1=require(a255_0x276634(0x169)),admin_ui_1=require(a255_0x276634(0x1bb)),jsonwebtoken_1=require(a255_0x276634(0x1b3)),AppError_1=__importDefault(require(a255_0x276634(0x198))),logger_1=require(a255_0x276634(0x176)),User_1=__importDefault(require('../models/User')),Queue_1=__importDefault(require(a255_0x276634(0x165))),Ticket_1=__importDefault(require(a255_0x276634(0x1ab))),auth_1=__importDefault(require(a255_0x276634(0x1be))),counter_1=require(a255_0x276634(0x1b9));let io;const initIO=_0x5818b6=>{const _0x35d6a9=a255_0x276634;return io=new socket_io_1['Server'](_0x5818b6,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process[_0x35d6a9(0x1c8)][_0x35d6a9(0x1b1)]}}),process[_0x35d6a9(0x1c8)][_0x35d6a9(0x17d)]&&JSON[_0x35d6a9(0x1b8)](process[_0x35d6a9(0x1c8)]['SOCKET_ADMIN'])&&User_1[_0x35d6a9(0x1a3)]['findByPk'](0x1)['then'](_0x126ed0=>{const _0x39e758=_0x35d6a9;(0x0,admin_ui_1[_0x39e758(0x1ba)])(io,{'auth':{'type':'basic','username':_0x126ed0[_0x39e758(0x16f)],'password':_0x126ed0[_0x39e758(0x17e)]},'mode':'development'});}),io[_0x35d6a9(0x17c)](async(_0xbcad08,_0x2eb352)=>{const _0x1aeb89=_0x35d6a9;try{const _0x41c6c9=_0xbcad08['handshake'][_0x1aeb89(0x171)][_0x1aeb89(0x1b5)]||_0xbcad08[_0x1aeb89(0x181)][_0x1aeb89(0x16e)]['token'];if(!_0x41c6c9)throw new Error(_0x1aeb89(0x1c3));const _0x1d9b58=(0x0,jsonwebtoken_1[_0x1aeb89(0x1b0)])(_0x41c6c9,auth_1[_0x1aeb89(0x1a3)][_0x1aeb89(0x1bf)]);if(!_0x1d9b58||typeof _0x1d9b58['id']!==_0x1aeb89(0x195))throw new Error('Token\x20inválido');const _0x29b059=await User_1[_0x1aeb89(0x1a3)][_0x1aeb89(0x175)](_0x1d9b58['id'],{'include':[Queue_1[_0x1aeb89(0x1a3)]]});if(!_0x29b059)throw new Error(_0x1aeb89(0x1c4));_0xbcad08[_0x1aeb89(0x1a6)][_0x1aeb89(0x182)]=_0x29b059,_0x2eb352();}catch(_0x363f34){logger_1[_0x1aeb89(0x196)]['error'](_0x1aeb89(0x187)+_0x363f34[_0x1aeb89(0x1a8)]),_0x2eb352(new Error(_0x1aeb89(0x19a)));}}),io['on'](_0x35d6a9(0x177),async _0x1d65c1=>{const _0x4d8c3e=_0x35d6a9,_0xe3436b=_0x1d65c1[_0x4d8c3e(0x1a6)][_0x4d8c3e(0x182)],_0x228ddd=new counter_1['CounterManager']();logger_1[_0x4d8c3e(0x196)][_0x4d8c3e(0x166)](_0x4d8c3e(0x188)+_0xe3436b['id']),_0xe3436b[_0x4d8c3e(0x190)]=!![],await _0xe3436b[_0x4d8c3e(0x180)](),_0x1d65c1['join'](_0x4d8c3e(0x1c5)+_0xe3436b[_0x4d8c3e(0x1ae)]+_0x4d8c3e(0x1a0)),_0x1d65c1[_0x4d8c3e(0x172)](_0x4d8c3e(0x1c5)+_0xe3436b[_0x4d8c3e(0x1ae)]),_0x1d65c1[_0x4d8c3e(0x172)]('user-'+_0xe3436b['id']),_0x1d65c1['on']('joinChatBox',async _0x5f3ed5=>{const _0x5cf6ac=_0x4d8c3e;if(typeof _0x5f3ed5!==_0x5cf6ac(0x194)||!/^\d+$/[_0x5cf6ac(0x19b)](_0x5f3ed5)){logger_1[_0x5cf6ac(0x196)][_0x5cf6ac(0x1a2)](_0x5cf6ac(0x16c)+_0x5f3ed5);return;}try{const _0x5a86c5=await Ticket_1[_0x5cf6ac(0x1a3)][_0x5cf6ac(0x175)](_0x5f3ed5);if(_0x5a86c5&&_0x5a86c5[_0x5cf6ac(0x1ae)]===_0xe3436b[_0x5cf6ac(0x1ae)]&&(_0x5a86c5[_0x5cf6ac(0x170)]===_0xe3436b['id']||_0xe3436b[_0x5cf6ac(0x1b7)]===_0x5cf6ac(0x167)||_0xe3436b['allTicket'])){const _0x282922=_0x228ddd[_0x5cf6ac(0x197)](_0x5cf6ac(0x19e)+_0x5f3ed5);_0x282922===0x1&&_0x1d65c1['join'](_0x5f3ed5),logger_1[_0x5cf6ac(0x196)]['debug']('joinChatbox['+_0x282922+_0x5cf6ac(0x1a5)+_0x5f3ed5+'\x20pelo\x20usuário\x20'+_0xe3436b['id']);}else logger_1[_0x5cf6ac(0x196)][_0x5cf6ac(0x1a2)](_0x5cf6ac(0x186)+_0x5f3ed5+_0x5cf6ac(0x199)+_0xe3436b['id']);}catch(_0x3a696c){logger_1[_0x5cf6ac(0x196)]['error'](_0x5cf6ac(0x18d)+_0x5f3ed5+':\x20'+_0x3a696c[_0x5cf6ac(0x1a8)]);}}),_0x1d65c1['on'](_0x4d8c3e(0x1c2),_0x5bcd8a=>{const _0x302c97=_0x4d8c3e;if(typeof _0x5bcd8a===_0x302c97(0x194)&&/^\d+$/['test'](_0x5bcd8a)){const _0x37e976=_0x228ddd['decrementCounter'](_0x302c97(0x19e)+_0x5bcd8a);_0x37e976===0x0&&_0x1d65c1[_0x302c97(0x1a9)](_0x5bcd8a),logger_1['logger']['debug'](_0x302c97(0x19d)+_0x37e976+_0x302c97(0x1a5)+_0x5bcd8a+'\x20pelo\x20usuário\x20'+_0xe3436b['id']);}}),_0x1d65c1['on']('joinNotification',()=>{const _0x3b39da=_0x4d8c3e,_0x11f9ff=_0x228ddd[_0x3b39da(0x197)](_0x3b39da(0x193));_0x11f9ff===0x1&&(_0xe3436b[_0x3b39da(0x1b7)]===_0x3b39da(0x167)||_0xe3436b['allTicket']?_0x1d65c1[_0x3b39da(0x172)]('company-'+_0xe3436b[_0x3b39da(0x1ae)]+_0x3b39da(0x18f)):_0xe3436b['queues']['forEach'](_0x3cc997=>{const _0x344d85=_0x3b39da;logger_1[_0x344d85(0x196)][_0x344d85(0x17f)](_0x344d85(0x1ac)+_0xe3436b['id']+_0x344d85(0x178)+_0xe3436b[_0x344d85(0x1ae)]+_0x344d85(0x1c0)+_0x3cc997['id']+'.'),_0x1d65c1[_0x344d85(0x172)](_0x344d85(0x16b)+_0x3cc997['id']+_0x344d85(0x18f));})),logger_1[_0x3b39da(0x196)][_0x3b39da(0x17f)](_0x3b39da(0x192)+_0x11f9ff+']:\x20Usuário:\x20'+_0xe3436b['id']);}),_0x1d65c1['on'](_0x4d8c3e(0x19f),()=>{const _0x2cf567=_0x4d8c3e,_0x2a463d=_0x228ddd[_0x2cf567(0x174)]('notification');_0x2a463d===0x0&&(_0xe3436b['profile']===_0x2cf567(0x167)||_0xe3436b['allTicket']?_0x1d65c1[_0x2cf567(0x1a9)]('company-'+_0xe3436b[_0x2cf567(0x1ae)]+'-notification'):_0xe3436b[_0x2cf567(0x1aa)]['forEach'](_0x51a191=>{const _0x3314f2=_0x2cf567;logger_1[_0x3314f2(0x196)][_0x3314f2(0x17f)]('Usuário\x20'+_0xe3436b['id']+_0x3314f2(0x178)+_0xe3436b[_0x3314f2(0x1ae)]+_0x3314f2(0x1af)+_0x51a191['id']+'.'),_0x1d65c1[_0x3314f2(0x1a9)](_0x3314f2(0x16b)+_0x51a191['id']+_0x3314f2(0x18f));})),logger_1['logger'][_0x2cf567(0x17f)](_0x2cf567(0x184)+_0x2a463d+_0x2cf567(0x17b)+_0xe3436b['id']);}),_0x1d65c1['on'](_0x4d8c3e(0x18b),_0x5f528b=>{const _0x2c617c=_0x4d8c3e;_0x228ddd[_0x2c617c(0x197)](_0x2c617c(0x191)+_0x5f528b)===0x1&&(_0xe3436b[_0x2c617c(0x1b7)]===_0x2c617c(0x167)||_0xe3436b[_0x2c617c(0x18e)]?(logger_1[_0x2c617c(0x196)][_0x2c617c(0x17f)](_0x2c617c(0x185)+_0xe3436b['id']+'\x20da\x20empresa\x20'+_0xe3436b['companyId']+_0x2c617c(0x179)+_0x5f528b+'.'),_0x1d65c1[_0x2c617c(0x172)](_0x2c617c(0x1c5)+_0xe3436b[_0x2c617c(0x1ae)]+'-'+_0x5f528b)):_0xe3436b[_0x2c617c(0x1aa)][_0x2c617c(0x1c1)](_0x4a40d6=>{const _0x45338c=_0x2c617c;logger_1[_0x45338c(0x196)][_0x45338c(0x17f)](_0x45338c(0x1ac)+_0xe3436b['id']+_0x45338c(0x178)+_0xe3436b[_0x45338c(0x1ae)]+_0x45338c(0x18a)+_0x4a40d6['id']+'.'),_0x1d65c1[_0x45338c(0x172)]('queue-'+_0x4a40d6['id']+'-'+_0x5f528b);}));}),_0x1d65c1['on']('leaveTickets',_0x3e90ab=>{const _0x4817a0=_0x4d8c3e;_0x228ddd[_0x4817a0(0x174)](_0x4817a0(0x191)+_0x3e90ab)===0x0&&(_0xe3436b[_0x4817a0(0x1b7)]==='admin'||_0xe3436b[_0x4817a0(0x18e)]?(logger_1[_0x4817a0(0x196)]['debug']('Admin\x20'+_0xe3436b['id']+_0x4817a0(0x178)+_0xe3436b[_0x4817a0(0x1ae)]+_0x4817a0(0x1a7)+_0x3e90ab+'.'),_0x1d65c1[_0x4817a0(0x1a9)](_0x4817a0(0x1c5)+_0xe3436b[_0x4817a0(0x1ae)]+'-'+_0x3e90ab)):_0xe3436b[_0x4817a0(0x1aa)][_0x4817a0(0x1c1)](_0x45dc3d=>{const _0xfb2f3c=_0x4817a0;logger_1[_0xfb2f3c(0x196)][_0xfb2f3c(0x17f)](_0xfb2f3c(0x1ac)+_0xe3436b['id']+_0xfb2f3c(0x178)+_0xe3436b[_0xfb2f3c(0x1ae)]+'\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20'+_0x45dc3d['id']+'.'),_0x1d65c1[_0xfb2f3c(0x1a9)]('queue-'+_0x45dc3d['id']+'-'+_0x3e90ab);}));}),_0x1d65c1['on'](_0x4d8c3e(0x183),async()=>{const _0x5686eb=_0x4d8c3e;logger_1['logger']['info']('Usuário\x20desconectado:\x20'+_0xe3436b['id']),_0xe3436b[_0x5686eb(0x190)]=![],await _0xe3436b[_0x5686eb(0x180)]();});}),io;};exports[a255_0x276634(0x1a4)]=initIO;const getIO=()=>{const _0x183dd6=a255_0x276634;if(!io)throw new AppError_1['default'](_0x183dd6(0x1bd));return io;};exports[a255_0x276634(0x173)]=getIO;