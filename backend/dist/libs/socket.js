const a254_0x2c5e4c=a254_0x534b;(function(_0x20b23a,_0x2dfbb9){const _0x85b7e6=a254_0x534b,_0xc67887=_0x20b23a();while(!![]){try{const _0x5e4bc0=parseInt(_0x85b7e6(0x1ed))/0x1*(parseInt(_0x85b7e6(0x1e7))/0x2)+parseInt(_0x85b7e6(0x210))/0x3*(-parseInt(_0x85b7e6(0x1e9))/0x4)+-parseInt(_0x85b7e6(0x204))/0x5+parseInt(_0x85b7e6(0x1d1))/0x6*(-parseInt(_0x85b7e6(0x1e0))/0x7)+parseInt(_0x85b7e6(0x1c1))/0x8*(-parseInt(_0x85b7e6(0x211))/0x9)+-parseInt(_0x85b7e6(0x21b))/0xa+-parseInt(_0x85b7e6(0x1f6))/0xb*(-parseInt(_0x85b7e6(0x1ca))/0xc);if(_0x5e4bc0===_0x2dfbb9)break;else _0xc67887['push'](_0xc67887['shift']());}catch(_0x949deb){_0xc67887['push'](_0xc67887['shift']());}}}(a254_0x34d6,0xecca1));const a254_0x26399b=(function(){let _0x4e6643=!![];return function(_0x136aea,_0x2376f2){const _0x18984d=_0x4e6643?function(){if(_0x2376f2){const _0x37d046=_0x2376f2['apply'](_0x136aea,arguments);return _0x2376f2=null,_0x37d046;}}:function(){};return _0x4e6643=![],_0x18984d;};}()),a254_0x48b3ce=a254_0x26399b(this,function(){const _0xa9f10b=a254_0x534b;return a254_0x48b3ce[_0xa9f10b(0x1de)]()[_0xa9f10b(0x1d6)]('(((.+)+)+)+$')[_0xa9f10b(0x1de)]()[_0xa9f10b(0x1d5)](a254_0x48b3ce)[_0xa9f10b(0x1d6)](_0xa9f10b(0x1e8));});a254_0x48b3ce();'use strict';function a254_0x34d6(){const _0xc09ae8=['2165508oCuODm','\x20entrou\x20no\x20canal\x20de\x20tickets\x20','allTicket','leaveTickets','leaveNotification[','token','Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20','306sFUSZl','__importDefault','Token\x20não\x20fornecido','companyId','constructor','search','Usuário\x20conectado:\x20','secret','test','../utils/logger','SOCKET_ADMIN','\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','queue-','toString','default','63203JYHrhS','passwordHash',']:\x20Canal:\x20','../config/auth','handshake','number','leave','47662RMWmme','(((.+)+)+)+$','4IzwkFt','../errors/AppError','env','Erro\x20ao\x20buscar\x20ticket\x20','57MHdxdh','then','info','-mainchannel','basic','joinNotification[','\x20da\x20empresa\x20','@socket.io/admin-ui','Usuário\x20','143kjCFlc','message','findByPk','leaveNotification','admin','\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','parse','defineProperty','../models/User','warn','profile','userId','jsonwebtoken','string','694955jhjlXN','Admin\x20','joinChatbox[','error','company-','Usuário\x20não\x20encontrado','joinTickets','\x20pelo\x20usuário\x20','notification','save','Server','__esModule','1202331poejmw','783vLXZPX','joinNotification','socket.io','logger','disconnect',']:\x20Usuário:\x20','ticket-','FRONTEND_URL','initIO','Usuário\x20desconectado:\x20','13498320holFBf','verify','-notification','./counter','decrementCounter','debug','email','leaveChatbox[','incrementCounter','status-','instrument','query','data','35344UgsVjc','queues','join','online','../models/Queue','Socket\x20IO\x20não\x20inicializado','forEach','Erro\x20de\x20autenticação:\x20','user'];a254_0x34d6=function(){return _0xc09ae8;};return a254_0x34d6();}var __importDefault=this&&this[a254_0x2c5e4c(0x1d2)]||function(_0x5d0f9c){const _0x1e8cb0=a254_0x2c5e4c;return _0x5d0f9c&&_0x5d0f9c[_0x1e8cb0(0x20f)]?_0x5d0f9c:{'default':_0x5d0f9c};};Object[a254_0x2c5e4c(0x1fd)](exports,a254_0x2c5e4c(0x20f),{'value':!![]}),exports['getIO']=exports[a254_0x2c5e4c(0x219)]=void 0x0;const socket_io_1=require(a254_0x2c5e4c(0x213)),admin_ui_1=require(a254_0x2c5e4c(0x1f4)),jsonwebtoken_1=require(a254_0x2c5e4c(0x202)),AppError_1=__importDefault(require(a254_0x2c5e4c(0x1ea))),logger_1=require(a254_0x2c5e4c(0x1da)),User_1=__importDefault(require(a254_0x2c5e4c(0x1fe))),Queue_1=__importDefault(require(a254_0x2c5e4c(0x1c5))),Ticket_1=__importDefault(require('../models/Ticket')),auth_1=__importDefault(require(a254_0x2c5e4c(0x1e3))),counter_1=require(a254_0x2c5e4c(0x1b7));let io;const initIO=_0x54cfd1=>{const _0x11e907=a254_0x2c5e4c;return io=new socket_io_1[(_0x11e907(0x20e))](_0x54cfd1,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process[_0x11e907(0x1eb)][_0x11e907(0x218)]}}),process[_0x11e907(0x1eb)][_0x11e907(0x1db)]&&JSON[_0x11e907(0x1fc)](process[_0x11e907(0x1eb)][_0x11e907(0x1db)])&&User_1[_0x11e907(0x1df)]['findByPk'](0x1)[_0x11e907(0x1ee)](_0x4f17fd=>{const _0x3d5650=_0x11e907;(0x0,admin_ui_1[_0x3d5650(0x1be)])(io,{'auth':{'type':_0x3d5650(0x1f1),'username':_0x4f17fd[_0x3d5650(0x1ba)],'password':_0x4f17fd[_0x3d5650(0x1e1)]},'mode':'development'});}),io['use'](async(_0x30e002,_0x24927b)=>{const _0x10f6ea=_0x11e907;try{const _0x8a9e38=_0x30e002[_0x10f6ea(0x1e4)]['auth'][_0x10f6ea(0x1cf)]||_0x30e002[_0x10f6ea(0x1e4)][_0x10f6ea(0x1bf)][_0x10f6ea(0x1cf)];if(!_0x8a9e38)throw new Error(_0x10f6ea(0x1d3));const _0x5d2422=(0x0,jsonwebtoken_1[_0x10f6ea(0x1b5)])(_0x8a9e38,auth_1[_0x10f6ea(0x1df)][_0x10f6ea(0x1d8)]);if(!_0x5d2422||typeof _0x5d2422['id']!==_0x10f6ea(0x1e5))throw new Error('Token\x20inválido');const _0x224112=await User_1[_0x10f6ea(0x1df)][_0x10f6ea(0x1f8)](_0x5d2422['id'],{'include':[Queue_1[_0x10f6ea(0x1df)]]});if(!_0x224112)throw new Error(_0x10f6ea(0x209));_0x30e002['data'][_0x10f6ea(0x1c9)]=_0x224112,_0x24927b();}catch(_0x265521){logger_1[_0x10f6ea(0x214)]['error'](_0x10f6ea(0x1c8)+_0x265521[_0x10f6ea(0x1f7)]),_0x24927b(new Error('Falha\x20na\x20autenticação'));}}),io['on']('connection',async _0x529460=>{const _0x3684aa=_0x11e907,_0x4e9f7c=_0x529460[_0x3684aa(0x1c0)][_0x3684aa(0x1c9)],_0x21d09=new counter_1['CounterManager']();logger_1['logger'][_0x3684aa(0x1ef)](_0x3684aa(0x1d7)+_0x4e9f7c['id']),_0x4e9f7c[_0x3684aa(0x1c4)]=!![],await _0x4e9f7c[_0x3684aa(0x20d)](),_0x529460[_0x3684aa(0x1c3)](_0x3684aa(0x208)+_0x4e9f7c[_0x3684aa(0x1d4)]+_0x3684aa(0x1f0)),_0x529460['join'](_0x3684aa(0x208)+_0x4e9f7c['companyId']),_0x529460[_0x3684aa(0x1c3)]('user-'+_0x4e9f7c['id']),_0x529460['on']('joinChatBox',async _0x316593=>{const _0x3183e7=_0x3684aa;if(typeof _0x316593!==_0x3183e7(0x203)||!/^\d+$/[_0x3183e7(0x1d9)](_0x316593)){logger_1[_0x3183e7(0x214)][_0x3183e7(0x1ff)]('ID\x20de\x20ticket\x20inválido:\x20'+_0x316593);return;}try{const _0x27646a=await Ticket_1[_0x3183e7(0x1df)][_0x3183e7(0x1f8)](_0x316593);if(_0x27646a&&_0x27646a[_0x3183e7(0x1d4)]===_0x4e9f7c['companyId']&&(_0x27646a[_0x3183e7(0x201)]===_0x4e9f7c['id']||_0x4e9f7c[_0x3183e7(0x200)]==='admin'||_0x4e9f7c[_0x3183e7(0x1cc)])){const _0x48f635=_0x21d09['incrementCounter'](_0x3183e7(0x217)+_0x316593);_0x48f635===0x1&&_0x529460[_0x3183e7(0x1c3)](_0x316593),logger_1[_0x3183e7(0x214)][_0x3183e7(0x1b9)](_0x3183e7(0x206)+_0x48f635+_0x3183e7(0x1e2)+_0x316593+_0x3183e7(0x20b)+_0x4e9f7c['id']);}else logger_1[_0x3183e7(0x214)]['warn'](_0x3183e7(0x1d0)+_0x316593+'\x20pelo\x20usuário\x20'+_0x4e9f7c['id']);}catch(_0x31e1e4){logger_1[_0x3183e7(0x214)][_0x3183e7(0x207)](_0x3183e7(0x1ec)+_0x316593+':\x20'+_0x31e1e4[_0x3183e7(0x1f7)]);}}),_0x529460['on']('leaveChatBox',_0x1194c2=>{const _0x4e5afc=_0x3684aa;if(typeof _0x1194c2==='string'&&/^\d+$/[_0x4e5afc(0x1d9)](_0x1194c2)){const _0x18f3db=_0x21d09['decrementCounter'](_0x4e5afc(0x217)+_0x1194c2);_0x18f3db===0x0&&_0x529460[_0x4e5afc(0x1e6)](_0x1194c2),logger_1[_0x4e5afc(0x214)][_0x4e5afc(0x1b9)](_0x4e5afc(0x1bb)+_0x18f3db+_0x4e5afc(0x1e2)+_0x1194c2+_0x4e5afc(0x20b)+_0x4e9f7c['id']);}}),_0x529460['on'](_0x3684aa(0x212),()=>{const _0x2f797b=_0x3684aa,_0x4da6ec=_0x21d09[_0x2f797b(0x1bc)]('notification');_0x4da6ec===0x1&&(_0x4e9f7c[_0x2f797b(0x200)]==='admin'||_0x4e9f7c[_0x2f797b(0x1cc)]?_0x529460['join'](_0x2f797b(0x208)+_0x4e9f7c[_0x2f797b(0x1d4)]+'-notification'):_0x4e9f7c[_0x2f797b(0x1c2)]['forEach'](_0x49a27a=>{const _0x1e21fa=_0x2f797b;logger_1['logger'][_0x1e21fa(0x1b9)](_0x1e21fa(0x1f5)+_0x4e9f7c['id']+_0x1e21fa(0x1f3)+_0x4e9f7c[_0x1e21fa(0x1d4)]+'\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20'+_0x49a27a['id']+'.'),_0x529460['join'](_0x1e21fa(0x1dd)+_0x49a27a['id']+_0x1e21fa(0x1b6));})),logger_1[_0x2f797b(0x214)][_0x2f797b(0x1b9)](_0x2f797b(0x1f2)+_0x4da6ec+_0x2f797b(0x216)+_0x4e9f7c['id']);}),_0x529460['on'](_0x3684aa(0x1f9),()=>{const _0x37ac7a=_0x3684aa,_0x30257f=_0x21d09[_0x37ac7a(0x1b8)](_0x37ac7a(0x20c));_0x30257f===0x0&&(_0x4e9f7c[_0x37ac7a(0x200)]===_0x37ac7a(0x1fa)||_0x4e9f7c[_0x37ac7a(0x1cc)]?_0x529460['leave']('company-'+_0x4e9f7c['companyId']+_0x37ac7a(0x1b6)):_0x4e9f7c[_0x37ac7a(0x1c2)][_0x37ac7a(0x1c7)](_0x53f556=>{const _0x2a8bee=_0x37ac7a;logger_1[_0x2a8bee(0x214)]['debug'](_0x2a8bee(0x1f5)+_0x4e9f7c['id']+_0x2a8bee(0x1f3)+_0x4e9f7c[_0x2a8bee(0x1d4)]+'\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20'+_0x53f556['id']+'.'),_0x529460[_0x2a8bee(0x1e6)](_0x2a8bee(0x1dd)+_0x53f556['id']+_0x2a8bee(0x1b6));})),logger_1['logger'][_0x37ac7a(0x1b9)](_0x37ac7a(0x1ce)+_0x30257f+_0x37ac7a(0x216)+_0x4e9f7c['id']);}),_0x529460['on'](_0x3684aa(0x20a),_0x98d885=>{const _0x3579ef=_0x3684aa;_0x21d09[_0x3579ef(0x1bc)](_0x3579ef(0x1bd)+_0x98d885)===0x1&&(_0x4e9f7c[_0x3579ef(0x200)]===_0x3579ef(0x1fa)||_0x4e9f7c[_0x3579ef(0x1cc)]?(logger_1[_0x3579ef(0x214)][_0x3579ef(0x1b9)]('Admin\x20'+_0x4e9f7c['id']+_0x3579ef(0x1f3)+_0x4e9f7c[_0x3579ef(0x1d4)]+_0x3579ef(0x1cb)+_0x98d885+'.'),_0x529460[_0x3579ef(0x1c3)](_0x3579ef(0x208)+_0x4e9f7c[_0x3579ef(0x1d4)]+'-'+_0x98d885)):_0x4e9f7c[_0x3579ef(0x1c2)][_0x3579ef(0x1c7)](_0x57adf5=>{const _0x5d0255=_0x3579ef;logger_1['logger']['debug'](_0x5d0255(0x1f5)+_0x4e9f7c['id']+_0x5d0255(0x1f3)+_0x4e9f7c[_0x5d0255(0x1d4)]+_0x5d0255(0x1fb)+_0x57adf5['id']+'.'),_0x529460[_0x5d0255(0x1c3)](_0x5d0255(0x1dd)+_0x57adf5['id']+'-'+_0x98d885);}));}),_0x529460['on'](_0x3684aa(0x1cd),_0x5c3c17=>{const _0x2d1205=_0x3684aa;_0x21d09['decrementCounter'](_0x2d1205(0x1bd)+_0x5c3c17)===0x0&&(_0x4e9f7c[_0x2d1205(0x200)]===_0x2d1205(0x1fa)||_0x4e9f7c['allTicket']?(logger_1[_0x2d1205(0x214)][_0x2d1205(0x1b9)](_0x2d1205(0x205)+_0x4e9f7c['id']+_0x2d1205(0x1f3)+_0x4e9f7c[_0x2d1205(0x1d4)]+'\x20saiu\x20do\x20canal\x20de\x20tickets\x20'+_0x5c3c17+'.'),_0x529460[_0x2d1205(0x1e6)](_0x2d1205(0x208)+_0x4e9f7c[_0x2d1205(0x1d4)]+'-'+_0x5c3c17)):_0x4e9f7c['queues']['forEach'](_0x1ade76=>{const _0x252b63=_0x2d1205;logger_1[_0x252b63(0x214)][_0x252b63(0x1b9)](_0x252b63(0x1f5)+_0x4e9f7c['id']+_0x252b63(0x1f3)+_0x4e9f7c[_0x252b63(0x1d4)]+_0x252b63(0x1dc)+_0x1ade76['id']+'.'),_0x529460['leave']('queue-'+_0x1ade76['id']+'-'+_0x5c3c17);}));}),_0x529460['on'](_0x3684aa(0x215),async()=>{const _0x28b7f4=_0x3684aa;logger_1[_0x28b7f4(0x214)][_0x28b7f4(0x1ef)](_0x28b7f4(0x21a)+_0x4e9f7c['id']),_0x4e9f7c[_0x28b7f4(0x1c4)]=![],await _0x4e9f7c[_0x28b7f4(0x20d)]();});}),io;};exports['initIO']=initIO;function a254_0x534b(_0x9f00e6,_0x3832ab){const _0x2ced0b=a254_0x34d6();return a254_0x534b=function(_0x48b3ce,_0x26399b){_0x48b3ce=_0x48b3ce-0x1b5;let _0x34d69d=_0x2ced0b[_0x48b3ce];return _0x34d69d;},a254_0x534b(_0x9f00e6,_0x3832ab);}const getIO=()=>{const _0x32b957=a254_0x2c5e4c;if(!io)throw new AppError_1[(_0x32b957(0x1df))](_0x32b957(0x1c6));return io;};exports['getIO']=getIO;