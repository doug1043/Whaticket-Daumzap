const a256_0x2aed6d=a256_0x89c1;function a256_0x89c1(_0x251273,_0x210e0e){const _0x68198=a256_0x5e6a();return a256_0x89c1=function(_0x3b9cf8,_0x3f5bb4){_0x3b9cf8=_0x3b9cf8-0xf1;let _0x5e6a19=_0x68198[_0x3b9cf8];return _0x5e6a19;},a256_0x89c1(_0x251273,_0x210e0e);}(function(_0x3230b6,_0x3fc152){const _0x21d25a=a256_0x89c1,_0x3d34f3=_0x3230b6();while(!![]){try{const _0x710fe6=parseInt(_0x21d25a(0x103))/0x1+parseInt(_0x21d25a(0x106))/0x2+-parseInt(_0x21d25a(0x12f))/0x3*(parseInt(_0x21d25a(0x11f))/0x4)+parseInt(_0x21d25a(0x131))/0x5*(parseInt(_0x21d25a(0xf7))/0x6)+parseInt(_0x21d25a(0x129))/0x7*(-parseInt(_0x21d25a(0x138))/0x8)+-parseInt(_0x21d25a(0xfe))/0x9+parseInt(_0x21d25a(0x10b))/0xa;if(_0x710fe6===_0x3fc152)break;else _0x3d34f3['push'](_0x3d34f3['shift']());}catch(_0x5a06bc){_0x3d34f3['push'](_0x3d34f3['shift']());}}}(a256_0x5e6a,0xc7d5d));const a256_0x3f5bb4=(function(){let _0x1dc6b6=!![];return function(_0x6444ec,_0x1a6f11){const _0x54bf17=_0x1dc6b6?function(){const _0x46552b=a256_0x89c1;if(_0x1a6f11){const _0x2078ec=_0x1a6f11[_0x46552b(0x140)](_0x6444ec,arguments);return _0x1a6f11=null,_0x2078ec;}}:function(){};return _0x1dc6b6=![],_0x54bf17;};}()),a256_0x3b9cf8=a256_0x3f5bb4(this,function(){const _0x1d1bf9=a256_0x89c1;return a256_0x3b9cf8[_0x1d1bf9(0xf2)]()[_0x1d1bf9(0x12c)](_0x1d1bf9(0x150))[_0x1d1bf9(0xf2)]()['constructor'](a256_0x3b9cf8)[_0x1d1bf9(0x12c)](_0x1d1bf9(0x150));});a256_0x3b9cf8();function a256_0x5e6a(){const _0x2ee9e9=['-mainchannel','test','ticket-','number','token','forEach','16cgIDqv','debug','FRONTEND_URL','__esModule','joinChatBox','save','profile','use','apply','userId','Token\x20não\x20fornecido','\x20pelo\x20usuário\x20','join','getIO','default','data','Usuário\x20','error','Usuário\x20desconectado:\x20','message','string','Usuário\x20não\x20encontrado','Erro\x20de\x20autenticação:\x20',']:\x20Usuário:\x20','(((.+)+)+)+$','findByPk','notification','verify','\x20entrou\x20no\x20canal\x20de\x20tickets\x20','\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','toString','decrementCounter',']:\x20Canal:\x20','joinChatbox[','joinNotification','859260tnXiie','incrementCounter','development','\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20','user-','\x20saiu\x20do\x20canal\x20de\x20tickets\x20','allTicket','8417934mVJnTX','jsonwebtoken','then','env','leaveTickets','1037249wnduwz','passwordHash','companyId','1810970KenATH','../models/Ticket','queue-','../models/User','parse','21114280dKbqgT','warn','queues','-notification','./counter','basic','initIO','logger','../config/auth','Admin\x20','leaveNotification','info','online','user','joinTickets','Usuário\x20conectado:\x20','leave','Token\x20inválido','Falha\x20na\x20autenticação','auth','94876HiHWWw','ID\x20de\x20ticket\x20inválido:\x20','SOCKET_ADMIN','status-','\x20da\x20empresa\x20','company-','Erro\x20ao\x20buscar\x20ticket\x20','@socket.io/admin-ui','admin','disconnect','5493257YeUePU','email','CounterManager','search','../utils/logger','\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20','183ECpbdw','leaveChatBox','25vnjBnc'];a256_0x5e6a=function(){return _0x2ee9e9;};return a256_0x5e6a();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3d6fef){const _0xbbfb16=a256_0x89c1;return _0x3d6fef&&_0x3d6fef[_0xbbfb16(0x13b)]?_0x3d6fef:{'default':_0x3d6fef};};Object['defineProperty'](exports,a256_0x2aed6d(0x13b),{'value':!![]}),exports[a256_0x2aed6d(0x145)]=exports[a256_0x2aed6d(0x111)]=void 0x0;const socket_io_1=require('socket.io'),admin_ui_1=require(a256_0x2aed6d(0x126)),jsonwebtoken_1=require(a256_0x2aed6d(0xff)),AppError_1=__importDefault(require('../errors/AppError')),logger_1=require(a256_0x2aed6d(0x12d)),User_1=__importDefault(require(a256_0x2aed6d(0x109))),Queue_1=__importDefault(require('../models/Queue')),Ticket_1=__importDefault(require(a256_0x2aed6d(0x107))),auth_1=__importDefault(require(a256_0x2aed6d(0x113))),counter_1=require(a256_0x2aed6d(0x10f));let io;const initIO=_0x2e3813=>{const _0x432392=a256_0x2aed6d;return io=new socket_io_1['Server'](_0x2e3813,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process[_0x432392(0x101)][_0x432392(0x13a)]}}),process[_0x432392(0x101)][_0x432392(0x121)]&&JSON[_0x432392(0x10a)](process['env'][_0x432392(0x121)])&&User_1[_0x432392(0x146)][_0x432392(0x151)](0x1)[_0x432392(0x100)](_0x21f772=>{const _0xf9cc39=_0x432392;(0x0,admin_ui_1['instrument'])(io,{'auth':{'type':_0xf9cc39(0x110),'username':_0x21f772[_0xf9cc39(0x12a)],'password':_0x21f772[_0xf9cc39(0x104)]},'mode':_0xf9cc39(0xf9)});}),io[_0x432392(0x13f)](async(_0x7cecc5,_0x4c9e8e)=>{const _0x56c1a6=_0x432392;try{const _0x499199=_0x7cecc5['handshake'][_0x56c1a6(0x11e)]['token']||_0x7cecc5['handshake']['query'][_0x56c1a6(0x136)];if(!_0x499199)throw new Error(_0x56c1a6(0x142));const _0x40dc3d=(0x0,jsonwebtoken_1[_0x56c1a6(0x153)])(_0x499199,auth_1[_0x56c1a6(0x146)]['secret']);if(!_0x40dc3d||typeof _0x40dc3d['id']!==_0x56c1a6(0x135))throw new Error(_0x56c1a6(0x11c));const _0x3c67ad=await User_1[_0x56c1a6(0x146)][_0x56c1a6(0x151)](_0x40dc3d['id'],{'include':[Queue_1['default']]});if(!_0x3c67ad)throw new Error(_0x56c1a6(0x14d));_0x7cecc5[_0x56c1a6(0x147)][_0x56c1a6(0x118)]=_0x3c67ad,_0x4c9e8e();}catch(_0x4bdb8d){logger_1[_0x56c1a6(0x112)][_0x56c1a6(0x149)](_0x56c1a6(0x14e)+_0x4bdb8d[_0x56c1a6(0x14b)]),_0x4c9e8e(new Error(_0x56c1a6(0x11d)));}}),io['on']('connection',async _0x2b7844=>{const _0x4a1da2=_0x432392,_0x814d7e=_0x2b7844[_0x4a1da2(0x147)][_0x4a1da2(0x118)],_0x2f066d=new counter_1[(_0x4a1da2(0x12b))]();logger_1[_0x4a1da2(0x112)][_0x4a1da2(0x116)](_0x4a1da2(0x11a)+_0x814d7e['id']),_0x814d7e[_0x4a1da2(0x117)]=!![],await _0x814d7e[_0x4a1da2(0x13d)](),_0x2b7844[_0x4a1da2(0x144)](_0x4a1da2(0x124)+_0x814d7e['companyId']+_0x4a1da2(0x132)),_0x2b7844[_0x4a1da2(0x144)]('company-'+_0x814d7e[_0x4a1da2(0x105)]),_0x2b7844[_0x4a1da2(0x144)](_0x4a1da2(0xfb)+_0x814d7e['id']),_0x2b7844['on'](_0x4a1da2(0x13c),async _0x18ddf3=>{const _0x5b6918=_0x4a1da2;if(typeof _0x18ddf3!==_0x5b6918(0x14c)||!/^\d+$/[_0x5b6918(0x133)](_0x18ddf3)){logger_1['logger']['warn'](_0x5b6918(0x120)+_0x18ddf3);return;}try{const _0x5ec86b=await Ticket_1[_0x5b6918(0x146)][_0x5b6918(0x151)](_0x18ddf3);if(_0x5ec86b&&_0x5ec86b['companyId']===_0x814d7e[_0x5b6918(0x105)]&&(_0x5ec86b[_0x5b6918(0x141)]===_0x814d7e['id']||_0x814d7e[_0x5b6918(0x13e)]===_0x5b6918(0x127)||_0x814d7e[_0x5b6918(0xfd)])){const _0x39cb94=_0x2f066d['incrementCounter']('ticket-'+_0x18ddf3);_0x39cb94===0x1&&_0x2b7844['join'](_0x18ddf3),logger_1[_0x5b6918(0x112)][_0x5b6918(0x139)](_0x5b6918(0xf5)+_0x39cb94+_0x5b6918(0xf4)+_0x18ddf3+'\x20pelo\x20usuário\x20'+_0x814d7e['id']);}else logger_1[_0x5b6918(0x112)][_0x5b6918(0x10c)]('Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20'+_0x18ddf3+_0x5b6918(0x143)+_0x814d7e['id']);}catch(_0x338851){logger_1['logger']['error'](_0x5b6918(0x125)+_0x18ddf3+':\x20'+_0x338851[_0x5b6918(0x14b)]);}}),_0x2b7844['on'](_0x4a1da2(0x130),_0x5994dd=>{const _0x698bec=_0x4a1da2;if(typeof _0x5994dd==='string'&&/^\d+$/['test'](_0x5994dd)){const _0x2797b1=_0x2f066d['decrementCounter'](_0x698bec(0x134)+_0x5994dd);_0x2797b1===0x0&&_0x2b7844[_0x698bec(0x11b)](_0x5994dd),logger_1[_0x698bec(0x112)][_0x698bec(0x139)]('leaveChatbox['+_0x2797b1+_0x698bec(0xf4)+_0x5994dd+'\x20pelo\x20usuário\x20'+_0x814d7e['id']);}}),_0x2b7844['on'](_0x4a1da2(0xf6),()=>{const _0x4172b9=_0x4a1da2,_0x394907=_0x2f066d[_0x4172b9(0xf8)]('notification');_0x394907===0x1&&(_0x814d7e[_0x4172b9(0x13e)]===_0x4172b9(0x127)||_0x814d7e['allTicket']?_0x2b7844[_0x4172b9(0x144)]('company-'+_0x814d7e[_0x4172b9(0x105)]+_0x4172b9(0x10e)):_0x814d7e['queues'][_0x4172b9(0x137)](_0x31633a=>{const _0x4e0ebe=_0x4172b9;logger_1['logger']['debug'](_0x4e0ebe(0x148)+_0x814d7e['id']+_0x4e0ebe(0x123)+_0x814d7e[_0x4e0ebe(0x105)]+_0x4e0ebe(0xfa)+_0x31633a['id']+'.'),_0x2b7844['join'](_0x4e0ebe(0x108)+_0x31633a['id']+'-notification');})),logger_1['logger'][_0x4172b9(0x139)]('joinNotification['+_0x394907+_0x4172b9(0x14f)+_0x814d7e['id']);}),_0x2b7844['on'](_0x4a1da2(0x115),()=>{const _0x4228fe=_0x4a1da2,_0x4637cc=_0x2f066d[_0x4228fe(0xf3)](_0x4228fe(0x152));_0x4637cc===0x0&&(_0x814d7e[_0x4228fe(0x13e)]==='admin'||_0x814d7e['allTicket']?_0x2b7844[_0x4228fe(0x11b)]('company-'+_0x814d7e[_0x4228fe(0x105)]+_0x4228fe(0x10e)):_0x814d7e[_0x4228fe(0x10d)]['forEach'](_0x2e3c6b=>{const _0xe59554=_0x4228fe;logger_1[_0xe59554(0x112)][_0xe59554(0x139)](_0xe59554(0x148)+_0x814d7e['id']+_0xe59554(0x123)+_0x814d7e['companyId']+_0xe59554(0x12e)+_0x2e3c6b['id']+'.'),_0x2b7844[_0xe59554(0x11b)](_0xe59554(0x108)+_0x2e3c6b['id']+'-notification');})),logger_1[_0x4228fe(0x112)][_0x4228fe(0x139)]('leaveNotification['+_0x4637cc+']:\x20Usuário:\x20'+_0x814d7e['id']);}),_0x2b7844['on'](_0x4a1da2(0x119),_0x11b430=>{const _0x5a5d21=_0x4a1da2;_0x2f066d[_0x5a5d21(0xf8)](_0x5a5d21(0x122)+_0x11b430)===0x1&&(_0x814d7e['profile']===_0x5a5d21(0x127)||_0x814d7e['allTicket']?(logger_1[_0x5a5d21(0x112)][_0x5a5d21(0x139)]('Admin\x20'+_0x814d7e['id']+_0x5a5d21(0x123)+_0x814d7e['companyId']+_0x5a5d21(0x154)+_0x11b430+'.'),_0x2b7844[_0x5a5d21(0x144)](_0x5a5d21(0x124)+_0x814d7e[_0x5a5d21(0x105)]+'-'+_0x11b430)):_0x814d7e[_0x5a5d21(0x10d)][_0x5a5d21(0x137)](_0x76e986=>{const _0x400687=_0x5a5d21;logger_1[_0x400687(0x112)][_0x400687(0x139)](_0x400687(0x148)+_0x814d7e['id']+_0x400687(0x123)+_0x814d7e['companyId']+_0x400687(0xf1)+_0x76e986['id']+'.'),_0x2b7844[_0x400687(0x144)]('queue-'+_0x76e986['id']+'-'+_0x11b430);}));}),_0x2b7844['on'](_0x4a1da2(0x102),_0xac4993=>{const _0x539b55=_0x4a1da2;_0x2f066d[_0x539b55(0xf3)](_0x539b55(0x122)+_0xac4993)===0x0&&(_0x814d7e['profile']===_0x539b55(0x127)||_0x814d7e[_0x539b55(0xfd)]?(logger_1['logger'][_0x539b55(0x139)](_0x539b55(0x114)+_0x814d7e['id']+_0x539b55(0x123)+_0x814d7e[_0x539b55(0x105)]+_0x539b55(0xfc)+_0xac4993+'.'),_0x2b7844[_0x539b55(0x11b)]('company-'+_0x814d7e[_0x539b55(0x105)]+'-'+_0xac4993)):_0x814d7e[_0x539b55(0x10d)][_0x539b55(0x137)](_0x310e69=>{const _0x40ccd5=_0x539b55;logger_1['logger'][_0x40ccd5(0x139)]('Usuário\x20'+_0x814d7e['id']+_0x40ccd5(0x123)+_0x814d7e[_0x40ccd5(0x105)]+'\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20'+_0x310e69['id']+'.'),_0x2b7844[_0x40ccd5(0x11b)]('queue-'+_0x310e69['id']+'-'+_0xac4993);}));}),_0x2b7844['on'](_0x4a1da2(0x128),async()=>{const _0x5e7dda=_0x4a1da2;logger_1[_0x5e7dda(0x112)]['info'](_0x5e7dda(0x14a)+_0x814d7e['id']),_0x814d7e[_0x5e7dda(0x117)]=![],await _0x814d7e[_0x5e7dda(0x13d)]();});}),io;};exports[a256_0x2aed6d(0x111)]=initIO;const getIO=()=>{if(!io)throw new AppError_1['default']('Socket\x20IO\x20não\x20inicializado');return io;};exports[a256_0x2aed6d(0x145)]=getIO;