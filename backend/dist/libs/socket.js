const a255_0x3da4d2=a255_0x4e78;function a255_0x177d(){const _0x1056f4=['token','env','number','\x20da\x20empresa\x20','companyId','5480144UQhLQa','initIO','socket.io','-notification','string','queue-','profile','CounterManager','Usuário\x20não\x20encontrado','defineProperty',']:\x20Canal:\x20','allTicket','leave','ID\x20de\x20ticket\x20inválido:\x20','../models/User','954895zRrRle','../utils/logger','notification','Token\x20inválido','status-','basic','(((.+)+)+)+$','use','Usuário\x20conectado:\x20','5743188tOYDrs','Admin\x20','\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20','query','4JAzmVa','joinNotification','25692650jWlzdA','13380FXBCjS','handshake','join','development','ticket-','leaveNotification','Erro\x20ao\x20buscar\x20ticket\x20','warn','connection','joinNotification[','error','Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20','../errors/AppError','default','instrument','Erro\x20de\x20autenticação:\x20','__importDefault','leaveChatBox','2704908HGGMxZ','leaveNotification[','Usuário\x20desconectado:\x20','-mainchannel','\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','toString','search','@socket.io/admin-ui','350280RBkRVX','apply','\x20pelo\x20usuário\x20','forEach','joinChatbox[','./counter','Token\x20não\x20fornecido','findByPk','18GYGgfS','logger','auth','secret','SOCKET_ADMIN','\x20saiu\x20do\x20canal\x20de\x20tickets\x20','email','verify','queues','disconnect','user','decrementCounter','test','Socket\x20IO\x20não\x20inicializado','getIO','Usuário\x20','7tfkzYI','passwordHash','info',']:\x20Usuário:\x20','admin','debug','online','leaveTickets','../config/auth','data','save','Server','\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20','incrementCounter','__esModule','company-'];a255_0x177d=function(){return _0x1056f4;};return a255_0x177d();}(function(_0x391d7a,_0x117aaa){const _0x32e95f=a255_0x4e78,_0x1d5580=_0x391d7a();while(!![]){try{const _0x540af9=parseInt(_0x32e95f(0xa2))/0x1*(-parseInt(_0x32e95f(0xc4))/0x2)+-parseInt(_0x32e95f(0xbc))/0x3+-parseInt(_0x32e95f(0x9f))/0x4*(parseInt(_0x32e95f(0x92))/0x5)+parseInt(_0x32e95f(0xb4))/0x6*(-parseInt(_0x32e95f(0xd4))/0x7)+-parseInt(_0x32e95f(0x83))/0x8+-parseInt(_0x32e95f(0x9b))/0x9+parseInt(_0x32e95f(0xa1))/0xa;if(_0x540af9===_0x117aaa)break;else _0x1d5580['push'](_0x1d5580['shift']());}catch(_0x563d6e){_0x1d5580['push'](_0x1d5580['shift']());}}}(a255_0x177d,0x59a22));const a255_0x38a328=(function(){let _0x81e608=!![];return function(_0x420462,_0x2589fb){const _0x5a8f0c=_0x81e608?function(){const _0x2e7e15=a255_0x4e78;if(_0x2589fb){const _0x7ad4f4=_0x2589fb[_0x2e7e15(0xbd)](_0x420462,arguments);return _0x2589fb=null,_0x7ad4f4;}}:function(){};return _0x81e608=![],_0x5a8f0c;};}()),a255_0x14e8ed=a255_0x38a328(this,function(){const _0x14e9fb=a255_0x4e78;return a255_0x14e8ed[_0x14e9fb(0xb9)]()[_0x14e9fb(0xba)]('(((.+)+)+)+$')[_0x14e9fb(0xb9)]()['constructor'](a255_0x14e8ed)['search'](_0x14e9fb(0x98));});a255_0x14e8ed();'use strict';var __importDefault=this&&this[a255_0x3da4d2(0xb2)]||function(_0x2580d3){return _0x2580d3&&_0x2580d3['__esModule']?_0x2580d3:{'default':_0x2580d3};};Object[a255_0x3da4d2(0x8c)](exports,a255_0x3da4d2(0x7c),{'value':!![]}),exports[a255_0x3da4d2(0xd2)]=exports[a255_0x3da4d2(0x84)]=void 0x0;const socket_io_1=require(a255_0x3da4d2(0x85)),admin_ui_1=require(a255_0x3da4d2(0xbb)),jsonwebtoken_1=require('jsonwebtoken'),AppError_1=__importDefault(require(a255_0x3da4d2(0xae))),logger_1=require(a255_0x3da4d2(0x93)),User_1=__importDefault(require(a255_0x3da4d2(0x91))),Queue_1=__importDefault(require('../models/Queue')),Ticket_1=__importDefault(require('../models/Ticket')),auth_1=__importDefault(require(a255_0x3da4d2(0x76))),counter_1=require(a255_0x3da4d2(0xc1));function a255_0x4e78(_0x31203a,_0x563199){const _0x5c2811=a255_0x177d();return a255_0x4e78=function(_0x14e8ed,_0x38a328){_0x14e8ed=_0x14e8ed-0x70;let _0x177d72=_0x5c2811[_0x14e8ed];return _0x177d72;},a255_0x4e78(_0x31203a,_0x563199);}let io;const initIO=_0x542e13=>{const _0x57afda=a255_0x3da4d2;return io=new socket_io_1[(_0x57afda(0x79))](_0x542e13,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process[_0x57afda(0x7f)]['FRONTEND_URL']}}),process[_0x57afda(0x7f)][_0x57afda(0xc8)]&&JSON['parse'](process[_0x57afda(0x7f)][_0x57afda(0xc8)])&&User_1['default'][_0x57afda(0xc3)](0x1)['then'](_0x1aae5f=>{const _0x18b722=_0x57afda;(0x0,admin_ui_1[_0x18b722(0xb0)])(io,{'auth':{'type':_0x18b722(0x97),'username':_0x1aae5f[_0x18b722(0xca)],'password':_0x1aae5f[_0x18b722(0xd5)]},'mode':_0x18b722(0xa5)});}),io[_0x57afda(0x99)](async(_0x427024,_0x2f1e3c)=>{const _0x1bc747=_0x57afda;try{const _0x3053f0=_0x427024['handshake'][_0x1bc747(0xc6)][_0x1bc747(0x7e)]||_0x427024[_0x1bc747(0xa3)][_0x1bc747(0x9e)][_0x1bc747(0x7e)];if(!_0x3053f0)throw new Error(_0x1bc747(0xc2));const _0x418987=(0x0,jsonwebtoken_1[_0x1bc747(0xcb)])(_0x3053f0,auth_1[_0x1bc747(0xaf)][_0x1bc747(0xc7)]);if(!_0x418987||typeof _0x418987['id']!==_0x1bc747(0x80))throw new Error(_0x1bc747(0x95));const _0x23a4fd=await User_1[_0x1bc747(0xaf)]['findByPk'](_0x418987['id'],{'include':[Queue_1[_0x1bc747(0xaf)]]});if(!_0x23a4fd)throw new Error(_0x1bc747(0x8b));_0x427024['data'][_0x1bc747(0xce)]=_0x23a4fd,_0x2f1e3c();}catch(_0x4ce561){logger_1['logger']['error'](_0x1bc747(0xb1)+_0x4ce561['message']),_0x2f1e3c(new Error('Falha\x20na\x20autenticação'));}}),io['on'](_0x57afda(0xaa),async _0x346551=>{const _0xbec730=_0x57afda,_0x4d0fa5=_0x346551[_0xbec730(0x77)][_0xbec730(0xce)],_0x197368=new counter_1[(_0xbec730(0x8a))]();logger_1[_0xbec730(0xc5)][_0xbec730(0x70)](_0xbec730(0x9a)+_0x4d0fa5['id']),_0x4d0fa5[_0xbec730(0x74)]=!![],await _0x4d0fa5[_0xbec730(0x78)](),_0x346551['join'](_0xbec730(0x7d)+_0x4d0fa5[_0xbec730(0x82)]+_0xbec730(0xb7)),_0x346551[_0xbec730(0xa4)](_0xbec730(0x7d)+_0x4d0fa5[_0xbec730(0x82)]),_0x346551[_0xbec730(0xa4)]('user-'+_0x4d0fa5['id']),_0x346551['on']('joinChatBox',async _0x36f1b5=>{const _0x279a10=_0xbec730;if(typeof _0x36f1b5!==_0x279a10(0x87)||!/^\d+$/[_0x279a10(0xd0)](_0x36f1b5)){logger_1[_0x279a10(0xc5)]['warn'](_0x279a10(0x90)+_0x36f1b5);return;}try{const _0x145965=await Ticket_1[_0x279a10(0xaf)][_0x279a10(0xc3)](_0x36f1b5);if(_0x145965&&_0x145965[_0x279a10(0x82)]===_0x4d0fa5[_0x279a10(0x82)]&&(_0x145965['userId']===_0x4d0fa5['id']||_0x4d0fa5[_0x279a10(0x89)]===_0x279a10(0x72)||_0x4d0fa5['allTicket'])){const _0x511b50=_0x197368[_0x279a10(0x7b)]('ticket-'+_0x36f1b5);_0x511b50===0x1&&_0x346551[_0x279a10(0xa4)](_0x36f1b5),logger_1[_0x279a10(0xc5)][_0x279a10(0x73)](_0x279a10(0xc0)+_0x511b50+']:\x20Canal:\x20'+_0x36f1b5+'\x20pelo\x20usuário\x20'+_0x4d0fa5['id']);}else logger_1[_0x279a10(0xc5)][_0x279a10(0xa9)](_0x279a10(0xad)+_0x36f1b5+'\x20pelo\x20usuário\x20'+_0x4d0fa5['id']);}catch(_0x170f73){logger_1[_0x279a10(0xc5)][_0x279a10(0xac)](_0x279a10(0xa8)+_0x36f1b5+':\x20'+_0x170f73['message']);}}),_0x346551['on'](_0xbec730(0xb3),_0x5d6c60=>{const _0x2960b6=_0xbec730;if(typeof _0x5d6c60===_0x2960b6(0x87)&&/^\d+$/['test'](_0x5d6c60)){const _0x372181=_0x197368['decrementCounter'](_0x2960b6(0xa6)+_0x5d6c60);_0x372181===0x0&&_0x346551[_0x2960b6(0x8f)](_0x5d6c60),logger_1[_0x2960b6(0xc5)]['debug']('leaveChatbox['+_0x372181+_0x2960b6(0x8d)+_0x5d6c60+_0x2960b6(0xbe)+_0x4d0fa5['id']);}}),_0x346551['on'](_0xbec730(0xa0),()=>{const _0xe9e8df=_0xbec730,_0x269fd4=_0x197368['incrementCounter'](_0xe9e8df(0x94));_0x269fd4===0x1&&(_0x4d0fa5['profile']===_0xe9e8df(0x72)||_0x4d0fa5[_0xe9e8df(0x8e)]?_0x346551[_0xe9e8df(0xa4)](_0xe9e8df(0x7d)+_0x4d0fa5[_0xe9e8df(0x82)]+_0xe9e8df(0x86)):_0x4d0fa5[_0xe9e8df(0xcc)]['forEach'](_0x3c65ee=>{const _0x13fc66=_0xe9e8df;logger_1[_0x13fc66(0xc5)]['debug'](_0x13fc66(0xd3)+_0x4d0fa5['id']+'\x20da\x20empresa\x20'+_0x4d0fa5[_0x13fc66(0x82)]+_0x13fc66(0x9d)+_0x3c65ee['id']+'.'),_0x346551[_0x13fc66(0xa4)](_0x13fc66(0x88)+_0x3c65ee['id']+_0x13fc66(0x86));})),logger_1['logger']['debug'](_0xe9e8df(0xab)+_0x269fd4+_0xe9e8df(0x71)+_0x4d0fa5['id']);}),_0x346551['on'](_0xbec730(0xa7),()=>{const _0x4e9271=_0xbec730,_0x4b3ee7=_0x197368['decrementCounter']('notification');_0x4b3ee7===0x0&&(_0x4d0fa5['profile']===_0x4e9271(0x72)||_0x4d0fa5['allTicket']?_0x346551[_0x4e9271(0x8f)]('company-'+_0x4d0fa5[_0x4e9271(0x82)]+_0x4e9271(0x86)):_0x4d0fa5['queues'][_0x4e9271(0xbf)](_0x2f4078=>{const _0x222675=_0x4e9271;logger_1[_0x222675(0xc5)][_0x222675(0x73)](_0x222675(0xd3)+_0x4d0fa5['id']+_0x222675(0x81)+_0x4d0fa5['companyId']+_0x222675(0x7a)+_0x2f4078['id']+'.'),_0x346551[_0x222675(0x8f)](_0x222675(0x88)+_0x2f4078['id']+_0x222675(0x86));})),logger_1[_0x4e9271(0xc5)][_0x4e9271(0x73)](_0x4e9271(0xb5)+_0x4b3ee7+_0x4e9271(0x71)+_0x4d0fa5['id']);}),_0x346551['on']('joinTickets',_0x4d8db7=>{const _0x572eb3=_0xbec730;_0x197368[_0x572eb3(0x7b)](_0x572eb3(0x96)+_0x4d8db7)===0x1&&(_0x4d0fa5[_0x572eb3(0x89)]===_0x572eb3(0x72)||_0x4d0fa5[_0x572eb3(0x8e)]?(logger_1['logger'][_0x572eb3(0x73)](_0x572eb3(0x9c)+_0x4d0fa5['id']+_0x572eb3(0x81)+_0x4d0fa5[_0x572eb3(0x82)]+'\x20entrou\x20no\x20canal\x20de\x20tickets\x20'+_0x4d8db7+'.'),_0x346551[_0x572eb3(0xa4)](_0x572eb3(0x7d)+_0x4d0fa5['companyId']+'-'+_0x4d8db7)):_0x4d0fa5[_0x572eb3(0xcc)][_0x572eb3(0xbf)](_0x1881e0=>{const _0x36c835=_0x572eb3;logger_1[_0x36c835(0xc5)][_0x36c835(0x73)](_0x36c835(0xd3)+_0x4d0fa5['id']+_0x36c835(0x81)+_0x4d0fa5[_0x36c835(0x82)]+_0x36c835(0xb8)+_0x1881e0['id']+'.'),_0x346551['join'](_0x36c835(0x88)+_0x1881e0['id']+'-'+_0x4d8db7);}));}),_0x346551['on'](_0xbec730(0x75),_0x1bd2a4=>{const _0x614d03=_0xbec730;_0x197368[_0x614d03(0xcf)](_0x614d03(0x96)+_0x1bd2a4)===0x0&&(_0x4d0fa5[_0x614d03(0x89)]===_0x614d03(0x72)||_0x4d0fa5[_0x614d03(0x8e)]?(logger_1[_0x614d03(0xc5)][_0x614d03(0x73)](_0x614d03(0x9c)+_0x4d0fa5['id']+_0x614d03(0x81)+_0x4d0fa5[_0x614d03(0x82)]+_0x614d03(0xc9)+_0x1bd2a4+'.'),_0x346551[_0x614d03(0x8f)](_0x614d03(0x7d)+_0x4d0fa5[_0x614d03(0x82)]+'-'+_0x1bd2a4)):_0x4d0fa5[_0x614d03(0xcc)][_0x614d03(0xbf)](_0x2e3062=>{const _0x221ae1=_0x614d03;logger_1['logger'][_0x221ae1(0x73)](_0x221ae1(0xd3)+_0x4d0fa5['id']+_0x221ae1(0x81)+_0x4d0fa5[_0x221ae1(0x82)]+'\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20'+_0x2e3062['id']+'.'),_0x346551[_0x221ae1(0x8f)]('queue-'+_0x2e3062['id']+'-'+_0x1bd2a4);}));}),_0x346551['on'](_0xbec730(0xcd),async()=>{const _0x212776=_0xbec730;logger_1[_0x212776(0xc5)]['info'](_0x212776(0xb6)+_0x4d0fa5['id']),_0x4d0fa5[_0x212776(0x74)]=![],await _0x4d0fa5[_0x212776(0x78)]();});}),io;};exports['initIO']=initIO;const getIO=()=>{const _0x66c2cb=a255_0x3da4d2;if(!io)throw new AppError_1[(_0x66c2cb(0xaf))](_0x66c2cb(0xd1));return io;};exports[a255_0x3da4d2(0xd2)]=getIO;