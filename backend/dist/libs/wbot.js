const a255_0x5c3fa1=a255_0x42e8;function a255_0x42e8(_0x295c12,_0x5b5452){const _0x44b130=a255_0x5b05();return a255_0x42e8=function(_0x7bf909,_0x1e324e){_0x7bf909=_0x7bf909-0x1ec;let _0x5b0540=_0x44b130[_0x7bf909];return _0x5b0540;},a255_0x42e8(_0x295c12,_0x5b5452);}(function(_0x59e9c6,_0x130848){const _0x13f54d=a255_0x42e8,_0xe5b783=_0x59e9c6();while(!![]){try{const _0x5abf04=parseInt(_0x13f54d(0x21b))/0x1*(parseInt(_0x13f54d(0x22b))/0x2)+-parseInt(_0x13f54d(0x226))/0x3*(-parseInt(_0x13f54d(0x242))/0x4)+parseInt(_0x13f54d(0x217))/0x5*(-parseInt(_0x13f54d(0x208))/0x6)+parseInt(_0x13f54d(0x1f3))/0x7*(parseInt(_0x13f54d(0x24d))/0x8)+parseInt(_0x13f54d(0x211))/0x9+-parseInt(_0x13f54d(0x232))/0xa+-parseInt(_0x13f54d(0x1f0))/0xb;if(_0x5abf04===_0x130848)break;else _0xe5b783['push'](_0xe5b783['shift']());}catch(_0x27749a){_0xe5b783['push'](_0xe5b783['shift']());}}}(a255_0x5b05,0xccfc2));const a255_0x1e324e=(function(){let _0x3bb3d4=!![];return function(_0x234d57,_0x2bbe06){const _0xae81ec=_0x3bb3d4?function(){const _0x1ce81a=a255_0x42e8;if(_0x2bbe06){const _0x3c829c=_0x2bbe06[_0x1ce81a(0x1ec)](_0x234d57,arguments);return _0x2bbe06=null,_0x3c829c;}}:function(){};return _0x3bb3d4=![],_0xae81ec;};}()),a255_0x7bf909=a255_0x1e324e(this,function(){const _0x2c7a04=a255_0x42e8;return a255_0x7bf909[_0x2c7a04(0x255)]()[_0x2c7a04(0x229)](_0x2c7a04(0x25b))[_0x2c7a04(0x255)]()[_0x2c7a04(0x23e)](a255_0x7bf909)[_0x2c7a04(0x229)](_0x2c7a04(0x25b));});a255_0x7bf909();function a255_0x5b05(){const _0xd512d0=['141208OOJshu','key','-mainchannel','versionWA','user','statusImportMessages','10.0','__createBinding','@whiskeysockets/baileys','getWbot','CONNECTED','89968UoYPoo','Aguardando\x20conexão\x20para\x20iniciar\x20a\x20importação\x20de\x20mensagens:\x0aWhatsapp\x20nome:\x20','importRecentMessages','companyId','Daumzap','Socket\x20','../services/BaileysServices/DeleteBaileysService','logout','toString','error','presence.update:\x20error\x20processing','queueId','Adicionando\x20mensagem\x20para\x20pós-processamento:\x0aMensagem\x20de\x20GRUPO\x0aData\x20e\x20hora\x20da\x20mensagem:\x20','prototype','(((.+)+)+)+$','isValidMsg','message','findAll','\x0aWhatsapp\x20Id:\x20','ERR_WAPP_NOT_INITIALIZED','CONFIG_SESSION_WA_CONNECTION','output','makeCacheableSignalKeyStore','\x0aTipo\x20da\x20mensagem:\x20','company-','PENDING','stringify','Erro\x20ao\x20obter\x20versionWA:','length','toLocaleString','-whatsappSession','messageTimestamp','child','initWASocket','Adicionando\x20mensagem\x20para\x20pós-processamento:\x0aNão\x20é\x20Mensagem\x20de\x20GRUPO\x0aData\x20e\x20hora\x20da\x20mensagem:\x20','emit','../helpers/authState','set','BROWSER_VERSION','name','creds','../services/SettingServices/GetPublicSettingService','../services/WhatsappService/ImportWhatsAppMessageService','sessions:','pending','apply','update','remoteJid','jidNormalizedUser','4975861UqvYCE','BROWSER_NAME','StartWhatsAppSession','385fIjTfQ','info','Current\x20sessions:\x20','__setModuleDefault','g.us','level','default','reload','create','hasOwnProperty','loggedOut','env','defineProperty','dataMessages','removeWbot','../services/WbotServices/wbotMessageListener','map','__esModule','writable','../errors/AppError','\x20Connection\x20Update\x20','6ixxZUc','debug','importMessages-','forEach','getTime','floor','importOldMessagesGroups','Received\x20contact\x20presence','split','4871655amDkIA','getIO','__importStar','connection.update','Formato\x20inválido\x20para\x20versionWA.\x20Esperado:\x200.0000.0000000000','-contact','860995rSbyVI','Starting\x20session\x20','../services/WbotServices/StartWhatsAppSession','findByPk','766766QzJfzk','presence.update','push','add','fetchLatestBaileysVersion','get','Chrome','lastKnownPresence','getTypeMessage','open','replace','18IvhscA','findIndex','logger','search','whatsappSession','2MBAQml','DisconnectReason','restartWbot','status','close','sequelize','Session\x20QRCode\x20Generate\x20','6742350qYXFOC','../models/Ticket','unshift','Checking\x20for\x20session\x20in\x20array:\x20ID\x20','findOne','@sentry/node','keys','getOwnPropertyDescriptor','Removing\x20session\x20from\x20array:\x20ID\x20','importOldMessages','delFromPattern','statusCode','constructor','messages','isJidBroadcast','log'];a255_0x5b05=function(){return _0xd512d0;};return a255_0x5b05();}'use strict';var __createBinding=this&&this[a255_0x5c3fa1(0x249)]||(Object[a255_0x5c3fa1(0x1fb)]?function(_0x2a4013,_0x60aef7,_0x18fcf1,_0x2ef596){const _0x1715bb=a255_0x5c3fa1;if(_0x2ef596===undefined)_0x2ef596=_0x18fcf1;var _0x44bd1d=Object[_0x1715bb(0x239)](_0x60aef7,_0x18fcf1);(!_0x44bd1d||(_0x1715bb(0x220)in _0x44bd1d?!_0x60aef7[_0x1715bb(0x204)]:_0x44bd1d[_0x1715bb(0x205)]||_0x44bd1d['configurable']))&&(_0x44bd1d={'enumerable':!![],'get':function(){return _0x60aef7[_0x18fcf1];}}),Object[_0x1715bb(0x1ff)](_0x2a4013,_0x2ef596,_0x44bd1d);}:function(_0x3fefa6,_0x4bff64,_0x3a5d7d,_0x252f3d){if(_0x252f3d===undefined)_0x252f3d=_0x3a5d7d;_0x3fefa6[_0x252f3d]=_0x4bff64[_0x3a5d7d];}),__setModuleDefault=this&&this[a255_0x5c3fa1(0x1f6)]||(Object[a255_0x5c3fa1(0x1fb)]?function(_0x51e79b,_0x41f7d8){const _0x53714e=a255_0x5c3fa1;Object['defineProperty'](_0x51e79b,_0x53714e(0x1f9),{'enumerable':!![],'value':_0x41f7d8});}:function(_0x220b98,_0x48a259){const _0x41acda=a255_0x5c3fa1;_0x220b98[_0x41acda(0x1f9)]=_0x48a259;}),__importStar=this&&this[a255_0x5c3fa1(0x213)]||function(_0x26f0dc){const _0x1e104=a255_0x5c3fa1;if(_0x26f0dc&&_0x26f0dc[_0x1e104(0x204)])return _0x26f0dc;var _0x3e51c0={};if(_0x26f0dc!=null){for(var _0x487571 in _0x26f0dc)if(_0x487571!==_0x1e104(0x1f9)&&Object[_0x1e104(0x25a)][_0x1e104(0x1fc)]['call'](_0x26f0dc,_0x487571))__createBinding(_0x3e51c0,_0x26f0dc,_0x487571);}return __setModuleDefault(_0x3e51c0,_0x26f0dc),_0x3e51c0;},__importDefault=this&&this['__importDefault']||function(_0x16901a){const _0x256897=a255_0x5c3fa1;return _0x16901a&&_0x16901a[_0x256897(0x204)]?_0x16901a:{'default':_0x16901a};};Object['defineProperty'](exports,a255_0x5c3fa1(0x204),{'value':!![]}),exports['initWASocket']=exports['restartWbot']=exports[a255_0x5c3fa1(0x201)]=exports[a255_0x5c3fa1(0x24b)]=exports['dataMessages']=void 0x0;const Sentry=__importStar(require(a255_0x5c3fa1(0x237))),baileys_1=__importStar(require(a255_0x5c3fa1(0x24a))),sequelize_1=require(a255_0x5c3fa1(0x230)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),Contact_1=__importDefault(require('../models/Contact')),Ticket_1=__importDefault(require(a255_0x5c3fa1(0x233))),logger_1=require('../utils/logger'),logger_2=__importDefault(require('@whiskeysockets/baileys/lib/Utils/logger')),authState_1=__importDefault(require(a255_0x5c3fa1(0x271))),AppError_1=__importDefault(require(a255_0x5c3fa1(0x206))),socket_1=require('./socket'),StartWhatsAppSession_1=require(a255_0x5c3fa1(0x219)),DeleteBaileysService_1=__importDefault(require(a255_0x5c3fa1(0x253))),node_cache_1=__importDefault(require('node-cache')),date_fns_1=require('date-fns'),wbotMessageListener_1=require(a255_0x5c3fa1(0x202)),ImportWhatsAppMessageService_1=__importDefault(require(a255_0x5c3fa1(0x277))),cache_1=__importDefault(require('../libs/cache')),GetPublicSettingService_1=__importDefault(require(a255_0x5c3fa1(0x276))),loggerBaileys=logger_2[a255_0x5c3fa1(0x1f9)][a255_0x5c3fa1(0x26d)]({});loggerBaileys[a255_0x5c3fa1(0x1f8)]='silent';const sessions=[],retriesQrCodeMap=new Map();exports[a255_0x5c3fa1(0x200)]={};const getWbot=_0x495949=>{const _0x2edcba=a255_0x5c3fa1;logger_1[_0x2edcba(0x228)][_0x2edcba(0x209)](_0x2edcba(0x235)+_0x495949),logger_1[_0x2edcba(0x228)][_0x2edcba(0x209)](_0x2edcba(0x1f5)+JSON[_0x2edcba(0x267)](sessions['map'](_0x89ec90=>_0x89ec90['id'])));const _0x8eeda2=sessions[_0x2edcba(0x227)](_0x3cba0b=>_0x3cba0b['id']===_0x495949);if(_0x8eeda2===-0x1)throw new AppError_1['default'](_0x2edcba(0x260));return sessions[_0x8eeda2];};exports[a255_0x5c3fa1(0x24b)]=getWbot;const removeWbot=async(_0x305c7d,_0x38a11b=!![])=>{const _0x49e46d=a255_0x5c3fa1;try{const _0x51c9ee=sessions[_0x49e46d(0x227)](_0x27f8cc=>_0x27f8cc['id']===_0x305c7d);_0x51c9ee!==-0x1&&(logger_1['logger'][_0x49e46d(0x1f4)](_0x49e46d(0x23a)+_0x305c7d),_0x38a11b&&(sessions[_0x51c9ee][_0x49e46d(0x254)](),sessions[_0x51c9ee]['ws'][_0x49e46d(0x22f)]()),sessions['splice'](_0x51c9ee,0x1),logger_1[_0x49e46d(0x228)][_0x49e46d(0x209)](_0x49e46d(0x1f5)+JSON[_0x49e46d(0x267)](sessions['map'](_0x4f4f85=>_0x4f4f85['id']))));}catch(_0x4ffced){logger_1[_0x49e46d(0x228)][_0x49e46d(0x256)](_0x4ffced);}};exports[a255_0x5c3fa1(0x201)]=removeWbot;const restartWbot=async(_0x49e79c,_0xa71f76)=>{const _0x3d0f2f=a255_0x5c3fa1;try{const _0x27c999={'where':{'companyId':_0x49e79c},'attributes':['id']},_0x92288e=await Whatsapp_1[_0x3d0f2f(0x1f9)][_0x3d0f2f(0x25e)](_0x27c999);_0x92288e[_0x3d0f2f(0x203)](async _0x52749c=>{const _0x33bb3f=_0x3d0f2f,_0x37e272=sessions[_0x33bb3f(0x227)](_0x62f662=>_0x62f662['id']===_0x52749c['id']);_0x37e272!==-0x1&&sessions[_0x37e272]['ws'][_0x33bb3f(0x22f)]();});}catch(_0x11f870){logger_1['logger']['error'](_0x11f870);}};exports[a255_0x5c3fa1(0x22d)]=restartWbot;const initWASocket=async _0xaa61ea=>{return new Promise(async(_0x274a1d,_0x209b53)=>{const _0x106f19=a255_0x42e8;try{const _0x267830=(0x0,socket_1[_0x106f19(0x212)])(),_0x54983f=await Whatsapp_1['default'][_0x106f19(0x236)]({'where':{'id':_0xaa61ea['id']}});if(!_0x54983f)return;const {id:_0x109c74,name:_0x39b1c9}=_0x54983f,{version:_0xb04dc7,isLatest:_0x5b0e73}=await(0x0,baileys_1[_0x106f19(0x21f)])();logger_1[_0x106f19(0x228)]['info'](_0x106f19(0x218)+_0x39b1c9);let _0xc377fc=0x0,_0x4d8f81=null;const {state:_0x306435,saveState:_0x1a28a0}=await(0x0,authState_1[_0x106f19(0x1f9)])(_0xaa61ea),_0x3da4d6=new node_cache_1[(_0x106f19(0x1f9))](),_0x5ceae6=async()=>{const _0x312ee1=_0x106f19;try{const _0x597180=_0x312ee1(0x245),_0x32adf5=0x1,_0x3159bb=await(0x0,GetPublicSettingService_1['default'])({'key':_0x597180,'companyId':_0x32adf5});return _0x3159bb;}catch(_0x1b4107){return console[_0x312ee1(0x256)](_0x312ee1(0x268),_0x1b4107),process[_0x312ee1(0x1fe)][_0x312ee1(0x261)];}};let _0x567d22;try{_0x567d22=await _0x5ceae6(),logger_1[_0x106f19(0x228)]['info']('Using\x20WA\x20v'+_0x567d22+',\x20isLatest:\x20'+_0x5b0e73);}catch(_0x313847){console['error']('Erro\x20ao\x20inicializar\x20waVersion:',_0x313847);}const _0x42578c=_0x567d22['split']('.');if(_0x42578c[_0x106f19(0x269)]!==0x3)throw new Error(_0x106f19(0x215));const [_0x5eac6e,_0x24f9c6,_0x93f705]=_0x42578c[_0x106f19(0x203)](Number);_0x4d8f81=(0x0,baileys_1['default'])({'logger':loggerBaileys,'printQRInTerminal':![],'browser':[process[_0x106f19(0x1fe)]['BROWSER_CLIENT']||_0x106f19(0x251),process[_0x106f19(0x1fe)][_0x106f19(0x1f1)]||_0x106f19(0x221),process[_0x106f19(0x1fe)][_0x106f19(0x273)]||_0x106f19(0x248)],'auth':{'creds':_0x306435[_0x106f19(0x275)],'keys':(0x0,baileys_1[_0x106f19(0x263)])(_0x306435[_0x106f19(0x238)],loggerBaileys)},'version':[_0x5eac6e,_0x24f9c6,_0x93f705],'defaultQueryTimeoutMs':0xea60,'msgRetryCounterCache':_0x3da4d6,'shouldIgnoreJid':_0x4ced77=>(0x0,baileys_1[_0x106f19(0x240)])(_0x4ced77)}),setTimeout(async()=>{const _0x5eea01=_0x106f19;if(_0x54983f?.[_0x5eea01(0x23b)]&&_0x54983f[_0x5eea01(0x22e)]===_0x5eea01(0x24c)){let _0x24455a=new Date(_0x54983f[_0x5eea01(0x23b)])['getTime'](),_0x46e639=_0x54983f[_0x5eea01(0x24f)]!=''?new Date(_0x54983f[_0x5eea01(0x24f)])[_0x5eea01(0x20c)]():new Date()[_0x5eea01(0x20c)]();logger_1[_0x5eea01(0x228)][_0x5eea01(0x1f4)](_0x5eea01(0x24e)+_0x54983f[_0x5eea01(0x274)]+_0x5eea01(0x25f)+_0x54983f['id']+'\x0aData\x20de\x20início\x20da\x20importação:\x20'+new Date(_0x24455a)[_0x5eea01(0x26a)]()+'\x0aData\x20final\x20da\x20importação:\x20'+new Date(_0x46e639)[_0x5eea01(0x26a)]());const _0x30e3fa=new Date()[_0x5eea01(0x20c)]();await _0x54983f[_0x5eea01(0x1ed)]({'statusImportMessages':_0x30e3fa}),_0x4d8f81['ev']['on']('messaging-history.set',async _0x214805=>{const _0x47462f=_0x5eea01,_0x564d19=new Date()[_0x47462f(0x20c)]();await _0x54983f[_0x47462f(0x1ed)]({'statusImportMessages':_0x564d19});const _0x1b03a9=_0xaa61ea['id'];let _0x5acc39=_0x214805[_0x47462f(0x23f)],_0x22d061=[];_0x5acc39[_0x47462f(0x20b)](_0x49c86d=>{const _0x28a890=_0x47462f,_0x515f9f=Math[_0x28a890(0x20d)](_0x49c86d[_0x28a890(0x26c)]*0x3e8);(0x0,wbotMessageListener_1[_0x28a890(0x25c)])(_0x49c86d)&&_0x24455a<_0x515f9f&&_0x46e639>_0x515f9f&&(_0x49c86d[_0x28a890(0x243)]?.[_0x28a890(0x1ee)]['split']('@')[0x1]!=_0x28a890(0x1f7)?(logger_1[_0x28a890(0x228)][_0x28a890(0x1f4)](_0x28a890(0x26f)+new Date(_0x515f9f)['toLocaleString']()+'\x0aContato\x20da\x20Mensagem:\x20'+_0x49c86d[_0x28a890(0x243)]?.[_0x28a890(0x1ee)]+_0x28a890(0x264)+(0x0,wbotMessageListener_1[_0x28a890(0x223)])(_0x49c86d)),_0x22d061[_0x28a890(0x21d)](_0x49c86d)):_0x54983f?.[_0x28a890(0x20e)]&&(logger_1[_0x28a890(0x228)][_0x28a890(0x1f4)](_0x28a890(0x259)+new Date(_0x515f9f)[_0x28a890(0x26a)]()+'\x0aContato\x20da\x20Mensagem:\x20'+_0x49c86d['key']?.[_0x28a890(0x1ee)]+_0x28a890(0x264)+(0x0,wbotMessageListener_1[_0x28a890(0x223)])(_0x49c86d)),_0x22d061[_0x28a890(0x21d)](_0x49c86d)));}),!exports[_0x47462f(0x200)]?.[_0x1b03a9]&&(exports[_0x47462f(0x200)][_0x1b03a9]=[]),exports[_0x47462f(0x200)][_0x1b03a9][_0x47462f(0x234)](..._0x22d061),setTimeout(async()=>{const _0x2e13bf=_0x47462f;_0x267830['to'](_0x2e13bf(0x265)+_0x54983f[_0x2e13bf(0x250)]+_0x2e13bf(0x244))[_0x2e13bf(0x270)](_0x2e13bf(0x20a)+_0x54983f[_0x2e13bf(0x250)],{'action':_0x2e13bf(0x1ed),'status':{'this':-0x1,'all':-0x1}}),_0x267830['to'](_0x2e13bf(0x265)+_0x54983f[_0x2e13bf(0x250)]+_0x2e13bf(0x244))['emit'](_0x2e13bf(0x22a),{'action':'update','session':_0x54983f});},0x1f4),setTimeout(async()=>{const _0x2caeea=_0x47462f,_0x27935d=await Whatsapp_1['default'][_0x2caeea(0x21a)](_0x1b03a9);if(_0x27935d?.[_0x2caeea(0x23b)]){let _0x453847=!isNaN(new Date(Math[_0x2caeea(0x20d)](parseInt(_0x27935d?.[_0x2caeea(0x247)])))['getTime']());if(_0x453847){const _0x1af84d=new Date(Math[_0x2caeea(0x20d)](parseInt(_0x27935d?.[_0x2caeea(0x247)])))[_0x2caeea(0x20c)](),_0x532de5=+(0x0,date_fns_1[_0x2caeea(0x21e)])(_0x1af84d,{'seconds':+0x2d})['getTime']();_0x532de5<new Date()[_0x2caeea(0x20c)]()&&(await(0x0,ImportWhatsAppMessageService_1[_0x2caeea(0x1f9)])(_0x27935d),_0x27935d[_0x2caeea(0x1ed)]({'statusImportMessages':'Running'}));}}_0x267830['to'](_0x2caeea(0x265)+_0x54983f[_0x2caeea(0x250)]+'-mainchannel')[_0x2caeea(0x270)](_0x2caeea(0x22a),{'action':'update','session':_0x27935d});},0xafc8);});}},0x9c4),_0x4d8f81['ev']['on'](_0x106f19(0x214),async({connection:_0x388df4,lastDisconnect:_0x5964c0,qr:_0x5f1e4e})=>{const _0x2b8114=_0x106f19;logger_1[_0x2b8114(0x228)][_0x2b8114(0x1f4)](_0x2b8114(0x252)+_0x39b1c9+_0x2b8114(0x207)+(_0x388df4||'')+'\x20'+(_0x5964c0?_0x5964c0['error']?.[_0x2b8114(0x25d)]:''));_0x388df4===_0x2b8114(0x22f)&&(_0x5964c0?.[_0x2b8114(0x256)]?.[_0x2b8114(0x262)]?.[_0x2b8114(0x23d)]===0x193&&(await _0xaa61ea['update']({'status':_0x2b8114(0x266),'session':'','number':''}),await(0x0,DeleteBaileysService_1[_0x2b8114(0x1f9)])(_0xaa61ea['id']),await cache_1['default'][_0x2b8114(0x23c)](_0x2b8114(0x278)+_0xaa61ea['id']+':*'),_0x267830['to'](_0x2b8114(0x265)+_0xaa61ea['companyId']+_0x2b8114(0x244))[_0x2b8114(0x270)]('company-'+_0xaa61ea[_0x2b8114(0x250)]+_0x2b8114(0x26b),{'action':_0x2b8114(0x1ed),'session':_0xaa61ea}),await(0x0,exports[_0x2b8114(0x201)])(_0x109c74,![])),_0x5964c0?.[_0x2b8114(0x256)]?.['output']?.[_0x2b8114(0x23d)]!==baileys_1[_0x2b8114(0x22c)][_0x2b8114(0x1fd)]?(await(0x0,exports[_0x2b8114(0x201)])(_0x109c74,![]),setTimeout(()=>(0x0,StartWhatsAppSession_1[_0x2b8114(0x1f2)])(_0xaa61ea,_0xaa61ea['companyId']),0x7d0)):(await _0xaa61ea['update']({'status':_0x2b8114(0x266),'session':'','number':''}),await(0x0,DeleteBaileysService_1[_0x2b8114(0x1f9)])(_0xaa61ea['id']),await cache_1['default'][_0x2b8114(0x23c)](_0x2b8114(0x278)+_0xaa61ea['id']+':*'),_0x267830['to'](_0x2b8114(0x265)+_0xaa61ea['companyId']+_0x2b8114(0x244))[_0x2b8114(0x270)](_0x2b8114(0x265)+_0xaa61ea[_0x2b8114(0x250)]+'-whatsappSession',{'action':_0x2b8114(0x1ed),'session':_0xaa61ea}),await(0x0,exports['removeWbot'])(_0x109c74,![]),setTimeout(()=>(0x0,StartWhatsAppSession_1[_0x2b8114(0x1f2)])(_0xaa61ea,_0xaa61ea[_0x2b8114(0x250)]),0x7d0)));if(_0x388df4===_0x2b8114(0x224)){await _0xaa61ea[_0x2b8114(0x1ed)]({'status':_0x2b8114(0x24c),'qrcode':'','retries':0x0,'number':_0x4d8f81['type']==='md'?(0x0,baileys_1[_0x2b8114(0x1ef)])(_0x4d8f81[_0x2b8114(0x246)]['id'])[_0x2b8114(0x210)]('@')[0x0]:'-'}),_0x267830['to'](_0x2b8114(0x265)+_0xaa61ea[_0x2b8114(0x250)]+_0x2b8114(0x244))[_0x2b8114(0x270)]('company-'+_0xaa61ea['companyId']+'-whatsappSession',{'action':_0x2b8114(0x1ed),'session':_0xaa61ea});const _0x7e8095=sessions[_0x2b8114(0x227)](_0x2c3736=>_0x2c3736['id']===_0xaa61ea['id']);_0x7e8095===-0x1&&(_0x4d8f81['id']=_0xaa61ea['id'],sessions['push'](_0x4d8f81),logger_1[_0x2b8114(0x228)][_0x2b8114(0x1f4)]('Session\x20added\x20to\x20array:\x20ID\x20'+_0xaa61ea['id']),logger_1[_0x2b8114(0x228)][_0x2b8114(0x209)](_0x2b8114(0x1f5)+JSON[_0x2b8114(0x267)](sessions[_0x2b8114(0x203)](_0x357317=>_0x357317['id'])))),_0x274a1d(_0x4d8f81);}if(_0x5f1e4e!==undefined){if(retriesQrCodeMap[_0x2b8114(0x220)](_0x109c74)&&retriesQrCodeMap[_0x2b8114(0x220)](_0x109c74)>=0x3)await _0x54983f['update']({'status':'DISCONNECTED','qrcode':''}),await(0x0,DeleteBaileysService_1['default'])(_0x54983f['id']),await cache_1[_0x2b8114(0x1f9)][_0x2b8114(0x23c)](_0x2b8114(0x278)+_0xaa61ea['id']+':*'),_0x267830['to'](_0x2b8114(0x265)+_0xaa61ea['companyId']+_0x2b8114(0x244))[_0x2b8114(0x270)](_0x2b8114(0x265)+_0xaa61ea[_0x2b8114(0x250)]+_0x2b8114(0x26b),{'action':_0x2b8114(0x1ed),'session':_0x54983f}),_0x4d8f81['ev']['removeAllListeners'](_0x2b8114(0x214)),_0x4d8f81['ws'][_0x2b8114(0x22f)](),_0x4d8f81=null,retriesQrCodeMap['delete'](_0x109c74);else{logger_1['logger'][_0x2b8114(0x1f4)](_0x2b8114(0x231)+_0x39b1c9),retriesQrCodeMap[_0x2b8114(0x272)](_0x109c74,_0xc377fc+=0x1),await _0xaa61ea[_0x2b8114(0x1ed)]({'qrcode':_0x5f1e4e,'status':'qrcode','retries':0x0,'number':''});const _0x25a7ad=sessions[_0x2b8114(0x227)](_0x105e41=>_0x105e41['id']===_0xaa61ea['id']);_0x25a7ad===-0x1&&(_0x4d8f81['id']=_0xaa61ea['id'],sessions['push'](_0x4d8f81)),_0x267830['to'](_0x2b8114(0x265)+_0xaa61ea['companyId']+_0x2b8114(0x244))[_0x2b8114(0x270)](_0x2b8114(0x265)+_0xaa61ea[_0x2b8114(0x250)]+_0x2b8114(0x26b),{'action':_0x2b8114(0x1ed),'session':_0xaa61ea});}}}),_0x4d8f81['ev']['on']('creds.update',_0x1a28a0),_0x4d8f81['ev']['on'](_0x106f19(0x21c),async({id:_0x8fa07b,presences:_0x152c03})=>{const _0x26663a=_0x106f19;try{logger_1[_0x26663a(0x228)][_0x26663a(0x209)]({'remoteJid':_0x8fa07b,'presences':_0x152c03},_0x26663a(0x20f));if(!_0x152c03[_0x8fa07b]?.[_0x26663a(0x222)])return;const _0x54eda5=await Contact_1[_0x26663a(0x1f9)][_0x26663a(0x236)]({'where':{'number':_0x8fa07b[_0x26663a(0x225)](/\D/g,''),'companyId':_0xaa61ea[_0x26663a(0x250)]}});if(!_0x54eda5)return;await _0x54eda5[_0x26663a(0x1ed)]({'presence':_0x152c03[_0x8fa07b][_0x26663a(0x222)]});const _0x795a7c=await Ticket_1[_0x26663a(0x1f9)][_0x26663a(0x236)]({'where':{'contactId':_0x54eda5['id'],'whatsappId':_0xaa61ea['id'],'status':{[sequelize_1['Op']['or']]:[_0x26663a(0x224),_0x26663a(0x279)]}}});_0x795a7c&&_0x267830['to'](_0x795a7c['id'][_0x26663a(0x255)]())['to']('company-'+_0xaa61ea[_0x26663a(0x250)]+'-'+_0x795a7c[_0x26663a(0x22e)])['to']('queue-'+_0x795a7c[_0x26663a(0x258)]+'-'+_0x795a7c[_0x26663a(0x22e)])[_0x26663a(0x270)]('company-'+_0xaa61ea[_0x26663a(0x250)]+'-presence',{'ticketId':_0x795a7c['id'],'presence':_0x152c03[_0x8fa07b][_0x26663a(0x222)]}),await _0x54eda5[_0x26663a(0x1fa)](),_0x267830['to'](_0x26663a(0x265)+_0xaa61ea[_0x26663a(0x250)]+'-mainchannel')[_0x26663a(0x270)](_0x26663a(0x265)+_0xaa61ea[_0x26663a(0x250)]+_0x26663a(0x216),{'action':_0x26663a(0x1ed),'contact':_0x54eda5});}catch(_0x324856){logger_1[_0x26663a(0x228)][_0x26663a(0x256)]({'remoteJid':_0x8fa07b,'presences':_0x152c03,'error':_0x324856},_0x26663a(0x257));}});}catch(_0x28b5b7){Sentry['captureException'](_0x28b5b7),console[_0x106f19(0x241)](_0x28b5b7),_0x209b53(_0x28b5b7);}});};exports[a255_0x5c3fa1(0x26e)]=initWASocket;