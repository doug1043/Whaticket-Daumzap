'use strict';const a299_0x34e607=a299_0x5a9e;(function(_0x58aae1,_0x54bcaa){const _0x55af96=a299_0x5a9e,_0x341e4e=_0x58aae1();while(!![]){try{const _0x3a570f=-parseInt(_0x55af96(0x127))/0x1+-parseInt(_0x55af96(0x11f))/0x2+-parseInt(_0x55af96(0x177))/0x3*(parseInt(_0x55af96(0x14e))/0x4)+-parseInt(_0x55af96(0x184))/0x5+parseInt(_0x55af96(0x14a))/0x6+parseInt(_0x55af96(0x185))/0x7+parseInt(_0x55af96(0x130))/0x8;if(_0x3a570f===_0x54bcaa)break;else _0x341e4e['push'](_0x341e4e['shift']());}catch(_0x1ce0e8){_0x341e4e['push'](_0x341e4e['shift']());}}}(a299_0x2fee,0x3e590));function a299_0x5a9e(_0x4faadf,_0x2642ad){const _0x54e0dd=a299_0x2fee();return a299_0x5a9e=function(_0x164270,_0x300b63){_0x164270=_0x164270-0x113;let _0x2fee1f=_0x54e0dd[_0x164270];return _0x2fee1f;},a299_0x5a9e(_0x4faadf,_0x2642ad);}var __createBinding=this&&this['__createBinding']||(Object[a299_0x34e607(0x173)]?function(_0x4547e5,_0x59ca35,_0x54e14a,_0x4fdf41){const _0x563e05=a299_0x34e607;if(_0x4fdf41===undefined)_0x4fdf41=_0x54e14a;var _0x10be3f=Object[_0x563e05(0x123)](_0x59ca35,_0x54e14a);(!_0x10be3f||(_0x563e05(0x141)in _0x10be3f?!_0x59ca35[_0x563e05(0x176)]:_0x10be3f['writable']||_0x10be3f[_0x563e05(0x18d)]))&&(_0x10be3f={'enumerable':!![],'get':function(){return _0x59ca35[_0x54e14a];}}),Object[_0x563e05(0x18f)](_0x4547e5,_0x4fdf41,_0x10be3f);}:function(_0x53a838,_0x568df8,_0x2f4345,_0x452416){if(_0x452416===undefined)_0x452416=_0x2f4345;_0x53a838[_0x452416]=_0x568df8[_0x2f4345];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x42407a,_0x4e2985){const _0x4b2186=a299_0x34e607;Object[_0x4b2186(0x18f)](_0x42407a,_0x4b2186(0x11a),{'enumerable':!![],'value':_0x4e2985});}:function(_0xc3cf43,_0x31f521){const _0x29cfc2=a299_0x34e607;_0xc3cf43[_0x29cfc2(0x11a)]=_0x31f521;}),__importStar=this&&this['__importStar']||(function(){const _0x272384=(function(){let _0x44f950=!![];return function(_0x342b3e,_0x97c9ce){const _0x282a78=_0x44f950?function(){if(_0x97c9ce){const _0x11e2d0=_0x97c9ce['apply'](_0x342b3e,arguments);return _0x97c9ce=null,_0x11e2d0;}}:function(){};return _0x44f950=![],_0x282a78;};}()),_0xb9f3de=_0x272384(this,function(){const _0x4d9eb7=a299_0x5a9e;return _0xb9f3de['toString']()[_0x4d9eb7(0x12d)](_0x4d9eb7(0x190))['toString']()['constructor'](_0xb9f3de)[_0x4d9eb7(0x12d)](_0x4d9eb7(0x190));});_0xb9f3de();var _0x3bddc2=function(_0x4816a4){const _0x1d9706=a299_0x5a9e;return _0x3bddc2=Object[_0x1d9706(0x193)]||function(_0x5a7244){const _0x2844fb=_0x1d9706;var _0x448fd1=[];for(var _0x16432a in _0x5a7244)if(Object[_0x2844fb(0x171)][_0x2844fb(0x163)]['call'](_0x5a7244,_0x16432a))_0x448fd1[_0x448fd1[_0x2844fb(0x145)]]=_0x16432a;return _0x448fd1;},_0x3bddc2(_0x4816a4);};return function(_0x559c7a){const _0x5a8cad=a299_0x5a9e;if(_0x559c7a&&_0x559c7a[_0x5a8cad(0x176)])return _0x559c7a;var _0x4406fe={};if(_0x559c7a!=null){for(var _0x1275d0=_0x3bddc2(_0x559c7a),_0x33086e=0x0;_0x33086e<_0x1275d0['length'];_0x33086e++)if(_0x1275d0[_0x33086e]!==_0x5a8cad(0x11a))__createBinding(_0x4406fe,_0x559c7a,_0x1275d0[_0x33086e]);}return __setModuleDefault(_0x4406fe,_0x559c7a),_0x4406fe;};}()),__importDefault=this&&this[a299_0x34e607(0x120)]||function(_0x13335f){const _0x413050=a299_0x34e607;return _0x13335f&&_0x13335f[_0x413050(0x176)]?_0x13335f:{'default':_0x13335f};};Object['defineProperty'](exports,a299_0x34e607(0x176),{'value':!![]}),exports[a299_0x34e607(0x186)]=exports[a299_0x34e607(0x17c)]=exports['removeWbot']=exports['getWbot']=void 0x0;const Sentry=__importStar(require('@sentry/node')),baileys_1=__importStar(require(a299_0x34e607(0x160))),node_cache_1=__importDefault(require('node-cache')),sequelize_1=require(a299_0x34e607(0x16a)),Whatsapp_1=__importDefault(require(a299_0x34e607(0x153))),logger_1=require(a299_0x34e607(0x189)),authState_1=__importDefault(require(a299_0x34e607(0x13d))),AppError_1=__importDefault(require(a299_0x34e607(0x18b))),socket_1=require(a299_0x34e607(0x11e)),StartWhatsAppSession_1=require(a299_0x34e607(0x18e)),DeleteBaileysService_1=__importDefault(require(a299_0x34e607(0x18c))),Contact_1=__importDefault(require(a299_0x34e607(0x12a))),Ticket_1=__importDefault(require('../models/Ticket')),GetPublicSettingService_1=__importDefault(require(a299_0x34e607(0x168))),Message_1=__importDefault(require(a299_0x34e607(0x148))),ExtractPhoneNumber_1=require(a299_0x34e607(0x17e)),sessions=[],retriesQrCodeMap=new Map(),getWbot=_0x4eebf5=>{const _0x3b7ef3=a299_0x34e607,_0x4d13d0=sessions[_0x3b7ef3(0x13f)](_0x4c6b9d=>_0x4c6b9d['id']===_0x4eebf5);if(_0x4d13d0===-0x1)throw new AppError_1[(_0x3b7ef3(0x11a))](_0x3b7ef3(0x15d));return sessions[_0x4d13d0];};exports[a299_0x34e607(0x178)]=getWbot;const removeWbot=async(_0x45ac58,_0xf6c3ab=!![])=>{const _0x3788d6=a299_0x34e607;try{const _0x15a9a2=sessions['findIndex'](_0x544b09=>_0x544b09['id']===_0x45ac58);_0x15a9a2!==-0x1&&(_0xf6c3ab&&await sessions[_0x15a9a2][_0x3788d6(0x16d)](),sessions[_0x15a9a2]['ev']['removeAllListeners'](_0x3788d6(0x158)),sessions[_0x15a9a2]['ev']['removeAllListeners'](_0x3788d6(0x12b)),sessions[_0x15a9a2]['ev'][_0x3788d6(0x14c)](_0x3788d6(0x113)),sessions[_0x15a9a2]['ev'][_0x3788d6(0x14c)]('groups.upsert'),sessions[_0x15a9a2]['ev'][_0x3788d6(0x14c)](_0x3788d6(0x11c)),sessions[_0x15a9a2]['ev'][_0x3788d6(0x14c)](_0x3788d6(0x14d)),sessions[_0x15a9a2]['ev'][_0x3788d6(0x14c)](_0x3788d6(0x121)),sessions[_0x15a9a2][_0x3788d6(0x13a)](null),sessions[_0x15a9a2]['ws']['removeAllListeners'](),await sessions[_0x15a9a2]['ws']['close'](),sessions[_0x3788d6(0x164)](_0x15a9a2,0x1));}catch(_0x147ece){logger_1[_0x3788d6(0x16c)]['error'](_0x147ece);}};exports[a299_0x34e607(0x15a)]=removeWbot;const getVersionWA=async()=>{const _0xd5c9bd=a299_0x34e607;try{const _0x1a2841='versionWA',_0x39bf11=0x1,_0x46cd46=await(0x0,GetPublicSettingService_1[_0xd5c9bd(0x11a)])({'key':_0x1a2841,'companyId':_0x39bf11});return _0x46cd46||process[_0xd5c9bd(0x159)][_0xd5c9bd(0x125)];}catch(_0x510a11){return console[_0xd5c9bd(0x16b)](_0xd5c9bd(0x144),_0x510a11),process[_0xd5c9bd(0x159)][_0xd5c9bd(0x125)];}},restartWbot=async(_0x2fc3f2,_0xfe0dca)=>{const _0x558911=a299_0x34e607;try{const _0x307558={'where':{'companyId':_0x2fc3f2},'attributes':['id']},_0x4c31f5=await Whatsapp_1[_0x558911(0x11a)][_0x558911(0x13e)](_0x307558);_0x4c31f5[_0x558911(0x166)](async _0x187002=>{const _0x2bea49=sessions['findIndex'](_0x3e7fe5=>_0x3e7fe5['id']===_0x187002['id']);_0x2bea49!==-0x1&&sessions[_0x2bea49]['ws']['close']();});}catch(_0x1285b5){logger_1[_0x558911(0x16c)]['error'](_0x1285b5);}};exports[a299_0x34e607(0x17c)]=restartWbot;function a299_0x2fee(){const _0x40550d=['../utils/logger','cacheMessage:\x20error\x20parsing\x20message\x20from\x20database\x20-\x20','../errors/AppError','../services/BaileysServices/DeleteBaileysService','configurable','../services/WbotServices/StartWhatsAppSession','defineProperty','(((.+)+)+)+$','company-','groupMetadata','getOwnPropertyNames','Contact\x20not\x20found\x20for\x20','presence.update','queue-','groupCache.del\x20','cacheMessage:\x20not\x20found\x20in\x20cache\x20-\x20fallback\x20to\x20database','debug','Received\x20new\x20group','then','default','forEach','groups.update','10.0','./socket','127062ZIfkbj','__importDefault','contacts.upsert','message','getOwnPropertyDescriptor','open','CONFIG_SESSION_WA_CONNECTION','Session\x20QRCode\x20Generate\x20','442825lKNzNj','flushAll','cacheMessage:\x20saved','../models/Contact','creds.update','groupCache.set\x20','search','whatsappSession','Socket\x20\x20','7112896UXPbUD','Chrome','Received\x20group\x20participants\x20update','Found\x20contact\x20ID:\x20','del','findOne','Ignoring\x20presence\x20from\x20possible\x20group','getPhoneNumberFromJid','groupCache.flushAll','BROWSER_CLIENT','end','Erro\x20ao\x20inicializar\x20waVersion:','queueId','../helpers/authState','findAll','findIndex','output','get','DisconnectReason','-whatsappSession','Erro\x20ao\x20obter\x20versionWA:','length','\x20for\x20number:\x20','cacheMessage:\x20recovered\x20from\x20database','../models/Message','Error\x20processing\x20presence\x20update:\x20','812736wyZfCq','restartRequired','removeAllListeners','group-participants.update','4baznBW','StartWhatsAppSession',',\x20isLatest:\x20','captureException','keys','../models/Whatsapp','close','split','cacheMessage:\x20recovered\x20from\x20cache','DISCONNECTED','connection.update','env','removeWbot','pending','Using\x20WA\x20v','ERR_WAPP_NOT_INITIALIZED','log','set','@whiskeysockets/baileys','Reconnecting\x20','lastKnownPresence','hasOwnProperty','splice','Starting\x20session\x20','map','loggerBaileys','../services/SettingServices/GetPublicSettingService','status','sequelize','error','logger','logout','key','\x20in\x202\x20seconds','\x20set','prototype','companyId','create','toString','info','__esModule','823311OuBcLO','getWbot','using\x20WA\x20v','makeCacheableSignalKeyStore','PENDING','restartWbot','CONNECTED','../helpers/ExtractPhoneNumber','groupCache.get\x20','getIO','reload','dataJson','update','2488240AezWWJ','3564743efZsbH','initWASocket','push','emit'];a299_0x2fee=function(){return _0x40550d;};return a299_0x2fee();}const initWASocket=async(_0x123bbd,_0xff850b)=>{return new Promise((_0x3263ab,_0x483e97)=>{const _0xa33a93=a299_0x5a9e;try{((async()=>{const _0x1888c3=a299_0x5a9e,_0x53a384=(0x0,socket_1[_0x1888c3(0x180)])(),_0x19cdf1=await Whatsapp_1[_0x1888c3(0x11a)][_0x1888c3(0x135)]({'where':{'id':_0x123bbd['id']}});if(!_0x19cdf1)return;const {id:_0x4e646c,name:_0x16a273,provider:_0x3d06d5}=_0x19cdf1;let _0x32b62d;const _0x3b397d=_0x3d06d5==='stable';try{_0x32b62d=await getVersionWA(),logger_1[_0x1888c3(0x16c)][_0x1888c3(0x175)](_0x1888c3(0x15c)+_0x32b62d+_0x1888c3(0x150)+_0x3b397d);}catch(_0x3c5c30){console[_0x1888c3(0x16b)](_0x1888c3(0x13b),_0x3c5c30);}const _0x40c698=_0x32b62d[_0x1888c3(0x155)]('.');if(_0x40c698[_0x1888c3(0x145)]!==0x3)throw new Error('Formato\x20invÃ¡lido\x20para\x20versionWA.\x20Esperado:\x200.0000.0000000000');const [_0x3881ca,_0x32dd56,_0x404be7]=_0x40c698[_0x1888c3(0x166)](Number);logger_1['logger'][_0x1888c3(0x175)](_0x1888c3(0x179)+_0x32b62d),logger_1[_0x1888c3(0x16c)]['info']('isLegacy:\x20'+_0x3b397d),logger_1[_0x1888c3(0x16c)][_0x1888c3(0x175)](_0x1888c3(0x165)+_0x16a273);let _0xc318b9=0x0,_0x441c82=null;const _0x280df8=new node_cache_1[(_0x1888c3(0x11a))]({'stdTTL':0x78,'checkperiod':0x1e,'useClones':![]});async function _0x4343cb(_0x2f821b){const _0x2fa4eb=_0x1888c3;if(!_0x2f821b['id'])return null;const _0x134ea5=_0x280df8[_0x2fa4eb(0x141)](_0x2f821b['id']);if(_0x134ea5)return logger_1[_0x2fa4eb(0x16c)]['debug']({'message':_0x134ea5},_0x2fa4eb(0x156)),_0x134ea5;logger_1[_0x2fa4eb(0x16c)][_0x2fa4eb(0x117)]({'key':_0x2f821b},_0x2fa4eb(0x116));const _0x3f695f=await Message_1[_0x2fa4eb(0x11a)]['findOne']({'where':{'id':_0x2f821b['id'],'fromMe':!![]}});try{const _0x527ba6=JSON['parse'](_0x3f695f[_0x2fa4eb(0x182)]);return logger_1[_0x2fa4eb(0x16c)][_0x2fa4eb(0x117)]({'key':_0x2f821b,'data':_0x527ba6},_0x2fa4eb(0x147)),_0x280df8[_0x2fa4eb(0x15f)](_0x2f821b['id'],_0x527ba6['message']),_0x527ba6[_0x2fa4eb(0x122)]||undefined;}catch(_0x5200b5){logger_1['logger'][_0x2fa4eb(0x16b)]({'key':_0x2f821b},_0x2fa4eb(0x18a)+_0x5200b5['message']);}return undefined;}const {state:_0x2760fe,saveState:_0x1abf93}=await(0x0,authState_1['default'])(_0x123bbd),_0x5a09d6=new node_cache_1['default'](),_0x24c56b=new node_cache_1[(_0x1888c3(0x11a))](),_0x2a4f0f=new node_cache_1['default']({'stdTTL':0x5*0x3c,'useClones':![]}),_0x288486={'get':_0x5ed9f7=>{const _0x328d0d=_0x1888c3;logger_1[_0x328d0d(0x16c)][_0x328d0d(0x117)](_0x328d0d(0x17f)+_0x5ed9f7);const _0x4c58a7=_0x2a4f0f[_0x328d0d(0x141)](_0x5ed9f7);return!_0x4c58a7&&(logger_1[_0x328d0d(0x16c)][_0x328d0d(0x117)](_0x328d0d(0x17f)+_0x5ed9f7+'\x20not\x20found'),_0x441c82[_0x328d0d(0x192)](_0x5ed9f7)[_0x328d0d(0x119)](async _0x14c4ce=>{const _0x3c3164=_0x328d0d;logger_1[_0x3c3164(0x16c)][_0x3c3164(0x117)]({'key':_0x5ed9f7,'metadata':_0x14c4ce},'groupCache.get\x20'+_0x5ed9f7+_0x3c3164(0x170)),_0x2a4f0f[_0x3c3164(0x15f)](_0x5ed9f7,_0x14c4ce);})),_0x4c58a7;},'set':(_0xcea669,_0x381e51)=>{const _0x32c9a4=_0x1888c3;return logger_1[_0x32c9a4(0x16c)][_0x32c9a4(0x117)]({'key':_0xcea669,'value':_0x381e51},_0x32c9a4(0x12c)+_0xcea669),_0x2a4f0f[_0x32c9a4(0x15f)](_0xcea669,_0x381e51);},'del':_0x546c21=>{const _0x3cab0c=_0x1888c3;return logger_1[_0x3cab0c(0x16c)][_0x3cab0c(0x117)](_0x3cab0c(0x115)+_0x546c21),_0x2a4f0f[_0x3cab0c(0x134)](_0x546c21);},'flushAll':()=>{const _0x171f50=_0x1888c3;return logger_1[_0x171f50(0x16c)][_0x171f50(0x117)](_0x171f50(0x138)),_0x2a4f0f[_0x171f50(0x128)]();}};_0x441c82=(0x0,baileys_1['default'])({'logger':logger_1[_0x1888c3(0x167)],'printQRInTerminal':![],'browser':[process['env'][_0x1888c3(0x139)]||'Daumzap',process[_0x1888c3(0x159)]['BROWSER_NAME']||_0x1888c3(0x131),process['env']['BROWSER_VERSION']||_0x1888c3(0x11d)],'auth':{'creds':_0x2760fe['creds'],'keys':(0x0,baileys_1[_0x1888c3(0x17a)])(_0x2760fe[_0x1888c3(0x152)],logger_1[_0x1888c3(0x167)])},'version':[_0x3881ca,_0x32dd56,_0x404be7],'defaultQueryTimeoutMs':0xea60,'msgRetryCounterCache':_0x5a09d6,'generateHighQualityLinkPreview':!![],'userDevicesCache':_0x24c56b,'getMessage':_0x4343cb,'agent':_0xff850b,'fetchAgent':_0xff850b,'transactionOpts':{'maxCommitRetries':0x1,'delayBetweenTriesMs':0xa}}),_0x441c82['cacheMessage']=_0x47d2d8=>{const _0x2384da=_0x1888c3;if(!_0x47d2d8[_0x2384da(0x16e)]['fromMe'])return;logger_1['logger'][_0x2384da(0x117)]({'message':_0x47d2d8[_0x2384da(0x122)]},_0x2384da(0x129)),_0x280df8[_0x2384da(0x15f)](_0x47d2d8[_0x2384da(0x16e)]['id'],_0x47d2d8['message']);},_0x441c82['ev']['on'](_0x1888c3(0x158),async({connection:_0x5c3724,lastDisconnect:_0x4392af,qr:_0x5f0338})=>{const _0x431420=_0x1888c3;logger_1[_0x431420(0x16c)]['info']({'lastDisconnect':_0x4392af},_0x431420(0x12f)+_0x16a273+'\x20Connection\x20Update\x20'+(_0x5c3724||''));if(_0x5c3724===_0x431420(0x154)){const _0x10221b=_0x4392af?.['error']?.[_0x431420(0x140)]?.['statusCode'];if(_0x10221b===0x193)await _0x123bbd[_0x431420(0x183)]({'status':_0x431420(0x17b),'session':''}),await(0x0,DeleteBaileysService_1[_0x431420(0x11a)])(_0x123bbd['id']),_0x53a384['emit'](_0x431420(0x191)+_0x123bbd[_0x431420(0x172)]+_0x431420(0x143),{'action':_0x431420(0x183),'session':_0x123bbd}),(0x0,exports['removeWbot'])(_0x4e646c,![]);else{if(_0x10221b===baileys_1[_0x431420(0x142)][_0x431420(0x14b)]||_0x10221b===0x1f7)logger_1[_0x431420(0x16c)][_0x431420(0x175)](_0x16a273+'\x20restart\x20required\x20(503),\x20reconnecting\x20immediately...'),(0x0,exports[_0x431420(0x15a)])(_0x4e646c,![])[_0x431420(0x119)](()=>{setTimeout(async()=>{const _0x58aa86=a299_0x5a9e;await _0x123bbd[_0x58aa86(0x181)](),await(0x0,StartWhatsAppSession_1[_0x58aa86(0x14f)])(_0x123bbd,_0x123bbd['companyId']);},0x3e8);});else _0x10221b!==baileys_1[_0x431420(0x142)]['loggedOut']?(await _0x123bbd['update']({'status':_0x431420(0x17b)}),_0x53a384[_0x431420(0x188)](_0x431420(0x191)+_0x123bbd['companyId']+_0x431420(0x143),{'action':_0x431420(0x183),'session':_0x123bbd}),(0x0,exports['removeWbot'])(_0x4e646c,![])[_0x431420(0x119)](()=>{const _0x58d7ff=_0x431420;logger_1['logger'][_0x58d7ff(0x175)](_0x58d7ff(0x161)+_0x16a273+_0x58d7ff(0x16f)),setTimeout(async()=>{const _0x2ba8b3=_0x58d7ff;await _0x123bbd[_0x2ba8b3(0x181)](),await(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x123bbd,_0x123bbd[_0x2ba8b3(0x172)]);},0x7d0);})):(await _0x123bbd[_0x431420(0x183)]({'status':_0x431420(0x17b),'session':''}),await(0x0,DeleteBaileysService_1[_0x431420(0x11a)])(_0x123bbd['id']),_0x53a384['emit'](_0x431420(0x191)+_0x123bbd[_0x431420(0x172)]+'-whatsappSession',{'action':_0x431420(0x183),'session':_0x123bbd}),(0x0,exports[_0x431420(0x15a)])(_0x4e646c,![])[_0x431420(0x119)](()=>{const _0x2d5502=_0x431420;logger_1[_0x2d5502(0x16c)]['info'](_0x2d5502(0x161)+_0x16a273+_0x2d5502(0x16f)),setTimeout(async()=>{const _0x245a9a=_0x2d5502;await _0x123bbd[_0x245a9a(0x181)](),await(0x0,StartWhatsAppSession_1[_0x245a9a(0x14f)])(_0x123bbd,_0x123bbd[_0x245a9a(0x172)]);},0x7d0);}));}}if(_0x5c3724===_0x431420(0x124)){await _0x123bbd['update']({'status':_0x431420(0x17d),'qrcode':'','retries':0x0}),_0x53a384[_0x431420(0x188)](_0x431420(0x191)+_0x123bbd[_0x431420(0x172)]+_0x431420(0x143),{'action':'update','session':_0x123bbd});const _0x2dec9c=sessions[_0x431420(0x13f)](_0x276d0e=>_0x276d0e['id']===_0x123bbd['id']);_0x2dec9c===-0x1&&(_0x441c82['id']=_0x123bbd['id'],sessions['push'](_0x441c82)),_0x3263ab(_0x441c82);}if(_0x5f0338!==undefined){if(retriesQrCodeMap[_0x431420(0x141)](_0x4e646c)&&retriesQrCodeMap[_0x431420(0x141)](_0x4e646c)>=0x3)await _0x19cdf1[_0x431420(0x183)]({'status':_0x431420(0x157),'qrcode':''}),await(0x0,DeleteBaileysService_1[_0x431420(0x11a)])(_0x19cdf1['id']),_0x53a384['emit'](_0x431420(0x12e),{'action':_0x431420(0x183),'session':_0x19cdf1}),_0x441c82['ev'][_0x431420(0x14c)]('connection.update'),_0x441c82['ws'][_0x431420(0x154)](),_0x441c82=null,retriesQrCodeMap['delete'](_0x4e646c);else{logger_1[_0x431420(0x16c)][_0x431420(0x175)](_0x431420(0x126)+_0x16a273),retriesQrCodeMap['set'](_0x4e646c,_0xc318b9+=0x1),await _0x123bbd[_0x431420(0x183)]({'qrcode':_0x5f0338,'status':'qrcode','retries':0x0});const _0x4a2be=sessions[_0x431420(0x13f)](_0x1c6c36=>_0x1c6c36['id']===_0x123bbd['id']);_0x4a2be===-0x1&&(_0x441c82['id']=_0x123bbd['id'],sessions[_0x431420(0x187)](_0x441c82)),_0x53a384['emit']('company-'+_0x123bbd[_0x431420(0x172)]+'-whatsappSession',{'action':_0x431420(0x183),'session':_0x123bbd});}}}),_0x441c82['ev']['on'](_0x1888c3(0x12b),_0x1abf93),_0x441c82['ev']['on'](_0x1888c3(0x113),async({id:_0x3a1823,presences:_0xf6bf3d})=>{const _0x310d80=_0x1888c3;try{const _0xc0f17d=_0xf6bf3d[_0x3a1823]?.[_0x310d80(0x162)];if(!_0xc0f17d){logger_1[_0x310d80(0x16c)][_0x310d80(0x117)](_0x310d80(0x136));return;}const _0x5c51d7=(0x0,ExtractPhoneNumber_1[_0x310d80(0x137)])(_0x3a1823),_0x57b310=await Contact_1[_0x310d80(0x11a)][_0x310d80(0x135)]({'where':{'number':_0x5c51d7,'companyId':_0x123bbd['companyId']}});if(!_0x57b310){logger_1[_0x310d80(0x16c)][_0x310d80(0x117)](_0x310d80(0x194)+_0x3a1823);return;}logger_1[_0x310d80(0x16c)][_0x310d80(0x117)](_0x310d80(0x133)+_0x57b310['id']+_0x310d80(0x146)+_0x3a1823);const _0x2a964=await Ticket_1[_0x310d80(0x11a)]['findOne']({'where':{'contactId':_0x57b310['id'],'whatsappId':_0x123bbd['id'],'status':{[sequelize_1['Op']['or']]:[_0x310d80(0x124),_0x310d80(0x15b)]}}});if(!_0x2a964){logger_1[_0x310d80(0x16c)][_0x310d80(0x117)]('No\x20active\x20ticket\x20found\x20for\x20contact\x20'+_0x57b310['id']);return;}const _0x7a2d7d=(0x0,socket_1['getIO'])();_0x7a2d7d['to'](_0x2a964['id'][_0x310d80(0x174)]())['to'](_0x310d80(0x191)+_0x123bbd[_0x310d80(0x172)]+'-'+_0x2a964[_0x310d80(0x169)])['to'](_0x310d80(0x114)+_0x2a964[_0x310d80(0x13c)]+'-'+_0x2a964[_0x310d80(0x169)])['emit'](_0x310d80(0x191)+_0x123bbd['companyId']+'-presence',{'ticketId':_0x2a964['id'],'presence':_0xc0f17d});}catch(_0x49b4a8){logger_1['logger'][_0x310d80(0x16b)](_0x310d80(0x149)+_0x49b4a8[_0x310d80(0x122)]),Sentry[_0x310d80(0x151)](_0x49b4a8);}}),_0x441c82['ev']['on']('groups.upsert',_0x370a94=>{const _0x99e6a2=_0x1888c3;logger_1['logger'][_0x99e6a2(0x117)](_0x99e6a2(0x118)),_0x370a94[_0x99e6a2(0x11b)](_0x4a9b71=>{_0x288486['set'](_0x4a9b71['id'],_0x4a9b71);});}),_0x441c82['ev']['on'](_0x1888c3(0x11c),async([_0xad1861])=>{const _0xde8572=_0x1888c3;logger_1[_0xde8572(0x16c)][_0xde8572(0x117)]('Received\x20group\x20update');const _0x3020e6=await _0x441c82['groupMetadata'](_0xad1861['id']);_0x288486[_0xde8572(0x15f)](_0xad1861['id'],_0x3020e6);}),_0x441c82['ev']['on'](_0x1888c3(0x14d),async _0x1c06d5=>{const _0x553efe=_0x1888c3;logger_1['logger'][_0x553efe(0x117)](_0x553efe(0x132));try{const _0x1276f6=await _0x441c82[_0x553efe(0x192)](_0x1c06d5['id']);_0x288486[_0x553efe(0x15f)](_0x1c06d5['id'],_0x1276f6);}catch(_0x4962da){_0x288486[_0x553efe(0x134)](_0x1c06d5['id']);}});})());}catch(_0x4dc5a3){Sentry[_0xa33a93(0x151)](_0x4dc5a3),console[_0xa33a93(0x15e)](_0x4dc5a3),_0x483e97(_0x4dc5a3);}});};exports['initWASocket']=initWASocket;