'use strict';const a298_0x40dba5=a298_0x3305;(function(_0x4c4924,_0xf753cb){const _0x4abab1=a298_0x3305,_0xec1e=_0x4c4924();while(!![]){try{const _0x468a93=parseInt(_0x4abab1(0xe0))/0x1*(-parseInt(_0x4abab1(0xff))/0x2)+-parseInt(_0x4abab1(0xcb))/0x3+-parseInt(_0x4abab1(0x11d))/0x4*(parseInt(_0x4abab1(0x110))/0x5)+parseInt(_0x4abab1(0x123))/0x6*(-parseInt(_0x4abab1(0xc7))/0x7)+-parseInt(_0x4abab1(0x115))/0x8+parseInt(_0x4abab1(0xcf))/0x9+parseInt(_0x4abab1(0xbc))/0xa*(parseInt(_0x4abab1(0xd5))/0xb);if(_0x468a93===_0xf753cb)break;else _0xec1e['push'](_0xec1e['shift']());}catch(_0x371c1b){_0xec1e['push'](_0xec1e['shift']());}}}(a298_0x48e1,0x4254b));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x5c824c,_0x7f867f,_0x4ae2a7,_0x31fb89){const _0x1a8821=a298_0x3305;if(_0x31fb89===undefined)_0x31fb89=_0x4ae2a7;var _0x56e3cc=Object['getOwnPropertyDescriptor'](_0x7f867f,_0x4ae2a7);(!_0x56e3cc||(_0x1a8821(0x122)in _0x56e3cc?!_0x7f867f['__esModule']:_0x56e3cc[_0x1a8821(0x117)]||_0x56e3cc[_0x1a8821(0xe2)]))&&(_0x56e3cc={'enumerable':!![],'get':function(){return _0x7f867f[_0x4ae2a7];}}),Object[_0x1a8821(0xdc)](_0x5c824c,_0x31fb89,_0x56e3cc);}:function(_0x4c8751,_0xf0a64d,_0x39c05d,_0x14c225){if(_0x14c225===undefined)_0x14c225=_0x39c05d;_0x4c8751[_0x14c225]=_0xf0a64d[_0x39c05d];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a298_0x40dba5(0x113)]?function(_0x493c61,_0x42c9f7){const _0xd2b2ed=a298_0x40dba5;Object['defineProperty'](_0x493c61,_0xd2b2ed(0xe1),{'enumerable':!![],'value':_0x42c9f7});}:function(_0x124c82,_0x16e239){const _0x48dd3b=a298_0x40dba5;_0x124c82[_0x48dd3b(0xe1)]=_0x16e239;}),__importStar=this&&this[a298_0x40dba5(0xd3)]||(function(){const _0x110fb9=(function(){let _0x3fb460=!![];return function(_0x3e066d,_0x5f45c3){const _0x1b3ab5=_0x3fb460?function(){const _0x5b4ff7=a298_0x3305;if(_0x5f45c3){const _0x4f8fa5=_0x5f45c3[_0x5b4ff7(0xcc)](_0x3e066d,arguments);return _0x5f45c3=null,_0x4f8fa5;}}:function(){};return _0x3fb460=![],_0x1b3ab5;};}()),_0x9ff675=_0x110fb9(this,function(){const _0x4a12a4=a298_0x3305;return _0x9ff675['toString']()['search']('(((.+)+)+)+$')['toString']()[_0x4a12a4(0x111)](_0x9ff675)['search'](_0x4a12a4(0xc9));});_0x9ff675();var _0x25212e=function(_0x2c4c1f){return _0x25212e=Object['getOwnPropertyNames']||function(_0x430b11){const _0x3ab576=a298_0x3305;var _0x303e17=[];for(var _0x35a388 in _0x430b11)if(Object[_0x3ab576(0xf0)]['hasOwnProperty']['call'](_0x430b11,_0x35a388))_0x303e17[_0x303e17[_0x3ab576(0xb5)]]=_0x35a388;return _0x303e17;},_0x25212e(_0x2c4c1f);};return function(_0x43cd02){const _0x9299b6=a298_0x3305;if(_0x43cd02&&_0x43cd02[_0x9299b6(0xb6)])return _0x43cd02;var _0x43ab5b={};if(_0x43cd02!=null){for(var _0x58e1fe=_0x25212e(_0x43cd02),_0x432502=0x0;_0x432502<_0x58e1fe[_0x9299b6(0xb5)];_0x432502++)if(_0x58e1fe[_0x432502]!=='default')__createBinding(_0x43ab5b,_0x43cd02,_0x58e1fe[_0x432502]);}return __setModuleDefault(_0x43ab5b,_0x43cd02),_0x43ab5b;};}()),__importDefault=this&&this[a298_0x40dba5(0xdd)]||function(_0x13626d){const _0x9f6ce6=a298_0x40dba5;return _0x13626d&&_0x13626d[_0x9f6ce6(0xb6)]?_0x13626d:{'default':_0x13626d};};function a298_0x48e1(){const _0x255554=['pending','cacheMessage','restartRequired','groupMetadata','../services/SettingServices/GetPublicSettingService','@whiskeysockets/baileys','status','DisconnectReason','../models/Ticket','update','length','__esModule','open','env','-presence','makeCacheableSignalKeyStore','isLegacy:\x20','69520zyrGWH','info','push','log','findAll','BROWSER_VERSION','initWASocket','loggerBaileys','Found\x20contact\x20ID:\x20','PENDING','restartWbot','7GvODMt','logger','(((.+)+)+)+$','getIO','1196238fRKjqY','apply','loggedOut','../services/WbotServices/StartWhatsAppSession','3196593NZNkIM','getPhoneNumberFromJid','parse','groupCache.get\x20','__importStar','queue-','1617RrTuHu','./socket','company-','getWbot','BROWSER_NAME','flushAll','using\x20WA\x20v','defineProperty','__importDefault',',\x20isLatest:\x20','BROWSER_CLIENT','1UmjVNX','default','configurable','groupCache.set\x20','CONNECTED','sequelize','end','DISCONNECTED','Erro\x20ao\x20obter\x20versionWA:','companyId','@sentry/node','CONFIG_SESSION_WA_CONNECTION','Session\x20QRCode\x20Generate\x20','Contact\x20not\x20found\x20for\x20','../utils/logger','groupCache.del\x20','prototype','map','statusCode','../errors/AppError','whatsappSession','message','findOne','close','lastKnownPresence','set','then','queueId','fromMe','logout','StartWhatsAppSession','333082oAwfNR','debug','-whatsappSession','Starting\x20session\x20','removeAllListeners','error','splice','\x20for\x20number:\x20','\x20set','toString','../helpers/ExtractPhoneNumber','No\x20active\x20ticket\x20found\x20for\x20contact\x20','Reconnecting\x20','Received\x20group\x20update','qrcode','\x20in\x202\x20seconds','groups.upsert','312635vKdVwD','constructor','reload','create','cacheMessage:\x20recovered\x20from\x20database','3006232dSWbyn','Ignoring\x20presence\x20from\x20possible\x20group','writable','10.0','group-participants.update','presence.update','findIndex','removeWbot','4mPeYHr','output','del','delete','key','get','611022BAZIef','node-cache','keys','Error\x20processing\x20presence\x20update:\x20','captureException','../helpers/authState','cacheMessage:\x20error\x20parsing\x20message\x20from\x20database\x20-\x20','emit','connection.update','contacts.upsert','groups.update','groupCache.flushAll','dataJson'];a298_0x48e1=function(){return _0x255554;};return a298_0x48e1();}Object[a298_0x40dba5(0xdc)](exports,a298_0x40dba5(0xb6),{'value':!![]}),exports[a298_0x40dba5(0xc2)]=exports[a298_0x40dba5(0xc6)]=exports['removeWbot']=exports[a298_0x40dba5(0xd8)]=void 0x0;const Sentry=__importStar(require(a298_0x40dba5(0xea))),baileys_1=__importStar(require(a298_0x40dba5(0xb0))),node_cache_1=__importDefault(require(a298_0x40dba5(0x124))),sequelize_1=require(a298_0x40dba5(0xe5)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),logger_1=require(a298_0x40dba5(0xee)),authState_1=__importDefault(require(a298_0x40dba5(0x128))),AppError_1=__importDefault(require(a298_0x40dba5(0xf3))),socket_1=require(a298_0x40dba5(0xd6)),StartWhatsAppSession_1=require(a298_0x40dba5(0xce)),DeleteBaileysService_1=__importDefault(require('../services/BaileysServices/DeleteBaileysService')),Contact_1=__importDefault(require('../models/Contact')),Ticket_1=__importDefault(require(a298_0x40dba5(0xb3))),GetPublicSettingService_1=__importDefault(require(a298_0x40dba5(0xaf))),Message_1=__importDefault(require('../models/Message')),ExtractPhoneNumber_1=require(a298_0x40dba5(0x109)),sessions=[],retriesQrCodeMap=new Map(),getWbot=_0x4bd512=>{const _0x33f571=sessions['findIndex'](_0x937d1b=>_0x937d1b['id']===_0x4bd512);if(_0x33f571===-0x1)throw new AppError_1['default']('ERR_WAPP_NOT_INITIALIZED');return sessions[_0x33f571];};exports[a298_0x40dba5(0xd8)]=getWbot;const removeWbot=async(_0x489c7c,_0x2afbdc=!![])=>{const _0x3841ae=a298_0x40dba5;try{const _0x54494e=sessions[_0x3841ae(0x11b)](_0x3095cc=>_0x3095cc['id']===_0x489c7c);_0x54494e!==-0x1&&(_0x2afbdc&&await sessions[_0x54494e][_0x3841ae(0xfd)](),sessions[_0x54494e]['ev']['removeAllListeners']('connection.update'),sessions[_0x54494e]['ev'][_0x3841ae(0x103)]('creds.update'),sessions[_0x54494e]['ev'][_0x3841ae(0x103)](_0x3841ae(0x11a)),sessions[_0x54494e]['ev'][_0x3841ae(0x103)](_0x3841ae(0x10f)),sessions[_0x54494e]['ev']['removeAllListeners'](_0x3841ae(0xa8)),sessions[_0x54494e]['ev']['removeAllListeners'](_0x3841ae(0x119)),sessions[_0x54494e]['ev'][_0x3841ae(0x103)](_0x3841ae(0xa7)),sessions[_0x54494e][_0x3841ae(0xe6)](null),sessions[_0x54494e]['ws'][_0x3841ae(0x103)](),await sessions[_0x54494e]['ws']['close'](),sessions[_0x3841ae(0x105)](_0x54494e,0x1));}catch(_0x488f3f){logger_1['logger'][_0x3841ae(0x104)](_0x488f3f);}};exports['removeWbot']=removeWbot;const getVersionWA=async()=>{const _0x469e39=a298_0x40dba5;try{const _0x2813c7='versionWA',_0x32d951=0x1,_0x304b61=await(0x0,GetPublicSettingService_1['default'])({'key':_0x2813c7,'companyId':_0x32d951});return _0x304b61||process[_0x469e39(0xb8)]['CONFIG_SESSION_WA_CONNECTION'];}catch(_0x20ea6a){return console[_0x469e39(0x104)](_0x469e39(0xe8),_0x20ea6a),process[_0x469e39(0xb8)][_0x469e39(0xeb)];}},restartWbot=async(_0x5ddffc,_0x4b54ff)=>{const _0x2cc946=a298_0x40dba5;try{const _0x3c34ea={'where':{'companyId':_0x5ddffc},'attributes':['id']},_0x115561=await Whatsapp_1[_0x2cc946(0xe1)][_0x2cc946(0xc0)](_0x3c34ea);_0x115561[_0x2cc946(0xf1)](async _0x342991=>{const _0x18481a=_0x2cc946,_0x4a91ad=sessions[_0x18481a(0x11b)](_0x30aad4=>_0x30aad4['id']===_0x342991['id']);_0x4a91ad!==-0x1&&sessions[_0x4a91ad]['ws'][_0x18481a(0xf7)]();});}catch(_0x3ee0d1){logger_1[_0x2cc946(0xc8)][_0x2cc946(0x104)](_0x3ee0d1);}};exports[a298_0x40dba5(0xc6)]=restartWbot;function a298_0x3305(_0x1a88e,_0x26b676){const _0x4b910a=a298_0x48e1();return a298_0x3305=function(_0xb09751,_0x2cb7fa){_0xb09751=_0xb09751-0xa7;let _0x48e171=_0x4b910a[_0xb09751];return _0x48e171;},a298_0x3305(_0x1a88e,_0x26b676);}const initWASocket=async(_0x1feae8,_0x53f91b)=>{return new Promise((_0x48ee9c,_0x3db4aa)=>{const _0x24f12c=a298_0x3305;try{((async()=>{const _0x470fe8=a298_0x3305,_0x32be08=(0x0,socket_1[_0x470fe8(0xca)])(),_0x19a24a=await Whatsapp_1[_0x470fe8(0xe1)]['findOne']({'where':{'id':_0x1feae8['id']}});if(!_0x19a24a)return;const {id:_0x25b100,name:_0x51fa61,provider:_0x3438b8}=_0x19a24a;let _0x15f73f;const _0x4e90bc=_0x3438b8==='stable';try{_0x15f73f=await getVersionWA(),logger_1[_0x470fe8(0xc8)]['info']('Using\x20WA\x20v'+_0x15f73f+_0x470fe8(0xde)+_0x4e90bc);}catch(_0x5a51a2){console[_0x470fe8(0x104)]('Erro\x20ao\x20inicializar\x20waVersion:',_0x5a51a2);}const _0x1c2ac1=_0x15f73f['split']('.');if(_0x1c2ac1['length']!==0x3)throw new Error('Formato\x20invÃ¡lido\x20para\x20versionWA.\x20Esperado:\x200.0000.0000000000');const [_0x1a7d1c,_0x568d3c,_0x50db38]=_0x1c2ac1[_0x470fe8(0xf1)](Number);logger_1['logger'][_0x470fe8(0xbd)](_0x470fe8(0xdb)+_0x15f73f),logger_1[_0x470fe8(0xc8)][_0x470fe8(0xbd)](_0x470fe8(0xbb)+_0x4e90bc),logger_1[_0x470fe8(0xc8)][_0x470fe8(0xbd)](_0x470fe8(0x102)+_0x51fa61);let _0x5b2a00=0x0,_0x134561=null;const _0xeb5a07=new node_cache_1['default']({'stdTTL':0x78,'checkperiod':0x1e,'useClones':![]});async function _0x220bb3(_0x41b05f){const _0x4a33a7=_0x470fe8;if(!_0x41b05f['id'])return null;const _0x2f228d=_0xeb5a07[_0x4a33a7(0x122)](_0x41b05f['id']);if(_0x2f228d)return logger_1[_0x4a33a7(0xc8)][_0x4a33a7(0x100)]({'message':_0x2f228d},'cacheMessage:\x20recovered\x20from\x20cache'),_0x2f228d;logger_1['logger'][_0x4a33a7(0x100)]({'key':_0x41b05f},'cacheMessage:\x20not\x20found\x20in\x20cache\x20-\x20fallback\x20to\x20database');const _0x4ddbad=await Message_1[_0x4a33a7(0xe1)][_0x4a33a7(0xf6)]({'where':{'id':_0x41b05f['id'],'fromMe':!![]}});try{const _0x578a0e=JSON[_0x4a33a7(0xd1)](_0x4ddbad[_0x4a33a7(0xaa)]);return logger_1[_0x4a33a7(0xc8)]['debug']({'key':_0x41b05f,'data':_0x578a0e},_0x4a33a7(0x114)),_0xeb5a07[_0x4a33a7(0xf9)](_0x41b05f['id'],_0x578a0e['message']),_0x578a0e[_0x4a33a7(0xf5)]||undefined;}catch(_0x54b7c2){logger_1[_0x4a33a7(0xc8)][_0x4a33a7(0x104)]({'key':_0x41b05f},_0x4a33a7(0x129)+_0x54b7c2[_0x4a33a7(0xf5)]);}return undefined;}const {state:_0x5b6193,saveState:_0x121c9c}=await(0x0,authState_1['default'])(_0x1feae8),_0x4ee9fc=new node_cache_1['default'](),_0x4e97c0=new node_cache_1['default'](),_0x432714=new node_cache_1['default']({'stdTTL':0x5*0x3c,'useClones':![]}),_0xbf6dfa={'get':_0x4d03f1=>{const _0x5d87f8=_0x470fe8;logger_1[_0x5d87f8(0xc8)]['debug'](_0x5d87f8(0xd2)+_0x4d03f1);const _0xbc95a0=_0x432714[_0x5d87f8(0x122)](_0x4d03f1);return!_0xbc95a0&&(logger_1[_0x5d87f8(0xc8)][_0x5d87f8(0x100)](_0x5d87f8(0xd2)+_0x4d03f1+'\x20not\x20found'),_0x134561[_0x5d87f8(0xae)](_0x4d03f1)[_0x5d87f8(0xfa)](async _0x32bbdc=>{const _0x3fd771=_0x5d87f8;logger_1[_0x3fd771(0xc8)][_0x3fd771(0x100)]({'key':_0x4d03f1,'metadata':_0x32bbdc},_0x3fd771(0xd2)+_0x4d03f1+_0x3fd771(0x107)),_0x432714[_0x3fd771(0xf9)](_0x4d03f1,_0x32bbdc);})),_0xbc95a0;},'set':(_0x517e5d,_0x4102ef)=>{const _0x279c8f=_0x470fe8;return logger_1[_0x279c8f(0xc8)][_0x279c8f(0x100)]({'key':_0x517e5d,'value':_0x4102ef},_0x279c8f(0xe3)+_0x517e5d),_0x432714[_0x279c8f(0xf9)](_0x517e5d,_0x4102ef);},'del':_0x5f5a4e=>{const _0x4c08cc=_0x470fe8;return logger_1[_0x4c08cc(0xc8)][_0x4c08cc(0x100)](_0x4c08cc(0xef)+_0x5f5a4e),_0x432714['del'](_0x5f5a4e);},'flushAll':()=>{const _0x34fb20=_0x470fe8;return logger_1[_0x34fb20(0xc8)][_0x34fb20(0x100)](_0x34fb20(0xa9)),_0x432714[_0x34fb20(0xda)]();}};_0x134561=(0x0,baileys_1[_0x470fe8(0xe1)])({'logger':logger_1[_0x470fe8(0xc3)],'printQRInTerminal':![],'browser':[process[_0x470fe8(0xb8)][_0x470fe8(0xdf)]||'Daumzap',process[_0x470fe8(0xb8)][_0x470fe8(0xd9)]||'Chrome',process[_0x470fe8(0xb8)][_0x470fe8(0xc1)]||_0x470fe8(0x118)],'auth':{'creds':_0x5b6193['creds'],'keys':(0x0,baileys_1[_0x470fe8(0xba)])(_0x5b6193[_0x470fe8(0x125)],logger_1[_0x470fe8(0xc3)])},'version':[_0x1a7d1c,_0x568d3c,_0x50db38],'defaultQueryTimeoutMs':0xea60,'msgRetryCounterCache':_0x4ee9fc,'generateHighQualityLinkPreview':!![],'userDevicesCache':_0x4e97c0,'getMessage':_0x220bb3,'agent':_0x53f91b,'fetchAgent':_0x53f91b,'transactionOpts':{'maxCommitRetries':0x1,'delayBetweenTriesMs':0xa}}),_0x134561[_0x470fe8(0xac)]=_0x453d8d=>{const _0x6f71bb=_0x470fe8;if(!_0x453d8d[_0x6f71bb(0x121)][_0x6f71bb(0xfc)])return;logger_1['logger'][_0x6f71bb(0x100)]({'message':_0x453d8d[_0x6f71bb(0xf5)]},'cacheMessage:\x20saved'),_0xeb5a07[_0x6f71bb(0xf9)](_0x453d8d[_0x6f71bb(0x121)]['id'],_0x453d8d['message']);},_0x134561['ev']['on'](_0x470fe8(0x12b),async({connection:_0x23be30,lastDisconnect:_0x23c58,qr:_0x241648})=>{const _0x47e14e=_0x470fe8;logger_1['logger'][_0x47e14e(0xbd)]({'lastDisconnect':_0x23c58},'Socket\x20\x20'+_0x51fa61+'\x20Connection\x20Update\x20'+(_0x23be30||''));if(_0x23be30===_0x47e14e(0xf7)){const _0xbabfa9=_0x23c58?.[_0x47e14e(0x104)]?.[_0x47e14e(0x11e)]?.[_0x47e14e(0xf2)];if(_0xbabfa9===0x193)await _0x1feae8[_0x47e14e(0xb4)]({'status':_0x47e14e(0xc5),'session':''}),await(0x0,DeleteBaileysService_1[_0x47e14e(0xe1)])(_0x1feae8['id']),_0x32be08[_0x47e14e(0x12a)](_0x47e14e(0xd7)+_0x1feae8['companyId']+_0x47e14e(0x101),{'action':_0x47e14e(0xb4),'session':_0x1feae8}),(0x0,exports[_0x47e14e(0x11c)])(_0x25b100,![]);else{if(_0xbabfa9===baileys_1[_0x47e14e(0xb2)][_0x47e14e(0xad)]||_0xbabfa9===0x1f7)logger_1['logger'][_0x47e14e(0xbd)](_0x51fa61+'\x20restart\x20required\x20(503),\x20reconnecting\x20immediately...'),(0x0,exports[_0x47e14e(0x11c)])(_0x25b100,![])[_0x47e14e(0xfa)](()=>{setTimeout(async()=>{const _0xe7dc54=a298_0x3305;await _0x1feae8[_0xe7dc54(0x112)](),await(0x0,StartWhatsAppSession_1[_0xe7dc54(0xfe)])(_0x1feae8,_0x1feae8[_0xe7dc54(0xe9)]);},0x3e8);});else _0xbabfa9!==baileys_1[_0x47e14e(0xb2)][_0x47e14e(0xcd)]?(await _0x1feae8[_0x47e14e(0xb4)]({'status':_0x47e14e(0xc5)}),_0x32be08[_0x47e14e(0x12a)](_0x47e14e(0xd7)+_0x1feae8[_0x47e14e(0xe9)]+_0x47e14e(0x101),{'action':_0x47e14e(0xb4),'session':_0x1feae8}),(0x0,exports[_0x47e14e(0x11c)])(_0x25b100,![])[_0x47e14e(0xfa)](()=>{const _0x11b701=_0x47e14e;logger_1[_0x11b701(0xc8)][_0x11b701(0xbd)](_0x11b701(0x10b)+_0x51fa61+_0x11b701(0x10e)),setTimeout(async()=>{const _0x3eb361=_0x11b701;await _0x1feae8[_0x3eb361(0x112)](),await(0x0,StartWhatsAppSession_1[_0x3eb361(0xfe)])(_0x1feae8,_0x1feae8[_0x3eb361(0xe9)]);},0x7d0);})):(await _0x1feae8[_0x47e14e(0xb4)]({'status':'PENDING','session':''}),await(0x0,DeleteBaileysService_1[_0x47e14e(0xe1)])(_0x1feae8['id']),_0x32be08[_0x47e14e(0x12a)](_0x47e14e(0xd7)+_0x1feae8[_0x47e14e(0xe9)]+_0x47e14e(0x101),{'action':'update','session':_0x1feae8}),(0x0,exports[_0x47e14e(0x11c)])(_0x25b100,![])[_0x47e14e(0xfa)](()=>{const _0x100b85=_0x47e14e;logger_1['logger']['info'](_0x100b85(0x10b)+_0x51fa61+'\x20in\x202\x20seconds'),setTimeout(async()=>{const _0x5ae02b=_0x100b85;await _0x1feae8[_0x5ae02b(0x112)](),await(0x0,StartWhatsAppSession_1[_0x5ae02b(0xfe)])(_0x1feae8,_0x1feae8['companyId']);},0x7d0);}));}}if(_0x23be30==='open'){await _0x1feae8[_0x47e14e(0xb4)]({'status':_0x47e14e(0xe4),'qrcode':'','retries':0x0}),_0x32be08['emit'](_0x47e14e(0xd7)+_0x1feae8[_0x47e14e(0xe9)]+_0x47e14e(0x101),{'action':_0x47e14e(0xb4),'session':_0x1feae8});const _0x233456=sessions[_0x47e14e(0x11b)](_0x1b867a=>_0x1b867a['id']===_0x1feae8['id']);_0x233456===-0x1&&(_0x134561['id']=_0x1feae8['id'],sessions[_0x47e14e(0xbe)](_0x134561)),_0x48ee9c(_0x134561);}if(_0x241648!==undefined){if(retriesQrCodeMap[_0x47e14e(0x122)](_0x25b100)&&retriesQrCodeMap[_0x47e14e(0x122)](_0x25b100)>=0x3)await _0x19a24a[_0x47e14e(0xb4)]({'status':_0x47e14e(0xe7),'qrcode':''}),await(0x0,DeleteBaileysService_1['default'])(_0x19a24a['id']),_0x32be08[_0x47e14e(0x12a)](_0x47e14e(0xf4),{'action':_0x47e14e(0xb4),'session':_0x19a24a}),_0x134561['ev'][_0x47e14e(0x103)](_0x47e14e(0x12b)),_0x134561['ws'][_0x47e14e(0xf7)](),_0x134561=null,retriesQrCodeMap[_0x47e14e(0x120)](_0x25b100);else{logger_1['logger'][_0x47e14e(0xbd)](_0x47e14e(0xec)+_0x51fa61),retriesQrCodeMap[_0x47e14e(0xf9)](_0x25b100,_0x5b2a00+=0x1),await _0x1feae8[_0x47e14e(0xb4)]({'qrcode':_0x241648,'status':_0x47e14e(0x10d),'retries':0x0});const _0xb96c65=sessions[_0x47e14e(0x11b)](_0xbfe91f=>_0xbfe91f['id']===_0x1feae8['id']);_0xb96c65===-0x1&&(_0x134561['id']=_0x1feae8['id'],sessions['push'](_0x134561)),_0x32be08[_0x47e14e(0x12a)](_0x47e14e(0xd7)+_0x1feae8[_0x47e14e(0xe9)]+'-whatsappSession',{'action':_0x47e14e(0xb4),'session':_0x1feae8});}}}),_0x134561['ev']['on']('creds.update',_0x121c9c),_0x134561['ev']['on']('presence.update',async({id:_0x479617,presences:_0x50d05a})=>{const _0x47e863=_0x470fe8;try{const _0x326f10=_0x50d05a[_0x479617]?.[_0x47e863(0xf8)];if(!_0x326f10){logger_1[_0x47e863(0xc8)][_0x47e863(0x100)](_0x47e863(0x116));return;}const _0x29f70d=(0x0,ExtractPhoneNumber_1[_0x47e863(0xd0)])(_0x479617),_0x15d48d=await Contact_1[_0x47e863(0xe1)][_0x47e863(0xf6)]({'where':{'number':_0x29f70d,'companyId':_0x1feae8['companyId']}});if(!_0x15d48d){logger_1[_0x47e863(0xc8)][_0x47e863(0x100)](_0x47e863(0xed)+_0x479617);return;}logger_1[_0x47e863(0xc8)][_0x47e863(0x100)](_0x47e863(0xc4)+_0x15d48d['id']+_0x47e863(0x106)+_0x479617);const _0xc41358=await Ticket_1[_0x47e863(0xe1)][_0x47e863(0xf6)]({'where':{'contactId':_0x15d48d['id'],'whatsappId':_0x1feae8['id'],'status':{[sequelize_1['Op']['or']]:[_0x47e863(0xb7),_0x47e863(0xab)]}}});if(!_0xc41358){logger_1[_0x47e863(0xc8)][_0x47e863(0x100)](_0x47e863(0x10a)+_0x15d48d['id']);return;}const _0x41084a=(0x0,socket_1[_0x47e863(0xca)])();_0x41084a['to'](_0xc41358['id'][_0x47e863(0x108)]())['to'](_0x47e863(0xd7)+_0x1feae8['companyId']+'-'+_0xc41358[_0x47e863(0xb1)])['to'](_0x47e863(0xd4)+_0xc41358[_0x47e863(0xfb)]+'-'+_0xc41358[_0x47e863(0xb1)])[_0x47e863(0x12a)]('company-'+_0x1feae8[_0x47e863(0xe9)]+_0x47e863(0xb9),{'ticketId':_0xc41358['id'],'presence':_0x326f10});}catch(_0x481696){logger_1[_0x47e863(0xc8)][_0x47e863(0x104)](_0x47e863(0x126)+_0x481696[_0x47e863(0xf5)]),Sentry[_0x47e863(0x127)](_0x481696);}}),_0x134561['ev']['on'](_0x470fe8(0x10f),_0x32fa42=>{const _0x51de74=_0x470fe8;logger_1['logger'][_0x51de74(0x100)]('Received\x20new\x20group'),_0x32fa42['forEach'](_0x38f707=>{const _0x3e9fc6=_0x51de74;_0xbf6dfa[_0x3e9fc6(0xf9)](_0x38f707['id'],_0x38f707);});}),_0x134561['ev']['on'](_0x470fe8(0xa8),async([_0x39265d])=>{const _0xe635d7=_0x470fe8;logger_1[_0xe635d7(0xc8)][_0xe635d7(0x100)](_0xe635d7(0x10c));const _0x562890=await _0x134561[_0xe635d7(0xae)](_0x39265d['id']);_0xbf6dfa[_0xe635d7(0xf9)](_0x39265d['id'],_0x562890);}),_0x134561['ev']['on'](_0x470fe8(0x119),async _0x5836b1=>{const _0x54808e=_0x470fe8;logger_1['logger']['debug']('Received\x20group\x20participants\x20update');try{const _0x4ef71a=await _0x134561[_0x54808e(0xae)](_0x5836b1['id']);_0xbf6dfa['set'](_0x5836b1['id'],_0x4ef71a);}catch(_0xaec9cb){_0xbf6dfa[_0x54808e(0x11f)](_0x5836b1['id']);}});})());}catch(_0xca3aae){Sentry[_0x24f12c(0x127)](_0xca3aae),console[_0x24f12c(0xbf)](_0xca3aae),_0x3db4aa(_0xca3aae);}});};exports['initWASocket']=initWASocket;