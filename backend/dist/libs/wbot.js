'use strict';function a362_0x2139(_0x4e7d2a,_0x283450){const _0x258e46=a362_0x502f();return a362_0x2139=function(_0xd87334,_0x3e2efd){_0xd87334=_0xd87334-0xb9;let _0x502fed=_0x258e46[_0xd87334];return _0x502fed;},a362_0x2139(_0x4e7d2a,_0x283450);}const a362_0x219970=a362_0x2139;(function(_0x39018b,_0x386b87){const _0x2981d8=a362_0x2139,_0x30e238=_0x39018b();while(!![]){try{const _0x4d7562=parseInt(_0x2981d8(0x11d))/0x1+parseInt(_0x2981d8(0xf0))/0x2+parseInt(_0x2981d8(0xe6))/0x3+parseInt(_0x2981d8(0x132))/0x4*(parseInt(_0x2981d8(0xc7))/0x5)+parseInt(_0x2981d8(0xd8))/0x6+parseInt(_0x2981d8(0xe2))/0x7+-parseInt(_0x2981d8(0xc3))/0x8*(parseInt(_0x2981d8(0xc9))/0x9);if(_0x4d7562===_0x386b87)break;else _0x30e238['push'](_0x30e238['shift']());}catch(_0x41c1e5){_0x30e238['push'](_0x30e238['shift']());}}}(a362_0x502f,0x79dc2));var __createBinding=this&&this['__createBinding']||(Object[a362_0x219970(0xe7)]?function(_0x16b044,_0x5dfa4d,_0x3ca121,_0x23ef27){const _0x581d0b=a362_0x219970;if(_0x23ef27===undefined)_0x23ef27=_0x3ca121;var _0x4c35f2=Object[_0x581d0b(0x12d)](_0x5dfa4d,_0x3ca121);(!_0x4c35f2||(_0x581d0b(0x106)in _0x4c35f2?!_0x5dfa4d[_0x581d0b(0xdf)]:_0x4c35f2[_0x581d0b(0xf5)]||_0x4c35f2[_0x581d0b(0x10d)]))&&(_0x4c35f2={'enumerable':!![],'get':function(){return _0x5dfa4d[_0x3ca121];}}),Object[_0x581d0b(0xfc)](_0x16b044,_0x23ef27,_0x4c35f2);}:function(_0x1b4ede,_0x53d467,_0x1178cf,_0x4332cd){if(_0x4332cd===undefined)_0x4332cd=_0x1178cf;_0x1b4ede[_0x4332cd]=_0x53d467[_0x1178cf];}),__setModuleDefault=this&&this[a362_0x219970(0x100)]||(Object['create']?function(_0x47a1c5,_0x345f5a){const _0x47ba37=a362_0x219970;Object[_0x47ba37(0xfc)](_0x47a1c5,'default',{'enumerable':!![],'value':_0x345f5a});}:function(_0x528c9,_0x4cfcef){const _0x298910=a362_0x219970;_0x528c9[_0x298910(0xd7)]=_0x4cfcef;}),__importStar=this&&this['__importStar']||(function(){const _0x2b61a4=(function(){let _0x53c14a=!![];return function(_0x866a2,_0x5e6399){const _0x54b2f0=_0x53c14a?function(){const _0x1dea64=a362_0x2139;if(_0x5e6399){const _0xc3857d=_0x5e6399[_0x1dea64(0x121)](_0x866a2,arguments);return _0x5e6399=null,_0xc3857d;}}:function(){};return _0x53c14a=![],_0x54b2f0;};}()),_0x3f78da=_0x2b61a4(this,function(){const _0x435392=a362_0x2139;return _0x3f78da[_0x435392(0xe8)]()[_0x435392(0xbc)](_0x435392(0xb9))[_0x435392(0xe8)]()['constructor'](_0x3f78da)[_0x435392(0xbc)](_0x435392(0xb9));});_0x3f78da();var _0x5b8274=function(_0x234cae){const _0x57c262=a362_0x2139;return _0x5b8274=Object[_0x57c262(0x130)]||function(_0x4e68aa){const _0x47d25b=_0x57c262;var _0x25424d=[];for(var _0x1c3685 in _0x4e68aa)if(Object['prototype']['hasOwnProperty'][_0x47d25b(0x10e)](_0x4e68aa,_0x1c3685))_0x25424d[_0x25424d[_0x47d25b(0xda)]]=_0x1c3685;return _0x25424d;},_0x5b8274(_0x234cae);};return function(_0x40f771){const _0x6d59ea=a362_0x2139;if(_0x40f771&&_0x40f771[_0x6d59ea(0xdf)])return _0x40f771;var _0x4c05e6={};if(_0x40f771!=null){for(var _0x30ed7f=_0x5b8274(_0x40f771),_0x31a7bc=0x0;_0x31a7bc<_0x30ed7f[_0x6d59ea(0xda)];_0x31a7bc++)if(_0x30ed7f[_0x31a7bc]!=='default')__createBinding(_0x4c05e6,_0x40f771,_0x30ed7f[_0x31a7bc]);}return __setModuleDefault(_0x4c05e6,_0x40f771),_0x4c05e6;};}()),__importDefault=this&&this[a362_0x219970(0xd4)]||function(_0x140664){const _0x3300d3=a362_0x219970;return _0x140664&&_0x140664[_0x3300d3(0xdf)]?_0x140664:{'default':_0x140664};};Object['defineProperty'](exports,a362_0x219970(0xdf),{'value':!![]}),exports[a362_0x219970(0x128)]=exports['restartWbot']=exports[a362_0x219970(0x116)]=exports['getWbot']=void 0x0;const Sentry=__importStar(require('@sentry/node')),baileys_1=__importStar(require(a362_0x219970(0xbe))),node_cache_1=__importDefault(require('node-cache')),sequelize_1=require(a362_0x219970(0x11f)),Whatsapp_1=__importDefault(require(a362_0x219970(0x10f))),logger_1=require('../utils/logger'),authState_1=__importDefault(require('../helpers/authState')),AppError_1=__importDefault(require('../errors/AppError')),socket_1=require('./socket'),StartWhatsAppSession_1=require(a362_0x219970(0xed)),DeleteBaileysService_1=__importDefault(require(a362_0x219970(0xd2))),Contact_1=__importDefault(require(a362_0x219970(0xf3))),Ticket_1=__importDefault(require(a362_0x219970(0x115))),GetPublicSettingService_1=__importDefault(require(a362_0x219970(0xf1))),Message_1=__importDefault(require('../models/Message')),ExtractPhoneNumber_1=require(a362_0x219970(0xd3)),sessions=[],retriesQrCodeMap=new Map(),getWbot=_0x5dc908=>{const _0x21ac2a=a362_0x219970,_0x1a23ee=sessions[_0x21ac2a(0x131)](_0x5b0d6c=>_0x5b0d6c['id']===_0x5dc908);if(_0x1a23ee===-0x1)throw new AppError_1[(_0x21ac2a(0xd7))](_0x21ac2a(0xef));return sessions[_0x1a23ee];};exports[a362_0x219970(0x109)]=getWbot;const removeWbot=async(_0x5218dd,_0xa0c585=!![])=>{const _0x534e3f=a362_0x219970;try{const _0x16dd50=sessions[_0x534e3f(0x131)](_0x1b5bfe=>_0x1b5bfe['id']===_0x5218dd);_0x16dd50!==-0x1&&(_0xa0c585&&await sessions[_0x16dd50][_0x534e3f(0xdd)](),sessions[_0x16dd50]['ev'][_0x534e3f(0xd0)]('connection.update'),sessions[_0x16dd50]['ev'][_0x534e3f(0xd0)](_0x534e3f(0xf9)),sessions[_0x16dd50]['ev'][_0x534e3f(0xd0)](_0x534e3f(0xf6)),sessions[_0x16dd50]['ev'][_0x534e3f(0xd0)](_0x534e3f(0x101)),sessions[_0x16dd50]['ev'][_0x534e3f(0xd0)](_0x534e3f(0xea)),sessions[_0x16dd50]['ev'][_0x534e3f(0xd0)](_0x534e3f(0xd5)),sessions[_0x16dd50]['ev']['removeAllListeners'](_0x534e3f(0xec)),sessions[_0x16dd50][_0x534e3f(0x120)](null),sessions[_0x16dd50]['ws'][_0x534e3f(0xd0)](),await sessions[_0x16dd50]['ws'][_0x534e3f(0x12b)](),sessions['splice'](_0x16dd50,0x1));}catch(_0x273eca){logger_1[_0x534e3f(0x112)][_0x534e3f(0x10b)](_0x273eca);}};exports['removeWbot']=removeWbot;function a362_0x502f(){const _0x5c4ad4=['default','2156208EcmObD','qrcode','length','CONNECTED','10.0','logout','set','__esModule','then','No\x20active\x20ticket\x20found\x20for\x20contact\x20','489755YtNpRO','Ignoring\x20presence\x20from\x20possible\x20group','cacheMessage:\x20recovered\x20from\x20database','message','2920863SZfNqE','create','toString','BROWSER_CLIENT','groups.update','cacheMessage:\x20not\x20found\x20in\x20cache\x20-\x20fallback\x20to\x20database','contacts.upsert','../services/WbotServices/StartWhatsAppSession','key','ERR_WAPP_NOT_INITIALIZED','1391486wDVihs','../services/SettingServices/GetPublicSettingService','\x20for\x20number:\x20','../models/Contact','statusCode','writable','presence.update',',\x20isLatest:\x20','log','creds.update','Daumzap','Error\x20processing\x20presence\x20update:\x20','defineProperty','\x20set','del','Received\x20new\x20group','__setModuleDefault','groups.upsert','update','PENDING','restartWbot','emit','get','cacheMessage:\x20error\x20parsing\x20message\x20from\x20database\x20-\x20','\x20Connection\x20Update\x20','getWbot','-whatsappSession','error','fromMe','configurable','call','../models/Whatsapp','status','groupMetadata','logger','split','parse','../models/Ticket','removeWbot','forEach','\x20in\x202\x20seconds','groupCache.get\x20','\x20not\x20found','queueId','DisconnectReason','328253qsyHfx','cacheMessage:\x20saved','sequelize','end','apply','output','delete','flushAll','Contact\x20not\x20found\x20for\x20','whatsappSession','getIO','initWASocket','push','connection.update','close','map','getOwnPropertyDescriptor','loggedOut','CONFIG_SESSION_WA_CONNECTION','getOwnPropertyNames','findIndex','5636JKFVBz','makeCacheableSignalKeyStore','Received\x20group\x20participants\x20update','replace','stable','company-','StartWhatsAppSession','Erro\x20ao\x20obter\x20versionWA:','env','debug','Session\x20QRCode\x20Generate\x20','(((.+)+)+)+$','info','groupCache.del\x20','search','groupCache.set\x20','@whiskeysockets/baileys','open','findOne','Erro\x20ao\x20inicializar\x20waVersion:','groupCache.flushAll','32kGYvmt','DISCONNECTED','companyId','captureException','940GyzKPl','user','4933584QuFZSf','using\x20WA\x20v','Reconnecting\x20','Starting\x20session\x20','isLegacy:\x20','BROWSER_VERSION','cacheMessage','removeAllListeners','reload','../services/BaileysServices/DeleteBaileysService','../helpers/ExtractPhoneNumber','__importDefault','group-participants.update','Formato\x20invÃ¡lido\x20para\x20versionWA.\x20Esperado:\x200.0000.0000000000'];a362_0x502f=function(){return _0x5c4ad4;};return a362_0x502f();}const getVersionWA=async()=>{const _0x106ca3=a362_0x219970;try{const _0x1fa2c1='versionWA',_0x3a0f2e=0x1,_0x2a3d10=await(0x0,GetPublicSettingService_1['default'])({'key':_0x1fa2c1,'companyId':_0x3a0f2e});return _0x2a3d10||process[_0x106ca3(0x13a)]['CONFIG_SESSION_WA_CONNECTION'];}catch(_0x1baf8a){return console[_0x106ca3(0x10b)](_0x106ca3(0x139),_0x1baf8a),process[_0x106ca3(0x13a)][_0x106ca3(0x12f)];}},restartWbot=async(_0xf4a911,_0xe7ff55)=>{const _0x1d38ce=a362_0x219970;try{const _0x4e0ead={'where':{'companyId':_0xf4a911},'attributes':['id']},_0x4e354c=await Whatsapp_1[_0x1d38ce(0xd7)]['findAll'](_0x4e0ead);_0x4e354c['map'](async _0x1cc175=>{const _0x51a447=_0x1d38ce,_0x4fa2a9=sessions['findIndex'](_0x2f0d39=>_0x2f0d39['id']===_0x1cc175['id']);_0x4fa2a9!==-0x1&&sessions[_0x4fa2a9]['ws'][_0x51a447(0x12b)]();});}catch(_0x114d6e){logger_1[_0x1d38ce(0x112)][_0x1d38ce(0x10b)](_0x114d6e);}};exports[a362_0x219970(0x104)]=restartWbot;const initWASocket=async(_0x178914,_0x165e7a)=>{return new Promise((_0x216324,_0x293794)=>{const _0x191916=a362_0x2139;try{((async()=>{const _0x55ef13=a362_0x2139,_0x3febb9=(0x0,socket_1['getIO'])(),_0x7e853=await Whatsapp_1['default'][_0x55ef13(0xc0)]({'where':{'id':_0x178914['id']}});if(!_0x7e853)return;const {id:_0x1c078e,name:_0x1fa906,provider:_0x919b4f}=_0x7e853;let _0xa4e3c3;const _0x31c7ae=_0x919b4f===_0x55ef13(0x136);try{_0xa4e3c3=await getVersionWA(),logger_1[_0x55ef13(0x112)]['info']('Using\x20WA\x20v'+_0xa4e3c3+_0x55ef13(0xf7)+_0x31c7ae);}catch(_0x152de1){console[_0x55ef13(0x10b)](_0x55ef13(0xc1),_0x152de1);}const _0x102f9b=_0xa4e3c3[_0x55ef13(0x113)]('.');if(_0x102f9b['length']!==0x3)throw new Error(_0x55ef13(0xd6));const [_0x27fccd,_0x240cb5,_0x5f337a]=_0x102f9b[_0x55ef13(0x12c)](Number);logger_1[_0x55ef13(0x112)][_0x55ef13(0xba)](_0x55ef13(0xca)+_0xa4e3c3),logger_1[_0x55ef13(0x112)][_0x55ef13(0xba)](_0x55ef13(0xcd)+_0x31c7ae),logger_1['logger']['info'](_0x55ef13(0xcc)+_0x1fa906);let _0x542824=0x0,_0x1abebb=null;const _0x213b8c=new node_cache_1[(_0x55ef13(0xd7))]({'stdTTL':0x78,'checkperiod':0x1e,'useClones':![]});async function _0x33ae7b(_0x3344fc){const _0xe1777c=_0x55ef13;if(!_0x3344fc['id'])return null;const _0x3b463b=_0x213b8c[_0xe1777c(0x106)](_0x3344fc['id']);if(_0x3b463b)return logger_1['logger'][_0xe1777c(0x13b)]({'message':_0x3b463b},'cacheMessage:\x20recovered\x20from\x20cache'),_0x3b463b;logger_1['logger'][_0xe1777c(0x13b)]({'key':_0x3344fc},_0xe1777c(0xeb));const _0x58071e=await Message_1['default']['findOne']({'where':{'id':_0x3344fc['id'],'fromMe':!![]}});try{const _0x49034a=JSON[_0xe1777c(0x114)](_0x58071e['dataJson']);return logger_1[_0xe1777c(0x112)][_0xe1777c(0x13b)]({'key':_0x3344fc,'data':_0x49034a},_0xe1777c(0xe4)),_0x213b8c[_0xe1777c(0xde)](_0x3344fc['id'],_0x49034a[_0xe1777c(0xe5)]),_0x49034a[_0xe1777c(0xe5)]||undefined;}catch(_0x50d2db){logger_1[_0xe1777c(0x112)]['error']({'key':_0x3344fc},_0xe1777c(0x107)+_0x50d2db['message']);}return undefined;}const {state:_0x19cebe,saveState:_0x4f2946}=await(0x0,authState_1[_0x55ef13(0xd7)])(_0x178914),_0x5608e8=new node_cache_1['default'](),_0x519c76=new node_cache_1[(_0x55ef13(0xd7))](),_0x2a6eee=new node_cache_1[(_0x55ef13(0xd7))]({'stdTTL':0x5*0x3c,'useClones':![]}),_0x2223b2={'get':_0x1ee572=>{const _0x37d34f=_0x55ef13;logger_1['logger'][_0x37d34f(0x13b)]('groupCache.get\x20'+_0x1ee572);const _0x129961=_0x2a6eee['get'](_0x1ee572);return!_0x129961&&(logger_1[_0x37d34f(0x112)][_0x37d34f(0x13b)](_0x37d34f(0x119)+_0x1ee572+_0x37d34f(0x11a)),_0x1abebb[_0x37d34f(0x111)](_0x1ee572)[_0x37d34f(0xe0)](async _0x5ee381=>{const _0xf0d35f=_0x37d34f;logger_1['logger']['debug']({'key':_0x1ee572,'metadata':_0x5ee381},_0xf0d35f(0x119)+_0x1ee572+_0xf0d35f(0xfd)),_0x2a6eee[_0xf0d35f(0xde)](_0x1ee572,_0x5ee381);})),_0x129961;},'set':(_0x20b582,_0x4f0477)=>{const _0x313c09=_0x55ef13;return logger_1['logger']['debug']({'key':_0x20b582,'value':_0x4f0477},_0x313c09(0xbd)+_0x20b582),_0x2a6eee[_0x313c09(0xde)](_0x20b582,_0x4f0477);},'del':_0x25142a=>{const _0x4d2002=_0x55ef13;return logger_1['logger'][_0x4d2002(0x13b)](_0x4d2002(0xbb)+_0x25142a),_0x2a6eee[_0x4d2002(0xfe)](_0x25142a);},'flushAll':()=>{const _0x20ea11=_0x55ef13;return logger_1[_0x20ea11(0x112)]['debug'](_0x20ea11(0xc2)),_0x2a6eee[_0x20ea11(0x124)]();}};_0x1abebb=(0x0,baileys_1[_0x55ef13(0xd7)])({'logger':logger_1['loggerBaileys'],'printQRInTerminal':![],'browser':[process['env'][_0x55ef13(0xe9)]||_0x55ef13(0xfa),process[_0x55ef13(0x13a)]['BROWSER_NAME']||'Chrome',process[_0x55ef13(0x13a)][_0x55ef13(0xce)]||_0x55ef13(0xdc)],'auth':{'creds':_0x19cebe['creds'],'keys':(0x0,baileys_1[_0x55ef13(0x133)])(_0x19cebe['keys'],logger_1['loggerBaileys'])},'version':[_0x27fccd,_0x240cb5,_0x5f337a],'defaultQueryTimeoutMs':0xea60,'msgRetryCounterCache':_0x5608e8,'generateHighQualityLinkPreview':!![],'userDevicesCache':_0x519c76,'getMessage':_0x33ae7b,'agent':_0x165e7a,'fetchAgent':_0x165e7a,'transactionOpts':{'maxCommitRetries':0x1,'delayBetweenTriesMs':0xa}}),_0x1abebb[_0x55ef13(0xcf)]=_0x51bf07=>{const _0x19abd3=_0x55ef13;if(!_0x51bf07[_0x19abd3(0xee)][_0x19abd3(0x10c)])return;logger_1[_0x19abd3(0x112)]['debug']({'message':_0x51bf07[_0x19abd3(0xe5)]},_0x19abd3(0x11e)),_0x213b8c[_0x19abd3(0xde)](_0x51bf07['key']['id'],_0x51bf07[_0x19abd3(0xe5)]);},_0x1abebb['ev']['on']('connection.update',async({connection:_0x4be7bc,lastDisconnect:_0x46af1e,qr:_0x22326a})=>{const _0x35dec0=_0x55ef13;logger_1[_0x35dec0(0x112)][_0x35dec0(0xba)]({'lastDisconnect':_0x46af1e},'Socket\x20\x20'+_0x1fa906+_0x35dec0(0x108)+(_0x4be7bc||''));if(_0x4be7bc===_0x35dec0(0x12b)){const _0x5d9c4b=_0x46af1e?.[_0x35dec0(0x10b)]?.[_0x35dec0(0x122)]?.[_0x35dec0(0xf4)];if(_0x5d9c4b===0x193)await _0x178914['update']({'status':_0x35dec0(0x103),'session':''}),await(0x0,DeleteBaileysService_1[_0x35dec0(0xd7)])(_0x178914['id']),_0x3febb9[_0x35dec0(0x105)](_0x35dec0(0x137)+_0x178914['companyId']+'-whatsappSession',{'action':_0x35dec0(0x102),'session':_0x178914}),(0x0,exports[_0x35dec0(0x116)])(_0x1c078e,![]);else{if(_0x5d9c4b===baileys_1['DisconnectReason']['restartRequired']||_0x5d9c4b===0x1f7)logger_1[_0x35dec0(0x112)][_0x35dec0(0xba)](_0x1fa906+'\x20restart\x20required\x20(503),\x20reconnecting\x20immediately...'),(0x0,exports[_0x35dec0(0x116)])(_0x1c078e,![])[_0x35dec0(0xe0)](()=>{setTimeout(async()=>{const _0x20902b=a362_0x2139;await _0x178914[_0x20902b(0xd1)](),await(0x0,StartWhatsAppSession_1[_0x20902b(0x138)])(_0x178914,_0x178914[_0x20902b(0xc5)]);},0x3e8);});else _0x5d9c4b!==baileys_1[_0x35dec0(0x11c)][_0x35dec0(0x12e)]?(await _0x178914[_0x35dec0(0x102)]({'status':'PENDING'}),_0x3febb9[_0x35dec0(0x105)](_0x35dec0(0x137)+_0x178914['companyId']+_0x35dec0(0x10a),{'action':_0x35dec0(0x102),'session':_0x178914}),(0x0,exports[_0x35dec0(0x116)])(_0x1c078e,![])[_0x35dec0(0xe0)](()=>{const _0x2b6054=_0x35dec0;logger_1['logger'][_0x2b6054(0xba)]('Reconnecting\x20'+_0x1fa906+_0x2b6054(0x118)),setTimeout(async()=>{const _0x1393b5=_0x2b6054;await _0x178914[_0x1393b5(0xd1)](),await(0x0,StartWhatsAppSession_1[_0x1393b5(0x138)])(_0x178914,_0x178914[_0x1393b5(0xc5)]);},0x7d0);})):(await _0x178914[_0x35dec0(0x102)]({'status':_0x35dec0(0x103),'session':''}),await(0x0,DeleteBaileysService_1[_0x35dec0(0xd7)])(_0x178914['id']),_0x3febb9['emit'](_0x35dec0(0x137)+_0x178914[_0x35dec0(0xc5)]+_0x35dec0(0x10a),{'action':_0x35dec0(0x102),'session':_0x178914}),(0x0,exports['removeWbot'])(_0x1c078e,![])['then'](()=>{const _0x28ad79=_0x35dec0;logger_1[_0x28ad79(0x112)][_0x28ad79(0xba)](_0x28ad79(0xcb)+_0x1fa906+_0x28ad79(0x118)),setTimeout(async()=>{const _0x108d4f=_0x28ad79;await _0x178914[_0x108d4f(0xd1)](),await(0x0,StartWhatsAppSession_1[_0x108d4f(0x138)])(_0x178914,_0x178914[_0x108d4f(0xc5)]);},0x7d0);}));}}if(_0x4be7bc==='open'){await _0x178914[_0x35dec0(0x102)]({'status':_0x35dec0(0xdb),'qrcode':'','retries':0x0,'number':_0x1abebb[_0x35dec0(0xc8)]?.['id']?.[_0x35dec0(0x135)](/:\d+/,'')}),_0x3febb9[_0x35dec0(0x105)]('company-'+_0x178914[_0x35dec0(0xc5)]+_0x35dec0(0x10a),{'action':_0x35dec0(0x102),'session':_0x178914});const _0x46ed09=sessions[_0x35dec0(0x131)](_0x3c81d4=>_0x3c81d4['id']===_0x178914['id']);_0x46ed09===-0x1&&(_0x1abebb['id']=_0x178914['id'],sessions[_0x35dec0(0x129)](_0x1abebb)),_0x216324(_0x1abebb);}if(_0x22326a!==undefined){if(retriesQrCodeMap[_0x35dec0(0x106)](_0x1c078e)&&retriesQrCodeMap[_0x35dec0(0x106)](_0x1c078e)>=0x3)await _0x7e853[_0x35dec0(0x102)]({'status':_0x35dec0(0xc4),'qrcode':''}),await(0x0,DeleteBaileysService_1['default'])(_0x7e853['id']),_0x3febb9[_0x35dec0(0x105)](_0x35dec0(0x126),{'action':_0x35dec0(0x102),'session':_0x7e853}),_0x1abebb['ev'][_0x35dec0(0xd0)](_0x35dec0(0x12a)),_0x1abebb['ws']['close'](),_0x1abebb=null,retriesQrCodeMap[_0x35dec0(0x123)](_0x1c078e);else{logger_1[_0x35dec0(0x112)]['info'](_0x35dec0(0x13c)+_0x1fa906),retriesQrCodeMap[_0x35dec0(0xde)](_0x1c078e,_0x542824+=0x1),await _0x178914[_0x35dec0(0x102)]({'qrcode':_0x22326a,'status':_0x35dec0(0xd9),'retries':0x0});const _0x503222=sessions[_0x35dec0(0x131)](_0x11206f=>_0x11206f['id']===_0x178914['id']);_0x503222===-0x1&&(_0x1abebb['id']=_0x178914['id'],sessions['push'](_0x1abebb)),_0x3febb9['emit']('company-'+_0x178914[_0x35dec0(0xc5)]+_0x35dec0(0x10a),{'action':_0x35dec0(0x102),'session':_0x178914});}}}),_0x1abebb['ev']['on'](_0x55ef13(0xf9),_0x4f2946),_0x1abebb['ev']['on']('presence.update',async({id:_0x4c3e0a,presences:_0x217e86})=>{const _0x4f6952=_0x55ef13;try{const _0x4a6b6f=_0x217e86[_0x4c3e0a]?.['lastKnownPresence'];if(!_0x4a6b6f){logger_1[_0x4f6952(0x112)]['debug'](_0x4f6952(0xe3));return;}const _0x4c798f=(0x0,ExtractPhoneNumber_1['getPhoneNumberFromJid'])(_0x4c3e0a),_0x14066e=await Contact_1[_0x4f6952(0xd7)][_0x4f6952(0xc0)]({'where':{'number':_0x4c798f,'companyId':_0x178914[_0x4f6952(0xc5)]}});if(!_0x14066e){logger_1[_0x4f6952(0x112)][_0x4f6952(0x13b)](_0x4f6952(0x125)+_0x4c3e0a);return;}logger_1[_0x4f6952(0x112)][_0x4f6952(0x13b)]('Found\x20contact\x20ID:\x20'+_0x14066e['id']+_0x4f6952(0xf2)+_0x4c3e0a);const _0x2ca411=await Ticket_1[_0x4f6952(0xd7)]['findOne']({'where':{'contactId':_0x14066e['id'],'whatsappId':_0x178914['id'],'status':{[sequelize_1['Op']['or']]:[_0x4f6952(0xbf),'pending']}}});if(!_0x2ca411){logger_1[_0x4f6952(0x112)][_0x4f6952(0x13b)](_0x4f6952(0xe1)+_0x14066e['id']);return;}const _0x1fa8b3=(0x0,socket_1[_0x4f6952(0x127)])();_0x1fa8b3['to'](_0x2ca411['id'][_0x4f6952(0xe8)]())['to']('company-'+_0x178914[_0x4f6952(0xc5)]+'-'+_0x2ca411['status'])['to']('queue-'+_0x2ca411[_0x4f6952(0x11b)]+'-'+_0x2ca411[_0x4f6952(0x110)])[_0x4f6952(0x105)](_0x4f6952(0x137)+_0x178914[_0x4f6952(0xc5)]+'-presence',{'ticketId':_0x2ca411['id'],'presence':_0x4a6b6f});}catch(_0x1d6325){logger_1['logger'][_0x4f6952(0x10b)](_0x4f6952(0xfb)+_0x1d6325['message']),Sentry[_0x4f6952(0xc6)](_0x1d6325);}}),_0x1abebb['ev']['on'](_0x55ef13(0x101),_0x4dc716=>{const _0x37a4e6=_0x55ef13;logger_1['logger'][_0x37a4e6(0x13b)](_0x37a4e6(0xff)),_0x4dc716[_0x37a4e6(0x117)](_0x12ce66=>{const _0x11b10a=_0x37a4e6;_0x2223b2[_0x11b10a(0xde)](_0x12ce66['id'],_0x12ce66);});}),_0x1abebb['ev']['on'](_0x55ef13(0xea),async([_0x1f5b3b])=>{const _0x5d2a7b=_0x55ef13;logger_1[_0x5d2a7b(0x112)][_0x5d2a7b(0x13b)]('Received\x20group\x20update');const _0x88c8d6=await _0x1abebb[_0x5d2a7b(0x111)](_0x1f5b3b['id']);_0x2223b2[_0x5d2a7b(0xde)](_0x1f5b3b['id'],_0x88c8d6);}),_0x1abebb['ev']['on'](_0x55ef13(0xd5),async _0x4e1c25=>{const _0x51cecc=_0x55ef13;logger_1[_0x51cecc(0x112)][_0x51cecc(0x13b)](_0x51cecc(0x134));try{const _0x3f85f4=await _0x1abebb[_0x51cecc(0x111)](_0x4e1c25['id']);_0x2223b2[_0x51cecc(0xde)](_0x4e1c25['id'],_0x3f85f4);}catch(_0x4ba884){_0x2223b2[_0x51cecc(0xfe)](_0x4e1c25['id']);}});})());}catch(_0x44de64){Sentry[_0x191916(0xc6)](_0x44de64),console[_0x191916(0xf8)](_0x44de64),_0x293794(_0x44de64);}});};exports['initWASocket']=initWASocket;