'use strict';const a295_0x47beca=a295_0x1a36;(function(_0x5effcc,_0x4c49b1){const _0x279f36=a295_0x1a36,_0x37a42b=_0x5effcc();while(!![]){try{const _0x527f28=parseInt(_0x279f36(0x22e))/0x1*(-parseInt(_0x279f36(0x223))/0x2)+-parseInt(_0x279f36(0x200))/0x3+-parseInt(_0x279f36(0x215))/0x4+-parseInt(_0x279f36(0x226))/0x5+-parseInt(_0x279f36(0x203))/0x6+-parseInt(_0x279f36(0x21b))/0x7*(-parseInt(_0x279f36(0x265))/0x8)+-parseInt(_0x279f36(0x1ed))/0x9*(-parseInt(_0x279f36(0x25b))/0xa);if(_0x527f28===_0x4c49b1)break;else _0x37a42b['push'](_0x37a42b['shift']());}catch(_0x126c49){_0x37a42b['push'](_0x37a42b['shift']());}}}(a295_0x4824,0x3f864));function a295_0x4824(){const _0x568583=['update','split','10.0','10249740WzFsuC','flushAll','creds','\x20for\x20number:\x20','group-participants.update','Received\x20group\x20participants\x20update','cacheMessage','Starting\x20session\x20','-presence','groupCache.del\x20','18904bIdwOd','companyId','isJidBroadcast','\x20Connection\x20Update\x20','lastKnownPresence','DISCONNECTED','configurable','findAll','loggedOut','constructor','PENDING','../services/SettingServices/GetPublicSettingService','qrcode','open','./socket','logger','__esModule','key','presence.update','info','dataJson','writable','BROWSER_NAME','groupCache.set\x20','logout','9xHNIZE','Formato\x20inv√°lido\x20para\x20versionWA.\x20Esperado:\x200.0000.0000000000','(((.+)+)+)+$','../helpers/authState','Erro\x20ao\x20obter\x20versionWA:','hasOwnProperty','apply','restartWbot','Reconnecting\x20','length','DisconnectReason','BROWSER_CLIENT','getIO','__setModuleDefault','debug','../services/BaileysServices/DeleteBaileysService','Received\x20group\x20update','../errors/AppError','groupCache.flushAll','330825SzbiXl','cacheMessage:\x20saved','create','1051218llKdBN','whatsappSession','end','groups.upsert','then','stable','groups.update','queue-','delete','StartWhatsAppSession','output','groupMetadata','@whiskeysockets/baileys','statusCode','Ignoring\x20presence\x20from\x20possible\x20group','Erro\x20ao\x20inicializar\x20waVersion:','default','getWbot','1283600PtuTok','get','CONNECTED','Contact\x20not\x20found\x20for\x20','emit','\x20in\x202\x20seconds','1064pZyoGc','connection.update','message','BROWSER_VERSION','env','groupCache.get\x20','-whatsappSession','log','2740lIwoBz','Using\x20WA\x20v','removeWbot','964430SSGvzN','Daumzap','getOwnPropertyDescriptor','initWASocket','node-cache','prototype','Chrome','isLegacy:\x20','237AAONKX','findIndex','error','removeAllListeners','findOne','fromMe','Found\x20contact\x20ID:\x20','endsWith','map','company-','status','@sentry/node','cacheMessage:\x20error\x20parsing\x20message\x20from\x20database\x20-\x20','__createBinding','defineProperty','push','loggerBaileys','cacheMessage:\x20recovered\x20from\x20cache','toString','@newsletter','call','\x20not\x20found','del','set','CONFIG_SESSION_WA_CONNECTION','__importStar','search','captureException','getOwnPropertyNames','Socket\x20\x20','Session\x20QRCode\x20Generate\x20','creds.update','../models/Message','close','keys',',\x20isLatest:\x20','forEach','replace','No\x20active\x20ticket\x20found\x20for\x20contact\x20','using\x20WA\x20v','pending','../services/WbotServices/StartWhatsAppSession'];a295_0x4824=function(){return _0x568583;};return a295_0x4824();}var __createBinding=this&&this[a295_0x47beca(0x23b)]||(Object[a295_0x47beca(0x202)]?function(_0xe8951c,_0x2c0064,_0x30675b,_0x2dc89f){const _0x392045=a295_0x47beca;if(_0x2dc89f===undefined)_0x2dc89f=_0x30675b;var _0x150b60=Object[_0x392045(0x228)](_0x2c0064,_0x30675b);(!_0x150b60||(_0x392045(0x216)in _0x150b60?!_0x2c0064[_0x392045(0x1e4)]:_0x150b60[_0x392045(0x1e9)]||_0x150b60[_0x392045(0x26b)]))&&(_0x150b60={'enumerable':!![],'get':function(){return _0x2c0064[_0x30675b];}}),Object['defineProperty'](_0xe8951c,_0x2dc89f,_0x150b60);}:function(_0x393964,_0x3e6f8c,_0x450611,_0x420969){if(_0x420969===undefined)_0x420969=_0x450611;_0x393964[_0x420969]=_0x3e6f8c[_0x450611];}),__setModuleDefault=this&&this[a295_0x47beca(0x1fa)]||(Object[a295_0x47beca(0x202)]?function(_0x2a7213,_0x388076){const _0x56eef6=a295_0x47beca;Object[_0x56eef6(0x23c)](_0x2a7213,'default',{'enumerable':!![],'value':_0x388076});}:function(_0x211394,_0x1432ca){_0x211394['default']=_0x1432ca;}),__importStar=this&&this[a295_0x47beca(0x247)]||(function(){const _0x47c390=(function(){let _0x433b11=!![];return function(_0x4e208c,_0x25ed3c){const _0x461926=_0x433b11?function(){const _0x468d1d=a295_0x1a36;if(_0x25ed3c){const _0x15010c=_0x25ed3c[_0x468d1d(0x1f3)](_0x4e208c,arguments);return _0x25ed3c=null,_0x15010c;}}:function(){};return _0x433b11=![],_0x461926;};}()),_0x275345=_0x47c390(this,function(){const _0x2a2840=a295_0x1a36;return _0x275345[_0x2a2840(0x240)]()['search'](_0x2a2840(0x1ef))[_0x2a2840(0x240)]()[_0x2a2840(0x26e)](_0x275345)[_0x2a2840(0x248)](_0x2a2840(0x1ef));});_0x275345();var _0x354f40=function(_0x48133e){const _0x2caf35=a295_0x1a36;return _0x354f40=Object[_0x2caf35(0x24a)]||function(_0x51fda8){const _0x2c8889=_0x2caf35;var _0x369ec1=[];for(var _0x2d07d7 in _0x51fda8)if(Object[_0x2c8889(0x22b)][_0x2c8889(0x1f2)][_0x2c8889(0x242)](_0x51fda8,_0x2d07d7))_0x369ec1[_0x369ec1[_0x2c8889(0x1f6)]]=_0x2d07d7;return _0x369ec1;},_0x354f40(_0x48133e);};return function(_0x5825c6){const _0x1cf4da=a295_0x1a36;if(_0x5825c6&&_0x5825c6['__esModule'])return _0x5825c6;var _0x35e8c3={};if(_0x5825c6!=null){for(var _0x57bac1=_0x354f40(_0x5825c6),_0x332450=0x0;_0x332450<_0x57bac1[_0x1cf4da(0x1f6)];_0x332450++)if(_0x57bac1[_0x332450]!==_0x1cf4da(0x213))__createBinding(_0x35e8c3,_0x5825c6,_0x57bac1[_0x332450]);}return __setModuleDefault(_0x35e8c3,_0x5825c6),_0x35e8c3;};}()),__importDefault=this&&this['__importDefault']||function(_0x560dc5){const _0x530ffb=a295_0x47beca;return _0x560dc5&&_0x560dc5[_0x530ffb(0x1e4)]?_0x560dc5:{'default':_0x560dc5};};Object['defineProperty'](exports,a295_0x47beca(0x1e4),{'value':!![]}),exports[a295_0x47beca(0x229)]=exports[a295_0x47beca(0x1f4)]=exports[a295_0x47beca(0x225)]=exports[a295_0x47beca(0x214)]=void 0x0;const Sentry=__importStar(require(a295_0x47beca(0x239))),baileys_1=__importStar(require(a295_0x47beca(0x20f))),node_cache_1=__importDefault(require(a295_0x47beca(0x22a))),sequelize_1=require('sequelize'),Whatsapp_1=__importDefault(require('../models/Whatsapp')),logger_1=require('../utils/logger'),authState_1=__importDefault(require(a295_0x47beca(0x1f0))),AppError_1=__importDefault(require(a295_0x47beca(0x1fe))),socket_1=require(a295_0x47beca(0x1e2)),StartWhatsAppSession_1=require(a295_0x47beca(0x257)),DeleteBaileysService_1=__importDefault(require(a295_0x47beca(0x1fc))),Contact_1=__importDefault(require('../models/Contact')),Ticket_1=__importDefault(require('../models/Ticket')),GetPublicSettingService_1=__importDefault(require(a295_0x47beca(0x1df))),Message_1=__importDefault(require(a295_0x47beca(0x24e))),sessions=[],retriesQrCodeMap=new Map(),getWbot=_0x115f3d=>{const _0x1607b5=a295_0x47beca,_0x180e7d=sessions[_0x1607b5(0x22f)](_0x576064=>_0x576064['id']===_0x115f3d);if(_0x180e7d===-0x1)throw new AppError_1[(_0x1607b5(0x213))]('ERR_WAPP_NOT_INITIALIZED');return sessions[_0x180e7d];};exports[a295_0x47beca(0x214)]=getWbot;const removeWbot=async(_0x5262cf,_0x4ce1f8=!![])=>{const _0x28ef00=a295_0x47beca;try{const _0x36e056=sessions[_0x28ef00(0x22f)](_0x411c93=>_0x411c93['id']===_0x5262cf);_0x36e056!==-0x1&&(_0x4ce1f8&&await sessions[_0x36e056][_0x28ef00(0x1ec)](),sessions[_0x36e056]['ev'][_0x28ef00(0x231)](_0x28ef00(0x21c)),sessions[_0x36e056]['ev'][_0x28ef00(0x231)](_0x28ef00(0x24d)),sessions[_0x36e056]['ev']['removeAllListeners'](_0x28ef00(0x1e6)),sessions[_0x36e056]['ev'][_0x28ef00(0x231)](_0x28ef00(0x206)),sessions[_0x36e056]['ev'][_0x28ef00(0x231)](_0x28ef00(0x209)),sessions[_0x36e056]['ev']['removeAllListeners'](_0x28ef00(0x25f)),sessions[_0x36e056]['ev'][_0x28ef00(0x231)]('contacts.upsert'),sessions[_0x36e056][_0x28ef00(0x205)](null),sessions[_0x36e056]['ws'][_0x28ef00(0x231)](),await sessions[_0x36e056]['ws'][_0x28ef00(0x24f)](),sessions['splice'](_0x36e056,0x1));}catch(_0x47819c){logger_1[_0x28ef00(0x1e3)][_0x28ef00(0x230)](_0x47819c);}};exports[a295_0x47beca(0x225)]=removeWbot;function a295_0x1a36(_0x132d61,_0x416d6a){const _0xb079a1=a295_0x4824();return a295_0x1a36=function(_0x2f8bc8,_0x22372a){_0x2f8bc8=_0x2f8bc8-0x1de;let _0x48245d=_0xb079a1[_0x2f8bc8];return _0x48245d;},a295_0x1a36(_0x132d61,_0x416d6a);}const getVersionWA=async()=>{const _0x489809=a295_0x47beca;try{const _0x3ddeb4='versionWA',_0x25a464=0x1,_0x982178=await(0x0,GetPublicSettingService_1[_0x489809(0x213)])({'key':_0x3ddeb4,'companyId':_0x25a464});return _0x982178||process[_0x489809(0x21f)][_0x489809(0x246)];}catch(_0x5db03b){return console[_0x489809(0x230)](_0x489809(0x1f1),_0x5db03b),process[_0x489809(0x21f)][_0x489809(0x246)];}},restartWbot=async(_0x459eb7,_0x4b3cfa)=>{const _0x530c9c=a295_0x47beca;try{const _0x1a288a={'where':{'companyId':_0x459eb7},'attributes':['id']},_0x53ccec=await Whatsapp_1[_0x530c9c(0x213)][_0x530c9c(0x26c)](_0x1a288a);_0x53ccec[_0x530c9c(0x236)](async _0x11490b=>{const _0x4364f6=_0x530c9c,_0x54529a=sessions[_0x4364f6(0x22f)](_0x3170a7=>_0x3170a7['id']===_0x11490b['id']);_0x54529a!==-0x1&&sessions[_0x54529a]['ws'][_0x4364f6(0x24f)]();});}catch(_0x361d82){logger_1[_0x530c9c(0x1e3)][_0x530c9c(0x230)](_0x361d82);}};exports['restartWbot']=restartWbot;const initWASocket=async(_0x1fb9d1,_0x2a8bfa)=>{return new Promise((_0x3e4e36,_0x1f3951)=>{const _0x5e2e65=a295_0x1a36;try{((async()=>{const _0x4a887d=a295_0x1a36,_0x220638=(0x0,socket_1[_0x4a887d(0x1f9)])(),_0x1ab900=await Whatsapp_1[_0x4a887d(0x213)][_0x4a887d(0x232)]({'where':{'id':_0x1fb9d1['id']}});if(!_0x1ab900)return;const {id:_0x170e88,name:_0x20cd5e,provider:_0x4b302b}=_0x1ab900;let _0x4f41f6;const _0x7ac4bf=_0x4b302b===_0x4a887d(0x208);try{_0x4f41f6=await getVersionWA(),logger_1[_0x4a887d(0x1e3)][_0x4a887d(0x1e7)](_0x4a887d(0x224)+_0x4f41f6+_0x4a887d(0x251)+_0x7ac4bf);}catch(_0x55e6a2){console[_0x4a887d(0x230)](_0x4a887d(0x212),_0x55e6a2);}const _0x4626e=_0x4f41f6[_0x4a887d(0x259)]('.');if(_0x4626e[_0x4a887d(0x1f6)]!==0x3)throw new Error(_0x4a887d(0x1ee));const [_0xe2864a,_0x11d039,_0x1e0aa6]=_0x4626e[_0x4a887d(0x236)](Number);logger_1[_0x4a887d(0x1e3)][_0x4a887d(0x1e7)](_0x4a887d(0x255)+_0x4f41f6),logger_1[_0x4a887d(0x1e3)]['info'](_0x4a887d(0x22d)+_0x7ac4bf),logger_1['logger'][_0x4a887d(0x1e7)](_0x4a887d(0x262)+_0x20cd5e);let _0x5310cf=0x0,_0x59bea8=null;const _0x101323=new node_cache_1[(_0x4a887d(0x213))]({'stdTTL':0x78,'checkperiod':0x1e,'useClones':![]});async function _0x128b73(_0x389977){const _0x2f3b1=_0x4a887d;if(!_0x389977['id'])return null;const _0x1a5049=_0x101323[_0x2f3b1(0x216)](_0x389977['id']);if(_0x1a5049)return logger_1[_0x2f3b1(0x1e3)][_0x2f3b1(0x1fb)]({'message':_0x1a5049},_0x2f3b1(0x23f)),_0x1a5049;logger_1['logger'][_0x2f3b1(0x1fb)]({'key':_0x389977},'cacheMessage:\x20not\x20found\x20in\x20cache\x20-\x20fallback\x20to\x20database');const _0x544bb0=await Message_1[_0x2f3b1(0x213)][_0x2f3b1(0x232)]({'where':{'id':_0x389977['id'],'fromMe':!![]}});try{const _0x242753=JSON['parse'](_0x544bb0[_0x2f3b1(0x1e8)]);return logger_1[_0x2f3b1(0x1e3)][_0x2f3b1(0x1fb)]({'key':_0x389977,'data':_0x242753},'cacheMessage:\x20recovered\x20from\x20database'),_0x101323['set'](_0x389977['id'],_0x242753[_0x2f3b1(0x21d)]),_0x242753[_0x2f3b1(0x21d)]||undefined;}catch(_0x12b64f){logger_1[_0x2f3b1(0x1e3)]['error']({'key':_0x389977},_0x2f3b1(0x23a)+_0x12b64f[_0x2f3b1(0x21d)]);}return undefined;}const {state:_0x39bdfc,saveState:_0x13d9e9}=await(0x0,authState_1['default'])(_0x1fb9d1),_0xa637f6=new node_cache_1[(_0x4a887d(0x213))](),_0x50fa7d=new node_cache_1[(_0x4a887d(0x213))](),_0x4d0071=new node_cache_1[(_0x4a887d(0x213))]({'stdTTL':0x5*0x3c,'useClones':![]}),_0x436d87={'get':_0x2c5b2f=>{const _0x473826=_0x4a887d;logger_1['logger']['debug'](_0x473826(0x220)+_0x2c5b2f);const _0x5c7370=_0x4d0071[_0x473826(0x216)](_0x2c5b2f);return!_0x5c7370&&(logger_1[_0x473826(0x1e3)]['debug'](_0x473826(0x220)+_0x2c5b2f+_0x473826(0x243)),_0x59bea8['groupMetadata'](_0x2c5b2f)['then'](async _0x4cf781=>{const _0x5f1a62=_0x473826;logger_1[_0x5f1a62(0x1e3)]['debug']({'key':_0x2c5b2f,'metadata':_0x4cf781},_0x5f1a62(0x220)+_0x2c5b2f+'\x20set'),_0x4d0071['set'](_0x2c5b2f,_0x4cf781);})),_0x5c7370;},'set':async(_0x22a1da,_0x81e9cb)=>{const _0x42a986=_0x4a887d;return logger_1['logger']['debug']({'key':_0x22a1da,'value':_0x81e9cb},_0x42a986(0x1eb)+_0x22a1da),_0x4d0071['set'](_0x22a1da,_0x81e9cb);},'del':async _0x1f4319=>{const _0x22ad4e=_0x4a887d;return logger_1[_0x22ad4e(0x1e3)]['debug'](_0x22ad4e(0x264)+_0x1f4319),_0x4d0071[_0x22ad4e(0x244)](_0x1f4319);},'flushAll':async()=>{const _0x140d79=_0x4a887d;return logger_1[_0x140d79(0x1e3)][_0x140d79(0x1fb)](_0x140d79(0x1ff)),_0x4d0071[_0x140d79(0x25c)]();}};_0x59bea8=(0x0,baileys_1['default'])({'logger':logger_1[_0x4a887d(0x23e)],'printQRInTerminal':![],'emitOwnEvents':![],'browser':[process['env'][_0x4a887d(0x1f8)]||_0x4a887d(0x227),process['env'][_0x4a887d(0x1ea)]||_0x4a887d(0x22c),process[_0x4a887d(0x21f)][_0x4a887d(0x21e)]||_0x4a887d(0x25a)],'auth':{'creds':_0x39bdfc[_0x4a887d(0x25d)],'keys':(0x0,baileys_1['makeCacheableSignalKeyStore'])(_0x39bdfc[_0x4a887d(0x250)],logger_1[_0x4a887d(0x23e)])},'version':[_0xe2864a,_0x11d039,_0x1e0aa6],'defaultQueryTimeoutMs':0xea60,'msgRetryCounterCache':_0xa637f6,'generateHighQualityLinkPreview':!![],'userDevicesCache':_0x50fa7d,'getMessage':_0x128b73,'agent':_0x2a8bfa,'fetchAgent':_0x2a8bfa,'cachedGroupMetadata':async _0x5e3b3e=>_0x436d87[_0x4a887d(0x216)](_0x5e3b3e),'shouldIgnoreJid':_0x557018=>(0x0,baileys_1[_0x4a887d(0x267)])(_0x557018)||_0x557018?.[_0x4a887d(0x235)](_0x4a887d(0x241)),'transactionOpts':{'maxCommitRetries':0x1,'delayBetweenTriesMs':0xa}}),_0x59bea8[_0x4a887d(0x261)]=_0x2b3958=>{const _0x48b6e6=_0x4a887d;if(!_0x2b3958[_0x48b6e6(0x1e5)][_0x48b6e6(0x233)])return;logger_1['logger'][_0x48b6e6(0x1fb)]({'message':_0x2b3958['message']},_0x48b6e6(0x201)),_0x101323[_0x48b6e6(0x245)](_0x2b3958[_0x48b6e6(0x1e5)]['id'],_0x2b3958['message']);},_0x59bea8['ev']['on'](_0x4a887d(0x21c),async({connection:_0x29a0fb,lastDisconnect:_0x485c82,qr:_0x2a45c6})=>{const _0x56f85c=_0x4a887d;logger_1[_0x56f85c(0x1e3)][_0x56f85c(0x1e7)]({'lastDisconnect':_0x485c82},_0x56f85c(0x24b)+_0x20cd5e+_0x56f85c(0x268)+(_0x29a0fb||''));_0x29a0fb==='close'&&(_0x485c82?.['error']?.[_0x56f85c(0x20d)]?.[_0x56f85c(0x210)]===0x193&&(await _0x1fb9d1[_0x56f85c(0x258)]({'status':_0x56f85c(0x1de),'session':''}),await(0x0,DeleteBaileysService_1['default'])(_0x1fb9d1['id']),_0x220638[_0x56f85c(0x219)](_0x56f85c(0x237)+_0x1fb9d1['companyId']+_0x56f85c(0x221),{'action':'update','session':_0x1fb9d1}),(0x0,exports[_0x56f85c(0x225)])(_0x170e88,![])),_0x485c82?.[_0x56f85c(0x230)]?.['output']?.[_0x56f85c(0x210)]!==baileys_1[_0x56f85c(0x1f7)][_0x56f85c(0x26d)]?(await _0x1fb9d1[_0x56f85c(0x258)]({'status':'PENDING'}),_0x220638['emit'](_0x56f85c(0x237)+_0x1fb9d1[_0x56f85c(0x266)]+'-whatsappSession',{'action':_0x56f85c(0x258),'session':_0x1fb9d1}),(0x0,exports[_0x56f85c(0x225)])(_0x170e88,![])[_0x56f85c(0x207)](()=>{const _0x143071=_0x56f85c;logger_1[_0x143071(0x1e3)]['info'](_0x143071(0x1f5)+_0x20cd5e+_0x143071(0x21a)),setTimeout(async()=>{const _0x4448d3=_0x143071;await _0x1fb9d1['reload'](),await(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x1fb9d1,_0x1fb9d1[_0x4448d3(0x266)]);},0x7d0);})):(await _0x1fb9d1[_0x56f85c(0x258)]({'status':_0x56f85c(0x1de),'session':''}),await(0x0,DeleteBaileysService_1[_0x56f85c(0x213)])(_0x1fb9d1['id']),_0x220638['emit']('company-'+_0x1fb9d1['companyId']+_0x56f85c(0x221),{'action':'update','session':_0x1fb9d1}),(0x0,exports[_0x56f85c(0x225)])(_0x170e88,![])[_0x56f85c(0x207)](()=>{const _0x561a7f=_0x56f85c;logger_1[_0x561a7f(0x1e3)]['info']('Reconnecting\x20'+_0x20cd5e+'\x20in\x202\x20seconds'),setTimeout(async()=>{const _0xb7e5a6=_0x561a7f;await _0x1fb9d1['reload'](),await(0x0,StartWhatsAppSession_1[_0xb7e5a6(0x20c)])(_0x1fb9d1,_0x1fb9d1[_0xb7e5a6(0x266)]);},0x7d0);})));if(_0x29a0fb===_0x56f85c(0x1e1)){await _0x1fb9d1[_0x56f85c(0x258)]({'status':_0x56f85c(0x217),'qrcode':'','retries':0x0}),_0x220638[_0x56f85c(0x219)](_0x56f85c(0x237)+_0x1fb9d1[_0x56f85c(0x266)]+_0x56f85c(0x221),{'action':_0x56f85c(0x258),'session':_0x1fb9d1});const _0xa77598=sessions[_0x56f85c(0x22f)](_0x3a5e50=>_0x3a5e50['id']===_0x1fb9d1['id']);_0xa77598===-0x1&&(_0x59bea8['id']=_0x1fb9d1['id'],sessions[_0x56f85c(0x23d)](_0x59bea8)),_0x3e4e36(_0x59bea8);}if(_0x2a45c6!==undefined){if(retriesQrCodeMap['get'](_0x170e88)&&retriesQrCodeMap['get'](_0x170e88)>=0x3)await _0x1ab900[_0x56f85c(0x258)]({'status':_0x56f85c(0x26a),'qrcode':''}),await(0x0,DeleteBaileysService_1['default'])(_0x1ab900['id']),_0x220638[_0x56f85c(0x219)](_0x56f85c(0x204),{'action':_0x56f85c(0x258),'session':_0x1ab900}),_0x59bea8['ev'][_0x56f85c(0x231)]('connection.update'),_0x59bea8['ws'][_0x56f85c(0x24f)](),_0x59bea8=null,retriesQrCodeMap[_0x56f85c(0x20b)](_0x170e88);else{logger_1[_0x56f85c(0x1e3)][_0x56f85c(0x1e7)](_0x56f85c(0x24c)+_0x20cd5e),retriesQrCodeMap['set'](_0x170e88,_0x5310cf+=0x1),await _0x1fb9d1[_0x56f85c(0x258)]({'qrcode':_0x2a45c6,'status':_0x56f85c(0x1e0),'retries':0x0});const _0x19f9e9=sessions[_0x56f85c(0x22f)](_0x258e41=>_0x258e41['id']===_0x1fb9d1['id']);_0x19f9e9===-0x1&&(_0x59bea8['id']=_0x1fb9d1['id'],sessions[_0x56f85c(0x23d)](_0x59bea8)),_0x220638[_0x56f85c(0x219)](_0x56f85c(0x237)+_0x1fb9d1[_0x56f85c(0x266)]+_0x56f85c(0x221),{'action':_0x56f85c(0x258),'session':_0x1fb9d1});}}}),_0x59bea8['ev']['on'](_0x4a887d(0x24d),_0x13d9e9),_0x59bea8['ev']['on']('presence.update',async({id:_0x5089dc,presences:_0x22a680})=>{const _0x7a3783=_0x4a887d;try{const _0x1459e5=_0x22a680[_0x5089dc]?.[_0x7a3783(0x269)];if(!_0x1459e5){logger_1['logger'][_0x7a3783(0x1fb)](_0x7a3783(0x211));return;}const _0x3e9224=await Contact_1[_0x7a3783(0x213)][_0x7a3783(0x232)]({'where':{'number':_0x5089dc[_0x7a3783(0x253)](/\D/g,''),'companyId':_0x1fb9d1[_0x7a3783(0x266)]}});if(!_0x3e9224){logger_1[_0x7a3783(0x1e3)][_0x7a3783(0x1fb)](_0x7a3783(0x218)+_0x5089dc);return;}logger_1[_0x7a3783(0x1e3)][_0x7a3783(0x1fb)](_0x7a3783(0x234)+_0x3e9224['id']+_0x7a3783(0x25e)+_0x5089dc);const _0x14bf59=await Ticket_1['default'][_0x7a3783(0x232)]({'where':{'contactId':_0x3e9224['id'],'whatsappId':_0x1fb9d1['id'],'status':{[sequelize_1['Op']['or']]:['open',_0x7a3783(0x256)]}}});if(!_0x14bf59){logger_1['logger'][_0x7a3783(0x1fb)](_0x7a3783(0x254)+_0x3e9224['id']);return;}const _0x4ed2d6=(0x0,socket_1[_0x7a3783(0x1f9)])();_0x4ed2d6['to'](_0x14bf59['id'][_0x7a3783(0x240)]())['to'](_0x7a3783(0x237)+_0x1fb9d1[_0x7a3783(0x266)]+'-'+_0x14bf59['status'])['to'](_0x7a3783(0x20a)+_0x14bf59['queueId']+'-'+_0x14bf59[_0x7a3783(0x238)])[_0x7a3783(0x219)](_0x7a3783(0x237)+_0x1fb9d1[_0x7a3783(0x266)]+_0x7a3783(0x263),{'ticketId':_0x14bf59['id'],'presence':_0x1459e5});}catch(_0x4b6950){logger_1[_0x7a3783(0x1e3)][_0x7a3783(0x230)]('Error\x20processing\x20presence\x20update:\x20'+_0x4b6950[_0x7a3783(0x21d)]),Sentry[_0x7a3783(0x249)](_0x4b6950);}}),_0x59bea8['ev']['on'](_0x4a887d(0x206),_0x441f43=>{const _0x1da2f4=_0x4a887d;logger_1[_0x1da2f4(0x1e3)][_0x1da2f4(0x1fb)]('Received\x20new\x20group'),_0x441f43[_0x1da2f4(0x252)](_0x3a4e2d=>{const _0x8c640d=_0x1da2f4;_0x436d87[_0x8c640d(0x245)](_0x3a4e2d['id'],_0x3a4e2d);});}),_0x59bea8['ev']['on'](_0x4a887d(0x209),async([_0x4a40a2])=>{const _0x3aaeb2=_0x4a887d;logger_1['logger'][_0x3aaeb2(0x1fb)](_0x3aaeb2(0x1fd));const _0xa8cc21=await _0x59bea8[_0x3aaeb2(0x20e)](_0x4a40a2['id']);_0x436d87['set'](_0x4a40a2['id'],_0xa8cc21);}),_0x59bea8['ev']['on']('group-participants.update',async _0x116869=>{const _0x59d6eb=_0x4a887d;logger_1[_0x59d6eb(0x1e3)][_0x59d6eb(0x1fb)](_0x59d6eb(0x260));try{const _0x53b10f=await _0x59bea8[_0x59d6eb(0x20e)](_0x116869['id']);_0x436d87['set'](_0x116869['id'],_0x53b10f);}catch(_0x1ee065){_0x436d87['del'](_0x116869['id']);}});})());}catch(_0x4793c1){Sentry[_0x5e2e65(0x249)](_0x4793c1),console[_0x5e2e65(0x222)](_0x4793c1),_0x1f3951(_0x4793c1);}});};exports[a295_0x47beca(0x229)]=initWASocket;