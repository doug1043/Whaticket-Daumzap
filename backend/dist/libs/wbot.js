'use strict';const a293_0x3e5b0c=a293_0x10a9;(function(_0x585d3d,_0x29304b){const _0x24f4d8=a293_0x10a9,_0xf431a0=_0x585d3d();while(!![]){try{const _0x5e5c88=parseInt(_0x24f4d8(0xf7))/0x1+-parseInt(_0x24f4d8(0x16b))/0x2+-parseInt(_0x24f4d8(0x108))/0x3+-parseInt(_0x24f4d8(0x15d))/0x4+-parseInt(_0x24f4d8(0x144))/0x5+parseInt(_0x24f4d8(0xfd))/0x6+parseInt(_0x24f4d8(0xfa))/0x7;if(_0x5e5c88===_0x29304b)break;else _0xf431a0['push'](_0xf431a0['shift']());}catch(_0x52b4bb){_0xf431a0['push'](_0xf431a0['shift']());}}}(a293_0x34dc,0xa735d));var __createBinding=this&&this[a293_0x3e5b0c(0x104)]||(Object[a293_0x3e5b0c(0x155)]?function(_0xa94298,_0x21e870,_0x490810,_0x3de062){const _0xf00dcc=a293_0x3e5b0c;if(_0x3de062===undefined)_0x3de062=_0x490810;var _0x78c2df=Object['getOwnPropertyDescriptor'](_0x21e870,_0x490810);(!_0x78c2df||('get'in _0x78c2df?!_0x21e870['__esModule']:_0x78c2df['writable']||_0x78c2df[_0xf00dcc(0x12d)]))&&(_0x78c2df={'enumerable':!![],'get':function(){return _0x21e870[_0x490810];}}),Object[_0xf00dcc(0x12b)](_0xa94298,_0x3de062,_0x78c2df);}:function(_0x2ac729,_0x4f07a7,_0x305868,_0x5e8c48){if(_0x5e8c48===undefined)_0x5e8c48=_0x305868;_0x2ac729[_0x5e8c48]=_0x4f07a7[_0x305868];}),__setModuleDefault=this&&this[a293_0x3e5b0c(0x12c)]||(Object['create']?function(_0x1cc277,_0x5030d9){const _0x2dbaf7=a293_0x3e5b0c;Object[_0x2dbaf7(0x12b)](_0x1cc277,'default',{'enumerable':!![],'value':_0x5030d9});}:function(_0x589867,_0x10ab16){const _0x7ed743=a293_0x3e5b0c;_0x589867[_0x7ed743(0x145)]=_0x10ab16;}),__importStar=this&&this['__importStar']||(function(){const _0x52a2a9=(function(){let _0x25eaf8=!![];return function(_0x4142c9,_0x588512){const _0x57aa72=_0x25eaf8?function(){const _0x3b53a9=a293_0x10a9;if(_0x588512){const _0x557b1a=_0x588512[_0x3b53a9(0x106)](_0x4142c9,arguments);return _0x588512=null,_0x557b1a;}}:function(){};return _0x25eaf8=![],_0x57aa72;};}()),_0x1ff39c=_0x52a2a9(this,function(){const _0x351603=a293_0x10a9;return _0x1ff39c[_0x351603(0x16c)]()['search'](_0x351603(0x10f))[_0x351603(0x16c)]()[_0x351603(0x125)](_0x1ff39c)['search'](_0x351603(0x10f));});_0x1ff39c();var _0x433169=function(_0x5317d5){const _0x3e3db3=a293_0x10a9;return _0x433169=Object[_0x3e3db3(0x115)]||function(_0x4ecbce){const _0x32aa94=_0x3e3db3;var _0x463c0b=[];for(var _0x293bb9 in _0x4ecbce)if(Object[_0x32aa94(0x121)][_0x32aa94(0x17a)][_0x32aa94(0x14d)](_0x4ecbce,_0x293bb9))_0x463c0b[_0x463c0b[_0x32aa94(0x11d)]]=_0x293bb9;return _0x463c0b;},_0x433169(_0x5317d5);};return function(_0x1849ef){const _0x37ab4c=a293_0x10a9;if(_0x1849ef&&_0x1849ef[_0x37ab4c(0x164)])return _0x1849ef;var _0x2da95e={};if(_0x1849ef!=null){for(var _0x2bcabb=_0x433169(_0x1849ef),_0x5ee339=0x0;_0x5ee339<_0x2bcabb[_0x37ab4c(0x11d)];_0x5ee339++)if(_0x2bcabb[_0x5ee339]!==_0x37ab4c(0x145))__createBinding(_0x2da95e,_0x1849ef,_0x2bcabb[_0x5ee339]);}return __setModuleDefault(_0x2da95e,_0x1849ef),_0x2da95e;};}()),__importDefault=this&&this[a293_0x3e5b0c(0x13b)]||function(_0x59e4e6){const _0x50ebac=a293_0x3e5b0c;return _0x59e4e6&&_0x59e4e6[_0x50ebac(0x164)]?_0x59e4e6:{'default':_0x59e4e6};};Object[a293_0x3e5b0c(0x12b)](exports,a293_0x3e5b0c(0x164),{'value':!![]}),exports['initWASocket']=exports[a293_0x3e5b0c(0x165)]=exports[a293_0x3e5b0c(0x13e)]=exports[a293_0x3e5b0c(0xf5)]=void 0x0;const Sentry=__importStar(require(a293_0x3e5b0c(0x110))),baileys_1=__importStar(require(a293_0x3e5b0c(0x126))),node_cache_1=__importDefault(require(a293_0x3e5b0c(0x11b))),sequelize_1=require(a293_0x3e5b0c(0x10a)),Whatsapp_1=__importDefault(require(a293_0x3e5b0c(0x157))),logger_1=require(a293_0x3e5b0c(0x177)),authState_1=__importDefault(require(a293_0x3e5b0c(0x14c))),AppError_1=__importDefault(require(a293_0x3e5b0c(0x124))),socket_1=require(a293_0x3e5b0c(0x170)),StartWhatsAppSession_1=require(a293_0x3e5b0c(0x120)),DeleteBaileysService_1=__importDefault(require(a293_0x3e5b0c(0x13c))),Contact_1=__importDefault(require('../models/Contact')),Ticket_1=__importDefault(require('../models/Ticket')),GetPublicSettingService_1=__importDefault(require(a293_0x3e5b0c(0x154))),Message_1=__importDefault(require(a293_0x3e5b0c(0x122))),sessions=[],retriesQrCodeMap=new Map(),getWbot=_0x344dbe=>{const _0x3bf54b=a293_0x3e5b0c,_0x12a588=sessions[_0x3bf54b(0x12e)](_0x483e61=>_0x483e61['id']===_0x344dbe);if(_0x12a588===-0x1)throw new AppError_1[(_0x3bf54b(0x145))](_0x3bf54b(0x103));return sessions[_0x12a588];};exports[a293_0x3e5b0c(0xf5)]=getWbot;const removeWbot=async(_0x21d7a1,_0x1c4334=!![])=>{const _0x5b33bb=a293_0x3e5b0c;try{const _0x51e6d8=sessions[_0x5b33bb(0x12e)](_0x1e1769=>_0x1e1769['id']===_0x21d7a1);_0x51e6d8!==-0x1&&(_0x1c4334&&await sessions[_0x51e6d8][_0x5b33bb(0x116)](),sessions[_0x51e6d8]['ev'][_0x5b33bb(0x15a)](_0x5b33bb(0x127)),sessions[_0x51e6d8]['ev'][_0x5b33bb(0x15a)]('creds.update'),sessions[_0x51e6d8]['ev']['removeAllListeners'](_0x5b33bb(0x132)),sessions[_0x51e6d8]['ev']['removeAllListeners'](_0x5b33bb(0x14e)),sessions[_0x51e6d8]['ev'][_0x5b33bb(0x15a)](_0x5b33bb(0x12a)),sessions[_0x51e6d8]['ev'][_0x5b33bb(0x15a)](_0x5b33bb(0x16a)),sessions[_0x51e6d8]['ev'][_0x5b33bb(0x15a)](_0x5b33bb(0xfb)),sessions[_0x51e6d8][_0x5b33bb(0x105)](null),sessions[_0x51e6d8]['ws'][_0x5b33bb(0x15a)](),await sessions[_0x51e6d8]['ws']['close'](),sessions['splice'](_0x51e6d8,0x1));}catch(_0x30f9c7){logger_1[_0x5b33bb(0x128)][_0x5b33bb(0x163)](_0x30f9c7);}};function a293_0x34dc(){const _0x42fe5b=['../utils/logger','Starting\x20session\x20','Ignoring\x20presence\x20from\x20possible\x20group','hasOwnProperty','getWbot','isLegacy:\x20','1336010XlfynI','DISCONNECTED','Reconnecting\x20','5846029KZQqCd','contacts.upsert','whatsappSession','7101570YKKvlV','BROWSER_NAME','cacheMessage:\x20not\x20found\x20in\x20cache\x20-\x20fallback\x20to\x20database','cacheMessage:\x20error\x20parsing\x20message\x20from\x20database\x20-\x20','CONFIG_SESSION_WA_CONNECTION','companyId','ERR_WAPP_NOT_INITIALIZED','__createBinding','end','apply','creds.update','1739481woMvKV','\x20in\x202\x20seconds','sequelize','Found\x20contact\x20ID:\x20','message','dataJson','\x20Connection\x20Update\x20','(((.+)+)+)+$','@sentry/node','debug','StartWhatsAppSession','parse','findAll','getOwnPropertyNames','logout','groupCache.get\x20','groupCache.flushAll','env','-whatsappSession','node-cache','groupCache.set\x20','length','BROWSER_CLIENT','info','../services/WbotServices/StartWhatsAppSession','prototype','../models/Message','captureException','../errors/AppError','constructor','@whiskeysockets/baileys','connection.update','logger','loggedOut','groups.update','defineProperty','__setModuleDefault','configurable','findIndex','endsWith','initWASocket','open','presence.update','BROWSER_VERSION','map','\x20not\x20found','\x20for\x20number:\x20','cacheMessage:\x20recovered\x20from\x20database','Received\x20group\x20participants\x20update','push','key','__importDefault','../services/BaileysServices/DeleteBaileysService','statusCode','removeWbot','\x20set','stable','del','groupMetadata',',\x20isLatest:\x20','5714195JAAKZT','default','Error\x20processing\x20presence\x20update:\x20','reload','fromMe','status','Session\x20QRCode\x20Generate\x20','Socket\x20\x20','../helpers/authState','call','groups.upsert','Formato\x20invÃ¡lido\x20para\x20versionWA.\x20Esperado:\x200.0000.0000000000','output','company-','isJidBroadcast','versionWA','../services/SettingServices/GetPublicSettingService','create','Contact\x20not\x20found\x20for\x20','../models/Whatsapp','forEach','Erro\x20ao\x20inicializar\x20waVersion:','removeAllListeners','PENDING','using\x20WA\x20v','2399680nvRevf','Received\x20new\x20group','pending','Using\x20WA\x20v','log','10.0','error','__esModule','restartWbot','get','then','queue-','makeCacheableSignalKeyStore','group-participants.update','694546OxMYRc','toString','update','Chrome','cacheMessage:\x20saved','./socket','emit','findOne','loggerBaileys','set','close','groupCache.del\x20'];a293_0x34dc=function(){return _0x42fe5b;};return a293_0x34dc();}function a293_0x10a9(_0xf28cca,_0x50525c){const _0x2eb098=a293_0x34dc();return a293_0x10a9=function(_0x1010f0,_0x514e45){_0x1010f0=_0x1010f0-0xf5;let _0x34dc88=_0x2eb098[_0x1010f0];return _0x34dc88;},a293_0x10a9(_0xf28cca,_0x50525c);}exports[a293_0x3e5b0c(0x13e)]=removeWbot;const getVersionWA=async()=>{const _0xa3d5b9=a293_0x3e5b0c;try{const _0x18a5d3=_0xa3d5b9(0x153),_0xf1c873=0x1,_0xc0e98a=await(0x0,GetPublicSettingService_1[_0xa3d5b9(0x145)])({'key':_0x18a5d3,'companyId':_0xf1c873});return _0xc0e98a||process[_0xa3d5b9(0x119)][_0xa3d5b9(0x101)];}catch(_0x15585f){return console[_0xa3d5b9(0x163)]('Erro\x20ao\x20obter\x20versionWA:',_0x15585f),process[_0xa3d5b9(0x119)]['CONFIG_SESSION_WA_CONNECTION'];}},restartWbot=async(_0x2bfbe7,_0x65c600)=>{const _0x44cc01=a293_0x3e5b0c;try{const _0x478aaf={'where':{'companyId':_0x2bfbe7},'attributes':['id']},_0x4b54df=await Whatsapp_1[_0x44cc01(0x145)][_0x44cc01(0x114)](_0x478aaf);_0x4b54df[_0x44cc01(0x134)](async _0x576cdb=>{const _0x2c3cdd=_0x44cc01,_0x268276=sessions['findIndex'](_0xce2362=>_0xce2362['id']===_0x576cdb['id']);_0x268276!==-0x1&&sessions[_0x268276]['ws'][_0x2c3cdd(0x175)]();});}catch(_0x22529e){logger_1[_0x44cc01(0x128)]['error'](_0x22529e);}};exports[a293_0x3e5b0c(0x165)]=restartWbot;const initWASocket=async(_0x17f90c,_0x3c39b5)=>{return new Promise((_0x126ebd,_0x5c3852)=>{const _0xeec593=a293_0x10a9;try{((async()=>{const _0x24f9bc=a293_0x10a9,_0x194fa5=(0x0,socket_1['getIO'])(),_0x52c4ed=await Whatsapp_1[_0x24f9bc(0x145)][_0x24f9bc(0x172)]({'where':{'id':_0x17f90c['id']}});if(!_0x52c4ed)return;const {id:_0x28a363,name:_0x49b8a1,provider:_0x24021d}=_0x52c4ed;let _0x49b7f1;const _0x1a23e4=_0x24021d===_0x24f9bc(0x140);try{_0x49b7f1=await getVersionWA(),logger_1['logger'][_0x24f9bc(0x11f)](_0x24f9bc(0x160)+_0x49b7f1+_0x24f9bc(0x143)+_0x1a23e4);}catch(_0x17a5b0){console[_0x24f9bc(0x163)](_0x24f9bc(0x159),_0x17a5b0);}const _0x4249b5=_0x49b7f1['split']('.');if(_0x4249b5[_0x24f9bc(0x11d)]!==0x3)throw new Error(_0x24f9bc(0x14f));const [_0x281c27,_0x3c0b1,_0x1b7530]=_0x4249b5[_0x24f9bc(0x134)](Number);logger_1[_0x24f9bc(0x128)][_0x24f9bc(0x11f)](_0x24f9bc(0x15c)+_0x49b7f1),logger_1[_0x24f9bc(0x128)][_0x24f9bc(0x11f)](_0x24f9bc(0xf6)+_0x1a23e4),logger_1[_0x24f9bc(0x128)][_0x24f9bc(0x11f)](_0x24f9bc(0x178)+_0x49b8a1);let _0x1dd4c4=0x0,_0x2a6c22=null;const _0x1696b9=new node_cache_1['default']({'stdTTL':0x78,'checkperiod':0x1e,'useClones':![]});async function _0x100bb8(_0x423024){const _0x194cd0=_0x24f9bc;if(!_0x423024['id'])return null;const _0x4fb1e7=_0x1696b9['get'](_0x423024['id']);if(_0x4fb1e7)return logger_1['logger'][_0x194cd0(0x111)]({'message':_0x4fb1e7},'cacheMessage:\x20recovered\x20from\x20cache'),_0x4fb1e7;logger_1[_0x194cd0(0x128)][_0x194cd0(0x111)]({'key':_0x423024},_0x194cd0(0xff));const _0x1e6ce0=await Message_1[_0x194cd0(0x145)][_0x194cd0(0x172)]({'where':{'id':_0x423024['id'],'fromMe':!![]}});try{const _0x4ae2f7=JSON[_0x194cd0(0x113)](_0x1e6ce0[_0x194cd0(0x10d)]);return logger_1[_0x194cd0(0x128)][_0x194cd0(0x111)]({'key':_0x423024,'data':_0x4ae2f7},_0x194cd0(0x137)),_0x1696b9[_0x194cd0(0x174)](_0x423024['id'],_0x4ae2f7[_0x194cd0(0x10c)]),_0x4ae2f7[_0x194cd0(0x10c)]||undefined;}catch(_0x8386a){logger_1[_0x194cd0(0x128)][_0x194cd0(0x163)]({'key':_0x423024},_0x194cd0(0x100)+_0x8386a['message']);}return undefined;}const {state:_0x1112eb,saveState:_0x35efd7}=await(0x0,authState_1[_0x24f9bc(0x145)])(_0x17f90c),_0x53f15b=new node_cache_1[(_0x24f9bc(0x145))](),_0x1ac001=new node_cache_1[(_0x24f9bc(0x145))](),_0x4f3b73=new node_cache_1['default']({'stdTTL':0x5*0x3c,'useClones':![]}),_0x472222={'get':_0x5abe47=>{const _0xa3f43c=_0x24f9bc;logger_1['logger']['debug'](_0xa3f43c(0x117)+_0x5abe47);const _0x5a0e22=_0x4f3b73[_0xa3f43c(0x166)](_0x5abe47);return!_0x5a0e22&&(logger_1[_0xa3f43c(0x128)][_0xa3f43c(0x111)](_0xa3f43c(0x117)+_0x5abe47+_0xa3f43c(0x135)),_0x2a6c22['groupMetadata'](_0x5abe47)[_0xa3f43c(0x167)](async _0x5760ba=>{const _0x389348=_0xa3f43c;logger_1[_0x389348(0x128)][_0x389348(0x111)]({'key':_0x5abe47,'metadata':_0x5760ba},_0x389348(0x117)+_0x5abe47+_0x389348(0x13f)),_0x4f3b73['set'](_0x5abe47,_0x5760ba);})),_0x5a0e22;},'set':async(_0x11db3b,_0x40ccd4)=>{const _0x4a5439=_0x24f9bc;return logger_1['logger'][_0x4a5439(0x111)]({'key':_0x11db3b,'value':_0x40ccd4},_0x4a5439(0x11c)+_0x11db3b),_0x4f3b73['set'](_0x11db3b,_0x40ccd4);},'del':async _0x3352f3=>{const _0x11f6d1=_0x24f9bc;return logger_1[_0x11f6d1(0x128)][_0x11f6d1(0x111)](_0x11f6d1(0x176)+_0x3352f3),_0x4f3b73[_0x11f6d1(0x141)](_0x3352f3);},'flushAll':async()=>{const _0x204e3b=_0x24f9bc;return logger_1[_0x204e3b(0x128)][_0x204e3b(0x111)](_0x204e3b(0x118)),_0x4f3b73['flushAll']();}};_0x2a6c22=(0x0,baileys_1[_0x24f9bc(0x145)])({'logger':logger_1[_0x24f9bc(0x173)],'printQRInTerminal':![],'emitOwnEvents':![],'browser':[process[_0x24f9bc(0x119)][_0x24f9bc(0x11e)]||'Daumzap',process[_0x24f9bc(0x119)][_0x24f9bc(0xfe)]||_0x24f9bc(0x16e),process['env'][_0x24f9bc(0x133)]||_0x24f9bc(0x162)],'auth':{'creds':_0x1112eb['creds'],'keys':(0x0,baileys_1[_0x24f9bc(0x169)])(_0x1112eb['keys'],logger_1[_0x24f9bc(0x173)])},'version':[_0x281c27,_0x3c0b1,_0x1b7530],'defaultQueryTimeoutMs':0xea60,'msgRetryCounterCache':_0x53f15b,'generateHighQualityLinkPreview':!![],'userDevicesCache':_0x1ac001,'getMessage':_0x100bb8,'agent':_0x3c39b5,'fetchAgent':_0x3c39b5,'cachedGroupMetadata':async _0x12d092=>_0x472222[_0x24f9bc(0x166)](_0x12d092),'shouldIgnoreJid':_0x58fc32=>(0x0,baileys_1[_0x24f9bc(0x152)])(_0x58fc32)||_0x58fc32?.[_0x24f9bc(0x12f)]('@newsletter'),'transactionOpts':{'maxCommitRetries':0x1,'delayBetweenTriesMs':0xa}}),_0x2a6c22['cacheMessage']=_0x4bd714=>{const _0x16ca84=_0x24f9bc;if(!_0x4bd714['key'][_0x16ca84(0x148)])return;logger_1[_0x16ca84(0x128)][_0x16ca84(0x111)]({'message':_0x4bd714[_0x16ca84(0x10c)]},_0x16ca84(0x16f)),_0x1696b9[_0x16ca84(0x174)](_0x4bd714[_0x16ca84(0x13a)]['id'],_0x4bd714[_0x16ca84(0x10c)]);},_0x2a6c22['ev']['on'](_0x24f9bc(0x127),async({connection:_0x456fb0,lastDisconnect:_0x31b62d,qr:_0x5c83ad})=>{const _0x4e4bc9=_0x24f9bc;logger_1['logger'][_0x4e4bc9(0x11f)]({'lastDisconnect':_0x31b62d},_0x4e4bc9(0x14b)+_0x49b8a1+_0x4e4bc9(0x10e)+(_0x456fb0||''));_0x456fb0===_0x4e4bc9(0x175)&&(_0x31b62d?.[_0x4e4bc9(0x163)]?.[_0x4e4bc9(0x150)]?.['statusCode']===0x193&&(await _0x17f90c['update']({'status':_0x4e4bc9(0x15b),'session':''}),await(0x0,DeleteBaileysService_1['default'])(_0x17f90c['id']),_0x194fa5[_0x4e4bc9(0x171)](_0x4e4bc9(0x151)+_0x17f90c[_0x4e4bc9(0x102)]+'-whatsappSession',{'action':_0x4e4bc9(0x16d),'session':_0x17f90c}),(0x0,exports[_0x4e4bc9(0x13e)])(_0x28a363,![])),_0x31b62d?.['error']?.[_0x4e4bc9(0x150)]?.[_0x4e4bc9(0x13d)]!==baileys_1['DisconnectReason'][_0x4e4bc9(0x129)]?(await _0x17f90c[_0x4e4bc9(0x16d)]({'status':_0x4e4bc9(0x15b)}),_0x194fa5['emit'](_0x4e4bc9(0x151)+_0x17f90c[_0x4e4bc9(0x102)]+_0x4e4bc9(0x11a),{'action':_0x4e4bc9(0x16d),'session':_0x17f90c}),(0x0,exports['removeWbot'])(_0x28a363,![])[_0x4e4bc9(0x167)](()=>{const _0x1162e5=_0x4e4bc9;logger_1[_0x1162e5(0x128)][_0x1162e5(0x11f)](_0x1162e5(0xf9)+_0x49b8a1+_0x1162e5(0x109)),setTimeout(async()=>{const _0x1261fd=_0x1162e5;await _0x17f90c[_0x1261fd(0x147)](),await(0x0,StartWhatsAppSession_1[_0x1261fd(0x112)])(_0x17f90c,_0x17f90c[_0x1261fd(0x102)]);},0x7d0);})):(await _0x17f90c[_0x4e4bc9(0x16d)]({'status':_0x4e4bc9(0x15b),'session':''}),await(0x0,DeleteBaileysService_1[_0x4e4bc9(0x145)])(_0x17f90c['id']),_0x194fa5['emit'](_0x4e4bc9(0x151)+_0x17f90c[_0x4e4bc9(0x102)]+'-whatsappSession',{'action':_0x4e4bc9(0x16d),'session':_0x17f90c}),(0x0,exports['removeWbot'])(_0x28a363,![])[_0x4e4bc9(0x167)](()=>{const _0x213245=_0x4e4bc9;logger_1['logger']['info'](_0x213245(0xf9)+_0x49b8a1+_0x213245(0x109)),setTimeout(async()=>{const _0x54942a=_0x213245;await _0x17f90c[_0x54942a(0x147)](),await(0x0,StartWhatsAppSession_1[_0x54942a(0x112)])(_0x17f90c,_0x17f90c[_0x54942a(0x102)]);},0x7d0);})));if(_0x456fb0===_0x4e4bc9(0x131)){await _0x17f90c[_0x4e4bc9(0x16d)]({'status':'CONNECTED','qrcode':'','retries':0x0}),_0x194fa5[_0x4e4bc9(0x171)](_0x4e4bc9(0x151)+_0x17f90c[_0x4e4bc9(0x102)]+'-whatsappSession',{'action':'update','session':_0x17f90c});const _0x30ba01=sessions[_0x4e4bc9(0x12e)](_0x237d62=>_0x237d62['id']===_0x17f90c['id']);_0x30ba01===-0x1&&(_0x2a6c22['id']=_0x17f90c['id'],sessions['push'](_0x2a6c22)),_0x126ebd(_0x2a6c22);}if(_0x5c83ad!==undefined){if(retriesQrCodeMap[_0x4e4bc9(0x166)](_0x28a363)&&retriesQrCodeMap['get'](_0x28a363)>=0x3)await _0x52c4ed[_0x4e4bc9(0x16d)]({'status':_0x4e4bc9(0xf8),'qrcode':''}),await(0x0,DeleteBaileysService_1[_0x4e4bc9(0x145)])(_0x52c4ed['id']),_0x194fa5['emit'](_0x4e4bc9(0xfc),{'action':_0x4e4bc9(0x16d),'session':_0x52c4ed}),_0x2a6c22['ev']['removeAllListeners'](_0x4e4bc9(0x127)),_0x2a6c22['ws']['close'](),_0x2a6c22=null,retriesQrCodeMap['delete'](_0x28a363);else{logger_1[_0x4e4bc9(0x128)][_0x4e4bc9(0x11f)](_0x4e4bc9(0x14a)+_0x49b8a1),retriesQrCodeMap[_0x4e4bc9(0x174)](_0x28a363,_0x1dd4c4+=0x1),await _0x17f90c[_0x4e4bc9(0x16d)]({'qrcode':_0x5c83ad,'status':'qrcode','retries':0x0});const _0x389e5f=sessions[_0x4e4bc9(0x12e)](_0x28f7af=>_0x28f7af['id']===_0x17f90c['id']);_0x389e5f===-0x1&&(_0x2a6c22['id']=_0x17f90c['id'],sessions[_0x4e4bc9(0x139)](_0x2a6c22)),_0x194fa5[_0x4e4bc9(0x171)](_0x4e4bc9(0x151)+_0x17f90c[_0x4e4bc9(0x102)]+_0x4e4bc9(0x11a),{'action':_0x4e4bc9(0x16d),'session':_0x17f90c});}}}),_0x2a6c22['ev']['on'](_0x24f9bc(0x107),_0x35efd7),_0x2a6c22['ev']['on'](_0x24f9bc(0x132),async({id:_0x44ac84,presences:_0x40c89a})=>{const _0x222f72=_0x24f9bc;try{const _0x252534=_0x40c89a[_0x44ac84]?.['lastKnownPresence'];if(!_0x252534){logger_1['logger'][_0x222f72(0x111)](_0x222f72(0x179));return;}const _0x1336d6=await Contact_1[_0x222f72(0x145)][_0x222f72(0x172)]({'where':{'number':_0x44ac84['replace'](/\D/g,''),'companyId':_0x17f90c[_0x222f72(0x102)]}});if(!_0x1336d6){logger_1[_0x222f72(0x128)][_0x222f72(0x111)](_0x222f72(0x156)+_0x44ac84);return;}logger_1[_0x222f72(0x128)][_0x222f72(0x111)](_0x222f72(0x10b)+_0x1336d6['id']+_0x222f72(0x136)+_0x44ac84);const _0x411563=await Ticket_1[_0x222f72(0x145)][_0x222f72(0x172)]({'where':{'contactId':_0x1336d6['id'],'whatsappId':_0x17f90c['id'],'status':{[sequelize_1['Op']['or']]:[_0x222f72(0x131),_0x222f72(0x15f)]}}});if(!_0x411563){logger_1[_0x222f72(0x128)][_0x222f72(0x111)]('No\x20active\x20ticket\x20found\x20for\x20contact\x20'+_0x1336d6['id']);return;}const _0xad655=(0x0,socket_1['getIO'])();_0xad655['to'](_0x411563['id'][_0x222f72(0x16c)]())['to']('company-'+_0x17f90c['companyId']+'-'+_0x411563[_0x222f72(0x149)])['to'](_0x222f72(0x168)+_0x411563['queueId']+'-'+_0x411563['status'])[_0x222f72(0x171)](_0x222f72(0x151)+_0x17f90c[_0x222f72(0x102)]+'-presence',{'ticketId':_0x411563['id'],'presence':_0x252534});}catch(_0x2f9f4b){logger_1[_0x222f72(0x128)][_0x222f72(0x163)](_0x222f72(0x146)+_0x2f9f4b[_0x222f72(0x10c)]),Sentry['captureException'](_0x2f9f4b);}}),_0x2a6c22['ev']['on'](_0x24f9bc(0x14e),_0x41219f=>{const _0x5cf16b=_0x24f9bc;logger_1[_0x5cf16b(0x128)][_0x5cf16b(0x111)](_0x5cf16b(0x15e)),_0x41219f[_0x5cf16b(0x158)](_0x359695=>{_0x472222['set'](_0x359695['id'],_0x359695);});}),_0x2a6c22['ev']['on']('groups.update',async([_0xd77f59])=>{const _0x3772da=_0x24f9bc;logger_1[_0x3772da(0x128)]['debug']('Received\x20group\x20update');const _0x517599=await _0x2a6c22[_0x3772da(0x142)](_0xd77f59['id']);_0x472222[_0x3772da(0x174)](_0xd77f59['id'],_0x517599);}),_0x2a6c22['ev']['on'](_0x24f9bc(0x16a),async _0x5c9abd=>{const _0x2536fa=_0x24f9bc;logger_1['logger']['debug'](_0x2536fa(0x138));try{const _0x21060b=await _0x2a6c22[_0x2536fa(0x142)](_0x5c9abd['id']);_0x472222['set'](_0x5c9abd['id'],_0x21060b);}catch(_0x12cf74){_0x472222[_0x2536fa(0x141)](_0x5c9abd['id']);}});})());}catch(_0x115715){Sentry[_0xeec593(0x123)](_0x115715),console[_0xeec593(0x161)](_0x115715),_0x5c3852(_0x115715);}});};exports[a293_0x3e5b0c(0x130)]=initWASocket;